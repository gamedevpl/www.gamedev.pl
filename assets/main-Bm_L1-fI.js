var Ie=Object.defineProperty;var je=(e,t,o)=>t in e?Ie(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var ne=(e,t,o)=>je(e,typeof t!="symbol"?t+"":t,o);import{r as D,j as u}from"./index-CI0GmJZi.js";var d=(e=>(e[e.CapOfInvisibility=0]="CapOfInvisibility",e[e.ConfusedMonsters=1]="ConfusedMonsters",e[e.LandMine=2]="LandMine",e[e.TimeBomb=3]="TimeBomb",e[e.Crusher=4]="Crusher",e[e.Builder=5]="Builder",e[e.Climber=6]="Climber",e[e.Teleport=7]="Teleport",e))(d||{}),j=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right",e))(j||{});function ce(e){switch(e){case 0:return"Now you see me, now you don't!";case 1:return"Monsters are dizzy!";case 2:return"Boom goes the floor!";case 3:return"Tick tock, boom o'clock!";case 4:return"Hulk smash!";case 5:return"Bob the Builder mode: ON";case 6:return"Walk on walls like a pro!";case 7:return"Beam me up, Scotty!";default:return"Mystery power activated!"}}const C=60,T=30;function M(e,t){return{x:(e-t)*C/2,y:(e+t)*T/2}}function he(e){switch(e){case"obstacle":return 1;case"bonus":case"landMine":case"timeBomb":return 2;case"goal":return 3;case"monster":return 4;case"player":return 5;case"explosion":return 6;default:return 0}}function Se(e){return e.sort((t,o)=>{const s=t.position.x+t.position.y,n=o.position.x+o.position.y;if(s!==n)return s-n;const i=he(t.type),r=he(o.type);return i!==r?i-r:0})}const ae=250,W=500,ke=()=>Math.cos(Date.now()/1e3*Math.PI),Ae=e=>.5+(e/2+1)/2,de=(e,t,o)=>{const s=Math.min(Date.now()-o,ae)/ae;return{x:t.x+(e.x-t.x)*s,y:t.y+(e.y-t.y)*s}},Ee=(e,t,o)=>Date.now()-o<W/2?t:e,De=e=>{const t=Date.now()/1e3;return Math.sin(t*2+e)*3},me=e=>{const t=Date.now()/50;return{x:Math.sin(t)*e,y:Math.cos(t*1.5)*e}},Oe=(e,t,o,s)=>{const n=[],i=s-o,r=1e3;if(i>r)return n;const a=t/13,l=i/r,h=Math.sqrt(a*(1-l)),c=Math.floor(h*10);for(let p=0;p<c;p++)n.push({position:{x:Math.random()*e,y:Math.random()*e},intensity:10*h,duration:10*h});return n},fe=500,Be=(e,t,o)=>{const s=Math.min((Date.now()-e)/fe,1);return o?1-s:t?s:1},Le=()=>me(2),Fe=e=>{const o=e%1e3/1e3;return Math.sin(o*Math.PI)*20},Re=e=>Math.max(0,1-e/2e3),Ge=e=>e<W/2?Math.max(0,1-e/2/(W/2)*2):Math.min(1,(e/2/(W/2)-.5)*2),Ne=(e,t,o)=>{const{x:s,y:n}=M(t.x,t.y);e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.ellipse(s,n+T/2,C/2,T/4,0,0,Math.PI*2),e.fill(),e.fillStyle="#FFD700",e.beginPath(),e.moveTo(s,n),e.lineTo(s+C/2,n+T/2),e.lineTo(s,n+T),e.lineTo(s-C/2,n+T/2),e.closePath(),e.fill(),e.fillStyle="#000000",e.font=`${o/2}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("â˜…",s,n+T/2)},Ve=(e,t,o)=>{t.forEach(s=>{const{position:n,creationTime:i,isRaising:r,isDestroying:a}=s,{x:l,y:h}=M(n.x,n.y),c=Be(i,r,a)*o*.8;if(c===0)return;const p=c/o*.2,{x:y,y:b}=M(n.x,n.y+1),{x:v,y:f}=M(n.x+1,n.y+1),{x:w,y:k}=M(n.x+1,n.y+1+p),{x:I,y:S}=M(n.x,n.y+1+p);e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(y,b),e.lineTo(v,f),e.lineTo(w,k),e.lineTo(I,S),e.closePath(),e.fill();const E=a?c/(o*.8):1;e.fillStyle=`rgba(142, 36, 170, ${E})`,e.beginPath(),e.moveTo(l,h-c),e.lineTo(l+C/2,h+T/2-c),e.lineTo(l,h+T-c),e.lineTo(l-C/2,h+T/2-c),e.closePath(),e.fill(),e.fillStyle=`rgba(106, 27, 154, ${E})`,e.beginPath(),e.moveTo(l+C/2,h+T/2-c),e.lineTo(l+C/2,h+T/2),e.lineTo(l,h+T),e.lineTo(l,h+T-c),e.closePath(),e.fill(),e.fillStyle=`rgba(74, 20, 140, ${E})`,e.beginPath(),e.moveTo(l-C/2,h+T/2-c),e.lineTo(l-C/2,h+T/2),e.lineTo(l,h+T),e.lineTo(l,h+T-c),e.closePath(),e.fill()})},$e=(e,t)=>{const o=M(0,0),s=M(t,0),n=M(0,t),i=M(t,t);e.fillStyle="#c2b280",e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(s.x,s.y),e.lineTo(i.x,i.y),e.lineTo(n.x,n.y),e.closePath(),e.fill(),e.fillStyle="#5d4037",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x,i.y+z),e.lineTo(n.x,n.y+z),e.lineTo(n.x,n.y),e.closePath(),e.fill(),e.fillStyle="#8d6e63",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x,i.y+z),e.lineTo(s.x,s.y+z),e.lineTo(s.x,s.y),e.closePath(),e.fill()},ye=(e,t)=>{e.strokeStyle="#4a4a4a",e.lineWidth=1;for(let o=0;o<=t;o++)for(let s=0;s<=t;s++){const{x:n,y:i}=M(s,o);s<t&&(e.beginPath(),e.moveTo(n,i),e.lineTo(n+C/2,i+T/2),e.stroke()),o<t&&(e.beginPath(),e.moveTo(n,i),e.lineTo(n-C/2,i+T/2),e.stroke())}},re=(e,t,o,s,n)=>{e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.ellipse(t+s/2,o+n/2+5,s/2,n/4,0,0,Math.PI*2),e.fill()},Xe=e=>{const{isoX:t,isoY:o,cellSize:s,baseHeight:n,widthFactor:i,heightAnimationFactor:r}=e,a=ke(),l=n*s+s*r*a,h=C*i,c=Ae(a),p=C*i*c,y=T*.4*c;return{entityHeight:l,entityWidth:h,shadowWidth:p,shadowHeight:y,animFactor:a,shadowX:t-p/2,shadowY:o+T/2}},qe=(e,t,o,s,n,i,r)=>{e.fillStyle=i,e.beginPath(),e.moveTo(t,o-s-r),e.lineTo(t+n/2,o-s+T/4-r),e.lineTo(t,o+T/2-r),e.lineTo(t-n/2,o-s+T/4-r),e.closePath(),e.fill()},xe=(e,t,o,s,n,i,r)=>{e.fillStyle=i,e.beginPath(),e.arc(t,o-s-n/2-r,n,0,Math.PI*2),e.fill()},We=(e,t,o,s,n,i,r,a)=>{const l=n*.3;e.fillStyle=i,e.beginPath(),e.arc(t-n/3,o-s-n/2-a,l,0,Math.PI*2),e.arc(t+n/3,o-s-n/2-a,l,0,Math.PI*2),e.fill(),e.fillStyle=r,e.beginPath(),e.arc(t-n/3,o-s-n/2-a,l/2,0,Math.PI*2),e.arc(t+n/3,o-s-n/2-a,l/2,0,Math.PI*2),e.fill()},Ye=(e,t,o,s,n,i)=>{e.strokeStyle="black",e.lineWidth=2,e.beginPath(),e.arc(t,o-s+n/4-i,n/2,.1*Math.PI,.9*Math.PI),e.stroke()},He=(e,t,o,s,n,i,r,a,l,h,c,p,y,b)=>{e.strokeStyle=h,e.lineWidth=l;const v=Math.sin(p*1e3)*Math.PI;for(let f=0;f<r;f++){const w=f/r*Math.PI*2,k=t+Math.cos(w)*(n/3),I=o-s/2+Math.sin(w)*(s/4)-b,S=2+Math.sin(p*100+f)*2,E=.1+Math.cos(p*200+f)*.05,Q=k+Math.cos(w)*(a/2),N=I+Math.sin(w)*(a/2)+Math.sin(c*S+v+f)*i*E,H=k+Math.cos(w)*a,U=I+Math.sin(w)*a+Math.sin(c*S+Math.PI+v+f)*i*(E*1.5),Z=k+Math.cos(w)*a,J=I+Math.sin(w)*a+Math.sin(c*S+v+f)*i*(E*2);y&&(e.save(),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.lineWidth=l*1.5,e.beginPath(),e.moveTo(k,I+T/2),e.bezierCurveTo(Q,N+T/2,H,U+T/2,Z,J+T/2),e.stroke(),e.restore()),e.beginPath(),e.moveTo(k,I),e.bezierCurveTo(Q,N,H,U,Z,J),e.stroke()}},be=e=>{const{ctx:t,isoX:o,isoY:s,cellSize:n,baseHeight:i,widthFactor:r,heightAnimationFactor:a,bodyColor:l,headColor:h,eyeColor:c,pupilColor:p,hasTentacles:y=!1,tentacleColor:b="",tentacleCount:v=0,tentacleLength:f=0,tentacleWidth:w=0,isInvisible:k=!1,seed:I=0,castShadow:S=!0,isConfused:E=!1}=e,Q=Xe({isoX:o,isoY:s,cellSize:n,baseHeight:i,widthFactor:r,heightAnimationFactor:a}),{entityHeight:N,entityWidth:H,shadowWidth:U,shadowHeight:Z,animFactor:J,shadowX:Me,shadowY:Pe}=Q,_=De(I),le=E?Le():{x:0,y:0};let $=o,X=s;$+=le.x,X+=le.y,S&&(t.fillStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.ellipse(Me+U/2,Pe,U/2,Z/2,0,0,Math.PI*2),t.fill()),t.save(),k&&(t.globalAlpha=.5),y&&b&&v>0&&He(t,$,X,N,H,n,v,f,w,b,J,I,S,_),qe(t,$,X,N,H,l,_);const se=n*.25;xe(t,$,X,N,se,h,_),We(t,$,X,N,se,c,p,_),Ye(t,$,X,N,se,_),t.restore()},Ue=(e,t,o,s=!1,n=[])=>{const{position:i,previousPosition:r,moveTimestamp:a,teleportTimestamp:l,isVanishing:h,isVictorious:c,isClimbing:p}=t,y=l&&Date.now()-l<W,b=y?Ee(i,r,l):de(i,r,a);let{x:v,y:f}=M(b.x,b.y);if(c){const k=Fe(Date.now()-a);f-=k}p&&n.some(I=>I.position.x===Math.round(b.x)&&I.position.y===Math.round(b.y))&&(f-=o*.5);const w={ctx:e,isoX:v,isoY:f,cellSize:o,baseHeight:.8,widthFactor:.6,heightAnimationFactor:.2,bodyColor:p?"#FFA500":"#00FF00",headColor:p?"#FFD700":"#32CD32",eyeColor:"white",pupilColor:"black",isInvisible:s};h?e.globalAlpha=Re(Date.now()-a):y&&(e.globalAlpha=Ge(Date.now()-l)),be(w),e.globalAlpha=1,c&&_e(e,v,f,o),p&&Ke(e,v,f,o),y&&Qe(e,v,f,o,Date.now()-l)},_e=(e,t,o,s)=>{e.save(),e.translate(t,o);for(let n=0;n<10;n++){const i=Math.PI*2*n/10,r=s*(.5+Math.sin(Date.now()/200+n)*.2),a=Math.cos(i)*r,l=Math.sin(i)*r;e.beginPath(),e.arc(a,l,s*.1,0,Math.PI*2),e.fillStyle=`hsl(${(Date.now()/20+n*36)%360}, 100%, 50%)`,e.fill()}e.restore()},Ke=(e,t,o,s)=>{e.save(),e.translate(t,o-s*.6);const n=s*.3;e.strokeStyle="#FFD700",e.lineWidth=2,e.beginPath(),e.moveTo(-n/2,-n/2),e.lineTo(-n/2,n/2),e.moveTo(n/2,-n/2),e.lineTo(n/2,n/2);for(let r=0;r<3;r++){const a=-n/2+(r+1)*(n/3);e.moveTo(-n/2,a),e.lineTo(n/2,a)}e.stroke(),e.shadowColor="#FFD700",e.shadowBlur=5,e.stroke();const i=Math.sin(Date.now()/200)*s*.05;e.translate(0,i),e.stroke(),e.restore()},Qe=(e,t,o,s,n)=>{e.save(),e.translate(t,o);const i=s*1.5,r=n/W;if(r<.5){const a=r*2,l=i*a;e.beginPath(),e.arc(0,0,l,0,Math.PI*2);const h=e.createRadialGradient(0,0,0,0,0,l);h.addColorStop(0,"rgba(0, 255, 255, 0)"),h.addColorStop(.7,"rgba(0, 255, 255, 0.7)"),h.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=h,e.fill();for(let c=0;c<20;c++){const p=Math.random()*Math.PI*2,y=Math.random()*l,b=Math.cos(p)*y,v=Math.sin(p)*y,f=s*.05*(1-a);e.beginPath(),e.arc(b,v,f,0,Math.PI*2),e.fillStyle="rgba(0, 255, 255, "+(1-a)+")",e.fill()}}else{const a=(r-.5)*2,l=i*(1-a);e.beginPath(),e.arc(0,0,l,0,Math.PI*2);const h=e.createRadialGradient(0,0,0,0,0,l);h.addColorStop(0,"rgba(0, 255, 255, 0.7)"),h.addColorStop(.7,"rgba(0, 255, 255, 0.3)"),h.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=h,e.fill();for(let c=0;c<20;c++){const p=Math.random()*Math.PI*2,y=Math.random()*i,b=Math.cos(p)*y,v=Math.sin(p)*y,f=s*.05*a;e.beginPath(),e.arc(b,v,f,0,Math.PI*2),e.fillStyle="rgba(0, 255, 255, "+a+")",e.fill()}}e.restore()},Ze=(e,t,o)=>{t.forEach(s=>{const n=de(s.position,s.previousPosition,s.moveTimestamp),{x:i,y:r}=M(n.x,n.y),a={ctx:e,isoX:i,isoY:r,cellSize:o,baseHeight:.4,widthFactor:.6,heightAnimationFactor:.1,bodyColor:"#800080",headColor:"#9932CC",eyeColor:"white",pupilColor:"red",hasTentacles:!0,tentacleColor:"#600060",tentacleCount:6,tentacleLength:o*.5,tentacleWidth:4,seed:s.seed,castShadow:!0};be(a)})},O=T*.4,Je=(e,t,o)=>{t.forEach(s=>{const{x:n,y:i}=M(s.position.x,s.position.y);re(e,n-C/4,i-T/4,C/2,T),e.fillStyle=tt(s.type),e.beginPath(),e.moveTo(n,i-O),e.lineTo(n+C/4,i-O/2),e.lineTo(n,i),e.lineTo(n-C/4,i-O/2),e.closePath(),e.fill(),e.beginPath(),e.arc(n,i-O,C/6,0,Math.PI*2),e.fill(),e.fillStyle="white",e.font=`bold ${o/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(ot(s.type),n,i-O)})},ze=(e,t,o)=>{t.forEach(s=>{const{x:n,y:i}=M(s.x,s.y);re(e,n-C/2,i,C,T),e.fillStyle="brown",e.beginPath(),e.moveTo(n,i-O/2),e.lineTo(n+C/4,i-O/4),e.lineTo(n,i),e.lineTo(n-C/4,i-O/4),e.closePath(),e.fill(),e.beginPath(),e.arc(n,i-O/2,C/5,0,Math.PI*2),e.fill(),e.fillStyle="white",e.font=`bold ${o/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("M",n,i-O/2)})},et=(e,t,o)=>{t.forEach(s=>{const{x:n,y:i}=M(s.position.x,s.position.y);re(e,n-C/2,i,C,T),e.fillStyle="black",e.beginPath(),e.moveTo(n,i-O),e.lineTo(n+C/4,i-O/2),e.lineTo(n,i),e.lineTo(n-C/4,i-O/2),e.closePath(),e.fill(),e.strokeStyle="orange",e.lineWidth=2,e.beginPath(),e.moveTo(n,i-O),e.quadraticCurveTo(n+C/8,i-O*1.5,n+C/4,i-O*1.25),e.stroke(),e.fillStyle="white",e.font=`bold ${o/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(s.timer.toString(),n,i-O/2)})},tt=e=>{switch(e){case d.CapOfInvisibility:return"#8A2BE2";case d.ConfusedMonsters:return"#FFA500";case d.LandMine:return"#8B4513";case d.TimeBomb:return"#000000";case d.Crusher:return"#FF69B4";case d.Builder:return"#00FFFF";default:return"#FFFF00"}},ot=e=>{switch(e){case d.CapOfInvisibility:return"I";case d.ConfusedMonsters:return"C";case d.LandMine:return"L";case d.TimeBomb:return"T";case d.Crusher:return"X";case d.Builder:return"B";default:return"?"}},st=(e,t)=>{e.save(),e.globalAlpha=.7;for(const{position:o,startTime:s,duration:n}of t){if(Date.now()-s>n)continue;const i=M(o.x+.5,o.y+.5),r=M(o.x-1,o.y-1),a=M(o.x+1*2,o.y-1),l=M(o.x+1*2,o.y+1*2),h=M(o.x-1,o.y+1*2);e.fillStyle="#FF6600",e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(a.x,a.y),e.lineTo(l.x,l.y),e.lineTo(h.x,h.y),e.closePath(),e.fill();const c=32,p=C;for(let b=0;b<c;b++){const v=Math.PI*2/c*b,f=p*Math.random(),w=i.x+Math.cos(v)*f,k=i.y+Math.sin(v)*f/2;e.fillStyle=b%2===0?"#FF9933":"#FF3300",e.beginPath(),e.arc(w,k-Math.random()*T*Math.pow(b/c,.5),C/16,0,Math.PI*2),e.fill()}const y=e.createRadialGradient(i.x,i.y,0,i.x,i.y,C*2);y.addColorStop(0,"rgba(255, 255, 0, 0.8)"),y.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=y,e.beginPath(),e.ellipse(i.x,i.y,C,T,0,0,Math.PI*2),e.fill()}e.restore()},nt=(e,t,o,s)=>{e.save(),e.globalAlpha=o.duration===12?1:.5,e.font="bold 16px Arial";const{x:n,y:i}=M(t.x,t.y),r=e.measureText(ce(o.type)).width+20,a=70,l=15,h=10,c=n-r/2,p=i-s-a-l;if(e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.moveTo(c+h,p),e.lineTo(c+r-h,p),e.quadraticCurveTo(c+r,p,c+r,p+h),e.lineTo(c+r,p+a-h),e.quadraticCurveTo(c+r,p+a,c+r-h,p+a),e.lineTo(c+r/2+l,p+a),e.lineTo(c+r/2,p+a+l),e.lineTo(c+r/2-l,p+a),e.lineTo(c+h,p+a),e.quadraticCurveTo(c,p+a,c,p+a-h),e.lineTo(c,p+h),e.quadraticCurveTo(c,p,c+h,p),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=2,e.stroke(),e.fillStyle="white",e.textAlign="center",e.fillText(ce(o.type),c+r/2,p+30),e.font="14px Arial",e.fillText(`${o.duration} steps left`,c+r/2,p+55),o.type===d.Climber){const b=c+r-30,v=p+25;e.strokeStyle="#FFD700",e.lineWidth=2,e.beginPath(),e.moveTo(b,v),e.lineTo(b,v+20),e.moveTo(b+20,v),e.lineTo(b+20,v+20);for(let f=0;f<3;f++){const w=v+(f+1)*6.666666666666667;e.moveTo(b,w),e.lineTo(b+20,w)}e.stroke()}e.restore()},it=(e,t,o,s,n)=>{const i=Oe(Math.max(t,t),o,s,Date.now());e.strokeStyle="rgba(255, 255, 255, 0.7)",e.lineWidth=2;for(const r of i){const a=M(r.position.x,r.position.y),l={x:a.x+(Math.random()-.5)*n,y:a.y+(Math.random()-.5)*n};e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(l.x,l.y),e.stroke()}},z=20,ge=(e,t,{gridSize:o,cellSize:s})=>{if(e.save(),t.explosions.length>0){const a=Math.min(t.explosions.filter(h=>Date.now()-h.startTime<h.duration).length*2,10),l=me(a);e.translate(l.x,l.y)}e.translate(e.canvas.width/2,100),e.clearRect(-e.canvas.width/2,-100,e.canvas.width,e.canvas.height),$e(e,o),ye(e,o),it(e,o,t.monsterSpawnSteps,t.player.moveTimestamp,s);const n=[...t.obstacles.map(a=>({position:a.position,type:"obstacle",obj:a})),...t.bonuses.map(a=>({position:a.position,type:"bonus",obj:a})),...t.landMines.map(a=>({position:a,type:"landMine"})),...t.timeBombs.map(a=>({position:a.position,type:"timeBomb",obj:a})),...t.monsters.map(a=>({position:a.position,type:"monster",obj:a})),{position:t.player.position,type:"player",obj:t.player},{position:t.goal,type:"goal"},...t.explosions.map(a=>({position:a.position,type:"explosion",obj:a}))],i=Se(n);for(const a of i){const{type:l,position:h}=a;switch(l){case"obstacle":Ve(e,[a.obj],s);break;case"bonus":Je(e,[a.obj],s);break;case"landMine":ze(e,[h],s);break;case"timeBomb":et(e,[a.obj],s);break;case"monster":Ze(e,[a.obj],s);break;case"player":Ue(e,a.obj,s,t.activeBonuses.some(c=>c.type===d.CapOfInvisibility),t.obstacles);break;case"goal":Ne(e,h,s);break;case"explosion":st(e,[a.obj]);break}}const r=t.activeBonuses.find(a=>a.duration===13||[d.Builder,d.CapOfInvisibility,d.Crusher].includes(a.type));r&&nt(e,t.player.position,r,s),e.restore()},ee=300,te=200,q=5,at=Math.min(ee/q,te/q)/2,rt=()=>({player:{position:{x:2,y:2},previousPosition:{x:2,y:2},moveTimestamp:Date.now(),isInvisible:!1,isVictorious:!1,isVanishing:!1,isClimbing:!1},goal:{x:4,y:4},obstacles:[{position:{x:1,y:1},creationTime:Date.now(),isRaising:!1,isDestroying:!1},{position:{x:3,y:3},creationTime:Date.now(),isRaising:!1,isDestroying:!1}],monsters:[{position:{x:0,y:4},previousPosition:{x:0,y:4},moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1},{position:{x:4,y:0},previousPosition:{x:4,y:0},moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1}],steps:0,monsterSpawnSteps:0,bonuses:[{type:d.CapOfInvisibility,position:{x:1,y:3}},{type:d.ConfusedMonsters,position:{x:3,y:1}}],activeBonuses:[],explosions:[],timeBombs:[],landMines:[],crusherActive:!1,builderActive:!1,score:0,gameEndingState:"none"}),lt=()=>{const e=D.useRef(null),t=D.useRef(rt());return D.useEffect(()=>{const o=e.current;if(!o)return;const s=o.getContext("2d");if(!s)return;const n=()=>{s.clearRect(0,0,ee,te),s.save(),s.scale(.8,.8),s.translate(ee*.1,te*.1),ye(s,q),ge(s,t.current,{gridSize:q,cellSize:at,initialMonsterCount:0,obstacleCount:0,initialBonusCount:0,levelName:"Preview",levelStory:"Preview"}),s.restore(),t.current.monsters.forEach(i=>{const r=i.position.x+(Math.random()-.5)*.1,a=i.position.y+(Math.random()-.5)*.1;i.previousPosition={...i.position},i.position={x:Math.max(0,Math.min(q-1,r)),y:Math.max(0,Math.min(q-1,a))},i.moveTimestamp=Date.now()}),requestAnimationFrame(n)};n()},[]),u.jsx("canvas",{ref:e,width:ee,height:te})},ct=({onStart:e,onInstructions:t})=>(D.useEffect(()=>{const o=s=>{s.key==="ArrowRight"&&e()};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e]),u.jsxs("div",{className:"intro",children:[u.jsx("h1",{className:"game-title",children:"Monster Steps"}),u.jsxs("div",{className:"game-intro-responsive",children:[u.jsx("div",{className:"game-preview-container",children:u.jsx(lt,{})}),u.jsxs("div",{className:"game-intro-column",children:[u.jsxs("div",{className:"intro-buttons",children:[u.jsx("button",{onClick:e,children:"Start Game"}),u.jsx("button",{onClick:t,children:"Instructions"})]}),u.jsx("p",{className:"intro-tip",children:"Press right arrow to start"})]})]}),u.jsxs("p",{className:"author-name",children:["Created by ",u.jsx("a",{href:"https://x.com/gtanczyk",children:"Grzegorz TaÅ„czyk"})," | ",u.jsx("a",{href:"https://github.com/gamedevpl/www.gamedev.pl/tree/master/js13k2024",children:"Source code (GitHub)"})]})]})),ht=({onBack:e})=>(D.useEffect(()=>{const t=o=>{o.key==="Escape"&&e()};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[e]),u.jsxs("div",{className:"instructions",children:[u.jsx("h1",{children:"How to Play Monster Steps"}),u.jsxs("ul",{children:[u.jsx("li",{children:"Use arrow keys, touch controls, or mouse clicks to move your character"}),u.jsx("li",{children:"Avoid obstacles and monsters"}),u.jsx("li",{children:"Reach the goal (green square) to complete the level"}),u.jsx("li",{children:"New monsters appear every 13 steps"}),u.jsxs("li",{children:["Collect bonuses for special abilities:",u.jsxs("ul",{children:[u.jsx("li",{children:"Cap of Invisibility: Temporary invisibility"}),u.jsx("li",{children:"Confused Monsters: Monsters move randomly"}),u.jsx("li",{children:"Land Mine: Place a trap for monsters"}),u.jsx("li",{children:"Time Bomb: Delayed explosion"}),u.jsx("li",{children:"Crusher: Destroy nearby obstacles"}),u.jsx("li",{children:"Builder: Create new platforms"}),u.jsx("li",{children:"Climber: Climb on walls"}),u.jsx("li",{children:"Teleport: Jump from point A to point B"})]})]}),u.jsx("li",{children:"Complete all 13 levels to win"})]}),u.jsx("h2",{children:"Tips"}),u.jsxs("ul",{children:[u.jsx("li",{children:"Plan your route to avoid getting trapped"}),u.jsx("li",{children:"Use obstacles to block monsters"}),u.jsx("li",{children:"Strategically use bonuses to overcome challenges"}),u.jsx("li",{children:"Keep moving to stay ahead of monsters"})]}),u.jsx("button",{onClick:e,children:"Back to Menu"}),u.jsx("p",{className:"instructions-tip",children:"Press Escape to return to the main menu"})]})),G=(e,t)=>e.x===t.x&&e.y===t.y,oe=(e,t)=>t.some(o=>G(o,e)),ut=e=>{switch(e){case"ArrowUp":case"w":return j.Up;case"ArrowDown":case"s":return j.Down;case"ArrowLeft":case"a":return j.Left;case"ArrowRight":case"d":return j.Right;default:return null}},x=(e,t,o=1)=>{switch(t){case j.Up:return{...e,y:e.y-o};case j.Down:return{...e,y:e.y+o};case j.Left:return{...e,x:e.x-o};case j.Right:return{...e,x:e.x+o}}};function ue(e,t){switch(e){case j.Up:return t===-1?j.Left:j.Right;case j.Down:return t===-1?j.Left:j.Right;case j.Left:return t===-1?j.Down:j.Up;case j.Right:return t===-1?j.Up:j.Down}}const ve=(e,t,{gridSize:o})=>!(!(e.x>=0&&e.x<o&&e.y>=0&&e.y<o)||oe(e,t.obstacles.filter(i=>!i.isDestroying).map(({position:i})=>i))&&!t.player.isClimbing&&!t.crusherActive),we=(e,t)=>{const{player:o}=e;return[j.Up,j.Down,j.Left,j.Right].map(n=>({position:x(o.position,n),direction:n})).filter(({position:n})=>ve(n,e,t))};function pt(e,t,o,s){return we(o,s).find(n=>dt(e,t,Te(s.gridSize,s.cellSize,n.direction)))}function dt(e,t,o){let s=!1;for(let n=0,i=o.length-1;n<o.length;i=n++){const r=o[n].x,a=o[n].y,l=o[i].x,h=o[i].y;a>t!=h>t&&e<(l-r)*(t-a)/(h-a)+r&&(s=!s)}return s}const mt=(e,t,o,s)=>{e.save(),e.translate(e.canvas.width/2,100),t.forEach(({direction:n})=>{const i=Te(o,s,n);e.beginPath(),e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y),e.fillStyle="rgba(255, 255, 0, 0.5)",e.fill()}),e.restore()};function Te(e,t,o){const s=e/3,n=x({x:e/2,y:e/2},o,e/1.5),i=x(n,ue(o,-1),s),r=x(n,ue(o,1),s),a=M(n.x,n.y),l=M(i.x,i.y),h=M(r.x,r.y),c=x(n,o,s),p=M(c.x,c.y),y=Math.atan2(p.y-a.y,p.x-a.x),b=Math.cos(y)*t,v=Math.sin(y)*t;return[{x:p.x+b,y:p.y+v},{x:l.x+b,y:l.y+v},{x:h.x+b,y:h.y+v}]}const ft=(e,t,o,s,n,i)=>{const r=[];return e.map(a=>{let l;n?l=bt(a.position,o,s,e):l=gt(a.position,t,o,s,e);let h;return i?h=yt(a.position,l[1]||a.position,o,s,e):h=l.length>1?l[1]:a.position,V(h,r)?h=a.position:r.push(h),{...a,previousPosition:a.position,position:h,moveTimestamp:Date.now(),path:l}})},yt=(e,t,o,s,n)=>{const i=t.x-e.x,r=t.y-e.y,a={x:Math.max(0,Math.min(o-1,e.x-i)),y:Math.max(0,Math.min(o-1,e.y-r))};return!V(a,s.map(({position:l})=>l))&&!V(a,n.map(l=>l.position))?a:e},bt=(e,t,o,s)=>{const n=[{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1}].filter(i=>i.x>=0&&i.x<t&&i.y>=0&&i.y<t&&!V(i,o.map(({position:r})=>r))&&!V(i,s.map(r=>r.position)));if(n.length>0){const i=Math.floor(Math.random()*n.length);return[e,n[i]]}return[e]},gt=(e,t,o,s,n)=>{const i=[],r=[],a={position:e,g:0,h:0,f:0,parent:null};for(i.push(a);i.length>0;){let l=i[0],h=0;if(i.forEach((p,y)=>{p.f<l.f&&(l=p,h=y)}),i.splice(h,1),r.push(l),Y(l.position,t))return vt(l);const c=wt(l.position,o);for(const p of c){if(V(p,s.map(({position:w})=>w))||V(p,n.map(w=>w.position))||r.some(w=>Y(w.position,p)))continue;const y=l.g+1,b=Tt(p,t),v=y+b,f=i.find(w=>Y(w.position,p));f?y<f.g&&(f.g=y,f.f=v,f.parent=l):i.push({position:p,g:y,h:b,f:v,parent:l})}}return[e]},vt=e=>{const t=[];let o=e;for(;o!==null;)t.unshift(o.position),o=o.parent;return t},wt=(e,t)=>[{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1}].filter(s=>s.x>=0&&s.x<t&&s.y>=0&&s.y<t),Tt=(e,t)=>Math.abs(e.x-t.x)+Math.abs(e.y-t.y),Y=(e,t)=>e.x===t.x&&e.y===t.y,V=(e,t)=>t.some(o=>Y(o,e)),Ct=(e,t)=>t.some(o=>Y(o.position,e)),Mt=(e,t)=>{const o=[];return[e.filter(n=>{const i=t.find(r=>Y(r,n.position));return i?(o.push({position:i,startTime:Date.now(),duration:1e3}),Pt(t,i),!1):!0}),o]},Pt=(e,t)=>{e.splice(e.indexOf(t),1)},It=(e,t)=>Math.abs(e.position.x-t.position.x)<=1&&Math.abs(e.position.y-t.position.y)<=1,ie=(e,t)=>t.some(o=>Math.abs(e.x-o.position.x)<=1&&Math.abs(e.y-o.position.y)<=1),jt=()=>{const e=L(),t=F(7,"The First Step","Avoid the lone monster and reach the goal in 13 steps!");return e.player=B(0,3),e.goal=A(6,3),e.monsters=[g(3,0)],e.obstacles=[m(5,2),m(5,3)],[e,t,t.levelStory]},St=()=>{const e=L(),t=F(8,"Now You See Me","Use the invisibility cap to sneak past the monsters!");return e.player=B(0,4),e.goal=A(7,4),e.monsters=[g(3,2),g(5,4)],e.bonuses=[P(2,4,d.CapOfInvisibility)],e.obstacles=[m(1,3),m(1,5),m(6,3),m(6,5)],[e,t,t.levelStory]},kt=()=>{const e=L(),t=F(9,"Bridge the Gap","Build your way to victory!");return e.player=B(0,4),e.goal=A(8,4),e.monsters=[g(4,4)],e.bonuses=[P(2,4,d.Builder)],e.obstacles=[m(3,3),m(3,4),m(3,5),m(5,3),m(5,4),m(5,5)],[e,t,t.levelStory]},At=()=>{const e=L(),t=F(9,"Crush and Rush","Clear the path with your crushing power!");e.player=B(0,4),e.goal=A(8,4),e.monsters=[g(4,4)],e.bonuses=[P(2,4,d.Crusher)],e.obstacles=[m(8,2),m(7,2),m(7,3),m(7,4),m(7,5),m(8,5)];for(let o=2;o<7;o++)e.obstacles.push(m(o,3)),e.obstacles.push(m(o-1,5));return[e,t,t.levelStory]},Et=()=>{const e=L(),t=F(10,"Tick Tock Boom","Time your bomb perfectly to clear the way!");e.player=B(0,5),e.goal=A(9,5),e.monsters=[g(3,5)],e.bonuses=[P(9,3,d.TimeBomb)],e.obstacles=[m(9,4),m(8,4),m(8,5),m(8,6),m(9,6),m(4,1),m(5,1),m(6,1),m(7,1),m(8,1)];for(let o=2;o<8;o++)e.obstacles.push(m(o,4)),e.obstacles.push(m(o,6)),e.obstacles.push(m(o-2,8));return[e,t,t.levelStory]},Dt=()=>{const e=L(),t=F(10,"Minesweeper's Revenge","Plant a surprise for your pursuers!");e.player=B(0,5),e.goal=A(9,5),e.monsters=[g(6,5),g(4,8),g(8,8)],e.bonuses=[P(2,5,d.LandMine)];for(let o=4;o<9;o++)o!==6&&(e.obstacles.push(m(o,4)),e.obstacles.push(m(o,6)));return[e,t,t.levelStory]},Ot=()=>{const e=L(),t=F(11,"Monsters' Mayhem","Confuse them all and make your escape!");e.player=B(0,5),e.goal=A(10,5),e.monsters=[g(3,4),g(3,6),g(6,4),g(6,6),g(9,5)],e.bonuses=[P(2,5,d.ConfusedMonsters)];for(let o=4;o<8;o++)e.obstacles.push(m(o,3)),e.obstacles.push(m(o,7));return[e,t,t.levelStory]},Bt=()=>{const e=L(),t=F(12,"Tunnel Vision","Build a path and set a trap!");e.player=B(0,6),e.goal=A(11,6),e.monsters=[g(3,10),g(8,8)],e.bonuses=[P(2,6,d.Builder),P(2,2,d.LandMine)];for(let o=3;o<10;o++)o!==6&&(e.obstacles.push(m(o,5)),e.obstacles.push(m(o,7)));return[e,t,t.levelStory]},Lt=()=>{const e=L(),t=F(12,"Ghost Bomber","Vanish, plant, and detonate!");e.player=B(0,6),e.goal=A(11,6),e.monsters=[g(3,6),g(7,6),g(10,6)],e.bonuses=[P(2,6,d.CapOfInvisibility),P(5,6,d.TimeBomb)];for(let o=4;o<11;o++)o!==5&&o!==8&&(e.obstacles.push(m(o,5)),e.obstacles.push(m(o,7)));return[e,t,t.levelStory]},Ft=()=>{const e=L(),t=F(13,"Crush, Confuse, Conquer","A symphony of chaos!");e.player=B(0,6),e.goal=A(12,6),e.monsters=[g(4,6),g(8,6),g(11,6)],e.bonuses=[P(2,6,d.Crusher),P(6,6,d.ConfusedMonsters)];for(let o=3;o<12;o++)o!==6&&o!==9&&(e.obstacles.push(m(o,5)),e.obstacles.push(m(o,7)));return[e,t,t.levelStory]},Rt=()=>{const e=L(),t=F(14,"The Triple Threat","Build, Bomb, and Vanish!");e.player=B(0,7),e.goal=A(13,7),e.monsters=[g(3,7),g(6,7),g(9,7),g(12,7)],e.bonuses=[P(2,7,d.Builder),P(5,7,d.TimeBomb),P(8,7,d.CapOfInvisibility)];for(let o=4;o<13;o++)o!==5&&o!==8&&o!==11&&(e.obstacles.push(m(o,6)),e.obstacles.push(m(o,8)));return[e,t,t.levelStory]},Gt=()=>{const e=L(),t=F(15,"The Gauntlet","Use everything you've learned!");e.player=B(0,7),e.goal=A(14,7),e.monsters=[g(3,7),g(6,7),g(9,7),g(12,7),g(7,3),g(7,11)],e.bonuses=[P(2,7,d.LandMine),P(2,8,d.CapOfInvisibility),P(5,7,d.Crusher),P(8,7,d.ConfusedMonsters),P(1,6,d.Builder),P(2,6,d.TimeBomb)];for(let o=4;o<14;o++)o!==5&&o!==8&&o!==11&&(e.obstacles.push(m(o,6)),e.obstacles.push(m(o,8)));for(let o=4;o<11;o++)o!==7&&(e.obstacles.push(m(6,o)),e.obstacles.push(m(8,o)));return[e,t,t.levelStory]},Nt=()=>{const e=L(),t=F(16,"The Final Countdown","Can you outsmart them all?");e.player=B(0,8),e.goal=A(15,8),e.monsters=[g(5,8),g(6,8),g(9,8),g(12,8),g(8,3),g(8,13),g(15,3),g(15,13)],e.bonuses=[P(2,8,d.CapOfInvisibility),P(5,8,d.TimeBomb),P(8,8,d.LandMine),P(11,1,d.Crusher),P(14,14,d.ConfusedMonsters)];for(let o=4;o<15;o++)o!==5&&o!==8&&o!==11&&o!==14&&(e.obstacles.push(m(o,7)),e.obstacles.push(m(o,9)));for(let o=4;o<13;o++)o!==8&&(e.obstacles.push(m(7,o)),e.obstacles.push(m(9,o)));return e.obstacles.push(m(14,8)),[e,t,t.levelStory]},A=(e,t)=>({x:e,y:t}),P=(e,t,o)=>({position:A(e,t),type:o}),g=(e,t)=>({position:A(e,t),previousPosition:A(e,t),moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1}),B=(e,t)=>({position:A(e,t),previousPosition:A(e,t),moveTimestamp:Date.now(),isInvisible:!1,isVictorious:!1,isVanishing:!1,isClimbing:!1}),m=(e,t)=>({position:A(e,t),creationTime:Date.now(),isRaising:!1,isDestroying:!1}),L=()=>({player:B(0,0),goal:A(0,0),obstacles:[],monsters:[],steps:0,monsterSpawnSteps:0,bonuses:[],activeBonuses:[],explosions:[],timeBombs:[],landMines:[],crusherActive:!1,builderActive:!1,score:0,gameEndingState:"none"}),Vt=40,F=(e,t,o)=>({gridSize:e,cellSize:Vt,initialMonsterCount:0,obstacleCount:0,initialBonusCount:0,levelName:t,levelStory:o}),$t={1:jt,2:St,3:kt,4:At,5:Et,6:Dt,7:Ot,8:Bt,9:Lt,10:Ft,11:Rt,12:Gt,13:Nt},Xt=e=>{if(e<1||e>13)throw new Error(`Invalid level number: ${e}`);return $t[e]()};class qt{constructor(){ne(this,"audioContext");ne(this,"masterVolume",.025);this.audioContext=new(window.AudioContext||window.webkitAudioContext)}createOscillator(t,o,s){const n=this.audioContext.createOscillator();return n.type=o,n.frequency.setValueAtTime(t,this.audioContext.currentTime),n.start(),n.stop(this.audioContext.currentTime+s),n}createGain(t,o,s=1){const n=this.audioContext.createGain(),i=s*this.masterVolume;return n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+t),n.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+t+o),n}playStep(){const t=this.createOscillator(200,"square",.1),o=this.createGain(.01,.09);t.connect(o).connect(this.audioContext.destination)}playElectricalDischarge(){const t=this.createOscillator(800,"sawtooth",.2),o=this.createGain(.01,.19);t.frequency.linearRampToValueAtTime(200,this.audioContext.currentTime+.2),t.connect(o).connect(this.audioContext.destination)}playBonusCollected(){const t=this.createOscillator(600,"sine",.15),o=this.createGain(.01,.14);t.frequency.linearRampToValueAtTime(800,this.audioContext.currentTime+.15),t.connect(o).connect(this.audioContext.destination)}playExplosion(){const t=this.audioContext.createBufferSource(),o=this.audioContext.sampleRate*.5,s=this.audioContext.createBuffer(1,o,this.audioContext.sampleRate),n=s.getChannelData(0);for(let r=0;r<o;r++)n[r]=Math.random()*2-1;t.buffer=s;const i=this.createGain(.01,.49,.5);t.connect(i).connect(this.audioContext.destination),t.start()}playStateTransition(){const t=this.createOscillator(300,"triangle",.3),o=this.createGain(.05,.25);t.frequency.linearRampToValueAtTime(600,this.audioContext.currentTime+.3),t.connect(o).connect(this.audioContext.destination)}playGameOver(){const t=this.createOscillator(440,"sine",1),o=this.createGain(.01,.99);t.frequency.linearRampToValueAtTime(220,this.audioContext.currentTime+1),t.connect(o).connect(this.audioContext.destination)}playLevelComplete(){const t=this.createOscillator(440,"sine",.5),o=this.createOscillator(550,"sine",.5),s=this.createGain(.01,.49),n=this.createGain(.01,.49);t.connect(s).connect(this.audioContext.destination),o.connect(n).connect(this.audioContext.destination),setTimeout(()=>{const i=this.createOscillator(660,"sine",.5),r=this.createGain(.01,.49);i.connect(r).connect(this.audioContext.destination)},250)}playMonsterSpawn(){const t=this.createOscillator(100,"sawtooth",.3),o=this.createGain(.01,.29);t.frequency.exponentialRampToValueAtTime(300,this.audioContext.currentTime+.3),t.connect(o).connect(this.audioContext.destination)}playTeleport(){const t=this.createOscillator(100,"sine",.5),o=this.createOscillator(200,"sine",.5),s=this.createGain(.01,.49),n=this.createGain(.01,.49);t.frequency.exponentialRampToValueAtTime(1e3,this.audioContext.currentTime+.25),o.frequency.exponentialRampToValueAtTime(2e3,this.audioContext.currentTime+.25),t.connect(s).connect(this.audioContext.destination),o.connect(n).connect(this.audioContext.destination),setTimeout(()=>{const i=this.createOscillator(2e3,"sine",.2),r=this.createGain(.01,.19);i.frequency.exponentialRampToValueAtTime(4e3,this.audioContext.currentTime+.2),i.connect(r).connect(this.audioContext.destination)},100)}}const R=new qt,xt=(e,t,o)=>{if(K(t))return t;const s=ut(e.key);return s!==null?Ce(s,t,o):{...t}},Ce=(e,t,o)=>{if(K(t))return t;const s={...t},n=s.player.position,i=x(s.player.position,e);if(s.obstacles=t.obstacles.filter(r=>!r.isDestroying||Date.now()-r.creationTime<fe),t.crusherActive&&t.obstacles.find(r=>G(i,r.position))&&(s.obstacles=t.obstacles.map(r=>G(i,r.position)?{...r,isDestroying:!0,creationTime:Date.now()}:r),R.playElectricalDischarge()),ve(i,s,o)){if(R.playStep(),s.player.position=i,Date.now()-s.player.moveTimestamp>ae&&(s.player.previousPosition=n,s.player.moveTimestamp=Date.now()),s.steps++,s.monsterSpawnSteps++,G(i,s.goal))return s.gameEndingState="levelComplete",_t(s),s.score+=Yt(s),s;const r=s.bonuses.find(c=>G(c.position,i));if(r&&(R.playBonusCollected(),s.bonuses=s.bonuses.filter(c=>!G(c.position,i)),Wt(s,r.type)),(r==null?void 0:r.type)===d.Teleport&&Kt(s,r.position),s.monsterSpawnSteps>=13&&(Ht(s,o),s.monsterSpawnSteps=0,R.playMonsterSpawn()),s.monsters=ft(s.monsters,s.player.position,o.gridSize,s.obstacles,s.activeBonuses.some(c=>c.type===d.CapOfInvisibility),s.activeBonuses.some(c=>c.type===d.ConfusedMonsters)),Ct(s.player.position,s.monsters))return s.gameEndingState="gameOver",pe(s),s;const[a,l]=Mt(s.monsters,s.landMines);s.monsters=a,s.explosions=l,s.timeBombs=s.timeBombs.map(c=>({...c,timer:c.timer-1}));const h=s.timeBombs.filter(c=>c.timer===0);if((h.length>0||l.length>0)&&R.playExplosion(),s.explosions=[...s.explosions,...h.map(c=>({position:c.position,startTime:Date.now(),duration:1e3}))],s.timeBombs=s.timeBombs.filter(c=>c.timer>0),s.monsters=s.monsters.filter(c=>!s.explosions.some(p=>It(c,p))),s.obstacles=s.obstacles.map(c=>ie(c.position,s.explosions)?{...c,isDestroying:!0,creationTime:Date.now()}:c),s.bonuses=s.bonuses.filter(c=>!ie(c.position,s.explosions)),ie(s.player.position,s.explosions))return s.gameEndingState="gameOver",pe(s),s;if(s.activeBonuses=s.activeBonuses.map(c=>({...c,duration:c.duration-1})).filter(c=>c.duration>0),s.builderActive=s.activeBonuses.some(c=>c.type===d.Builder),s.crusherActive=s.activeBonuses.some(c=>c.type===d.Crusher),s.player.isClimbing=s.activeBonuses.some(c=>c.type===d.Climber),t.builderActive){const c={position:n,creationTime:Date.now(),isRaising:!0,isDestroying:!1};oe(c.position,s.obstacles.map(({position:p})=>p))||(s.obstacles.push(c),R.playElectricalDischarge())}}return s},Wt=(e,t)=>{const o={type:t,duration:13};switch(e.activeBonuses.push(o),t){case d.CapOfInvisibility:break;case d.ConfusedMonsters:break;case d.LandMine:e.landMines.push({...e.player.position});break;case d.TimeBomb:e.timeBombs.push({position:e.player.position,timer:13,shakeIntensity:0});break;case d.Crusher:e.crusherActive=!0;break;case d.Builder:e.builderActive=!0;break;case d.Climber:e.player.isClimbing=!0;break;case d.Teleport:break}},Yt=e=>100-e.steps+e.monsters.length*10,Ht=(e,{gridSize:t})=>{let o;do o=Ut(t,t);while(G(o,e.player.position)||G(o,e.goal)||oe(o,e.obstacles.filter(s=>!s.isDestroying).map(({position:s})=>s))||oe(o,e.monsters.map(s=>s.position)));e.monsters.push({position:o,previousPosition:o,moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1})},Ut=(e,t)=>({x:Math.floor(Math.random()*e),y:Math.floor(Math.random()*t)}),K=e=>e.gameEndingState!=="none",pe=e=>{e.player.isVanishing=!0,R.playGameOver()},_t=e=>{e.player.isVictorious=!0,R.playLevelComplete()},Kt=(e,t)=>{const o=e.bonuses.find(s=>s.type===d.Teleport&&!G(s.position,t));o&&(e.player.previousPosition=e.player.position,e.player.position=o.position,e.player.teleportTimestamp=Date.now(),R.playTeleport())},Qt=({level:e,score:t,steps:o})=>u.jsxs("div",{className:"hud",children:[u.jsxs("div",{children:["Level: ",e]}),u.jsxs("div",{children:["Score: ",t]}),u.jsxs("div",{children:["Steps: ",o]})]}),Zt=13,Jt=2e3,zt=({level:e,score:t,onGameOver:o,onLevelComplete:s,onGameComplete:n,updateScore:i,updateSteps:r})=>{const a=D.useRef(null),[[l,h,c],p]=D.useState(()=>Xt(e)),[y,b]=D.useState(!0),v=f=>{p([f,h,c]),i(f.score),r(f.steps)};return D.useEffect(()=>{l.gameEndingState!=="none"&&setTimeout(()=>{l.gameEndingState==="levelComplete"&&(e===Zt?n():s()),l.gameEndingState==="gameOver"&&o()},Jt)},[l.gameEndingState]),D.useEffect(()=>{if(!l||!h)return;const f=a.current;let w;if(f){const k=(h.gridSize+h.gridSize)*h.cellSize,I=(h.gridSize+h.gridSize)*h.cellSize/2;f.width=k,f.height=I+100;const S=f.getContext("2d");if(S){const E=()=>{ge(S,l,h),K(l)||mt(S,we(l,h),h.gridSize,h.cellSize),w=requestAnimationFrame(E)};E()}}return()=>{w!==null&&cancelAnimationFrame(w)}},[l,h,y]),D.useEffect(()=>{if(!l||!h)return;const f=k=>{if(y){b(!1);return}if(!K(l)){const I=xt(k,l,h);v(I)}},w=k=>{if(y){b(!1);return}if(K(l))return;const I=a.current;if(!I)return;const S=I.getBoundingClientRect(),E=pt((k.clientX-S.left)*(I.width/S.width)-I.width/2,(k.clientY-S.top)*(I.height/S.height)-100,l,h);E&&v(Ce(E.direction,l,h))};return window.addEventListener("click",w),window.addEventListener("keydown",f),()=>{window.removeEventListener("click",w),window.removeEventListener("keydown",f)}},[l,h,y,o,s,i,r]),y?u.jsxs("div",{className:"level-story",children:[u.jsxs("h2",{children:["Level ",e]}),u.jsx("p",{children:c}),u.jsx("p",{children:"Press any key to start..."})]}):u.jsxs("div",{className:"gameplay",children:[u.jsx(Qt,{level:e,score:t,steps:(l==null?void 0:l.monsterSpawnSteps)||0}),u.jsx("div",{className:"canvas-container",children:u.jsx("canvas",{ref:a})})]})},eo=({score:e,steps:t,onTryAgain:o,onQuit:s})=>u.jsxs("div",{className:"game-over",children:[u.jsx("h1",{children:"Game Over"}),u.jsxs("p",{children:["Your score: ",e]}),u.jsxs("p",{children:["Steps taken: ",t]}),u.jsx("button",{onClick:o,children:"Try Again"}),u.jsx("button",{onClick:s,children:"Quit"})]}),to=({level:e,onNextLevel:t,onQuit:o})=>u.jsxs("div",{className:"level-complete",children:[u.jsxs("h1",{children:["Level ",e," Complete!"]}),u.jsx("p",{children:"Congratulations! You've completed the level."}),u.jsx("button",{onClick:t,children:"Next Level"}),u.jsx("button",{onClick:o,children:"Quit"})]});function io(){const[e,t]=D.useState(0),[o,s]=D.useState(parseInt(document.location.hash.split("level")[1]??"1")),[n,i]=D.useState(0),[r,a]=D.useState(0),l=D.useCallback(()=>{t(2)},[]),h=()=>{t(1)},c=()=>{s(1),i(0),a(0),t(2)},p=()=>{t(2)},y=()=>{t(0)},b=()=>{t(3)},v=()=>{s(o+1),t(4)},f=D.useCallback(()=>{t(2)},[]),w=()=>{R.playLevelComplete(),t(5)},k=S=>i(S),I=S=>a(S);return D.useEffect(()=>{const S=E=>{E.key==="ArrowRight"?e===0?l():e===4?f():e===3?p():e===5&&c():E.key==="Escape"&&(e===1||e===3||e===5)&&y()};return window.addEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}},[e,l,f]),u.jsxs("div",{className:"game-container",children:[e===0&&u.jsx(ct,{onStart:l,onInstructions:h}),e===1&&u.jsx(ht,{onBack:y}),e===2&&u.jsx(zt,{level:o,score:n,onGameOver:b,onLevelComplete:v,onGameComplete:w,updateScore:k,updateSteps:I}),e===3&&u.jsx(eo,{score:n,steps:r,onTryAgain:p,onQuit:y}),e===4&&u.jsx(to,{level:o,onNextLevel:f,onQuit:y}),e===5&&u.jsx(oo,{score:n,steps:r,onPlayAgain:c,onQuit:y})]})}function oo({score:e,steps:t,onPlayAgain:o,onQuit:s}){return u.jsxs("div",{className:"game-complete intro",children:[u.jsx("h1",{className:"game-title",children:"Monster Steps"}),u.jsx("h2",{className:"game-complete-subtitle",children:"Congratulations!"}),u.jsxs("div",{className:"game-complete-stats",children:[u.jsxs("p",{children:["Final Score: ",e]}),u.jsxs("p",{children:["Total Steps: ",t]})]}),u.jsxs("div",{className:"intro-buttons",children:[u.jsx("button",{onClick:o,children:"Play Again"}),u.jsx("button",{onClick:s,children:"Quit"})]}),u.jsx("p",{className:"intro-tip",children:"Press right arrow to play again"})]})}export{io as MonsterStepsApp};
