var Fe=Object.defineProperty;var Ge=(e,t,o)=>t in e?Fe(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var le=(e,t,o)=>Ge(e,typeof t!="symbol"?t+"":t,o);import{r as B,j as h}from"./index-zlHzHA06.js";var p=(e=>(e[e.CapOfInvisibility=0]="CapOfInvisibility",e[e.ConfusedMonsters=1]="ConfusedMonsters",e[e.LandMine=2]="LandMine",e[e.TimeBomb=3]="TimeBomb",e[e.Crusher=4]="Crusher",e[e.Builder=5]="Builder",e[e.Climber=6]="Climber",e[e.Teleport=7]="Teleport",e[e.Tsunami=8]="Tsunami",e[e.Monster=9]="Monster",e[e.Slide=10]="Slide",e[e.Sokoban=11]="Sokoban",e[e.Blaster=12]="Blaster",e))(p||{}),w=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right",e))(w||{});function ye(e){switch(e){case 0:return"Now you see me, now you don't!";case 1:return"Monsters are dizzy!";case 2:return"Boom goes the floor!";case 3:return"Tick tock, boom o'clock!";case 4:return"Hulk smash!";case 5:return"Bob the Builder mode: ON";case 6:return"Walk on walls like a pro!";case 7:return"Beam me up, Scotty!";case 8:return"Water, water everywhere!";case 9:return"Tables have turned!";case 10:return"Slip and slide!";case 11:return"Push it real good!";case 12:return"Pew pew pew!";default:return"Mystery power activated!"}}function S(e,t){return e.activeBonuses.some(o=>o.type===t)}const M=60,g=30;function C(e,t){return{x:(e-t)*M/2,y:(e+t)*g/2}}function be(e){switch(e){case"wave":case"obstacle":return 3;case"bonus":case"landMine":case"timeBomb":return 2;case"goal":return 2;case"monster":return 4;case"player":return 5;case"explosion":return 6;default:return 0}}function Ne(e){return e.sort((t,o)=>{const s=t.position.x+t.position.y,n=o.position.x+o.position.y;if(s!==n)return s-n;const i=be(t.type),r=be(o.type);return i!==r?i-r:0})}const Te=250,q=500,xe=50,Ve=()=>Math.cos(Date.now()/1e3*Math.PI),Ue=e=>.5+(e/2+1)/2,ae=(e,t,o,s=Te)=>{const n=Math.min(Date.now()-o,s)/s;return{x:t.x+(e.x-t.x)*n,y:t.y+(e.y-t.y)*n}},We=(e,t,o)=>Date.now()-o<q/2?t:e,_e=e=>{const t=Date.now()/1e3;return Math.sin(t*2+e)*3},ve=e=>{const t=Date.now()/50;return{x:Math.sin(t)*e,y:Math.cos(t*1.5)*e}},Me=500,Ye=(e,t,o)=>{const s=Math.min((Date.now()-e)/Me,1);return o?1-s:t?s:1},$e=()=>ve(2),Xe=e=>{const o=e%1e3/1e3;return Math.sin(o*Math.PI)*20},He=e=>Math.max(0,1-e/2e3),qe=e=>e<q/2?Math.max(0,1-e/2/(q/2)*2):Math.min(1,(e/2/(q/2)-.5)*2),Ke=(e,t,o)=>{const{x:s,y:n}=C(t.x,t.y);e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.ellipse(s,n+g/2,M/2,g/4,0,0,Math.PI*2),e.fill(),e.fillStyle="#FFD700",e.beginPath(),e.moveTo(s,n),e.lineTo(s+M/2,n+g/2),e.lineTo(s,n+g),e.lineTo(s-M/2,n+g/2),e.closePath(),e.fill(),e.fillStyle="#000000",e.font=`${o/2}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("★",s,n+g/2)},Qe=(e,t,o)=>{t.forEach(s=>{const{position:n,creationTime:i,isRaising:r,isDestroying:l}=s,{x:a,y:u}=C(n.x,n.y),c=Ye(i,r,l)*o*.8;if(c===0)return;const d=c/o*.2,{x:f,y:b}=C(n.x,n.y+1),{x:T,y}=C(n.x+1,n.y+1),{x:v,y:k}=C(n.x+1,n.y+1+d),{x:I,y:j}=C(n.x,n.y+1+d);e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(f,b),e.lineTo(T,y),e.lineTo(v,k),e.lineTo(I,j),e.closePath(),e.fill();const A=l?c/(o*.8):1;e.fillStyle=`rgba(142, 36, 170, ${A})`,e.beginPath(),e.moveTo(a,u-c),e.lineTo(a+M/2,u+g/2-c),e.lineTo(a,u+g-c),e.lineTo(a-M/2,u+g/2-c),e.closePath(),e.fill(),e.fillStyle=`rgba(106, 27, 154, ${A})`,e.beginPath(),e.moveTo(a+M/2,u+g/2-c),e.lineTo(a+M/2,u+g/2),e.lineTo(a,u+g),e.lineTo(a,u+g-c),e.closePath(),e.fill(),e.fillStyle=`rgba(74, 20, 140, ${A})`,e.beginPath(),e.moveTo(a-M/2,u+g/2-c),e.lineTo(a-M/2,u+g/2),e.lineTo(a,u+g),e.lineTo(a,u+g-c),e.closePath(),e.fill()})},Ze=(e,t)=>{const o=C(0,0),s=C(t,0),n=C(0,t),i=C(t,t);e.fillStyle="#c2b280",e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(s.x,s.y),e.lineTo(i.x,i.y),e.lineTo(n.x,n.y),e.closePath(),e.fill(),e.fillStyle="#5d4037",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x,i.y+te),e.lineTo(n.x,n.y+te),e.lineTo(n.x,n.y),e.closePath(),e.fill(),e.fillStyle="#8d6e63",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x,i.y+te),e.lineTo(s.x,s.y+te),e.lineTo(s.x,s.y),e.closePath(),e.fill()},Ce=(e,t,o)=>{e.strokeStyle="#4a4a4a",e.lineWidth=1;for(let s=0;s<=t;s++)for(let n=0;n<=t;n++){const{x:i,y:r}=C(n,s);n<t&&(e.beginPath(),e.moveTo(i,r),e.lineTo(i+M/2,r+g/2),e.stroke()),s<t&&(e.beginPath(),e.moveTo(i,r),e.lineTo(i-M/2,r+g/2),e.stroke()),S(o,p.Slide)&&Je(e,n,s)}},Je=(e,t,o)=>{const{x:s,y:n}=C(t,o),i=e.createLinearGradient(s-M/2,n,s+M/2,n+g);i.addColorStop(0,"rgba(200, 200, 255, 0.2)"),i.addColorStop(.5,"rgba(220, 220, 255, 0.3)"),i.addColorStop(1,"rgba(200, 200, 255, 0.2)"),e.fillStyle=i,e.beginPath(),e.moveTo(s,n),e.lineTo(s+M/2,n+g/2),e.lineTo(s,n+g),e.lineTo(s-M/2,n+g/2),e.closePath(),e.fill();for(let r=0;r<3;r++){const l=s+(Math.random()-.5)*M,a=n+(Math.random()-.5)*g,u=Math.random()*2+1;e.fillStyle="rgba(255, 255, 255, 0.7)",e.beginPath(),e.arc(l,a,u,0,Math.PI*2),e.fill()}},pe=(e,t,o,s,n)=>{e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.ellipse(t+s/2,o+n/2+5,s/2,n/4,0,0,Math.PI*2),e.fill()},ze=e=>{const{isoX:t,isoY:o,cellSize:s,baseHeight:n,widthFactor:i,heightAnimationFactor:r}=e,l=Ve(),a=n*s+s*r*l,u=M*i,c=Ue(l),d=M*i*c,f=g*.4*c;return{entityHeight:a,entityWidth:u,shadowWidth:d,shadowHeight:f,animFactor:l,shadowX:t-d/2,shadowY:o+g/2}},et=(e,t,o,s,n,i,r)=>{e.fillStyle=i,e.beginPath(),e.moveTo(t,o-s-r),e.lineTo(t+n/2,o-s+g/4-r),e.lineTo(t,o+g/2-r),e.lineTo(t-n/2,o-s+g/4-r),e.closePath(),e.fill()},tt=(e,t,o,s,n,i,r)=>{e.fillStyle=i,e.beginPath(),e.arc(t,o-s-n/2-r,n,0,Math.PI*2),e.fill()},ot=(e,t,o,s,n,i,r,l)=>{const a=n*.3;e.fillStyle=i,e.beginPath(),e.arc(t-n/3,o-s-n/2-l,a,0,Math.PI*2),e.arc(t+n/3,o-s-n/2-l,a,0,Math.PI*2),e.fill(),e.fillStyle=r,e.beginPath(),e.arc(t-n/3,o-s-n/2-l,a/2,0,Math.PI*2),e.arc(t+n/3,o-s-n/2-l,a/2,0,Math.PI*2),e.fill()},st=(e,t,o,s,n,i)=>{e.strokeStyle="black",e.lineWidth=2,e.beginPath(),e.arc(t,o-s+n/4-i,n/2,.1*Math.PI,.9*Math.PI),e.stroke()},nt=(e,t,o,s,n,i,r,l,a,u,c,d,f,b)=>{e.strokeStyle=u,e.lineWidth=a;const T=Math.sin(d*1e3)*Math.PI;for(let y=0;y<r;y++){const v=y/r*Math.PI*2,k=t+Math.cos(v)*(n/3),I=o-s/2+Math.sin(v)*(s/4)-b,j=2+Math.sin(d*100+y)*2,A=.1+Math.cos(d*200+y)*.05,W=k+Math.cos(v)*(l/2),_=I+Math.sin(v)*(l/2)+Math.sin(c*j+T+y)*i*A,K=k+Math.cos(v)*l,Q=I+Math.sin(v)*l+Math.sin(c*j+Math.PI+T+y)*i*(A*1.5),z=k+Math.cos(v)*l,ee=I+Math.sin(v)*l+Math.sin(c*j+T+y)*i*(A*2);f&&(e.save(),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.lineWidth=a*1.5,e.beginPath(),e.moveTo(k,I+g/2),e.bezierCurveTo(W,_+g/2,K,Q+g/2,z,ee+g/2),e.stroke(),e.restore()),e.beginPath(),e.moveTo(k,I),e.bezierCurveTo(W,_,K,Q,z,ee),e.stroke()}},Pe=e=>{const{ctx:t,isoX:o,isoY:s,cellSize:n,baseHeight:i,widthFactor:r,heightAnimationFactor:l,bodyColor:a,headColor:u,eyeColor:c,pupilColor:d,hasTentacles:f=!1,tentacleColor:b="",tentacleCount:T=0,tentacleLength:y=0,tentacleWidth:v=0,isInvisible:k=!1,seed:I=0,castShadow:j=!0,isConfused:A=!1}=e,W=ze({isoX:o,isoY:s,cellSize:n,baseHeight:i,widthFactor:r,heightAnimationFactor:l}),{entityHeight:_,entityWidth:K,shadowWidth:Q,shadowHeight:z,animFactor:ee,shadowX:Oe,shadowY:Re}=W,Y=_e(I),fe=A?$e():{x:0,y:0};let $=o,X=s;$+=fe.x,X+=fe.y,j&&(t.fillStyle="rgba(0, 0, 0, 0.3)",t.beginPath(),t.ellipse(Oe+Q/2,Re,Q/2,z/2,0,0,Math.PI*2),t.fill()),t.save(),k&&(t.globalAlpha=.5),f&&b&&T>0&&nt(t,$,X,_,K,n,T,y,v,b,ee,I,j,Y),et(t,$,X,_,K,a,Y);const re=n*.25;return tt(t,$,X,_,re,u,Y),ot(t,$,X,_,re,c,d,Y),st(t,$,X,_,re,Y),t.restore(),{bounceOffset:Y}},it=(e,t,o,s=!1,n=[],i=!1,r=!1,l=!1)=>{const{position:a,previousPosition:u,moveTimestamp:c,teleportTimestamp:d,isVanishing:f,isVictorious:b}=t,T=d&&Date.now()-d<q,y=T?We(a,u,d):ae(a,u,c);let{x:v,y:k}=C(y.x,y.y);if(b){const W=Xe(Date.now()-c);k-=W}const I=n.some(W=>W.position.x===Math.round(y.x)&&W.position.y===Math.round(y.y));(l||I)&&I&&(k-=o*.5);const j={ctx:e,isoX:v,isoY:k,cellSize:o,baseHeight:.8,widthFactor:.6,heightAnimationFactor:.2,bodyColor:at(l,i),headColor:rt(l,i),eyeColor:i?"red":"white",pupilColor:"black",isInvisible:s};f?e.globalAlpha=He(Date.now()-c):T&&(e.globalAlpha=qe(Date.now()-d));const{bounceOffset:A}=Pe(j);e.globalAlpha=1,b&&lt(e,v,k,o),l&&ct(e,v,k,o),i&&ht(e,v,k,o),r&&ut(e,v,k,o,A),T&&pt(e,v,k,o,Date.now()-d)},at=(e,t)=>t?"#800080":e?"#FFA500":"#00FF00",rt=(e,t)=>t?"#9932CC":e?"#FFD700":"#32CD32",lt=(e,t,o,s)=>{e.save(),e.translate(t,o);for(let n=0;n<10;n++){const i=Math.PI*2*n/10,r=s*(.5+Math.sin(Date.now()/200+n)*.2),l=Math.cos(i)*r,a=Math.sin(i)*r;e.beginPath(),e.arc(l,a,s*.1,0,Math.PI*2),e.fillStyle=`hsl(${(Date.now()/20+n*36)%360}, 100%, 50%)`,e.fill()}e.restore()},ct=(e,t,o,s)=>{e.save(),e.translate(t,o-s*.6);const n=s*.3;e.strokeStyle="#FFD700",e.lineWidth=2,e.beginPath(),e.moveTo(-n/2,-n/2),e.lineTo(-n/2,n/2),e.moveTo(n/2,-n/2),e.lineTo(n/2,n/2);for(let r=0;r<3;r++){const l=-n/2+(r+1)*(n/3);e.moveTo(-n/2,l),e.lineTo(n/2,l)}e.stroke(),e.shadowColor="#FFD700",e.shadowBlur=5,e.stroke();const i=Math.sin(Date.now()/200)*s*.05;e.translate(0,i),e.stroke(),e.restore()},ht=(e,t,o,s)=>{e.save(),e.translate(t,o);const n=20,i=s*.8;for(let a=0;a<n;a++){const u=Math.PI*2*a/n+Date.now()/1e3,c=i*(.5+Math.sin(Date.now()/500+a)*.2),d=Math.cos(u)*c,f=Math.sin(u)*c;e.beginPath(),e.arc(d,f,s*.05,0,Math.PI*2),e.fillStyle=`rgba(128, 0, 128, ${.5+Math.sin(Date.now()/200+a)*.3})`,e.fill()}const r=s*.1,l=s*.15;e.beginPath(),e.arc(-l,-l,r,0,Math.PI*2),e.arc(l,-l,r,0,Math.PI*2),e.fillStyle="rgba(255, 0, 0, 0.8)",e.fill(),e.shadowColor="red",e.shadowBlur=10+Math.sin(Date.now()/200)*5,e.fill(),e.restore()},ut=(e,t,o,s,n)=>{e.save(),e.translate(t-s/10,o-n);const i=s*.4,r=s*.1;e.fillStyle="#808080",e.beginPath(),e.rect(-r/2,-i,r,i),e.fill(),e.fillStyle="#FFD700",e.beginPath(),e.arc(0,-i,r/2,0,Math.PI*2),e.fill(),e.shadowColor="#FFD700",e.shadowBlur=5,e.fill();const l=(Math.sin(Date.now()/200)+1)*r/4;e.beginPath(),e.arc(0,-i,l,0,Math.PI*2),e.fillStyle="rgba(255, 255, 0, 0.8)",e.fill(),e.restore()},pt=(e,t,o,s,n)=>{e.save(),e.translate(t,o);const i=s*1.5,r=n/q;if(r<.5){const l=r*2,a=i*l;e.beginPath(),e.arc(0,0,a,0,Math.PI*2);const u=e.createRadialGradient(0,0,0,0,0,a);u.addColorStop(0,"rgba(0, 255, 255, 0)"),u.addColorStop(.7,"rgba(0, 255, 255, 0.7)"),u.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=u,e.fill();for(let c=0;c<20;c++){const d=Math.random()*Math.PI*2,f=Math.random()*a,b=Math.cos(d)*f,T=Math.sin(d)*f,y=s*.05*(1-l);e.beginPath(),e.arc(b,T,y,0,Math.PI*2),e.fillStyle="rgba(0, 255, 255, "+(1-l)+")",e.fill()}}else{const l=(r-.5)*2,a=i*(1-l);e.beginPath(),e.arc(0,0,a,0,Math.PI*2);const u=e.createRadialGradient(0,0,0,0,0,a);u.addColorStop(0,"rgba(0, 255, 255, 0.7)"),u.addColorStop(.7,"rgba(0, 255, 255, 0.3)"),u.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=u,e.fill();for(let c=0;c<20;c++){const d=Math.random()*Math.PI*2,f=Math.random()*i,b=Math.cos(d)*f,T=Math.sin(d)*f,y=s*.05*l;e.beginPath(),e.arc(b,T,y,0,Math.PI*2),e.fillStyle="rgba(0, 255, 255, "+l+")",e.fill()}}e.restore()},dt=(e,t,o,s)=>{t.forEach(n=>{const i=ae(n.position,n.previousPosition,n.moveTimestamp),{x:r,y:l}=C(i.x,i.y),a={ctx:e,isoX:r,isoY:l,cellSize:o,baseHeight:.4,widthFactor:.6,heightAnimationFactor:.1,bodyColor:s?"#00FF00":"#800080",headColor:s?"#32CD32":"#9932CC",eyeColor:"white",pupilColor:s?"black":"red",hasTentacles:!s,tentacleColor:"#600060",tentacleCount:6,tentacleLength:o*.5,tentacleWidth:4,seed:n.seed,castShadow:!0};Pe(a),s&&mt(e,r,l,o)})},mt=(e,t,o,s)=>{e.save(),e.translate(t,o);const n=s*.2;e.fillStyle="#FFD700",e.beginPath(),e.moveTo(-n/2,-s*.3),e.lineTo(0,-s*.5),e.lineTo(n/2,-s*.3),e.closePath(),e.fill();for(let i=0;i<5;i++){const r=Math.random()*Math.PI*2,l=Math.random()*s*.4+s*.2,a=Math.cos(r)*l,u=Math.sin(r)*l;e.fillStyle=`rgba(255, 255, 0, ${.5+Math.random()*.5})`,e.beginPath(),e.arc(a,u,s*.05,0,Math.PI*2),e.fill()}e.restore()},R=g,ft=(e,t,o)=>{t.forEach(s=>{const{x:n,y:i}=C(s.position.x,s.position.y);pe(e,n-M/4,i-g/4,M/2,g),e.fillStyle=wt(s.type),e.beginPath(),e.moveTo(n,i+R/2),e.lineTo(n+M/4,i),e.lineTo(n,i-R/2),e.lineTo(n-M/4,i),e.closePath(),e.fill(),e.beginPath(),e.arc(n,i-R/2,M/6,0,Math.PI*2),e.fill(),e.fillStyle="white",e.font=`bold ${o/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(gt(s.type),n,i-R/2)})},yt=(e,t,o)=>{t.forEach(s=>{const{x:n,y:i}=C(s.x,s.y);pe(e,n-M/2,i,M,g),e.fillStyle="brown",e.beginPath(),e.moveTo(n,i+R/2),e.lineTo(n+M/4,i),e.lineTo(n,i-R/2),e.lineTo(n-M/4,i),e.closePath(),e.fill(),e.beginPath(),e.arc(n,i-R/2,M/5,0,Math.PI*2),e.fill(),e.fillStyle="white",e.font=`bold ${o/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("M",n,i-R/2)})},bt=(e,t,o)=>{t.forEach(s=>{const{x:n,y:i}=C(s.position.x,s.position.y);pe(e,n-M/2,i,M,g),e.fillStyle="black",e.beginPath(),e.moveTo(n,i-R),e.lineTo(n+M/4,i-R/2),e.lineTo(n,i+R/2),e.lineTo(n-M/4,i-R/2),e.closePath(),e.fill(),e.strokeStyle="orange",e.lineWidth=2,e.beginPath(),e.moveTo(n,i-R),e.quadraticCurveTo(n+M/8,i-R*1.5,n+M/4,i-R*1.25),e.stroke(),e.fillStyle="white",e.font=`bold ${o/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(s.timer.toString(),n,i-R/2)})},wt=e=>{switch(e){case p.CapOfInvisibility:return"#8A2BE2";case p.ConfusedMonsters:return"#FFA500";case p.LandMine:return"#8B4513";case p.TimeBomb:return"#000000";case p.Crusher:return"#FF69B4";case p.Builder:return"#00FFFF";case p.Climber:return"#32CD32";case p.Teleport:return"#9400D3";case p.Tsunami:return"#1E90FF";case p.Monster:return"#FF4500";case p.Slide:return"#00CED1";case p.Sokoban:return"#DAA520";case p.Blaster:return"#FF1493";default:return"#FFFF00"}},gt=e=>{switch(e){case p.CapOfInvisibility:return"I";case p.ConfusedMonsters:return"C";case p.LandMine:return"L";case p.TimeBomb:return"T";case p.Crusher:return"X";case p.Builder:return"B";case p.Climber:return"↑";case p.Teleport:return"⊷";case p.Tsunami:return"≋";case p.Monster:return"M";case p.Slide:return"⇉";case p.Sokoban:return"◊";case p.Blaster:return"⚡";default:return"?"}},Tt=(e,t)=>{e.save(),e.globalAlpha=.7;for(const{position:o,startTime:s,duration:n}of t){if(Date.now()-s>n)continue;const i=C(o.x+.5,o.y+.5),r=C(o.x-1,o.y-1),l=C(o.x+1*2,o.y-1),a=C(o.x+1*2,o.y+1*2),u=C(o.x-1,o.y+1*2);e.fillStyle="#FF6600",e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(l.x,l.y),e.lineTo(a.x,a.y),e.lineTo(u.x,u.y),e.closePath(),e.fill();const c=32,d=M;for(let b=0;b<c;b++){const T=Math.PI*2/c*b,y=d*Math.random(),v=i.x+Math.cos(T)*y,k=i.y+Math.sin(T)*y/2;e.fillStyle=b%2===0?"#FF9933":"#FF3300",e.beginPath(),e.arc(v,k-Math.random()*g*Math.pow(b/c,.5),M/16,0,Math.PI*2),e.fill()}const f=e.createRadialGradient(i.x,i.y,0,i.x,i.y,M*2);f.addColorStop(0,"rgba(255, 255, 0, 0.8)"),f.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=f,e.beginPath(),e.ellipse(i.x,i.y,M,g,0,0,Math.PI*2),e.fill()}e.restore()},vt=(e,t,o,s)=>{e.save(),e.globalAlpha=o.duration===12?1:.5,e.font="bold 16px Arial";const{x:n,y:i}=C(t.x,t.y),r=e.measureText(ye(o.type)).width+20,l=90,a=15,u=10,c=n-r/2,d=i-s-l-a;e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.moveTo(c+u,d),e.lineTo(c+r-u,d),e.quadraticCurveTo(c+r,d,c+r,d+u),e.lineTo(c+r,d+l-u),e.quadraticCurveTo(c+r,d+l,c+r-u,d+l),e.lineTo(c+r/2+a,d+l),e.lineTo(c+r/2,d+l+a),e.lineTo(c+r/2-a,d+l),e.lineTo(c+u,d+l),e.quadraticCurveTo(c,d+l,c,d+l-u),e.lineTo(c,d+u),e.quadraticCurveTo(c,d,c+u,d),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=2,e.stroke(),e.fillStyle="white",e.textAlign="center",e.fillText(ye(o.type),c+r/2,d+30),e.font="14px Arial",e.fillText(`${o.duration} steps left`,c+r/2,d+55),e.restore()},ke=1e3,Mt=(e,t,o)=>{let{tsunamiLevel:s}=e;e.tsunamiTeardownTimestamp&&(s=e.player.isVanishing?13:(1-(Date.now()-e.tsunamiTeardownTimestamp)/ke)*13);const n=o*.8,i=[];for(let r=0;r<t;r++)for(let l=0;l<t;l++){const a=C(l,r),u=C(l+1,r),c=C(l,r+1),d=C(l+1,r+1),f=Math.min(Math.max(s/13,0),1)*n,b=f+Math.sin(Date.now()/200+l*.5)*5,T=f+Math.sin(Date.now()/200+(l+1)*.5)*5;i.push({tsunamiLevel:s,grid:{x:l,y:r},isoTop:[{x:a.x,y:a.y-b},{x:c.x,y:c.y-T},{x:d.x,y:d.y-T},{x:u.x,y:u.y-b}],isoFront:r===t-1?[{x:c.x,y:c.y-T},{x:c.x,y:c.y},{x:d.x,y:d.y},{x:d.x,y:d.y-T}]:void 0,isoSide:l===t-1?[{x:d.x,y:d.y-T},{x:d.x,y:d.y},{x:u.x,y:u.y},{x:u.x,y:u.y-b}]:void 0})}return i},Ct=(e,t)=>{e.save(),e.globalAlpha=.6,ce(e,t.isoTop,`rgba(0, 100, 255, ${t.tsunamiLevel/13})`),t.isoFront&&ce(e,t.isoFront,`rgba(0, 39, 98, ${t.tsunamiLevel/13})`),t.isoSide&&ce(e,t.isoSide,`rgba(0, 63, 157, ${t.tsunamiLevel/13})`),e.restore()};function ce(e,t,o){e.fillStyle=o,e.beginPath(),e.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s++)e.lineTo(t[s].x,t[s].y);e.closePath(),e.fill()}const Pt=(e,t,o)=>{const{x:s,y:n}=C(t.x,t.y),{x:i,y:r}=C(o.x,o.y);e.save(),e.strokeStyle="rgba(0, 255, 255, 0.5)",e.lineWidth=3,e.setLineDash([5,5]),e.beginPath(),e.moveTo(s,n),e.lineTo(i,r),e.stroke(),e.restore()},kt=(e,t,o)=>{if(Date.now()-t.shotTimestamp>t.duration)return;const s=ae(t.endPosition,t.startPosition,t.shotTimestamp,t.duration),{x:n,y:i}=C(s.x,s.y);e.save(),e.shadowColor="rgba(255, 0, 0, 0.8)",e.shadowBlur=o*.2,e.fillStyle="red",e.strokeStyle="rgba(255, 100, 100, 0.8)",e.lineWidth=2;const r=o*.6,l=o*.1;switch(e.translate(n,i),t.direction){case w.Up:e.rotate(-Math.PI/4);break;case w.Down:e.rotate(3*Math.PI/4);break;case w.Left:e.rotate(-3*Math.PI/4);break;case w.Right:e.rotate(Math.PI/4);break}e.beginPath(),e.ellipse(0,0,r/2,l/2,0,0,2*Math.PI),e.fill(),e.stroke(),e.globalAlpha=.5;for(let a=1;a<=3;a++)e.globalAlpha*=.5,e.beginPath(),e.ellipse(-a*r*.2,0,r/(2+a),l/(2+a),0,0,2*Math.PI),e.fill();e.restore()},we=1e3,jt=13,It=3;function Dt(e,t,{gridSize:o}){const{player:s,obstacles:n}=t,r=Date.now()-s.moveTimestamp;if(r>we)return;const l=Et(s.position,n,jt);e.save(),e.strokeStyle="purple",e.lineWidth=2,l.forEach(a=>{const u=Math.min(r/we,1),c=a.path.length,d=Math.floor(c*u);e.beginPath();for(let f=Math.max(d-It,0);f<d;f++){const b=a.path[f];if(b.x<0||b.y<0||b.x>=o||b.y>=o)continue;const{x:T,y}=C(b.x+.5,b.y+.5);f===0?e.moveTo(T,y):e.lineTo(T,y);const v=1-f/d;e.globalAlpha=v}e.stroke()}),e.restore()}function Et(e,t,o){const s=[],n=new Set,i=[{x:1,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:-1}],r=[{position:e,path:[e]}];for(n.add(`${e.x},${e.y}`);r.length>0;){const{position:l,path:a}=r.shift();if(a.length>o||At(l,t))s.push({path:a,startTime:Date.now()});else for(const u of i){const c={x:l.x+u.x,y:l.y+u.y},d=`${c.x},${c.y}`;if(!n.has(d)){n.add(d);const f=[...a,c];r.push({position:c,path:f}),f.length===o&&s.push({path:f,startTime:Date.now()})}}}return s}function At(e,t){return t.some(o=>o.position.x===e.x&&o.position.y===e.y)}const te=20,je=(e,t,{gridSize:o,cellSize:s})=>{if(e.save(),t.explosions.length>0){const a=Math.min(t.explosions.filter(c=>Date.now()-c.startTime<c.duration).length*2,10),u=ve(a);e.translate(u.x,u.y)}e.translate(e.canvas.width/2,100),e.clearRect(-e.canvas.width/2,-100,e.canvas.width,e.canvas.height),Ze(e,o),Ce(e,o,t);const n=t.tsunamiLevel>0||t.tsunamiTeardownTimestamp?Mt(t,o,s):[];Date.now()-t.tsunamiTeardownTimestamp>ke&&!t.player.isVanishing&&(t.tsunamiTeardownTimestamp=void 0),S(t,p.Slide)&&Pt(e,t.player.previousPosition,t.player.position),Dt(e,t,{gridSize:o});const i=[...n.map(a=>({position:a.grid,type:"wave",obj:a})),...t.obstacles.map(a=>({position:a.position,type:"obstacle",obj:a})),...t.bonuses.map(a=>({position:a.position,type:"bonus",obj:a})),...t.landMines.map(a=>({position:a,type:"landMine"})),...t.timeBombs.map(a=>({position:a.position,type:"timeBomb",obj:a})),...t.monsters.map(a=>({position:a.position,type:"monster",obj:a})),{position:t.player.position,type:"player",obj:t.player},{position:t.goal,type:"goal"},...t.explosions.map(a=>({position:a.position,type:"explosion",obj:a})),...t.blasterShots.map(a=>({position:ae(a.endPosition,a.startPosition,a.shotTimestamp,a.duration),type:"blasterShot",obj:a}))],r=Ne(i);for(const a of r){const{type:u,position:c}=a;switch(u){case"wave":Ct(e,a.obj);break;case"obstacle":Qe(e,[a.obj],s);break;case"bonus":ft(e,[a.obj],s);break;case"landMine":yt(e,[c],s);break;case"timeBomb":bt(e,[a.obj],s);break;case"monster":dt(e,[a.obj],s,S(t,p.Monster));break;case"player":it(e,a.obj,s,t.activeBonuses.some(d=>d.type===p.CapOfInvisibility),t.obstacles,S(t,p.Monster),S(t,p.Blaster),S(t,p.Climber));break;case"goal":Ke(e,c,s);break;case"explosion":Tt(e,[a.obj]);break;case"blasterShot":kt(e,a.obj,s);break}}const l=t.activeBonuses.sort((a,u)=>u.duration-a.duration)[0];l&&vt(e,t.player.position,l,s),e.restore()},oe=300,se=200,H=5,Lt=Math.min(oe/H,se/H)/2,Bt=()=>({player:{position:{x:2,y:2},previousPosition:{x:2,y:2},moveTimestamp:Date.now(),isVictorious:!1,isVanishing:!1},goal:{x:4,y:4},obstacles:[{position:{x:1,y:1},creationTime:Date.now(),isRaising:!1,isDestroying:!1},{position:{x:3,y:3},creationTime:Date.now(),isRaising:!1,isDestroying:!1}],monsters:[{position:{x:0,y:4},previousPosition:{x:0,y:4},moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1,spawnPoint:{x:0,y:4}},{position:{x:4,y:0},previousPosition:{x:4,y:0},moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1,spawnPoint:{x:4,y:0}}],steps:0,monsterSpawnSteps:0,bonuses:[{type:p.CapOfInvisibility,position:{x:1,y:3}},{type:p.ConfusedMonsters,position:{x:3,y:1}}],activeBonuses:[],explosions:[],timeBombs:[],landMines:[],score:0,gameEndingState:"none",tsunamiLevel:0,blasterShots:[]}),St=()=>{const e=B.useRef(null),t=B.useRef(Bt());return B.useEffect(()=>{const o=e.current;if(!o)return;const s=o.getContext("2d");if(!s)return;const n=()=>{s.clearRect(0,0,oe,se),s.save(),s.scale(.8,.8),s.translate(oe*.1,se*.1),Ce(s,H,t.current),je(s,t.current,{gridSize:H,cellSize:Lt,initialMonsterCount:0,monsterSpawnSectors:[],obstacleCount:0,initialBonusCount:0,levelName:"Preview",levelStory:"Preview",levelUpdater:()=>{}}),s.restore(),t.current.monsters.forEach(i=>{const r=i.position.x+(Math.random()-.5)*.1,l=i.position.y+(Math.random()-.5)*.1;i.previousPosition={...i.position},i.position={x:Math.max(0,Math.min(H-1,r)),y:Math.max(0,Math.min(H-1,l))},i.moveTimestamp=Date.now()}),requestAnimationFrame(n)};n()},[]),h.jsx("canvas",{ref:e,width:oe,height:se})},Ot=({onStart:e,onInstructions:t})=>(B.useEffect(()=>{const o=s=>{s.key==="ArrowRight"&&e()};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e]),h.jsxs("div",{className:"intro",children:[h.jsx("h1",{className:"game-title",children:"Monster Steps"}),h.jsxs("div",{className:"game-intro-responsive",children:[h.jsx("div",{className:"game-preview-container",children:h.jsx(St,{})}),h.jsxs("div",{className:"game-intro-column",children:[h.jsxs("div",{className:"intro-buttons",children:[h.jsx("button",{onClick:e,children:"Start Game"}),h.jsx("button",{onClick:t,children:"Instructions"})]}),h.jsx("p",{className:"intro-tip",children:"Press right arrow to start"})]})]}),h.jsxs("p",{className:"author-name",children:["Created by ",h.jsx("a",{href:"https://x.com/gtanczyk",children:"Grzegorz Tańczyk"})," | ",h.jsx("a",{href:"https://github.com/gamedevpl/www.gamedev.pl/tree/master/js13k2024",children:"Source code (GitHub)"})]})]})),Rt=({onBack:e})=>(B.useEffect(()=>{const t=o=>{o.key==="Escape"&&e()};return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[e]),h.jsxs("div",{className:"instructions",children:[h.jsx("h1",{children:"How to Play Monster Steps"}),h.jsxs("ul",{children:[h.jsx("li",{children:"Use arrow keys, touch controls, or mouse clicks to move your character"}),h.jsx("li",{children:"Avoid obstacles and monsters"}),h.jsx("li",{children:"Reach the goal (green square) to complete the level"}),h.jsx("li",{children:"New monsters appear every 13 steps"}),h.jsxs("li",{children:["Collect bonuses for special abilities:",h.jsxs("ul",{children:[h.jsx("li",{children:"Cap of Invisibility: Temporary invisibility to monsters"}),h.jsx("li",{children:"Confused Monsters: Monsters move randomly"}),h.jsx("li",{children:"Land Mine: Place a trap for monsters"}),h.jsx("li",{children:"Time Bomb: Delayed explosion"}),h.jsx("li",{children:"Crusher: Destroy nearby obstacles"}),h.jsx("li",{children:"Builder: Create new platforms"}),h.jsx("li",{children:"Climber: Climb on walls and obstacles"}),h.jsx("li",{children:"Teleport: Instantly move to another location on the grid"}),h.jsx("li",{children:"Tsunami: Water floods the grid, slowing movement. Climb to survive!"}),h.jsx("li",{children:"Monster: Transform into a monster and hunt other monsters"}),h.jsx("li",{children:"Slide: Glide across the grid until hitting an obstacle"}),h.jsx("li",{children:"Sokoban: Push obstacles to crush monsters or create paths"}),h.jsx("li",{children:"Blaster: Shoot in the direction you're moving to eliminate monsters"})]})]}),h.jsx("li",{children:"Complete all 13 levels to win"})]}),h.jsx("h2",{children:"New Bonus Details"}),h.jsxs("ul",{children:[h.jsxs("li",{children:["Tsunami:",h.jsxs("ul",{children:[h.jsx("li",{children:"Water gradually floods the grid over 13 steps"}),h.jsx("li",{children:"Movement becomes slower for both you and monsters"}),h.jsx("li",{children:"At the 13th step, everything not on an obstacle is eliminated"}),h.jsx("li",{children:"Use the Climber bonus to survive on obstacles"})]})]}),h.jsxs("li",{children:["Monster:",h.jsxs("ul",{children:[h.jsx("li",{children:"You become a monster for 13 steps"}),h.jsx("li",{children:'Monsters become vulnerable "players" during this time'}),h.jsx("li",{children:"Eliminate all monster-players to win, but be careful not to let them reach the goal!"})]})]}),h.jsxs("li",{children:["Slide:",h.jsxs("ul",{children:[h.jsx("li",{children:"Your movement becomes a slide in the chosen direction"}),h.jsx("li",{children:"You'll keep moving until you hit an obstacle or the edge of the grid"}),h.jsx("li",{children:"Use this to quickly traverse the grid, but plan your moves carefully!"})]})]}),h.jsxs("li",{children:["Sokoban:",h.jsxs("ul",{children:[h.jsx("li",{children:"Gain the ability to push obstacles"}),h.jsx("li",{children:"Use this to create new paths or crush monsters"}),h.jsx("li",{children:"Strategic obstacle placement can help block monster paths"})]})]}),h.jsxs("li",{children:["Blaster:",h.jsxs("ul",{children:[h.jsx("li",{children:"Equip a blaster that shoots in the direction you're moving"}),h.jsx("li",{children:"Eliminate monsters in your path"}),h.jsx("li",{children:"Use carefully to clear your way to the goal"})]})]})]}),h.jsx("h2",{children:"Tips"}),h.jsxs("ul",{children:[h.jsx("li",{children:"Plan your route to avoid getting trapped"}),h.jsx("li",{children:"Use obstacles and new bonuses strategically to outmaneuver monsters"}),h.jsx("li",{children:"Combine bonuses for powerful effects (e.g., Climber during Tsunami)"}),h.jsx("li",{children:"Think ahead when using Slide or Sokoban to avoid putting yourself in danger"}),h.jsx("li",{children:"Keep track of your steps to anticipate new monster spawns"})]}),h.jsx("button",{onClick:e,children:"Back to Menu"}),h.jsx("p",{className:"instructions-tip",children:"Press Escape to return to the main menu"})]})),L=(e,t)=>e.x===t.x&&e.y===t.y,O=(e,t)=>t.some(o=>L(o,e)),J=(e,t)=>Math.abs(e.x-t.x)+Math.abs(e.y-t.y),Ft=e=>{switch(e){case"ArrowUp":case"w":return w.Up;case"ArrowDown":case"s":return w.Down;case"ArrowLeft":case"a":return w.Left;case"ArrowRight":case"d":return w.Right;default:return null}},x=(e,t,o=1)=>{switch(t){case w.Up:return{...e,y:e.y-o};case w.Down:return{...e,y:e.y+o};case w.Left:return{...e,x:e.x-o};case w.Right:return{...e,x:e.x+o}}};function ge(e,t){switch(e){case w.Up:return t===-1?w.Left:w.Right;case w.Down:return t===-1?w.Left:w.Right;case w.Left:return t===-1?w.Down:w.Up;case w.Right:return t===-1?w.Up:w.Down}}const Gt=(e,t,{gridSize:o})=>!(!(e.x>=0&&e.x<o&&e.y>=0&&e.y<o)||O(e,t.obstacles.filter(i=>!i.isDestroying).map(({position:i})=>i))),ne=(e,t,{gridSize:o})=>{if(!(e.x>=0&&e.x<o&&e.y>=0&&e.y<o))return!1;const n=O(t.player.position,t.obstacles.filter(r=>!r.isDestroying).map(({position:r})=>r));if(O(e,t.obstacles.filter(r=>!r.isDestroying).map(({position:r})=>r))&&!S(t,p.Climber)&&!n&&!S(t,p.Crusher)){if(t.activeBonuses.some(r=>r.type===p.Sokoban)){const r=De(t.player.position,e),l=x(e,r);if(l.x>=0&&l.x<o&&l.y>=0&&l.y<o&&!O(l,t.obstacles.map(u=>u.position)))return!0}return!1}return!0},Ie=(e,t)=>{const{player:o}=e,s=[w.Up,w.Down,w.Left,w.Right];return S(e,p.Slide)?s.map(n=>{let i=o.position;for(;ne(x(i,n),e,t);)i=x(i,n);return{position:i,direction:n}}).filter(n=>!L(n.position,o.position)):s.map(n=>({position:x(o.position,n),direction:n})).filter(({position:n})=>ne(n,e,t))};function Nt(e,t,o,s){return Ie(o,s).find(n=>xt(e,t,Ee(s.gridSize,s.cellSize,n.direction)))}function xt(e,t,o){let s=!1;for(let n=0,i=o.length-1;n<o.length;i=n++){const r=o[n].x,l=o[n].y,a=o[i].x,u=o[i].y;l>t!=u>t&&e<(a-r)*(t-l)/(u-l)+r&&(s=!s)}return s}function De(e,t){return t.x>e.x?w.Right:t.x<e.x?w.Left:t.y>e.y?w.Down:w.Up}const Vt=(e,t,o,s)=>{e.save(),e.translate(e.canvas.width/2,100),t.forEach(({direction:n})=>{const i=Ee(o,s,n);e.beginPath(),e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y),e.fillStyle="rgba(255, 255, 0, 0.5)",e.fill()}),e.restore()};function Ee(e,t,o){const s=e/3,n=x({x:e/2,y:e/2},o,e/1.5),i=x(n,ge(o,-1),s),r=x(n,ge(o,1),s),l=C(n.x,n.y),a=C(i.x,i.y),u=C(r.x,r.y),c=x(n,o,s),d=C(c.x,c.y),f=Math.atan2(d.y-l.y,d.x-l.x),b=Math.cos(f)*t,T=Math.sin(f)*t;return[{x:d.x+b,y:d.y+T},{x:a.x+b,y:a.y+T},{x:u.x+b,y:u.y+T}]}const Ut=(e,t,o,s,n,i,r)=>{const l=[];return e.map(a=>{let u;const c=Wt(a.position,t,o,s);n||c>13?u=ue(a.position,a.spawnPoint,o,s,e)[1]||a.position:u=ue(a.position,t,o,s,e)[1]||a.position;let d;return i||r?d=_t(a.position,u,o,s,e):d=u,O(d,l)?d=a.position:l.push(d),{...a,previousPosition:a.position,position:d,moveTimestamp:Date.now()}})},Wt=(e,t,o,s)=>ue(e,t,o,s,[]).length-1,_t=(e,t,o,s,n)=>{const i=t.x-e.x,r=t.y-e.y,l={x:Math.max(0,Math.min(o-1,e.x-i)),y:Math.max(0,Math.min(o-1,e.y-r))};return!O(l,s.map(({position:a})=>a))&&!O(l,n.map(a=>a.position))?l:e},ue=(e,t,o,s,n)=>{const i=[],r=[],l={position:e,g:0,h:0,f:0,parent:null};for(i.push(l);i.length>0;){let a=i[0],u=0;if(i.forEach((d,f)=>{d.f<a.f&&(a=d,u=f)}),i.splice(u,1),r.push(a),L(a.position,t))return Yt(a);const c=$t(a.position,o);for(const d of c){if(O(d,s.map(({position:v})=>v))||O(d,n.map(v=>v.position))||r.some(v=>L(v.position,d)))continue;const f=a.g+1,b=J(d,t),T=f+b,y=i.find(v=>L(v.position,d));y?f<y.g&&(y.g=f,y.f=T,y.parent=a):i.push({position:d,g:f,h:b,f:T,parent:a})}}return[e]},Yt=e=>{const t=[];let o=e;for(;o!==null;)t.unshift(o.position),o=o.parent;return t},$t=(e,t)=>[{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1}].filter(s=>s.x>=0&&s.x<t&&s.y>=0&&s.y<t),Xt=(e,t)=>t.some(o=>L(o.position,e)),Ht=(e,t)=>{const o=[];return[e.filter(n=>{const i=t.find(r=>L(r,n.position));return i?(o.push({position:i,startTime:Date.now(),duration:1e3}),qt(t,i),!1):!0}),o]},qt=(e,t)=>{e.splice(e.indexOf(t),1)},Kt=(e,t)=>Math.abs(e.position.x-t.position.x)<=1&&Math.abs(e.position.y-t.position.y)<=1,he=(e,t)=>t.some(o=>Math.abs(e.x-o.position.x)<=1&&Math.abs(e.y-o.position.y)<=1);class Qt{constructor(){le(this,"audioContext");le(this,"masterVolume",.025);this.audioContext=new(window.AudioContext||window.webkitAudioContext)}createOscillator(t,o,s){const n=this.audioContext.createOscillator();return n.type=o,n.frequency.setValueAtTime(t,this.audioContext.currentTime),n.start(),n.stop(this.audioContext.currentTime+s),n}createGain(t,o,s=1){const n=this.audioContext.createGain(),i=s*this.masterVolume;return n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+t),n.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+t+o),n}playStep(){const t=this.createOscillator(200,"square",.1),o=this.createGain(.01,.09);t.connect(o).connect(this.audioContext.destination)}playElectricalDischarge(){const t=this.createOscillator(800,"sawtooth",.2),o=this.createGain(.01,.19);t.frequency.linearRampToValueAtTime(200,this.audioContext.currentTime+.2),t.connect(o).connect(this.audioContext.destination)}playBonusCollected(){const t=this.createOscillator(600,"sine",.15),o=this.createGain(.01,.14);t.frequency.linearRampToValueAtTime(800,this.audioContext.currentTime+.15),t.connect(o).connect(this.audioContext.destination)}playExplosion(){const t=this.audioContext.createBufferSource(),o=this.audioContext.sampleRate*.5,s=this.audioContext.createBuffer(1,o,this.audioContext.sampleRate),n=s.getChannelData(0);for(let r=0;r<o;r++)n[r]=Math.random()*2-1;t.buffer=s;const i=this.createGain(.01,.49,.5);t.connect(i).connect(this.audioContext.destination),t.start()}playStateTransition(){const t=this.createOscillator(300,"triangle",.3),o=this.createGain(.05,.25);t.frequency.linearRampToValueAtTime(600,this.audioContext.currentTime+.3),t.connect(o).connect(this.audioContext.destination)}playGameOver(){const t=this.createOscillator(440,"sine",1),o=this.createGain(.01,.99);t.frequency.linearRampToValueAtTime(220,this.audioContext.currentTime+1),t.connect(o).connect(this.audioContext.destination)}playLevelComplete(){const t=this.createOscillator(440,"sine",.5),o=this.createOscillator(550,"sine",.5),s=this.createGain(.01,.49),n=this.createGain(.01,.49);t.connect(s).connect(this.audioContext.destination),o.connect(n).connect(this.audioContext.destination),setTimeout(()=>{const i=this.createOscillator(660,"sine",.5),r=this.createGain(.01,.49);i.connect(r).connect(this.audioContext.destination)},250)}playMonsterSpawn(){const t=this.createOscillator(100,"sawtooth",.3),o=this.createGain(.01,.29);t.frequency.exponentialRampToValueAtTime(300,this.audioContext.currentTime+.3),t.connect(o).connect(this.audioContext.destination)}playTeleport(){const t=this.createOscillator(100,"sine",.5),o=this.createOscillator(200,"sine",.5),s=this.createGain(.01,.49),n=this.createGain(.01,.49);t.frequency.exponentialRampToValueAtTime(1e3,this.audioContext.currentTime+.25),o.frequency.exponentialRampToValueAtTime(2e3,this.audioContext.currentTime+.25),t.connect(s).connect(this.audioContext.destination),o.connect(n).connect(this.audioContext.destination),setTimeout(()=>{const i=this.createOscillator(2e3,"sine",.2),r=this.createGain(.01,.19);i.frequency.exponentialRampToValueAtTime(4e3,this.audioContext.currentTime+.2),i.connect(r).connect(this.audioContext.destination)},100)}playBlasterSound(){const o=this.audioContext.createOscillator();o.type="sawtooth",o.frequency.setValueAtTime(1e3,this.audioContext.currentTime),o.frequency.exponentialRampToValueAtTime(500,this.audioContext.currentTime+.15);const s=this.audioContext.createGain();s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(this.masterVolume,this.audioContext.currentTime+.01),s.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15);const n=this.audioContext.createBuffer(1,this.audioContext.sampleRate*.15,this.audioContext.sampleRate),i=n.getChannelData(0);for(let a=0;a<n.length;a++)i[a]=Math.random()*2-1;const r=this.audioContext.createBufferSource();r.buffer=n;const l=this.audioContext.createGain();l.gain.setValueAtTime(this.masterVolume*.2,this.audioContext.currentTime),l.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15),o.connect(s).connect(this.audioContext.destination),r.connect(l).connect(this.audioContext.destination),o.start(),r.start(),o.stop(this.audioContext.currentTime+.15),r.stop(this.audioContext.currentTime+.15)}}const U=new Qt,Zt=(e,t)=>{const o={type:t,duration:13};switch(e.activeBonuses.push(o),t){case p.CapOfInvisibility:break;case p.ConfusedMonsters:break;case p.LandMine:e.landMines.push({...e.player.position});break;case p.TimeBomb:e.timeBombs.push({position:e.player.position,timer:13,shakeIntensity:0});break;case p.Crusher:break;case p.Builder:break;case p.Climber:break;case p.Teleport:break;case p.Tsunami:e.tsunamiLevel=1;break;case p.Monster:break;case p.Slide:break;case p.Sokoban:break;case p.Blaster:break}},Jt=(e,t)=>{const o=Object.values(p).filter(i=>typeof i=="number");let s;if(e.monsters.length>5){const i=[p.CapOfInvisibility,p.Crusher,p.LandMine,p.TimeBomb,p.Blaster];s=i[Math.floor(Math.random()*i.length)]}else if(e.obstacles.length>20){const i=[p.Climber,p.Slide,p.Teleport];s=i[Math.floor(Math.random()*i.length)]}else s=o[Math.floor(Math.random()*o.length)];let n;do n={x:Math.floor(Math.random()*t.gridSize),y:Math.floor(Math.random()*t.gridSize)};while(O(n,e.obstacles.map(i=>i.position))||O(n,e.monsters.map(i=>i.position))||O(n,e.bonuses.map(i=>i.position))||L(n,e.player.position)||L(n,e.goal)||J(n,e.player.position)<3);e.bonuses.push({type:s,position:n})},zt=(e,t)=>{const o=e.bonuses.find(s=>s.type===p.Teleport&&!L(s.position,t));o&&(e.player.previousPosition=e.player.position,e.player.position=o.position,e.player.teleportTimestamp=Date.now(),U.playTeleport())},eo=e=>{e.tsunamiLevel++,e.tsunamiLevel>=13&&(O(e.player.position,e.obstacles.map(t=>t.position))||(e.gameEndingState="gameOver",ie(e)),e.monsters=[],e.tsunamiLevel=0,e.tsunamiTeardownTimestamp=Date.now())},to=e=>{const t=e.monsters.find(o=>L(e.player.position,o.position));t&&(e.monsters=e.monsters.filter(o=>o!==t),e.monsters.length===0&&(e.gameEndingState="gameOver",ie(e)))},Ae=(e,t,o)=>{let s=e.player.position;for(;ne(x(s,t),e,o);)s=x(s,t);return s},oo=(e,t,o,s)=>{const n=e.obstacles.find(i=>L(i.position,o));if(n){const i=x(n.position,De(t,o));if(Gt(i,e,{gridSize:s})){n.position=i;const r=e.monsters.find(l=>L(l.position,i));r&&(e.monsters=e.monsters.filter(l=>l!==r))}else o=t}},so=(e,t,o)=>{const s=e.player.position,n=Ae(e,t,o),i={startPosition:s,endPosition:n,direction:t,shotTimestamp:Date.now(),duration:xe*(J(s,n)+1)};e.blasterShots.push(i),U.playBlasterSound(),e.monsters=e.monsters.filter(r=>!no(r.position,s,n,t))},no=(e,t,o,s)=>{switch(s){case w.Up:case w.Down:return e.x===t.x&&(s===w.Up&&e.y<=t.y&&e.y>=o.y||s===w.Down&&e.y>=t.y&&e.y<=o.y);case w.Left:case w.Right:return e.y===t.y&&(s===w.Left&&e.x<=t.x&&e.x>=o.x||s===w.Right&&e.x>=t.x&&e.x<=o.x)}},io=(e,t,o)=>{if(Z(t))return t;const s=Ft(e.key);return s!==null?Le(s,t,o):{...t}},Le=(e,t,o)=>{if(Z(t))return t;const s={...t},n=s.player.position;let i=x(s.player.position,e);if(S(s,p.Slide)&&(i=Ae(s,e,o)),s.activeBonuses.some(r=>r.type===p.Sokoban)&&oo(s,n,i,o.gridSize),s.obstacles=t.obstacles.filter(r=>!r.isDestroying||Date.now()-r.creationTime<Me),S(s,p.Crusher)&&t.obstacles.find(r=>L(i,r.position))&&(s.obstacles=t.obstacles.map(r=>L(i,r.position)?{...r,isDestroying:!0,creationTime:Date.now()}:r),U.playElectricalDischarge()),ne(i,s,o)){if(U.playStep(),s.player.position=i,Date.now()-s.player.moveTimestamp>Te&&(s.player.previousPosition=n,s.player.moveTimestamp=Date.now()),s.steps++,s.monsterSpawnSteps++,s.tsunamiLevel>0&&eo(s),L(i,s.goal))return s.gameEndingState="levelComplete",ro(s),s.score+=ao(s),s;const r=s.bonuses.find(c=>L(c.position,i));if(r&&(U.playBonusCollected(),s.bonuses=s.bonuses.filter(c=>!L(c.position,i)),Zt(s,r.type)),(r==null?void 0:r.type)===p.Teleport&&zt(s,r.position),o.levelUpdater(s,o),s.monsters=Ut(s.monsters,s.player.position,o.gridSize,s.obstacles,S(s,p.CapOfInvisibility),S(s,p.ConfusedMonsters),S(s,p.Monster)),S(s,p.Monster))to(s);else if(Xt(s.player.position,s.monsters))return s.gameEndingState="gameOver",ie(s),s;S(s,p.Blaster)&&so(s,e,o),s.blasterShots=s.blasterShots.filter(c=>Date.now()-c.shotTimestamp<c.duration);const[l,a]=Ht(s.monsters,s.landMines);s.monsters=l,s.explosions=a,s.timeBombs=s.timeBombs.map(c=>({...c,timer:c.timer-1}));const u=s.timeBombs.filter(c=>c.timer===0);if((u.length>0||a.length>0)&&U.playExplosion(),s.explosions=[...s.explosions,...u.map(c=>({position:c.position,startTime:Date.now(),duration:1e3}))],s.timeBombs=s.timeBombs.filter(c=>c.timer>0),s.monsters=s.monsters.filter(c=>!s.explosions.some(d=>Kt(c,d))),s.obstacles=s.obstacles.map(c=>he(c.position,s.explosions)?{...c,isDestroying:!0,creationTime:Date.now()}:c),s.bonuses=s.bonuses.filter(c=>!he(c.position,s.explosions)),he(s.player.position,s.explosions))return s.gameEndingState="gameOver",ie(s),s;if(s.activeBonuses=s.activeBonuses.map(c=>({...c,duration:c.duration-1})).filter(c=>c.duration>0),S(s,p.Builder)){const c={position:n,creationTime:Date.now(),isRaising:!0,isDestroying:!1};O(c.position,s.obstacles.map(({position:d})=>d))||(s.obstacles.push(c),U.playElectricalDischarge())}}return s},ao=e=>100-e.steps+e.monsters.length*10,Z=e=>e.gameEndingState!=="none",ie=e=>{e.player.isVanishing=!0,U.playGameOver()},ro=e=>{e.player.isVictorious=!0,U.playLevelComplete()},lo=({level:e,score:t,steps:o})=>h.jsxs("div",{className:"hud",children:[h.jsxs("div",{children:["Level: ",e]}),h.jsxs("div",{children:["Score: ",t]}),h.jsxs("div",{children:["Steps: ",o]})]}),co=10,ho=10,uo=(e,{gridSize:t,monsterSpawnSectors:o})=>{let s=0;const n=50;for(;s<n;){const i=o.length>0?o[Math.round(o.length*Math.random())]:{x:Math.floor(Math.random()*t),y:Math.floor(Math.random()*t)};if(po(i,e,t))return{position:i,previousPosition:i,moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1,spawnPoint:i};s++}return null},po=(e,t,o)=>{if(e.x<0||e.y<0||e.x>=o||e.y>=o||O(e,t.obstacles.map(n=>n.position))||O(e,t.monsters.map(n=>n.position))||O(e,t.bonuses.map(n=>n.position))||L(e,t.goal)||J(e,t.player.position)<co)return!1;const s=[p.TimeBomb,p.LandMine,p.Crusher,p.Blaster];for(const n of t.bonuses)if(s.includes(n.type)&&J(e,n.position)<ho)return!1;return!0};function mo(e,t){if(e.monsterSpawnSteps>=13){const o=uo(e,t);o&&(e.monsters.push(o),e.monsterSpawnSteps=0,U.playMonsterSpawn())}}const fo=()=>{const e=G(),t=N(7,"The First Step","Avoid the lone monster and reach the goal in 13 steps!");return e.player=F(0,3),e.goal=E(6,3),e.monsters=[P(3,0)],e.obstacles=[m(5,2),m(5,3)],[e,t,t.levelStory]},yo=()=>{const e=G(),t=N(8,"Now You See Me","Use the invisibility cap to sneak past the monsters!");return e.player=F(0,4),e.goal=E(7,4),e.monsters=[P(3,2),P(5,4)],e.bonuses=[D(2,4,p.CapOfInvisibility)],e.obstacles=[m(1,3),m(1,5),m(6,3),m(6,5)],[e,t,t.levelStory]},bo=()=>{const e=G(),t=N(9,"Bridge the Gap","Build your way to victory!");return e.player=F(0,4),e.goal=E(8,4),e.monsters=[P(4,4)],e.bonuses=[D(2,4,p.Builder)],e.obstacles=[m(3,3),m(3,4),m(3,5),m(5,3),m(5,4),m(5,5)],[e,t,t.levelStory]},wo=()=>{const e=G(),t=N(9,"Crush and Rush","Clear the path with your crushing power!");e.player=F(0,4),e.goal=E(8,4),e.monsters=[P(4,4)],e.bonuses=[D(2,4,p.Crusher)],e.obstacles=[m(8,2),m(7,2),m(7,3),m(7,4),m(7,5),m(8,5)];for(let o=2;o<7;o++)e.obstacles.push(m(o,3)),e.obstacles.push(m(o-1,5));return[e,t,t.levelStory]},go=()=>{const e=G(),t=N(10,"Tick Tock Boom","Time your bomb perfectly to clear the way!");e.player=F(0,5),e.goal=E(9,5),e.monsters=[P(3,5)],e.bonuses=[D(8,3,p.TimeBomb)],e.obstacles=[m(9,4),m(8,4),m(8,5),m(8,6),m(9,6),m(2,1),m(3,1),m(4,1),m(5,1),m(6,1),m(7,1),m(8,1)];for(let o=2;o<8;o++)e.obstacles.push(m(o,4)),e.obstacles.push(m(o,6)),e.obstacles.push(m(o-2,8));return t.monsterSpawnSectors=[E(1,9)],[e,t,t.levelStory]},To=()=>{const e=G(),t=N(10,"Minesweeper's Revenge","Plant a surprise for your pursuers!");e.player=F(0,5),e.goal=E(9,5),e.monsters=[P(6,5),P(4,8),P(8,8)],e.bonuses=[D(2,5,p.LandMine)];for(let o=4;o<9;o++)o!==6&&(e.obstacles.push(m(o,4)),e.obstacles.push(m(o,6)));return[e,t,t.levelStory]},vo=()=>{const e=G(),t=N(11,"Monsters' Mayhem","Confuse them all and make your escape!");e.player=F(0,5),e.goal=E(10,5),e.monsters=[P(3,4),P(3,6),P(6,4),P(6,6)],e.bonuses=[D(2,5,p.ConfusedMonsters)];for(let o=4;o<8;o++)e.obstacles.push(m(o,3)),e.obstacles.push(m(o,7));return[e,t,t.levelStory]},Mo=()=>{const e=G(),t=N(12,"Tunnel Vision","Build a path and set a trap!");e.player=F(0,6),e.goal=E(11,6),e.monsters=[],e.bonuses=[D(2,6,p.Builder),D(5,6,p.LandMine),D(5,5,p.Sokoban)];for(let o=3;o<10;o++)o!==5&&o!==8&&(e.obstacles.push(m(o,5)),e.obstacles.push(m(o,7)));return e.obstacles.push(m(1,4)),e.obstacles.push(m(1,8)),e.obstacles.push(m(10,4)),e.obstacles.push(m(10,8)),e.obstacles.push(m(11,5)),e.obstacles.push(m(11,7)),t.monsterSpawnSectors=[E(0,0)],[e,t,"Use the Builder bonus to create a path and set up a trap with the Land Mine. Be strategic about where you place your obstacles and mine to catch the spawning monsters!"]},Co=()=>{const e=G(),t=N(12,"Ghost Bomber","Vanish, plant, and detonate!");e.player=F(0,6),e.goal=E(11,6),e.monsters=[P(3,1),P(7,11),P(10,3)],e.bonuses=[D(2,6,p.CapOfInvisibility),D(9,6,p.TimeBomb),D(7,4,p.CapOfInvisibility)];for(let o=2;o<11;o+=2)for(let s=1;s<12;s+=2)!(o===10&&s===5)&&!(o===10&&s===7)&&e.obstacles.push(m(o,s));return e.obstacles.push(m(11,5)),e.obstacles.push(m(10,6)),e.obstacles.push(m(11,7)),e.obstacles.push(m(10,8)),e.obstacles.push(m(1,3)),e.obstacles.push(m(1,9)),e.obstacles.push(m(5,6)),e.obstacles.push(m(8,4)),e.obstacles.push(m(8,8)),[e,t,"Use your invisibility wisely to sneak past the monsters and reach the time bomb. Then, strategically place and detonate the bomb to clear a path to the goal!"]},Po=()=>{const e=G(),t=N(13,"Surf and Climb","Ride the wave and climb to safety!");e.player=F(0,6),e.goal=E(12,6),e.monsters=[P(4,6),P(8,6),P(11,6),P(6,2),P(6,10)],e.bonuses=[D(2,6,p.Tsunami),D(4,4,p.Climber)];for(let o=1;o<12;o++)o!==2&&o!==10&&(e.obstacles.push(m(o,5)),e.obstacles.push(m(o,7)));e.obstacles.push(m(3,6)),e.obstacles.push(m(6,6)),e.obstacles.push(m(9,6));for(let o=0;o<13;o+=3)e.obstacles.push(m(o,0)),e.obstacles.push(m(o,12));return e.obstacles.push(m(11,5)),e.obstacles.push(m(11,7)),[e,t,"Collect the Tsunami bonus first, then make your way to the Climber bonus. Use the Climber to get on top of an obstacle, then activate the Tsunami to wash away the monsters. Time it right to reach the goal!"]},ko=()=>{const e=G(),t=N(14,"Slide and Blast","Slide through danger and blast your way to victory!");e.player=F(0,0),e.goal=E(13,13),e.monsters=[P(3,3),P(10,10),P(6,7),P(7,6),P(13,0)],e.bonuses=[D(0,2,p.Blaster),D(0,13,p.Slide)];for(let o=2;o<12;o+=3)for(let s=0;s<14;s++)s!==7&&e.obstacles.push(m(o,s));return e.obstacles.push(m(12,1)),e.obstacles.push(m(12,2)),e.obstacles.push(m(11,1)),e.obstacles.push(m(0,6)),e.obstacles.push(m(1,1)),e.obstacles.push(m(4,4)),e.obstacles.push(m(9,9)),e.obstacles.push(m(12,10)),[e,t,"Navigate to the Slide bonus to quickly traverse the level. Then, collect the Blaster to destroy the wall blocking your path to the goal. Watch out for monsters and use your bonuses strategically!"]},jo=()=>{const e=G(),t=N(15,"The Gauntlet","Master all your skills to conquer the final challenge!");e.player=F(0,7),e.goal=E(14,7),e.monsters=[P(5,2),P(5,12),P(10,4),P(10,10),P(14,0),P(14,14)],e.bonuses=[D(2,7,p.CapOfInvisibility),D(4,7,p.Crusher),D(7,3,p.TimeBomb),D(7,11,p.LandMine),D(10,7,p.Blaster),D(12,7,p.Climber)];for(let o=1;o<14;o++)o%3!==1&&(e.obstacles.push(m(o,6)),e.obstacles.push(m(o,8)));for(let o=0;o<15;o+=3)if(o!==6&&o!==9)for(let s=0;s<15;s++)s!==7&&e.obstacles.push(m(o,s));return e.obstacles.push(m(3,5)),e.obstacles.push(m(3,9)),e.obstacles.push(m(7,5)),e.obstacles.push(m(7,9)),e.obstacles.push(m(11,5)),e.obstacles.push(m(11,9)),e.obstacles.push(m(13,6)),e.obstacles.push(m(13,8)),e.obstacles.push(m(14,6)),e.obstacles.push(m(14,8)),[e,t,"This is your final test! Use all the skills you've learned to navigate through the gauntlet. Collect bonuses strategically, avoid or eliminate monsters, and make your way to the goal. Good luck!"]},V=16,Be=5;function de(){return{x:Math.floor(Math.random()*V),y:Math.floor(Math.random()*V)}}function Se(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}function me(e,t){return!t.obstacles.some(o=>o.position.x===e.x&&o.position.y===e.y)&&!t.monsters.some(o=>o.position.x===e.x&&o.position.y===e.y)&&!t.bonuses.some(o=>o.position.x===e.x&&o.position.y===e.y)&&e.x!==t.player.position.x&&e.y!==t.player.position.y&&e.x!==t.goal.x&&e.y!==t.goal.y}function Io(e,t){for(let o=0;o<t;o++){let s;do s=de();while(!me(s,e));e.obstacles.push(m(s.x,s.y))}}function Do(e){const t=Object.values(p).filter(n=>typeof n=="number"),o=t[Math.floor(Math.random()*t.length)];let s;do s=de();while(!me(s,e)||Se(s,e.player.position)<Be);e.bonuses.push(D(s.x,s.y,o))}const Eo=()=>{const e=G(),t=N(V,"The Final Countdown","Survive and thrive in this ever-changing challenge!",Ao);e.player=F(0,0),e.goal=E(V-1,V-1),e.obstacles=[m(V-2,V-2),m(V-1,V-2),m(V-2,V-1)],Io(e,50);for(let o=0;o<3;o++)Do(e);return[e,t,"Welcome to the ultimate challenge! The level will dynamically evolve as you play. Use your skills wisely, collect bonuses, and make your way to the goal while avoiding the increasing dangers. Good luck!"]},Ao=(e,t)=>{if(e.steps%13===0){let o;do o=de();while(!me(o,e)||Se(o,e.player.position)<Be);e.monsters.push(P(o.x,o.y)),Jt(e,t)}},E=(e,t)=>({x:e,y:t}),D=(e,t,o)=>({position:E(e,t),type:o}),P=(e,t)=>({position:E(e,t),previousPosition:E(e,t),moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1,spawnPoint:E(e,t)}),F=(e,t)=>({position:E(e,t),previousPosition:E(e,t),moveTimestamp:Date.now(),isVictorious:!1,isVanishing:!1}),m=(e,t)=>({position:E(e,t),creationTime:Date.now(),isRaising:!1,isDestroying:!1}),G=()=>({player:F(0,0),goal:E(0,0),obstacles:[],monsters:[],steps:0,monsterSpawnSteps:0,bonuses:[],activeBonuses:[],explosions:[],timeBombs:[],landMines:[],score:0,gameEndingState:"none",tsunamiLevel:0,blasterShots:[]}),Lo=40,N=(e,t,o,s=mo)=>({gridSize:e,cellSize:Lo,initialMonsterCount:0,monsterSpawnSectors:[],obstacleCount:0,initialBonusCount:0,levelName:t,levelStory:o,levelUpdater:s}),Bo={1:fo,2:yo,3:bo,4:wo,5:go,6:To,7:vo,8:Mo,9:Co,10:Po,11:ko,12:jo,13:Eo},So=e=>{if(e<1||e>13)throw new Error(`Invalid level number: ${e}`);return Bo[e]()},Oo=13,Ro=2e3,Fo=({level:e,score:t,onGameOver:o,onLevelComplete:s,onGameComplete:n,updateScore:i,updateSteps:r})=>{const l=B.useRef(null),[[a,u,c],d]=B.useState(()=>So(e)),[f,b]=B.useState(!0),T=y=>{d([y,u,c]),i(y.score),r(y.steps)};return B.useEffect(()=>{a.gameEndingState!=="none"&&setTimeout(()=>{a.gameEndingState==="levelComplete"&&(e===Oo?n():s()),a.gameEndingState==="gameOver"&&o()},Ro)},[a.gameEndingState]),B.useEffect(()=>{if(!a||!u)return;const y=l.current;let v;if(y){const k=(u.gridSize+u.gridSize)*u.cellSize,I=(u.gridSize+u.gridSize)*u.cellSize/2;y.width=k,y.height=I+100;const j=y.getContext("2d");if(j){const A=()=>{je(j,a,u),Z(a)||Vt(j,Ie(a,u),u.gridSize,u.cellSize),v=requestAnimationFrame(A)};A()}}return()=>{v!==null&&cancelAnimationFrame(v)}},[a,u,f]),B.useEffect(()=>{if(!a||!u)return;const y=k=>{if(f){b(!1);return}if(!Z(a)){const I=io(k,a,u);T(I)}},v=k=>{if(f){b(!1);return}if(Z(a))return;const I=l.current;if(!I)return;const j=I.getBoundingClientRect(),A=Nt((k.clientX-j.left)*(I.width/j.width)-I.width/2,(k.clientY-j.top)*(I.height/j.height)-100,a,u);A&&T(Le(A.direction,a,u))};return window.addEventListener("click",v),window.addEventListener("keydown",y),()=>{window.removeEventListener("click",v),window.removeEventListener("keydown",y)}},[a,u,f,o,s,i,r]),f?h.jsxs("div",{className:"level-story",children:[h.jsxs("h2",{children:["Level ",e]}),h.jsx("p",{children:c}),h.jsx("p",{children:"Press any key to start..."})]}):h.jsxs("div",{className:"gameplay",children:[h.jsx(lo,{level:e,score:t,steps:(a==null?void 0:a.monsterSpawnSteps)||0}),h.jsx("div",{className:"canvas-container",children:h.jsx("canvas",{ref:l})})]})},Go=({score:e,steps:t,onTryAgain:o,onQuit:s})=>h.jsxs("div",{className:"game-over",children:[h.jsx("h1",{children:"Game Over"}),h.jsxs("p",{children:["Your score: ",e]}),h.jsxs("p",{children:["Steps taken: ",t]}),h.jsx("button",{onClick:o,children:"Try Again"}),h.jsx("button",{onClick:s,children:"Quit"})]}),No=({level:e,onNextLevel:t,onQuit:o})=>h.jsxs("div",{className:"level-complete",children:[h.jsxs("h1",{children:["Level ",e," Complete!"]}),h.jsx("p",{children:"Congratulations! You've completed the level."}),h.jsx("button",{onClick:t,children:"Next Level"}),h.jsx("button",{onClick:o,children:"Quit"})]});function Wo(){const[e,t]=B.useState(0),[o,s]=B.useState(parseInt(document.location.hash.split("level")[1]??"1")),[n,i]=B.useState(0),[r,l]=B.useState(0),a=B.useCallback(()=>{t(2)},[]),u=()=>{t(1)},c=()=>{s(1),i(0),l(0),t(2)},d=()=>{t(2)},f=()=>{t(0)},b=()=>{t(3)},T=()=>{s(o+1),t(4)},y=B.useCallback(()=>{t(2)},[]),v=()=>{U.playLevelComplete(),t(5)},k=j=>i(j),I=j=>l(j);return B.useEffect(()=>{const j=A=>{A.key==="ArrowRight"?e===0?a():e===4?y():e===3?d():e===5&&c():A.key==="Escape"&&(e===1||e===3||e===5)&&f()};return window.addEventListener("keydown",j),()=>{window.removeEventListener("keydown",j)}},[e,a,y]),h.jsxs("div",{className:"game-container",children:[e===0&&h.jsx(Ot,{onStart:a,onInstructions:u}),e===1&&h.jsx(Rt,{onBack:f}),e===2&&h.jsx(Fo,{level:o,score:n,onGameOver:b,onLevelComplete:T,onGameComplete:v,updateScore:k,updateSteps:I}),e===3&&h.jsx(Go,{score:n,steps:r,onTryAgain:d,onQuit:f}),e===4&&h.jsx(No,{level:o,onNextLevel:y,onQuit:f}),e===5&&h.jsx(xo,{score:n,steps:r,onPlayAgain:c,onQuit:f})]})}function xo({score:e,steps:t,onPlayAgain:o,onQuit:s}){return h.jsxs("div",{className:"game-complete intro",children:[h.jsx("h1",{className:"game-title",children:"Monster Steps"}),h.jsx("h2",{className:"game-complete-subtitle",children:"Congratulations!"}),h.jsxs("div",{className:"game-complete-stats",children:[h.jsxs("p",{children:["Final Score: ",e]}),h.jsxs("p",{children:["Total Steps: ",t]})]}),h.jsxs("div",{className:"intro-buttons",children:[h.jsx("button",{onClick:o,children:"Play Again"}),h.jsx("button",{onClick:s,children:"Quit"})]}),h.jsx("p",{className:"intro-tip",children:"Press right arrow to play again"})]})}export{Wo as MonsterStepsApp};
