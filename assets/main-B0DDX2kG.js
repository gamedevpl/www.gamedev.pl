var De=Object.defineProperty;var Se=(e,o,n)=>o in e?De(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var ae=(e,o,n)=>Se(e,typeof o!="symbol"?o+"":o,n);import{r as L,j as h}from"./index-vWYUYoix.js";var p=(e=>(e[e.CapOfInvisibility=0]="CapOfInvisibility",e[e.ConfusedMonsters=1]="ConfusedMonsters",e[e.LandMine=2]="LandMine",e[e.TimeBomb=3]="TimeBomb",e[e.Crusher=4]="Crusher",e[e.Builder=5]="Builder",e[e.Climber=6]="Climber",e[e.Teleport=7]="Teleport",e[e.Tsunami=8]="Tsunami",e[e.Monster=9]="Monster",e[e.Slide=10]="Slide",e[e.Sokoban=11]="Sokoban",e[e.Blaster=12]="Blaster",e))(p||{}),b=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right",e))(b||{});function ue(e){switch(e){case 0:return"Now you see me, now you don't!";case 1:return"Monsters are dizzy!";case 2:return"Boom goes the floor!";case 3:return"Tick tock, boom o'clock!";case 4:return"Hulk smash!";case 5:return"Bob the Builder mode: ON";case 6:return"Walk on walls like a pro!";case 7:return"Beam me up, Scotty!";case 8:return"Water, water everywhere!";case 9:return"Tables have turned!";case 10:return"Slip and slide!";case 11:return"Push it real good!";case 12:return"Pew pew pew!";default:return"Mystery power activated!"}}function O(e,o){return e.activeBonuses.some(n=>n.type===o)}const w=60,g=30;function P(e,o){return{x:(e-o)*w/2,y:(e+o)*g/2}}function de(e){switch(e){case"wave":case"obstacle":return 3;case"bonus":case"landMine":case"timeBomb":return 2;case"goal":return 2;case"monster":return 4;case"player":return 5;case"explosion":return 6;default:return 0}}function Ee(e){return e.sort((o,n)=>{const t=o.position.x+o.position.y,s=n.position.x+n.position.y;if(t!==s)return t-s;const i=de(o.type),r=de(n.type);return i!==r?i-r:0})}const fe=250,_=500,Le=50,Ae=()=>Math.cos(Date.now()/1e3*Math.PI),Be=e=>.5+(e/2+1)/2,se=(e,o,n,t=fe)=>{const s=Math.min(Date.now()-n,t)/t;return{x:o.x+(e.x-o.x)*s,y:o.y+(e.y-o.y)*s}},Oe=(e,o,n)=>Date.now()-n<_/2?o:e,Re=e=>{const o=Date.now()/1e3;return Math.sin(o*2+e)*3},me=e=>{const o=Date.now()/50;return{x:Math.sin(o)*e,y:Math.cos(o*1.5)*e}},Fe=(e,o,n,t)=>{const s=[],i=t-n,r=1e3;if(i>r)return s;const l=o/13,a=i/r,u=Math.sqrt(l*(1-a)),c=Math.floor(u*10);for(let d=0;d<c;d++)s.push({position:{x:Math.random()*e,y:Math.random()*e},intensity:10*u,duration:10*u});return s},ye=500,Ge=(e,o,n)=>{const t=Math.min((Date.now()-e)/ye,1);return n?1-t:o?t:1},Ne=()=>me(2),Ve=e=>{const n=e%1e3/1e3;return Math.sin(n*Math.PI)*20},We=e=>Math.max(0,1-e/2e3),Ye=e=>e<_/2?Math.max(0,1-e/2/(_/2)*2):Math.min(1,(e/2/(_/2)-.5)*2),Xe=(e,o,n)=>{const{x:t,y:s}=P(o.x,o.y);e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.ellipse(t,s+g/2,w/2,g/4,0,0,Math.PI*2),e.fill(),e.fillStyle="#FFD700",e.beginPath(),e.moveTo(t,s),e.lineTo(t+w/2,s+g/2),e.lineTo(t,s+g),e.lineTo(t-w/2,s+g/2),e.closePath(),e.fill(),e.fillStyle="#000000",e.font=`${n/2}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("★",t,s+g/2)},qe=(e,o,n)=>{o.forEach(t=>{const{position:s,creationTime:i,isRaising:r,isDestroying:l}=t,{x:a,y:u}=P(s.x,s.y),c=Ge(i,r,l)*n*.8;if(c===0)return;const d=c/n*.2,{x:m,y:C}=P(s.x,s.y+1),{x:M,y}=P(s.x+1,s.y+1),{x:T,y:k}=P(s.x+1,s.y+1+d),{x:D,y:I}=P(s.x,s.y+1+d);e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(m,C),e.lineTo(M,y),e.lineTo(T,k),e.lineTo(D,I),e.closePath(),e.fill();const S=l?c/(n*.8):1;e.fillStyle=`rgba(142, 36, 170, ${S})`,e.beginPath(),e.moveTo(a,u-c),e.lineTo(a+w/2,u+g/2-c),e.lineTo(a,u+g-c),e.lineTo(a-w/2,u+g/2-c),e.closePath(),e.fill(),e.fillStyle=`rgba(106, 27, 154, ${S})`,e.beginPath(),e.moveTo(a+w/2,u+g/2-c),e.lineTo(a+w/2,u+g/2),e.lineTo(a,u+g),e.lineTo(a,u+g-c),e.closePath(),e.fill(),e.fillStyle=`rgba(74, 20, 140, ${S})`,e.beginPath(),e.moveTo(a-w/2,u+g/2-c),e.lineTo(a-w/2,u+g/2),e.lineTo(a,u+g),e.lineTo(a,u+g-c),e.closePath(),e.fill()})},Ue=(e,o)=>{const n=P(0,0),t=P(o,0),s=P(0,o),i=P(o,o);e.fillStyle="#c2b280",e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(s.x,s.y),e.closePath(),e.fill(),e.fillStyle="#5d4037",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x,i.y+z),e.lineTo(s.x,s.y+z),e.lineTo(s.x,s.y),e.closePath(),e.fill(),e.fillStyle="#8d6e63",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x,i.y+z),e.lineTo(t.x,t.y+z),e.lineTo(t.x,t.y),e.closePath(),e.fill()},be=(e,o,n)=>{e.strokeStyle="#4a4a4a",e.lineWidth=1;for(let t=0;t<=o;t++)for(let s=0;s<=o;s++){const{x:i,y:r}=P(s,t);s<o&&(e.beginPath(),e.moveTo(i,r),e.lineTo(i+w/2,r+g/2),e.stroke()),t<o&&(e.beginPath(),e.moveTo(i,r),e.lineTo(i-w/2,r+g/2),e.stroke()),n.isSliding&&He(e,s,t)}},He=(e,o,n)=>{const{x:t,y:s}=P(o,n),i=e.createLinearGradient(t-w/2,s,t+w/2,s+g);i.addColorStop(0,"rgba(200, 200, 255, 0.2)"),i.addColorStop(.5,"rgba(220, 220, 255, 0.3)"),i.addColorStop(1,"rgba(200, 200, 255, 0.2)"),e.fillStyle=i,e.beginPath(),e.moveTo(t,s),e.lineTo(t+w/2,s+g/2),e.lineTo(t,s+g),e.lineTo(t-w/2,s+g/2),e.closePath(),e.fill();for(let r=0;r<3;r++){const l=t+(Math.random()-.5)*w,a=s+(Math.random()-.5)*g,u=Math.random()*2+1;e.fillStyle="rgba(255, 255, 255, 0.7)",e.beginPath(),e.arc(l,a,u,0,Math.PI*2),e.fill()}},ce=(e,o,n,t,s)=>{e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.ellipse(o+t/2,n+s/2+5,t/2,s/4,0,0,Math.PI*2),e.fill()},$e=e=>{const{isoX:o,isoY:n,cellSize:t,baseHeight:s,widthFactor:i,heightAnimationFactor:r}=e,l=Ae(),a=s*t+t*r*l,u=w*i,c=Be(l),d=w*i*c,m=g*.4*c;return{entityHeight:a,entityWidth:u,shadowWidth:d,shadowHeight:m,animFactor:l,shadowX:o-d/2,shadowY:n+g/2}},_e=(e,o,n,t,s,i,r)=>{e.fillStyle=i,e.beginPath(),e.moveTo(o,n-t-r),e.lineTo(o+s/2,n-t+g/4-r),e.lineTo(o,n+g/2-r),e.lineTo(o-s/2,n-t+g/4-r),e.closePath(),e.fill()},Ke=(e,o,n,t,s,i,r)=>{e.fillStyle=i,e.beginPath(),e.arc(o,n-t-s/2-r,s,0,Math.PI*2),e.fill()},Qe=(e,o,n,t,s,i,r,l)=>{const a=s*.3;e.fillStyle=i,e.beginPath(),e.arc(o-s/3,n-t-s/2-l,a,0,Math.PI*2),e.arc(o+s/3,n-t-s/2-l,a,0,Math.PI*2),e.fill(),e.fillStyle=r,e.beginPath(),e.arc(o-s/3,n-t-s/2-l,a/2,0,Math.PI*2),e.arc(o+s/3,n-t-s/2-l,a/2,0,Math.PI*2),e.fill()},Ze=(e,o,n,t,s,i)=>{e.strokeStyle="black",e.lineWidth=2,e.beginPath(),e.arc(o,n-t+s/4-i,s/2,.1*Math.PI,.9*Math.PI),e.stroke()},Je=(e,o,n,t,s,i,r,l,a,u,c,d,m,C)=>{e.strokeStyle=u,e.lineWidth=a;const M=Math.sin(d*1e3)*Math.PI;for(let y=0;y<r;y++){const T=y/r*Math.PI*2,k=o+Math.cos(T)*(s/3),D=n-t/2+Math.sin(T)*(t/4)-C,I=2+Math.sin(d*100+y)*2,S=.1+Math.cos(d*200+y)*.05,X=k+Math.cos(T)*(l/2),Y=D+Math.sin(T)*(l/2)+Math.sin(c*I+M+y)*i*S,K=k+Math.cos(T)*l,Q=D+Math.sin(T)*l+Math.sin(c*I+Math.PI+M+y)*i*(S*1.5),J=k+Math.cos(T)*l,x=D+Math.sin(T)*l+Math.sin(c*I+M+y)*i*(S*2);m&&(e.save(),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.lineWidth=a*1.5,e.beginPath(),e.moveTo(k,D+g/2),e.bezierCurveTo(X,Y+g/2,K,Q+g/2,J,x+g/2),e.stroke(),e.restore()),e.beginPath(),e.moveTo(k,D),e.bezierCurveTo(X,Y,K,Q,J,x),e.stroke()}},ge=e=>{const{ctx:o,isoX:n,isoY:t,cellSize:s,baseHeight:i,widthFactor:r,heightAnimationFactor:l,bodyColor:a,headColor:u,eyeColor:c,pupilColor:d,hasTentacles:m=!1,tentacleColor:C="",tentacleCount:M=0,tentacleLength:y=0,tentacleWidth:T=0,isInvisible:k=!1,seed:D=0,castShadow:I=!0,isConfused:S=!1}=e,X=$e({isoX:n,isoY:t,cellSize:s,baseHeight:i,widthFactor:r,heightAnimationFactor:l}),{entityHeight:Y,entityWidth:K,shadowWidth:Q,shadowHeight:J,animFactor:x,shadowX:Ie,shadowY:je}=X,q=Re(D),he=S?Ne():{x:0,y:0};let U=n,H=t;U+=he.x,H+=he.y,I&&(o.fillStyle="rgba(0, 0, 0, 0.3)",o.beginPath(),o.ellipse(Ie+Q/2,je,Q/2,J/2,0,0,Math.PI*2),o.fill()),o.save(),k&&(o.globalAlpha=.5),m&&C&&M>0&&Je(o,U,H,Y,K,s,M,y,T,C,x,D,I,q),_e(o,U,H,Y,K,a,q);const ie=s*.25;return Ke(o,U,H,Y,ie,u,q),Qe(o,U,H,Y,ie,c,d,q),Ze(o,U,H,Y,ie,q),o.restore(),{bounceOffset:q}},xe=(e,o,n,t=!1,s=[],i=!1,r=!1,l=!1)=>{const{position:a,previousPosition:u,moveTimestamp:c,teleportTimestamp:d,isVanishing:m,isVictorious:C}=o,M=d&&Date.now()-d<_,y=M?Oe(a,u,d):se(a,u,c);let{x:T,y:k}=P(y.x,y.y);if(C){const S=Ve(Date.now()-c);k-=S}l&&s.some(X=>X.position.x===Math.round(y.x)&&X.position.y===Math.round(y.y))&&(k-=n*.5);const D={ctx:e,isoX:T,isoY:k,cellSize:n,baseHeight:.8,widthFactor:.6,heightAnimationFactor:.2,bodyColor:ze(l,i),headColor:eo(l,i),eyeColor:i?"red":"white",pupilColor:"black",isInvisible:t};m?e.globalAlpha=We(Date.now()-c):M&&(e.globalAlpha=Ye(Date.now()-d));const{bounceOffset:I}=ge(D);e.globalAlpha=1,C&&oo(e,T,k,n),l&&to(e,T,k,n),i&&no(e,T,k,n),r&&so(e,T,k,n,I),M&&io(e,T,k,n,Date.now()-d)},ze=(e,o)=>o?"#800080":e?"#FFA500":"#00FF00",eo=(e,o)=>o?"#9932CC":e?"#FFD700":"#32CD32",oo=(e,o,n,t)=>{e.save(),e.translate(o,n);for(let s=0;s<10;s++){const i=Math.PI*2*s/10,r=t*(.5+Math.sin(Date.now()/200+s)*.2),l=Math.cos(i)*r,a=Math.sin(i)*r;e.beginPath(),e.arc(l,a,t*.1,0,Math.PI*2),e.fillStyle=`hsl(${(Date.now()/20+s*36)%360}, 100%, 50%)`,e.fill()}e.restore()},to=(e,o,n,t)=>{e.save(),e.translate(o,n-t*.6);const s=t*.3;e.strokeStyle="#FFD700",e.lineWidth=2,e.beginPath(),e.moveTo(-s/2,-s/2),e.lineTo(-s/2,s/2),e.moveTo(s/2,-s/2),e.lineTo(s/2,s/2);for(let r=0;r<3;r++){const l=-s/2+(r+1)*(s/3);e.moveTo(-s/2,l),e.lineTo(s/2,l)}e.stroke(),e.shadowColor="#FFD700",e.shadowBlur=5,e.stroke();const i=Math.sin(Date.now()/200)*t*.05;e.translate(0,i),e.stroke(),e.restore()},no=(e,o,n,t)=>{e.save(),e.translate(o,n);const s=20,i=t*.8;for(let a=0;a<s;a++){const u=Math.PI*2*a/s+Date.now()/1e3,c=i*(.5+Math.sin(Date.now()/500+a)*.2),d=Math.cos(u)*c,m=Math.sin(u)*c;e.beginPath(),e.arc(d,m,t*.05,0,Math.PI*2),e.fillStyle=`rgba(128, 0, 128, ${.5+Math.sin(Date.now()/200+a)*.3})`,e.fill()}const r=t*.1,l=t*.15;e.beginPath(),e.arc(-l,-l,r,0,Math.PI*2),e.arc(l,-l,r,0,Math.PI*2),e.fillStyle="rgba(255, 0, 0, 0.8)",e.fill(),e.shadowColor="red",e.shadowBlur=10+Math.sin(Date.now()/200)*5,e.fill(),e.restore()},so=(e,o,n,t,s)=>{e.save(),e.translate(o-t/10,n-s);const i=t*.4,r=t*.1;e.fillStyle="#808080",e.beginPath(),e.rect(-r/2,-i,r,i),e.fill(),e.fillStyle="#FFD700",e.beginPath(),e.arc(0,-i,r/2,0,Math.PI*2),e.fill(),e.shadowColor="#FFD700",e.shadowBlur=5,e.fill();const l=(Math.sin(Date.now()/200)+1)*r/4;e.beginPath(),e.arc(0,-i,l,0,Math.PI*2),e.fillStyle="rgba(255, 255, 0, 0.8)",e.fill(),e.restore()},io=(e,o,n,t,s)=>{e.save(),e.translate(o,n);const i=t*1.5,r=s/_;if(r<.5){const l=r*2,a=i*l;e.beginPath(),e.arc(0,0,a,0,Math.PI*2);const u=e.createRadialGradient(0,0,0,0,0,a);u.addColorStop(0,"rgba(0, 255, 255, 0)"),u.addColorStop(.7,"rgba(0, 255, 255, 0.7)"),u.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=u,e.fill();for(let c=0;c<20;c++){const d=Math.random()*Math.PI*2,m=Math.random()*a,C=Math.cos(d)*m,M=Math.sin(d)*m,y=t*.05*(1-l);e.beginPath(),e.arc(C,M,y,0,Math.PI*2),e.fillStyle="rgba(0, 255, 255, "+(1-l)+")",e.fill()}}else{const l=(r-.5)*2,a=i*(1-l);e.beginPath(),e.arc(0,0,a,0,Math.PI*2);const u=e.createRadialGradient(0,0,0,0,0,a);u.addColorStop(0,"rgba(0, 255, 255, 0.7)"),u.addColorStop(.7,"rgba(0, 255, 255, 0.3)"),u.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=u,e.fill();for(let c=0;c<20;c++){const d=Math.random()*Math.PI*2,m=Math.random()*i,C=Math.cos(d)*m,M=Math.sin(d)*m,y=t*.05*l;e.beginPath(),e.arc(C,M,y,0,Math.PI*2),e.fillStyle="rgba(0, 255, 255, "+l+")",e.fill()}}e.restore()},ao=(e,o,n,t)=>{o.forEach(s=>{const i=se(s.position,s.previousPosition,s.moveTimestamp),{x:r,y:l}=P(i.x,i.y),a={ctx:e,isoX:r,isoY:l,cellSize:n,baseHeight:.4,widthFactor:.6,heightAnimationFactor:.1,bodyColor:t?"#00FF00":"#800080",headColor:t?"#32CD32":"#9932CC",eyeColor:"white",pupilColor:t?"black":"red",hasTentacles:!t,tentacleColor:"#600060",tentacleCount:6,tentacleLength:n*.5,tentacleWidth:4,seed:s.seed,castShadow:!0};ge(a),t&&ro(e,r,l,n)})},ro=(e,o,n,t)=>{e.save(),e.translate(o,n);const s=t*.2;e.fillStyle="#FFD700",e.beginPath(),e.moveTo(-s/2,-t*.3),e.lineTo(0,-t*.5),e.lineTo(s/2,-t*.3),e.closePath(),e.fill();for(let i=0;i<5;i++){const r=Math.random()*Math.PI*2,l=Math.random()*t*.4+t*.2,a=Math.cos(r)*l,u=Math.sin(r)*l;e.fillStyle=`rgba(255, 255, 0, ${.5+Math.random()*.5})`,e.beginPath(),e.arc(a,u,t*.05,0,Math.PI*2),e.fill()}e.restore()},B=g*.4,lo=(e,o,n)=>{o.forEach(t=>{const{x:s,y:i}=P(t.position.x,t.position.y);ce(e,s-w/4,i-g/4,w/2,g),e.fillStyle=uo(t.type),e.beginPath(),e.moveTo(s,i-B),e.lineTo(s+w/4,i-B/2),e.lineTo(s,i),e.lineTo(s-w/4,i-B/2),e.closePath(),e.fill(),e.beginPath(),e.arc(s,i-B,w/6,0,Math.PI*2),e.fill(),e.fillStyle="white",e.font=`bold ${n/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(po(t.type),s,i-B)})},co=(e,o,n)=>{o.forEach(t=>{const{x:s,y:i}=P(t.x,t.y);ce(e,s-w/2,i,w,g),e.fillStyle="brown",e.beginPath(),e.moveTo(s,i-B/2),e.lineTo(s+w/4,i-B/4),e.lineTo(s,i),e.lineTo(s-w/4,i-B/4),e.closePath(),e.fill(),e.beginPath(),e.arc(s,i-B/2,w/5,0,Math.PI*2),e.fill(),e.fillStyle="white",e.font=`bold ${n/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("M",s,i-B/2)})},ho=(e,o,n)=>{o.forEach(t=>{const{x:s,y:i}=P(t.position.x,t.position.y);ce(e,s-w/2,i,w,g),e.fillStyle="black",e.beginPath(),e.moveTo(s,i-B),e.lineTo(s+w/4,i-B/2),e.lineTo(s,i),e.lineTo(s-w/4,i-B/2),e.closePath(),e.fill(),e.strokeStyle="orange",e.lineWidth=2,e.beginPath(),e.moveTo(s,i-B),e.quadraticCurveTo(s+w/8,i-B*1.5,s+w/4,i-B*1.25),e.stroke(),e.fillStyle="white",e.font=`bold ${n/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.timer.toString(),s,i-B/2)})},uo=e=>{switch(e){case p.CapOfInvisibility:return"#8A2BE2";case p.ConfusedMonsters:return"#FFA500";case p.LandMine:return"#8B4513";case p.TimeBomb:return"#000000";case p.Crusher:return"#FF69B4";case p.Builder:return"#00FFFF";default:return"#FFFF00"}},po=e=>{switch(e){case p.CapOfInvisibility:return"I";case p.ConfusedMonsters:return"C";case p.LandMine:return"L";case p.TimeBomb:return"T";case p.Crusher:return"X";case p.Builder:return"B";default:return"?"}},fo=(e,o)=>{e.save(),e.globalAlpha=.7;for(const{position:n,startTime:t,duration:s}of o){if(Date.now()-t>s)continue;const i=P(n.x+.5,n.y+.5),r=P(n.x-1,n.y-1),l=P(n.x+1*2,n.y-1),a=P(n.x+1*2,n.y+1*2),u=P(n.x-1,n.y+1*2);e.fillStyle="#FF6600",e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(l.x,l.y),e.lineTo(a.x,a.y),e.lineTo(u.x,u.y),e.closePath(),e.fill();const c=32,d=w;for(let C=0;C<c;C++){const M=Math.PI*2/c*C,y=d*Math.random(),T=i.x+Math.cos(M)*y,k=i.y+Math.sin(M)*y/2;e.fillStyle=C%2===0?"#FF9933":"#FF3300",e.beginPath(),e.arc(T,k-Math.random()*g*Math.pow(C/c,.5),w/16,0,Math.PI*2),e.fill()}const m=e.createRadialGradient(i.x,i.y,0,i.x,i.y,w*2);m.addColorStop(0,"rgba(255, 255, 0, 0.8)"),m.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=m,e.beginPath(),e.ellipse(i.x,i.y,w,g,0,0,Math.PI*2),e.fill()}e.restore()},mo=(e,o,n,t)=>{e.save(),e.globalAlpha=n.duration===12?1:.5,e.font="bold 16px Arial";const{x:s,y:i}=P(o.x,o.y),r=e.measureText(ue(n.type)).width+20,l=90,a=15,u=10,c=s-r/2,d=i-t-l-a;e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.moveTo(c+u,d),e.lineTo(c+r-u,d),e.quadraticCurveTo(c+r,d,c+r,d+u),e.lineTo(c+r,d+l-u),e.quadraticCurveTo(c+r,d+l,c+r-u,d+l),e.lineTo(c+r/2+a,d+l),e.lineTo(c+r/2,d+l+a),e.lineTo(c+r/2-a,d+l),e.lineTo(c+u,d+l),e.quadraticCurveTo(c,d+l,c,d+l-u),e.lineTo(c,d+u),e.quadraticCurveTo(c,d,c+u,d),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=2,e.stroke(),e.fillStyle="white",e.textAlign="center",e.fillText(ue(n.type),c+r/2,d+30),e.font="14px Arial",e.fillText(`${n.duration} steps left`,c+r/2,d+55),yo(e,n.type,c+r-30,d+25,20),e.restore()},yo=(e,o,n,t,s)=>{switch(e.save(),e.strokeStyle="#FFD700",e.lineWidth=2,o){case p.Climber:bo(e,n,t,s);break;case p.Tsunami:go(e,n,t,s);break;case p.Monster:vo(e,n,t,s);break;case p.Slide:wo(e,n,t,s);break;case p.Sokoban:To(e,n,t,s);break;case p.Blaster:Mo(e,n,t,s);break;default:Co(e,n,t,s)}e.restore()},bo=(e,o,n,t)=>{e.beginPath(),e.moveTo(o,n),e.lineTo(o,n+t),e.moveTo(o+t,n),e.lineTo(o+t,n+t);for(let s=0;s<3;s++){const i=n+(s+1)*(t/3);e.moveTo(o,i),e.lineTo(o+t,i)}e.stroke()},go=(e,o,n,t)=>{e.beginPath(),e.moveTo(o,n+t),e.quadraticCurveTo(o+t/4,n,o+t/2,n+t/2),e.quadraticCurveTo(o+t*3/4,n+t,o+t,n),e.stroke(),e.fillStyle="rgba(0, 100, 255, 0.5)",e.fill()},vo=(e,o,n,t)=>{e.fillStyle="#800080",e.beginPath(),e.arc(o+t/2,n+t/2,t/3,0,Math.PI*2),e.fill(),e.fillStyle="red",e.beginPath(),e.arc(o+t/3,n+t/3,t/10,0,Math.PI*2),e.arc(o+t*2/3,n+t/3,t/10,0,Math.PI*2),e.fill()},wo=(e,o,n,t)=>{e.beginPath(),e.moveTo(o,n+t),e.quadraticCurveTo(o+t/2,n,o+t,n+t),e.stroke();for(let s=0;s<5;s++)e.fillStyle="rgba(200, 200, 255, 0.8)",e.beginPath(),e.arc(o+Math.random()*t,n+Math.random()*t,t/10,0,Math.PI*2),e.fill()},To=(e,o,n,t)=>{e.strokeRect(o+t/4,n+t/4,t/2,t/2),e.beginPath(),e.moveTo(o,n+t/2),e.lineTo(o+t,n+t/2),e.lineTo(o+t*3/4,n+t/4),e.moveTo(o+t,n+t/2),e.lineTo(o+t*3/4,n+t*3/4),e.stroke()},Mo=(e,o,n,t)=>{e.fillStyle="#808080",e.fillRect(o,n+t/3,t*2/3,t/3),e.beginPath(),e.arc(o+t*2/3,n+t/2,t/6,0,Math.PI*2),e.fill(),e.strokeStyle="red",e.setLineDash([t/10,t/20]),e.beginPath(),e.moveTo(o+t*2/3,n+t/2),e.lineTo(o+t,n+t/2),e.stroke(),e.setLineDash([])},Co=(e,o,n,t)=>{e.beginPath(),e.arc(o+t/2,n+t/2,t/3,0,Math.PI*2),e.stroke(),e.fillText("?",o+t/2,n+t/2+5)},Po=(e,o,n,t,s)=>{const i=Fe(Math.max(o,o),n,t,Date.now());e.strokeStyle="rgba(255, 255, 255, 0.7)",e.lineWidth=2;for(const r of i){const l=P(r.position.x,r.position.y),a={x:l.x+(Math.random()-.5)*s,y:l.y+(Math.random()-.5)*s};e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(a.x,a.y),e.stroke()}},ko=(e,o,n)=>{const{tsunamiLevel:t}=e,s=n*.8,i=[];for(let r=0;r<o;r++)for(let l=0;l<o;l++){const a=P(l,r),u=P(l+1,r),c=P(l,r+1),d=P(l+1,r+1),m=t/13*s,C=m+Math.sin(Date.now()/200+l*.5)*5,M=m+Math.sin(Date.now()/200+(l+1)*.5)*5;i.push({tsunamiLevel:t,grid:{x:l,y:r},isoTop:[{x:a.x,y:a.y-C},{x:c.x,y:c.y-M},{x:d.x,y:d.y-M},{x:u.x,y:u.y-C}],isoFront:r===o-1?[{x:c.x,y:c.y-M},{x:c.x,y:c.y},{x:d.x,y:d.y},{x:d.x,y:d.y-M}]:void 0,isoSide:l===o-1?[{x:d.x,y:d.y-M},{x:d.x,y:d.y},{x:u.x,y:u.y},{x:u.x,y:u.y-C}]:void 0})}return i},Io=(e,o)=>{e.save(),e.globalAlpha=.6,re(e,o.isoTop,`rgba(0, 100, 255, ${o.tsunamiLevel/13})`),o.isoFront&&re(e,o.isoFront,`rgba(0, 39, 98, ${o.tsunamiLevel/13})`),o.isoSide&&re(e,o.isoSide,`rgba(0, 63, 157, ${o.tsunamiLevel/13})`),e.restore()};function re(e,o,n){e.fillStyle=n,e.beginPath(),e.moveTo(o[0].x,o[0].y);for(let t=1;t<o.length;t++)e.lineTo(o[t].x,o[t].y);e.closePath(),e.fill()}const jo=(e,o,n)=>{const{x:t,y:s}=P(o.x,o.y),{x:i,y:r}=P(n.x,n.y);e.save(),e.strokeStyle="rgba(0, 255, 255, 0.5)",e.lineWidth=3,e.setLineDash([5,5]),e.beginPath(),e.moveTo(t,s),e.lineTo(i,r),e.stroke(),e.restore()},Do=(e,o,n)=>{if(Date.now()-o.shotTimestamp>o.duration)return;const t=se(o.endPosition,o.startPosition,o.shotTimestamp,o.duration),{x:s,y:i}=P(t.x,t.y);e.save(),e.shadowColor="rgba(255, 0, 0, 0.8)",e.shadowBlur=n*.2,e.fillStyle="red",e.strokeStyle="rgba(255, 100, 100, 0.8)",e.lineWidth=2;const r=n*.6,l=n*.1;switch(e.translate(s,i),o.direction){case b.Up:e.rotate(-Math.PI/4);break;case b.Down:e.rotate(3*Math.PI/4);break;case b.Left:e.rotate(-3*Math.PI/4);break;case b.Right:e.rotate(Math.PI/4);break}e.beginPath(),e.ellipse(0,0,r/2,l/2,0,0,2*Math.PI),e.fill(),e.stroke(),e.globalAlpha=.5;for(let a=1;a<=3;a++)e.globalAlpha*=.5,e.beginPath(),e.ellipse(-a*r*.2,0,r/(2+a),l/(2+a),0,0,2*Math.PI),e.fill();e.restore()},z=20,ve=(e,o,{gridSize:n,cellSize:t})=>{if(e.save(),o.explosions.length>0){const a=Math.min(o.explosions.filter(c=>Date.now()-c.startTime<c.duration).length*2,10),u=me(a);e.translate(u.x,u.y)}e.translate(e.canvas.width/2,100),e.clearRect(-e.canvas.width/2,-100,e.canvas.width,e.canvas.height),Ue(e,n),be(e,n,o);const s=o.tsunamiLevel>0?ko(o,n,t):[];Po(e,n,o.monsterSpawnSteps,o.player.moveTimestamp,t),o.isSliding&&jo(e,o.player.previousPosition,o.player.position);const i=[...s.map(a=>({position:a.grid,type:"wave",obj:a})),...o.obstacles.map(a=>({position:a.position,type:"obstacle",obj:a})),...o.bonuses.map(a=>({position:a.position,type:"bonus",obj:a})),...o.landMines.map(a=>({position:a,type:"landMine"})),...o.timeBombs.map(a=>({position:a.position,type:"timeBomb",obj:a})),...o.monsters.map(a=>({position:a.position,type:"monster",obj:a})),{position:o.player.position,type:"player",obj:o.player},{position:o.goal,type:"goal"},...o.explosions.map(a=>({position:a.position,type:"explosion",obj:a})),...o.blasterShots.map(a=>({position:se(a.endPosition,a.startPosition,a.shotTimestamp,a.duration),type:"blasterShot",obj:a}))],r=Ee(i);for(const a of r){const{type:u,position:c}=a;switch(u){case"wave":Io(e,a.obj);break;case"obstacle":qe(e,[a.obj],t);break;case"bonus":lo(e,[a.obj],t);break;case"landMine":co(e,[c],t);break;case"timeBomb":ho(e,[a.obj],t);break;case"monster":ao(e,[a.obj],t,O(o,p.Monster));break;case"player":xe(e,a.obj,t,o.activeBonuses.some(d=>d.type===p.CapOfInvisibility),o.obstacles,O(o,p.Monster),O(o,p.Blaster),O(o,p.Climber));break;case"goal":Xe(e,c,t);break;case"explosion":fo(e,[a.obj]);break;case"blasterShot":Do(e,a.obj,t);break}}const l=o.activeBonuses.find(a=>a.duration===13||[p.Builder,p.CapOfInvisibility,p.Crusher,p.Blaster].includes(a.type));l&&mo(e,o.player.position,l,t),e.restore()},ee=300,oe=200,$=5,So=Math.min(ee/$,oe/$)/2,Eo=()=>({player:{position:{x:2,y:2},previousPosition:{x:2,y:2},moveTimestamp:Date.now(),isVictorious:!1,isVanishing:!1},goal:{x:4,y:4},obstacles:[{position:{x:1,y:1},creationTime:Date.now(),isRaising:!1,isDestroying:!1},{position:{x:3,y:3},creationTime:Date.now(),isRaising:!1,isDestroying:!1}],monsters:[{position:{x:0,y:4},previousPosition:{x:0,y:4},moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1},{position:{x:4,y:0},previousPosition:{x:4,y:0},moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1}],steps:0,monsterSpawnSteps:0,bonuses:[{type:p.CapOfInvisibility,position:{x:1,y:3}},{type:p.ConfusedMonsters,position:{x:3,y:1}}],activeBonuses:[],explosions:[],timeBombs:[],landMines:[],score:0,gameEndingState:"none",tsunamiLevel:0,isSliding:!1,blasterShots:[]}),Lo=()=>{const e=L.useRef(null),o=L.useRef(Eo());return L.useEffect(()=>{const n=e.current;if(!n)return;const t=n.getContext("2d");if(!t)return;const s=()=>{t.clearRect(0,0,ee,oe),t.save(),t.scale(.8,.8),t.translate(ee*.1,oe*.1),be(t,$,o.current),ve(t,o.current,{gridSize:$,cellSize:So,initialMonsterCount:0,obstacleCount:0,initialBonusCount:0,levelName:"Preview",levelStory:"Preview"}),t.restore(),o.current.monsters.forEach(i=>{const r=i.position.x+(Math.random()-.5)*.1,l=i.position.y+(Math.random()-.5)*.1;i.previousPosition={...i.position},i.position={x:Math.max(0,Math.min($-1,r)),y:Math.max(0,Math.min($-1,l))},i.moveTimestamp=Date.now()}),requestAnimationFrame(s)};s()},[]),h.jsx("canvas",{ref:e,width:ee,height:oe})},Ao=({onStart:e,onInstructions:o})=>(L.useEffect(()=>{const n=t=>{t.key==="ArrowRight"&&e()};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}},[e]),h.jsxs("div",{className:"intro",children:[h.jsx("h1",{className:"game-title",children:"Monster Steps"}),h.jsxs("div",{className:"game-intro-responsive",children:[h.jsx("div",{className:"game-preview-container",children:h.jsx(Lo,{})}),h.jsxs("div",{className:"game-intro-column",children:[h.jsxs("div",{className:"intro-buttons",children:[h.jsx("button",{onClick:e,children:"Start Game"}),h.jsx("button",{onClick:o,children:"Instructions"})]}),h.jsx("p",{className:"intro-tip",children:"Press right arrow to start"})]})]}),h.jsxs("p",{className:"author-name",children:["Created by ",h.jsx("a",{href:"https://x.com/gtanczyk",children:"Grzegorz Tańczyk"})," | ",h.jsx("a",{href:"https://github.com/gamedevpl/www.gamedev.pl/tree/master/js13k2024",children:"Source code (GitHub)"})]})]})),Bo=({onBack:e})=>(L.useEffect(()=>{const o=n=>{n.key==="Escape"&&e()};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e]),h.jsxs("div",{className:"instructions",children:[h.jsx("h1",{children:"How to Play Monster Steps"}),h.jsxs("ul",{children:[h.jsx("li",{children:"Use arrow keys, touch controls, or mouse clicks to move your character"}),h.jsx("li",{children:"Avoid obstacles and monsters"}),h.jsx("li",{children:"Reach the goal (green square) to complete the level"}),h.jsx("li",{children:"New monsters appear every 13 steps"}),h.jsxs("li",{children:["Collect bonuses for special abilities:",h.jsxs("ul",{children:[h.jsx("li",{children:"Cap of Invisibility: Temporary invisibility to monsters"}),h.jsx("li",{children:"Confused Monsters: Monsters move randomly"}),h.jsx("li",{children:"Land Mine: Place a trap for monsters"}),h.jsx("li",{children:"Time Bomb: Delayed explosion"}),h.jsx("li",{children:"Crusher: Destroy nearby obstacles"}),h.jsx("li",{children:"Builder: Create new platforms"}),h.jsx("li",{children:"Climber: Climb on walls and obstacles"}),h.jsx("li",{children:"Teleport: Instantly move to another location on the grid"}),h.jsx("li",{children:"Tsunami: Water floods the grid, slowing movement. Climb to survive!"}),h.jsx("li",{children:"Monster: Transform into a monster and hunt other monsters"}),h.jsx("li",{children:"Slide: Glide across the grid until hitting an obstacle"}),h.jsx("li",{children:"Sokoban: Push obstacles to crush monsters or create paths"}),h.jsx("li",{children:"Blaster: Shoot in the direction you're moving to eliminate monsters"})]})]}),h.jsx("li",{children:"Complete all 13 levels to win"})]}),h.jsx("h2",{children:"New Bonus Details"}),h.jsxs("ul",{children:[h.jsxs("li",{children:["Tsunami:",h.jsxs("ul",{children:[h.jsx("li",{children:"Water gradually floods the grid over 13 steps"}),h.jsx("li",{children:"Movement becomes slower for both you and monsters"}),h.jsx("li",{children:"At the 13th step, everything not on an obstacle is eliminated"}),h.jsx("li",{children:"Use the Climber bonus to survive on obstacles"})]})]}),h.jsxs("li",{children:["Monster:",h.jsxs("ul",{children:[h.jsx("li",{children:"You become a monster for 13 steps"}),h.jsx("li",{children:'Monsters become vulnerable "players" during this time'}),h.jsx("li",{children:"Eliminate all monster-players to win, but be careful not to let them reach the goal!"})]})]}),h.jsxs("li",{children:["Slide:",h.jsxs("ul",{children:[h.jsx("li",{children:"Your movement becomes a slide in the chosen direction"}),h.jsx("li",{children:"You'll keep moving until you hit an obstacle or the edge of the grid"}),h.jsx("li",{children:"Use this to quickly traverse the grid, but plan your moves carefully!"})]})]}),h.jsxs("li",{children:["Sokoban:",h.jsxs("ul",{children:[h.jsx("li",{children:"Gain the ability to push obstacles"}),h.jsx("li",{children:"Use this to create new paths or crush monsters"}),h.jsx("li",{children:"Strategic obstacle placement can help block monster paths"})]})]}),h.jsxs("li",{children:["Blaster:",h.jsxs("ul",{children:[h.jsx("li",{children:"Equip a blaster that shoots in the direction you're moving"}),h.jsx("li",{children:"Eliminate monsters in your path"}),h.jsx("li",{children:"Use carefully to clear your way to the goal"})]})]})]}),h.jsx("h2",{children:"Tips"}),h.jsxs("ul",{children:[h.jsx("li",{children:"Plan your route to avoid getting trapped"}),h.jsx("li",{children:"Use obstacles and new bonuses strategically to outmaneuver monsters"}),h.jsx("li",{children:"Combine bonuses for powerful effects (e.g., Climber during Tsunami)"}),h.jsx("li",{children:"Think ahead when using Slide or Sokoban to avoid putting yourself in danger"}),h.jsx("li",{children:"Keep track of your steps to anticipate new monster spawns"})]}),h.jsx("button",{onClick:e,children:"Back to Menu"}),h.jsx("p",{className:"instructions-tip",children:"Press Escape to return to the main menu"})]})),A=(e,o)=>e.x===o.x&&e.y===o.y,F=(e,o)=>o.some(n=>A(n,e)),we=(e,o)=>Math.abs(e.x-o.x)+Math.abs(e.y-o.y),Oo=e=>{switch(e){case"ArrowUp":case"w":return b.Up;case"ArrowDown":case"s":return b.Down;case"ArrowLeft":case"a":return b.Left;case"ArrowRight":case"d":return b.Right;default:return null}},V=(e,o,n=1)=>{switch(o){case b.Up:return{...e,y:e.y-n};case b.Down:return{...e,y:e.y+n};case b.Left:return{...e,x:e.x-n};case b.Right:return{...e,x:e.x+n}}};function pe(e,o){switch(e){case b.Up:return o===-1?b.Left:b.Right;case b.Down:return o===-1?b.Left:b.Right;case b.Left:return o===-1?b.Down:b.Up;case b.Right:return o===-1?b.Up:b.Down}}const Ro=(e,o,{gridSize:n})=>!(!(e.x>=0&&e.x<n&&e.y>=0&&e.y<n)||F(e,o.obstacles.filter(i=>!i.isDestroying).map(({position:i})=>i))),te=(e,o,{gridSize:n})=>{if(!(e.x>=0&&e.x<n&&e.y>=0&&e.y<n))return!1;if(F(e,o.obstacles.filter(i=>!i.isDestroying).map(({position:i})=>i))&&!O(o,p.Climber)&&!O(o,p.Crusher)){if(o.activeBonuses.some(i=>i.type===p.Sokoban)){const i=Me(o.player.position,e),r=V(e,i);if(r.x>=0&&r.x<n&&r.y>=0&&r.y<n&&!F(r,o.obstacles.map(a=>a.position)))return!0}return!1}return!0},Te=(e,o)=>{const{player:n}=e,t=[b.Up,b.Down,b.Left,b.Right];return e.isSliding?t.map(s=>{let i=n.position;for(;te(V(i,s),e,o);)i=V(i,s);return{position:i,direction:s}}).filter(s=>!A(s.position,n.position)):t.map(s=>({position:V(n.position,s),direction:s})).filter(({position:s})=>te(s,e,o))};function Fo(e,o,n,t){return Te(n,t).find(s=>Go(e,o,Ce(t.gridSize,t.cellSize,s.direction)))}function Go(e,o,n){let t=!1;for(let s=0,i=n.length-1;s<n.length;i=s++){const r=n[s].x,l=n[s].y,a=n[i].x,u=n[i].y;l>o!=u>o&&e<(a-r)*(o-l)/(u-l)+r&&(t=!t)}return t}function Me(e,o){return o.x>e.x?b.Right:o.x<e.x?b.Left:o.y>e.y?b.Down:b.Up}const No=(e,o,n,t)=>{e.save(),e.translate(e.canvas.width/2,100),o.forEach(({direction:s})=>{const i=Ce(n,t,s);e.beginPath(),e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y),e.fillStyle="rgba(255, 255, 0, 0.5)",e.fill()}),e.restore()};function Ce(e,o,n){const t=e/3,s=V({x:e/2,y:e/2},n,e/1.5),i=V(s,pe(n,-1),t),r=V(s,pe(n,1),t),l=P(s.x,s.y),a=P(i.x,i.y),u=P(r.x,r.y),c=V(s,n,t),d=P(c.x,c.y),m=Math.atan2(d.y-l.y,d.x-l.x),C=Math.cos(m)*o,M=Math.sin(m)*o;return[{x:d.x+C,y:d.y+M},{x:a.x+C,y:a.y+M},{x:u.x+C,y:u.y+M}]}const Vo=(e,o,n,t,s,i,r)=>{const l=[];return e.map(a=>{let u;s?u=Yo(a.position,n,t,e):u=Xo(a.position,o,n,t,e);let c;return i||r?c=Wo(a.position,u[1]||a.position,n,t,e):c=u.length>1?u[1]:a.position,F(c,l)?c=a.position:l.push(c),{...a,previousPosition:a.position,position:c,moveTimestamp:Date.now(),path:u}})},Wo=(e,o,n,t,s)=>{const i=o.x-e.x,r=o.y-e.y,l={x:Math.max(0,Math.min(n-1,e.x-i)),y:Math.max(0,Math.min(n-1,e.y-r))};return!F(l,t.map(({position:a})=>a))&&!F(l,s.map(a=>a.position))?l:e},Yo=(e,o,n,t)=>{const s=[{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1}].filter(i=>i.x>=0&&i.x<o&&i.y>=0&&i.y<o&&!F(i,n.map(({position:r})=>r))&&!F(i,t.map(r=>r.position)));if(s.length>0){const i=Math.floor(Math.random()*s.length);return[e,s[i]]}return[e]},Xo=(e,o,n,t,s)=>{const i=[],r=[],l={position:e,g:0,h:0,f:0,parent:null};for(i.push(l);i.length>0;){let a=i[0],u=0;if(i.forEach((d,m)=>{d.f<a.f&&(a=d,u=m)}),i.splice(u,1),r.push(a),A(a.position,o))return qo(a);const c=Uo(a.position,n);for(const d of c){if(F(d,t.map(({position:T})=>T))||F(d,s.map(T=>T.position))||r.some(T=>A(T.position,d)))continue;const m=a.g+1,C=we(d,o),M=m+C,y=i.find(T=>A(T.position,d));y?m<y.g&&(y.g=m,y.f=M,y.parent=a):i.push({position:d,g:m,h:C,f:M,parent:a})}}return[e]},qo=e=>{const o=[];let n=e;for(;n!==null;)o.unshift(n.position),n=n.parent;return o},Uo=(e,o)=>[{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1}].filter(t=>t.x>=0&&t.x<o&&t.y>=0&&t.y<o),Ho=(e,o)=>o.some(n=>A(n.position,e)),$o=(e,o)=>{const n=[];return[e.filter(s=>{const i=o.find(r=>A(r,s.position));return i?(n.push({position:i,startTime:Date.now(),duration:1e3}),_o(o,i),!1):!0}),n]},_o=(e,o)=>{e.splice(e.indexOf(o),1)},Ko=(e,o)=>Math.abs(e.position.x-o.position.x)<=1&&Math.abs(e.position.y-o.position.y)<=1,le=(e,o)=>o.some(n=>Math.abs(e.x-n.position.x)<=1&&Math.abs(e.y-n.position.y)<=1),Qo=()=>{const e=G(),o=N(7,"The First Step","Avoid the lone monster and reach the goal in 13 steps!");return e.player=R(0,3),e.goal=E(6,3),e.monsters=[v(3,0)],e.obstacles=[f(5,2),f(5,3)],[e,o,o.levelStory]},Zo=()=>{const e=G(),o=N(8,"Now You See Me","Use the invisibility cap to sneak past the monsters!");return e.player=R(0,4),e.goal=E(7,4),e.monsters=[v(3,2),v(5,4)],e.bonuses=[j(2,4,p.CapOfInvisibility)],e.obstacles=[f(1,3),f(1,5),f(6,3),f(6,5)],[e,o,o.levelStory]},Jo=()=>{const e=G(),o=N(9,"Bridge the Gap","Build your way to victory!");return e.player=R(0,4),e.goal=E(8,4),e.monsters=[v(4,4)],e.bonuses=[j(2,4,p.Builder)],e.obstacles=[f(3,3),f(3,4),f(3,5),f(5,3),f(5,4),f(5,5)],[e,o,o.levelStory]},xo=()=>{const e=G(),o=N(9,"Crush and Rush","Clear the path with your crushing power!");e.player=R(0,4),e.goal=E(8,4),e.monsters=[v(4,4)],e.bonuses=[j(2,4,p.Crusher)],e.obstacles=[f(8,2),f(7,2),f(7,3),f(7,4),f(7,5),f(8,5)];for(let n=2;n<7;n++)e.obstacles.push(f(n,3)),e.obstacles.push(f(n-1,5));return[e,o,o.levelStory]},zo=()=>{const e=G(),o=N(10,"Tick Tock Boom","Time your bomb perfectly to clear the way!");e.player=R(0,5),e.goal=E(9,5),e.monsters=[v(3,5)],e.bonuses=[j(9,3,p.TimeBomb)],e.obstacles=[f(9,4),f(8,4),f(8,5),f(8,6),f(9,6),f(4,1),f(5,1),f(6,1),f(7,1),f(8,1)];for(let n=2;n<8;n++)e.obstacles.push(f(n,4)),e.obstacles.push(f(n,6)),e.obstacles.push(f(n-2,8));return[e,o,o.levelStory]},et=()=>{const e=G(),o=N(10,"Minesweeper's Revenge","Plant a surprise for your pursuers!");e.player=R(0,5),e.goal=E(9,5),e.monsters=[v(6,5),v(4,8),v(8,8)],e.bonuses=[j(2,5,p.LandMine)];for(let n=4;n<9;n++)n!==6&&(e.obstacles.push(f(n,4)),e.obstacles.push(f(n,6)));return[e,o,o.levelStory]},ot=()=>{const e=G(),o=N(11,"Monsters' Mayhem","Confuse them all and make your escape!");e.player=R(0,5),e.goal=E(10,5),e.monsters=[v(3,4),v(3,6),v(6,4),v(6,6),v(9,5)],e.bonuses=[j(2,5,p.ConfusedMonsters)];for(let n=4;n<8;n++)e.obstacles.push(f(n,3)),e.obstacles.push(f(n,7));return[e,o,o.levelStory]},tt=()=>{const e=G(),o=N(12,"Tunnel Vision","Build a path and set a trap!");e.player=R(0,6),e.goal=E(11,6),e.monsters=[v(3,10),v(8,8)],e.bonuses=[j(2,6,p.Builder),j(2,2,p.LandMine)];for(let n=3;n<10;n++)n!==6&&(e.obstacles.push(f(n,5)),e.obstacles.push(f(n,7)));return[e,o,o.levelStory]},nt=()=>{const e=G(),o=N(12,"Ghost Bomber","Vanish, plant, and detonate!");e.player=R(0,6),e.goal=E(11,6),e.monsters=[v(3,6),v(7,6),v(10,6)],e.bonuses=[j(2,6,p.CapOfInvisibility),j(5,6,p.TimeBomb)];for(let n=4;n<11;n++)n!==5&&n!==8&&(e.obstacles.push(f(n,5)),e.obstacles.push(f(n,7)));return[e,o,o.levelStory]},st=()=>{const e=G(),o=N(13,"Crush, Confuse, Conquer","A symphony of chaos!");e.player=R(0,6),e.goal=E(12,6),e.monsters=[v(4,6),v(8,6),v(11,6)],e.bonuses=[j(2,6,p.Crusher),j(6,6,p.ConfusedMonsters)];for(let n=3;n<12;n++)n!==6&&n!==9&&(e.obstacles.push(f(n,5)),e.obstacles.push(f(n,7)));return[e,o,o.levelStory]},it=()=>{const e=G(),o=N(14,"The Triple Threat","Build, Bomb, and Vanish!");e.player=R(0,7),e.goal=E(13,7),e.monsters=[v(3,7),v(6,7),v(9,7),v(12,7)],e.bonuses=[j(2,7,p.Builder),j(5,7,p.TimeBomb),j(8,7,p.CapOfInvisibility)];for(let n=4;n<13;n++)n!==5&&n!==8&&n!==11&&(e.obstacles.push(f(n,6)),e.obstacles.push(f(n,8)));return[e,o,o.levelStory]},at=()=>{const e=G(),o=N(15,"The Gauntlet","Use everything you've learned!");e.player=R(0,7),e.goal=E(14,7),e.monsters=[v(3,7),v(6,7),v(9,7),v(12,7),v(7,3),v(7,11)],e.bonuses=[j(2,7,p.LandMine),j(2,8,p.CapOfInvisibility),j(5,7,p.Crusher),j(8,7,p.ConfusedMonsters),j(1,6,p.Builder),j(2,6,p.TimeBomb)];for(let n=4;n<14;n++)n!==5&&n!==8&&n!==11&&(e.obstacles.push(f(n,6)),e.obstacles.push(f(n,8)));for(let n=4;n<11;n++)n!==7&&(e.obstacles.push(f(6,n)),e.obstacles.push(f(8,n)));return[e,o,o.levelStory]},rt=()=>{const e=G(),o=N(16,"The Final Countdown","Can you outsmart them all?");e.player=R(0,8),e.goal=E(15,8),e.monsters=[v(5,8),v(6,8),v(9,8),v(12,8),v(8,3),v(8,13),v(15,3),v(15,13)],e.bonuses=[j(2,8,p.CapOfInvisibility),j(5,8,p.TimeBomb),j(8,8,p.LandMine),j(11,1,p.Crusher),j(14,14,p.ConfusedMonsters)];for(let n=4;n<15;n++)n!==5&&n!==8&&n!==11&&n!==14&&(e.obstacles.push(f(n,7)),e.obstacles.push(f(n,9)));for(let n=4;n<13;n++)n!==8&&(e.obstacles.push(f(7,n)),e.obstacles.push(f(9,n)));return e.obstacles.push(f(14,8)),[e,o,o.levelStory]},E=(e,o)=>({x:e,y:o}),j=(e,o,n)=>({position:E(e,o),type:n}),v=(e,o)=>({position:E(e,o),previousPosition:E(e,o),moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1}),R=(e,o)=>({position:E(e,o),previousPosition:E(e,o),moveTimestamp:Date.now(),isVictorious:!1,isVanishing:!1}),f=(e,o)=>({position:E(e,o),creationTime:Date.now(),isRaising:!1,isDestroying:!1}),G=()=>({player:R(0,0),goal:E(0,0),obstacles:[],monsters:[],steps:0,monsterSpawnSteps:0,bonuses:[],activeBonuses:[],explosions:[],timeBombs:[],landMines:[],score:0,gameEndingState:"none",tsunamiLevel:0,isSliding:!1,blasterShots:[]}),lt=40,N=(e,o,n)=>({gridSize:e,cellSize:lt,initialMonsterCount:0,obstacleCount:0,initialBonusCount:0,levelName:o,levelStory:n}),ct={1:Qo,2:Zo,3:Jo,4:xo,5:zo,6:et,7:ot,8:tt,9:nt,10:st,11:it,12:at,13:rt},ht=e=>{if(e<1||e>13)throw new Error(`Invalid level number: ${e}`);return ct[e]()};class ut{constructor(){ae(this,"audioContext");ae(this,"masterVolume",.025);this.audioContext=new(window.AudioContext||window.webkitAudioContext)}createOscillator(o,n,t){const s=this.audioContext.createOscillator();return s.type=n,s.frequency.setValueAtTime(o,this.audioContext.currentTime),s.start(),s.stop(this.audioContext.currentTime+t),s}createGain(o,n,t=1){const s=this.audioContext.createGain(),i=t*this.masterVolume;return s.gain.setValueAtTime(0,this.audioContext.currentTime),s.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+o),s.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+o+n),s}playStep(){const o=this.createOscillator(200,"square",.1),n=this.createGain(.01,.09);o.connect(n).connect(this.audioContext.destination)}playElectricalDischarge(){const o=this.createOscillator(800,"sawtooth",.2),n=this.createGain(.01,.19);o.frequency.linearRampToValueAtTime(200,this.audioContext.currentTime+.2),o.connect(n).connect(this.audioContext.destination)}playBonusCollected(){const o=this.createOscillator(600,"sine",.15),n=this.createGain(.01,.14);o.frequency.linearRampToValueAtTime(800,this.audioContext.currentTime+.15),o.connect(n).connect(this.audioContext.destination)}playExplosion(){const o=this.audioContext.createBufferSource(),n=this.audioContext.sampleRate*.5,t=this.audioContext.createBuffer(1,n,this.audioContext.sampleRate),s=t.getChannelData(0);for(let r=0;r<n;r++)s[r]=Math.random()*2-1;o.buffer=t;const i=this.createGain(.01,.49,.5);o.connect(i).connect(this.audioContext.destination),o.start()}playStateTransition(){const o=this.createOscillator(300,"triangle",.3),n=this.createGain(.05,.25);o.frequency.linearRampToValueAtTime(600,this.audioContext.currentTime+.3),o.connect(n).connect(this.audioContext.destination)}playGameOver(){const o=this.createOscillator(440,"sine",1),n=this.createGain(.01,.99);o.frequency.linearRampToValueAtTime(220,this.audioContext.currentTime+1),o.connect(n).connect(this.audioContext.destination)}playLevelComplete(){const o=this.createOscillator(440,"sine",.5),n=this.createOscillator(550,"sine",.5),t=this.createGain(.01,.49),s=this.createGain(.01,.49);o.connect(t).connect(this.audioContext.destination),n.connect(s).connect(this.audioContext.destination),setTimeout(()=>{const i=this.createOscillator(660,"sine",.5),r=this.createGain(.01,.49);i.connect(r).connect(this.audioContext.destination)},250)}playMonsterSpawn(){const o=this.createOscillator(100,"sawtooth",.3),n=this.createGain(.01,.29);o.frequency.exponentialRampToValueAtTime(300,this.audioContext.currentTime+.3),o.connect(n).connect(this.audioContext.destination)}playTeleport(){const o=this.createOscillator(100,"sine",.5),n=this.createOscillator(200,"sine",.5),t=this.createGain(.01,.49),s=this.createGain(.01,.49);o.frequency.exponentialRampToValueAtTime(1e3,this.audioContext.currentTime+.25),n.frequency.exponentialRampToValueAtTime(2e3,this.audioContext.currentTime+.25),o.connect(t).connect(this.audioContext.destination),n.connect(s).connect(this.audioContext.destination),setTimeout(()=>{const i=this.createOscillator(2e3,"sine",.2),r=this.createGain(.01,.19);i.frequency.exponentialRampToValueAtTime(4e3,this.audioContext.currentTime+.2),i.connect(r).connect(this.audioContext.destination)},100)}playBlasterSound(){const n=this.audioContext.createOscillator();n.type="sawtooth",n.frequency.setValueAtTime(1e3,this.audioContext.currentTime),n.frequency.exponentialRampToValueAtTime(500,this.audioContext.currentTime+.15);const t=this.audioContext.createGain();t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(this.masterVolume,this.audioContext.currentTime+.01),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15);const s=this.audioContext.createBuffer(1,this.audioContext.sampleRate*.15,this.audioContext.sampleRate),i=s.getChannelData(0);for(let a=0;a<s.length;a++)i[a]=Math.random()*2-1;const r=this.audioContext.createBufferSource();r.buffer=s;const l=this.audioContext.createGain();l.gain.setValueAtTime(this.masterVolume*.2,this.audioContext.currentTime),l.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15),n.connect(t).connect(this.audioContext.destination),r.connect(l).connect(this.audioContext.destination),n.start(),r.start(),n.stop(this.audioContext.currentTime+.15),r.stop(this.audioContext.currentTime+.15)}}const W=new ut,dt=(e,o,n)=>{if(Z(o))return o;const t=Oo(e.key);return t!==null?Pe(t,o,n):{...o}},Pe=(e,o,n)=>{if(Z(o))return o;const t={...o},s=t.player.position;let i=V(t.player.position,e);if(t.isSliding&&(i=ke(t,e,n)),t.activeBonuses.some(r=>r.type===p.Sokoban)&&Tt(t,s,i,n.gridSize),t.obstacles=o.obstacles.filter(r=>!r.isDestroying||Date.now()-r.creationTime<ye),O(t,p.Crusher)&&o.obstacles.find(r=>A(i,r.position))&&(t.obstacles=o.obstacles.map(r=>A(i,r.position)?{...r,isDestroying:!0,creationTime:Date.now()}:r),W.playElectricalDischarge()),te(i,t,n)){if(W.playStep(),t.player.position=i,Date.now()-t.player.moveTimestamp>fe&&(t.player.previousPosition=s,t.player.moveTimestamp=Date.now()),t.steps++,t.monsterSpawnSteps++,t.tsunamiLevel>0&&vt(t),A(i,t.goal))return t.gameEndingState="levelComplete",bt(t),t.score+=ft(t),t;const r=t.bonuses.find(c=>A(c.position,i));if(r&&(W.playBonusCollected(),t.bonuses=t.bonuses.filter(c=>!A(c.position,i)),pt(t,r.type)),(r==null?void 0:r.type)===p.Teleport&&gt(t,r.position),t.monsterSpawnSteps>=13&&(mt(t,n),t.monsterSpawnSteps=0,W.playMonsterSpawn()),t.monsters=Vo(t.monsters,t.player.position,n.gridSize,t.obstacles,O(t,p.CapOfInvisibility),O(t,p.ConfusedMonsters),O(t,p.Monster)),O(t,p.Monster))wt(t);else if(Ho(t.player.position,t.monsters))return t.gameEndingState="gameOver",ne(t),t;O(t,p.Blaster)&&Mt(t,e,n),t.blasterShots=t.blasterShots.filter(c=>Date.now()-c.shotTimestamp<c.duration);const[l,a]=$o(t.monsters,t.landMines);t.monsters=l,t.explosions=a,t.timeBombs=t.timeBombs.map(c=>({...c,timer:c.timer-1}));const u=t.timeBombs.filter(c=>c.timer===0);if((u.length>0||a.length>0)&&W.playExplosion(),t.explosions=[...t.explosions,...u.map(c=>({position:c.position,startTime:Date.now(),duration:1e3}))],t.timeBombs=t.timeBombs.filter(c=>c.timer>0),t.monsters=t.monsters.filter(c=>!t.explosions.some(d=>Ko(c,d))),t.obstacles=t.obstacles.map(c=>le(c.position,t.explosions)?{...c,isDestroying:!0,creationTime:Date.now()}:c),t.bonuses=t.bonuses.filter(c=>!le(c.position,t.explosions)),le(t.player.position,t.explosions))return t.gameEndingState="gameOver",ne(t),t;if(t.activeBonuses=t.activeBonuses.map(c=>({...c,duration:c.duration-1})).filter(c=>c.duration>0),O(t,p.Builder)){const c={position:s,creationTime:Date.now(),isRaising:!0,isDestroying:!1};F(c.position,t.obstacles.map(({position:d})=>d))||(t.obstacles.push(c),W.playElectricalDischarge())}}return t},pt=(e,o)=>{const n={type:o,duration:13};switch(e.activeBonuses.push(n),o){case p.CapOfInvisibility:break;case p.ConfusedMonsters:break;case p.LandMine:e.landMines.push({...e.player.position});break;case p.TimeBomb:e.timeBombs.push({position:e.player.position,timer:13,shakeIntensity:0});break;case p.Crusher:break;case p.Builder:break;case p.Climber:break;case p.Teleport:break;case p.Tsunami:e.tsunamiLevel=1;break;case p.Monster:break;case p.Slide:e.isSliding=!0;break;case p.Sokoban:break;case p.Blaster:break}},ft=e=>100-e.steps+e.monsters.length*10,mt=(e,{gridSize:o})=>{let n;do n=yt(o,o);while(A(n,e.player.position)||A(n,e.goal)||F(n,e.obstacles.filter(t=>!t.isDestroying).map(({position:t})=>t))||F(n,e.monsters.map(t=>t.position)));e.monsters.push({position:n,previousPosition:n,moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1})},yt=(e,o)=>({x:Math.floor(Math.random()*e),y:Math.floor(Math.random()*o)}),Z=e=>e.gameEndingState!=="none",ne=e=>{e.player.isVanishing=!0,W.playGameOver()},bt=e=>{e.player.isVictorious=!0,W.playLevelComplete()},gt=(e,o)=>{const n=e.bonuses.find(t=>t.type===p.Teleport&&!A(t.position,o));n&&(e.player.previousPosition=e.player.position,e.player.position=n.position,e.player.teleportTimestamp=Date.now(),W.playTeleport())},vt=e=>{e.tsunamiLevel++,e.tsunamiLevel>=13&&(O(e,p.Climber)||(e.gameEndingState="gameOver",ne(e)),e.monsters=[],e.tsunamiLevel=0)},wt=e=>{const o=e.monsters.find(n=>A(e.player.position,n.position));o&&(e.monsters=e.monsters.filter(n=>n!==o),e.monsters.length===0&&(e.gameEndingState="gameOver",ne(e)))},ke=(e,o,n)=>{let t=e.player.position;for(;te(V(t,o),e,n);)t=V(t,o);return t},Tt=(e,o,n,t)=>{const s=e.obstacles.find(i=>A(i.position,n));if(s){const i=V(s.position,Me(o,n));if(Ro(i,e,{gridSize:t})){s.position=i;const r=e.monsters.find(l=>A(l.position,i));r&&(e.monsters=e.monsters.filter(l=>l!==r))}else n=o}},Mt=(e,o,n)=>{const t=e.player.position,s=ke(e,o,n),i={startPosition:t,endPosition:s,direction:o,shotTimestamp:Date.now(),duration:Le*(we(t,s)+1)};e.blasterShots.push(i),W.playBlasterSound(),e.monsters=e.monsters.filter(r=>!Ct(r.position,t,s,o))},Ct=(e,o,n,t)=>{switch(t){case b.Up:case b.Down:return e.x===o.x&&(t===b.Up&&e.y<=o.y&&e.y>=n.y||t===b.Down&&e.y>=o.y&&e.y<=n.y);case b.Left:case b.Right:return e.y===o.y&&(t===b.Left&&e.x<=o.x&&e.x>=n.x||t===b.Right&&e.x>=o.x&&e.x<=n.x)}},Pt=({level:e,score:o,steps:n})=>h.jsxs("div",{className:"hud",children:[h.jsxs("div",{children:["Level: ",e]}),h.jsxs("div",{children:["Score: ",o]}),h.jsxs("div",{children:["Steps: ",n]})]}),kt=13,It=2e3,jt=({level:e,score:o,onGameOver:n,onLevelComplete:t,onGameComplete:s,updateScore:i,updateSteps:r})=>{const l=L.useRef(null),[[a,u,c],d]=L.useState(()=>ht(e)),[m,C]=L.useState(!0),M=y=>{d([y,u,c]),i(y.score),r(y.steps)};return L.useEffect(()=>{a.gameEndingState!=="none"&&setTimeout(()=>{a.gameEndingState==="levelComplete"&&(e===kt?s():t()),a.gameEndingState==="gameOver"&&n()},It)},[a.gameEndingState]),L.useEffect(()=>{if(!a||!u)return;const y=l.current;let T;if(y){const k=(u.gridSize+u.gridSize)*u.cellSize,D=(u.gridSize+u.gridSize)*u.cellSize/2;y.width=k,y.height=D+100;const I=y.getContext("2d");if(I){const S=()=>{ve(I,a,u),Z(a)||No(I,Te(a,u),u.gridSize,u.cellSize),T=requestAnimationFrame(S)};S()}}return()=>{T!==null&&cancelAnimationFrame(T)}},[a,u,m]),L.useEffect(()=>{if(!a||!u)return;const y=k=>{if(m){C(!1);return}if(!Z(a)){const D=dt(k,a,u);M(D)}},T=k=>{if(m){C(!1);return}if(Z(a))return;const D=l.current;if(!D)return;const I=D.getBoundingClientRect(),S=Fo((k.clientX-I.left)*(D.width/I.width)-D.width/2,(k.clientY-I.top)*(D.height/I.height)-100,a,u);S&&M(Pe(S.direction,a,u))};return window.addEventListener("click",T),window.addEventListener("keydown",y),()=>{window.removeEventListener("click",T),window.removeEventListener("keydown",y)}},[a,u,m,n,t,i,r]),m?h.jsxs("div",{className:"level-story",children:[h.jsxs("h2",{children:["Level ",e]}),h.jsx("p",{children:c}),h.jsx("p",{children:"Press any key to start..."})]}):h.jsxs("div",{className:"gameplay",children:[h.jsx(Pt,{level:e,score:o,steps:(a==null?void 0:a.monsterSpawnSteps)||0}),h.jsx("div",{className:"canvas-container",children:h.jsx("canvas",{ref:l})})]})},Dt=({score:e,steps:o,onTryAgain:n,onQuit:t})=>h.jsxs("div",{className:"game-over",children:[h.jsx("h1",{children:"Game Over"}),h.jsxs("p",{children:["Your score: ",e]}),h.jsxs("p",{children:["Steps taken: ",o]}),h.jsx("button",{onClick:n,children:"Try Again"}),h.jsx("button",{onClick:t,children:"Quit"})]}),St=({level:e,onNextLevel:o,onQuit:n})=>h.jsxs("div",{className:"level-complete",children:[h.jsxs("h1",{children:["Level ",e," Complete!"]}),h.jsx("p",{children:"Congratulations! You've completed the level."}),h.jsx("button",{onClick:o,children:"Next Level"}),h.jsx("button",{onClick:n,children:"Quit"})]});function Bt(){const[e,o]=L.useState(0),[n,t]=L.useState(parseInt(document.location.hash.split("level")[1]??"1")),[s,i]=L.useState(0),[r,l]=L.useState(0),a=L.useCallback(()=>{o(2)},[]),u=()=>{o(1)},c=()=>{t(1),i(0),l(0),o(2)},d=()=>{o(2)},m=()=>{o(0)},C=()=>{o(3)},M=()=>{t(n+1),o(4)},y=L.useCallback(()=>{o(2)},[]),T=()=>{W.playLevelComplete(),o(5)},k=I=>i(I),D=I=>l(I);return L.useEffect(()=>{const I=S=>{S.key==="ArrowRight"?e===0?a():e===4?y():e===3?d():e===5&&c():S.key==="Escape"&&(e===1||e===3||e===5)&&m()};return window.addEventListener("keydown",I),()=>{window.removeEventListener("keydown",I)}},[e,a,y]),h.jsxs("div",{className:"game-container",children:[e===0&&h.jsx(Ao,{onStart:a,onInstructions:u}),e===1&&h.jsx(Bo,{onBack:m}),e===2&&h.jsx(jt,{level:n,score:s,onGameOver:C,onLevelComplete:M,onGameComplete:T,updateScore:k,updateSteps:D}),e===3&&h.jsx(Dt,{score:s,steps:r,onTryAgain:d,onQuit:m}),e===4&&h.jsx(St,{level:n,onNextLevel:y,onQuit:m}),e===5&&h.jsx(Et,{score:s,steps:r,onPlayAgain:c,onQuit:m})]})}function Et({score:e,steps:o,onPlayAgain:n,onQuit:t}){return h.jsxs("div",{className:"game-complete intro",children:[h.jsx("h1",{className:"game-title",children:"Monster Steps"}),h.jsx("h2",{className:"game-complete-subtitle",children:"Congratulations!"}),h.jsxs("div",{className:"game-complete-stats",children:[h.jsxs("p",{children:["Final Score: ",e]}),h.jsxs("p",{children:["Total Steps: ",o]})]}),h.jsxs("div",{className:"intro-buttons",children:[h.jsx("button",{onClick:n,children:"Play Again"}),h.jsx("button",{onClick:t,children:"Quit"})]}),h.jsx("p",{className:"intro-tip",children:"Press right arrow to play again"})]})}export{Bt as MonsterStepsApp};
