var Ae=Object.defineProperty;var Oe=(e,o,s)=>o in e?Ae(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s;var le=(e,o,s)=>Oe(e,typeof o!="symbol"?o+"":o,s);import{r as A,j as h}from"./index-BxeKkRbR.js";var d=(e=>(e[e.CapOfInvisibility=0]="CapOfInvisibility",e[e.ConfusedMonsters=1]="ConfusedMonsters",e[e.LandMine=2]="LandMine",e[e.TimeBomb=3]="TimeBomb",e[e.Crusher=4]="Crusher",e[e.Builder=5]="Builder",e[e.Climber=6]="Climber",e[e.Teleport=7]="Teleport",e[e.Tsunami=8]="Tsunami",e[e.Monster=9]="Monster",e[e.Slide=10]="Slide",e[e.Sokoban=11]="Sokoban",e[e.Blaster=12]="Blaster",e))(d||{}),b=(e=>(e[e.Up=0]="Up",e[e.Down=1]="Down",e[e.Left=2]="Left",e[e.Right=3]="Right",e))(b||{});function fe(e){switch(e){case 0:return"Now you see me, now you don't!";case 1:return"Monsters are dizzy!";case 2:return"Boom goes the floor!";case 3:return"Tick tock, boom o'clock!";case 4:return"Hulk smash!";case 5:return"Bob the Builder mode: ON";case 6:return"Walk on walls like a pro!";case 7:return"Beam me up, Scotty!";case 8:return"Water, water everywhere!";case 9:return"Tables have turned!";case 10:return"Slip and slide!";case 11:return"Push it real good!";case 12:return"Pew pew pew!";default:return"Mystery power activated!"}}function B(e,o){return e.activeBonuses.some(s=>s.type===o)}const w=60,g=30;function C(e,o){return{x:(e-o)*w/2,y:(e+o)*g/2}}function ye(e){switch(e){case"wave":case"obstacle":return 3;case"bonus":case"landMine":case"timeBomb":return 2;case"goal":return 2;case"monster":return 4;case"player":return 5;case"explosion":return 6;default:return 0}}function Re(e){return e.sort((o,s)=>{const t=o.position.x+o.position.y,n=s.position.x+s.position.y;if(t!==n)return t-n;const i=ye(o.type),r=ye(s.type);return i!==r?i-r:0})}const ge=250,K=500,Fe=50,Ge=()=>Math.cos(Date.now()/1e3*Math.PI),Ne=e=>.5+(e/2+1)/2,ae=(e,o,s,t=ge)=>{const n=Math.min(Date.now()-s,t)/t;return{x:o.x+(e.x-o.x)*n,y:o.y+(e.y-o.y)*n}},Ve=(e,o,s)=>Date.now()-s<K/2?o:e,We=e=>{const o=Date.now()/1e3;return Math.sin(o*2+e)*3},we=e=>{const o=Date.now()/50;return{x:Math.sin(o)*e,y:Math.cos(o*1.5)*e}},Ue=(e,o,s,t)=>{const n=[],i=t-s,r=1e3;if(i>r)return n;const l=o/13,a=i/r,u=Math.sqrt(l*(1-a)),c=Math.floor(u*10);for(let m=0;m<c;m++)n.push({position:{x:Math.random()*e,y:Math.random()*e},intensity:10*u,duration:10*u});return n},ve=500,Ye=(e,o,s)=>{const t=Math.min((Date.now()-e)/ve,1);return s?1-t:o?t:1},_e=()=>we(2),qe=e=>{const s=e%1e3/1e3;return Math.sin(s*Math.PI)*20},Xe=e=>Math.max(0,1-e/2e3),$e=e=>e<K/2?Math.max(0,1-e/2/(K/2)*2):Math.min(1,(e/2/(K/2)-.5)*2),He=(e,o,s)=>{const{x:t,y:n}=C(o.x,o.y);e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.ellipse(t,n+g/2,w/2,g/4,0,0,Math.PI*2),e.fill(),e.fillStyle="#FFD700",e.beginPath(),e.moveTo(t,n),e.lineTo(t+w/2,n+g/2),e.lineTo(t,n+g),e.lineTo(t-w/2,n+g/2),e.closePath(),e.fill(),e.fillStyle="#000000",e.font=`${s/2}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("★",t,n+g/2)},Ke=(e,o,s)=>{o.forEach(t=>{const{position:n,creationTime:i,isRaising:r,isDestroying:l}=t,{x:a,y:u}=C(n.x,n.y),c=Ye(i,r,l)*s*.8;if(c===0)return;const m=c/s*.2,{x:f,y:M}=C(n.x,n.y+1),{x:T,y}=C(n.x+1,n.y+1),{x:v,y:k}=C(n.x+1,n.y+1+m),{x:j,y:I}=C(n.x,n.y+1+m);e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.moveTo(f,M),e.lineTo(T,y),e.lineTo(v,k),e.lineTo(j,I),e.closePath(),e.fill();const E=l?c/(s*.8):1;e.fillStyle=`rgba(142, 36, 170, ${E})`,e.beginPath(),e.moveTo(a,u-c),e.lineTo(a+w/2,u+g/2-c),e.lineTo(a,u+g-c),e.lineTo(a-w/2,u+g/2-c),e.closePath(),e.fill(),e.fillStyle=`rgba(106, 27, 154, ${E})`,e.beginPath(),e.moveTo(a+w/2,u+g/2-c),e.lineTo(a+w/2,u+g/2),e.lineTo(a,u+g),e.lineTo(a,u+g-c),e.closePath(),e.fill(),e.fillStyle=`rgba(74, 20, 140, ${E})`,e.beginPath(),e.moveTo(a-w/2,u+g/2-c),e.lineTo(a-w/2,u+g/2),e.lineTo(a,u+g),e.lineTo(a,u+g-c),e.closePath(),e.fill()})},Qe=(e,o)=>{const s=C(0,0),t=C(o,0),n=C(0,o),i=C(o,o);e.fillStyle="#c2b280",e.beginPath(),e.moveTo(s.x,s.y),e.lineTo(t.x,t.y),e.lineTo(i.x,i.y),e.lineTo(n.x,n.y),e.closePath(),e.fill(),e.fillStyle="#5d4037",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x,i.y+oe),e.lineTo(n.x,n.y+oe),e.lineTo(n.x,n.y),e.closePath(),e.fill(),e.fillStyle="#8d6e63",e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(i.x,i.y+oe),e.lineTo(t.x,t.y+oe),e.lineTo(t.x,t.y),e.closePath(),e.fill()},Te=(e,o,s)=>{e.strokeStyle="#4a4a4a",e.lineWidth=1;for(let t=0;t<=o;t++)for(let n=0;n<=o;n++){const{x:i,y:r}=C(n,t);n<o&&(e.beginPath(),e.moveTo(i,r),e.lineTo(i+w/2,r+g/2),e.stroke()),t<o&&(e.beginPath(),e.moveTo(i,r),e.lineTo(i-w/2,r+g/2),e.stroke()),B(s,d.Slide)&&Ze(e,n,t)}},Ze=(e,o,s)=>{const{x:t,y:n}=C(o,s),i=e.createLinearGradient(t-w/2,n,t+w/2,n+g);i.addColorStop(0,"rgba(200, 200, 255, 0.2)"),i.addColorStop(.5,"rgba(220, 220, 255, 0.3)"),i.addColorStop(1,"rgba(200, 200, 255, 0.2)"),e.fillStyle=i,e.beginPath(),e.moveTo(t,n),e.lineTo(t+w/2,n+g/2),e.lineTo(t,n+g),e.lineTo(t-w/2,n+g/2),e.closePath(),e.fill();for(let r=0;r<3;r++){const l=t+(Math.random()-.5)*w,a=n+(Math.random()-.5)*g,u=Math.random()*2+1;e.fillStyle="rgba(255, 255, 255, 0.7)",e.beginPath(),e.arc(l,a,u,0,Math.PI*2),e.fill()}},ue=(e,o,s,t,n)=>{e.fillStyle="rgba(0, 0, 0, 0.3)",e.beginPath(),e.ellipse(o+t/2,s+n/2+5,t/2,n/4,0,0,Math.PI*2),e.fill()},Je=e=>{const{isoX:o,isoY:s,cellSize:t,baseHeight:n,widthFactor:i,heightAnimationFactor:r}=e,l=Ge(),a=n*t+t*r*l,u=w*i,c=Ne(l),m=w*i*c,f=g*.4*c;return{entityHeight:a,entityWidth:u,shadowWidth:m,shadowHeight:f,animFactor:l,shadowX:o-m/2,shadowY:s+g/2}},xe=(e,o,s,t,n,i,r)=>{e.fillStyle=i,e.beginPath(),e.moveTo(o,s-t-r),e.lineTo(o+n/2,s-t+g/4-r),e.lineTo(o,s+g/2-r),e.lineTo(o-n/2,s-t+g/4-r),e.closePath(),e.fill()},ze=(e,o,s,t,n,i,r)=>{e.fillStyle=i,e.beginPath(),e.arc(o,s-t-n/2-r,n,0,Math.PI*2),e.fill()},eo=(e,o,s,t,n,i,r,l)=>{const a=n*.3;e.fillStyle=i,e.beginPath(),e.arc(o-n/3,s-t-n/2-l,a,0,Math.PI*2),e.arc(o+n/3,s-t-n/2-l,a,0,Math.PI*2),e.fill(),e.fillStyle=r,e.beginPath(),e.arc(o-n/3,s-t-n/2-l,a/2,0,Math.PI*2),e.arc(o+n/3,s-t-n/2-l,a/2,0,Math.PI*2),e.fill()},oo=(e,o,s,t,n,i)=>{e.strokeStyle="black",e.lineWidth=2,e.beginPath(),e.arc(o,s-t+n/4-i,n/2,.1*Math.PI,.9*Math.PI),e.stroke()},to=(e,o,s,t,n,i,r,l,a,u,c,m,f,M)=>{e.strokeStyle=u,e.lineWidth=a;const T=Math.sin(m*1e3)*Math.PI;for(let y=0;y<r;y++){const v=y/r*Math.PI*2,k=o+Math.cos(v)*(n/3),j=s-t/2+Math.sin(v)*(t/4)-M,I=2+Math.sin(m*100+y)*2,E=.1+Math.cos(m*200+y)*.05,_=k+Math.cos(v)*(l/2),Y=j+Math.sin(v)*(l/2)+Math.sin(c*I+T+y)*i*E,Q=k+Math.cos(v)*l,Z=j+Math.sin(v)*l+Math.sin(c*I+Math.PI+T+y)*i*(E*1.5),z=k+Math.cos(v)*l,ee=j+Math.sin(v)*l+Math.sin(c*I+T+y)*i*(E*2);f&&(e.save(),e.strokeStyle="rgba(0, 0, 0, 0.3)",e.lineWidth=a*1.5,e.beginPath(),e.moveTo(k,j+g/2),e.bezierCurveTo(_,Y+g/2,Q,Z+g/2,z,ee+g/2),e.stroke(),e.restore()),e.beginPath(),e.moveTo(k,j),e.bezierCurveTo(_,Y,Q,Z,z,ee),e.stroke()}},Me=e=>{const{ctx:o,isoX:s,isoY:t,cellSize:n,baseHeight:i,widthFactor:r,heightAnimationFactor:l,bodyColor:a,headColor:u,eyeColor:c,pupilColor:m,hasTentacles:f=!1,tentacleColor:M="",tentacleCount:T=0,tentacleLength:y=0,tentacleWidth:v=0,isInvisible:k=!1,seed:j=0,castShadow:I=!0,isConfused:E=!1}=e,_=Je({isoX:s,isoY:t,cellSize:n,baseHeight:i,widthFactor:r,heightAnimationFactor:l}),{entityHeight:Y,entityWidth:Q,shadowWidth:Z,shadowHeight:z,animFactor:ee,shadowX:Le,shadowY:Be}=_,q=We(j),me=E?_e():{x:0,y:0};let X=s,$=t;X+=me.x,$+=me.y,I&&(o.fillStyle="rgba(0, 0, 0, 0.3)",o.beginPath(),o.ellipse(Le+Z/2,Be,Z/2,z/2,0,0,Math.PI*2),o.fill()),o.save(),k&&(o.globalAlpha=.5),f&&M&&T>0&&to(o,X,$,Y,Q,n,T,y,v,M,ee,j,I,q),xe(o,X,$,Y,Q,a,q);const re=n*.25;return ze(o,X,$,Y,re,u,q),eo(o,X,$,Y,re,c,m,q),oo(o,X,$,Y,re,q),o.restore(),{bounceOffset:q}},so=(e,o,s,t=!1,n=[],i=!1,r=!1,l=!1)=>{const{position:a,previousPosition:u,moveTimestamp:c,teleportTimestamp:m,isVanishing:f,isVictorious:M}=o,T=m&&Date.now()-m<K,y=T?Ve(a,u,m):ae(a,u,c);let{x:v,y:k}=C(y.x,y.y);if(M){const E=qe(Date.now()-c);k-=E}l&&n.some(_=>_.position.x===Math.round(y.x)&&_.position.y===Math.round(y.y))&&(k-=s*.5);const j={ctx:e,isoX:v,isoY:k,cellSize:s,baseHeight:.8,widthFactor:.6,heightAnimationFactor:.2,bodyColor:no(l,i),headColor:io(l,i),eyeColor:i?"red":"white",pupilColor:"black",isInvisible:t};f?e.globalAlpha=Xe(Date.now()-c):T&&(e.globalAlpha=$e(Date.now()-m));const{bounceOffset:I}=Me(j);e.globalAlpha=1,M&&ao(e,v,k,s),l&&ro(e,v,k,s),i&&lo(e,v,k,s),r&&co(e,v,k,s,I),T&&ho(e,v,k,s,Date.now()-m)},no=(e,o)=>o?"#800080":e?"#FFA500":"#00FF00",io=(e,o)=>o?"#9932CC":e?"#FFD700":"#32CD32",ao=(e,o,s,t)=>{e.save(),e.translate(o,s);for(let n=0;n<10;n++){const i=Math.PI*2*n/10,r=t*(.5+Math.sin(Date.now()/200+n)*.2),l=Math.cos(i)*r,a=Math.sin(i)*r;e.beginPath(),e.arc(l,a,t*.1,0,Math.PI*2),e.fillStyle=`hsl(${(Date.now()/20+n*36)%360}, 100%, 50%)`,e.fill()}e.restore()},ro=(e,o,s,t)=>{e.save(),e.translate(o,s-t*.6);const n=t*.3;e.strokeStyle="#FFD700",e.lineWidth=2,e.beginPath(),e.moveTo(-n/2,-n/2),e.lineTo(-n/2,n/2),e.moveTo(n/2,-n/2),e.lineTo(n/2,n/2);for(let r=0;r<3;r++){const l=-n/2+(r+1)*(n/3);e.moveTo(-n/2,l),e.lineTo(n/2,l)}e.stroke(),e.shadowColor="#FFD700",e.shadowBlur=5,e.stroke();const i=Math.sin(Date.now()/200)*t*.05;e.translate(0,i),e.stroke(),e.restore()},lo=(e,o,s,t)=>{e.save(),e.translate(o,s);const n=20,i=t*.8;for(let a=0;a<n;a++){const u=Math.PI*2*a/n+Date.now()/1e3,c=i*(.5+Math.sin(Date.now()/500+a)*.2),m=Math.cos(u)*c,f=Math.sin(u)*c;e.beginPath(),e.arc(m,f,t*.05,0,Math.PI*2),e.fillStyle=`rgba(128, 0, 128, ${.5+Math.sin(Date.now()/200+a)*.3})`,e.fill()}const r=t*.1,l=t*.15;e.beginPath(),e.arc(-l,-l,r,0,Math.PI*2),e.arc(l,-l,r,0,Math.PI*2),e.fillStyle="rgba(255, 0, 0, 0.8)",e.fill(),e.shadowColor="red",e.shadowBlur=10+Math.sin(Date.now()/200)*5,e.fill(),e.restore()},co=(e,o,s,t,n)=>{e.save(),e.translate(o-t/10,s-n);const i=t*.4,r=t*.1;e.fillStyle="#808080",e.beginPath(),e.rect(-r/2,-i,r,i),e.fill(),e.fillStyle="#FFD700",e.beginPath(),e.arc(0,-i,r/2,0,Math.PI*2),e.fill(),e.shadowColor="#FFD700",e.shadowBlur=5,e.fill();const l=(Math.sin(Date.now()/200)+1)*r/4;e.beginPath(),e.arc(0,-i,l,0,Math.PI*2),e.fillStyle="rgba(255, 255, 0, 0.8)",e.fill(),e.restore()},ho=(e,o,s,t,n)=>{e.save(),e.translate(o,s);const i=t*1.5,r=n/K;if(r<.5){const l=r*2,a=i*l;e.beginPath(),e.arc(0,0,a,0,Math.PI*2);const u=e.createRadialGradient(0,0,0,0,0,a);u.addColorStop(0,"rgba(0, 255, 255, 0)"),u.addColorStop(.7,"rgba(0, 255, 255, 0.7)"),u.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=u,e.fill();for(let c=0;c<20;c++){const m=Math.random()*Math.PI*2,f=Math.random()*a,M=Math.cos(m)*f,T=Math.sin(m)*f,y=t*.05*(1-l);e.beginPath(),e.arc(M,T,y,0,Math.PI*2),e.fillStyle="rgba(0, 255, 255, "+(1-l)+")",e.fill()}}else{const l=(r-.5)*2,a=i*(1-l);e.beginPath(),e.arc(0,0,a,0,Math.PI*2);const u=e.createRadialGradient(0,0,0,0,0,a);u.addColorStop(0,"rgba(0, 255, 255, 0.7)"),u.addColorStop(.7,"rgba(0, 255, 255, 0.3)"),u.addColorStop(1,"rgba(0, 255, 255, 0)"),e.fillStyle=u,e.fill();for(let c=0;c<20;c++){const m=Math.random()*Math.PI*2,f=Math.random()*i,M=Math.cos(m)*f,T=Math.sin(m)*f,y=t*.05*l;e.beginPath(),e.arc(M,T,y,0,Math.PI*2),e.fillStyle="rgba(0, 255, 255, "+l+")",e.fill()}}e.restore()},uo=(e,o,s,t)=>{o.forEach(n=>{const i=ae(n.position,n.previousPosition,n.moveTimestamp),{x:r,y:l}=C(i.x,i.y),a={ctx:e,isoX:r,isoY:l,cellSize:s,baseHeight:.4,widthFactor:.6,heightAnimationFactor:.1,bodyColor:t?"#00FF00":"#800080",headColor:t?"#32CD32":"#9932CC",eyeColor:"white",pupilColor:t?"black":"red",hasTentacles:!t,tentacleColor:"#600060",tentacleCount:6,tentacleLength:s*.5,tentacleWidth:4,seed:n.seed,castShadow:!0};Me(a),t&&po(e,r,l,s)})},po=(e,o,s,t)=>{e.save(),e.translate(o,s);const n=t*.2;e.fillStyle="#FFD700",e.beginPath(),e.moveTo(-n/2,-t*.3),e.lineTo(0,-t*.5),e.lineTo(n/2,-t*.3),e.closePath(),e.fill();for(let i=0;i<5;i++){const r=Math.random()*Math.PI*2,l=Math.random()*t*.4+t*.2,a=Math.cos(r)*l,u=Math.sin(r)*l;e.fillStyle=`rgba(255, 255, 0, ${.5+Math.random()*.5})`,e.beginPath(),e.arc(a,u,t*.05,0,Math.PI*2),e.fill()}e.restore()},O=g*.4,mo=(e,o,s)=>{o.forEach(t=>{const{x:n,y:i}=C(t.position.x,t.position.y);ue(e,n-w/4,i-g/4,w/2,g),e.fillStyle=bo(t.type),e.beginPath(),e.moveTo(n,i-O),e.lineTo(n+w/4,i-O/2),e.lineTo(n,i),e.lineTo(n-w/4,i-O/2),e.closePath(),e.fill(),e.beginPath(),e.arc(n,i-O,w/6,0,Math.PI*2),e.fill(),e.fillStyle="white",e.font=`bold ${s/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(go(t.type),n,i-O)})},fo=(e,o,s)=>{o.forEach(t=>{const{x:n,y:i}=C(t.x,t.y);ue(e,n-w/2,i,w,g),e.fillStyle="brown",e.beginPath(),e.moveTo(n,i-O/2),e.lineTo(n+w/4,i-O/4),e.lineTo(n,i),e.lineTo(n-w/4,i-O/4),e.closePath(),e.fill(),e.beginPath(),e.arc(n,i-O/2,w/5,0,Math.PI*2),e.fill(),e.fillStyle="white",e.font=`bold ${s/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("M",n,i-O/2)})},yo=(e,o,s)=>{o.forEach(t=>{const{x:n,y:i}=C(t.position.x,t.position.y);ue(e,n-w/2,i,w,g),e.fillStyle="black",e.beginPath(),e.moveTo(n,i-O),e.lineTo(n+w/4,i-O/2),e.lineTo(n,i),e.lineTo(n-w/4,i-O/2),e.closePath(),e.fill(),e.strokeStyle="orange",e.lineWidth=2,e.beginPath(),e.moveTo(n,i-O),e.quadraticCurveTo(n+w/8,i-O*1.5,n+w/4,i-O*1.25),e.stroke(),e.fillStyle="white",e.font=`bold ${s/3}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.timer.toString(),n,i-O/2)})},bo=e=>{switch(e){case d.CapOfInvisibility:return"#8A2BE2";case d.ConfusedMonsters:return"#FFA500";case d.LandMine:return"#8B4513";case d.TimeBomb:return"#000000";case d.Crusher:return"#FF69B4";case d.Builder:return"#00FFFF";default:return"#FFFF00"}},go=e=>{switch(e){case d.CapOfInvisibility:return"I";case d.ConfusedMonsters:return"C";case d.LandMine:return"L";case d.TimeBomb:return"T";case d.Crusher:return"X";case d.Builder:return"B";default:return"?"}},wo=(e,o)=>{e.save(),e.globalAlpha=.7;for(const{position:s,startTime:t,duration:n}of o){if(Date.now()-t>n)continue;const i=C(s.x+.5,s.y+.5),r=C(s.x-1,s.y-1),l=C(s.x+1*2,s.y-1),a=C(s.x+1*2,s.y+1*2),u=C(s.x-1,s.y+1*2);e.fillStyle="#FF6600",e.beginPath(),e.moveTo(r.x,r.y),e.lineTo(l.x,l.y),e.lineTo(a.x,a.y),e.lineTo(u.x,u.y),e.closePath(),e.fill();const c=32,m=w;for(let M=0;M<c;M++){const T=Math.PI*2/c*M,y=m*Math.random(),v=i.x+Math.cos(T)*y,k=i.y+Math.sin(T)*y/2;e.fillStyle=M%2===0?"#FF9933":"#FF3300",e.beginPath(),e.arc(v,k-Math.random()*g*Math.pow(M/c,.5),w/16,0,Math.PI*2),e.fill()}const f=e.createRadialGradient(i.x,i.y,0,i.x,i.y,w*2);f.addColorStop(0,"rgba(255, 255, 0, 0.8)"),f.addColorStop(1,"rgba(255, 165, 0, 0)"),e.fillStyle=f,e.beginPath(),e.ellipse(i.x,i.y,w,g,0,0,Math.PI*2),e.fill()}e.restore()},vo=(e,o,s,t)=>{e.save(),e.globalAlpha=s.duration===12?1:.5,e.font="bold 16px Arial";const{x:n,y:i}=C(o.x,o.y),r=e.measureText(fe(s.type)).width+20,l=90,a=15,u=10,c=n-r/2,m=i-t-l-a;e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.moveTo(c+u,m),e.lineTo(c+r-u,m),e.quadraticCurveTo(c+r,m,c+r,m+u),e.lineTo(c+r,m+l-u),e.quadraticCurveTo(c+r,m+l,c+r-u,m+l),e.lineTo(c+r/2+a,m+l),e.lineTo(c+r/2,m+l+a),e.lineTo(c+r/2-a,m+l),e.lineTo(c+u,m+l),e.quadraticCurveTo(c,m+l,c,m+l-u),e.lineTo(c,m+u),e.quadraticCurveTo(c,m,c+u,m),e.closePath(),e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=2,e.stroke(),e.fillStyle="white",e.textAlign="center",e.fillText(fe(s.type),c+r/2,m+30),e.font="14px Arial",e.fillText(`${s.duration} steps left`,c+r/2,m+55),To(e,s.type,c+r-30,m+25,20),e.restore()},To=(e,o,s,t,n)=>{switch(e.save(),e.strokeStyle="#FFD700",e.lineWidth=2,o){case d.Climber:Mo(e,s,t,n);break;case d.Tsunami:Co(e,s,t,n);break;case d.Monster:Po(e,s,t,n);break;case d.Slide:ko(e,s,t,n);break;case d.Sokoban:Io(e,s,t,n);break;case d.Blaster:jo(e,s,t,n);break;default:Do(e,s,t,n)}e.restore()},Mo=(e,o,s,t)=>{e.beginPath(),e.moveTo(o,s),e.lineTo(o,s+t),e.moveTo(o+t,s),e.lineTo(o+t,s+t);for(let n=0;n<3;n++){const i=s+(n+1)*(t/3);e.moveTo(o,i),e.lineTo(o+t,i)}e.stroke()},Co=(e,o,s,t)=>{e.beginPath(),e.moveTo(o,s+t),e.quadraticCurveTo(o+t/4,s,o+t/2,s+t/2),e.quadraticCurveTo(o+t*3/4,s+t,o+t,s),e.stroke(),e.fillStyle="rgba(0, 100, 255, 0.5)",e.fill()},Po=(e,o,s,t)=>{e.fillStyle="#800080",e.beginPath(),e.arc(o+t/2,s+t/2,t/3,0,Math.PI*2),e.fill(),e.fillStyle="red",e.beginPath(),e.arc(o+t/3,s+t/3,t/10,0,Math.PI*2),e.arc(o+t*2/3,s+t/3,t/10,0,Math.PI*2),e.fill()},ko=(e,o,s,t)=>{e.beginPath(),e.moveTo(o,s+t),e.quadraticCurveTo(o+t/2,s,o+t,s+t),e.stroke();for(let n=0;n<5;n++)e.fillStyle="rgba(200, 200, 255, 0.8)",e.beginPath(),e.arc(o+Math.random()*t,s+Math.random()*t,t/10,0,Math.PI*2),e.fill()},Io=(e,o,s,t)=>{e.strokeRect(o+t/4,s+t/4,t/2,t/2),e.beginPath(),e.moveTo(o,s+t/2),e.lineTo(o+t,s+t/2),e.lineTo(o+t*3/4,s+t/4),e.moveTo(o+t,s+t/2),e.lineTo(o+t*3/4,s+t*3/4),e.stroke()},jo=(e,o,s,t)=>{e.fillStyle="#808080",e.fillRect(o,s+t/3,t*2/3,t/3),e.beginPath(),e.arc(o+t*2/3,s+t/2,t/6,0,Math.PI*2),e.fill(),e.strokeStyle="red",e.setLineDash([t/10,t/20]),e.beginPath(),e.moveTo(o+t*2/3,s+t/2),e.lineTo(o+t,s+t/2),e.stroke(),e.setLineDash([])},Do=(e,o,s,t)=>{e.beginPath(),e.arc(o+t/2,s+t/2,t/3,0,Math.PI*2),e.stroke(),e.fillText("?",o+t/2,s+t/2+5)},So=(e,o,s,t,n)=>{const i=Ue(Math.max(o,o),s,t,Date.now());e.strokeStyle="rgba(255, 255, 255, 0.7)",e.lineWidth=2;for(const r of i){const l=C(r.position.x,r.position.y),a={x:l.x+(Math.random()-.5)*n,y:l.y+(Math.random()-.5)*n};e.beginPath(),e.moveTo(l.x,l.y),e.lineTo(a.x,a.y),e.stroke()}},Eo=(e,o,s)=>{const{tsunamiLevel:t}=e,n=s*.8,i=[];for(let r=0;r<o;r++)for(let l=0;l<o;l++){const a=C(l,r),u=C(l+1,r),c=C(l,r+1),m=C(l+1,r+1),f=t/13*n,M=f+Math.sin(Date.now()/200+l*.5)*5,T=f+Math.sin(Date.now()/200+(l+1)*.5)*5;i.push({tsunamiLevel:t,grid:{x:l,y:r},isoTop:[{x:a.x,y:a.y-M},{x:c.x,y:c.y-T},{x:m.x,y:m.y-T},{x:u.x,y:u.y-M}],isoFront:r===o-1?[{x:c.x,y:c.y-T},{x:c.x,y:c.y},{x:m.x,y:m.y},{x:m.x,y:m.y-T}]:void 0,isoSide:l===o-1?[{x:m.x,y:m.y-T},{x:m.x,y:m.y},{x:u.x,y:u.y},{x:u.x,y:u.y-M}]:void 0})}return i},Lo=(e,o)=>{e.save(),e.globalAlpha=.6,ce(e,o.isoTop,`rgba(0, 100, 255, ${o.tsunamiLevel/13})`),o.isoFront&&ce(e,o.isoFront,`rgba(0, 39, 98, ${o.tsunamiLevel/13})`),o.isoSide&&ce(e,o.isoSide,`rgba(0, 63, 157, ${o.tsunamiLevel/13})`),e.restore()};function ce(e,o,s){e.fillStyle=s,e.beginPath(),e.moveTo(o[0].x,o[0].y);for(let t=1;t<o.length;t++)e.lineTo(o[t].x,o[t].y);e.closePath(),e.fill()}const Bo=(e,o,s)=>{const{x:t,y:n}=C(o.x,o.y),{x:i,y:r}=C(s.x,s.y);e.save(),e.strokeStyle="rgba(0, 255, 255, 0.5)",e.lineWidth=3,e.setLineDash([5,5]),e.beginPath(),e.moveTo(t,n),e.lineTo(i,r),e.stroke(),e.restore()},Ao=(e,o,s)=>{if(Date.now()-o.shotTimestamp>o.duration)return;const t=ae(o.endPosition,o.startPosition,o.shotTimestamp,o.duration),{x:n,y:i}=C(t.x,t.y);e.save(),e.shadowColor="rgba(255, 0, 0, 0.8)",e.shadowBlur=s*.2,e.fillStyle="red",e.strokeStyle="rgba(255, 100, 100, 0.8)",e.lineWidth=2;const r=s*.6,l=s*.1;switch(e.translate(n,i),o.direction){case b.Up:e.rotate(-Math.PI/4);break;case b.Down:e.rotate(3*Math.PI/4);break;case b.Left:e.rotate(-3*Math.PI/4);break;case b.Right:e.rotate(Math.PI/4);break}e.beginPath(),e.ellipse(0,0,r/2,l/2,0,0,2*Math.PI),e.fill(),e.stroke(),e.globalAlpha=.5;for(let a=1;a<=3;a++)e.globalAlpha*=.5,e.beginPath(),e.ellipse(-a*r*.2,0,r/(2+a),l/(2+a),0,0,2*Math.PI),e.fill();e.restore()},oe=20,Ce=(e,o,{gridSize:s,cellSize:t})=>{if(e.save(),o.explosions.length>0){const a=Math.min(o.explosions.filter(c=>Date.now()-c.startTime<c.duration).length*2,10),u=we(a);e.translate(u.x,u.y)}e.translate(e.canvas.width/2,100),e.clearRect(-e.canvas.width/2,-100,e.canvas.width,e.canvas.height),Qe(e,s),Te(e,s,o);const n=o.tsunamiLevel>0?Eo(o,s,t):[];So(e,s,o.monsterSpawnSteps,o.player.moveTimestamp,t),B(o,d.Slide)&&Bo(e,o.player.previousPosition,o.player.position);const i=[...n.map(a=>({position:a.grid,type:"wave",obj:a})),...o.obstacles.map(a=>({position:a.position,type:"obstacle",obj:a})),...o.bonuses.map(a=>({position:a.position,type:"bonus",obj:a})),...o.landMines.map(a=>({position:a,type:"landMine"})),...o.timeBombs.map(a=>({position:a.position,type:"timeBomb",obj:a})),...o.monsters.map(a=>({position:a.position,type:"monster",obj:a})),{position:o.player.position,type:"player",obj:o.player},{position:o.goal,type:"goal"},...o.explosions.map(a=>({position:a.position,type:"explosion",obj:a})),...o.blasterShots.map(a=>({position:ae(a.endPosition,a.startPosition,a.shotTimestamp,a.duration),type:"blasterShot",obj:a}))],r=Re(i);for(const a of r){const{type:u,position:c}=a;switch(u){case"wave":Lo(e,a.obj);break;case"obstacle":Ke(e,[a.obj],t);break;case"bonus":mo(e,[a.obj],t);break;case"landMine":fo(e,[c],t);break;case"timeBomb":yo(e,[a.obj],t);break;case"monster":uo(e,[a.obj],t,B(o,d.Monster));break;case"player":so(e,a.obj,t,o.activeBonuses.some(m=>m.type===d.CapOfInvisibility),o.obstacles,B(o,d.Monster),B(o,d.Blaster),B(o,d.Climber));break;case"goal":He(e,c,t);break;case"explosion":wo(e,[a.obj]);break;case"blasterShot":Ao(e,a.obj,t);break}}const l=o.activeBonuses.find(a=>a.duration===13||[d.Builder,d.CapOfInvisibility,d.Crusher,d.Blaster].includes(a.type));l&&vo(e,o.player.position,l,t),e.restore()},te=300,se=200,H=5,Oo=Math.min(te/H,se/H)/2,Ro=()=>({player:{position:{x:2,y:2},previousPosition:{x:2,y:2},moveTimestamp:Date.now(),isVictorious:!1,isVanishing:!1},goal:{x:4,y:4},obstacles:[{position:{x:1,y:1},creationTime:Date.now(),isRaising:!1,isDestroying:!1},{position:{x:3,y:3},creationTime:Date.now(),isRaising:!1,isDestroying:!1}],monsters:[{position:{x:0,y:4},previousPosition:{x:0,y:4},moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1},{position:{x:4,y:0},previousPosition:{x:4,y:0},moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1}],steps:0,monsterSpawnSteps:0,bonuses:[{type:d.CapOfInvisibility,position:{x:1,y:3}},{type:d.ConfusedMonsters,position:{x:3,y:1}}],activeBonuses:[],explosions:[],timeBombs:[],landMines:[],score:0,gameEndingState:"none",tsunamiLevel:0,blasterShots:[]}),Fo=()=>{const e=A.useRef(null),o=A.useRef(Ro());return A.useEffect(()=>{const s=e.current;if(!s)return;const t=s.getContext("2d");if(!t)return;const n=()=>{t.clearRect(0,0,te,se),t.save(),t.scale(.8,.8),t.translate(te*.1,se*.1),Te(t,H,o.current),Ce(t,o.current,{gridSize:H,cellSize:Oo,initialMonsterCount:0,monsterSpawnSectors:[],obstacleCount:0,initialBonusCount:0,levelName:"Preview",levelStory:"Preview",levelUpdater:()=>{}}),t.restore(),o.current.monsters.forEach(i=>{const r=i.position.x+(Math.random()-.5)*.1,l=i.position.y+(Math.random()-.5)*.1;i.previousPosition={...i.position},i.position={x:Math.max(0,Math.min(H-1,r)),y:Math.max(0,Math.min(H-1,l))},i.moveTimestamp=Date.now()}),requestAnimationFrame(n)};n()},[]),h.jsx("canvas",{ref:e,width:te,height:se})},Go=({onStart:e,onInstructions:o})=>(A.useEffect(()=>{const s=t=>{t.key==="ArrowRight"&&e()};return window.addEventListener("keydown",s),()=>{window.removeEventListener("keydown",s)}},[e]),h.jsxs("div",{className:"intro",children:[h.jsx("h1",{className:"game-title",children:"Monster Steps"}),h.jsxs("div",{className:"game-intro-responsive",children:[h.jsx("div",{className:"game-preview-container",children:h.jsx(Fo,{})}),h.jsxs("div",{className:"game-intro-column",children:[h.jsxs("div",{className:"intro-buttons",children:[h.jsx("button",{onClick:e,children:"Start Game"}),h.jsx("button",{onClick:o,children:"Instructions"})]}),h.jsx("p",{className:"intro-tip",children:"Press right arrow to start"})]})]}),h.jsxs("p",{className:"author-name",children:["Created by ",h.jsx("a",{href:"https://x.com/gtanczyk",children:"Grzegorz Tańczyk"})," | ",h.jsx("a",{href:"https://github.com/gamedevpl/www.gamedev.pl/tree/master/js13k2024",children:"Source code (GitHub)"})]})]})),No=({onBack:e})=>(A.useEffect(()=>{const o=s=>{s.key==="Escape"&&e()};return window.addEventListener("keydown",o),()=>{window.removeEventListener("keydown",o)}},[e]),h.jsxs("div",{className:"instructions",children:[h.jsx("h1",{children:"How to Play Monster Steps"}),h.jsxs("ul",{children:[h.jsx("li",{children:"Use arrow keys, touch controls, or mouse clicks to move your character"}),h.jsx("li",{children:"Avoid obstacles and monsters"}),h.jsx("li",{children:"Reach the goal (green square) to complete the level"}),h.jsx("li",{children:"New monsters appear every 13 steps"}),h.jsxs("li",{children:["Collect bonuses for special abilities:",h.jsxs("ul",{children:[h.jsx("li",{children:"Cap of Invisibility: Temporary invisibility to monsters"}),h.jsx("li",{children:"Confused Monsters: Monsters move randomly"}),h.jsx("li",{children:"Land Mine: Place a trap for monsters"}),h.jsx("li",{children:"Time Bomb: Delayed explosion"}),h.jsx("li",{children:"Crusher: Destroy nearby obstacles"}),h.jsx("li",{children:"Builder: Create new platforms"}),h.jsx("li",{children:"Climber: Climb on walls and obstacles"}),h.jsx("li",{children:"Teleport: Instantly move to another location on the grid"}),h.jsx("li",{children:"Tsunami: Water floods the grid, slowing movement. Climb to survive!"}),h.jsx("li",{children:"Monster: Transform into a monster and hunt other monsters"}),h.jsx("li",{children:"Slide: Glide across the grid until hitting an obstacle"}),h.jsx("li",{children:"Sokoban: Push obstacles to crush monsters or create paths"}),h.jsx("li",{children:"Blaster: Shoot in the direction you're moving to eliminate monsters"})]})]}),h.jsx("li",{children:"Complete all 13 levels to win"})]}),h.jsx("h2",{children:"New Bonus Details"}),h.jsxs("ul",{children:[h.jsxs("li",{children:["Tsunami:",h.jsxs("ul",{children:[h.jsx("li",{children:"Water gradually floods the grid over 13 steps"}),h.jsx("li",{children:"Movement becomes slower for both you and monsters"}),h.jsx("li",{children:"At the 13th step, everything not on an obstacle is eliminated"}),h.jsx("li",{children:"Use the Climber bonus to survive on obstacles"})]})]}),h.jsxs("li",{children:["Monster:",h.jsxs("ul",{children:[h.jsx("li",{children:"You become a monster for 13 steps"}),h.jsx("li",{children:'Monsters become vulnerable "players" during this time'}),h.jsx("li",{children:"Eliminate all monster-players to win, but be careful not to let them reach the goal!"})]})]}),h.jsxs("li",{children:["Slide:",h.jsxs("ul",{children:[h.jsx("li",{children:"Your movement becomes a slide in the chosen direction"}),h.jsx("li",{children:"You'll keep moving until you hit an obstacle or the edge of the grid"}),h.jsx("li",{children:"Use this to quickly traverse the grid, but plan your moves carefully!"})]})]}),h.jsxs("li",{children:["Sokoban:",h.jsxs("ul",{children:[h.jsx("li",{children:"Gain the ability to push obstacles"}),h.jsx("li",{children:"Use this to create new paths or crush monsters"}),h.jsx("li",{children:"Strategic obstacle placement can help block monster paths"})]})]}),h.jsxs("li",{children:["Blaster:",h.jsxs("ul",{children:[h.jsx("li",{children:"Equip a blaster that shoots in the direction you're moving"}),h.jsx("li",{children:"Eliminate monsters in your path"}),h.jsx("li",{children:"Use carefully to clear your way to the goal"})]})]})]}),h.jsx("h2",{children:"Tips"}),h.jsxs("ul",{children:[h.jsx("li",{children:"Plan your route to avoid getting trapped"}),h.jsx("li",{children:"Use obstacles and new bonuses strategically to outmaneuver monsters"}),h.jsx("li",{children:"Combine bonuses for powerful effects (e.g., Climber during Tsunami)"}),h.jsx("li",{children:"Think ahead when using Slide or Sokoban to avoid putting yourself in danger"}),h.jsx("li",{children:"Keep track of your steps to anticipate new monster spawns"})]}),h.jsx("button",{onClick:e,children:"Back to Menu"}),h.jsx("p",{className:"instructions-tip",children:"Press Escape to return to the main menu"})]})),L=(e,o)=>e.x===o.x&&e.y===o.y,R=(e,o)=>o.some(s=>L(s,e)),x=(e,o)=>Math.abs(e.x-o.x)+Math.abs(e.y-o.y),Vo=e=>{switch(e){case"ArrowUp":case"w":return b.Up;case"ArrowDown":case"s":return b.Down;case"ArrowLeft":case"a":return b.Left;case"ArrowRight":case"d":return b.Right;default:return null}},V=(e,o,s=1)=>{switch(o){case b.Up:return{...e,y:e.y-s};case b.Down:return{...e,y:e.y+s};case b.Left:return{...e,x:e.x-s};case b.Right:return{...e,x:e.x+s}}};function be(e,o){switch(e){case b.Up:return o===-1?b.Left:b.Right;case b.Down:return o===-1?b.Left:b.Right;case b.Left:return o===-1?b.Down:b.Up;case b.Right:return o===-1?b.Up:b.Down}}const Wo=(e,o,{gridSize:s})=>!(!(e.x>=0&&e.x<s&&e.y>=0&&e.y<s)||R(e,o.obstacles.filter(i=>!i.isDestroying).map(({position:i})=>i))),ne=(e,o,{gridSize:s})=>{if(!(e.x>=0&&e.x<s&&e.y>=0&&e.y<s))return!1;if(R(e,o.obstacles.filter(i=>!i.isDestroying).map(({position:i})=>i))&&!B(o,d.Climber)&&!B(o,d.Crusher)){if(o.activeBonuses.some(i=>i.type===d.Sokoban)){const i=ke(o.player.position,e),r=V(e,i);if(r.x>=0&&r.x<s&&r.y>=0&&r.y<s&&!R(r,o.obstacles.map(a=>a.position)))return!0}return!1}return!0},Pe=(e,o)=>{const{player:s}=e,t=[b.Up,b.Down,b.Left,b.Right];return B(e,d.Slide)?t.map(n=>{let i=s.position;for(;ne(V(i,n),e,o);)i=V(i,n);return{position:i,direction:n}}).filter(n=>!L(n.position,s.position)):t.map(n=>({position:V(s.position,n),direction:n})).filter(({position:n})=>ne(n,e,o))};function Uo(e,o,s,t){return Pe(s,t).find(n=>Yo(e,o,Ie(t.gridSize,t.cellSize,n.direction)))}function Yo(e,o,s){let t=!1;for(let n=0,i=s.length-1;n<s.length;i=n++){const r=s[n].x,l=s[n].y,a=s[i].x,u=s[i].y;l>o!=u>o&&e<(a-r)*(o-l)/(u-l)+r&&(t=!t)}return t}function ke(e,o){return o.x>e.x?b.Right:o.x<e.x?b.Left:o.y>e.y?b.Down:b.Up}const _o=(e,o,s,t)=>{e.save(),e.translate(e.canvas.width/2,100),o.forEach(({direction:n})=>{const i=Ie(s,t,n);e.beginPath(),e.moveTo(i[0].x,i[0].y),e.lineTo(i[1].x,i[1].y),e.lineTo(i[2].x,i[2].y),e.fillStyle="rgba(255, 255, 0, 0.5)",e.fill()}),e.restore()};function Ie(e,o,s){const t=e/3,n=V({x:e/2,y:e/2},s,e/1.5),i=V(n,be(s,-1),t),r=V(n,be(s,1),t),l=C(n.x,n.y),a=C(i.x,i.y),u=C(r.x,r.y),c=V(n,s,t),m=C(c.x,c.y),f=Math.atan2(m.y-l.y,m.x-l.x),M=Math.cos(f)*o,T=Math.sin(f)*o;return[{x:m.x+M,y:m.y+T},{x:a.x+M,y:a.y+T},{x:u.x+M,y:u.y+T}]}const qo=(e,o,s,t,n,i,r)=>{const l=[];return e.map(a=>{let u;n?u=$o(a.position,s,t,e):u=Ho(a.position,o,s,t,e);let c;return i||r?c=Xo(a.position,u[1]||a.position,s,t,e):c=u.length>1?u[1]:a.position,R(c,l)?c=a.position:l.push(c),{...a,previousPosition:a.position,position:c,moveTimestamp:Date.now(),path:u}})},Xo=(e,o,s,t,n)=>{const i=o.x-e.x,r=o.y-e.y,l={x:Math.max(0,Math.min(s-1,e.x-i)),y:Math.max(0,Math.min(s-1,e.y-r))};return!R(l,t.map(({position:a})=>a))&&!R(l,n.map(a=>a.position))?l:e},$o=(e,o,s,t)=>{const n=[{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1}].filter(i=>i.x>=0&&i.x<o&&i.y>=0&&i.y<o&&!R(i,s.map(({position:r})=>r))&&!R(i,t.map(r=>r.position)));if(n.length>0){const i=Math.floor(Math.random()*n.length);return[e,n[i]]}return[e]},Ho=(e,o,s,t,n)=>{const i=[],r=[],l={position:e,g:0,h:0,f:0,parent:null};for(i.push(l);i.length>0;){let a=i[0],u=0;if(i.forEach((m,f)=>{m.f<a.f&&(a=m,u=f)}),i.splice(u,1),r.push(a),L(a.position,o))return Ko(a);const c=Qo(a.position,s);for(const m of c){if(R(m,t.map(({position:v})=>v))||R(m,n.map(v=>v.position))||r.some(v=>L(v.position,m)))continue;const f=a.g+1,M=x(m,o),T=f+M,y=i.find(v=>L(v.position,m));y?f<y.g&&(y.g=f,y.f=T,y.parent=a):i.push({position:m,g:f,h:M,f:T,parent:a})}}return[e]},Ko=e=>{const o=[];let s=e;for(;s!==null;)o.unshift(s.position),s=s.parent;return o},Qo=(e,o)=>[{x:e.x-1,y:e.y},{x:e.x+1,y:e.y},{x:e.x,y:e.y-1},{x:e.x,y:e.y+1}].filter(t=>t.x>=0&&t.x<o&&t.y>=0&&t.y<o),Zo=(e,o)=>o.some(s=>L(s.position,e)),Jo=(e,o)=>{const s=[];return[e.filter(n=>{const i=o.find(r=>L(r,n.position));return i?(s.push({position:i,startTime:Date.now(),duration:1e3}),xo(o,i),!1):!0}),s]},xo=(e,o)=>{e.splice(e.indexOf(o),1)},zo=(e,o)=>Math.abs(e.position.x-o.position.x)<=1&&Math.abs(e.position.y-o.position.y)<=1,he=(e,o)=>o.some(s=>Math.abs(e.x-s.position.x)<=1&&Math.abs(e.y-s.position.y)<=1);class et{constructor(){le(this,"audioContext");le(this,"masterVolume",.025);this.audioContext=new(window.AudioContext||window.webkitAudioContext)}createOscillator(o,s,t){const n=this.audioContext.createOscillator();return n.type=s,n.frequency.setValueAtTime(o,this.audioContext.currentTime),n.start(),n.stop(this.audioContext.currentTime+t),n}createGain(o,s,t=1){const n=this.audioContext.createGain(),i=t*this.masterVolume;return n.gain.setValueAtTime(0,this.audioContext.currentTime),n.gain.linearRampToValueAtTime(i,this.audioContext.currentTime+o),n.gain.linearRampToValueAtTime(0,this.audioContext.currentTime+o+s),n}playStep(){const o=this.createOscillator(200,"square",.1),s=this.createGain(.01,.09);o.connect(s).connect(this.audioContext.destination)}playElectricalDischarge(){const o=this.createOscillator(800,"sawtooth",.2),s=this.createGain(.01,.19);o.frequency.linearRampToValueAtTime(200,this.audioContext.currentTime+.2),o.connect(s).connect(this.audioContext.destination)}playBonusCollected(){const o=this.createOscillator(600,"sine",.15),s=this.createGain(.01,.14);o.frequency.linearRampToValueAtTime(800,this.audioContext.currentTime+.15),o.connect(s).connect(this.audioContext.destination)}playExplosion(){const o=this.audioContext.createBufferSource(),s=this.audioContext.sampleRate*.5,t=this.audioContext.createBuffer(1,s,this.audioContext.sampleRate),n=t.getChannelData(0);for(let r=0;r<s;r++)n[r]=Math.random()*2-1;o.buffer=t;const i=this.createGain(.01,.49,.5);o.connect(i).connect(this.audioContext.destination),o.start()}playStateTransition(){const o=this.createOscillator(300,"triangle",.3),s=this.createGain(.05,.25);o.frequency.linearRampToValueAtTime(600,this.audioContext.currentTime+.3),o.connect(s).connect(this.audioContext.destination)}playGameOver(){const o=this.createOscillator(440,"sine",1),s=this.createGain(.01,.99);o.frequency.linearRampToValueAtTime(220,this.audioContext.currentTime+1),o.connect(s).connect(this.audioContext.destination)}playLevelComplete(){const o=this.createOscillator(440,"sine",.5),s=this.createOscillator(550,"sine",.5),t=this.createGain(.01,.49),n=this.createGain(.01,.49);o.connect(t).connect(this.audioContext.destination),s.connect(n).connect(this.audioContext.destination),setTimeout(()=>{const i=this.createOscillator(660,"sine",.5),r=this.createGain(.01,.49);i.connect(r).connect(this.audioContext.destination)},250)}playMonsterSpawn(){const o=this.createOscillator(100,"sawtooth",.3),s=this.createGain(.01,.29);o.frequency.exponentialRampToValueAtTime(300,this.audioContext.currentTime+.3),o.connect(s).connect(this.audioContext.destination)}playTeleport(){const o=this.createOscillator(100,"sine",.5),s=this.createOscillator(200,"sine",.5),t=this.createGain(.01,.49),n=this.createGain(.01,.49);o.frequency.exponentialRampToValueAtTime(1e3,this.audioContext.currentTime+.25),s.frequency.exponentialRampToValueAtTime(2e3,this.audioContext.currentTime+.25),o.connect(t).connect(this.audioContext.destination),s.connect(n).connect(this.audioContext.destination),setTimeout(()=>{const i=this.createOscillator(2e3,"sine",.2),r=this.createGain(.01,.19);i.frequency.exponentialRampToValueAtTime(4e3,this.audioContext.currentTime+.2),i.connect(r).connect(this.audioContext.destination)},100)}playBlasterSound(){const s=this.audioContext.createOscillator();s.type="sawtooth",s.frequency.setValueAtTime(1e3,this.audioContext.currentTime),s.frequency.exponentialRampToValueAtTime(500,this.audioContext.currentTime+.15);const t=this.audioContext.createGain();t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(this.masterVolume,this.audioContext.currentTime+.01),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15);const n=this.audioContext.createBuffer(1,this.audioContext.sampleRate*.15,this.audioContext.sampleRate),i=n.getChannelData(0);for(let a=0;a<n.length;a++)i[a]=Math.random()*2-1;const r=this.audioContext.createBufferSource();r.buffer=n;const l=this.audioContext.createGain();l.gain.setValueAtTime(this.masterVolume*.2,this.audioContext.currentTime),l.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15),s.connect(t).connect(this.audioContext.destination),r.connect(l).connect(this.audioContext.destination),s.start(),r.start(),s.stop(this.audioContext.currentTime+.15),r.stop(this.audioContext.currentTime+.15)}}const U=new et,ot=(e,o)=>{const s={type:o,duration:13};switch(e.activeBonuses.push(s),o){case d.CapOfInvisibility:break;case d.ConfusedMonsters:break;case d.LandMine:e.landMines.push({...e.player.position});break;case d.TimeBomb:e.timeBombs.push({position:e.player.position,timer:13,shakeIntensity:0});break;case d.Crusher:break;case d.Builder:break;case d.Climber:break;case d.Teleport:break;case d.Tsunami:e.tsunamiLevel=1;break;case d.Monster:break;case d.Slide:break;case d.Sokoban:break;case d.Blaster:break}},tt=(e,o)=>{const s=Object.values(d).filter(i=>typeof i=="number");let t;if(e.monsters.length>5){const i=[d.CapOfInvisibility,d.Crusher,d.LandMine,d.TimeBomb,d.Blaster];t=i[Math.floor(Math.random()*i.length)]}else if(e.obstacles.length>20){const i=[d.Climber,d.Slide,d.Teleport];t=i[Math.floor(Math.random()*i.length)]}else t=s[Math.floor(Math.random()*s.length)];let n;do n={x:Math.floor(Math.random()*o.gridSize),y:Math.floor(Math.random()*o.gridSize)};while(R(n,e.obstacles.map(i=>i.position))||R(n,e.monsters.map(i=>i.position))||R(n,e.bonuses.map(i=>i.position))||L(n,e.player.position)||L(n,e.goal)||x(n,e.player.position)<3);e.bonuses.push({type:t,position:n})},st=(e,o)=>{const s=e.bonuses.find(t=>t.type===d.Teleport&&!L(t.position,o));s&&(e.player.previousPosition=e.player.position,e.player.position=s.position,e.player.teleportTimestamp=Date.now(),U.playTeleport())},nt=e=>{e.tsunamiLevel++,e.tsunamiLevel>=13&&(B(e,d.Climber)||(e.gameEndingState="gameOver",ie(e)),e.monsters=[],e.tsunamiLevel=0)},it=e=>{const o=e.monsters.find(s=>L(e.player.position,s.position));o&&(e.monsters=e.monsters.filter(s=>s!==o),e.monsters.length===0&&(e.gameEndingState="gameOver",ie(e)))},je=(e,o,s)=>{let t=e.player.position;for(;ne(V(t,o),e,s);)t=V(t,o);return t},at=(e,o,s,t)=>{const n=e.obstacles.find(i=>L(i.position,s));if(n){const i=V(n.position,ke(o,s));if(Wo(i,e,{gridSize:t})){n.position=i;const r=e.monsters.find(l=>L(l.position,i));r&&(e.monsters=e.monsters.filter(l=>l!==r))}else s=o}},rt=(e,o,s)=>{const t=e.player.position,n=je(e,o,s),i={startPosition:t,endPosition:n,direction:o,shotTimestamp:Date.now(),duration:Fe*(x(t,n)+1)};e.blasterShots.push(i),U.playBlasterSound(),e.monsters=e.monsters.filter(r=>!lt(r.position,t,n,o))},lt=(e,o,s,t)=>{switch(t){case b.Up:case b.Down:return e.x===o.x&&(t===b.Up&&e.y<=o.y&&e.y>=s.y||t===b.Down&&e.y>=o.y&&e.y<=s.y);case b.Left:case b.Right:return e.y===o.y&&(t===b.Left&&e.x<=o.x&&e.x>=s.x||t===b.Right&&e.x>=o.x&&e.x<=s.x)}},ct=(e,o,s)=>{if(J(o))return o;const t=Vo(e.key);return t!==null?De(t,o,s):{...o}},De=(e,o,s)=>{if(J(o))return o;const t={...o},n=t.player.position;let i=V(t.player.position,e);if(B(t,d.Slide)&&(i=je(t,e,s)),t.activeBonuses.some(r=>r.type===d.Sokoban)&&at(t,n,i,s.gridSize),t.obstacles=o.obstacles.filter(r=>!r.isDestroying||Date.now()-r.creationTime<ve),B(t,d.Crusher)&&o.obstacles.find(r=>L(i,r.position))&&(t.obstacles=o.obstacles.map(r=>L(i,r.position)?{...r,isDestroying:!0,creationTime:Date.now()}:r),U.playElectricalDischarge()),ne(i,t,s)){if(U.playStep(),t.player.position=i,Date.now()-t.player.moveTimestamp>ge&&(t.player.previousPosition=n,t.player.moveTimestamp=Date.now()),t.steps++,t.monsterSpawnSteps++,t.tsunamiLevel>0&&nt(t),L(i,t.goal))return t.gameEndingState="levelComplete",ut(t),t.score+=ht(t),t;const r=t.bonuses.find(c=>L(c.position,i));if(r&&(U.playBonusCollected(),t.bonuses=t.bonuses.filter(c=>!L(c.position,i)),ot(t,r.type)),(r==null?void 0:r.type)===d.Teleport&&st(t,r.position),s.levelUpdater(t,s),t.monsters=qo(t.monsters,t.player.position,s.gridSize,t.obstacles,B(t,d.CapOfInvisibility),B(t,d.ConfusedMonsters),B(t,d.Monster)),B(t,d.Monster))it(t);else if(Zo(t.player.position,t.monsters))return t.gameEndingState="gameOver",ie(t),t;B(t,d.Blaster)&&rt(t,e,s),t.blasterShots=t.blasterShots.filter(c=>Date.now()-c.shotTimestamp<c.duration);const[l,a]=Jo(t.monsters,t.landMines);t.monsters=l,t.explosions=a,t.timeBombs=t.timeBombs.map(c=>({...c,timer:c.timer-1}));const u=t.timeBombs.filter(c=>c.timer===0);if((u.length>0||a.length>0)&&U.playExplosion(),t.explosions=[...t.explosions,...u.map(c=>({position:c.position,startTime:Date.now(),duration:1e3}))],t.timeBombs=t.timeBombs.filter(c=>c.timer>0),t.monsters=t.monsters.filter(c=>!t.explosions.some(m=>zo(c,m))),t.obstacles=t.obstacles.map(c=>he(c.position,t.explosions)?{...c,isDestroying:!0,creationTime:Date.now()}:c),t.bonuses=t.bonuses.filter(c=>!he(c.position,t.explosions)),he(t.player.position,t.explosions))return t.gameEndingState="gameOver",ie(t),t;if(t.activeBonuses=t.activeBonuses.map(c=>({...c,duration:c.duration-1})).filter(c=>c.duration>0),B(t,d.Builder)){const c={position:n,creationTime:Date.now(),isRaising:!0,isDestroying:!1};R(c.position,t.obstacles.map(({position:m})=>m))||(t.obstacles.push(c),U.playElectricalDischarge())}}return t},ht=e=>100-e.steps+e.monsters.length*10,J=e=>e.gameEndingState!=="none",ie=e=>{e.player.isVanishing=!0,U.playGameOver()},ut=e=>{e.player.isVictorious=!0,U.playLevelComplete()},dt=({level:e,score:o,steps:s})=>h.jsxs("div",{className:"hud",children:[h.jsxs("div",{children:["Level: ",e]}),h.jsxs("div",{children:["Score: ",o]}),h.jsxs("div",{children:["Steps: ",s]})]}),pt=10,mt=10,ft=(e,{gridSize:o,monsterSpawnSectors:s})=>{let t=0;const n=50;for(;t<n;){const i=s.length>0?s[Math.round(s.length*Math.random())]:{x:Math.floor(Math.random()*o),y:Math.floor(Math.random()*o)};if(yt(i,e,o))return{position:i,previousPosition:i,moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1};t++}return null},yt=(e,o,s)=>{if(e.x<0||e.y<0||e.x>=s||e.y>=s||R(e,o.obstacles.map(n=>n.position))||R(e,o.monsters.map(n=>n.position))||R(e,o.bonuses.map(n=>n.position))||L(e,o.goal)||x(e,o.player.position)<pt)return!1;const t=[d.TimeBomb,d.LandMine,d.Crusher,d.Blaster];for(const n of o.bonuses)if(t.includes(n.type)&&x(e,n.position)<mt)return!1;return!0};function bt(e,o){if(e.monsterSpawnSteps>=13){const s=ft(e,o);s&&(e.monsters.push(s),e.monsterSpawnSteps=0,U.playMonsterSpawn())}}const gt=()=>{const e=G(),o=N(7,"The First Step","Avoid the lone monster and reach the goal in 13 steps!");return e.player=F(0,3),e.goal=S(6,3),e.monsters=[P(3,0)],e.obstacles=[p(5,2),p(5,3)],[e,o,o.levelStory]},wt=()=>{const e=G(),o=N(8,"Now You See Me","Use the invisibility cap to sneak past the monsters!");return e.player=F(0,4),e.goal=S(7,4),e.monsters=[P(3,2),P(5,4)],e.bonuses=[D(2,4,d.CapOfInvisibility)],e.obstacles=[p(1,3),p(1,5),p(6,3),p(6,5)],[e,o,o.levelStory]},vt=()=>{const e=G(),o=N(9,"Bridge the Gap","Build your way to victory!");return e.player=F(0,4),e.goal=S(8,4),e.monsters=[P(4,4)],e.bonuses=[D(2,4,d.Builder)],e.obstacles=[p(3,3),p(3,4),p(3,5),p(5,3),p(5,4),p(5,5)],[e,o,o.levelStory]},Tt=()=>{const e=G(),o=N(9,"Crush and Rush","Clear the path with your crushing power!");e.player=F(0,4),e.goal=S(8,4),e.monsters=[P(4,4)],e.bonuses=[D(2,4,d.Crusher)],e.obstacles=[p(8,2),p(7,2),p(7,3),p(7,4),p(7,5),p(8,5)];for(let s=2;s<7;s++)e.obstacles.push(p(s,3)),e.obstacles.push(p(s-1,5));return[e,o,o.levelStory]},Mt=()=>{const e=G(),o=N(10,"Tick Tock Boom","Time your bomb perfectly to clear the way!");e.player=F(0,5),e.goal=S(9,5),e.monsters=[P(3,5)],e.bonuses=[D(8,3,d.TimeBomb)],e.obstacles=[p(9,4),p(8,4),p(8,5),p(8,6),p(9,6),p(2,1),p(3,1),p(4,1),p(5,1),p(6,1),p(7,1),p(8,1)];for(let s=2;s<8;s++)e.obstacles.push(p(s,4)),e.obstacles.push(p(s,6)),e.obstacles.push(p(s-2,8));return o.monsterSpawnSectors=[S(1,9)],[e,o,o.levelStory]},Ct=()=>{const e=G(),o=N(10,"Minesweeper's Revenge","Plant a surprise for your pursuers!");e.player=F(0,5),e.goal=S(9,5),e.monsters=[P(6,5),P(4,8),P(8,8)],e.bonuses=[D(2,5,d.LandMine)];for(let s=4;s<9;s++)s!==6&&(e.obstacles.push(p(s,4)),e.obstacles.push(p(s,6)));return[e,o,o.levelStory]},Pt=()=>{const e=G(),o=N(11,"Monsters' Mayhem","Confuse them all and make your escape!");e.player=F(0,5),e.goal=S(10,5),e.monsters=[P(3,4),P(3,6),P(6,4),P(6,6)],e.bonuses=[D(2,5,d.ConfusedMonsters)];for(let s=4;s<8;s++)e.obstacles.push(p(s,3)),e.obstacles.push(p(s,7));return[e,o,o.levelStory]},kt=()=>{const e=G(),o=N(12,"Tunnel Vision","Build a path and set a trap!");e.player=F(0,6),e.goal=S(11,6),e.monsters=[],e.bonuses=[D(2,6,d.Builder),D(5,6,d.LandMine),D(5,5,d.Sokoban)];for(let s=3;s<10;s++)s!==5&&s!==8&&(e.obstacles.push(p(s,5)),e.obstacles.push(p(s,7)));return e.obstacles.push(p(1,4)),e.obstacles.push(p(1,8)),e.obstacles.push(p(10,4)),e.obstacles.push(p(10,8)),e.obstacles.push(p(11,5)),e.obstacles.push(p(11,7)),o.monsterSpawnSectors=[S(0,0)],[e,o,"Use the Builder bonus to create a path and set up a trap with the Land Mine. Be strategic about where you place your obstacles and mine to catch the spawning monsters!"]},It=()=>{const e=G(),o=N(12,"Ghost Bomber","Vanish, plant, and detonate!");e.player=F(0,6),e.goal=S(11,6),e.monsters=[P(3,1),P(7,11),P(10,3)],e.bonuses=[D(2,6,d.CapOfInvisibility),D(9,6,d.TimeBomb),D(7,4,d.CapOfInvisibility)];for(let s=2;s<11;s+=2)for(let t=1;t<12;t+=2)!(s===10&&t===5)&&!(s===10&&t===7)&&e.obstacles.push(p(s,t));return e.obstacles.push(p(11,5)),e.obstacles.push(p(10,6)),e.obstacles.push(p(11,7)),e.obstacles.push(p(10,8)),e.obstacles.push(p(1,3)),e.obstacles.push(p(1,9)),e.obstacles.push(p(5,6)),e.obstacles.push(p(8,4)),e.obstacles.push(p(8,8)),[e,o,"Use your invisibility wisely to sneak past the monsters and reach the time bomb. Then, strategically place and detonate the bomb to clear a path to the goal!"]},jt=()=>{const e=G(),o=N(13,"Surf and Climb","Ride the wave and climb to safety!");e.player=F(0,6),e.goal=S(12,6),e.monsters=[P(4,6),P(8,6),P(11,6),P(6,2),P(6,10)],e.bonuses=[D(2,6,d.Tsunami),D(4,4,d.Climber)];for(let s=1;s<12;s++)s!==2&&s!==10&&(e.obstacles.push(p(s,5)),e.obstacles.push(p(s,7)));e.obstacles.push(p(3,6)),e.obstacles.push(p(6,6)),e.obstacles.push(p(9,6));for(let s=0;s<13;s+=3)e.obstacles.push(p(s,0)),e.obstacles.push(p(s,12));return e.obstacles.push(p(11,5)),e.obstacles.push(p(11,7)),[e,o,"Collect the Tsunami bonus first, then make your way to the Climber bonus. Use the Climber to get on top of an obstacle, then activate the Tsunami to wash away the monsters. Time it right to reach the goal!"]},Dt=()=>{const e=G(),o=N(14,"Slide and Blast","Slide through danger and blast your way to victory!");e.player=F(0,0),e.goal=S(13,13),e.monsters=[P(3,3),P(10,10),P(6,7),P(7,6),P(13,0)],e.bonuses=[D(0,2,d.Blaster),D(0,13,d.Slide)];for(let s=2;s<12;s+=3)for(let t=0;t<14;t++)t!==7&&e.obstacles.push(p(s,t));return e.obstacles.push(p(12,1)),e.obstacles.push(p(12,2)),e.obstacles.push(p(11,1)),e.obstacles.push(p(0,6)),e.obstacles.push(p(1,1)),e.obstacles.push(p(4,4)),e.obstacles.push(p(9,9)),e.obstacles.push(p(12,10)),[e,o,"Navigate to the Slide bonus to quickly traverse the level. Then, collect the Blaster to destroy the wall blocking your path to the goal. Watch out for monsters and use your bonuses strategically!"]},St=()=>{const e=G(),o=N(15,"The Gauntlet","Master all your skills to conquer the final challenge!");e.player=F(0,7),e.goal=S(14,7),e.monsters=[P(5,2),P(5,12),P(10,4),P(10,10),P(14,0),P(14,14)],e.bonuses=[D(2,7,d.CapOfInvisibility),D(4,7,d.Crusher),D(7,3,d.TimeBomb),D(7,11,d.LandMine),D(10,7,d.Blaster),D(12,7,d.Climber)];for(let s=1;s<14;s++)s%3!==1&&(e.obstacles.push(p(s,6)),e.obstacles.push(p(s,8)));for(let s=0;s<15;s+=3)if(s!==6&&s!==9)for(let t=0;t<15;t++)t!==7&&e.obstacles.push(p(s,t));return e.obstacles.push(p(3,5)),e.obstacles.push(p(3,9)),e.obstacles.push(p(7,5)),e.obstacles.push(p(7,9)),e.obstacles.push(p(11,5)),e.obstacles.push(p(11,9)),e.obstacles.push(p(13,6)),e.obstacles.push(p(13,8)),e.obstacles.push(p(14,6)),e.obstacles.push(p(14,8)),[e,o,"This is your final test! Use all the skills you've learned to navigate through the gauntlet. Collect bonuses strategically, avoid or eliminate monsters, and make your way to the goal. Good luck!"]},W=16,Se=5;function de(){return{x:Math.floor(Math.random()*W),y:Math.floor(Math.random()*W)}}function Ee(e,o){return Math.abs(e.x-o.x)+Math.abs(e.y-o.y)}function pe(e,o){return!o.obstacles.some(s=>s.position.x===e.x&&s.position.y===e.y)&&!o.monsters.some(s=>s.position.x===e.x&&s.position.y===e.y)&&!o.bonuses.some(s=>s.position.x===e.x&&s.position.y===e.y)&&e.x!==o.player.position.x&&e.y!==o.player.position.y&&e.x!==o.goal.x&&e.y!==o.goal.y}function Et(e,o){for(let s=0;s<o;s++){let t;do t=de();while(!pe(t,e));e.obstacles.push(p(t.x,t.y))}}function Lt(e){const o=Object.values(d).filter(n=>typeof n=="number"),s=o[Math.floor(Math.random()*o.length)];let t;do t=de();while(!pe(t,e)||Ee(t,e.player.position)<Se);e.bonuses.push(D(t.x,t.y,s))}const Bt=()=>{const e=G(),o=N(W,"The Final Countdown","Survive and thrive in this ever-changing challenge!",At);e.player=F(0,0),e.goal=S(W-1,W-1),e.obstacles=[p(W-2,W-2),p(W-1,W-2),p(W-2,W-1)],Et(e,50);for(let s=0;s<3;s++)Lt(e);return[e,o,"Welcome to the ultimate challenge! The level will dynamically evolve as you play. Use your skills wisely, collect bonuses, and make your way to the goal while avoiding the increasing dangers. Good luck!"]},At=(e,o)=>{if(e.steps%13===0){let s;do s=de();while(!pe(s,e)||Ee(s,e.player.position)<Se);e.monsters.push(P(s.x,s.y)),tt(e,o)}},S=(e,o)=>({x:e,y:o}),D=(e,o,s)=>({position:S(e,o),type:s}),P=(e,o)=>({position:S(e,o),previousPosition:S(e,o),moveTimestamp:Date.now(),path:[],seed:Math.random(),isConfused:!1}),F=(e,o)=>({position:S(e,o),previousPosition:S(e,o),moveTimestamp:Date.now(),isVictorious:!1,isVanishing:!1}),p=(e,o)=>({position:S(e,o),creationTime:Date.now(),isRaising:!1,isDestroying:!1}),G=()=>({player:F(0,0),goal:S(0,0),obstacles:[],monsters:[],steps:0,monsterSpawnSteps:0,bonuses:[],activeBonuses:[],explosions:[],timeBombs:[],landMines:[],score:0,gameEndingState:"none",tsunamiLevel:0,blasterShots:[]}),Ot=40,N=(e,o,s,t=bt)=>({gridSize:e,cellSize:Ot,initialMonsterCount:0,monsterSpawnSectors:[],obstacleCount:0,initialBonusCount:0,levelName:o,levelStory:s,levelUpdater:t}),Rt={1:gt,2:wt,3:vt,4:Tt,5:Mt,6:Ct,7:Pt,8:kt,9:It,10:jt,11:Dt,12:St,13:Bt},Ft=e=>{if(e<1||e>13)throw new Error(`Invalid level number: ${e}`);return Rt[e]()},Gt=13,Nt=2e3,Vt=({level:e,score:o,onGameOver:s,onLevelComplete:t,onGameComplete:n,updateScore:i,updateSteps:r})=>{const l=A.useRef(null),[[a,u,c],m]=A.useState(()=>Ft(e)),[f,M]=A.useState(!0),T=y=>{m([y,u,c]),i(y.score),r(y.steps)};return A.useEffect(()=>{a.gameEndingState!=="none"&&setTimeout(()=>{a.gameEndingState==="levelComplete"&&(e===Gt?n():t()),a.gameEndingState==="gameOver"&&s()},Nt)},[a.gameEndingState]),A.useEffect(()=>{if(!a||!u)return;const y=l.current;let v;if(y){const k=(u.gridSize+u.gridSize)*u.cellSize,j=(u.gridSize+u.gridSize)*u.cellSize/2;y.width=k,y.height=j+100;const I=y.getContext("2d");if(I){const E=()=>{Ce(I,a,u),J(a)||_o(I,Pe(a,u),u.gridSize,u.cellSize),v=requestAnimationFrame(E)};E()}}return()=>{v!==null&&cancelAnimationFrame(v)}},[a,u,f]),A.useEffect(()=>{if(!a||!u)return;const y=k=>{if(f){M(!1);return}if(!J(a)){const j=ct(k,a,u);T(j)}},v=k=>{if(f){M(!1);return}if(J(a))return;const j=l.current;if(!j)return;const I=j.getBoundingClientRect(),E=Uo((k.clientX-I.left)*(j.width/I.width)-j.width/2,(k.clientY-I.top)*(j.height/I.height)-100,a,u);E&&T(De(E.direction,a,u))};return window.addEventListener("click",v),window.addEventListener("keydown",y),()=>{window.removeEventListener("click",v),window.removeEventListener("keydown",y)}},[a,u,f,s,t,i,r]),f?h.jsxs("div",{className:"level-story",children:[h.jsxs("h2",{children:["Level ",e]}),h.jsx("p",{children:c}),h.jsx("p",{children:"Press any key to start..."})]}):h.jsxs("div",{className:"gameplay",children:[h.jsx(dt,{level:e,score:o,steps:(a==null?void 0:a.monsterSpawnSteps)||0}),h.jsx("div",{className:"canvas-container",children:h.jsx("canvas",{ref:l})})]})},Wt=({score:e,steps:o,onTryAgain:s,onQuit:t})=>h.jsxs("div",{className:"game-over",children:[h.jsx("h1",{children:"Game Over"}),h.jsxs("p",{children:["Your score: ",e]}),h.jsxs("p",{children:["Steps taken: ",o]}),h.jsx("button",{onClick:s,children:"Try Again"}),h.jsx("button",{onClick:t,children:"Quit"})]}),Ut=({level:e,onNextLevel:o,onQuit:s})=>h.jsxs("div",{className:"level-complete",children:[h.jsxs("h1",{children:["Level ",e," Complete!"]}),h.jsx("p",{children:"Congratulations! You've completed the level."}),h.jsx("button",{onClick:o,children:"Next Level"}),h.jsx("button",{onClick:s,children:"Quit"})]});function Xt(){const[e,o]=A.useState(0),[s,t]=A.useState(parseInt(document.location.hash.split("level")[1]??"1")),[n,i]=A.useState(0),[r,l]=A.useState(0),a=A.useCallback(()=>{o(2)},[]),u=()=>{o(1)},c=()=>{t(1),i(0),l(0),o(2)},m=()=>{o(2)},f=()=>{o(0)},M=()=>{o(3)},T=()=>{t(s+1),o(4)},y=A.useCallback(()=>{o(2)},[]),v=()=>{U.playLevelComplete(),o(5)},k=I=>i(I),j=I=>l(I);return A.useEffect(()=>{const I=E=>{E.key==="ArrowRight"?e===0?a():e===4?y():e===3?m():e===5&&c():E.key==="Escape"&&(e===1||e===3||e===5)&&f()};return window.addEventListener("keydown",I),()=>{window.removeEventListener("keydown",I)}},[e,a,y]),h.jsxs("div",{className:"game-container",children:[e===0&&h.jsx(Go,{onStart:a,onInstructions:u}),e===1&&h.jsx(No,{onBack:f}),e===2&&h.jsx(Vt,{level:s,score:n,onGameOver:M,onLevelComplete:T,onGameComplete:v,updateScore:k,updateSteps:j}),e===3&&h.jsx(Wt,{score:n,steps:r,onTryAgain:m,onQuit:f}),e===4&&h.jsx(Ut,{level:s,onNextLevel:y,onQuit:f}),e===5&&h.jsx(Yt,{score:n,steps:r,onPlayAgain:c,onQuit:f})]})}function Yt({score:e,steps:o,onPlayAgain:s,onQuit:t}){return h.jsxs("div",{className:"game-complete intro",children:[h.jsx("h1",{className:"game-title",children:"Monster Steps"}),h.jsx("h2",{className:"game-complete-subtitle",children:"Congratulations!"}),h.jsxs("div",{className:"game-complete-stats",children:[h.jsxs("p",{children:["Final Score: ",e]}),h.jsxs("p",{children:["Total Steps: ",o]})]}),h.jsxs("div",{className:"intro-buttons",children:[h.jsx("button",{onClick:s,children:"Play Again"}),h.jsx("button",{onClick:t,children:"Quit"})]}),h.jsx("p",{className:"intro-tip",children:"Press right arrow to play again"})]})}export{Xt as MonsterStepsApp};
