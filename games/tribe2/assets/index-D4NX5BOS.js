var UC=Object.defineProperty;var HC=(e,t,n)=>t in e?UC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var De=(e,t,n)=>HC(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function Yv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fh={exports:{}},ol={},Lh={exports:{}},Ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xy;function GC(){if(xy)return Ye;xy=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.iterator;function S(F){return F===null||typeof F!="object"?null:(F=m&&F[m]||F["@@iterator"],typeof F=="function"?F:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,A={};function _(F,z,ue){this.props=F,this.context=z,this.refs=A,this.updater=ue||v}_.prototype.isReactComponent={},_.prototype.setState=function(F,z){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,z,"setState")},_.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function R(){}R.prototype=_.prototype;function P(F,z,ue){this.props=F,this.context=z,this.refs=A,this.updater=ue||v}var w=P.prototype=new R;w.constructor=P,I(w,_.prototype),w.isPureReactComponent=!0;var b=Array.isArray,N=Object.prototype.hasOwnProperty,D={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function k(F,z,ue){var pe,Pe={},ye=null,Oe=null;if(z!=null)for(pe in z.ref!==void 0&&(Oe=z.ref),z.key!==void 0&&(ye=""+z.key),z)N.call(z,pe)&&!M.hasOwnProperty(pe)&&(Pe[pe]=z[pe]);var Ne=arguments.length-2;if(Ne===1)Pe.children=ue;else if(1<Ne){for(var he=Array(Ne),ve=0;ve<Ne;ve++)he[ve]=arguments[ve+2];Pe.children=he}if(F&&F.defaultProps)for(pe in Ne=F.defaultProps,Ne)Pe[pe]===void 0&&(Pe[pe]=Ne[pe]);return{$$typeof:e,type:F,key:ye,ref:Oe,props:Pe,_owner:D.current}}function U(F,z){return{$$typeof:e,type:F.type,key:z,ref:F.ref,props:F.props,_owner:F._owner}}function j(F){return typeof F=="object"&&F!==null&&F.$$typeof===e}function K(F){var z={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(ue){return z[ue]})}var X=/\/+/g;function J(F,z){return typeof F=="object"&&F!==null&&F.key!=null?K(""+F.key):z.toString(36)}function Z(F,z,ue,pe,Pe){var ye=typeof F;(ye==="undefined"||ye==="boolean")&&(F=null);var Oe=!1;if(F===null)Oe=!0;else switch(ye){case"string":case"number":Oe=!0;break;case"object":switch(F.$$typeof){case e:case t:Oe=!0}}if(Oe)return Oe=F,Pe=Pe(Oe),F=pe===""?"."+J(Oe,0):pe,b(Pe)?(ue="",F!=null&&(ue=F.replace(X,"$&/")+"/"),Z(Pe,z,ue,"",function(ve){return ve})):Pe!=null&&(j(Pe)&&(Pe=U(Pe,ue+(!Pe.key||Oe&&Oe.key===Pe.key?"":(""+Pe.key).replace(X,"$&/")+"/")+F)),z.push(Pe)),1;if(Oe=0,pe=pe===""?".":pe+":",b(F))for(var Ne=0;Ne<F.length;Ne++){ye=F[Ne];var he=pe+J(ye,Ne);Oe+=Z(ye,z,ue,he,Pe)}else if(he=S(F),typeof he=="function")for(F=he.call(F),Ne=0;!(ye=F.next()).done;)ye=ye.value,he=pe+J(ye,Ne++),Oe+=Z(ye,z,ue,he,Pe);else if(ye==="object")throw z=String(F),Error("Objects are not valid as a React child (found: "+(z==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":z)+"). If you meant to render a collection of children, use an array instead.");return Oe}function le(F,z,ue){if(F==null)return F;var pe=[],Pe=0;return Z(F,pe,"","",function(ye){return z.call(ue,ye,Pe++)}),pe}function re(F){if(F._status===-1){var z=F._result;z=z(),z.then(function(ue){(F._status===0||F._status===-1)&&(F._status=1,F._result=ue)},function(ue){(F._status===0||F._status===-1)&&(F._status=2,F._result=ue)}),F._status===-1&&(F._status=0,F._result=z)}if(F._status===1)return F._result.default;throw F._result}var te={current:null},Y={transition:null},V={ReactCurrentDispatcher:te,ReactCurrentBatchConfig:Y,ReactCurrentOwner:D};function q(){throw Error("act(...) is not supported in production builds of React.")}return Ye.Children={map:le,forEach:function(F,z,ue){le(F,function(){z.apply(this,arguments)},ue)},count:function(F){var z=0;return le(F,function(){z++}),z},toArray:function(F){return le(F,function(z){return z})||[]},only:function(F){if(!j(F))throw Error("React.Children.only expected to receive a single React element child.");return F}},Ye.Component=_,Ye.Fragment=n,Ye.Profiler=s,Ye.PureComponent=P,Ye.StrictMode=i,Ye.Suspense=u,Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,Ye.act=q,Ye.cloneElement=function(F,z,ue){if(F==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+F+".");var pe=I({},F.props),Pe=F.key,ye=F.ref,Oe=F._owner;if(z!=null){if(z.ref!==void 0&&(ye=z.ref,Oe=D.current),z.key!==void 0&&(Pe=""+z.key),F.type&&F.type.defaultProps)var Ne=F.type.defaultProps;for(he in z)N.call(z,he)&&!M.hasOwnProperty(he)&&(pe[he]=z[he]===void 0&&Ne!==void 0?Ne[he]:z[he])}var he=arguments.length-2;if(he===1)pe.children=ue;else if(1<he){Ne=Array(he);for(var ve=0;ve<he;ve++)Ne[ve]=arguments[ve+2];pe.children=Ne}return{$$typeof:e,type:F.type,key:Pe,ref:ye,props:pe,_owner:Oe}},Ye.createContext=function(F){return F={$$typeof:l,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},F.Provider={$$typeof:a,_context:F},F.Consumer=F},Ye.createElement=k,Ye.createFactory=function(F){var z=k.bind(null,F);return z.type=F,z},Ye.createRef=function(){return{current:null}},Ye.forwardRef=function(F){return{$$typeof:d,render:F}},Ye.isValidElement=j,Ye.lazy=function(F){return{$$typeof:g,_payload:{_status:-1,_result:F},_init:re}},Ye.memo=function(F,z){return{$$typeof:f,type:F,compare:z===void 0?null:z}},Ye.startTransition=function(F){var z=Y.transition;Y.transition={};try{F()}finally{Y.transition=z}},Ye.unstable_act=q,Ye.useCallback=function(F,z){return te.current.useCallback(F,z)},Ye.useContext=function(F){return te.current.useContext(F)},Ye.useDebugValue=function(){},Ye.useDeferredValue=function(F){return te.current.useDeferredValue(F)},Ye.useEffect=function(F,z){return te.current.useEffect(F,z)},Ye.useId=function(){return te.current.useId()},Ye.useImperativeHandle=function(F,z,ue){return te.current.useImperativeHandle(F,z,ue)},Ye.useInsertionEffect=function(F,z){return te.current.useInsertionEffect(F,z)},Ye.useLayoutEffect=function(F,z){return te.current.useLayoutEffect(F,z)},Ye.useMemo=function(F,z){return te.current.useMemo(F,z)},Ye.useReducer=function(F,z,ue){return te.current.useReducer(F,z,ue)},Ye.useRef=function(F){return te.current.useRef(F)},Ye.useState=function(F){return te.current.useState(F)},Ye.useSyncExternalStore=function(F,z,ue){return te.current.useSyncExternalStore(F,z,ue)},Ye.useTransition=function(){return te.current.useTransition()},Ye.version="18.3.1",Ye}var Wy;function ep(){return Wy||(Wy=1,Lh.exports=GC()),Lh.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Yy;function $C(){if(Yy)return ol;Yy=1;var e=ep(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(d,u,f){var g,m={},S=null,v=null;f!==void 0&&(S=""+f),u.key!==void 0&&(S=""+u.key),u.ref!==void 0&&(v=u.ref);for(g in u)i.call(u,g)&&!a.hasOwnProperty(g)&&(m[g]=u[g]);if(d&&d.defaultProps)for(g in u=d.defaultProps,u)m[g]===void 0&&(m[g]=u[g]);return{$$typeof:t,type:d,key:S,ref:v,props:m,_owner:s.current}}return ol.Fragment=n,ol.jsx=l,ol.jsxs=l,ol}var zy;function xC(){return zy||(zy=1,Fh.exports=$C()),Fh.exports}var Ue=xC(),Fe=ep();const Bi=Yv(Fe);var pd={},Uh={exports:{}},Pn={},Hh={exports:{}},Gh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jy;function WC(){return jy||(jy=1,function(e){function t(Y,V){var q=Y.length;Y.push(V);e:for(;0<q;){var F=q-1>>>1,z=Y[F];if(0<s(z,V))Y[F]=V,Y[q]=z,q=F;else break e}}function n(Y){return Y.length===0?null:Y[0]}function i(Y){if(Y.length===0)return null;var V=Y[0],q=Y.pop();if(q!==V){Y[0]=q;e:for(var F=0,z=Y.length,ue=z>>>1;F<ue;){var pe=2*(F+1)-1,Pe=Y[pe],ye=pe+1,Oe=Y[ye];if(0>s(Pe,q))ye<z&&0>s(Oe,Pe)?(Y[F]=Oe,Y[ye]=q,F=ye):(Y[F]=Pe,Y[pe]=q,F=pe);else if(ye<z&&0>s(Oe,q))Y[F]=Oe,Y[ye]=q,F=ye;else break e}}return V}function s(Y,V){var q=Y.sortIndex-V.sortIndex;return q!==0?q:Y.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var l=Date,d=l.now();e.unstable_now=function(){return l.now()-d}}var u=[],f=[],g=1,m=null,S=3,v=!1,I=!1,A=!1,_=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(Y){for(var V=n(f);V!==null;){if(V.callback===null)i(f);else if(V.startTime<=Y)i(f),V.sortIndex=V.expirationTime,t(u,V);else break;V=n(f)}}function b(Y){if(A=!1,w(Y),!I)if(n(u)!==null)I=!0,re(N);else{var V=n(f);V!==null&&te(b,V.startTime-Y)}}function N(Y,V){I=!1,A&&(A=!1,R(k),k=-1),v=!0;var q=S;try{for(w(V),m=n(u);m!==null&&(!(m.expirationTime>V)||Y&&!K());){var F=m.callback;if(typeof F=="function"){m.callback=null,S=m.priorityLevel;var z=F(m.expirationTime<=V);V=e.unstable_now(),typeof z=="function"?m.callback=z:m===n(u)&&i(u),w(V)}else i(u);m=n(u)}if(m!==null)var ue=!0;else{var pe=n(f);pe!==null&&te(b,pe.startTime-V),ue=!1}return ue}finally{m=null,S=q,v=!1}}var D=!1,M=null,k=-1,U=5,j=-1;function K(){return!(e.unstable_now()-j<U)}function X(){if(M!==null){var Y=e.unstable_now();j=Y;var V=!0;try{V=M(!0,Y)}finally{V?J():(D=!1,M=null)}}else D=!1}var J;if(typeof P=="function")J=function(){P(X)};else if(typeof MessageChannel<"u"){var Z=new MessageChannel,le=Z.port2;Z.port1.onmessage=X,J=function(){le.postMessage(null)}}else J=function(){_(X,0)};function re(Y){M=Y,D||(D=!0,J())}function te(Y,V){k=_(function(){Y(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Y){Y.callback=null},e.unstable_continueExecution=function(){I||v||(I=!0,re(N))},e.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<Y?Math.floor(1e3/Y):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(Y){switch(S){case 1:case 2:case 3:var V=3;break;default:V=S}var q=S;S=V;try{return Y()}finally{S=q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Y,V){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var q=S;S=Y;try{return V()}finally{S=q}},e.unstable_scheduleCallback=function(Y,V,q){var F=e.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?F+q:F):q=F,Y){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=q+z,Y={id:g++,callback:V,priorityLevel:Y,startTime:q,expirationTime:z,sortIndex:-1},q>F?(Y.sortIndex=q,t(f,Y),n(u)===null&&Y===n(f)&&(A?(R(k),k=-1):A=!0,te(b,q-F))):(Y.sortIndex=z,t(u,Y),I||v||(I=!0,re(N))),Y},e.unstable_shouldYield=K,e.unstable_wrapCallback=function(Y){var V=S;return function(){var q=S;S=V;try{return Y.apply(this,arguments)}finally{S=q}}}}(Gh)),Gh}var Xy;function YC(){return Xy||(Xy=1,Hh.exports=WC()),Hh.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vy;function zC(){if(Vy)return Pn;Vy=1;var e=ep(),t=YC();function n(o){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+o,c=1;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+o+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function a(o,r){l(o,r),l(o+"Capture",r)}function l(o,r){for(s[o]=r,o=0;o<r.length;o++)i.add(r[o])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},m={};function S(o){return u.call(m,o)?!0:u.call(g,o)?!1:f.test(o)?m[o]=!0:(g[o]=!0,!1)}function v(o,r,c,h){if(c!==null&&c.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return h?!1:c!==null?!c.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function I(o,r,c,h){if(r===null||typeof r>"u"||v(o,r,c,h))return!0;if(h)return!1;if(c!==null)switch(c.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function A(o,r,c,h,p,y,C){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=h,this.attributeNamespace=p,this.mustUseProperty=c,this.propertyName=o,this.type=r,this.sanitizeURL=y,this.removeEmptyString=C}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){_[o]=new A(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var r=o[0];_[r]=new A(r,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){_[o]=new A(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){_[o]=new A(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){_[o]=new A(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){_[o]=new A(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){_[o]=new A(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){_[o]=new A(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){_[o]=new A(o,5,!1,o.toLowerCase(),null,!1,!1)});var R=/[\-:]([a-z])/g;function P(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var r=o.replace(R,P);_[r]=new A(r,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var r=o.replace(R,P);_[r]=new A(r,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var r=o.replace(R,P);_[r]=new A(r,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){_[o]=new A(o,1,!1,o.toLowerCase(),null,!1,!1)}),_.xlinkHref=new A("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){_[o]=new A(o,1,!1,o.toLowerCase(),null,!0,!0)});function w(o,r,c,h){var p=_.hasOwnProperty(r)?_[r]:null;(p!==null?p.type!==0:h||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(I(r,c,p,h)&&(c=null),h||p===null?S(r)&&(c===null?o.removeAttribute(r):o.setAttribute(r,""+c)):p.mustUseProperty?o[p.propertyName]=c===null?p.type===3?!1:"":c:(r=p.attributeName,h=p.attributeNamespace,c===null?o.removeAttribute(r):(p=p.type,c=p===3||p===4&&c===!0?"":""+c,h?o.setAttributeNS(h,r,c):o.setAttribute(r,c))))}var b=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,N=Symbol.for("react.element"),D=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),j=Symbol.for("react.provider"),K=Symbol.for("react.context"),X=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),Z=Symbol.for("react.suspense_list"),le=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),te=Symbol.for("react.offscreen"),Y=Symbol.iterator;function V(o){return o===null||typeof o!="object"?null:(o=Y&&o[Y]||o["@@iterator"],typeof o=="function"?o:null)}var q=Object.assign,F;function z(o){if(F===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);F=r&&r[1]||""}return`
`+F+o}var ue=!1;function pe(o,r){if(!o||ue)return"";ue=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(W){var h=W}Reflect.construct(o,[],r)}else{try{r.call()}catch(W){h=W}o.call(r.prototype)}else{try{throw Error()}catch(W){h=W}o()}}catch(W){if(W&&h&&typeof W.stack=="string"){for(var p=W.stack.split(`
`),y=h.stack.split(`
`),C=p.length-1,O=y.length-1;1<=C&&0<=O&&p[C]!==y[O];)O--;for(;1<=C&&0<=O;C--,O--)if(p[C]!==y[O]){if(C!==1||O!==1)do if(C--,O--,0>O||p[C]!==y[O]){var B=`
`+p[C].replace(" at new "," at ");return o.displayName&&B.includes("<anonymous>")&&(B=B.replace("<anonymous>",o.displayName)),B}while(1<=C&&0<=O);break}}}finally{ue=!1,Error.prepareStackTrace=c}return(o=o?o.displayName||o.name:"")?z(o):""}function Pe(o){switch(o.tag){case 5:return z(o.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return o=pe(o.type,!1),o;case 11:return o=pe(o.type.render,!1),o;case 1:return o=pe(o.type,!0),o;default:return""}}function ye(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case M:return"Fragment";case D:return"Portal";case U:return"Profiler";case k:return"StrictMode";case J:return"Suspense";case Z:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case K:return(o.displayName||"Context")+".Consumer";case j:return(o._context.displayName||"Context")+".Provider";case X:var r=o.render;return o=o.displayName,o||(o=r.displayName||r.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case le:return r=o.displayName||null,r!==null?r:ye(o.type)||"Memo";case re:r=o._payload,o=o._init;try{return ye(o(r))}catch{}}return null}function Oe(o){var r=o.type;switch(o.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=r.render,o=o.displayName||o.name||"",r.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ye(r);case 8:return r===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Ne(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function he(o){var r=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function ve(o){var r=he(o)?"checked":"value",c=Object.getOwnPropertyDescriptor(o.constructor.prototype,r),h=""+o[r];if(!o.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,y=c.set;return Object.defineProperty(o,r,{configurable:!0,get:function(){return p.call(this)},set:function(C){h=""+C,y.call(this,C)}}),Object.defineProperty(o,r,{enumerable:c.enumerable}),{getValue:function(){return h},setValue:function(C){h=""+C},stopTracking:function(){o._valueTracker=null,delete o[r]}}}}function xe(o){o._valueTracker||(o._valueTracker=ve(o))}function Te(o){if(!o)return!1;var r=o._valueTracker;if(!r)return!0;var c=r.getValue(),h="";return o&&(h=he(o)?o.checked?"true":"false":o.value),o=h,o!==c?(r.setValue(o),!0):!1}function ai(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function nt(o,r){var c=r.checked;return q({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??o._wrapperState.initialChecked})}function at(o,r){var c=r.defaultValue==null?"":r.defaultValue,h=r.checked!=null?r.checked:r.defaultChecked;c=Ne(r.value!=null?r.value:c),o._wrapperState={initialChecked:h,initialValue:c,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function vi(o,r){r=r.checked,r!=null&&w(o,"checked",r,!1)}function Tn(o,r){vi(o,r);var c=Ne(r.value),h=r.type;if(c!=null)h==="number"?(c===0&&o.value===""||o.value!=c)&&(o.value=""+c):o.value!==""+c&&(o.value=""+c);else if(h==="submit"||h==="reset"){o.removeAttribute("value");return}r.hasOwnProperty("value")?Ai(o,r.type,c):r.hasOwnProperty("defaultValue")&&Ai(o,r.type,Ne(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(o.defaultChecked=!!r.defaultChecked)}function Xn(o,r,c){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var h=r.type;if(!(h!=="submit"&&h!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+o._wrapperState.initialValue,c||r===o.value||(o.value=r),o.defaultValue=r}c=o.name,c!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,c!==""&&(o.name=c)}function Ai(o,r,c){(r!=="number"||ai(o.ownerDocument)!==o)&&(c==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+c&&(o.defaultValue=""+c))}var Ii=Array.isArray;function go(o,r,c,h){if(o=o.options,r){r={};for(var p=0;p<c.length;p++)r["$"+c[p]]=!0;for(c=0;c<o.length;c++)p=r.hasOwnProperty("$"+o[c].value),o[c].selected!==p&&(o[c].selected=p),p&&h&&(o[c].defaultSelected=!0)}else{for(c=""+Ne(c),r=null,p=0;p<o.length;p++){if(o[p].value===c){o[p].selected=!0,h&&(o[p].defaultSelected=!0);return}r!==null||o[p].disabled||(r=o[p])}r!==null&&(r.selected=!0)}}function sr(o,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return q({},r,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function Qp(o,r){var c=r.value;if(c==null){if(c=r.children,r=r.defaultValue,c!=null){if(r!=null)throw Error(n(92));if(Ii(c)){if(1<c.length)throw Error(n(93));c=c[0]}r=c}r==null&&(r=""),c=r}o._wrapperState={initialValue:Ne(c)}}function Jp(o,r){var c=Ne(r.value),h=Ne(r.defaultValue);c!=null&&(c=""+c,c!==o.value&&(o.value=c),r.defaultValue==null&&o.defaultValue!==c&&(o.defaultValue=c)),h!=null&&(o.defaultValue=""+h)}function em(o){var r=o.textContent;r===o._wrapperState.initialValue&&r!==""&&r!==null&&(o.value=r)}function tm(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ju(o,r){return o==null||o==="http://www.w3.org/1999/xhtml"?tm(r):o==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var ac,nm=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,c,h,p){MSApp.execUnsafeLocalFunction(function(){return o(r,c,h,p)})}:o}(function(o,r){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=r;else{for(ac=ac||document.createElement("div"),ac.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=ac.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;r.firstChild;)o.appendChild(r.firstChild)}});function Aa(o,r){if(r){var c=o.firstChild;if(c&&c===o.lastChild&&c.nodeType===3){c.nodeValue=r;return}}o.textContent=r}var Ia={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xT=["Webkit","ms","Moz","O"];Object.keys(Ia).forEach(function(o){xT.forEach(function(r){r=r+o.charAt(0).toUpperCase()+o.substring(1),Ia[r]=Ia[o]})});function im(o,r,c){return r==null||typeof r=="boolean"||r===""?"":c||typeof r!="number"||r===0||Ia.hasOwnProperty(o)&&Ia[o]?(""+r).trim():r+"px"}function om(o,r){o=o.style;for(var c in r)if(r.hasOwnProperty(c)){var h=c.indexOf("--")===0,p=im(c,r[c],h);c==="float"&&(c="cssFloat"),h?o.setProperty(c,p):o[c]=p}}var WT=q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xu(o,r){if(r){if(WT[o]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,o));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function Vu(o,r){if(o.indexOf("-")===-1)return typeof r.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ku=null;function qu(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Zu=null,Jr=null,es=null;function rm(o){if(o=Wa(o)){if(typeof Zu!="function")throw Error(n(280));var r=o.stateNode;r&&(r=Nc(r),Zu(o.stateNode,o.type,r))}}function sm(o){Jr?es?es.push(o):es=[o]:Jr=o}function am(){if(Jr){var o=Jr,r=es;if(es=Jr=null,rm(o),r)for(o=0;o<r.length;o++)rm(r[o])}}function lm(o,r){return o(r)}function cm(){}var Qu=!1;function dm(o,r,c){if(Qu)return o(r,c);Qu=!0;try{return lm(o,r,c)}finally{Qu=!1,(Jr!==null||es!==null)&&(cm(),am())}}function Ta(o,r){var c=o.stateNode;if(c===null)return null;var h=Nc(c);if(h===null)return null;c=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(o=o.type,h=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!h;break e;default:o=!1}if(o)return null;if(c&&typeof c!="function")throw Error(n(231,r,typeof c));return c}var Ju=!1;if(d)try{var Ea={};Object.defineProperty(Ea,"passive",{get:function(){Ju=!0}}),window.addEventListener("test",Ea,Ea),window.removeEventListener("test",Ea,Ea)}catch{Ju=!1}function YT(o,r,c,h,p,y,C,O,B){var W=Array.prototype.slice.call(arguments,3);try{r.apply(c,W)}catch(ee){this.onError(ee)}}var Ca=!1,lc=null,cc=!1,ef=null,zT={onError:function(o){Ca=!0,lc=o}};function jT(o,r,c,h,p,y,C,O,B){Ca=!1,lc=null,YT.apply(zT,arguments)}function XT(o,r,c,h,p,y,C,O,B){if(jT.apply(this,arguments),Ca){if(Ca){var W=lc;Ca=!1,lc=null}else throw Error(n(198));cc||(cc=!0,ef=W)}}function ar(o){var r=o,c=o;if(o.alternate)for(;r.return;)r=r.return;else{o=r;do r=o,(r.flags&4098)!==0&&(c=r.return),o=r.return;while(o)}return r.tag===3?c:null}function um(o){if(o.tag===13){var r=o.memoizedState;if(r===null&&(o=o.alternate,o!==null&&(r=o.memoizedState)),r!==null)return r.dehydrated}return null}function fm(o){if(ar(o)!==o)throw Error(n(188))}function VT(o){var r=o.alternate;if(!r){if(r=ar(o),r===null)throw Error(n(188));return r!==o?null:o}for(var c=o,h=r;;){var p=c.return;if(p===null)break;var y=p.alternate;if(y===null){if(h=p.return,h!==null){c=h;continue}break}if(p.child===y.child){for(y=p.child;y;){if(y===c)return fm(p),o;if(y===h)return fm(p),r;y=y.sibling}throw Error(n(188))}if(c.return!==h.return)c=p,h=y;else{for(var C=!1,O=p.child;O;){if(O===c){C=!0,c=p,h=y;break}if(O===h){C=!0,h=p,c=y;break}O=O.sibling}if(!C){for(O=y.child;O;){if(O===c){C=!0,c=y,h=p;break}if(O===h){C=!0,h=y,c=p;break}O=O.sibling}if(!C)throw Error(n(189))}}if(c.alternate!==h)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?o:r}function hm(o){return o=VT(o),o!==null?gm(o):null}function gm(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var r=gm(o);if(r!==null)return r;o=o.sibling}return null}var pm=t.unstable_scheduleCallback,mm=t.unstable_cancelCallback,KT=t.unstable_shouldYield,qT=t.unstable_requestPaint,It=t.unstable_now,ZT=t.unstable_getCurrentPriorityLevel,tf=t.unstable_ImmediatePriority,ym=t.unstable_UserBlockingPriority,dc=t.unstable_NormalPriority,QT=t.unstable_LowPriority,Sm=t.unstable_IdlePriority,uc=null,Ti=null;function JT(o){if(Ti&&typeof Ti.onCommitFiberRoot=="function")try{Ti.onCommitFiberRoot(uc,o,void 0,(o.current.flags&128)===128)}catch{}}var li=Math.clz32?Math.clz32:nE,eE=Math.log,tE=Math.LN2;function nE(o){return o>>>=0,o===0?32:31-(eE(o)/tE|0)|0}var fc=64,hc=4194304;function _a(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function gc(o,r){var c=o.pendingLanes;if(c===0)return 0;var h=0,p=o.suspendedLanes,y=o.pingedLanes,C=c&268435455;if(C!==0){var O=C&~p;O!==0?h=_a(O):(y&=C,y!==0&&(h=_a(y)))}else C=c&~p,C!==0?h=_a(C):y!==0&&(h=_a(y));if(h===0)return 0;if(r!==0&&r!==h&&(r&p)===0&&(p=h&-h,y=r&-r,p>=y||p===16&&(y&4194240)!==0))return r;if((h&4)!==0&&(h|=c&16),r=o.entangledLanes,r!==0)for(o=o.entanglements,r&=h;0<r;)c=31-li(r),p=1<<c,h|=o[c],r&=~p;return h}function iE(o,r){switch(o){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function oE(o,r){for(var c=o.suspendedLanes,h=o.pingedLanes,p=o.expirationTimes,y=o.pendingLanes;0<y;){var C=31-li(y),O=1<<C,B=p[C];B===-1?((O&c)===0||(O&h)!==0)&&(p[C]=iE(O,r)):B<=r&&(o.expiredLanes|=O),y&=~O}}function nf(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function vm(){var o=fc;return fc<<=1,(fc&4194240)===0&&(fc=64),o}function of(o){for(var r=[],c=0;31>c;c++)r.push(o);return r}function wa(o,r,c){o.pendingLanes|=r,r!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,r=31-li(r),o[r]=c}function rE(o,r){var c=o.pendingLanes&~r;o.pendingLanes=r,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=r,o.mutableReadLanes&=r,o.entangledLanes&=r,r=o.entanglements;var h=o.eventTimes;for(o=o.expirationTimes;0<c;){var p=31-li(c),y=1<<p;r[p]=0,h[p]=-1,o[p]=-1,c&=~y}}function rf(o,r){var c=o.entangledLanes|=r;for(o=o.entanglements;c;){var h=31-li(c),p=1<<h;p&r|o[h]&r&&(o[h]|=r),c&=~p}}var tt=0;function Am(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var Im,sf,Tm,Em,Cm,af=!1,pc=[],po=null,mo=null,yo=null,Ra=new Map,Pa=new Map,So=[],sE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _m(o,r){switch(o){case"focusin":case"focusout":po=null;break;case"dragenter":case"dragleave":mo=null;break;case"mouseover":case"mouseout":yo=null;break;case"pointerover":case"pointerout":Ra.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pa.delete(r.pointerId)}}function Da(o,r,c,h,p,y){return o===null||o.nativeEvent!==y?(o={blockedOn:r,domEventName:c,eventSystemFlags:h,nativeEvent:y,targetContainers:[p]},r!==null&&(r=Wa(r),r!==null&&sf(r)),o):(o.eventSystemFlags|=h,r=o.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),o)}function aE(o,r,c,h,p){switch(r){case"focusin":return po=Da(po,o,r,c,h,p),!0;case"dragenter":return mo=Da(mo,o,r,c,h,p),!0;case"mouseover":return yo=Da(yo,o,r,c,h,p),!0;case"pointerover":var y=p.pointerId;return Ra.set(y,Da(Ra.get(y)||null,o,r,c,h,p)),!0;case"gotpointercapture":return y=p.pointerId,Pa.set(y,Da(Pa.get(y)||null,o,r,c,h,p)),!0}return!1}function wm(o){var r=lr(o.target);if(r!==null){var c=ar(r);if(c!==null){if(r=c.tag,r===13){if(r=um(c),r!==null){o.blockedOn=r,Cm(o.priority,function(){Tm(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){o.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}o.blockedOn=null}function mc(o){if(o.blockedOn!==null)return!1;for(var r=o.targetContainers;0<r.length;){var c=cf(o.domEventName,o.eventSystemFlags,r[0],o.nativeEvent);if(c===null){c=o.nativeEvent;var h=new c.constructor(c.type,c);Ku=h,c.target.dispatchEvent(h),Ku=null}else return r=Wa(c),r!==null&&sf(r),o.blockedOn=c,!1;r.shift()}return!0}function Rm(o,r,c){mc(o)&&c.delete(r)}function lE(){af=!1,po!==null&&mc(po)&&(po=null),mo!==null&&mc(mo)&&(mo=null),yo!==null&&mc(yo)&&(yo=null),Ra.forEach(Rm),Pa.forEach(Rm)}function Na(o,r){o.blockedOn===r&&(o.blockedOn=null,af||(af=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,lE)))}function Ma(o){function r(p){return Na(p,o)}if(0<pc.length){Na(pc[0],o);for(var c=1;c<pc.length;c++){var h=pc[c];h.blockedOn===o&&(h.blockedOn=null)}}for(po!==null&&Na(po,o),mo!==null&&Na(mo,o),yo!==null&&Na(yo,o),Ra.forEach(r),Pa.forEach(r),c=0;c<So.length;c++)h=So[c],h.blockedOn===o&&(h.blockedOn=null);for(;0<So.length&&(c=So[0],c.blockedOn===null);)wm(c),c.blockedOn===null&&So.shift()}var ts=b.ReactCurrentBatchConfig,yc=!0;function cE(o,r,c,h){var p=tt,y=ts.transition;ts.transition=null;try{tt=1,lf(o,r,c,h)}finally{tt=p,ts.transition=y}}function dE(o,r,c,h){var p=tt,y=ts.transition;ts.transition=null;try{tt=4,lf(o,r,c,h)}finally{tt=p,ts.transition=y}}function lf(o,r,c,h){if(yc){var p=cf(o,r,c,h);if(p===null)wf(o,r,h,Sc,c),_m(o,h);else if(aE(p,o,r,c,h))h.stopPropagation();else if(_m(o,h),r&4&&-1<sE.indexOf(o)){for(;p!==null;){var y=Wa(p);if(y!==null&&Im(y),y=cf(o,r,c,h),y===null&&wf(o,r,h,Sc,c),y===p)break;p=y}p!==null&&h.stopPropagation()}else wf(o,r,h,null,c)}}var Sc=null;function cf(o,r,c,h){if(Sc=null,o=qu(h),o=lr(o),o!==null)if(r=ar(o),r===null)o=null;else if(c=r.tag,c===13){if(o=um(r),o!==null)return o;o=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;o=null}else r!==o&&(o=null);return Sc=o,null}function Pm(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ZT()){case tf:return 1;case ym:return 4;case dc:case QT:return 16;case Sm:return 536870912;default:return 16}default:return 16}}var vo=null,df=null,vc=null;function Dm(){if(vc)return vc;var o,r=df,c=r.length,h,p="value"in vo?vo.value:vo.textContent,y=p.length;for(o=0;o<c&&r[o]===p[o];o++);var C=c-o;for(h=1;h<=C&&r[c-h]===p[y-h];h++);return vc=p.slice(o,1<h?1-h:void 0)}function Ac(o){var r=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&r===13&&(o=13)):o=r,o===10&&(o=13),32<=o||o===13?o:0}function Ic(){return!0}function Nm(){return!1}function bn(o){function r(c,h,p,y,C){this._reactName=c,this._targetInst=p,this.type=h,this.nativeEvent=y,this.target=C,this.currentTarget=null;for(var O in o)o.hasOwnProperty(O)&&(c=o[O],this[O]=c?c(y):y[O]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Ic:Nm,this.isPropagationStopped=Nm,this}return q(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Ic)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Ic)},persist:function(){},isPersistent:Ic}),r}var ns={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uf=bn(ns),Oa=q({},ns,{view:0,detail:0}),uE=bn(Oa),ff,hf,ba,Tc=q({},Oa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pf,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==ba&&(ba&&o.type==="mousemove"?(ff=o.screenX-ba.screenX,hf=o.screenY-ba.screenY):hf=ff=0,ba=o),ff)},movementY:function(o){return"movementY"in o?o.movementY:hf}}),Mm=bn(Tc),fE=q({},Tc,{dataTransfer:0}),hE=bn(fE),gE=q({},Oa,{relatedTarget:0}),gf=bn(gE),pE=q({},ns,{animationName:0,elapsedTime:0,pseudoElement:0}),mE=bn(pE),yE=q({},ns,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),SE=bn(yE),vE=q({},ns,{data:0}),Om=bn(vE),AE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},TE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function EE(o){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(o):(o=TE[o])?!!r[o]:!1}function pf(){return EE}var CE=q({},Oa,{key:function(o){if(o.key){var r=AE[o.key]||o.key;if(r!=="Unidentified")return r}return o.type==="keypress"?(o=Ac(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?IE[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pf,charCode:function(o){return o.type==="keypress"?Ac(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Ac(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),_E=bn(CE),wE=q({},Tc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),bm=bn(wE),RE=q({},Oa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pf}),PE=bn(RE),DE=q({},ns,{propertyName:0,elapsedTime:0,pseudoElement:0}),NE=bn(DE),ME=q({},Tc,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),OE=bn(ME),bE=[9,13,27,32],mf=d&&"CompositionEvent"in window,ka=null;d&&"documentMode"in document&&(ka=document.documentMode);var kE=d&&"TextEvent"in window&&!ka,km=d&&(!mf||ka&&8<ka&&11>=ka),Bm=" ",Fm=!1;function Lm(o,r){switch(o){case"keyup":return bE.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Um(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var is=!1;function BE(o,r){switch(o){case"compositionend":return Um(r);case"keypress":return r.which!==32?null:(Fm=!0,Bm);case"textInput":return o=r.data,o===Bm&&Fm?null:o;default:return null}}function FE(o,r){if(is)return o==="compositionend"||!mf&&Lm(o,r)?(o=Dm(),vc=df=vo=null,is=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return km&&r.locale!=="ko"?null:r.data;default:return null}}var LE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hm(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r==="input"?!!LE[o.type]:r==="textarea"}function Gm(o,r,c,h){sm(h),r=Rc(r,"onChange"),0<r.length&&(c=new uf("onChange","change",null,c,h),o.push({event:c,listeners:r}))}var Ba=null,Fa=null;function UE(o){o0(o,0)}function Ec(o){var r=ls(o);if(Te(r))return o}function HE(o,r){if(o==="change")return r}var $m=!1;if(d){var yf;if(d){var Sf="oninput"in document;if(!Sf){var xm=document.createElement("div");xm.setAttribute("oninput","return;"),Sf=typeof xm.oninput=="function"}yf=Sf}else yf=!1;$m=yf&&(!document.documentMode||9<document.documentMode)}function Wm(){Ba&&(Ba.detachEvent("onpropertychange",Ym),Fa=Ba=null)}function Ym(o){if(o.propertyName==="value"&&Ec(Fa)){var r=[];Gm(r,Fa,o,qu(o)),dm(UE,r)}}function GE(o,r,c){o==="focusin"?(Wm(),Ba=r,Fa=c,Ba.attachEvent("onpropertychange",Ym)):o==="focusout"&&Wm()}function $E(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Ec(Fa)}function xE(o,r){if(o==="click")return Ec(r)}function WE(o,r){if(o==="input"||o==="change")return Ec(r)}function YE(o,r){return o===r&&(o!==0||1/o===1/r)||o!==o&&r!==r}var ci=typeof Object.is=="function"?Object.is:YE;function La(o,r){if(ci(o,r))return!0;if(typeof o!="object"||o===null||typeof r!="object"||r===null)return!1;var c=Object.keys(o),h=Object.keys(r);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var p=c[h];if(!u.call(r,p)||!ci(o[p],r[p]))return!1}return!0}function zm(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function jm(o,r){var c=zm(o);o=0;for(var h;c;){if(c.nodeType===3){if(h=o+c.textContent.length,o<=r&&h>=r)return{node:c,offset:r-o};o=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=zm(c)}}function Xm(o,r){return o&&r?o===r?!0:o&&o.nodeType===3?!1:r&&r.nodeType===3?Xm(o,r.parentNode):"contains"in o?o.contains(r):o.compareDocumentPosition?!!(o.compareDocumentPosition(r)&16):!1:!1}function Vm(){for(var o=window,r=ai();r instanceof o.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)o=r.contentWindow;else break;r=ai(o.document)}return r}function vf(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r&&(r==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||r==="textarea"||o.contentEditable==="true")}function zE(o){var r=Vm(),c=o.focusedElem,h=o.selectionRange;if(r!==c&&c&&c.ownerDocument&&Xm(c.ownerDocument.documentElement,c)){if(h!==null&&vf(c)){if(r=h.start,o=h.end,o===void 0&&(o=r),"selectionStart"in c)c.selectionStart=r,c.selectionEnd=Math.min(o,c.value.length);else if(o=(r=c.ownerDocument||document)&&r.defaultView||window,o.getSelection){o=o.getSelection();var p=c.textContent.length,y=Math.min(h.start,p);h=h.end===void 0?y:Math.min(h.end,p),!o.extend&&y>h&&(p=h,h=y,y=p),p=jm(c,y);var C=jm(c,h);p&&C&&(o.rangeCount!==1||o.anchorNode!==p.node||o.anchorOffset!==p.offset||o.focusNode!==C.node||o.focusOffset!==C.offset)&&(r=r.createRange(),r.setStart(p.node,p.offset),o.removeAllRanges(),y>h?(o.addRange(r),o.extend(C.node,C.offset)):(r.setEnd(C.node,C.offset),o.addRange(r)))}}for(r=[],o=c;o=o.parentNode;)o.nodeType===1&&r.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<r.length;c++)o=r[c],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var jE=d&&"documentMode"in document&&11>=document.documentMode,os=null,Af=null,Ua=null,If=!1;function Km(o,r,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;If||os==null||os!==ai(h)||(h=os,"selectionStart"in h&&vf(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Ua&&La(Ua,h)||(Ua=h,h=Rc(Af,"onSelect"),0<h.length&&(r=new uf("onSelect","select",null,r,c),o.push({event:r,listeners:h}),r.target=os)))}function Cc(o,r){var c={};return c[o.toLowerCase()]=r.toLowerCase(),c["Webkit"+o]="webkit"+r,c["Moz"+o]="moz"+r,c}var rs={animationend:Cc("Animation","AnimationEnd"),animationiteration:Cc("Animation","AnimationIteration"),animationstart:Cc("Animation","AnimationStart"),transitionend:Cc("Transition","TransitionEnd")},Tf={},qm={};d&&(qm=document.createElement("div").style,"AnimationEvent"in window||(delete rs.animationend.animation,delete rs.animationiteration.animation,delete rs.animationstart.animation),"TransitionEvent"in window||delete rs.transitionend.transition);function _c(o){if(Tf[o])return Tf[o];if(!rs[o])return o;var r=rs[o],c;for(c in r)if(r.hasOwnProperty(c)&&c in qm)return Tf[o]=r[c];return o}var Zm=_c("animationend"),Qm=_c("animationiteration"),Jm=_c("animationstart"),e0=_c("transitionend"),t0=new Map,n0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ao(o,r){t0.set(o,r),a(r,[o])}for(var Ef=0;Ef<n0.length;Ef++){var Cf=n0[Ef],XE=Cf.toLowerCase(),VE=Cf[0].toUpperCase()+Cf.slice(1);Ao(XE,"on"+VE)}Ao(Zm,"onAnimationEnd"),Ao(Qm,"onAnimationIteration"),Ao(Jm,"onAnimationStart"),Ao("dblclick","onDoubleClick"),Ao("focusin","onFocus"),Ao("focusout","onBlur"),Ao(e0,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ha="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),KE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ha));function i0(o,r,c){var h=o.type||"unknown-event";o.currentTarget=c,XT(h,r,void 0,o),o.currentTarget=null}function o0(o,r){r=(r&4)!==0;for(var c=0;c<o.length;c++){var h=o[c],p=h.event;h=h.listeners;e:{var y=void 0;if(r)for(var C=h.length-1;0<=C;C--){var O=h[C],B=O.instance,W=O.currentTarget;if(O=O.listener,B!==y&&p.isPropagationStopped())break e;i0(p,O,W),y=B}else for(C=0;C<h.length;C++){if(O=h[C],B=O.instance,W=O.currentTarget,O=O.listener,B!==y&&p.isPropagationStopped())break e;i0(p,O,W),y=B}}}if(cc)throw o=ef,cc=!1,ef=null,o}function lt(o,r){var c=r[Of];c===void 0&&(c=r[Of]=new Set);var h=o+"__bubble";c.has(h)||(r0(r,o,2,!1),c.add(h))}function _f(o,r,c){var h=0;r&&(h|=4),r0(c,o,h,r)}var wc="_reactListening"+Math.random().toString(36).slice(2);function Ga(o){if(!o[wc]){o[wc]=!0,i.forEach(function(c){c!=="selectionchange"&&(KE.has(c)||_f(c,!1,o),_f(c,!0,o))});var r=o.nodeType===9?o:o.ownerDocument;r===null||r[wc]||(r[wc]=!0,_f("selectionchange",!1,r))}}function r0(o,r,c,h){switch(Pm(r)){case 1:var p=cE;break;case 4:p=dE;break;default:p=lf}c=p.bind(null,r,c,o),p=void 0,!Ju||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),h?p!==void 0?o.addEventListener(r,c,{capture:!0,passive:p}):o.addEventListener(r,c,!0):p!==void 0?o.addEventListener(r,c,{passive:p}):o.addEventListener(r,c,!1)}function wf(o,r,c,h,p){var y=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var C=h.tag;if(C===3||C===4){var O=h.stateNode.containerInfo;if(O===p||O.nodeType===8&&O.parentNode===p)break;if(C===4)for(C=h.return;C!==null;){var B=C.tag;if((B===3||B===4)&&(B=C.stateNode.containerInfo,B===p||B.nodeType===8&&B.parentNode===p))return;C=C.return}for(;O!==null;){if(C=lr(O),C===null)return;if(B=C.tag,B===5||B===6){h=y=C;continue e}O=O.parentNode}}h=h.return}dm(function(){var W=y,ee=qu(c),ne=[];e:{var Q=t0.get(o);if(Q!==void 0){var me=uf,Ae=o;switch(o){case"keypress":if(Ac(c)===0)break e;case"keydown":case"keyup":me=_E;break;case"focusin":Ae="focus",me=gf;break;case"focusout":Ae="blur",me=gf;break;case"beforeblur":case"afterblur":me=gf;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":me=Mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":me=hE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":me=PE;break;case Zm:case Qm:case Jm:me=mE;break;case e0:me=NE;break;case"scroll":me=uE;break;case"wheel":me=OE;break;case"copy":case"cut":case"paste":me=SE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":me=bm}var Ee=(r&4)!==0,Tt=!Ee&&o==="scroll",$=Ee?Q!==null?Q+"Capture":null:Q;Ee=[];for(var L=W,x;L!==null;){x=L;var ie=x.stateNode;if(x.tag===5&&ie!==null&&(x=ie,$!==null&&(ie=Ta(L,$),ie!=null&&Ee.push($a(L,ie,x)))),Tt)break;L=L.return}0<Ee.length&&(Q=new me(Q,Ae,null,c,ee),ne.push({event:Q,listeners:Ee}))}}if((r&7)===0){e:{if(Q=o==="mouseover"||o==="pointerover",me=o==="mouseout"||o==="pointerout",Q&&c!==Ku&&(Ae=c.relatedTarget||c.fromElement)&&(lr(Ae)||Ae[$i]))break e;if((me||Q)&&(Q=ee.window===ee?ee:(Q=ee.ownerDocument)?Q.defaultView||Q.parentWindow:window,me?(Ae=c.relatedTarget||c.toElement,me=W,Ae=Ae?lr(Ae):null,Ae!==null&&(Tt=ar(Ae),Ae!==Tt||Ae.tag!==5&&Ae.tag!==6)&&(Ae=null)):(me=null,Ae=W),me!==Ae)){if(Ee=Mm,ie="onMouseLeave",$="onMouseEnter",L="mouse",(o==="pointerout"||o==="pointerover")&&(Ee=bm,ie="onPointerLeave",$="onPointerEnter",L="pointer"),Tt=me==null?Q:ls(me),x=Ae==null?Q:ls(Ae),Q=new Ee(ie,L+"leave",me,c,ee),Q.target=Tt,Q.relatedTarget=x,ie=null,lr(ee)===W&&(Ee=new Ee($,L+"enter",Ae,c,ee),Ee.target=x,Ee.relatedTarget=Tt,ie=Ee),Tt=ie,me&&Ae)t:{for(Ee=me,$=Ae,L=0,x=Ee;x;x=ss(x))L++;for(x=0,ie=$;ie;ie=ss(ie))x++;for(;0<L-x;)Ee=ss(Ee),L--;for(;0<x-L;)$=ss($),x--;for(;L--;){if(Ee===$||$!==null&&Ee===$.alternate)break t;Ee=ss(Ee),$=ss($)}Ee=null}else Ee=null;me!==null&&s0(ne,Q,me,Ee,!1),Ae!==null&&Tt!==null&&s0(ne,Tt,Ae,Ee,!0)}}e:{if(Q=W?ls(W):window,me=Q.nodeName&&Q.nodeName.toLowerCase(),me==="select"||me==="input"&&Q.type==="file")var we=HE;else if(Hm(Q))if($m)we=WE;else{we=$E;var be=GE}else(me=Q.nodeName)&&me.toLowerCase()==="input"&&(Q.type==="checkbox"||Q.type==="radio")&&(we=xE);if(we&&(we=we(o,W))){Gm(ne,we,c,ee);break e}be&&be(o,Q,W),o==="focusout"&&(be=Q._wrapperState)&&be.controlled&&Q.type==="number"&&Ai(Q,"number",Q.value)}switch(be=W?ls(W):window,o){case"focusin":(Hm(be)||be.contentEditable==="true")&&(os=be,Af=W,Ua=null);break;case"focusout":Ua=Af=os=null;break;case"mousedown":If=!0;break;case"contextmenu":case"mouseup":case"dragend":If=!1,Km(ne,c,ee);break;case"selectionchange":if(jE)break;case"keydown":case"keyup":Km(ne,c,ee)}var ke;if(mf)e:{switch(o){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else is?Lm(o,c)&&(He="onCompositionEnd"):o==="keydown"&&c.keyCode===229&&(He="onCompositionStart");He&&(km&&c.locale!=="ko"&&(is||He!=="onCompositionStart"?He==="onCompositionEnd"&&is&&(ke=Dm()):(vo=ee,df="value"in vo?vo.value:vo.textContent,is=!0)),be=Rc(W,He),0<be.length&&(He=new Om(He,o,null,c,ee),ne.push({event:He,listeners:be}),ke?He.data=ke:(ke=Um(c),ke!==null&&(He.data=ke)))),(ke=kE?BE(o,c):FE(o,c))&&(W=Rc(W,"onBeforeInput"),0<W.length&&(ee=new Om("onBeforeInput","beforeinput",null,c,ee),ne.push({event:ee,listeners:W}),ee.data=ke))}o0(ne,r)})}function $a(o,r,c){return{instance:o,listener:r,currentTarget:c}}function Rc(o,r){for(var c=r+"Capture",h=[];o!==null;){var p=o,y=p.stateNode;p.tag===5&&y!==null&&(p=y,y=Ta(o,c),y!=null&&h.unshift($a(o,y,p)),y=Ta(o,r),y!=null&&h.push($a(o,y,p))),o=o.return}return h}function ss(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function s0(o,r,c,h,p){for(var y=r._reactName,C=[];c!==null&&c!==h;){var O=c,B=O.alternate,W=O.stateNode;if(B!==null&&B===h)break;O.tag===5&&W!==null&&(O=W,p?(B=Ta(c,y),B!=null&&C.unshift($a(c,B,O))):p||(B=Ta(c,y),B!=null&&C.push($a(c,B,O)))),c=c.return}C.length!==0&&o.push({event:r,listeners:C})}var qE=/\r\n?/g,ZE=/\u0000|\uFFFD/g;function a0(o){return(typeof o=="string"?o:""+o).replace(qE,`
`).replace(ZE,"")}function Pc(o,r,c){if(r=a0(r),a0(o)!==r&&c)throw Error(n(425))}function Dc(){}var Rf=null,Pf=null;function Df(o,r){return o==="textarea"||o==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Nf=typeof setTimeout=="function"?setTimeout:void 0,QE=typeof clearTimeout=="function"?clearTimeout:void 0,l0=typeof Promise=="function"?Promise:void 0,JE=typeof queueMicrotask=="function"?queueMicrotask:typeof l0<"u"?function(o){return l0.resolve(null).then(o).catch(eC)}:Nf;function eC(o){setTimeout(function(){throw o})}function Mf(o,r){var c=r,h=0;do{var p=c.nextSibling;if(o.removeChild(c),p&&p.nodeType===8)if(c=p.data,c==="/$"){if(h===0){o.removeChild(p),Ma(r);return}h--}else c!=="$"&&c!=="$?"&&c!=="$!"||h++;c=p}while(c);Ma(r)}function Io(o){for(;o!=null;o=o.nextSibling){var r=o.nodeType;if(r===1||r===3)break;if(r===8){if(r=o.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return o}function c0(o){o=o.previousSibling;for(var r=0;o;){if(o.nodeType===8){var c=o.data;if(c==="$"||c==="$!"||c==="$?"){if(r===0)return o;r--}else c==="/$"&&r++}o=o.previousSibling}return null}var as=Math.random().toString(36).slice(2),Ei="__reactFiber$"+as,xa="__reactProps$"+as,$i="__reactContainer$"+as,Of="__reactEvents$"+as,tC="__reactListeners$"+as,nC="__reactHandles$"+as;function lr(o){var r=o[Ei];if(r)return r;for(var c=o.parentNode;c;){if(r=c[$i]||c[Ei]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(o=c0(o);o!==null;){if(c=o[Ei])return c;o=c0(o)}return r}o=c,c=o.parentNode}return null}function Wa(o){return o=o[Ei]||o[$i],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function ls(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(n(33))}function Nc(o){return o[xa]||null}var bf=[],cs=-1;function To(o){return{current:o}}function ct(o){0>cs||(o.current=bf[cs],bf[cs]=null,cs--)}function st(o,r){cs++,bf[cs]=o.current,o.current=r}var Eo={},Jt=To(Eo),En=To(!1),cr=Eo;function ds(o,r){var c=o.type.contextTypes;if(!c)return Eo;var h=o.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===r)return h.__reactInternalMemoizedMaskedChildContext;var p={},y;for(y in c)p[y]=r[y];return h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=r,o.__reactInternalMemoizedMaskedChildContext=p),p}function Cn(o){return o=o.childContextTypes,o!=null}function Mc(){ct(En),ct(Jt)}function d0(o,r,c){if(Jt.current!==Eo)throw Error(n(168));st(Jt,r),st(En,c)}function u0(o,r,c){var h=o.stateNode;if(r=r.childContextTypes,typeof h.getChildContext!="function")return c;h=h.getChildContext();for(var p in h)if(!(p in r))throw Error(n(108,Oe(o)||"Unknown",p));return q({},c,h)}function Oc(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||Eo,cr=Jt.current,st(Jt,o),st(En,En.current),!0}function f0(o,r,c){var h=o.stateNode;if(!h)throw Error(n(169));c?(o=u0(o,r,cr),h.__reactInternalMemoizedMergedChildContext=o,ct(En),ct(Jt),st(Jt,o)):ct(En),st(En,c)}var xi=null,bc=!1,kf=!1;function h0(o){xi===null?xi=[o]:xi.push(o)}function iC(o){bc=!0,h0(o)}function Co(){if(!kf&&xi!==null){kf=!0;var o=0,r=tt;try{var c=xi;for(tt=1;o<c.length;o++){var h=c[o];do h=h(!0);while(h!==null)}xi=null,bc=!1}catch(p){throw xi!==null&&(xi=xi.slice(o+1)),pm(tf,Co),p}finally{tt=r,kf=!1}}return null}var us=[],fs=0,kc=null,Bc=0,Vn=[],Kn=0,dr=null,Wi=1,Yi="";function ur(o,r){us[fs++]=Bc,us[fs++]=kc,kc=o,Bc=r}function g0(o,r,c){Vn[Kn++]=Wi,Vn[Kn++]=Yi,Vn[Kn++]=dr,dr=o;var h=Wi;o=Yi;var p=32-li(h)-1;h&=~(1<<p),c+=1;var y=32-li(r)+p;if(30<y){var C=p-p%5;y=(h&(1<<C)-1).toString(32),h>>=C,p-=C,Wi=1<<32-li(r)+p|c<<p|h,Yi=y+o}else Wi=1<<y|c<<p|h,Yi=o}function Bf(o){o.return!==null&&(ur(o,1),g0(o,1,0))}function Ff(o){for(;o===kc;)kc=us[--fs],us[fs]=null,Bc=us[--fs],us[fs]=null;for(;o===dr;)dr=Vn[--Kn],Vn[Kn]=null,Yi=Vn[--Kn],Vn[Kn]=null,Wi=Vn[--Kn],Vn[Kn]=null}var kn=null,Bn=null,ut=!1,di=null;function p0(o,r){var c=Jn(5,null,null,0);c.elementType="DELETED",c.stateNode=r,c.return=o,r=o.deletions,r===null?(o.deletions=[c],o.flags|=16):r.push(c)}function m0(o,r){switch(o.tag){case 5:var c=o.type;return r=r.nodeType!==1||c.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(o.stateNode=r,kn=o,Bn=Io(r.firstChild),!0):!1;case 6:return r=o.pendingProps===""||r.nodeType!==3?null:r,r!==null?(o.stateNode=r,kn=o,Bn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(c=dr!==null?{id:Wi,overflow:Yi}:null,o.memoizedState={dehydrated:r,treeContext:c,retryLane:1073741824},c=Jn(18,null,null,0),c.stateNode=r,c.return=o,o.child=c,kn=o,Bn=null,!0):!1;default:return!1}}function Lf(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Uf(o){if(ut){var r=Bn;if(r){var c=r;if(!m0(o,r)){if(Lf(o))throw Error(n(418));r=Io(c.nextSibling);var h=kn;r&&m0(o,r)?p0(h,c):(o.flags=o.flags&-4097|2,ut=!1,kn=o)}}else{if(Lf(o))throw Error(n(418));o.flags=o.flags&-4097|2,ut=!1,kn=o}}}function y0(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;kn=o}function Fc(o){if(o!==kn)return!1;if(!ut)return y0(o),ut=!0,!1;var r;if((r=o.tag!==3)&&!(r=o.tag!==5)&&(r=o.type,r=r!=="head"&&r!=="body"&&!Df(o.type,o.memoizedProps)),r&&(r=Bn)){if(Lf(o))throw S0(),Error(n(418));for(;r;)p0(o,r),r=Io(r.nextSibling)}if(y0(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,r=0;o;){if(o.nodeType===8){var c=o.data;if(c==="/$"){if(r===0){Bn=Io(o.nextSibling);break e}r--}else c!=="$"&&c!=="$!"&&c!=="$?"||r++}o=o.nextSibling}Bn=null}}else Bn=kn?Io(o.stateNode.nextSibling):null;return!0}function S0(){for(var o=Bn;o;)o=Io(o.nextSibling)}function hs(){Bn=kn=null,ut=!1}function Hf(o){di===null?di=[o]:di.push(o)}var oC=b.ReactCurrentBatchConfig;function Ya(o,r,c){if(o=c.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(n(309));var h=c.stateNode}if(!h)throw Error(n(147,o));var p=h,y=""+o;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===y?r.ref:(r=function(C){var O=p.refs;C===null?delete O[y]:O[y]=C},r._stringRef=y,r)}if(typeof o!="string")throw Error(n(284));if(!c._owner)throw Error(n(290,o))}return o}function Lc(o,r){throw o=Object.prototype.toString.call(r),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o))}function v0(o){var r=o._init;return r(o._payload)}function A0(o){function r($,L){if(o){var x=$.deletions;x===null?($.deletions=[L],$.flags|=16):x.push(L)}}function c($,L){if(!o)return null;for(;L!==null;)r($,L),L=L.sibling;return null}function h($,L){for($=new Map;L!==null;)L.key!==null?$.set(L.key,L):$.set(L.index,L),L=L.sibling;return $}function p($,L){return $=Oo($,L),$.index=0,$.sibling=null,$}function y($,L,x){return $.index=x,o?(x=$.alternate,x!==null?(x=x.index,x<L?($.flags|=2,L):x):($.flags|=2,L)):($.flags|=1048576,L)}function C($){return o&&$.alternate===null&&($.flags|=2),$}function O($,L,x,ie){return L===null||L.tag!==6?(L=Nh(x,$.mode,ie),L.return=$,L):(L=p(L,x),L.return=$,L)}function B($,L,x,ie){var we=x.type;return we===M?ee($,L,x.props.children,ie,x.key):L!==null&&(L.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===re&&v0(we)===L.type)?(ie=p(L,x.props),ie.ref=Ya($,L,x),ie.return=$,ie):(ie=ad(x.type,x.key,x.props,null,$.mode,ie),ie.ref=Ya($,L,x),ie.return=$,ie)}function W($,L,x,ie){return L===null||L.tag!==4||L.stateNode.containerInfo!==x.containerInfo||L.stateNode.implementation!==x.implementation?(L=Mh(x,$.mode,ie),L.return=$,L):(L=p(L,x.children||[]),L.return=$,L)}function ee($,L,x,ie,we){return L===null||L.tag!==7?(L=vr(x,$.mode,ie,we),L.return=$,L):(L=p(L,x),L.return=$,L)}function ne($,L,x){if(typeof L=="string"&&L!==""||typeof L=="number")return L=Nh(""+L,$.mode,x),L.return=$,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case N:return x=ad(L.type,L.key,L.props,null,$.mode,x),x.ref=Ya($,null,L),x.return=$,x;case D:return L=Mh(L,$.mode,x),L.return=$,L;case re:var ie=L._init;return ne($,ie(L._payload),x)}if(Ii(L)||V(L))return L=vr(L,$.mode,x,null),L.return=$,L;Lc($,L)}return null}function Q($,L,x,ie){var we=L!==null?L.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return we!==null?null:O($,L,""+x,ie);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case N:return x.key===we?B($,L,x,ie):null;case D:return x.key===we?W($,L,x,ie):null;case re:return we=x._init,Q($,L,we(x._payload),ie)}if(Ii(x)||V(x))return we!==null?null:ee($,L,x,ie,null);Lc($,x)}return null}function me($,L,x,ie,we){if(typeof ie=="string"&&ie!==""||typeof ie=="number")return $=$.get(x)||null,O(L,$,""+ie,we);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case N:return $=$.get(ie.key===null?x:ie.key)||null,B(L,$,ie,we);case D:return $=$.get(ie.key===null?x:ie.key)||null,W(L,$,ie,we);case re:var be=ie._init;return me($,L,x,be(ie._payload),we)}if(Ii(ie)||V(ie))return $=$.get(x)||null,ee(L,$,ie,we,null);Lc(L,ie)}return null}function Ae($,L,x,ie){for(var we=null,be=null,ke=L,He=L=0,Ft=null;ke!==null&&He<x.length;He++){ke.index>He?(Ft=ke,ke=null):Ft=ke.sibling;var qe=Q($,ke,x[He],ie);if(qe===null){ke===null&&(ke=Ft);break}o&&ke&&qe.alternate===null&&r($,ke),L=y(qe,L,He),be===null?we=qe:be.sibling=qe,be=qe,ke=Ft}if(He===x.length)return c($,ke),ut&&ur($,He),we;if(ke===null){for(;He<x.length;He++)ke=ne($,x[He],ie),ke!==null&&(L=y(ke,L,He),be===null?we=ke:be.sibling=ke,be=ke);return ut&&ur($,He),we}for(ke=h($,ke);He<x.length;He++)Ft=me(ke,$,He,x[He],ie),Ft!==null&&(o&&Ft.alternate!==null&&ke.delete(Ft.key===null?He:Ft.key),L=y(Ft,L,He),be===null?we=Ft:be.sibling=Ft,be=Ft);return o&&ke.forEach(function(bo){return r($,bo)}),ut&&ur($,He),we}function Ee($,L,x,ie){var we=V(x);if(typeof we!="function")throw Error(n(150));if(x=we.call(x),x==null)throw Error(n(151));for(var be=we=null,ke=L,He=L=0,Ft=null,qe=x.next();ke!==null&&!qe.done;He++,qe=x.next()){ke.index>He?(Ft=ke,ke=null):Ft=ke.sibling;var bo=Q($,ke,qe.value,ie);if(bo===null){ke===null&&(ke=Ft);break}o&&ke&&bo.alternate===null&&r($,ke),L=y(bo,L,He),be===null?we=bo:be.sibling=bo,be=bo,ke=Ft}if(qe.done)return c($,ke),ut&&ur($,He),we;if(ke===null){for(;!qe.done;He++,qe=x.next())qe=ne($,qe.value,ie),qe!==null&&(L=y(qe,L,He),be===null?we=qe:be.sibling=qe,be=qe);return ut&&ur($,He),we}for(ke=h($,ke);!qe.done;He++,qe=x.next())qe=me(ke,$,He,qe.value,ie),qe!==null&&(o&&qe.alternate!==null&&ke.delete(qe.key===null?He:qe.key),L=y(qe,L,He),be===null?we=qe:be.sibling=qe,be=qe);return o&&ke.forEach(function(LC){return r($,LC)}),ut&&ur($,He),we}function Tt($,L,x,ie){if(typeof x=="object"&&x!==null&&x.type===M&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case N:e:{for(var we=x.key,be=L;be!==null;){if(be.key===we){if(we=x.type,we===M){if(be.tag===7){c($,be.sibling),L=p(be,x.props.children),L.return=$,$=L;break e}}else if(be.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===re&&v0(we)===be.type){c($,be.sibling),L=p(be,x.props),L.ref=Ya($,be,x),L.return=$,$=L;break e}c($,be);break}else r($,be);be=be.sibling}x.type===M?(L=vr(x.props.children,$.mode,ie,x.key),L.return=$,$=L):(ie=ad(x.type,x.key,x.props,null,$.mode,ie),ie.ref=Ya($,L,x),ie.return=$,$=ie)}return C($);case D:e:{for(be=x.key;L!==null;){if(L.key===be)if(L.tag===4&&L.stateNode.containerInfo===x.containerInfo&&L.stateNode.implementation===x.implementation){c($,L.sibling),L=p(L,x.children||[]),L.return=$,$=L;break e}else{c($,L);break}else r($,L);L=L.sibling}L=Mh(x,$.mode,ie),L.return=$,$=L}return C($);case re:return be=x._init,Tt($,L,be(x._payload),ie)}if(Ii(x))return Ae($,L,x,ie);if(V(x))return Ee($,L,x,ie);Lc($,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,L!==null&&L.tag===6?(c($,L.sibling),L=p(L,x),L.return=$,$=L):(c($,L),L=Nh(x,$.mode,ie),L.return=$,$=L),C($)):c($,L)}return Tt}var gs=A0(!0),I0=A0(!1),Uc=To(null),Hc=null,ps=null,Gf=null;function $f(){Gf=ps=Hc=null}function xf(o){var r=Uc.current;ct(Uc),o._currentValue=r}function Wf(o,r,c){for(;o!==null;){var h=o.alternate;if((o.childLanes&r)!==r?(o.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),o===c)break;o=o.return}}function ms(o,r){Hc=o,Gf=ps=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&r)!==0&&(_n=!0),o.firstContext=null)}function qn(o){var r=o._currentValue;if(Gf!==o)if(o={context:o,memoizedValue:r,next:null},ps===null){if(Hc===null)throw Error(n(308));ps=o,Hc.dependencies={lanes:0,firstContext:o}}else ps=ps.next=o;return r}var fr=null;function Yf(o){fr===null?fr=[o]:fr.push(o)}function T0(o,r,c,h){var p=r.interleaved;return p===null?(c.next=c,Yf(r)):(c.next=p.next,p.next=c),r.interleaved=c,zi(o,h)}function zi(o,r){o.lanes|=r;var c=o.alternate;for(c!==null&&(c.lanes|=r),c=o,o=o.return;o!==null;)o.childLanes|=r,c=o.alternate,c!==null&&(c.childLanes|=r),c=o,o=o.return;return c.tag===3?c.stateNode:null}var _o=!1;function zf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function E0(o,r){o=o.updateQueue,r.updateQueue===o&&(r.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function ji(o,r){return{eventTime:o,lane:r,tag:0,payload:null,callback:null,next:null}}function wo(o,r,c){var h=o.updateQueue;if(h===null)return null;if(h=h.shared,(Ve&2)!==0){var p=h.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),h.pending=r,zi(o,c)}return p=h.interleaved,p===null?(r.next=r,Yf(h)):(r.next=p.next,p.next=r),h.interleaved=r,zi(o,c)}function Gc(o,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194240)!==0)){var h=r.lanes;h&=o.pendingLanes,c|=h,r.lanes=c,rf(o,c)}}function C0(o,r){var c=o.updateQueue,h=o.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var p=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var C={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};y===null?p=y=C:y=y.next=C,c=c.next}while(c!==null);y===null?p=y=r:y=y.next=r}else p=y=r;c={baseState:h.baseState,firstBaseUpdate:p,lastBaseUpdate:y,shared:h.shared,effects:h.effects},o.updateQueue=c;return}o=c.lastBaseUpdate,o===null?c.firstBaseUpdate=r:o.next=r,c.lastBaseUpdate=r}function $c(o,r,c,h){var p=o.updateQueue;_o=!1;var y=p.firstBaseUpdate,C=p.lastBaseUpdate,O=p.shared.pending;if(O!==null){p.shared.pending=null;var B=O,W=B.next;B.next=null,C===null?y=W:C.next=W,C=B;var ee=o.alternate;ee!==null&&(ee=ee.updateQueue,O=ee.lastBaseUpdate,O!==C&&(O===null?ee.firstBaseUpdate=W:O.next=W,ee.lastBaseUpdate=B))}if(y!==null){var ne=p.baseState;C=0,ee=W=B=null,O=y;do{var Q=O.lane,me=O.eventTime;if((h&Q)===Q){ee!==null&&(ee=ee.next={eventTime:me,lane:0,tag:O.tag,payload:O.payload,callback:O.callback,next:null});e:{var Ae=o,Ee=O;switch(Q=r,me=c,Ee.tag){case 1:if(Ae=Ee.payload,typeof Ae=="function"){ne=Ae.call(me,ne,Q);break e}ne=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=Ee.payload,Q=typeof Ae=="function"?Ae.call(me,ne,Q):Ae,Q==null)break e;ne=q({},ne,Q);break e;case 2:_o=!0}}O.callback!==null&&O.lane!==0&&(o.flags|=64,Q=p.effects,Q===null?p.effects=[O]:Q.push(O))}else me={eventTime:me,lane:Q,tag:O.tag,payload:O.payload,callback:O.callback,next:null},ee===null?(W=ee=me,B=ne):ee=ee.next=me,C|=Q;if(O=O.next,O===null){if(O=p.shared.pending,O===null)break;Q=O,O=Q.next,Q.next=null,p.lastBaseUpdate=Q,p.shared.pending=null}}while(!0);if(ee===null&&(B=ne),p.baseState=B,p.firstBaseUpdate=W,p.lastBaseUpdate=ee,r=p.shared.interleaved,r!==null){p=r;do C|=p.lane,p=p.next;while(p!==r)}else y===null&&(p.shared.lanes=0);pr|=C,o.lanes=C,o.memoizedState=ne}}function _0(o,r,c){if(o=r.effects,r.effects=null,o!==null)for(r=0;r<o.length;r++){var h=o[r],p=h.callback;if(p!==null){if(h.callback=null,h=c,typeof p!="function")throw Error(n(191,p));p.call(h)}}}var za={},Ci=To(za),ja=To(za),Xa=To(za);function hr(o){if(o===za)throw Error(n(174));return o}function jf(o,r){switch(st(Xa,r),st(ja,o),st(Ci,za),o=r.nodeType,o){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:ju(null,"");break;default:o=o===8?r.parentNode:r,r=o.namespaceURI||null,o=o.tagName,r=ju(r,o)}ct(Ci),st(Ci,r)}function ys(){ct(Ci),ct(ja),ct(Xa)}function w0(o){hr(Xa.current);var r=hr(Ci.current),c=ju(r,o.type);r!==c&&(st(ja,o),st(Ci,c))}function Xf(o){ja.current===o&&(ct(Ci),ct(ja))}var gt=To(0);function xc(o){for(var r=o;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Vf=[];function Kf(){for(var o=0;o<Vf.length;o++)Vf[o]._workInProgressVersionPrimary=null;Vf.length=0}var Wc=b.ReactCurrentDispatcher,qf=b.ReactCurrentBatchConfig,gr=0,pt=null,Nt=null,kt=null,Yc=!1,Va=!1,Ka=0,rC=0;function en(){throw Error(n(321))}function Zf(o,r){if(r===null)return!1;for(var c=0;c<r.length&&c<o.length;c++)if(!ci(o[c],r[c]))return!1;return!0}function Qf(o,r,c,h,p,y){if(gr=y,pt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Wc.current=o===null||o.memoizedState===null?cC:dC,o=c(h,p),Va){y=0;do{if(Va=!1,Ka=0,25<=y)throw Error(n(301));y+=1,kt=Nt=null,r.updateQueue=null,Wc.current=uC,o=c(h,p)}while(Va)}if(Wc.current=Xc,r=Nt!==null&&Nt.next!==null,gr=0,kt=Nt=pt=null,Yc=!1,r)throw Error(n(300));return o}function Jf(){var o=Ka!==0;return Ka=0,o}function _i(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kt===null?pt.memoizedState=kt=o:kt=kt.next=o,kt}function Zn(){if(Nt===null){var o=pt.alternate;o=o!==null?o.memoizedState:null}else o=Nt.next;var r=kt===null?pt.memoizedState:kt.next;if(r!==null)kt=r,Nt=o;else{if(o===null)throw Error(n(310));Nt=o,o={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},kt===null?pt.memoizedState=kt=o:kt=kt.next=o}return kt}function qa(o,r){return typeof r=="function"?r(o):r}function eh(o){var r=Zn(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=o;var h=Nt,p=h.baseQueue,y=c.pending;if(y!==null){if(p!==null){var C=p.next;p.next=y.next,y.next=C}h.baseQueue=p=y,c.pending=null}if(p!==null){y=p.next,h=h.baseState;var O=C=null,B=null,W=y;do{var ee=W.lane;if((gr&ee)===ee)B!==null&&(B=B.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),h=W.hasEagerState?W.eagerState:o(h,W.action);else{var ne={lane:ee,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};B===null?(O=B=ne,C=h):B=B.next=ne,pt.lanes|=ee,pr|=ee}W=W.next}while(W!==null&&W!==y);B===null?C=h:B.next=O,ci(h,r.memoizedState)||(_n=!0),r.memoizedState=h,r.baseState=C,r.baseQueue=B,c.lastRenderedState=h}if(o=c.interleaved,o!==null){p=o;do y=p.lane,pt.lanes|=y,pr|=y,p=p.next;while(p!==o)}else p===null&&(c.lanes=0);return[r.memoizedState,c.dispatch]}function th(o){var r=Zn(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=o;var h=c.dispatch,p=c.pending,y=r.memoizedState;if(p!==null){c.pending=null;var C=p=p.next;do y=o(y,C.action),C=C.next;while(C!==p);ci(y,r.memoizedState)||(_n=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),c.lastRenderedState=y}return[y,h]}function R0(){}function P0(o,r){var c=pt,h=Zn(),p=r(),y=!ci(h.memoizedState,p);if(y&&(h.memoizedState=p,_n=!0),h=h.queue,nh(M0.bind(null,c,h,o),[o]),h.getSnapshot!==r||y||kt!==null&&kt.memoizedState.tag&1){if(c.flags|=2048,Za(9,N0.bind(null,c,h,p,r),void 0,null),Bt===null)throw Error(n(349));(gr&30)!==0||D0(c,r,p)}return p}function D0(o,r,c){o.flags|=16384,o={getSnapshot:r,value:c},r=pt.updateQueue,r===null?(r={lastEffect:null,stores:null},pt.updateQueue=r,r.stores=[o]):(c=r.stores,c===null?r.stores=[o]:c.push(o))}function N0(o,r,c,h){r.value=c,r.getSnapshot=h,O0(r)&&b0(o)}function M0(o,r,c){return c(function(){O0(r)&&b0(o)})}function O0(o){var r=o.getSnapshot;o=o.value;try{var c=r();return!ci(o,c)}catch{return!0}}function b0(o){var r=zi(o,1);r!==null&&gi(r,o,1,-1)}function k0(o){var r=_i();return typeof o=="function"&&(o=o()),r.memoizedState=r.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qa,lastRenderedState:o},r.queue=o,o=o.dispatch=lC.bind(null,pt,o),[r.memoizedState,o]}function Za(o,r,c,h){return o={tag:o,create:r,destroy:c,deps:h,next:null},r=pt.updateQueue,r===null?(r={lastEffect:null,stores:null},pt.updateQueue=r,r.lastEffect=o.next=o):(c=r.lastEffect,c===null?r.lastEffect=o.next=o:(h=c.next,c.next=o,o.next=h,r.lastEffect=o)),o}function B0(){return Zn().memoizedState}function zc(o,r,c,h){var p=_i();pt.flags|=o,p.memoizedState=Za(1|r,c,void 0,h===void 0?null:h)}function jc(o,r,c,h){var p=Zn();h=h===void 0?null:h;var y=void 0;if(Nt!==null){var C=Nt.memoizedState;if(y=C.destroy,h!==null&&Zf(h,C.deps)){p.memoizedState=Za(r,c,y,h);return}}pt.flags|=o,p.memoizedState=Za(1|r,c,y,h)}function F0(o,r){return zc(8390656,8,o,r)}function nh(o,r){return jc(2048,8,o,r)}function L0(o,r){return jc(4,2,o,r)}function U0(o,r){return jc(4,4,o,r)}function H0(o,r){if(typeof r=="function")return o=o(),r(o),function(){r(null)};if(r!=null)return o=o(),r.current=o,function(){r.current=null}}function G0(o,r,c){return c=c!=null?c.concat([o]):null,jc(4,4,H0.bind(null,r,o),c)}function ih(){}function $0(o,r){var c=Zn();r=r===void 0?null:r;var h=c.memoizedState;return h!==null&&r!==null&&Zf(r,h[1])?h[0]:(c.memoizedState=[o,r],o)}function x0(o,r){var c=Zn();r=r===void 0?null:r;var h=c.memoizedState;return h!==null&&r!==null&&Zf(r,h[1])?h[0]:(o=o(),c.memoizedState=[o,r],o)}function W0(o,r,c){return(gr&21)===0?(o.baseState&&(o.baseState=!1,_n=!0),o.memoizedState=c):(ci(c,r)||(c=vm(),pt.lanes|=c,pr|=c,o.baseState=!0),r)}function sC(o,r){var c=tt;tt=c!==0&&4>c?c:4,o(!0);var h=qf.transition;qf.transition={};try{o(!1),r()}finally{tt=c,qf.transition=h}}function Y0(){return Zn().memoizedState}function aC(o,r,c){var h=No(o);if(c={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null},z0(o))j0(r,c);else if(c=T0(o,r,c,h),c!==null){var p=un();gi(c,o,h,p),X0(c,r,h)}}function lC(o,r,c){var h=No(o),p={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null};if(z0(o))j0(r,p);else{var y=o.alternate;if(o.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var C=r.lastRenderedState,O=y(C,c);if(p.hasEagerState=!0,p.eagerState=O,ci(O,C)){var B=r.interleaved;B===null?(p.next=p,Yf(r)):(p.next=B.next,B.next=p),r.interleaved=p;return}}catch{}finally{}c=T0(o,r,p,h),c!==null&&(p=un(),gi(c,o,h,p),X0(c,r,h))}}function z0(o){var r=o.alternate;return o===pt||r!==null&&r===pt}function j0(o,r){Va=Yc=!0;var c=o.pending;c===null?r.next=r:(r.next=c.next,c.next=r),o.pending=r}function X0(o,r,c){if((c&4194240)!==0){var h=r.lanes;h&=o.pendingLanes,c|=h,r.lanes=c,rf(o,c)}}var Xc={readContext:qn,useCallback:en,useContext:en,useEffect:en,useImperativeHandle:en,useInsertionEffect:en,useLayoutEffect:en,useMemo:en,useReducer:en,useRef:en,useState:en,useDebugValue:en,useDeferredValue:en,useTransition:en,useMutableSource:en,useSyncExternalStore:en,useId:en,unstable_isNewReconciler:!1},cC={readContext:qn,useCallback:function(o,r){return _i().memoizedState=[o,r===void 0?null:r],o},useContext:qn,useEffect:F0,useImperativeHandle:function(o,r,c){return c=c!=null?c.concat([o]):null,zc(4194308,4,H0.bind(null,r,o),c)},useLayoutEffect:function(o,r){return zc(4194308,4,o,r)},useInsertionEffect:function(o,r){return zc(4,2,o,r)},useMemo:function(o,r){var c=_i();return r=r===void 0?null:r,o=o(),c.memoizedState=[o,r],o},useReducer:function(o,r,c){var h=_i();return r=c!==void 0?c(r):r,h.memoizedState=h.baseState=r,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:r},h.queue=o,o=o.dispatch=aC.bind(null,pt,o),[h.memoizedState,o]},useRef:function(o){var r=_i();return o={current:o},r.memoizedState=o},useState:k0,useDebugValue:ih,useDeferredValue:function(o){return _i().memoizedState=o},useTransition:function(){var o=k0(!1),r=o[0];return o=sC.bind(null,o[1]),_i().memoizedState=o,[r,o]},useMutableSource:function(){},useSyncExternalStore:function(o,r,c){var h=pt,p=_i();if(ut){if(c===void 0)throw Error(n(407));c=c()}else{if(c=r(),Bt===null)throw Error(n(349));(gr&30)!==0||D0(h,r,c)}p.memoizedState=c;var y={value:c,getSnapshot:r};return p.queue=y,F0(M0.bind(null,h,y,o),[o]),h.flags|=2048,Za(9,N0.bind(null,h,y,c,r),void 0,null),c},useId:function(){var o=_i(),r=Bt.identifierPrefix;if(ut){var c=Yi,h=Wi;c=(h&~(1<<32-li(h)-1)).toString(32)+c,r=":"+r+"R"+c,c=Ka++,0<c&&(r+="H"+c.toString(32)),r+=":"}else c=rC++,r=":"+r+"r"+c.toString(32)+":";return o.memoizedState=r},unstable_isNewReconciler:!1},dC={readContext:qn,useCallback:$0,useContext:qn,useEffect:nh,useImperativeHandle:G0,useInsertionEffect:L0,useLayoutEffect:U0,useMemo:x0,useReducer:eh,useRef:B0,useState:function(){return eh(qa)},useDebugValue:ih,useDeferredValue:function(o){var r=Zn();return W0(r,Nt.memoizedState,o)},useTransition:function(){var o=eh(qa)[0],r=Zn().memoizedState;return[o,r]},useMutableSource:R0,useSyncExternalStore:P0,useId:Y0,unstable_isNewReconciler:!1},uC={readContext:qn,useCallback:$0,useContext:qn,useEffect:nh,useImperativeHandle:G0,useInsertionEffect:L0,useLayoutEffect:U0,useMemo:x0,useReducer:th,useRef:B0,useState:function(){return th(qa)},useDebugValue:ih,useDeferredValue:function(o){var r=Zn();return Nt===null?r.memoizedState=o:W0(r,Nt.memoizedState,o)},useTransition:function(){var o=th(qa)[0],r=Zn().memoizedState;return[o,r]},useMutableSource:R0,useSyncExternalStore:P0,useId:Y0,unstable_isNewReconciler:!1};function ui(o,r){if(o&&o.defaultProps){r=q({},r),o=o.defaultProps;for(var c in o)r[c]===void 0&&(r[c]=o[c]);return r}return r}function oh(o,r,c,h){r=o.memoizedState,c=c(h,r),c=c==null?r:q({},r,c),o.memoizedState=c,o.lanes===0&&(o.updateQueue.baseState=c)}var Vc={isMounted:function(o){return(o=o._reactInternals)?ar(o)===o:!1},enqueueSetState:function(o,r,c){o=o._reactInternals;var h=un(),p=No(o),y=ji(h,p);y.payload=r,c!=null&&(y.callback=c),r=wo(o,y,p),r!==null&&(gi(r,o,p,h),Gc(r,o,p))},enqueueReplaceState:function(o,r,c){o=o._reactInternals;var h=un(),p=No(o),y=ji(h,p);y.tag=1,y.payload=r,c!=null&&(y.callback=c),r=wo(o,y,p),r!==null&&(gi(r,o,p,h),Gc(r,o,p))},enqueueForceUpdate:function(o,r){o=o._reactInternals;var c=un(),h=No(o),p=ji(c,h);p.tag=2,r!=null&&(p.callback=r),r=wo(o,p,h),r!==null&&(gi(r,o,h,c),Gc(r,o,h))}};function V0(o,r,c,h,p,y,C){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(h,y,C):r.prototype&&r.prototype.isPureReactComponent?!La(c,h)||!La(p,y):!0}function K0(o,r,c){var h=!1,p=Eo,y=r.contextType;return typeof y=="object"&&y!==null?y=qn(y):(p=Cn(r)?cr:Jt.current,h=r.contextTypes,y=(h=h!=null)?ds(o,p):Eo),r=new r(c,y),o.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Vc,o.stateNode=r,r._reactInternals=o,h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=p,o.__reactInternalMemoizedMaskedChildContext=y),r}function q0(o,r,c,h){o=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,h),r.state!==o&&Vc.enqueueReplaceState(r,r.state,null)}function rh(o,r,c,h){var p=o.stateNode;p.props=c,p.state=o.memoizedState,p.refs={},zf(o);var y=r.contextType;typeof y=="object"&&y!==null?p.context=qn(y):(y=Cn(r)?cr:Jt.current,p.context=ds(o,y)),p.state=o.memoizedState,y=r.getDerivedStateFromProps,typeof y=="function"&&(oh(o,r,y,c),p.state=o.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(r=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),r!==p.state&&Vc.enqueueReplaceState(p,p.state,null),$c(o,c,p,h),p.state=o.memoizedState),typeof p.componentDidMount=="function"&&(o.flags|=4194308)}function Ss(o,r){try{var c="",h=r;do c+=Pe(h),h=h.return;while(h);var p=c}catch(y){p=`
Error generating stack: `+y.message+`
`+y.stack}return{value:o,source:r,stack:p,digest:null}}function sh(o,r,c){return{value:o,source:null,stack:c??null,digest:r??null}}function ah(o,r){try{console.error(r.value)}catch(c){setTimeout(function(){throw c})}}var fC=typeof WeakMap=="function"?WeakMap:Map;function Z0(o,r,c){c=ji(-1,c),c.tag=3,c.payload={element:null};var h=r.value;return c.callback=function(){td||(td=!0,Th=h),ah(o,r)},c}function Q0(o,r,c){c=ji(-1,c),c.tag=3;var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var p=r.value;c.payload=function(){return h(p)},c.callback=function(){ah(o,r)}}var y=o.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(c.callback=function(){ah(o,r),typeof h!="function"&&(Po===null?Po=new Set([this]):Po.add(this));var C=r.stack;this.componentDidCatch(r.value,{componentStack:C!==null?C:""})}),c}function J0(o,r,c){var h=o.pingCache;if(h===null){h=o.pingCache=new fC;var p=new Set;h.set(r,p)}else p=h.get(r),p===void 0&&(p=new Set,h.set(r,p));p.has(c)||(p.add(c),o=wC.bind(null,o,r,c),r.then(o,o))}function ey(o){do{var r;if((r=o.tag===13)&&(r=o.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return o;o=o.return}while(o!==null);return null}function ty(o,r,c,h,p){return(o.mode&1)===0?(o===r?o.flags|=65536:(o.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(r=ji(-1,1),r.tag=2,wo(c,r,1))),c.lanes|=1),o):(o.flags|=65536,o.lanes=p,o)}var hC=b.ReactCurrentOwner,_n=!1;function dn(o,r,c,h){r.child=o===null?I0(r,null,c,h):gs(r,o.child,c,h)}function ny(o,r,c,h,p){c=c.render;var y=r.ref;return ms(r,p),h=Qf(o,r,c,h,y,p),c=Jf(),o!==null&&!_n?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,Xi(o,r,p)):(ut&&c&&Bf(r),r.flags|=1,dn(o,r,h,p),r.child)}function iy(o,r,c,h,p){if(o===null){var y=c.type;return typeof y=="function"&&!Dh(y)&&y.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(r.tag=15,r.type=y,oy(o,r,y,h,p)):(o=ad(c.type,null,h,r,r.mode,p),o.ref=r.ref,o.return=r,r.child=o)}if(y=o.child,(o.lanes&p)===0){var C=y.memoizedProps;if(c=c.compare,c=c!==null?c:La,c(C,h)&&o.ref===r.ref)return Xi(o,r,p)}return r.flags|=1,o=Oo(y,h),o.ref=r.ref,o.return=r,r.child=o}function oy(o,r,c,h,p){if(o!==null){var y=o.memoizedProps;if(La(y,h)&&o.ref===r.ref)if(_n=!1,r.pendingProps=h=y,(o.lanes&p)!==0)(o.flags&131072)!==0&&(_n=!0);else return r.lanes=o.lanes,Xi(o,r,p)}return lh(o,r,c,h,p)}function ry(o,r,c){var h=r.pendingProps,p=h.children,y=o!==null?o.memoizedState:null;if(h.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},st(As,Fn),Fn|=c;else{if((c&1073741824)===0)return o=y!==null?y.baseLanes|c:c,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:o,cachePool:null,transitions:null},r.updateQueue=null,st(As,Fn),Fn|=o,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=y!==null?y.baseLanes:c,st(As,Fn),Fn|=h}else y!==null?(h=y.baseLanes|c,r.memoizedState=null):h=c,st(As,Fn),Fn|=h;return dn(o,r,p,c),r.child}function sy(o,r){var c=r.ref;(o===null&&c!==null||o!==null&&o.ref!==c)&&(r.flags|=512,r.flags|=2097152)}function lh(o,r,c,h,p){var y=Cn(c)?cr:Jt.current;return y=ds(r,y),ms(r,p),c=Qf(o,r,c,h,y,p),h=Jf(),o!==null&&!_n?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,Xi(o,r,p)):(ut&&h&&Bf(r),r.flags|=1,dn(o,r,c,p),r.child)}function ay(o,r,c,h,p){if(Cn(c)){var y=!0;Oc(r)}else y=!1;if(ms(r,p),r.stateNode===null)qc(o,r),K0(r,c,h),rh(r,c,h,p),h=!0;else if(o===null){var C=r.stateNode,O=r.memoizedProps;C.props=O;var B=C.context,W=c.contextType;typeof W=="object"&&W!==null?W=qn(W):(W=Cn(c)?cr:Jt.current,W=ds(r,W));var ee=c.getDerivedStateFromProps,ne=typeof ee=="function"||typeof C.getSnapshotBeforeUpdate=="function";ne||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(O!==h||B!==W)&&q0(r,C,h,W),_o=!1;var Q=r.memoizedState;C.state=Q,$c(r,h,C,p),B=r.memoizedState,O!==h||Q!==B||En.current||_o?(typeof ee=="function"&&(oh(r,c,ee,h),B=r.memoizedState),(O=_o||V0(r,c,O,h,Q,B,W))?(ne||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(r.flags|=4194308)):(typeof C.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=B),C.props=h,C.state=B,C.context=W,h=O):(typeof C.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{C=r.stateNode,E0(o,r),O=r.memoizedProps,W=r.type===r.elementType?O:ui(r.type,O),C.props=W,ne=r.pendingProps,Q=C.context,B=c.contextType,typeof B=="object"&&B!==null?B=qn(B):(B=Cn(c)?cr:Jt.current,B=ds(r,B));var me=c.getDerivedStateFromProps;(ee=typeof me=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(O!==ne||Q!==B)&&q0(r,C,h,B),_o=!1,Q=r.memoizedState,C.state=Q,$c(r,h,C,p);var Ae=r.memoizedState;O!==ne||Q!==Ae||En.current||_o?(typeof me=="function"&&(oh(r,c,me,h),Ae=r.memoizedState),(W=_o||V0(r,c,W,h,Q,Ae,B)||!1)?(ee||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(h,Ae,B),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(h,Ae,B)),typeof C.componentDidUpdate=="function"&&(r.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof C.componentDidUpdate!="function"||O===o.memoizedProps&&Q===o.memoizedState||(r.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||O===o.memoizedProps&&Q===o.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=Ae),C.props=h,C.state=Ae,C.context=B,h=W):(typeof C.componentDidUpdate!="function"||O===o.memoizedProps&&Q===o.memoizedState||(r.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||O===o.memoizedProps&&Q===o.memoizedState||(r.flags|=1024),h=!1)}return ch(o,r,c,h,y,p)}function ch(o,r,c,h,p,y){sy(o,r);var C=(r.flags&128)!==0;if(!h&&!C)return p&&f0(r,c,!1),Xi(o,r,y);h=r.stateNode,hC.current=r;var O=C&&typeof c.getDerivedStateFromError!="function"?null:h.render();return r.flags|=1,o!==null&&C?(r.child=gs(r,o.child,null,y),r.child=gs(r,null,O,y)):dn(o,r,O,y),r.memoizedState=h.state,p&&f0(r,c,!0),r.child}function ly(o){var r=o.stateNode;r.pendingContext?d0(o,r.pendingContext,r.pendingContext!==r.context):r.context&&d0(o,r.context,!1),jf(o,r.containerInfo)}function cy(o,r,c,h,p){return hs(),Hf(p),r.flags|=256,dn(o,r,c,h),r.child}var dh={dehydrated:null,treeContext:null,retryLane:0};function uh(o){return{baseLanes:o,cachePool:null,transitions:null}}function dy(o,r,c){var h=r.pendingProps,p=gt.current,y=!1,C=(r.flags&128)!==0,O;if((O=C)||(O=o!==null&&o.memoizedState===null?!1:(p&2)!==0),O?(y=!0,r.flags&=-129):(o===null||o.memoizedState!==null)&&(p|=1),st(gt,p&1),o===null)return Uf(r),o=r.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((r.mode&1)===0?r.lanes=1:o.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(C=h.children,o=h.fallback,y?(h=r.mode,y=r.child,C={mode:"hidden",children:C},(h&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=C):y=ld(C,h,0,null),o=vr(o,h,c,null),y.return=r,o.return=r,y.sibling=o,r.child=y,r.child.memoizedState=uh(c),r.memoizedState=dh,o):fh(r,C));if(p=o.memoizedState,p!==null&&(O=p.dehydrated,O!==null))return gC(o,r,C,h,O,p,c);if(y){y=h.fallback,C=r.mode,p=o.child,O=p.sibling;var B={mode:"hidden",children:h.children};return(C&1)===0&&r.child!==p?(h=r.child,h.childLanes=0,h.pendingProps=B,r.deletions=null):(h=Oo(p,B),h.subtreeFlags=p.subtreeFlags&14680064),O!==null?y=Oo(O,y):(y=vr(y,C,c,null),y.flags|=2),y.return=r,h.return=r,h.sibling=y,r.child=h,h=y,y=r.child,C=o.child.memoizedState,C=C===null?uh(c):{baseLanes:C.baseLanes|c,cachePool:null,transitions:C.transitions},y.memoizedState=C,y.childLanes=o.childLanes&~c,r.memoizedState=dh,h}return y=o.child,o=y.sibling,h=Oo(y,{mode:"visible",children:h.children}),(r.mode&1)===0&&(h.lanes=c),h.return=r,h.sibling=null,o!==null&&(c=r.deletions,c===null?(r.deletions=[o],r.flags|=16):c.push(o)),r.child=h,r.memoizedState=null,h}function fh(o,r){return r=ld({mode:"visible",children:r},o.mode,0,null),r.return=o,o.child=r}function Kc(o,r,c,h){return h!==null&&Hf(h),gs(r,o.child,null,c),o=fh(r,r.pendingProps.children),o.flags|=2,r.memoizedState=null,o}function gC(o,r,c,h,p,y,C){if(c)return r.flags&256?(r.flags&=-257,h=sh(Error(n(422))),Kc(o,r,C,h)):r.memoizedState!==null?(r.child=o.child,r.flags|=128,null):(y=h.fallback,p=r.mode,h=ld({mode:"visible",children:h.children},p,0,null),y=vr(y,p,C,null),y.flags|=2,h.return=r,y.return=r,h.sibling=y,r.child=h,(r.mode&1)!==0&&gs(r,o.child,null,C),r.child.memoizedState=uh(C),r.memoizedState=dh,y);if((r.mode&1)===0)return Kc(o,r,C,null);if(p.data==="$!"){if(h=p.nextSibling&&p.nextSibling.dataset,h)var O=h.dgst;return h=O,y=Error(n(419)),h=sh(y,h,void 0),Kc(o,r,C,h)}if(O=(C&o.childLanes)!==0,_n||O){if(h=Bt,h!==null){switch(C&-C){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=(p&(h.suspendedLanes|C))!==0?0:p,p!==0&&p!==y.retryLane&&(y.retryLane=p,zi(o,p),gi(h,o,p,-1))}return Ph(),h=sh(Error(n(421))),Kc(o,r,C,h)}return p.data==="$?"?(r.flags|=128,r.child=o.child,r=RC.bind(null,o),p._reactRetry=r,null):(o=y.treeContext,Bn=Io(p.nextSibling),kn=r,ut=!0,di=null,o!==null&&(Vn[Kn++]=Wi,Vn[Kn++]=Yi,Vn[Kn++]=dr,Wi=o.id,Yi=o.overflow,dr=r),r=fh(r,h.children),r.flags|=4096,r)}function uy(o,r,c){o.lanes|=r;var h=o.alternate;h!==null&&(h.lanes|=r),Wf(o.return,r,c)}function hh(o,r,c,h,p){var y=o.memoizedState;y===null?o.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:p}:(y.isBackwards=r,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=c,y.tailMode=p)}function fy(o,r,c){var h=r.pendingProps,p=h.revealOrder,y=h.tail;if(dn(o,r,h.children,c),h=gt.current,(h&2)!==0)h=h&1|2,r.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=r.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&uy(o,c,r);else if(o.tag===19)uy(o,c,r);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}h&=1}if(st(gt,h),(r.mode&1)===0)r.memoizedState=null;else switch(p){case"forwards":for(c=r.child,p=null;c!==null;)o=c.alternate,o!==null&&xc(o)===null&&(p=c),c=c.sibling;c=p,c===null?(p=r.child,r.child=null):(p=c.sibling,c.sibling=null),hh(r,!1,p,c,y);break;case"backwards":for(c=null,p=r.child,r.child=null;p!==null;){if(o=p.alternate,o!==null&&xc(o)===null){r.child=p;break}o=p.sibling,p.sibling=c,c=p,p=o}hh(r,!0,c,null,y);break;case"together":hh(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function qc(o,r){(r.mode&1)===0&&o!==null&&(o.alternate=null,r.alternate=null,r.flags|=2)}function Xi(o,r,c){if(o!==null&&(r.dependencies=o.dependencies),pr|=r.lanes,(c&r.childLanes)===0)return null;if(o!==null&&r.child!==o.child)throw Error(n(153));if(r.child!==null){for(o=r.child,c=Oo(o,o.pendingProps),r.child=c,c.return=r;o.sibling!==null;)o=o.sibling,c=c.sibling=Oo(o,o.pendingProps),c.return=r;c.sibling=null}return r.child}function pC(o,r,c){switch(r.tag){case 3:ly(r),hs();break;case 5:w0(r);break;case 1:Cn(r.type)&&Oc(r);break;case 4:jf(r,r.stateNode.containerInfo);break;case 10:var h=r.type._context,p=r.memoizedProps.value;st(Uc,h._currentValue),h._currentValue=p;break;case 13:if(h=r.memoizedState,h!==null)return h.dehydrated!==null?(st(gt,gt.current&1),r.flags|=128,null):(c&r.child.childLanes)!==0?dy(o,r,c):(st(gt,gt.current&1),o=Xi(o,r,c),o!==null?o.sibling:null);st(gt,gt.current&1);break;case 19:if(h=(c&r.childLanes)!==0,(o.flags&128)!==0){if(h)return fy(o,r,c);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),st(gt,gt.current),h)break;return null;case 22:case 23:return r.lanes=0,ry(o,r,c)}return Xi(o,r,c)}var hy,gh,gy,py;hy=function(o,r){for(var c=r.child;c!==null;){if(c.tag===5||c.tag===6)o.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===r)break;for(;c.sibling===null;){if(c.return===null||c.return===r)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},gh=function(){},gy=function(o,r,c,h){var p=o.memoizedProps;if(p!==h){o=r.stateNode,hr(Ci.current);var y=null;switch(c){case"input":p=nt(o,p),h=nt(o,h),y=[];break;case"select":p=q({},p,{value:void 0}),h=q({},h,{value:void 0}),y=[];break;case"textarea":p=sr(o,p),h=sr(o,h),y=[];break;default:typeof p.onClick!="function"&&typeof h.onClick=="function"&&(o.onclick=Dc)}Xu(c,h);var C;c=null;for(W in p)if(!h.hasOwnProperty(W)&&p.hasOwnProperty(W)&&p[W]!=null)if(W==="style"){var O=p[W];for(C in O)O.hasOwnProperty(C)&&(c||(c={}),c[C]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(s.hasOwnProperty(W)?y||(y=[]):(y=y||[]).push(W,null));for(W in h){var B=h[W];if(O=p!=null?p[W]:void 0,h.hasOwnProperty(W)&&B!==O&&(B!=null||O!=null))if(W==="style")if(O){for(C in O)!O.hasOwnProperty(C)||B&&B.hasOwnProperty(C)||(c||(c={}),c[C]="");for(C in B)B.hasOwnProperty(C)&&O[C]!==B[C]&&(c||(c={}),c[C]=B[C])}else c||(y||(y=[]),y.push(W,c)),c=B;else W==="dangerouslySetInnerHTML"?(B=B?B.__html:void 0,O=O?O.__html:void 0,B!=null&&O!==B&&(y=y||[]).push(W,B)):W==="children"?typeof B!="string"&&typeof B!="number"||(y=y||[]).push(W,""+B):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(s.hasOwnProperty(W)?(B!=null&&W==="onScroll"&&lt("scroll",o),y||O===B||(y=[])):(y=y||[]).push(W,B))}c&&(y=y||[]).push("style",c);var W=y;(r.updateQueue=W)&&(r.flags|=4)}},py=function(o,r,c,h){c!==h&&(r.flags|=4)};function Qa(o,r){if(!ut)switch(o.tailMode){case"hidden":r=o.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?o.tail=null:c.sibling=null;break;case"collapsed":c=o.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?r||o.tail===null?o.tail=null:o.tail.sibling=null:h.sibling=null}}function tn(o){var r=o.alternate!==null&&o.alternate.child===o.child,c=0,h=0;if(r)for(var p=o.child;p!==null;)c|=p.lanes|p.childLanes,h|=p.subtreeFlags&14680064,h|=p.flags&14680064,p.return=o,p=p.sibling;else for(p=o.child;p!==null;)c|=p.lanes|p.childLanes,h|=p.subtreeFlags,h|=p.flags,p.return=o,p=p.sibling;return o.subtreeFlags|=h,o.childLanes=c,r}function mC(o,r,c){var h=r.pendingProps;switch(Ff(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tn(r),null;case 1:return Cn(r.type)&&Mc(),tn(r),null;case 3:return h=r.stateNode,ys(),ct(En),ct(Jt),Kf(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(Fc(r)?r.flags|=4:o===null||o.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,di!==null&&(_h(di),di=null))),gh(o,r),tn(r),null;case 5:Xf(r);var p=hr(Xa.current);if(c=r.type,o!==null&&r.stateNode!=null)gy(o,r,c,h,p),o.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!h){if(r.stateNode===null)throw Error(n(166));return tn(r),null}if(o=hr(Ci.current),Fc(r)){h=r.stateNode,c=r.type;var y=r.memoizedProps;switch(h[Ei]=r,h[xa]=y,o=(r.mode&1)!==0,c){case"dialog":lt("cancel",h),lt("close",h);break;case"iframe":case"object":case"embed":lt("load",h);break;case"video":case"audio":for(p=0;p<Ha.length;p++)lt(Ha[p],h);break;case"source":lt("error",h);break;case"img":case"image":case"link":lt("error",h),lt("load",h);break;case"details":lt("toggle",h);break;case"input":at(h,y),lt("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!y.multiple},lt("invalid",h);break;case"textarea":Qp(h,y),lt("invalid",h)}Xu(c,y),p=null;for(var C in y)if(y.hasOwnProperty(C)){var O=y[C];C==="children"?typeof O=="string"?h.textContent!==O&&(y.suppressHydrationWarning!==!0&&Pc(h.textContent,O,o),p=["children",O]):typeof O=="number"&&h.textContent!==""+O&&(y.suppressHydrationWarning!==!0&&Pc(h.textContent,O,o),p=["children",""+O]):s.hasOwnProperty(C)&&O!=null&&C==="onScroll"&&lt("scroll",h)}switch(c){case"input":xe(h),Xn(h,y,!0);break;case"textarea":xe(h),em(h);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(h.onclick=Dc)}h=p,r.updateQueue=h,h!==null&&(r.flags|=4)}else{C=p.nodeType===9?p:p.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=tm(c)),o==="http://www.w3.org/1999/xhtml"?c==="script"?(o=C.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof h.is=="string"?o=C.createElement(c,{is:h.is}):(o=C.createElement(c),c==="select"&&(C=o,h.multiple?C.multiple=!0:h.size&&(C.size=h.size))):o=C.createElementNS(o,c),o[Ei]=r,o[xa]=h,hy(o,r,!1,!1),r.stateNode=o;e:{switch(C=Vu(c,h),c){case"dialog":lt("cancel",o),lt("close",o),p=h;break;case"iframe":case"object":case"embed":lt("load",o),p=h;break;case"video":case"audio":for(p=0;p<Ha.length;p++)lt(Ha[p],o);p=h;break;case"source":lt("error",o),p=h;break;case"img":case"image":case"link":lt("error",o),lt("load",o),p=h;break;case"details":lt("toggle",o),p=h;break;case"input":at(o,h),p=nt(o,h),lt("invalid",o);break;case"option":p=h;break;case"select":o._wrapperState={wasMultiple:!!h.multiple},p=q({},h,{value:void 0}),lt("invalid",o);break;case"textarea":Qp(o,h),p=sr(o,h),lt("invalid",o);break;default:p=h}Xu(c,p),O=p;for(y in O)if(O.hasOwnProperty(y)){var B=O[y];y==="style"?om(o,B):y==="dangerouslySetInnerHTML"?(B=B?B.__html:void 0,B!=null&&nm(o,B)):y==="children"?typeof B=="string"?(c!=="textarea"||B!=="")&&Aa(o,B):typeof B=="number"&&Aa(o,""+B):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?B!=null&&y==="onScroll"&&lt("scroll",o):B!=null&&w(o,y,B,C))}switch(c){case"input":xe(o),Xn(o,h,!1);break;case"textarea":xe(o),em(o);break;case"option":h.value!=null&&o.setAttribute("value",""+Ne(h.value));break;case"select":o.multiple=!!h.multiple,y=h.value,y!=null?go(o,!!h.multiple,y,!1):h.defaultValue!=null&&go(o,!!h.multiple,h.defaultValue,!0);break;default:typeof p.onClick=="function"&&(o.onclick=Dc)}switch(c){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return tn(r),null;case 6:if(o&&r.stateNode!=null)py(o,r,o.memoizedProps,h);else{if(typeof h!="string"&&r.stateNode===null)throw Error(n(166));if(c=hr(Xa.current),hr(Ci.current),Fc(r)){if(h=r.stateNode,c=r.memoizedProps,h[Ei]=r,(y=h.nodeValue!==c)&&(o=kn,o!==null))switch(o.tag){case 3:Pc(h.nodeValue,c,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&Pc(h.nodeValue,c,(o.mode&1)!==0)}y&&(r.flags|=4)}else h=(c.nodeType===9?c:c.ownerDocument).createTextNode(h),h[Ei]=r,r.stateNode=h}return tn(r),null;case 13:if(ct(gt),h=r.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(ut&&Bn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)S0(),hs(),r.flags|=98560,y=!1;else if(y=Fc(r),h!==null&&h.dehydrated!==null){if(o===null){if(!y)throw Error(n(318));if(y=r.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[Ei]=r}else hs(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;tn(r),y=!1}else di!==null&&(_h(di),di=null),y=!0;if(!y)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=c,r):(h=h!==null,h!==(o!==null&&o.memoizedState!==null)&&h&&(r.child.flags|=8192,(r.mode&1)!==0&&(o===null||(gt.current&1)!==0?Mt===0&&(Mt=3):Ph())),r.updateQueue!==null&&(r.flags|=4),tn(r),null);case 4:return ys(),gh(o,r),o===null&&Ga(r.stateNode.containerInfo),tn(r),null;case 10:return xf(r.type._context),tn(r),null;case 17:return Cn(r.type)&&Mc(),tn(r),null;case 19:if(ct(gt),y=r.memoizedState,y===null)return tn(r),null;if(h=(r.flags&128)!==0,C=y.rendering,C===null)if(h)Qa(y,!1);else{if(Mt!==0||o!==null&&(o.flags&128)!==0)for(o=r.child;o!==null;){if(C=xc(o),C!==null){for(r.flags|=128,Qa(y,!1),h=C.updateQueue,h!==null&&(r.updateQueue=h,r.flags|=4),r.subtreeFlags=0,h=c,c=r.child;c!==null;)y=c,o=h,y.flags&=14680066,C=y.alternate,C===null?(y.childLanes=0,y.lanes=o,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=C.childLanes,y.lanes=C.lanes,y.child=C.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=C.memoizedProps,y.memoizedState=C.memoizedState,y.updateQueue=C.updateQueue,y.type=C.type,o=C.dependencies,y.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),c=c.sibling;return st(gt,gt.current&1|2),r.child}o=o.sibling}y.tail!==null&&It()>Is&&(r.flags|=128,h=!0,Qa(y,!1),r.lanes=4194304)}else{if(!h)if(o=xc(C),o!==null){if(r.flags|=128,h=!0,c=o.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),Qa(y,!0),y.tail===null&&y.tailMode==="hidden"&&!C.alternate&&!ut)return tn(r),null}else 2*It()-y.renderingStartTime>Is&&c!==1073741824&&(r.flags|=128,h=!0,Qa(y,!1),r.lanes=4194304);y.isBackwards?(C.sibling=r.child,r.child=C):(c=y.last,c!==null?c.sibling=C:r.child=C,y.last=C)}return y.tail!==null?(r=y.tail,y.rendering=r,y.tail=r.sibling,y.renderingStartTime=It(),r.sibling=null,c=gt.current,st(gt,h?c&1|2:c&1),r):(tn(r),null);case 22:case 23:return Rh(),h=r.memoizedState!==null,o!==null&&o.memoizedState!==null!==h&&(r.flags|=8192),h&&(r.mode&1)!==0?(Fn&1073741824)!==0&&(tn(r),r.subtreeFlags&6&&(r.flags|=8192)):tn(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function yC(o,r){switch(Ff(r),r.tag){case 1:return Cn(r.type)&&Mc(),o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 3:return ys(),ct(En),ct(Jt),Kf(),o=r.flags,(o&65536)!==0&&(o&128)===0?(r.flags=o&-65537|128,r):null;case 5:return Xf(r),null;case 13:if(ct(gt),o=r.memoizedState,o!==null&&o.dehydrated!==null){if(r.alternate===null)throw Error(n(340));hs()}return o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 19:return ct(gt),null;case 4:return ys(),null;case 10:return xf(r.type._context),null;case 22:case 23:return Rh(),null;case 24:return null;default:return null}}var Zc=!1,nn=!1,SC=typeof WeakSet=="function"?WeakSet:Set,Se=null;function vs(o,r){var c=o.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(h){St(o,r,h)}else c.current=null}function ph(o,r,c){try{c()}catch(h){St(o,r,h)}}var my=!1;function vC(o,r){if(Rf=yc,o=Vm(),vf(o)){if("selectionStart"in o)var c={start:o.selectionStart,end:o.selectionEnd};else e:{c=(c=o.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var p=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var C=0,O=-1,B=-1,W=0,ee=0,ne=o,Q=null;t:for(;;){for(var me;ne!==c||p!==0&&ne.nodeType!==3||(O=C+p),ne!==y||h!==0&&ne.nodeType!==3||(B=C+h),ne.nodeType===3&&(C+=ne.nodeValue.length),(me=ne.firstChild)!==null;)Q=ne,ne=me;for(;;){if(ne===o)break t;if(Q===c&&++W===p&&(O=C),Q===y&&++ee===h&&(B=C),(me=ne.nextSibling)!==null)break;ne=Q,Q=ne.parentNode}ne=me}c=O===-1||B===-1?null:{start:O,end:B}}else c=null}c=c||{start:0,end:0}}else c=null;for(Pf={focusedElem:o,selectionRange:c},yc=!1,Se=r;Se!==null;)if(r=Se,o=r.child,(r.subtreeFlags&1028)!==0&&o!==null)o.return=r,Se=o;else for(;Se!==null;){r=Se;try{var Ae=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(Ae!==null){var Ee=Ae.memoizedProps,Tt=Ae.memoizedState,$=r.stateNode,L=$.getSnapshotBeforeUpdate(r.elementType===r.type?Ee:ui(r.type,Ee),Tt);$.__reactInternalSnapshotBeforeUpdate=L}break;case 3:var x=r.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(ie){St(r,r.return,ie)}if(o=r.sibling,o!==null){o.return=r.return,Se=o;break}Se=r.return}return Ae=my,my=!1,Ae}function Ja(o,r,c){var h=r.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var p=h=h.next;do{if((p.tag&o)===o){var y=p.destroy;p.destroy=void 0,y!==void 0&&ph(r,c,y)}p=p.next}while(p!==h)}}function Qc(o,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var c=r=r.next;do{if((c.tag&o)===o){var h=c.create;c.destroy=h()}c=c.next}while(c!==r)}}function mh(o){var r=o.ref;if(r!==null){var c=o.stateNode;switch(o.tag){case 5:o=c;break;default:o=c}typeof r=="function"?r(o):r.current=o}}function yy(o){var r=o.alternate;r!==null&&(o.alternate=null,yy(r)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(r=o.stateNode,r!==null&&(delete r[Ei],delete r[xa],delete r[Of],delete r[tC],delete r[nC])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function Sy(o){return o.tag===5||o.tag===3||o.tag===4}function vy(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||Sy(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function yh(o,r,c){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?c.nodeType===8?c.parentNode.insertBefore(o,r):c.insertBefore(o,r):(c.nodeType===8?(r=c.parentNode,r.insertBefore(o,c)):(r=c,r.appendChild(o)),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=Dc));else if(h!==4&&(o=o.child,o!==null))for(yh(o,r,c),o=o.sibling;o!==null;)yh(o,r,c),o=o.sibling}function Sh(o,r,c){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?c.insertBefore(o,r):c.appendChild(o);else if(h!==4&&(o=o.child,o!==null))for(Sh(o,r,c),o=o.sibling;o!==null;)Sh(o,r,c),o=o.sibling}var Wt=null,fi=!1;function Ro(o,r,c){for(c=c.child;c!==null;)Ay(o,r,c),c=c.sibling}function Ay(o,r,c){if(Ti&&typeof Ti.onCommitFiberUnmount=="function")try{Ti.onCommitFiberUnmount(uc,c)}catch{}switch(c.tag){case 5:nn||vs(c,r);case 6:var h=Wt,p=fi;Wt=null,Ro(o,r,c),Wt=h,fi=p,Wt!==null&&(fi?(o=Wt,c=c.stateNode,o.nodeType===8?o.parentNode.removeChild(c):o.removeChild(c)):Wt.removeChild(c.stateNode));break;case 18:Wt!==null&&(fi?(o=Wt,c=c.stateNode,o.nodeType===8?Mf(o.parentNode,c):o.nodeType===1&&Mf(o,c),Ma(o)):Mf(Wt,c.stateNode));break;case 4:h=Wt,p=fi,Wt=c.stateNode.containerInfo,fi=!0,Ro(o,r,c),Wt=h,fi=p;break;case 0:case 11:case 14:case 15:if(!nn&&(h=c.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){p=h=h.next;do{var y=p,C=y.destroy;y=y.tag,C!==void 0&&((y&2)!==0||(y&4)!==0)&&ph(c,r,C),p=p.next}while(p!==h)}Ro(o,r,c);break;case 1:if(!nn&&(vs(c,r),h=c.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=c.memoizedProps,h.state=c.memoizedState,h.componentWillUnmount()}catch(O){St(c,r,O)}Ro(o,r,c);break;case 21:Ro(o,r,c);break;case 22:c.mode&1?(nn=(h=nn)||c.memoizedState!==null,Ro(o,r,c),nn=h):Ro(o,r,c);break;default:Ro(o,r,c)}}function Iy(o){var r=o.updateQueue;if(r!==null){o.updateQueue=null;var c=o.stateNode;c===null&&(c=o.stateNode=new SC),r.forEach(function(h){var p=PC.bind(null,o,h);c.has(h)||(c.add(h),h.then(p,p))})}}function hi(o,r){var c=r.deletions;if(c!==null)for(var h=0;h<c.length;h++){var p=c[h];try{var y=o,C=r,O=C;e:for(;O!==null;){switch(O.tag){case 5:Wt=O.stateNode,fi=!1;break e;case 3:Wt=O.stateNode.containerInfo,fi=!0;break e;case 4:Wt=O.stateNode.containerInfo,fi=!0;break e}O=O.return}if(Wt===null)throw Error(n(160));Ay(y,C,p),Wt=null,fi=!1;var B=p.alternate;B!==null&&(B.return=null),p.return=null}catch(W){St(p,r,W)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)Ty(r,o),r=r.sibling}function Ty(o,r){var c=o.alternate,h=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(hi(r,o),wi(o),h&4){try{Ja(3,o,o.return),Qc(3,o)}catch(Ee){St(o,o.return,Ee)}try{Ja(5,o,o.return)}catch(Ee){St(o,o.return,Ee)}}break;case 1:hi(r,o),wi(o),h&512&&c!==null&&vs(c,c.return);break;case 5:if(hi(r,o),wi(o),h&512&&c!==null&&vs(c,c.return),o.flags&32){var p=o.stateNode;try{Aa(p,"")}catch(Ee){St(o,o.return,Ee)}}if(h&4&&(p=o.stateNode,p!=null)){var y=o.memoizedProps,C=c!==null?c.memoizedProps:y,O=o.type,B=o.updateQueue;if(o.updateQueue=null,B!==null)try{O==="input"&&y.type==="radio"&&y.name!=null&&vi(p,y),Vu(O,C);var W=Vu(O,y);for(C=0;C<B.length;C+=2){var ee=B[C],ne=B[C+1];ee==="style"?om(p,ne):ee==="dangerouslySetInnerHTML"?nm(p,ne):ee==="children"?Aa(p,ne):w(p,ee,ne,W)}switch(O){case"input":Tn(p,y);break;case"textarea":Jp(p,y);break;case"select":var Q=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!y.multiple;var me=y.value;me!=null?go(p,!!y.multiple,me,!1):Q!==!!y.multiple&&(y.defaultValue!=null?go(p,!!y.multiple,y.defaultValue,!0):go(p,!!y.multiple,y.multiple?[]:"",!1))}p[xa]=y}catch(Ee){St(o,o.return,Ee)}}break;case 6:if(hi(r,o),wi(o),h&4){if(o.stateNode===null)throw Error(n(162));p=o.stateNode,y=o.memoizedProps;try{p.nodeValue=y}catch(Ee){St(o,o.return,Ee)}}break;case 3:if(hi(r,o),wi(o),h&4&&c!==null&&c.memoizedState.isDehydrated)try{Ma(r.containerInfo)}catch(Ee){St(o,o.return,Ee)}break;case 4:hi(r,o),wi(o);break;case 13:hi(r,o),wi(o),p=o.child,p.flags&8192&&(y=p.memoizedState!==null,p.stateNode.isHidden=y,!y||p.alternate!==null&&p.alternate.memoizedState!==null||(Ih=It())),h&4&&Iy(o);break;case 22:if(ee=c!==null&&c.memoizedState!==null,o.mode&1?(nn=(W=nn)||ee,hi(r,o),nn=W):hi(r,o),wi(o),h&8192){if(W=o.memoizedState!==null,(o.stateNode.isHidden=W)&&!ee&&(o.mode&1)!==0)for(Se=o,ee=o.child;ee!==null;){for(ne=Se=ee;Se!==null;){switch(Q=Se,me=Q.child,Q.tag){case 0:case 11:case 14:case 15:Ja(4,Q,Q.return);break;case 1:vs(Q,Q.return);var Ae=Q.stateNode;if(typeof Ae.componentWillUnmount=="function"){h=Q,c=Q.return;try{r=h,Ae.props=r.memoizedProps,Ae.state=r.memoizedState,Ae.componentWillUnmount()}catch(Ee){St(h,c,Ee)}}break;case 5:vs(Q,Q.return);break;case 22:if(Q.memoizedState!==null){_y(ne);continue}}me!==null?(me.return=Q,Se=me):_y(ne)}ee=ee.sibling}e:for(ee=null,ne=o;;){if(ne.tag===5){if(ee===null){ee=ne;try{p=ne.stateNode,W?(y=p.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(O=ne.stateNode,B=ne.memoizedProps.style,C=B!=null&&B.hasOwnProperty("display")?B.display:null,O.style.display=im("display",C))}catch(Ee){St(o,o.return,Ee)}}}else if(ne.tag===6){if(ee===null)try{ne.stateNode.nodeValue=W?"":ne.memoizedProps}catch(Ee){St(o,o.return,Ee)}}else if((ne.tag!==22&&ne.tag!==23||ne.memoizedState===null||ne===o)&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===o)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===o)break e;ee===ne&&(ee=null),ne=ne.return}ee===ne&&(ee=null),ne.sibling.return=ne.return,ne=ne.sibling}}break;case 19:hi(r,o),wi(o),h&4&&Iy(o);break;case 21:break;default:hi(r,o),wi(o)}}function wi(o){var r=o.flags;if(r&2){try{e:{for(var c=o.return;c!==null;){if(Sy(c)){var h=c;break e}c=c.return}throw Error(n(160))}switch(h.tag){case 5:var p=h.stateNode;h.flags&32&&(Aa(p,""),h.flags&=-33);var y=vy(o);Sh(o,y,p);break;case 3:case 4:var C=h.stateNode.containerInfo,O=vy(o);yh(o,O,C);break;default:throw Error(n(161))}}catch(B){St(o,o.return,B)}o.flags&=-3}r&4096&&(o.flags&=-4097)}function AC(o,r,c){Se=o,Ey(o)}function Ey(o,r,c){for(var h=(o.mode&1)!==0;Se!==null;){var p=Se,y=p.child;if(p.tag===22&&h){var C=p.memoizedState!==null||Zc;if(!C){var O=p.alternate,B=O!==null&&O.memoizedState!==null||nn;O=Zc;var W=nn;if(Zc=C,(nn=B)&&!W)for(Se=p;Se!==null;)C=Se,B=C.child,C.tag===22&&C.memoizedState!==null?wy(p):B!==null?(B.return=C,Se=B):wy(p);for(;y!==null;)Se=y,Ey(y),y=y.sibling;Se=p,Zc=O,nn=W}Cy(o)}else(p.subtreeFlags&8772)!==0&&y!==null?(y.return=p,Se=y):Cy(o)}}function Cy(o){for(;Se!==null;){var r=Se;if((r.flags&8772)!==0){var c=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:nn||Qc(5,r);break;case 1:var h=r.stateNode;if(r.flags&4&&!nn)if(c===null)h.componentDidMount();else{var p=r.elementType===r.type?c.memoizedProps:ui(r.type,c.memoizedProps);h.componentDidUpdate(p,c.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var y=r.updateQueue;y!==null&&_0(r,y,h);break;case 3:var C=r.updateQueue;if(C!==null){if(c=null,r.child!==null)switch(r.child.tag){case 5:c=r.child.stateNode;break;case 1:c=r.child.stateNode}_0(r,C,c)}break;case 5:var O=r.stateNode;if(c===null&&r.flags&4){c=O;var B=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":B.autoFocus&&c.focus();break;case"img":B.src&&(c.src=B.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var W=r.alternate;if(W!==null){var ee=W.memoizedState;if(ee!==null){var ne=ee.dehydrated;ne!==null&&Ma(ne)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}nn||r.flags&512&&mh(r)}catch(Q){St(r,r.return,Q)}}if(r===o){Se=null;break}if(c=r.sibling,c!==null){c.return=r.return,Se=c;break}Se=r.return}}function _y(o){for(;Se!==null;){var r=Se;if(r===o){Se=null;break}var c=r.sibling;if(c!==null){c.return=r.return,Se=c;break}Se=r.return}}function wy(o){for(;Se!==null;){var r=Se;try{switch(r.tag){case 0:case 11:case 15:var c=r.return;try{Qc(4,r)}catch(B){St(r,c,B)}break;case 1:var h=r.stateNode;if(typeof h.componentDidMount=="function"){var p=r.return;try{h.componentDidMount()}catch(B){St(r,p,B)}}var y=r.return;try{mh(r)}catch(B){St(r,y,B)}break;case 5:var C=r.return;try{mh(r)}catch(B){St(r,C,B)}}}catch(B){St(r,r.return,B)}if(r===o){Se=null;break}var O=r.sibling;if(O!==null){O.return=r.return,Se=O;break}Se=r.return}}var IC=Math.ceil,Jc=b.ReactCurrentDispatcher,vh=b.ReactCurrentOwner,Qn=b.ReactCurrentBatchConfig,Ve=0,Bt=null,wt=null,Yt=0,Fn=0,As=To(0),Mt=0,el=null,pr=0,ed=0,Ah=0,tl=null,wn=null,Ih=0,Is=1/0,Vi=null,td=!1,Th=null,Po=null,nd=!1,Do=null,id=0,nl=0,Eh=null,od=-1,rd=0;function un(){return(Ve&6)!==0?It():od!==-1?od:od=It()}function No(o){return(o.mode&1)===0?1:(Ve&2)!==0&&Yt!==0?Yt&-Yt:oC.transition!==null?(rd===0&&(rd=vm()),rd):(o=tt,o!==0||(o=window.event,o=o===void 0?16:Pm(o.type)),o)}function gi(o,r,c,h){if(50<nl)throw nl=0,Eh=null,Error(n(185));wa(o,c,h),((Ve&2)===0||o!==Bt)&&(o===Bt&&((Ve&2)===0&&(ed|=c),Mt===4&&Mo(o,Yt)),Rn(o,h),c===1&&Ve===0&&(r.mode&1)===0&&(Is=It()+500,bc&&Co()))}function Rn(o,r){var c=o.callbackNode;oE(o,r);var h=gc(o,o===Bt?Yt:0);if(h===0)c!==null&&mm(c),o.callbackNode=null,o.callbackPriority=0;else if(r=h&-h,o.callbackPriority!==r){if(c!=null&&mm(c),r===1)o.tag===0?iC(Py.bind(null,o)):h0(Py.bind(null,o)),JE(function(){(Ve&6)===0&&Co()}),c=null;else{switch(Am(h)){case 1:c=tf;break;case 4:c=ym;break;case 16:c=dc;break;case 536870912:c=Sm;break;default:c=dc}c=Fy(c,Ry.bind(null,o))}o.callbackPriority=r,o.callbackNode=c}}function Ry(o,r){if(od=-1,rd=0,(Ve&6)!==0)throw Error(n(327));var c=o.callbackNode;if(Ts()&&o.callbackNode!==c)return null;var h=gc(o,o===Bt?Yt:0);if(h===0)return null;if((h&30)!==0||(h&o.expiredLanes)!==0||r)r=sd(o,h);else{r=h;var p=Ve;Ve|=2;var y=Ny();(Bt!==o||Yt!==r)&&(Vi=null,Is=It()+500,yr(o,r));do try{CC();break}catch(O){Dy(o,O)}while(!0);$f(),Jc.current=y,Ve=p,wt!==null?r=0:(Bt=null,Yt=0,r=Mt)}if(r!==0){if(r===2&&(p=nf(o),p!==0&&(h=p,r=Ch(o,p))),r===1)throw c=el,yr(o,0),Mo(o,h),Rn(o,It()),c;if(r===6)Mo(o,h);else{if(p=o.current.alternate,(h&30)===0&&!TC(p)&&(r=sd(o,h),r===2&&(y=nf(o),y!==0&&(h=y,r=Ch(o,y))),r===1))throw c=el,yr(o,0),Mo(o,h),Rn(o,It()),c;switch(o.finishedWork=p,o.finishedLanes=h,r){case 0:case 1:throw Error(n(345));case 2:Sr(o,wn,Vi);break;case 3:if(Mo(o,h),(h&130023424)===h&&(r=Ih+500-It(),10<r)){if(gc(o,0)!==0)break;if(p=o.suspendedLanes,(p&h)!==h){un(),o.pingedLanes|=o.suspendedLanes&p;break}o.timeoutHandle=Nf(Sr.bind(null,o,wn,Vi),r);break}Sr(o,wn,Vi);break;case 4:if(Mo(o,h),(h&4194240)===h)break;for(r=o.eventTimes,p=-1;0<h;){var C=31-li(h);y=1<<C,C=r[C],C>p&&(p=C),h&=~y}if(h=p,h=It()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*IC(h/1960))-h,10<h){o.timeoutHandle=Nf(Sr.bind(null,o,wn,Vi),h);break}Sr(o,wn,Vi);break;case 5:Sr(o,wn,Vi);break;default:throw Error(n(329))}}}return Rn(o,It()),o.callbackNode===c?Ry.bind(null,o):null}function Ch(o,r){var c=tl;return o.current.memoizedState.isDehydrated&&(yr(o,r).flags|=256),o=sd(o,r),o!==2&&(r=wn,wn=c,r!==null&&_h(r)),o}function _h(o){wn===null?wn=o:wn.push.apply(wn,o)}function TC(o){for(var r=o;;){if(r.flags&16384){var c=r.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var h=0;h<c.length;h++){var p=c[h],y=p.getSnapshot;p=p.value;try{if(!ci(y(),p))return!1}catch{return!1}}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Mo(o,r){for(r&=~Ah,r&=~ed,o.suspendedLanes|=r,o.pingedLanes&=~r,o=o.expirationTimes;0<r;){var c=31-li(r),h=1<<c;o[c]=-1,r&=~h}}function Py(o){if((Ve&6)!==0)throw Error(n(327));Ts();var r=gc(o,0);if((r&1)===0)return Rn(o,It()),null;var c=sd(o,r);if(o.tag!==0&&c===2){var h=nf(o);h!==0&&(r=h,c=Ch(o,h))}if(c===1)throw c=el,yr(o,0),Mo(o,r),Rn(o,It()),c;if(c===6)throw Error(n(345));return o.finishedWork=o.current.alternate,o.finishedLanes=r,Sr(o,wn,Vi),Rn(o,It()),null}function wh(o,r){var c=Ve;Ve|=1;try{return o(r)}finally{Ve=c,Ve===0&&(Is=It()+500,bc&&Co())}}function mr(o){Do!==null&&Do.tag===0&&(Ve&6)===0&&Ts();var r=Ve;Ve|=1;var c=Qn.transition,h=tt;try{if(Qn.transition=null,tt=1,o)return o()}finally{tt=h,Qn.transition=c,Ve=r,(Ve&6)===0&&Co()}}function Rh(){Fn=As.current,ct(As)}function yr(o,r){o.finishedWork=null,o.finishedLanes=0;var c=o.timeoutHandle;if(c!==-1&&(o.timeoutHandle=-1,QE(c)),wt!==null)for(c=wt.return;c!==null;){var h=c;switch(Ff(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&Mc();break;case 3:ys(),ct(En),ct(Jt),Kf();break;case 5:Xf(h);break;case 4:ys();break;case 13:ct(gt);break;case 19:ct(gt);break;case 10:xf(h.type._context);break;case 22:case 23:Rh()}c=c.return}if(Bt=o,wt=o=Oo(o.current,null),Yt=Fn=r,Mt=0,el=null,Ah=ed=pr=0,wn=tl=null,fr!==null){for(r=0;r<fr.length;r++)if(c=fr[r],h=c.interleaved,h!==null){c.interleaved=null;var p=h.next,y=c.pending;if(y!==null){var C=y.next;y.next=p,h.next=C}c.pending=h}fr=null}return o}function Dy(o,r){do{var c=wt;try{if($f(),Wc.current=Xc,Yc){for(var h=pt.memoizedState;h!==null;){var p=h.queue;p!==null&&(p.pending=null),h=h.next}Yc=!1}if(gr=0,kt=Nt=pt=null,Va=!1,Ka=0,vh.current=null,c===null||c.return===null){Mt=1,el=r,wt=null;break}e:{var y=o,C=c.return,O=c,B=r;if(r=Yt,O.flags|=32768,B!==null&&typeof B=="object"&&typeof B.then=="function"){var W=B,ee=O,ne=ee.tag;if((ee.mode&1)===0&&(ne===0||ne===11||ne===15)){var Q=ee.alternate;Q?(ee.updateQueue=Q.updateQueue,ee.memoizedState=Q.memoizedState,ee.lanes=Q.lanes):(ee.updateQueue=null,ee.memoizedState=null)}var me=ey(C);if(me!==null){me.flags&=-257,ty(me,C,O,y,r),me.mode&1&&J0(y,W,r),r=me,B=W;var Ae=r.updateQueue;if(Ae===null){var Ee=new Set;Ee.add(B),r.updateQueue=Ee}else Ae.add(B);break e}else{if((r&1)===0){J0(y,W,r),Ph();break e}B=Error(n(426))}}else if(ut&&O.mode&1){var Tt=ey(C);if(Tt!==null){(Tt.flags&65536)===0&&(Tt.flags|=256),ty(Tt,C,O,y,r),Hf(Ss(B,O));break e}}y=B=Ss(B,O),Mt!==4&&(Mt=2),tl===null?tl=[y]:tl.push(y),y=C;do{switch(y.tag){case 3:y.flags|=65536,r&=-r,y.lanes|=r;var $=Z0(y,B,r);C0(y,$);break e;case 1:O=B;var L=y.type,x=y.stateNode;if((y.flags&128)===0&&(typeof L.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Po===null||!Po.has(x)))){y.flags|=65536,r&=-r,y.lanes|=r;var ie=Q0(y,O,r);C0(y,ie);break e}}y=y.return}while(y!==null)}Oy(c)}catch(we){r=we,wt===c&&c!==null&&(wt=c=c.return);continue}break}while(!0)}function Ny(){var o=Jc.current;return Jc.current=Xc,o===null?Xc:o}function Ph(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),Bt===null||(pr&268435455)===0&&(ed&268435455)===0||Mo(Bt,Yt)}function sd(o,r){var c=Ve;Ve|=2;var h=Ny();(Bt!==o||Yt!==r)&&(Vi=null,yr(o,r));do try{EC();break}catch(p){Dy(o,p)}while(!0);if($f(),Ve=c,Jc.current=h,wt!==null)throw Error(n(261));return Bt=null,Yt=0,Mt}function EC(){for(;wt!==null;)My(wt)}function CC(){for(;wt!==null&&!KT();)My(wt)}function My(o){var r=By(o.alternate,o,Fn);o.memoizedProps=o.pendingProps,r===null?Oy(o):wt=r,vh.current=null}function Oy(o){var r=o;do{var c=r.alternate;if(o=r.return,(r.flags&32768)===0){if(c=mC(c,r,Fn),c!==null){wt=c;return}}else{if(c=yC(c,r),c!==null){c.flags&=32767,wt=c;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{Mt=6,wt=null;return}}if(r=r.sibling,r!==null){wt=r;return}wt=r=o}while(r!==null);Mt===0&&(Mt=5)}function Sr(o,r,c){var h=tt,p=Qn.transition;try{Qn.transition=null,tt=1,_C(o,r,c,h)}finally{Qn.transition=p,tt=h}return null}function _C(o,r,c,h){do Ts();while(Do!==null);if((Ve&6)!==0)throw Error(n(327));c=o.finishedWork;var p=o.finishedLanes;if(c===null)return null;if(o.finishedWork=null,o.finishedLanes=0,c===o.current)throw Error(n(177));o.callbackNode=null,o.callbackPriority=0;var y=c.lanes|c.childLanes;if(rE(o,y),o===Bt&&(wt=Bt=null,Yt=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||nd||(nd=!0,Fy(dc,function(){return Ts(),null})),y=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||y){y=Qn.transition,Qn.transition=null;var C=tt;tt=1;var O=Ve;Ve|=4,vh.current=null,vC(o,c),Ty(c,o),zE(Pf),yc=!!Rf,Pf=Rf=null,o.current=c,AC(c),qT(),Ve=O,tt=C,Qn.transition=y}else o.current=c;if(nd&&(nd=!1,Do=o,id=p),y=o.pendingLanes,y===0&&(Po=null),JT(c.stateNode),Rn(o,It()),r!==null)for(h=o.onRecoverableError,c=0;c<r.length;c++)p=r[c],h(p.value,{componentStack:p.stack,digest:p.digest});if(td)throw td=!1,o=Th,Th=null,o;return(id&1)!==0&&o.tag!==0&&Ts(),y=o.pendingLanes,(y&1)!==0?o===Eh?nl++:(nl=0,Eh=o):nl=0,Co(),null}function Ts(){if(Do!==null){var o=Am(id),r=Qn.transition,c=tt;try{if(Qn.transition=null,tt=16>o?16:o,Do===null)var h=!1;else{if(o=Do,Do=null,id=0,(Ve&6)!==0)throw Error(n(331));var p=Ve;for(Ve|=4,Se=o.current;Se!==null;){var y=Se,C=y.child;if((Se.flags&16)!==0){var O=y.deletions;if(O!==null){for(var B=0;B<O.length;B++){var W=O[B];for(Se=W;Se!==null;){var ee=Se;switch(ee.tag){case 0:case 11:case 15:Ja(8,ee,y)}var ne=ee.child;if(ne!==null)ne.return=ee,Se=ne;else for(;Se!==null;){ee=Se;var Q=ee.sibling,me=ee.return;if(yy(ee),ee===W){Se=null;break}if(Q!==null){Q.return=me,Se=Q;break}Se=me}}}var Ae=y.alternate;if(Ae!==null){var Ee=Ae.child;if(Ee!==null){Ae.child=null;do{var Tt=Ee.sibling;Ee.sibling=null,Ee=Tt}while(Ee!==null)}}Se=y}}if((y.subtreeFlags&2064)!==0&&C!==null)C.return=y,Se=C;else e:for(;Se!==null;){if(y=Se,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:Ja(9,y,y.return)}var $=y.sibling;if($!==null){$.return=y.return,Se=$;break e}Se=y.return}}var L=o.current;for(Se=L;Se!==null;){C=Se;var x=C.child;if((C.subtreeFlags&2064)!==0&&x!==null)x.return=C,Se=x;else e:for(C=L;Se!==null;){if(O=Se,(O.flags&2048)!==0)try{switch(O.tag){case 0:case 11:case 15:Qc(9,O)}}catch(we){St(O,O.return,we)}if(O===C){Se=null;break e}var ie=O.sibling;if(ie!==null){ie.return=O.return,Se=ie;break e}Se=O.return}}if(Ve=p,Co(),Ti&&typeof Ti.onPostCommitFiberRoot=="function")try{Ti.onPostCommitFiberRoot(uc,o)}catch{}h=!0}return h}finally{tt=c,Qn.transition=r}}return!1}function by(o,r,c){r=Ss(c,r),r=Z0(o,r,1),o=wo(o,r,1),r=un(),o!==null&&(wa(o,1,r),Rn(o,r))}function St(o,r,c){if(o.tag===3)by(o,o,c);else for(;r!==null;){if(r.tag===3){by(r,o,c);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Po===null||!Po.has(h))){o=Ss(c,o),o=Q0(r,o,1),r=wo(r,o,1),o=un(),r!==null&&(wa(r,1,o),Rn(r,o));break}}r=r.return}}function wC(o,r,c){var h=o.pingCache;h!==null&&h.delete(r),r=un(),o.pingedLanes|=o.suspendedLanes&c,Bt===o&&(Yt&c)===c&&(Mt===4||Mt===3&&(Yt&130023424)===Yt&&500>It()-Ih?yr(o,0):Ah|=c),Rn(o,r)}function ky(o,r){r===0&&((o.mode&1)===0?r=1:(r=hc,hc<<=1,(hc&130023424)===0&&(hc=4194304)));var c=un();o=zi(o,r),o!==null&&(wa(o,r,c),Rn(o,c))}function RC(o){var r=o.memoizedState,c=0;r!==null&&(c=r.retryLane),ky(o,c)}function PC(o,r){var c=0;switch(o.tag){case 13:var h=o.stateNode,p=o.memoizedState;p!==null&&(c=p.retryLane);break;case 19:h=o.stateNode;break;default:throw Error(n(314))}h!==null&&h.delete(r),ky(o,c)}var By;By=function(o,r,c){if(o!==null)if(o.memoizedProps!==r.pendingProps||En.current)_n=!0;else{if((o.lanes&c)===0&&(r.flags&128)===0)return _n=!1,pC(o,r,c);_n=(o.flags&131072)!==0}else _n=!1,ut&&(r.flags&1048576)!==0&&g0(r,Bc,r.index);switch(r.lanes=0,r.tag){case 2:var h=r.type;qc(o,r),o=r.pendingProps;var p=ds(r,Jt.current);ms(r,c),p=Qf(null,r,h,o,p,c);var y=Jf();return r.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Cn(h)?(y=!0,Oc(r)):y=!1,r.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,zf(r),p.updater=Vc,r.stateNode=p,p._reactInternals=r,rh(r,h,o,c),r=ch(null,r,h,!0,y,c)):(r.tag=0,ut&&y&&Bf(r),dn(null,r,p,c),r=r.child),r;case 16:h=r.elementType;e:{switch(qc(o,r),o=r.pendingProps,p=h._init,h=p(h._payload),r.type=h,p=r.tag=NC(h),o=ui(h,o),p){case 0:r=lh(null,r,h,o,c);break e;case 1:r=ay(null,r,h,o,c);break e;case 11:r=ny(null,r,h,o,c);break e;case 14:r=iy(null,r,h,ui(h.type,o),c);break e}throw Error(n(306,h,""))}return r;case 0:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:ui(h,p),lh(o,r,h,p,c);case 1:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:ui(h,p),ay(o,r,h,p,c);case 3:e:{if(ly(r),o===null)throw Error(n(387));h=r.pendingProps,y=r.memoizedState,p=y.element,E0(o,r),$c(r,h,null,c);var C=r.memoizedState;if(h=C.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){p=Ss(Error(n(423)),r),r=cy(o,r,h,c,p);break e}else if(h!==p){p=Ss(Error(n(424)),r),r=cy(o,r,h,c,p);break e}else for(Bn=Io(r.stateNode.containerInfo.firstChild),kn=r,ut=!0,di=null,c=I0(r,null,h,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(hs(),h===p){r=Xi(o,r,c);break e}dn(o,r,h,c)}r=r.child}return r;case 5:return w0(r),o===null&&Uf(r),h=r.type,p=r.pendingProps,y=o!==null?o.memoizedProps:null,C=p.children,Df(h,p)?C=null:y!==null&&Df(h,y)&&(r.flags|=32),sy(o,r),dn(o,r,C,c),r.child;case 6:return o===null&&Uf(r),null;case 13:return dy(o,r,c);case 4:return jf(r,r.stateNode.containerInfo),h=r.pendingProps,o===null?r.child=gs(r,null,h,c):dn(o,r,h,c),r.child;case 11:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:ui(h,p),ny(o,r,h,p,c);case 7:return dn(o,r,r.pendingProps,c),r.child;case 8:return dn(o,r,r.pendingProps.children,c),r.child;case 12:return dn(o,r,r.pendingProps.children,c),r.child;case 10:e:{if(h=r.type._context,p=r.pendingProps,y=r.memoizedProps,C=p.value,st(Uc,h._currentValue),h._currentValue=C,y!==null)if(ci(y.value,C)){if(y.children===p.children&&!En.current){r=Xi(o,r,c);break e}}else for(y=r.child,y!==null&&(y.return=r);y!==null;){var O=y.dependencies;if(O!==null){C=y.child;for(var B=O.firstContext;B!==null;){if(B.context===h){if(y.tag===1){B=ji(-1,c&-c),B.tag=2;var W=y.updateQueue;if(W!==null){W=W.shared;var ee=W.pending;ee===null?B.next=B:(B.next=ee.next,ee.next=B),W.pending=B}}y.lanes|=c,B=y.alternate,B!==null&&(B.lanes|=c),Wf(y.return,c,r),O.lanes|=c;break}B=B.next}}else if(y.tag===10)C=y.type===r.type?null:y.child;else if(y.tag===18){if(C=y.return,C===null)throw Error(n(341));C.lanes|=c,O=C.alternate,O!==null&&(O.lanes|=c),Wf(C,c,r),C=y.sibling}else C=y.child;if(C!==null)C.return=y;else for(C=y;C!==null;){if(C===r){C=null;break}if(y=C.sibling,y!==null){y.return=C.return,C=y;break}C=C.return}y=C}dn(o,r,p.children,c),r=r.child}return r;case 9:return p=r.type,h=r.pendingProps.children,ms(r,c),p=qn(p),h=h(p),r.flags|=1,dn(o,r,h,c),r.child;case 14:return h=r.type,p=ui(h,r.pendingProps),p=ui(h.type,p),iy(o,r,h,p,c);case 15:return oy(o,r,r.type,r.pendingProps,c);case 17:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:ui(h,p),qc(o,r),r.tag=1,Cn(h)?(o=!0,Oc(r)):o=!1,ms(r,c),K0(r,h,p),rh(r,h,p,c),ch(null,r,h,!0,o,c);case 19:return fy(o,r,c);case 22:return ry(o,r,c)}throw Error(n(156,r.tag))};function Fy(o,r){return pm(o,r)}function DC(o,r,c,h){this.tag=o,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jn(o,r,c,h){return new DC(o,r,c,h)}function Dh(o){return o=o.prototype,!(!o||!o.isReactComponent)}function NC(o){if(typeof o=="function")return Dh(o)?1:0;if(o!=null){if(o=o.$$typeof,o===X)return 11;if(o===le)return 14}return 2}function Oo(o,r){var c=o.alternate;return c===null?(c=Jn(o.tag,r,o.key,o.mode),c.elementType=o.elementType,c.type=o.type,c.stateNode=o.stateNode,c.alternate=o,o.alternate=c):(c.pendingProps=r,c.type=o.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=o.flags&14680064,c.childLanes=o.childLanes,c.lanes=o.lanes,c.child=o.child,c.memoizedProps=o.memoizedProps,c.memoizedState=o.memoizedState,c.updateQueue=o.updateQueue,r=o.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=o.sibling,c.index=o.index,c.ref=o.ref,c}function ad(o,r,c,h,p,y){var C=2;if(h=o,typeof o=="function")Dh(o)&&(C=1);else if(typeof o=="string")C=5;else e:switch(o){case M:return vr(c.children,p,y,r);case k:C=8,p|=8;break;case U:return o=Jn(12,c,r,p|2),o.elementType=U,o.lanes=y,o;case J:return o=Jn(13,c,r,p),o.elementType=J,o.lanes=y,o;case Z:return o=Jn(19,c,r,p),o.elementType=Z,o.lanes=y,o;case te:return ld(c,p,y,r);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case j:C=10;break e;case K:C=9;break e;case X:C=11;break e;case le:C=14;break e;case re:C=16,h=null;break e}throw Error(n(130,o==null?o:typeof o,""))}return r=Jn(C,c,r,p),r.elementType=o,r.type=h,r.lanes=y,r}function vr(o,r,c,h){return o=Jn(7,o,h,r),o.lanes=c,o}function ld(o,r,c,h){return o=Jn(22,o,h,r),o.elementType=te,o.lanes=c,o.stateNode={isHidden:!1},o}function Nh(o,r,c){return o=Jn(6,o,null,r),o.lanes=c,o}function Mh(o,r,c){return r=Jn(4,o.children!==null?o.children:[],o.key,r),r.lanes=c,r.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},r}function MC(o,r,c,h,p){this.tag=r,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=of(0),this.expirationTimes=of(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=of(0),this.identifierPrefix=h,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function Oh(o,r,c,h,p,y,C,O,B){return o=new MC(o,r,c,O,B),r===1?(r=1,y===!0&&(r|=8)):r=0,y=Jn(3,null,null,r),o.current=y,y.stateNode=o,y.memoizedState={element:h,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},zf(y),o}function OC(o,r,c){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:h==null?null:""+h,children:o,containerInfo:r,implementation:c}}function Ly(o){if(!o)return Eo;o=o._reactInternals;e:{if(ar(o)!==o||o.tag!==1)throw Error(n(170));var r=o;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Cn(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(o.tag===1){var c=o.type;if(Cn(c))return u0(o,c,r)}return r}function Uy(o,r,c,h,p,y,C,O,B){return o=Oh(c,h,!0,o,p,y,C,O,B),o.context=Ly(null),c=o.current,h=un(),p=No(c),y=ji(h,p),y.callback=r??null,wo(c,y,p),o.current.lanes=p,wa(o,p,h),Rn(o,h),o}function cd(o,r,c,h){var p=r.current,y=un(),C=No(p);return c=Ly(c),r.context===null?r.context=c:r.pendingContext=c,r=ji(y,C),r.payload={element:o},h=h===void 0?null:h,h!==null&&(r.callback=h),o=wo(p,r,C),o!==null&&(gi(o,p,C,y),Gc(o,p,C)),C}function dd(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function Hy(o,r){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var c=o.retryLane;o.retryLane=c!==0&&c<r?c:r}}function bh(o,r){Hy(o,r),(o=o.alternate)&&Hy(o,r)}function bC(){return null}var Gy=typeof reportError=="function"?reportError:function(o){console.error(o)};function kh(o){this._internalRoot=o}ud.prototype.render=kh.prototype.render=function(o){var r=this._internalRoot;if(r===null)throw Error(n(409));cd(o,r,null,null)},ud.prototype.unmount=kh.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var r=o.containerInfo;mr(function(){cd(null,o,null,null)}),r[$i]=null}};function ud(o){this._internalRoot=o}ud.prototype.unstable_scheduleHydration=function(o){if(o){var r=Em();o={blockedOn:null,target:o,priority:r};for(var c=0;c<So.length&&r!==0&&r<So[c].priority;c++);So.splice(c,0,o),c===0&&wm(o)}};function Bh(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function fd(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function $y(){}function kC(o,r,c,h,p){if(p){if(typeof h=="function"){var y=h;h=function(){var W=dd(C);y.call(W)}}var C=Uy(r,h,o,0,null,!1,!1,"",$y);return o._reactRootContainer=C,o[$i]=C.current,Ga(o.nodeType===8?o.parentNode:o),mr(),C}for(;p=o.lastChild;)o.removeChild(p);if(typeof h=="function"){var O=h;h=function(){var W=dd(B);O.call(W)}}var B=Oh(o,0,!1,null,null,!1,!1,"",$y);return o._reactRootContainer=B,o[$i]=B.current,Ga(o.nodeType===8?o.parentNode:o),mr(function(){cd(r,B,c,h)}),B}function hd(o,r,c,h,p){var y=c._reactRootContainer;if(y){var C=y;if(typeof p=="function"){var O=p;p=function(){var B=dd(C);O.call(B)}}cd(r,C,o,p)}else C=kC(c,r,o,p,h);return dd(C)}Im=function(o){switch(o.tag){case 3:var r=o.stateNode;if(r.current.memoizedState.isDehydrated){var c=_a(r.pendingLanes);c!==0&&(rf(r,c|1),Rn(r,It()),(Ve&6)===0&&(Is=It()+500,Co()))}break;case 13:mr(function(){var h=zi(o,1);if(h!==null){var p=un();gi(h,o,1,p)}}),bh(o,1)}},sf=function(o){if(o.tag===13){var r=zi(o,134217728);if(r!==null){var c=un();gi(r,o,134217728,c)}bh(o,134217728)}},Tm=function(o){if(o.tag===13){var r=No(o),c=zi(o,r);if(c!==null){var h=un();gi(c,o,r,h)}bh(o,r)}},Em=function(){return tt},Cm=function(o,r){var c=tt;try{return tt=o,r()}finally{tt=c}},Zu=function(o,r,c){switch(r){case"input":if(Tn(o,c),r=c.name,c.type==="radio"&&r!=null){for(c=o;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<c.length;r++){var h=c[r];if(h!==o&&h.form===o.form){var p=Nc(h);if(!p)throw Error(n(90));Te(h),Tn(h,p)}}}break;case"textarea":Jp(o,c);break;case"select":r=c.value,r!=null&&go(o,!!c.multiple,r,!1)}},lm=wh,cm=mr;var BC={usingClientEntryPoint:!1,Events:[Wa,ls,Nc,sm,am,wh]},il={findFiberByHostInstance:lr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},FC={bundleType:il.bundleType,version:il.version,rendererPackageName:il.rendererPackageName,rendererConfig:il.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=hm(o),o===null?null:o.stateNode},findFiberByHostInstance:il.findFiberByHostInstance||bC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var gd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!gd.isDisabled&&gd.supportsFiber)try{uc=gd.inject(FC),Ti=gd}catch{}}return Pn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BC,Pn.createPortal=function(o,r){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bh(r))throw Error(n(200));return OC(o,r,null,c)},Pn.createRoot=function(o,r){if(!Bh(o))throw Error(n(299));var c=!1,h="",p=Gy;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),r=Oh(o,1,!1,null,null,c,!1,h,p),o[$i]=r.current,Ga(o.nodeType===8?o.parentNode:o),new kh(r)},Pn.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var r=o._reactInternals;if(r===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=hm(r),o=o===null?null:o.stateNode,o},Pn.flushSync=function(o){return mr(o)},Pn.hydrate=function(o,r,c){if(!fd(r))throw Error(n(200));return hd(null,o,r,!0,c)},Pn.hydrateRoot=function(o,r,c){if(!Bh(o))throw Error(n(405));var h=c!=null&&c.hydratedSources||null,p=!1,y="",C=Gy;if(c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(y=c.identifierPrefix),c.onRecoverableError!==void 0&&(C=c.onRecoverableError)),r=Uy(r,null,o,1,c??null,p,!1,y,C),o[$i]=r.current,Ga(o),h)for(o=0;o<h.length;o++)c=h[o],p=c._getVersion,p=p(c._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[c,p]:r.mutableSourceEagerHydrationData.push(c,p);return new ud(r)},Pn.render=function(o,r,c){if(!fd(r))throw Error(n(200));return hd(null,o,r,!1,c)},Pn.unmountComponentAtNode=function(o){if(!fd(o))throw Error(n(40));return o._reactRootContainer?(mr(function(){hd(null,null,o,!1,function(){o._reactRootContainer=null,o[$i]=null})}),!0):!1},Pn.unstable_batchedUpdates=wh,Pn.unstable_renderSubtreeIntoContainer=function(o,r,c,h){if(!fd(c))throw Error(n(200));if(o==null||o._reactInternals===void 0)throw Error(n(38));return hd(o,r,c,!1,h)},Pn.version="18.3.1-next-f1338f8080-20240426",Pn}var Ky;function jC(){if(Ky)return Uh.exports;Ky=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Uh.exports=zC(),Uh.exports}var qy;function XC(){if(qy)return pd;qy=1;var e=jC();return pd.createRoot=e.createRoot,pd.hydrateRoot=e.hydrateRoot,pd}var VC=XC();const KC=Yv(VC);class qC{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let i=this.length++;for(;i>0;){const s=i-1>>1,a=this.values[s];if(n>=a)break;this.ids[i]=this.ids[s],this.values[i]=a,i=s}this.ids[i]=t,this.values[i]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let l=(a<<1)+1;const d=l+1;let u=this.ids[l],f=this.values[l];const g=this.values[d];if(d<this.length&&g<f&&(l=d,u=this.ids[d],f=g),f>=i)break;this.ids[a]=u,this.values[a]=f,a=l}this.ids[a]=n,this.values[a]=i}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Zy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],$h=3;class tp{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[i,s]=new Uint8Array(t,n+0,2);if(i!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==$h)throw new Error(`Got v${a} data when expected v${$h}.`);const l=Zy[s&15];if(!l)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,n+2,1),[u]=new Uint32Array(t,n+4,1);return new tp(u,d,l,void 0,t,n)}constructor(t,n=16,i=Float64Array,s=ArrayBuffer,a,l=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=l;let d=t,u=d;this._levelBounds=[d*4];do d=Math.ceil(d/this.nodeSize),u+=d,this._levelBounds.push(u*4);while(d!==1);this.ArrayType=i,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const f=Zy.indexOf(this.ArrayType),g=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(f<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,l+8,u*4),this._indices=new this.IndexArrayType(this.data,l+8+g,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+g+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+g,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,($h<<4)+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new qC}add(t,n,i=t,s=n){const a=this._pos>>2,l=this._boxes;return this._indices[a]=a,l[this._pos++]=t,l[this._pos++]=n,l[this._pos++]=i,l[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),i>this.maxX&&(this.maxX=i),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,i=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let l=0,d=0;l<this.numItems;l++){const u=t[d++],f=t[d++],g=t[d++],m=t[d++],S=Math.floor(a*((u+g)/2-this.minX)/n),v=Math.floor(a*((f+m)/2-this.minY)/i);s[l]=QC(S,v)}Tg(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let l=0,d=0;l<this._levelBounds.length-1;l++){const u=this._levelBounds[l];for(;d<u;){const f=d;let g=t[d++],m=t[d++],S=t[d++],v=t[d++];for(let I=1;I<this.nodeSize&&d<u;I++)g=Math.min(g,t[d++]),m=Math.min(m,t[d++]),S=Math.max(S,t[d++]),v=Math.max(v,t[d++]);this._indices[this._pos>>2]=f,t[this._pos++]=g,t[this._pos++]=m,t[this._pos++]=S,t[this._pos++]=v}}}search(t,n,i,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const d=[],u=[];for(;l!==void 0;){const f=Math.min(l+this.nodeSize*4,Jy(l,this._levelBounds));for(let g=l;g<f;g+=4){if(i<this._boxes[g]||s<this._boxes[g+1]||t>this._boxes[g+2]||n>this._boxes[g+3])continue;const m=this._indices[g>>2]|0;l>=this.numItems*4?d.push(m):(a===void 0||a(m))&&u.push(m)}l=d.pop()}return u}neighbors(t,n,i=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const d=this._queue,u=[],f=s*s;e:for(;l!==void 0;){const g=Math.min(l+this.nodeSize*4,Jy(l,this._levelBounds));for(let m=l;m<g;m+=4){const S=this._indices[m>>2]|0,v=Qy(t,this._boxes[m],this._boxes[m+2]),I=Qy(n,this._boxes[m+1],this._boxes[m+3]),A=v*v+I*I;A>f||(l>=this.numItems*4?d.push(S<<1,A):(a===void 0||a(S))&&d.push((S<<1)+1,A))}for(;d.length&&d.peek()&1;)if(d.peekValue()>f||(u.push(d.pop()>>1),u.length===i))break e;l=d.length?d.pop()>>1:void 0}return d.clear(),u}}function Qy(e,t,n){return e<t?t-e:e<=n?0:e-n}function Jy(e,t){let n=0,i=t.length-1;for(;n<i;){const s=n+i>>1;t[s]>e?i=s:n=s+1}return t[n]}function Tg(e,t,n,i,s,a){if(Math.floor(i/a)>=Math.floor(s/a))return;const l=e[i+s>>1];let d=i-1,u=s+1;for(;;){do d++;while(e[d]<l);do u--;while(e[u]>l);if(d>=u)break;ZC(e,t,n,d,u)}Tg(e,t,n,i,u,a),Tg(e,t,n,u+1,s,a)}function ZC(e,t,n,i,s){const a=e[i];e[i]=e[s],e[s]=a;const l=4*i,d=4*s,u=t[l],f=t[l+1],g=t[l+2],m=t[l+3];t[l]=t[d],t[l+1]=t[d+1],t[l+2]=t[d+2],t[l+3]=t[d+3],t[d]=u,t[d+1]=f,t[d+2]=g,t[d+3]=m;const S=n[i];n[i]=n[s],n[s]=S}function QC(e,t){let n=e^t,i=65535^n,s=65535^(e|t),a=e&(t^65535),l=n|i>>1,d=n>>1^n,u=s>>1^i&a>>1^s,f=n&s>>1^a>>1^a;n=l,i=d,s=u,a=f,l=n&n>>2^i&i>>2,d=n&i>>2^i&(n^i)>>2,u^=n&s>>2^i&a>>2,f^=i&s>>2^(n^i)&a>>2,n=l,i=d,s=u,a=f,l=n&n>>4^i&i>>4,d=n&i>>4^i&(n^i)>>4,u^=n&s>>4^i&a>>4,f^=i&s>>4^(n^i)&a>>4,n=l,i=d,s=u,a=f,u^=n&s>>8^i&a>>8,f^=i&s>>8^(n^i)&a>>8,n=u^u>>1,i=f^f>>1;let g=e^t,m=i|65535^(g|n);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|g)>>>0}function oi(e,t){return{x:e.x+t.x,y:e.y+t.y}}function JC(e,t){return{x:e.x-t.x,y:e.y-t.y}}function At(e,t){return{x:e.x*t,y:e.y*t}}function Js(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function ot(e){const t=Js(e);return t===0?{x:0,y:0}:At(e,1/t)}function np(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function Zd(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,i)=>({x:n.x+i.x,y:n.y+i.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Xe(e,t,n,i){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>i/2&&(a=a-Math.sign(a)*i),{x:s,y:a}}function $e(e,t,n){const i=Xe(e,t,n.width,n.height);return ot(i)}function H(e,t,n,i){const s=Xe(e,t,n,i);return Js(s)}function Nn(e,t,n,i){const s=Xe(e,t,n,i);return s.x*s.x+s.y*s.y}function zv(e,t){return e.x*t.x+e.y*t.y}function e_(e,t){const n=zv(e,t),i=Js(e),s=Js(t);if(i===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(i*s)));return Math.acos(a)}function Eg(e,t){const n=Math.cos(t),i=Math.sin(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function t_(e,t,n){const i=Math.max(0,Math.min(1,n)),s={r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16)},a={r:parseInt(t.substring(1,3),16),g:parseInt(t.substring(3,5),16),b:parseInt(t.substring(5,7),16)},l=Math.round(s.r+(a.r-s.r)*i),d=Math.round(s.g+(a.g-s.g)*i),u=Math.round(s.b+(a.b-s.b)*i),f=g=>("00"+g.toString(16)).slice(-2);return`#${f(l)}${f(d)}${f(u)}`}function n_(e,t){return t.split(".").reduce((n,i)=>{if(n&&typeof n=="object"&&i in n)return n[i]},e)}function Zi(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new tp(e.length),i=new Map,s=new Map;let a=0;const l=new Uint32Array(e.length);for(let u=0;u<e.length;u++){const f=e[u];f.width!==void 0&&f.height!==void 0?n.add(f.position.x,f.position.y,f.position.x+f.width,f.position.y+f.height):n.add(f.position.x,f.position.y,f.position.x,f.position.y)}return n.finish(),{all(){return e},byRect(u){const{width:f,height:g}=t,m=[];a++;const S=[];u.left<0?(S.push({left:u.left+f,right:f}),S.push({left:0,right:u.right})):u.right>f?(S.push({left:u.left,right:f}),S.push({left:0,right:u.right-f})):S.push({left:u.left,right:u.right});const v=[];u.top<0?(v.push({top:u.top+g,bottom:g}),v.push({top:0,bottom:u.bottom})):u.bottom>g?(v.push({top:u.top,bottom:g}),v.push({top:0,bottom:u.bottom-g})):v.push({top:u.top,bottom:u.bottom});for(let I=0;I<S.length;I++){const A=S[I];for(let _=0;_<v.length;_++){const R=v[_],P=n.search(A.left,R.top,A.right,R.bottom);for(let w=0;w<P.length;w++){const b=P[w];l[b]!==a&&(l[b]=a,m.push(e[b]))}}}return m},byRadius(u,f){const{width:g,height:m}=t,S=[];a++;const v=f*f,I=u.x-f,A=u.x+f,_=u.y-f,R=u.y+f,P=[];I<0?(P.push({left:I+g,right:g}),P.push({left:0,right:A})):A>g?(P.push({left:I,right:g}),P.push({left:0,right:A-g})):P.push({left:I,right:A});const w=[];_<0?(w.push({top:_+m,bottom:m}),w.push({top:0,bottom:R})):R>m?(w.push({top:_,bottom:m}),w.push({top:0,bottom:R-m})):w.push({top:_,bottom:R});for(let b=0;b<P.length;b++){const N=P[b];for(let D=0;D<w.length;D++){const M=w[D],k=n.search(N.left,M.top,N.right,M.bottom);for(let U=0;U<k.length;U++){const j=k[U];if(l[j]!==a){l[j]=a;const K=e[j];Nn(u,K.position,g,m)<=v&&S.push(K)}}}}return S},byProperty(u,f){var g;if(!i.has(u)){const m=new Map;for(let S=0;S<e.length;S++){const v=e[S],I=v[u];m.has(I)||m.set(I,[]),m.get(I).push(v)}i.set(u,m)}return((g=i.get(u))==null?void 0:g.get(f))||[]},byPropertyPath(u,f){var g;if(!s.has(u)){const m=new Map;for(let S=0;S<e.length;S++){const v=e[S],I=n_(v,u);m.has(I)||m.set(I,[]),m.get(I).push(v)}s.set(u,m)}return((g=s.get(u))==null?void 0:g.get(f))||[]},resetPropertyCache(){i.clear(),s.clear()},count(){return e.length}}}function yu(e){var m,S;const t=e.entities.entities,n=[],i=[],s=[],a=[],l=[],d=[],u=[];for(const v in t){const I=t[v];switch(I.type){case"human":n.push(I);break;case"berryBush":i.push(I);break;case"corpse":s.push(I);break;case"prey":a.push(I);break;case"predator":l.push(I);break;case"building":d.push(I);break;case"tree":u.push(I);break}}const f=e.mapDimensions;return{...e,search:{human:Zi(n,f),berryBush:Zi(i,f),corpse:Zi(s,f),prey:Zi(a,f),predator:Zi(l,f),building:Zi(d,f),tree:Zi(u,f),tasks:((m=e.search)==null?void 0:m.tasks)??Zi([],f)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((S=e.cache)==null?void 0:S.tribeCenters)??{}}}}function i_(e){const t=[];for(const n in e.tasks)t.push(e.tasks[n]);e.search.tasks=Zi(t,e.mapDimensions)}const ce={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire"},ir={[ce.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[ce.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[ce.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[ce.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}}},o_=.5,r_="#FFA500",s_="#FF4500",eS=4,a_=10,ip=60;function op(e){return ir[e].dimensions}function l_(e){return ir[e].constructionTimeHours}function c_(e){return ir[e].destructionTimeHours}const jv=5;function d_(){return ir[ce.PlantingZone].dimensions}function tS(e,t,n){const i=e.position.x+n.width/2,a=t.position.x-n.width/2-i,l=e.position.y-n.height/2,d=e.position.y+n.height/2,u=t.position.y-n.height/2,f=t.position.y+n.height/2,g=Math.min(d,f)-Math.max(l,u);return a>=-5&&a<=jv&&g>n.height*.5}function nS(e,t,n){const i=e.position.y+n.height/2,a=t.position.y-n.height/2-i,l=e.position.x-n.width/2,d=e.position.x+n.width/2,u=t.position.x-n.width/2,f=t.position.x+n.width/2,g=Math.min(d,f)-Math.max(l,u);return a>=-5&&a<=jv&&g>n.width*.5}function u_(e){var l;const t={},n=d_(),i=e;if(!((l=i.search)!=null&&l.building))return t;const a=i.search.building.all().filter(d=>d.buildingType===ce.PlantingZone&&d.isConstructed);for(const d of a)t[d.id]={top:!1,bottom:!1,left:!1,right:!1};for(let d=0;d<a.length;d++){const u=a[d];for(let f=d+1;f<a.length;f++){const g=a[f];u.ownerId===g.ownerId&&(tS(u,g,n)&&(t[u.id].right=!0,t[g.id].left=!0),tS(g,u,n)&&(t[g.id].right=!0,t[u.id].left=!0),nS(u,g,n)&&(t[u.id].bottom=!0,t[g.id].top=!0),nS(g,u,n)&&(t[g.id].bottom=!0,t[u.id].top=!0))}}return t}function Fl(e){e.plantingZoneConnections=u_(e)}var Dr=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(Dr||{});class f_{constructor(){De(this,"worker",null);De(this,"pendingRequests",new Map);De(this,"requestQueue",[]);De(this,"isProcessing",!1);De(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case Dr.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case Dr.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case Dr.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,i)=>{if(!this.worker){i(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:i});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),i(s)}})}queueOperation(t){return new Promise((n,i)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){i(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),i=t,s={type:Dr.SAVE_REQUEST,id:n,gameState:i};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Dr.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Dr.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const rp=new f_;async function sp(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,roleManagerOpen:e.roleManagerOpen,armyControlOpen:e.armyControlOpen,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks};await rp.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function h_(){try{const e=await rp.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=yu(t);return Fl(n),n}catch(e){return console.error("Failed to load game:",e),await Xv(),null}}async function Xv(){try{await rp.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const Vv=Fe.createContext(void 0),g_=({initialAppState:e,children:t})=>{const[n,i]=Fe.useState(e),[s,a]=Fe.useState(void 0),[l,d]=Fe.useState(null),[u,f]=Fe.useState(!1);Fe.useEffect(()=>{h_().then(I=>{I&&d(I),f(!0)})},[]);const g=(I,A)=>{i(I),I==="gameOver"&&A?a(A):I!=="gameOver"&&a(void 0)},m=()=>{i("intro"),a(void 0),v()},S=I=>{sp(I),d(I)},v=()=>{Xv(),d(null)};return Ue.jsx(Vv.Provider,{value:{appState:n,setAppState:g,returnToIntro:m,gameOverDetails:s,contextReady:u,savedGameState:l,setSavedGameState:d,saveCurrentGame:S,clearCurrentSave:v},children:t})},Kr=()=>{const e=Fe.useContext(Vv);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var rn=function(){return rn=Object.assign||function(t){for(var n,i=1,s=arguments.length;i<s;i++){n=arguments[i];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},rn.apply(this,arguments)};function Ll(e,t,n){if(n||arguments.length===2)for(var i=0,s=t.length,a;i<s;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return e.concat(a||Array.prototype.slice.call(t))}var dt="-ms-",Cl="-moz-",Je="-webkit-",Kv="comm",Su="rule",ap="decl",p_="@import",qv="@keyframes",m_="@layer",Zv=Math.abs,lp=String.fromCharCode,Cg=Object.assign;function y_(e,t){return Lt(e,0)^45?(((t<<2^Lt(e,0))<<2^Lt(e,1))<<2^Lt(e,2))<<2^Lt(e,3):0}function Qv(e){return e.trim()}function Ji(e,t){return(e=t.exec(e))?e[0]:e}function We(e,t,n){return e.replace(t,n)}function Gd(e,t,n){return e.indexOf(t,n)}function Lt(e,t){return e.charCodeAt(t)|0}function ea(e,t,n){return e.slice(t,n)}function ki(e){return e.length}function Jv(e){return e.length}function Sl(e,t){return t.push(e),e}function S_(e,t){return e.map(t).join("")}function iS(e,t){return e.filter(function(n){return!Ji(n,t)})}var vu=1,ta=1,eA=0,si=0,Pt=0,ga="";function Au(e,t,n,i,s,a,l,d){return{value:e,root:t,parent:n,type:i,props:s,children:a,line:vu,column:ta,length:l,return:"",siblings:d}}function Go(e,t){return Cg(Au("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Es(e){for(;e.root;)e=Go(e.root,{children:[e]});Sl(e,e.siblings)}function v_(){return Pt}function A_(){return Pt=si>0?Lt(ga,--si):0,ta--,Pt===10&&(ta=1,vu--),Pt}function Si(){return Pt=si<eA?Lt(ga,si++):0,ta++,Pt===10&&(ta=1,vu++),Pt}function Br(){return Lt(ga,si)}function $d(){return si}function Iu(e,t){return ea(ga,e,t)}function _g(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function I_(e){return vu=ta=1,eA=ki(ga=e),si=0,[]}function T_(e){return ga="",e}function xh(e){return Qv(Iu(si-1,wg(e===91?e+2:e===40?e+1:e)))}function E_(e){for(;(Pt=Br())&&Pt<33;)Si();return _g(e)>2||_g(Pt)>3?"":" "}function C_(e,t){for(;--t&&Si()&&!(Pt<48||Pt>102||Pt>57&&Pt<65||Pt>70&&Pt<97););return Iu(e,$d()+(t<6&&Br()==32&&Si()==32))}function wg(e){for(;Si();)switch(Pt){case e:return si;case 34:case 39:e!==34&&e!==39&&wg(Pt);break;case 40:e===41&&wg(e);break;case 92:Si();break}return si}function __(e,t){for(;Si()&&e+Pt!==57;)if(e+Pt===84&&Br()===47)break;return"/*"+Iu(t,si-1)+"*"+lp(e===47?e:Si())}function w_(e){for(;!_g(Br());)Si();return Iu(e,si)}function R_(e){return T_(xd("",null,null,null,[""],e=I_(e),0,[0],e))}function xd(e,t,n,i,s,a,l,d,u){for(var f=0,g=0,m=l,S=0,v=0,I=0,A=1,_=1,R=1,P=0,w="",b=s,N=a,D=i,M=w;_;)switch(I=P,P=Si()){case 40:if(I!=108&&Lt(M,m-1)==58){Gd(M+=We(xh(P),"&","&\f"),"&\f",Zv(f?d[f-1]:0))!=-1&&(R=-1);break}case 34:case 39:case 91:M+=xh(P);break;case 9:case 10:case 13:case 32:M+=E_(I);break;case 92:M+=C_($d()-1,7);continue;case 47:switch(Br()){case 42:case 47:Sl(P_(__(Si(),$d()),t,n,u),u);break;default:M+="/"}break;case 123*A:d[f++]=ki(M)*R;case 125*A:case 59:case 0:switch(P){case 0:case 125:_=0;case 59+g:R==-1&&(M=We(M,/\f/g,"")),v>0&&ki(M)-m&&Sl(v>32?rS(M+";",i,n,m-1,u):rS(We(M," ","")+";",i,n,m-2,u),u);break;case 59:M+=";";default:if(Sl(D=oS(M,t,n,f,g,s,d,w,b=[],N=[],m,a),a),P===123)if(g===0)xd(M,t,D,D,b,a,m,d,N);else switch(S===99&&Lt(M,3)===110?100:S){case 100:case 108:case 109:case 115:xd(e,D,D,i&&Sl(oS(e,D,D,0,0,s,d,w,s,b=[],m,N),N),s,N,m,d,i?b:N);break;default:xd(M,D,D,D,[""],N,0,d,N)}}f=g=v=0,A=R=1,w=M="",m=l;break;case 58:m=1+ki(M),v=I;default:if(A<1){if(P==123)--A;else if(P==125&&A++==0&&A_()==125)continue}switch(M+=lp(P),P*A){case 38:R=g>0?1:(M+="\f",-1);break;case 44:d[f++]=(ki(M)-1)*R,R=1;break;case 64:Br()===45&&(M+=xh(Si())),S=Br(),g=m=ki(w=M+=w_($d())),P++;break;case 45:I===45&&ki(M)==2&&(A=0)}}return a}function oS(e,t,n,i,s,a,l,d,u,f,g,m){for(var S=s-1,v=s===0?a:[""],I=Jv(v),A=0,_=0,R=0;A<i;++A)for(var P=0,w=ea(e,S+1,S=Zv(_=l[A])),b=e;P<I;++P)(b=Qv(_>0?v[P]+" "+w:We(w,/&\f/g,v[P])))&&(u[R++]=b);return Au(e,t,n,s===0?Su:d,u,f,g,m)}function P_(e,t,n,i){return Au(e,t,n,Kv,lp(v_()),ea(e,2,-2),0,i)}function rS(e,t,n,i,s){return Au(e,t,n,ap,ea(e,0,i),ea(e,i+1,-1),i,s)}function tA(e,t,n){switch(y_(e,t)){case 5103:return Je+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Je+e+e;case 4789:return Cl+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Je+e+Cl+e+dt+e+e;case 5936:switch(Lt(e,t+11)){case 114:return Je+e+dt+We(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Je+e+dt+We(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Je+e+dt+We(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Je+e+dt+e+e;case 6165:return Je+e+dt+"flex-"+e+e;case 5187:return Je+e+We(e,/(\w+).+(:[^]+)/,Je+"box-$1$2"+dt+"flex-$1$2")+e;case 5443:return Je+e+dt+"flex-item-"+We(e,/flex-|-self/g,"")+(Ji(e,/flex-|baseline/)?"":dt+"grid-row-"+We(e,/flex-|-self/g,""))+e;case 4675:return Je+e+dt+"flex-line-pack"+We(e,/align-content|flex-|-self/g,"")+e;case 5548:return Je+e+dt+We(e,"shrink","negative")+e;case 5292:return Je+e+dt+We(e,"basis","preferred-size")+e;case 6060:return Je+"box-"+We(e,"-grow","")+Je+e+dt+We(e,"grow","positive")+e;case 4554:return Je+We(e,/([^-])(transform)/g,"$1"+Je+"$2")+e;case 6187:return We(We(We(e,/(zoom-|grab)/,Je+"$1"),/(image-set)/,Je+"$1"),e,"")+e;case 5495:case 3959:return We(e,/(image-set\([^]*)/,Je+"$1$`$1");case 4968:return We(We(e,/(.+:)(flex-)?(.*)/,Je+"box-pack:$3"+dt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Je+e+e;case 4200:if(!Ji(e,/flex-|baseline/))return dt+"grid-column-align"+ea(e,t)+e;break;case 2592:case 3360:return dt+We(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(i,s){return t=s,Ji(i.props,/grid-\w+-end/)})?~Gd(e+(n=n[t].value),"span",0)?e:dt+We(e,"-start","")+e+dt+"grid-row-span:"+(~Gd(n,"span",0)?Ji(n,/\d+/):+Ji(n,/\d+/)-+Ji(e,/\d+/))+";":dt+We(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(i){return Ji(i.props,/grid-\w+-start/)})?e:dt+We(We(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return We(e,/(.+)-inline(.+)/,Je+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(ki(e)-1-t>6)switch(Lt(e,t+1)){case 109:if(Lt(e,t+4)!==45)break;case 102:return We(e,/(.+:)(.+)-([^]+)/,"$1"+Je+"$2-$3$1"+Cl+(Lt(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Gd(e,"stretch",0)?tA(We(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return We(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,s,a,l,d,u,f){return dt+s+":"+a+f+(l?dt+s+"-span:"+(d?u:+u-+a)+f:"")+e});case 4949:if(Lt(e,t+6)===121)return We(e,":",":"+Je)+e;break;case 6444:switch(Lt(e,Lt(e,14)===45?18:11)){case 120:return We(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Je+(Lt(e,14)===45?"inline-":"")+"box$3$1"+Je+"$2$3$1"+dt+"$2box$3")+e;case 100:return We(e,":",":"+dt)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return We(e,"scroll-","scroll-snap-")+e}return e}function Qd(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function D_(e,t,n,i){switch(e.type){case m_:if(e.children.length)break;case p_:case ap:return e.return=e.return||e.value;case Kv:return"";case qv:return e.return=e.value+"{"+Qd(e.children,i)+"}";case Su:if(!ki(e.value=e.props.join(",")))return""}return ki(n=Qd(e.children,i))?e.return=e.value+"{"+n+"}":""}function N_(e){var t=Jv(e);return function(n,i,s,a){for(var l="",d=0;d<t;d++)l+=e[d](n,i,s,a)||"";return l}}function M_(e){return function(t){t.root||(t=t.return)&&e(t)}}function O_(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case ap:e.return=tA(e.value,e.length,n);return;case qv:return Qd([Go(e,{value:We(e.value,"@","@"+Je)})],i);case Su:if(e.length)return S_(n=e.props,function(s){switch(Ji(s,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Es(Go(e,{props:[We(s,/:(read-\w+)/,":"+Cl+"$1")]})),Es(Go(e,{props:[s]})),Cg(e,{props:iS(n,i)});break;case"::placeholder":Es(Go(e,{props:[We(s,/:(plac\w+)/,":"+Je+"input-$1")]})),Es(Go(e,{props:[We(s,/:(plac\w+)/,":"+Cl+"$1")]})),Es(Go(e,{props:[We(s,/:(plac\w+)/,dt+"input-$1")]})),Es(Go(e,{props:[s]})),Cg(e,{props:iS(n,i)});break}return""})}}var b_={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Gn={},na=typeof process<"u"&&Gn!==void 0&&(Gn.REACT_APP_SC_ATTR||Gn.SC_ATTR)||"data-styled",nA="active",iA="data-styled-version",Tu="6.1.13",cp=`/*!sc*/
`,Jd=typeof window<"u"&&"HTMLElement"in window,k_=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Gn!==void 0&&Gn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Gn.REACT_APP_SC_DISABLE_SPEEDY!==""?Gn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Gn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Gn!==void 0&&Gn.SC_DISABLE_SPEEDY!==void 0&&Gn.SC_DISABLE_SPEEDY!==""&&Gn.SC_DISABLE_SPEEDY!=="false"&&Gn.SC_DISABLE_SPEEDY),B_={},Eu=Object.freeze([]),ia=Object.freeze({});function oA(e,t,n){return n===void 0&&(n=ia),e.theme!==n.theme&&e.theme||t||n.theme}var rA=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),F_=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,L_=/(^-|-$)/g;function sS(e){return e.replace(F_,"-").replace(L_,"")}var U_=/(a)(d)/gi,md=52,aS=function(e){return String.fromCharCode(e+(e>25?39:97))};function Rg(e){var t,n="";for(t=Math.abs(e);t>md;t=t/md|0)n=aS(t%md)+n;return(aS(t%md)+n).replace(U_,"$1-$2")}var Wh,sA=5381,Ls=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},aA=function(e){return Ls(sA,e)};function lA(e){return Rg(aA(e)>>>0)}function H_(e){return e.displayName||e.name||"Component"}function Yh(e){return typeof e=="string"&&!0}var cA=typeof Symbol=="function"&&Symbol.for,dA=cA?Symbol.for("react.memo"):60115,G_=cA?Symbol.for("react.forward_ref"):60112,$_={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},x_={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},uA={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},W_=((Wh={})[G_]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Wh[dA]=uA,Wh);function lS(e){return("type"in(t=e)&&t.type.$$typeof)===dA?uA:"$$typeof"in e?W_[e.$$typeof]:$_;var t}var Y_=Object.defineProperty,z_=Object.getOwnPropertyNames,cS=Object.getOwnPropertySymbols,j_=Object.getOwnPropertyDescriptor,X_=Object.getPrototypeOf,dS=Object.prototype;function fA(e,t,n){if(typeof t!="string"){if(dS){var i=X_(t);i&&i!==dS&&fA(e,i,n)}var s=z_(t);cS&&(s=s.concat(cS(t)));for(var a=lS(e),l=lS(t),d=0;d<s.length;++d){var u=s[d];if(!(u in x_||n&&n[u]||l&&u in l||a&&u in a)){var f=j_(t,u);try{Y_(e,u,f)}catch{}}}}return e}function oa(e){return typeof e=="function"}function dp(e){return typeof e=="object"&&"styledComponentId"in e}function br(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function Pg(e,t){if(e.length===0)return"";for(var n=e[0],i=1;i<e.length;i++)n+=e[i];return n}function Ul(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function Dg(e,t,n){if(n===void 0&&(n=!1),!n&&!Ul(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)e[i]=Dg(e[i],t[i]);else if(Ul(t))for(var i in t)e[i]=Dg(e[i],t[i]);return e}function up(e,t){Object.defineProperty(e,"toString",{value:t})}function Zl(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var V_=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,i=0;i<t;i++)n+=this.groupSizes[i];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var i=this.groupSizes,s=i.length,a=s;t>=a;)if((a<<=1)<0)throw Zl(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(i),this.length=a;for(var l=s;l<a;l++)this.groupSizes[l]=0}for(var d=this.indexOfGroup(t+1),u=(l=0,n.length);l<u;l++)this.tag.insertRule(d,n[l])&&(this.groupSizes[t]++,d++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],i=this.indexOfGroup(t),s=i+n;this.groupSizes[t]=0;for(var a=i;a<s;a++)this.tag.deleteRule(i)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var i=this.groupSizes[t],s=this.indexOfGroup(t),a=s+i,l=s;l<a;l++)n+="".concat(this.tag.getRule(l)).concat(cp);return n},e}(),Wd=new Map,eu=new Map,Yd=1,yd=function(e){if(Wd.has(e))return Wd.get(e);for(;eu.has(Yd);)Yd++;var t=Yd++;return Wd.set(e,t),eu.set(t,e),t},K_=function(e,t){Yd=t+1,Wd.set(e,t),eu.set(t,e)},q_="style[".concat(na,"][").concat(iA,'="').concat(Tu,'"]'),Z_=new RegExp("^".concat(na,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Q_=function(e,t,n){for(var i,s=n.split(","),a=0,l=s.length;a<l;a++)(i=s[a])&&e.registerName(t,i)},J_=function(e,t){for(var n,i=((n=t.textContent)!==null&&n!==void 0?n:"").split(cp),s=[],a=0,l=i.length;a<l;a++){var d=i[a].trim();if(d){var u=d.match(Z_);if(u){var f=0|parseInt(u[1],10),g=u[2];f!==0&&(K_(g,f),Q_(e,g,u[3]),e.getTag().insertRules(f,s)),s.length=0}else s.push(d)}}},uS=function(e){for(var t=document.querySelectorAll(q_),n=0,i=t.length;n<i;n++){var s=t[n];s&&s.getAttribute(na)!==nA&&(J_(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function ew(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var hA=function(e){var t=document.head,n=e||t,i=document.createElement("style"),s=function(d){var u=Array.from(d.querySelectorAll("style[".concat(na,"]")));return u[u.length-1]}(n),a=s!==void 0?s.nextSibling:null;i.setAttribute(na,nA),i.setAttribute(iA,Tu);var l=ew();return l&&i.setAttribute("nonce",l),n.insertBefore(i,a),i},tw=function(){function e(t){this.element=hA(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,s=0,a=i.length;s<a;s++){var l=i[s];if(l.ownerNode===n)return l}throw Zl(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),nw=function(){function e(t){this.element=hA(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),iw=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),fS=Jd,ow={isServer:!Jd,useCSSOMInjection:!k_},tu=function(){function e(t,n,i){t===void 0&&(t=ia),n===void 0&&(n={});var s=this;this.options=rn(rn({},ow),t),this.gs=n,this.names=new Map(i),this.server=!!t.isServer,!this.server&&Jd&&fS&&(fS=!1,uS(this)),up(this,function(){return function(a){for(var l=a.getTag(),d=l.length,u="",f=function(m){var S=function(R){return eu.get(R)}(m);if(S===void 0)return"continue";var v=a.names.get(S),I=l.getGroup(m);if(v===void 0||!v.size||I.length===0)return"continue";var A="".concat(na,".g").concat(m,'[id="').concat(S,'"]'),_="";v!==void 0&&v.forEach(function(R){R.length>0&&(_+="".concat(R,","))}),u+="".concat(I).concat(A,'{content:"').concat(_,'"}').concat(cp)},g=0;g<d;g++)f(g);return u}(s)})}return e.registerId=function(t){return yd(t)},e.prototype.rehydrate=function(){!this.server&&Jd&&uS(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(rn(rn({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var i=n.useCSSOMInjection,s=n.target;return n.isServer?new iw(s):i?new tw(s):new nw(s)}(this.options),new V_(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(yd(t),this.names.has(t))this.names.get(t).add(n);else{var i=new Set;i.add(n),this.names.set(t,i)}},e.prototype.insertRules=function(t,n,i){this.registerName(t,n),this.getTag().insertRules(yd(t),i)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(yd(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),rw=/&/g,sw=/^\s*\/\/.*$/gm;function gA(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(i){return"".concat(t," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=gA(n.children,t)),n})}function aw(e){var t,n,i,s=ia,a=s.options,l=a===void 0?ia:a,d=s.plugins,u=d===void 0?Eu:d,f=function(S,v,I){return I.startsWith(n)&&I.endsWith(n)&&I.replaceAll(n,"").length>0?".".concat(t):S},g=u.slice();g.push(function(S){S.type===Su&&S.value.includes("&")&&(S.props[0]=S.props[0].replace(rw,n).replace(i,f))}),l.prefix&&g.push(O_),g.push(D_);var m=function(S,v,I,A){v===void 0&&(v=""),I===void 0&&(I=""),A===void 0&&(A="&"),t=A,n=v,i=new RegExp("\\".concat(n,"\\b"),"g");var _=S.replace(sw,""),R=R_(I||v?"".concat(I," ").concat(v," { ").concat(_," }"):_);l.namespace&&(R=gA(R,l.namespace));var P=[];return Qd(R,N_(g.concat(M_(function(w){return P.push(w)})))),P};return m.hash=u.length?u.reduce(function(S,v){return v.name||Zl(15),Ls(S,v.name)},sA).toString():"",m}var lw=new tu,Ng=aw(),pA=Bi.createContext({shouldForwardProp:void 0,styleSheet:lw,stylis:Ng});pA.Consumer;Bi.createContext(void 0);function Mg(){return Fe.useContext(pA)}var cw=function(){function e(t,n){var i=this;this.inject=function(s,a){a===void 0&&(a=Ng);var l=i.name+a.hash;s.hasNameForId(i.id,l)||s.insertRules(i.id,l,a(i.rules,l,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,up(this,function(){throw Zl(12,String(i.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Ng),this.name+t.hash},e}(),dw=function(e){return e>="A"&&e<="Z"};function hS(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(n===1&&i==="-"&&e[0]==="-")return e;dw(i)?t+="-"+i.toLowerCase():t+=i}return t.startsWith("ms-")?"-"+t:t}var mA=function(e){return e==null||e===!1||e===""},yA=function(e){var t,n,i=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!mA(a)&&(Array.isArray(a)&&a.isCss||oa(a)?i.push("".concat(hS(s),":"),a,";"):Ul(a)?i.push.apply(i,Ll(Ll(["".concat(s," {")],yA(a),!1),["}"],!1)):i.push("".concat(hS(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in b_||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function Ko(e,t,n,i){if(mA(e))return[];if(dp(e))return[".".concat(e.styledComponentId)];if(oa(e)){if(!oa(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return Ko(s,t,n,i)}var a;return e instanceof cw?n?(e.inject(n,i),[e.getName(i)]):[e]:Ul(e)?yA(e):Array.isArray(e)?Array.prototype.concat.apply(Eu,e.map(function(l){return Ko(l,t,n,i)})):[e.toString()]}function SA(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(oa(n)&&!dp(n))return!1}return!0}var uw=aA(Tu),fw=function(){function e(t,n,i){this.rules=t,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&SA(t),this.componentId=n,this.baseHash=Ls(uw,n),this.baseStyle=i,tu.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,i){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=br(s,this.staticRulesId);else{var a=Pg(Ko(this.rules,t,n,i)),l=Rg(Ls(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,l)){var d=i(a,".".concat(l),void 0,this.componentId);n.insertRules(this.componentId,l,d)}s=br(s,l),this.staticRulesId=l}else{for(var u=Ls(this.baseHash,i.hash),f="",g=0;g<this.rules.length;g++){var m=this.rules[g];if(typeof m=="string")f+=m;else if(m){var S=Pg(Ko(m,t,n,i));u=Ls(u,S+g),f+=S}}if(f){var v=Rg(u>>>0);n.hasNameForId(this.componentId,v)||n.insertRules(this.componentId,v,i(f,".".concat(v),void 0,this.componentId)),s=br(s,v)}}return s},e}(),fp=Bi.createContext(void 0);fp.Consumer;var zh={};function hw(e,t,n){var i=dp(e),s=e,a=!Yh(e),l=t.attrs,d=l===void 0?Eu:l,u=t.componentId,f=u===void 0?function(b,N){var D=typeof b!="string"?"sc":sS(b);zh[D]=(zh[D]||0)+1;var M="".concat(D,"-").concat(lA(Tu+D+zh[D]));return N?"".concat(N,"-").concat(M):M}(t.displayName,t.parentComponentId):u,g=t.displayName,m=g===void 0?function(b){return Yh(b)?"styled.".concat(b):"Styled(".concat(H_(b),")")}(e):g,S=t.displayName&&t.componentId?"".concat(sS(t.displayName),"-").concat(t.componentId):t.componentId||f,v=i&&s.attrs?s.attrs.concat(d).filter(Boolean):d,I=t.shouldForwardProp;if(i&&s.shouldForwardProp){var A=s.shouldForwardProp;if(t.shouldForwardProp){var _=t.shouldForwardProp;I=function(b,N){return A(b,N)&&_(b,N)}}else I=A}var R=new fw(n,S,i?s.componentStyle:void 0);function P(b,N){return function(D,M,k){var U=D.attrs,j=D.componentStyle,K=D.defaultProps,X=D.foldedComponentIds,J=D.styledComponentId,Z=D.target,le=Bi.useContext(fp),re=Mg(),te=D.shouldForwardProp||re.shouldForwardProp,Y=oA(M,le,K)||ia,V=function(Pe,ye,Oe){for(var Ne,he=rn(rn({},ye),{className:void 0,theme:Oe}),ve=0;ve<Pe.length;ve+=1){var xe=oa(Ne=Pe[ve])?Ne(he):Ne;for(var Te in xe)he[Te]=Te==="className"?br(he[Te],xe[Te]):Te==="style"?rn(rn({},he[Te]),xe[Te]):xe[Te]}return ye.className&&(he.className=br(he.className,ye.className)),he}(U,M,Y),q=V.as||Z,F={};for(var z in V)V[z]===void 0||z[0]==="$"||z==="as"||z==="theme"&&V.theme===Y||(z==="forwardedAs"?F.as=V.forwardedAs:te&&!te(z,q)||(F[z]=V[z]));var ue=function(Pe,ye){var Oe=Mg(),Ne=Pe.generateAndInjectStyles(ye,Oe.styleSheet,Oe.stylis);return Ne}(j,V),pe=br(X,J);return ue&&(pe+=" "+ue),V.className&&(pe+=" "+V.className),F[Yh(q)&&!rA.has(q)?"class":"className"]=pe,F.ref=k,Fe.createElement(q,F)}(w,b,N)}P.displayName=m;var w=Bi.forwardRef(P);return w.attrs=v,w.componentStyle=R,w.displayName=m,w.shouldForwardProp=I,w.foldedComponentIds=i?br(s.foldedComponentIds,s.styledComponentId):"",w.styledComponentId=S,w.target=i?s.target:e,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(b){this._foldedDefaultProps=i?function(N){for(var D=[],M=1;M<arguments.length;M++)D[M-1]=arguments[M];for(var k=0,U=D;k<U.length;k++)Dg(N,U[k],!0);return N}({},s.defaultProps,b):b}}),up(w,function(){return".".concat(w.styledComponentId)}),a&&fA(w,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function gS(e,t){for(var n=[e[0]],i=0,s=t.length;i<s;i+=1)n.push(t[i],e[i+1]);return n}var pS=function(e){return Object.assign(e,{isCss:!0})};function vA(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(oa(e)||Ul(e))return pS(Ko(gS(Eu,Ll([e],t,!0))));var i=e;return t.length===0&&i.length===1&&typeof i[0]=="string"?Ko(i):pS(Ko(gS(i,t)))}function Og(e,t,n){if(n===void 0&&(n=ia),!t)throw Zl(1,t);var i=function(s){for(var a=[],l=1;l<arguments.length;l++)a[l-1]=arguments[l];return e(t,n,vA.apply(void 0,Ll([s],a,!1)))};return i.attrs=function(s){return Og(e,t,rn(rn({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},i.withConfig=function(s){return Og(e,t,rn(rn({},n),s))},i}var AA=function(e){return Og(hw,e)},Ot=AA;rA.forEach(function(e){Ot[e]=AA(e)});var gw=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=SA(t),tu.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,i,s){var a=s(Pg(Ko(this.rules,n,i,s)),""),l=this.componentId+t;i.insertRules(l,l,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,i,s){t>2&&tu.registerId(this.componentId+t),this.removeStyles(t,i),this.createStyles(t,n,i,s)},e}();function pw(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=vA.apply(void 0,Ll([e],t,!1)),s="sc-global-".concat(lA(JSON.stringify(i))),a=new gw(i,s),l=function(u){var f=Mg(),g=Bi.useContext(fp),m=Bi.useRef(f.styleSheet.allocateGSInstance(s)).current;return f.styleSheet.server&&d(m,u,f.styleSheet,g,f.stylis),Bi.useLayoutEffect(function(){if(!f.styleSheet.server)return d(m,u,f.styleSheet,g,f.stylis),function(){return a.removeStyles(m,f.styleSheet)}},[m,u,f.styleSheet,g,f.stylis]),null};function d(u,f,g,m,S){if(a.isStatic)a.renderStyles(u,B_,g,S);else{var v=rn(rn({},f),{theme:oA(f,m,l.defaultProps)});a.renderStyles(u,v,g,S)}}return Bi.memo(l)}function IA(e,t){var n=Fe.useRef(null),i=Fe.useRef(!1),s=Fe.useRef(e);s.current=e;var a=Fe.useCallback(function(d){i.current&&(s.current(d),n.current=requestAnimationFrame(a))},[]),l=Fe.useMemo(function(){return[function(){i.current&&(i.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){i.current||(i.current=!0,n.current=requestAnimationFrame(a))},function(){return i.current}]},[]);return Fe.useEffect(function(){return l[0]},[]),l}function mw(e,t,n,i,s){var l;(l=e.onExit)==null||l.call(e,i,t);const a=s.find(({id:d})=>d===t);return a!=null&&a.onEnter?a.onEnter(i,n):{...n,enteredAt:i.updateContext.gameState.time}}function yw(e,t){return t.find(({id:n})=>n===e)}function Sw(e,t){return e!==t}function vw(e){e&&console.warn(`No handler found for state: ${e}`)}const _l="bushGrowing",Mr="bushFull",zd="bushSpreading",Hl="bushDying",Ct=24,Dt=10,Ze=4e3,Qe=4e3,hp=2,Aw=15,Iw=5e3,ro=100,so=20,ao=60,TA=200,Tw=1e3,Ew=5,Cw=3,_w=12,ww=940,bg=20,mS=90,EA=100,fo=5,Rw=.5,Qo=30,lo=.1,vl=.9,Pw=2,Dw=2;var In=(e=>(e.Berry="berry",e.Meat="meat",e))(In||{});const gp={berry:"",meat:""};function CA(e,t){return`${e},${t}`}function _A(e){const[t,n]=e.split(",").map(Number);return{gridX:t,gridY:n}}function Nw(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function wA(){return{lastUpdateTime:0,sectors:{}}}const Xt=20,nu=100,RA=20,PA=0,Mw=20,Ow=1,DA=.15,bw=.5,kw=.01,Bw=24,Fw="#6B5344",Lw="#4A3728",yS=.85,NA=35,Uw=30,SS=1.25,vS=40,jh=Math.PI/6,MA=.5,Hw=1,Cu=10,Gl=80,OA=3,rl=5,sn=150,pp=sn*.8,Gw=sn*.2,an=sn*.8,Jo=30,bA=10,$w=10,xw=.5,ze=30,Yr=ze*.75,_u=30,Ql=_u*.75,kA=50,Ww=20,Yw=Gl*.8,zw=.7,$l=16,wu=40,jw=24,mp=16,Xw=72/3,AS=24,Vw=1.25,Kw=1.5,ra=sn*.6,Ru=50,qw=1,Zw=350,yp=Gl*.65,Qw=80,Jw=50,eR=1,tR=128,BA=10,IS=100,Sp=35,ho=30,Pu=.5,Du=2.5,vp=20,Sn=250,Ap=.4,Ip=150,Tp=6,nR=5,Ep=2,Nu=.5,Mu=1.5,iR=1,oR=.5,rR=.5,sR=1.5,aR=.25,lR=2.5,cR=45,dR=.05,uR=200;var Ut=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(Ut||{}),je=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e[e.SupplyChain=5]="SupplyChain",e))(je||{}),zr=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(zr||{});const iu=24,fR=24;let hR=0;function gR(){return`notification-${Date.now()}-${hR++}`}function xl(e,t){if(t.identifier){const i=e.notifications.find(s=>s.identifier===t.identifier);if(i){if(i.dismissedUntil&&e.time<i.dismissedUntil)return;i.message=t.message,i.timestamp=e.time,i.creationTime=Date.now(),i.duration=t.duration,i.targetEntityIds=t.targetEntityIds,i.highlightedEntityIds=t.highlightedEntityIds,i.targetPosition=t.targetPosition,i.targetArea=t.targetArea,i.targetRadius=t.targetRadius,i.isDismissed=!1,i.dismissedUntil=void 0;return}}const n={...t,id:gR(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function pR(e,t){const n=e.notifications.find(i=>i.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+fR))}function mR(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function yR(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const i of n.highlightedEntityIds){const s=e.entities.entities[i];s&&(s.isHighlighted=!0)}}function Cp(e,t,n,i){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,l={x:Math.cos(s)*a,y:Math.sin(s)*a},d=oi(e,l);return{x:(d.x%n+n)%n,y:(d.y%i+i)%i}}function zn(e,t,n,i){const s=t,{width:a,height:l}=t.mapDimensions,d={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},u=f=>{for(let g=0;g<f.length;g++){const m=f[g];if(i!==void 0&&m.id===i)continue;const S=Nn(e,m.position,a,l),v=n+m.radius;if(S<v*v)return!0}return!1};return u(s.search.human.byRect(d))||u(s.search.berryBush.byRect(d))||u(s.search.corpse.byRect(d))}function SR(e,t,n,i,s){const a=t.mapDimensions.width,l=t.mapDimensions.height;if(!zn(e,t,i,s)&&!Ui(t.soilDepletion,e,a,l))return e;const d=i;for(let u=d;u<=n;u+=d){const f=Math.ceil(2*Math.PI*u/d);for(let g=0;g<f;g++){const m=g/f*2*Math.PI,S={x:Math.cos(m)*u,y:Math.sin(m)*u},v=oi(e,S),I={x:(v.x%a+a)%a,y:(v.y%l+l)%l};if(!zn(I,t,i,s)&&!Ui(t.soilDepletion,I,a,l))return I}}return null}function vn(e,t){var l,d;const n=t;if((d=(l=n.cache)==null?void 0:l.tribeCenters)!=null&&d[e])return n.cache.tribeCenters[e];const i=t.search.building.byProperty("ownerId",e);if(i.length>0){const u=i.map(f=>f.position);return n.cache.tribeCenters[e]=Zd(u)}const s=Li(e,t);if(s.length===0){const u=t.entities.entities[e];return n.cache.tribeCenters[e]=u?u.position:{x:0,y:0}}const a=s.map(u=>u.position);return n.cache.tribeCenters[e]=Zd(a)}function TS(e,t){const i=[...Yl(e,t),e].map(s=>s.position);return Zd(i)}function kg(e,t,n){const i=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,l=e.y-t.position.y;return Math.abs(a)>i/2&&(a-=Math.sign(a)*i),Math.abs(l)>s/2&&(l-=Math.sign(l)*s),Math.abs(a)<=t.width/2&&Math.abs(l)<=t.height/2}const sa=80,xn=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],Re=20,Gi=(e,t,n)=>{var d,u,f,g;if(!e||!t||e===t)return!1;const i=n.entities.entities[e],s=n.entities.entities[t],a=(u=(d=i==null?void 0:i.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[t],l=(g=(f=s==null?void 0:s.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[e];return a===Ut.Hostile||l===Ut.Hostile},qr=(e,t,n)=>e.id===t.id?!1:Gi(e.leaderId,t.leaderId,n),Vt=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:Gi(e.leaderId,t.ownerId,n),or=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=an||t.hunger>=an||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||qr(e,t,n))return!1;const i=e.gender==="female"?e:t;return!(i.isPregnant||i.age>wu)},aa=1,la=150*.6,ES=150*.25,vR=150*.7,AR=150*.8,IR=400,FA=800,TR=150,ER=300,CR=2,CS=800,_R=500,wR=150*.85,RR=150,LA=3,PR=24,UA=600,DR=1,NR=1,MR=.5,OR=1,bR=.5,kR=2,Os=24,Us=12,BR=24,FR=1.5,LR=150,UR=200,HR=100,GR=.7,$R=300,xR=400,Xh=600,WR=600,ou=.15,Bg=200,Vs=30*.75*1.2,HA=20,GA=.3,$A=.6,xA=.8,YR=1,zR=3,jR=5,XR=6,_S=.5,VR=.4,KR=.6,qR=.8,ZR=2,eo=800,wS=2,Fg=.7,Lg=.5,Hs=10,QR=.5,Ks=400,WA=800,JR=8,e1=16,YA=5,zA=600,to=100,t1=100,jA=150,RS=600,PS=250,n1=.5,i1=.7,o1=300,r1=150;function XA(e){const t=Math.floor(e.x/Re),n=Math.floor(e.y/Re);return{x:t,y:n}}function Ug(e,t){const n=Math.ceil(t/Re),i=e%n*Re+Re/2,s=Math.floor(e/n)*Re+Re/2;return{x:i,y:s}}function s1(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(i/Re),l=Math.floor(s/Re),d=Math.ceil(t/Re);return l*d+a}function ri(e,t,n){const i=s1({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[i]||null}function _p(e,t){return t.terrainOwnership.includes(e)}function VA(e,t,n,i){var l;const s=n;return(l=s.search)!=null&&l.human?s.search.human.byRadius(e,i).some(d=>Gi(t,d.leaderId,n)):!1}function a1(e,t,n,i,s=!1,a){if(s&&a&&VA(e,a,i,jA))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:l,height:d}=i.mapDimensions,u=Math.ceil(l/Re),f=Math.ceil(d/Re),g=Math.ceil(t/Re),m=t*t,S=Math.floor(e.x/Re),v=Math.floor(e.y/Re);let I=!1,A=!1;for(let _=-g;_<=g;_++)for(let R=-g;R<=g;R++){const P=((S+R)%u+u)%u,w=((v+_)%f+f)%f,b=P*Re+Re/2,N=w*Re+Re/2;if(Nn(e,{x:b,y:N},l,d)<=m){const M=w*u+P,k=i.terrainOwnership[M];if(k===n)I=!0;else if(k!==null){if(s&&a&&Gi(a,k,i))continue;A=!0}}}return A?{valid:!1,reason:"Position overlaps with another tribe's territory"}:I?{valid:!0}:_p(n,i)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function KA(e,t,n,i){if(!_p(n,i))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(VA(e,n,i,jA))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=i.mapDimensions,l=Math.ceil(s/Re),d=Math.ceil(a/Re),u=Math.ceil(t/Re),f=t*t,g=Math.floor(e.x/Re),m=Math.floor(e.y/Re);let S=!1;for(let v=-u;v<=u;v++){for(let I=-u;I<=u;I++){const A=((g+I)%l+l)%l,_=((m+v)%d+d)%d,R=A*Re+Re/2,P=_*Re+Re/2;if(Nn(e,{x:R,y:P},s,a)<=f){const b=_*l+A;if(i.terrainOwnership[b]===n){S=!0;break}}}if(S)break}return S?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function qA(e,t,n,i=0,s=!1,a){if(i>0){const d=a1(e,i,t,n,s,a);return d.valid?{canPlace:!0}:{canPlace:!1,reason:d.reason}}const l=ri(e.x,e.y,n);return l===null||l===t?{canPlace:!0}:s&&a&&Gi(a,l,n)?{canPlace:!0}:l!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function Hg(e,t,n){const i=ri(e.x,e.y,n);return i===null||i===t}function Wn(e,t,n){const i=ri(e.x,e.y,n);return i===null||i===t||!Gi(t,i,n)}function l1(e,t,n,i){if(Hg(t,n,i))return t;const{width:s,height:a}=i.mapDimensions,l=Xe(e,t,s,a),d=Math.sqrt(l.x**2+l.y**2);if(d===0)return e;let u=e;const f=H(e,t,s,a),g=f/10;for(let m=g;m<=f;m+=g){const S={x:((e.x+l.x*m/d)%s+s)%s,y:((e.y+l.y*m/d)%a+a)%a};if(Hg(S,n,i))u=S;else break}return u}function ZA(e,t,n,i,{allowOverwrite:s}){const{width:a,height:l}=i.mapDimensions,d=Math.ceil(a/Re),u=Math.ceil(l/Re),f=Math.ceil(t/Re),g=Math.floor(e.x/Re),m=Math.floor(e.y/Re);for(let P=-f;P<=f;P++)for(let w=-f;w<=f;w++){const b=((g+w)%d+d)%d,N=((m+P)%u+u)%u,D=b*Re+Re/2,M=N*Re+Re/2;if(H(e,{x:D,y:M},a,l)<=t){const U=N*d+b,j=i.terrainOwnership[U];(s||j===null||j===n)&&(i.terrainOwnership[U]=n)}}const S=3,v=f+S+2,I=[];for(let P=-v;P<=v;P++)for(let w=-v;w<=v;w++){const b=((g+w)%d+d)%d,N=((m+P)%u+u)%u,D=N*d+b;if(i.terrainOwnership[D]===null){let M=!1;const k=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const U of k){let j=!1,K=!1;for(let X=1;X<=S;X++){const J=((b+U.x*X)%d+d)%d,le=((N+U.y*X)%u+u)%u*d+J;if(i.terrainOwnership[le]===n){j=!0;break}}if(j)for(let X=1;X<=S;X++){const J=((b-U.x*X)%d+d)%d,le=((N-U.y*X)%u+u)%u*d+J;if(i.terrainOwnership[le]===n){K=!0;break}}if(j&&K){M=!0;break}}M&&I.push(D)}}for(const P of I)i.terrainOwnership[P]=n;const A=250,_=new Set;for(let P=-v;P<=v;P++)for(let w=-v;w<=v;w++){const b=((g+w)%d+d)%d,D=((m+P)%u+u)%u*d+b;if(i.terrainOwnership[D]===null&&!_.has(D)){const M=[],k=[D];_.add(D),M.push(D);let U=!0,j=0;for(;j<k.length;){const K=k[j++];if(M.length>A){U=!1;break}const X=K%d,J=Math.floor(K/d),Z=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:le,ny:re}of Z){const te=((X+le)%d+d)%d,V=((J+re)%u+u)%u*d+te;i.terrainOwnership[V]===null&&!_.has(V)&&(_.add(V),U&&(M.push(V),k.push(V)))}}if(U&&M.length<=A)for(const K of M)i.terrainOwnership[K]=n}}const R=[];for(let P=-v;P<=v;P++)for(let w=-v;w<=v;w++){const b=((g+w)%d+d)%d,N=((m+P)%u+u)%u,D=N*d+b;if(i.terrainOwnership[D]===null){let M=0;for(let k=-1;k<=1;k++)for(let U=-1;U<=1;U++){if(U===0&&k===0)continue;const j=((b+U)%d+d)%d,X=((N+k)%u+u)%u*d+j;i.terrainOwnership[X]===n&&M++}M>=5&&R.push(D)}}for(const P of R)i.terrainOwnership[P]=n}function QA(e,t,n,i){ZA(e,t,n,i,{allowOverwrite:!1})}function JA(e,t,n,i){ZA(e,t,n,i,{allowOverwrite:!0})}function c1(e,t,n){const{width:i,height:s}=n.mapDimensions,a=Math.ceil(i/Re),l=Math.ceil(s/Re),d=Math.floor(e.x/Re),u=Math.floor(e.y/Re),f=50;for(let g=0;g<=f;g++){const m=-g,S=g,v=-g,I=g;for(let A=v;A<=I;A++)for(let _=m;_<=S;_++){if(g>0&&_>m&&_<S&&A>v&&A<I)continue;const R=((d+_)%a+a)%a,P=((u+A)%l+l)%l,w=P*a+R;if(n.terrainOwnership[w]===t){let b=!1;const N=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:D,ny:M}of N){const k=((R+D)%a+a)%a,j=((P+M)%l+l)%l*a+k;if(n.terrainOwnership[j]!==t){b=!0;break}}if(b)return{x:R*Re+Re/2,y:P*Re+Re/2}}}}return null}function ru(e,t,n){const i=e.terrainOwnership;for(let s=0;s<i.length;s++)i[s]===t&&(i[s]=n)}function Be(e,t,n,i,s){const a=t,l=i,d="position"in e&&e.id?e:null,u=d?d.position:e,f=a.search[n].byRadius(u,l);let g=null,m=l;for(const S of f){if(S.id===(d==null?void 0:d.id)||s&&!s(S))continue;const v=H(u,S.position,t.mapDimensions.width,t.mapDimensions.height);v<m&&(m=v,g=S)}return g}function d1(e,t,n,i){return t.search[n].byRadius(e,i)}function DS(e,t,n,i){return d1(e,t,n,i).length}function vt(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function eI(e,t){var l;const i=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const d of i){if(d.attackTargetId!==e)continue;const u=H(d.position,((l=t.entities.entities[e])==null?void 0:l.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<a&&(s=d,a=u)}return s}function tI(e){return e.search.human.all()}function u1(e,t,n){const{width:i,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const l of a){const d=H(e,l.position,i,s),u=l.type==="tree"?l.radius*2:l.radius;if(d<u)return l}}function f1(e,t,n,i,s){const{width:a,height:l}=i.mapDimensions,d=n*n;if(s){for(let S=0;S<s.length;S++)if(Nn(e,s[S],a,l)<d)return!0;return!1}const u=tI(i),f=new Set;for(let S=0;S<u.length;S++){const v=u[S];v.leaderId&&v.leaderId!==t&&f.add(v.leaderId)}const g=f.values();let m=g.next();for(;!m.done;){const S=m.value,v=vn(S,i);if(Nn(e,v,a,l)<d)return!0;m=g.next()}return!1}var Ce=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(Ce||{});function Ge(e,t,n,i,s,a,l){const d={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:i,entityId:s,targetPosition:a,targetEntityId:l};return e.visualEffects.push(d),e.nextVisualEffectId++,d.id}const Ke=1,Wl=3,io=100,nI=20,co=10,h1=.5,Fr=150,g1=25,p1=.5,Lr=100,iI=25,wp=.5,oI=15,su=4,m1=.75,y1=15,Gg=8,rI=20,S1=.5;function ca(e,t,n,i,s,a){if(n===void 0)return!1;const{width:l,height:d}=i.mapDimensions;if(s&&a!==void 0&&Nn(s,e,l,d)>a*a)return!1;const u=op(t),f=Math.sqrt(u.width*u.width+u.height*u.height)/2;if(zn(e,i,f*.8))return!1;if(t===ce.PlantingZone){const{depletedSectors:A}=bI(i.soilDepletion,e,u.width,u.height,l,d);if(A.length>0)return!1}const m=i.search.building.byRadius(e,f*2);for(const A of m){const _=Nn(e,A.position,l,d),R=(Math.max(u.width,u.height)+Math.max(A.width,A.height))/2;if(_<R*R*.81)return!1}const S=t===ce.BorderPost;return!!qA(e,n,i,S?ip:sa,S,n).canPlace}function v1(e){const t=[],n=2*Math.PI/e;for(let i=0;i<e;i++){const s=i*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function qs(e,t,n,i,s,a,l){const d=performance.now(),u=n,f=op(e),g=n.mapDimensions.width,m=n.mapDimensions.height,S=u.search.building.byProperty("ownerId",t),v=[];if(S.length>0){a&&v.unshift(a);const P=vn(t,n),w=[...S].sort((b,N)=>{const D=Nn(b.position,P,g,m),M=Nn(N.position,P,g,m);return D-M});v.push(...w.map(b=>b.position))}else v.push(vn(t,n));const I=Math.min(v.length,JR),A=Math.max(f.width,f.height),_=A+20,R=A/2;for(let P=0;P<I;P++){const w=v[P];for(let b=_;b<=i;b+=R){const N=Math.max(8,Math.min(e1,Math.ceil(2*Math.PI*b/A))),D=v1(N);for(let M=0;M<N;M++){const k=D[M].cos*b,U=D[M].sin*b,j=w.x+k,K=w.y+U,X=(j%g+g)%g,J=(K%m+m)%m;if(!f1({x:X,y:J},t,s,n,l)&&ca({x:X,y:J},e,t,n))return performance.now()-d,{x:X,y:J}}}}performance.now()-d}function qo(e,t,n,i){if(t===ce.BorderPost)return JA(e,ip,n,i),Ge(i,Ce.BorderClaim,e,Ke,n),null;const s=zb(i.entities,e,t,n);return t===ce.Bonfire&&(s.storageCapacity=su,s.storedItems=[]),QA(e,sa,n,i),t===ce.PlantingZone&&Fl(i),s}function $g(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===ce.PlantingZone&&Fl(t))}function A1(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let l=e.x-a.position.x,d=e.y-a.position.y;const u=t.mapDimensions.width,f=t.mapDimensions.height;if(Math.abs(l)>u/2&&(l-=Math.sign(l)*u),Math.abs(d)>f/2&&(d-=Math.sign(d)*f),Math.abs(l)<=a.width/2&&Math.abs(d)<=a.height/2)return a}}var oe=(e=>(e.Leader="leader",e.Gatherer="gatherer",e.Planter="planter",e.Hunter="hunter",e.Mover="mover",e.Warrior="warrior",e))(oe||{});const _t=30,pa=_t*.6,sI="#4CAF50",aI="#FF5722",lI="#9C27B0",I1="#2196F3",cI="#FFC107",T1="#DC143C",Rp="#FFFFFF",Pp=[5,5],Ou=5,da=15,E1=20,C1=16,_1=10,w1=16,R1=16,au=["","","","","","","","","",""],wl=8,P1="#FFFFFF",it=18,et=15,D1="rgba(0, 0, 0, 0.7)",N1=4,ko=150,Ln=15,Ki=10,zo="#555",M1="#f44336",O1="#4CAF50",b1="#2196F3",k1="#FFC107",Sd=16,Ar=32,vd=28,B1=10,F1=8,L1=8,U1=8,ei=28,Ad=40,H1="rgba(255, 215, 0, 0.7)",G1="rgba(0, 0, 0, 0.3)",Ri=10,NS=8,Vh=11,Bo=20,Kh=40,MS=5,$1=10,x1="#FFA500",W1="#808080",oo=120,dI=30,Y1=20,Wo="#2d3748",Ht="#ffffff",Id="#4a5568",uI=5,Dp="#bdc9f792",fI="#272c36ff",hI="#a0aec0",lu=300,gI="rgba(255, 255, 255, 0.5)",z1="rgba(0, 0, 0, 0.8)",j1="#FFFFFF",OS=14,bS=8,kS=-15,pI="#FFD700",mI=5,X1=10,qh=12,V1=10,K1="#4CAF50",q1="#F44336",Z1="#FFC107",Q1="rgba(255, 255, 255, 0.2)",BS="#FFFFFF",J1="#FF6B6B",eP=5,yI=30,sl=50,Td=8,FS=10,tP="rgba(0, 0, 0, 0.5)",nP="#FFFFFF",iP=33,oP=400,rP=20,sP=10,aP="rgba(0, 0, 0, 0.7)",lP="#FFFFFF",Zh=20,LS=16,cP=.5,US=5,SI="#FFD700",dP=40,Np=4,vI=3,uP=5,AI=20,II=5,fP="#FFFFFF",hP="#FF6B6B",Un=80,Ir=10,Ed=300,Tr=15,gP=8,pP="rgba(0, 0, 0, 0.8)",mP="#FFFFFF",Qh=14,HS=10,Pi=20,yP="#FF6B6B",SP="#4CAF50",GS="#FFD700",vP="rgba(255, 255, 0, 0.3)",AP=2,IP=500,TP=120,EP=45,CP="#FFD700",_P=3,wP=4;let Jh=0;function cu(){const e=au[Jh];return Jh=(Jh+1)%au.length,e}function $S(e,t,n){return t.search.human.byRadius(e.position,n).filter(a=>{var d;return!(a.id===e.id||a.gender===e.gender||!a.isAdult||a.hunger>=an||(a.procreationCooldown||0)>0||a.gender==="female"&&a.isPregnant||(e.motherId===a.id||e.fatherId===a.id)&&((d=a.partnerIds)!=null&&d.length))}).sort((a,l)=>{const d=a.id===e.motherId||a.id===e.fatherId,u=e.id===a.motherId||e.id===a.fatherId,f=l.id===e.motherId||l.id===e.fatherId,g=e.id===l.motherId||e.id===l.fatherId;return d||u?1:f||g?-1:a.age-l.age})}function jr(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),i=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(i),t.length>0)return t[0];if(n.sort(i),n.length>0)return n[0]}function Mn(e,t){const n=e,i=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...i,...s]}function RP(e,t,n){var s;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||e.motherId&&e.motherId===t.motherId||e.fatherId&&e.fatherId===t.fatherId||(s=e.partnerIds)!=null&&s.includes(t.id))return!0;if(e.motherId){const a=n.entities.entities[e.motherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(e.fatherId){const a=n.entities.entities[e.fatherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(t.motherId){const a=n.entities.entities[t.motherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}if(t.fatherId){const a=n.entities.entities[t.fatherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}return!1}function xg(e,t){var a,l,d,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(l=t.partnerIds)!=null&&l.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,i=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((d=e.ancestorIds)==null?void 0:d.some(f=>t.ancestorIds.includes(f)))||((u=t.ancestorIds)==null?void 0:u.some(f=>e.ancestorIds.includes(f)));return n||i||s}function PP(e,t){const n=[];if(e.motherId){const i=t.entities.entities[e.motherId];i&&n.push(i)}if(e.fatherId){const i=t.entities.entities[e.fatherId];i&&n.push(i)}return n}function TI(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const i=t.entities.entities[n];if(i&&i.gender==="male")return i}return null}function Wg(e,t){var n;if(!e.isAdult){if(e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human")return i}if(e.motherId){const i=t.entities.entities[e.motherId];if(i&&i.type==="human")return i}}if(e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human"&&((n=jr(Mn(t,i)))==null?void 0:n.id)===e.id)return i}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?TI(e,t):null}function du(e,t){let n=e;const i=new Set;i.add(n.id);for(let s=0;s<OA;s++){let a=null;if(n.gender==="female"&&(a=TI(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||i.has(a.id))break;n=a,i.add(n.id)}return n}function Yl(e,t){var i;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(i=e.partnerIds)==null||i.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),Mn(t,e).forEach(s=>n.add(s)),Array.from(n)}function uu(e,t){const n=new Map;function i(s){const a=Mn(t,s);for(const l of a)n.has(l.id)||(n.set(l.id,l),i(l))}return i(e),Array.from(n.values())}function Li(e,t){return t.search.human.byProperty("leaderId",e)}function fu(e,t,n=new Map,i=new Set){var a;if(n.has(e))return n.get(e);if(i.has(e))return e;i.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const l=s.partnerIds.find(d=>{const u=t.entities.entities[d];return u&&u.gender==="male"});if(l){const d=fu(l,t,n,i);return n.set(e,d),d}}if(s.fatherId&&t.entities.entities[s.fatherId]){const l=fu(s.fatherId,t,n,i);return n.set(e,l),l}return n.set(e,e),e}function DP(e,t){e.leaderId=e.id,e.tribeRole=oe.Leader,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{roleWeights:{[oe.Leader]:0,[oe.Gatherer]:2,[oe.Planter]:2,[oe.Hunter]:2,[oe.Mover]:2,[oe.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}}),e.tribeInfo||(e.tribeInfo={tribeBadge:cu(),tribeColor:xn[Math.floor(Math.random()*xn.length)]}),e.tribeControl||(e.tribeControl={roleWeights:{[oe.Leader]:0,[oe.Gatherer]:2,[oe.Planter]:2,[oe.Hunter]:2,[oe.Mover]:2,[oe.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}})}function NP(e,t){if(e.length===0)return null;const n=new Map,i=new Map;for(const l of e){const d=fu(l.id,t,n);i.has(d)||i.set(d,[]),i.get(d).push(l)}let s=null,a=0;for(const[l,d]of i.entries())d.length>a&&(a=d.length,s=l);return s&&t.entities.entities[s]||null}function bu(e,t){var l,d,u;const n=new Map,i=Object.values(e.entities.entities).filter(f=>f.type==="human");for(const f of i)f.leaderId&&(n.has(f.leaderId)||n.set(f.leaderId,{leaderId:f.leaderId,tribeInfo:f.tribeInfo,members:[]}),(l=n.get(f.leaderId))==null||l.members.push(f));const s=t?(u=(d=e.entities.entities[t])==null?void 0:d.tribeControl)==null?void 0:u.diplomacy:void 0,a=Array.from(n.values()).map(f=>{var v,I;const g=e.entities.entities[f.leaderId],m=f.members.filter(A=>A.isAdult).length,S=f.members.length-m;return{leaderId:f.leaderId,tribeBadge:((v=f==null?void 0:f.tribeInfo)==null?void 0:v.tribeBadge)||"",tribeColor:((I=f==null?void 0:f.tribeInfo)==null?void 0:I.tribeColor)||"",adultCount:m,childCount:S,isPlayerTribe:f.leaderId===t,leaderAge:(g==null?void 0:g.age)??0,leaderGender:(g==null?void 0:g.gender)??"male",diplomacyStatus:(s==null?void 0:s[f.leaderId??-1])??Ut.Friendly}});return a.sort((f,g)=>f.isPlayerTribe?-1:g.isPlayerTribe?1:g.adultCount+g.childCount-(f.adultCount+f.childCount)),a}function jn(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function EI(e){var a;const t=new Set,i=e.search.human.all(),s=new Map;for(const l of i)l.leaderId&&(s.has(l.leaderId)||s.set(l.leaderId,[]),(a=s.get(l.leaderId))==null||a.push(l));for(const[l,d]of s){if(d.length===0)continue;const u=e.entities.entities[l],f=!u,g=u&&u.leaderId!==l;(f||g)&&t.add(l)}for(let l=0;l<e.terrainOwnership.length;l++){const d=e.terrainOwnership[l];d!==null&&!s.has(d)&&t.add(d)}return Array.from(t)}function MP(e,t){const n=new Map,s=t.search.human.all(),a=Yl(e,t);for(const d of a)n.set(d,3);for(const d of s)d.id===e.id||n.has(d)||xg(e,d)&&n.set(d,2);const l=Array.from(n.keys());for(const d of l)if(d.partnerIds)for(const u of d.partnerIds){const f=t.entities.entities[u];f&&!n.has(f)&&f.id!==e.id&&n.set(f,1)}return n}function OP(e,t){const n=Li(e,t);if(n.length===0)return null;const i=t.entities.entities[e];if(i&&i.leaderId&&i.leaderId!==i.id)return i.leaderId;const s=new Map;for(const d of n){const u=MP(d,t);for(const[f,g]of u)if(f.leaderId&&f.leaderId!==e){const m=f.leaderId,S=t.entities.entities[m];if(S&&S.leaderId===S.id){const v=s.get(m)||0;s.set(m,v+g)}}}let a=null,l=0;for(const[d,u]of s)u>l&&(l=u,a=d);return a}function xS(e,t,n){var g,m;const i=Li(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=i.length>0?(g=i[0].tribeInfo)==null?void 0:g.tribeBadge:"?",l=s.leaderId===e||!s.leaderId;if(l){const S=n.entities.entities[e];DP(s,S)}const d=((m=s.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const S of i)S.id!==t&&(S.leaderId=t,S.tribeInfo=s.tribeInfo,S.tribeRole=void 0);const f=n.search.building.byProperty("ownerId",e);for(const S of f)S.ownerId=t;ru(n,e,t),xl(n,{identifier:`tribe-merge-${e}`,type:zr.TribeMerged,message:l?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${d}!`,duration:iu,targetEntityIds:[t],highlightedEntityIds:[t,...i.map(S=>S.id)]})}function bP(e){var n;const t=EI(e);for(const i of t){const s=Li(i,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",i);for(const f of u)$g(f.id,e);ru(e,i,null),xl(e,{identifier:`tribe-dissolved-${i}`,type:zr.TribeMerged,message:"An extinct tribe has been dissolved.",duration:iu});continue}const a=NP(s,e);if(a){xS(i,a.id,e);continue}const l=OP(i,e);if(l)xS(i,l,e);else{const d=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const g of s)g.leaderId=void 0,g.tribeInfo=void 0,g.tribeRole=void 0;const f=e.search.building.byProperty("ownerId",i);for(const g of f)$g(g.id,e);ru(e,i,null),xl(e,{identifier:`tribe-dissolved-${i}`,type:zr.TribeMerged,message:`Tribe ${d} has been dissolved due to lack of leadership.`,duration:iu})}}}var yt=(e=>(e.Wood="wood",e))(yt||{});const Mp={wood:""},ln="treeGrowing",Kt="treeFull",An="treeSpreading",Gt="treeFallen",uo="treeStump",Xr="treeDying",kP=500;function BP(e,t){if(!e.leaderId)return 0;const n=FP(e.leaderId,t),i=LP(e.leaderId,t);return i===0?0:Math.min(1,n/i)}function FP(e,t){const n=jn({leaderId:e},t),i=ma(e,t),s=n.reduce((l,d)=>l+d.food.length,0),a=i.reduce((l,d)=>{var f;const u=(f=d.storedItems)==null?void 0:f.filter(g=>g.item.type===In.Berry||g.item.type===In.Meat);return l+((u==null?void 0:u.length)||0)},0);return s+a}function LP(e,t){const n=jn({leaderId:e},t),i=ma(e,t),s=n.reduce((l,d)=>l+d.maxFood,0),a=i.reduce((l,d)=>l+(d.storageCapacity||0),0);return s+a}function CI(e,t,n=!1){const i=ma(e,t,n);if(i.length===0)return 0;const s=i.reduce((l,d)=>{var u;return l+(((u=d.storedItems)==null?void 0:u.length)||0)},0),a=i.reduce((l,d)=>l+(d.storageCapacity||0),0);return a===0?0:Math.min(1,s/a)}function zl(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const n=jn({leaderId:e},t),i=0,l=t.search.building.byProperty("ownerId",e).reduce((I,A)=>{if(A.isConstructed)return I;const _=ir[A.buildingType].cost.wood||0;return I+_},0),u=ua(e,t).reduce((I,A)=>{const R=(A.maxFuelLevel||Lr)-(A.fuelLevel||0);if(R<=0)return I;const P=Math.ceil(R/iI),w=A.storedItems.filter(N=>N.item.type===yt.Wood).length,b=Math.max(0,P-w);return I+b},0),g=ma(e,t).reduce((I,A)=>{var R;const _=(R=A.storedItems)==null?void 0:R.filter(P=>P.item.type===yt.Wood);return I+((_==null?void 0:_.length)||0)},0),m=n.reduce((I,A)=>{var _;return I+(((_=A.heldItem)==null?void 0:_.type)===yt.Wood?1:0)},0),S=g+m,v=l+u+i;return t.cache.tribeWoodNeeds[e]=Math.max(0,v-S),t.cache.tribeWoodNeeds[e]}function _I(e,t){const n=t;if(e&&n.cache.tribeAvailableWoodOnGround[e]!==void 0)return n.cache.tribeAvailableWoodOnGround[e];const i=n.search.tree.all().filter(s=>!(s.stateMachine[0]===Gt)||s.wood.length===0?!1:Wn(s.position,e,t));return n.cache.tribeAvailableWoodOnGround[e]=i.reduce((s,a)=>s+a.wood.length,0),n.cache.tribeAvailableWoodOnGround[e]}function wI(e,t){const n=jn({leaderId:e},t);if(n.length===0)return{count:0,ratio:0};const i=UP(e,t);return{count:i,ratio:i/n.length}}function UP(e,t){return t.search.berryBush.all().filter(a=>ri(a.position.x,a.position.y,t)===e).filter(a=>{const l=a.stateMachine&&a.stateMachine[0]==="bushDying",d=a.food.length>0,u=Ui(t.soilDepletion,a.position,t.mapDimensions.width,t.mapDimensions.height);return!l&&d&&!u}).length}function ku(e,t,n=!1){const i=typeof e=="object"?e.leaderId:e;return i?t.search.building.byProperty("buildingType",ce.PlantingZone).filter(a=>{if(!n&&!a.isConstructed)return!1;if(a.ownerId){const l=t.entities.entities[a.ownerId];return l&&l.leaderId===i}return!1}):[]}function RI(e,t){const{width:n,height:i,position:s}=e,{width:a,height:l}=t.mapDimensions,{depletedSectors:d,totalSectorsCount:u}=bI(t.soilDepletion,s,n,i,a,l);return u===0?!0:d.length/u<.25}function Op(e){const t=Qo*2,n=Math.floor(e.width/t),i=Math.floor(e.height/t);return n*i}function PI(e,t){const n=t,i=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,i).filter(l=>{const d=Math.abs(l.position.x-e.position.x),u=Math.abs(l.position.y-e.position.y);return d<=e.width/2&&u<=e.height/2}).length}function HP(e,t){if(!e.leaderId)return[];const n=ma(e.leaderId,t),i=jn(e,t);return n.map(s=>{var f;const a=s.storageCapacity||0,l=((f=s.storedItems)==null?void 0:f.length)||0,d=i.filter(g=>{if(g.activeAction!=="depositing")return!1;if(typeof g.target=="object"&&"x"in g.target){const m=g.target;return H(m,s.position,t.mapDimensions.width,t.mapDimensions.height)<=50}return!1}).length,u=H(e.position,s.position,t.mapDimensions.width,t.mapDimensions.height);return{storage:s,capacity:a,currentItems:l,assignedDepositors:d,distance:u}})}function DI(e,t){const n=HP(e,t);if(n.length===0)return null;const i=n.filter(s=>{const a=s.currentItems<s.capacity,l=s.distance<=kP;return a&&l});return i.length===0?null:(i.sort((s,a)=>{const l=s.currentItems/s.capacity,d=a.currentItems/a.capacity;return Math.abs(l-d)>.1?l-d:s.assignedDepositors!==a.assignedDepositors?s.assignedDepositors-a.assignedDepositors:s.distance-a.distance}),i[0].storage)}function GP(e,t){if(!e.leaderId)return null;const i=ua(e.leaderId,t).filter(s=>{const a=s.storageCapacity||su;return s.storedItems.length<a});if(i.length>0){const s=i.filter(a=>{const l=a.fuelLevel??0,d=a.maxFuelLevel??Lr;return l<d*wp});return s.length>0?(s.sort((a,l)=>{const d=a.fuelLevel??0,u=l.fuelLevel??0,f=a.maxFuelLevel??Lr,g=l.maxFuelLevel??Lr,m=d/f,S=u/g,v=m<.25,I=S<.25;return v!==I?v?-1:1:d-u}),s[0]):(i.sort((a,l)=>{const d=H(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height),u=H(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);return d-u}),i[0])}return DI(e,t)}function NI(e,t,n){return jn({leaderId:e},t).filter(s=>s.activeAction===n).length}function ma(e,t,n=!1){return t.search.building.byProperty("buildingType",ce.StorageSpot).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function ua(e,t,n=!1){return t.search.building.byProperty("buildingType",ce.Bonfire).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function $P(e,t){const n=ku(e,t);if(n.length===0)return null;const i=t.mapDimensions.width,s=t.mapDimensions.height,a=t.soilDepletion;for(const l of n){const d=Op(l);if(PI(l,t)>=d)continue;const f=20;for(let g=0;g<f;g++){const m=l.position.x+(Math.random()-.5)*l.width,S=l.position.y+(Math.random()-.5)*l.height,v={x:(m%i+i)%i,y:(S%s+s)%s};if(!Ui(a,v,i,s)&&!zn(v,t,Qo))return{position:v,zoneId:l.id}}}return null}function Jl(e,t,n=void 0){return n?ku(n,t).some(l=>kg(e,l,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===ce.PlantingZone&&kg(e,a,t))}function Bu(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/Xt),gridY:Math.floor(s/Xt)}}function MI(e,t,n){const i=CA(t,n);return e.sectors[i]||(e.sectors[i]=Nw()),e.sectors[i]}function bp(e,t,n){const i=CA(t,n),s=e.sectors[i];return s?s.health:nu}function Ui(e,t,n,i){const{gridX:s,gridY:a}=Bu(t,n,i);return bp(e,s,a)<RA}function OI(e,t,n){return bp(e,t,n)>=RA}function xP(e,t,n,i,s,a,l){const{gridX:d,gridY:u}=Bu(t,s,a),f=MI(e,d,u),g=f.lastAffectedBy[n]||0;if(i-g<DA)return;const m=Jl(t,l)?MA:1,S=Ow*m;f.health=Math.max(PA,f.health-S),f.lastWalkTime=i,f.lastAffectedBy[n]=i}function WP(e,t,n,i,s,a){const{gridX:l,gridY:d}=Bu(t,i,s),u=MI(e,l,d),f=Jl(t,a)?MA:1,g=Mw*f;u.health=Math.max(PA,u.health-g),u.lastPlantTime=n}function YP(e,t,n,i,s){let a=0;for(let l=-1;l<=1;l++)for(let d=-1;d<=1;d++){if(l===0&&d===0)continue;const u=((t+l)%i+i)%i,f=((n+d)%s+s)%s;OI(e,u,f)&&a++}return a}function zP({soilDepletion:e,time:t,mapDimensions:{width:n,height:i}}){if(t-e.lastUpdateTime<Hw)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/Xt),l=Math.ceil(i/Xt),d=[];for(const u of Object.keys(e.sectors)){const f=e.sectors[u],g=Math.max(f.lastWalkTime,f.lastPlantTime);if(t-g<Bw)continue;const{gridX:m,gridY:S}=_A(u),v=YP(e,m,S,a,l),I=v>0?kw*(v/8):0,A=bw+I;f.health=Math.min(nu,f.health+A*s),f.health>=nu&&d.push(u);const _=t-DA*10;for(const R of Object.keys(f.lastAffectedBy))f.lastAffectedBy[Number(R)]<_&&delete f.lastAffectedBy[Number(R)]}for(const u of d)delete e.sectors[u]}function jP(e,t){const n=[];for(const i of Object.keys(e.sectors)){const s=e.sectors[i];if(s.health<t){const{gridX:a,gridY:l}=_A(i);n.push({gridX:a,gridY:l,health:s.health})}}return n}function bI(e,t,n,i,s,a){const l=[],d=n/2,u=i/2,f=t.x-d,g=t.x+d,m=t.y-u,S=t.y+u,v=Math.floor(f/Xt),I=Math.floor((g-.001)/Xt),A=Math.floor(m/Xt),_=Math.floor((S-.001)/Xt),R=Math.ceil(s/Xt),P=Math.ceil(a/Xt);let w=0;for(let b=v;b<=I;b++)for(let N=A;N<=_;N++){w++;const D=(b%R+R)%R,M=(N%P+P)%P;OI(e,D,M)||l.push({gridX:D,gridY:M})}return{depletedSectors:l,totalSectorsCount:w}}function WS(e,t,n,i,s){const{gridX:a,gridY:l}=Bu(t,n,i),d=bp(e,a,l);return 1+(s-1)*Math.sqrt(1-d/nu)}const XP={id:_l,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ct/Dt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Hl,data:{...e,enteredAt:i.gameState.time}};if(!Ui(i.gameState.soilDepletion,n.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)){const l=Jl(n.position,i.gameState)?Dw:1;n.timeSinceLastBerryRegen+=s*l,n.timeSinceLastBerryRegen>=_w&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:In.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:Mr,data:{...e,enteredAt:i.gameState.time,previousState:_l}}:{nextState:_l,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},VP={id:Mr,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ct/Dt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Hl,data:{...e,enteredAt:i.gameState.time,previousState:Mr}};if(n.food.length<n.maxFood)return{nextState:_l,data:{...e,enteredAt:i.gameState.time,previousState:Mr}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=mS){n.timeSinceLastSpreadAttempt=0;const l=i.gameState.time-n.timeSinceLastHarvest>=mS,d=Jl(n.position,i.gameState)?Pw:1,u=i.gameState.ecosystem.berryBushSpreadChance*d;if(l&&Math.random()<u)return{nextState:zd,data:{...e,enteredAt:i.gameState.time,previousState:Mr}}}return{nextState:Mr,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function KP(e,t,n){const i=Yl(e,t),s=t;for(const a of i){if(H(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height)>n)continue;const d=s.search.human.byProperty("attackTargetId",a.id);for(const u of d)if(u.leaderId!==e.leaderId&&H(e.position,u.position,t.mapDimensions.width,t.mapDimensions.height)<=n)return{familyMember:a,aggressor:u}}}function qP(e,t){const i=t.search.human.byRadius(e.position,$R);let s,a=1/0;for(const l of i){if(l.id===e.id||l.hitpoints<=0||l.hitpoints/l.maxHitpoints>GR||RP(e,l,t)||e.leaderId===l.leaderId&&e.leaderId)continue;const d=H(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);d<a&&(a=d,s=l)}return s}function ZP(e,t,n){return t.search.human.byRadius(e.position,n).filter(s=>qr(e,s,t))}function QP(e,t,n){const i=n.search.human.byProperty("leaderId",e);let s=0;for(const a of i)a.attackTargetId===t&&s++;return s}function YS(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let i=n.hitpoints;return i+=(n.maxAge-n.age)*.5,i+=n.food.length*2,t+i},0)}var se=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(se||{});const Fu={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},kI={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var bs=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(bs||{});const al={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var fe=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenRoleManager="OpenRoleManager",e.CloseRoleManager="CloseRoleManager",e.IncreaseRoleWeight="IncreaseRoleWeight",e.DecreaseRoleWeight="DecreaseRoleWeight",e.OpenArmyControl="OpenArmyControl",e.CloseArmyControl="CloseArmyControl",e.IncreaseArmyObjective="IncreaseArmyObjective",e.DecreaseArmyObjective="DecreaseArmyObjective",e.SwitchAIType="SwitchAIType",e))(fe||{});const eg=30,JP=.4,eD=24,BI=50,tD=100,nD=160,iD=72,FI=10,kp=2,oD=10,rD=15,Yg=5,zg=5,jg=5,zS=600,sD=1.5,LI=.1,tg=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,ng=""+new URL("gather-CU75596W.mp3",import.meta.url).href,aD=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,jS=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,lD=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,cD=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,dD=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,uD=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,fD=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,hD=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var _e=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(_e||{});const gD=new Map([[0,tg],[1,ng],[2,aD],[3,jS],[4,lD],[5,cD],[6,dD],[12,uD],[13,fD],[7,tg],[8,jS],[9,ng],[10,ng],[11,tg],[14,hD]]);let ll,jl;function pD(){if(!(typeof window>"u"))return jl}function Bp(){if(!(typeof window>"u"))return!ll&&typeof window.AudioContext=="function"&&(ll=new window.AudioContext,jl=ll.createGain(),jl.connect(ll.destination),Rl(.1,!1)),ll}function Rl(e,t){jl&&(jl.gain.value=t?0:e/10)}const UI=new Map;let Cd=!1,XS=!1;async function mD(){if(XS||Cd)return;const e=Bp();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),Cd=!0,console.log("Starting sound loading...");const t=[];gD.forEach((n,i)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{UI.set(i,a)}).catch(a=>{console.error(`Error loading sound ${_e[i]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),XS=!0,Cd=!1,console.log("All sounds loaded successfully.")}catch(n){Cd=!1,console.error("An error occurred while loading sounds:",n)}}const Pl=new Map;function Fp(e,t){const n=Bp(),i=pD();if(!n||!i||i.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=UI.get(e);if(!s){console.warn(`Sound buffer not found for type: ${_e[e]}`);return}if(t!=null&&t.trackId&&Pl.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const l=n.createGain(),d=n.createStereoPanner();let u=l;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const f=Xe(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),g=H(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(g>zS)return;const m=1-Math.pow(g/zS,sD);l.gain.value=Math.max(0,m);const S=Math.sin(f.x/g*(Math.PI/2));d.pan.value=isNaN(S)?0:S,l.connect(d),u=d}else{const f=e===_e.GameOver?.4:e===_e.SoundTrack1?1:.2;l.gain.value=f}a.connect(u),u.connect(i),a.start(0),t!=null&&t.trackId&&(Pl.set(t.trackId,{sourceNode:a,gainNode:l}),a.onended=()=>{Pl.delete(t.trackId)})}function ig(e,t=1){const n=Pl.get(e),i=Bp();if(n&&i){const{sourceNode:s,gainNode:a}=n,l=i.currentTime;a.gain.setValueAtTime(a.gain.value,l),a.gain.linearRampToValueAtTime(0,l+t),s.stop(l+t),s.onended=null,Pl.delete(e)}}function Me(e,t,n){const i=vt(e.gameState);i&&Fp(t,{position:n,listenerPosition:i.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}var T=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.FAILURE=1]="FAILURE",e[e.RUNNING=2]="RUNNING",e[e.NOT_EVALUATED=3]="NOT_EVALUATED",e))(T||{});class On{constructor(){De(this,"name");De(this,"depth");De(this,"children");De(this,"child")}getLastStatus(t){return E.get(t.aiBlackboard,`${this.name}_lastStatus`)??3}setLastStatus(t,n){E.set(t.aiBlackboard,`${this.name}_lastStatus`,n)}getRunningChildIndex(t){return E.get(t.aiBlackboard,`${this.name}_runningChildIndex`)}setRunningChildIndex(t,n){E.set(t.aiBlackboard,`${this.name}_runningChildIndex`,n)}}const E={create(){return{data:{},nodeExecutionData:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e},recordNodeExecution({nodeExecutionData:e},t,n,i,s,a){const l=e[t]||{lastExecuted:0,status:T.FAILURE,depth:0,debugInfo:"",executionHistory:[]},d=l.executionHistory[l.executionHistory.length-1];d&&i-(d==null?void 0:d.time)>aa&&l.executionHistory.push({time:d.time+aa,status:T.NOT_EVALUATED}),l.executionHistory.push({time:i,status:n});const u=yI/Dt*Ct,f=i-u;l.executionHistory=l.executionHistory.filter(m=>m.time>=f);const g={...l,lastExecuted:i,status:n,depth:s,debugInfo:a};e[t]=g},getNodeExecutionData({nodeExecutionData:e}){return e},cleanupOldEntries({nodeExecutionData:e},t){const n=PR,i=[];for(const[s,a]of Object.entries(e))t-a.lastExecuted>n&&i.push(s);for(const s of i)delete e[s]}},Lp="tribeSplit_phase",ec="tribeSplit_strategy",Up="tribeSplit_targetPosition",Lu="tribeSplit_targetBuildingId",Uu="tribeSplit_familyIds",HI="tribeSplit_phaseStartTime",GI="tribeSplit_lastFailureTime";function $I(e,t){E.set(e,Lp,"idle"),E.delete(e,ec),E.delete(e,Up),E.delete(e,Lu),E.delete(e,Uu),E.set(e,GI,t)}function yD(e,t){const n=E.get(e,GI);return n?t-n>=iD:!0}function SD(e,t){const n=E.get(e,HI);return n?t-n>=nD:!1}function Hp(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(EI(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!yD(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const i=t.entities.entities[e.leaderId];if(!i||i.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=jr(Mn(t,i));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(du(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const l=Li(e.leaderId,t).filter(v=>v.isAdult);if(l.length<eg)return{canSplit:!1,reason:"Tribe too small"};const u=uu(e,t).length+1,g=uu(i,t).length+1;if(u>=g&&u>eg)return{canSplit:!0,progress:1,strategy:VS(e,t)};const m=Math.max(l.length*JP,eg),S=u/m;if(u>=m){const v=VS(e,t);return{canSplit:!0,progress:S,strategy:v}}return{canSplit:!1,progress:S,reason:`Family too small: ${u} < ${m}`}}function VS(e,t){if(!e.leaderId)return"migration";const n=t;if(!(ri(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===ce.StorageSpot&&a.isConstructed);return s.length>0&&s.find(l=>H(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height)<=tD)?"concentration":"migration"}function xI(e,t){if(!e.aiBlackboard)return!1;const n=E.get(e.aiBlackboard,ec);if(!n)return!1;const i=uu(e,t),s=[e.id,...i.map(a=>a.id)];return E.set(e.aiBlackboard,Uu,s),n==="migration"?AD(e,t):n==="concentration"?ID(e,t):!1}function vD(e,t,n){if(zn(e,n,30))return!1;const s=ri(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function AD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,i=t.mapDimensions.height,s=Math.min(n,i)/2,a=50,l=50;for(let d=0;d<=s;d+=a){const u=d===0?1:Math.max(8,Math.ceil(2*Math.PI*d/l)),f=d===0?0:2*Math.PI/u;for(let g=0;g<u;g++){const m=g*f,S=Math.cos(m)*d,v=Math.sin(m)*d,I=e.position.x+S,A=e.position.y+v,_={x:(I%n+n)%n,y:(A%i+i)%i};if(vD(_,e.leaderId,t))return E.set(e.aiBlackboard,Up,_),!0}}return!1}function ID(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const i=t.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===ce.StorageSpot&&l.isConstructed);if(i.length===0)return!1;let s=null,a=1/0;for(const l of i){const d=H(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);d<a&&(a=d,s=l)}return s?(E.set(e.aiBlackboard,Lu,s.id),!0):!1}function TD(e,t){var d;if(!e.aiBlackboard)return[!1,0];const n=E.get(e.aiBlackboard,ec),i=(d=E.get(e.aiBlackboard,Uu))==null?void 0:d.filter(u=>!!t.entities.entities[u]);if(!n||!i)return[!1,0];let s;if(n==="migration"){const u=E.get(e.aiBlackboard,Up);if(!u)return[!1,0];s=u}else if(n==="concentration"){const u=E.get(e.aiBlackboard,Lu);if(!u)return[!1,0];const f=t.entities.entities[u];if(!f)return[!1,0];s=f.position}else return[!1,0];let a=0;for(const u of i){const f=t.entities.entities[u];if(!f||f.type!=="human")continue;H(f.position,s,t.mapDimensions.width,t.mapDimensions.height)<=BI&&a++}const l=Math.ceil(i.length*.5);return[a>=l,a/l]}function WI(e,t){var u;if(!e.aiBlackboard)return!1;const n=E.get(e.aiBlackboard,ec),i=E.get(e.aiBlackboard,Uu);if(!n||!i)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=cu(),l=xn[Math.floor(Math.random()*xn.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:l},e.tribeRole=oe.Leader,e.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=Ut.Hostile);for(const f of i){if(f===e.id)continue;const g=t.entities.entities[f];!g||g.type!=="human"||(g.leaderId=e.id,g.tribeInfo={tribeBadge:a,tribeColor:l})}if(n==="concentration"){const f=E.get(e.aiBlackboard,Lu);if(f){const g=t.entities.entities[f];g&&g.type==="building"&&(g.ownerId=e.id)}}return xl(t,{type:zr.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:iu,targetEntityIds:[e.id],highlightedEntityIds:i}),Me({gameState:t},_e.TribeSplit,e.position),$I(e.aiBlackboard,t.time),!0}function Al(e){return e?E.get(e,Lp)??"idle":"idle"}function Cs(e,t,n){E.set(e,Lp,t),E.set(e,HI,n)}function YI(e,t){E.set(e,ec,t)}function ED(e,t){$I(e,t)}function CD(e,t){return SD(e,t)?(ED(e,t),!0):!1}function zI(e,t){const n=Hp(e,t);return{canSplit:n.canSplit,progress:n.progress}}function jI(e,t){if(!e.aiBlackboard)return;const n=Hp(e,t);!n.canSplit||!n.strategy||(YI(e.aiBlackboard,n.strategy),xI(e,t)&&WI(e,t))}const _D=20,qt=30,wD=.5,RD=.3,PD=2,DD=50;function Gp(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>Jo&&n.push({type:se.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const l=Be(t,e,"berryBush",ze,f=>f.food.length>0),d=Be(t,e,"corpse",ze,f=>f.food.length>0);let u=null;l&&d?u=H(t.position,l.position,e.mapDimensions.width,e.mapDimensions.height)<=H(t.position,d.position,e.mapDimensions.width,e.mapDimensions.height)?l:d:u=l||d,u&&n.push({type:se.Gather,action:"gathering",key:"e",targetEntity:u})}const i=Be(t,e,"human",ze,l=>or(t,l,e));if(i&&n.push({type:se.Procreate,action:"procreating",key:"r",targetEntity:i}),t.food.length>0&&t.isAdult){const l=Be(t,e,"human",ze,d=>{const u=d;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=Jo});l&&n.push({type:se.FeedChild,action:"feeding",key:"h",targetEntity:l})}const s=Be(t,e,"human",Sn,l=>qr(t,l,e))??Be(t,e,"predator",Sn)??Be(t,e,"prey",Sn);if(s&&n.push({type:se.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(l=>l.type===In.Berry).length>=fo&&n.push({type:se.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const l=Be(t,e,"building",qt,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});l&&n.push({type:se.Deposit,action:"idle",key:"x",targetEntity:l})}if(t.food.length<t.maxFood&&t.isAdult){const l=Be(t,e,"building",qt,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});l&&n.push({type:se.Retrieve,action:"idle",key:"z",targetEntity:l})}if(((a=t.heldItem)==null?void 0:a.type)===yt.Wood){const l=Be(t,e,"building",qt,d=>{const u=d;return u.buildingType===ce.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});l&&n.push({type:se.Deposit,action:"depositing",key:"x",targetEntity:l})}if(zI(t,e).canSplit&&n.push({type:se.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const l=Be(t,e,"tree",_u,d=>d.wood&&d.wood.length>0);l&&n.push({type:se.Chop,action:"chopping",key:"c",targetEntity:l})}return n}const ND={id:zd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i,a=i.deltaTime*(Ct/Dt);if(n.age+=a,n.age>=n.lifespan)return{nextState:Hl,data:{...e,enteredAt:s.time,previousState:zd}};const l=Cp(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return zn(l,s,15)||oc(s.entities,l,s.time),{nextState:Mr,data:{...e,enteredAt:s.time,previousState:zd}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},MD={id:Hl,update:e=>({nextState:Hl,data:e}),onEnter:(e,t)=>(Qr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},OD=[XP,VP,ND,MD],mt="humanIdle",Nr="humanMoving",Il="humanEating",ya="humanGathering",Dl="humanDepositing",Nl="humanRetrieving",kr="humanProcreating",er="humanAttacking",jd="humanPlanting",$p="humanChopping",bD={id:mt,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:er,data:{...e,enteredAt:i.gameState.time,previousState:mt,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:(n.hunger>=pp?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:i.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:Nr,data:{...e,enteredAt:i.gameState.time,previousState:mt,target:n.target}}:n.activeAction==="gathering"?{nextState:ya,data:{...e,enteredAt:i.gameState.time,previousState:mt,target:n.target}}:n.activeAction==="eating"?{nextState:Il,data:{...e,enteredAt:i.gameState.time,previousState:mt}}:n.activeAction==="planting"&&n.target?{nextState:jd,data:{...e,enteredAt:i.gameState.time,previousState:mt,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:Dl,data:{...e,enteredAt:i.gameState.time,previousState:mt}}:n.activeAction==="retrieving"?{nextState:Nl,data:{...e,enteredAt:i.gameState.time,previousState:mt}}:n.activeAction==="chopping"&&n.target?{nextState:$p,data:{...e,enteredAt:i.gameState.time,previousState:mt,state:"chopping"}}:{nextState:mt,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function XI(e,t=1){let n=$w;return e.hunger>=pp&&(n*=xw),e.age>=Yw&&(n*=zw),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const og=7.5;class kD{constructor(){De(this,"id",Nr)}update(t,n){var S;const{entity:i,updateContext:s}=n;if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:er,data:{...t,enteredAt:s.gameState.time,previousState:Nr,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:Nr}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(S=n.updateContext.gameState.entities.entities[i.target])==null?void 0:S.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*og*2,y:i.position.y+i.direction.y*og*2}),!a)return{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:Nr}};const{width:l,height:d}=s.gameState.mapDimensions,u=H(i.position,a,l,d);if(u<og)return{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:Nr}};const f=Xe(i.position,a,l,d),g=ot(f);if(u>vS){const v=Eg(g,-jh),I=Eg(g,jh),A=[g,v,I],_=A.map((P,w)=>{const b=oi(i.position,At(P,vS)),N={x:(b.x%l+l)%l,y:(b.y%d+d)%d},D=WS(s.gameState.soilDepletion,N,l,d,SS),k=Math.cos(w===0?0:jh);return D*k});let R=0;for(let P=1;P<_.length;P++)_[P]>_[R]&&(R=P);i.direction=A[R]}else i.direction=g;const m=WS(s.gameState.soilDepletion,i.position,l,d,SS);return i.acceleration=XI(i,m),{nextState:Nr,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const BD=new kD,FD={id:Il,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:mt,data:{...e,enteredAt:i.gameState.time,previousState:Il}}:(n.food.length>0&&(!n.eatingCooldownTime||i.gameState.time>=n.eatingCooldownTime)&&n.hunger>Jo&&(n.hunger=Math.max(0,n.hunger-Jo),n.food.pop(),n.eatingCooldownTime=i.gameState.time+1,Me(i,_e.Eat,n.position),(!n.lastEatingEffectTime||i.gameState.time-n.lastEatingEffectTime>2)&&(Ge(i.gameState,Ce.Eating,n.position,Ke,n.id),n.lastEatingEffectTime=i.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:mt,data:{...e,enteredAt:i.gameState.time,previousState:Il}}:{nextState:Il,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class LD{constructor(){De(this,"id",ya)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const UD=new LD,HD={id:Dl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:mt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Dl}}:{nextState:Dl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},GD={id:Nl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:mt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Nl}}:{nextState:Nl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},$D=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),xD=(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time<(e.procreationEndTime||0))return{nextState:kr,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<an&&a.hunger<an&&!n.procreationCooldown&&!a.procreationCooldown){const l=n.gender==="female"?n:a.gender==="female"?a:void 0,d=n.gender==="male"?n:a.gender==="male"?a:void 0;l&&d&&(l.isPregnant=!0,l.gestationTime=Xw,l.pregnancyFatherId=d.id,n.procreationCooldown=AS,a.procreationCooldown=AS,Me(i,_e.Procreate,l.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:mt,data:{...e,enteredAt:s.time,previousState:kr}}},WD={id:kr,onEnter:$D,update:xD},YD={id:er,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:mt,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:mt,data:{...e}};const i=H(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Xe(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=ot(s),i<=ho||i<=Sn&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=XI(t.entity),{nextState:er,data:e}}},zD={id:jd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time-e.enteredAt>=Rw){const l=n.food.filter(u=>u.type===In.Berry).length,d=Ui(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(l>=fo&&!d){for(let u=0;u<fo;u++){const f=n.food.findIndex(g=>g.type===In.Berry);f>-1&&n.food.splice(f,1)}oc(s.entities,e.plantingSpot,s.time),WP(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:mt,data:{...e,enteredAt:s.time,previousState:jd}}}return{nextState:jd,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class jD{constructor(){De(this,"id",$p)}update(t,n){const{entity:i,updateContext:s}=n;return i.activeAction!=="chopping"||i.heldItem?{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const XD=new jD,VD=[bD,BD,FD,UD,HD,GD,WD,YD,zD,XD],mi="preyIdle",Yo="preyMoving",Tl="preyGrazing",El="preyProcreating",KD={id:mi,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Yo,data:{...e,enteredAt:i.gameState.time,previousState:mi,target:n.target}}:n.activeAction==="grazing"?{nextState:Tl,data:{...e,enteredAt:i.gameState.time,previousState:mi}}:n.activeAction==="procreating"?{nextState:El,data:{...e,enteredAt:i.gameState.time,previousState:mi}}:{nextState:mi,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},VI=12,qD=120,KS=50,ZD=12,KI=30,QD=2,yn=50,JD=100,Ml=2,rg=3,eN=.9,tN=1,nN=50,iN=.5,qI=20,oN=140,qS=40,rN=12,ZI=40,sN=3,Zo=60,yi=40,ks=50,ZS=320,QI=25,aN=60,JI=2,lN=90,cN=.7,dN=1,Ol=3,sg=15,xp=80,eT=10,Hu=80,Sa=40,tT=2,hu=30,Gs=20,Ur=40,$s=24,Hr=48,xs=12,Gr=40,Ws=20,$r=60,Ys=.75,jo=2.5,zs=.25,Xo=2,nT=4;function uN(e){let t=ZD;return e.isAdult||(t*=.7),e.hunger>=nN&&(t*=iN),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function fN(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),g=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function Xl(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const ag=10;class hN{constructor(){De(this,"id",Yo)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction!=="moving")return{nextState:mi,data:{...t,enteredAt:s.gameState.time,previousState:Yo}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*ag*2,y:i.position.y+i.direction.y*ag*2}),!a)return{nextState:mi,data:{...t,enteredAt:s.gameState.time,previousState:Yo}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=ot(l),i.acceleration=uN(i),H(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<ag?{nextState:mi,data:{...t,enteredAt:s.gameState.time,previousState:Yo}}:{nextState:Yo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const gN=new hN,pN={id:Tl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Yo,data:{...e,enteredAt:i.gameState.time,previousState:Tl,target:n.target}}:n.activeAction!=="grazing"?{nextState:mi,data:{...e,enteredAt:i.gameState.time,previousState:Tl}}:{nextState:Tl,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},mN={id:El,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Yo,data:{...e,enteredAt:i.gameState.time,previousState:El,target:n.target}}:n.activeAction!=="procreating"?{nextState:mi,data:{...e,enteredAt:i.gameState.time,previousState:El}}:{nextState:El,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},yN=[KD,gN,pN,mN],mn="predatorIdle",$o="predatorMoving",no="predatorAttacking",Bs="predatorProcreating",xr="predatorEating",SN={id:mn,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:xr,data:{...e,enteredAt:i.gameState.time,previousState:mn,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:no,data:{...e,enteredAt:i.gameState.time,previousState:mn,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction==="moving"?{nextState:$o,data:{...e,enteredAt:i.gameState.time,previousState:mn,target:n.target}}:n.activeAction==="procreating"?{nextState:Bs,data:{...e,enteredAt:i.gameState.time,previousState:mn}}:{nextState:mn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function iT(e){let t=rN;return e.hunger>=lN&&(t*=cN),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function vN(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),g=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function Vl(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const lg=12;class AN{constructor(){De(this,"id",$o)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction==="eating")return{nextState:xr,data:{...t,enteredAt:s.gameState.time,previousState:$o,preyId:i.attackTargetId,eatingStartTime:s.gameState.time}};if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:no,data:{...t,enteredAt:s.gameState.time,previousState:$o,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:$o}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*lg*2,y:i.position.y+i.direction.y*lg*2}),!a)return{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:$o}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=ot(l),i.acceleration=iT(i),H(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<lg?{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:$o}}:{nextState:$o,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const IN=new AN,TN={id:no,update:(e,t)=>{const{entity:n,updateContext:i}=t;if(n.activeAction==="eating")return{nextState:xr,data:{...e,enteredAt:i.gameState.time,previousState:no,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:no}};const s=i.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:no}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:no}};const l=H(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),d=Xe(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return n.direction=ot(d),l>yi?n.acceleration=iT(n):n.acceleration=0,{nextState:no,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},EN={id:Bs,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:xr,data:{...e,enteredAt:i.gameState.time,previousState:Bs,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:no,data:{...e,enteredAt:i.gameState.time,previousState:Bs,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction!=="procreating"?{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:Bs}}:{nextState:Bs,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},CN={id:xr,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:xr}}:{nextState:xr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},_N=[SN,IN,TN,EN,CN],wN=24*30*10,tr=24*5,RN=48,PN=72,tc=20,DN="#3b2016",NN="#5c3a21",MN="#376d31",ON="#76a331",bN="#a6c44a",kN="rgba(0, 0, 0, 0.25)",BN=60,FN=24*7,LN=.1,QS=1,Gu=5,UN={id:ln,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.age>=n.lifespan?{nextState:Xr,data:{enteredAt:i.gameState.time,previousState:ln}}:n.age>=tr?{nextState:Kt,data:{enteredAt:i.gameState.time,previousState:ln}}:{nextState:ln,data:e}}},HN={id:Kt,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ct/Dt);return n.age>=n.lifespan?{nextState:Xr,data:{...e,enteredAt:i.gameState.time,previousState:Kt}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=FN&&(n.timeSinceLastSpreadAttempt=0,Math.random()<LN)?{nextState:An,data:{...e,enteredAt:i.gameState.time,previousState:Kt}}:{nextState:Kt,data:e})}},GN={id:An,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(n.age>=n.lifespan)return{nextState:Xr,data:{...e,enteredAt:s.time,previousState:An}};const a=Cp(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return zn(a,s,25)||Kl(s.entities,a,s.time),{nextState:Kt,data:{...e,enteredAt:s.time,previousState:An}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},$N={id:Gt,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=RN?{nextState:uo,data:{enteredAt:n.gameState.time,previousState:Gt}}:{nextState:Gt,data:e}}},xN={id:uo,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=PN?{nextState:Xr,data:{enteredAt:n.gameState.time,previousState:uo}}:{nextState:uo,data:e}}},WN={id:Xr,update:e=>({nextState:Xr,data:e}),onEnter:(e,t)=>(Qr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},YN=[UN,HN,GN,$N,xN,WN],JS=[...OD,...VD,...yN,..._N,...YN];function zN(e,t,n){const i=yw(e,JS);if(!i)return vw(e),[e,t];const{nextState:s,data:a}=i.update(t,n);return Sw(e,s)?[s,mw(i,s,a,n,JS)]:[s,a]}function Wp(e,t){return`${e},${t}`}const ev=Ct*10;function oT(e){return e%ev/ev}function rT(e){const t=oT(e);return(Math.cos(t*2*Math.PI)+1)/2}function jN(e){const t=oT(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function sT(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/io),gridY:Math.floor(s/io)}}function nr(e,t,n,i,s){const{gridX:a,gridY:l}=sT(t,i,s),d=Wp(a,l),u=e.sectors[d],f=u?u.currentTemperature:nI,m=(rT(n)*2-1)*y1;return f+m}function XN(e){const{sectors:t}=e.temperature,{width:n,height:i}=e.mapDimensions,s=Math.ceil(n/io),a=Math.ceil(i/io);for(const d in t){const u=t[d];u.currentTemperature=u.baseTemperature}const l=Math.ceil(Fr/io);Object.values(e.entities.entities).forEach(d=>{if(d.type==="building"){const u=d;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const f=sT(u.position,n,i);for(let g=-l;g<=l;g++)for(let m=-l;m<=l;m++){const S=(f.gridX+m+s)%s,v=(f.gridY+g+a)%a,I=Wp(S,v),A=t[I];if(A){const _={x:(S+.5)*io,y:(v+.5)*io},R=H(u.position,_,n,i);if(R<Fr){const P=g1*(1-R/Fr);A.currentTemperature+=P}}}}}})}function aT(e,t){const n={},i=Math.ceil(e/io),s=Math.ceil(t/io);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const d=Wp(l,a);let u=nI;const f=a/s*10-5;u+=f,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),n[d]={baseTemperature:u,currentTemperature:u}}return{sectors:n}}function VN(e,t,n){var d;const{gameState:i}=t,s=n*(Ct/Dt);e.isAdult=e.age>=mp;const a=nr(i.temperature,e.position,i.time,i.mapDimensions.width,i.mapDimensions.height);if(a<co){const u=(co-a)*h1*s;e.hitpoints-=u}if(e.movementSlowdown&&i.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<sn){const u=1-e.hunger/sn*oR,f=iR*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+f)}if(e.hunger+=n*(rl/(Ct/Dt)),e.hunger>=sn)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-Jo);else{const u=rR*s;e.hitpoints-=u}if(e.age+=n/Cu,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((rl*Vw-rl)/(Ct/Dt)),(!e.lastPregnantEffectTime||i.time-e.lastPregnantEffectTime>Wl*3)&&(Ge(i,Ce.Pregnant,e.position,Wl,e.id),e.lastPregnantEffectTime=i.time),e.gestationTime<=0&&(Yb(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===pa&&(e.radius=_t):e.hunger+=n*((rl*Kw-rl)/(Ct/Dt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const f=i.entities.entities[e.motherId];f&&u.push(f)}if(e.fatherId){const f=i.entities.entities[e.fatherId];f&&u.push(f)}for(const f of u)if(f.age>=yp&&f.hunger>=Qw&&H(e.position,f.position,i.mapDimensions.width,i.mapDimensions.height)<=Jw){e.food.pop(),f.hunger=Math.max(0,f.hunger-Jo),e.feedParentCooldownTime=eR;break}}let l;if(e.hitpoints<=0?a<co?l="hypothermia":e.hunger>=sn?l="hunger":l="killed":e.age>=e.maxAge&&(l="oldAge"),l){if(e.leaderId===e.id){const u=jr(Mn(i,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeRole=oe.Leader,u.tribeControl=e.tribeControl??{roleWeights:{[oe.Leader]:0,[oe.Gatherer]:2,[oe.Planter]:2,[oe.Hunter]:2,[oe.Mover]:2,[oe.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}};const f=i;ru(i,e.id,u.id);const g=f.search.human.byProperty("leaderId",e.id);for(const v of g)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const m=f.search.building.byProperty("ownerId",e.id);for(const v of m)v.ownerId=u.id;for(const v of uu(u,i))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const S=bu(i).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of S){const I=i.entities.entities[v.leaderId];if((d=I==null?void 0:I.tribeControl)!=null&&d.diplomacy){const A=I.tribeControl.diplomacy[e.id];A!==void 0&&(I.tribeControl.diplomacy[u.id]=A,delete I.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=jr(Mn(i,e));u?(u.isPlayer=!0,i.generationCount++):(i.gameOver=!0,i.causeOfGameOver=l,xl(i,{identifier:"no_heir",type:zr.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}$b(i.entities,e.position,e.gender,e.age,e.radius,e.id,i.time,e.food,e.hunger),Qr(i.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function KN(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/tR);const i=Math.floor(BA*(1-e.decayProgress));e.food.length>i&&e.food.splice(i),e.decayProgress>=1&&e.food.length<=0&&Qr(t.gameState.entities,e.id)}function qN(e,t,n){const i=n*(Ct/Dt);e.age+=n/Cu,e.isAdult=e.age>=Ml;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=qD){const l=nT*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};l.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,l.x)),l.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,l.y));const d=Math.random()<.5?"male":"female",u=e,f=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let g;if(f)g=fN(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}fa(t.gameState.entities,l,d,0,KI*.5,g,e.id,e.fatherId,e.aiType),Ge(t.gameState,Ce.Procreation,e.position,Wl,e.id),Me(t,_e.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=i,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=VI&&(a=!0),a&&(xb(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Qr(t.gameState.entities,e.id))}function ZN(e,t,n){const i=n*(Ct/Dt);e.age+=n/Cu,e.isAdult=e.age>=Ol;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=oN){const l=nT*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};l.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,l.x)),l.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,l.y));const d=Math.random()<.5?"male":"female",u=e,f=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let g;if(f)g=vN(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}ha(t.gameState.entities,l,d,0,ZI*.6,g,e.id,e.pregnancyFatherId,e.aiType),Ge(t.gameState,Ce.Procreation,e.position,Wl,e.id),Me(t,_e.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=i,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=i,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=qI&&(a=!0),a&&(Wb(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Qr(t.gameState.entities,e.id))}var $t=(e=>(e[e.BehaviorTreeBased=0]="BehaviorTreeBased",e[e.TaskBased=1]="TaskBased",e))($t||{});const Fi=24,$u=2,Yp=3;function xt(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}function QN(e,t){if(!e.aiBlackboard)return;const n=e.aiBlackboard.data,i=[];for(const s in n)if(s.startsWith("tribal_")){const a=n[s];a&&typeof a=="object"&&"startTime"in a&&t-a.startTime>Fi&&i.push(s)}for(const s of i)E.delete(e.aiBlackboard,s)}const nc="tribe_logistics_demands",JN=8;function rr(e){return E.get(e,nc)||[]}function lT(e,t,n,i){const s=rr(e),a=s.find(l=>l.requesterId===t&&l.resourceType===n);if(a)a.updatedAt=i;else{const l={requesterId:t,resourceType:n,updatedAt:i};s.push(l)}E.set(e,nc,s)}function eM(e,t,n,i,s){const a=rr(e),l=a.find(d=>d.requesterId===t&&d.resourceType===n);return l&&!l.claimedBy?(l.updatedAt=s,l.claimedBy=i,E.set(e,nc,a),!0):!1}function tM(e){return rr(e).filter(n=>!n.claimedBy).sort((n,i)=>n.updatedAt-i.updatedAt)}function cT(e,t,n){let i=rr(e);i=i.filter(s=>!(s.requesterId===t&&s.resourceType===n)),E.set(e,nc,i)}function dT(e,t,n){return rr(e).find(s=>s.requesterId===t&&s.resourceType===n)}function nM(e,t){let n=rr(e);n=n.filter(i=>t-i.updatedAt<=JN),E.set(e,nc,n)}function zp(e,t,n){const i=xt(e,t.gameState);i&&i.id===e.id&&i.aiBlackboard&&(QN(i,t.gameState.time),nM(i.aiBlackboard,t.gameState.time)),n.execute(e,t,e.aiBlackboard)}const tv="Human Behavior",iM=1;class oM{constructor(){De(this,"nodeData",new Map);De(this,"pathStack",[]);De(this,"startTimeStack",[])}nodeStart(t){this.pathStack.push(t),this.startTimeStack.push(performance.now())}nodeEnd(){if(this.startTimeStack.length===0||this.pathStack.length===0){console.error("BTProfiler: nodeEnd() called without a matching nodeStart().");return}const t=performance.now(),n=this.startTimeStack.pop(),i=t-n,s=this.pathStack.join(" > "),a=this.nodeData.get(s)??{path:s,totalTime:0,callCount:0,minTime:1/0,maxTime:-1/0};a.totalTime+=i,a.callCount++,a.minTime=Math.min(a.minTime,i),a.maxTime=Math.max(a.maxTime,i),this.nodeData.set(s,a),this.pathStack.pop()}report(t={}){const{showAll:n=!1}=t,i=Array.from(this.nodeData.values());if(i.length===0){console.log("--- Behavior Tree Profiler: No data collected. ---");return}let s=i,a="--- Behavior Tree Full Report ---";if(!n){const d=this.nodeData.get(tv);if(d){const u=d.totalTime*iM/100;s=i.filter(f=>f.totalTime>u&&f.path!==tv),a="--- Behavior Tree Problem Report ---"}else console.log('BTProfiler: Root node "Human Behavior" not found. Showing full report.'),a="--- Behavior Tree Full Report (Root Not Found) ---"}const l=s.sort((d,u)=>u.totalTime-d.totalTime);console.log(a),l.length>0?console.table(l.map(d=>({Path:d.path,"Total Time (ms)":d.totalTime.toFixed(3),Calls:d.callCount,"Avg Time (ms)":(d.totalTime/d.callCount).toFixed(3),"Min Time (ms)":d.minTime.toFixed(3),"Max Time (ms)":d.maxTime.toFixed(3)}))):console.log("No significant performance problems detected."),console.log("------------------------------------")}reset(){this.nodeData.clear(),this.pathStack=[],this.startTimeStack=[]}getNodeData(t){return this.nodeData.get(t)}}const rt=new oM;function Zt(e){return Array.isArray(e)?e:[e,""]}class Ie extends On{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{for(const a of this.children){const[l,d]=Zt(a.execute(n,i,s));if(l!==T.SUCCESS)return this.setLastStatus(n,l),this.name&&E.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,d),l}return this.setLastStatus(n,T.SUCCESS),this.name&&E.recordNodeExecution(s,this.name,T.SUCCESS,i.gameState.time,this.depth,""),T.SUCCESS}finally{this.name&&rt.nodeEnd()}}}class cn extends On{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const a=this.getRunningChildIndex(n)??0;for(let l=a;l<this.children.length;l++){const d=this.children[l],[u,f]=Zt(d.execute(n,i,s));if(u!==T.FAILURE){if(u===T.SUCCESS)return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,T.SUCCESS),this.name&&E.recordNodeExecution(s,this.name,T.SUCCESS,i.gameState.time,this.depth,f),T.SUCCESS;if(u===T.RUNNING)return this.setRunningChildIndex(n,l),this.setLastStatus(n,T.RUNNING),this.name&&E.recordNodeExecution(s,this.name,T.RUNNING,i.gameState.time,this.depth,f),T.RUNNING}}return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,T.FAILURE),this.name&&E.recordNodeExecution(s,this.name,T.FAILURE,i.gameState.time,this.depth,""),T.FAILURE}finally{this.name&&rt.nodeEnd()}}}class nv extends On{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{let a=!0;for(const d of this.children){const[u,f]=Zt(d.execute(n,i,s));u===T.FAILURE&&(a=!1),this.name&&E.recordNodeExecution(s,this.name,u,i.gameState.time,this.depth,f)}const l=a?T.SUCCESS:T.FAILURE;return this.setLastStatus(n,l),l}finally{this.name&&rt.nodeEnd()}}}class de extends On{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.action=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=Zt(this.action(n,i,s));return this.setLastStatus(n,a),this.name&&E.recordNodeExecution(s,this.name,a,i.gameState.time,this.depth,l),a}finally{this.name&&rt.nodeEnd()}}}class ge extends On{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.condition=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=Zt(this.condition(n,i,s)),d=a?T.SUCCESS:T.FAILURE;return this.setLastStatus(n,d),this.name&&E.recordNodeExecution(s,this.name,d,i.gameState.time,this.depth,l),d}finally{this.name&&rt.nodeEnd()}}}class rM extends On{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=Zt(this.child.execute(n,i,s));let d;switch(a){case T.SUCCESS:d=T.FAILURE;break;case T.FAILURE:d=T.SUCCESS;break;case T.RUNNING:default:d=a;break}return this.setLastStatus(n,d),this.name&&E.recordNodeExecution(s,this.name,d,i.gameState.time,this.depth,l),d}finally{this.name&&rt.nodeEnd()}}}class sM extends On{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[,a]=Zt(this.child.execute(n,i,s)),l=T.SUCCESS;return this.setLastStatus(n,l),this.name&&E.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,a),l}finally{this.name&&rt.nodeEnd()}}}class Or extends On{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");De(this,"startTimeKey");this.child=n,this.timeoutDurationHours=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.startTimeKey=`timeout_${this.name}_startTime`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time;let l=E.get(s,this.startTimeKey);const[d,u]=Zt(this.child.execute(n,i,s));if(d===T.RUNNING){l===void 0&&(E.set(s,this.startTimeKey,a),l=a);const f=a-l;if(f>this.timeoutDurationHours){E.delete(s,this.startTimeKey),this.setLastStatus(n,T.FAILURE);const m=`Timed out after ${f.toFixed(2)}h.`;return E.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m),this.getLastStatus(n)}this.setLastStatus(n,T.RUNNING);const g=`Running for ${f.toFixed(2)}h. ${u}`;return E.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}return l!==void 0&&E.delete(s,this.startTimeKey),this.setLastStatus(n,d),E.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class $n extends On{constructor(n,i,s,a=0,l){super();De(this,"name");De(this,"depth");De(this,"statusKey");De(this,"timestampKey");this.child=n,this.cacheDurationHours=i,this.validityCheck=l,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.statusKey=`caching_${this.name}_status`,this.timestampKey=`caching_${this.name}_timestamp`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time,l=E.get(s,this.statusKey),d=E.get(s,this.timestampKey);if(l!==void 0&&d!==void 0){const m=a-d>this.cacheDurationHours,S=this.validityCheck?this.validityCheck(n,i,s):!0;if(!m&&S){const v=(d+this.cacheDurationHours-a).toFixed(2),I=`Cache hit. Status: ${T[l]}. ${v}h left.`;return this.setLastStatus(n,l),E.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,I),this.getLastStatus(n)}}const[u,f]=Zt(this.child.execute(n,i,s));(u===T.SUCCESS||u===T.FAILURE)&&(E.set(s,this.statusKey,u),E.set(s,this.timestampKey,a)),this.setLastStatus(n,u);const g=`Cache miss. Child returned ${T[u]}. ${f}`;return E.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class va extends On{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");De(this,"cooldownKey");this.cooldownDurationHours=n,this.child=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.cooldownKey=`cooldown_${this.name}`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time,l=E.get(s,this.cooldownKey);if(this.child.getLastStatus(n)===T.RUNNING){const[f,g]=Zt(this.child.execute(n,i,s));if(this.setLastStatus(n,f),this.name){const m=`Continuing running child. ${g}`;E.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m)}return this.getLastStatus(n)}if(l!==void 0&&a<l){const g=`Cooldown active, ${(l-a).toFixed(2)}h left`;return this.setLastStatus(n,T.FAILURE),this.name&&E.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}const[d,u]=Zt(this.child.execute(n,i,s));return d===T.SUCCESS&&E.set(s,this.cooldownKey,a+this.cooldownDurationHours),this.setLastStatus(n,d),this.name&&E.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class Dn extends On{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");this.child=n,this.behaviorKey=i,this.name=s,this.depth=a;const l=(d,u)=>{d.depth=u,d.children?d.children.forEach(f=>l(f,u+1)):d.child&&l(d.child,u+1)};l(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer&&!i.gameState.autopilotControls.behaviors[this.behaviorKey]){const u=`Player autopilot for '${this.behaviorKey}' is disabled.`;return this.setLastStatus(n,T.FAILURE),this.name&&E.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,u),this.getLastStatus(n)}const[l,d]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,l),this.name&&E.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,d),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class aM extends On{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,d)=>{l.depth=d,l.children?l.children.forEach(u=>a(u,d+1)):l.child&&a(l.child,d+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer&&i.gameState.autopilotControls.isManuallyMoving)return this.setLastStatus(n,T.FAILURE),this.name&&E.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Manual movement active, AI blocked."),this.getLastStatus(n);const[a,l]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&E.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class _s extends On{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,d)=>{l.depth=d,l.children?l.children.forEach(u=>a(u,d+1)):l.child&&a(l.child,d+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer)return this.setLastStatus(n,T.FAILURE),this.name&&E.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Player controlled, AI blocked."),this.getLastStatus(n);const[a,l]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&E.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class Hi extends On{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");De(this,"registeredKey");this.child=n,this.config=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.registeredKey=`${this.name}_registered`}execute(n,i,s){rt.nodeStart(this.name);try{const a=xt(n,i.gameState);if(!a||!a.aiBlackboard){const[I,A]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,I),E.recordNodeExecution(s,this.name,I,i.gameState.time,this.depth,`No coordination: ${A}`),I}const l=i.gameState.time,d=E.get(s,this.registeredKey)??!1,u=this.getTaskTarget(n,i,s);if(!u)return this.setLastStatus(n,T.FAILURE),E.recordNodeExecution(s,this.name,T.FAILURE,l,this.depth,"No task target found"),T.FAILURE;const f=this.getTaskKey(u);if(d){const[I,A]=Zt(this.child.execute(n,i,s));return I===T.RUNNING?(this.refreshTaskTimestamp(a.aiBlackboard,f,n.id,l),this.setLastStatus(n,I),E.recordNodeExecution(s,this.name,I,l,this.depth,`Continuing: ${A}`),I):(this.removeFromTask(a.aiBlackboard,f,n.id),E.delete(s,this.registeredKey),this.setLastStatus(n,I),E.recordNodeExecution(s,this.name,I,l,this.depth,`Completed: ${A}`),I)}if(!this.canJoinTask(a.aiBlackboard,f,n.id,l)){this.setLastStatus(n,T.FAILURE);const I=E.get(a.aiBlackboard,f),A=(I==null?void 0:I.memberIds.length)??0,_=this.config.maxCapacity??1;return E.recordNodeExecution(s,this.name,T.FAILURE,l,this.depth,`Task full: ${A}/${_}`),T.FAILURE}if(!this.registerTask(a.aiBlackboard,f,n.id,l))return this.setLastStatus(n,T.FAILURE),E.recordNodeExecution(s,this.name,T.FAILURE,l,this.depth,"Failed to register task"),T.FAILURE;E.set(s,this.registeredKey,!0);const[S,v]=Zt(this.child.execute(n,i,s));if(S===T.RUNNING){this.setLastStatus(n,S);const I=E.get(a.aiBlackboard,f),A=(I==null?void 0:I.memberIds.length)??0,_=this.config.maxCapacity??1;return E.recordNodeExecution(s,this.name,S,l,this.depth,`Started (${A}/${_}): ${v}`),S}else return this.removeFromTask(a.aiBlackboard,f,n.id),E.delete(s,this.registeredKey),this.setLastStatus(n,S),E.recordNodeExecution(s,this.name,S,l,this.depth,`Immediate result: ${v}`),S}finally{rt.nodeEnd()}}getTaskTarget(n,i,s){var l,d,u,f;if(this.config.taskType==="procreation")return((d=(l=this.config).getTargetId)==null?void 0:d.call(l,n,i,s))??null;const a=(f=(u=this.config).getTargetId)==null?void 0:f.call(u,n,i,s);return a??null}getTaskKey(n){return this.config.generateTaskKey?this.config.generateTaskKey(this.config.taskType,n):`tribal_${this.config.taskType}_${n}`}canJoinTask(n,i,s,a){const l=E.get(n,i);if(!l||a-l.startTime>Fi||l.memberIds.includes(s))return!0;const d=this.config.maxCapacity??1;return l.memberIds.length<d}registerTask(n,i,s,a){let l=E.get(n,i);return l?a-l.startTime>Fi?(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},E.set(n,i,l),!0):l.memberIds.length>=(this.config.maxCapacity??1)?!!l.memberIds.includes(s):(l.memberIds.includes(s)||(l.memberIds.push(s),E.set(n,i,l)),!0):(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},E.set(n,i,l),!0)}refreshTaskTimestamp(n,i,s,a){const l=E.get(n,i);l&&l.memberIds.includes(s)&&(l.startTime=a,E.set(n,i,l))}removeFromTask(n,i,s){const a=E.get(n,i);a&&(a.memberIds=a.memberIds.filter(l=>l!==s),a.memberIds.length===0?E.delete(n,i):E.set(n,i,a))}}function lM(e){return new Ie([new ge((t,n)=>{const i=t.hunger>=la,s=t.food.length>0,a=!t.eatingCooldownTime||n.gameState.time>=t.eatingCooldownTime;return[!!(i&&s&&a),`${Math.floor(t.hunger-la)}, ${t.food.length}, ${t.eatingCooldownTime?Math.floor(t.eatingCooldownTime-n.gameState.time):""}`]},"Can Eat",e+1),new de(t=>(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",T.RUNNING),"Eat",e+1)],"Eating",e)}function Yn(e,t,n){return xu(e,n)?e.tribeRole===t:!0}function xu(e,t){if(!e.leaderId)return!1;const n=t.entities.entities[e.leaderId];return!n||!n.tribeControl?!1:t.search.human.byProperty("leaderId",n.id).filter(s=>s.isAdult).length>=oD}function cM(e){return new Ie([new ge((n,i)=>{if(!!!n.leaderId||!xu(n,i.gameState))return!1;const a=n.id===n.leaderId,l=Yn(n,oe.Warrior,i.gameState)||Yn(n,oe.Hunter,i.gameState),d=!n.isAdult&&(!n.fatherId||!i.gameState.entities.entities[n.fatherId])&&(!n.motherId||!i.gameState.entities.entities[n.motherId]);return a||l||d},"Demand eligible?",e+1),new de((n,i)=>{const s=xt(n,i.gameState);if(!s||!s.aiBlackboard)return[T.NOT_EVALUATED,"No leader for coordination"];if(n.food.length<n.maxFood*.5){lT(s.aiBlackboard,n.id,"food",i.gameState.time);const a=dT(s.aiBlackboard,n.id,"food");if(a&&a.claimedBy){const l=i.gameState.entities.entities[a.claimedBy];if(!l||l.type!=="human")return[T.NOT_EVALUATED,"Supplier not found or invalid"];const d=H(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return d>uR?[T.NOT_EVALUATED,`Supplier too far (${d.toFixed(1)}px), waiting`]:d<=ze?(n.activeAction="retrieving",n.target=l.id,[T.RUNNING,`Retrieving from supplier ${l.id}`]):(n.target=l.id,n.activeAction="moving",[T.RUNNING,`Moving to supplier ${l.id}, distance: ${d.toFixed(1)}`])}return[T.NOT_EVALUATED,"Waiting for supplier"]}return[T.NOT_EVALUATED,"No demand needed"]},"Create Demand",e+1)],"Demand",e)}const jp=400,dM=25;function iv(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function uM(e,t,n=jp){return t.search.building.byRadius(e.position,n).some(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed&&l.storageCapacity&&l.storedItems.length<l.storageCapacity})}function fM(e,t,n=jp,i,s){return t.search.building.byRadius(e.position,n).filter(d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===e.leaderId&&u.isConstructed&&u.storedItems.filter(f=>f.item.itemType==="food").length>0}).filter(d=>{if(i){const u=`tribal_storage_${d.id}`,f=E.get(i,u);if(f&&f.memberIds.length>=Yp&&(!s||!f.memberIds.includes(s)))return!1}return!0})}function hM(e,t,n=jp){return t.search.building.byRadius(e.position,n).filter(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed})}function uT(e,t,n){if(t.length===0)return null;let i=null,s=1/0;for(const a of t){const l=H(e.position,a.position,n.mapDimensions.width,n.mapDimensions.height);l<s&&(s=l,i=a)}return i?{storage:i,distance:s}:null}function fT(e){const t=e.storedItems.length,n=iv(t+e.id)*2*Math.PI,i=iv(t+e.id+1)*dM;return{x:Math.cos(n)*i,y:Math.sin(n)*i}}const ov="FINDING_DEMAND",rv="RETRIEVING_FROM_STORAGE",sv="DELIVERING_TO_DEMANDER",Xd="supply_phase",Xg="supply_targetDemanderId",hT="supply_targetStorageId",Vd="supply_targetResourceType";function Di(e){e.aiBlackboard&&(E.delete(e.aiBlackboard,Xd),E.delete(e.aiBlackboard,Xg),E.delete(e.aiBlackboard,hT),E.delete(e.aiBlackboard,Vd))}function gM(e){return new de((t,n)=>{var a;if(!xu(t,n.gameState))return Di(t),[T.FAILURE,"Tribe roles not effective"];if(!Yn(t,oe.Mover,n.gameState))return Di(t),[T.FAILURE,"Not a Mover"];const i=xt(t,n.gameState);if(!i||!i.aiBlackboard)return Di(t),[T.FAILURE,"No leader or blackboard"];if(!t.aiBlackboard)return[T.FAILURE,"No AI blackboard"];const s=E.get(t.aiBlackboard,Xd)||ov;if(s===ov){const l=tM(i.aiBlackboard).filter(f=>f.requesterId!==t.id);if(l.length===0)return[T.FAILURE,"No unclaimed demands"];const d=l[0];return eM(i.aiBlackboard,d.requesterId,d.resourceType,t.id,n.gameState.time)?(E.set(t.aiBlackboard,Xg,d.requesterId),E.set(t.aiBlackboard,Vd,d.resourceType),E.set(t.aiBlackboard,Xd,rv),[T.RUNNING,`Claimed ${d.resourceType} demand for ${d.requesterId}, moving to retrieval phase`]):(Di(t),[T.FAILURE,"Failed to claim demand"])}if(s===rv){const l=E.get(t.aiBlackboard,Vd),d=l==="food"&&t.food.length>0,u=l==="wood"&&((a=t.heldItem)==null?void 0:a.type)===yt.Wood;if(d||u)return E.set(t.aiBlackboard,Xd,sv),[T.RUNNING,`${l} retrieved, moving to delivery phase`];const f=hM(t,n.gameState,400).filter(v=>l==="food"?v.storedItems.some(I=>I.item.itemType==="food"):l==="wood"?v.storedItems.some(I=>I.item.type===yt.Wood):!1);if(f.length===0)return[T.FAILURE,`No storage with ${l} found nearby`];const g=uT(t,f,n.gameState);if(!g)return Di(t),[T.FAILURE,"Could not find closest storage"];const{storage:m,distance:S}=g;return E.set(t.aiBlackboard,hT,m.id),S<=qt?(t.activeAction="retrieving",t.target=m.id,[T.RUNNING,`Retrieving from storage ${m.id}`]):(t.target=m.id,t.activeAction="moving",[T.RUNNING,`Moving to storage ${m.id}, distance: ${S.toFixed(1)}`])}if(s===sv){const l=E.get(t.aiBlackboard,Vd)||"food",d=E.get(t.aiBlackboard,Xg);if(!d)return Di(t),[T.FAILURE,"Demander ID not found in blackboard"];const u=dT(i.aiBlackboard,d,l);if(!u||u.claimedBy!==t.id)return Di(t),[T.FAILURE,"Demand not found"];const f=n.gameState.entities.entities[d];if(!f)return Di(t),[T.FAILURE,"Demander not found"];if(l==="food"?t.food.length===0:!t.heldItem)return Di(t),[T.SUCCESS,`Successfully delivered ${l} to ${d}`];const m=H(t.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),S=f.type==="building"&&f.buildingType===ce.Bonfire?qt:ze;return m<=S?(t.activeAction="depositing",l==="food"&&(t.activeActionPayload={amount:Math.min(f.maxFood/2||1,t.food.length||1)}),t.target=f.id,[T.RUNNING,`Delivering to demander ${f.id}`]):(t.target=f.id,t.activeAction="moving",[T.RUNNING,`Moving to demander ${f.id}, distance: ${m.toFixed(1)}`])}return Di(t),[T.FAILURE,"Unknown supply phase"]},"Supply",e)}function pM(e){return new Ie([new ge((t,n,i)=>{if(t.isAdult&&t.hitpoints>t.maxHitpoints*ou||!(t.hitpoints<t.maxHitpoints*.1)&&t.isAdult&&t.hunger>wR)return!1;const a=eI(t.id,n.gameState);return a?(E.set(i,"fleeThreat",a.id),!0):!1},"Should Flee",e+1),new de((t,n,i)=>{const s=E.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;t.activeAction="moving";const l=Xe(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=ot(l),u=oi(t.position,At(d,Bg));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=d,T.RUNNING},"Execute Flee",e+1)],"Flee",e)}const Er="resourceSource";function mM(e){const t=new de((i,s,a)=>{const l=xt(i,s.gameState),d=l?zl(l.id,s.gameState):0,u=i.hunger>ES,f=Mn(s.gameState,i).filter(A=>A.hunger>ra),g=u||f.length>0,m=Yn(i,oe.Gatherer,s.gameState),S=()=>{const A=Be(i,s.gameState,"berryBush",Xh,R=>{if(R.food.length===0||i.leaderId&&!Wn(R.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const P=`tribal_gather_${R.id}`,w=E.get(l.aiBlackboard,P);if(w&&s.gameState.time-w.startTime<=Fi&&!w.memberIds.includes(i.id))return!1}return!0}),_=Be(i,s.gameState,"corpse",Xh,R=>{if(R.food.length===0||i.leaderId&&!Wn(R.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const P=`tribal_gather_${R.id}`,w=E.get(l.aiBlackboard,P);if(w&&s.gameState.time-w.startTime<=Fi&&!w.memberIds.includes(i.id))return!1}return!0});if(A&&_){const R=H(i.position,A.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height),P=H(i.position,_.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);return R<=P?A:_}return A||_},v=()=>Be(i,s.gameState,"tree",Xh,A=>{if(A.stateMachine[0]!==Gt||A.wood.length===0||i.leaderId&&!Wn(A.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const _=`tribal_gather_${A.id}`,R=E.get(l.aiBlackboard,_);if(R&&s.gameState.time-R.startTime<=Fi&&!R.memberIds.includes(i.id))return!1}return!0});let I=null;return g&&i.food.length<i.maxFood?I=S():d>0&&!i.heldItem?I=v():m&&(i.heldItem||(I=v()),!I&&i.food.length<i.maxFood&&(I=S())),I?(E.set(a,Er,I.id),[T.SUCCESS,`Found ${I.type}: ${I.id} at ${I.position.x.toFixed(0)},${I.position.y.toFixed(0)}`]):[T.FAILURE,"No resource found"]},"Find Closest Resource Source",e+4),n=new Hi(new de((i,s,a)=>{const l=E.get(a,Er);if(!l)return[T.FAILURE,"No target in blackboard"];const d=s.gameState.entities.entities[l];return d?(d.type==="tree"&&"wood"in d?d.wood.length===0:d.food.length===0)?(E.delete(a,Er),[T.FAILURE,"Resource source is depleted"]):H(i.position,d.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Yr?(i.activeAction="gathering",i.direction={x:0,y:0},i.target=d.id,E.delete(a,Er),[T.SUCCESS,`Gathering from ${d.type}`]):(i.activeAction="moving",i.target=d.id,i.direction=$e(i.position,d.position,s.gameState.mapDimensions),[T.RUNNING,`Moving to ${d.type}`]):(E.delete(a,Er),[T.FAILURE,"Resource source is invalid"])},"Move To Resource and Gather",e+3),{taskType:"gather",maxCapacity:2,getTargetId:(i,s,a)=>E.get(a,Er)??null},"Tribal Gather Task",e+3);return new Ie([new ge((i,s)=>{const a=xt(i,s.gameState),l=a?zl(a.id,s.gameState):0,d=i.food.length<i.maxFood,u=!i.heldItem,f=i.hunger>ES,g=Mn(s.gameState,i).filter(A=>A.hunger>ra),m=Yn(i,oe.Gatherer,s.gameState),S=uM(i,s.gameState),v=d&&(f||g.length>0||m&&S),I=u&&(l>0||m&&S);return[(i.isAdult&&(v||I))??!1,`${f?"Hungry ":""}${g.length>0?"Children("+g.length+") ":""}${l>0?"WoodNeed("+l+") ":""}${I&&l<=0?"Wood ":""}${S?"Storage":""}`]},"Should Gather Resources",e+1),new cn([new Ie([new ge((i,s,a)=>E.has(a,Er),"Has Resource Source?",e+2),n],"Continue Gathering Action",e+2),new Ie([new $n(t,MR,"Cache Resource Source Search",e+3),n],"Find New Resource Source and Gather",e+2)],"Perform or Start Gathering",e+1)],"Gather Resources",e)}const yM=.5;function SM(e){return new de((t,n,i)=>{const{gameState:s}=n,{width:a,height:l}=s.mapDimensions;let d=E.get(i,"wanderTarget");const u=E.get(i,"lastWanderTime")??0,f=s.time;if(!d||f-u>yM||H(t.position,d,a,l)<20){const m=Cp(t.position,TR,a,l);t.leaderId?Hg(m,t.leaderId,s)?d=m:d=l1(t.position,m,t.leaderId,s):d=m,E.set(i,"wanderTarget",d),E.set(i,"lastWanderTime",f)}if(d&&H(t.position,d,a,l)>10){t.activeAction="moving",t.target=d;let S=d.x-t.position.x,v=d.y-t.position.y;return Math.abs(S)>a/2&&(S=S>0?S-a:S+a),Math.abs(v)>l/2&&(v=v>0?v-l:v+l),t.direction=ot({x:S,y:v}),T.RUNNING}return t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,T.SUCCESS},"Idle/Wander",e)}const _d="procreationWanderStartTime",av=(e,t,n)=>t.find(i=>or(e,i,n)),lv={taskType:"procreation",maxCapacity:2,getTargetId:(e,t,n)=>E.get(n,"procreationPartner")??null};function vM(e){const t=new ge((a,l,d)=>{const u=$S(a,l.gameState,Yr),f=av(a,u,l.gameState);return f?(E.set(d,"procreationPartner",f.id),!0):[!1,"No immediate partner found"]},"Find Immediate Partner"),n=new Hi(new de((a,l,d)=>{var g;const u=E.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=void 0,E.delete(d,"procreationPartner"),E.delete(d,_d),(g=a.partnerIds)!=null&&g.includes(f.id)||(a.partnerIds=a.partnerIds?[...a.partnerIds,f.id]:[f.id]),T.SUCCESS):T.FAILURE},"Start Procreating"),lv,"Tribal Start Procreating",e+2),i=new ge((a,l,d)=>{const u=$S(a,l.gameState,_R),f=av(a,u,l.gameState);return f?(E.set(d,"procreationPartner",f.id),!0):[!1,"No distant partner found"]},"Locate Distant Partner"),s=new Hi(new de((a,l,d)=>{const u=E.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return[T.FAILURE,"No partner found"];if(f.isPregnant)return[T.FAILURE,"Partner is pregnant"];if(a.hunger>an)return[T.FAILURE,"Too hungry to procreate"];const g=H(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);if(g<Yr)return[T.SUCCESS,"Reached partner"];if(a.leaderId&&!Wn(f.position,a.leaderId,l.gameState))return[T.FAILURE,"Partner out of operating range"];a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),[T.RUNNING,`${g.toFixed(1)} units away`]},"Move Towards Partner"),lv,"Tribal Move To Partner",e+3);return new Ie([new ge(a=>!a.isAdult||a.gender==="female"&&a.isPregnant?[!1,"Not adult or pregnant"]:a.age<$l||a.gender==="female"&&a.age>wu?[!1,"Not fertile due to age or pregnancy status"]:a.hunger>=an?[!1,"Too hungry"]:!0,"Is Fertile (age, not pregnant)",e+1),new ge(a=>a.hunger<an,"Is Healthy (hunger)",e+1),new ge(a=>(a.procreationCooldown||0)<=0,"Is Ready (cooldown)",e+1),new cn([new Ie([new ge((a,l)=>{const d=DS(a.position,l.gameState,"berryBush",CS);return[d>=CR,`Found ${d} bushes`]},"Is Environment Viable (food)",e+3),new de((a,l,d)=>(E.delete(d,_d),T.SUCCESS),"Clear Wander Timer",e+3)],"Sufficient Food Path",e+2),new Ie([new ge((a,l)=>{const d=Mn(l.gameState,a);return jr(d)?[!1,"Has an heir"]:!0},"Is Male Without Heir",e+3),new de((a,l,d)=>{const u=E.get(d,_d);if(u===void 0)return E.set(d,_d,l.gameState.time),[T.FAILURE,"Starting heirless wander timer"];const f=l.gameState.time-u;return f>=jw?DS(a.position,l.gameState,"berryBush",CS)>=1?[T.SUCCESS,`Wandered for ${f.toFixed(1)}h, minimum food found`]:[T.FAILURE,"Desperate but no food sources nearby"]:[T.FAILURE,`Wandering for heir, ${f.toFixed(1)}h elapsed`]},"Check Wander Timer",e+3)],"Heirless Desperation Path",e+2)],"Check Environment Or Desperation",e+1),new ge((a,l,d)=>{var f;const u=E.get(d,"procreationPartner");return u&&((f=u.partnerIds)!=null&&f.length)&&!u.partnerIds.includes(a.id)&&a.leaderId!==a.id&&a.leaderId&&u.partnerIds.map(g=>l.gameState.entities.entities[g]).filter(g=>!!g).some(g=>H(a.position,g.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<xR)?[!1,"Partner's primary partner is too close"]:!0},"Is Partner's Primary Partner Nearby",e+1),new cn([new Ie([t,n],"Procreate With Immediate Partner",e+2),new va(DR,new Ie([i,s,n],"Seek Distant Partner Action",e+3),"Seek Distant Partner Cooldown",e+2)],"Find Partner And Procreate",e+1)],"Procreate",e)}const ws="attackTarget",Cr="homeCenter",cg=150;function AM(e){return new Ie([new ge((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.hitpoints>0&&H(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=cg){if(E.set(i,ws,l.id),!E.get(i,Cr)){const d=t.leaderId?vn(t.leaderId,s):Yl(t,s).length>0?TS(t,s):t.position;E.set(i,Cr,d)}return!0}}if(!Yn(t,oe.Warrior,s))return[!1,"Not a Warrior"];const a=Be(t,s,"human",cg,l=>l.hitpoints>0&&qr(t,l,s));if(a){E.set(i,ws,a.id);const l=t.leaderId?vn(t.leaderId,s):Yl(t,s).length>0?TS(t,s):t.position;return E.set(i,Cr,l),!0}return E.set(i,ws,void 0),E.set(i,Cr,void 0),!1},"Find Attack Target",e+1),new de((t,n,i)=>{const s=E.get(i,ws),a=s&&n.gameState.entities.entities[s],l=E.get(i,Cr);if(!a||!l)return T.FAILURE;const{gameState:d}=n;return H(t.position,l,d.mapDimensions.width,d.mapDimensions.height)>UA?(t.activeAction="idle",t.attackTargetId=void 0,E.set(i,ws,void 0),E.set(i,Cr,void 0),T.FAILURE):a.hitpoints<=0||H(t.position,a.position,d.mapDimensions.width,d.mapDimensions.height)>cg?(t.activeAction==="attacking"&&(t.activeAction="idle",t.attackTargetId=void 0),E.set(i,ws,void 0),E.set(i,Cr,void 0),T.SUCCESS):(t.activeAction==="attacking"&&t.attackTargetId===a.id||(t.activeAction="attacking",t.attackTargetId=a.id),T.RUNNING)},"Execute Attack",e+1)],"Attack",e)}const IM=(e,t,n)=>{const i=Mn(t.gameState,e).filter(l=>!l.isAdult);if(i.length===0)return T.FAILURE;let s=null,a=ra;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(E.set(n,"targetChild",s.id),T.SUCCESS):T.FAILURE},TM=(e,t,n)=>{const i=E.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?H(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>Ru?(e.activeAction="moving",e.target=s.id,e.direction=$e(e.position,s.position,t.gameState.mapDimensions),T.RUNNING):(e.activeAction="feeding",e.target=void 0,E.set(n,"targetChild",void 0),T.SUCCESS):T.FAILURE};function EM(e){return new Ie([new ge(t=>(t.isAdult&&t.food.length>0&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child",e+1),new de(IM,"Find Hungriest Child",e+1),new de(TM,"Move To Child and Feed",e+1)],"Feed Child",e)}function CM(e){return new Ie([new ge(t=>!t.isAdult&&t.hunger>=ra,"Is Hungry Child",e+1),new de((t,n,i)=>{const s=PP(t,n.gameState);if(s.length===0)return T.FAILURE;const a=Be(t,n.gameState,"human",Zw,l=>s.some(d=>d.id===l.id)&&l.food.length>0);return a?(E.set(i,"targetParent",a.id),T.SUCCESS):T.FAILURE},"Find Parent With Food",e+1),new de((t,n,i)=>{const s=E.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const l=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=Ru?(t.target=void 0,T.SUCCESS):(t.target=a.id,t.activeAction="moving",T.RUNNING)},"Move To Parent",e+1)],"Seek Food From Parent",e)}const _r="plantingSpot",Rs="plantingZoneId",_M=50;function wM(e,t,n,i){const s=Xe(e,t,n,i);return oi(e,s)}function RM(e){const t=new de((s,a,l)=>{const d=E.get(l,_r);if(!d)return E.delete(l,_r),E.delete(l,Rs),[T.FAILURE,"Planting spot is missing"];if(Ui(a.gameState.soilDepletion,d,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height))return E.delete(l,_r),E.delete(l,Rs),[T.FAILURE,"Soil is depleted at planting spot"];if(zn(d,a.gameState,Qo,s.id))return E.delete(l,_r),E.delete(l,Rs),[T.FAILURE,"Planting spot is occupied"];const u=wM(s.position,d,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height),f=H(s.position,u,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height);return f>Yr?(s.activeAction="moving",s.target=u,s.direction=$e(s.position,u,a.gameState.mapDimensions),[T.RUNNING,"Moving to planting spot: "+f.toFixed(2)+" units away"]):zn(d,a.gameState,Qo,s.id)?(E.delete(l,_r),E.delete(l,Rs),[T.FAILURE,"Planting spot is now occupied"]):(s.activeAction="planting",s.target=d,[T.RUNNING,"Planting state initiated"])},"Move To Spot and Plant",e+4),n=new Hi(t,{taskType:"plant",maxCapacity:2,proximityRadius:_M,getTargetId:(s,a,l)=>E.get(l,Rs)??null},"Coordinated Planting",e+3),i=new de((s,a,l)=>{const d=$P(s,a.gameState);return d?(E.set(l,_r,d.position),E.set(l,Rs,d.zoneId),[T.SUCCESS,`Found new spot at ${d.position.x.toFixed(0)}, ${d.position.y.toFixed(0)} (Zone ${d.zoneId})`]):[T.FAILURE,"No suitable planting spot found"]},"Find Optimal Planting Spot",e+3);return new Ie([new ge((s,a)=>{if(!Yn(s,oe.Planter,a.gameState))return[!1,"Not a Planter"];const l=s.food.filter(f=>f.type===In.Berry).length>=fo,d=s.hunger<vR,u=(s.isAdult&&l&&d)??!1;return[u,u?"Can plant":`Cannot plant: adult=${s.isAdult}, berries=${s.food.filter(f=>f.type===In.Berry).length}/${fo}, hunger=${s.hunger.toFixed(0)}`]},"Can Plant",e+1),new ge((s,a)=>{if(!s.leaderId)return[!1,"No tribe"];const l=BP(s,a.gameState),{count:d,ratio:u}=wI(s.leaderId,a.gameState);let f;return l<GA?f=YR:l<$A?f=zR:l<xA?f=jR:f=XR,[u<f||d<=Hs,`Food security: ${(l*100).toFixed(0)}%, Bush density: ${u.toFixed(1)}/${f}`]},"Needs More Bushes (Adaptive)",e+1),new ge((s,a)=>{if(!s.leaderId)return[!0,"No tribe coordination needed"];const l=jn(s,a.gameState),d=NI(s.leaderId,a.gameState,"planting"),u=Math.max(1,Math.ceil(l.length*.3));return[d<u,`Active planters: ${d}/${u}`]},"Not Too Many Planters",e+1),new cn([new Ie([new ge((s,a,l)=>E.has(l,_r),"Has Planting Spot?",e+2),n],"Continue Planting Action",e+2),new va(NR,i,"Find Planting Spot Cooldown",e+2)],"Perform or Start Planting",e+1)],"Plant Bush",e)}const cv="lastDepositTime",Ps="assignedStorageSpot";function PM(e){return new cn([new Ie([new ge((t,n,i)=>{var d;const s=((d=t.heldItem)==null?void 0:d.type)===yt.Wood;if(!t.isAdult)return[!1,"Not an adult"];if(!t.leaderId)return[!1,"No tribe"];let a=null,l="";if(s)a=GP(t,n.gameState),l=`Holding wood${a?` (Target: ${a.id})`:""}`;else{if(!Yn(t,oe.Gatherer,n.gameState)&&!Yn(t,oe.Mover,n.gameState)&&!Yn(t,oe.Hunter,n.gameState))return[!1,"Not a Gatherer/Mover/Hunter and not holding wood"];const u=E.get(i,cv)||0,f=n.gameState.time-u;if(f<_S)return[!1,`Cooldown: ${(_S-f).toFixed(1)}h remaining`];const g=CI(t.leaderId,n.gameState);let m;g<.3?m=VR:g<.7?m=KR:m=qR;const S=t.food.length/t.maxFood;if(S<=m)return[!1,`Food ${(S*100).toFixed(0)}% < threshold ${(m*100).toFixed(0)}%`];a=DI(t,n.gameState),l=`Storage util: ${(g*100).toFixed(0)}%, Personal: ${(S*100).toFixed(0)}%`}return a?(E.set(i,Ps,a.id),[!0,l]):[!1,"No available tribe storage nearby"]},"Check for Excess Food and Storage",e+1),new ge((t,n)=>{if(!t.leaderId)return[!0,"No tribe coordination needed"];const i=NI(t.leaderId,n.gameState,"depositing"),s=jn(t,n.gameState),a=ua(t.leaderId,n.gameState).length,l=Math.max(2,Math.ceil(s.length*.4)+a);return[i<l,`Active depositors: ${i}/${l}`]},"Not Too Many Depositors",e+1),new Hi(new de((t,n,i)=>{var d,u;const s=E.get(i,Ps);if(!s)return[T.FAILURE,"No storage assigned"];const a=n.gameState.entities.entities[s];if(!a)return E.delete(i,Ps),[T.FAILURE,"Storage entity missing"];if((((d=a.storedItems)==null?void 0:d.length)??0)>=(a.storageCapacity??0))return E.delete(i,Ps),[T.FAILURE,"Storage full"];const l=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l<=qt){t.activeAction="depositing",t.target=void 0,E.set(i,cv,n.gameState.time),E.delete(i,Ps);const f=((u=t.heldItem)==null?void 0:u.type)===yt.Wood;return[T.SUCCESS,f?"Depositing wood":"Depositing food"]}return t.activeAction="moving",t.target=a.position,[T.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`]},"Navigate to Storage and Deposit",e+2),{taskType:"storage",maxCapacity:Yp,storageAction:"deposit",getTargetId:(t,n,i)=>E.get(i,Ps)??null},"Tribal Storage Deposit Task",e+1)],"Deposit Sequence",e)],"Storage Deposit Behavior",e)}const wd="retrievalStorageId";function DM(e){return new cn([new Ie([new ge((t,n,i)=>{if(t.hunger<=la)return[!1,"Not hungry enough"];if(t.food.length>=t.maxFood)return[!1,"Inventory full"];const s=xt(t,n.gameState),a=fM(t,n.gameState,void 0,s==null?void 0:s.aiBlackboard,t.id),l=uT(t,a,n.gameState),d=l==null?void 0:l.storage;return d?(E.set(i,wd,d.id),[!0,`Storage with food found at distance ${l.distance.toFixed(1)}`]):[!1,"No tribe storage with food nearby"]},"Check for Hunger and Storage Food",e+1),new Hi(new de((t,n,i)=>{const s=E.get(i,wd);if(!s)return[T.FAILURE,"No storage target"];const a=n.gameState.entities.entities[s];if(!a)return E.delete(i,wd),[T.FAILURE,"Storage not found"];const l=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=qt?(t.activeAction="retrieving",t.target=void 0,[T.SUCCESS,"Retrieving food"]):(t.activeAction="moving",t.target=a.position,[T.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`])},"Navigate to Storage and Retrieve",e+2),{taskType:"storage",maxCapacity:Yp,storageAction:"retrieve",getTargetId:(t,n,i)=>E.get(i,wd)??null},"Coordinated Storage Retrieve",e+1)],"Retrieve Sequence",e)],"Storage Retrieve Behavior",e)}const dg="combatTarget",ug="homeCenter";function NM(e){const t=new ge(a=>a.isAdult&&a.leaderId?a.id!==a.leaderId:!1,"Is Tribe Follower?",e+1),n=new ge(a=>a.hunger<AR&&a.hitpoints>=a.maxHitpoints*ou,"Is Fit for Combat?",e+1),i=new de((a,l,d)=>{const{gameState:u}=l,f=u.entities.entities[a.leaderId];if(!f)return T.FAILURE;const g=ZP(f,u,RR);if(g.length===0)return T.FAILURE;g.sort((m,S)=>{const v=H(a.position,m.position,u.mapDimensions.width,u.mapDimensions.height),I=H(a.position,S.position,u.mapDimensions.width,u.mapDimensions.height);return v-I});for(const m of g)if(QP(f.id,m.id,u)<LA){E.set(d,dg,m.id);const v=vn(f.id,u);return E.set(d,ug,v),T.SUCCESS}return T.FAILURE},"Find Best Target",e+1),s=new de((a,l,d)=>{const u=E.get(d,dg),f=u&&l.gameState.entities.entities[u],g=E.get(d,ug);if(!f||!g)return T.FAILURE;const{gameState:m}=l;return H(a.position,g,m.mapDimensions.width,m.mapDimensions.height)>UA?(a.activeAction==="attacking"&&a.attackTargetId===f.id&&(a.activeAction="idle",a.attackTargetId=void 0),E.set(d,dg,void 0),E.set(d,ug,void 0),T.FAILURE):((!a.lastTargetAcquiredEffectTime||l.gameState.time-a.lastTargetAcquiredEffectTime>Ke*5)&&(Ge(l.gameState,Ce.TargetAcquired,a.position,Ke,a.id),a.lastTargetAcquiredEffectTime=l.gameState.time),a.activeAction="attacking",a.attackTargetId=f.id,a.target=void 0,T.RUNNING)},"Attack Target",e+1);return new Ie([t,n,i,s],"Tribe Member Combat",e)}function MM(e){const t=new ge((N,D)=>!N.leaderId||N.leaderId!==N.id?[!1,"Not a tribe leader"]:Mn(D.gameState,N).length<kp?[!1,"Leader has no children"]:[!0,"Is tribe leader"],"Is Leader",e+1),n=new de((N,D,M)=>{const k=jn(N,D.gameState),U=k.filter(Y=>Y.isAdult),j=ma(N.leaderId,D.gameState,!0),K=ku(N,D.gameState,!0).filter(Y=>RI(Y,D.gameState)),X=CI(N.leaderId,D.gameState),{count:J,ratio:Z}=wI(N.leaderId,D.gameState),le=K.length/Math.max(1,k.length),re=Math.ceil(U.length*(1+QR)),te=ua(N.leaderId,D.gameState,!0);return E.set(M,"tribeAnalysis_adultCount",U.length),E.set(M,"tribeAnalysis_existingStorageSpots",j.length),E.set(M,"tribeAnalysis_existingPlantingZones",K.length),E.set(M,"tribeAnalysis_existingBonfires",te.length),E.set(M,"tribeAnalysis_storageUtilization",X),E.set(M,"tribeAnalysis_bushCount",J),E.set(M,"tribeAnalysis_bushDensity",Z),E.set(M,"tribeAnalysis_zoneDensity",le),E.set(M,"tribeAnalysis_projectedAdultCount",re),[T.SUCCESS,`Analyzed tribe: ${U.length} adults, ${j.length} storage, ${K.length} viable planting zones, ${te.length} bonfires`]},"Analyze Tribe",e+1),i=new $n(n,1,"Cached Tribe Analysis",e+1),s=new ge((N,D,M)=>{const k=E.get(M,"tribeAnalysis_adultCount");return k===void 0?[!1,"No tribe analysis available"]:k<wS?[!1,`Tribe too small: ${k}/${wS} adults`]:[!0,`Tribe size sufficient: ${k} adults`]},"Has Minimum Tribe Size",e+1),a=new ge((N,D,M)=>{if(E.has(M,"buildingPlacement_storageTarget"))return[!0,"Placement already in progress"];const k=E.get(M,"tribeAnalysis_adultCount"),U=E.get(M,"tribeAnalysis_existingStorageSpots"),j=E.get(M,"tribeAnalysis_storageUtilization"),K=E.get(M,"tribeAnalysis_projectedAdultCount");if(k===void 0||U===void 0||j===void 0||K===void 0)return[!1,"No tribe analysis available"];const X=U===0,J=j*(K/Math.max(1,k));return X||j>Fg||J>Fg?[!0,X?"Bootstrap: First storage spot":`Utilization: ${(j*100).toFixed(0)}% (projected: ${(J*100).toFixed(0)}%)`]:[!1,`Storage adequate: ${U}, util: ${(j*100).toFixed(0)}%`]},"Needs Storage",e+2),l=new de((N,D,M)=>{if(E.has(M,"buildingPlacement_storageTarget"))return[T.SUCCESS,"Using existing storage placement target"];const k=E.get(M,"tribeAnalysis_existingStorageSpots");if(k===void 0)return[T.FAILURE,"No tribe analysis available"];const j=k===0?WA:Ks,K=qs(ce.StorageSpot,N.id,D.gameState,eo,j,N.position);return K?(E.set(M,"buildingPlacement_storageTarget",K),[T.SUCCESS,`Found storage location at (${K.x.toFixed(0)}, ${K.y.toFixed(0)})`]):[T.FAILURE,`No valid location found for storage within ${eo}px`]},"Find Storage Location",e+2),d=new de((N,D,M)=>{const k=E.get(M,"buildingPlacement_storageTarget");if(!k)return[T.FAILURE,"No target location in blackboard"];const U=H(N.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U<=to?[T.SUCCESS,`Reached storage location (${U.toFixed(0)}px away)`]:(N.activeAction="moving",N.target=k,N.direction=$e(N.position,k,D.gameState.mapDimensions),[T.RUNNING,`Moving to storage location (${U.toFixed(0)}px away)`])},"Move To Storage Location",e+2),u=new de((N,D,M)=>{const k=E.get(M,"buildingPlacement_storageTarget");if(!k)return[T.FAILURE,"No target location in blackboard"];const U=H(N.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U>to?[T.FAILURE,`Too far from placement location: ${U.toFixed(0)}px`]:(qo(k,ce.StorageSpot,N.id,D.gameState),E.delete(M,"buildingPlacement_storageTarget"),E.delete(M,"caching_Cached Tribe Analysis_status"),E.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[T.SUCCESS,`Placed storage at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`])},"Place Storage",e+2),f=new Ie([a,l,d,u],"Storage Sequence",e+1),g=new ge((N,D,M)=>{if(!N.leaderId)return[!1,"No tribe"];if(E.has(M,"buildingPlacement_bonfireTarget"))return[!0,"Placement already in progress"];const k=E.get(M,"tribeAnalysis_existingBonfires")||0,U=E.get(M,"tribeAnalysis_adultCount")||0,j=vn(N.leaderId,D.gameState),K=nr(D.gameState.temperature,j,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height),X=K<oI&&k===0,J=k>0&&k<Math.ceil(U/rI),Z=jn(N,D.gameState),le=ua(N.leaderId,D.gameState,!0),re=Z.filter(Y=>nr(D.gameState.temperature,Y.position,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)<co+5?le.every(z=>H(Y.position,z.position,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)>Fr*1.5):!1),te=re.length>=3;if(X||J||te){if(te){const V=re.reduce((q,F)=>({x:q.x+F.position.x,y:q.y+F.position.y}),{x:0,y:0});V.x/=re.length,V.y/=re.length,E.set(M,"buildingPlacement_coldClusterPos",V)}else E.delete(M,"buildingPlacement_coldClusterPos");let Y="";return X?Y=`Cold at center: ${K.toFixed(1)}C`:J?Y=`Tribe size: ${U}/${k} fires`:Y=`Cold cluster: ${re.length} members`,[!0,Y]}return[!1,`Adequate heating: ${k} fires for ${U} adults`]},"Needs Bonfire",e+2),m=new de((N,D,M)=>{if(E.has(M,"buildingPlacement_bonfireTarget"))return[T.SUCCESS,"Using existing bonfire placement target"];const k=E.get(M,"buildingPlacement_coldClusterPos"),U=qs(ce.Bonfire,N.id,D.gameState,eo,Ks,k||N.position);return U?(E.set(M,"buildingPlacement_bonfireTarget",U),[T.SUCCESS,`Found bonfire location at (${U.x.toFixed(0)}, ${U.y.toFixed(0)})`]):[T.FAILURE,`No valid location found for bonfire within ${eo}px`]},"Find Bonfire Location",e+2),S=new de((N,D,M)=>{const k=E.get(M,"buildingPlacement_bonfireTarget");if(!k)return[T.FAILURE,"No target location in blackboard"];const U=H(N.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U<=to?[T.SUCCESS,`Reached bonfire location (${U.toFixed(0)}px away)`]:(N.activeAction="moving",N.target=k,N.direction=$e(N.position,k,D.gameState.mapDimensions),[T.RUNNING,`Moving to bonfire location (${U.toFixed(0)}px away)`])},"Move To Bonfire Location",e+2),v=new de((N,D,M)=>{const k=E.get(M,"buildingPlacement_bonfireTarget");if(!k)return[T.FAILURE,"No target location in blackboard"];const U=H(N.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U>to?[T.FAILURE,`Too far from placement location: ${U.toFixed(0)}px`]:(qo(k,ce.Bonfire,N.id,D.gameState),E.delete(M,"buildingPlacement_bonfireTarget"),E.delete(M,"caching_Cached Tribe Analysis_status"),E.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[T.SUCCESS,`Placed bonfire at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`])},"Place Bonfire",e+2),I=new Ie([g,m,S,v],"Bonfire Sequence",e+1),A=new ge((N,D,M)=>{if(E.has(M,"buildingPlacement_plantingTarget"))return[!0,"Placement already in progress"];const k=E.get(M,"tribeAnalysis_adultCount"),U=E.get(M,"tribeAnalysis_existingPlantingZones"),j=E.get(M,"tribeAnalysis_bushDensity"),K=E.get(M,"tribeAnalysis_bushCount"),X=E.get(M,"tribeAnalysis_zoneDensity"),J=E.get(M,"tribeAnalysis_projectedAdultCount");if(k===void 0||U===void 0||j===void 0||K===void 0||X===void 0||J===void 0)return[!1,"No tribe analysis available"];const Z=j*(k/Math.max(1,J)),re=U===0||j<Lg||Z<Lg||K<=Hs&&U<=Hs;return re&&X>Z&&(K>Hs||U>Hs)?[!1,`Planting zone density (${X.toFixed(2)}) exceeds projected density (${Z.toFixed(2)})`]:re?[!0,`Low bush density: ${j.toFixed(1)}, count: ${K}/${U} (projected: ${Z.toFixed(1)})`]:[!1,`Planting zones adequate: ${U}, density: ${j.toFixed(1)}`]},"Needs Planting Zone",e+2),_=new de((N,D,M)=>{if(E.has(M,"buildingPlacement_plantingTarget"))return[T.SUCCESS,"Using existing planting zone placement target"];const k=qs(ce.PlantingZone,N.id,D.gameState,eo,Ks,N.position);return k?(E.set(M,"buildingPlacement_plantingTarget",k),[T.SUCCESS,`Found planting zone location at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`]):[T.FAILURE,`No valid location found for planting zone within ${eo}px`]},"Find Planting Zone Location",e+2),R=new de((N,D,M)=>{const k=E.get(M,"buildingPlacement_plantingTarget");if(!k)return[T.FAILURE,"No target location in blackboard"];const U=H(N.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U<=to?[T.SUCCESS,`Reached planting zone location (${U.toFixed(0)}px away)`]:(N.activeAction="moving",N.target=k,N.direction=$e(N.position,k,D.gameState.mapDimensions),[T.RUNNING,`Moving to planting zone location (${U.toFixed(0)}px away)`])},"Move To Planting Zone Location",e+2),P=new de((N,D,M)=>{const k=E.get(M,"buildingPlacement_plantingTarget");if(!k)return[T.FAILURE,"No target location in blackboard"];const U=H(N.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U>to?[T.FAILURE,`Too far from placement location: ${U.toFixed(0)}px`]:(qo(k,ce.PlantingZone,N.id,D.gameState),E.delete(M,"buildingPlacement_plantingTarget"),E.delete(M,"caching_Cached Tribe Analysis_status"),E.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[T.SUCCESS,`Placed planting zone at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`])},"Place Planting Zone",e+2),w=new Ie([A,_,R,P],"Planting Zone Sequence",e+1),b=new cn([f,I,w],"Building Type Selector",e+1);return new Ie([t,i,s,b],"Leader Building Placement",e)}const Fo="takeOverBuildingTarget";function OM(e){const t=new Ie([new ge((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=E.get(s,Fo);if(a){const d=i.gameState.entities.entities[a];if(d&&d.type==="building"&&Vt(n,d,i.gameState))return[!0,`Continuing to target building ${a}`];E.delete(s,Fo)}const l=Be(n,i.gameState,"building",zA,d=>Vt(n,d,i.gameState)&&d.isConstructed);return l?(E.set(s,Fo,l.id),[!0,`Found enemy building at distance ${H(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Take Over",e+2),new de((n,i,s)=>{const a=E.get(s,Fo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(E.delete(s,Fo),n.activeAction="idle",n.target=void 0,T.FAILURE):H(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<ze?(n.activeAction="idle",n.target=void 0,T.SUCCESS):(n.activeAction="moving",n.target=l.id,T.RUNNING)},"Move to Enemy Building",e+2),new de((n,i,s)=>{const a=E.get(s,Fo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(E.delete(s,Fo),T.FAILURE):(n.activeAction="takingOverBuilding",n.target=l.id,E.delete(s,Fo),T.SUCCESS)},"Initiate Building Takeover",e+2)],"Take Over Building Action",e+1);return new va(YA,t,"Take Over Building Cooldown",e)}const dv=2,bM=40,uv=3;function kM(e){const t=new ge(a=>{if(!a.isAdult)return[!1,"Not an adult"];if(a.hunger>pp)return[!1,`Too hungry (${a.hunger.toFixed(1)})`];const l=a.leaderId===a.id,d=a.tribeRole===oe.Warrior;return!l&&!d?[!1,`Not a Warrior or Leader (role: ${a.tribeRole||"none"})`]:[!0,l?"Is Leader":"Is Warrior"]},"Is Warrior or Leader",e+1),n=new ge(a=>{var d,u;if(a.leaderId!==a.id)return[!0,"Warrior follows leader strategy"];const l=((u=(d=a.tribeControl)==null?void 0:d.armyControl)==null?void 0:u.expandBorders)??0;return l<dv?[!1,`Expand borders weight too low: ${l}/${dv}`]:[!0,`Expand borders weight: ${l}`]},"Has Expand Borders Weight",e+1),i=new ge((a,l)=>{if(!a.leaderId)return[!1,"No tribe leader"];const u=l.gameState.search.building.byProperty("ownerId",a.leaderId);return u.length===0?[!1,"No territory to expand"]:[!0,`Tribe has ${u.length} buildings`]},"Has Territory",e+1),s=new de((a,l,d)=>{if(!a.leaderId)return[T.FAILURE,"No leader"];const u=l.gameState,f=u.mapDimensions.width,g=u.mapDimensions.height,m=c1(a.position,a.leaderId,u);if(!m)return[T.FAILURE,"Could not find territory edge"];const S=H(a.position,m,f,g);if(S>bM)return a.activeAction="moving",a.target=m,[T.RUNNING,`Approaching territory edge (${S.toFixed(0)}px)`];const I=u.search.building.byProperty("ownerId",a.leaderId),A=Zd(I.map(k=>k.position));E.get(d,"pioneerOrbitDirection")===void 0&&E.set(d,"pioneerOrbitDirection",1);const _=Math.ceil(f/Re),R=Math.ceil(g/Re),P=XA(a.position),w=[];for(let k=-3;k<=uv;k++)for(let U=-3;U<=uv;U++){if(U===0&&k===0)continue;const j=((P.x+U)%_+_)%_,K=((P.y+k)%R+R)%R,X=K*_+j,J=u.terrainOwnership[X],Z=J!==null&&Gi(a.leaderId,J,u);if(J!==null&&!Z)continue;const le={x:j*Re+Re/2,y:K*Re+Re/2};qA(le,a.leaderId,u,ip,!0,a.leaderId).canPlace&&w.push({pos:le,gx:j,gy:K})}if(w.length===0)return E.set(d,"pioneerOrbitDirection",-E.get(d,"pioneerOrbitDirection")),[T.RUNNING,"Blocked, reversing orbit direction"];const b=ot(Xe(A,a.position,f,g)),N=Eg(b,E.get(d,"pioneerOrbitDirection")*(Math.PI/2));let D=w[0],M=-1/0;for(const k of w){let U=0;for(let re=-1;re<=1;re++)for(let te=-1;te<=1;te++){if(te===0&&re===0)continue;const Y=((k.gx+te)%_+_)%_,V=((k.gy+re)%R+R)%R;u.terrainOwnership[V*_+Y]===a.leaderId&&U++}const j=ot(Xe(a.position,k.pos,f,g)),K=zv(j,N),X=H(A,k.pos,f,g),J=H(A,a.position,f,g),Z=X>J?1:0,le=U*2+K*1.5+Z*.5;le>M&&(M=le,D=k)}return qo(a.position,ce.BorderPost,a.leaderId,u),a.target=D.pos,a.activeAction="moving",[T.RUNNING,"Expanding territory (cell-based)"]},"Pioneer Expansion",e+1);return new Ie([t,n,i,s],"Border Expansion",e)}const Lo="removeEnemyBuildingTarget";function BM(e){const t=new Ie([new ge((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=E.get(s,Lo);if(a){const d=i.gameState.entities.entities[a];if(d&&d.type==="building"&&Vt(n,d,i.gameState))return[!0,`Continuing to target building ${a}`];E.delete(s,Lo)}const l=Be(n,i.gameState,"building",zA,d=>Vt(n,d,i.gameState)&&d.isConstructed);return l?(E.set(s,Lo,l.id),[!0,`Found enemy building at distance ${H(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Destroy",e+2),new de((n,i,s)=>{const a=E.get(s,Lo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(E.delete(s,Lo),n.activeAction="idle",n.target=void 0,T.FAILURE):H(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<ze?(n.activeAction="idle",n.target=void 0,T.SUCCESS):(n.activeAction="moving",n.target=l.id,T.RUNNING)},"Move to Enemy Building",e+2),new de((n,i,s)=>{const a=E.get(s,Lo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(E.delete(s,Lo),T.FAILURE):(n.activeAction="destroyingBuilding",n.target=l.id,E.delete(s,Lo),T.SUCCESS)},"Initiate Building Destruction",e+2)],"Remove Enemy Building Action",e+1);return new va(YA,t,"Remove Enemy Building Cooldown",e)}function FM(e){return new Ie([new de((t,n,i)=>{const s=Wg(t,n.gameState);return s?(E.set(i,"patriarchTarget",s.id),[T.SUCCESS,`Found patriarch: ${s.id}`]):(E.delete(i,"patriarchTarget"),[T.FAILURE,"No patriarch found"])},"Find Patriarch",e+1),new de((t,n,i)=>{const s=E.get(i,"patriarchTarget"),a=s&&n.gameState.entities.entities[s];if(!a)return[T.FAILURE,"Patriarch target missing from blackboard"];const l=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l>ER){t.activeAction="moving",t.target=a.id;const d=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(d),[T.RUNNING,`Moving to patriarch at ${l.toFixed(0)}`]}return t.activeAction="idle",t.target=void 0,t.direction={x:0,y:0},[T.SUCCESS,`Arrived at patriarch at ${l.toFixed(0)}`]},"Move Towards Patriarch",e+1)],"Follow Patriarch",e)}function LM(e){const t=new cn([new Ie([new ge((n,i)=>{if(!n.aiBlackboard)return[!1,"No blackboard"];if(!n.leaderId||n.leaderId===n.id)return[!1,"No tribe or the leader"];if(du(n,i.gameState).id!==n.id)return[!1,"Not patriarch"];const a=Al(n.aiBlackboard);return a!=="idle"&&CD(n.aiBlackboard,i.gameState.time)?(Cs(n.aiBlackboard,"idle",i.gameState.time),[!1,"Phase timed out, reset to idle"]):[a==="idle",`Phase: ${a}`]},"Is Idle?",e+2),new de((n,i)=>{if(!n.aiBlackboard)return T.FAILURE;const s=Hp(n,i.gameState);return s.canSplit&&s.strategy?(Cs(n.aiBlackboard,"planning",i.gameState.time),YI(n.aiBlackboard,s.strategy),T.SUCCESS):[T.FAILURE,s.reason||"Cannot split"]},"Check Split Conditions",e+2)],"Check Phase",e+1),new Ie([new ge(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Al(n.aiBlackboard);return[i==="planning",`Phase: ${i}`]},"Is Planning?",e+2),new de((n,i)=>n.aiBlackboard?xI(n,i.gameState)?(Cs(n.aiBlackboard,"gathering",i.gameState.time),T.SUCCESS):(Cs(n.aiBlackboard,"idle",i.gameState.time),T.FAILURE):T.FAILURE,"Plan Split Strategy",e+2)],"Planning Phase",e+1),new Ie([new ge(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Al(n.aiBlackboard);return[i==="gathering",`Phase: ${i}`]},"Is Gathering?",e+2),new de((n,i)=>{if(!n.aiBlackboard)return T.FAILURE;const[s,a]=TD(n,i.gameState);return s?(Cs(n.aiBlackboard,"executing",i.gameState.time),T.SUCCESS):[T.RUNNING,`Progress: ${a.toFixed(2)}`]},"Wait for Family to Gather",e+2)],"Gathering Phase",e+1),new Ie([new ge(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Al(n.aiBlackboard);return[i==="executing",`Phase: ${i}`]},"Is Executing?",e+2),new de((n,i)=>n.aiBlackboard?WI(n,i.gameState)?T.SUCCESS:(Cs(n.aiBlackboard,"idle",i.gameState.time),T.FAILURE):T.FAILURE,"Execute Tribe Split",e+2)],"Execution Phase",e+1)],"Tribe Split State Machine",e+1);return new va(eD,t,"Tribe Split Cooldown",e)}const Rd="jealousyAttackTarget";function UM(e){return new Ie([new ge((t,n,i)=>{var l,d;if(!t.isAdult)return[!1,"Not an adult"];if(t.gender!=="male")return[!1,"Not male"];const s=((d=(l=t.partnerIds)==null?void 0:l.map(u=>{var f;return(f=n.gameState.entities.entities[u])==null?void 0:f.pregnancyFatherId}))==null?void 0:d.filter(u=>!!u&&u!==t.id))??[],a=n.gameState.search.human.byRadius(t.position,LR).find(u=>s.includes(u.id));return a?t.leaderId&&a.id===t.leaderId?[!1,"Stranger is the tribe leader - no attack"]:(E.set(i,Rd,a.id),[!0,`Partner cheating with ${a.id}`]):(E.delete(i,Rd),!1)},"Check for Infidelity",e+1),new de((t,n,i)=>{const s=E.get(i,Rd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(E.delete(i,Rd),[T.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?T.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[T.RUNNING,`Attacking ${a.id}`])},"Execute Jealousy Attack",e+1)],"Jealousy Attack",e)}const Pd="defendAggressor";function HM(e){return new Ie([new ge((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const s=KP(t,n.gameState,UR);return s?(E.set(i,Pd,s.aggressor.id),[!0,`Family member ${s.familyMember.id} attacked by ${s.aggressor.id}`]):(E.delete(i,Pd),!1)},"Check Family Under Attack",e+1),new de((t,n,i)=>{const s=E.get(i,Pd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(E.delete(i,Pd),[T.FAILURE,"Target invalid/dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?T.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[T.RUNNING,`Attacking aggressor ${a.id}`])},"Execute Family Defense Attack",e+1)],"Defend Family",e)}const Dd="desperateAttackTarget";function GM(e){return new Ie([new ge(t=>t.hunger>HR,"Is Starving",e+1),new ge((t,n)=>{if(!t.isAdult)return[!1,"Not an adult"];const i=Be(t,n.gameState,"berryBush",ze,a=>a.food.length>0),s=Be(t,n.gameState,"corpse",ze,a=>a.food.length>0);return!i&&!s},"No Other Food Available",e+1),new ge((t,n,i)=>{const s=qP(t,n.gameState);return s?(E.set(i,Dd,s.id),[!0,`Found weak target ${s.id}`]):(E.delete(i,Dd),!1)},"Find Weak Target",e+1),new de((t,n,i)=>{const s=E.get(i,Dd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(E.delete(i,Dd),[T.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?T.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[T.RUNNING,`Desperately attacking ${a.id}`])},"Execute Desperate Attack",e+1)],"Desperate Attack",e)}function $M(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const a=H(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?Sn:ho;return a<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=s.id,t.direction=$e(t.position,s.position,e.mapDimensions),T.RUNNING)}function xM(e){return new Ie([new ge((t,n)=>t.isPlayer===!0&&!!n.gameState.autopilotControls.activeAutopilotAction,"Has Player Command",e+1),new de((t,n)=>{var a;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return T.FAILURE;switch(s.action){case se.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=s.position;return H(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<HA?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),T.SUCCESS):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),T.RUNNING)}case se.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;let d=!1;if(l.type==="berryBush")d=l.food.length===0;else if(l.type==="corpse")d=l.food.length===0;else if(l.type==="tree"){const f=l;d=f.stateMachine[0]!==Gt||f.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;return d?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Yr?(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),T.RUNNING):(t.activeAction="gathering",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS)}case se.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const[d]=l.stateMachine??[];return!(d===ln||d===Kt||d===An)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Ql?(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),T.RUNNING):(t.activeAction="chopping",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS)}case se.AutopilotAttack:return"targetEntityId"in s?$M(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE);case se.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||!or(t,l,n.gameState)?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Vs?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),T.RUNNING)}case se.AutopilotPlant:{if(t.activeAction==="planting")return T.RUNNING;if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=s.position;return zn(l,i,Qo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):H(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<=Vs?(t.activeAction="planting",t.target=l,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,T.RUNNING):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),T.RUNNING)}case se.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Vs?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",T.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),T.RUNNING)}case se.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l||l.buildingType!==ce.StorageSpot&&l.buildingType!==ce.Bonfire||!l.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const d=l.storageCapacity??0;if(l.storedItems.length>=d||t.leaderId!==l.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const f=t.food.length>0,g=!!t.heldItem;if(l.buildingType===ce.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==yt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE}else if(!f&&!g)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;return H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),T.RUNNING)}case se.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.buildingType!==ce.StorageSpot||!l.isConstructed||l.storedItems.length===0||t.leaderId!==l.ownerId||t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),T.RUNNING)}case se.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="takingOverBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),T.RUNNING)}case se.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="destroyingBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),T.RUNNING)}case se.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const l=s.position,d=s.buildingType;if(!d)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const u=H(t.position,l,i.mapDimensions.width,i.mapDimensions.height),f=100;return u<=f?ca(l,d,t.leaderId,i,t.position,f)?(qo(l,d,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",T.SUCCESS):(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),T.RUNNING)}default:return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE}},"Execute Player Command",e+1)],"Player Command Handler",e)}function WM(e){const t=new ge(i=>i.id===i.leaderId,"Is Leader?",e+1),n=new de((i,s)=>{var f,g,m,S,v,I;const{gameState:a}=s,l=Li(i.id,a),d=YS(l),u=bu(a).filter(A=>A.leaderId!==i.id);for(const A of u){const _=Li(A.leaderId,a),R=YS(_),P=((g=(f=i.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[A.leaderId])||Ut.Friendly,w=a.entities.entities[A.leaderId];((S=(m=w==null?void 0:w.tribeControl)==null?void 0:m.diplomacy)==null?void 0:S[i.id])===Ut.Hostile||d>R*FR?P!==Ut.Hostile&&((v=i.tribeControl)!=null&&v.diplomacy)&&(i.tribeControl.diplomacy[A.leaderId]=Ut.Hostile):P!==Ut.Friendly&&((I=i.tribeControl)!=null&&I.diplomacy)&&(i.tribeControl.diplomacy[A.leaderId]=Ut.Friendly)}return T.SUCCESS},"Evaluate Diplomacy",e+2);return new Ie([t,new va(BR,n,"Diplomacy Cooldown",e+1)],"Manage Diplomacy",e)}const cl="huntTarget";function YM(e){return new Ie([new $n(new ge((n,i,s)=>{if(!n.isAdult)return[!1,"Not an adult"];if(!n.leaderId)return[!1,"Not in a tribe"];if(!Yn(n,oe.Hunter,i.gameState))return[!1,"Not a Hunter"];const a=Be(n.position,i.gameState,"prey",IR,l=>!(n.leaderId&&!Wn(l.position,n.leaderId,i.gameState)));return a?(E.set(s,cl,a.id),[!0,"Found prey"]):[!1,"No suitable prey found"]},"Find Prey Target",e+2),kR,"Cache Find Prey",e+1),new Hi(new Or(new de((n,i,s)=>{if(!n.leaderId)return T.FAILURE;const a=E.get(s,cl);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];if(!l||l.hitpoints<=0)return E.delete(s,cl),n.activeAction="idle",n.attackTargetId=void 0,T.SUCCESS;const{gameState:d}=i,u=vn(n.leaderId,d);return H(n.position,u,d.mapDimensions.width,d.mapDimensions.height)>FA?(E.delete(s,cl),n.activeAction="idle",n.attackTargetId=void 0,T.FAILURE):(n.activeAction="attacking",n.attackTargetId=l.id,T.RUNNING)},"Hunt Prey Action",e+3),Os,"Hunt Prey Timeout",e+2),{taskType:"hunt",maxCapacity:$u,getTargetId:(n,i,s)=>E.get(s,cl)??null},"Tribal Hunt Task",e+1)],"Human Hunt Prey Sequence",e)}const Nd="defendTarget",fg=150;function zM(e){return new Ie([new ge((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult - children flee instead"];if(t.hitpoints<=t.maxHitpoints*.3)return[!1,"Too injured to defend"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.type==="predator"&&l.hitpoints>0&&H(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=fg)return E.set(i,Nd,l.id),[!0,"Continuing defense"]}const a=Be(t,s,"predator",fg,l=>l.hitpoints>0&&(l.isAdult||!1));if(a){const l=H(t.position,a.position,s.mapDimensions.width,s.mapDimensions.height),d=a.attackTargetId===t.id,u=l<80;if(d||u)return E.set(i,Nd,a.id),[!0,"Predator threat detected"]}return E.set(i,Nd,void 0),[!1,"No predator threat"]},"Detect Predator Threat",e+1),new de((t,n,i)=>{const s=E.get(i,Nd),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const{gameState:l}=n,d=H(t.position,a.position,l.mapDimensions.width,l.mapDimensions.height);return t.hitpoints<t.maxHitpoints*.3?T.FAILURE:a.hitpoints<=0||d>fg*1.5?(t.activeAction="idle",t.attackTargetId=void 0,T.SUCCESS):(t.activeAction="attacking",t.attackTargetId=a.id,T.RUNNING)},"Defend Against Predator",e+1)],"Human Defend Against Predator",e)}function jM(e){const t=new de((n,i)=>{if(!n.leaderId||!n.isAdult)return T.FAILURE;const s=i.gameState.entities.entities[n.leaderId];if(!s||!s.tribeControl)return T.FAILURE;if(n.id===s.id)return n.tribeRole!==oe.Leader&&(n.tribeRole=oe.Leader),T.SUCCESS;const l=jn(s,i.gameState).filter(A=>A.id!==s.id),d=l.length;if(d===0)return T.SUCCESS;const u=s.tribeControl.roleWeights;let f=0;const g=[];for(const A of Object.values(oe))A!==oe.Leader&&(f+=u[A]||0,g.push(A));if(f===0)return n.tribeRole||(n.tribeRole=oe.Gatherer),T.SUCCESS;const m={},S={},v={};for(const A of g)m[A]=0,S[A]=u[A]/f*d;for(const A of l)A.tribeRole&&A.tribeRole!==oe.Leader&&(m[A.tribeRole]=(m[A.tribeRole]||0)+1);for(const A of g)v[A]=S[A]-m[A];let I=!1;if((!n.tribeRole||n.tribeRole===oe.Leader||v[n.tribeRole]<-.5&&g.some(R=>v[R]>.5))&&(I=!0),I){let A=null,_=-1/0;const R=[...g].sort(()=>Math.random()-.5);for(const P of R){const w=v[P];w>_&&(_=w,A=P)}if(A)n.tribeRole=A;else{const P=Math.random()*f;let w=0;for(const b of g)if(w+=u[b],P<=w){n.tribeRole=b;break}}}return T.SUCCESS},"Assign Tribe Role",e+1);return new $n(t,Us,"Cache Tribe Role Assignment",e)}const XM=5,VM=0,KM=10;function qM(e){return e<GA?{[oe.Leader]:0,[oe.Gatherer]:7,[oe.Planter]:2,[oe.Hunter]:1,[oe.Mover]:1,[oe.Warrior]:0}:e<$A?{[oe.Leader]:0,[oe.Gatherer]:5,[oe.Planter]:4,[oe.Hunter]:2,[oe.Mover]:2,[oe.Warrior]:1}:e<xA?{[oe.Leader]:0,[oe.Gatherer]:4,[oe.Planter]:3,[oe.Hunter]:3,[oe.Mover]:3,[oe.Warrior]:2}:{[oe.Leader]:0,[oe.Gatherer]:3,[oe.Planter]:3,[oe.Hunter]:4,[oe.Mover]:3,[oe.Warrior]:3}}function ZM(e){if(e.length===0)return 0;let t=0,n=0;for(const i of e)t+=i.food.length,n+=i.maxFood;return n===0?0:t/n}function QM(e,t){return e<t?Math.min(e+1,KM):e>t?Math.max(e-1,VM):e}function JM(e){const t=new de((n,i)=>{if(!n.leaderId||n.id!==n.leaderId||!n.tribeControl)return T.FAILURE;const s=jn(n,i.gameState);if(s.filter(m=>m.isAdult).length<XM)return T.FAILURE;const l=ZM(s),d=qM(l),u=n.tribeControl.roleWeights;let f=!1;const g=[oe.Gatherer,oe.Planter,oe.Hunter,oe.Mover,oe.Warrior];for(const m of g){const S=u[m]||0,v=d[m],I=QM(S,v);I!==S&&(u[m]=I,f=!0)}if(f){const m=`Adjusted weights for food security: ${(l*100).toFixed(1)}%`;return[T.SUCCESS,m]}return T.FAILURE},"Manage Tribe Role Weights",e+1);return new $n(t,Us,"Cache Role Management",e)}const wr="treeTarget";function eO(e){const t=new de((i,s,a)=>{const l=xt(i,s.gameState),d=Be(i,s.gameState,"tree",WR,u=>{const[f]=u.stateMachine??[];if(!(f===ln||f===Kt||f===An)||i.leaderId&&!Wn(u.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const m=`tribal_chop_${u.id}`,S=E.get(l.aiBlackboard,m);if(S&&s.gameState.time-S.startTime<=Fi&&!S.memberIds.includes(i.id))return!1}return!0});return d?(E.set(a,wr,d.id),[T.SUCCESS,`Found tree: ${d.id} at ${d.position.x.toFixed(0)},${d.position.y.toFixed(0)}`]):[T.FAILURE,"No tree found"]},"Find Closest Tree",e+4),n=new Hi(new de((i,s,a)=>{const l=E.get(a,wr);if(!l)return[T.FAILURE,"No target in blackboard"];const d=s.gameState.entities.entities[l];if(!d)return E.delete(a,wr),[T.FAILURE,"Tree no longer exists"];const[u]=d.stateMachine??[];return u===ln||u===Kt||u===An?H(i.position,d.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Ql?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=d.id,E.delete(a,wr),[T.SUCCESS,`Chopping tree ${d.id}`]):(i.activeAction="moving",i.target=d.id,i.direction=$e(i.position,d.position,s.gameState.mapDimensions),[T.RUNNING,`Moving to tree ${d.id}`]):(E.delete(a,wr),[T.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop",e+3),{taskType:"chop",maxCapacity:1,getTargetId:(i,s,a)=>E.get(a,wr)??null},"Tribal Chop Task",e+3);return new Ie([new ge((i,s)=>{const a=xt(i,s.gameState);if(!a)return[!1,"No leader for coordination"];const l=zl(a.id,s.gameState);if(l<=0)return[!1,"No wood need"];const d=_I(a.id,s.gameState);return[l>d,`Wood need: ${l}, Available on ground: ${d}`]},"Need Wood?",e+1),new ge(i=>{const s=!i.heldItem;return[(i.isAdult&&s)??!1,`${s?"Can chop":"Holding item"}`]},"Should Chop Tree",e+1),new cn([new Ie([new ge((i,s,a)=>E.has(a,wr),"Has Tree Target?",e+2),n],"Continue Chopping Action",e+2),new Ie([new $n(t,OR,"Cache Tree Search",e+3),n],"Find New Tree and Chop",e+2)],"Perform or Start Chopping",e+1)],"Chop Tree",e)}const Rr="cleanupTreeTarget";function tO(e){const t=new de((i,s,a)=>{const l=xt(i,s.gameState),d=ku(i,s.gameState);if(d.length===0)return[T.FAILURE,"No planting zones found"];const u=s.gameState;let f=null,g=1/0;for(const m of d){const S=Math.sqrt(m.width*m.width+m.height*m.height)/2,v=u.search.tree.byRadius(m.position,S);for(const I of v){const[A]=I.stateMachine??[];if(!(A===ln||A===Kt||A===An)||!kg(I.position,m,s.gameState))continue;if(l&&l.aiBlackboard){const P=`tribal_cleanup_tree_${I.id}`,w=E.get(l.aiBlackboard,P);if(w&&s.gameState.time-w.startTime<=Fi&&!w.memberIds.includes(i.id))continue}const R=H(i.position,I.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);R<g&&(g=R,f=I)}}return f?(E.set(a,Rr,f.id),[T.SUCCESS,`Found nuisance tree: ${f.id} at ${f.position.x.toFixed(0)},${f.position.y.toFixed(0)}`]):[T.FAILURE,"No nuisance trees found in planting zones"]},"Find Nuisance Tree",e+4),n=new Hi(new de((i,s,a)=>{const l=E.get(a,Rr);if(!l)return[T.FAILURE,"No target in blackboard"];const d=s.gameState.entities.entities[l];if(!d)return E.delete(a,Rr),[T.FAILURE,"Tree no longer exists"];const[u]=d.stateMachine??[];return u===ln||u===Kt||u===An?H(i.position,d.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Ql?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=d.id,E.delete(a,Rr),[T.SUCCESS,`Chopping nuisance tree ${d.id}`]):(i.activeAction="moving",i.target=d.id,i.direction=$e(i.position,d.position,s.gameState.mapDimensions),[T.RUNNING,`Moving to nuisance tree ${d.id}`]):(E.delete(a,Rr),[T.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop (Cleanup)",e+3),{taskType:"cleanup_tree",maxCapacity:1,getTargetId:(i,s,a)=>E.get(a,Rr)??null},"Tribal Cleanup Tree Task",e+3);return new Ie([new ge((i,s)=>{const a=Yn(i,oe.Planter,s.gameState),l=Yn(i,oe.Gatherer,s.gameState),d=!i.heldItem;return[!!(i.isAdult&&(a||l)&&d),`${d?"Planter/Gatherer role eligible":"Holding item"}`]},"Should Cleanup Zone?",e+1),new cn([new Ie([new ge((i,s,a)=>E.has(a,Rr),"Has Cleanup Target?",e+2),n],"Continue Cleanup Action",e+2),new Ie([new $n(t,bR,"Cache Cleanup Search",e+3),n],"Find New Nuisance Tree and Chop",e+2)],"Perform or Start Cleanup",e+1)],"Cleanup Planting Zones",e)}const dl="bonfireTargetId",nO=800;function iO(e){return new Ie([new ge((t,n)=>{const i=nr(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<co+8;return[s,`Temp: ${i.toFixed(1)}C`+(s?" (Cold)":"")]},"Is Cold?",e+1),new de((t,n,i)=>{const s=xt(t,n.gameState),a=Be(t,n.gameState,"building",nO,l=>{if(!(l.buildingType===ce.Bonfire&&l.isConstructed&&!l.isBeingDestroyed&&(l.fuelLevel??0)>0)||l.ownerId!==t.leaderId)return!1;if(s&&s.aiBlackboard){const u=`tribal_warmth_${l.id}`,f=E.get(s.aiBlackboard,u);if(f&&n.gameState.time-f.startTime<=Fi&&f.memberIds.length>=Gg&&!f.memberIds.includes(t.id))return!1}return!0});return a?(E.set(i,dl,a.id),[T.SUCCESS,`Found bonfire ${a.id}`]):(E.delete(i,dl),[T.FAILURE,"No available fueled bonfires found"])},"Find Bonfire",e+1),new Hi(new de((t,n,i)=>{const s=E.get(i,dl),a=s&&n.gameState.entities.entities[s];if(!a||(a.fuelLevel??0)<=0||!a.isConstructed)return E.delete(i,dl),T.FAILURE;const l=t.id*137%360*(Math.PI/180),d=Fr*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,g={x:(a.position.x+Math.cos(l)*d+u)%u,y:(a.position.y+Math.sin(l)*d+f)%f},m=H(t.position,g,u,f);return m>10?(t.activeAction="moving",t.target=g,t.direction=$e(t.position,g,n.gameState.mapDimensions),[T.RUNNING,`Moving to personal warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[T.RUNNING,"Staying warm at personal spot"])},"Move to Warmth Spot",e+2),{taskType:"warmth",maxCapacity:Gg,getTargetId:(t,n,i)=>E.get(i,dl)??null},"Tribal Warmth Task",e+1)],"Gather at Bonfire Sequence",e)}function oO(e){const t=new de((n,i,s)=>{if(!n.leaderId||n.id!==n.leaderId)return[T.FAILURE,"Not a tribe leader"];const a=ua(n.id,i.gameState);let l=0;for(const d of a)if(d.isConstructed&&d.fuelLevel!==void 0){const u=d.maxFuelLevel??Lr;d.fuelLevel<u*wp&&(lT(s,d.id,"wood",i.gameState.time),l++)}return[T.SUCCESS,`Tribe logistics: ${l} wood demands registered for bonfires`]},"Manage Tribe Logistics",e+1);return new $n(t,S1,"Cached Tribe Logistics",e)}function rO(e){return new Ie([new ge((t,n,i)=>{const s=Be(t,n.gameState,"predator",yn*2,()=>!0),a=Be(t,n.gameState,"human",yn*2,()=>!0);let l=null,d=1/0;if(s){const u=H(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<d&&(d=u,l=s)}if(a){const u=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<d&&(d=u,l=a)}return l&&d<yn*1.5?(E.set(i,"fleeThreat",l.id),E.set(i,"fleeDistance",d),!0):!1},"Detect Threat",e+1),new de((t,n,i)=>{const s=E.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;t.activeAction="moving";const l=Xe(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=ot(l),u=oi(t.position,At(d,JD));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=d,t.fleeCooldown=n.gameState.time+2,T.RUNNING},"Execute Flee",e+1)],"Prey Flee",e)}function sO(e){return new Ie([new ge((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=30||t.eatingCooldownTime&&t.eatingCooldownTime>n.gameState.time)return!1;const s=Be(t,n.gameState,"berryBush",yn*10,a=>a.food.length>0);return s?H(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=yn?(E.set(i,"grazingTarget",s.id),!0):(E.set(i,"grazingTarget",s.id),E.set(i,"needToMoveToTarget",!0),!0):!1},"Find Berry Bush",e+1),new de((t,n,i)=>{const s=E.get(i,"grazingTarget"),a=s&&n.gameState.entities.entities[s],l=E.get(i,"needToMoveToTarget");if(!a)return T.FAILURE;const d=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=yn)return t.activeAction="grazing",t.target=a.id,t.direction={x:0,y:0},E.delete(i,"needToMoveToTarget"),T.RUNNING;if(l||d>yn){t.activeAction="moving",t.target=a.id;const u=$e(t.position,a.position,n.gameState.mapDimensions);return t.direction=u,T.RUNNING}return T.FAILURE},"Move to Bush or Graze",e+1)],"Prey Graze",e)}function aO(e){const t=new ge((a,l,d)=>{const u=Be(a,l.gameState,"prey",yn,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Ml&&f.age<=rg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(E.set(d,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new de((a,l,d)=>{const u=E.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},E.delete(d,"procreationPartner"),T.SUCCESS):T.FAILURE},"Start Procreating",e+2),i=new ge((a,l,d)=>{const u=Be(a,l.gameState,"prey",yn*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Ml&&f.age<=rg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(E.set(d,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new de((a,l,d)=>{const u=E.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return T.FAILURE;if(H(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=yn)return T.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),T.RUNNING},"Move Towards Partner",e+2);return new Ie([new ge(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=Ml&&a.age<=rg&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new cn([new Ie([t,n],"Procreate With Immediate Partner",e+2),new Ie([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Prey Procreate",e)}const lO=(e,t,n)=>{const i=t.gameState.search.prey.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="prey");if(i.length===0)return T.FAILURE;let s=null,a=Hu;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(E.set(n,"targetChild",s.id),T.SUCCESS):T.FAILURE},cO=(e,t,n)=>{const i=E.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?H(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>Sa?(e.activeAction="moving",e.target=s.id,e.direction=$e(e.position,s.position,t.gameState.mapDimensions),T.RUNNING):(e.activeAction="feeding",e.target=void 0,E.set(n,"targetChild",void 0),T.SUCCESS):T.FAILURE};function dO(e){return new Ie([new ge(t=>(t.isAdult&&t.gender==="female"&&t.hunger<80&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new de(lO,"Find Hungriest Prey Child",e+1),new de(cO,"Move To Child and Feed",e+1)],"Feed Prey Child",e)}function uO(e){return new Ie([new ge(t=>!t.isAdult&&t.hunger>=Hu,"Is Hungry Prey Child",e+1),new de((t,n,i)=>{if(!t.motherId)return T.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(E.set(i,"targetParent",s.id),T.SUCCESS):T.FAILURE},"Find Female Parent",e+1),new de((t,n,i)=>{const s=E.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const l=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=Sa?(t.target=void 0,T.SUCCESS):(t.target=a.id,t.activeAction="moving",T.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}const Md="huntTarget";function fO(e,t,n){if(!(e!=null&&e.aiBlackboard))return!0;const i=`tribal_hunt_${t}`,s=E.get(e.aiBlackboard,i);return!s||n-s.startTime>Fi?!0:s.memberIds.length<(s.maxCapacity||$u)}function hO(e,t,n,i){if(!(e!=null&&e.aiBlackboard))return;const s=`tribal_hunt_${n}`;let a=E.get(e.aiBlackboard,s);a||(a={memberIds:[],startTime:i,maxCapacity:$u},E.set(e.aiBlackboard,s,a)),a.memberIds.includes(t.id)||a.memberIds.push(t.id)}function gO(e,t){if(!(e!=null&&e.aiBlackboard))return 0;const n=`tribal_hunt_${t}`,i=E.get(e.aiBlackboard,n);return(i==null?void 0:i.memberIds.length)??0}function Kd(e,t,n=new Set){if(n.has(e.id))return e;n.add(e.id);for(const i of[e.fatherId,e.pregnancyFatherId,e.motherId]){if(!i||i===e.id)continue;const s=t.entities.entities[i];if(s)return Kd(s,t,n)}return e}function pO(e){return new Ie([new ge((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=50||t.huntCooldown&&t.huntCooldown>0)return!1;const s=Be(t,n.gameState,"prey",ks*10,a=>{if(a.hitpoints<=0)return!1;const l=Kd(t,n.gameState);return!(l&&!fO(l,a.id,n.gameState.time))});if(s){const a=H(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Kd(t,n.gameState),d=l?gO(l,s.id):0;if(a<=ks)return E.set(i,Md,s.id),[!0,`Prey in range (${d} hunters)`];if(a<=ks*10)return E.set(i,Md,s.id),E.set(i,"needToApproach",!0),[!0,`Approaching prey (${d} hunters)`]}return!1},"Find Prey Target",e+1),new Or(new de((t,n,i)=>{const s=E.get(i,Md),a=s&&n.gameState.entities.entities[s],l=E.get(i,"needToApproach");if(!a||a.hitpoints<=0)return E.delete(i,Md),E.delete(i,"needToApproach"),T.SUCCESS;const d=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=ks)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},E.delete(i,"needToApproach"),T.RUNNING;if(l||d>ks){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),hO(Kd(t,n.gameState),t,a.id,n.gameState.time),T.RUNNING}return T.FAILURE},"Hunt or Approach Prey",e+3),10,"Hunt Timeout (10 hour)",e+2)],"Predator Hunt",e)}function mO(e){return new Ie([new ge((t,n,i)=>{const s=t.hunger>100,a=t.hitpoints<t.maxHitpoints*.5;if(!s&&!a||t.attackCooldown&&t.attackCooldown>0)return!1;const l=Be(t,n.gameState,"human",yi*2,d=>d.hitpoints>0);if(l){const d=H(t.position,l.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=yi)return E.set(i,"attackTarget",l.id),!0;if(s&&d<=yi*2)return E.set(i,"attackTarget",l.id),E.set(i,"needToApproach",!0),!0}return!1},"Find Human Target",e+1),new de((t,n,i)=>{const s=E.get(i,"attackTarget"),a=s&&n.gameState.entities.entities[s],l=E.get(i,"needToApproach");if(!a||a.hitpoints<=0)return T.FAILURE;const d=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=yi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},E.delete(i,"needToApproach"),T.RUNNING;if(l||d>yi){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),T.RUNNING}return T.FAILURE},"Attack or Approach Human",e+1)],"Predator Attack Human",e)}function yO(e){const t=new ge((a,l,d)=>{const u=Be(a,l.gameState,"predator",Zo,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Ol&&f.age<=sg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(E.set(d,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new de((a,l,d)=>{const u=E.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},E.delete(d,"procreationPartner"),T.SUCCESS):T.FAILURE},"Start Procreating",e+2),i=new ge((a,l,d)=>{const u=Be(a,l.gameState,"predator",Zo*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Ol&&f.age<=sg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(E.set(d,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new de((a,l,d)=>{const u=E.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return T.FAILURE;if(H(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=Zo)return T.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),T.RUNNING},"Move Towards Partner",e+2);return new Ie([new ge(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=Ol&&a.age<=sg&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new cn([new Ie([t,n],"Procreate With Immediate Partner",e+2),new Ie([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Predator Procreate",e)}const SO=(e,t,n)=>{const i=t.gameState.search.predator.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="predator");if(i.length===0)return T.FAILURE;let s=null,a=Hu;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(E.set(n,"targetChild",s.id),T.SUCCESS):T.FAILURE},vO=(e,t,n)=>{const i=E.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?H(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>Sa?(e.activeAction="moving",e.target=s.id,e.direction=$e(e.position,s.position,t.gameState.mapDimensions),T.RUNNING):(e.activeAction="feeding",e.target=void 0,E.set(n,"targetChild",void 0),T.SUCCESS):T.FAILURE};function AO(e){return new Ie([new ge(t=>(t.isAdult&&t.gender==="female"&&t.hunger<90&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new de(SO,"Find Hungriest Predator Child",e+1),new de(vO,"Move To Child and Feed",e+1)],"Feed Predator Child",e)}function IO(e){return new Ie([new ge(t=>!t.isAdult&&t.hunger>=Hu,"Is Hungry Predator Child",e+1),new de((t,n,i)=>{if(!t.motherId)return T.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(E.set(i,"targetParent",s.id),T.SUCCESS):T.FAILURE},"Find Female Parent",e+1),new de((t,n,i)=>{const s=E.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const l=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=Sa?(t.target=void 0,T.SUCCESS):(t.target=a.id,t.activeAction="moving",T.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}function gT(e){return new de((t,n,i)=>{t.activeAction="idle";let s=E.get(i,"wanderTarget"),a=E.get(i,"wanderStartTime");const l=n.gameState.time;if(!s||!a||l-a>2){const d=Math.random()*2*Math.PI,u=50+Math.random()*100,f={x:Math.cos(d),y:Math.sin(d)},g=oi(t.position,At(f,u));s={x:(g.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(g.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},E.set(i,"wanderTarget",s),E.set(i,"wanderStartTime",l)}if(s){t.target=s;let d=s.x-t.position.x,u=s.y-t.position.y;const f=n.gameState.mapDimensions.width,g=n.gameState.mapDimensions.height;Math.abs(d)>f/2&&(d=d>0?d-f:d+f),Math.abs(u)>g/2&&(u=u>0?u-g:u+g);const m=ot({x:d,y:u});t.direction=m}return T.SUCCESS},"Animal Wander",e)}function TO(e){return new Ie([new ge((t,n,i)=>{if(t.hunger>90||t.hitpoints<t.maxHitpoints*.3||t.activeAction==="grazing"||t.activeAction==="procreating")return!1;const s=Object.values(n.gameState.entities.entities),a=[];for(const l of s)if(l.type==="prey"&&l.id!==t.id){const d=l;d.hitpoints>0&&d.isAdult&&H(t.position,d.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=yn*5&&a.push(d)}if(a.length>=2){let l=0,d=0;for(const g of a)l+=g.position.x,d+=g.position.y;l/=a.length,d/=a.length;const u={x:l,y:d};if(H(t.position,u,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>yn*2)return E.set(i,"herdCenter",u),E.set(i,"herdSize",a.length),!0}return!1},"Find Herd",e+1),new de((t,n,i)=>{const s=E.get(i,"herdCenter");if(!s)return T.FAILURE;if(H(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>yn*2){t.activeAction="moving",t.target=s;const l=Xe(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(l),T.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},T.SUCCESS},"Join Herd",e+1)],"Prey Herd Behavior",e)}function EO(e){return new Ie([new ge((t,n,i)=>{if(t.hunger>100||t.hitpoints<t.maxHitpoints*.4||t.activeAction==="attacking"||t.activeAction==="procreating")return!1;const s=Be(t,n.gameState,"predator",Zo*4,a=>a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==void 0&&a.fatherId===t.fatherId&&a.age>=t.age||a.hitpoints>t.hitpoints);return s&&H(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Zo*2?(E.set(i,"packLeader",s.id),!0):!1},"Find Pack Leader",e+1),new de((t,n,i)=>{const s=E.get(i,"packLeader"),a=s&&n.gameState.entities.entities[s];if(!a||a.hitpoints<=0)return T.FAILURE;if(H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Zo*2){t.activeAction="moving",t.target=a.id;const d=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(d),T.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},T.SUCCESS},"Follow Pack Leader",e+1)],"Predator Pack Behavior",e)}function CO(e){return new Ie([new ge((t,n,i)=>{if(!t.isAdult||t.hitpoints<t.maxHitpoints*.6||t.hunger>120||t.attackCooldown&&t.attackCooldown>0)return!1;const s=Be(t,n.gameState,"predator",ZS,a=>!!(a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==a.fatherId&&t.gender===a.gender&&t.fatherId!==void 0&&a.fatherId!==void 0));if(s){const a=H(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(a<=yi)return E.set(i,"territorialTarget",s.id),!0;if(a<=ZS)return E.set(i,"territorialTarget",s.id),E.set(i,"needToApproach",!0),!0}return!1},"Find Territorial Rival",e+1),new de((t,n,i)=>{const s=E.get(i,"territorialTarget"),a=s&&n.gameState.entities.entities[s],l=E.get(i,"needToApproach");if(!a||a.hitpoints<=0)return T.FAILURE;const d=H(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=yi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},E.delete(i,"needToApproach"),T.RUNNING;if(l||d>yi){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),T.RUNNING}return T.FAILURE},"Territorial Fight or Approach",e+1)],"Predator Territorial Defense",e)}const _O="tribeSplit_strategy",wO="tribeSplit_targetPosition",RO="tribeSplit_targetBuildingId",PO="tribeSplit_familyIds";function DO(e){return new Ie([new ge((t,n)=>{const i=du(t,n.gameState);if(!i.aiBlackboard)return[!1,"Patriarch has no blackboard"];const s=Al(i.aiBlackboard);if(s!=="gathering")return[!1,`Patriarch phase: ${s}`];const a=E.get(i.aiBlackboard,PO);return!a||!a.includes(t.id)?[!1,"Not in split family"]:[!0,"Gathering for split"]},"Should Gather for Split?",e+1),new de((t,n)=>{const i=du(t,n.gameState),s=E.get(i.aiBlackboard,_O);let a;if(s==="migration")a=E.get(i.aiBlackboard,wO);else if(s==="concentration"){const d=E.get(i.aiBlackboard,RO);if(d){const u=n.gameState.entities.entities[d];u&&(a=u.position)}}if(!a)return T.FAILURE;const l=H(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=BI?(t.activeAction="idle",t.target=void 0,T.SUCCESS):(t.activeAction="moving",t.target=a,[T.RUNNING,`Distance: ${l.toFixed(2)}`])},"Move to Split Gathering Point",e+1)],"Tribe Split Gather Behavior",e)}function NO(){const e=new cn([pM(2),HM(2),new Dn(zM(2),"attack","Gated Defend Against Predator",2),new Dn(UM(2),"attack","Gated Jealousy Attack",2),new Dn(GM(2),"attack","Gated Desperate Attack",2),xM(2),new _s(new cn([new $n(OM(5),Us,"Cache Take Over Building",4),new $n(BM(5),Us,"Cache Remove Enemy Building",4)],"Building Interaction Selector",3),"Gated Leader Building Interactions",2),NM(2),new Dn(AM(3),"attack","Gated Attacking",2),iO(2),lM(2),cM(2),DM(2),new Dn(new $n(MM(4),ZR,"Cache Building Placement",3),"build","Gated Leader Building Placement",2),new _s(new $n(kM(4),Us,"Cache Border Post Placement",3),"Gated Border Post Placement",2),LM(2),DO(2),gM(2),new Dn(vM(3),"procreation","Gated Procreation",2),new Or(new Dn(tO(4),"chopping","Gated Cleanup Trees",3),Os,"Timeout Cleanup Trees",2),new Or(new Dn(RM(4),"planting","Gated Planting",3),Os,"Timeout Planting",2),new Dn(PM(3),"gathering","Gated Storage Deposit",2),new Dn(EM(3),"feedChildren","Gated Feed Child",2),new Or(new Dn(mM(4),"gathering","Gated Gathering",3),Os,"Timeout Gathering",2),new Or(new Dn(eO(4),"chopping","Gated Chopping",3),Os,"Timeout Chopping",2),CM(2),new Dn(YM(3),"attack","Gated Hunt Prey",2),new _s(FM(2),"Gated Follow Patriarch",2),new Or(new _s(SM(2),"Gated Idle Wander",3),Os,"Timeout Idle Wander",2)],"AI Root Selector",1),t=new nv([new rM(new sM(jM(4),"Role Assignment Success",3),"Role Assignment Gate",2),new Dn(new $n(JM(4),Us,"Cache Role Management",3),"roleManagement","Gated Role Management",2),new _s(WM(3),"Gated Diplomacy",2),new _s(oO(2),"Gated Logistics Management",2)],"Non blocking",1),n=new nv([e,t],"AI Root Sequence",1);return new aM(n,"Manual Control Gate",0)}var ae=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e))(ae||{}),G=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(G||{});const bt=2,MO=250,pT=.8,OO=100,bO=5,Vg="currentAiTask",mT="lastTaskResult",yT="lastTaskMessage",Kg="taskHistory";function qg({aiBlackboard:e}){return E.get(e,Vg)||null}function js({aiBlackboard:e},t){t?E.set(e,Vg,t):E.delete(e,Vg)}function kO(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function BO(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function FO(e,t,n,i){const s=t.type===ae.Wait?LO:i[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=G.Failure;const[l,d,u]=BO(a);if(E.set(e.aiBlackboard,mT,l),E.set(e.aiBlackboard,yT,d),l!==G.Running){const f=E.get(e.aiBlackboard,Kg)||[];if(f.unshift({type:t.type,result:l,completedAtTick:n.gameState.time,message:d}),f.length>5&&f.pop(),E.set(e.aiBlackboard,Kg,f),delete n.gameState.tasks[t.id],js(e,null),l===G.Success){const g=u||t.nextTask;g&&(n.gameState.tasks[g.id]=g,g.claimedByEntityId=e.id,js(e,g.id))}}return l}function Qt(e){return 1/(1+e/MO)}function ic(e,t,n){for(let i=0;i<n.length;i++){const s=n[i];if(!s.producer)continue;const a=s.producer(e,t);for(const l in a){const d=a[l],u=t.gameState.tasks[l];t.gameState.tasks[l]=d,u&&(t.gameState.tasks[l].claimedByEntityId=u.claimedByEntityId)}}}const Od=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:ae.Wait,creatorEntityId:e.id,validUntilTime:t+bt}),LO={type:ae.Wait,executor:(e,t,n)=>n.gameState.time>=e.validUntilTime-1?[G.Success,"Wait complete"]:[G.Running,"Waiting"]};function ht(e){const{type:t,requireAdult:n,autopilotBehavior:i,producer:s,scorer:a,executor:l}=e;return{type:t,producer:s,scorer:a?(f,g,m)=>n&&!f.isAdult||i&&f.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?null:a(f,g,m):void 0,executor:l?(f,g,m)=>n&&!g.isAdult||i&&g.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?G.Failure:m.gameState.autopilotControls.activeAutopilotAction&&f.type!==ae.HumanPlayerCommand&&g.isPlayer?[G.Failure,"Autopilot action active",{id:`player-command-${g.id}`,type:ae.HumanPlayerCommand,position:g.position,creatorEntityId:g.id,validUntilTime:m.gameState.time+bt}]:l(f,g,m):void 0}}const UO=ht({type:ae.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>la&&e.food.length>0){const i=`eat-task-${e.id}`;n[i]={id:i,type:ae.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/sn,executor:(e,t)=>e.target!==t.id?G.Empty:t.hunger<la?G.Success:t.food.length===0?G.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",G.Running)}),HO=ht({type:ae.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="berryBush"||i.food.length===0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qt(s),l=e.hunger/sn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="berryBush"||i.food.length===0||t.food.length>=t.maxFood?[G.Success,"Bush is empty"]:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",[G.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[G.Running,"Gathering berries"])}}),GO=ht({type:ae.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="corpse"||i.food.length===0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qt(s),l=e.hunger/sn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="corpse"||i.food.length===0||t.food.length>=t.maxFood?G.Success:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",G.Running)}}),$O=ht({type:ae.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=$l&&e.age<=wu&&e.hunger<an&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:ae.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<$l||e.hunger>=an||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="female"||i.isPregnant||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(s)*pT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="female"||t.hunger>=an?G.Failure:i.isPregnant?G.Success:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",t.direction=$e(t.position,i.position,n.gameState.mapDimensions),G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",G.Running)}}),xO=ht({type:ae.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=$l&&e.hunger<an&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:ae.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<$l||e.age>wu||e.hunger>=an||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="male"||i.hunger>=an||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(s)*pT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="male"||i.hunger>=an?G.Failure:t.isPregnant?G.Success:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",t.direction=$e(t.position,i.position,n.gameState.mapDimensions),G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",G.Running)}}),WO=ht({type:ae.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=ra){const i=`feed-child-task-${e.id}`;n[i]={id:i,type:ae.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.isAdult||!(i.motherId===e.id||i.fatherId===e.id))return null;const a=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Qt(a),d=i.hunger/sn;return(l+d)/2},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.isAdult||t.food.length===0?G.Failure:i.hunger<ra/2?G.Success:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ru?(t.target=i.position,t.activeAction="moving",t.direction=$e(t.position,i.position,n.gameState.mapDimensions),G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="feeding",G.Running)}});function Xp(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const i=H(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(i)}function YO(e,t,n){if(e.leaderId!==t.creatorEntityId||!e.leaderId)return null;const i=t.target;if(!i)return null;const{width:s,height:a}=n.gameState.mapDimensions,l=H(e.position,i,s,a),d=Qt(l)*.5,u=vn(e.leaderId,n.gameState),f=H(u,i,s,a),g=Math.max(0,1-f/800)*.25,m=Math.ceil(s/Re),S=Math.ceil(a/Re),v=XA(i);let I=0;for(let _=-1;_<=1;_++)for(let R=-1;R<=1;R++){if(R===0&&_===0)continue;const P=((v.x+R)%m+m)%m,w=((v.y+_)%S+S)%S;n.gameState.terrainOwnership[w*m+P]===e.leaderId&&I++}const A=I/8*.25;return d+g+A}function Wu(e,t,n,i,s){const a=e.target;return H(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",G.Running):(qo(a,i,t.leaderId,n.gameState),G.Success)}const zO=ht({type:ae.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:Xp,executor:(e,t,n)=>Wu(e,t,n,ce.StorageSpot,to)}),jO=ht({type:ae.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:Xp,executor:(e,t,n)=>Wu(e,t,n,ce.Bonfire,to)}),XO=ht({type:ae.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:Xp,executor:(e,t,n)=>Wu(e,t,n,ce.PlantingZone,to)}),VO=ht({type:ae.HumanPlaceBorderPost,scorer:YO,requireAdult:!0,autopilotBehavior:"build",executor:(e,t,n)=>Wu(e,t,n,ce.BorderPost,t1)}),KO=ht({type:ae.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(u=>u.type===In.Berry).length<fo)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const l=t.target,d=H(e.position,l,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(d)},executor:(e,t,n)=>{if(t.food.filter(d=>d.type===In.Berry).length<fo)return t.activeAction="idle",G.Failure;const s=e.target;return H(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Yr?(t.target=s,t.activeAction="moving",G.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(d=>d.type==="berryBush"&&H(d.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<bO)?(t.activeAction="idle",G.Success):G.Running)}}),qO=ht({type:ae.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var f;if(typeof t.target!="number")return null;const i=e.food.length>0,s=((f=e.heldItem)==null?void 0:f.type)===yt.Wood;if(!i&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==ce.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const l=H(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=Qt(l),u=s?.6:e.food.length/e.maxFood*.4;return(d+u)/2},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==ce.StorageSpot)return G.Failure;const s=t.food.length>0,a=((d=t.heldItem)==null?void 0:d.type)===yt.Wood;return!s&&!a?G.Success:i.storedItems.length>=i.storageCapacity?G.Failure:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",G.Running)}}),ZO=ht({type:ae.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var d;if(typeof t.target!="number"||!(((d=e.heldItem)==null?void 0:d.type)===yt.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==ce.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||su;if(s.storedItems.length>=a)return null;const l=H(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(l)},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==ce.Bonfire)return G.Failure;if(!(((d=t.heldItem)==null?void 0:d.type)===yt.Wood))return G.Success;const a=i.storageCapacity||su;return i.storedItems.length>=a?G.Failure:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",G.Running)}}),QO=ht({type:ae.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=la||e.food.length>0||typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="building"||i.buildingType!==ce.StorageSpot||i.ownerId!==e.leaderId||!i.storedItems.some(u=>u.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qt(s),l=e.hunger/sn,d=1-e.food.length/e.maxFood;return(a+l+d)/3},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="building"||i.buildingType!==ce.StorageSpot||!i.storedItems.some(a=>a.item.itemType==="food")?G.Failure:t.food.length>0?G.Success:t.food.length>=t.maxFood?G.Failure:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="retrieving",G.Running)}}),JO=ht({type:ae.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree")return null;const[s]=i.stateMachine??[];if(!(s===ln||s===Kt||s===An)||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.heldItem||e.food.length===0)return null;const l=xt(e,n.gameState);if(!l)return null;const d=zl(l.id,n.gameState);if(d<=0)return null;const u=_I(l.id,n.gameState);if(u>=d)return null;const f=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),g=Qt(f),m=Math.min(1,(d-u)/10);return(g+m)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="tree")return[G.Failure,"Tree not found"];const[s]=i.stateMachine??[];if(s===Gt){const d={id:`gather-wood-${t.id}-${n.gameState.time}`,type:ae.HumanGatherWood,position:i.position,creatorEntityId:t.id,target:i.id,validUntilTime:n.gameState.time+1};return[G.Success,"Tree fell!",d]}return s===ln||s===Kt||s===An?t.heldItem?[G.Failure,"Hands full"]:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ql?(t.target=i.position,t.activeAction="moving",[G.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="chopping",[G.Running,"Chopping tree"]):[G.Failure,"Tree is not standing"]}}),eb=ht({type:ae.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree"||i.wood.length===0)return null;const[s]=i.stateMachine??[];if(s!==Gt||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.heldItem)return null;const a=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Qt(a),d=xt(e,n.gameState),u=d?zl(d.id,n.gameState):0,f=Math.min(1,u/10);return(l+f)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[G.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[G.Success,"Already holding wood"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="tree"||i.wood.length===0||t.heldItem?[G.Failure,"Tree gone, empty, or human full"]:H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",[G.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[G.Running,"Gathering wood"])}}),tb=ht({type:ae.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="prey"||i.hitpoints<=0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState))return null;const s=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const d=vn(e.leaderId,n.gameState);if(H(e.position,d,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>FA)return null}const a=Qt(s),l=e.hunger/sn;return(a+l)/2*.6},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[G.Success,"Prey is dead"];const s=H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[G.Running,"Chasing prey"]:[G.Running,"Attacking prey"]}}),nb=ht({type:ae.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="predator"||i.hitpoints<=0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState))return null;const s=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(Qt(s)+.3)/1.3},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[G.Failure,"Too injured to continue"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[G.Success,"Predator eliminated"];const s=H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[G.Running,"Chasing predator"]:[G.Running,"Fighting predator"]}});function ib(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,G.Failure;const a=H(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?Sn:ho;return a<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,G.Success):(t.activeAction="moving",t.target=s.id,t.direction=$e(t.position,s.position,e.mapDimensions),G.Running)}const ob=ht({type:ae.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const i=`player-command-${e.id}`;n[i]={id:i,type:ae.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t)=>t.type===ae.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return[G.Failure,"No active autopilot action"];switch(s.action){case se.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,G.Failure;const l=s.position;return H(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<HA?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[G.Success,"Reached target position"]):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),[G.Running,"Moving to target"])}case se.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Target entity not found"];let d=!1;if(l.type==="berryBush")d=l.food.length===0;else if(l.type==="corpse")d=l.food.length===0;else if(l.type==="tree"){const f=l;d=f.stateMachine[0]!==Gt||f.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target type"];return d?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Target is depleted"]):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Yr?(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"At target, gathering",Od(t,i.time)])}case se.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target entity"];const[d]=l.stateMachine??[];return!(d===ln||d===Kt||d===An)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Tree is not standing or human is holding an item"]):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Ql?(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"At tree, chopping",Od(t,i.time)])}case se.AutopilotAttack:return"targetEntityId"in s?ib(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,G.Failure);case se.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="human"||!or(t,l,i))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target for procreation"];const d=H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height);return l.isPregnant||t.isPregnant?t.gender==="male"&&l.pregnancyFatherId!==t.id?[G.Failure,"Target is pregnant by another"]:[G.Success,"Procreation conditions met"]:d<=Vs?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,[G.Running,"Procreating"]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to procreation target"])}case se.AutopilotPlant:{if(t.activeAction==="planting")return[G.Running,"Planting"];if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No position specified"];const l=s.position;return zn(l,i,Qo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Position is occupied"]):H(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<=Vs?(t.activeAction="planting",t.target=l,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,[G.Running,"Planting"]):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),[G.Running,"Moving to planting target"])}case se.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target for feeding child"]):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Vs?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[G.Success,"Feeding child"]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to feeding target"])}case se.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.buildingType!==ce.StorageSpot&&l.buildingType!==ce.Bonfire||!l.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"];const d=l.storageCapacity??0;if(l.storedItems.length>=d)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Storage is full"];if(t.leaderId!==l.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Human does not belong to the same tribe as the building"];const f=t.food.length>0,g=!!t.heldItem;if(l.buildingType===ce.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==yt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Bonfires only accept wood"]}else if(!f&&!g)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No items to deposit"];return H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Depositing items",Od(t,i.time)]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to deposit target"])}case se.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.buildingType!==ce.StorageSpot||!l.isConstructed||l.storedItems.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"]):t.leaderId!==l.ownerId?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Storage is full"]):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Retrieving items",Od(t,i.time)]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to retrieve target"])}case se.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Only leaders can take over buildings"]):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="takingOverBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Taking over building"]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to takeover target"])}case se.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Only leaders can remove enemy buildings"]):H(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="destroyingBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to removal target"])}case se.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,G.Failure;const l=s.position,d=s.buildingType;if(!d)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No building type specified"];const u=H(t.position,l,i.mapDimensions.width,i.mapDimensions.height),f=100;return u<=f?ca(l,d,t.leaderId,i,t.position,f)?(qo(l,d,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[G.Success,"Building placed"]):(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),[G.Running,"Moving to placement target"])}default:return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Unknown or unhandled action"]}}}),rb=ht({type:ae.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:n}=t,i={},s=ri(e.position.x,e.position.y,n),a=s!==null&&s!==e.leaderId&&Gi(e.leaderId,s,n),l=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(a||l){const d=`attack-human-${e.id}`;i[d]={id:d,type:ae.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:n.time+bt}}return i},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="human"||i.hitpoints<=0||i.id===e.id||i.leaderId===e.leaderId)return null;const{gameState:s}=n,a=qr(e,i,s),l=ri(i.position.x,i.position.y,s)===e.leaderId,d=i.activeAction==="attacking"&&i.attackTargetId!==void 0;if(!a&&!d)return null;let u=.5;const f=H(e.position,i.position,s.mapDimensions.width,s.mapDimensions.height),g=Qt(f);return l&&a&&(u+=.1),(g+u)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[G.Success,"Target eliminated"];const s=H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[G.Running,"Chasing human target"]:[G.Running,"Fighting human target"]}}),sb=ht({type:ae.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,n)=>{if(typeof t.target!="number"||rT(n.gameState.time)>.5)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.buildingType!==ce.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0||e.leaderId!==i.ownerId)return null;const s=nr(n.gameState.temperature,e.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=co+5;if(s>=a)return null;const l=(a-s)/15,d=(1-e.hitpoints/e.maxHitpoints)*.8,u=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),f=Qt(u);let g=(l+d+f)/2;return e.hitpoints/e.maxHitpoints<.2&&s<co&&(g=Math.max(g,1.2)),g},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.buildingType!==ce.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0)return G.Failure;const s=nr(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=co+5;if(s>=a)return t.activeAction="idle",[G.Success,"Comfortable temperature reached"];const l=t.id*137%360*(Math.PI/180),d=Fr*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,g={x:(i.position.x+Math.cos(l)*d+u)%u,y:(i.position.y+Math.sin(l)*d+f)%f},m=H(t.position,g,u,f);return m>10?(t.activeAction="moving",t.target=g,t.direction=$e(t.position,g,n.gameState.mapDimensions),[G.Running,`Moving to warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[G.Running,"Staying warm at bonfire"])}}),ab=ht({type:ae.HumanFlee,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hitpoints<e.maxHitpoints*ou){const i=eI(e.id,t.gameState);if(i){const s=`flee-task-${e.id}`;n[s]={id:s,type:ae.HumanFlee,position:e.position,creatorEntityId:e.id,target:i.id,validUntilTime:t.gameState.time+bt}}}return n},scorer:(e,t,n)=>typeof t.target!="number"||!n.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*ou?.9:null,executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i)return t.activeAction="idle",t.attackTargetId=void 0,G.Success;if(H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Bg)return t.activeAction="idle",t.target=void 0,G.Success;t.activeAction="moving",t.attackTargetId=void 0;const a=Xe(i.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=ot(a),d=oi(t.position,At(l,Bg));return t.target={x:(d.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(d.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=l,G.Running}}),lb=ht({type:ae.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(!e.leaderId||e.id===e.leaderId)return i;const s=vn(e.leaderId,n),a=`stay-near-tribe-${e.id}`;return i[a]={id:a,type:ae.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:n.time+bt},i},scorer:(e,t,n)=>{if(!e.leaderId||e.id===e.leaderId)return null;const i=vn(e.leaderId,n.gameState),s=H(e.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=RS)return null;const a=s-RS;return Math.min(.95,.5+a/1e3*n1)},executor:(e,t,n)=>{if(!t.leaderId)return G.Failure;const i=vn(t.leaderId,n.gameState),s=H(t.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<o1?(t.activeAction="idle",t.target=void 0,G.Success):(t.activeAction="moving",t.target=i,t.direction=$e(t.position,i,n.gameState.mapDimensions),[G.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),cb=ht({type:ae.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(e.isAdult)return i;const s=Wg(e,n);if(!s)return i;const a=`stay-near-parent-${e.id}`;return i[a]={id:a,type:ae.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:n.time+bt},i},scorer:(e,t,n)=>{if(e.isAdult)return null;const i=Wg(e,n.gameState);if(!i||i.id!==t.target||e.leaderId&&_p(e.leaderId,n.gameState)&&ri(i.position.x,i.position.y,n.gameState)!==e.leaderId)return null;const s=H(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=PS)return null;const a=s-PS;return Math.min(.98,.6+a/500*i1)},executor:(e,t,n)=>{if(typeof e.target!="number")return t.activeAction="idle",G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="human")return t.activeAction="idle",t.target=void 0,G.Failure;const s=H(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<=r1?(t.activeAction="idle",t.target=void 0,G.Success):(t.activeAction="moving",t.target=i.id,t.direction=$e(t.position,i.position,n.gameState.mapDimensions),[G.Running,`Returning to parent (${Math.round(s)}px away)`])}}),Yu=[UO,HO,GO,$O,xO,WO,zO,jO,XO,VO,KO,qO,ZO,QO,JO,eb,tb,nb,ob,rb,sb,ab,lb,cb].reduce((e,t)=>(e[t.type]=t,e),{}),db=Object.values(Yu);function ub(e,t){ic(e,t,db)}function fb(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const i=qg(e);if(i){const s=t.gameState.tasks[i];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),js(e,null)}return}let n=qg(e);if(n){const i=t.gameState.tasks[n];(!i||i.claimedByEntityId&&i.claimedByEntityId!==e.id)&&(js(e,null),n=null)}if(!n){const i=hb(e,t);if(i&&t.gameState.tasks[i]){const s=t.gameState.tasks[i];n=i,js(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const i=t.gameState.tasks[n];i?FO(e,i,t,Yu):js(e,null)}}function hb(e,t){let n=null,i=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=Yu[a.type];if(!l||!l.scorer)continue;const d=l.scorer(e,a,t);d!==null&&d>i&&(i=d,n=a.id)}return i>0?n:null}const ST=NO();function gb(e,t){const n=performance.now();switch(e.aiType){case $t.TaskBased:fb(e,t);break;case $t.BehaviorTreeBased:default:zp(e,t,ST);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}function pb(){return new cn([rO(1),dO(1),uO(1),sO(1),aO(1),TO(1),gT(1)],"Prey Behavior Root",0)}function mb(){return new cn([pO(1),mO(1),AO(1),IO(1),CO(1),yO(1),EO(1),gT(1)],"Predator Behavior Root",0)}const yb=(e,t)=>{const n={};for(let i=0;i<$u;i++){const s=`hunt-prey-${e.id}-${i}`;n[s]={id:s,type:ae.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},Sb=(e,t)=>{const n={};if(e.hitpoints<=0)return n;const i=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((i==null?void 0:i.type)==="human"))return n;for(let a=0;a<LA;a++){const l=`hunt-predator-${e.id}-${a}`;n[l]={id:l,type:ae.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},vb={[ae.HumanHuntPrey]:{type:ae.HumanHuntPrey,producer:yb},[ae.HumanHuntPredator]:{type:ae.HumanHuntPredator,producer:Sb}};function gu(e,t){ic(e,t,Object.values(vb))}const vT=pb();function Ab(e,t){switch(e.aiType){case $t.TaskBased:gu(e,t);break;case $t.BehaviorTreeBased:default:zp(e,t,vT);break}}const AT=mb();function Ib(e,t){switch(e.aiType){case $t.TaskBased:gu(e,t);break;case $t.BehaviorTreeBased:default:zp(e,t,AT);break}}const Tb=(e,t)=>{if(e.buildingType!==ce.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,i=Op(e);if(PI(e,n)>=i)return{};const a=n.search.tasks.byProperty("creatorEntityId",e.id).find(g=>g.type===ae.HumanPlantBush);if(a)return{[a.id]:a};const l=n.mapDimensions.width,d=n.mapDimensions.height,u=n.soilDepletion,f=10;for(let g=0;g<f;g++){const m=e.position.x+(Math.random()-.5)*e.width,S=e.position.y+(Math.random()-.5)*e.height,v={x:(m%l+l)%l,y:(S%d+d)%d};if(!Ui(u,v,l,d)&&!zn(v,n,Qo)){const I=`plant-bush-${e.id}`,A={id:I,type:ae.HumanPlantBush,position:v,creatorEntityId:e.id,target:v,validUntilTime:n.time+OO};return{[I]:A}}}return{}},Eb=(e,t)=>{const n={};if(e.buildingType===ce.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const i=`stockpile-${e.id}`;n[i]={id:i,type:ae.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},Cb=(e,t)=>{const n={};if(e.buildingType===ce.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*wp){const i=`fuel-bonfire-${e.id}`;n[i]={id:i,type:ae.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},_b=(e,t)=>{const n={};if(e.buildingType===ce.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let i=0;i<Gg;i++){const s=`seek-warmth-${e.id}-${i}`;n[s]={id:s,type:ae.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},wb=(e,t)=>{const n={};if(e.buildingType===ce.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(i=>i.item.itemType==="food")){const i=`retrieve-from-${e.id}`;n[i]={id:i,type:ae.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},Rb={[ae.HumanPlantBush]:{type:ae.HumanPlantBush,producer:Tb},[ae.HumanStockpile]:{type:ae.HumanStockpile,producer:Eb},[ae.HumanFuelBonfire]:{type:ae.HumanFuelBonfire,producer:Cb},[ae.HumanSeekWarmth]:{type:ae.HumanSeekWarmth,producer:_b},[ae.HumanRetrieve]:{type:ae.HumanRetrieve,producer:wb}};function IT(e,t){ic(e,t,Object.values(Rb))}function Pb(e,t){const{gameState:n,deltaTime:i}=t,s=i*(Ct/Dt);if(e.isBeingDestroyed){const a=c_(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){const l=e.buildingType===ce.PlantingZone;Qr(n.entities,e.id),l&&Fl(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=l_(e.buildingType);a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&QA(e.position,sa,e.ownerId,n),e.buildingType===ce.PlantingZone&&Fl(n))}if(e.buildingType===ce.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*p1,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*m1)){const a=e.storedItems.findIndex(l=>l.item.itemType==="item"&&l.item.type===yt.Wood);a!==-1&&(e.storedItems.splice(a,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+iI))}IT(e,t)}function Db(e,t){const n=t.deltaTime*Ct/Dt;if(e.age+=n,!e.stateMachine)return;const[i]=e.stateMachine;i!==Gt&&i!==uo&&i!==Xr&&(e.age>=tr&&!e.woodGenerated&&(e.wood=Array.from({length:Gu},()=>({itemType:"item",type:yt.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=tc*Math.min(1,Math.max(.4,e.age/tr)))}const Nb={type:ae.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const i=`gather-berries-${e.id}`;n[i]={id:i,type:ae.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n}},Mb={type:ae.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===ln||i===Kt||i===An){const a=`chop-tree-${e.id}`;n[a]={id:a,type:ae.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n}},Ob={type:ae.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===Gt&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:ae.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n}},bb=[Nb,Mb,Ob].reduce((e,t)=>(e[t.type]=t,e),{});function fv(e,t){ic(e,t,Object.values(bb))}const kb={type:ae.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const i=`gather-meat-${e.id}`;n[i]={id:i,type:ae.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n}},Bb=[kb].reduce((e,t)=>(e[t.type]=t,e),{});function Fb(e,t){ic(e,t,Object.values(Bb))}var qd=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(qd||{});function hg(e,t,n){switch(n){case 0:Lb(e,t);break;case 1:Ub(e,t);break;case 2:Hb(e,t);break}}function Lb(e,t){e.forces.push(At(e.velocity,-.1));const n=At(ot(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(i=>{t.gameState.time-i.startTime<i.duration&&i.type==="slow"&&(e.velocity=At(e.velocity,.5))}),e.debuffs=e.debuffs.filter(i=>t.gameState.time-i.startTime<i.duration),e.velocity=oi(e.velocity,e.forces.reduce(oi,{x:0,y:0})),Js(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=oi(e.position,At(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&Js(e.velocity)>.1&&xP(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?VN(e,t,t.deltaTime):e.type==="corpse"?KN(e,t):e.type==="prey"?qN(e,t,t.deltaTime):e.type==="predator"?ZN(e,t,t.deltaTime):e.type==="building"?Pb(e,t):e.type==="tree"?Db(e,t):e.type,e.stateMachine&&(e.stateMachine=zN(...e.stateMachine,{entity:e,updateContext:t}))}function Ub(e,t){TT(e,t)&&(e.type==="human"?ub(e,t):e.type==="corpse"?Fb(e,t):e.type==="prey"||e.type==="predator"?gu(e,t):e.type==="building"?IT(e,t):(e.type==="tree"||e.type==="berryBush")&&fv(e,t))}function Hb(e,t){TT(e,t)&&(E.cleanupOldEntries(e.aiBlackboard,t.gameState.time),e.type==="human"?gb(e,t):e.type==="corpse"||(e.type==="prey"?Ab(e,t):e.type==="predator"?Ib(e,t):e.type==="building"||e.type==="tree"||e.type),E.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function TT(e,t){const n=E.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-n+(Math.random()-Math.random())*aa/10>aa}function Gb(e){const t=e.gameState.entities.entities;for(const n in t)hg(t[n],e,qd.Physics);for(const n in t)hg(t[n],e,qd.PrepareAI);i_(e.gameState);for(const n in t)hg(t[n],e,qd.ExecuteAI)}function ET(){return{entities:{},nextEntityId:1}}function Zr(e,t,n){const i={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:E.create(),...n};return e.entities[i.id]=i,i}function oc(e,t,n){return Zr(e,"berryBush",{position:t,radius:bg,food:Array.from({length:Cw},()=>({itemType:"food",type:In.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:Ew,lifespan:ww,age:0,spreadRadius:bg,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:E.create(),stateMachine:[_l,{enteredAt:n,previousState:void 0}]})}function Kl(e,t,n,i=0){const s=i>=tr;return Zr(e,"tree",{position:t,radius:tc,age:i,lifespan:wN,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:BN,stateMachine:[ln,{enteredAt:n,previousState:void 0}],aiBlackboard:E.create(),wood:s?Array.from({length:Gu},()=>({itemType:"item",type:yt.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function Xs(e,t,n,i,s=!1,a=Ww,l=kA,d,u,f=[],g,m,S=$t.TaskBased){const v=a>=mp;return Zr(e,"human",{position:t,radius:v?_t:pa,hunger:l,hitpoints:IS,maxHitpoints:IS,age:a,gender:i,isPlayer:s,food:[],maxFood:bA,maxAge:Gl,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:d,fatherId:u,ancestorIds:f,stateMachine:[mt,{enteredAt:n,previousState:void 0}],leaderId:g,tribeInfo:m,aiType:S,aiBlackboard:E.create()})}function Vp(e,t,n,i,s,a,l,d,u,f,g){let m,S;switch(l){case"human":m=BA,S=an;break;case"prey":m=2,S=120;break;case"predator":m=4,S=140;break}return Zr(e,"corpse",{position:t,radius:s,gender:n,age:i,originalEntityId:a,originalEntityType:l,timeOfDeath:d,decayProgress:0,geneCode:g,food:[...Array.from({length:Math.max(m*Math.max(S-f,0)/S,0)},()=>({itemType:"food",type:In.Meat})),...u].map(I=>({...I,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:E.create()})}function $b(e,t,n,i,s,a,l,d,u){return Vp(e,t,n,i,s,a,"human",l,d,u)}function xb(e,t,n,i,s,a,l,d){return Vp(e,t,n,i,s,a,"prey",l,[],0,d)}function Wb(e,t,n,i,s,a,l,d){return Vp(e,t,n,i,s,a,"predator",l,[],0,d)}function Yb(e,t,n){const i=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=i?[...i.ancestorIds||[],i.id]:[],l=[...s,...a],d=[...new Set(l)],u=d.slice(Math.max(d.length-OA,0)),f=Math.random()<.5?"male":"female",g=oi(e.position,{x:5,y:5}),m=Xs(n.gameState.entities,g,n.gameState.time,f,!1,0,kA/2,e.id,t,u,(i==null?void 0:i.leaderId)??e.leaderId,(i==null?void 0:i.tribeInfo)??e.tribeInfo,e.aiType);return Me(n,_e.Birth,e.position),m}function Qr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function fa(e,t,n,i=QD,s=KI,a,l,d,u=$t.BehaviorTreeBased){const f=i>=Ml,g=Date.now();return Zr(e,"prey",{position:t,radius:f?_t*.7:pa*.7,hunger:s,hitpoints:KS,maxHitpoints:KS,age:i,maxAge:VI,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:d,stateMachine:[mi,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:E.create()})}function ha(e,t,n,i=sN,s=ZI,a,l,d,u=$t.BehaviorTreeBased){const f=i>=Ol,g=Date.now();return Zr(e,"predator",{position:t,radius:f?_t*.9:pa*.9,hunger:s,hitpoints:qS,maxHitpoints:qS,age:i,maxAge:qI,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:d,stateMachine:[mn,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:E.create()})}function zb(e,t,n,i){const s=op(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:i,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:_D,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===ce.Bonfire?Lr:void 0,maxFuelLevel:n===ce.Bonfire?Lr:void 0,aiBlackboard:E.create(),stateMachine:["",{enteredAt:0}]};return Zr(e,"building",a)}var gn=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(gn||{}),Wr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(Wr||{}),pn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(pn||{});const Zg={},Qg={},jb=[{key:gn.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:gn.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>Gw,isCompleted:!1,minDisplayTime:US,highlightedUIElements:[Wr.HUNGER_BAR]},{key:gn.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!Be(t,e,"berryBush",ze*5,i=>i.food.length>0),getTargets:(e,t)=>{const n=[];for(const i of Object.values(e.entities.entities))i.type==="berryBush"&&i.food.length>0&&H(t.position,i.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(i);return n.map(i=>i.id)},isCompleted:!1,minDisplayTime:US},{key:gn.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=Be(t,e,"berryBush",ze,i=>i.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:gn.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[Wr.FOOD_BAR]},{key:gn.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>Mn(e,t).length>0,getTargets:(e,t)=>{const n=Be(t,e,"human",ze,i=>or(t,i,e));return n?[n.id]:[]},isCompleted:!1},{key:gn.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>Gp(e,t).some(i=>i.type===se.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:gn.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[Wr.COMMAND_BUTTONS],isCompleted:!1},{key:gn.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:gn.AUTOPILOT},{key:gn.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=Be(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=Be(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:gn.ANIMALS_INTRODUCTION},{key:gn.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!Be(t,e,"predator",120),getTargets:(e,t)=>{const n=Be(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:gn.HUNT_PREY}].map(e=>({...e,condition:e.condition?Kb(e.condition):void 0,getTargets:e.getTargets?qb(e.getTargets):void 0}));function CT(){return{steps:jb.map(e=>({...e,isCompleted:!1}))}}function _T(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:pn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function Xb(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function Vb(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const i=vt(e);if(!i){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/cP;switch(n.transitionState){case pn.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=pn.ACTIVE);break;case pn.ACTIVE:{const u=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),f=Zg[s.condition];f&&u&&f(e,i)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=pn.FADING_OUT);break}case pn.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const d=Xb(e);d!==null?(n.currentStepIndex=d,n.transitionState=pn.FADING_IN):(n.isActive=!1,n.transitionState=pn.INACTIVE)}break}if(n.transitionState!==pn.FADING_OUT&&n.transitionState!==pn.INACTIVE){const d=Qg[s.getTargets||""];d?n.highlightedEntityIds=[...d(e,i)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function Kb(e){const t=`condition_${Object.keys(Zg).length+1}`;return Zg[t]=e,t}function qb(e){const t=`getTargets_${Object.keys(Qg).length+1}`;return Qg[t]=e,t}function Zb(){const e=ET(),t=0;for(let S=0;S<EA;S++){const v={x:Math.random()*Ze,y:Math.random()*Qe};oc(e,v,t)}for(let S=0;S<TA;S++){const v={x:Math.random()*Ze,y:Math.random()*Qe};Kl(e,v,t)}const n=Ze/2,i=Qe/2;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,I=100+Math.random()*100,A={x:n+Math.cos(v)*I,y:i+Math.sin(v)*I};Kl(e,A,t,tr)}const s=Xs(e,{x:n-25,y:i},t,"male",!0),a=Xs(e,{x:n+25,y:i},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:xn[0]},s.aiType=$t.TaskBased,a.aiType=$t.TaskBased;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,I=Ze/2,A=Qe/2,_={x:n+Math.cos(v)*I,y:i+Math.sin(v)*A},R=Xs(e,{x:_.x,y:_.y},t,"male",!1);R.leaderId=R.id,R.tribeInfo={tribeBadge:au[S%au.length],tribeColor:xn[S%xn.length]};const P=Xs(e,{x:_.x+50,y:_.y},t,"female",!1);P.leaderId=R.id,P.tribeInfo=R.tribeInfo}for(let S=0;S<eT;S++){const v={x:n+Ze*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};fa(e,v,"male",void 0,void 0,Xl()),fa(e,{x:v.x+20,y:v.y},"female",void 0,void 0,Xl())}const l={x:n+Ze*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};ha(e,l,"male",void 0,void 0,Vl()),ha(e,{x:l.x+20,y:l.y},"female",void 0,void 0,Vl());const d=[{id:"muteButton",action:fe.ToggleMute,currentWidth:oo,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Ht},{id:"pauseButton",action:fe.TogglePause,currentWidth:oo,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Ht},{id:"returnToIntroButton",action:fe.ReturnToIntro,currentWidth:oo,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:Ht}],u=CT(),f=_T(),g={time:t,entities:e,mapDimensions:{width:Ze,height:Qe},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:LI,isMuted:!1,uiButtons:d,tutorial:u,tutorialState:f,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:zr.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:Ur,preyProcreationCooldown:Hr,predatorGestationPeriod:Gr,predatorProcreationCooldown:$r,preyHungerIncreasePerHour:jo,predatorHungerIncreasePerHour:Xo,berryBushSpreadChance:lo},soilDepletion:wA(),temperature:aT(Ze,Qe),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ze/Re)*Math.ceil(Qe/Re)).fill(null),tasks:{}},m=yu(g);return console.log("Game world initialized:",m),m}function Qb(){const e=ET(),t=0;for(let u=0;u<EA;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};oc(e,f,t)}for(let u=0;u<TA;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};Kl(e,f,t)}const n=Ze/2,i=Qe/2;for(let u=0;u<5;u++){const f=u/5*Math.PI*2,g=100+Math.random()*100,m={x:n+Math.cos(f)*g,y:i+Math.sin(f)*g};Kl(e,m,t,tr)}for(let u=0;u<Aw;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe},g=Math.random()<.5?"male":"female";Xs(e,f,t,g,!1)}for(let u=0;u<eT;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};fa(e,f,"male",void 0,void 0,Xl()),fa(e,{x:f.x+20,y:f.y},"female",void 0,void 0,Xl())}const s={x:Math.random()*Ze,y:Math.random()*Qe};ha(e,s,"male",void 0,void 0,Vl()),ha(e,{x:s.x+20,y:s.y},"female",void 0,void 0,Vl());const a=CT(),l=_T(),d={time:t,entities:e,mapDimensions:{width:Ze,height:Qe},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Ze/2,y:Qe/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:LI,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:l,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:Ur,preyProcreationCooldown:Hr,predatorGestationPeriod:Gr,predatorProcreationCooldown:$r,preyHungerIncreasePerHour:jo,predatorHungerIncreasePerHour:Xo,berryBushSpreadChance:lo},soilDepletion:wA(),temperature:aT(Ze,Qe),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ze/Re)*Math.ceil(Qe/Re)).fill(null),tasks:{}};return yu(d)}const Jb="humanProcreation",ek="human",tk="human",nk=ze,ik=(e,t,n)=>or(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,ok=(e,t,n)=>{const{gameState:i}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,l=e.gender==="female"?e:t,d=(a.partnerIds||[]).length===0;if(e.stateMachine[0]!==kr&&(e.stateMachine=[kr,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:n.gameState.time+1}]),t.stateMachine[0]!==kr&&(t.stateMachine=[kr,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),d&&a.leaderId&&a.leaderId!==a.id){const u=i.entities.entities[a.leaderId];if(u){const f=xg(a,u),g=xg(l,u);if(!f&&!g){const m=cu();a.leaderId=a.id,a.tribeInfo={tribeBadge:m,tribeColor:xn[Math.floor(Math.random()*xn.length)]},a.tribeRole=oe.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&l){const u=cu();a.leaderId=a.id,a.tribeInfo={tribeBadge:u,tribeColor:xn[Math.floor(Math.random()*xn.length)]},a.tribeRole=oe.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}e.activeAction=void 0,Ge(i,Ce.Procreation,s,Wl),Ge(i,Ce.Partnered,e.position,Ke,e.id),Ge(i,Ce.Partnered,t.position,Ke,t.id),e.lastPartneredEffectTime=i.time,t.lastPartneredEffectTime=i.time,t.activeAction=void 0,Me(n,_e.Procreate,s)},rk={id:Jb,sourceType:ek,targetType:tk,maxDistance:nk,checker:ik,perform:ok},sk={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:Ru,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Jo&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-Jo),e.feedChildCooldownTime=qw,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ce.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,_e.ChildFed,t.position)}},ak={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:Sn,checker:(e,t,n)=>{var g,m;if(e.stateMachine[0]!==er||e.attackTargetId!==t.id)return!1;const i=H(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=ho,a=!s&&i<=Sn;if(!s&&!a||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?Pu:Ap,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:i}=n,s=H(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>ho,l=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),d=e_(ot(l),t.direction);if(Math.abs(d)<cR*Math.PI/180&&Math.random()<dR)Ge(i,Ce.AttackDeflected,t.position,Ke,t.id);else{let g=a?vp:Sp;if(e.gender==="male"&&(g*=sR),e.isAdult||(g*=aR),(!t.isAdult||t.age>=yp)&&e.isAdult&&(g*=lR),a){const S=s/Ip;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+S,data:{attackerId:e.id,targetId:t.id,damage:g,pushbackForce:Ep,attackerPosition:{...e.position}}}),Ge(i,Ce.StoneProjectile,e.position,S,void 0,t.position,t.id),Me(n,_e.Attack,e.position)}else{t.hitpoints-=g,t.movementSlowdown={modifier:Nu,endTime:i.time+Mu},Ge(i,Ce.Hit,t.position,Ke,t.id);const S=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),v=At(S,nR);t.forces.push(v),t.hitpoints<=0?Me(n,_e.HumanDeath,t.position):Me(n,_e.Attack,e.position),Ge(i,Ce.Attack,e.position,Ke,e.id)}}e.attackCooldown={melee:Du,ranged:Tp};const f=e.stateMachine[1];f.attackStartTime=i.time}},lk={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:_t*2,checker:(e,t,{gameState:n})=>H(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const i=H(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(i===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const a=(e.radius+t.radius-i)*.05,l=ot(JC(e.position,t.position)),d=At(l,a);e.forces.push(d),t.forces.push(At(d,-1))}},ck={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:_t*.6+tc*.4,checker:(e,t,{gameState:n})=>{const i=t.stateMachine[0];if(i==="fallen"||i==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return H(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=H(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const d=l*2.5,u=ot(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=At(u,d);e.forces.push(f)}},dk={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:_t*.6+tc*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return H(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=H(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const d=l*2.5,u=ot(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=At(u,d);e.forces.push(f)}},uk={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:_t*.6+tc*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return H(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=H(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const d=l*2.5,u=ot(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=At(u,d);e.forces.push(f)}},fk={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:ze,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===ya&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Ge(n.gameState,Ce.BushClaimed,t.position,Ke),Me(n,_e.Gather,e.position)}},hk={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:ze,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===ya&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,Me(n,_e.Gather,e.position)}},gk={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:ze,checker:(e,t,n)=>e.isAdult&&t.stateMachine[0]===Gt&&t.wood.length>0&&e.stateMachine[0]===ya&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.wood.pop();i&&(e.heldItem=i),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[uo,{enteredAt:n.gameState.time,previousState:Gt}]),Me(n,_e.Gather,e.position)}},pk=[fk,hk,gk],mk={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:yn,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=tN,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+eN,Ge(n.gameState,Ce.BushClaimed,t.position,Ke,e.id),Me(n,_e.Gather,e.position))}},yk={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:ks,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=aN;const i=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=At(i,8);t.forces.push(s),e.huntCooldown=dN,t.hitpoints<=0?(Me(n,_e.HumanDeath,t.position),Ge(n.gameState,Ce.Hit,t.position,Ke,t.id)):(Ge(n.gameState,Ce.Hit,t.position,Ke,t.id),t.fleeCooldown=5,Me(n,_e.Attack,e.position)),Ge(n.gameState,Ce.Attack,e.position,Ke,e.id)}},Sk={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:Sn,checker:(e,t,n)=>{var g,m;if(e.stateMachine[0]!==er||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=H(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=ho,a=!s&&i<=Sn;if(!s&&!a||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?Pu:Ap,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:i}=n,s=H(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>ho;let l=(a?vp:Sp)*1.2;if(e.gender==="male"&&(l*=1.3),a){const u=s/Ip;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+u,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Ep,attackerPosition:{...e.position}}}),Ge(i,Ce.StoneProjectile,e.position,u,void 0,t.position,t.id),Me(n,_e.Attack,e.position)}else{t.hitpoints-=l;const u=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),f=At(u,6);t.forces.push(f),t.hitpoints<=0?(Me(n,_e.HumanDeath,t.position),Ge(i,Ce.Hit,t.position,Ke,t.id)):(Ge(i,Ce.Hit,t.position,Ke,t.id),t.fleeCooldown=8,Me(n,_e.Attack,e.position)),Ge(i,Ce.Attack,e.position,Ke,e.id)}e.attackCooldown={melee:Du,ranged:Tp};const d=e.stateMachine[1];d.attackStartTime=i.time}},vk={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:yi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=QI;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:Nu,endTime:n.gameState.time+Mu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=At(s,7);t.forces.push(a),e.attackCooldown=JI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-xp),Me(n,_e.HumanDeath,t.position),Ge(n.gameState,Ce.Hit,t.position,Ke,t.id)):(Ge(n.gameState,Ce.Hit,t.position,Ke,t.id),Me(n,_e.Attack,e.position)),Ge(n.gameState,Ce.Attack,e.position,Ke,e.id)}},Ak={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:Sn,checker:(e,t,n)=>{var g,m;if(e.stateMachine[0]!==er||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=H(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=ho,a=!s&&i<=Sn;if(!s&&!a||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?Pu:Ap,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:i}=n,s=H(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>ho;let l=(a?vp:Sp)*.8;e.gender==="male"&&(l*=1.2);const d=Object.values(i.entities.entities).filter(f=>f.type==="human"&&f.id!==e.id).filter(f=>{const g=f;return Math.sqrt(Math.pow(g.position.x-e.position.x,2)+Math.pow(g.position.y-e.position.y,2))<100&&g.activeAction==="attacking"&&g.attackTargetId===t.id}).length;if(d>0&&(l*=1+d*.2),a){const f=s/Ip;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+f,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Ep,attackerPosition:{...e.position}}}),Ge(i,Ce.StoneProjectile,e.position,f,void 0,t.position,t.id),Me(n,_e.Attack,e.position)}else{t.hitpoints-=l;const f=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),g=At(f,8);t.forces.push(g),t.hitpoints<=0?(Me(n,_e.HumanDeath,t.position),Ge(i,Ce.Hit,t.position,Ke,t.id)):(Ge(i,Ce.Hit,t.position,Ke,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),Me(n,_e.Attack,e.position)),Ge(i,Ce.Attack,e.position,Ke,e.id)}e.attackCooldown={melee:Du,ranged:Tp};const u=e.stateMachine[1];u.attackStartTime=i.time}},Ik={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:yn,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Ge(n.gameState,Ce.Procreation,i.position,Ke,i.id),Me(n,_e.Procreate,i.position)}},Tk={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:Zo,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.pregnancyFatherId=e.gender==="male"?e.id:t.id,i.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Ge(n.gameState,Ce.Procreation,i.position,Ke,i.id),Me(n,_e.Procreate,i.position)}},Ek={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:Sa,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=hu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-hu),e.feedChildCooldownTime=tT,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ce.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,_e.ChildFed,t.position)}},Ck={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:Sa,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=hu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-hu),e.feedChildCooldownTime=tT,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ce.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,_e.ChildFed,t.position)}},_k={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:Zo,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-xp),e.eatingCooldownTime=n.gameState.time+2,Ge(n.gameState,Ce.Eating,e.position,Ke,e.id),Me(n,_e.Gather,e.position))}},wk={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:yi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=QI;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:Nu,endTime:n.gameState.time+Mu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=At(s,7);t.forces.push(a),e.attackCooldown=JI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-xp),Me(n,_e.HumanDeath,t.position),Ge(n.gameState,Ce.Hit,t.position,Ke,t.id)):(Ge(n.gameState,Ce.Hit,t.position,Ke,t.id),Me(n,_e.Attack,e.position)),Ge(n.gameState,Ce.Attack,e.position,Ke,e.id)}},Rk={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>{var f;const i=t.buildingType===ce.StorageSpot,s=t.buildingType===ce.Bonfire;if(!i&&!s||e.stateMachine[0]!==Dl||!t.isConstructed)return!1;const a=e.food.length>0,l=((f=e.heldItem)==null?void 0:f.type)===yt.Wood;if(s&&!l||!a&&!l)return!1;const d=t.storageCapacity??0;return!(t.storedItems.length>=d||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<wD)},perform:(e,t,n)=>{var s;let i=null;if(t.buildingType===ce.Bonfire?((s=e.heldItem)==null?void 0:s.type)===yt.Wood&&(i=e.heldItem,e.heldItem=void 0):e.heldItem?(i=e.heldItem,e.heldItem=void 0):i=e.food.pop()??null,i&&(t.storedItems.push({item:i,positionOffset:fT(t)}),t.buildingType===ce.Bonfire)){const a=xt(e,n.gameState);a&&a.aiBlackboard&&cT(a.aiBlackboard,t.id,"wood")}t.lastDepositTime=n.gameState.time,Me(n,_e.StorageDeposit,t.position)}},Pk={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Nl||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<RD),perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&(e.food.push(i.item),fT(t)),t.lastRetrieveTime=n.gameState.time,Me(n,_e.StorageRetrieve,t.position)}},Dk={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>{var d;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==ya||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const i=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!i||!((d=i.tribeControl)!=null&&d.diplomacy)||(t.ownerId?i.tribeControl.diplomacy[t.ownerId]:void 0)!==Ut.Hostile||n.gameState.time-(t.lastStealTime??0)<PD)return!1;const l=jn({leaderId:t.ownerId},n.gameState);for(const u of l)if(H(e.position,u.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=DD)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&e.food.push(i.item),t.lastStealTime=n.gameState.time,Me(n,_e.StorageSteal,t.position),Ge(n.gameState,Ce.Attack,t.position,.5)}},Nk={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!Vt(e,t,n.gameState)||!KA(t.position,sa,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,JA(t.position,sa,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Ge(n.gameState,Ce.BushClaimed,t.position,2,t.id)}},Mk={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!Vt(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Ge(n.gameState,Ce.Hit,t.position,1,t.id)}},Ok={id:"supplyTransfer",sourceType:"human",targetType:"human",maxDistance:ze,checker:(e,t)=>!(e.activeAction!=="depositing"||t.activeAction!=="retrieving"||e.leaderId!==t.leaderId||e.food.length===0||t.food.length>=t.maxFood),perform:(e,t,n)=>{var l;const i=Math.min(((l=e.activeActionPayload)==null?void 0:l.amount)||1,e.food.length,t.maxFood-t.food.length),s=e.food.splice(0,i);t.food.push(...s);const a=xt(t,n.gameState);a&&a.aiBlackboard&&cT(a.aiBlackboard,t.id,"food"),e.activeAction="idle",e.target=void 0,e.activeActionPayload=void 0,t.activeAction="idle",t.target=void 0,Me(n,_e.StorageDeposit,t.position)}},bk={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:_u,checker:(e,t,n)=>{const[i]=t.stateMachine??[],s=i===ln||i===Kt||i===An;return e.isAdult&&s&&e.stateMachine[0]===$p&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const{gameState:i}=n;if(t.stateMachine=[Gt,{enteredAt:i.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/tr),a=Math.floor(QS+s*(Gu-QS));t.wood=Array.from({length:a},()=>({itemType:"item",type:yt.Wood,id:i.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=i.time+1,Me(n,_e.Gather,e.position)}},kk=[lk,ck,dk,uk,...pk,rk,sk,ak,Rk,Pk,Dk,Nk,Mk,Ok,bk,mk,Ek,Ck,_k,yk,Sk,Ak,vk,wk,Ik,Tk],hv=Object.values(kk.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const i={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[n].interactions.push(i),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));let gv=0;function Bk(e){const{gameState:t}=e,n=t,{width:i,height:s}=t.mapDimensions;gv++;const a=gv%2===0;for(let l=0;l<hv.length;l++){const d=hv[l],u=n.search[d.sourceType].all();for(let f=0;f<u.length;f++){const g=u[f],m=n.search[d.targetType].byRadius(g.position,d.maxDistance);for(let S=0;S<m.length;S++){const v=m[S];if(g.id===v.id)continue;const I=Nn(g.position,v.position,i,s);for(let A=0;A<d.interactions.length;A++){const _=d.interactions[A];!_.isCollision&&a||I<=_.maxDistanceSq&&_.checker(g,v,e)&&_.perform(g,v,e)}}}}}function wT(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function Fk(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),i=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=50+Math.random()*100;a={x:Math.max(50,Math.min(Ze-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*g))}}else a={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let l=!0;const d=100;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){l=!1;break}if(l){for(const u of i)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){l=!1;break}}if(l)return a}return{x:Ze*.3+Math.random()*Ze*.4,y:Qe*.3+Math.random()*Qe*.4}}function Lk(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=100+Math.random()*150;a={x:Math.max(50,Math.min(Ze-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*g))}}else a={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let l=!0;const d=150;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){l=!1;break}if(l)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Ze,y:50+Math.random()*100};case 1:return{x:Ze-150+Math.random()*100,y:Math.random()*Qe};case 2:return{x:Math.random()*Ze,y:Qe-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Qe}}}function Uk(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let i=0;i<20;i++){const s={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let a=!0;const l=80,d=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<l){a=!1;break}if(a){for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<d){a=!1;break}}if(a)return s}return{x:Math.random()*Ze,y:Math.random()*Qe}}function RT(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=Fk(n),a=i%2===0?"male":"female";fa(e.entities,s,a,void 0,void 0,Xl())}}function PT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=Lk(n),a=i%2===0?"male":"female";ha(e.entities,s,a,void 0,void 0,Vl())}}function Hk(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count();let s=!1;return n===0&&(RT(e,6),s=!0),i===0&&(PT(e,3),s=!0),s}function Gk(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const l=Math.max(2,Math.floor(8-n));RT(e,l),a=!0}if(i>0&&i<2){const l=Math.max(1,Math.floor(3-i));PT(e,l),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let l=0;l<5;l++){const d=Uk(t);oc(e.entities,d,e.time)}a=!0}return a}const $k=1,xk=.3,Wk=.8,pv=.8,Yk=.99,zk=.05;var DT=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.NO_ACTION=14]="NO_ACTION",e))(DT||{});const gg=Object.keys(DT).length/2;class jk{constructor(){De(this,"qTable",new Map);De(this,"epsilon",pv);De(this,"lastState",null);De(this,"lastAction",null)}discretizeState(t,n,i){const s=Math.min(4,Math.floor(t/25)),a=Math.min(4,Math.floor(n/5)),l=Math.min(4,Math.floor(i/15));return`${s}-${a}-${l}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,i){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,i)}getBestAction(t){let n=0,i=this.getQValue(t,0);for(let s=1;s<gg;s++){const a=this.getQValue(t,s);a>i&&(i=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*gg):this.getBestAction(t)}applyEmergencyCorrections(t,n,i,s){t<ro*.5&&(s.ecosystem.preyGestationPeriod=Math.max(Gs,s.ecosystem.preyGestationPeriod*.8),s.ecosystem.preyProcreationCooldown=Math.max($s,s.ecosystem.preyProcreationCooldown*.8),s.ecosystem.preyHungerIncreasePerHour=Math.max(Ys,s.ecosystem.preyHungerIncreasePerHour*.9)),n<so*.6&&(s.ecosystem.predatorGestationPeriod=Math.max(xs,s.ecosystem.predatorGestationPeriod*.75),s.ecosystem.predatorProcreationCooldown=Math.max(Ws,s.ecosystem.predatorProcreationCooldown*.75),s.ecosystem.predatorHungerIncreasePerHour=Math.max(zs,s.ecosystem.predatorHungerIncreasePerHour*.85)),i<ao*.5&&(s.ecosystem.berryBushSpreadChance=Math.min(vl,s.ecosystem.berryBushSpreadChance*1.2)),t>ro*1.4&&(s.ecosystem.preyHungerIncreasePerHour=Math.min(jo,s.ecosystem.preyHungerIncreasePerHour*1.05)),n>so*1.4&&(s.ecosystem.predatorHungerIncreasePerHour=Math.min(Xo,s.ecosystem.predatorHungerIncreasePerHour*1.05)),i>ao*1.4&&(s.ecosystem.berryBushSpreadChance=Math.max(lo,s.ecosystem.berryBushSpreadChance*.95))}calculateReward(t,n,i){const s=Math.abs(t-ro),a=Math.abs(n-so),l=Math.abs(i-ao),d=s/ro,u=a/so,f=l/ao,g=d+u+f;return 100*Math.exp(-g*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(Ur,n.ecosystem.preyGestationPeriod+.2*(Ur-Gs));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(Gs,n.ecosystem.preyGestationPeriod-.2*(Ur-Gs));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(Hr,n.ecosystem.preyProcreationCooldown+.2*(Hr-$s));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max($s,n.ecosystem.preyProcreationCooldown-.2*(Hr-$s));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(jo,n.ecosystem.preyHungerIncreasePerHour+.2*(jo-Ys));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(Ys,n.ecosystem.preyHungerIncreasePerHour-.2*(jo-Ys));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(Gr,n.ecosystem.predatorGestationPeriod+.2*(Gr-xs));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max(xs,n.ecosystem.predatorGestationPeriod-.2*(Gr-xs));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min($r,n.ecosystem.predatorProcreationCooldown+.2*($r-Ws));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(Ws,n.ecosystem.predatorProcreationCooldown-.2*($r-Ws));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(Xo,n.ecosystem.predatorHungerIncreasePerHour+.2*(Xo-zs));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(zs,n.ecosystem.predatorHungerIncreasePerHour-.2*(Xo-zs));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(vl,n.ecosystem.berryBushSpreadChance+.2*(vl-lo));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(lo,n.ecosystem.berryBushSpreadChance-.2*(vl-lo));break}}updateQTable(t,n,i,s){const a=this.getQValue(t,n),l=Math.max(...Array.from({length:gg},(u,f)=>this.getQValue(s,f))),d=a+xk*(i+Wk*l-a);this.setQValue(t,n,d)}step(t){const n=t,i=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count();this.applyEmergencyCorrections(i,s,a,t);const l=this.discretizeState(i,s,a);if(this.lastState!==null&&this.lastAction!==null){const u=this.calculateReward(i,s,a);this.updateQTable(this.lastState,this.lastAction,u,l)}const d=this.chooseAction(l);this.applyAction(d,t),this.epsilon=Math.max(zk,this.epsilon*Yk),this.lastState=l,this.lastAction=d}reset(){this.qTable.clear(),this.epsilon=pv,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let NT=new jk;function Xk(e){Hk(e),Gk(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=Gs+(Ur-Gs)*.3,e.ecosystem.preyProcreationCooldown=$s+(Hr-$s)*.3,e.ecosystem.preyHungerIncreasePerHour=Ys+(jo-Ys)*.3,e.ecosystem.predatorGestationPeriod=xs+(Gr-xs)*.3,e.ecosystem.predatorProcreationCooldown=Ws+($r-Ws)*.3,e.ecosystem.predatorHungerIncreasePerHour=zs+(Xo-zs)*.3,e.ecosystem.berryBushSpreadChance=lo+(vl-lo)*.7),NT.step(e)}function Vk(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<$k)&&(e.ecosystem.lastUpdateTime=e.time,Xk(e))}function Kk(){return NT.getStats()}function qk(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function Zk(e){const{gameState:t}=e,n=t.time,i=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of i)switch(a.type){case"ranged-impact":{const l=t.entities.entities[a.data.targetId];if(!l||l.hitpoints<=0)continue;l.hitpoints-=a.data.damage,l.movementSlowdown={modifier:Nu,endTime:t.time+Mu};const d=Xe(a.data.attackerPosition,l.position,t.mapDimensions.width,t.mapDimensions.height),u=At(d,a.data.pushbackForce);l.forces.push(u),Ge(t,Ce.Hit,l.position,Ke,l.id),l.hitpoints<=0?Me(e,_e.HumanDeath,l.position):Me(e,_e.Attack,l.position);break}}}const MT="ownedIndices",mv="frontierScanIndex",bl="frontierCandidates";function Qk(e){const{gameState:t}=e,n=t,s=n.search.human.all().filter(f=>f.leaderId===f.id),{width:a,height:l}=t.mapDimensions,d=Math.ceil(a/Re),u=Math.ceil(l/Re);for(const f of s){if(!f.aiBlackboard)continue;const g=E.get(f.aiBlackboard,MT)||[];if(g.length===0)continue;let m=E.get(f.aiBlackboard,mv)||0;const S=E.get(f.aiBlackboard,bl)||{},v=vn(f.id,t),I=20;for(let _=0;_<I;_++){m>=g.length&&(m=0);const R=g[m];m=(m+1)%g.length;const P=R%d,w=Math.floor(R/d),b=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:N,dy:D}of b){const M=(P+N+d)%d,k=(w+D+u)%u,U=k*d+M,j=t.terrainOwnership[U],K=j!==null&&Gi(f.id,j,t);if(j===null||K){let X=0;for(const{dx:z,dy:ue}of b){const pe=(M+z+d)%d,Pe=(k+ue+u)%u;t.terrainOwnership[Pe*d+pe]===f.id&&X++}const J=X*20,Z=Ug(U,a),le=n.search.berryBush.byRadius(Z,100),re=n.search.tree.byRadius(Z,100),te=le.length*10+re.length*5,Y=K?50:0,q=H(Z,v,a,l)/100*5,F=J+te+Y-q;S[U.toString()]={score:F,fromIdx:R,lastSeenTime:t.time}}}}const A=Object.entries(S).sort((_,R)=>R[1].score-_[1].score);if(A.length>50){const _={};for(let R=0;R<50;R++){const[P,w]=A[R];_[P]=w}E.set(f.aiBlackboard,bl,_)}else E.set(f.aiBlackboard,bl,S);E.set(f.aiBlackboard,mv,m)}}function Jk(e){var m,S,v;const{gameState:t}=e,n=t,i=n.search.human.all(),s=new Map,a=new Set;for(let I=0;I<i.length;I++){const A=i[I];A.leaderId&&(s.has(A.leaderId)||s.set(A.leaderId,[]),s.get(A.leaderId).push(A),A.leaderId===A.id&&a.add(A.id))}const l=Object.values(t.tasks),d=new Map;for(let I=0;I<l.length;I++){const A=l[I];A.creatorEntityId&&(d.has(A.creatorEntityId)||d.set(A.creatorEntityId,[]),d.get(A.creatorEntityId).push(A))}const u=n.search.building.all(),f=new Map;for(let I=0;I<u.length;I++){const A=u[I];if(A.ownerId){const _=t.entities.entities[A.ownerId],R=_==null?void 0:_.leaderId;R&&(f.has(R)||f.set(R,[]),f.get(R).push(A))}}const g=new Map;for(const I of a)g.set(I,vn(I,t));for(const I of a){const A=t.entities.entities[I];if(!A)continue;const _=[];for(let k=0;k<t.terrainOwnership.length;k++)t.terrainOwnership[k]===I&&_.push(k);E.set(A.aiBlackboard,MT,_);const R=s.get(I)||[];if(R.length<kp)continue;const P=R.filter(k=>k.isAdult);if(P.length===0)continue;const w=d.get(I)||[],b=k=>w.some(U=>U.type===k),N=f.get(I)||[],D=[];for(const[k,U]of g.entries())k!==I&&D.push(U);if(!b(ae.HumanPlaceStorage)){const k=N.filter(J=>J.buildingType===ce.StorageSpot);let U=0,j=0;for(let J=0;J<k.length;J++){const Z=k[J];U+=((m=Z.storedItems)==null?void 0:m.length)||0,j+=Z.storageCapacity||0}const K=j>0?U/j:0;if(k.length===0||K>Fg){const J=k.length===0?WA:Ks,Z=qs(ce.StorageSpot,I,t,eo,J,A.position,D);Z&&bd(I,ae.HumanPlaceStorage,Z,t)}}if(!b(ae.HumanPlaceBonfire)){const k=N.filter(le=>le.buildingType===ce.Bonfire),U=g.get(I),K=nr(t.temperature,U,t.time,t.mapDimensions.width,t.mapDimensions.height)<oI&&k.length===0,X=k.length>0&&k.length<Math.ceil(P.length/rI);let J;const Z=R.filter(le=>nr(t.temperature,le.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<co+5?k.every(Y=>H(le.position,Y.position,t.mapDimensions.width,t.mapDimensions.height)>Fr*1.5):!1);if(Z.length>=3){const le=Z.reduce((te,Y)=>te+Y.position.x,0)/Z.length,re=Z.reduce((te,Y)=>te+Y.position.y,0)/Z.length;J={x:le,y:re}}if(K||X||J){const le=qs(ce.Bonfire,I,t,eo,Ks,J||A.position,D);le&&bd(I,ae.HumanPlaceBonfire,le,t)}}if(!b(ae.HumanPlacePlantingZone)){const U=N.filter(K=>K.buildingType===ce.PlantingZone&&RI(K,t)).reduce((K,X)=>K+Op(X),0),j=Math.max(Hs,P.length*Lg);if(U<j){const K=qs(ce.PlantingZone,I,t,eo,Ks,A.position,D);K&&bd(I,ae.HumanPlacePlantingZone,K,t)}}if((((v=(S=A.tribeControl)==null?void 0:S.armyControl)==null?void 0:v.expandBorders)??0)>=2){const k=E.get(A.aiBlackboard,bl)||{},{width:U,height:j}=t.mapDimensions,K=N.filter(Z=>Z.buildingType===ce.BorderPost),X=w.filter(Z=>Z.type===ae.HumanPlaceBorderPost);for(const Z in k){const le=parseInt(Z,10),re=t.terrainOwnership[le],te=re!==null&&Gi(A.id,re,t);if(re===I||re!==null&&!te){delete k[Z];continue}const Y=Ug(le,U);(K.some(q=>Nn(Y,q.position,U,j)<100*100)||X.some(q=>Nn(Y,q.position,U,j)<100*100))&&delete k[Z]}E.set(A.aiBlackboard,bl,k);const J=3;if(X.length<J){const Z=Object.entries(k).map(([Y,V])=>({idx:parseInt(Y,10),...V})).sort((Y,V)=>V.score-Y.score),le=[];for(const Y of Z){if(le.length>=J-X.length)break;const V=Ug(Y.idx,U);le.every(F=>Nn(V,F,U,j)>100*100)&&le.push(V)}const re=new Set(X.map(Y=>{const V=Y.id.split("-");return parseInt(V[V.length-1],10)}).filter(Y=>!isNaN(Y))),te=[];for(let Y=0;Y<J;Y++)re.has(Y)||te.push(Y);for(let Y=0;Y<le.length;Y++)bd(I,ae.HumanPlaceBorderPost,le[Y],t,te[Y])}}}}function bd(e,t,n,i,s=0){const a=`${ae[t]}-${e}-${s}`;i.tasks[a]={id:a,position:n,type:t,creatorEntityId:e,target:n,validUntilTime:i.time+12}}const eB=1/60;function tB(e,t){const n=vt(e);n&&(e.viewportCenter=np(e.viewportCenter,n.position,hp*t))}function zu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(sp(e),e.lastAutosaveTime=n)}for(;t>0;){const n=yu(e),i=Math.min(t,eB),s=i*(Ct/Dt);n.time+=s,tB(n,i),mR(n),kO(n),Vk(n),zP(n),XN(n),yR(n),Zk({gameState:n}),Gb({gameState:n,deltaTime:i}),Bk({gameState:n,deltaTime:i}),Qk({gameState:n}),Math.floor(n.time)>Math.floor(n.time-s)&&(bP(n),Jk({gameState:n})),wT(n),Vb(n,i),qk(n),e=n,t-=i}return e}function pg(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,d=uI;if(e.beginPath(),e.moveTo(i+d,s),e.lineTo(i+a-d,s),e.quadraticCurveTo(i+a,s,i+a,s+d),e.lineTo(i+a,s+l-d),e.quadraticCurveTo(i+a,s+l,i+a-d,s+l),e.lineTo(i+d,s+l),e.quadraticCurveTo(i,s+l,i,s+l-d),e.lineTo(i,s+d),e.quadraticCurveTo(i,s,i+d,s),e.closePath(),e.fillStyle=t.isDisabled?fI:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*mI)+1)/2;e.strokeStyle=pI,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<lu){const f=1-u/lu;e.fillStyle=gI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Dp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?hI:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function nB(e,t,n,i){e.save(),e.font=`${OS}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,l=OS,d=a+bS*2,u=l+bS*2,f=i.x-d/2,g=e.canvas.height,m=t.y<g/2?t.y+t.height-kS:t.y-u+kS;e.fillStyle=z1,e.fillRect(f,m,d,u),e.fillStyle=j1,e.fillText(n,i.x,m+u/2+l/2),e.restore()}function iB(e,t,n){e.save();const i=vt(t),s=[{id:"fastForwardButton",action:fe.FastForward,text:"FFWD [T]",currentWidth:oo*1.3,backgroundColor:Wo,textColor:Ht,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:fe.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?Id:Wo,currentWidth:t.isPaused?oo*1.4:oo*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:Ht},{id:"muteButton",action:fe.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?Id:Wo,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:oo,rect:{x:0,y:0,width:0,height:0},textColor:Ht},{id:"returnToIntroButton",action:fe.ReturnToIntro,text:"EXIT",backgroundColor:Wo,tooltip:"Return to Main Menu [ESC]",currentWidth:oo*.9,rect:{x:0,y:0,width:0,height:0},textColor:Ht}];if(t.uiButtons.push(...s),i){const f=Gp(t,i),g=new Set(f.map(P=>P.type));let m=[{playerAction:se.Gather,buttonAction:fe.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>i.isAdult===!0},{playerAction:se.Eat,buttonAction:fe.CommandEat,shortcut:"F",name:"Eat"},{playerAction:se.Plant,buttonAction:fe.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>i.isAdult===!0},{playerAction:se.Procreate,buttonAction:fe.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>i.isAdult===!0},{playerAction:se.FeedChild,buttonAction:fe.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>i.isAdult===!0},{playerAction:se.Attack,buttonAction:fe.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>i.isAdult===!0&&i.leaderId===i.id},{playerAction:se.ArmyControl,buttonAction:fe.OpenArmyControl,shortcut:"V",name:"Army Control",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Li(i.id,t).length>rD},{playerAction:se.TribeSplit,buttonAction:fe.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>i.leaderId!==void 0&&i.leaderId!==i.id&&i.isAdult===!0},{playerAction:se.Build,buttonAction:fe.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Li(i.id,t).length>kp},{playerAction:se.Build,buttonAction:fe.OpenRoleManager,shortcut:"U",name:"Roles",toggleKey:"roleManagement",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&xu(i,t)}];m=m.filter(P=>P.condition?P.condition():!0);const S=1,v=m.length,I=v*Un+(v-1)*Ir,A=S*Un+(S-1)*Ir,_=(n-I)/2,R=e.canvas.height-A-20;if(m.forEach((P,w)=>{const b=w%v,N=Math.floor(w/v),D=_+b*(Un+Ir),M=R+N*(Un+Ir),k=!!P.toggleKey,U=k&&t.autopilotControls.behaviors[P.toggleKey],j=!g.has(P.playerAction),X=P.playerAction===se.Build&&t.buildMenuOpen,J=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",Z=k?`${P.name}${J}`:P.name,le=U||X||P.buttonAction===fe.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)?Id:Wo,re={id:`commandButton_${P.name}`,action:P.buttonAction,rect:{x:D,y:M,width:Un,height:Un},icon:P.buttonAction===fe.OpenRoleManager?"":Fu[P.playerAction],text:P.shortcut,backgroundColor:le,textColor:Ht,currentWidth:Un,tooltip:Z,isDisabled:j,activated:U||P.buttonAction===fe.CommandBuild&&X||P.buttonAction===fe.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)};t.uiButtons.push(re)}),t.buildMenuOpen){const P=[{id:"buildMenu_storageSpot",action:fe.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:fe.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_bonfire",action:fe.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:fe.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:fe.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"}],w=P.length,b=w*Un+(w-1)*Ir,N=(n-b)/2,D=R-Un-Ir;P.forEach((M,k)=>{const U=N+k*(Un+Ir),j=D,K=M.action===fe.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||M.action===fe.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||M.action===fe.SelectBorderPost&&t.selectedBuildingType==="borderPost"||M.action===fe.SelectBonfire&&t.selectedBuildingType==="bonfire"||M.action===fe.SelectRemovalTool&&t.selectedBuildingType==="removal",X={id:M.id,action:M.action,rect:{x:U,y:j,width:Un,height:Un},icon:M.icon,text:M.shortcut,backgroundColor:K?Id:Wo,textColor:Ht,currentWidth:Un,tooltip:M.name,activated:K};t.uiButtons.push(X),pg(e,X,t.hoveredButtonId===X.id)})}}let a=n-et;s.forEach(f=>{const g=et,m=a-f.currentWidth;f.rect={x:m,y:g,width:f.currentWidth,height:dI},pg(e,f,t.hoveredButtonId===f.id),a-=f.currentWidth+Y1});let l=null;t.uiButtons.filter(f=>f.id.startsWith("commandButton_")||f.id.startsWith("buildMenu_")).forEach(f=>{l||(l={x:f.rect.x,y:f.rect.y,width:f.rect.width,height:f.rect.height}),l.x=Math.min(l.x,f.rect.x),l.y=Math.min(l.y,f.rect.y),l.width=Math.max(l.width,f.rect.x+f.rect.width-l.x),l.height=Math.max(l.height,f.rect.y+f.rect.height-l.y),f.id.startsWith("commandButton_")&&pg(e,f,t.hoveredButtonId===f.id)});const u=t.hoveredButtonId?t.uiButtons.find(f=>f.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&nB(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:l}}function oB(e){e.save(),e.fillStyle=tP,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=nP,e.font=`${iP}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function Jg(e,t,n,i){const s=t.x-n.width/2,a=t.y-n.height/2,l=s+e.x,d=a+e.y,u=(l%i.width+i.width)%i.width,f=(d%i.height+i.height)%i.height;return{x:u,y:f}}function rc(e,t,n,i){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>i.width/2&&(s=s-Math.sign(s)*i.width),Math.abs(a)>i.height/2&&(a=a-Math.sign(a)*i.height),{x:s+n.width/2,y:a+n.height/2}}function kl(e,t,n,i){const s=rc(e.position,t,n,i),l=("radius"in e?e.radius:20)+20;return s.x>=-l&&s.x<=n.width+l&&s.y>=-l&&s.y<=n.height+l}function ii(e,t,n,i,s,...a){const l={...s.position};for(let d=-n;d<=n;d+=n)for(let u=-t;u<=t;u+=t)s.position.x=l.x+u,s.position.y=l.y+d,i(e,s,...a);s.position=l}function OT(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const i=n.getContext("2d");if(!i)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:n,ctx:i}}function Zs(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function Vr(e,t){return Math.round(e*t)/t}function Kp(e,t=8){const i=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(i/(Math.PI*2)*t)%t}function qp(e,t=8){const n=e/t*Math.PI*2;return[Math.cos(n),Math.sin(n)]}const rB=25,sB=0,yv=28;function bT(e,t,n,i,s,a,l,d,u,f){e.save();const{x:g,y:m}=rc(t,l,{width:d,height:u},f);e.strokeStyle=i,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(g,m,n+Ou,0,2*Math.PI),e.stroke(),e.restore()}function aB(e,t,n,i,s,a,l){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&bT(e,m.targetEntity.position,m.targetEntity.radius,Rp,Pp,2,i,s,a,l)}),e.font=`${da}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:d,y:u}=rc(n.position,i,{width:s,height:a},l);let f=0,g={};t.forEach(m=>{const S=Fu[m.type];if(m.targetEntity){g[m.targetEntity.id]=(g[m.targetEntity.id]||0)+1;const v=m.targetEntity.position.x-i.x+s/2,I=m.targetEntity.position.y-i.y+a/2,A=`${S}${m.key.toUpperCase()}`,_=I-m.targetEntity.radius-Ou-da/2-(g[m.targetEntity.id]-1)*yv;e.fillText(A,v,_)}else{e.textAlign="left";const v=`${S}${m.key.toUpperCase()}`,I=d+rB,_=u+sB+f*yv;e.fillText(v,I,_),f++,e.textAlign="center"}}),e.restore()}const Le=(e,t,n,i,s,a,l)=>{a==="transparent"||i<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*l),Math.floor(n*l),Math.ceil(i*l),Math.ceil(s*l)))},Sv=10,vv=10,Ni=6,Qi=4,kd=2,lB=5,ni=4,cB=2,on=4,dB=2,ft=3,Ds=2,xo=0,Bl=xo+Qi-1,fn=Bl,Et=Bl+ni-1,uB="rgba(0, 0, 0, 0.4)",fB=4,hB=1,Zp={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,i,s,a,l,d="male",u=20,f=[1,0],g=!1,m=0){const S=["dead","stunned"].includes(l),v=S?vv+4:Sv,I=S?Sv+4:vv+ft,A=.15,_=Math.min(i*(1-2*A)/v,s*(1-2*A)/I),R=v*_,P=I*_,w=t+(i-R)/2,b=n+(s-P)/2;e.save(),f[0]<0&&!S?(e.translate(w+R,b),e.scale(-1,1)):e.translate(w,b);const D="#D09A5A",M=u>50?"#BDBDBD":"#281808",k="#7F5C4A",U="#6B4F3A",j="#E0D8C0",K="#A0522D",X=1-Math.max(0,Math.min(100,m))/100*.2,J=d==="male"?1.1:.9,Z=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let le=lB*X*J*Z,re=cB*X*J*Z,te=dB*X*Z;g&&d==="female"&&(le*=1.5);const Y=Math.round((v-le)/2),V=Math.round((v-Ni)/2),q=Y-re,F=Y+le,z=1,ue=Y+(le/2-z/2)-te,pe=Y+(le/2+z/2),Pe=f[1]<-.2&&Math.abs(f[0])<.7,ye=he=>{e.fillStyle=uB,e.beginPath();const ve=v/2,xe=he;e.ellipse(Math.floor(ve*_),Math.floor(xe*_),Math.max(1,Math.floor(fB*_)),Math.max(1,Math.floor(hB*_)),0,0,2*Math.PI),e.fill()},Oe=(he,ve)=>{d==="male"?(Le(e,Y,Bl+he,le,ni-Ds,ve,_),Le(e,Y,Bl+ni-Ds+he,le,Ds,k,_)):Le(e,Y,Bl+he,le,ni,U,_)},Ne=(he,ve)=>{Pe?Le(e,V,xo+he,Ni,Qi,M,_):(Le(e,V,xo+he,Ni,Qi,ve,_),Le(e,V,xo+he,Ni,kd,M,_),d==="female"?(Le(e,V-1,xo+kd+he,1,Qi,M,_),Le(e,V+Ni,xo+kd+he,1,Qi,M,_)):Le(e,V+1,xo+2+he,Ni-2,Qi-2,M,_))};switch(l){case"idle":{const he=a*Math.PI*2,ve=Math.sin(he)*.5,Te=(Math.cos(he*2)+1)*.25;ye(Et+ft+1),Le(e,ue+ve,Et+Te,te,ft,D,_),Le(e,pe-ve,Et+Te,te,ft,D,_),Oe(Te,D),Le(e,q,fn+Te,re,on,D,_),Le(e,F,fn+Te,re,on,D,_),Ne(Te,D);break}case"walk":{const he=a*Math.PI*2,ve=Math.sin(he)*2,Te=Math.abs(Math.cos(he))*1;ye(Et+ft+1),Le(e,ue+ve,Et+Te,te,ft,D,_),Le(e,pe-ve,Et+Te,te,ft,D,_),Oe(Te,D),Le(e,q-ve,fn+Te,re,on,D,_),Le(e,F+ve,fn+Te,re,on,D,_),Ne(Te,D);break}case"gathering":{const he=a*Math.PI*2,ve=1,xe=(Math.sin(he)+1)/2*2,Te=ve+Math.abs(Math.cos(he))*.5;ye(Et+ft+1),Le(e,ue,Et+Te,te,ft-ve,D,_),Le(e,pe,Et+Te,te,ft-ve,D,_),Oe(Te,D),Le(e,q+1,fn+Te-xe,re,on,D,_),Le(e,F-1,fn+Te-xe,re,on,D,_),Ne(Te,D);break}case"eat":{ye(Et+ft+1),Le(e,ue,Et+1,te,ft-1,D,_),Le(e,pe,Et+1,te,ft-1,D,_),Oe(1,D);const xe=(Math.sin(a*Math.PI*4)+1)/2,Te=V+Ni/2,ai=xo+Qi/2,nt=F+(Te-F)*xe,at=fn+1+(ai-(fn+1))*xe;Le(e,q,fn+1,re,on,D,_),Le(e,nt,at,re,on,D,_),Le(e,nt,at-1,1,1,K,_),Ne(1,D);break}case"procreate":{const he=(Math.sin(a*Math.PI*8)+1)/4,ve=(Math.sin(a*Math.PI*6)+1)*.5,xe=1.5,Te=xe-ve;ye(Et+ft+1),Le(e,ue,Et+Te,te,ft-xe,D,_),Le(e,pe,Et+Te,te,ft-xe,D,_),Oe(Te,D),Le(e,q,fn+Te,re,on,D,_),Le(e,F,fn+Te,re,on,D,_),Ne(Te,D),e.globalAlpha=he,Oe(Te,"white"),e.globalAlpha=1;break}case"attacking":{const he=Math.sin(a*Math.PI)*1.5,ve=Math.abs(Math.sin(a*Math.PI));ye(Et+ft+1),Le(e,ue-he,Et+ve,te,ft,D,_),Le(e,pe+he*.5,Et+ve,te,ft,D,_),Oe(ve,D),Le(e,q,fn+ve-2,re,on,D,_),Le(e,F,fn+ve-2.5,re,on,D,_),Ne(ve,D);break}case"defending":{ye(Et+ft+1),Le(e,ue,Et+1,te,ft-1,D,_),Le(e,pe,Et+1,te,ft-1,D,_),Oe(1,D),Le(e,q-1,fn+1-1,re,on,D,_),Le(e,F+1,fn+1-1,re,on,D,_),Ne(1,D);break}case"stunned":case"dead":{const he=l==="dead",ve=he?Math.min(1,a):0,xe=ve>.5?j:D,Te=d==="male"?k:U,ai=ve>.8?"transparent":M,nt=v/2,at=I/2,vi=2;ye(I-1),Le(e,nt-te-vi,at,te,ft,xe,_),Le(e,nt+vi,at,te,ft,xe,_),Le(e,nt-re-vi,at-ni+1,re,on,xe,_),Le(e,nt+vi,at-ni+1,re,on,xe,_);const Tn=nt-le/2,Xn=at-ni/2;d==="male"?(ve<.7&&Le(e,Tn,Xn+ni-Ds,le,Ds,Te,_),Le(e,Tn,Xn,le,ni-Ds,xe,_)):ve<.7?Le(e,Tn,Xn,le,ni,Te,_):Le(e,Tn,Xn,le,ni,xe,_);const Ai=nt-Ni/2,Ii=at-ni/2-Qi+1;if(Le(e,Ai,Ii,Ni,Qi,xe,_),ai!=="transparent"&&Le(e,Ai,Ii,Ni,kd,ai,_),he&&ve>.6){const go="#B0A890";for(let sr=0;sr<3;sr++)Le(e,Tn+1,Xn+sr*1+1,le-2,.5,go,_)}break}default:Le(e,0,0,v,I,"magenta",_);break}e.restore()}};function gB(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function ql(e,t,n,i,s,a=!1,l=!1,d=!1,u=!1){i<mp&&(n=n*.75),Zp.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,i,[0,0],!1,0);let f,g;a?(f=B1,g=sI):l?(f=F1,g=cI):d?(f=L1,g=lI):u&&(f=U1,g=aI),f&&g&&gB(e,t,n/2,f,g)}function pB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s,d=4;let u;const f=l+(i.length-1)*d;i.length>1&&f>a?u=(a-l)/(i.length-1):u=d,i.length<=1&&(u=0);for(let g=0;g<i.length;g++){const{member:m,isPlayer:S,isHeir:v,isPartner:I,isParent:A}=i[g],_=t+g*(s+u)+s/2,R=n+s/4;ql(e,{x:_,y:R},s,m.age,m.gender,S,v,I,A)}e.restore()}function mB(e,t,n,i,s){if(n.length===0)return;e.save();const a=Ri,l=" 00",d=" 00";e.font=`${Vh}px "Press Start 2P", Arial`;const u=e.measureText(l).width,f=e.measureText(d).width,g=Ri+ei+Ri+ei+Ri+Bo+u+Ri/2+Bo+f,m=n.length*Ad+(n.length-1)*NS,S=s-m-Ri;e.fillStyle=G1,e.fillRect(a,S,g,m);for(let v=0;v<n.length;v++){const I=n[v],A=S+v*(Ad+NS),_=A+Ad/2;I.isPlayerTribe&&(e.fillStyle=H1,e.fillRect(a,A,g,Ad));let R=a+Ri;if(e.font=`${ei}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillText(I.tribeBadge,R,_-ei/4),R+=ei+Ri,!I.isPlayerTribe){const P=I.diplomacyStatus===Ut.Friendly?"":"",w=`diplomacyButton_${I.leaderId}`,b={x:R-2,y:_-ei/2-2,width:ei+4,height:ei+4},N={id:w,action:fe.ToggleDiplomacy,rect:b,text:"",icon:P,backgroundColor:"transparent",textColor:"white",currentWidth:ei,tooltip:`Toggle diplomacy with this tribe (Currently: ${I.diplomacyStatus})`,targetTribeId:I.leaderId};t.uiButtons.push(N),t.hoveredButtonId===w&&(e.fillStyle=Dp,e.globalAlpha=.5,e.fillRect(b.x,b.y,b.width,b.height),e.globalAlpha=1),e.font=`${ei*.8}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="center",e.fillText(P,R+ei/2,_)}R+=ei+Ri,I.adultCount>0&&(ql(e,{x:R+Bo/2,y:_},Bo,25,"male"),R+=Bo/2,e.font=`${Vh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${I.adultCount}`,R,_),R+=e.measureText(` ${I.adultCount}`).width+Ri/2),I.childCount>0&&(ql(e,{x:R+Bo/2,y:_},Bo,1,"female"),R+=Bo/2,e.font=`${Vh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${I.childCount}`,R,_))}e.restore()}function yB(e,t,n,i,s){const a=AI,l=II,d=t+i-a-l,u=n+l;e.save(),e.lineWidth=2,e.strokeStyle=s?hP:fP,e.beginPath();const f=5;e.moveTo(d+f,u+f),e.lineTo(d+a-f,u+a-f),e.moveTo(d+a-f,u+f),e.lineTo(d+f,u+a-f),e.stroke(),e.restore()}function SB(e,t,n,i){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===pn.INACTIVE)return;const l=a.steps[s.currentStepIndex];if(!l)return;e.save(),e.globalAlpha=s.transitionAlpha;const d=oP,u=rP,f=sP,g=`${Zh}px "Press Start 2P", Arial`,m=`${LS}px "Press Start 2P", Arial`,S=lP,v=LS*1.5;e.font=m;const I=l.text.split(" ");let A="";const _=[];for(let j=0;j<I.length;j++){const K=A+I[j]+" ";e.measureText(K).width>d-u*2&&j>0?(_.push(A),A=I[j]+" "):A=K}_.push(A);const R=u*2+Zh+u/2+_.length*v,P=(n-d)/2,w=i-R-160;e.fillStyle=aP,e.beginPath(),e.moveTo(P+f,w),e.lineTo(P+d-f,w),e.quadraticCurveTo(P+d,w,P+d,w+f),e.lineTo(P+d,w+R-f),e.quadraticCurveTo(P+d,w+R,P+d-f,w+R),e.lineTo(P+f,w+R),e.quadraticCurveTo(P,w+R,P,w+R-f),e.lineTo(P,w+f),e.quadraticCurveTo(P,w,P+f,w),e.closePath(),e.fill(),e.fillStyle=S,e.textAlign="center",e.textBaseline="top",e.font=g,e.fillText(l.title,P+d/2,w+u),e.font=m;let b=w+u+Zh+u/2;for(const j of _)e.fillText(j,P+d/2,b),b+=v;const N=t.hoveredButtonId==="tutorial-dismiss";yB(e,P,w,d,N),e.restore();const D=AI,M=II,k=P+d-D-M,U=w+M;return{x:k,y:U,width:D,height:D}}function mg(e,t,n){e.save();const i=uP,s={x:t.x-i,y:t.y-i,width:t.width+i*2,height:t.height+i*2};e.strokeStyle=SI,e.lineWidth=vI+Math.sin(n*Np)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function vB(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const kT=10,AB=3,Av=kT*.7;function IB(e,t){const{position:n,food:i,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,kT,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),i.length>0){const a=Math.PI*2/Math.min(i.length,s);for(let l=0;l<i.length;l++){const d=l*a,u=n.x+Av*Math.cos(d),f=n.y+Av*Math.sin(d);e.beginPath(),e.arc(u,f,AB,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const Iv=(e,t,n=70,i=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${i}%)`},TB=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[i,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${i}, ${s}%, ${Math.max(0,a-t)}%)`},Bd=(e,t,n,i,s,a,l,d=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=d?TB(l,15):l,e.beginPath(),e.roundRect(-i/2,0,i,s,i/2),e.fill(),e.restore()},yg=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),i=75;if(!n)return`hsl(0, 0%, ${i}%)`;const[,s,a,l]=n.map(Number),d=a*(1-t),u=l+(i-l)*t;return`hsl(${s}, ${d}%, ${u}%)`},BT={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,i,s,a,l,d={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=i*.15,f=t+i/2,g=n+s/2,m=i-u*2,S=s-u*2,{gender:v,age:I,direction:A,isPregnant:_,hungryLevel:R,geneCode:P}=d,w=.8+Math.min(I,10)/10*.4,b=v==="male"?1.05:.95,N=1-R/100*.3,D=m*.5*N*w*b;let M=S*.3*w*b;const k=m*.15*w*b,U=D*.2,j=S*.3,K=Iv(P,0,30,50);let X=Iv(P,8,50,40);if(I>45){const ye=Math.min(1,(I-45)/15);X=yg(X,ye)}e.translate(f,g),A[0]<0&&e.scale(-1,1);const J=Math.sin(a*Math.PI*2),Z=Math.cos(a*Math.PI*2),le=j+M*.2;if(l==="dead"){const ye=Math.min(a,1);e.translate(0,S*.2),e.rotate(Math.PI/2);const Oe=yg(X,ye),Ne=yg(K,ye);e.globalAlpha=.5+ye*.5,e.strokeStyle=Oe,e.lineWidth=U*.5,e.beginPath(),e.moveTo(-D*.4,0),e.lineTo(D*.4,0),e.stroke();for(let he=-1;he<=1;he+=1)e.beginPath(),e.arc(0,0,M*.4,Math.PI*.4*he-Math.PI*.2,Math.PI*.4*he+Math.PI*.2),e.stroke();e.fillStyle=Ne,e.beginPath(),e.arc(D*.5,0,k,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(D*.55,0,k*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,le,D*.7,D*.25,0,0,2*Math.PI),e.fill();let re=0,te=0,Y=0,V=0,q=0,F=0;switch(l){case"idle":te=J*(S*.02),Y=J*.05,V=-J*.05,q=-J*.05,F=J*.05;break;case"walk":te=Math.abs(Z)*(S*-.04),Y=J*.7,V=-J*.7,q=-J*.7,F=J*.7;break;case"eat":re=S*.1,te=S*.05,re+=J*(S*.02);break;case"procreate":te=S*.05;const ye=(1-Z)*-m*.05;e.translate(ye,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}_&&v==="female"&&(M*=1.6);const z=te,ue=z-M*.2;Bd(e,D*-.35,ue,U,j,q,X,!0),Bd(e,D*.35,ue,U,j,F,X,!0),e.fillStyle=X,e.beginPath(),e.ellipse(0,z,D/2,M/2,0,0,2*Math.PI),e.fill();const pe=D*.45,Pe=ue+re;e.fillStyle=K,e.beginPath(),e.arc(pe,Pe,k,0,Math.PI*2),e.fill(),A[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(pe+k*.3,Pe-k*.2,k*.15,0,Math.PI*2),e.fill()),Bd(e,D*-.35,ue,U,j,Y,X),Bd(e,D*.35,ue,U,j,V,X),e.restore()}};function EB(e,t){let[n,i,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),i=Math.max(0,i-t),s=Math.max(0,s-t),`rgb(${n}, ${i}, ${s})`}function CB(e){const t=(e&16711680)>>16,n=(e&65280)>>8,i=e&255,s=`rgb(${t}, ${n}, ${i})`,a=EB(s,40),l=(e&255)%100+50,d=(e>>8&255)%100,u=(e>>16&255)%100,f=`rgb(${l}, ${d}, ${u})`,g=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:f,eyeColor:g}}const FT={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,i,s,a,l,d={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:f,direction:g,isPregnant:m,hungryLevel:S,geneCode:v}=d;e.save();const I=i*.15,A=Math.max(1,Math.floor((i-I*2)/10)),_=g[0]<0;e.translate(t+i/2,n+s/2),_&&e.scale(-1,1);const R=CB(v),P=.8+Math.min(f,20)/20*.4,w=u==="male"?1.05:.95,b=1-S/100*.25,N=P*w*b,D=Math.max(0,Math.min(1,(f-15)/5));e.filter=`grayscale(${D})`;const M=R.furColor,k=R.darkerFurColor,U=R.eyeColor,j="#FFFFFF",K="#c75c5c",X="#E0E0E0",J="#A0A0A0",Z=s/2-2*A,le=Math.sin(a*Math.PI*2),re=Math.abs(le);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,Z,A*4,A,0,0,2*Math.PI),e.fill(),e.filter="none",l==="dead"){const nt=Math.min(1,a*2);e.save(),e.translate(0,Z-A*3),e.rotate(-Math.PI/2);const at=(vi,Tn,Xn,Ai,Ii=!1)=>{e.fillStyle=Ii?J:X,e.fillRect(vi*A,Tn*A,Xn*A,Ai*A)};nt<1&&(e.globalAlpha=1-nt,e.fillStyle=M,e.beginPath(),e.ellipse(0,0,A*3,A*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),nt>0&&(e.globalAlpha=nt,at(-1,-4,2,2),at(1,-3.5,1,1,!0),at(-.5,-2,1,5,!0),at(-2.5,-1,5,.5),at(-2.5,0,5,.5),at(-2.5,1,5,.5),at(-3,-2,-1,2,!0),at(3,-2,1,2),at(-3,2,-1,2,!0),at(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=M;let te=0,Y=0,V=0,q=[0,0,0,0];switch(l){case"idle":te=le*A*.1;break;case"walk":const nt=Math.sin(a*Math.PI*4);te=Math.abs(nt)*-A*.5,q=[nt*A,-nt*A,-nt*A,nt*A];break;case"attacking":const at=Math.sin(a*Math.PI*4);Y=A*2+at*A,V=A*2,te=A;break;case"eat":V=A*3+re*A,te=A*1.5,e.fillStyle=K,e.fillRect(-A,Z-A,A*2,A);break;case"procreate":te=Math.sin(a*Math.PI*8)*A*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let Tn=0;Tn<5;Tn++){const Xn=(Math.random()-.5)*A*8,Ai=Z+(Math.random()-.5)*A*2;re>.5&&e.fillRect(Xn,Ai,A*.5,A*.5)}break}const F=A*3*N*(m?1.3:1),z=A*5*N,ue=-z/1.5,pe=Z-F-A*2.5+te;e.fillStyle=M,e.beginPath(),e.moveTo(ue-A*.5,pe+F*.5),e.quadraticCurveTo(ue-A*3,pe-A,ue-A*2+le*A,pe+F+A),e.fill();const Pe=A*1.2*N,ye=A*3*N,Oe=A*2.5*N,Ne=ue+z*.8,he=ue+z*.2;e.fillStyle=k,e.fillRect(he,Z-Oe,Pe,Oe+q[2]),e.fillRect(Ne,Z-ye,Pe,ye+q[0]),e.fillStyle=M,e.beginPath(),e.moveTo(ue,pe+F),e.lineTo(ue,pe+A),e.quadraticCurveTo(ue+z/2,pe,ue+z,pe+A),e.lineTo(ue+z,pe+F),e.fill(),e.fillStyle=M,e.fillRect(he+A/2,Z-Oe,Pe,Oe+q[3]),e.fillRect(Ne+A/2,Z-ye,Pe,ye+q[1]);const ve=A*3.5*N,xe=ue+z-ve*.3+Y,Te=pe-ve*.3+V;e.fillStyle=M,e.beginPath(),e.arc(xe,Te,ve/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(xe+ve*.4,Te+ve*.2,A*1.5,A,0,0,Math.PI*2),e.fill(),g[1]>=0&&(e.fillStyle=U,e.fillRect(xe+A*.5,Te-A*.5,A*.5,A*.5),l==="attacking"&&(e.fillStyle=j,e.fillRect(xe+ve*.5,Te+ve*.4,A,A*.4))),e.fillStyle=k,e.beginPath(),e.moveTo(xe-ve*.4,Te-ve*.3),e.lineTo(xe,Te-ve*.7),e.lineTo(xe,Te-ve*.2),e.fill(),e.restore()}};class sc{constructor(t=200){De(this,"cache",new Map);De(this,"maxSize");this.maxSize=t}getOrRender(t,n,i,s){const a=this.cache.get(t);if(a)return this.cache.delete(t),this.cache.set(t,a),a;const{canvas:l,ctx:d}=OT(n,i);if(s(d),this.cache.size>=this.maxSize){const u=this.cache.keys().next().value;u!==void 0&&this.cache.delete(u)}return this.cache.set(t,l),l}clear(){this.cache.clear()}}const _B=9,wB=new sc(200);function RB(e,t){const{position:n,gender:i,age:s,decayProgress:a,food:l,radius:d,originalEntityType:u,geneCode:f}=t,g=Vr(a,20),m=Math.floor(s),S=`${u}_${i}_${m}_${g}_${d}_${f||0}`,v=Math.ceil(d*2)+4,I=wB.getOrRender(S,v,v,A=>{A.translate(v/2,v/2),u==="human"?Zp.render(A,-v/2+2,-v/2+2,v-4,v-4,g,"dead",i,m,[0,0],!1,0):u==="prey"?BT.render(A,-v/2+2,-v/2+2,v-4,v-4,g,"dead",{gender:i,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}):u==="predator"&&FT.render(A,-v/2+2,-v/2+2,v-4,v-4,g,"dead",{gender:i,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024})});if(e.save(),e.globalAlpha=1-a,e.drawImage(I,n.x-I.width/2,n.y-I.height/2),e.restore(),l.length>0){e.save(),e.font=`${_B}px Arial`,e.textAlign="center",e.textBaseline="middle";const A=_t*.9,_=Math.PI/bA*3;l.forEach((R,P)=>{const w=P*_,b=n.x+A*Math.cos(w)*Math.atan2(P,P),N=n.y+A*Math.sin(w)*Math.atan2(P,P),D=gp[R.type];e.fillText(D,b,N)}),e.restore()}}function Vo(e,t,n,i,s,a,l,d){e.save(),e.fillStyle=l,e.fillRect(t,n,i,s),e.fillStyle=d,e.fillRect(t,n,i*Math.max(0,a),s),e.restore()}function PB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s;let d;l>a||l+(i.length-1)*4>a?d=(a-l)/(i.length-1):d=4,i.length===1&&(d=0);for(let u=0;u<i.length;u++){const f=gp[i[u].type];e.fillText(f,t+u*(s+d),n)}e.restore()}function DB(e,t,n,i,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let l,d=_t/2;const u=Fu[a.action],f=kI[a.action],g=`${u} ${f}`;if("targetEntityId"in a){const m=t.entities.entities[a.targetEntityId];m&&(l=m.position,d=m.radius)}else"position"in a&&(l=a.position);if(l){bT(e,l,d,Rp,Pp,2,n,i,s,t.mapDimensions),e.save(),e.font=`${da}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:S}=rc(l,n,{width:i,height:s},t.mapDimensions),v=S-d-Ou-da/2;e.fillText(g,m,v),e.restore()}}function NB(e,t,n,i,s){e.save();const a=(Math.sin(s*Np)+1)/2,l=n+Ou+a*5;e.strokeStyle=Rp,e.lineWidth=2,e.setLineDash(Pp),e.beginPath(),e.arc(t.x,t.y,l,0,Math.PI*2),e.stroke(),e.setLineDash([]);const d=Fu[i],u=kI[i];if(d){e.font=`${da*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const f=t.y-l-25;e.fillText(d,t.x,f),e.font=`${da*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,f+25)}e.restore()}function MB(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(vt(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const l=t.entities.entities[n.targetEntityId];l&&(s=l.position,a=l.radius||(l.type==="building"?20:30))}if(s){const l=(d,u)=>{NB(d,u.position,a,n.action,t.time)};ii(e,t.mapDimensions.width,t.mapDimensions.height,l,{position:{...s}},s,a+30)}}}function Tv(e,t,n,i,s,a,l=!0){const d=t.split(" ");let u="";const f=[];for(let g=0;g<d.length;g++){const m=u+d[g]+" ";e.measureText(m).width>s&&g>0?(f.push(u),u=d[g]+" "):u=m}if(f.push(u),l)for(let g=0;g<f.length;g++)e.fillText(f[g],n,i+g*a);return f.length*a}function OB(e){return 1-Math.pow(1-e,3)}function bB(e,t,n,i){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(l=>!l.isDismissed);if(s.length===0)return;e.save();let a=i-TP;for(const l of s){const d=n-Ed-Tr;e.font=`${Qh}px "Press Start 2P", Arial`;const u=d+Tr,f=Ed-Tr*2,g=Tv(e,l.message,-9999,-9999,f,Qh*1.2,!1),m=Tr*2+g+Pi,S=a-m,v=Date.now()-l.creationTime,I=Math.min(v/IP,1),A=OB(I),_=i,R=_+(S-_)*A;e.fillStyle=pP,e.beginPath(),e.roundRect(d,R,Ed,m,gP),e.fill(),e.fillStyle=mP,e.textBaseline="top",Tv(e,l.message,u,R+Tr,f,Qh*1.2,!0);const P=R+m-Pi-Tr/2,w=d+Ed-Pi-Tr/2,b={x:w,y:P,width:Pi,height:Pi};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[l.id]=b);const N=t.hoveredButtonId===`notification-dismiss-${l.id}`;if(e.fillStyle=N?GS:yP,e.font=`${Pi}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",b.x+b.width/2,b.y+b.height/2),l.targetEntityIds||l.targetPosition||l.targetArea||l.targetRadius){const k={x:w-Pi-HS,y:P,width:Pi,height:Pi};t.notificationButtonRects&&(t.notificationButtonRects.view[l.id]=k);const U=t.hoveredButtonId===`notification-view-${l.id}`;e.fillStyle=U?GS:SP,e.font=`${Pi*(U?1.5:1.2)}px Arial`,e.fillText("",k.x+k.width/2,k.y+k.height/2)}a-=m+HS}e.restore()}function kB(e){return e.length===0?0:e.reduce((n,i)=>n+i,0)/e.length}function Sg(e,t,n,i,s,a,l,d){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(i,s,a,l),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(i,s,a,l);const u=kB(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,i+et,s+et+8);const f=Math.max(...n,1),g=n.map(m=>m/f*l);if(e.beginPath(),e.strokeStyle=d,e.lineWidth=2,g.length>1){e.moveTo(i,s+l-g[0]);for(let m=1;m<g.length;m++){const S=i+m/(g.length-1)*a,v=s+l-g[m];e.lineTo(S,v)}}else if(g.length===1){const m=s+l-g[0];e.moveTo(i,m),e.lineTo(i+a,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${f.toFixed(2)}ms`,i+a-et,s+et+8),e.restore()}function BB(e,t,n){const{performanceMetrics:i}=t;if(!i)return;const s=280,a=240,l=n-s-et,d=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(l,d,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(l,d,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=d+et+5;const f=l+et;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",f,u),u+=25,e.fillStyle="white",e.font="12px monospace";const g=FB(t);e.fillText(`FPS: ${g.toFixed(1)}`,f,u),u+=20;const m=s-et*2,S=45,v=10;Sg(e,"Render",vg(t,"renderTime"),f,u,m,S,"#4CAF50"),u+=S+v,Sg(e,"World Update",vg(t,"worldUpdateTime"),f,u,m,S,"#2196F3"),u+=S+v,Sg(e,"AI Update",vg(t,"aiUpdateTime"),f,u,m,S,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",l+s/2,d+a-10),e.restore()}function FB(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(Ct/Dt);return t.history.filter(a=>n-a.bucketTime/(Ct/Dt)<1).length}function LB(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const l=Math.floor(a.bucketTime/(Ct/Dt));n.set(l,(n.get(l)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function vg(e,t){return LB(e.performanceMetrics.history,t)}function UB(e,t,n,i){const{debugCharacterId:s,time:a}=t,l=500,d=Math.min(i*.9,800),u=n-l-10,f=et+it*2;t.debugPanelRect={x:u,y:f,width:l,height:d},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(u,f,l,d),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(u,f,l,d),e.fillStyle="white",e.font="12px monospace",e.textAlign="left",e.textBaseline="top";let g=f+20;const m=u+15;if(e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Behavior Tree Debugger",m,g),g+=25,!s){e.fillStyle="#888",e.font="12px monospace",e.fillText("No character selected for debugging.",m,g),e.fillText("Click on a character to inspect behavior.",m,g+20),e.restore();return}const S=t.entities.entities[s];if(!S){e.fillStyle="#ff4444",e.font="12px monospace",e.fillText(`Character #${s} not found (might be dead).`,m,g),e.restore();return}if(!S.aiBlackboard){e.fillStyle="#ffaa44",e.font="12px monospace",e.fillText(`Character #${s} has no AI Blackboard.`,m,g),e.restore();return}e.fillStyle="white",e.font="12px monospace",e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,m,g),g+=20,HB(e,S,a,m,g,l-30,d-(g-f)-10,t),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '~' to toggle this debugger",u+l/2,f+d-10),e.restore()}function HB(e,t,n,i,s,a,l,d){var R,P;const u=t.aiBlackboard.nodeExecutionData,f=t.type==="human"?ST:t.type==="predator"?AT:t.type==="prey"?vT:null;if(!f)return;const g=((R=d.debugPanelScroll)==null?void 0:R.x)??0,m=((P=d.debugPanelScroll)==null?void 0:P.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-g,-m),e.font=`${X1}px Arial`,e.textAlign="left",e.textBaseline="top";const S=w=>{switch(w){case T.SUCCESS:return K1;case T.FAILURE:return q1;case T.RUNNING:return Z1;case T.NOT_EVALUATED:case null:default:return Q1}};let v=0;const I=(w,b)=>{if(!w.name||!u[w.name])return b;let N=b;const D=N+qh>s+m&&N<s+l+m,M=u[w.name],k=i+(w.depth??0)*V1;let U=T.NOT_EVALUATED,j=BS,K="";if(M){U=M.status,K=M.debugInfo;const te=eP/Dt*Ct,Y=n-M.lastExecuted,V=Math.max(0,1-Y/te);j=t_(BS,J1,V),Y>aa&&(U=T.NOT_EVALUATED)}const X=S(U),J=` ${w.name}`+(K?`: ${K}`:""),Z=e.measureText(J).width,le=sl+FS,re=k-i+8+Z+le;if(re>v&&(v=re),D&&(e.fillStyle=X,e.fillText("",k,N),e.fillStyle=j,e.fillText(J,k+8,N),M&&M.executionHistory.length>0)){const{executionHistory:te}=M,Y=yI/Dt*Ct,V=n,q=V-Y,F=i+a-sl-FS;let z=F;const ue=N+(qh-Td)/2,pe=te.filter(Te=>Te.time<q);let Pe=pe.length>0?pe[pe.length-1].status:null,ye=q;const Oe=te.filter(Te=>Te.time>=q&&Te.time<=V),Ne=sl/Y;e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(F,ue,sl,Td);for(const Te of Oe){const nt=(Te.time-ye)*Ne;nt>0&&(e.fillStyle=S(Pe),e.fillRect(z,ue,nt,Td),z+=nt),Pe=Te.status,ye=Te.time}n-ye>aa&&(Pe=T.NOT_EVALUATED);const ve=(V-ye)*Ne;e.fillStyle=S(Pe);const xe=F+sl-z;e.fillRect(z,ue,Math.min(ve,xe),Td)}if(N+=qh,w.children)for(const te of w.children)N=I(te,N);else w.child&&(N=I(w.child,N));return N},_=I(f,s)-s;d.debugPanelContentSize={width:v,height:_},e.restore()}function pu(e,t,n,i,s,a,l){e.save();const{position:d}=t;e.strokeStyle=i,e.lineWidth=s+Math.sin(l*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(d.x,d.y,n,0,2*Math.PI),e.stroke(),e.restore()}function GB(e,t,n,i){if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;const a=xt(s,t);if(!a||!a.aiBlackboard)return;const l=rr(a.aiBlackboard),d=500,u=Math.min(i*.9,700),f=n-d-10,g=et+it*2;t.debugPanelRect={x:f,y:g,width:d,height:u},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(f,g,d,u),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(f,g,d,u),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";const m=14,S=f+15;let v=g+20;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Supply Chain Debugger",S,v),v+=25,e.fillStyle="#aaaaaa",e.font="11px monospace",e.fillText(`Tribe Leader: ${a.isPlayer?"Player":"#"+a.id}`,S,v),v+=m,e.fillText(`Current Time: ${t.time.toFixed(1)}h`,S,v),v+=20;const I=v,A=u-(I-g)-30;$B(e,t,l,S,I,d-30,A,m),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+4' to toggle this debugger",f+d/2,g+u-10),e.restore()}function $B(e,t,n,i,s,a,l,d){var I,A;const u=((I=t.debugPanelScroll)==null?void 0:I.x)??0,f=((A=t.debugPanelScroll)==null?void 0:A.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-u,-f);let g=s;e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(` Active Demands (${n.length})`,i,g),g+=18,n.length===0?(e.fillStyle="#888888",e.font="11px monospace",e.fillText("No active demands",i,g),g+=d):[...n].sort((R,P)=>P.updatedAt-R.updatedAt).forEach((R,P)=>{const w=t.entities.entities[R.requesterId];let b=w?w.isPlayer?"Player":`Human #${w.id}`:`Unknown #${R.requesterId}`;w&&(b+=` (Food: ${w.food.length}), Active action: ${w.activeAction||"idle"}`);let N="None";if(R.claimedBy){const U=t.entities.entities[R.claimedBy];N=U?U.isPlayer?"Player":`Human #${U.id}`:`Unknown #${R.claimedBy}`,U&&(N+=" (Food: "+U.food.length+"), Active action: "+(U.activeAction||"idle")+")")}const D=t.time-R.updatedAt,M=g,k=d*5+10;e.fillStyle=R.claimedBy?"rgba(50, 100, 50, 0.3)":"rgba(50, 50, 50, 0.3)",e.fillRect(i-5,M-2,a,k),e.strokeStyle=R.claimedBy?"#44ff44":"#666666",e.lineWidth=1,e.strokeRect(i-5,M-2,a,k),e.fillStyle="#ffaa00",e.font="bold 12px monospace",e.fillText(`#${P+1}`,i,g),g+=d,e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Requester: ${b}`,i+10,g),g+=d,e.fillStyle="#ffff88",e.fillText(`Resource: ${R.resourceType}`,i+10,g),g+=d,e.fillStyle=R.claimedBy?"#44ff44":"#ff8844",e.fillText(`Status: ${R.claimedBy?"Claimed":"Pending"}`,i+10,g),g+=d,R.claimedBy?(e.fillStyle="#aaffaa",e.fillText(`Mover: ${N}`,i+10,g)):(e.fillStyle="#888888",e.fillText(`Mover: ${N}`,i+10,g)),g+=d,e.fillStyle="#aaaaaa",e.font="10px monospace",e.fillText(`Updated: ${D.toFixed(1)}h ago`,i+10,g),g+=d+5}),g+=10,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Statistics",i,g),g+=18;const m=n.filter(_=>!_.claimedBy).length,S=n.filter(_=>_.claimedBy).length;e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Total Demands: ${n.length}`,i,g),g+=d,e.fillStyle="#ff8844",e.fillText(`Pending: ${m}`,i,g),g+=d,e.fillStyle="#44ff44",e.fillText(`Claimed: ${S}`,i,g),g+=d;const v=g-s;t.debugPanelContentSize={width:a,height:v},e.restore()}function xB(e,t,n){if(!n.debugCharacterId)return;const i=n.search.human.byProperty("id",n.debugCharacterId)[0];if(!i)return;const s=xt(i,n);if(!s||!s.aiBlackboard||s.id!==t.leaderId)return;rr(s.aiBlackboard).some(l=>l.requesterId===t.id)&&pu(e,t,t.radius+15,"#ff6644",3,2,n.time),t.tribeRole===oe.Mover&&pu(e,t,t.radius+15,"#44ff44",3,2,n.time)}const WB={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"},YB=new sc(500);function zB(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?_t+20:_t*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,i.x,i.y-l+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function jB(e,t,n,i,s){e.save(),e.font=`${wl}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(i?_t:pa)-wl-s),e.restore()}function XB(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function VB(e,t,n){var d;const{position:i,radius:s}=t,a=i.x-Kh/2,l=i.y-s-$1;if(t.stateMachine[0]===er){const u=t.stateMachine[1],f=n-u.attackStartTime,g=Math.min(f/Pu,1);Vo(e,a,l,Kh,MS,g,zo,x1)}else if((d=t.attackCooldown)!=null&&d.melee&&t.attackCooldown.melee>0){const u=1-t.attackCooldown.melee/Du;Vo(e,a,l,Kh,MS,u,zo,W1)}}function KB(e,t,n=!1,i=!1,s=!1,a=!1,l=!1,d=!1,u=!1,f){var k,U;const{position:g,activeAction:m="idle"}=t,S=t.isAdult?_t:_t*.6,v=WB[m]||"idle",I=Vr(t.animationProgress||0,12),A=Kp(t.direction,8),_=Math.floor(t.age),R=Vr(t.hunger/100,5)*100,P=`${v}_${t.gender}_${_}_${A}_${I}_${t.isPregnant??!1}_${R}_${S}`,w=Math.ceil(S*2)+4,b=YB.getOrRender(P,w,w,j=>{j.translate(w/2,w/2);const K=qp(A,8);Zp.render(j,-w/2+2,-w/2+2,w-4,w-4,I,v,t.gender,_,K,t.isPregnant??!1,R)});e.drawImage(b,g.x-b.width/2,g.y-b.height/2),d&&(e.save(),e.strokeStyle=T1,e.lineWidth=2,e.beginPath(),e.arc(g.x,g.y,S+3,0,2*Math.PI),e.stroke(),e.restore());let N,D;if(l?(N=C1,D=cI):n?(N=E1,D=sI):s?(N=_1,D=I1):i?(N=w1,D=aI):a&&(N=R1,D=lI),N&&D&&XB(e,g,S,N,D),(k=t.tribeInfo)!=null&&k.tribeBadge&&jB(e,g,t.tribeInfo.tribeBadge,t.isAdult??!1,N??0),t.heldItem){const j=Mp[t.heldItem.type],K=(U=t.tribeInfo)!=null&&U.tribeBadge?wl:0;e.save(),e.font=`${wl}px Arial`,e.textAlign="center",e.textBaseline="middle";const X=g.y-(t.isAdult?_t:pa)-wl-(N??0)-K;e.fillText(j,g.x,X),e.restore()}const M=u&&(f.debugCharacterId===void 0||t.id===f.debugCharacterId);VB(e,t,f.time),M&&zB(e,t),f.debugPanel===je.SupplyChain&&xB(e,t,f)}const qB={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},ZB=new sc(200);function QB(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?_t+20:_t*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function JB(e,t,n=!1,i){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,d=qB[a]||"idle",u=Vr(t.animationProgress||0,12),f=Kp(t.direction||{x:1,y:0},8),g=Math.floor(t.age),m=Vr(t.hunger/100,5)*100,S=`${d}_${g}_${f}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,v=Math.ceil(l*2)+4,I=ZB.getOrRender(S,v,v,_=>{_.translate(v/2,v/2);const R=qp(f,8);BT.render(_,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:g,direction:R,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(I,s.x-I.width/2,s.y-I.height/2),t.hitpoints<t.maxHitpoints){const _=l*1.5,R=3,P=s.x-_/2,w=s.y-l-8;e.fillStyle="#555",e.fillRect(P,w,_,R);const b=t.hitpoints/t.maxHitpoints;e.fillStyle=b>.5?"#4CAF50":b>.25?"#FFC107":"#F44336",e.fillRect(P,w,_*b,R)}n&&(i===void 0||t.id===i)&&QB(e,t)}const eF={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},tF=new sc(200);function nF(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?_t+20:_t*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function iF(e,t,n=!1,i){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,d=eF[a]||"idle",u=Vr(t.animationProgress||0,12),f=Kp(t.direction||{x:1,y:0},8),g=Math.floor(t.age),m=Vr(t.hunger/100,5)*100,S=`${d}_${g}_${f}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,v=Math.ceil(l*2)+4,I=tF.getOrRender(S,v,v,_=>{_.translate(v/2,v/2);const R=qp(f,8);FT.render(_,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:g,direction:R,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(I,s.x-I.width/2,s.y-I.height/2),t.hitpoints<t.maxHitpoints){const _=l*1.5,R=3,P=s.x-_/2,w=s.y-l-8;e.fillStyle="#555",e.fillRect(P,w,_,R);const b=t.hitpoints/t.maxHitpoints;e.fillStyle=b>.5?"#4CAF50":b>.25?"#FFC107":"#F44336",e.fillRect(P,w,_*b,R)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,l+3,0,2*Math.PI),e.stroke()),n&&(i===void 0||t.id===i)&&nF(e,t)}const LT=15;function oF(e,t,n,i,s=1.5){const a=n-t.startTime,l=Math.min(a/t.duration,1),d=1-l,f=1+Math.sin(l*Math.PI*2)*(s-1),g=LT*f;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,g),0,Math.PI*2),e.fillStyle=i,e.fill(),e.restore()}function ul(e,t,n,i,s=2){const a=n-t.startTime,l=Math.min(a/t.duration,1),d=1-l,u=LT*2*l;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=i,e.lineWidth=s,e.stroke(),e.restore()}function qi(e,t,n,i){const s=n-t.startTime,a=Math.min(s/t.duration,1),l=1-a,d=-20*a;e.save(),e.globalAlpha=l,e.font="20px Arial",e.textAlign="center",e.fillText(i,t.position.x,t.position.y+d),e.restore()}function rF(e,t,n,i){const{width:s,height:a}=i.mapDimensions;let l=t.targetPosition;if(t.targetEntityId){const A=i.entities.entities[t.targetEntityId];A&&(l=A.position)}if(!l)return;const d=n-t.startTime,u=Math.min(d/t.duration,1);let f=l.x-t.position.x,g=l.y-t.position.y;f=f-Math.round(f/s)*s,g=g-Math.round(g/a)*a;const m={x:f,y:g},S=t.position.x+m.x*u,v=t.position.y+m.y*u,I=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(S,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(S,v+I),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function UT(e,t,n,i){switch(t.type){case Ce.Procreation:qi(e,t,n,"");break;case Ce.Pregnant:oF(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Ce.TargetAcquired:ul(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Ce.Attack:qi(e,t,n,"");break;case Ce.Partnered:qi(e,t,n,"");break;case Ce.BushClaimed:ul(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Ce.BushClaimLost:ul(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Ce.Eating:qi(e,t,n,"");break;case Ce.ChildFed:qi(e,t,n,"");break;case Ce.AttackDeflected:qi(e,t,n,"");break;case Ce.AttackResisted:qi(e,t,n,"");break;case Ce.Hit:qi(e,t,n,"");break;case Ce.SeizeBuildup:ul(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Ce.BorderClaim:qi(e,t,n,"");break;case Ce.Seize:ul(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Ce.StoneProjectile:rF(e,t,n,i);break}}const Ev=8,sF=1.5,aF=.5,Cv=2,lF="#5a5a5a",cF="#7e7e7e",dF="#8B0000",uF="#FF4444",fF=6,hF=new sc(200),_v=20;function gF(e,t,n=!1,i=!0){if(n)return`ghost_${e.buildingType}_${i}`;const s=e,a=s.buildingType===ce.Bonfire&&(s.fuelLevel??0)>0;return`${s.id}_${s.buildingType}_${s.width}_${s.height}_${t}_${s.isConstructed}_${a}`}function HT(e,t,n=!1,i=!0){const s=gF(e,t,n,i),{width:a,height:l,id:d,buildingType:u}=e,f=a+_v*2,g=l+_v*2;return hF.getOrRender(s,f,g,m=>{const S=ir[u],v="isConstructed"in e?e.isConstructed:!0;if(m.translate(f/2,g/2),n){const I=i?"#4CAF50":"#F44336";Ag(m,a,l,9999,I),m.font=`${Math.min(a,l)*.5}px Arial`,m.textAlign="center",m.textBaseline="middle",m.fillStyle=I,m.fillText(S.icon,0,0)}else{const I=e;let A=S.icon;I.buildingType===ce.Bonfire&&v&&(A=(I.fuelLevel??0)>0?"":""),t?Ag(m,a,l,d,dF,uF):Ag(m,a,l,d),m.globalAlpha=.5,m.font=`${Math.min(a,l,30)*.5}px Arial`,m.textAlign="center",m.textBaseline="middle",m.shadowColor="rgba(0,0,0,0.5)",m.shadowBlur=4,m.fillStyle="#FFFFFF",m.fillText(A,0,0)}})}function Ag(e,t,n,i,s,a){const l=(t+n)*2,d=Math.floor(l/Ev),u=-t/2,f=t/2,g=-n/2,m=n/2;for(let S=0;S<d;S++){const v=i+S*13,I=Zs(v),A=Zs(v+1);let _=S*Ev,R=0,P=0;_<t?(R=u+_,P=g):_<t+n?(R=f,P=g+(_-t)):_<t*2+n?(R=f-(_-(t+n)),P=m):(R=u,P=m-(_-(t*2+n)));const w=(A-.5)*Cv,b=(Zs(v+2)-.5)*Cv;e.beginPath();const N=sF+I*aF;s?e.fillStyle=s:e.fillStyle=I>.5?a||cF:s||lF,e.ellipse(R+w,P+b,N,N*.85,A*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function pF(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:i}=t;e.save(),e.font=`${fF}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,i.forEach(s=>{const a=s.item.type,l=(gp[a]||Mp[a])??"?",d={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(l,d.x,d.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function mF(e,t,n){const{position:i,width:s,height:a,constructionProgress:l,destructionProgress:d,isConstructed:u,isBeingDestroyed:f}=t,g=vt(n),m=!!(g&&Vt(g,t,n)),S=HT(t,m);e.save(),u||(e.globalAlpha=.3+l*.7),e.drawImage(S,i.x-S.width/2,i.y-S.height/2),e.restore();const v=s,I=i.x-v/2,A=i.y+a/2+a_;u?f&&Vo(e,I,A,v,eS,1-d,zo,s_):Vo(e,I,A,v,eS,l,zo,r_),(t.buildingType===ce.StorageSpot||t.buildingType===ce.Bonfire)&&u&&pF(e,t)}function yF(e,t,n,i,s){const a=ir[n],{width:l,height:d}=a.dimensions,u=HT({buildingType:n,width:l,height:d,id:9999},!1,!0,i),f=(m,S)=>{m.save(),m.globalAlpha=o_,m.drawImage(u,S.x-u.width/2,S.y-u.height/2),m.restore()},g={position:{...t},radius:Math.max(l,d)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:E.create()};ii(e,s.width,s.height,(m,S)=>f(m,S.position),g)}const Fs=1,SF=20,pi=4,wv=8,vF="rgba(34, 85, 34, 0.25)",AF="rgba(139, 50, 50, 0.25)",Qs=new Map,IF=50;function TF(e,t){return e.map(n=>n.id).sort((n,i)=>n-i).join(",")+`_${t}`}function EF(){if(Qs.size>IF){const e=Qs.keys().next().value;e&&Qs.delete(e)}}function CF(e){const t=new Map;for(const n of e){const i=n.ownerId;i&&(t.has(i)||t.set(i,[]),t.get(i).push(n))}return t}function _F(e,t,n,i){let s=0;const a=Math.max(i.width,i.height)/2;for(const l of n){const d=e-l.position.x,u=t-l.position.y,f=d*d+u*u;f>0?s+=a*a/f:s+=100}return s}function wF(e,t,n){let i=1/0,s=1/0,a=-1/0,l=-1/0;for(const d of e)i=Math.min(i,d.position.x-t.width/2),s=Math.min(s,d.position.y-t.height/2),a=Math.max(a,d.position.x+t.width/2),l=Math.max(l,d.position.y+t.height/2);return{minX:i-n,minY:s-n,maxX:a+n,maxY:l+n}}function RF(e,t,n,i){const s=TF(e,i);if(Qs.has(s))return Qs.get(s);const a=n.maxX-n.minX,l=n.maxY-n.minY,d=Math.ceil(a/pi),u=Math.ceil(l/pi),f=[],g=[];for(let v=0;v<u;v++)f[v]=new Array(d);for(let v=0;v<u;v++)for(let I=0;I<d;I++){const A=n.minX+I*pi,_=n.minY+v*pi,R=_F(A,_,e,t);f[v][I]=R}for(let v=1;v<u-1;v++)for(let I=1;I<d-1;I++)if(f[v][I]>=Fs&&(f[v-1][I]<Fs||f[v+1][I]<Fs||f[v][I-1]<Fs||f[v][I+1]<Fs)){const _=n.minX+I*pi,R=n.minY+v*pi;g.push({x:_,y:R})}const m=NF(g),S={fieldValues:f,edgePoints:g,regions:m,bounds:n};return Qs.set(s,S),EF(),S}function PF(e,t,n,i,s,a){if(t.length===0)return;const{bounds:l}=a,d=10;if(!a.canvas){const u=l.maxX-l.minX+d*2,f=l.maxY-l.minY+d*2,{canvas:g,ctx:m}=OT(u,f);m.translate(-l.minX+d,-l.minY+d);const{fieldValues:S,regions:v}=a;DF(m,S,l,i);let I=s;for(const A of v){const _=MF(A);OF(m,_,i,I),I+=1e3}a.canvas=g}e.save(),e.globalAlpha=1,e.drawImage(a.canvas,l.minX-d,l.minY-d),e.restore()}function DF(e,t,n,i){const s=i?AF:vF;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++)if(t[a][l]>=Fs){const d=n.minX+l*pi,u=n.minY+a*pi;e.rect(d,u,pi,pi)}e.fill(),e.restore()}function NF(e){if(e.length===0)return[];const t=pi*2,n=t,i=new Map;function s(f,g){const m=Math.floor(f/n),S=Math.floor(g/n);return`${m},${S}`}for(let f=0;f<e.length;f++){const g=s(e[f].x,e[f].y);i.has(g)||i.set(g,[]),i.get(g).push(f)}function a(f,g){const m=[],S=Math.floor(f/n),v=Math.floor(g/n);for(let I=-1;I<=1;I++)for(let A=-1;A<=1;A++){const _=`${S+I},${v+A}`,R=i.get(_);R&&m.push(...R)}return m}const l=new Set,d=[],u=t*t;for(let f=0;f<e.length;f++){if(l.has(f))continue;const g=[],m=[f];for(;m.length>0;){const S=m.shift();if(l.has(S))continue;l.add(S),g.push(e[S]);const v=a(e[S].x,e[S].y);for(const I of v){if(l.has(I))continue;const A=e[I].x-e[S].x,_=e[I].y-e[S].y;A*A+_*_<=u&&m.push(I)}}g.length>0&&d.push(g)}return d}function MF(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const i=t[t.length-1];let s=0,a=1/0;for(let l=0;l<n.length;l++){const d=n[l].x-i.x,u=n[l].y-i.y,f=d*d+u*u;f<a&&(a=f,s=l)}t.push(n.splice(s,1)[0])}return t}function OF(e,t,n,i){if(t.length===0)return;let s=0,a=0;for(let l=1;l<t.length;l++){const d=t[l-1],u=t[l],f=u.x-d.x,g=u.y-d.y,m=Math.sqrt(f*f+g*g);for(s+=m;s>=wv;){s-=wv;const S=1-s/m,v=d.x+f*S,I=d.y+g*S;bF(e,v,I,n,i+a*13),a++}}}function bF(e,t,n,i,s){const a=Zs(s),l=Zs(s+1),d=(l-.5)*2,u=(Zs(s+2)-.5)*2;e.beginPath();const f=1.5+a*.5;i?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+d,n+u,f,f*.85,l*Math.PI,0,Math.PI*2),e.fill(),i||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function kF(e,t,n,i){var m,S,v;const s=t;if(!((m=s.search)!=null&&m.building))return;const l=s.search.building.all().filter(I=>I.buildingType===ce.PlantingZone&&I.isConstructed);if(l.length===0)return;const d=l.filter(I=>kl(I,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(d.length===0)return;const u=ir[ce.PlantingZone].dimensions,f=CF(d),g=i?t.entities.entities[i]:void 0;for(const[I,A]of f){const _=((v=(S=g==null?void 0:g.tribeControl)==null?void 0:S.diplomacy)==null?void 0:v[I])==="Hostile",R=typeof I=="number"?I:0,P=wF(A,u,SF),w=RF(A,u,P,_);PF(e,A,u,_,R,w)}}const BF=.001,FF=.05,LF=12;function UF(e,t,n){const{position:i,age:s,swayOffset:a}=t,[l]=t.stateMachine??[],d=Math.min(1,Math.max(.4,s/tr)),f=l!==Gt&&l!==uo?Math.sin(n*BF+a)*FF:0;if(e.save(),e.translate(i.x,i.y),e.scale(d,d),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=kN,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),l===uo?Ig(e,10,8):l===Gt?(e.rotate(Math.PI/2),Ig(e,10,30),e.translate(0,-25),Rv(e,40,20,40,15)):(e.rotate(f),Ig(e,10,30),e.translate(0,-25),e.rotate(f*.5),Rv(e,40,20,40,15)),e.restore(),(l===Gt||l===uo)&&t.wood&&t.wood.length>0){e.save(),e.font=`${LF}px Arial`,e.textAlign="center",e.textBaseline="middle";const g=t.radius*1.1,m=Math.PI*2/(Gu-1);t.wood.forEach((S,v)=>{const I=v===0?0:g,A=v===0?0:(v-1)*m,_=i.x+I*Math.cos(A),R=i.y+I*Math.sin(A),P=Mp[S.type];e.fillText(P,_,R)}),e.restore()}}function Ig(e,t,n){e.fillStyle=DN,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=NN,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function Rv(e,t,n,i,s){e.fillStyle=MN,Pv(e,t+4,n+4,i+2,s+2),e.translate(0,-2),e.fillStyle=ON,Pv(e,t,n,i,s),e.fillStyle=bN,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function Pv(e,t,n,i,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-i),e.lineTo(0,-i-s),e.lineTo(n/2,-i),e.lineTo(t/2,0),e.closePath(),e.fill()}const Fd=200;let Uo=null;function HF(e,t,n,i,s){const a=jN(t.time);if(a<=0)return;Uo||(Uo=document.createElement("canvas")),(Uo.width!==i.width||Uo.height!==i.height)&&(Uo.width=i.width,Uo.height=i.height);const l=Uo.getContext("2d");if(l){l.clearRect(0,0,i.width,i.height),l.fillStyle=`rgba(0, 0, 40, ${a*.85})`,l.fillRect(0,0,i.width,i.height),l.globalCompositeOperation="destination-out";for(const d of s){const u=rc(d.position,n,i,t.mapDimensions),f=l.createRadialGradient(u.x,u.y,0,u.x,u.y,d.radius);f.addColorStop(0,`rgba(255, 255, 255, ${d.intensity})`),f.addColorStop(1,"rgba(255, 255, 255, 0)"),l.fillStyle=f,l.beginPath(),l.arc(u.x,u.y,d.radius,0,Math.PI*2),l.fill()}l.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(Uo,0,0),e.restore()}}function Dv(e,t,n,i,s,a,l){for(let d=-s.height;d<=s.height;d+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const f={x:t.x+u,y:t.y+d};kl({position:f,radius:n},a,l,s)&&e.push({position:f,radius:n,intensity:i})}}function GF(e,t,n,i,s,a=[]){const l=vt(t),d=l?Mn(t,l):[],u=jr(d),{width:f,height:g}=t.mapDimensions,m=[];a.forEach(R=>{m.push({position:R,radius:30,intensity:.3})}),kF(e,t,i,l==null?void 0:l.leaderId);const S=t,v={left:i.x-s.width/2-Fd,top:i.y-s.height/2-Fd,right:i.x+s.width/2+Fd,bottom:i.y+s.height/2+Fd};[...S.search.human.byRect(v),...S.search.building.byRect(v),...S.search.berryBush.byRect(v),...S.search.tree.byRect(v),...S.search.corpse.byRect(v),...S.search.prey.byRect(v),...S.search.predator.byRect(v)].sort((R,P)=>n&&R.id===t.debugCharacterId&&R.id!==P.id||R.type==="building"&&P.type!=="building"||R.position.y<P.position.y?-1:R.position.y>P.position.y?1:R.id-P.id).forEach(R=>{var P,w;if(R.type==="building"){const b=R;if(b.isConstructed){const N=b.buildingType===ce.Bonfire&&(b.fuelLevel??0)>0,D=N?180:60,M=N?.9:.4;Dv(m,b.position,D,M,t.mapDimensions,i,s)}if(b.buildingType===ce.PlantingZone&&b.isConstructed)return;ii(e,f,g,mF,b,t,l,t.time)}else if(R.type==="berryBush")ii(e,f,g,IB,R,t,l,t.time);else if(R.type==="tree")ii(e,f,g,UF,R,t.time);else if(R.type==="human"){const b=R,N=b.id===(l==null?void 0:l.id),D=d.some(K=>K.id===b.id),M=b.id===(u==null?void 0:u.id),k=l&&(b.id===l.motherId||b.id===l.fatherId),U=l&&(((P=b.partnerIds)==null?void 0:P.includes(l.id))||((w=l.partnerIds)==null?void 0:w.includes(b.id))),j=(l==null?void 0:l.attackTargetId)===b.id;Dv(m,b.position,40,.3,t.mapDimensions,i,s),ii(e,f,g,KB,b,N,k,D,U,M,j,n,t)}else R.type==="corpse"?ii(e,f,g,RB,R):R.type==="prey"?ii(e,f,g,JB,R,n,t.time,t.debugCharacterId):R.type==="predator"&&ii(e,f,g,iF,R,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(R=>kl(R,i,s,t.mapDimensions)).forEach(R=>{ii(e,f,g,UT,R,t.time,t)});const _=t.notifications.filter(R=>!R.isDismissed);for(const R of _)if(R.highlightedEntityIds&&R.renderHighlights)for(const P of R.highlightedEntityIds){const w=t.entities.entities[P];w&&kl(w,i,s,t.mapDimensions)&&ii(e,f,g,pu,w,EP,CP,wP,_P,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const R of t.tutorialState.highlightedEntityIds){const P=t.entities.entities[R];P&&kl(P,i,s,t.mapDimensions)&&ii(e,f,g,pu,P,dP,SI,vI,Np,t.time)}HF(e,t,i,s,m)}function $F(e,t,n,i,s,a){let l=null,d=null;e.textAlign="left";let u=et+it;const g=t.time/(Ct/Dt)/Cu%1,m=al[bs.Time],S=25,v=et+S;e.fillText(m,et,u+Ln/2+it/3),Vo(e,v,u,ko,Ln,g,zo,k1),u+=Ln+Ki;const I=u+Ar/2,A=u+(Ar-Ln)/2,_=5;ql(e,{x:et*2,y:I},Ar,5,n.gender,!1,!1,!1);const R=et+Ar+_,P=ko+S-(Ar+_)*2;Vo(e,R,A,P,Ln,Math.floor(n.age)/Gl,zo,b1),ql(e,{x:R+P+_+Ar/2,y:I},Ar,Gl,n.gender,!1,!1,!1),u+=Ln+Ki*2;const w=[],b=new Set;if(w.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),b.add(n.id),i&&!b.has(i.id)&&(w.push({member:i,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),b.add(i.id)),s.forEach(Z=>{b.has(Z.id)||(w.push({member:Z,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),b.add(Z.id))}),a.forEach(Z=>{b.has(Z.id)||(w.push({member:Z,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),b.add(Z.id))}),n.motherId&&!b.has(n.motherId)){const Z=t.entities.entities[n.motherId];Z&&(w.push({member:Z,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),b.add(Z.id))}if(n.fatherId&&!b.has(n.fatherId)){const Z=t.entities.entities[n.fatherId];Z&&(w.push({member:Z,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),b.add(Z.id))}const N=al[bs.Family],D=10,M=et+it+D,k=ko+S-(it+D),U=u+vd/2;e.font=`${it}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(N,et,U);const j=u+vd/2;pB(e,M,j,w,vd,k),u+=vd+Ki,e.textBaseline="alphabetic";const K=al[bs.Hitpoints];e.fillText(K,et,u+Ln/2+it/3),Vo(e,v,u,ko,Ln,n.hitpoints/n.maxHitpoints,zo,O1),u+=Ln+Ki;const X=al[bs.Hunger];e.fillText(X,et,u+Ln/2+it/3),Vo(e,v,u,ko,Ln,(sn-n.hunger)/sn,zo,M1),l={x:et,y:u-Ki/2,width:ko+S,height:Ln+Ki},u+=Ln+Ki,e.textBaseline="middle";const J=al[bs.Food];return e.fillText(J,et,u+Sd/2),PB(e,v,u+Sd/2,n.food,Sd,ko),d={x:et,y:u-Ki/5,width:ko+S,height:Sd+Ki},e.textBaseline="alphabetic",{hungerBarRect:l,foodBarRect:d}}let fl=[],Nv=0;const xF=36,WF=200;function YF(e,t,n,i){const s=t.search.prey.count(),a=t.search.predator.count(),l=t.search.berryBush.count();t.time-Nv>=xF&&(fl.push({time:t.time,prey:s,predators:a,bushes:l}),fl.length>WF&&(fl=fl.slice(-200)),Nv=t.time);const d=Ze*Qe,u=s/d*1e6,f=a/d*1e6,g=l/d*1e6,m=Kk(),S=Math.floor(t.time/(24*365)),v=Math.floor(t.time%(24*365)/24),I=Math.floor(t.time%24),A=400,_=Math.min(i*.8,600),R=n-A-10,P=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(R,P,A,_),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(R,P,A,_),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let w=P+20;const b=14,N=R+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",N,w),w+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${S}, Day ${v}, Hour ${I}`,N,w),w+=b,e.fillText(`Map Size: ${Ze}  ${Qe} pixels`,N,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",N,w),w+=18,m&&(e.fillText(`Q-Table Size: ${m.qTableSize} entries`,N,w),w+=b,e.fillText(`Exploration Rate: ${(m.explorationRate*100).toFixed(1)}%`,N,w),w+=b);const D=fl.slice(-20);D.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",N,w),w+=30,zF(e,N,w,D),w+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",N,w),w+=18,e.fillStyle="white",e.font="12px monospace";const M=(ro/d*1e6).toFixed(2),k=(so/d*1e6).toFixed(2),U=(ao/d*1e6).toFixed(2);e.fillText(`Prey: ${u.toFixed(2)} (target: ${M})`,N,w),w+=b,e.fillText(`Predators: ${f.toFixed(2)} (target: ${k})`,N,w),w+=b,e.fillText(`Bushes: ${g.toFixed(2)} (target: ${U})`,N,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",N,w),w+=18,e.fillStyle="white",e.font="12px monospace";const j=Math.round(s/ro*100),K=Math.round(a/so*100),X=Math.round(l/ao*100),J=Z=>Z<50?"#ff4444":Z<80?"#ffaa44":Z>120?"#44aaff":"#44ff44";e.fillStyle=J(j),e.fillText(`Prey: ${s}/${ro} (${j}%)`,N,w),w+=b,e.fillStyle=J(K),e.fillText(`Predators: ${a}/${so} (${K}%)`,N,w),w+=b,e.fillStyle=J(X),e.fillText(`Bushes: ${l}/${ao} (${X}%)`,N,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",N,w),w+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",N,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,N,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,N,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,N,w),w+=13,e.fillText("Predators:",N,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,N,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,N,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,N,w),w+=13,e.fillText("Bushes:",N,w),w+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,N,w),w+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",R+A/2,P+_-10),e.restore()}function zF(e,t,n,i){if(i.length<2)return;const d={prey:Math.max(...i.map(f=>f.prey),ro),predators:Math.max(...i.map(f=>f.predators),so),bushes:Math.max(...i.map(f=>f.bushes),ao)};[{data:i.map(f=>f.prey),color:"#44ff44",label:"Prey",target:ro,max:d.prey},{data:i.map(f=>f.predators),color:"#ff4444",label:"Predators",target:so,max:d.predators},{data:i.map(f=>f.bushes),color:"#ffaa44",label:"Bushes",target:ao,max:d.bushes}].forEach((f,g)=>{const m=t+g*115,S=n;e.fillStyle=f.color,e.font="10px monospace",e.fillText(f.label,m,S-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,S,100,30),e.beginPath(),e.strokeStyle=f.color;for(let I=0;I<f.data.length;I++){const A=m+I/(f.data.length-1)*100,_=S+30-f.data[I]/f.max*30;I===0?e.moveTo(A,_):e.lineTo(A,_)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=S+30-f.target/f.max*30;e.moveTo(m,v),e.lineTo(m+100,v),e.stroke(),e.setLineDash([])})}function jF(e,t){const n=t.search.human.byProperty("leaderId",e),i={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||i.children++,s.gender==="male"?i.males++:s.gender==="female"&&i.females++,s.age>=yp&&i.old++;return i}function XF(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(f=>n.berryBush.byRadius(f.position,f.radius)).reduce((f,g)=>f+g.food.length,0),u=n.building.byProperty("ownerId",e).filter(f=>f.buildingType===ce.StorageSpot).reduce((f,g)=>f+(g.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:u,consumptionRate:0}}function VF(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,l=new Map,d=new Map;for(const f of s){const g=fu(f.id,t,l);d.has(g)||d.set(g,[]),d.get(g).push(f)}const u=[];for(const[f,g]of d.entries()){const m=a[f];m&&u.push({patriarch:m,memberCount:g.length,members:g.map(S=>S.id)})}return u.sort((f,g)=>g.memberCount-f.memberCount),u.slice(0,n)}let hl=[],Mi=[],Mv=0;const KF=36,Ov=200;function qF(e,t,n,i){var b;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(b=xt(s,t))==null?void 0:b.id;if(!a)return;const l=jF(a,t),d=XF(a,t);if(t.time-Mv>=KF){hl.push({time:t.time,total:l.total,children:l.children,males:l.males,females:l.females,old:l.old});const N=d.totalBushFood+d.totalStorageFood;Mi.push({time:t.time,bushFood:d.totalBushFood,storageFood:d.totalStorageFood,totalFood:N}),hl.length>Ov&&(hl=hl.slice(-200)),Mi.length>Ov&&(Mi=Mi.slice(-200)),Mv=t.time}let u=0;if(Mi.length>=2){const N=Mi[Mi.length-1],D=Mi[Mi.length-2],M=N.time-D.time;M>0&&(u=(D.totalFood-N.totalFood)/M)}const f=400,g=Math.min(i*.9,700),m=n-f-10,S=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,S,f,g),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,S,f,g),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=S+20;const I=13,A=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",A,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",A,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${l.total}`,A,v),v+=I,e.fillStyle="#00ffff",e.fillText(`Children: ${l.children}`,A,v),v+=I,e.fillStyle="#4488ff",e.fillText(`Males: ${l.males}`,A,v),v+=I,e.fillStyle="#ff88ff",e.fillText(`Females: ${l.females}`,A,v),v+=I,e.fillStyle="#888888",e.fillText(`Old (${l.old})`,A,v),v+=20;const _=hl.slice(-50);_.length>1&&(ZF(e,A,v,_),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",A,v),v+=18;const R=d.totalBushFood+d.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${R}`,A,v),v+=I,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${d.totalBushFood}`,A,v),v+=I,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${d.totalStorageFood}`,A,v),v+=I,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,A,v),v+=20;const P=Mi.slice(-50);P.length>1&&(QF(e,A,v,P),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",A,v),v+=18;const w=VF(a,t,5);e.fillStyle="white",e.font="11px monospace",w.length===0?(e.fillText("No families found",A,v),v+=I):w.forEach((N,D)=>{const k=`${D+1}. ${N.patriarch.isPlayer?"Player":"#"+N.patriarch.id} (${N.memberCount} members, can split: ${zI(N.patriarch,t).canSplit})`;e.fillText(k,A,v),v+=I}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+f/2,S+g-10),e.restore()}function ZF(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.total),color:"#ffffff",label:"Total"},{data:i.map(u=>u.children),color:"#00ffff",label:"Children"},{data:i.map(u=>u.males),color:"#4488ff",label:"Males"},{data:i.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:i.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function QF(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:i.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:i.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function bv(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,d=uI;if(e.beginPath(),e.moveTo(i+d,s),e.lineTo(i+a-d,s),e.quadraticCurveTo(i+a,s,i+a,s+d),e.lineTo(i+a,s+l-d),e.quadraticCurveTo(i+a,s+l,i+a-d,s+l),e.lineTo(i+d,s+l),e.quadraticCurveTo(i,s+l,i,s+l-d),e.lineTo(i,s+d),e.quadraticCurveTo(i,s,i+d,s),e.closePath(),e.fillStyle=t.isDisabled?fI:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*mI)+1)/2;e.strokeStyle=pI,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<lu){const f=1-u/lu;e.fillStyle=gI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Dp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?hI:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.font=`${it*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function JF(e,t,n,i){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,i);const s=500,a=150,l=(n-s)/2,d=(i-a)/2;e.fillStyle=Ht,e.font=`${it*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,d+a/3-10),e.fillText("to the main menu?",n/2,d+a/3+10);const u=oo*1.5,f=dI,g=d+a-f-et*2,m=20,S=u*2+m,v=l+(s-S)/2,I={id:"confirmExitYes",action:fe.ConfirmExitYes,rect:{x:v,y:g,width:u,height:f},text:"Yes",backgroundColor:Wo,textColor:Ht,currentWidth:u},A=v+u+m,_={id:"confirmExitNo",action:fe.ConfirmExitNo,rect:{x:A,y:g,width:u,height:f},text:"No",backgroundColor:Wo,textColor:Ht,currentWidth:u};t.uiButtons.push(I,_),bv(e,I,t.hoveredButtonId===I.id),bv(e,_,t.hoveredButtonId===_.id),e.restore()}const Ho=600,Ns=30,Oi=60,zt=30,eL="";function tL(e,t,n){const i=[];if(!n.tribeControl||!n.leaderId)return i;const{width:s,height:a}=e.canvas,l=(s-Ho)/2,d=480,u=(a-d)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(l,u,Ho,d,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Ht,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Tribe Roles",l+Ho/2,u+Ns);const f=30,g=l+Ho-Ns-f,m=u+Ns,S=t.hoveredButtonId==="roleManager_close";e.fillStyle=S?"#ff7777":"#ff5555",e.fillRect(g,m,f,f),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",g+f/2,m+f/2),i.push({id:"roleManager_close",action:fe.CloseRoleManager,rect:{x:g,y:m,width:f,height:f},text:"X",currentWidth:f,backgroundColor:"#ff5555",textColor:"#ffffff"});const I=Li(n.leaderId,t).filter(X=>X.isAdult),A={[oe.Leader]:0,[oe.Gatherer]:0,[oe.Planter]:0,[oe.Hunter]:0,[oe.Mover]:0,[oe.Warrior]:0};I.forEach(X=>{X.tribeRole&&A[X.tribeRole]++});const _=n.tribeControl.roleWeights,R=[{role:oe.Gatherer,emoji:"",name:"Gatherer"},{role:oe.Planter,emoji:"",name:"Planter"},{role:oe.Hunter,emoji:"",name:"Hunter"},{role:oe.Mover,emoji:"",name:"Mover"},{role:oe.Warrior,emoji:"",name:"Warrior"}];let P=0;R.forEach(X=>{P+=_[X.role]||0});let w=u+Ns+70;const b=l+Ns,N=l+Ho-Ns;R.forEach(X=>{const J=_[X.role]||0,Z=P>0?Math.round(J/P*100):0,le=A[X.role]||0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${X.emoji} ${le} ${X.name}`,b,w+Oi/2);const re=l+220,te=re+zt+15,V=te+200+15,q=`role_minus_${X.role}`,F=t.hoveredButtonId===q,z=J<=0,ue=z?"#555":F?"#dd6666":"#cc4444";e.fillStyle=ue,e.fillRect(re,w+(Oi-zt)/2,zt,zt),e.fillStyle=z?"#888":"#fff",e.textAlign="center",e.fillText("-",re+zt/2,w+Oi/2+2),i.push({id:q,action:fe.DecreaseRoleWeight,targetRole:X.role,rect:{x:re,y:w+(Oi-zt)/2,width:zt,height:zt},text:"-",currentWidth:zt,backgroundColor:ue,textColor:"#fff",isDisabled:z}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#fff";let pe=te;for(let he=0;he<J;he++)e.fillText(eL,pe,w+Oi/2+2),pe+=18;const Pe=`role_plus_${X.role}`,ye=t.hoveredButtonId===Pe,Oe=J>=10,Ne=Oe?"#555":ye?"#66dd66":"#44cc44";e.fillStyle=Ne,e.fillRect(V,w+(Oi-zt)/2,zt,zt),e.fillStyle=Oe?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",V+zt/2,w+Oi/2+4),i.push({id:Pe,action:fe.IncreaseRoleWeight,targetRole:X.role,rect:{x:V,y:w+(Oi-zt)/2,width:zt,height:zt},text:"+",currentWidth:zt,backgroundColor:Ne,textColor:"#fff",isDisabled:Oe}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${Z}%`,N,w+Oi/2),w+=Oi});const D=A[oe.Leader],M=Object.values(A).reduce((X,J)=>X+J,0),k=I.length-M;e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`Adults: ${I.length} | Leader: ${D} | Assigned: ${M} | Unassigned: ${k}`,l+Ho/2,w+10),e.fillText("(Adjust weights to control role distribution)",l+Ho/2,w+30);const U=t.autopilotControls.behaviors.roleManagement,j=U?" Auto-adjust: ON":" Auto-adjust: OFF",K=U?"#4CAF50":"#888";return e.fillStyle=K,e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`${j} (Shift+U to toggle)`,l+Ho/2,w+50),e.restore(),i}const Pr=600,Ms=30,bi=60,jt=30,kv=[{key:"protectHomeland",emoji:"",name:"Protect Homeland",description:"Stay inside territory and protect from enemies"},{key:"expandBorders",emoji:"",name:"Expand Borders",description:"Expand territory by placing border posts (Coming Soon)"},{key:"invadeEnemies",emoji:"",name:"Invade Enemies",description:"Attack enemies outside of our border"}];function nL(e,t,n){const i=[];if(!n.tribeControl||n.leaderId!==n.id)return i;const s=n.tribeControl.armyControl??{protectHomeland:Yg,expandBorders:zg,invadeEnemies:jg},{width:a,height:l}=e.canvas,d=(a-Pr)/2,u=350,f=(l-u)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(d,f,Pr,u,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Ht,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Army Control",d+Pr/2,f+Ms);const g=30,m=d+Pr-Ms-g,S=f+Ms,v=t.hoveredButtonId==="armyControl_close";e.fillStyle=v?"#ff7777":"#ff5555",e.fillRect(m,S,g,g),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",m+g/2,S+g/2),i.push({id:"armyControl_close",action:fe.CloseArmyControl,rect:{x:m,y:S,width:g,height:g},text:"X",currentWidth:g,backgroundColor:"#ff5555",textColor:"#ffffff"});let I=0;kv.forEach(P=>{I+=s[P.key]||0});let A=f+Ms+70;const _=d+Ms,R=d+Pr-Ms;return kv.forEach(P=>{const w=s[P.key]||0,b=I>0?Math.round(w/I*100):0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${P.emoji} ${P.name}`,_,A+bi/2);const N=d+320,D=N+jt+15,M=120,k=D+M+15,U=`army_minus_${P.key}`,j=t.hoveredButtonId===U,K=w<=0,X=K?"#555":j?"#dd6666":"#cc4444";e.fillStyle=X,e.fillRect(N,A+(bi-jt)/2,jt,jt),e.fillStyle=K?"#888":"#fff",e.textAlign="center",e.fillText("-",N+jt/2,A+bi/2+2),i.push({id:U,action:fe.DecreaseArmyObjective,targetArmyObjective:P.key,rect:{x:N,y:A+(bi-jt)/2,width:jt,height:jt},text:"-",currentWidth:jt,backgroundColor:X,textColor:"#fff",isDisabled:K}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#4CAF50";const J=M-10,Z=12,le=A+bi/2-Z/2;e.fillStyle="#333",e.fillRect(D,le,J,Z);const re=w/10*J;e.fillStyle="#4CAF50",e.fillRect(D,le,re,Z);const te=`army_plus_${P.key}`,Y=t.hoveredButtonId===te,V=w>=10,q=V?"#555":Y?"#66dd66":"#44cc44";e.fillStyle=q,e.fillRect(k,A+(bi-jt)/2,jt,jt),e.fillStyle=V?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",k+jt/2,A+bi/2+4),i.push({id:te,action:fe.IncreaseArmyObjective,targetArmyObjective:P.key,rect:{x:k,y:A+(bi-jt)/2,width:jt,height:jt},text:"+",currentWidth:jt,backgroundColor:q,textColor:"#fff",isDisabled:V}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${b}%`,R,A+bi/2),A+=bi}),e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText("Adjust priorities for warrior objectives",d+Pr/2,A+10),e.fillText("Higher values = higher priority",d+Pr/2,A+30),e.restore(),i}let Bv="",Fv=null;function iL(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function oL(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function Ld(e,t,n,i,s,a,l){const d=((t+i)%a+a)%a,u=((n+s)%l+l)%l;return e.has(`${d},${u}`)}function rL(e,t,n,i){const s=jP(t.soilDepletion,NA);if(s.length===0)return;const{width:a,height:l}=t.mapDimensions,d=i.width/2,u=i.height/2,f=Math.ceil(a/Xt),g=Math.ceil(l/Xt),m=iL(s);m!==Bv&&(Bv=m,Fv=oL(s));const S=Fv,v=Xt*2,I=n.x-d-v,A=n.x+d+v,_=n.y-u-v,R=n.y+u+v;e.save();const P=e.globalAlpha;for(const w of s){const b=w.gridX*Xt,N=w.gridY*Xt,D=sL(b,N,a,l,I,A,_,R);for(const M of D)aL(e,M.x,M.y,w.health,w.gridX,w.gridY,S,f,g)}e.globalAlpha=P,e.restore()}function sL(e,t,n,i,s,a,l,d){const u=[],f=Xt,g=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-i},{dx:0,dy:i},{dx:-n,dy:-i},{dx:n,dy:-i},{dx:-n,dy:i},{dx:n,dy:i}];for(const m of g){const S=e+m.dx,v=t+m.dy;S+f>=s&&S<=a&&v+f>=l&&v<=d&&u.push({x:S,y:v})}return u}function aL(e,t,n,i,s,a,l,d,u){const f=Math.floor(t),g=Math.floor(n),m=Xt,S=1-i/NA,I=i<Uw?yS:yS*S,A=!Ld(l,s,a,0,-1,d,u),_=!Ld(l,s,a,0,1,d,u),R=!Ld(l,s,a,-1,0,d,u),P=!Ld(l,s,a,1,0,d,u);e.globalAlpha=I,e.fillStyle=Fw,e.fillRect(f,g,m,m);const w=3;e.fillStyle=Lw,e.globalAlpha=I*1.2,A&&e.fillRect(f,g,m,w),_&&e.fillRect(f,g+m-w,m,w),R&&e.fillRect(f,g,w,m),P&&e.fillRect(f+m-w,g,w,m),e.globalAlpha=I*.5;const b=w+1;A&&R&&e.fillRect(f,g,b,b),A&&P&&e.fillRect(f+m-b,g,b,b),_&&R&&e.fillRect(f,g+m-b,b,b),_&&P&&e.fillRect(f+m-b,g+m-b,b,b),e.globalAlpha=1}const gl=8,pl=12,hn=24;function Lv(e,t,n,i,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-pl),e.stroke(),e.fillStyle=i,e.beginPath(),e.moveTo(t,n-pl),e.lineTo(t+gl,n-pl+gl/2),e.lineTo(t,n-pl+gl),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+gl/2,n-pl+gl/2))}function lL(e,t,n,i,s){const a=bu(t,s);let l=1;const d=new Map,u=new Map;for(const A of a){const R=A.leaderId===s?0:l++,P=xn[R%xn.length];d.set(A.leaderId,P),u.set(A.leaderId,A.tribeBadge||"")}const f=[],g=hn*2,m=Math.floor((n.x-i.width/2-g)/hn)*hn,S=Math.floor((n.x+i.width/2+g)/hn)*hn,v=Math.floor((n.y-i.height/2-g)/hn)*hn,I=Math.floor((n.y+i.height/2+g)/hn)*hn;for(let A=v;A<=I;A+=hn)for(let _=m;_<=S;_+=hn){const R=ri(_,A,t),P=_+hn,w=ri(P,A,t);if(R!==w){const D=R||w;if(D){const M=_+hn/2,k=A;Lv(e,M,k,d.get(D)||"#000",u.get(D)||""),f.push({x:M,y:k})}}const b=A+hn,N=ri(_,b,t);if(R!==N){const D=R||N;if(D){const M=_,k=A+hn/2;Lv(e,M,k,d.get(D)||"#000",u.get(D)||""),f.push({x:M,y:k})}}}return f}const Hn=12,Rt=16,ti=15;function Uv(e){switch(e){case G.Success:return"#4CAF50";case G.Failure:return"#F44336";case G.Running:return"#FFC107";case G.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function cL(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function dL(e,t,n,i){var M;const{debugCharacterId:s}=t,a=500,l=Math.min(i*.9,800),d=n-a-10,u=et+it*2;t.debugPanelRect={x:d,y:u,width:a,height:l},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(d,u,a,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(d,u,a,l),e.fillStyle="white",e.font=`${Hn}px monospace`,e.textAlign="left",e.textBaseline="top";let f=u+20;const g=d+15;if(e.fillStyle="#66ccff",e.font=`bold ${Hn+2}px monospace`,e.fillText(" Task AI Debugger",g,f),f+=25,!s){e.fillStyle="#888",e.font=`${Hn}px monospace`,e.fillText("No character selected for debugging.",g,f),e.fillText("Click on a character to inspect their Task AI.",g,f+20),e.restore();return}const m=t.entities.entities[s];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${Hn}px monospace`,e.fillText(`Character #${s} not found or not a character.`,g,f),e.restore();return}const S=m;e.fillStyle="white",e.font=`${Hn}px monospace`,e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,g,f),f+=Rt*1.5,e.fillStyle="#66ccff",e.font=`bold ${Hn}px monospace`,e.fillText(" Current Task",g,f),f+=Rt*1.5;const v=qg(S),I=v?t.tasks[v]:null;if(e.font=`${Hn}px monospace`,I){const k=E.get(S.aiBlackboard,mT),U=E.get(S.aiBlackboard,yT),j=k!==void 0?G[k]:"N/A";e.fillStyle="white",e.fillText(`ID: ${I.id}`,g+ti,f),f+=Rt,e.fillText(`Type: ${ae[I.type]}`,g+ti,f),f+=Rt,e.fillText(`Target: ${cL(I.target)}`,g+ti,f),f+=Rt,e.fillStyle=Uv(k),e.fillText(`Status: ${j}`,g+ti,f),f+=Rt,U&&(e.fillStyle="#aaa",e.fillText(`Message: ${U}`,g+ti,f),f+=Rt)}else e.fillStyle="#888",e.fillText("No active task.",g+ti,f),f+=Rt;f+=Rt,e.fillStyle="#66ccff",e.font=`bold ${Hn}px monospace`,e.fillText(" Recent Task History (Last 5)",g,f),f+=Rt*1.5;const A=E.get(S.aiBlackboard,Kg)||[];if(A.length===0)e.fillStyle="#888",e.font=`${Hn}px monospace`,e.fillText("No task history yet.",g+ti,f),f+=Rt;else for(const k of A){e.fillStyle="white",e.font=`${Hn}px monospace`;const U=ae[k.type];e.fillText(` ${U}`,g+ti,f);const j=G[k.result];e.fillStyle=Uv(k.result);const K=e.measureText(` ${U} `).width;e.fillText(`(${j})`,g+ti+K,f),e.fillStyle="#666";const X=e.measureText(`(${j}) `).width;e.fillText(`@ ${k.completedAtTick.toFixed(1)}h`,g+ti+K+X,f),f+=Rt,k.message&&(e.fillStyle="#888",e.fillText(`   ${k.message}`,g+ti,f),f+=Rt)}f+=Rt,e.fillStyle="#66ccff",e.font=`bold ${Hn}px monospace`,e.fillText(" Available Tasks",g,f),f+=Rt*1.5;const _=f,R=u+l-_-30;e.save(),e.beginPath(),e.rect(d,_,a,R),e.clip();const P=((M=t.debugPanelScroll)==null?void 0:M.y)??0;e.translate(0,-P);const w=t.search.tasks.byRadius(m.position,800);let b=0;if(w.length===0)e.fillStyle="#888",e.font=`${Hn}px monospace`,e.fillText("No tasks available in the world.",g+ti,f),f+=Rt;else{const k=w.map(U=>{const j=Yu[U.type];return{task:U,score:j&&j.scorer&&S.type==="human"?j.scorer(S,U,{gameState:t,deltaTime:0}):null}});k.sort((U,j)=>{const K=U.score!==null?U.score:-1/0;return(j.score!==null?j.score:-1/0)-K});for(const{task:U,score:j}of k){let K="Unclaimed",X="#888";U.claimedByEntityId&&(U.claimedByEntityId===S.id?(K="Claimed by this character",X="#4CAF50"):(K=`Claimed by #${U.claimedByEntityId}`,X="#F44336")),e.font=`${Hn}px monospace`,e.fillStyle=X;const J=` Task ID: ${U.id}`;e.fillText(J,g,f),f+=Rt,e.fillStyle="white",e.fillText(`  Type: ${ae[U.type]}`,g,f),f+=Rt;const Z=j!==null?j.toFixed(3):"N/A";e.fillStyle=j!==null&&j>0?"#FFC107":"#888",e.fillText(`  Score: ${Z}`,g,f),f+=Rt,e.fillStyle=X,e.fillText(`  Status: ${K}`,g,f),f+=Rt*1.5,b=Math.max(b,e.measureText(J).width+30)}}const N=f-_;t.debugPanelContentSize={width:b,height:N},e.restore();const D=u+l-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",d+a/2,D),e.restore()}function uL(e,t,n,i){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey")return;switch(a.aiType){case $t.TaskBased:dL(e,t,n,i);break;case $t.BehaviorTreeBased:UB(e,t,n,i);break}const l=500,d=n-l-10,u=et+it*2,f=150,g=25,m=d+l-f-15,S=u+15,v={x:m,y:S,width:f,height:g};t.uiButtons.push({id:"switch-ai-type-button",action:fe.SwitchAIType,rect:v,text:"",currentWidth:f,backgroundColor:"rgba(100, 100, 100, 0.5)",textColor:"white"}),e.save(),e.fillStyle="rgba(100, 100, 100, 0.8)",e.fillRect(m,S,f,g),e.strokeStyle="#fff",e.lineWidth=1,e.strokeRect(m,S,f,g),e.fillStyle="white",e.font="10px monospace",e.textAlign="center",e.textBaseline="middle";const I=a.aiType===$t.BehaviorTreeBased?"BT":"Task";e.fillText(`AI: ${I} (Switch)`,m+f/2,S+g/2),e.restore()}function mu(e,t,n,i,s,a=!1){var f;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),vB(e,t);return}const l=vt(t),d=lL(e,t,n,s,l==null?void 0:l.leaderId);if(rL(e,t,n,s),GF(e,t,t.debugPanel===je.General,n,s,d),l&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const g=Jg(t.mousePosition,n,s,t.mapDimensions),m=ca(g,t.selectedBuildingType,l.leaderId,t);yF(e,g,t.selectedBuildingType,m,t.mapDimensions)}const u=t.notifications.filter(g=>!g.isDismissed);for(const g of u){const m=(Math.sin(t.time*AP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=vP,g.targetArea&&e.fillRect(g.targetArea.x,g.targetArea.y,g.targetArea.width,g.targetArea.height),g.targetRadius&&(e.beginPath(),e.arc(g.targetRadius.x,g.targetRadius.y,g.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,MB(e,t),e.restore(),!a){e.fillStyle=P1,e.font=`${it}px "Press Start 2P", Arial`,e.shadowColor=D1,e.shadowBlur=N1,t.uiButtons=[];let g=null,m=null;if(l){const I=Mn(t,l),A=jr(I),_=((f=l.partnerIds)==null?void 0:f.map(P=>t.entities.entities[P]).filter(P=>P!==void 0))||[],R=$F(e,t,l,A,_,I);g=R.hungerBarRect,m=R.foodBarRect}const S=bu(t,l==null?void 0:l.leaderId);mB(e,t,S,e.canvas.width,e.canvas.height);const{commandButtonsRect:v}=iB(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,l&&(DB(e,t,n,e.canvas.width,e.canvas.height),i.length>0&&aB(e,i,l,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:I}=t.tutorialState;I.includes(Wr.HUNGER_BAR)&&g&&mg(e,g,t.time),I.includes(Wr.FOOD_BAR)&&m&&mg(e,m,t.time),I.includes(Wr.COMMAND_BUTTONS)&&v&&mg(e,v,t.time)}if(t.tutorialState.isActive){const I=SB(e,t,e.canvas.width,e.canvas.height);I&&t.uiButtons.push({id:"tutorial-dismiss",action:fe.DismissTutorial,rect:I,text:"",currentWidth:I.width,backgroundColor:"transparent",textColor:"transparent"})}switch(bB(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case je.Ecosystem:YF(e,t,e.canvas.width,e.canvas.height);break;case je.Tribe:qF(e,t,e.canvas.width,e.canvas.height);break;case je.SupplyChain:GB(e,t,e.canvas.width,e.canvas.height);break;case je.Performance:BB(e,t,s.width);break;case je.General:uL(e,t,e.canvas.width,e.canvas.height);break}if(t.roleManagerOpen&&l&&l.leaderId===l.id){const I=tL(e,t,l);t.uiButtons.push(...I)}if(t.armyControlOpen&&l&&l.leaderId===l.id){const I=nL(e,t,l);t.uiButtons.push(...I)}t.isPaused&&t.exitConfirmation!=="pending"&&oB(e),t.exitConfirmation==="pending"&&JF(e,t,e.canvas.width,e.canvas.height)}}const fL=Ot.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,hL=Ot.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,gL=Ot.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,pL=Ot.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Hv=Ot.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,mL=Ot.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,yL=Ot.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,Ud="intro-soundtrack",Gv=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=Kr(),i=Fe.useRef(null),s=Fe.useRef(null),a=Fe.useRef(Qb()),l=Fe.useRef(),d=Fe.useRef(a.current.viewportCenter),u=Fe.useRef(),f=Fe.useCallback(()=>{ig(Ud,2),n(),e("game")},[e,n]),g=Fe.useCallback(()=>{t&&(ig(Ud,2),e("game"))},[e,t]);Fe.useEffect(()=>{const v=I=>{(I.key==="Enter"||I.key===" ")&&(t?g():f())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[f,g,t]),Fe.useEffect(()=>(Fp(_e.SoundTrack1,{loop:!0,trackId:Ud}),()=>{ig(Ud,2)}),[]),Fe.useEffect(()=>{const v=i.current;if(!v)return;s.current=v.getContext("2d");const I=()=>{v&&s.current&&(v.width=window.innerWidth,v.height=window.innerHeight,mu(s.current,a.current,d.current,[],{width:v.width,height:v.height},!0))};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]),Fe.useEffect(()=>{const v=()=>{const A=tI(a.current);if(A.length>0){const _=Math.floor(Math.random()*A.length);u.current=A[_].id}};v();const I=setInterval(v,Iw);return()=>clearInterval(I)},[]);const[m,S]=IA(v=>{var _,R;if(!s.current)return;if(l.current===void 0){l.current=v;return}const I=Math.min((v-l.current)/1e3,1);a.current=zu(a.current,I);const A=u.current?a.current.entities.entities[u.current]:void 0;if(A){const{mapDimensions:P}=a.current,{width:w,height:b}=P;let N={...A.position};const D=N.x-d.current.x;Math.abs(D)>w/2&&(D>0?N.x-=w:N.x+=w);const M=N.y-d.current.y;Math.abs(M)>b/2&&(M>0?N.y-=b:N.y+=b);let k=np(d.current,N,hp*I);k={x:(k.x%w+w)%w,y:(k.y%b+b)%b},d.current=k}mu(s.current,a.current,d.current,[],{width:((_=i.current)==null?void 0:_.width)||800,height:((R=i.current)==null?void 0:R.height)||600},!0),l.current=v});return Fe.useEffect(()=>(S(),m),[S,m]),Ue.jsxs(fL,{children:[Ue.jsx(hL,{ref:i}),Ue.jsxs(gL,{children:[Ue.jsx(pL,{children:"Tribe2"}),Ue.jsxs(mL,{children:[Ue.jsx(Hv,{onClick:f,children:"New Game"}),t&&Ue.jsx(Hv,{onClick:g,children:"Load Game"})]}),Ue.jsxs(yL,{children:["by"," ",Ue.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function SL(){console.log("Tribe game initialized with detailed 2D world state.");const e=Zb();return e.ecosystem={preyGestationPeriod:Ur,preyProcreationCooldown:Hr,predatorGestationPeriod:Gr,predatorProcreationCooldown:$r,preyHungerIncreasePerHour:jo,predatorHungerIncreasePerHour:Xo,berryBushSpreadChance:lo},e.debugPanel=je.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const vL=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:i,playerActionHintsRef:s})=>(Fe.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const l=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,mu(t.current,n.current,i.current,s.current,{width:a.width,height:a.height},!1))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),Ue.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),AL=(e,t,n,i=!1)=>{var l,d;let s;const a=u1(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:se.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:se.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const u=a;t.isAdult&&qr(t,u,n)?s={action:se.AutopilotAttack,targetEntityId:u.id}:or(t,u,n)?s={action:se.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:se.AutopilotFeedChild,targetEntityId:u.id})}else if(a.type==="prey")s={action:se.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:se.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const u=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&Vt(t,u,n)&&u.isConstructed?s={action:se.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:se.Removal,position:a.position};else if(t.leaderId===t.id&&Vt(t,u,n)&&u.isConstructed)KA(u.position,sa,t.id,n).valid?s={action:se.TakeOverBuilding,targetEntityId:u.id}:s={action:se.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const f=u.ownerId===t.leaderId,g=u.storedItems.length>0,m=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(i&&u.isConstructed&&g&&t.food.length<t.maxFood)if(f)s={action:se.AutopilotRetrieve,targetEntityId:a.id};else{const S=t.leaderId?n.entities.entities[t.leaderId]:void 0;S&&((l=S.tribeControl)!=null&&l.diplomacy)?(u.ownerId&&S.tribeControl.diplomacy[u.ownerId])===Ut.Hostile?s={action:se.AutopilotGather,targetEntityId:a.id}:s={action:se.AutopilotMove,position:e}:s={action:se.AutopilotMove,position:e}}else f&&u.isConstructed?(t.food.length>0||t.heldItem)&&m?s={action:se.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&g?s={action:se.AutopilotRetrieve,targetEntityId:a.id}:s={action:se.AutopilotMove,position:e}:s={action:se.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(f=>f.type===In.Berry).length>=fo&&!zn(e,n,Qo)&&!Ui(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:se.AutopilotPlant,position:e}:u.buildingType===ce.Bonfire&&((d=t.heldItem)==null?void 0:d.type)===yt.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:se.AutopilotDeposit,targetEntityId:u.id}:s={action:se.AutopilotMove,position:e}}else if(a.type==="tree"){const u=a,[f]=u.stateMachine??[],g=f===ln||f===Kt||f===An;t.isAdult&&!t.heldItem&&g?s={action:se.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&f===Gt&&u.wood.length>0?s={action:se.AutopilotGather,targetEntityId:u.id}:s={action:se.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===In.Berry).length>=fo&&(n.autopilotControls.isManuallyPlanting||Jl(e,n,t))&&!Ui(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:se.AutopilotPlant,position:e}:s={action:se.AutopilotMove,position:e};return s},IL=(e,t)=>{if(e.isPaused)return;const n=vt(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=H(n.position,t,e.mapDimensions.width,e.mapDimensions.height),l=100;a<=l?ca(t,s,n.leaderId,e,n.position,l)&&(qo(t,s,n.leaderId,e),e.selectedBuildingType=null):ca(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:se.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=A1(t,e);s&&$g(s.id,e);return}const i=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,i?(e.autopilotControls.activeAutopilotAction=i,(i.action===se.AutopilotMove||i.action===se.AutopilotGather||i.action===se.AutopilotChop)&&(e.hasPlayerMovedEver=!0),i.action===se.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:se.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},TL=(e,t)=>{var l,d,u,f,g,m,S,v;const n=e.key.toLowerCase(),i=e.ctrlKey||e.metaKey;let s=!0,a=t;if(i){switch(n){case"s":sp(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:I}=t;I.activeAutopilotAction||I.isManuallyMoving||I.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(I.activeAutopilotAction=void 0,I.isManuallyMoving=!1,I.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"u":const A=vt(t);A&&A.isAdult&&A.leaderId===A.id&&(e.shiftKey?t.autopilotControls.behaviors.roleManagement=!t.autopilotControls.behaviors.roleManagement:t.roleManagerOpen=!t.roleManagerOpen);break;case"v":{const P=vt(t);P&&P.isAdult&&P.leaderId===P.id&&(t.armyControlOpen=!t.armyControlOpen);break}case"m":t.isMuted=!t.isMuted,Rl(t.masterVolume,t.isMuted);break;case"=":case"+":const _=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(_.toFixed(1)),Rl(t.masterVolume,t.isMuted);break;case"-":const R=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(R.toFixed(1)),Rl(t.masterVolume,t.isMuted);break;case"t":a=zu(t,FI);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===je.General?(a.debugPanel=je.None,a.debugCharacterId=void 0):(a.debugPanel=je.General,a.debugCharacterId||(a.debugCharacterId=((l=vt(a))==null?void 0:l.id)??((d=Object.values(a.entities.entities).find(P=>P.type==="human"||P.type==="prey"||P.type==="predator"))==null?void 0:d.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===je.Ecosystem){a.debugPanel=je.None;break}a.debugPanel=je.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((u=vt(a))==null?void 0:u.id)??((f=Object.values(a.entities.entities).find(P=>P.type==="human"||P.type==="prey"||P.type==="predator"))==null?void 0:f.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===je.Tribe){a.debugPanel=je.None;break}a.debugPanel=je.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((g=vt(a))==null?void 0:g.id)??((m=a.search.human.all().find(P=>P.leaderId===P.id))==null?void 0:m.id))}else s=!1;break;case"$":if(e.shiftKey){if(a.debugPanel===je.SupplyChain){a.debugPanel=je.None;break}a.debugPanel=je.SupplyChain,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((S=vt(a))==null?void 0:S.id)??((v=a.search.human.all().find(P=>P.leaderId===P.id))==null?void 0:v.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===je.Performance){a.debugPanel=je.None;break}a.debugPanel=je.Performance}else s=!1;break;case"tab":if(a.debugPanel!==je.General&&a.debugPanel!==je.Tribe&&a.debugPanel!==je.SupplyChain&&(a.debugPanel=je.General),a.debugPanel===je.General){const P=Object.values(a.entities.entities).filter(w=>w.type==="human"||w.type==="prey"||w.type==="predator");if(P.length>0){const w=P.sort((M,k)=>{if(M.type==="human"&&M.isPlayer)return-1;if(k.type==="human"&&k.isPlayer)return 1;if(M.type!==k.type){const U={human:0,prey:1,predator:2},j=U[M.type]??999,K=U[k.type]??999;return j-K}return M.id-k.id}),b=a.debugCharacterId,D=((b?w.findIndex(M=>M.id===b):-1)+1)%w.length;a.debugCharacterId=w[D].id}else a.debugCharacterId=void 0}else if(a.debugPanel===je.Tribe||a.debugPanel===je.SupplyChain){const P=a.search.human.all().filter(b=>b.leaderId===b.id);let w=P.findIndex(b=>b.id===a.debugCharacterId)+1;(w===-1||w>P.length-1)&&(w=0),a.debugCharacterId=P[w].id}else a.debugPanel=je.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},EL=(e,t,n,i,s)=>{var l;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",Me(a,_e.ButtonClick,i.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",Me(a,_e.ButtonClick,i.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",Me(a,_e.ButtonClick,i.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",Me(a,_e.ButtonClick,i.position);return}else if(e==="6"){n.selectedBuildingType="removal",Me(a,_e.ButtonClick,i.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=Be(i,n,"berryBush",ze,g=>g.food.length>0&&i.food.length<i.maxFood),u=Be(i,n,"corpse",ze,g=>g.food.length>0&&i.food.length<i.maxFood);let f=null;d&&u?f=H(i.position,d.position,n.mapDimensions.width,n.mapDimensions.height)<=H(i.position,u.position,n.mapDimensions.width,n.mapDimensions.height)?d:u:f=d||u,f&&(i.activeAction="gathering",Me(a,_e.Gather,i.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}Be(i,n,"human",ze,u=>or(i,u,n))&&(i.activeAction="procreating",Me(a,_e.Procreate,i.position))}else if(e==="f")i.food.length>0&&(i.activeAction="eating",Me(a,_e.Eat,i.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=s.find(u=>u.type===se.FeedChild);d&&d.targetEntity&&(i.activeAction="feeding",i.target=d.targetEntity.id)}else if(e==="arrowup"||e==="w")i.direction.y=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")i.direction.y=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")i.direction.x=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")i.direction.x=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const d=Be(i,n,"human",Sn,u=>qr(i,u,n))??Be(i,n,"predator",Sn)??Be(i,n,"prey",Sn);d&&(i.activeAction="attacking",i.attackTargetId=d.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===se.Plant)){const u=SR(i.position,n,50,bg);u&&(i.activeAction="planting",i.target=u,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=Be(i,n,"building",qt,f=>{const g=f;return g.buildingType===ce.Bonfire&&g.isConstructed&&g.storedItems.length<(g.storageCapacity||0)});if(((l=i.heldItem)==null?void 0:l.type)===yt.Wood&&d){i.activeAction="depositing",i.target=d.id,Me(a,_e.StorageDeposit,i.position);return}const u=Be(i,n,"building",qt,f=>{const g=f;return g.buildingType===ce.StorageSpot&&g.ownerId===i.leaderId&&g.isConstructed&&g.storageCapacity!==void 0&&g.storedItems.length<g.storageCapacity});u&&(i.activeAction="idle",i.target=u.id,Me(a,_e.StorageDeposit,i.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=Be(i,n,"building",qt,u=>{const f=u;return f.buildingType==="storageSpot"&&f.ownerId===i.leaderId&&f.isConstructed&&f.storedItems.length>0});d&&(i.activeAction="idle",i.target=d.id,Me(a,_e.StorageRetrieve,i.position))}else if(e==="k")jI(i,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,Me(a,_e.ButtonClick,i.position)}else if(e==="u"){if(t){n.autopilotControls.behaviors.roleManagement=!n.autopilotControls.behaviors.roleManagement;return}}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const d=Be(i,n,"tree",_u,u=>u.wood&&u.wood.length>0&&!i.heldItem);d&&(i.activeAction="chopping",i.target=d.id)}},CL=(e,t,n,i)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!i.current.has("arrowup")&&!i.current.has("arrowdown")&&!i.current.has("arrowleft")&&!i.current.has("arrowright")&&!i.current.has("w")&&!i.current.has("a")&&!i.current.has("s")&&!i.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!i.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!i.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!i.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!i.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!i.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},_L=(e,t,n)=>{let s=vt(e);if(e.debugCharacterId){const a=e.entities.entities[e.debugCharacterId];a&&"position"in a&&(s=a)}if(s){const{mapDimensions:a}=e,{width:l,height:d}=a;let u={...s.position};const f=u.x-t.x;Math.abs(f)>l/2&&(f>0?u.x-=l:u.x+=l);const g=u.y-t.y;Math.abs(g)>d/2&&(g>0?u.y-=d:u.y+=d);let m=np(t,u,hp*n);return m={x:(m.x%l+l)%l,y:(m.y%d+d)%d},m}return e.viewportCenter};function wL(e,t){const{width:n,height:i}=e.mapDimensions;e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%i+i)%i}}const RL=(e,t,n,i)=>{var u,f;const s={gameState:n},a=vt(n);a&&Me(s,_e.ButtonClick,a.position);const l=n.uiButtons.find(g=>g.id===e.id);l&&(l.lastActivated=Date.now()),t&&[fe.CommandGather,fe.CommandPlant,fe.ToggleProcreationBehavior,fe.CommandBuild,fe.OpenRoleManager].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:d}=n.autopilotControls;switch(e.action){case fe.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case fe.ConfirmExitYes:i(),n.exitConfirmation="inactive";break;case fe.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case fe.ToggleMute:n.isMuted=!n.isMuted,Rl(n.masterVolume,n.isMuted);break;case fe.TogglePause:n.isPaused=!n.isPaused;break;case fe.FastForward:return zu(n,FI);case fe.DismissTutorial:n.tutorialState.isActive=!1;break;case fe.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case fe.CommandGather:t?d.gathering=!d.gathering:a&&(a.activeAction="gathering");break;case fe.CommandPlant:t?d.planting=!d.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case fe.ToggleProcreationBehavior:d.procreation=!d.procreation;break;case fe.ToggleAttackBehavior:d.attack=!d.attack;break;case fe.ToggleFeedChildBehavior:d.feedChildren=!d.feedChildren;break;case fe.CommandTribeSplit:a&&jI(a,n);break;case fe.CommandBuild:t?d.build=!d.build:n.buildMenuOpen=!n.buildMenuOpen;break;case fe.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case fe.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case fe.SelectRemovalTool:n.selectedBuildingType="removal";break;case fe.SelectBorderPost:n.selectedBuildingType="borderPost";break;case fe.SelectBonfire:n.selectedBuildingType="bonfire";break;case fe.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const g=a.leaderId,m=e.targetTribeId,S=n.entities.entities[m],v=(u=a.tribeControl)==null?void 0:u.diplomacy,I=(f=S==null?void 0:S.tribeControl)==null?void 0:f.diplomacy;if(v&&I){const _=(v[m]||Ut.Friendly)===Ut.Friendly?Ut.Hostile:Ut.Friendly;v[m]=_,I[g]=_}}break;case fe.OpenRoleManager:t?d.roleManagement=!d.roleManagement:n.roleManagerOpen=!0;break;case fe.CloseRoleManager:n.roleManagerOpen=!1;break;case fe.IncreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const g=a.tribeControl.roleWeights[e.targetRole]||0;g<10&&(a.tribeControl.roleWeights[e.targetRole]=g+1)}break;case fe.DecreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const g=a.tribeControl.roleWeights[e.targetRole]||0;g>0&&(a.tribeControl.roleWeights[e.targetRole]=g-1)}break;case fe.OpenArmyControl:n.armyControlOpen=!0;break;case fe.CloseArmyControl:n.armyControlOpen=!1;break;case fe.IncreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Yg,expandBorders:zg,invadeEnemies:jg});const g=a.tribeControl.armyControl[e.targetArmyObjective]||0;g<10&&(a.tribeControl.armyControl[e.targetArmyObjective]=g+1)}break;case fe.DecreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Yg,expandBorders:zg,invadeEnemies:jg});const g=a.tribeControl.armyControl[e.targetArmyObjective]||0;g>0&&(a.tribeControl.armyControl[e.targetArmyObjective]=g-1)}break;case fe.SwitchAIType:if(n.debugCharacterId){const g=n.entities.entities[n.debugCharacterId];g&&(g.aiType=g.aiType===$t.BehaviorTreeBased?$t.TaskBased:$t.BehaviorTreeBased)}break}return n};function PL(e,t,n){if(!e.notificationButtonRects)return!1;const i=vt(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return pR(e,s),i&&Me({gameState:e},_e.ButtonClick,i.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const l=e.notifications.find(d=>d.id===s);if(l){let d=l.targetPosition;if(!d&&l.targetEntityIds&&l.targetEntityIds.length>0){const u=e.entities.entities[l.targetEntityIds[0]];u&&(d=u.position)}return d&&wL(e,d),i&&Me({gameState:e},_e.ButtonClick,i.position),l.highlightedEntityIds&&(l.renderHighlights=!l.renderHighlights),!0}}return!1}function GT(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const DL=(e,t)=>{var n;if(t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(GT(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},NL=(e,t)=>t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:GT(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},$v=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},ML=(e,t)=>{var n,i;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const l=t.debugPanelRect.height-60,d=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.height)??0)-l);return t.debugPanelScroll.y>d&&(t.debugPanelScroll.y=d),{newState:t,handled:!0}}return{newState:t,handled:!1}},OL=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,returnToIntro:l})=>(Fe.useEffect(()=>{const d=u=>{if(!e()||t.current.gameOver||!n.current)return;const f=DL(u,t.current);t.current=f.newState,f.handled};return window.addEventListener("wheel",d,{passive:!1}),()=>{window.removeEventListener("wheel",d)}},[e,n,t]),Fe.useEffect(()=>{const d=f=>{if(!e()||t.current.gameOver||!n.current||!f.target||f.target!==n.current)return;const g=n.current.getBoundingClientRect(),m=f.clientX-g.left,S=f.clientY-g.top;if(PL(t.current,m,S))return;const I=t.current.uiButtons.find(R=>m>=R.rect.x&&m<=R.rect.x+R.rect.width&&S>=R.rect.y&&S<=R.rect.y+R.rect.height);if(I){t.current=RL(I,f.shiftKey,t.current,l);return}const A=NL(f,t.current);if(t.current=A.newState,A.handled)return;const _=Jg({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);IL(t.current,_)},u=f=>{if(!e()||!n.current)return;const g=$v(f,t.current);t.current=g.newState};return window.addEventListener("mousedown",d),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("mouseup",u)}},[e,n,t,i,l]),Fe.useEffect(()=>{const d=u=>{if(!e()||!n.current)return;const f=ML(u,t.current);if(t.current=f.newState,f.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const A=$v(u,t.current);t.current=A.newState}const g=n.current.getBoundingClientRect(),m=u.clientX-g.left,S=u.clientY-g.top;t.current.mousePosition={x:m,y:S};let v;if(t.current.notificationButtonRects){for(const[A,_]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=_.x&&m<=_.x+_.width&&S>=_.y&&S<=_.y+_.height){v=`notification-dismiss-${A}`;break}if(!v){for(const[A,_]of Object.entries(t.current.notificationButtonRects.view))if(m>=_.x&&m<=_.x+_.width&&S>=_.y&&S<=_.y+_.height){v=`notification-view-${A}`;break}}}if(!v)for(let A=t.current.uiButtons.length-1;A>=0;A--){const _=t.current.uiButtons[A];if(m>=_.rect.x&&m<=_.rect.x+_.rect.width&&S>=_.rect.y&&S<=_.rect.y+_.rect.height){v=_.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0;return}const I=vt(t.current);if(I){const A=Jg({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=AL(A,I,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}},[e,n,t,i]),Fe.useEffect(()=>{const d=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();(g===" "||g==="p"||g==="tab"||(f.ctrlKey||f.metaKey)&&(g==="s"||g==="a"))&&f.preventDefault();const m=TL(f,t.current);if(t.current=m.newState,m.handled)return;const S=vt(t.current);S&&(a.current.add(g),EL(g,f.shiftKey,t.current,S,s.current))},u=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();a.current.delete(g);const m=vt(t.current);m&&CL(g,m,t.current,a)};return window.addEventListener("keydown",d),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}},[e,t,s,a,l]),null),bL=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,canvasRef:l,setAppState:d,appState:u})=>{const f=Fe.useRef(),{returnToIntro:g}=Kr(),[m,S,v]=IA(I=>{var b,N;if(!t.current||!f.current){f.current=I;return}const A=Math.min(I-f.current,1e3)/1e3,{performanceMetrics:_}=e.current;_.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const R=performance.now();e.current=zu(e.current,A),_.currentBucket.worldUpdateTime=performance.now()-R;const P=vt(e.current);P?s.current=Gp(e.current,P):s.current=[],i.current=_L(e.current,i.current,A);const w=performance.now();mu(t.current,e.current,i.current,s.current,{width:((b=l.current)==null?void 0:b.width)||800,height:((N=l.current)==null?void 0:N.height)||600},!1),_.currentBucket.renderTime=performance.now()-w,_.history.push({bucketTime:e.current.time,..._.currentBucket}),_.history.length>Tw&&_.history.shift(),f.current=I,e.current.gameOver&&u!=="gameOver"&&(Fp(_e.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),d("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return Fe.useEffect(()=>(S(),m),[S,m]),Ue.jsx(OL,{isActive:v,gameStateRef:e,canvasRef:l,viewportCenterRef:i,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:g})},xv=()=>{const{savedGameState:e,contextReady:t}=Kr(),[n,i]=Fe.useState(null);return Fe.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),i(e)):(console.log("Initializing new game state..."),i(SL())))},[t,e]),!t||!n?Ue.jsx("div",{children:"Loading..."}):Ue.jsx(kL,{initialState:n})},kL=({initialState:e})=>{const t=Fe.useRef(null),n=Fe.useRef(null),i=Fe.useRef(e),s=Fe.useRef(new Set),a=Fe.useRef(e.debugPanel),l=Fe.useRef(e.viewportCenter),d=Fe.useRef([]),{appState:u,setAppState:f}=Kr();return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(vL,{canvasRef:t,ctxRef:n,gameStateRef:i,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:d}),Ue.jsx(bL,{gameStateRef:i,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:d,keysPressed:s,canvasRef:t,setAppState:f,appState:u})]})},BL=Ot.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,FL=Ot.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Hd=Ot.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,LL=Ot.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,UL=()=>{const{setAppState:e,gameOverDetails:t}=Kr(),n=()=>{e("intro")};return Ue.jsxs(BL,{children:[Ue.jsx(FL,{children:"Game Over"}),Ue.jsx(Hd,{children:"Your tribe's lineage has ended."}),t&&Ue.jsxs(Ue.Fragment,{children:[Ue.jsxs(Hd,{children:["Generations Survived: ",t.generations]}),Ue.jsxs(Hd,{children:["Cause of Extinction: ",t.cause]})]}),!t&&Ue.jsx(Hd,{children:"Game details are unavailable."}),Ue.jsx(LL,{onClick:n,children:"Return to Menu"})]})},HL=Ot.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,GL=Ot.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,$L=Ot.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,xL=Ot.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,WL=Ot.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,$T=Ot.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,YL=Ot($T)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,ml=800,yl=600,zL=()=>{const{returnToIntro:e}=Kr(),t=Fe.useRef(null),n=Fe.useRef(),i=Fe.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:ml,height:yl}}),s=l=>{const d={x:ml/2,y:yl/2};let u;l===Ce.StoneProjectile&&(u={x:d.x+200*(Math.random()-Math.random()),y:d.y+200*(Math.random()-Math.random())}),Ge(i.current,l,d,1,void 0,u)};Fe.useEffect(()=>{const l=()=>{i.current.time+=.016,wT(i.current);const u=t.current,f=u==null?void 0:u.getContext("2d");f&&(f.clearRect(0,0,ml,yl),f.fillStyle="#2c5234",f.fillRect(0,0,ml,yl),i.current.visualEffects.forEach(g=>{UT(f,g,i.current.time,i.current)})),n.current=requestAnimationFrame(l)};return n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(Ce).filter(l=>isNaN(Number(l))).map(l=>({name:l,value:Ce[l]}));return Ue.jsxs(HL,{children:[Ue.jsxs(GL,{children:[Ue.jsx(WL,{children:"Visual Effects"}),a.map(l=>Ue.jsx($T,{onClick:()=>s(l.value),children:l.name},l.name)),Ue.jsx(YL,{onClick:e,children:"Back to Intro"})]}),Ue.jsxs($L,{children:[Ue.jsx(xL,{ref:t,width:ml,height:yl}),Ue.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},jL=pw`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function XL(e,t){Fe.useEffect(()=>{const n=()=>{const i=document.location.hash;t(i==="#game"?"game":i==="#effects"?"effects":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),Fe.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const VL=()=>{const{appState:e,setAppState:t}=Kr();XL(e,t);const n=()=>{switch(e){case"intro":return Ue.jsx(Gv,{});case"game":return Ue.jsx(xv,{});case"effects":return Ue.jsx(zL,{});case"gameOver":return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(xv,{}),Ue.jsx(UL,{})]});default:return Ue.jsx(Gv,{})}};return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(jL,{}),n()]})},Wv=document.getElementById("root");Wv?mD().then(()=>{KC.createRoot(Wv).render(Ue.jsx(Bi.StrictMode,{children:Ue.jsx(g_,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:Ue.jsx(VL,{})})}))}):console.error("Failed to find the root element");
