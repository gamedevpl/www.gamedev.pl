var pT=Object.defineProperty;var gT=(e,t,i)=>t in e?pT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Nt=(e,t,i)=>gT(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function i(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=i(s);fetch(s.href,l)}})();function Fy(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var rf={exports:{}},qs={},sf={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ym;function mT(){if(Ym)return He;Ym=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),y=Symbol.iterator;function I(k){return k===null||typeof k!="object"?null:(k=y&&k[y]||k["@@iterator"],typeof k=="function"?k:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,A={};function E(k,U,se){this.props=k,this.context=U,this.refs=A,this.updater=se||v}E.prototype.isReactComponent={},E.prototype.setState=function(k,U){if(typeof k!="object"&&typeof k!="function"&&k!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,k,U,"setState")},E.prototype.forceUpdate=function(k){this.updater.enqueueForceUpdate(this,k,"forceUpdate")};function C(){}C.prototype=E.prototype;function _(k,U,se){this.props=k,this.context=U,this.refs=A,this.updater=se||v}var w=_.prototype=new C;w.constructor=_,T(w,E.prototype),w.isPureReactComponent=!0;var R=Array.isArray,N=Object.prototype.hasOwnProperty,D={current:null},B={key:!0,ref:!0,__self:!0,__source:!0};function G(k,U,se){var ce,Re={},ae=null,Se=null;if(U!=null)for(ce in U.ref!==void 0&&(Se=U.ref),U.key!==void 0&&(ae=""+U.key),U)N.call(U,ce)&&!B.hasOwnProperty(ce)&&(Re[ce]=U[ce]);var Te=arguments.length-2;if(Te===1)Re.children=se;else if(1<Te){for(var ie=Array(Te),he=0;he<Te;he++)ie[he]=arguments[he+2];Re.children=ie}if(k&&k.defaultProps)for(ce in Te=k.defaultProps,Te)Re[ce]===void 0&&(Re[ce]=Te[ce]);return{$$typeof:e,type:k,key:ae,ref:Se,props:Re,_owner:D.current}}function $(k,U){return{$$typeof:e,type:k.type,key:U,ref:k.ref,props:k.props,_owner:k._owner}}function V(k){return typeof k=="object"&&k!==null&&k.$$typeof===e}function X(k){var U={"=":"=0",":":"=2"};return"$"+k.replace(/[=:]/g,function(se){return U[se]})}var q=/\/+/g;function re(k,U){return typeof k=="object"&&k!==null&&k.key!=null?X(""+k.key):U.toString(36)}function ee(k,U,se,ce,Re){var ae=typeof k;(ae==="undefined"||ae==="boolean")&&(k=null);var Se=!1;if(k===null)Se=!0;else switch(ae){case"string":case"number":Se=!0;break;case"object":switch(k.$$typeof){case e:case t:Se=!0}}if(Se)return Se=k,Re=Re(Se),k=ce===""?"."+re(Se,0):ce,R(Re)?(se="",k!=null&&(se=k.replace(q,"$&/")+"/"),ee(Re,U,se,"",function(he){return he})):Re!=null&&(V(Re)&&(Re=$(Re,se+(!Re.key||Se&&Se.key===Re.key?"":(""+Re.key).replace(q,"$&/")+"/")+k)),U.push(Re)),1;if(Se=0,ce=ce===""?".":ce+":",R(k))for(var Te=0;Te<k.length;Te++){ae=k[Te];var ie=ce+re(ae,Te);Se+=ee(ae,U,se,ie,Re)}else if(ie=I(k),typeof ie=="function")for(k=ie.call(k),Te=0;!(ae=k.next()).done;)ae=ae.value,ie=ce+re(ae,Te++),Se+=ee(ae,U,se,ie,Re);else if(ae==="object")throw U=String(k),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(k).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.");return Se}function ne(k,U,se){if(k==null)return k;var ce=[],Re=0;return ee(k,ce,"","",function(ae){return U.call(se,ae,Re++)}),ce}function oe(k){if(k._status===-1){var U=k._result;U=U(),U.then(function(se){(k._status===0||k._status===-1)&&(k._status=1,k._result=se)},function(se){(k._status===0||k._status===-1)&&(k._status=2,k._result=se)}),k._status===-1&&(k._status=0,k._result=U)}if(k._status===1)return k._result.default;throw k._result}var te={current:null},W={transition:null},Q={ReactCurrentDispatcher:te,ReactCurrentBatchConfig:W,ReactCurrentOwner:D};function Z(){throw Error("act(...) is not supported in production builds of React.")}return He.Children={map:ne,forEach:function(k,U,se){ne(k,function(){U.apply(this,arguments)},se)},count:function(k){var U=0;return ne(k,function(){U++}),U},toArray:function(k){return ne(k,function(U){return U})||[]},only:function(k){if(!V(k))throw Error("React.Children.only expected to receive a single React element child.");return k}},He.Component=E,He.Fragment=i,He.Profiler=s,He.PureComponent=_,He.StrictMode=o,He.Suspense=u,He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q,He.act=Z,He.cloneElement=function(k,U,se){if(k==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+k+".");var ce=T({},k.props),Re=k.key,ae=k.ref,Se=k._owner;if(U!=null){if(U.ref!==void 0&&(ae=U.ref,Se=D.current),U.key!==void 0&&(Re=""+U.key),k.type&&k.type.defaultProps)var Te=k.type.defaultProps;for(ie in U)N.call(U,ie)&&!B.hasOwnProperty(ie)&&(ce[ie]=U[ie]===void 0&&Te!==void 0?Te[ie]:U[ie])}var ie=arguments.length-2;if(ie===1)ce.children=se;else if(1<ie){Te=Array(ie);for(var he=0;he<ie;he++)Te[he]=arguments[he+2];ce.children=Te}return{$$typeof:e,type:k.type,key:Re,ref:ae,props:ce,_owner:Se}},He.createContext=function(k){return k={$$typeof:c,_currentValue:k,_currentValue2:k,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},k.Provider={$$typeof:l,_context:k},k.Consumer=k},He.createElement=G,He.createFactory=function(k){var U=G.bind(null,k);return U.type=k,U},He.createRef=function(){return{current:null}},He.forwardRef=function(k){return{$$typeof:d,render:k}},He.isValidElement=V,He.lazy=function(k){return{$$typeof:g,_payload:{_status:-1,_result:k},_init:oe}},He.memo=function(k,U){return{$$typeof:h,type:k,compare:U===void 0?null:U}},He.startTransition=function(k){var U=W.transition;W.transition={};try{k()}finally{W.transition=U}},He.unstable_act=Z,He.useCallback=function(k,U){return te.current.useCallback(k,U)},He.useContext=function(k){return te.current.useContext(k)},He.useDebugValue=function(){},He.useDeferredValue=function(k){return te.current.useDeferredValue(k)},He.useEffect=function(k,U){return te.current.useEffect(k,U)},He.useId=function(){return te.current.useId()},He.useImperativeHandle=function(k,U,se){return te.current.useImperativeHandle(k,U,se)},He.useInsertionEffect=function(k,U){return te.current.useInsertionEffect(k,U)},He.useLayoutEffect=function(k,U){return te.current.useLayoutEffect(k,U)},He.useMemo=function(k,U){return te.current.useMemo(k,U)},He.useReducer=function(k,U,se){return te.current.useReducer(k,U,se)},He.useRef=function(k){return te.current.useRef(k)},He.useState=function(k){return te.current.useState(k)},He.useSyncExternalStore=function(k,U,se){return te.current.useSyncExternalStore(k,U,se)},He.useTransition=function(){return te.current.useTransition()},He.version="18.3.1",He}var zm;function ch(){return zm||(zm=1,sf.exports=mT()),sf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jm;function yT(){if(jm)return qs;jm=1;var e=ch(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(d,u,h){var g,y={},I=null,v=null;h!==void 0&&(I=""+h),u.key!==void 0&&(I=""+u.key),u.ref!==void 0&&(v=u.ref);for(g in u)o.call(u,g)&&!l.hasOwnProperty(g)&&(y[g]=u[g]);if(d&&d.defaultProps)for(g in u=d.defaultProps,u)y[g]===void 0&&(y[g]=u[g]);return{$$typeof:t,type:d,key:I,ref:v,props:y,_owner:s.current}}return qs.Fragment=i,qs.jsx=c,qs.jsxs=c,qs}var Xm;function vT(){return Xm||(Xm=1,rf.exports=yT()),rf.exports}var ke=vT(),Pe=ch();const ai=Fy(Pe);var tc={},af={exports:{}},an={},lf={exports:{}},cf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vm;function IT(){return Vm||(Vm=1,function(e){function t(W,Q){var Z=W.length;W.push(Q);e:for(;0<Z;){var k=Z-1>>>1,U=W[k];if(0<s(U,Q))W[k]=Q,W[Z]=U,Z=k;else break e}}function i(W){return W.length===0?null:W[0]}function o(W){if(W.length===0)return null;var Q=W[0],Z=W.pop();if(Z!==Q){W[0]=Z;e:for(var k=0,U=W.length,se=U>>>1;k<se;){var ce=2*(k+1)-1,Re=W[ce],ae=ce+1,Se=W[ae];if(0>s(Re,Z))ae<U&&0>s(Se,Re)?(W[k]=Se,W[ae]=Z,k=ae):(W[k]=Re,W[ce]=Z,k=ce);else if(ae<U&&0>s(Se,Z))W[k]=Se,W[ae]=Z,k=ae;else break e}}return Q}function s(W,Q){var Z=W.sortIndex-Q.sortIndex;return Z!==0?Z:W.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var c=Date,d=c.now();e.unstable_now=function(){return c.now()-d}}var u=[],h=[],g=1,y=null,I=3,v=!1,T=!1,A=!1,E=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(W){for(var Q=i(h);Q!==null;){if(Q.callback===null)o(h);else if(Q.startTime<=W)o(h),Q.sortIndex=Q.expirationTime,t(u,Q);else break;Q=i(h)}}function R(W){if(A=!1,w(W),!T)if(i(u)!==null)T=!0,oe(N);else{var Q=i(h);Q!==null&&te(R,Q.startTime-W)}}function N(W,Q){T=!1,A&&(A=!1,C(G),G=-1),v=!0;var Z=I;try{for(w(Q),y=i(u);y!==null&&(!(y.expirationTime>Q)||W&&!X());){var k=y.callback;if(typeof k=="function"){y.callback=null,I=y.priorityLevel;var U=k(y.expirationTime<=Q);Q=e.unstable_now(),typeof U=="function"?y.callback=U:y===i(u)&&o(u),w(Q)}else o(u);y=i(u)}if(y!==null)var se=!0;else{var ce=i(h);ce!==null&&te(R,ce.startTime-Q),se=!1}return se}finally{y=null,I=Z,v=!1}}var D=!1,B=null,G=-1,$=5,V=-1;function X(){return!(e.unstable_now()-V<$)}function q(){if(B!==null){var W=e.unstable_now();V=W;var Q=!0;try{Q=B(!0,W)}finally{Q?re():(D=!1,B=null)}}else D=!1}var re;if(typeof _=="function")re=function(){_(q)};else if(typeof MessageChannel<"u"){var ee=new MessageChannel,ne=ee.port2;ee.port1.onmessage=q,re=function(){ne.postMessage(null)}}else re=function(){E(q,0)};function oe(W){B=W,D||(D=!0,re())}function te(W,Q){G=E(function(){W(e.unstable_now())},Q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_continueExecution=function(){T||v||(T=!0,oe(N))},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return I},e.unstable_getFirstCallbackNode=function(){return i(u)},e.unstable_next=function(W){switch(I){case 1:case 2:case 3:var Q=3;break;default:Q=I}var Z=I;I=Q;try{return W()}finally{I=Z}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(W,Q){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var Z=I;I=W;try{return Q()}finally{I=Z}},e.unstable_scheduleCallback=function(W,Q,Z){var k=e.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?k+Z:k):Z=k,W){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=Z+U,W={id:g++,callback:Q,priorityLevel:W,startTime:Z,expirationTime:U,sortIndex:-1},Z>k?(W.sortIndex=Z,t(h,W),i(u)===null&&W===i(h)&&(A?(C(G),G=-1):A=!0,te(R,Z-k))):(W.sortIndex=U,t(u,W),T||v||(T=!0,oe(N))),W},e.unstable_shouldYield=X,e.unstable_wrapCallback=function(W){var Q=I;return function(){var Z=I;I=Q;try{return W.apply(this,arguments)}finally{I=Z}}}}(cf)),cf}var qm;function ST(){return qm||(qm=1,lf.exports=IT()),lf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zm;function AT(){if(Zm)return an;Zm=1;var e=ch(),t=ST();function i(n){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+n,a=1;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(n,r){c(n,r),c(n+"Capture",r)}function c(n,r){for(s[n]=r,n=0;n<r.length;n++)o.add(r[n])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},y={};function I(n){return u.call(y,n)?!0:u.call(g,n)?!1:h.test(n)?y[n]=!0:(g[n]=!0,!1)}function v(n,r,a,f){if(a!==null&&a.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return f?!1:a!==null?!a.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function T(n,r,a,f){if(r===null||typeof r>"u"||v(n,r,a,f))return!0;if(f)return!1;if(a!==null)switch(a.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function A(n,r,a,f,p,m,S){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=f,this.attributeNamespace=p,this.mustUseProperty=a,this.propertyName=n,this.type=r,this.sanitizeURL=m,this.removeEmptyString=S}var E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){E[n]=new A(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var r=n[0];E[r]=new A(r,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){E[n]=new A(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){E[n]=new A(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){E[n]=new A(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){E[n]=new A(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){E[n]=new A(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){E[n]=new A(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){E[n]=new A(n,5,!1,n.toLowerCase(),null,!1,!1)});var C=/[\-:]([a-z])/g;function _(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var r=n.replace(C,_);E[r]=new A(r,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var r=n.replace(C,_);E[r]=new A(r,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var r=n.replace(C,_);E[r]=new A(r,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){E[n]=new A(n,1,!1,n.toLowerCase(),null,!1,!1)}),E.xlinkHref=new A("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){E[n]=new A(n,1,!1,n.toLowerCase(),null,!0,!0)});function w(n,r,a,f){var p=E.hasOwnProperty(r)?E[r]:null;(p!==null?p.type!==0:f||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(T(r,a,p,f)&&(a=null),f||p===null?I(r)&&(a===null?n.removeAttribute(r):n.setAttribute(r,""+a)):p.mustUseProperty?n[p.propertyName]=a===null?p.type===3?!1:"":a:(r=p.attributeName,f=p.attributeNamespace,a===null?n.removeAttribute(r):(p=p.type,a=p===3||p===4&&a===!0?"":""+a,f?n.setAttributeNS(f,r,a):n.setAttribute(r,a))))}var R=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,N=Symbol.for("react.element"),D=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),G=Symbol.for("react.strict_mode"),$=Symbol.for("react.profiler"),V=Symbol.for("react.provider"),X=Symbol.for("react.context"),q=Symbol.for("react.forward_ref"),re=Symbol.for("react.suspense"),ee=Symbol.for("react.suspense_list"),ne=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),te=Symbol.for("react.offscreen"),W=Symbol.iterator;function Q(n){return n===null||typeof n!="object"?null:(n=W&&n[W]||n["@@iterator"],typeof n=="function"?n:null)}var Z=Object.assign,k;function U(n){if(k===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);k=r&&r[1]||""}return`
`+k+n}var se=!1;function ce(n,r){if(!n||se)return"";se=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(L){var f=L}Reflect.construct(n,[],r)}else{try{r.call()}catch(L){f=L}n.call(r.prototype)}else{try{throw Error()}catch(L){f=L}n()}}catch(L){if(L&&f&&typeof L.stack=="string"){for(var p=L.stack.split(`
`),m=f.stack.split(`
`),S=p.length-1,P=m.length-1;1<=S&&0<=P&&p[S]!==m[P];)P--;for(;1<=S&&0<=P;S--,P--)if(p[S]!==m[P]){if(S!==1||P!==1)do if(S--,P--,0>P||p[S]!==m[P]){var M=`
`+p[S].replace(" at new "," at ");return n.displayName&&M.includes("<anonymous>")&&(M=M.replace("<anonymous>",n.displayName)),M}while(1<=S&&0<=P);break}}}finally{se=!1,Error.prepareStackTrace=a}return(n=n?n.displayName||n.name:"")?U(n):""}function Re(n){switch(n.tag){case 5:return U(n.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return n=ce(n.type,!1),n;case 11:return n=ce(n.type.render,!1),n;case 1:return n=ce(n.type,!0),n;default:return""}}function ae(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case B:return"Fragment";case D:return"Portal";case $:return"Profiler";case G:return"StrictMode";case re:return"Suspense";case ee:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case X:return(n.displayName||"Context")+".Consumer";case V:return(n._context.displayName||"Context")+".Provider";case q:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case ne:return r=n.displayName||null,r!==null?r:ae(n.type)||"Memo";case oe:r=n._payload,n=n._init;try{return ae(n(r))}catch{}}return null}function Se(n){var r=n.type;switch(n.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=r.render,n=n.displayName||n.name||"",r.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ae(r);case 8:return r===G?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Te(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function ie(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function he(n){var r=ie(n)?"checked":"value",a=Object.getOwnPropertyDescriptor(n.constructor.prototype,r),f=""+n[r];if(!n.hasOwnProperty(r)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var p=a.get,m=a.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return p.call(this)},set:function(S){f=""+S,m.call(this,S)}}),Object.defineProperty(n,r,{enumerable:a.enumerable}),{getValue:function(){return f},setValue:function(S){f=""+S},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function Ne(n){n._valueTracker||(n._valueTracker=he(n))}function Ae(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var a=r.getValue(),f="";return n&&(f=ie(n)?n.checked?"true":"false":n.value),n=f,n!==a?(r.setValue(n),!0):!1}function Sn(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Ke(n,r){var a=r.checked;return Z({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??n._wrapperState.initialChecked})}function Ve(n,r){var a=r.defaultValue==null?"":r.defaultValue,f=r.checked!=null?r.checked:r.defaultChecked;a=Te(r.value!=null?r.value:a),n._wrapperState={initialChecked:f,initialValue:a,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function An(n,r){r=r.checked,r!=null&&w(n,"checked",r,!1)}function en(n,r){An(n,r);var a=Te(r.value),f=r.type;if(a!=null)f==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+a):n.value!==""+a&&(n.value=""+a);else if(f==="submit"||f==="reset"){n.removeAttribute("value");return}r.hasOwnProperty("value")?Zn(n,r.type,a):r.hasOwnProperty("defaultValue")&&Zn(n,r.type,Te(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(n.defaultChecked=!!r.defaultChecked)}function Tn(n,r,a){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var f=r.type;if(!(f!=="submit"&&f!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+n._wrapperState.initialValue,a||r===n.value||(n.value=r),n.defaultValue=r}a=n.name,a!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,a!==""&&(n.name=a)}function Zn(n,r,a){(r!=="number"||Sn(n.ownerDocument)!==n)&&(a==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+a&&(n.defaultValue=""+a))}var Kn=Array.isArray;function Fi(n,r,a,f){if(n=n.options,r){r={};for(var p=0;p<a.length;p++)r["$"+a[p]]=!0;for(a=0;a<n.length;a++)p=r.hasOwnProperty("$"+n[a].value),n[a].selected!==p&&(n[a].selected=p),p&&f&&(n[a].defaultSelected=!0)}else{for(a=""+Te(a),r=null,p=0;p<n.length;p++){if(n[p].value===a){n[p].selected=!0,f&&(n[p].defaultSelected=!0);return}r!==null||n[p].disabled||(r=n[p])}r!==null&&(r.selected=!0)}}function Eo(n,r){if(r.dangerouslySetInnerHTML!=null)throw Error(i(91));return Z({},r,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function ep(n,r){var a=r.value;if(a==null){if(a=r.children,r=r.defaultValue,a!=null){if(r!=null)throw Error(i(92));if(Kn(a)){if(1<a.length)throw Error(i(93));a=a[0]}r=a}r==null&&(r=""),a=r}n._wrapperState={initialValue:Te(a)}}function tp(n,r){var a=Te(r.value),f=Te(r.defaultValue);a!=null&&(a=""+a,a!==n.value&&(n.value=a),r.defaultValue==null&&n.defaultValue!==a&&(n.defaultValue=a)),f!=null&&(n.defaultValue=""+f)}function np(n){var r=n.textContent;r===n._wrapperState.initialValue&&r!==""&&r!==null&&(n.value=r)}function ip(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function gu(n,r){return n==null||n==="http://www.w3.org/1999/xhtml"?ip(r):n==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Xa,op=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,a,f,p){MSApp.execUnsafeLocalFunction(function(){return n(r,a,f,p)})}:n}(function(n,r){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=r;else{for(Xa=Xa||document.createElement("div"),Xa.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=Xa.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;r.firstChild;)n.appendChild(r.firstChild)}});function ds(n,r){if(r){var a=n.firstChild;if(a&&a===n.lastChild&&a.nodeType===3){a.nodeValue=r;return}}n.textContent=r}var fs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},vS=["Webkit","ms","Moz","O"];Object.keys(fs).forEach(function(n){vS.forEach(function(r){r=r+n.charAt(0).toUpperCase()+n.substring(1),fs[r]=fs[n]})});function rp(n,r,a){return r==null||typeof r=="boolean"||r===""?"":a||typeof r!="number"||r===0||fs.hasOwnProperty(n)&&fs[n]?(""+r).trim():r+"px"}function sp(n,r){n=n.style;for(var a in r)if(r.hasOwnProperty(a)){var f=a.indexOf("--")===0,p=rp(a,r[a],f);a==="float"&&(a="cssFloat"),f?n.setProperty(a,p):n[a]=p}}var IS=Z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function mu(n,r){if(r){if(IS[n]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(i(137,n));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(i(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(i(61))}if(r.style!=null&&typeof r.style!="object")throw Error(i(62))}}function yu(n,r){if(n.indexOf("-")===-1)return typeof r.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vu=null;function Iu(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Su=null,ur=null,dr=null;function ap(n){if(n=Ns(n)){if(typeof Su!="function")throw Error(i(280));var r=n.stateNode;r&&(r=ml(r),Su(n.stateNode,n.type,r))}}function lp(n){ur?dr?dr.push(n):dr=[n]:ur=n}function cp(){if(ur){var n=ur,r=dr;if(dr=ur=null,ap(n),r)for(n=0;n<r.length;n++)ap(r[n])}}function up(n,r){return n(r)}function dp(){}var Au=!1;function fp(n,r,a){if(Au)return n(r,a);Au=!0;try{return up(n,r,a)}finally{Au=!1,(ur!==null||dr!==null)&&(dp(),cp())}}function hs(n,r){var a=n.stateNode;if(a===null)return null;var f=ml(a);if(f===null)return null;a=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(n=n.type,f=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!f;break e;default:n=!1}if(n)return null;if(a&&typeof a!="function")throw Error(i(231,r,typeof a));return a}var Tu=!1;if(d)try{var ps={};Object.defineProperty(ps,"passive",{get:function(){Tu=!0}}),window.addEventListener("test",ps,ps),window.removeEventListener("test",ps,ps)}catch{Tu=!1}function SS(n,r,a,f,p,m,S,P,M){var L=Array.prototype.slice.call(arguments,3);try{r.apply(a,L)}catch(j){this.onError(j)}}var gs=!1,Va=null,qa=!1,Eu=null,AS={onError:function(n){gs=!0,Va=n}};function TS(n,r,a,f,p,m,S,P,M){gs=!1,Va=null,SS.apply(AS,arguments)}function ES(n,r,a,f,p,m,S,P,M){if(TS.apply(this,arguments),gs){if(gs){var L=Va;gs=!1,Va=null}else throw Error(i(198));qa||(qa=!0,Eu=L)}}function wo(n){var r=n,a=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,(r.flags&4098)!==0&&(a=r.return),n=r.return;while(n)}return r.tag===3?a:null}function hp(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function pp(n){if(wo(n)!==n)throw Error(i(188))}function wS(n){var r=n.alternate;if(!r){if(r=wo(n),r===null)throw Error(i(188));return r!==n?null:n}for(var a=n,f=r;;){var p=a.return;if(p===null)break;var m=p.alternate;if(m===null){if(f=p.return,f!==null){a=f;continue}break}if(p.child===m.child){for(m=p.child;m;){if(m===a)return pp(p),n;if(m===f)return pp(p),r;m=m.sibling}throw Error(i(188))}if(a.return!==f.return)a=p,f=m;else{for(var S=!1,P=p.child;P;){if(P===a){S=!0,a=p,f=m;break}if(P===f){S=!0,f=p,a=m;break}P=P.sibling}if(!S){for(P=m.child;P;){if(P===a){S=!0,a=m,f=p;break}if(P===f){S=!0,f=m,a=p;break}P=P.sibling}if(!S)throw Error(i(189))}}if(a.alternate!==f)throw Error(i(190))}if(a.tag!==3)throw Error(i(188));return a.stateNode.current===a?n:r}function gp(n){return n=wS(n),n!==null?mp(n):null}function mp(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var r=mp(n);if(r!==null)return r;n=n.sibling}return null}var yp=t.unstable_scheduleCallback,vp=t.unstable_cancelCallback,_S=t.unstable_shouldYield,CS=t.unstable_requestPaint,ct=t.unstable_now,PS=t.unstable_getCurrentPriorityLevel,wu=t.unstable_ImmediatePriority,Ip=t.unstable_UserBlockingPriority,Za=t.unstable_NormalPriority,RS=t.unstable_LowPriority,Sp=t.unstable_IdlePriority,Ka=null,Qn=null;function MS(n){if(Qn&&typeof Qn.onCommitFiberRoot=="function")try{Qn.onCommitFiberRoot(Ka,n,void 0,(n.current.flags&128)===128)}catch{}}var Hn=Math.clz32?Math.clz32:OS,kS=Math.log,DS=Math.LN2;function OS(n){return n>>>=0,n===0?32:31-(kS(n)/DS|0)|0}var Qa=64,Ja=4194304;function ms(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function el(n,r){var a=n.pendingLanes;if(a===0)return 0;var f=0,p=n.suspendedLanes,m=n.pingedLanes,S=a&268435455;if(S!==0){var P=S&~p;P!==0?f=ms(P):(m&=S,m!==0&&(f=ms(m)))}else S=a&~p,S!==0?f=ms(S):m!==0&&(f=ms(m));if(f===0)return 0;if(r!==0&&r!==f&&(r&p)===0&&(p=f&-f,m=r&-r,p>=m||p===16&&(m&4194240)!==0))return r;if((f&4)!==0&&(f|=a&16),r=n.entangledLanes,r!==0)for(n=n.entanglements,r&=f;0<r;)a=31-Hn(r),p=1<<a,f|=n[a],r&=~p;return f}function bS(n,r){switch(n){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function NS(n,r){for(var a=n.suspendedLanes,f=n.pingedLanes,p=n.expirationTimes,m=n.pendingLanes;0<m;){var S=31-Hn(m),P=1<<S,M=p[S];M===-1?((P&a)===0||(P&f)!==0)&&(p[S]=bS(P,r)):M<=r&&(n.expiredLanes|=P),m&=~P}}function _u(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Ap(){var n=Qa;return Qa<<=1,(Qa&4194240)===0&&(Qa=64),n}function Cu(n){for(var r=[],a=0;31>a;a++)r.push(n);return r}function ys(n,r,a){n.pendingLanes|=r,r!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,r=31-Hn(r),n[r]=a}function BS(n,r){var a=n.pendingLanes&~r;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=r,n.mutableReadLanes&=r,n.entangledLanes&=r,r=n.entanglements;var f=n.eventTimes;for(n=n.expirationTimes;0<a;){var p=31-Hn(a),m=1<<p;r[p]=0,f[p]=-1,n[p]=-1,a&=~m}}function Pu(n,r){var a=n.entangledLanes|=r;for(n=n.entanglements;a;){var f=31-Hn(a),p=1<<f;p&r|n[f]&r&&(n[f]|=r),a&=~p}}var We=0;function Tp(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var Ep,Ru,wp,_p,Cp,Mu=!1,tl=[],Li=null,Ui=null,Gi=null,vs=new Map,Is=new Map,xi=[],HS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pp(n,r){switch(n){case"focusin":case"focusout":Li=null;break;case"dragenter":case"dragleave":Ui=null;break;case"mouseover":case"mouseout":Gi=null;break;case"pointerover":case"pointerout":vs.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Is.delete(r.pointerId)}}function Ss(n,r,a,f,p,m){return n===null||n.nativeEvent!==m?(n={blockedOn:r,domEventName:a,eventSystemFlags:f,nativeEvent:m,targetContainers:[p]},r!==null&&(r=Ns(r),r!==null&&Ru(r)),n):(n.eventSystemFlags|=f,r=n.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),n)}function FS(n,r,a,f,p){switch(r){case"focusin":return Li=Ss(Li,n,r,a,f,p),!0;case"dragenter":return Ui=Ss(Ui,n,r,a,f,p),!0;case"mouseover":return Gi=Ss(Gi,n,r,a,f,p),!0;case"pointerover":var m=p.pointerId;return vs.set(m,Ss(vs.get(m)||null,n,r,a,f,p)),!0;case"gotpointercapture":return m=p.pointerId,Is.set(m,Ss(Is.get(m)||null,n,r,a,f,p)),!0}return!1}function Rp(n){var r=_o(n.target);if(r!==null){var a=wo(r);if(a!==null){if(r=a.tag,r===13){if(r=hp(a),r!==null){n.blockedOn=r,Cp(n.priority,function(){wp(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){n.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}n.blockedOn=null}function nl(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var a=Du(n.domEventName,n.eventSystemFlags,r[0],n.nativeEvent);if(a===null){a=n.nativeEvent;var f=new a.constructor(a.type,a);vu=f,a.target.dispatchEvent(f),vu=null}else return r=Ns(a),r!==null&&Ru(r),n.blockedOn=a,!1;r.shift()}return!0}function Mp(n,r,a){nl(n)&&a.delete(r)}function LS(){Mu=!1,Li!==null&&nl(Li)&&(Li=null),Ui!==null&&nl(Ui)&&(Ui=null),Gi!==null&&nl(Gi)&&(Gi=null),vs.forEach(Mp),Is.forEach(Mp)}function As(n,r){n.blockedOn===r&&(n.blockedOn=null,Mu||(Mu=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,LS)))}function Ts(n){function r(p){return As(p,n)}if(0<tl.length){As(tl[0],n);for(var a=1;a<tl.length;a++){var f=tl[a];f.blockedOn===n&&(f.blockedOn=null)}}for(Li!==null&&As(Li,n),Ui!==null&&As(Ui,n),Gi!==null&&As(Gi,n),vs.forEach(r),Is.forEach(r),a=0;a<xi.length;a++)f=xi[a],f.blockedOn===n&&(f.blockedOn=null);for(;0<xi.length&&(a=xi[0],a.blockedOn===null);)Rp(a),a.blockedOn===null&&xi.shift()}var fr=R.ReactCurrentBatchConfig,il=!0;function US(n,r,a,f){var p=We,m=fr.transition;fr.transition=null;try{We=1,ku(n,r,a,f)}finally{We=p,fr.transition=m}}function GS(n,r,a,f){var p=We,m=fr.transition;fr.transition=null;try{We=4,ku(n,r,a,f)}finally{We=p,fr.transition=m}}function ku(n,r,a,f){if(il){var p=Du(n,r,a,f);if(p===null)Vu(n,r,f,ol,a),Pp(n,f);else if(FS(p,n,r,a,f))f.stopPropagation();else if(Pp(n,f),r&4&&-1<HS.indexOf(n)){for(;p!==null;){var m=Ns(p);if(m!==null&&Ep(m),m=Du(n,r,a,f),m===null&&Vu(n,r,f,ol,a),m===p)break;p=m}p!==null&&f.stopPropagation()}else Vu(n,r,f,null,a)}}var ol=null;function Du(n,r,a,f){if(ol=null,n=Iu(f),n=_o(n),n!==null)if(r=wo(n),r===null)n=null;else if(a=r.tag,a===13){if(n=hp(r),n!==null)return n;n=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null);return ol=n,null}function kp(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(PS()){case wu:return 1;case Ip:return 4;case Za:case RS:return 16;case Sp:return 536870912;default:return 16}default:return 16}}var $i=null,Ou=null,rl=null;function Dp(){if(rl)return rl;var n,r=Ou,a=r.length,f,p="value"in $i?$i.value:$i.textContent,m=p.length;for(n=0;n<a&&r[n]===p[n];n++);var S=a-n;for(f=1;f<=S&&r[a-f]===p[m-f];f++);return rl=p.slice(n,1<f?1-f:void 0)}function sl(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function al(){return!0}function Op(){return!1}function dn(n){function r(a,f,p,m,S){this._reactName=a,this._targetInst=p,this.type=f,this.nativeEvent=m,this.target=S,this.currentTarget=null;for(var P in n)n.hasOwnProperty(P)&&(a=n[P],this[P]=a?a(m):m[P]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?al:Op,this.isPropagationStopped=Op,this}return Z(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=al)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=al)},persist:function(){},isPersistent:al}),r}var hr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},bu=dn(hr),Es=Z({},hr,{view:0,detail:0}),xS=dn(Es),Nu,Bu,ws,ll=Z({},Es,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Fu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==ws&&(ws&&n.type==="mousemove"?(Nu=n.screenX-ws.screenX,Bu=n.screenY-ws.screenY):Bu=Nu=0,ws=n),Nu)},movementY:function(n){return"movementY"in n?n.movementY:Bu}}),bp=dn(ll),$S=Z({},ll,{dataTransfer:0}),WS=dn($S),YS=Z({},Es,{relatedTarget:0}),Hu=dn(YS),zS=Z({},hr,{animationName:0,elapsedTime:0,pseudoElement:0}),jS=dn(zS),XS=Z({},hr,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),VS=dn(XS),qS=Z({},hr,{data:0}),Np=dn(qS),ZS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},KS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},QS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function JS(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=QS[n])?!!r[n]:!1}function Fu(){return JS}var eA=Z({},Es,{key:function(n){if(n.key){var r=ZS[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=sl(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?KS[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Fu,charCode:function(n){return n.type==="keypress"?sl(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?sl(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),tA=dn(eA),nA=Z({},ll,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Bp=dn(nA),iA=Z({},Es,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Fu}),oA=dn(iA),rA=Z({},hr,{propertyName:0,elapsedTime:0,pseudoElement:0}),sA=dn(rA),aA=Z({},ll,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),lA=dn(aA),cA=[9,13,27,32],Lu=d&&"CompositionEvent"in window,_s=null;d&&"documentMode"in document&&(_s=document.documentMode);var uA=d&&"TextEvent"in window&&!_s,Hp=d&&(!Lu||_s&&8<_s&&11>=_s),Fp=" ",Lp=!1;function Up(n,r){switch(n){case"keyup":return cA.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gp(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var pr=!1;function dA(n,r){switch(n){case"compositionend":return Gp(r);case"keypress":return r.which!==32?null:(Lp=!0,Fp);case"textInput":return n=r.data,n===Fp&&Lp?null:n;default:return null}}function fA(n,r){if(pr)return n==="compositionend"||!Lu&&Up(n,r)?(n=Dp(),rl=Ou=$i=null,pr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Hp&&r.locale!=="ko"?null:r.data;default:return null}}var hA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function xp(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!hA[n.type]:r==="textarea"}function $p(n,r,a,f){lp(f),r=hl(r,"onChange"),0<r.length&&(a=new bu("onChange","change",null,a,f),n.push({event:a,listeners:r}))}var Cs=null,Ps=null;function pA(n){sg(n,0)}function cl(n){var r=Ir(n);if(Ae(r))return n}function gA(n,r){if(n==="change")return r}var Wp=!1;if(d){var Uu;if(d){var Gu="oninput"in document;if(!Gu){var Yp=document.createElement("div");Yp.setAttribute("oninput","return;"),Gu=typeof Yp.oninput=="function"}Uu=Gu}else Uu=!1;Wp=Uu&&(!document.documentMode||9<document.documentMode)}function zp(){Cs&&(Cs.detachEvent("onpropertychange",jp),Ps=Cs=null)}function jp(n){if(n.propertyName==="value"&&cl(Ps)){var r=[];$p(r,Ps,n,Iu(n)),fp(pA,r)}}function mA(n,r,a){n==="focusin"?(zp(),Cs=r,Ps=a,Cs.attachEvent("onpropertychange",jp)):n==="focusout"&&zp()}function yA(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return cl(Ps)}function vA(n,r){if(n==="click")return cl(r)}function IA(n,r){if(n==="input"||n==="change")return cl(r)}function SA(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var Fn=typeof Object.is=="function"?Object.is:SA;function Rs(n,r){if(Fn(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var a=Object.keys(n),f=Object.keys(r);if(a.length!==f.length)return!1;for(f=0;f<a.length;f++){var p=a[f];if(!u.call(r,p)||!Fn(n[p],r[p]))return!1}return!0}function Xp(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Vp(n,r){var a=Xp(n);n=0;for(var f;a;){if(a.nodeType===3){if(f=n+a.textContent.length,n<=r&&f>=r)return{node:a,offset:r-n};n=f}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=Xp(a)}}function qp(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?qp(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function Zp(){for(var n=window,r=Sn();r instanceof n.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)n=r.contentWindow;else break;r=Sn(n.document)}return r}function xu(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}function AA(n){var r=Zp(),a=n.focusedElem,f=n.selectionRange;if(r!==a&&a&&a.ownerDocument&&qp(a.ownerDocument.documentElement,a)){if(f!==null&&xu(a)){if(r=f.start,n=f.end,n===void 0&&(n=r),"selectionStart"in a)a.selectionStart=r,a.selectionEnd=Math.min(n,a.value.length);else if(n=(r=a.ownerDocument||document)&&r.defaultView||window,n.getSelection){n=n.getSelection();var p=a.textContent.length,m=Math.min(f.start,p);f=f.end===void 0?m:Math.min(f.end,p),!n.extend&&m>f&&(p=f,f=m,m=p),p=Vp(a,m);var S=Vp(a,f);p&&S&&(n.rangeCount!==1||n.anchorNode!==p.node||n.anchorOffset!==p.offset||n.focusNode!==S.node||n.focusOffset!==S.offset)&&(r=r.createRange(),r.setStart(p.node,p.offset),n.removeAllRanges(),m>f?(n.addRange(r),n.extend(S.node,S.offset)):(r.setEnd(S.node,S.offset),n.addRange(r)))}}for(r=[],n=a;n=n.parentNode;)n.nodeType===1&&r.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<r.length;a++)n=r[a],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var TA=d&&"documentMode"in document&&11>=document.documentMode,gr=null,$u=null,Ms=null,Wu=!1;function Kp(n,r,a){var f=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;Wu||gr==null||gr!==Sn(f)||(f=gr,"selectionStart"in f&&xu(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Ms&&Rs(Ms,f)||(Ms=f,f=hl($u,"onSelect"),0<f.length&&(r=new bu("onSelect","select",null,r,a),n.push({event:r,listeners:f}),r.target=gr)))}function ul(n,r){var a={};return a[n.toLowerCase()]=r.toLowerCase(),a["Webkit"+n]="webkit"+r,a["Moz"+n]="moz"+r,a}var mr={animationend:ul("Animation","AnimationEnd"),animationiteration:ul("Animation","AnimationIteration"),animationstart:ul("Animation","AnimationStart"),transitionend:ul("Transition","TransitionEnd")},Yu={},Qp={};d&&(Qp=document.createElement("div").style,"AnimationEvent"in window||(delete mr.animationend.animation,delete mr.animationiteration.animation,delete mr.animationstart.animation),"TransitionEvent"in window||delete mr.transitionend.transition);function dl(n){if(Yu[n])return Yu[n];if(!mr[n])return n;var r=mr[n],a;for(a in r)if(r.hasOwnProperty(a)&&a in Qp)return Yu[n]=r[a];return n}var Jp=dl("animationend"),eg=dl("animationiteration"),tg=dl("animationstart"),ng=dl("transitionend"),ig=new Map,og="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Wi(n,r){ig.set(n,r),l(r,[n])}for(var zu=0;zu<og.length;zu++){var ju=og[zu],EA=ju.toLowerCase(),wA=ju[0].toUpperCase()+ju.slice(1);Wi(EA,"on"+wA)}Wi(Jp,"onAnimationEnd"),Wi(eg,"onAnimationIteration"),Wi(tg,"onAnimationStart"),Wi("dblclick","onDoubleClick"),Wi("focusin","onFocus"),Wi("focusout","onBlur"),Wi(ng,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ks="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_A=new Set("cancel close invalid load scroll toggle".split(" ").concat(ks));function rg(n,r,a){var f=n.type||"unknown-event";n.currentTarget=a,ES(f,r,void 0,n),n.currentTarget=null}function sg(n,r){r=(r&4)!==0;for(var a=0;a<n.length;a++){var f=n[a],p=f.event;f=f.listeners;e:{var m=void 0;if(r)for(var S=f.length-1;0<=S;S--){var P=f[S],M=P.instance,L=P.currentTarget;if(P=P.listener,M!==m&&p.isPropagationStopped())break e;rg(p,P,L),m=M}else for(S=0;S<f.length;S++){if(P=f[S],M=P.instance,L=P.currentTarget,P=P.listener,M!==m&&p.isPropagationStopped())break e;rg(p,P,L),m=M}}}if(qa)throw n=Eu,qa=!1,Eu=null,n}function Je(n,r){var a=r[ed];a===void 0&&(a=r[ed]=new Set);var f=n+"__bubble";a.has(f)||(ag(r,n,2,!1),a.add(f))}function Xu(n,r,a){var f=0;r&&(f|=4),ag(a,n,f,r)}var fl="_reactListening"+Math.random().toString(36).slice(2);function Ds(n){if(!n[fl]){n[fl]=!0,o.forEach(function(a){a!=="selectionchange"&&(_A.has(a)||Xu(a,!1,n),Xu(a,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[fl]||(r[fl]=!0,Xu("selectionchange",!1,r))}}function ag(n,r,a,f){switch(kp(r)){case 1:var p=US;break;case 4:p=GS;break;default:p=ku}a=p.bind(null,r,a,n),p=void 0,!Tu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),f?p!==void 0?n.addEventListener(r,a,{capture:!0,passive:p}):n.addEventListener(r,a,!0):p!==void 0?n.addEventListener(r,a,{passive:p}):n.addEventListener(r,a,!1)}function Vu(n,r,a,f,p){var m=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var S=f.tag;if(S===3||S===4){var P=f.stateNode.containerInfo;if(P===p||P.nodeType===8&&P.parentNode===p)break;if(S===4)for(S=f.return;S!==null;){var M=S.tag;if((M===3||M===4)&&(M=S.stateNode.containerInfo,M===p||M.nodeType===8&&M.parentNode===p))return;S=S.return}for(;P!==null;){if(S=_o(P),S===null)return;if(M=S.tag,M===5||M===6){f=m=S;continue e}P=P.parentNode}}f=f.return}fp(function(){var L=m,j=Iu(a),K=[];e:{var Y=ig.get(n);if(Y!==void 0){var le=bu,pe=n;switch(n){case"keypress":if(sl(a)===0)break e;case"keydown":case"keyup":le=tA;break;case"focusin":pe="focus",le=Hu;break;case"focusout":pe="blur",le=Hu;break;case"beforeblur":case"afterblur":le=Hu;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":le=bp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":le=WS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":le=oA;break;case Jp:case eg:case tg:le=jS;break;case ng:le=sA;break;case"scroll":le=xS;break;case"wheel":le=lA;break;case"copy":case"cut":case"paste":le=VS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":le=Bp}var ge=(r&4)!==0,ut=!ge&&n==="scroll",H=ge?Y!==null?Y+"Capture":null:Y;ge=[];for(var b=L,F;b!==null;){F=b;var J=F.stateNode;if(F.tag===5&&J!==null&&(F=J,H!==null&&(J=hs(b,H),J!=null&&ge.push(Os(b,J,F)))),ut)break;b=b.return}0<ge.length&&(Y=new le(Y,pe,null,a,j),K.push({event:Y,listeners:ge}))}}if((r&7)===0){e:{if(Y=n==="mouseover"||n==="pointerover",le=n==="mouseout"||n==="pointerout",Y&&a!==vu&&(pe=a.relatedTarget||a.fromElement)&&(_o(pe)||pe[di]))break e;if((le||Y)&&(Y=j.window===j?j:(Y=j.ownerDocument)?Y.defaultView||Y.parentWindow:window,le?(pe=a.relatedTarget||a.toElement,le=L,pe=pe?_o(pe):null,pe!==null&&(ut=wo(pe),pe!==ut||pe.tag!==5&&pe.tag!==6)&&(pe=null)):(le=null,pe=L),le!==pe)){if(ge=bp,J="onMouseLeave",H="onMouseEnter",b="mouse",(n==="pointerout"||n==="pointerover")&&(ge=Bp,J="onPointerLeave",H="onPointerEnter",b="pointer"),ut=le==null?Y:Ir(le),F=pe==null?Y:Ir(pe),Y=new ge(J,b+"leave",le,a,j),Y.target=ut,Y.relatedTarget=F,J=null,_o(j)===L&&(ge=new ge(H,b+"enter",pe,a,j),ge.target=F,ge.relatedTarget=ut,J=ge),ut=J,le&&pe)t:{for(ge=le,H=pe,b=0,F=ge;F;F=yr(F))b++;for(F=0,J=H;J;J=yr(J))F++;for(;0<b-F;)ge=yr(ge),b--;for(;0<F-b;)H=yr(H),F--;for(;b--;){if(ge===H||H!==null&&ge===H.alternate)break t;ge=yr(ge),H=yr(H)}ge=null}else ge=null;le!==null&&lg(K,Y,le,ge,!1),pe!==null&&ut!==null&&lg(K,ut,pe,ge,!0)}}e:{if(Y=L?Ir(L):window,le=Y.nodeName&&Y.nodeName.toLowerCase(),le==="select"||le==="input"&&Y.type==="file")var ve=gA;else if(xp(Y))if(Wp)ve=IA;else{ve=yA;var _e=mA}else(le=Y.nodeName)&&le.toLowerCase()==="input"&&(Y.type==="checkbox"||Y.type==="radio")&&(ve=vA);if(ve&&(ve=ve(n,L))){$p(K,ve,a,j);break e}_e&&_e(n,Y,L),n==="focusout"&&(_e=Y._wrapperState)&&_e.controlled&&Y.type==="number"&&Zn(Y,"number",Y.value)}switch(_e=L?Ir(L):window,n){case"focusin":(xp(_e)||_e.contentEditable==="true")&&(gr=_e,$u=L,Ms=null);break;case"focusout":Ms=$u=gr=null;break;case"mousedown":Wu=!0;break;case"contextmenu":case"mouseup":case"dragend":Wu=!1,Kp(K,a,j);break;case"selectionchange":if(TA)break;case"keydown":case"keyup":Kp(K,a,j)}var Ce;if(Lu)e:{switch(n){case"compositionstart":var De="onCompositionStart";break e;case"compositionend":De="onCompositionEnd";break e;case"compositionupdate":De="onCompositionUpdate";break e}De=void 0}else pr?Up(n,a)&&(De="onCompositionEnd"):n==="keydown"&&a.keyCode===229&&(De="onCompositionStart");De&&(Hp&&a.locale!=="ko"&&(pr||De!=="onCompositionStart"?De==="onCompositionEnd"&&pr&&(Ce=Dp()):($i=j,Ou="value"in $i?$i.value:$i.textContent,pr=!0)),_e=hl(L,De),0<_e.length&&(De=new Np(De,n,null,a,j),K.push({event:De,listeners:_e}),Ce?De.data=Ce:(Ce=Gp(a),Ce!==null&&(De.data=Ce)))),(Ce=uA?dA(n,a):fA(n,a))&&(L=hl(L,"onBeforeInput"),0<L.length&&(j=new Np("onBeforeInput","beforeinput",null,a,j),K.push({event:j,listeners:L}),j.data=Ce))}sg(K,r)})}function Os(n,r,a){return{instance:n,listener:r,currentTarget:a}}function hl(n,r){for(var a=r+"Capture",f=[];n!==null;){var p=n,m=p.stateNode;p.tag===5&&m!==null&&(p=m,m=hs(n,a),m!=null&&f.unshift(Os(n,m,p)),m=hs(n,r),m!=null&&f.push(Os(n,m,p))),n=n.return}return f}function yr(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function lg(n,r,a,f,p){for(var m=r._reactName,S=[];a!==null&&a!==f;){var P=a,M=P.alternate,L=P.stateNode;if(M!==null&&M===f)break;P.tag===5&&L!==null&&(P=L,p?(M=hs(a,m),M!=null&&S.unshift(Os(a,M,P))):p||(M=hs(a,m),M!=null&&S.push(Os(a,M,P)))),a=a.return}S.length!==0&&n.push({event:r,listeners:S})}var CA=/\r\n?/g,PA=/\u0000|\uFFFD/g;function cg(n){return(typeof n=="string"?n:""+n).replace(CA,`
`).replace(PA,"")}function pl(n,r,a){if(r=cg(r),cg(n)!==r&&a)throw Error(i(425))}function gl(){}var qu=null,Zu=null;function Ku(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Qu=typeof setTimeout=="function"?setTimeout:void 0,RA=typeof clearTimeout=="function"?clearTimeout:void 0,ug=typeof Promise=="function"?Promise:void 0,MA=typeof queueMicrotask=="function"?queueMicrotask:typeof ug<"u"?function(n){return ug.resolve(null).then(n).catch(kA)}:Qu;function kA(n){setTimeout(function(){throw n})}function Ju(n,r){var a=r,f=0;do{var p=a.nextSibling;if(n.removeChild(a),p&&p.nodeType===8)if(a=p.data,a==="/$"){if(f===0){n.removeChild(p),Ts(r);return}f--}else a!=="$"&&a!=="$?"&&a!=="$!"||f++;a=p}while(a);Ts(r)}function Yi(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return n}function dg(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var a=n.data;if(a==="$"||a==="$!"||a==="$?"){if(r===0)return n;r--}else a==="/$"&&r++}n=n.previousSibling}return null}var vr=Math.random().toString(36).slice(2),Jn="__reactFiber$"+vr,bs="__reactProps$"+vr,di="__reactContainer$"+vr,ed="__reactEvents$"+vr,DA="__reactListeners$"+vr,OA="__reactHandles$"+vr;function _o(n){var r=n[Jn];if(r)return r;for(var a=n.parentNode;a;){if(r=a[di]||a[Jn]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(n=dg(n);n!==null;){if(a=n[Jn])return a;n=dg(n)}return r}n=a,a=n.parentNode}return null}function Ns(n){return n=n[Jn]||n[di],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ir(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(i(33))}function ml(n){return n[bs]||null}var td=[],Sr=-1;function zi(n){return{current:n}}function et(n){0>Sr||(n.current=td[Sr],td[Sr]=null,Sr--)}function Qe(n,r){Sr++,td[Sr]=n.current,n.current=r}var ji={},Ft=zi(ji),tn=zi(!1),Co=ji;function Ar(n,r){var a=n.type.contextTypes;if(!a)return ji;var f=n.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===r)return f.__reactInternalMemoizedMaskedChildContext;var p={},m;for(m in a)p[m]=r[m];return f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=p),p}function nn(n){return n=n.childContextTypes,n!=null}function yl(){et(tn),et(Ft)}function fg(n,r,a){if(Ft.current!==ji)throw Error(i(168));Qe(Ft,r),Qe(tn,a)}function hg(n,r,a){var f=n.stateNode;if(r=r.childContextTypes,typeof f.getChildContext!="function")return a;f=f.getChildContext();for(var p in f)if(!(p in r))throw Error(i(108,Se(n)||"Unknown",p));return Z({},a,f)}function vl(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||ji,Co=Ft.current,Qe(Ft,n),Qe(tn,tn.current),!0}function pg(n,r,a){var f=n.stateNode;if(!f)throw Error(i(169));a?(n=hg(n,r,Co),f.__reactInternalMemoizedMergedChildContext=n,et(tn),et(Ft),Qe(Ft,n)):et(tn),Qe(tn,a)}var fi=null,Il=!1,nd=!1;function gg(n){fi===null?fi=[n]:fi.push(n)}function bA(n){Il=!0,gg(n)}function Xi(){if(!nd&&fi!==null){nd=!0;var n=0,r=We;try{var a=fi;for(We=1;n<a.length;n++){var f=a[n];do f=f(!0);while(f!==null)}fi=null,Il=!1}catch(p){throw fi!==null&&(fi=fi.slice(n+1)),yp(wu,Xi),p}finally{We=r,nd=!1}}return null}var Tr=[],Er=0,Sl=null,Al=0,En=[],wn=0,Po=null,hi=1,pi="";function Ro(n,r){Tr[Er++]=Al,Tr[Er++]=Sl,Sl=n,Al=r}function mg(n,r,a){En[wn++]=hi,En[wn++]=pi,En[wn++]=Po,Po=n;var f=hi;n=pi;var p=32-Hn(f)-1;f&=~(1<<p),a+=1;var m=32-Hn(r)+p;if(30<m){var S=p-p%5;m=(f&(1<<S)-1).toString(32),f>>=S,p-=S,hi=1<<32-Hn(r)+p|a<<p|f,pi=m+n}else hi=1<<m|a<<p|f,pi=n}function id(n){n.return!==null&&(Ro(n,1),mg(n,1,0))}function od(n){for(;n===Sl;)Sl=Tr[--Er],Tr[Er]=null,Al=Tr[--Er],Tr[Er]=null;for(;n===Po;)Po=En[--wn],En[wn]=null,pi=En[--wn],En[wn]=null,hi=En[--wn],En[wn]=null}var fn=null,hn=null,it=!1,Ln=null;function yg(n,r){var a=Rn(5,null,null,0);a.elementType="DELETED",a.stateNode=r,a.return=n,r=n.deletions,r===null?(n.deletions=[a],n.flags|=16):r.push(a)}function vg(n,r){switch(n.tag){case 5:var a=n.type;return r=r.nodeType!==1||a.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(n.stateNode=r,fn=n,hn=Yi(r.firstChild),!0):!1;case 6:return r=n.pendingProps===""||r.nodeType!==3?null:r,r!==null?(n.stateNode=r,fn=n,hn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(a=Po!==null?{id:hi,overflow:pi}:null,n.memoizedState={dehydrated:r,treeContext:a,retryLane:1073741824},a=Rn(18,null,null,0),a.stateNode=r,a.return=n,n.child=a,fn=n,hn=null,!0):!1;default:return!1}}function rd(n){return(n.mode&1)!==0&&(n.flags&128)===0}function sd(n){if(it){var r=hn;if(r){var a=r;if(!vg(n,r)){if(rd(n))throw Error(i(418));r=Yi(a.nextSibling);var f=fn;r&&vg(n,r)?yg(f,a):(n.flags=n.flags&-4097|2,it=!1,fn=n)}}else{if(rd(n))throw Error(i(418));n.flags=n.flags&-4097|2,it=!1,fn=n}}}function Ig(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;fn=n}function Tl(n){if(n!==fn)return!1;if(!it)return Ig(n),it=!0,!1;var r;if((r=n.tag!==3)&&!(r=n.tag!==5)&&(r=n.type,r=r!=="head"&&r!=="body"&&!Ku(n.type,n.memoizedProps)),r&&(r=hn)){if(rd(n))throw Sg(),Error(i(418));for(;r;)yg(n,r),r=Yi(r.nextSibling)}if(Ig(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));e:{for(n=n.nextSibling,r=0;n;){if(n.nodeType===8){var a=n.data;if(a==="/$"){if(r===0){hn=Yi(n.nextSibling);break e}r--}else a!=="$"&&a!=="$!"&&a!=="$?"||r++}n=n.nextSibling}hn=null}}else hn=fn?Yi(n.stateNode.nextSibling):null;return!0}function Sg(){for(var n=hn;n;)n=Yi(n.nextSibling)}function wr(){hn=fn=null,it=!1}function ad(n){Ln===null?Ln=[n]:Ln.push(n)}var NA=R.ReactCurrentBatchConfig;function Bs(n,r,a){if(n=a.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(i(309));var f=a.stateNode}if(!f)throw Error(i(147,n));var p=f,m=""+n;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===m?r.ref:(r=function(S){var P=p.refs;S===null?delete P[m]:P[m]=S},r._stringRef=m,r)}if(typeof n!="string")throw Error(i(284));if(!a._owner)throw Error(i(290,n))}return n}function El(n,r){throw n=Object.prototype.toString.call(r),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n))}function Ag(n){var r=n._init;return r(n._payload)}function Tg(n){function r(H,b){if(n){var F=H.deletions;F===null?(H.deletions=[b],H.flags|=16):F.push(b)}}function a(H,b){if(!n)return null;for(;b!==null;)r(H,b),b=b.sibling;return null}function f(H,b){for(H=new Map;b!==null;)b.key!==null?H.set(b.key,b):H.set(b.index,b),b=b.sibling;return H}function p(H,b){return H=to(H,b),H.index=0,H.sibling=null,H}function m(H,b,F){return H.index=F,n?(F=H.alternate,F!==null?(F=F.index,F<b?(H.flags|=2,b):F):(H.flags|=2,b)):(H.flags|=1048576,b)}function S(H){return n&&H.alternate===null&&(H.flags|=2),H}function P(H,b,F,J){return b===null||b.tag!==6?(b=Qd(F,H.mode,J),b.return=H,b):(b=p(b,F),b.return=H,b)}function M(H,b,F,J){var ve=F.type;return ve===B?j(H,b,F.props.children,J,F.key):b!==null&&(b.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===oe&&Ag(ve)===b.type)?(J=p(b,F.props),J.ref=Bs(H,b,F),J.return=H,J):(J=Xl(F.type,F.key,F.props,null,H.mode,J),J.ref=Bs(H,b,F),J.return=H,J)}function L(H,b,F,J){return b===null||b.tag!==4||b.stateNode.containerInfo!==F.containerInfo||b.stateNode.implementation!==F.implementation?(b=Jd(F,H.mode,J),b.return=H,b):(b=p(b,F.children||[]),b.return=H,b)}function j(H,b,F,J,ve){return b===null||b.tag!==7?(b=Ho(F,H.mode,J,ve),b.return=H,b):(b=p(b,F),b.return=H,b)}function K(H,b,F){if(typeof b=="string"&&b!==""||typeof b=="number")return b=Qd(""+b,H.mode,F),b.return=H,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case N:return F=Xl(b.type,b.key,b.props,null,H.mode,F),F.ref=Bs(H,null,b),F.return=H,F;case D:return b=Jd(b,H.mode,F),b.return=H,b;case oe:var J=b._init;return K(H,J(b._payload),F)}if(Kn(b)||Q(b))return b=Ho(b,H.mode,F,null),b.return=H,b;El(H,b)}return null}function Y(H,b,F,J){var ve=b!==null?b.key:null;if(typeof F=="string"&&F!==""||typeof F=="number")return ve!==null?null:P(H,b,""+F,J);if(typeof F=="object"&&F!==null){switch(F.$$typeof){case N:return F.key===ve?M(H,b,F,J):null;case D:return F.key===ve?L(H,b,F,J):null;case oe:return ve=F._init,Y(H,b,ve(F._payload),J)}if(Kn(F)||Q(F))return ve!==null?null:j(H,b,F,J,null);El(H,F)}return null}function le(H,b,F,J,ve){if(typeof J=="string"&&J!==""||typeof J=="number")return H=H.get(F)||null,P(b,H,""+J,ve);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case N:return H=H.get(J.key===null?F:J.key)||null,M(b,H,J,ve);case D:return H=H.get(J.key===null?F:J.key)||null,L(b,H,J,ve);case oe:var _e=J._init;return le(H,b,F,_e(J._payload),ve)}if(Kn(J)||Q(J))return H=H.get(F)||null,j(b,H,J,ve,null);El(b,J)}return null}function pe(H,b,F,J){for(var ve=null,_e=null,Ce=b,De=b=0,Ct=null;Ce!==null&&De<F.length;De++){Ce.index>De?(Ct=Ce,Ce=null):Ct=Ce.sibling;var Le=Y(H,Ce,F[De],J);if(Le===null){Ce===null&&(Ce=Ct);break}n&&Ce&&Le.alternate===null&&r(H,Ce),b=m(Le,b,De),_e===null?ve=Le:_e.sibling=Le,_e=Le,Ce=Ct}if(De===F.length)return a(H,Ce),it&&Ro(H,De),ve;if(Ce===null){for(;De<F.length;De++)Ce=K(H,F[De],J),Ce!==null&&(b=m(Ce,b,De),_e===null?ve=Ce:_e.sibling=Ce,_e=Ce);return it&&Ro(H,De),ve}for(Ce=f(H,Ce);De<F.length;De++)Ct=le(Ce,H,De,F[De],J),Ct!==null&&(n&&Ct.alternate!==null&&Ce.delete(Ct.key===null?De:Ct.key),b=m(Ct,b,De),_e===null?ve=Ct:_e.sibling=Ct,_e=Ct);return n&&Ce.forEach(function(no){return r(H,no)}),it&&Ro(H,De),ve}function ge(H,b,F,J){var ve=Q(F);if(typeof ve!="function")throw Error(i(150));if(F=ve.call(F),F==null)throw Error(i(151));for(var _e=ve=null,Ce=b,De=b=0,Ct=null,Le=F.next();Ce!==null&&!Le.done;De++,Le=F.next()){Ce.index>De?(Ct=Ce,Ce=null):Ct=Ce.sibling;var no=Y(H,Ce,Le.value,J);if(no===null){Ce===null&&(Ce=Ct);break}n&&Ce&&no.alternate===null&&r(H,Ce),b=m(no,b,De),_e===null?ve=no:_e.sibling=no,_e=no,Ce=Ct}if(Le.done)return a(H,Ce),it&&Ro(H,De),ve;if(Ce===null){for(;!Le.done;De++,Le=F.next())Le=K(H,Le.value,J),Le!==null&&(b=m(Le,b,De),_e===null?ve=Le:_e.sibling=Le,_e=Le);return it&&Ro(H,De),ve}for(Ce=f(H,Ce);!Le.done;De++,Le=F.next())Le=le(Ce,H,De,Le.value,J),Le!==null&&(n&&Le.alternate!==null&&Ce.delete(Le.key===null?De:Le.key),b=m(Le,b,De),_e===null?ve=Le:_e.sibling=Le,_e=Le);return n&&Ce.forEach(function(hT){return r(H,hT)}),it&&Ro(H,De),ve}function ut(H,b,F,J){if(typeof F=="object"&&F!==null&&F.type===B&&F.key===null&&(F=F.props.children),typeof F=="object"&&F!==null){switch(F.$$typeof){case N:e:{for(var ve=F.key,_e=b;_e!==null;){if(_e.key===ve){if(ve=F.type,ve===B){if(_e.tag===7){a(H,_e.sibling),b=p(_e,F.props.children),b.return=H,H=b;break e}}else if(_e.elementType===ve||typeof ve=="object"&&ve!==null&&ve.$$typeof===oe&&Ag(ve)===_e.type){a(H,_e.sibling),b=p(_e,F.props),b.ref=Bs(H,_e,F),b.return=H,H=b;break e}a(H,_e);break}else r(H,_e);_e=_e.sibling}F.type===B?(b=Ho(F.props.children,H.mode,J,F.key),b.return=H,H=b):(J=Xl(F.type,F.key,F.props,null,H.mode,J),J.ref=Bs(H,b,F),J.return=H,H=J)}return S(H);case D:e:{for(_e=F.key;b!==null;){if(b.key===_e)if(b.tag===4&&b.stateNode.containerInfo===F.containerInfo&&b.stateNode.implementation===F.implementation){a(H,b.sibling),b=p(b,F.children||[]),b.return=H,H=b;break e}else{a(H,b);break}else r(H,b);b=b.sibling}b=Jd(F,H.mode,J),b.return=H,H=b}return S(H);case oe:return _e=F._init,ut(H,b,_e(F._payload),J)}if(Kn(F))return pe(H,b,F,J);if(Q(F))return ge(H,b,F,J);El(H,F)}return typeof F=="string"&&F!==""||typeof F=="number"?(F=""+F,b!==null&&b.tag===6?(a(H,b.sibling),b=p(b,F),b.return=H,H=b):(a(H,b),b=Qd(F,H.mode,J),b.return=H,H=b),S(H)):a(H,b)}return ut}var _r=Tg(!0),Eg=Tg(!1),wl=zi(null),_l=null,Cr=null,ld=null;function cd(){ld=Cr=_l=null}function ud(n){var r=wl.current;et(wl),n._currentValue=r}function dd(n,r,a){for(;n!==null;){var f=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),n===a)break;n=n.return}}function Pr(n,r){_l=n,ld=Cr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&r)!==0&&(on=!0),n.firstContext=null)}function _n(n){var r=n._currentValue;if(ld!==n)if(n={context:n,memoizedValue:r,next:null},Cr===null){if(_l===null)throw Error(i(308));Cr=n,_l.dependencies={lanes:0,firstContext:n}}else Cr=Cr.next=n;return r}var Mo=null;function fd(n){Mo===null?Mo=[n]:Mo.push(n)}function wg(n,r,a,f){var p=r.interleaved;return p===null?(a.next=a,fd(r)):(a.next=p.next,p.next=a),r.interleaved=a,gi(n,f)}function gi(n,r){n.lanes|=r;var a=n.alternate;for(a!==null&&(a.lanes|=r),a=n,n=n.return;n!==null;)n.childLanes|=r,a=n.alternate,a!==null&&(a.childLanes|=r),a=n,n=n.return;return a.tag===3?a.stateNode:null}var Vi=!1;function hd(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _g(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function mi(n,r){return{eventTime:n,lane:r,tag:0,payload:null,callback:null,next:null}}function qi(n,r,a){var f=n.updateQueue;if(f===null)return null;if(f=f.shared,(Fe&2)!==0){var p=f.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),f.pending=r,gi(n,a)}return p=f.interleaved,p===null?(r.next=r,fd(f)):(r.next=p.next,p.next=r),f.interleaved=r,gi(n,a)}function Cl(n,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194240)!==0)){var f=r.lanes;f&=n.pendingLanes,a|=f,r.lanes=a,Pu(n,a)}}function Cg(n,r){var a=n.updateQueue,f=n.alternate;if(f!==null&&(f=f.updateQueue,a===f)){var p=null,m=null;if(a=a.firstBaseUpdate,a!==null){do{var S={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};m===null?p=m=S:m=m.next=S,a=a.next}while(a!==null);m===null?p=m=r:m=m.next=r}else p=m=r;a={baseState:f.baseState,firstBaseUpdate:p,lastBaseUpdate:m,shared:f.shared,effects:f.effects},n.updateQueue=a;return}n=a.lastBaseUpdate,n===null?a.firstBaseUpdate=r:n.next=r,a.lastBaseUpdate=r}function Pl(n,r,a,f){var p=n.updateQueue;Vi=!1;var m=p.firstBaseUpdate,S=p.lastBaseUpdate,P=p.shared.pending;if(P!==null){p.shared.pending=null;var M=P,L=M.next;M.next=null,S===null?m=L:S.next=L,S=M;var j=n.alternate;j!==null&&(j=j.updateQueue,P=j.lastBaseUpdate,P!==S&&(P===null?j.firstBaseUpdate=L:P.next=L,j.lastBaseUpdate=M))}if(m!==null){var K=p.baseState;S=0,j=L=M=null,P=m;do{var Y=P.lane,le=P.eventTime;if((f&Y)===Y){j!==null&&(j=j.next={eventTime:le,lane:0,tag:P.tag,payload:P.payload,callback:P.callback,next:null});e:{var pe=n,ge=P;switch(Y=r,le=a,ge.tag){case 1:if(pe=ge.payload,typeof pe=="function"){K=pe.call(le,K,Y);break e}K=pe;break e;case 3:pe.flags=pe.flags&-65537|128;case 0:if(pe=ge.payload,Y=typeof pe=="function"?pe.call(le,K,Y):pe,Y==null)break e;K=Z({},K,Y);break e;case 2:Vi=!0}}P.callback!==null&&P.lane!==0&&(n.flags|=64,Y=p.effects,Y===null?p.effects=[P]:Y.push(P))}else le={eventTime:le,lane:Y,tag:P.tag,payload:P.payload,callback:P.callback,next:null},j===null?(L=j=le,M=K):j=j.next=le,S|=Y;if(P=P.next,P===null){if(P=p.shared.pending,P===null)break;Y=P,P=Y.next,Y.next=null,p.lastBaseUpdate=Y,p.shared.pending=null}}while(!0);if(j===null&&(M=K),p.baseState=M,p.firstBaseUpdate=L,p.lastBaseUpdate=j,r=p.shared.interleaved,r!==null){p=r;do S|=p.lane,p=p.next;while(p!==r)}else m===null&&(p.shared.lanes=0);Oo|=S,n.lanes=S,n.memoizedState=K}}function Pg(n,r,a){if(n=r.effects,r.effects=null,n!==null)for(r=0;r<n.length;r++){var f=n[r],p=f.callback;if(p!==null){if(f.callback=null,f=a,typeof p!="function")throw Error(i(191,p));p.call(f)}}}var Hs={},ei=zi(Hs),Fs=zi(Hs),Ls=zi(Hs);function ko(n){if(n===Hs)throw Error(i(174));return n}function pd(n,r){switch(Qe(Ls,r),Qe(Fs,n),Qe(ei,Hs),n=r.nodeType,n){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:gu(null,"");break;default:n=n===8?r.parentNode:r,r=n.namespaceURI||null,n=n.tagName,r=gu(r,n)}et(ei),Qe(ei,r)}function Rr(){et(ei),et(Fs),et(Ls)}function Rg(n){ko(Ls.current);var r=ko(ei.current),a=gu(r,n.type);r!==a&&(Qe(Fs,n),Qe(ei,a))}function gd(n){Fs.current===n&&(et(ei),et(Fs))}var rt=zi(0);function Rl(n){for(var r=n;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var md=[];function yd(){for(var n=0;n<md.length;n++)md[n]._workInProgressVersionPrimary=null;md.length=0}var Ml=R.ReactCurrentDispatcher,vd=R.ReactCurrentBatchConfig,Do=0,st=null,yt=null,wt=null,kl=!1,Us=!1,Gs=0,BA=0;function Lt(){throw Error(i(321))}function Id(n,r){if(r===null)return!1;for(var a=0;a<r.length&&a<n.length;a++)if(!Fn(n[a],r[a]))return!1;return!0}function Sd(n,r,a,f,p,m){if(Do=m,st=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Ml.current=n===null||n.memoizedState===null?UA:GA,n=a(f,p),Us){m=0;do{if(Us=!1,Gs=0,25<=m)throw Error(i(301));m+=1,wt=yt=null,r.updateQueue=null,Ml.current=xA,n=a(f,p)}while(Us)}if(Ml.current=bl,r=yt!==null&&yt.next!==null,Do=0,wt=yt=st=null,kl=!1,r)throw Error(i(300));return n}function Ad(){var n=Gs!==0;return Gs=0,n}function ti(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return wt===null?st.memoizedState=wt=n:wt=wt.next=n,wt}function Cn(){if(yt===null){var n=st.alternate;n=n!==null?n.memoizedState:null}else n=yt.next;var r=wt===null?st.memoizedState:wt.next;if(r!==null)wt=r,yt=n;else{if(n===null)throw Error(i(310));yt=n,n={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},wt===null?st.memoizedState=wt=n:wt=wt.next=n}return wt}function xs(n,r){return typeof r=="function"?r(n):r}function Td(n){var r=Cn(),a=r.queue;if(a===null)throw Error(i(311));a.lastRenderedReducer=n;var f=yt,p=f.baseQueue,m=a.pending;if(m!==null){if(p!==null){var S=p.next;p.next=m.next,m.next=S}f.baseQueue=p=m,a.pending=null}if(p!==null){m=p.next,f=f.baseState;var P=S=null,M=null,L=m;do{var j=L.lane;if((Do&j)===j)M!==null&&(M=M.next={lane:0,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null}),f=L.hasEagerState?L.eagerState:n(f,L.action);else{var K={lane:j,action:L.action,hasEagerState:L.hasEagerState,eagerState:L.eagerState,next:null};M===null?(P=M=K,S=f):M=M.next=K,st.lanes|=j,Oo|=j}L=L.next}while(L!==null&&L!==m);M===null?S=f:M.next=P,Fn(f,r.memoizedState)||(on=!0),r.memoizedState=f,r.baseState=S,r.baseQueue=M,a.lastRenderedState=f}if(n=a.interleaved,n!==null){p=n;do m=p.lane,st.lanes|=m,Oo|=m,p=p.next;while(p!==n)}else p===null&&(a.lanes=0);return[r.memoizedState,a.dispatch]}function Ed(n){var r=Cn(),a=r.queue;if(a===null)throw Error(i(311));a.lastRenderedReducer=n;var f=a.dispatch,p=a.pending,m=r.memoizedState;if(p!==null){a.pending=null;var S=p=p.next;do m=n(m,S.action),S=S.next;while(S!==p);Fn(m,r.memoizedState)||(on=!0),r.memoizedState=m,r.baseQueue===null&&(r.baseState=m),a.lastRenderedState=m}return[m,f]}function Mg(){}function kg(n,r){var a=st,f=Cn(),p=r(),m=!Fn(f.memoizedState,p);if(m&&(f.memoizedState=p,on=!0),f=f.queue,wd(bg.bind(null,a,f,n),[n]),f.getSnapshot!==r||m||wt!==null&&wt.memoizedState.tag&1){if(a.flags|=2048,$s(9,Og.bind(null,a,f,p,r),void 0,null),_t===null)throw Error(i(349));(Do&30)!==0||Dg(a,r,p)}return p}function Dg(n,r,a){n.flags|=16384,n={getSnapshot:r,value:a},r=st.updateQueue,r===null?(r={lastEffect:null,stores:null},st.updateQueue=r,r.stores=[n]):(a=r.stores,a===null?r.stores=[n]:a.push(n))}function Og(n,r,a,f){r.value=a,r.getSnapshot=f,Ng(r)&&Bg(n)}function bg(n,r,a){return a(function(){Ng(r)&&Bg(n)})}function Ng(n){var r=n.getSnapshot;n=n.value;try{var a=r();return!Fn(n,a)}catch{return!0}}function Bg(n){var r=gi(n,1);r!==null&&$n(r,n,1,-1)}function Hg(n){var r=ti();return typeof n=="function"&&(n=n()),r.memoizedState=r.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xs,lastRenderedState:n},r.queue=n,n=n.dispatch=LA.bind(null,st,n),[r.memoizedState,n]}function $s(n,r,a,f){return n={tag:n,create:r,destroy:a,deps:f,next:null},r=st.updateQueue,r===null?(r={lastEffect:null,stores:null},st.updateQueue=r,r.lastEffect=n.next=n):(a=r.lastEffect,a===null?r.lastEffect=n.next=n:(f=a.next,a.next=n,n.next=f,r.lastEffect=n)),n}function Fg(){return Cn().memoizedState}function Dl(n,r,a,f){var p=ti();st.flags|=n,p.memoizedState=$s(1|r,a,void 0,f===void 0?null:f)}function Ol(n,r,a,f){var p=Cn();f=f===void 0?null:f;var m=void 0;if(yt!==null){var S=yt.memoizedState;if(m=S.destroy,f!==null&&Id(f,S.deps)){p.memoizedState=$s(r,a,m,f);return}}st.flags|=n,p.memoizedState=$s(1|r,a,m,f)}function Lg(n,r){return Dl(8390656,8,n,r)}function wd(n,r){return Ol(2048,8,n,r)}function Ug(n,r){return Ol(4,2,n,r)}function Gg(n,r){return Ol(4,4,n,r)}function xg(n,r){if(typeof r=="function")return n=n(),r(n),function(){r(null)};if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function $g(n,r,a){return a=a!=null?a.concat([n]):null,Ol(4,4,xg.bind(null,r,n),a)}function _d(){}function Wg(n,r){var a=Cn();r=r===void 0?null:r;var f=a.memoizedState;return f!==null&&r!==null&&Id(r,f[1])?f[0]:(a.memoizedState=[n,r],n)}function Yg(n,r){var a=Cn();r=r===void 0?null:r;var f=a.memoizedState;return f!==null&&r!==null&&Id(r,f[1])?f[0]:(n=n(),a.memoizedState=[n,r],n)}function zg(n,r,a){return(Do&21)===0?(n.baseState&&(n.baseState=!1,on=!0),n.memoizedState=a):(Fn(a,r)||(a=Ap(),st.lanes|=a,Oo|=a,n.baseState=!0),r)}function HA(n,r){var a=We;We=a!==0&&4>a?a:4,n(!0);var f=vd.transition;vd.transition={};try{n(!1),r()}finally{We=a,vd.transition=f}}function jg(){return Cn().memoizedState}function FA(n,r,a){var f=Ji(n);if(a={lane:f,action:a,hasEagerState:!1,eagerState:null,next:null},Xg(n))Vg(r,a);else if(a=wg(n,r,a,f),a!==null){var p=Xt();$n(a,n,f,p),qg(a,r,f)}}function LA(n,r,a){var f=Ji(n),p={lane:f,action:a,hasEagerState:!1,eagerState:null,next:null};if(Xg(n))Vg(r,p);else{var m=n.alternate;if(n.lanes===0&&(m===null||m.lanes===0)&&(m=r.lastRenderedReducer,m!==null))try{var S=r.lastRenderedState,P=m(S,a);if(p.hasEagerState=!0,p.eagerState=P,Fn(P,S)){var M=r.interleaved;M===null?(p.next=p,fd(r)):(p.next=M.next,M.next=p),r.interleaved=p;return}}catch{}finally{}a=wg(n,r,p,f),a!==null&&(p=Xt(),$n(a,n,f,p),qg(a,r,f))}}function Xg(n){var r=n.alternate;return n===st||r!==null&&r===st}function Vg(n,r){Us=kl=!0;var a=n.pending;a===null?r.next=r:(r.next=a.next,a.next=r),n.pending=r}function qg(n,r,a){if((a&4194240)!==0){var f=r.lanes;f&=n.pendingLanes,a|=f,r.lanes=a,Pu(n,a)}}var bl={readContext:_n,useCallback:Lt,useContext:Lt,useEffect:Lt,useImperativeHandle:Lt,useInsertionEffect:Lt,useLayoutEffect:Lt,useMemo:Lt,useReducer:Lt,useRef:Lt,useState:Lt,useDebugValue:Lt,useDeferredValue:Lt,useTransition:Lt,useMutableSource:Lt,useSyncExternalStore:Lt,useId:Lt,unstable_isNewReconciler:!1},UA={readContext:_n,useCallback:function(n,r){return ti().memoizedState=[n,r===void 0?null:r],n},useContext:_n,useEffect:Lg,useImperativeHandle:function(n,r,a){return a=a!=null?a.concat([n]):null,Dl(4194308,4,xg.bind(null,r,n),a)},useLayoutEffect:function(n,r){return Dl(4194308,4,n,r)},useInsertionEffect:function(n,r){return Dl(4,2,n,r)},useMemo:function(n,r){var a=ti();return r=r===void 0?null:r,n=n(),a.memoizedState=[n,r],n},useReducer:function(n,r,a){var f=ti();return r=a!==void 0?a(r):r,f.memoizedState=f.baseState=r,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:r},f.queue=n,n=n.dispatch=FA.bind(null,st,n),[f.memoizedState,n]},useRef:function(n){var r=ti();return n={current:n},r.memoizedState=n},useState:Hg,useDebugValue:_d,useDeferredValue:function(n){return ti().memoizedState=n},useTransition:function(){var n=Hg(!1),r=n[0];return n=HA.bind(null,n[1]),ti().memoizedState=n,[r,n]},useMutableSource:function(){},useSyncExternalStore:function(n,r,a){var f=st,p=ti();if(it){if(a===void 0)throw Error(i(407));a=a()}else{if(a=r(),_t===null)throw Error(i(349));(Do&30)!==0||Dg(f,r,a)}p.memoizedState=a;var m={value:a,getSnapshot:r};return p.queue=m,Lg(bg.bind(null,f,m,n),[n]),f.flags|=2048,$s(9,Og.bind(null,f,m,a,r),void 0,null),a},useId:function(){var n=ti(),r=_t.identifierPrefix;if(it){var a=pi,f=hi;a=(f&~(1<<32-Hn(f)-1)).toString(32)+a,r=":"+r+"R"+a,a=Gs++,0<a&&(r+="H"+a.toString(32)),r+=":"}else a=BA++,r=":"+r+"r"+a.toString(32)+":";return n.memoizedState=r},unstable_isNewReconciler:!1},GA={readContext:_n,useCallback:Wg,useContext:_n,useEffect:wd,useImperativeHandle:$g,useInsertionEffect:Ug,useLayoutEffect:Gg,useMemo:Yg,useReducer:Td,useRef:Fg,useState:function(){return Td(xs)},useDebugValue:_d,useDeferredValue:function(n){var r=Cn();return zg(r,yt.memoizedState,n)},useTransition:function(){var n=Td(xs)[0],r=Cn().memoizedState;return[n,r]},useMutableSource:Mg,useSyncExternalStore:kg,useId:jg,unstable_isNewReconciler:!1},xA={readContext:_n,useCallback:Wg,useContext:_n,useEffect:wd,useImperativeHandle:$g,useInsertionEffect:Ug,useLayoutEffect:Gg,useMemo:Yg,useReducer:Ed,useRef:Fg,useState:function(){return Ed(xs)},useDebugValue:_d,useDeferredValue:function(n){var r=Cn();return yt===null?r.memoizedState=n:zg(r,yt.memoizedState,n)},useTransition:function(){var n=Ed(xs)[0],r=Cn().memoizedState;return[n,r]},useMutableSource:Mg,useSyncExternalStore:kg,useId:jg,unstable_isNewReconciler:!1};function Un(n,r){if(n&&n.defaultProps){r=Z({},r),n=n.defaultProps;for(var a in n)r[a]===void 0&&(r[a]=n[a]);return r}return r}function Cd(n,r,a,f){r=n.memoizedState,a=a(f,r),a=a==null?r:Z({},r,a),n.memoizedState=a,n.lanes===0&&(n.updateQueue.baseState=a)}var Nl={isMounted:function(n){return(n=n._reactInternals)?wo(n)===n:!1},enqueueSetState:function(n,r,a){n=n._reactInternals;var f=Xt(),p=Ji(n),m=mi(f,p);m.payload=r,a!=null&&(m.callback=a),r=qi(n,m,p),r!==null&&($n(r,n,p,f),Cl(r,n,p))},enqueueReplaceState:function(n,r,a){n=n._reactInternals;var f=Xt(),p=Ji(n),m=mi(f,p);m.tag=1,m.payload=r,a!=null&&(m.callback=a),r=qi(n,m,p),r!==null&&($n(r,n,p,f),Cl(r,n,p))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var a=Xt(),f=Ji(n),p=mi(a,f);p.tag=2,r!=null&&(p.callback=r),r=qi(n,p,f),r!==null&&($n(r,n,f,a),Cl(r,n,f))}};function Zg(n,r,a,f,p,m,S){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(f,m,S):r.prototype&&r.prototype.isPureReactComponent?!Rs(a,f)||!Rs(p,m):!0}function Kg(n,r,a){var f=!1,p=ji,m=r.contextType;return typeof m=="object"&&m!==null?m=_n(m):(p=nn(r)?Co:Ft.current,f=r.contextTypes,m=(f=f!=null)?Ar(n,p):ji),r=new r(a,m),n.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Nl,n.stateNode=r,r._reactInternals=n,f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=p,n.__reactInternalMemoizedMaskedChildContext=m),r}function Qg(n,r,a,f){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,f),r.state!==n&&Nl.enqueueReplaceState(r,r.state,null)}function Pd(n,r,a,f){var p=n.stateNode;p.props=a,p.state=n.memoizedState,p.refs={},hd(n);var m=r.contextType;typeof m=="object"&&m!==null?p.context=_n(m):(m=nn(r)?Co:Ft.current,p.context=Ar(n,m)),p.state=n.memoizedState,m=r.getDerivedStateFromProps,typeof m=="function"&&(Cd(n,r,m,a),p.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(r=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),r!==p.state&&Nl.enqueueReplaceState(p,p.state,null),Pl(n,a,p,f),p.state=n.memoizedState),typeof p.componentDidMount=="function"&&(n.flags|=4194308)}function Mr(n,r){try{var a="",f=r;do a+=Re(f),f=f.return;while(f);var p=a}catch(m){p=`
Error generating stack: `+m.message+`
`+m.stack}return{value:n,source:r,stack:p,digest:null}}function Rd(n,r,a){return{value:n,source:null,stack:a??null,digest:r??null}}function Md(n,r){try{console.error(r.value)}catch(a){setTimeout(function(){throw a})}}var $A=typeof WeakMap=="function"?WeakMap:Map;function Jg(n,r,a){a=mi(-1,a),a.tag=3,a.payload={element:null};var f=r.value;return a.callback=function(){xl||(xl=!0,Yd=f),Md(n,r)},a}function em(n,r,a){a=mi(-1,a),a.tag=3;var f=n.type.getDerivedStateFromError;if(typeof f=="function"){var p=r.value;a.payload=function(){return f(p)},a.callback=function(){Md(n,r)}}var m=n.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(a.callback=function(){Md(n,r),typeof f!="function"&&(Ki===null?Ki=new Set([this]):Ki.add(this));var S=r.stack;this.componentDidCatch(r.value,{componentStack:S!==null?S:""})}),a}function tm(n,r,a){var f=n.pingCache;if(f===null){f=n.pingCache=new $A;var p=new Set;f.set(r,p)}else p=f.get(r),p===void 0&&(p=new Set,f.set(r,p));p.has(a)||(p.add(a),n=nT.bind(null,n,r,a),r.then(n,n))}function nm(n){do{var r;if((r=n.tag===13)&&(r=n.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return n;n=n.return}while(n!==null);return null}function im(n,r,a,f,p){return(n.mode&1)===0?(n===r?n.flags|=65536:(n.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(r=mi(-1,1),r.tag=2,qi(a,r,1))),a.lanes|=1),n):(n.flags|=65536,n.lanes=p,n)}var WA=R.ReactCurrentOwner,on=!1;function jt(n,r,a,f){r.child=n===null?Eg(r,null,a,f):_r(r,n.child,a,f)}function om(n,r,a,f,p){a=a.render;var m=r.ref;return Pr(r,p),f=Sd(n,r,a,f,m,p),a=Ad(),n!==null&&!on?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~p,yi(n,r,p)):(it&&a&&id(r),r.flags|=1,jt(n,r,f,p),r.child)}function rm(n,r,a,f,p){if(n===null){var m=a.type;return typeof m=="function"&&!Kd(m)&&m.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(r.tag=15,r.type=m,sm(n,r,m,f,p)):(n=Xl(a.type,null,f,r,r.mode,p),n.ref=r.ref,n.return=r,r.child=n)}if(m=n.child,(n.lanes&p)===0){var S=m.memoizedProps;if(a=a.compare,a=a!==null?a:Rs,a(S,f)&&n.ref===r.ref)return yi(n,r,p)}return r.flags|=1,n=to(m,f),n.ref=r.ref,n.return=r,r.child=n}function sm(n,r,a,f,p){if(n!==null){var m=n.memoizedProps;if(Rs(m,f)&&n.ref===r.ref)if(on=!1,r.pendingProps=f=m,(n.lanes&p)!==0)(n.flags&131072)!==0&&(on=!0);else return r.lanes=n.lanes,yi(n,r,p)}return kd(n,r,a,f,p)}function am(n,r,a){var f=r.pendingProps,p=f.children,m=n!==null?n.memoizedState:null;if(f.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qe(Dr,pn),pn|=a;else{if((a&1073741824)===0)return n=m!==null?m.baseLanes|a:a,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:n,cachePool:null,transitions:null},r.updateQueue=null,Qe(Dr,pn),pn|=n,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=m!==null?m.baseLanes:a,Qe(Dr,pn),pn|=f}else m!==null?(f=m.baseLanes|a,r.memoizedState=null):f=a,Qe(Dr,pn),pn|=f;return jt(n,r,p,a),r.child}function lm(n,r){var a=r.ref;(n===null&&a!==null||n!==null&&n.ref!==a)&&(r.flags|=512,r.flags|=2097152)}function kd(n,r,a,f,p){var m=nn(a)?Co:Ft.current;return m=Ar(r,m),Pr(r,p),a=Sd(n,r,a,f,m,p),f=Ad(),n!==null&&!on?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~p,yi(n,r,p)):(it&&f&&id(r),r.flags|=1,jt(n,r,a,p),r.child)}function cm(n,r,a,f,p){if(nn(a)){var m=!0;vl(r)}else m=!1;if(Pr(r,p),r.stateNode===null)Hl(n,r),Kg(r,a,f),Pd(r,a,f,p),f=!0;else if(n===null){var S=r.stateNode,P=r.memoizedProps;S.props=P;var M=S.context,L=a.contextType;typeof L=="object"&&L!==null?L=_n(L):(L=nn(a)?Co:Ft.current,L=Ar(r,L));var j=a.getDerivedStateFromProps,K=typeof j=="function"||typeof S.getSnapshotBeforeUpdate=="function";K||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(P!==f||M!==L)&&Qg(r,S,f,L),Vi=!1;var Y=r.memoizedState;S.state=Y,Pl(r,f,S,p),M=r.memoizedState,P!==f||Y!==M||tn.current||Vi?(typeof j=="function"&&(Cd(r,a,j,f),M=r.memoizedState),(P=Vi||Zg(r,a,P,f,Y,M,L))?(K||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(r.flags|=4194308)):(typeof S.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=M),S.props=f,S.state=M,S.context=L,f=P):(typeof S.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{S=r.stateNode,_g(n,r),P=r.memoizedProps,L=r.type===r.elementType?P:Un(r.type,P),S.props=L,K=r.pendingProps,Y=S.context,M=a.contextType,typeof M=="object"&&M!==null?M=_n(M):(M=nn(a)?Co:Ft.current,M=Ar(r,M));var le=a.getDerivedStateFromProps;(j=typeof le=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(P!==K||Y!==M)&&Qg(r,S,f,M),Vi=!1,Y=r.memoizedState,S.state=Y,Pl(r,f,S,p);var pe=r.memoizedState;P!==K||Y!==pe||tn.current||Vi?(typeof le=="function"&&(Cd(r,a,le,f),pe=r.memoizedState),(L=Vi||Zg(r,a,L,f,Y,pe,M)||!1)?(j||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(f,pe,M),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(f,pe,M)),typeof S.componentDidUpdate=="function"&&(r.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof S.componentDidUpdate!="function"||P===n.memoizedProps&&Y===n.memoizedState||(r.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||P===n.memoizedProps&&Y===n.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=pe),S.props=f,S.state=pe,S.context=M,f=L):(typeof S.componentDidUpdate!="function"||P===n.memoizedProps&&Y===n.memoizedState||(r.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||P===n.memoizedProps&&Y===n.memoizedState||(r.flags|=1024),f=!1)}return Dd(n,r,a,f,m,p)}function Dd(n,r,a,f,p,m){lm(n,r);var S=(r.flags&128)!==0;if(!f&&!S)return p&&pg(r,a,!1),yi(n,r,m);f=r.stateNode,WA.current=r;var P=S&&typeof a.getDerivedStateFromError!="function"?null:f.render();return r.flags|=1,n!==null&&S?(r.child=_r(r,n.child,null,m),r.child=_r(r,null,P,m)):jt(n,r,P,m),r.memoizedState=f.state,p&&pg(r,a,!0),r.child}function um(n){var r=n.stateNode;r.pendingContext?fg(n,r.pendingContext,r.pendingContext!==r.context):r.context&&fg(n,r.context,!1),pd(n,r.containerInfo)}function dm(n,r,a,f,p){return wr(),ad(p),r.flags|=256,jt(n,r,a,f),r.child}var Od={dehydrated:null,treeContext:null,retryLane:0};function bd(n){return{baseLanes:n,cachePool:null,transitions:null}}function fm(n,r,a){var f=r.pendingProps,p=rt.current,m=!1,S=(r.flags&128)!==0,P;if((P=S)||(P=n!==null&&n.memoizedState===null?!1:(p&2)!==0),P?(m=!0,r.flags&=-129):(n===null||n.memoizedState!==null)&&(p|=1),Qe(rt,p&1),n===null)return sd(r),n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((r.mode&1)===0?r.lanes=1:n.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(S=f.children,n=f.fallback,m?(f=r.mode,m=r.child,S={mode:"hidden",children:S},(f&1)===0&&m!==null?(m.childLanes=0,m.pendingProps=S):m=Vl(S,f,0,null),n=Ho(n,f,a,null),m.return=r,n.return=r,m.sibling=n,r.child=m,r.child.memoizedState=bd(a),r.memoizedState=Od,n):Nd(r,S));if(p=n.memoizedState,p!==null&&(P=p.dehydrated,P!==null))return YA(n,r,S,f,P,p,a);if(m){m=f.fallback,S=r.mode,p=n.child,P=p.sibling;var M={mode:"hidden",children:f.children};return(S&1)===0&&r.child!==p?(f=r.child,f.childLanes=0,f.pendingProps=M,r.deletions=null):(f=to(p,M),f.subtreeFlags=p.subtreeFlags&14680064),P!==null?m=to(P,m):(m=Ho(m,S,a,null),m.flags|=2),m.return=r,f.return=r,f.sibling=m,r.child=f,f=m,m=r.child,S=n.child.memoizedState,S=S===null?bd(a):{baseLanes:S.baseLanes|a,cachePool:null,transitions:S.transitions},m.memoizedState=S,m.childLanes=n.childLanes&~a,r.memoizedState=Od,f}return m=n.child,n=m.sibling,f=to(m,{mode:"visible",children:f.children}),(r.mode&1)===0&&(f.lanes=a),f.return=r,f.sibling=null,n!==null&&(a=r.deletions,a===null?(r.deletions=[n],r.flags|=16):a.push(n)),r.child=f,r.memoizedState=null,f}function Nd(n,r){return r=Vl({mode:"visible",children:r},n.mode,0,null),r.return=n,n.child=r}function Bl(n,r,a,f){return f!==null&&ad(f),_r(r,n.child,null,a),n=Nd(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function YA(n,r,a,f,p,m,S){if(a)return r.flags&256?(r.flags&=-257,f=Rd(Error(i(422))),Bl(n,r,S,f)):r.memoizedState!==null?(r.child=n.child,r.flags|=128,null):(m=f.fallback,p=r.mode,f=Vl({mode:"visible",children:f.children},p,0,null),m=Ho(m,p,S,null),m.flags|=2,f.return=r,m.return=r,f.sibling=m,r.child=f,(r.mode&1)!==0&&_r(r,n.child,null,S),r.child.memoizedState=bd(S),r.memoizedState=Od,m);if((r.mode&1)===0)return Bl(n,r,S,null);if(p.data==="$!"){if(f=p.nextSibling&&p.nextSibling.dataset,f)var P=f.dgst;return f=P,m=Error(i(419)),f=Rd(m,f,void 0),Bl(n,r,S,f)}if(P=(S&n.childLanes)!==0,on||P){if(f=_t,f!==null){switch(S&-S){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=(p&(f.suspendedLanes|S))!==0?0:p,p!==0&&p!==m.retryLane&&(m.retryLane=p,gi(n,p),$n(f,n,p,-1))}return Zd(),f=Rd(Error(i(421))),Bl(n,r,S,f)}return p.data==="$?"?(r.flags|=128,r.child=n.child,r=iT.bind(null,n),p._reactRetry=r,null):(n=m.treeContext,hn=Yi(p.nextSibling),fn=r,it=!0,Ln=null,n!==null&&(En[wn++]=hi,En[wn++]=pi,En[wn++]=Po,hi=n.id,pi=n.overflow,Po=r),r=Nd(r,f.children),r.flags|=4096,r)}function hm(n,r,a){n.lanes|=r;var f=n.alternate;f!==null&&(f.lanes|=r),dd(n.return,r,a)}function Bd(n,r,a,f,p){var m=n.memoizedState;m===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:a,tailMode:p}:(m.isBackwards=r,m.rendering=null,m.renderingStartTime=0,m.last=f,m.tail=a,m.tailMode=p)}function pm(n,r,a){var f=r.pendingProps,p=f.revealOrder,m=f.tail;if(jt(n,r,f.children,a),f=rt.current,(f&2)!==0)f=f&1|2,r.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&hm(n,a,r);else if(n.tag===19)hm(n,a,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}f&=1}if(Qe(rt,f),(r.mode&1)===0)r.memoizedState=null;else switch(p){case"forwards":for(a=r.child,p=null;a!==null;)n=a.alternate,n!==null&&Rl(n)===null&&(p=a),a=a.sibling;a=p,a===null?(p=r.child,r.child=null):(p=a.sibling,a.sibling=null),Bd(r,!1,p,a,m);break;case"backwards":for(a=null,p=r.child,r.child=null;p!==null;){if(n=p.alternate,n!==null&&Rl(n)===null){r.child=p;break}n=p.sibling,p.sibling=a,a=p,p=n}Bd(r,!0,a,null,m);break;case"together":Bd(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Hl(n,r){(r.mode&1)===0&&n!==null&&(n.alternate=null,r.alternate=null,r.flags|=2)}function yi(n,r,a){if(n!==null&&(r.dependencies=n.dependencies),Oo|=r.lanes,(a&r.childLanes)===0)return null;if(n!==null&&r.child!==n.child)throw Error(i(153));if(r.child!==null){for(n=r.child,a=to(n,n.pendingProps),r.child=a,a.return=r;n.sibling!==null;)n=n.sibling,a=a.sibling=to(n,n.pendingProps),a.return=r;a.sibling=null}return r.child}function zA(n,r,a){switch(r.tag){case 3:um(r),wr();break;case 5:Rg(r);break;case 1:nn(r.type)&&vl(r);break;case 4:pd(r,r.stateNode.containerInfo);break;case 10:var f=r.type._context,p=r.memoizedProps.value;Qe(wl,f._currentValue),f._currentValue=p;break;case 13:if(f=r.memoizedState,f!==null)return f.dehydrated!==null?(Qe(rt,rt.current&1),r.flags|=128,null):(a&r.child.childLanes)!==0?fm(n,r,a):(Qe(rt,rt.current&1),n=yi(n,r,a),n!==null?n.sibling:null);Qe(rt,rt.current&1);break;case 19:if(f=(a&r.childLanes)!==0,(n.flags&128)!==0){if(f)return pm(n,r,a);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Qe(rt,rt.current),f)break;return null;case 22:case 23:return r.lanes=0,am(n,r,a)}return yi(n,r,a)}var gm,Hd,mm,ym;gm=function(n,r){for(var a=r.child;a!==null;){if(a.tag===5||a.tag===6)n.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return;a=a.return}a.sibling.return=a.return,a=a.sibling}},Hd=function(){},mm=function(n,r,a,f){var p=n.memoizedProps;if(p!==f){n=r.stateNode,ko(ei.current);var m=null;switch(a){case"input":p=Ke(n,p),f=Ke(n,f),m=[];break;case"select":p=Z({},p,{value:void 0}),f=Z({},f,{value:void 0}),m=[];break;case"textarea":p=Eo(n,p),f=Eo(n,f),m=[];break;default:typeof p.onClick!="function"&&typeof f.onClick=="function"&&(n.onclick=gl)}mu(a,f);var S;a=null;for(L in p)if(!f.hasOwnProperty(L)&&p.hasOwnProperty(L)&&p[L]!=null)if(L==="style"){var P=p[L];for(S in P)P.hasOwnProperty(S)&&(a||(a={}),a[S]="")}else L!=="dangerouslySetInnerHTML"&&L!=="children"&&L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&L!=="autoFocus"&&(s.hasOwnProperty(L)?m||(m=[]):(m=m||[]).push(L,null));for(L in f){var M=f[L];if(P=p!=null?p[L]:void 0,f.hasOwnProperty(L)&&M!==P&&(M!=null||P!=null))if(L==="style")if(P){for(S in P)!P.hasOwnProperty(S)||M&&M.hasOwnProperty(S)||(a||(a={}),a[S]="");for(S in M)M.hasOwnProperty(S)&&P[S]!==M[S]&&(a||(a={}),a[S]=M[S])}else a||(m||(m=[]),m.push(L,a)),a=M;else L==="dangerouslySetInnerHTML"?(M=M?M.__html:void 0,P=P?P.__html:void 0,M!=null&&P!==M&&(m=m||[]).push(L,M)):L==="children"?typeof M!="string"&&typeof M!="number"||(m=m||[]).push(L,""+M):L!=="suppressContentEditableWarning"&&L!=="suppressHydrationWarning"&&(s.hasOwnProperty(L)?(M!=null&&L==="onScroll"&&Je("scroll",n),m||P===M||(m=[])):(m=m||[]).push(L,M))}a&&(m=m||[]).push("style",a);var L=m;(r.updateQueue=L)&&(r.flags|=4)}},ym=function(n,r,a,f){a!==f&&(r.flags|=4)};function Ws(n,r){if(!it)switch(n.tailMode){case"hidden":r=n.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?n.tail=null:a.sibling=null;break;case"collapsed":a=n.tail;for(var f=null;a!==null;)a.alternate!==null&&(f=a),a=a.sibling;f===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:f.sibling=null}}function Ut(n){var r=n.alternate!==null&&n.alternate.child===n.child,a=0,f=0;if(r)for(var p=n.child;p!==null;)a|=p.lanes|p.childLanes,f|=p.subtreeFlags&14680064,f|=p.flags&14680064,p.return=n,p=p.sibling;else for(p=n.child;p!==null;)a|=p.lanes|p.childLanes,f|=p.subtreeFlags,f|=p.flags,p.return=n,p=p.sibling;return n.subtreeFlags|=f,n.childLanes=a,r}function jA(n,r,a){var f=r.pendingProps;switch(od(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ut(r),null;case 1:return nn(r.type)&&yl(),Ut(r),null;case 3:return f=r.stateNode,Rr(),et(tn),et(Ft),yd(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(n===null||n.child===null)&&(Tl(r)?r.flags|=4:n===null||n.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Ln!==null&&(Xd(Ln),Ln=null))),Hd(n,r),Ut(r),null;case 5:gd(r);var p=ko(Ls.current);if(a=r.type,n!==null&&r.stateNode!=null)mm(n,r,a,f,p),n.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!f){if(r.stateNode===null)throw Error(i(166));return Ut(r),null}if(n=ko(ei.current),Tl(r)){f=r.stateNode,a=r.type;var m=r.memoizedProps;switch(f[Jn]=r,f[bs]=m,n=(r.mode&1)!==0,a){case"dialog":Je("cancel",f),Je("close",f);break;case"iframe":case"object":case"embed":Je("load",f);break;case"video":case"audio":for(p=0;p<ks.length;p++)Je(ks[p],f);break;case"source":Je("error",f);break;case"img":case"image":case"link":Je("error",f),Je("load",f);break;case"details":Je("toggle",f);break;case"input":Ve(f,m),Je("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!m.multiple},Je("invalid",f);break;case"textarea":ep(f,m),Je("invalid",f)}mu(a,m),p=null;for(var S in m)if(m.hasOwnProperty(S)){var P=m[S];S==="children"?typeof P=="string"?f.textContent!==P&&(m.suppressHydrationWarning!==!0&&pl(f.textContent,P,n),p=["children",P]):typeof P=="number"&&f.textContent!==""+P&&(m.suppressHydrationWarning!==!0&&pl(f.textContent,P,n),p=["children",""+P]):s.hasOwnProperty(S)&&P!=null&&S==="onScroll"&&Je("scroll",f)}switch(a){case"input":Ne(f),Tn(f,m,!0);break;case"textarea":Ne(f),np(f);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(f.onclick=gl)}f=p,r.updateQueue=f,f!==null&&(r.flags|=4)}else{S=p.nodeType===9?p:p.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=ip(a)),n==="http://www.w3.org/1999/xhtml"?a==="script"?(n=S.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof f.is=="string"?n=S.createElement(a,{is:f.is}):(n=S.createElement(a),a==="select"&&(S=n,f.multiple?S.multiple=!0:f.size&&(S.size=f.size))):n=S.createElementNS(n,a),n[Jn]=r,n[bs]=f,gm(n,r,!1,!1),r.stateNode=n;e:{switch(S=yu(a,f),a){case"dialog":Je("cancel",n),Je("close",n),p=f;break;case"iframe":case"object":case"embed":Je("load",n),p=f;break;case"video":case"audio":for(p=0;p<ks.length;p++)Je(ks[p],n);p=f;break;case"source":Je("error",n),p=f;break;case"img":case"image":case"link":Je("error",n),Je("load",n),p=f;break;case"details":Je("toggle",n),p=f;break;case"input":Ve(n,f),p=Ke(n,f),Je("invalid",n);break;case"option":p=f;break;case"select":n._wrapperState={wasMultiple:!!f.multiple},p=Z({},f,{value:void 0}),Je("invalid",n);break;case"textarea":ep(n,f),p=Eo(n,f),Je("invalid",n);break;default:p=f}mu(a,p),P=p;for(m in P)if(P.hasOwnProperty(m)){var M=P[m];m==="style"?sp(n,M):m==="dangerouslySetInnerHTML"?(M=M?M.__html:void 0,M!=null&&op(n,M)):m==="children"?typeof M=="string"?(a!=="textarea"||M!=="")&&ds(n,M):typeof M=="number"&&ds(n,""+M):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(s.hasOwnProperty(m)?M!=null&&m==="onScroll"&&Je("scroll",n):M!=null&&w(n,m,M,S))}switch(a){case"input":Ne(n),Tn(n,f,!1);break;case"textarea":Ne(n),np(n);break;case"option":f.value!=null&&n.setAttribute("value",""+Te(f.value));break;case"select":n.multiple=!!f.multiple,m=f.value,m!=null?Fi(n,!!f.multiple,m,!1):f.defaultValue!=null&&Fi(n,!!f.multiple,f.defaultValue,!0);break;default:typeof p.onClick=="function"&&(n.onclick=gl)}switch(a){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Ut(r),null;case 6:if(n&&r.stateNode!=null)ym(n,r,n.memoizedProps,f);else{if(typeof f!="string"&&r.stateNode===null)throw Error(i(166));if(a=ko(Ls.current),ko(ei.current),Tl(r)){if(f=r.stateNode,a=r.memoizedProps,f[Jn]=r,(m=f.nodeValue!==a)&&(n=fn,n!==null))switch(n.tag){case 3:pl(f.nodeValue,a,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&pl(f.nodeValue,a,(n.mode&1)!==0)}m&&(r.flags|=4)}else f=(a.nodeType===9?a:a.ownerDocument).createTextNode(f),f[Jn]=r,r.stateNode=f}return Ut(r),null;case 13:if(et(rt),f=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(it&&hn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)Sg(),wr(),r.flags|=98560,m=!1;else if(m=Tl(r),f!==null&&f.dehydrated!==null){if(n===null){if(!m)throw Error(i(318));if(m=r.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));m[Jn]=r}else wr(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Ut(r),m=!1}else Ln!==null&&(Xd(Ln),Ln=null),m=!0;if(!m)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=a,r):(f=f!==null,f!==(n!==null&&n.memoizedState!==null)&&f&&(r.child.flags|=8192,(r.mode&1)!==0&&(n===null||(rt.current&1)!==0?vt===0&&(vt=3):Zd())),r.updateQueue!==null&&(r.flags|=4),Ut(r),null);case 4:return Rr(),Hd(n,r),n===null&&Ds(r.stateNode.containerInfo),Ut(r),null;case 10:return ud(r.type._context),Ut(r),null;case 17:return nn(r.type)&&yl(),Ut(r),null;case 19:if(et(rt),m=r.memoizedState,m===null)return Ut(r),null;if(f=(r.flags&128)!==0,S=m.rendering,S===null)if(f)Ws(m,!1);else{if(vt!==0||n!==null&&(n.flags&128)!==0)for(n=r.child;n!==null;){if(S=Rl(n),S!==null){for(r.flags|=128,Ws(m,!1),f=S.updateQueue,f!==null&&(r.updateQueue=f,r.flags|=4),r.subtreeFlags=0,f=a,a=r.child;a!==null;)m=a,n=f,m.flags&=14680066,S=m.alternate,S===null?(m.childLanes=0,m.lanes=n,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=S.childLanes,m.lanes=S.lanes,m.child=S.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=S.memoizedProps,m.memoizedState=S.memoizedState,m.updateQueue=S.updateQueue,m.type=S.type,n=S.dependencies,m.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),a=a.sibling;return Qe(rt,rt.current&1|2),r.child}n=n.sibling}m.tail!==null&&ct()>Or&&(r.flags|=128,f=!0,Ws(m,!1),r.lanes=4194304)}else{if(!f)if(n=Rl(S),n!==null){if(r.flags|=128,f=!0,a=n.updateQueue,a!==null&&(r.updateQueue=a,r.flags|=4),Ws(m,!0),m.tail===null&&m.tailMode==="hidden"&&!S.alternate&&!it)return Ut(r),null}else 2*ct()-m.renderingStartTime>Or&&a!==1073741824&&(r.flags|=128,f=!0,Ws(m,!1),r.lanes=4194304);m.isBackwards?(S.sibling=r.child,r.child=S):(a=m.last,a!==null?a.sibling=S:r.child=S,m.last=S)}return m.tail!==null?(r=m.tail,m.rendering=r,m.tail=r.sibling,m.renderingStartTime=ct(),r.sibling=null,a=rt.current,Qe(rt,f?a&1|2:a&1),r):(Ut(r),null);case 22:case 23:return qd(),f=r.memoizedState!==null,n!==null&&n.memoizedState!==null!==f&&(r.flags|=8192),f&&(r.mode&1)!==0?(pn&1073741824)!==0&&(Ut(r),r.subtreeFlags&6&&(r.flags|=8192)):Ut(r),null;case 24:return null;case 25:return null}throw Error(i(156,r.tag))}function XA(n,r){switch(od(r),r.tag){case 1:return nn(r.type)&&yl(),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return Rr(),et(tn),et(Ft),yd(),n=r.flags,(n&65536)!==0&&(n&128)===0?(r.flags=n&-65537|128,r):null;case 5:return gd(r),null;case 13:if(et(rt),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error(i(340));wr()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return et(rt),null;case 4:return Rr(),null;case 10:return ud(r.type._context),null;case 22:case 23:return qd(),null;case 24:return null;default:return null}}var Fl=!1,Gt=!1,VA=typeof WeakSet=="function"?WeakSet:Set,fe=null;function kr(n,r){var a=n.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(f){lt(n,r,f)}else a.current=null}function Fd(n,r,a){try{a()}catch(f){lt(n,r,f)}}var vm=!1;function qA(n,r){if(qu=il,n=Zp(),xu(n)){if("selectionStart"in n)var a={start:n.selectionStart,end:n.selectionEnd};else e:{a=(a=n.ownerDocument)&&a.defaultView||window;var f=a.getSelection&&a.getSelection();if(f&&f.rangeCount!==0){a=f.anchorNode;var p=f.anchorOffset,m=f.focusNode;f=f.focusOffset;try{a.nodeType,m.nodeType}catch{a=null;break e}var S=0,P=-1,M=-1,L=0,j=0,K=n,Y=null;t:for(;;){for(var le;K!==a||p!==0&&K.nodeType!==3||(P=S+p),K!==m||f!==0&&K.nodeType!==3||(M=S+f),K.nodeType===3&&(S+=K.nodeValue.length),(le=K.firstChild)!==null;)Y=K,K=le;for(;;){if(K===n)break t;if(Y===a&&++L===p&&(P=S),Y===m&&++j===f&&(M=S),(le=K.nextSibling)!==null)break;K=Y,Y=K.parentNode}K=le}a=P===-1||M===-1?null:{start:P,end:M}}else a=null}a=a||{start:0,end:0}}else a=null;for(Zu={focusedElem:n,selectionRange:a},il=!1,fe=r;fe!==null;)if(r=fe,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,fe=n;else for(;fe!==null;){r=fe;try{var pe=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(pe!==null){var ge=pe.memoizedProps,ut=pe.memoizedState,H=r.stateNode,b=H.getSnapshotBeforeUpdate(r.elementType===r.type?ge:Un(r.type,ge),ut);H.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var F=r.stateNode.containerInfo;F.nodeType===1?F.textContent="":F.nodeType===9&&F.documentElement&&F.removeChild(F.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(J){lt(r,r.return,J)}if(n=r.sibling,n!==null){n.return=r.return,fe=n;break}fe=r.return}return pe=vm,vm=!1,pe}function Ys(n,r,a){var f=r.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var p=f=f.next;do{if((p.tag&n)===n){var m=p.destroy;p.destroy=void 0,m!==void 0&&Fd(r,a,m)}p=p.next}while(p!==f)}}function Ll(n,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&n)===n){var f=a.create;a.destroy=f()}a=a.next}while(a!==r)}}function Ld(n){var r=n.ref;if(r!==null){var a=n.stateNode;switch(n.tag){case 5:n=a;break;default:n=a}typeof r=="function"?r(n):r.current=n}}function Im(n){var r=n.alternate;r!==null&&(n.alternate=null,Im(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&(delete r[Jn],delete r[bs],delete r[ed],delete r[DA],delete r[OA])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Sm(n){return n.tag===5||n.tag===3||n.tag===4}function Am(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Sm(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Ud(n,r,a){var f=n.tag;if(f===5||f===6)n=n.stateNode,r?a.nodeType===8?a.parentNode.insertBefore(n,r):a.insertBefore(n,r):(a.nodeType===8?(r=a.parentNode,r.insertBefore(n,a)):(r=a,r.appendChild(n)),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=gl));else if(f!==4&&(n=n.child,n!==null))for(Ud(n,r,a),n=n.sibling;n!==null;)Ud(n,r,a),n=n.sibling}function Gd(n,r,a){var f=n.tag;if(f===5||f===6)n=n.stateNode,r?a.insertBefore(n,r):a.appendChild(n);else if(f!==4&&(n=n.child,n!==null))for(Gd(n,r,a),n=n.sibling;n!==null;)Gd(n,r,a),n=n.sibling}var Ot=null,Gn=!1;function Zi(n,r,a){for(a=a.child;a!==null;)Tm(n,r,a),a=a.sibling}function Tm(n,r,a){if(Qn&&typeof Qn.onCommitFiberUnmount=="function")try{Qn.onCommitFiberUnmount(Ka,a)}catch{}switch(a.tag){case 5:Gt||kr(a,r);case 6:var f=Ot,p=Gn;Ot=null,Zi(n,r,a),Ot=f,Gn=p,Ot!==null&&(Gn?(n=Ot,a=a.stateNode,n.nodeType===8?n.parentNode.removeChild(a):n.removeChild(a)):Ot.removeChild(a.stateNode));break;case 18:Ot!==null&&(Gn?(n=Ot,a=a.stateNode,n.nodeType===8?Ju(n.parentNode,a):n.nodeType===1&&Ju(n,a),Ts(n)):Ju(Ot,a.stateNode));break;case 4:f=Ot,p=Gn,Ot=a.stateNode.containerInfo,Gn=!0,Zi(n,r,a),Ot=f,Gn=p;break;case 0:case 11:case 14:case 15:if(!Gt&&(f=a.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){p=f=f.next;do{var m=p,S=m.destroy;m=m.tag,S!==void 0&&((m&2)!==0||(m&4)!==0)&&Fd(a,r,S),p=p.next}while(p!==f)}Zi(n,r,a);break;case 1:if(!Gt&&(kr(a,r),f=a.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=a.memoizedProps,f.state=a.memoizedState,f.componentWillUnmount()}catch(P){lt(a,r,P)}Zi(n,r,a);break;case 21:Zi(n,r,a);break;case 22:a.mode&1?(Gt=(f=Gt)||a.memoizedState!==null,Zi(n,r,a),Gt=f):Zi(n,r,a);break;default:Zi(n,r,a)}}function Em(n){var r=n.updateQueue;if(r!==null){n.updateQueue=null;var a=n.stateNode;a===null&&(a=n.stateNode=new VA),r.forEach(function(f){var p=oT.bind(null,n,f);a.has(f)||(a.add(f),f.then(p,p))})}}function xn(n,r){var a=r.deletions;if(a!==null)for(var f=0;f<a.length;f++){var p=a[f];try{var m=n,S=r,P=S;e:for(;P!==null;){switch(P.tag){case 5:Ot=P.stateNode,Gn=!1;break e;case 3:Ot=P.stateNode.containerInfo,Gn=!0;break e;case 4:Ot=P.stateNode.containerInfo,Gn=!0;break e}P=P.return}if(Ot===null)throw Error(i(160));Tm(m,S,p),Ot=null,Gn=!1;var M=p.alternate;M!==null&&(M.return=null),p.return=null}catch(L){lt(p,r,L)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)wm(r,n),r=r.sibling}function wm(n,r){var a=n.alternate,f=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(xn(r,n),ni(n),f&4){try{Ys(3,n,n.return),Ll(3,n)}catch(ge){lt(n,n.return,ge)}try{Ys(5,n,n.return)}catch(ge){lt(n,n.return,ge)}}break;case 1:xn(r,n),ni(n),f&512&&a!==null&&kr(a,a.return);break;case 5:if(xn(r,n),ni(n),f&512&&a!==null&&kr(a,a.return),n.flags&32){var p=n.stateNode;try{ds(p,"")}catch(ge){lt(n,n.return,ge)}}if(f&4&&(p=n.stateNode,p!=null)){var m=n.memoizedProps,S=a!==null?a.memoizedProps:m,P=n.type,M=n.updateQueue;if(n.updateQueue=null,M!==null)try{P==="input"&&m.type==="radio"&&m.name!=null&&An(p,m),yu(P,S);var L=yu(P,m);for(S=0;S<M.length;S+=2){var j=M[S],K=M[S+1];j==="style"?sp(p,K):j==="dangerouslySetInnerHTML"?op(p,K):j==="children"?ds(p,K):w(p,j,K,L)}switch(P){case"input":en(p,m);break;case"textarea":tp(p,m);break;case"select":var Y=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!m.multiple;var le=m.value;le!=null?Fi(p,!!m.multiple,le,!1):Y!==!!m.multiple&&(m.defaultValue!=null?Fi(p,!!m.multiple,m.defaultValue,!0):Fi(p,!!m.multiple,m.multiple?[]:"",!1))}p[bs]=m}catch(ge){lt(n,n.return,ge)}}break;case 6:if(xn(r,n),ni(n),f&4){if(n.stateNode===null)throw Error(i(162));p=n.stateNode,m=n.memoizedProps;try{p.nodeValue=m}catch(ge){lt(n,n.return,ge)}}break;case 3:if(xn(r,n),ni(n),f&4&&a!==null&&a.memoizedState.isDehydrated)try{Ts(r.containerInfo)}catch(ge){lt(n,n.return,ge)}break;case 4:xn(r,n),ni(n);break;case 13:xn(r,n),ni(n),p=n.child,p.flags&8192&&(m=p.memoizedState!==null,p.stateNode.isHidden=m,!m||p.alternate!==null&&p.alternate.memoizedState!==null||(Wd=ct())),f&4&&Em(n);break;case 22:if(j=a!==null&&a.memoizedState!==null,n.mode&1?(Gt=(L=Gt)||j,xn(r,n),Gt=L):xn(r,n),ni(n),f&8192){if(L=n.memoizedState!==null,(n.stateNode.isHidden=L)&&!j&&(n.mode&1)!==0)for(fe=n,j=n.child;j!==null;){for(K=fe=j;fe!==null;){switch(Y=fe,le=Y.child,Y.tag){case 0:case 11:case 14:case 15:Ys(4,Y,Y.return);break;case 1:kr(Y,Y.return);var pe=Y.stateNode;if(typeof pe.componentWillUnmount=="function"){f=Y,a=Y.return;try{r=f,pe.props=r.memoizedProps,pe.state=r.memoizedState,pe.componentWillUnmount()}catch(ge){lt(f,a,ge)}}break;case 5:kr(Y,Y.return);break;case 22:if(Y.memoizedState!==null){Pm(K);continue}}le!==null?(le.return=Y,fe=le):Pm(K)}j=j.sibling}e:for(j=null,K=n;;){if(K.tag===5){if(j===null){j=K;try{p=K.stateNode,L?(m=p.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(P=K.stateNode,M=K.memoizedProps.style,S=M!=null&&M.hasOwnProperty("display")?M.display:null,P.style.display=rp("display",S))}catch(ge){lt(n,n.return,ge)}}}else if(K.tag===6){if(j===null)try{K.stateNode.nodeValue=L?"":K.memoizedProps}catch(ge){lt(n,n.return,ge)}}else if((K.tag!==22&&K.tag!==23||K.memoizedState===null||K===n)&&K.child!==null){K.child.return=K,K=K.child;continue}if(K===n)break e;for(;K.sibling===null;){if(K.return===null||K.return===n)break e;j===K&&(j=null),K=K.return}j===K&&(j=null),K.sibling.return=K.return,K=K.sibling}}break;case 19:xn(r,n),ni(n),f&4&&Em(n);break;case 21:break;default:xn(r,n),ni(n)}}function ni(n){var r=n.flags;if(r&2){try{e:{for(var a=n.return;a!==null;){if(Sm(a)){var f=a;break e}a=a.return}throw Error(i(160))}switch(f.tag){case 5:var p=f.stateNode;f.flags&32&&(ds(p,""),f.flags&=-33);var m=Am(n);Gd(n,m,p);break;case 3:case 4:var S=f.stateNode.containerInfo,P=Am(n);Ud(n,P,S);break;default:throw Error(i(161))}}catch(M){lt(n,n.return,M)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function ZA(n,r,a){fe=n,_m(n)}function _m(n,r,a){for(var f=(n.mode&1)!==0;fe!==null;){var p=fe,m=p.child;if(p.tag===22&&f){var S=p.memoizedState!==null||Fl;if(!S){var P=p.alternate,M=P!==null&&P.memoizedState!==null||Gt;P=Fl;var L=Gt;if(Fl=S,(Gt=M)&&!L)for(fe=p;fe!==null;)S=fe,M=S.child,S.tag===22&&S.memoizedState!==null?Rm(p):M!==null?(M.return=S,fe=M):Rm(p);for(;m!==null;)fe=m,_m(m),m=m.sibling;fe=p,Fl=P,Gt=L}Cm(n)}else(p.subtreeFlags&8772)!==0&&m!==null?(m.return=p,fe=m):Cm(n)}}function Cm(n){for(;fe!==null;){var r=fe;if((r.flags&8772)!==0){var a=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:Gt||Ll(5,r);break;case 1:var f=r.stateNode;if(r.flags&4&&!Gt)if(a===null)f.componentDidMount();else{var p=r.elementType===r.type?a.memoizedProps:Un(r.type,a.memoizedProps);f.componentDidUpdate(p,a.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var m=r.updateQueue;m!==null&&Pg(r,m,f);break;case 3:var S=r.updateQueue;if(S!==null){if(a=null,r.child!==null)switch(r.child.tag){case 5:a=r.child.stateNode;break;case 1:a=r.child.stateNode}Pg(r,S,a)}break;case 5:var P=r.stateNode;if(a===null&&r.flags&4){a=P;var M=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":M.autoFocus&&a.focus();break;case"img":M.src&&(a.src=M.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var L=r.alternate;if(L!==null){var j=L.memoizedState;if(j!==null){var K=j.dehydrated;K!==null&&Ts(K)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Gt||r.flags&512&&Ld(r)}catch(Y){lt(r,r.return,Y)}}if(r===n){fe=null;break}if(a=r.sibling,a!==null){a.return=r.return,fe=a;break}fe=r.return}}function Pm(n){for(;fe!==null;){var r=fe;if(r===n){fe=null;break}var a=r.sibling;if(a!==null){a.return=r.return,fe=a;break}fe=r.return}}function Rm(n){for(;fe!==null;){var r=fe;try{switch(r.tag){case 0:case 11:case 15:var a=r.return;try{Ll(4,r)}catch(M){lt(r,a,M)}break;case 1:var f=r.stateNode;if(typeof f.componentDidMount=="function"){var p=r.return;try{f.componentDidMount()}catch(M){lt(r,p,M)}}var m=r.return;try{Ld(r)}catch(M){lt(r,m,M)}break;case 5:var S=r.return;try{Ld(r)}catch(M){lt(r,S,M)}}}catch(M){lt(r,r.return,M)}if(r===n){fe=null;break}var P=r.sibling;if(P!==null){P.return=r.return,fe=P;break}fe=r.return}}var KA=Math.ceil,Ul=R.ReactCurrentDispatcher,xd=R.ReactCurrentOwner,Pn=R.ReactCurrentBatchConfig,Fe=0,_t=null,ht=null,bt=0,pn=0,Dr=zi(0),vt=0,zs=null,Oo=0,Gl=0,$d=0,js=null,rn=null,Wd=0,Or=1/0,vi=null,xl=!1,Yd=null,Ki=null,$l=!1,Qi=null,Wl=0,Xs=0,zd=null,Yl=-1,zl=0;function Xt(){return(Fe&6)!==0?ct():Yl!==-1?Yl:Yl=ct()}function Ji(n){return(n.mode&1)===0?1:(Fe&2)!==0&&bt!==0?bt&-bt:NA.transition!==null?(zl===0&&(zl=Ap()),zl):(n=We,n!==0||(n=window.event,n=n===void 0?16:kp(n.type)),n)}function $n(n,r,a,f){if(50<Xs)throw Xs=0,zd=null,Error(i(185));ys(n,a,f),((Fe&2)===0||n!==_t)&&(n===_t&&((Fe&2)===0&&(Gl|=a),vt===4&&eo(n,bt)),sn(n,f),a===1&&Fe===0&&(r.mode&1)===0&&(Or=ct()+500,Il&&Xi()))}function sn(n,r){var a=n.callbackNode;NS(n,r);var f=el(n,n===_t?bt:0);if(f===0)a!==null&&vp(a),n.callbackNode=null,n.callbackPriority=0;else if(r=f&-f,n.callbackPriority!==r){if(a!=null&&vp(a),r===1)n.tag===0?bA(km.bind(null,n)):gg(km.bind(null,n)),MA(function(){(Fe&6)===0&&Xi()}),a=null;else{switch(Tp(f)){case 1:a=wu;break;case 4:a=Ip;break;case 16:a=Za;break;case 536870912:a=Sp;break;default:a=Za}a=Lm(a,Mm.bind(null,n))}n.callbackPriority=r,n.callbackNode=a}}function Mm(n,r){if(Yl=-1,zl=0,(Fe&6)!==0)throw Error(i(327));var a=n.callbackNode;if(br()&&n.callbackNode!==a)return null;var f=el(n,n===_t?bt:0);if(f===0)return null;if((f&30)!==0||(f&n.expiredLanes)!==0||r)r=jl(n,f);else{r=f;var p=Fe;Fe|=2;var m=Om();(_t!==n||bt!==r)&&(vi=null,Or=ct()+500,No(n,r));do try{eT();break}catch(P){Dm(n,P)}while(!0);cd(),Ul.current=m,Fe=p,ht!==null?r=0:(_t=null,bt=0,r=vt)}if(r!==0){if(r===2&&(p=_u(n),p!==0&&(f=p,r=jd(n,p))),r===1)throw a=zs,No(n,0),eo(n,f),sn(n,ct()),a;if(r===6)eo(n,f);else{if(p=n.current.alternate,(f&30)===0&&!QA(p)&&(r=jl(n,f),r===2&&(m=_u(n),m!==0&&(f=m,r=jd(n,m))),r===1))throw a=zs,No(n,0),eo(n,f),sn(n,ct()),a;switch(n.finishedWork=p,n.finishedLanes=f,r){case 0:case 1:throw Error(i(345));case 2:Bo(n,rn,vi);break;case 3:if(eo(n,f),(f&130023424)===f&&(r=Wd+500-ct(),10<r)){if(el(n,0)!==0)break;if(p=n.suspendedLanes,(p&f)!==f){Xt(),n.pingedLanes|=n.suspendedLanes&p;break}n.timeoutHandle=Qu(Bo.bind(null,n,rn,vi),r);break}Bo(n,rn,vi);break;case 4:if(eo(n,f),(f&4194240)===f)break;for(r=n.eventTimes,p=-1;0<f;){var S=31-Hn(f);m=1<<S,S=r[S],S>p&&(p=S),f&=~m}if(f=p,f=ct()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*KA(f/1960))-f,10<f){n.timeoutHandle=Qu(Bo.bind(null,n,rn,vi),f);break}Bo(n,rn,vi);break;case 5:Bo(n,rn,vi);break;default:throw Error(i(329))}}}return sn(n,ct()),n.callbackNode===a?Mm.bind(null,n):null}function jd(n,r){var a=js;return n.current.memoizedState.isDehydrated&&(No(n,r).flags|=256),n=jl(n,r),n!==2&&(r=rn,rn=a,r!==null&&Xd(r)),n}function Xd(n){rn===null?rn=n:rn.push.apply(rn,n)}function QA(n){for(var r=n;;){if(r.flags&16384){var a=r.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var f=0;f<a.length;f++){var p=a[f],m=p.getSnapshot;p=p.value;try{if(!Fn(m(),p))return!1}catch{return!1}}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function eo(n,r){for(r&=~$d,r&=~Gl,n.suspendedLanes|=r,n.pingedLanes&=~r,n=n.expirationTimes;0<r;){var a=31-Hn(r),f=1<<a;n[a]=-1,r&=~f}}function km(n){if((Fe&6)!==0)throw Error(i(327));br();var r=el(n,0);if((r&1)===0)return sn(n,ct()),null;var a=jl(n,r);if(n.tag!==0&&a===2){var f=_u(n);f!==0&&(r=f,a=jd(n,f))}if(a===1)throw a=zs,No(n,0),eo(n,r),sn(n,ct()),a;if(a===6)throw Error(i(345));return n.finishedWork=n.current.alternate,n.finishedLanes=r,Bo(n,rn,vi),sn(n,ct()),null}function Vd(n,r){var a=Fe;Fe|=1;try{return n(r)}finally{Fe=a,Fe===0&&(Or=ct()+500,Il&&Xi())}}function bo(n){Qi!==null&&Qi.tag===0&&(Fe&6)===0&&br();var r=Fe;Fe|=1;var a=Pn.transition,f=We;try{if(Pn.transition=null,We=1,n)return n()}finally{We=f,Pn.transition=a,Fe=r,(Fe&6)===0&&Xi()}}function qd(){pn=Dr.current,et(Dr)}function No(n,r){n.finishedWork=null,n.finishedLanes=0;var a=n.timeoutHandle;if(a!==-1&&(n.timeoutHandle=-1,RA(a)),ht!==null)for(a=ht.return;a!==null;){var f=a;switch(od(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&yl();break;case 3:Rr(),et(tn),et(Ft),yd();break;case 5:gd(f);break;case 4:Rr();break;case 13:et(rt);break;case 19:et(rt);break;case 10:ud(f.type._context);break;case 22:case 23:qd()}a=a.return}if(_t=n,ht=n=to(n.current,null),bt=pn=r,vt=0,zs=null,$d=Gl=Oo=0,rn=js=null,Mo!==null){for(r=0;r<Mo.length;r++)if(a=Mo[r],f=a.interleaved,f!==null){a.interleaved=null;var p=f.next,m=a.pending;if(m!==null){var S=m.next;m.next=p,f.next=S}a.pending=f}Mo=null}return n}function Dm(n,r){do{var a=ht;try{if(cd(),Ml.current=bl,kl){for(var f=st.memoizedState;f!==null;){var p=f.queue;p!==null&&(p.pending=null),f=f.next}kl=!1}if(Do=0,wt=yt=st=null,Us=!1,Gs=0,xd.current=null,a===null||a.return===null){vt=1,zs=r,ht=null;break}e:{var m=n,S=a.return,P=a,M=r;if(r=bt,P.flags|=32768,M!==null&&typeof M=="object"&&typeof M.then=="function"){var L=M,j=P,K=j.tag;if((j.mode&1)===0&&(K===0||K===11||K===15)){var Y=j.alternate;Y?(j.updateQueue=Y.updateQueue,j.memoizedState=Y.memoizedState,j.lanes=Y.lanes):(j.updateQueue=null,j.memoizedState=null)}var le=nm(S);if(le!==null){le.flags&=-257,im(le,S,P,m,r),le.mode&1&&tm(m,L,r),r=le,M=L;var pe=r.updateQueue;if(pe===null){var ge=new Set;ge.add(M),r.updateQueue=ge}else pe.add(M);break e}else{if((r&1)===0){tm(m,L,r),Zd();break e}M=Error(i(426))}}else if(it&&P.mode&1){var ut=nm(S);if(ut!==null){(ut.flags&65536)===0&&(ut.flags|=256),im(ut,S,P,m,r),ad(Mr(M,P));break e}}m=M=Mr(M,P),vt!==4&&(vt=2),js===null?js=[m]:js.push(m),m=S;do{switch(m.tag){case 3:m.flags|=65536,r&=-r,m.lanes|=r;var H=Jg(m,M,r);Cg(m,H);break e;case 1:P=M;var b=m.type,F=m.stateNode;if((m.flags&128)===0&&(typeof b.getDerivedStateFromError=="function"||F!==null&&typeof F.componentDidCatch=="function"&&(Ki===null||!Ki.has(F)))){m.flags|=65536,r&=-r,m.lanes|=r;var J=em(m,P,r);Cg(m,J);break e}}m=m.return}while(m!==null)}Nm(a)}catch(ve){r=ve,ht===a&&a!==null&&(ht=a=a.return);continue}break}while(!0)}function Om(){var n=Ul.current;return Ul.current=bl,n===null?bl:n}function Zd(){(vt===0||vt===3||vt===2)&&(vt=4),_t===null||(Oo&268435455)===0&&(Gl&268435455)===0||eo(_t,bt)}function jl(n,r){var a=Fe;Fe|=2;var f=Om();(_t!==n||bt!==r)&&(vi=null,No(n,r));do try{JA();break}catch(p){Dm(n,p)}while(!0);if(cd(),Fe=a,Ul.current=f,ht!==null)throw Error(i(261));return _t=null,bt=0,vt}function JA(){for(;ht!==null;)bm(ht)}function eT(){for(;ht!==null&&!_S();)bm(ht)}function bm(n){var r=Fm(n.alternate,n,pn);n.memoizedProps=n.pendingProps,r===null?Nm(n):ht=r,xd.current=null}function Nm(n){var r=n;do{var a=r.alternate;if(n=r.return,(r.flags&32768)===0){if(a=jA(a,r,pn),a!==null){ht=a;return}}else{if(a=XA(a,r),a!==null){a.flags&=32767,ht=a;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{vt=6,ht=null;return}}if(r=r.sibling,r!==null){ht=r;return}ht=r=n}while(r!==null);vt===0&&(vt=5)}function Bo(n,r,a){var f=We,p=Pn.transition;try{Pn.transition=null,We=1,tT(n,r,a,f)}finally{Pn.transition=p,We=f}return null}function tT(n,r,a,f){do br();while(Qi!==null);if((Fe&6)!==0)throw Error(i(327));a=n.finishedWork;var p=n.finishedLanes;if(a===null)return null;if(n.finishedWork=null,n.finishedLanes=0,a===n.current)throw Error(i(177));n.callbackNode=null,n.callbackPriority=0;var m=a.lanes|a.childLanes;if(BS(n,m),n===_t&&(ht=_t=null,bt=0),(a.subtreeFlags&2064)===0&&(a.flags&2064)===0||$l||($l=!0,Lm(Za,function(){return br(),null})),m=(a.flags&15990)!==0,(a.subtreeFlags&15990)!==0||m){m=Pn.transition,Pn.transition=null;var S=We;We=1;var P=Fe;Fe|=4,xd.current=null,qA(n,a),wm(a,n),AA(Zu),il=!!qu,Zu=qu=null,n.current=a,ZA(a),CS(),Fe=P,We=S,Pn.transition=m}else n.current=a;if($l&&($l=!1,Qi=n,Wl=p),m=n.pendingLanes,m===0&&(Ki=null),MS(a.stateNode),sn(n,ct()),r!==null)for(f=n.onRecoverableError,a=0;a<r.length;a++)p=r[a],f(p.value,{componentStack:p.stack,digest:p.digest});if(xl)throw xl=!1,n=Yd,Yd=null,n;return(Wl&1)!==0&&n.tag!==0&&br(),m=n.pendingLanes,(m&1)!==0?n===zd?Xs++:(Xs=0,zd=n):Xs=0,Xi(),null}function br(){if(Qi!==null){var n=Tp(Wl),r=Pn.transition,a=We;try{if(Pn.transition=null,We=16>n?16:n,Qi===null)var f=!1;else{if(n=Qi,Qi=null,Wl=0,(Fe&6)!==0)throw Error(i(331));var p=Fe;for(Fe|=4,fe=n.current;fe!==null;){var m=fe,S=m.child;if((fe.flags&16)!==0){var P=m.deletions;if(P!==null){for(var M=0;M<P.length;M++){var L=P[M];for(fe=L;fe!==null;){var j=fe;switch(j.tag){case 0:case 11:case 15:Ys(8,j,m)}var K=j.child;if(K!==null)K.return=j,fe=K;else for(;fe!==null;){j=fe;var Y=j.sibling,le=j.return;if(Im(j),j===L){fe=null;break}if(Y!==null){Y.return=le,fe=Y;break}fe=le}}}var pe=m.alternate;if(pe!==null){var ge=pe.child;if(ge!==null){pe.child=null;do{var ut=ge.sibling;ge.sibling=null,ge=ut}while(ge!==null)}}fe=m}}if((m.subtreeFlags&2064)!==0&&S!==null)S.return=m,fe=S;else e:for(;fe!==null;){if(m=fe,(m.flags&2048)!==0)switch(m.tag){case 0:case 11:case 15:Ys(9,m,m.return)}var H=m.sibling;if(H!==null){H.return=m.return,fe=H;break e}fe=m.return}}var b=n.current;for(fe=b;fe!==null;){S=fe;var F=S.child;if((S.subtreeFlags&2064)!==0&&F!==null)F.return=S,fe=F;else e:for(S=b;fe!==null;){if(P=fe,(P.flags&2048)!==0)try{switch(P.tag){case 0:case 11:case 15:Ll(9,P)}}catch(ve){lt(P,P.return,ve)}if(P===S){fe=null;break e}var J=P.sibling;if(J!==null){J.return=P.return,fe=J;break e}fe=P.return}}if(Fe=p,Xi(),Qn&&typeof Qn.onPostCommitFiberRoot=="function")try{Qn.onPostCommitFiberRoot(Ka,n)}catch{}f=!0}return f}finally{We=a,Pn.transition=r}}return!1}function Bm(n,r,a){r=Mr(a,r),r=Jg(n,r,1),n=qi(n,r,1),r=Xt(),n!==null&&(ys(n,1,r),sn(n,r))}function lt(n,r,a){if(n.tag===3)Bm(n,n,a);else for(;r!==null;){if(r.tag===3){Bm(r,n,a);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(Ki===null||!Ki.has(f))){n=Mr(a,n),n=em(r,n,1),r=qi(r,n,1),n=Xt(),r!==null&&(ys(r,1,n),sn(r,n));break}}r=r.return}}function nT(n,r,a){var f=n.pingCache;f!==null&&f.delete(r),r=Xt(),n.pingedLanes|=n.suspendedLanes&a,_t===n&&(bt&a)===a&&(vt===4||vt===3&&(bt&130023424)===bt&&500>ct()-Wd?No(n,0):$d|=a),sn(n,r)}function Hm(n,r){r===0&&((n.mode&1)===0?r=1:(r=Ja,Ja<<=1,(Ja&130023424)===0&&(Ja=4194304)));var a=Xt();n=gi(n,r),n!==null&&(ys(n,r,a),sn(n,a))}function iT(n){var r=n.memoizedState,a=0;r!==null&&(a=r.retryLane),Hm(n,a)}function oT(n,r){var a=0;switch(n.tag){case 13:var f=n.stateNode,p=n.memoizedState;p!==null&&(a=p.retryLane);break;case 19:f=n.stateNode;break;default:throw Error(i(314))}f!==null&&f.delete(r),Hm(n,a)}var Fm;Fm=function(n,r,a){if(n!==null)if(n.memoizedProps!==r.pendingProps||tn.current)on=!0;else{if((n.lanes&a)===0&&(r.flags&128)===0)return on=!1,zA(n,r,a);on=(n.flags&131072)!==0}else on=!1,it&&(r.flags&1048576)!==0&&mg(r,Al,r.index);switch(r.lanes=0,r.tag){case 2:var f=r.type;Hl(n,r),n=r.pendingProps;var p=Ar(r,Ft.current);Pr(r,a),p=Sd(null,r,f,n,p,a);var m=Ad();return r.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,nn(f)?(m=!0,vl(r)):m=!1,r.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,hd(r),p.updater=Nl,r.stateNode=p,p._reactInternals=r,Pd(r,f,n,a),r=Dd(null,r,f,!0,m,a)):(r.tag=0,it&&m&&id(r),jt(null,r,p,a),r=r.child),r;case 16:f=r.elementType;e:{switch(Hl(n,r),n=r.pendingProps,p=f._init,f=p(f._payload),r.type=f,p=r.tag=sT(f),n=Un(f,n),p){case 0:r=kd(null,r,f,n,a);break e;case 1:r=cm(null,r,f,n,a);break e;case 11:r=om(null,r,f,n,a);break e;case 14:r=rm(null,r,f,Un(f.type,n),a);break e}throw Error(i(306,f,""))}return r;case 0:return f=r.type,p=r.pendingProps,p=r.elementType===f?p:Un(f,p),kd(n,r,f,p,a);case 1:return f=r.type,p=r.pendingProps,p=r.elementType===f?p:Un(f,p),cm(n,r,f,p,a);case 3:e:{if(um(r),n===null)throw Error(i(387));f=r.pendingProps,m=r.memoizedState,p=m.element,_g(n,r),Pl(r,f,null,a);var S=r.memoizedState;if(f=S.element,m.isDehydrated)if(m={element:f,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},r.updateQueue.baseState=m,r.memoizedState=m,r.flags&256){p=Mr(Error(i(423)),r),r=dm(n,r,f,a,p);break e}else if(f!==p){p=Mr(Error(i(424)),r),r=dm(n,r,f,a,p);break e}else for(hn=Yi(r.stateNode.containerInfo.firstChild),fn=r,it=!0,Ln=null,a=Eg(r,null,f,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(wr(),f===p){r=yi(n,r,a);break e}jt(n,r,f,a)}r=r.child}return r;case 5:return Rg(r),n===null&&sd(r),f=r.type,p=r.pendingProps,m=n!==null?n.memoizedProps:null,S=p.children,Ku(f,p)?S=null:m!==null&&Ku(f,m)&&(r.flags|=32),lm(n,r),jt(n,r,S,a),r.child;case 6:return n===null&&sd(r),null;case 13:return fm(n,r,a);case 4:return pd(r,r.stateNode.containerInfo),f=r.pendingProps,n===null?r.child=_r(r,null,f,a):jt(n,r,f,a),r.child;case 11:return f=r.type,p=r.pendingProps,p=r.elementType===f?p:Un(f,p),om(n,r,f,p,a);case 7:return jt(n,r,r.pendingProps,a),r.child;case 8:return jt(n,r,r.pendingProps.children,a),r.child;case 12:return jt(n,r,r.pendingProps.children,a),r.child;case 10:e:{if(f=r.type._context,p=r.pendingProps,m=r.memoizedProps,S=p.value,Qe(wl,f._currentValue),f._currentValue=S,m!==null)if(Fn(m.value,S)){if(m.children===p.children&&!tn.current){r=yi(n,r,a);break e}}else for(m=r.child,m!==null&&(m.return=r);m!==null;){var P=m.dependencies;if(P!==null){S=m.child;for(var M=P.firstContext;M!==null;){if(M.context===f){if(m.tag===1){M=mi(-1,a&-a),M.tag=2;var L=m.updateQueue;if(L!==null){L=L.shared;var j=L.pending;j===null?M.next=M:(M.next=j.next,j.next=M),L.pending=M}}m.lanes|=a,M=m.alternate,M!==null&&(M.lanes|=a),dd(m.return,a,r),P.lanes|=a;break}M=M.next}}else if(m.tag===10)S=m.type===r.type?null:m.child;else if(m.tag===18){if(S=m.return,S===null)throw Error(i(341));S.lanes|=a,P=S.alternate,P!==null&&(P.lanes|=a),dd(S,a,r),S=m.sibling}else S=m.child;if(S!==null)S.return=m;else for(S=m;S!==null;){if(S===r){S=null;break}if(m=S.sibling,m!==null){m.return=S.return,S=m;break}S=S.return}m=S}jt(n,r,p.children,a),r=r.child}return r;case 9:return p=r.type,f=r.pendingProps.children,Pr(r,a),p=_n(p),f=f(p),r.flags|=1,jt(n,r,f,a),r.child;case 14:return f=r.type,p=Un(f,r.pendingProps),p=Un(f.type,p),rm(n,r,f,p,a);case 15:return sm(n,r,r.type,r.pendingProps,a);case 17:return f=r.type,p=r.pendingProps,p=r.elementType===f?p:Un(f,p),Hl(n,r),r.tag=1,nn(f)?(n=!0,vl(r)):n=!1,Pr(r,a),Kg(r,f,p),Pd(r,f,p,a),Dd(null,r,f,!0,n,a);case 19:return pm(n,r,a);case 22:return am(n,r,a)}throw Error(i(156,r.tag))};function Lm(n,r){return yp(n,r)}function rT(n,r,a,f){this.tag=n,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rn(n,r,a,f){return new rT(n,r,a,f)}function Kd(n){return n=n.prototype,!(!n||!n.isReactComponent)}function sT(n){if(typeof n=="function")return Kd(n)?1:0;if(n!=null){if(n=n.$$typeof,n===q)return 11;if(n===ne)return 14}return 2}function to(n,r){var a=n.alternate;return a===null?(a=Rn(n.tag,r,n.key,n.mode),a.elementType=n.elementType,a.type=n.type,a.stateNode=n.stateNode,a.alternate=n,n.alternate=a):(a.pendingProps=r,a.type=n.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=n.flags&14680064,a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,r=n.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=n.sibling,a.index=n.index,a.ref=n.ref,a}function Xl(n,r,a,f,p,m){var S=2;if(f=n,typeof n=="function")Kd(n)&&(S=1);else if(typeof n=="string")S=5;else e:switch(n){case B:return Ho(a.children,p,m,r);case G:S=8,p|=8;break;case $:return n=Rn(12,a,r,p|2),n.elementType=$,n.lanes=m,n;case re:return n=Rn(13,a,r,p),n.elementType=re,n.lanes=m,n;case ee:return n=Rn(19,a,r,p),n.elementType=ee,n.lanes=m,n;case te:return Vl(a,p,m,r);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case V:S=10;break e;case X:S=9;break e;case q:S=11;break e;case ne:S=14;break e;case oe:S=16,f=null;break e}throw Error(i(130,n==null?n:typeof n,""))}return r=Rn(S,a,r,p),r.elementType=n,r.type=f,r.lanes=m,r}function Ho(n,r,a,f){return n=Rn(7,n,f,r),n.lanes=a,n}function Vl(n,r,a,f){return n=Rn(22,n,f,r),n.elementType=te,n.lanes=a,n.stateNode={isHidden:!1},n}function Qd(n,r,a){return n=Rn(6,n,null,r),n.lanes=a,n}function Jd(n,r,a){return r=Rn(4,n.children!==null?n.children:[],n.key,r),r.lanes=a,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}function aT(n,r,a,f,p){this.tag=r,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Cu(0),this.expirationTimes=Cu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Cu(0),this.identifierPrefix=f,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function ef(n,r,a,f,p,m,S,P,M){return n=new aT(n,r,a,P,M),r===1?(r=1,m===!0&&(r|=8)):r=0,m=Rn(3,null,null,r),n.current=m,m.stateNode=n,m.memoizedState={element:f,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},hd(m),n}function lT(n,r,a){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:f==null?null:""+f,children:n,containerInfo:r,implementation:a}}function Um(n){if(!n)return ji;n=n._reactInternals;e:{if(wo(n)!==n||n.tag!==1)throw Error(i(170));var r=n;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(nn(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(i(171))}if(n.tag===1){var a=n.type;if(nn(a))return hg(n,a,r)}return r}function Gm(n,r,a,f,p,m,S,P,M){return n=ef(a,f,!0,n,p,m,S,P,M),n.context=Um(null),a=n.current,f=Xt(),p=Ji(a),m=mi(f,p),m.callback=r??null,qi(a,m,p),n.current.lanes=p,ys(n,p,f),sn(n,f),n}function ql(n,r,a,f){var p=r.current,m=Xt(),S=Ji(p);return a=Um(a),r.context===null?r.context=a:r.pendingContext=a,r=mi(m,S),r.payload={element:n},f=f===void 0?null:f,f!==null&&(r.callback=f),n=qi(p,r,S),n!==null&&($n(n,p,S,m),Cl(n,p,S)),S}function Zl(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function xm(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var a=n.retryLane;n.retryLane=a!==0&&a<r?a:r}}function tf(n,r){xm(n,r),(n=n.alternate)&&xm(n,r)}function cT(){return null}var $m=typeof reportError=="function"?reportError:function(n){console.error(n)};function nf(n){this._internalRoot=n}Kl.prototype.render=nf.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error(i(409));ql(n,r,null,null)},Kl.prototype.unmount=nf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;bo(function(){ql(null,n,null,null)}),r[di]=null}};function Kl(n){this._internalRoot=n}Kl.prototype.unstable_scheduleHydration=function(n){if(n){var r=_p();n={blockedOn:null,target:n,priority:r};for(var a=0;a<xi.length&&r!==0&&r<xi[a].priority;a++);xi.splice(a,0,n),a===0&&Rp(n)}};function of(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Ql(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function Wm(){}function uT(n,r,a,f,p){if(p){if(typeof f=="function"){var m=f;f=function(){var L=Zl(S);m.call(L)}}var S=Gm(r,f,n,0,null,!1,!1,"",Wm);return n._reactRootContainer=S,n[di]=S.current,Ds(n.nodeType===8?n.parentNode:n),bo(),S}for(;p=n.lastChild;)n.removeChild(p);if(typeof f=="function"){var P=f;f=function(){var L=Zl(M);P.call(L)}}var M=ef(n,0,!1,null,null,!1,!1,"",Wm);return n._reactRootContainer=M,n[di]=M.current,Ds(n.nodeType===8?n.parentNode:n),bo(function(){ql(r,M,a,f)}),M}function Jl(n,r,a,f,p){var m=a._reactRootContainer;if(m){var S=m;if(typeof p=="function"){var P=p;p=function(){var M=Zl(S);P.call(M)}}ql(r,S,n,p)}else S=uT(a,r,n,p,f);return Zl(S)}Ep=function(n){switch(n.tag){case 3:var r=n.stateNode;if(r.current.memoizedState.isDehydrated){var a=ms(r.pendingLanes);a!==0&&(Pu(r,a|1),sn(r,ct()),(Fe&6)===0&&(Or=ct()+500,Xi()))}break;case 13:bo(function(){var f=gi(n,1);if(f!==null){var p=Xt();$n(f,n,1,p)}}),tf(n,1)}},Ru=function(n){if(n.tag===13){var r=gi(n,134217728);if(r!==null){var a=Xt();$n(r,n,134217728,a)}tf(n,134217728)}},wp=function(n){if(n.tag===13){var r=Ji(n),a=gi(n,r);if(a!==null){var f=Xt();$n(a,n,r,f)}tf(n,r)}},_p=function(){return We},Cp=function(n,r){var a=We;try{return We=n,r()}finally{We=a}},Su=function(n,r,a){switch(r){case"input":if(en(n,a),r=a.name,a.type==="radio"&&r!=null){for(a=n;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<a.length;r++){var f=a[r];if(f!==n&&f.form===n.form){var p=ml(f);if(!p)throw Error(i(90));Ae(f),en(f,p)}}}break;case"textarea":tp(n,a);break;case"select":r=a.value,r!=null&&Fi(n,!!a.multiple,r,!1)}},up=Vd,dp=bo;var dT={usingClientEntryPoint:!1,Events:[Ns,Ir,ml,lp,cp,Vd]},Vs={findFiberByHostInstance:_o,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},fT={bundleType:Vs.bundleType,version:Vs.version,rendererPackageName:Vs.rendererPackageName,rendererConfig:Vs.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:R.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=gp(n),n===null?null:n.stateNode},findFiberByHostInstance:Vs.findFiberByHostInstance||cT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ec=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ec.isDisabled&&ec.supportsFiber)try{Ka=ec.inject(fT),Qn=ec}catch{}}return an.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dT,an.createPortal=function(n,r){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!of(r))throw Error(i(200));return lT(n,r,null,a)},an.createRoot=function(n,r){if(!of(n))throw Error(i(299));var a=!1,f="",p=$m;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),r=ef(n,1,!1,null,null,a,!1,f,p),n[di]=r.current,Ds(n.nodeType===8?n.parentNode:n),new nf(r)},an.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=gp(r),n=n===null?null:n.stateNode,n},an.flushSync=function(n){return bo(n)},an.hydrate=function(n,r,a){if(!Ql(r))throw Error(i(200));return Jl(null,n,r,!0,a)},an.hydrateRoot=function(n,r,a){if(!of(n))throw Error(i(405));var f=a!=null&&a.hydratedSources||null,p=!1,m="",S=$m;if(a!=null&&(a.unstable_strictMode===!0&&(p=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onRecoverableError!==void 0&&(S=a.onRecoverableError)),r=Gm(r,null,n,1,a??null,p,!1,m,S),n[di]=r.current,Ds(n),f)for(n=0;n<f.length;n++)a=f[n],p=a._getVersion,p=p(a._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[a,p]:r.mutableSourceEagerHydrationData.push(a,p);return new Kl(r)},an.render=function(n,r,a){if(!Ql(r))throw Error(i(200));return Jl(null,n,r,!1,a)},an.unmountComponentAtNode=function(n){if(!Ql(n))throw Error(i(40));return n._reactRootContainer?(bo(function(){Jl(null,null,n,!1,function(){n._reactRootContainer=null,n[di]=null})}),!0):!1},an.unstable_batchedUpdates=Vd,an.unstable_renderSubtreeIntoContainer=function(n,r,a,f){if(!Ql(a))throw Error(i(200));if(n==null||n._reactInternals===void 0)throw Error(i(38));return Jl(n,r,a,!1,f)},an.version="18.3.1-next-f1338f8080-20240426",an}var Km;function TT(){if(Km)return af.exports;Km=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),af.exports=AT(),af.exports}var Qm;function ET(){if(Qm)return tc;Qm=1;var e=TT();return tc.createRoot=e.createRoot,tc.hydrateRoot=e.hydrateRoot,tc}var wT=ET();const _T=Fy(wT);class CT{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,i){let o=this.length++;for(;o>0;){const s=o-1>>1,l=this.values[s];if(i>=l)break;this.ids[o]=this.ids[s],this.values[o]=l,o=s}this.ids[o]=t,this.values[o]=i}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const i=this.ids[0]=this.ids[this.length],o=this.values[0]=this.values[this.length],s=this.length>>1;let l=0;for(;l<s;){let c=(l<<1)+1;const d=c+1;let u=this.ids[c],h=this.values[c];const g=this.values[d];if(d<this.length&&g<h&&(c=d,u=this.ids[d],h=g),h>=o)break;this.ids[l]=u,this.values[l]=h,l=c}this.ids[l]=i,this.values[l]=o}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Jm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],uf=3;class uh{static from(t,i=0){if(i%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[o,s]=new Uint8Array(t,i+0,2);if(o!==251)throw new Error("Data does not appear to be in a Flatbush format.");const l=s>>4;if(l!==uf)throw new Error(`Got v${l} data when expected v${uf}.`);const c=Jm[s&15];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,i+2,1),[u]=new Uint32Array(t,i+4,1);return new uh(u,d,c,void 0,t,i)}constructor(t,i=16,o=Float64Array,s=ArrayBuffer,l,c=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.byteOffset=c;let d=t,u=d;this._levelBounds=[d*4];do d=Math.ceil(d/this.nodeSize),u+=d,this._levelBounds.push(u*4);while(d!==1);this.ArrayType=o,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const h=Jm.indexOf(this.ArrayType),g=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l.byteLength!==void 0&&!l.buffer?(this.data=l,this._boxes=new this.ArrayType(this.data,c+8,u*4),this._indices=new this.IndexArrayType(this.data,c+8+g,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+g+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+g,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(uf<<4)+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t),this._queue=new CT}add(t,i,o=t,s=i){const l=this._pos>>2,c=this._boxes;return this._indices[l]=l,c[this._pos++]=t,c[this._pos++]=i,c[this._pos++]=o,c[this._pos++]=s,t<this.minX&&(this.minX=t),i<this.minY&&(this.minY=i),o>this.maxX&&(this.maxX=o),s>this.maxY&&(this.maxY=s),l}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const i=this.maxX-this.minX||1,o=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),l=65535;for(let c=0,d=0;c<this.numItems;c++){const u=t[d++],h=t[d++],g=t[d++],y=t[d++],I=Math.floor(l*((u+g)/2-this.minX)/i),v=Math.floor(l*((h+y)/2-this.minY)/o);s[c]=RT(I,v)}xf(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let c=0,d=0;c<this._levelBounds.length-1;c++){const u=this._levelBounds[c];for(;d<u;){const h=d;let g=t[d++],y=t[d++],I=t[d++],v=t[d++];for(let T=1;T<this.nodeSize&&d<u;T++)g=Math.min(g,t[d++]),y=Math.min(y,t[d++]),I=Math.max(I,t[d++]),v=Math.max(v,t[d++]);this._indices[this._pos>>2]=h,t[this._pos++]=g,t[this._pos++]=y,t[this._pos++]=I,t[this._pos++]=v}}}search(t,i,o,s,l){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let c=this._boxes.length-4;const d=[],u=[];for(;c!==void 0;){const h=Math.min(c+this.nodeSize*4,t0(c,this._levelBounds));for(let g=c;g<h;g+=4){if(o<this._boxes[g]||s<this._boxes[g+1]||t>this._boxes[g+2]||i>this._boxes[g+3])continue;const y=this._indices[g>>2]|0;c>=this.numItems*4?d.push(y):(l===void 0||l(y))&&u.push(y)}c=d.pop()}return u}neighbors(t,i,o=1/0,s=1/0,l){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let c=this._boxes.length-4;const d=this._queue,u=[],h=s*s;e:for(;c!==void 0;){const g=Math.min(c+this.nodeSize*4,t0(c,this._levelBounds));for(let y=c;y<g;y+=4){const I=this._indices[y>>2]|0,v=e0(t,this._boxes[y],this._boxes[y+2]),T=e0(i,this._boxes[y+1],this._boxes[y+3]),A=v*v+T*T;A>h||(c>=this.numItems*4?d.push(I<<1,A):(l===void 0||l(I))&&d.push((I<<1)+1,A))}for(;d.length&&d.peek()&1;)if(d.peekValue()>h||(u.push(d.pop()>>1),u.length===o))break e;c=d.length?d.pop()>>1:void 0}return d.clear(),u}}function e0(e,t,i){return e<t?t-e:e<=i?0:e-i}function t0(e,t){let i=0,o=t.length-1;for(;i<o;){const s=i+o>>1;t[s]>e?o=s:i=s+1}return t[i]}function xf(e,t,i,o,s,l){if(Math.floor(o/l)>=Math.floor(s/l))return;const c=e[o+s>>1];let d=o-1,u=s+1;for(;;){do d++;while(e[d]<c);do u--;while(e[u]>c);if(d>=u)break;PT(e,t,i,d,u)}xf(e,t,i,o,u,l),xf(e,t,i,u+1,s,l)}function PT(e,t,i,o,s){const l=e[o];e[o]=e[s],e[s]=l;const c=4*o,d=4*s,u=t[c],h=t[c+1],g=t[c+2],y=t[c+3];t[c]=t[d],t[c+1]=t[d+1],t[c+2]=t[d+2],t[c+3]=t[d+3],t[d]=u,t[d+1]=h,t[d+2]=g,t[d+3]=y;const I=i[o];i[o]=i[s],i[s]=I}function RT(e,t){let i=e^t,o=65535^i,s=65535^(e|t),l=e&(t^65535),c=i|o>>1,d=i>>1^i,u=s>>1^o&l>>1^s,h=i&s>>1^l>>1^l;i=c,o=d,s=u,l=h,c=i&i>>2^o&o>>2,d=i&o>>2^o&(i^o)>>2,u^=i&s>>2^o&l>>2,h^=o&s>>2^(i^o)&l>>2,i=c,o=d,s=u,l=h,c=i&i>>4^o&o>>4,d=i&o>>4^o&(i^o)>>4,u^=i&s>>4^o&l>>4,h^=o&s>>4^(i^o)&l>>4,i=c,o=d,s=u,l=h,u^=i&s>>8^o&l>>8,h^=o&s>>8^(i^o)&l>>8,i=u^u>>1,o=h^h>>1;let g=e^t,y=o|65535^(g|i);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|g)>>>0}function li(e,t){return{x:e.x+t.x,y:e.y+t.y}}function dh(e,t){return{x:e.x-t.x,y:e.y-t.y}}function mt(e,t){return{x:e.x*t,y:e.y*t}}function go(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function Dt(e){const t=go(e);return t===0?{x:0,y:0}:mt(e,1/t)}function Nn(e,t){return go(dh(e,t))}function wc(e,t,i){return{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}}function n0(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((i,o)=>({x:i.x+o.x,y:i.y+o.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function ze(e,t,i,o){let s=t.x-e.x,l=t.y-e.y;return Math.abs(s)>i/2&&(s=s-Math.sign(s)*i),Math.abs(l)>o/2&&(l=l-Math.sign(l)*o),{x:s,y:l}}function Pt(e,t,i){const o=ze(e,t,i.width,i.height);return Dt(o)}function z(e,t,i,o){const s=ze(e,t,i,o);return go(s)}function cn(e,t,i,o){const s=ze(e,t,i,o);return s.x*s.x+s.y*s.y}function MT(e,t){return e.x*t.x+e.y*t.y}function kT(e,t){const i=MT(e,t),o=go(e),s=go(t);if(o===0||s===0)return 0;const l=Math.max(-1,Math.min(1,i/(o*s)));return Math.acos(l)}function i0(e,t){const i=Math.cos(t),o=Math.sin(t);return{x:e.x*i-e.y*o,y:e.x*o+e.y*i}}function DT(e,t){return t.split(".").reduce((i,o)=>{if(i&&typeof i=="object"&&o in i)return i[o]},e)}function Ai(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const i=new uh(e.length),o=new Map,s=new Map;let l=0;const c=new Uint32Array(e.length);for(let u=0;u<e.length;u++){const h=e[u];h.width!==void 0&&h.height!==void 0?i.add(h.position.x,h.position.y,h.position.x+h.width,h.position.y+h.height):i.add(h.position.x,h.position.y,h.position.x,h.position.y)}return i.finish(),{all(){return e},byRect(u){const{width:h,height:g}=t,y=[];l++;const I=[];u.left<0?(I.push({left:u.left+h,right:h}),I.push({left:0,right:u.right})):u.right>h?(I.push({left:u.left,right:h}),I.push({left:0,right:u.right-h})):I.push({left:u.left,right:u.right});const v=[];u.top<0?(v.push({top:u.top+g,bottom:g}),v.push({top:0,bottom:u.bottom})):u.bottom>g?(v.push({top:u.top,bottom:g}),v.push({top:0,bottom:u.bottom-g})):v.push({top:u.top,bottom:u.bottom});for(let T=0;T<I.length;T++){const A=I[T];for(let E=0;E<v.length;E++){const C=v[E],_=i.search(A.left,C.top,A.right,C.bottom);for(let w=0;w<_.length;w++){const R=_[w];c[R]!==l&&(c[R]=l,y.push(e[R]))}}}return y},byRadius(u,h){const{width:g,height:y}=t,I=[];l++;const v=h*h,T=u.x-h,A=u.x+h,E=u.y-h,C=u.y+h,_=[];T<0?(_.push({left:T+g,right:g}),_.push({left:0,right:A})):A>g?(_.push({left:T,right:g}),_.push({left:0,right:A-g})):_.push({left:T,right:A});const w=[];E<0?(w.push({top:E+y,bottom:y}),w.push({top:0,bottom:C})):C>y?(w.push({top:E,bottom:y}),w.push({top:0,bottom:C-y})):w.push({top:E,bottom:C});for(let R=0;R<_.length;R++){const N=_[R];for(let D=0;D<w.length;D++){const B=w[D],G=i.search(N.left,B.top,N.right,B.bottom);for(let $=0;$<G.length;$++){const V=G[$];if(c[V]!==l){c[V]=l;const X=e[V];cn(u,X.position,g,y)<=v&&I.push(X)}}}}return I},byProperty(u,h){var g;if(!o.has(u)){const y=new Map;for(let I=0;I<e.length;I++){const v=e[I],T=v[u];y.has(T)||y.set(T,[]),y.get(T).push(v)}o.set(u,y)}return((g=o.get(u))==null?void 0:g.get(h))||[]},byPropertyPath(u,h){var g;if(!s.has(u)){const y=new Map;for(let I=0;I<e.length;I++){const v=e[I],T=DT(v,u);y.has(T)||y.set(T,[]),y.get(T).push(v)}s.set(u,y)}return((g=s.get(u))==null?void 0:g.get(h))||[]},resetPropertyCache(){o.clear(),s.clear()},count(){return e.length}}}function Wc(e){var y,I;const t=e.entities.entities,i=[],o=[],s=[],l=[],c=[],d=[],u=[];for(const v in t){const T=t[v];switch(T.type){case"human":i.push(T);break;case"berryBush":o.push(T);break;case"corpse":s.push(T);break;case"prey":l.push(T);break;case"predator":c.push(T);break;case"building":d.push(T);break;case"tree":u.push(T);break}}const h=e.mapDimensions;return{...e,search:{human:Ai(i,h),berryBush:Ai(o,h),corpse:Ai(s,h),prey:Ai(l,h),predator:Ai(c,h),building:Ai(d,h),tree:Ai(u,h),tasks:((y=e.search)==null?void 0:y.tasks)??Ai([],h)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((I=e.cache)==null?void 0:I.tribeCenters)??{}}}}function OT(e){const t=[];for(const i in e.tasks)t.push(e.tasks[i]);e.search.tasks=Ai(t,e.mapDimensions)}const de={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire"},To={[de.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[de.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[de.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[de.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}}},bT=.5,NT="#FFA500",BT="#FF4500",o0=4,HT=10,Ly=60;function fh(e){return To[e].dimensions}function FT(e){return To[e].constructionTimeHours}function LT(e){return To[e].destructionTimeHours}const Uy=5;function UT(){return To[de.PlantingZone].dimensions}function r0(e,t,i){const o=e.position.x+i.width/2,l=t.position.x-i.width/2-o,c=e.position.y-i.height/2,d=e.position.y+i.height/2,u=t.position.y-i.height/2,h=t.position.y+i.height/2,g=Math.min(d,h)-Math.max(c,u);return l>=-5&&l<=Uy&&g>i.height*.5}function s0(e,t,i){const o=e.position.y+i.height/2,l=t.position.y-i.height/2-o,c=e.position.x-i.width/2,d=e.position.x+i.width/2,u=t.position.x-i.width/2,h=t.position.x+i.width/2,g=Math.min(d,h)-Math.max(c,u);return l>=-5&&l<=Uy&&g>i.width*.5}function GT(e){var c;const t={},i=UT(),o=e;if(!((c=o.search)!=null&&c.building))return t;const l=o.search.building.all().filter(d=>d.buildingType===de.PlantingZone&&d.isConstructed);for(const d of l)t[d.id]={top:!1,bottom:!1,left:!1,right:!1};for(let d=0;d<l.length;d++){const u=l[d];for(let h=d+1;h<l.length;h++){const g=l[h];u.ownerId===g.ownerId&&(r0(u,g,i)&&(t[u.id].right=!0,t[g.id].left=!0),r0(g,u,i)&&(t[g.id].right=!0,t[u.id].left=!0),s0(u,g,i)&&(t[u.id].bottom=!0,t[g.id].top=!0),s0(g,u,i)&&(t[g.id].bottom=!0,t[u.id].top=!0))}}return t}function _a(e){e.plantingZoneConnections=GT(e)}var Go=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(Go||{});class xT{constructor(){Nt(this,"worker",null);Nt(this,"pendingRequests",new Map);Nt(this,"requestQueue",[]);Nt(this,"isProcessing",!1);Nt(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:i})=>{i(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const i=this.pendingRequests.get(t.id);if(!i){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case Go.SAVE_RESPONSE:this.handleSaveResponse(t,i);break;case Go.LOAD_RESPONSE:this.handleLoadResponse(t,i);break;case Go.CLEAR_RESPONSE:this.handleClearResponse(t,i);break;default:console.error("[WorkerManager] Unknown response type:",t),i.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,i){t.success?i.resolve():i.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,i){t.success?i.resolve(t.gameState):i.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,i){t.success?i.resolve():i.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((i,o)=>{if(!this.worker){o(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:i,reject:o});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),o(s)}})}queueOperation(t){return new Promise((i,o)=>{this.requestQueue.push(async()=>{try{const s=await t();i(s)}catch(s){o(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(i){console.error("[WorkerManager] Error processing queued operation:",i)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const i=this.generateRequestId(),o=t,s={type:Go.SAVE_REQUEST,id:i,gameState:o};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),i={type:Go.LOAD_REQUEST,id:t};return await this.sendMessage(i)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),i={type:Go.CLEAR_REQUEST,id:t};await this.sendMessage(i)})}}const hh=new xT;async function ph(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,tribeModalOpen:e.tribeModalOpen,cameraFollowingPlayer:e.cameraFollowingPlayer,cameraZoom:e.cameraZoom,isDraggingMinimap:e.isDraggingMinimap,minimapDragDistance:e.minimapDragDistance,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks,isDraggingViewport:e.isDraggingViewport,viewportDragButton:e.viewportDragButton,viewportDragDistance:e.viewportDragDistance};await hh.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function $T(){try{const e=await hh.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const i=Wc(t);return _a(i),i}catch(e){return console.error("Failed to load game:",e),await Gy(),null}}async function Gy(){try{await hh.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const xy=Pe.createContext(void 0),WT=({initialAppState:e,children:t})=>{const[i,o]=Pe.useState(e),[s,l]=Pe.useState(void 0),[c,d]=Pe.useState(null),[u,h]=Pe.useState(!1);Pe.useEffect(()=>{$T().then(T=>{T&&d(T),h(!0)})},[]);const g=(T,A)=>{o(T),T==="gameOver"&&A?l(A):T!=="gameOver"&&l(void 0)},y=()=>{o("intro"),l(void 0),v()},I=T=>{ph(T),d(T)},v=()=>{Gy(),d(null)};return ke.jsx(xy.Provider,{value:{appState:i,setAppState:g,returnToIntro:y,gameOverDetails:s,contextReady:u,savedGameState:c,setSavedGameState:d,saveCurrentGame:I,clearCurrentSave:v},children:t})},rr=()=>{const e=Pe.useContext(xy);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var $t=function(){return $t=Object.assign||function(t){for(var i,o=1,s=arguments.length;o<s;o++){i=arguments[o];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(t[l]=i[l])}return t},$t.apply(this,arguments)};function Ca(e,t,i){if(i||arguments.length===2)for(var o=0,s=t.length,l;o<s;o++)(l||!(o in t))&&(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))}var tt="-ms-",pa="-moz-",$e="-webkit-",$y="comm",Yc="rule",gh="decl",YT="@import",Wy="@keyframes",zT="@layer",Yy=Math.abs,mh=String.fromCharCode,$f=Object.assign;function jT(e,t){return Rt(e,0)^45?(((t<<2^Rt(e,0))<<2^Rt(e,1))<<2^Rt(e,2))<<2^Rt(e,3):0}function zy(e){return e.trim()}function Ei(e,t){return(e=t.exec(e))?e[0]:e}function Be(e,t,i){return e.replace(t,i)}function mc(e,t,i){return e.indexOf(t,i)}function Rt(e,t){return e.charCodeAt(t)|0}function qr(e,t,i){return e.slice(t,i)}function si(e){return e.length}function jy(e){return e.length}function la(e,t){return t.push(e),e}function XT(e,t){return e.map(t).join("")}function a0(e,t){return e.filter(function(i){return!Ei(i,t)})}var zc=1,Zr=1,Xy=0,Bn=0,gt=0,as="";function jc(e,t,i,o,s,l,c,d){return{value:e,root:t,parent:i,type:o,props:s,children:l,line:zc,column:Zr,length:c,return:"",siblings:d}}function ro(e,t){return $f(jc("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Nr(e){for(;e.root;)e=ro(e.root,{children:[e]});la(e,e.siblings)}function VT(){return gt}function qT(){return gt=Bn>0?Rt(as,--Bn):0,Zr--,gt===10&&(Zr=1,zc--),gt}function jn(){return gt=Bn<Xy?Rt(as,Bn++):0,Zr++,gt===10&&(Zr=1,zc++),gt}function zo(){return Rt(as,Bn)}function yc(){return Bn}function Xc(e,t){return qr(as,e,t)}function Wf(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function ZT(e){return zc=Zr=1,Xy=si(as=e),Bn=0,[]}function KT(e){return as="",e}function df(e){return zy(Xc(Bn-1,Yf(e===91?e+2:e===40?e+1:e)))}function QT(e){for(;(gt=zo())&&gt<33;)jn();return Wf(e)>2||Wf(gt)>3?"":" "}function JT(e,t){for(;--t&&jn()&&!(gt<48||gt>102||gt>57&&gt<65||gt>70&&gt<97););return Xc(e,yc()+(t<6&&zo()==32&&jn()==32))}function Yf(e){for(;jn();)switch(gt){case e:return Bn;case 34:case 39:e!==34&&e!==39&&Yf(gt);break;case 40:e===41&&Yf(e);break;case 92:jn();break}return Bn}function eE(e,t){for(;jn()&&e+gt!==57;)if(e+gt===84&&zo()===47)break;return"/*"+Xc(t,Bn-1)+"*"+mh(e===47?e:jn())}function tE(e){for(;!Wf(zo());)jn();return Xc(e,Bn)}function nE(e){return KT(vc("",null,null,null,[""],e=ZT(e),0,[0],e))}function vc(e,t,i,o,s,l,c,d,u){for(var h=0,g=0,y=c,I=0,v=0,T=0,A=1,E=1,C=1,_=0,w="",R=s,N=l,D=o,B=w;E;)switch(T=_,_=jn()){case 40:if(T!=108&&Rt(B,y-1)==58){mc(B+=Be(df(_),"&","&\f"),"&\f",Yy(h?d[h-1]:0))!=-1&&(C=-1);break}case 34:case 39:case 91:B+=df(_);break;case 9:case 10:case 13:case 32:B+=QT(T);break;case 92:B+=JT(yc()-1,7);continue;case 47:switch(zo()){case 42:case 47:la(iE(eE(jn(),yc()),t,i,u),u);break;default:B+="/"}break;case 123*A:d[h++]=si(B)*C;case 125*A:case 59:case 0:switch(_){case 0:case 125:E=0;case 59+g:C==-1&&(B=Be(B,/\f/g,"")),v>0&&si(B)-y&&la(v>32?c0(B+";",o,i,y-1,u):c0(Be(B," ","")+";",o,i,y-2,u),u);break;case 59:B+=";";default:if(la(D=l0(B,t,i,h,g,s,d,w,R=[],N=[],y,l),l),_===123)if(g===0)vc(B,t,D,D,R,l,y,d,N);else switch(I===99&&Rt(B,3)===110?100:I){case 100:case 108:case 109:case 115:vc(e,D,D,o&&la(l0(e,D,D,0,0,s,d,w,s,R=[],y,N),N),s,N,y,d,o?R:N);break;default:vc(B,D,D,D,[""],N,0,d,N)}}h=g=v=0,A=C=1,w=B="",y=c;break;case 58:y=1+si(B),v=T;default:if(A<1){if(_==123)--A;else if(_==125&&A++==0&&qT()==125)continue}switch(B+=mh(_),_*A){case 38:C=g>0?1:(B+="\f",-1);break;case 44:d[h++]=(si(B)-1)*C,C=1;break;case 64:zo()===45&&(B+=df(jn())),I=zo(),g=y=si(w=B+=tE(yc())),_++;break;case 45:T===45&&si(B)==2&&(A=0)}}return l}function l0(e,t,i,o,s,l,c,d,u,h,g,y){for(var I=s-1,v=s===0?l:[""],T=jy(v),A=0,E=0,C=0;A<o;++A)for(var _=0,w=qr(e,I+1,I=Yy(E=c[A])),R=e;_<T;++_)(R=zy(E>0?v[_]+" "+w:Be(w,/&\f/g,v[_])))&&(u[C++]=R);return jc(e,t,i,s===0?Yc:d,u,h,g,y)}function iE(e,t,i,o){return jc(e,t,i,$y,mh(VT()),qr(e,2,-2),0,o)}function c0(e,t,i,o,s){return jc(e,t,i,gh,qr(e,0,o),qr(e,o+1,-1),o,s)}function Vy(e,t,i){switch(jT(e,t)){case 5103:return $e+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return $e+e+e;case 4789:return pa+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return $e+e+pa+e+tt+e+e;case 5936:switch(Rt(e,t+11)){case 114:return $e+e+tt+Be(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return $e+e+tt+Be(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return $e+e+tt+Be(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return $e+e+tt+e+e;case 6165:return $e+e+tt+"flex-"+e+e;case 5187:return $e+e+Be(e,/(\w+).+(:[^]+)/,$e+"box-$1$2"+tt+"flex-$1$2")+e;case 5443:return $e+e+tt+"flex-item-"+Be(e,/flex-|-self/g,"")+(Ei(e,/flex-|baseline/)?"":tt+"grid-row-"+Be(e,/flex-|-self/g,""))+e;case 4675:return $e+e+tt+"flex-line-pack"+Be(e,/align-content|flex-|-self/g,"")+e;case 5548:return $e+e+tt+Be(e,"shrink","negative")+e;case 5292:return $e+e+tt+Be(e,"basis","preferred-size")+e;case 6060:return $e+"box-"+Be(e,"-grow","")+$e+e+tt+Be(e,"grow","positive")+e;case 4554:return $e+Be(e,/([^-])(transform)/g,"$1"+$e+"$2")+e;case 6187:return Be(Be(Be(e,/(zoom-|grab)/,$e+"$1"),/(image-set)/,$e+"$1"),e,"")+e;case 5495:case 3959:return Be(e,/(image-set\([^]*)/,$e+"$1$`$1");case 4968:return Be(Be(e,/(.+:)(flex-)?(.*)/,$e+"box-pack:$3"+tt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+$e+e+e;case 4200:if(!Ei(e,/flex-|baseline/))return tt+"grid-column-align"+qr(e,t)+e;break;case 2592:case 3360:return tt+Be(e,"template-","")+e;case 4384:case 3616:return i&&i.some(function(o,s){return t=s,Ei(o.props,/grid-\w+-end/)})?~mc(e+(i=i[t].value),"span",0)?e:tt+Be(e,"-start","")+e+tt+"grid-row-span:"+(~mc(i,"span",0)?Ei(i,/\d+/):+Ei(i,/\d+/)-+Ei(e,/\d+/))+";":tt+Be(e,"-start","")+e;case 4896:case 4128:return i&&i.some(function(o){return Ei(o.props,/grid-\w+-start/)})?e:tt+Be(Be(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return Be(e,/(.+)-inline(.+)/,$e+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(si(e)-1-t>6)switch(Rt(e,t+1)){case 109:if(Rt(e,t+4)!==45)break;case 102:return Be(e,/(.+:)(.+)-([^]+)/,"$1"+$e+"$2-$3$1"+pa+(Rt(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~mc(e,"stretch",0)?Vy(Be(e,"stretch","fill-available"),t,i)+e:e}break;case 5152:case 5920:return Be(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(o,s,l,c,d,u,h){return tt+s+":"+l+h+(c?tt+s+"-span:"+(d?u:+u-+l)+h:"")+e});case 4949:if(Rt(e,t+6)===121)return Be(e,":",":"+$e)+e;break;case 6444:switch(Rt(e,Rt(e,14)===45?18:11)){case 120:return Be(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+$e+(Rt(e,14)===45?"inline-":"")+"box$3$1"+$e+"$2$3$1"+tt+"$2box$3")+e;case 100:return Be(e,":",":"+tt)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Be(e,"scroll-","scroll-snap-")+e}return e}function _c(e,t){for(var i="",o=0;o<e.length;o++)i+=t(e[o],o,e,t)||"";return i}function oE(e,t,i,o){switch(e.type){case zT:if(e.children.length)break;case YT:case gh:return e.return=e.return||e.value;case $y:return"";case Wy:return e.return=e.value+"{"+_c(e.children,o)+"}";case Yc:if(!si(e.value=e.props.join(",")))return""}return si(i=_c(e.children,o))?e.return=e.value+"{"+i+"}":""}function rE(e){var t=jy(e);return function(i,o,s,l){for(var c="",d=0;d<t;d++)c+=e[d](i,o,s,l)||"";return c}}function sE(e){return function(t){t.root||(t=t.return)&&e(t)}}function aE(e,t,i,o){if(e.length>-1&&!e.return)switch(e.type){case gh:e.return=Vy(e.value,e.length,i);return;case Wy:return _c([ro(e,{value:Be(e.value,"@","@"+$e)})],o);case Yc:if(e.length)return XT(i=e.props,function(s){switch(Ei(s,o=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Nr(ro(e,{props:[Be(s,/:(read-\w+)/,":"+pa+"$1")]})),Nr(ro(e,{props:[s]})),$f(e,{props:a0(i,o)});break;case"::placeholder":Nr(ro(e,{props:[Be(s,/:(plac\w+)/,":"+$e+"input-$1")]})),Nr(ro(e,{props:[Be(s,/:(plac\w+)/,":"+pa+"$1")]})),Nr(ro(e,{props:[Be(s,/:(plac\w+)/,tt+"input-$1")]})),Nr(ro(e,{props:[s]})),$f(e,{props:a0(i,o)});break}return""})}}var lE={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},vn={},Kr=typeof process<"u"&&vn!==void 0&&(vn.REACT_APP_SC_ATTR||vn.SC_ATTR)||"data-styled",qy="active",Zy="data-styled-version",Vc="6.1.13",yh=`/*!sc*/
`,Cc=typeof window<"u"&&"HTMLElement"in window,cE=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&vn!==void 0&&vn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&vn.REACT_APP_SC_DISABLE_SPEEDY!==""?vn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&vn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&vn!==void 0&&vn.SC_DISABLE_SPEEDY!==void 0&&vn.SC_DISABLE_SPEEDY!==""&&vn.SC_DISABLE_SPEEDY!=="false"&&vn.SC_DISABLE_SPEEDY),uE={},qc=Object.freeze([]),Qr=Object.freeze({});function Ky(e,t,i){return i===void 0&&(i=Qr),e.theme!==i.theme&&e.theme||t||i.theme}var Qy=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),dE=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,fE=/(^-|-$)/g;function u0(e){return e.replace(dE,"-").replace(fE,"")}var hE=/(a)(d)/gi,nc=52,d0=function(e){return String.fromCharCode(e+(e>25?39:97))};function zf(e){var t,i="";for(t=Math.abs(e);t>nc;t=t/nc|0)i=d0(t%nc)+i;return(d0(t%nc)+i).replace(hE,"$1-$2")}var ff,Jy=5381,Ur=function(e,t){for(var i=t.length;i;)e=33*e^t.charCodeAt(--i);return e},ev=function(e){return Ur(Jy,e)};function tv(e){return zf(ev(e)>>>0)}function pE(e){return e.displayName||e.name||"Component"}function hf(e){return typeof e=="string"&&!0}var nv=typeof Symbol=="function"&&Symbol.for,iv=nv?Symbol.for("react.memo"):60115,gE=nv?Symbol.for("react.forward_ref"):60112,mE={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},yE={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},ov={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},vE=((ff={})[gE]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},ff[iv]=ov,ff);function f0(e){return("type"in(t=e)&&t.type.$$typeof)===iv?ov:"$$typeof"in e?vE[e.$$typeof]:mE;var t}var IE=Object.defineProperty,SE=Object.getOwnPropertyNames,h0=Object.getOwnPropertySymbols,AE=Object.getOwnPropertyDescriptor,TE=Object.getPrototypeOf,p0=Object.prototype;function rv(e,t,i){if(typeof t!="string"){if(p0){var o=TE(t);o&&o!==p0&&rv(e,o,i)}var s=SE(t);h0&&(s=s.concat(h0(t)));for(var l=f0(e),c=f0(t),d=0;d<s.length;++d){var u=s[d];if(!(u in yE||i&&i[u]||c&&u in c||l&&u in l)){var h=AE(t,u);try{IE(e,u,h)}catch{}}}}return e}function Jr(e){return typeof e=="function"}function vh(e){return typeof e=="object"&&"styledComponentId"in e}function Wo(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function jf(e,t){if(e.length===0)return"";for(var i=e[0],o=1;o<e.length;o++)i+=e[o];return i}function Pa(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function Xf(e,t,i){if(i===void 0&&(i=!1),!i&&!Pa(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var o=0;o<t.length;o++)e[o]=Xf(e[o],t[o]);else if(Pa(t))for(var o in t)e[o]=Xf(e[o],t[o]);return e}function Ih(e,t){Object.defineProperty(e,"toString",{value:t})}function Ua(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var EE=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var i=0,o=0;o<t;o++)i+=this.groupSizes[o];return i},e.prototype.insertRules=function(t,i){if(t>=this.groupSizes.length){for(var o=this.groupSizes,s=o.length,l=s;t>=l;)if((l<<=1)<0)throw Ua(16,"".concat(t));this.groupSizes=new Uint32Array(l),this.groupSizes.set(o),this.length=l;for(var c=s;c<l;c++)this.groupSizes[c]=0}for(var d=this.indexOfGroup(t+1),u=(c=0,i.length);c<u;c++)this.tag.insertRule(d,i[c])&&(this.groupSizes[t]++,d++)},e.prototype.clearGroup=function(t){if(t<this.length){var i=this.groupSizes[t],o=this.indexOfGroup(t),s=o+i;this.groupSizes[t]=0;for(var l=o;l<s;l++)this.tag.deleteRule(o)}},e.prototype.getGroup=function(t){var i="";if(t>=this.length||this.groupSizes[t]===0)return i;for(var o=this.groupSizes[t],s=this.indexOfGroup(t),l=s+o,c=s;c<l;c++)i+="".concat(this.tag.getRule(c)).concat(yh);return i},e}(),Ic=new Map,Pc=new Map,Sc=1,ic=function(e){if(Ic.has(e))return Ic.get(e);for(;Pc.has(Sc);)Sc++;var t=Sc++;return Ic.set(e,t),Pc.set(t,e),t},wE=function(e,t){Sc=t+1,Ic.set(e,t),Pc.set(t,e)},_E="style[".concat(Kr,"][").concat(Zy,'="').concat(Vc,'"]'),CE=new RegExp("^".concat(Kr,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),PE=function(e,t,i){for(var o,s=i.split(","),l=0,c=s.length;l<c;l++)(o=s[l])&&e.registerName(t,o)},RE=function(e,t){for(var i,o=((i=t.textContent)!==null&&i!==void 0?i:"").split(yh),s=[],l=0,c=o.length;l<c;l++){var d=o[l].trim();if(d){var u=d.match(CE);if(u){var h=0|parseInt(u[1],10),g=u[2];h!==0&&(wE(g,h),PE(e,g,u[3]),e.getTag().insertRules(h,s)),s.length=0}else s.push(d)}}},g0=function(e){for(var t=document.querySelectorAll(_E),i=0,o=t.length;i<o;i++){var s=t[i];s&&s.getAttribute(Kr)!==qy&&(RE(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function ME(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var sv=function(e){var t=document.head,i=e||t,o=document.createElement("style"),s=function(d){var u=Array.from(d.querySelectorAll("style[".concat(Kr,"]")));return u[u.length-1]}(i),l=s!==void 0?s.nextSibling:null;o.setAttribute(Kr,qy),o.setAttribute(Zy,Vc);var c=ME();return c&&o.setAttribute("nonce",c),i.insertBefore(o,l),o},kE=function(){function e(t){this.element=sv(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(i){if(i.sheet)return i.sheet;for(var o=document.styleSheets,s=0,l=o.length;s<l;s++){var c=o[s];if(c.ownerNode===i)return c}throw Ua(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,i){try{return this.sheet.insertRule(i,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var i=this.sheet.cssRules[t];return i&&i.cssText?i.cssText:""},e}(),DE=function(){function e(t){this.element=sv(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,i){if(t<=this.length&&t>=0){var o=document.createTextNode(i);return this.element.insertBefore(o,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),OE=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,i){return t<=this.length&&(this.rules.splice(t,0,i),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),m0=Cc,bE={isServer:!Cc,useCSSOMInjection:!cE},Rc=function(){function e(t,i,o){t===void 0&&(t=Qr),i===void 0&&(i={});var s=this;this.options=$t($t({},bE),t),this.gs=i,this.names=new Map(o),this.server=!!t.isServer,!this.server&&Cc&&m0&&(m0=!1,g0(this)),Ih(this,function(){return function(l){for(var c=l.getTag(),d=c.length,u="",h=function(y){var I=function(C){return Pc.get(C)}(y);if(I===void 0)return"continue";var v=l.names.get(I),T=c.getGroup(y);if(v===void 0||!v.size||T.length===0)return"continue";var A="".concat(Kr,".g").concat(y,'[id="').concat(I,'"]'),E="";v!==void 0&&v.forEach(function(C){C.length>0&&(E+="".concat(C,","))}),u+="".concat(T).concat(A,'{content:"').concat(E,'"}').concat(yh)},g=0;g<d;g++)h(g);return u}(s)})}return e.registerId=function(t){return ic(t)},e.prototype.rehydrate=function(){!this.server&&Cc&&g0(this)},e.prototype.reconstructWithOptions=function(t,i){return i===void 0&&(i=!0),new e($t($t({},this.options),t),this.gs,i&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(i){var o=i.useCSSOMInjection,s=i.target;return i.isServer?new OE(s):o?new kE(s):new DE(s)}(this.options),new EE(t)));var t},e.prototype.hasNameForId=function(t,i){return this.names.has(t)&&this.names.get(t).has(i)},e.prototype.registerName=function(t,i){if(ic(t),this.names.has(t))this.names.get(t).add(i);else{var o=new Set;o.add(i),this.names.set(t,o)}},e.prototype.insertRules=function(t,i,o){this.registerName(t,i),this.getTag().insertRules(ic(t),o)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(ic(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),NE=/&/g,BE=/^\s*\/\/.*$/gm;function av(e,t){return e.map(function(i){return i.type==="rule"&&(i.value="".concat(t," ").concat(i.value),i.value=i.value.replaceAll(",",",".concat(t," ")),i.props=i.props.map(function(o){return"".concat(t," ").concat(o)})),Array.isArray(i.children)&&i.type!=="@keyframes"&&(i.children=av(i.children,t)),i})}function HE(e){var t,i,o,s=Qr,l=s.options,c=l===void 0?Qr:l,d=s.plugins,u=d===void 0?qc:d,h=function(I,v,T){return T.startsWith(i)&&T.endsWith(i)&&T.replaceAll(i,"").length>0?".".concat(t):I},g=u.slice();g.push(function(I){I.type===Yc&&I.value.includes("&")&&(I.props[0]=I.props[0].replace(NE,i).replace(o,h))}),c.prefix&&g.push(aE),g.push(oE);var y=function(I,v,T,A){v===void 0&&(v=""),T===void 0&&(T=""),A===void 0&&(A="&"),t=A,i=v,o=new RegExp("\\".concat(i,"\\b"),"g");var E=I.replace(BE,""),C=nE(T||v?"".concat(T," ").concat(v," { ").concat(E," }"):E);c.namespace&&(C=av(C,c.namespace));var _=[];return _c(C,rE(g.concat(sE(function(w){return _.push(w)})))),_};return y.hash=u.length?u.reduce(function(I,v){return v.name||Ua(15),Ur(I,v.name)},Jy).toString():"",y}var FE=new Rc,Vf=HE(),lv=ai.createContext({shouldForwardProp:void 0,styleSheet:FE,stylis:Vf});lv.Consumer;ai.createContext(void 0);function qf(){return Pe.useContext(lv)}var LE=function(){function e(t,i){var o=this;this.inject=function(s,l){l===void 0&&(l=Vf);var c=o.name+l.hash;s.hasNameForId(o.id,c)||s.insertRules(o.id,c,l(o.rules,c,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=i,Ih(this,function(){throw Ua(12,String(o.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Vf),this.name+t.hash},e}(),UE=function(e){return e>="A"&&e<="Z"};function y0(e){for(var t="",i=0;i<e.length;i++){var o=e[i];if(i===1&&o==="-"&&e[0]==="-")return e;UE(o)?t+="-"+o.toLowerCase():t+=o}return t.startsWith("ms-")?"-"+t:t}var cv=function(e){return e==null||e===!1||e===""},uv=function(e){var t,i,o=[];for(var s in e){var l=e[s];e.hasOwnProperty(s)&&!cv(l)&&(Array.isArray(l)&&l.isCss||Jr(l)?o.push("".concat(y0(s),":"),l,";"):Pa(l)?o.push.apply(o,Ca(Ca(["".concat(s," {")],uv(l),!1),["}"],!1)):o.push("".concat(y0(s),": ").concat((t=s,(i=l)==null||typeof i=="boolean"||i===""?"":typeof i!="number"||i===0||t in lE||t.startsWith("--")?String(i).trim():"".concat(i,"px")),";")))}return o};function po(e,t,i,o){if(cv(e))return[];if(vh(e))return[".".concat(e.styledComponentId)];if(Jr(e)){if(!Jr(l=e)||l.prototype&&l.prototype.isReactComponent||!t)return[e];var s=e(t);return po(s,t,i,o)}var l;return e instanceof LE?i?(e.inject(i,o),[e.getName(o)]):[e]:Pa(e)?uv(e):Array.isArray(e)?Array.prototype.concat.apply(qc,e.map(function(c){return po(c,t,i,o)})):[e.toString()]}function dv(e){for(var t=0;t<e.length;t+=1){var i=e[t];if(Jr(i)&&!vh(i))return!1}return!0}var GE=ev(Vc),xE=function(){function e(t,i,o){this.rules=t,this.staticRulesId="",this.isStatic=(o===void 0||o.isStatic)&&dv(t),this.componentId=i,this.baseHash=Ur(GE,i),this.baseStyle=o,Rc.registerId(i)}return e.prototype.generateAndInjectStyles=function(t,i,o){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,i,o):"";if(this.isStatic&&!o.hash)if(this.staticRulesId&&i.hasNameForId(this.componentId,this.staticRulesId))s=Wo(s,this.staticRulesId);else{var l=jf(po(this.rules,t,i,o)),c=zf(Ur(this.baseHash,l)>>>0);if(!i.hasNameForId(this.componentId,c)){var d=o(l,".".concat(c),void 0,this.componentId);i.insertRules(this.componentId,c,d)}s=Wo(s,c),this.staticRulesId=c}else{for(var u=Ur(this.baseHash,o.hash),h="",g=0;g<this.rules.length;g++){var y=this.rules[g];if(typeof y=="string")h+=y;else if(y){var I=jf(po(y,t,i,o));u=Ur(u,I+g),h+=I}}if(h){var v=zf(u>>>0);i.hasNameForId(this.componentId,v)||i.insertRules(this.componentId,v,o(h,".".concat(v),void 0,this.componentId)),s=Wo(s,v)}}return s},e}(),Sh=ai.createContext(void 0);Sh.Consumer;var pf={};function $E(e,t,i){var o=vh(e),s=e,l=!hf(e),c=t.attrs,d=c===void 0?qc:c,u=t.componentId,h=u===void 0?function(R,N){var D=typeof R!="string"?"sc":u0(R);pf[D]=(pf[D]||0)+1;var B="".concat(D,"-").concat(tv(Vc+D+pf[D]));return N?"".concat(N,"-").concat(B):B}(t.displayName,t.parentComponentId):u,g=t.displayName,y=g===void 0?function(R){return hf(R)?"styled.".concat(R):"Styled(".concat(pE(R),")")}(e):g,I=t.displayName&&t.componentId?"".concat(u0(t.displayName),"-").concat(t.componentId):t.componentId||h,v=o&&s.attrs?s.attrs.concat(d).filter(Boolean):d,T=t.shouldForwardProp;if(o&&s.shouldForwardProp){var A=s.shouldForwardProp;if(t.shouldForwardProp){var E=t.shouldForwardProp;T=function(R,N){return A(R,N)&&E(R,N)}}else T=A}var C=new xE(i,I,o?s.componentStyle:void 0);function _(R,N){return function(D,B,G){var $=D.attrs,V=D.componentStyle,X=D.defaultProps,q=D.foldedComponentIds,re=D.styledComponentId,ee=D.target,ne=ai.useContext(Sh),oe=qf(),te=D.shouldForwardProp||oe.shouldForwardProp,W=Ky(B,ne,X)||Qr,Q=function(Re,ae,Se){for(var Te,ie=$t($t({},ae),{className:void 0,theme:Se}),he=0;he<Re.length;he+=1){var Ne=Jr(Te=Re[he])?Te(ie):Te;for(var Ae in Ne)ie[Ae]=Ae==="className"?Wo(ie[Ae],Ne[Ae]):Ae==="style"?$t($t({},ie[Ae]),Ne[Ae]):Ne[Ae]}return ae.className&&(ie.className=Wo(ie.className,ae.className)),ie}($,B,W),Z=Q.as||ee,k={};for(var U in Q)Q[U]===void 0||U[0]==="$"||U==="as"||U==="theme"&&Q.theme===W||(U==="forwardedAs"?k.as=Q.forwardedAs:te&&!te(U,Z)||(k[U]=Q[U]));var se=function(Re,ae){var Se=qf(),Te=Re.generateAndInjectStyles(ae,Se.styleSheet,Se.stylis);return Te}(V,Q),ce=Wo(q,re);return se&&(ce+=" "+se),Q.className&&(ce+=" "+Q.className),k[hf(Z)&&!Qy.has(Z)?"class":"className"]=ce,k.ref=G,Pe.createElement(Z,k)}(w,R,N)}_.displayName=y;var w=ai.forwardRef(_);return w.attrs=v,w.componentStyle=C,w.displayName=y,w.shouldForwardProp=T,w.foldedComponentIds=o?Wo(s.foldedComponentIds,s.styledComponentId):"",w.styledComponentId=I,w.target=o?s.target:e,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(R){this._foldedDefaultProps=o?function(N){for(var D=[],B=1;B<arguments.length;B++)D[B-1]=arguments[B];for(var G=0,$=D;G<$.length;G++)Xf(N,$[G],!0);return N}({},s.defaultProps,R):R}}),Ih(w,function(){return".".concat(w.styledComponentId)}),l&&rv(w,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function v0(e,t){for(var i=[e[0]],o=0,s=t.length;o<s;o+=1)i.push(t[o],e[o+1]);return i}var I0=function(e){return Object.assign(e,{isCss:!0})};function fv(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(Jr(e)||Pa(e))return I0(po(v0(qc,Ca([e],t,!0))));var o=e;return t.length===0&&o.length===1&&typeof o[0]=="string"?po(o):I0(po(v0(o,t)))}function Zf(e,t,i){if(i===void 0&&(i=Qr),!t)throw Ua(1,t);var o=function(s){for(var l=[],c=1;c<arguments.length;c++)l[c-1]=arguments[c];return e(t,i,fv.apply(void 0,Ca([s],l,!1)))};return o.attrs=function(s){return Zf(e,t,$t($t({},i),{attrs:Array.prototype.concat(i.attrs,s).filter(Boolean)}))},o.withConfig=function(s){return Zf(e,t,$t($t({},i),s))},o}var hv=function(e){return Zf($E,e)},Tt=hv;Qy.forEach(function(e){Tt[e]=hv(e)});var WE=function(){function e(t,i){this.rules=t,this.componentId=i,this.isStatic=dv(t),Rc.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,i,o,s){var l=s(jf(po(this.rules,i,o,s)),""),c=this.componentId+t;o.insertRules(c,c,l)},e.prototype.removeStyles=function(t,i){i.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,i,o,s){t>2&&Rc.registerId(this.componentId+t),this.removeStyles(t,o),this.createStyles(t,i,o,s)},e}();function YE(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=fv.apply(void 0,Ca([e],t,!1)),s="sc-global-".concat(tv(JSON.stringify(o))),l=new WE(o,s),c=function(u){var h=qf(),g=ai.useContext(Sh),y=ai.useRef(h.styleSheet.allocateGSInstance(s)).current;return h.styleSheet.server&&d(y,u,h.styleSheet,g,h.stylis),ai.useLayoutEffect(function(){if(!h.styleSheet.server)return d(y,u,h.styleSheet,g,h.stylis),function(){return l.removeStyles(y,h.styleSheet)}},[y,u,h.styleSheet,g,h.stylis]),null};function d(u,h,g,y,I){if(l.isStatic)l.renderStyles(u,uE,g,I);else{var v=$t($t({},h),{theme:Ky(h,y,c.defaultProps)});l.renderStyles(u,v,g,I)}}return ai.memo(c)}function pv(e,t){var i=Pe.useRef(null),o=Pe.useRef(!1),s=Pe.useRef(e);s.current=e;var l=Pe.useCallback(function(d){o.current&&(s.current(d),i.current=requestAnimationFrame(l))},[]),c=Pe.useMemo(function(){return[function(){o.current&&(o.current=!1,i.current&&cancelAnimationFrame(i.current))},function(){o.current||(o.current=!0,i.current=requestAnimationFrame(l))},function(){return o.current}]},[]);return Pe.useEffect(function(){return c[0]},[]),c}function zE(e,t,i,o,s){var c;(c=e.onExit)==null||c.call(e,o,t);const l=s.find(({id:d})=>d===t);return l!=null&&l.onEnter?l.onEnter(o,i):{...i,enteredAt:o.updateContext.gameState.time}}function jE(e,t){return t.find(({id:i})=>i===e)}function XE(e,t){return e!==t}function VE(e){e&&console.warn(`No handler found for state: ${e}`)}const ga="bushGrowing",$o="bushFull",Ac="bushSpreading",Ra="bushDying",Mt=24,Ht=10,Ue=4e3,Ge=4e3,Mc=5,qE=15,ZE=5e3,Ri=100,Mi=20,ki=60,gv=200,KE=1e3,QE=5,JE=3,ew=12,tw=940,Kf=20,S0=90,mv=100,Jo=5,nw=.5,Zc=30,Di=.1,ca=.9,iw=2,ow=2;var qn=(e=>(e.Berry="berry",e.Meat="meat",e))(qn||{});const Ah={berry:"",meat:""};function yv(e,t){return e+t*65536}function vv(e){return{gridX:e%65536,gridY:Math.floor(e/65536)}}function rw(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function Iv(){return{lastUpdateTime:0,sectors:{}}}const Bt=20,kc=100,Sv=20,Av=0,sw=20,aw=1,Tv=.15,lw=.5,cw=.01,uw=24,dw="#6B5344",fw="#4A3728",A0=.85,Ev=35,hw=30,T0=1.25,E0=40,gf=Math.PI/6,wv=.5,pw=1,Kc=10,Ma=80,_v=3,Zs=5,Wt=150,Cv=Wt*.8,gw=Wt*.2,On=Wt*.8,mo=30,Pv=10,mw=10,yw=.5,Xe=30,Rv=Xe*.75,Qc=30,Mv=Qc*.75,kv=50,vw=20,Iw=Ma*.8,Sw=.7,Dc=16,Th=40,Eh=16,Aw=72/3,w0=24,Tw=1.25,Ew=1.5,_0=Wt*.6,Dv=50,ww=1,wh=Ma*.65,_w=80,Cw=50,Pw=1,Rw=128,Ov=10,C0=100,_h=35,yo=30,Jc=.5,eu=2.5,Ch=20,un=250,Ph=.4,Rh=150,Mh=6,Mw=5,kh=2,tu=.5,nu=1.5,kw=1,Dw=.5,Ow=.5,bw=1.5,Nw=.25,Bw=2.5,Hw=45,Fw=.05;var It=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(It||{}),Ye=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e))(Ye||{}),er=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(er||{});const Oc=24,Lw=24;let Uw=0;function Gw(){return`notification-${Date.now()}-${Uw++}`}function ka(e,t){if(t.identifier){const o=e.notifications.find(s=>s.identifier===t.identifier);if(o){if(o.dismissedUntil&&e.time<o.dismissedUntil)return;o.message=t.message,o.timestamp=e.time,o.creationTime=Date.now(),o.duration=t.duration,o.targetEntityIds=t.targetEntityIds,o.highlightedEntityIds=t.highlightedEntityIds,o.targetPosition=t.targetPosition,o.targetArea=t.targetArea,o.targetRadius=t.targetRadius,o.isDismissed=!1,o.dismissedUntil=void 0;return}}const i={...t,id:Gw(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(i)}function xw(e,t){const i=e.notifications.find(o=>o.id===t);i&&(i.isDismissed=!0,i.identifier&&(i.dismissedUntil=e.time+Lw))}function $w(e){const t=e.time;e.notifications=e.notifications.filter(i=>i.duration===0?!0:!(t-i.timestamp>i.duration))}function Ww(e){for(const i of Object.values(e.entities.entities))i.isHighlighted=!1;const t=e.notifications.filter(i=>!i.isDismissed);for(const i of t)if(i.highlightedEntityIds)for(const o of i.highlightedEntityIds){const s=e.entities.entities[o];s&&(s.isHighlighted=!0)}}function bv(e,t,i,o){const s=Math.random()*Math.PI*2,l=Math.sqrt(Math.random())*t,c={x:Math.cos(s)*l,y:Math.sin(s)*l},d=li(e,c);return{x:(d.x%i+i)%i,y:(d.y%o+o)%o}}function Ni(e,t,i,o){const s=t,{width:l,height:c}=t.mapDimensions,d={left:e.x-i,top:e.y-i,right:e.x+i,bottom:e.y+i},u=h=>{for(let g=0;g<h.length;g++){const y=h[g];if(o!==void 0&&y.id===o)continue;const I=cn(e,y.position,l,c),v=i+y.radius;if(I<v*v)return!0}return!1};return u(s.search.human.byRect(d))||u(s.search.berryBush.byRect(d))||u(s.search.corpse.byRect(d))}function Yw(e,t,i,o,s){const l=t.mapDimensions.width,c=t.mapDimensions.height;if(!Ni(e,t,o,s)&&!ir(t.soilDepletion,e,l,c))return e;const d=o;for(let u=d;u<=i;u+=d){const h=Math.ceil(2*Math.PI*u/d);for(let g=0;g<h;g++){const y=g/h*2*Math.PI,I={x:Math.cos(y)*u,y:Math.sin(y)*u},v=li(e,I),T={x:(v.x%l+l)%l,y:(v.y%c+c)%c};if(!Ni(T,t,o,s)&&!ir(t.soilDepletion,T,l,c))return T}}return null}function ci(e,t){var c,d;const i=t;if((d=(c=i.cache)==null?void 0:c.tribeCenters)!=null&&d[e])return i.cache.tribeCenters[e];const o=t.search.building.byProperty("ownerId",e);if(o.length>0){const u=o.map(h=>h.position);return i.cache.tribeCenters[e]=n0(u)}const s=vo(e,t);if(s.length===0){const u=t.entities.entities[e];return i.cache.tribeCenters[e]=u?u.position:{x:0,y:0}}const l=s.map(u=>u.position);return i.cache.tribeCenters[e]=n0(l)}function P0(e,t,i){const o=i.mapDimensions.width,s=i.mapDimensions.height;let l=e.x-t.position.x,c=e.y-t.position.y;return Math.abs(l)>o/2&&(l-=Math.sign(l)*o),Math.abs(c)>s/2&&(c-=Math.sign(c)*s),Math.abs(l)<=t.width/2&&Math.abs(c)<=t.height/2}const es=80,Jt=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],Ee=20,Hi=(e,t,i)=>{var d,u,h,g;if(!e||!t||e===t)return!1;const o=i.entities.entities[e],s=i.entities.entities[t],l=(u=(d=o==null?void 0:o.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[t],c=(g=(h=s==null?void 0:s.tribeControl)==null?void 0:h.diplomacy)==null?void 0:g[e];return l===It.Hostile||c===It.Hostile},Ga=(e,t,i)=>e.id===t.id?!1:Hi(e.leaderId,t.leaderId,i),tr=(e,t,i)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:Hi(e.leaderId,t.ownerId,i),ls=(e,t,i)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=On||t.hunger>=On||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||Ga(e,t,i))return!1;const o=e.gender==="female"?e:t;return!(o.isPregnant||o.age>Th)},R0=1,Qf=150*.6,zw=800,jw=3,M0=24,Xw=1.5,k0=.15,D0=200,mf=30*.75*1.2,Vw=20,yf=800,qw=.7,Zw=.5,Kw=10,vf=400,Qw=800,Jw=8,e_=16,Dh=100,t_=100,Nv=150,O0=600,b0=250,n_=.5,i_=.7,o_=300,r_=150;function s_(e){const t=Math.floor(e.x/Ee),i=Math.floor(e.y/Ee);return{x:t,y:i}}function Jf(e,t){const i=Math.ceil(t/Ee),o=e%i*Ee+Ee/2,s=Math.floor(e/i)*Ee+Ee/2;return{x:o,y:s}}function a_(e,t,i){const o=(e.x%t+t)%t,s=(e.y%i+i)%i,l=Math.floor(o/Ee),c=Math.floor(s/Ee),d=Math.ceil(t/Ee);return c*d+l}function Xn(e,t,i){const o=a_({x:e,y:t},i.mapDimensions.width,i.mapDimensions.height);return i.terrainOwnership[o]||null}function Oh(e,t){return t.terrainOwnership.includes(e)}function Bv(e,t,i,o){var c;const s=i;return(c=s.search)!=null&&c.human?s.search.human.byRadius(e,o).some(d=>Hi(t,d.leaderId,i)):!1}function l_(e,t,i,o,s=!1,l){if(s&&l&&Bv(e,l,o,Nv))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:c,height:d}=o.mapDimensions,u=Math.ceil(c/Ee),h=Math.ceil(d/Ee),g=Math.ceil(t/Ee),y=t*t,I=Math.floor(e.x/Ee),v=Math.floor(e.y/Ee);let T=!1,A=!1;for(let E=-g;E<=g;E++)for(let C=-g;C<=g;C++){const _=((I+C)%u+u)%u,w=((v+E)%h+h)%h,R=_*Ee+Ee/2,N=w*Ee+Ee/2;if(cn(e,{x:R,y:N},c,d)<=y){const B=w*u+_,G=o.terrainOwnership[B];if(G===i)T=!0;else if(G!==null){if(s&&l&&Hi(l,G,o))continue;A=!0}}}return A?{valid:!1,reason:"Position overlaps with another tribe's territory"}:T?{valid:!0}:Oh(i,o)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function Hv(e,t,i,o){if(!Oh(i,o))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(Bv(e,i,o,Nv))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:l}=o.mapDimensions,c=Math.ceil(s/Ee),d=Math.ceil(l/Ee),u=Math.ceil(t/Ee),h=t*t,g=Math.floor(e.x/Ee),y=Math.floor(e.y/Ee);let I=!1;for(let v=-u;v<=u;v++){for(let T=-u;T<=u;T++){const A=((g+T)%c+c)%c,E=((y+v)%d+d)%d,C=A*Ee+Ee/2,_=E*Ee+Ee/2;if(cn(e,{x:C,y:_},s,l)<=h){const R=E*c+A;if(o.terrainOwnership[R]===i){I=!0;break}}}if(I)break}return I?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function c_(e,t,i,o=0,s=!1,l){if(o>0){const d=l_(e,o,t,i,s,l);return d.valid?{canPlace:!0}:{canPlace:!1,reason:d.reason}}const c=Xn(e.x,e.y,i);return c===null||c===t?{canPlace:!0}:s&&l&&Hi(l,c,i)?{canPlace:!0}:c!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function sr(e,t,i){const o=Xn(e.x,e.y,i);return o===null||o===t||!Hi(t,o,i)}function Fv(e,t,i,o,{allowOverwrite:s}){const{width:l,height:c}=o.mapDimensions,d=Math.ceil(l/Ee),u=Math.ceil(c/Ee),h=Math.ceil(t/Ee),g=Math.floor(e.x/Ee),y=Math.floor(e.y/Ee);for(let _=-h;_<=h;_++)for(let w=-h;w<=h;w++){const R=((g+w)%d+d)%d,N=((y+_)%u+u)%u,D=R*Ee+Ee/2,B=N*Ee+Ee/2;if(z(e,{x:D,y:B},l,c)<=t){const $=N*d+R,V=o.terrainOwnership[$];(s||V===null||V===i)&&(o.terrainOwnership[$]=i)}}const I=3,v=h+I+2,T=[];for(let _=-v;_<=v;_++)for(let w=-v;w<=v;w++){const R=((g+w)%d+d)%d,N=((y+_)%u+u)%u,D=N*d+R;if(o.terrainOwnership[D]===null){let B=!1;const G=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const $ of G){let V=!1,X=!1;for(let q=1;q<=I;q++){const re=((R+$.x*q)%d+d)%d,ne=((N+$.y*q)%u+u)%u*d+re;if(o.terrainOwnership[ne]===i){V=!0;break}}if(V)for(let q=1;q<=I;q++){const re=((R-$.x*q)%d+d)%d,ne=((N-$.y*q)%u+u)%u*d+re;if(o.terrainOwnership[ne]===i){X=!0;break}}if(V&&X){B=!0;break}}B&&T.push(D)}}for(const _ of T)o.terrainOwnership[_]=i;const A=250,E=new Set;for(let _=-v;_<=v;_++)for(let w=-v;w<=v;w++){const R=((g+w)%d+d)%d,D=((y+_)%u+u)%u*d+R;if(o.terrainOwnership[D]===null&&!E.has(D)){const B=[],G=[D];E.add(D),B.push(D);let $=!0,V=0;for(;V<G.length;){const X=G[V++];if(B.length>A){$=!1;break}const q=X%d,re=Math.floor(X/d),ee=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:ne,ny:oe}of ee){const te=((q+ne)%d+d)%d,Q=((re+oe)%u+u)%u*d+te;o.terrainOwnership[Q]===null&&!E.has(Q)&&(E.add(Q),$&&(B.push(Q),G.push(Q)))}}if($&&B.length<=A)for(const X of B)o.terrainOwnership[X]=i}}const C=[];for(let _=-v;_<=v;_++)for(let w=-v;w<=v;w++){const R=((g+w)%d+d)%d,N=((y+_)%u+u)%u,D=N*d+R;if(o.terrainOwnership[D]===null){let B=0;for(let G=-1;G<=1;G++)for(let $=-1;$<=1;$++){if($===0&&G===0)continue;const V=((R+$)%d+d)%d,q=((N+G)%u+u)%u*d+V;o.terrainOwnership[q]===i&&B++}B>=5&&C.push(D)}}for(const _ of C)o.terrainOwnership[_]=i}function Lv(e,t,i,o){Fv(e,t,i,o,{allowOverwrite:!1})}function Uv(e,t,i,o){Fv(e,t,i,o,{allowOverwrite:!0})}function bc(e,t,i){const o=e.terrainOwnership;for(let s=0;s<o.length;s++)o[s]===t&&(o[s]=i)}function je(e,t,i,o,s){const l=t,c=o,d="position"in e&&e.id?e:null,u=d?d.position:e,h=l.search[i].byRadius(u,c);let g=null,y=c;for(const I of h){if(I.id===(d==null?void 0:d.id)||s&&!s(I))continue;const v=z(u,I.position,t.mapDimensions.width,t.mapDimensions.height);v<y&&(y=v,g=I)}return g}function At(e){const i=e.search.human.byProperty("isPlayer",!0);return i.length>0?i[0]:void 0}function u_(e,t){var c;const o=t.search.human.byProperty("activeAction","attacking");let s=null,l=1/0;for(const d of o){if(d.attackTargetId!==e)continue;const u=z(d.position,((c=t.entities.entities[e])==null?void 0:c.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<l&&(s=d,l=u)}return s}function Gv(e){return e.search.human.all()}function d_(e,t,i){const{width:o,height:s}=t.mapDimensions,l=Object.values(t.entities.entities).reverse();for(const c of l){const d=z(e,c.position,o,s),u=c.type==="tree"?c.radius*2:c.radius;if(d<u)return c}}function f_(e,t,i,o,s){const{width:l,height:c}=o.mapDimensions,d=i*i;if(s){for(let I=0;I<s.length;I++)if(cn(e,s[I],l,c)<d)return!0;return!1}const u=Gv(o),h=new Set;for(let I=0;I<u.length;I++){const v=u[I];v.leaderId&&v.leaderId!==t&&h.add(v.leaderId)}const g=h.values();let y=g.next();for(;!y.done;){const I=y.value,v=ci(I,o);if(cn(e,v,l,c)<d)return!0;y=g.next()}return!1}var ye=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(ye||{});function be(e,t,i,o,s,l,c){const d={id:e.nextVisualEffectId,type:t,position:i,startTime:e.time,duration:o,entityId:s,targetPosition:l,targetEntityId:c};return e.visualEffects.push(d),e.nextVisualEffectId++,d.id}const xe=1,Da=3,Ci=100,xv=20,jo=10,h_=.5,ma=150,p_=25,g_=.5,eh=100,$v=25,m_=.5,y_=15,th=4,v_=.75,I_=15,S_=8,A_=20;function Oa(e,t,i,o,s,l){if(i===void 0)return!1;const{width:c,height:d}=o.mapDimensions;if(s&&l!==void 0&&cn(s,e,c,d)>l*l)return!1;const u=fh(t),h=Math.sqrt(u.width*u.width+u.height*u.height)/2;if(Ni(e,o,h*.8))return!1;if(t===de.PlantingZone){const{depletedSectors:A}=dI(o.soilDepletion,e,u.width,u.height,c,d);if(A.length>0)return!1}const y=o.search.building.byRadius(e,h*2);for(const A of y){const E=cn(e,A.position,c,d),C=(Math.max(u.width,u.height)+Math.max(A.width,A.height))/2;if(E<C*C*.81)return!1}const I=t===de.BorderPost;return!!c_(e,i,o,I?Ly:es,I,i).canPlace}function T_(e){const t=[],i=2*Math.PI/e;for(let o=0;o<e;o++){const s=o*i;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function If(e,t,i,o,s,l,c){const d=performance.now(),u=i,h=fh(e),g=i.mapDimensions.width,y=i.mapDimensions.height,I=u.search.building.byProperty("ownerId",t),v=[];if(I.length>0){l&&v.unshift(l);const _=ci(t,i),w=[...I].sort((R,N)=>{const D=cn(R.position,_,g,y),B=cn(N.position,_,g,y);return D-B});v.push(...w.map(R=>R.position))}else v.push(ci(t,i));const T=Math.min(v.length,Jw),A=Math.max(h.width,h.height),E=A+20,C=A/2;for(let _=0;_<T;_++){const w=v[_];for(let R=E;R<=o;R+=C){const N=Math.max(8,Math.min(e_,Math.ceil(2*Math.PI*R/A))),D=T_(N);for(let B=0;B<N;B++){const G=D[B].cos*R,$=D[B].sin*R,V=w.x+G,X=w.y+$,q=(V%g+g)%g,re=(X%y+y)%y;if(!f_({x:q,y:re},t,s,i,c)&&Oa({x:q,y:re},e,t,i))return performance.now()-d,{x:q,y:re}}}}performance.now()-d}function bh(e,t,i,o){if(t===de.BorderPost)return Uv(e,Ly,i,o),be(o,ye.BorderClaim,e,xe,i),null;const s=$M(o.entities,e,t,i);return t===de.Bonfire&&(s.storageCapacity=th,s.storedItems=[]),Lv(e,es,i,o),t===de.PlantingZone&&_a(o),s}function nh(e,t){const i=t.entities.entities[e];i&&i.type==="building"&&!i.isBeingDestroyed&&(i.isBeingDestroyed=!0,i.destructionProgress=0,i.buildingType===de.PlantingZone&&_a(t))}function E_(e,t){const s=t.search.building.byRadius(e,100);for(const l of s){let c=e.x-l.position.x,d=e.y-l.position.y;const u=t.mapDimensions.width,h=t.mapDimensions.height;if(Math.abs(c)>u/2&&(c-=Math.sign(c)*u),Math.abs(d)>h/2&&(d-=Math.sign(d)*h),Math.abs(c)<=l.width/2&&Math.abs(d)<=l.height/2)return l}}const ft=30,cs=ft*.6,Wv="#4CAF50",Yv="#FF5722",zv="#9C27B0",w_="#2196F3",jv="#FFC107",__="#DC143C",Nh="#FFFFFF",Bh=[5,5],iu=5,ts=15,C_=20,P_=16,R_=10,M_=16,k_=16,Nc=["","","","","","","","","",""],ya=8,D_="#FFFFFF",ln=18,qe=15,O_="rgba(0, 0, 0, 0.7)",b_=4,io=150,gn=15,Ii=10,co="#555",N_="#f44336",B_="#4CAF50",H_="#2196F3",F_="#FFC107",oc=16,wi=32,rc=28,L_=10,U_=8,G_=8,x_=8,Fo=28,Ks=40,Qs=10,N0=8,$_=11,Sf=40,B0=5,W_=10,Y_="#FFA500",z_="#808080",Pi=120,Xv=30,j_=20,In="#2d3748",St="#ffffff",ua="#4a5568",Vv=5,Hh="#bdc9f792",qv="#272c36ff",Zv="#a0aec0",Bc=300,Kv="rgba(255, 255, 255, 0.5)",X_="rgba(0, 0, 0, 0.8)",V_="#FFFFFF",H0=14,F0=8,L0=-15,Qv="#FFD700",Jv=5,q_="rgba(0, 0, 0, 0.5)",Z_="#FFFFFF",K_=33,Q_=400,J_=20,e1=10,t1="rgba(0, 0, 0, 0.7)",n1="#FFFFFF",Af=20,U0=16,i1=.5,G0=5,eI="#FFD700",o1=40,Fh=4,tI=3,r1=5,nI=20,iI=5,s1="#FFFFFF",a1="#FF6B6B",mn=80,Lo=10,sc=300,Uo=15,l1=8,c1="rgba(0, 0, 0, 0.8)",u1="#FFFFFF",Tf=14,x0=10,ii=20,d1="#FF6B6B",f1="#4CAF50",$0="#FFD700",h1="rgba(255, 255, 0, 0.3)",p1=2,g1=500,m1=120,y1=45,v1="#FFD700",I1=3,S1=4,Ef=225,W0=20,A1="#666",T1="#1a2a3a";let wf=0;function Hc(){const e=Nc[wf];return wf=(wf+1)%Nc.length,e}function ns(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),i=e.filter(s=>s.gender==="female"),o=(s,l)=>s.age!==l.age?l.age-s.age:s.id-l.id;if(t.sort(o),t.length>0)return t[0];if(i.sort(o),i.length>0)return i[0]}function Bi(e,t){const i=e,o=i.search.human.byProperty("motherId",t.id),s=i.search.human.byProperty("fatherId",t.id);return[...o,...s]}function ih(e,t){var l,c,d,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(l=e.partnerIds)!=null&&l.includes(t.id)||(c=t.partnerIds)!=null&&c.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const i=e.motherId===t.motherId||e.fatherId===t.fatherId,o=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((d=e.ancestorIds)==null?void 0:d.some(h=>t.ancestorIds.includes(h)))||((u=t.ancestorIds)==null?void 0:u.some(h=>e.ancestorIds.includes(h)));return i||o||s}function oI(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const i of e.partnerIds){const o=t.entities.entities[i];if(o&&o.gender==="male")return o}return null}function Y0(e,t){var i;if(!e.isAdult){if(e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human")return o}if(e.motherId){const o=t.entities.entities[e.motherId];if(o&&o.type==="human")return o}}if(e.isAdult&&e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human"&&((i=ns(Bi(t,o)))==null?void 0:i.id)===e.id)return o}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?oI(e,t):null}function E1(e,t){let i=e;const o=new Set;o.add(i.id);for(let s=0;s<_v;s++){let l=null;if(i.gender==="female"&&(l=oI(i,t)),!l&&i.fatherId&&(l=t.entities.entities[i.fatherId]||null),!l||o.has(l.id))break;i=l,o.add(i.id)}return i}function w1(e,t){var o;const i=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&i.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&i.add(s)}return(o=e.partnerIds)==null||o.forEach(s=>{const l=t.entities.entities[s];l&&i.add(l)}),Bi(t,e).forEach(s=>i.add(s)),Array.from(i)}function Fc(e,t){const i=new Map;function o(s){const l=Bi(t,s);for(const c of l)i.has(c.id)||(i.set(c.id,c),o(c))}return o(e),Array.from(i.values())}function vo(e,t){return t.search.human.byProperty("leaderId",e)}function Lc(e,t,i=new Map,o=new Set){var l;if(i.has(e))return i.get(e);if(o.has(e))return e;o.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((l=s.partnerIds)!=null&&l.length)){const c=s.partnerIds.find(d=>{const u=t.entities.entities[d];return u&&u.gender==="male"});if(c){const d=Lc(c,t,i,o);return i.set(e,d),d}}if(s.fatherId&&t.entities.entities[s.fatherId]){const c=Lc(s.fatherId,t,i,o);return i.set(e,c),c}return i.set(e,e),e}function _1(e,t){e.leaderId=e.id,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{diplomacy:{}}),e.tribeInfo||(e.tribeInfo={tribeBadge:Hc(),tribeColor:Jt[Math.floor(Math.random()*Jt.length)]}),e.tribeControl||(e.tribeControl={diplomacy:{}})}function C1(e,t){if(e.length===0)return null;const i=new Map,o=new Map;for(const c of e){const d=Lc(c.id,t,i);o.has(d)||o.set(d,[]),o.get(d).push(c)}let s=null,l=0;for(const[c,d]of o.entries())d.length>l&&(l=d.length,s=c);return s&&t.entities.entities[s]||null}function ou(e,t){var g,y,I;const i=new Map;for(let v=0;v<e.terrainOwnership.length;v++){const T=e.terrainOwnership[v];T!==null&&(i.has(T)||i.set(T,[]),i.get(T).push(v))}const{width:o,height:s}=e.mapDimensions,l=Math.ceil(o/Ee),c=new Map,d=Object.values(e.entities.entities).filter(v=>v.type==="human");for(const v of d)v.leaderId&&(c.has(v.leaderId)||c.set(v.leaderId,{leaderId:v.leaderId,tribeInfo:v.tribeInfo,members:[]}),(g=c.get(v.leaderId))==null||g.members.push(v));const u=t?(I=(y=e.entities.entities[t])==null?void 0:y.tribeControl)==null?void 0:I.diplomacy:void 0,h=Array.from(c.values()).map(v=>{var w,R;const T=e.entities.entities[v.leaderId],A=v.members.filter(N=>N.isAdult).length,E=v.members.length-A,C=i.get(v.leaderId)||[];let _=T==null?void 0:T.position;if(C.length>0){const N=C[0],D=N%l*Ee,B=Math.floor(N/l)*Ee,G={x:D,y:B};let $=0,V=0;for(const re of C){const ee=re%l*Ee,ne=Math.floor(re/l)*Ee,oe=ze(G,{x:ee,y:ne},o,s);$+=oe.x,V+=oe.y}const X=$/C.length,q=V/C.length;_={x:((G.x+X)%o+o)%o,y:((G.y+q)%s+s)%s}}return{leaderId:v.leaderId,tribeBadge:((w=v==null?void 0:v.tribeInfo)==null?void 0:w.tribeBadge)||"",tribeColor:((R=v==null?void 0:v.tribeInfo)==null?void 0:R.tribeColor)||"",adultCount:A,childCount:E,isPlayerTribe:v.leaderId===t,leaderAge:(T==null?void 0:T.age)??0,leaderGender:(T==null?void 0:T.gender)??"male",diplomacyStatus:(u==null?void 0:u[v.leaderId??-1])??It.Friendly,territoryCenter:_}});return h.sort((v,T)=>v.isPlayerTribe?-1:T.isPlayerTribe?1:T.adultCount+T.childCount-(v.adultCount+v.childCount)),h}function rI(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function sI(e){var l;const t=new Set,o=e.search.human.all(),s=new Map;for(const c of o)c.leaderId&&(s.has(c.leaderId)||s.set(c.leaderId,[]),(l=s.get(c.leaderId))==null||l.push(c));for(const[c,d]of s){if(d.length===0)continue;const u=e.entities.entities[c],h=!u,g=u&&u.leaderId!==c;(h||g)&&t.add(c)}for(let c=0;c<e.terrainOwnership.length;c++){const d=e.terrainOwnership[c];d!==null&&!s.has(d)&&t.add(d)}return Array.from(t)}function P1(e,t){const i=new Map,s=t.search.human.all(),l=w1(e,t);for(const d of l)i.set(d,3);for(const d of s)d.id===e.id||i.has(d)||ih(e,d)&&i.set(d,2);const c=Array.from(i.keys());for(const d of c)if(d.partnerIds)for(const u of d.partnerIds){const h=t.entities.entities[u];h&&!i.has(h)&&h.id!==e.id&&i.set(h,1)}return i}function R1(e,t){const i=vo(e,t);if(i.length===0)return null;const o=t.entities.entities[e];if(o&&o.leaderId&&o.leaderId!==o.id)return o.leaderId;const s=new Map;for(const d of i){const u=P1(d,t);for(const[h,g]of u)if(h.leaderId&&h.leaderId!==e){const y=h.leaderId,I=t.entities.entities[y];if(I&&I.leaderId===I.id){const v=s.get(y)||0;s.set(y,v+g)}}}let l=null,c=0;for(const[d,u]of s)u>c&&(c=u,l=d);return l}function z0(e,t,i){var g,y;const o=vo(e,i);let s=i.entities.entities[t];if(!s||(s.leaderId&&i.entities.entities[s.leaderId]&&(t=s.leaderId,s=i.entities.entities[t]),!s))return;const l=o.length>0?(g=o[0].tribeInfo)==null?void 0:g.tribeBadge:"?",c=s.leaderId===e||!s.leaderId;if(c){const I=i.entities.entities[e];_1(s,I)}const d=((y=s.tribeInfo)==null?void 0:y.tribeBadge)??"?";for(const I of o)I.id!==t&&(I.leaderId=t,I.tribeInfo=s.tribeInfo);const h=i.search.building.byProperty("ownerId",e);for(const I of h)I.ownerId=t;bc(i,e,t),ka(i,{identifier:`tribe-merge-${e}`,type:er.TribeMerged,message:c?`Tribe ${l} has a new leader!`:`Tribe ${l} has merged into Tribe ${d}!`,duration:Oc,targetEntityIds:[t],highlightedEntityIds:[t,...o.map(I=>I.id)]})}function M1(e){var i;const t=sI(e);for(const o of t){const s=vo(o,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",o);for(const h of u)nh(h.id,e);bc(e,o,null),ka(e,{identifier:`tribe-dissolved-${o}`,type:er.TribeMerged,message:"An extinct tribe has been dissolved.",duration:Oc});continue}const l=C1(s,e);if(l){z0(o,l.id,e);continue}const c=R1(o,e);if(c)z0(o,c,e);else{const d=s.length>0?(i=s[0].tribeInfo)==null?void 0:i.tribeBadge:"?";for(const g of s)g.leaderId=void 0,g.tribeInfo=void 0;const h=e.search.building.byProperty("ownerId",o);for(const g of h)nh(g.id,e);bc(e,o,null),ka(e,{identifier:`tribe-dissolved-${o}`,type:er.TribeMerged,message:`Tribe ${d} has been dissolved due to lack of leadership.`,duration:Oc})}}}var kt=(e=>(e.Wood="wood",e))(kt||{});const Lh={wood:""},zn="treeGrowing",bn="treeFull",ui="treeSpreading",Yt="treeFallen",bi="treeStump",nr="treeDying";function aI(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const i=rI({leaderId:e},t),o=0,c=t.search.building.byProperty("ownerId",e).reduce((T,A)=>{if(A.isConstructed)return T;const E=To[A.buildingType].cost.wood||0;return T+E},0),u=B1(e,t).reduce((T,A)=>{const C=(A.maxFuelLevel||eh)-(A.fuelLevel||0);if(C<=0)return T;const _=Math.ceil(C/$v),w=A.storedItems.filter(N=>N.item.type===kt.Wood).length,R=Math.max(0,_-w);return T+R},0),g=N1(e,t).reduce((T,A)=>{var C;const E=(C=A.storedItems)==null?void 0:C.filter(_=>_.item.type===kt.Wood);return T+((E==null?void 0:E.length)||0)},0),y=i.reduce((T,A)=>{var E;return T+(((E=A.heldItem)==null?void 0:E.type)===kt.Wood?1:0)},0),I=g+y,v=c+u+o;return t.cache.tribeWoodNeeds[e]=Math.max(0,v-I),t.cache.tribeWoodNeeds[e]}function k1(e,t){const i=t;if(e&&i.cache.tribeAvailableWoodOnGround[e]!==void 0)return i.cache.tribeAvailableWoodOnGround[e];const o=i.search.tree.all().filter(s=>!(s.stateMachine[0]===Yt)||s.wood.length===0?!1:sr(s.position,e,t));return i.cache.tribeAvailableWoodOnGround[e]=o.reduce((s,l)=>s+l.wood.length,0),i.cache.tribeAvailableWoodOnGround[e]}function D1(e,t,i=!1){const o=typeof e=="object"?e.leaderId:e;return o?t.search.building.byProperty("buildingType",de.PlantingZone).filter(l=>{if(!i&&!l.isConstructed)return!1;if(l.ownerId){const c=t.entities.entities[l.ownerId];return c&&c.leaderId===o}return!1}):[]}function O1(e,t){const{width:i,height:o,position:s}=e,{width:l,height:c}=t.mapDimensions,{depletedSectors:d,totalSectorsCount:u}=dI(t.soilDepletion,s,i,o,l,c);return u===0?!0:d.length/u<.25}function lI(e){const t=Zc*2,i=Math.floor(e.width/t),o=Math.floor(e.height/t);return i*o}function b1(e,t){const i=t,o=Math.max(e.width,e.height);return i.search.berryBush.byRadius(e.position,o).filter(c=>{const d=Math.abs(c.position.x-e.position.x),u=Math.abs(c.position.y-e.position.y);return d<=e.width/2&&u<=e.height/2}).length}function N1(e,t,i=!1){return t.search.building.byProperty("buildingType",de.StorageSpot).filter(s=>{if(!i&&!s.isConstructed)return!1;if(s.ownerId){const l=t.entities.entities[s.ownerId];return l&&l.leaderId===e}return!1})}function B1(e,t,i=!1){return t.search.building.byProperty("buildingType",de.Bonfire).filter(s=>{if(!i&&!s.isConstructed)return!1;if(s.ownerId){const l=t.entities.entities[s.ownerId];return l&&l.leaderId===e}return!1})}function xa(e,t,i=void 0){return i?D1(i,t).some(c=>P0(e,c,t)):t.search.building.byRadius(e,60).some(l=>l.buildingType===de.PlantingZone&&P0(e,l,t))}function ru(e,t,i){const o=(e.x%t+t)%t,s=(e.y%i+i)%i;return{gridX:Math.floor(o/Bt),gridY:Math.floor(s/Bt)}}function cI(e,t,i){const o=yv(t,i);return e.sectors[o]||(e.sectors[o]=rw()),e.sectors[o]}function Uh(e,t,i){const o=yv(t,i),s=e.sectors[o];return s?s.health:kc}function ir(e,t,i,o){const{gridX:s,gridY:l}=ru(t,i,o);return Uh(e,s,l)<Sv}function uI(e,t,i){return Uh(e,t,i)>=Sv}function H1(e,t,i,o,s,l,c){const{gridX:d,gridY:u}=ru(t,s,l),h=cI(e,d,u),g=h.lastAffectedBy[i]||0;if(o-g<Tv)return;const y=xa(t,c)?wv:1,I=aw*y;h.health=Math.max(Av,h.health-I),h.lastWalkTime=o,h.lastAffectedBy[i]=o}function F1(e,t,i,o,s,l){const{gridX:c,gridY:d}=ru(t,o,s),u=cI(e,c,d),h=xa(t,l)?wv:1,g=sw*h;u.health=Math.max(Av,u.health-g),u.lastPlantTime=i}function L1(e,t,i,o,s){let l=0;for(let c=-1;c<=1;c++)for(let d=-1;d<=1;d++){if(c===0&&d===0)continue;const u=((t+c)%o+o)%o,h=((i+d)%s+s)%s;uI(e,u,h)&&l++}return l}function U1({soilDepletion:e,time:t,mapDimensions:{width:i,height:o}}){if(t-e.lastUpdateTime<pw)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const l=Math.ceil(i/Bt),c=Math.ceil(o/Bt),d=[];for(const u of Object.keys(e.sectors)){const h=Number(u),g=e.sectors[h],y=Math.max(g.lastWalkTime,g.lastPlantTime);if(t-y<uw)continue;const{gridX:I,gridY:v}=vv(h),T=L1(e,I,v,l,c),A=T>0?cw*(T/8):0,E=lw+A;g.health=Math.min(kc,g.health+E*s),g.health>=kc&&d.push(h);const C=t-Tv*10;for(const _ of Object.keys(g.lastAffectedBy)){const w=Number(_);g.lastAffectedBy[w]<C&&delete g.lastAffectedBy[w]}}for(const u of d)delete e.sectors[u]}function G1(e,t){const i=[];for(const o of Object.keys(e.sectors)){const s=Number(o),l=e.sectors[s];if(l.health<t){const{gridX:c,gridY:d}=vv(s);i.push({gridX:c,gridY:d,health:l.health})}}return i}function dI(e,t,i,o,s,l){const c=[],d=i/2,u=o/2,h=t.x-d,g=t.x+d,y=t.y-u,I=t.y+u,v=Math.floor(h/Bt),T=Math.floor((g-.001)/Bt),A=Math.floor(y/Bt),E=Math.floor((I-.001)/Bt),C=Math.ceil(s/Bt),_=Math.ceil(l/Bt);let w=0;for(let R=v;R<=T;R++)for(let N=A;N<=E;N++){w++;const D=(R%C+C)%C,B=(N%_+_)%_;uI(e,D,B)||c.push({gridX:D,gridY:B})}return{depletedSectors:c,totalSectorsCount:w}}function j0(e,t,i,o,s){const{gridX:l,gridY:c}=ru(t,i,o),d=Uh(e,l,c);return 1+(s-1)*Math.sqrt(1-d/kc)}const x1={id:ga,update:(e,t)=>{const{entity:i,updateContext:o}=t,s=o.deltaTime*(Mt/Ht);if(i.age+=s,i.age>=i.lifespan)return{nextState:Ra,data:{...e,enteredAt:o.gameState.time}};if(!ir(o.gameState.soilDepletion,i.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height)){const c=xa(i.position,o.gameState)?ow:1;i.timeSinceLastBerryRegen+=s*c,i.timeSinceLastBerryRegen>=ew&&i.food.length<i.maxFood&&(i.food.push({itemType:"food",type:qn.Berry}),i.timeSinceLastBerryRegen=0)}return i.food.length>=i.maxFood?{nextState:$o,data:{...e,enteredAt:o.gameState.time,previousState:ga}}:{nextState:ga,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},$1={id:$o,update:(e,t)=>{const{entity:i,updateContext:o}=t,s=o.deltaTime*(Mt/Ht);if(i.age+=s,i.age>=i.lifespan)return{nextState:Ra,data:{...e,enteredAt:o.gameState.time,previousState:$o}};if(i.food.length<i.maxFood)return{nextState:ga,data:{...e,enteredAt:o.gameState.time,previousState:$o}};if(i.timeSinceLastSpreadAttempt+=s,i.timeSinceLastSpreadAttempt>=S0){i.timeSinceLastSpreadAttempt=0;const c=o.gameState.time-i.timeSinceLastHarvest>=S0,d=xa(i.position,o.gameState)?iw:1,u=o.gameState.ecosystem.berryBushSpreadChance*d;if(c&&Math.random()<u)return{nextState:Ac,data:{...e,enteredAt:o.gameState.time,previousState:$o}}}return{nextState:$o,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function X0(e){return e.filter(t=>t.isAdult).reduce((t,i)=>{let o=i.hitpoints;return o+=(i.maxAge-i.age)*.5,o+=i.food.length*2,t+o},0)}var ue=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(ue||{});const su={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},fI={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var Hr=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(Hr||{});const Js={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var me=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenTribeModal="OpenTribeModal",e.RecenterCamera="RecenterCamera",e.CloseTribeModal="CloseTribeModal",e))(me||{});const _f=30,W1=.4,Y1=100,z1=72,hI=10,pI=2,V0=600,j1=1.5,gI=.1,Cf=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,Pf=""+new URL("gather-CU75596W.mp3",import.meta.url).href,X1=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,q0=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,V1=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,q1=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,Z1=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,K1=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,Q1=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,J1=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Ie=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Ie||{});const eC=new Map([[0,Cf],[1,Pf],[2,X1],[3,q0],[4,V1],[5,q1],[6,Z1],[12,K1],[13,Q1],[7,Cf],[8,q0],[9,Pf],[10,Pf],[11,Cf],[14,J1]]);let ea,ba;function tC(){if(!(typeof window>"u"))return ba}function Gh(){if(!(typeof window>"u"))return!ea&&typeof window.AudioContext=="function"&&(ea=new window.AudioContext,ba=ea.createGain(),ba.connect(ea.destination),va(.1,!1)),ea}function va(e,t){ba&&(ba.gain.value=t?0:e/10)}const mI=new Map;let ac=!1,Z0=!1;async function nC(){if(Z0||ac)return;const e=Gh();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),ac=!0,console.log("Starting sound loading...");const t=[];eC.forEach((i,o)=>{const s=fetch(i).then(l=>{if(!l.ok)throw new Error(`Failed to fetch sound: ${i}`);return l.arrayBuffer()}).then(l=>e.decodeAudioData(l)).then(l=>{mI.set(o,l)}).catch(l=>{console.error(`Error loading sound ${Ie[o]} from ${i}:`,l)});t.push(s)});try{await Promise.all(t),Z0=!0,ac=!1,console.log("All sounds loaded successfully.")}catch(i){ac=!1,console.error("An error occurred while loading sounds:",i)}}const Ia=new Map;function xh(e,t){const i=Gh(),o=tC();if(!i||!o||o.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;i.state==="suspended"&&i.resume();const s=mI.get(e);if(!s){console.warn(`Sound buffer not found for type: ${Ie[e]}`);return}if(t!=null&&t.trackId&&Ia.has(t.trackId))return;const l=i.createBufferSource();l.buffer=s,l.loop=(t==null?void 0:t.loop)??!1;const c=i.createGain(),d=i.createStereoPanner();let u=c;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const h=ze(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),g=z(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(g>V0)return;const y=1-Math.pow(g/V0,j1);c.gain.value=Math.max(0,y);const I=Math.sin(h.x/g*(Math.PI/2));d.pan.value=isNaN(I)?0:I,c.connect(d),u=d}else{const h=e===Ie.GameOver?.4:e===Ie.SoundTrack1?1:.2;c.gain.value=h}l.connect(u),u.connect(o),l.start(0),t!=null&&t.trackId&&(Ia.set(t.trackId,{sourceNode:l,gainNode:c}),l.onended=()=>{Ia.delete(t.trackId)})}function Rf(e,t=1){const i=Ia.get(e),o=Gh();if(i&&o){const{sourceNode:s,gainNode:l}=i,c=o.currentTime;l.gain.setValueAtTime(l.gain.value,c),l.gain.linearRampToValueAtTime(0,c+t),s.stop(c+t),s.onended=null,Ia.delete(e)}}function we(e,t,i){const o=At(e.gameState);o&&xh(t,{position:i,listenerPosition:o.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}const Oe={create(){return{data:{}}},set({data:e},t,i){e[t]=i},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e}},iC="tribeSplit_phase",au="tribeSplit_strategy",yI="tribeSplit_targetPosition",$h="tribeSplit_targetBuildingId",Wh="tribeSplit_familyIds",vI="tribeSplit_lastFailureTime";function oC(e,t){Oe.set(e,iC,"idle"),Oe.delete(e,au),Oe.delete(e,yI),Oe.delete(e,$h),Oe.delete(e,Wh),Oe.set(e,vI,t)}function rC(e,t){const i=Oe.get(e,vI);return i?t-i>=z1:!0}function II(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(sI(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!rC(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const o=t.entities.entities[e.leaderId];if(!o||o.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=ns(Bi(t,o));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(E1(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const c=vo(e.leaderId,t).filter(v=>v.isAdult);if(c.length<_f)return{canSplit:!1,reason:"Tribe too small"};const u=Fc(e,t).length+1,g=Fc(o,t).length+1;if(u>=g&&u>_f)return{canSplit:!0,progress:1,strategy:K0(e,t)};const y=Math.max(c.length*W1,_f),I=u/y;if(u>=y){const v=K0(e,t);return{canSplit:!0,progress:I,strategy:v}}return{canSplit:!1,progress:I,reason:`Family too small: ${u} < ${y}`}}function K0(e,t){if(!e.leaderId)return"migration";const i=t;if(!(Xn(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=i.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===de.StorageSpot&&l.isConstructed);return s.length>0&&s.find(c=>z(e.position,c.position,t.mapDimensions.width,t.mapDimensions.height)<=Y1)?"concentration":"migration"}function sC(e,t){if(!e.aiBlackboard)return!1;const i=Oe.get(e.aiBlackboard,au);if(!i)return!1;const o=Fc(e,t),s=[e.id,...o.map(l=>l.id)];return Oe.set(e.aiBlackboard,Wh,s),i==="migration"?lC(e,t):i==="concentration"?cC(e,t):!1}function aC(e,t,i){if(Ni(e,i,30))return!1;const s=Xn(e.x,e.y,i);return!(s===t||s!==null&&s!==t)}function lC(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const i=t.mapDimensions.width,o=t.mapDimensions.height,s=Math.min(i,o)/2,l=50,c=50;for(let d=0;d<=s;d+=l){const u=d===0?1:Math.max(8,Math.ceil(2*Math.PI*d/c)),h=d===0?0:2*Math.PI/u;for(let g=0;g<u;g++){const y=g*h,I=Math.cos(y)*d,v=Math.sin(y)*d,T=e.position.x+I,A=e.position.y+v,E={x:(T%i+i)%i,y:(A%o+o)%o};if(aC(E,e.leaderId,t))return Oe.set(e.aiBlackboard,yI,E),!0}}return!1}function cC(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const o=t.search.building.byProperty("ownerId",e.leaderId).filter(c=>c.buildingType===de.StorageSpot&&c.isConstructed);if(o.length===0)return!1;let s=null,l=1/0;for(const c of o){const d=z(e.position,c.position,t.mapDimensions.width,t.mapDimensions.height);d<l&&(l=d,s=c)}return s?(Oe.set(e.aiBlackboard,$h,s.id),!0):!1}function uC(e,t){var u;if(!e.aiBlackboard)return!1;const i=Oe.get(e.aiBlackboard,au),o=Oe.get(e.aiBlackboard,Wh);if(!i||!o)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,l=Hc(),c=Jt[Math.floor(Math.random()*Jt.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:l,tribeColor:c},e.tribeControl={diplomacy:{}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=It.Hostile);for(const h of o){if(h===e.id)continue;const g=t.entities.entities[h];!g||g.type!=="human"||(g.leaderId=e.id,g.tribeInfo={tribeBadge:l,tribeColor:c})}if(i==="concentration"){const h=Oe.get(e.aiBlackboard,$h);if(h){const g=t.entities.entities[h];g&&g.type==="building"&&(g.ownerId=e.id)}}return ka(t,{type:er.NewTribeFormed,message:`A new tribe has formed via ${i}! ${l}`,duration:Oc,targetEntityIds:[e.id],highlightedEntityIds:o}),we({gameState:t},Ie.TribeSplit,e.position),oC(e.aiBlackboard,t.time),!0}function dC(e,t){Oe.set(e,au,t)}function SI(e,t){const i=II(e,t);return{canSplit:i.canSplit,progress:i.progress}}function AI(e,t){if(!e.aiBlackboard)return;const i=II(e,t);!i.canSplit||!i.strategy||(dC(e.aiBlackboard,i.strategy),sC(e,t)&&uC(e,t))}const fC=20,Vn=30,hC=.5,pC=.3,gC=2,mC=50;function Yh(e,t){var l;const i=[];if(t.food.length>0&&t.hunger>mo&&i.push({type:ue.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const c=je(t,e,"berryBush",Xe,h=>h.food.length>0),d=je(t,e,"corpse",Xe,h=>h.food.length>0);let u=null;c&&d?u=z(t.position,c.position,e.mapDimensions.width,e.mapDimensions.height)<=z(t.position,d.position,e.mapDimensions.width,e.mapDimensions.height)?c:d:u=c||d,u&&i.push({type:ue.Gather,action:"gathering",key:"e",targetEntity:u})}const o=je(t,e,"human",Xe,c=>ls(t,c,e));if(o&&i.push({type:ue.Procreate,action:"procreating",key:"r",targetEntity:o}),t.food.length>0&&t.isAdult){const c=je(t,e,"human",Xe,d=>{const u=d;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=mo});c&&i.push({type:ue.FeedChild,action:"feeding",key:"h",targetEntity:c})}const s=je(t,e,"human",un,c=>Ga(t,c,e))??je(t,e,"predator",un)??je(t,e,"prey",un);if(s&&i.push({type:ue.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(c=>c.type===qn.Berry).length>=Jo&&i.push({type:ue.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const c=je(t,e,"building",Vn,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});c&&i.push({type:ue.Deposit,action:"idle",key:"x",targetEntity:c})}if(t.food.length<t.maxFood&&t.isAdult){const c=je(t,e,"building",Vn,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});c&&i.push({type:ue.Retrieve,action:"idle",key:"z",targetEntity:c})}if(((l=t.heldItem)==null?void 0:l.type)===kt.Wood){const c=je(t,e,"building",Vn,d=>{const u=d;return u.buildingType===de.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});c&&i.push({type:ue.Deposit,action:"depositing",key:"x",targetEntity:c})}if(SI(t,e).canSplit&&i.push({type:ue.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const c=je(t,e,"tree",Qc,d=>d.wood&&d.wood.length>0);c&&i.push({type:ue.Chop,action:"chopping",key:"c",targetEntity:c})}return i}const yC={id:Ac,update:(e,t)=>{const{entity:i,updateContext:o}=t,{gameState:s}=o,l=o.deltaTime*(Mt/Ht);if(i.age+=l,i.age>=i.lifespan)return{nextState:Ra,data:{...e,enteredAt:s.time,previousState:Ac}};const c=bv(i.position,i.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Ni(c,s,15)||Ya(s.entities,c,s.time),{nextState:$o,data:{...e,enteredAt:s.time,previousState:Ac}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},vC={id:Ra,update:e=>({nextState:Ra,data:e}),onEnter:(e,t)=>(cr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},IC=[x1,$1,yC,vC],at="humanIdle",xo="humanMoving",da="humanEating",us="humanGathering",Sa="humanDepositing",Aa="humanRetrieving",Yo="humanProcreating",Io="humanAttacking",Tc="humanPlanting",zh="humanChopping",SC={id:at,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="attacking"&&i.attackTargetId?{nextState:Io,data:{...e,enteredAt:o.gameState.time,previousState:at,attackTargetId:i.attackTargetId,attackStartTime:o.gameState.time}}:(i.hunger>=Cv?(i.debuffs=i.debuffs.filter(s=>s.type!=="slow"),i.debuffs.push({type:"slow",startTime:o.gameState.time,duration:.1})):i.debuffs=i.debuffs.filter(s=>s.type!=="slow"),i.activeAction==="moving"?{nextState:xo,data:{...e,enteredAt:o.gameState.time,previousState:at,target:i.target}}:i.activeAction==="gathering"?{nextState:us,data:{...e,enteredAt:o.gameState.time,previousState:at,target:i.target}}:i.activeAction==="eating"?{nextState:da,data:{...e,enteredAt:o.gameState.time,previousState:at}}:i.activeAction==="planting"&&i.target?{nextState:Tc,data:{...e,enteredAt:o.gameState.time,previousState:at,plantingSpot:i.target}}:i.activeAction==="depositing"?{nextState:Sa,data:{...e,enteredAt:o.gameState.time,previousState:at}}:i.activeAction==="retrieving"?{nextState:Aa,data:{...e,enteredAt:o.gameState.time,previousState:at}}:i.activeAction==="chopping"&&i.target?{nextState:zh,data:{...e,enteredAt:o.gameState.time,previousState:at,state:"chopping"}}:{nextState:at,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function TI(e,t=1){let i=mw;return e.hunger>=Cv&&(i*=yw),e.age>=Iw&&(i*=Sw),e.movementSlowdown&&(i*=e.movementSlowdown.modifier),i*=t,i}const Mf=7.5;class AC{constructor(){Nt(this,"id",xo)}update(t,i){var I;const{entity:o,updateContext:s}=i;if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:Io,data:{...t,enteredAt:s.gameState.time,previousState:xo,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:at,data:{...t,enteredAt:s.gameState.time,previousState:xo}};let l;if(typeof o.target=="object"?l=o.target:typeof o.target=="number"&&(l=(I=i.updateContext.gameState.entities.entities[o.target])==null?void 0:I.position),!l&&(o.direction.x!==0||o.direction.y!==0)&&(l={x:o.position.x+o.direction.x*Mf*2,y:o.position.y+o.direction.y*Mf*2}),!l)return{nextState:at,data:{...t,enteredAt:s.gameState.time,previousState:xo}};const{width:c,height:d}=s.gameState.mapDimensions,u=z(o.position,l,c,d);if(u<Mf)return{nextState:at,data:{...t,enteredAt:s.gameState.time,previousState:xo}};const h=ze(o.position,l,c,d),g=Dt(h);if(u>E0){const v=i0(g,-gf),T=i0(g,gf),A=[g,v,T],E=A.map((_,w)=>{const R=li(o.position,mt(_,E0)),N={x:(R.x%c+c)%c,y:(R.y%d+d)%d},D=j0(s.gameState.soilDepletion,N,c,d,T0),G=Math.cos(w===0?0:gf);return D*G});let C=0;for(let _=1;_<E.length;_++)E[_]>E[C]&&(C=_);o.direction=A[C]}else o.direction=g;const y=j0(s.gameState.soilDepletion,o.position,c,d,T0);return o.acceleration=TI(o,y),{nextState:xo,data:t}}onExit(t){const{entity:i}=t;i.acceleration=0}}const TC=new AC,EC={id:da,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction!=="eating"?{nextState:at,data:{...e,enteredAt:o.gameState.time,previousState:da}}:(i.food.length>0&&(!i.eatingCooldownTime||o.gameState.time>=i.eatingCooldownTime)&&i.hunger>mo&&(i.hunger=Math.max(0,i.hunger-mo),i.food.pop(),i.eatingCooldownTime=o.gameState.time+1,we(o,Ie.Eat,i.position),(!i.lastEatingEffectTime||o.gameState.time-i.lastEatingEffectTime>2)&&(be(o.gameState,ye.Eating,i.position,xe,i.id),i.lastEatingEffectTime=o.gameState.time)),i.hunger<=0||i.food.length<=0?{nextState:at,data:{...e,enteredAt:o.gameState.time,previousState:da}}:{nextState:da,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class wC{constructor(){Nt(this,"id",us)}update(t,i){return i.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:i.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const _C=new wC,CC={id:Sa,update:(e,t)=>{const{entity:i}=t;return i.activeAction!=="depositing"?{nextState:at,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Sa}}:{nextState:Sa,data:e}},onEnter:(e,t)=>{const{entity:i}=e;return i.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},PC={id:Aa,update:(e,t)=>{const{entity:i}=t;return i.activeAction!=="retrieving"?{nextState:at,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Aa}}:{nextState:Aa,data:e}},onEnter:(e,t)=>{const{entity:i}=e;return i.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},RC=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),MC=(e,t)=>{const{entity:i,updateContext:o}=t,{gameState:s}=o;if(s.time<(e.procreationEndTime||0))return{nextState:Yo,data:e};const l=s.entities.entities[e.partnerId];if(l&&l.type==="human"&&!l.isPregnant&&i.hunger<On&&l.hunger<On&&!i.procreationCooldown&&!l.procreationCooldown){const c=i.gender==="female"?i:l.gender==="female"?l:void 0,d=i.gender==="male"?i:l.gender==="male"?l:void 0;c&&d&&(c.isPregnant=!0,c.gestationTime=Aw,c.pregnancyFatherId=d.id,i.procreationCooldown=w0,l.procreationCooldown=w0,we(o,Ie.Procreate,c.position))}return i.activeAction="idle",l&&(l.activeAction="idle"),{nextState:at,data:{...e,enteredAt:s.time,previousState:Yo}}},kC={id:Yo,onEnter:RC,update:MC},DC={id:Io,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var l;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:at,data:{...e}};const i=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!i)return t.entity.activeAction="idle",{nextState:at,data:{...e}};const o=z(t.entity.position,i.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=ze(t.entity.position,i.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=Dt(s),o<=yo||o<=un&&(((l=t.entity.attackCooldown)==null?void 0:l.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=TI(t.entity),{nextState:Io,data:e}}},OC={id:Tc,update:(e,t)=>{const{entity:i,updateContext:o}=t,{gameState:s}=o;if(s.time-e.enteredAt>=nw){const c=i.food.filter(u=>u.type===qn.Berry).length,d=ir(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(c>=Jo&&!d){for(let u=0;u<Jo;u++){const h=i.food.findIndex(g=>g.type===qn.Berry);h>-1&&i.food.splice(h,1)}Ya(s.entities,e.plantingSpot,s.time),F1(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return i.activeAction="idle",{nextState:at,data:{...e,enteredAt:s.time,previousState:Tc}}}return{nextState:Tc,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class bC{constructor(){Nt(this,"id",zh)}update(t,i){const{entity:o,updateContext:s}=i;return o.activeAction!=="chopping"||o.heldItem?{nextState:at,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const NC=new bC,BC=[SC,TC,EC,_C,CC,PC,kC,DC,OC,NC],Yn="preyIdle",lo="preyMoving",fa="preyGrazing",ha="preyProcreating",HC={id:Yn,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="moving"?{nextState:lo,data:{...e,enteredAt:o.gameState.time,previousState:Yn,target:i.target}}:i.activeAction==="grazing"?{nextState:fa,data:{...e,enteredAt:o.gameState.time,previousState:Yn}}:i.activeAction==="procreating"?{nextState:ha,data:{...e,enteredAt:o.gameState.time,previousState:Yn}}:{nextState:Yn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},EI=12,lu=120,Q0=50,FC=12,wI=30,LC=2,is=50,UC=100,_I=2,GC=.9,xC=1,$C=50,WC=.5,CI=20,cu=140,J0=40,YC=12,PI=40,zC=3,os=60,ar=40,jC=50,RI=320,MI=25,XC=60,kI=2,VC=90,qC=.7,ZC=1,DI=3,jh=80,OI=10,uu=80,bI=40,NI=2,Uc=30,Gr=20,Xo=40,xr=24,Vo=48,$r=12,qo=40,Wr=20,Zo=60,Yr=.75,uo=2.5,zr=.25,fo=2,BI=4;function KC(e){let t=FC;return e.isAdult||(t*=.7),e.hunger>=$C&&(t*=WC),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function QC(e,t){const i=e>>16&255,o=e>>8&255,s=e&255,l=t>>16&255,c=t>>8&255,d=t&255;let u=Math.floor((i+l)/2),h=Math.floor((o+c)/2),g=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|h<<8|g}function Na(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,i=Math.floor(Math.random()*60)+20;return e<<16|t<<8|i}const kf=10;class JC{constructor(){Nt(this,"id",lo)}update(t,i){var u;const{entity:o,updateContext:s}=i;if(o.activeAction!=="moving")return{nextState:Yn,data:{...t,enteredAt:s.gameState.time,previousState:lo}};let l;if(typeof o.target=="object"?l=o.target:typeof o.target=="number"&&(l=(u=i.updateContext.gameState.entities.entities[o.target])==null?void 0:u.position),!l&&(o.direction.x!==0||o.direction.y!==0)&&(l={x:o.position.x+o.direction.x*kf*2,y:o.position.y+o.direction.y*kf*2}),!l)return{nextState:Yn,data:{...t,enteredAt:s.gameState.time,previousState:lo}};const c=ze(o.position,l,i.updateContext.gameState.mapDimensions.width,i.updateContext.gameState.mapDimensions.height);return o.direction=Dt(c),o.acceleration=KC(o),z(o.position,l,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<kf?{nextState:Yn,data:{...t,enteredAt:s.gameState.time,previousState:lo}}:{nextState:lo,data:t}}onExit(t){const{entity:i}=t;i.acceleration=0}onEnter(t,i){return{...i,enteredAt:t.updateContext.gameState.time}}}const eP=new JC,tP={id:fa,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="moving"?{nextState:lo,data:{...e,enteredAt:o.gameState.time,previousState:fa,target:i.target}}:i.activeAction!=="grazing"?{nextState:Yn,data:{...e,enteredAt:o.gameState.time,previousState:fa}}:{nextState:fa,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},nP={id:ha,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="moving"?{nextState:lo,data:{...e,enteredAt:o.gameState.time,previousState:ha,target:i.target}}:i.activeAction!=="procreating"?{nextState:Yn,data:{...e,enteredAt:o.gameState.time,previousState:ha}}:{nextState:ha,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},iP=[HC,eP,tP,nP],Qt="predatorIdle",so="predatorMoving",_i="predatorAttacking",Fr="predatorProcreating",Ko="predatorEating",oP={id:Qt,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="eating"?{nextState:Ko,data:{...e,enteredAt:o.gameState.time,previousState:Qt,preyId:i.attackTargetId,eatingStartTime:o.gameState.time}}:i.activeAction==="attacking"&&i.attackTargetId?{nextState:_i,data:{...e,enteredAt:o.gameState.time,previousState:Qt,attackTargetId:i.attackTargetId,attackStartTime:o.gameState.time}}:i.activeAction==="moving"?{nextState:so,data:{...e,enteredAt:o.gameState.time,previousState:Qt,target:i.target}}:i.activeAction==="procreating"?{nextState:Fr,data:{...e,enteredAt:o.gameState.time,previousState:Qt}}:{nextState:Qt,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function HI(e){let t=YC;return e.hunger>=VC&&(t*=qC),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function rP(e,t){const i=e>>16&255,o=e>>8&255,s=e&255,l=t>>16&255,c=t>>8&255,d=t&255;let u=Math.floor((i+l)/2),h=Math.floor((o+c)/2),g=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|h<<8|g}function Ba(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,i=Math.floor(Math.random()*40)+20;return e<<16|t<<8|i}const Df=12;class sP{constructor(){Nt(this,"id",so)}update(t,i){var u;const{entity:o,updateContext:s}=i;if(o.activeAction==="eating")return{nextState:Ko,data:{...t,enteredAt:s.gameState.time,previousState:so,preyId:o.attackTargetId,eatingStartTime:s.gameState.time}};if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:_i,data:{...t,enteredAt:s.gameState.time,previousState:so,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:Qt,data:{...t,enteredAt:s.gameState.time,previousState:so}};let l;if(typeof o.target=="object"?l=o.target:typeof o.target=="number"&&(l=(u=i.updateContext.gameState.entities.entities[o.target])==null?void 0:u.position),!l&&(o.direction.x!==0||o.direction.y!==0)&&(l={x:o.position.x+o.direction.x*Df*2,y:o.position.y+o.direction.y*Df*2}),!l)return{nextState:Qt,data:{...t,enteredAt:s.gameState.time,previousState:so}};const c=ze(o.position,l,i.updateContext.gameState.mapDimensions.width,i.updateContext.gameState.mapDimensions.height);return o.direction=Dt(c),o.acceleration=HI(o),z(o.position,l,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Df?{nextState:Qt,data:{...t,enteredAt:s.gameState.time,previousState:so}}:{nextState:so,data:t}}onExit(t){const{entity:i}=t;i.acceleration=0}onEnter(t,i){return{...i,enteredAt:t.updateContext.gameState.time}}}const aP=new sP,lP={id:_i,update:(e,t)=>{const{entity:i,updateContext:o}=t;if(i.activeAction==="eating")return{nextState:Ko,data:{...e,enteredAt:o.gameState.time,previousState:_i,preyId:i.attackTargetId,eatingStartTime:o.gameState.time}};if(i.activeAction!=="attacking"||!i.attackTargetId)return i.activeAction="idle",{nextState:Qt,data:{...e,enteredAt:o.gameState.time,previousState:_i}};const s=o.gameState.entities.entities[i.attackTargetId];if(!s)return i.activeAction="idle",{nextState:Qt,data:{...e,enteredAt:o.gameState.time,previousState:_i}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return i.activeAction="idle",{nextState:Qt,data:{...e,enteredAt:o.gameState.time,previousState:_i}};const c=z(i.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height),d=ze(i.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height);return i.direction=Dt(d),c>ar?i.acceleration=HI(i):i.acceleration=0,{nextState:_i,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},cP={id:Fr,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="eating"?{nextState:Ko,data:{...e,enteredAt:o.gameState.time,previousState:Fr,preyId:i.attackTargetId,eatingStartTime:o.gameState.time}}:i.activeAction==="attacking"&&i.attackTargetId?{nextState:_i,data:{...e,enteredAt:o.gameState.time,previousState:Fr,attackTargetId:i.attackTargetId,attackStartTime:o.gameState.time}}:i.activeAction!=="procreating"?{nextState:Qt,data:{...e,enteredAt:o.gameState.time,previousState:Fr}}:{nextState:Fr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},uP={id:Ko,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction!=="eating"?{nextState:Qt,data:{...e,enteredAt:o.gameState.time,previousState:Ko}}:{nextState:Ko,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},dP=[oP,aP,lP,cP,uP],fP=24*30*10,So=24*5,hP=48,pP=72,$a=20,gP="#3b2016",mP="#5c3a21",yP="#376d31",vP="#76a331",IP="#a6c44a",SP="rgba(0, 0, 0, 0.25)",AP=60,TP=24*7,EP=.1,ey=1,du=5,wP={id:zn,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.age>=i.lifespan?{nextState:nr,data:{enteredAt:o.gameState.time,previousState:zn}}:i.age>=So?{nextState:bn,data:{enteredAt:o.gameState.time,previousState:zn}}:{nextState:zn,data:e}}},_P={id:bn,update:(e,t)=>{const{entity:i,updateContext:o}=t,s=o.deltaTime*(Mt/Ht);return i.age>=i.lifespan?{nextState:nr,data:{...e,enteredAt:o.gameState.time,previousState:bn}}:(i.timeSinceLastSpreadAttempt+=s,i.timeSinceLastSpreadAttempt>=TP&&(i.timeSinceLastSpreadAttempt=0,Math.random()<EP)?{nextState:ui,data:{...e,enteredAt:o.gameState.time,previousState:bn}}:{nextState:bn,data:e})}},CP={id:ui,update:(e,t)=>{const{entity:i,updateContext:o}=t,{gameState:s}=o;if(i.age>=i.lifespan)return{nextState:nr,data:{...e,enteredAt:s.time,previousState:ui}};const l=bv(i.position,i.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Ni(l,s,25)||Fa(s.entities,l,s.time),{nextState:bn,data:{...e,enteredAt:s.time,previousState:ui}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},PP={id:Yt,update:(e,t)=>{const{updateContext:i}=t;return i.gameState.time-e.enteredAt>=hP?{nextState:bi,data:{enteredAt:i.gameState.time,previousState:Yt}}:{nextState:Yt,data:e}}},RP={id:bi,update:(e,t)=>{const{updateContext:i}=t;return i.gameState.time-e.enteredAt>=pP?{nextState:nr,data:{enteredAt:i.gameState.time,previousState:bi}}:{nextState:bi,data:e}}},MP={id:nr,update:e=>({nextState:nr,data:e}),onEnter:(e,t)=>(cr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},kP=[wP,_P,CP,PP,RP,MP],ty=[...IC,...BC,...iP,...dP,...kP];function DP(e,t,i){const o=jE(e,ty);if(!o)return VE(e),[e,t];const{nextState:s,data:l}=o.update(t,i);return XE(e,s)?[s,zE(o,s,l,i,ty)]:[s,l]}function Xh(e,t){return`${e},${t}`}const ny=Mt*10;function FI(e){return e%ny/ny}function LI(e){const t=FI(e);return(Math.cos(t*2*Math.PI)+1)/2}function OP(e){const t=FI(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function UI(e,t,i){const o=(e.x%t+t)%t,s=(e.y%i+i)%i;return{gridX:Math.floor(o/Ci),gridY:Math.floor(s/Ci)}}function Ha(e,t,i,o,s){const{gridX:l,gridY:c}=UI(t,o,s),d=Xh(l,c),u=e.sectors[d],h=u?u.currentTemperature:xv,y=(LI(i)*2-1)*I_;return h+y}function bP(e){const{sectors:t}=e.temperature,{width:i,height:o}=e.mapDimensions,s=Math.ceil(i/Ci),l=Math.ceil(o/Ci);for(const d in t){const u=t[d];u.currentTemperature=u.baseTemperature}const c=Math.ceil(ma/Ci);Object.values(e.entities.entities).forEach(d=>{if(d.type==="building"){const u=d;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const h=UI(u.position,i,o);for(let g=-c;g<=c;g++)for(let y=-c;y<=c;y++){const I=(h.gridX+y+s)%s,v=(h.gridY+g+l)%l,T=Xh(I,v),A=t[T];if(A){const E={x:(I+.5)*Ci,y:(v+.5)*Ci},C=z(u.position,E,i,o);if(C<ma){const _=p_*(1-C/ma);A.currentTemperature+=_}}}}}})}function GI(e,t){const i={},o=Math.ceil(e/Ci),s=Math.ceil(t/Ci);for(let l=0;l<s;l++)for(let c=0;c<o;c++){const d=Xh(c,l);let u=xv;const h=l/s*10-5;u+=h,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),i[d]={baseTemperature:u,currentTemperature:u}}return{sectors:i}}function NP(e,t,i){var d;const{gameState:o}=t,s=i*(Mt/Ht);e.isAdult=e.age>=Eh;const l=Ha(o.temperature,e.position,o.time,o.mapDimensions.width,o.mapDimensions.height);if(l<jo){const u=(jo-l)*h_*s;e.hitpoints-=u}if(e.movementSlowdown&&o.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<Wt){const u=1-e.hunger/Wt*Dw,h=kw*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+h)}if(e.hunger+=i*(Zs/(Mt/Ht)),e.hunger>=Wt)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-mo);else{const u=Ow*s;e.hitpoints-=u}if(e.age+=i/Kc,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=i*((Zs*Tw-Zs)/(Mt/Ht)),(!e.lastPregnantEffectTime||o.time-e.lastPregnantEffectTime>Da*3)&&(be(o,ye.Pregnant,e.position,Da,e.id),e.lastPregnantEffectTime=o.time),e.gestationTime<=0&&(xM(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===cs&&(e.radius=ft):e.hunger+=i*((Zs*Ew-Zs)/(Mt/Ht)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const h=o.entities.entities[e.motherId];h&&u.push(h)}if(e.fatherId){const h=o.entities.entities[e.fatherId];h&&u.push(h)}for(const h of u)if(h.age>=wh&&h.hunger>=_w&&z(e.position,h.position,o.mapDimensions.width,o.mapDimensions.height)<=Cw){e.food.pop(),h.hunger=Math.max(0,h.hunger-mo),e.feedParentCooldownTime=Pw;break}}let c;if(e.hitpoints<=0?l<jo?c="hypothermia":e.hunger>=Wt?c="hunger":c="killed":e.age>=e.maxAge&&(c="oldAge"),c){if(e.leaderId===e.id){const u=ns(Bi(o,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeControl=e.tribeControl??{diplomacy:{}};const h=o;bc(o,e.id,u.id);const g=h.search.human.byProperty("leaderId",e.id);for(const v of g)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const y=h.search.building.byProperty("ownerId",e.id);for(const v of y)v.ownerId=u.id;for(const v of Fc(u,o))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const I=ou(o).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of I){const T=o.entities.entities[v.leaderId];if((d=T==null?void 0:T.tribeControl)!=null&&d.diplomacy){const A=T.tribeControl.diplomacy[e.id];A!==void 0&&(T.tribeControl.diplomacy[u.id]=A,delete T.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=ns(Bi(o,e));u?(u.isPlayer=!0,o.generationCount++):(o.gameOver=!0,o.causeOfGameOver=c,ka(o,{identifier:"no_heir",type:er.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}LM(o.entities,e.position,e.gender,e.age,e.radius,e.id,o.time,e.food,e.hunger),cr(o.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=i*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function BP(e,t){const i=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,i/Rw);const o=Math.floor(Ov*(1-e.decayProgress));e.food.length>o&&e.food.splice(o),e.decayProgress>=1&&e.food.length<=0&&cr(t.gameState.entities,e.id)}function HP(e,t,i){const o=i*(Mt/Ht);e.age+=i/Kc,e.isAdult=e.age>=_I;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=lu){const c=BI*o;e.hitpoints-=c}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const c={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};c.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,c.x)),c.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,c.y));const d=Math.random()<.5?"male":"female",u=e,h=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let g;if(h)g=QC(u.geneCode,h.geneCode);else{g=u.geneCode;const y=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+y))}rs(t.gameState.entities,c,d,0,wI*.5,g,e.id,e.fatherId,e.aiType),be(t.gameState,ye.Procreation,e.position,Da,e.id),we(t,Ie.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=o,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let l=!1;e.hitpoints<=0&&(l=!0),e.age>=EI&&(l=!0),l&&(UM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),cr(t.gameState.entities,e.id))}function FP(e,t,i){const o=i*(Mt/Ht);e.age+=i/Kc,e.isAdult=e.age>=DI;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=cu){const c=BI*o;e.hitpoints-=c}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const c={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};c.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,c.x)),c.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,c.y));const d=Math.random()<.5?"male":"female",u=e,h=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let g;if(h)g=rP(u.geneCode,h.geneCode);else{g=u.geneCode;const y=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+y))}ss(t.gameState.entities,c,d,0,PI*.6,g,e.id,e.pregnancyFatherId,e.aiType),be(t.gameState,ye.Procreation,e.position,Da,e.id),we(t,Ie.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=o,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=o,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let l=!1;e.hitpoints<=0&&(l=!0),e.age>=CI&&(l=!0),l&&(GM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),cr(t.gameState.entities,e.id))}var Ao=(e=>(e[e.TaskBased=0]="TaskBased",e))(Ao||{}),x=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e[e.HumanDiplomacy=25]="HumanDiplomacy",e[e.AnimalFlee=26]="AnimalFlee",e[e.AnimalGraze=27]="AnimalGraze",e[e.AnimalHunt=28]="AnimalHunt",e[e.AnimalAttack=29]="AnimalAttack",e[e.AnimalProcreate=30]="AnimalProcreate",e[e.AnimalWander=31]="AnimalWander",e[e.AnimalFeedChild=32]="AnimalFeedChild",e[e.AnimalSeekFoodFromParent=33]="AnimalSeekFoodFromParent",e[e.AnimalHerd=34]="AnimalHerd",e[e.AnimalTerritorial=35]="AnimalTerritorial",e[e.AnimalPack=36]="AnimalPack",e))(x||{}),O=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(O||{});const Et=3,LP=250,xI=.8,UP=100,GP=5,oh="currentAiTask",$I="lastTaskResult",WI="lastTaskMessage",rh="taskHistory";function Gc({aiBlackboard:e}){return Oe.get(e,oh)||null}function Oi({aiBlackboard:e},t){t?Oe.set(e,oh,t):Oe.delete(e,oh)}function xP(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function $P(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function YI(e,t,i,o){const s=t.type===x.Wait?WP:o[t.type];let l;s&&s.executor?l=s.executor(t,e,i):l=O.Failure;const[c,d,u]=$P(l);if(Oe.set(e.aiBlackboard,$I,c),Oe.set(e.aiBlackboard,WI,d),c!==O.Running){const h=Oe.get(e.aiBlackboard,rh)||[];if(h.unshift({type:t.type,result:c,completedAtTick:i.gameState.time,message:d}),h.length>5&&h.pop(),Oe.set(e.aiBlackboard,rh,h),delete i.gameState.tasks[t.id],Oi(e,null),c===O.Success){const g=u||t.nextTask;g&&(i.gameState.tasks[g.id]=g,g.claimedByEntityId=e.id,Oi(e,g.id))}}return c}function Ze(e){return 1/(1+e/LP)}function Wa(e,t,i){for(let o=0;o<i.length;o++){const s=i[o];if(!s.producer)continue;const l=s.producer(e,t);for(const c in l){const d=l[c],u=t.gameState.tasks[c];t.gameState.tasks[c]=d,u&&(t.gameState.tasks[c].claimedByEntityId=u.claimedByEntityId)}}}const lc=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:x.Wait,creatorEntityId:e.id,validUntilTime:t+Et}),WP={type:x.Wait,executor:(e,t,i)=>i.gameState.time>=e.validUntilTime-1?[O.Success,"Wait complete"]:[O.Running,"Waiting"]};function nt(e){const{type:t,requireAdult:i,autopilotBehavior:o,producer:s,scorer:l,executor:c}=e;return{type:t,producer:s,scorer:l?(h,g,y)=>i&&!h.isAdult||o&&h.isPlayer&&!y.gameState.autopilotControls.behaviors[o]?null:l(h,g,y):void 0,executor:c?(h,g,y)=>i&&!g.isAdult||o&&g.isPlayer&&!y.gameState.autopilotControls.behaviors[o]?O.Failure:y.gameState.autopilotControls.activeAutopilotAction&&h.type!==x.HumanPlayerCommand&&g.isPlayer?[O.Failure,"Autopilot action active",{id:`player-command-${g.id}`,type:x.HumanPlayerCommand,position:g.position,creatorEntityId:g.id,validUntilTime:y.gameState.time+Et}]:c(h,g,y):void 0}}const YP=nt({type:x.HumanEat,requireAdult:!1,producer:(e,t)=>{const i={};if(e.hunger>Qf&&e.food.length>0){const o=`eat-task-${e.id}`;i[o]={id:o,type:x.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/Wt,executor:(e,t)=>e.target!==t.id?O.Empty:t.hunger<Qf?O.Success:t.food.length===0?O.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",O.Running)}),zP=nt({type:x.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="berryBush"||o.food.length===0||e.leaderId&&!sr(o.position,e.leaderId,i.gameState)||e.food.length>=e.maxFood)return null;const s=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=Ze(s),c=e.hunger/Wt;return(l+c)/2},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=i.gameState.entities.entities[e.target];return!o||o.type!=="berryBush"||o.food.length===0||t.food.length>=t.maxFood?[O.Success,"Bush is empty"]:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Xe?(t.target=o.position,t.activeAction="moving",[O.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[O.Running,"Gathering berries"])}}),jP=nt({type:x.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="corpse"||o.food.length===0||e.leaderId&&!sr(o.position,e.leaderId,i.gameState)||e.food.length>=e.maxFood)return null;const s=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=Ze(s),c=e.hunger/Wt;return(l+c)/2},executor:(e,t,i)=>{if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];return!o||o.type!=="corpse"||o.food.length===0||t.food.length>=t.maxFood?O.Success:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Xe?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",O.Running)}}),XP=nt({type:x.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const i={};if(e.gender==="female"&&!e.isPregnant&&e.age>=Dc&&e.age<=Th&&e.hunger<On&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;i[s]={id:s,type:x.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i},scorer:(e,t,i)=>{if(e.gender!=="male"||e.age<Dc||e.hunger>=On||(e.procreationCooldown||0)>0)return null;const o=i.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="female"||o.isPregnant||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ze(s)*xI},executor:(e,t,i)=>{const o=i.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="female"||t.hunger>=On?O.Failure:o.isPregnant?O.Success:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Xe?(t.target=o.position,t.activeAction="moving",t.direction=Pt(t.position,o.position,i.gameState.mapDimensions),O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",O.Running)}}),VP=nt({type:x.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const i={};if(e.gender==="male"&&e.age>=Dc&&e.hunger<On&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;i[s]={id:s,type:x.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i},scorer:(e,t,i)=>{if(e.gender!=="female"||e.isPregnant||e.age<Dc||e.age>Th||e.hunger>=On||(e.procreationCooldown||0)>0)return null;const o=i.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="male"||o.hunger>=On||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ze(s)*xI},executor:(e,t,i)=>{const o=i.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="male"||o.hunger>=On?O.Failure:t.isPregnant?O.Success:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Xe?(t.target=o.position,t.activeAction="moving",t.direction=Pt(t.position,o.position,i.gameState.mapDimensions),O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",O.Running)}}),qP=nt({type:x.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const i={};if(!e.isAdult&&e.hunger>=_0){const o=`feed-child-task-${e.id}`;i[o]={id:o,type:x.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i},scorer:(e,t,i)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const o=i.gameState.entities.entities[t.creatorEntityId];if(!o||o.isAdult||!(o.motherId===e.id||o.fatherId===e.id))return null;const l=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=Ze(l),d=o.hunger/Wt;return(c+d)/2},executor:(e,t,i)=>{const o=i.gameState.entities.entities[e.creatorEntityId];return!o||o.isAdult||t.food.length===0?O.Failure:o.hunger<_0/2?O.Success:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Dv?(t.target=o.position,t.activeAction="moving",t.direction=Pt(t.position,o.position,i.gameState.mapDimensions),O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="feeding",O.Running)}});function Vh(e,t,i){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const o=z(e.position,t.target,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ze(o)}function ZP(e,t,i){if(e.leaderId!==t.creatorEntityId||!e.leaderId)return null;const o=t.target;if(!o)return null;const{width:s,height:l}=i.gameState.mapDimensions,c=z(e.position,o,s,l),d=Ze(c)*.5,u=ci(e.leaderId,i.gameState),h=z(u,o,s,l),g=Math.max(0,1-h/800)*.25,y=Math.ceil(s/Ee),I=Math.ceil(l/Ee),v=s_(o);let T=0;for(let E=-1;E<=1;E++)for(let C=-1;C<=1;C++){if(C===0&&E===0)continue;const _=((v.x+C)%y+y)%y,w=((v.y+E)%I+I)%I;i.gameState.terrainOwnership[w*y+_]===e.leaderId&&T++}const A=T/8*.25;return d+g+A}function fu(e,t,i,o,s){const l=e.target;return z(t.position,l,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>s?(t.target=l,t.activeAction="moving",O.Running):(bh(l,o,t.leaderId,i.gameState),O.Success)}const KP=nt({type:x.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:Vh,executor:(e,t,i)=>fu(e,t,i,de.StorageSpot,Dh)}),QP=nt({type:x.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:Vh,executor:(e,t,i)=>fu(e,t,i,de.Bonfire,Dh)}),JP=nt({type:x.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:Vh,executor:(e,t,i)=>fu(e,t,i,de.PlantingZone,Dh)}),eR=nt({type:x.HumanPlaceBorderPost,scorer:ZP,requireAdult:!0,autopilotBehavior:"build",executor:(e,t,i)=>fu(e,t,i,de.BorderPost,t_)}),tR=nt({type:x.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,i)=>{if(e.food.filter(u=>u.type===qn.Berry).length<Jo)return null;const s=i.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const l=i.gameState.entities.entities[s.ownerId];if(!l||l.leaderId!==e.leaderId)return null;const c=t.target,d=z(e.position,c,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ze(d)},executor:(e,t,i)=>{if(t.food.filter(d=>d.type===qn.Berry).length<Jo)return t.activeAction="idle",O.Failure;const s=e.target;return z(t.position,s,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Rv?(t.target=s,t.activeAction="moving",O.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(i.gameState.entities.entities).find(d=>d.type==="berryBush"&&z(d.position,s,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<GP)?(t.activeAction="idle",O.Success):O.Running)}}),nR=nt({type:x.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{var h;if(typeof t.target!="number")return null;const o=e.food.length>0,s=((h=e.heldItem)==null?void 0:h.type)===kt.Wood;if(!o&&!s)return null;const l=i.gameState.entities.entities[t.target];if(!l||l.type!=="building"||l.buildingType!==de.StorageSpot||e.leaderId!==l.ownerId||l.storedItems.length>=l.storageCapacity)return null;const c=z(e.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),d=Ze(c),u=s?.6:e.food.length/e.maxFood*.4;return(d+u)/2},executor:(e,t,i)=>{var d;if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==de.StorageSpot)return O.Failure;const s=t.food.length>0,l=((d=t.heldItem)==null?void 0:d.type)===kt.Wood;return!s&&!l?O.Success:o.storedItems.length>=o.storageCapacity?O.Failure:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Xe?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",O.Running)}}),iR=nt({type:x.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{var d;if(typeof t.target!="number"||!(((d=e.heldItem)==null?void 0:d.type)===kt.Wood))return null;const s=i.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==de.Bonfire||e.leaderId!==s.ownerId)return null;const l=s.storageCapacity||th;if(s.storedItems.length>=l)return null;const c=z(e.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ze(c)},executor:(e,t,i)=>{var d;if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==de.Bonfire)return O.Failure;if(!(((d=t.heldItem)==null?void 0:d.type)===kt.Wood))return O.Success;const l=o.storageCapacity||th;return o.storedItems.length>=l?O.Failure:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Xe?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",O.Running)}}),oR=nt({type:x.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,i)=>{if(e.hunger<=Qf||e.food.length>0||typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="building"||o.buildingType!==de.StorageSpot||o.ownerId!==e.leaderId||!o.storedItems.some(u=>u.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=Ze(s),c=e.hunger/Wt,d=1-e.food.length/e.maxFood;return(l+c+d)/3},executor:(e,t,i)=>{if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];return!o||o.type!=="building"||o.buildingType!==de.StorageSpot||!o.storedItems.some(l=>l.item.itemType==="food")?O.Failure:t.food.length>0?O.Success:t.food.length>=t.maxFood?O.Failure:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Xe?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="retrieving",O.Running)}}),rR=2;function qh(e,t){if(e.leaderId){const i=t.entities.entities[e.leaderId];if(i&&i.aiBlackboard)return i}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.aiBlackboard)return i}return null}const sR=nt({type:x.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="tree")return null;const[s]=o.stateMachine??[];if(!(s===zn||s===bn||s===ui)||e.leaderId&&!sr(o.position,e.leaderId,i.gameState)||e.heldItem||e.food.length===0)return null;const c=qh(e,i.gameState);if(!c)return null;const d=aI(c.id,i.gameState);if(d<=0)return null;const u=k1(c.id,i.gameState);if(u>=d)return null;const h=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),g=Ze(h),y=Math.min(1,(d-u)/10);return(g+y)/2},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=i.gameState.entities.entities[e.target];if(!o||o.type!=="tree")return[O.Failure,"Tree not found"];const[s]=o.stateMachine??[];if(s===Yt){const d={id:`gather-wood-${t.id}-${i.gameState.time}`,type:x.HumanGatherWood,position:o.position,creatorEntityId:t.id,target:o.id,validUntilTime:i.gameState.time+1};return[O.Success,"Tree fell!",d]}return s===zn||s===bn||s===ui?t.heldItem?[O.Failure,"Hands full"]:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Mv?(t.target=o.position,t.activeAction="moving",[O.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="chopping",[O.Running,"Chopping tree"]):[O.Failure,"Tree is not standing"]}}),aR=nt({type:x.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="tree"||o.wood.length===0)return null;const[s]=o.stateMachine??[];if(s!==Yt||e.leaderId&&!sr(o.position,e.leaderId,i.gameState)||e.heldItem)return null;const l=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=Ze(l),d=qh(e,i.gameState),u=d?aI(d.id,i.gameState):0,h=Math.min(1,u/10);return(c+h)/2},executor:(e,t,i)=>{var l;if(typeof e.target!="number")return[O.Failure,"Invalid target"];if(((l=t.heldItem)==null?void 0:l.type)==="wood")return[O.Success,"Already holding wood"];const o=i.gameState.entities.entities[e.target];return!o||o.type!=="tree"||o.wood.length===0||t.heldItem?[O.Failure,"Tree gone, empty, or human full"]:z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Xe?(t.target=o.position,t.activeAction="moving",[O.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[O.Running,"Gathering wood"])}}),lR=nt({type:x.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="prey"||o.hitpoints<=0||e.leaderId&&!sr(o.position,e.leaderId,i.gameState))return null;const s=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);if(e.leaderId){const d=ci(e.leaderId,i.gameState);if(z(e.position,d,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>zw)return null}const l=Ze(s),c=e.hunger/Wt;return(l+c)/2*.6},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=i.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[O.Success,"Prey is dead"];const s=z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Xe?[O.Running,"Chasing prey"]:[O.Running,"Attacking prey"]}}),cR=nt({type:x.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,i)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="predator"||o.hitpoints<=0||e.leaderId&&!sr(o.position,e.leaderId,i.gameState))return null;const s=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return(Ze(s)+.3)/1.3},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[O.Failure,"Too injured to continue"];const o=i.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[O.Success,"Predator eliminated"];const s=z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Xe?[O.Running,"Chasing predator"]:[O.Running,"Fighting predator"]}});function uR(e,t,i,o){var u;const s=e.entities.entities[i.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,O.Failure;const l=z(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?un:yo;return l<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,O.Success):(t.activeAction="moving",t.target=s.id,t.direction=Pt(t.position,s.position,e.mapDimensions),O.Running)}const dR=nt({type:x.HumanPlayerCommand,producer:(e,t)=>{const i={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const o=`player-command-${e.id}`;i[o]={id:o,type:x.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+Et}}return i},scorer:(e,t)=>t.type===x.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,i)=>{var l;const{gameState:o}=i,s=o.autopilotControls.activeAutopilotAction;if(!s)return[O.Failure,"No active autopilot action"];switch(s.action){case ue.AutopilotMove:{if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,O.Failure;const c=s.position;return z(t.position,c,o.mapDimensions.width,o.mapDimensions.height)<Vw?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[O.Success,"Reached target position"]):(t.activeAction="moving",t.target=c,t.direction=Pt(t.position,c,o.mapDimensions),[O.Running,"Moving to target"])}case ue.AutopilotGather:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Target entity not found"];let d=!1;if(c.type==="berryBush")d=c.food.length===0;else if(c.type==="corpse")d=c.food.length===0;else if(c.type==="tree"){const h=c;d=h.stateMachine[0]!==Yt||h.wood.length===0}else return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target type"];return d?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Target is depleted"]):z(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)>Rv?(t.activeAction="moving",t.target=c.id,t.direction=Pt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"At target, gathering",lc(t,o.time)])}case ue.AutopilotChop:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.type!=="tree")return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target entity"];const[d]=c.stateMachine??[];return!(d===zn||d===bn||d===ui)||t.heldItem?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Tree is not standing or human is holding an item"]):z(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)>Mv?(t.activeAction="moving",t.target=c.id,t.direction=Pt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"At tree, chopping",lc(t,o.time)])}case ue.AutopilotAttack:return"targetEntityId"in s?uR(o,t,s):(o.autopilotControls.activeAutopilotAction=void 0,O.Failure);case ue.AutopilotProcreate:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.type!=="human"||!ls(t,c,o))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target for procreation"];const d=z(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height);return c.isPregnant||t.isPregnant?t.gender==="male"&&c.pregnancyFatherId!==t.id?[O.Failure,"Target is pregnant by another"]:[O.Success,"Procreation conditions met"]:d<=mf?(t.activeAction="procreating",o.autopilotControls.activeAutopilotAction=void 0,[O.Running,"Procreating"]):(t.activeAction="moving",t.target=c.id,t.direction=Pt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to procreation target"])}case ue.AutopilotPlant:{if(t.activeAction==="planting")return[O.Running,"Planting"];if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No position specified"];const c=s.position;return Ni(c,o,Zc,t.id)?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Position is occupied"]):z(t.position,c,o.mapDimensions.width,o.mapDimensions.height)<=mf?(t.activeAction="planting",t.target=c,o.autopilotControls.activeAutopilotAction=void 0,o.hasPlayerPlantedBush=!0,[O.Running,"Planting"]):(t.activeAction="moving",t.target=c,t.direction=Pt(t.position,c,o.mapDimensions),[O.Running,"Moving to planting target"])}case ue.AutopilotFeedChild:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="human"||c.isAdult||t.food.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target for feeding child"]):z(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=mf?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[O.Success,"Feeding child"]):(t.activeAction="moving",t.target=c.id,t.direction=Pt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to feeding target"])}case ue.AutopilotDeposit:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.buildingType!==de.StorageSpot&&c.buildingType!==de.Bonfire||!c.isConstructed)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"];const d=c.storageCapacity??0;if(c.storedItems.length>=d)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Storage is full"];if(t.leaderId!==c.ownerId)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Human does not belong to the same tribe as the building"];const h=t.food.length>0,g=!!t.heldItem;if(c.buildingType===de.Bonfire){if(((l=t.heldItem)==null?void 0:l.type)!==kt.Wood)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Bonfires only accept wood"]}else if(!h&&!g)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No items to deposit"];return z(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Vn?(t.activeAction="depositing",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Depositing items",lc(t,o.time)]):(t.activeAction="moving",t.target=c.id,t.direction=Pt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to deposit target"])}case ue.AutopilotRetrieve:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.buildingType!==de.StorageSpot||!c.isConstructed||c.storedItems.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"]):t.leaderId!==c.ownerId?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Storage is full"]):z(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Vn?(t.activeAction="retrieving",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Retrieving items",lc(t,o.time)]):(t.activeAction="moving",t.target=c.id,t.direction=Pt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to retrieve target"])}case ue.TakeOverBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!tr(t,c,o)?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Only leaders can take over buildings"]):z(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Xe?(t.activeAction="takingOverBuilding",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Taking over building"]):(t.activeAction="moving",t.target=c.id,t.direction=Pt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to takeover target"])}case ue.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!tr(t,c,o)?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Only leaders can remove enemy buildings"]):z(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Xe?(t.activeAction="destroyingBuilding",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=c.id,t.direction=Pt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to removal target"])}case ue.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return o.autopilotControls.activeAutopilotAction=void 0,O.Failure;const c=s.position,d=s.buildingType;if(!d)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No building type specified"];const u=z(t.position,c,o.mapDimensions.width,o.mapDimensions.height),h=100;return u<=h?Oa(c,d,t.leaderId,o,t.position,h)?(bh(c,d,t.leaderId,o),o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[O.Success,"Building placed"]):(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=c,t.direction=Pt(t.position,c,o.mapDimensions),[O.Running,"Moving to placement target"])}default:return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Unknown or unhandled action"]}}}),fR=nt({type:x.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:i}=t,o={},s=Xn(e.position.x,e.position.y,i),l=s!==null&&s!==e.leaderId&&Hi(e.leaderId,s,i),c=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(l||c){const d=`attack-human-${e.id}`;o[d]={id:d,type:x.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:i.time+Et}}return o},scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="human"||o.hitpoints<=0||o.id===e.id||o.leaderId===e.leaderId)return null;const{gameState:s}=i,l=Ga(e,o,s),c=Xn(o.position.x,o.position.y,s)===e.leaderId,d=o.activeAction==="attacking"&&o.attackTargetId!==void 0;if(!l&&!d)return null;let u=.5;const h=z(e.position,o.position,s.mapDimensions.width,s.mapDimensions.height),g=Ze(h);return c&&l&&(u+=.1),(g+u)/2},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=i.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[O.Success,"Target eliminated"];const s=z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Xe?[O.Running,"Chasing human target"]:[O.Running,"Fighting human target"]}}),hR=nt({type:x.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,i)=>{if(typeof t.target!="number"||LI(i.gameState.time)>.5)return null;const o=i.gameState.entities.entities[t.target];if(!o||o.buildingType!==de.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0||e.leaderId!==o.ownerId)return null;const s=Ha(i.gameState.temperature,e.position,i.gameState.time,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=jo+5;if(s>=l)return null;const c=(l-s)/15,d=(1-e.hitpoints/e.maxHitpoints)*.8,u=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),h=Ze(u);let g=(c+d+h)/2;return e.hitpoints/e.maxHitpoints<.2&&s<jo&&(g=Math.max(g,1.2)),g},executor:(e,t,i)=>{if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];if(!o||o.buildingType!==de.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0)return O.Failure;const s=Ha(i.gameState.temperature,t.position,i.gameState.time,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=jo+5;if(s>=l)return t.activeAction="idle",[O.Success,"Comfortable temperature reached"];const c=t.id*137%360*(Math.PI/180),d=ma*.4,u=i.gameState.mapDimensions.width,h=i.gameState.mapDimensions.height,g={x:(o.position.x+Math.cos(c)*d+u)%u,y:(o.position.y+Math.sin(c)*d+h)%h},y=z(t.position,g,u,h);return y>10?(t.activeAction="moving",t.target=g,t.direction=Pt(t.position,g,i.gameState.mapDimensions),[O.Running,`Moving to warmth spot (${y.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[O.Running,"Staying warm at bonfire"])}}),pR=nt({type:x.HumanFlee,requireAdult:!1,producer:(e,t)=>{const i={};if(e.hitpoints<e.maxHitpoints*k0){const o=u_(e.id,t.gameState);if(o){const s=`flee-task-${e.id}`;i[s]={id:s,type:x.HumanFlee,position:e.position,creatorEntityId:e.id,target:o.id,validUntilTime:t.gameState.time+Et}}}return i},scorer:(e,t,i)=>typeof t.target!="number"||!i.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*k0?.9:null,executor:(e,t,i)=>{if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];if(!o)return t.activeAction="idle",t.attackTargetId=void 0,O.Success;if(z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>D0)return t.activeAction="idle",t.target=void 0,O.Success;t.activeAction="moving",t.attackTargetId=void 0;const l=ze(o.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=Dt(l),d=li(t.position,mt(c,D0));return t.target={x:(d.x%i.gameState.mapDimensions.width+i.gameState.mapDimensions.width)%i.gameState.mapDimensions.width,y:(d.y%i.gameState.mapDimensions.height+i.gameState.mapDimensions.height)%i.gameState.mapDimensions.height},t.direction=c,O.Running}}),gR=nt({type:x.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:i}=t,o={};if(!e.leaderId||e.id===e.leaderId)return o;const s=ci(e.leaderId,i),l=`stay-near-tribe-${e.id}`;return o[l]={id:l,type:x.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:i.time+Et},o},scorer:(e,t,i)=>{if(!e.leaderId||e.id===e.leaderId)return null;const o=ci(e.leaderId,i.gameState),s=z(e.position,o,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);if(s<=O0)return null;const l=s-O0;return Math.min(.95,.5+l/1e3*n_)},executor:(e,t,i)=>{if(!t.leaderId)return O.Failure;const o=ci(t.leaderId,i.gameState),s=z(t.position,o,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return s<o_?(t.activeAction="idle",t.target=void 0,O.Success):(t.activeAction="moving",t.target=o,t.direction=Pt(t.position,o,i.gameState.mapDimensions),[O.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),mR=nt({type:x.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:i}=t,o={};if(e.isAdult)return o;const s=Y0(e,i);if(!s)return o;const l=`stay-near-parent-${e.id}`;return o[l]={id:l,type:x.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:i.time+Et},o},scorer:(e,t,i)=>{if(e.isAdult)return null;const o=Y0(e,i.gameState);if(!o||o.id!==t.target||e.leaderId&&Oh(e.leaderId,i.gameState)&&Xn(o.position.x,o.position.y,i.gameState)!==e.leaderId)return null;const s=z(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);if(s<=b0)return null;const l=s-b0;return Math.min(.98,.6+l/500*i_)},executor:(e,t,i)=>{if(typeof e.target!="number")return t.activeAction="idle",O.Failure;const o=i.gameState.entities.entities[e.target];if(!o||o.type!=="human")return t.activeAction="idle",t.target=void 0,O.Failure;const s=z(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return s<=r_?(t.activeAction="idle",t.target=void 0,O.Success):(t.activeAction="moving",t.target=o.id,t.direction=Pt(t.position,o.position,i.gameState.mapDimensions),[O.Running,`Returning to parent (${Math.round(s)}px away)`])}}),yR=nt({type:x.HumanDiplomacy,requireAdult:!0,scorer:(e,t)=>e.id===e.leaderId&&t.creatorEntityId===e.id?1:null,executor:(e,t,i)=>{var d,u,h,g,y,I;const{gameState:o}=i,s=vo(t.id,o),l=X0(s),c=ou(o).filter(v=>v.leaderId!==t.id);for(const v of c){const T=vo(v.leaderId,o),A=X0(T),E=((u=(d=t.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[v.leaderId])||It.Friendly,C=o.entities.entities[v.leaderId];((g=(h=C==null?void 0:C.tribeControl)==null?void 0:h.diplomacy)==null?void 0:g[t.id])===It.Hostile||l>A*Xw?E!==It.Hostile&&((y=t.tribeControl)!=null&&y.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=It.Hostile):E!==It.Friendly&&((I=t.tribeControl)!=null&&I.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=It.Friendly)}return t.aiBlackboard&&Oe.set(t.aiBlackboard,"lastDiplomacyCheckTime",o.time),O.Success}}),hu=[YP,zP,jP,XP,VP,qP,KP,QP,JP,eR,tR,nR,iR,oR,sR,aR,lR,cR,dR,fR,hR,pR,gR,mR,yR].reduce((e,t)=>(e[t.type]=t,e),{}),vR=Object.values(hu);function IR(e,t){Wa(e,t,vR)}function SR(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const o=Gc(e);if(o){const s=t.gameState.tasks[o];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),Oi(e,null)}return}let i=Gc(e);if(i){const o=t.gameState.tasks[i];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(Oi(e,null),i=null)}if(!i){const o=AR(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];i=o,Oi(e,i),s&&(s.claimedByEntityId=e.id)}}if(i){const o=t.gameState.tasks[i];o?YI(e,o,t,hu):Oi(e,null)}}function AR(e,t){let i=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let l of s){if(!l||l.claimedByEntityId&&l.claimedByEntityId!==e.id)continue;const c=hu[l.type];if(!c||!c.scorer)continue;const d=c.scorer(e,l,t);d!==null&&d>o&&(o=d,i=l.id)}return o>0?i:null}function TR(e,t){const i=performance.now();switch(e.aiType){case Ao.TaskBased:default:SR(e,t);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-i}const ER=(e,t)=>{const i={};for(let o=0;o<rR;o++){const s=`hunt-prey-${e.id}-${o}`;i[s]={id:s,type:x.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return i},wR=(e,t)=>{const i={};if(e.hitpoints<=0)return i;const o=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((o==null?void 0:o.type)==="human"))return i;for(let l=0;l<jw;l++){const c=`hunt-predator-${e.id}-${l}`;i[c]={id:c,type:x.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return i},xc=UC*1.5,_R=(e,t)=>{const i={},o=t.gameState,s=[...o.search.human.byRadius(e.position,xc),...o.search.predator.byRadius(e.position,xc)].filter(u=>{if(u.id===e.id)return!1;if(e.type==="prey")return u.type==="human"||u.type==="predator";if(e.type==="predator"){if(u.type==="human")return!0;if(u.type==="predator")return u.geneCode!==e.geneCode}return!1});if(s.length===0)return i;let l=s[0],c=Nn(e.position,l.position);for(let u=1;u<s.length;u++){const h=Nn(e.position,s[u].position);h<c&&(c=h,l=s[u])}const d=`animal-flee-${e.id}-${l.id}`;return i[d]={id:d,type:x.AnimalFlee,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1},i},CR=(e,t,i)=>{const o=i.gameState.entities.entities[t.target];if(!o)return null;const s=Nn(e.position,o.position);return s>xc?null:Ze(s)*.95},PR=(e,t,i)=>{const o=i.gameState.entities.entities[e.target];if(!o)return O.Failure;if(Nn(t.position,o.position)>xc*1.2)return O.Success;const l=Dt(dh(t.position,o.position)),c=li(t.position,mt(l,100));return t.activeAction="moving",t.target=c,O.Running},RR={type:x.AnimalFlee,producer:_R,scorer:CR,executor:PR},zI=600,MR=(e,t)=>{if(e.type!=="prey")return{};const i={},s=t.gameState.search.berryBush.byRadius(e.position,zI).filter(l=>l.food.length>0);for(const l of s){const c=`animal-graze-${e.id}-${l.id}`;i[c]={id:c,type:x.AnimalGraze,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},kR=(e,t,i)=>{if(e.type!=="prey")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.food.length===0)return null;const s=Nn(e.position,o.position);if(s>zI)return null;const l=Ze(s),c=Math.max(0,e.hunger/lu);return e.hunger<20&&s>100?null:l*c*.65},DR=(e,t,i)=>{if(t.type!=="prey")return O.Failure;const o=i.gameState.entities.entities[e.target];return!o||o.food.length===0||(t.activeAction="grazing",t.target=o.id,t.hunger<5)?O.Success:O.Running},OR={type:x.AnimalGraze,producer:MR,scorer:kR,executor:DR},jI=800,bR=(e,t)=>{if(e.type!=="predator")return{};const i={},s=t.gameState.search.prey.byRadius(e.position,jI).filter(l=>l.type==="prey");for(const l of s){const c=`animal-hunt-${e.id}-${l.id}`;i[c]={id:c,type:x.AnimalHunt,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},NR=(e,t,i)=>{if(e.type!=="predator")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.hitpoints<=0)return null;const s=Nn(e.position,o.position);if(s>jI)return null;const l=Ze(s),c=Math.max(0,e.hunger/cu);return e.hunger<30&&s>200?null:l*c*.8},BR=(e,t,i)=>{if(t.type!=="predator")return O.Failure;const o=i.gameState.entities.entities[e.target];return!o||o.hitpoints<=0||(t.activeAction="attacking",t.target=o.id,t.hunger<10)?O.Success:O.Running},HR={type:x.AnimalHunt,producer:bR,scorer:NR,executor:BR},XI=500,FR=(e,t)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return{};const i={},s=t.gameState.search[e.type].byRadius(e.position,XI).filter(l=>{if(l.id===e.id||l.type!==e.type)return!1;const c=l;return c.isAdult&&c.gender!==e.gender&&(!c.procreationCooldown||c.procreationCooldown<=0)&&!c.isPregnant});for(const l of s){const c=`animal-procreate-${e.id}-${l.id}`;i[c]={id:c,type:x.AnimalProcreate,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},LR=(e,t,i)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return null;const o=i.gameState.entities.entities[t.target];if(!o||!o.isAdult||o.gender===e.gender||o.procreationCooldown&&o.procreationCooldown>0||o.isPregnant)return null;const s=Nn(e.position,o.position);return s>XI?null:Ze(s)*.6},UR=(e,t,i)=>{const o=i.gameState.entities.entities[e.target];return!o||o.isPregnant||o.procreationCooldown&&o.procreationCooldown>0?O.Failure:(t.activeAction="procreating",t.target=o.id,t.isPregnant||t.procreationCooldown&&t.procreationCooldown>0?O.Success:O.Running)},GR={type:x.AnimalProcreate,producer:FR,scorer:LR,executor:UR},xR=200,$R=(e,t)=>{const i=`animal-wander-${e.id}`,o=Math.random()*Math.PI*2,s=Math.random()*xR,l={x:e.position.x+Math.cos(o)*s,y:e.position.y+Math.sin(o)*s};l.x=Math.max(0,Math.min(t.gameState.mapDimensions.width,l.x)),l.y=Math.max(0,Math.min(t.gameState.mapDimensions.height,l.y));const c={};return c[i]={id:i,type:x.AnimalWander,position:l,creatorEntityId:e.id,validUntilTime:t.gameState.time+5},c},WR=()=>.1,YR=(e,t)=>Nn(t.position,e.position)<10?(t.activeAction="idle",O.Success):(t.activeAction="moving",t.target=e.position,O.Running),zR={type:x.AnimalWander,producer:$R,scorer:WR,executor:YR},jR=(e,t)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return{};const i={},s=t.gameState.search[e.type].byRadius(e.position,600).filter(l=>{if(l.type!==e.type)return!1;const c=l;return c.motherId===e.id&&c.hunger>=uu});for(const l of s){const c=`animal-feed-child-${e.id}-${l.id}`;i[c]={id:c,type:x.AnimalFeedChild,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},XR=(e,t,i)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return null;const o=i.gameState.entities.entities[t.target];if(!o||o.motherId!==e.id)return null;const s=Nn(e.position,o.position),l=Ze(s),c=e.type==="prey"?lu:cu,d=Math.max(0,o.hunger/c);return l*d*.9},VR=(e,t,i)=>{const o=i.gameState.entities.entities[e.target];return!o||o.hunger<uu/2?O.Success:Nn(t.position,o.position)<30?(t.activeAction="feeding",O.Running):(t.activeAction="moving",t.target=o.id,O.Running)},qR={type:x.AnimalFeedChild,producer:jR,scorer:XR,executor:VR},ZR=(e,t)=>{if(e.isAdult||e.hunger<uu||!e.motherId)return{};const i=t.gameState.entities.entities[e.motherId];if(!i)return{};const o={},s=`animal-seek-food-${e.id}-${i.id}`;return o[s]={id:s,type:x.AnimalSeekFoodFromParent,position:i.position,creatorEntityId:e.id,target:i.id,validUntilTime:t.gameState.time+1},o},KR=(e,t,i)=>{if(e.isAdult||!e.motherId)return null;const o=i.gameState.entities.entities[e.motherId];if(!o)return null;const s=Nn(e.position,o.position),l=Ze(s),c=e.type==="prey"?lu:cu,d=Math.max(0,e.hunger/c);return l*d*.85},QR=(e,t,i)=>{const o=i.gameState.entities.entities[e.target];return!o||t.hunger<uu/2?O.Success:(Nn(t.position,o.position)<30||(t.activeAction="moving",t.target=o.id),O.Running)},JR={type:x.AnimalSeekFoodFromParent,producer:ZR,scorer:KR,executor:QR},eM=(e,t)=>{if(e.type!=="prey")return{};if(e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return{};const i={},o=t.gameState,{width:s,height:l}=t.gameState.mapDimensions,c=o.search.prey.byRadius(e.position,is*5),d=[];for(const u of c)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&d.push(u);if(d.length>=2){let u=0,h=0;for(const I of d)u+=I.position.x,h+=I.position.y;u/=d.length,h/=d.length;const g={x:u,y:h};if(z(e.position,g,s,l)>is*2){const I=`animal-herd-${e.id}`;i[I]={id:I,type:x.AnimalHerd,position:g,creatorEntityId:e.id,target:g,validUntilTime:t.gameState.time+1}}}return i},tM=(e,t,i)=>{if(e.type!=="prey"||e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return null;const o=t.target,{width:s,height:l}=i.gameState.mapDimensions,c=z(e.position,o,s,l);return c<=is*2?null:Ze(c)*.4},nM=(e,t,i)=>{if(t.type!=="prey")return O.Failure;const o=e.target,{width:s,height:l}=i.gameState.mapDimensions;if(z(t.position,o,s,l)<=is*2)return t.activeAction="idle",t.direction={x:0,y:0},O.Success;t.activeAction="moving",t.target=o;const d=ze(t.position,o,s,l);return t.direction=Dt(d),O.Running},iM={type:x.AnimalHerd,producer:eM,scorer:tM,executor:nM},oM=(e,t)=>{if(e.type!=="predator")return{};const i=e.hunger>100,o=e.hitpoints<e.maxHitpoints*.5;if(!i&&!o)return{};if(e.attackCooldown&&e.attackCooldown>0)return{};const s={},c=t.gameState.search.human.byRadius(e.position,ar*2);let d=null,u=1/0;for(const h of c)if(h.hitpoints>0){const g=z(e.position,h.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);g<u&&(u=g,d=h)}if(d){const h=`animal-attack-human-${e.id}-${d.id}`;s[h]={id:h,type:x.AnimalAttack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return s},rM=(e,t,i)=>{if(e.type!=="predator")return null;const o=t.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const l=z(e.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return l>ar*2.5?null:Ze(l)*.75},sM=(e,t,i)=>{if(t.type!=="predator")return O.Failure;const o=e.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return O.Success;const{width:l,height:c}=i.gameState.mapDimensions;if(z(t.position,s.position,l,c)<=ar)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},O.Running;{t.activeAction="moving",t.target=s.id;const u=ze(t.position,s.position,l,c);return t.direction=Dt(u),O.Running}},aM={type:x.AnimalAttack,producer:oM,scorer:rM,executor:sM},lM=(e,t)=>{if(e.type!=="predator")return{};if(!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120||e.attackCooldown&&e.attackCooldown>0)return{};const i={},s=t.gameState.search.predator.byRadius(e.position,RI);let l=null,c=1/0;for(const d of s)if(d.id!==e.id&&d.hitpoints>0&&d.isAdult&&e.fatherId!==d.fatherId&&e.gender===d.gender&&e.fatherId!==void 0&&d.fatherId!==void 0){const u=z(e.position,d.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);u<c&&(c=u,l=d)}if(l){const d=`animal-territorial-${e.id}-${l.id}`;i[d]={id:d,type:x.AnimalTerritorial,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},cM=(e,t,i)=>{if(e.type!=="predator"||!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120)return null;const o=t.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const l=z(e.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return l>RI*1.2?null:Ze(l)*.7},uM=(e,t,i)=>{if(t.type!=="predator")return O.Failure;const o=e.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return O.Success;const{width:l,height:c}=i.gameState.mapDimensions;if(z(t.position,s.position,l,c)<=ar)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},O.Running;{t.activeAction="moving",t.target=s.id;const u=ze(t.position,s.position,l,c);return t.direction=Dt(u),O.Running}},dM={type:x.AnimalTerritorial,producer:lM,scorer:cM,executor:uM},fM=(e,t)=>{if(e.type!=="predator")return{};if(e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return{};if(e.fatherId===void 0)return{};const i={},o=t.gameState,{width:s,height:l}=t.gameState.mapDimensions,c=o.search.predator.byRadius(e.position,os*4);let d=null;for(const u of c)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&u.fatherId===e.fatherId&&(u.age>=e.age||u.hitpoints>e.hitpoints)&&(!d||u.age>d.age)&&(d=u);if(d&&z(e.position,d.position,s,l)>os*2){const h=`animal-pack-follow-${e.id}-${d.id}`;i[h]={id:h,type:x.AnimalPack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return i},hM=(e,t,i)=>{if(e.type!=="predator"||e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return null;const o=t.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const{width:l,height:c}=i.gameState.mapDimensions,d=z(e.position,s.position,l,c);return d<=os*2?null:Ze(d)*.35},pM=(e,t,i)=>{if(t.type!=="predator")return O.Failure;const o=e.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return O.Success;const{width:l,height:c}=i.gameState.mapDimensions;if(z(t.position,s.position,l,c)<=os*2)return t.activeAction="idle",t.direction={x:0,y:0},O.Success;t.activeAction="moving",t.target=s.id;const u=ze(t.position,s.position,l,c);return t.direction=Dt(u),O.Running},gM={type:x.AnimalPack,producer:fM,scorer:hM,executor:pM},zt={};zt[x.HumanHuntPrey]={type:x.HumanHuntPrey,producer:ER};zt[x.HumanHuntPredator]={type:x.HumanHuntPredator,producer:wR};zt[x.AnimalFlee]=RR;zt[x.AnimalGraze]=OR;zt[x.AnimalHunt]=HR;zt[x.AnimalAttack]=aM;zt[x.AnimalProcreate]=GR;zt[x.AnimalWander]=zR;zt[x.AnimalFeedChild]=qR;zt[x.AnimalSeekFoodFromParent]=JR;zt[x.AnimalHerd]=iM;zt[x.AnimalTerritorial]=dM;zt[x.AnimalPack]=gM;function iy(e,t){Wa(e,t,Object.values(zt))}function VI(e,t){let i=Gc(e);if(i){const o=t.gameState.tasks[i];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(Oi(e,null),i=null)}if(!i){const o=mM(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];i=o,Oi(e,i),s&&(s.claimedByEntityId=e.id)}}if(i){const o=t.gameState.tasks[i];o?YI(e,o,t,zt):Oi(e,null)}}function mM(e,t){let i=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,1e3);for(let l of s){if(!l||l.claimedByEntityId&&l.claimedByEntityId!==e.id)continue;const c=zt[l.type];if(!c||!c.scorer)continue;const d=c.scorer(e,l,t);d!==null&&d>o&&(o=d,i=l.id)}return o>0?i:null}function yM(e,t){VI(e,t)}function vM(e,t){VI(e,t)}const IM=(e,t)=>{if(e.buildingType!==de.PlantingZone||!e.isConstructed)return{};const{gameState:i}=t,o=lI(e);if(b1(e,i)>=o)return{};const l=i.search.tasks.byProperty("creatorEntityId",e.id).find(g=>g.type===x.HumanPlantBush);if(l)return{[l.id]:l};const c=i.mapDimensions.width,d=i.mapDimensions.height,u=i.soilDepletion,h=10;for(let g=0;g<h;g++){const y=e.position.x+(Math.random()-.5)*e.width,I=e.position.y+(Math.random()-.5)*e.height,v={x:(y%c+c)%c,y:(I%d+d)%d};if(!ir(u,v,c,d)&&!Ni(v,i,Zc)){const T=`plant-bush-${e.id}`,A={id:T,type:x.HumanPlantBush,position:v,creatorEntityId:e.id,target:v,validUntilTime:i.time+UP};return{[T]:A}}}return{}},SM=(e,t)=>{const i={};if(e.buildingType===de.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const o=`stockpile-${e.id}`;i[o]={id:o,type:x.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i},AM=(e,t)=>{const i={};if(e.buildingType===de.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*m_){const o=`fuel-bonfire-${e.id}`;i[o]={id:o,type:x.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i},TM=(e,t)=>{const i={};if(e.buildingType===de.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let o=0;o<S_;o++){const s=`seek-warmth-${e.id}-${o}`;i[s]={id:s,type:x.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i},EM=(e,t)=>{const i={};if(e.buildingType===de.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(o=>o.item.itemType==="food")){const o=`retrieve-from-${e.id}`;i[o]={id:o,type:x.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i},wM={[x.HumanPlantBush]:{type:x.HumanPlantBush,producer:IM},[x.HumanStockpile]:{type:x.HumanStockpile,producer:SM},[x.HumanFuelBonfire]:{type:x.HumanFuelBonfire,producer:AM},[x.HumanSeekWarmth]:{type:x.HumanSeekWarmth,producer:TM},[x.HumanRetrieve]:{type:x.HumanRetrieve,producer:EM}};function qI(e,t){Wa(e,t,Object.values(wM))}function _M(e,t){const{gameState:i,deltaTime:o}=t,s=o*(Mt/Ht);if(e.isBeingDestroyed){const l=LT(e.buildingType);if(l>0?e.destructionProgress+=s/l:e.destructionProgress=1,e.destructionProgress>=1){const c=e.buildingType===de.PlantingZone;cr(i.entities,e.id),c&&_a(i);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const l=FT(e.buildingType);l>0?e.constructionProgress+=s/l:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&Lv(e.position,es,e.ownerId,i),e.buildingType===de.PlantingZone&&_a(i))}if(e.buildingType===de.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*g_,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*v_)){const l=e.storedItems.findIndex(c=>c.item.itemType==="item"&&c.item.type===kt.Wood);l!==-1&&(e.storedItems.splice(l,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+$v))}qI(e,t)}function CM(e,t){const i=t.deltaTime*Mt/Ht;if(e.age+=i,!e.stateMachine)return;const[o]=e.stateMachine;o!==Yt&&o!==bi&&o!==nr&&(e.age>=So&&!e.woodGenerated&&(e.wood=Array.from({length:du},()=>({itemType:"item",type:kt.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=$a*Math.min(1,Math.max(.4,e.age/So)))}const PM={type:x.HumanGatherBerries,producer:(e,t)=>{const i={};if(e.type!=="berryBush")return i;if(e.food.length>0){const o=`gather-berries-${e.id}`;i[o]={id:o,type:x.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i}},RM={type:x.HumanChopTree,producer:(e,t)=>{const i={};if(e.type!=="tree")return i;const[o]=e.stateMachine??[];if(o===zn||o===bn||o===ui){const l=`chop-tree-${e.id}`;i[l]={id:l,type:x.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i}},MM={type:x.HumanGatherWood,producer:(e,t)=>{const i={};if(e.type!=="tree")return i;const[o]=e.stateMachine??[];if(o===Yt&&e.wood.length>0){const l=`gather-wood-${e.id}`;i[l]={id:l,type:x.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i}},kM=[PM,RM,MM].reduce((e,t)=>(e[t.type]=t,e),{});function oy(e,t){Wa(e,t,Object.values(kM))}const DM={type:x.HumanGatherMeat,producer:(e,t)=>{const i={};if(e.food.length>0){const o=`gather-meat-${e.id}`;i[o]={id:o,type:x.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Et}}return i}},OM=[DM].reduce((e,t)=>(e[t.type]=t,e),{});function bM(e,t){Wa(e,t,Object.values(OM))}var Ec=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(Ec||{});function Of(e,t,i){switch(i){case 0:NM(e,t);break;case 1:BM(e,t);break;case 2:HM(e,t);break}}function NM(e,t){e.forces.push(mt(e.velocity,-.1));const i=mt(Dt(e.direction),e.acceleration);e.forces.push(i),e.debuffs.forEach(o=>{t.gameState.time-o.startTime<o.duration&&o.type==="slow"&&(e.velocity=mt(e.velocity,.5))}),e.debuffs=e.debuffs.filter(o=>t.gameState.time-o.startTime<o.duration),e.velocity=li(e.velocity,e.forces.reduce(li,{x:0,y:0})),go(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=li(e.position,mt(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&go(e.velocity)>.1&&H1(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?NP(e,t,t.deltaTime):e.type==="corpse"?BP(e,t):e.type==="prey"?HP(e,t,t.deltaTime):e.type==="predator"?FP(e,t,t.deltaTime):e.type==="building"?_M(e,t):e.type==="tree"?CM(e,t):e.type,e.stateMachine&&(e.stateMachine=DP(...e.stateMachine,{entity:e,updateContext:t}))}function BM(e,t){ZI(e,t)&&(e.type==="human"?IR(e,t):e.type==="corpse"?bM(e,t):e.type==="prey"||e.type==="predator"?iy(e,t):e.type==="building"?qI(e,t):(e.type==="tree"||e.type==="berryBush")&&oy(e,t))}function HM(e,t){ZI(e,t)&&(e.type==="human"?TR(e,t):e.type==="corpse"||(e.type==="prey"?yM(e,t):e.type==="predator"?vM(e,t):e.type==="building"||e.type==="tree"||e.type),Oe.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function ZI(e,t){const i=Oe.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-i+(Math.random()-Math.random())*R0/10>R0}function FM(e){const t=e.gameState.entities.entities;for(const i in t)Of(t[i],e,Ec.Physics);for(const i in t)Of(t[i],e,Ec.PrepareAI);OT(e.gameState);for(const i in t)Of(t[i],e,Ec.ExecuteAI)}function KI(){return{entities:{},nextEntityId:1}}function lr(e,t,i){const o={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:Oe.create(),...i};return e.entities[o.id]=o,o}function Ya(e,t,i){return lr(e,"berryBush",{position:t,radius:Kf,food:Array.from({length:JE},()=>({itemType:"food",type:qn.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:QE,lifespan:tw,age:0,spreadRadius:Kf,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:Oe.create(),stateMachine:[ga,{enteredAt:i,previousState:void 0}]})}function Fa(e,t,i,o=0){const s=o>=So;return lr(e,"tree",{position:t,radius:$a,age:o,lifespan:fP,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:AP,stateMachine:[zn,{enteredAt:i,previousState:void 0}],aiBlackboard:Oe.create(),wood:s?Array.from({length:du},()=>({itemType:"item",type:kt.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function jr(e,t,i,o,s=!1,l=vw,c=kv,d,u,h=[],g,y,I=Ao.TaskBased){const v=l>=Eh;return lr(e,"human",{position:t,radius:v?ft:cs,hunger:c,hitpoints:C0,maxHitpoints:C0,age:l,gender:o,isPlayer:s,food:[],maxFood:Pv,maxAge:Ma,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:d,fatherId:u,ancestorIds:h,stateMachine:[at,{enteredAt:i,previousState:void 0}],leaderId:g,tribeInfo:y,aiType:I,aiBlackboard:Oe.create()})}function Zh(e,t,i,o,s,l,c,d,u,h,g){let y,I;switch(c){case"human":y=Ov,I=On;break;case"prey":y=2,I=120;break;case"predator":y=4,I=140;break}return lr(e,"corpse",{position:t,radius:s,gender:i,age:o,originalEntityId:l,originalEntityType:c,timeOfDeath:d,decayProgress:0,geneCode:g,food:[...Array.from({length:Math.max(y*Math.max(I-h,0)/I,0)},()=>({itemType:"food",type:qn.Meat})),...u].map(T=>({...T,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:Oe.create()})}function LM(e,t,i,o,s,l,c,d,u){return Zh(e,t,i,o,s,l,"human",c,d,u)}function UM(e,t,i,o,s,l,c,d){return Zh(e,t,i,o,s,l,"prey",c,[],0,d)}function GM(e,t,i,o,s,l,c,d){return Zh(e,t,i,o,s,l,"predator",c,[],0,d)}function xM(e,t,i){const o=t?i.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],l=o?[...o.ancestorIds||[],o.id]:[],c=[...s,...l],d=[...new Set(c)],u=d.slice(Math.max(d.length-_v,0)),h=Math.random()<.5?"male":"female",g=li(e.position,{x:5,y:5}),y=jr(i.gameState.entities,g,i.gameState.time,h,!1,0,kv/2,e.id,t,u,(o==null?void 0:o.leaderId)??e.leaderId,(o==null?void 0:o.tribeInfo)??e.tribeInfo,e.aiType);return we(i,Ie.Birth,e.position),y}function cr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function rs(e,t,i,o=LC,s=wI,l,c,d,u=Ao.TaskBased){const h=o>=_I,g=Date.now();return lr(e,"prey",{position:t,radius:h?ft*.7:cs*.7,hunger:s,hitpoints:Q0,maxHitpoints:Q0,age:o,maxAge:EI,gender:i,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:l,motherId:c,fatherId:d,stateMachine:[Yn,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:Oe.create()})}function ss(e,t,i,o=zC,s=PI,l,c,d,u=Ao.TaskBased){const h=o>=DI,g=Date.now();return lr(e,"predator",{position:t,radius:h?ft*.9:cs*.9,hunger:s,hitpoints:J0,maxHitpoints:J0,age:o,maxAge:CI,gender:i,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:l,motherId:c,fatherId:d,stateMachine:[Qt,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:Oe.create()})}function $M(e,t,i,o){const s=fh(i),l={position:t,radius:Math.max(s.width,s.height)/2,buildingType:i,ownerId:o,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:fC,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:i===de.Bonfire?eh:void 0,maxFuelLevel:i===de.Bonfire?eh:void 0,aiBlackboard:Oe.create(),stateMachine:["",{enteredAt:0}]};return lr(e,"building",l)}var Zt=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(Zt||{}),Qo=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(Qo||{}),Kt=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(Kt||{});const sh={},ah={},WM=[{key:Zt.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:Zt.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>gw,isCompleted:!1,minDisplayTime:G0,highlightedUIElements:[Qo.HUNGER_BAR]},{key:Zt.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!je(t,e,"berryBush",Xe*5,o=>o.food.length>0),getTargets:(e,t)=>{const i=[];for(const o of Object.values(e.entities.entities))o.type==="berryBush"&&o.food.length>0&&z(t.position,o.position,e.mapDimensions.width,e.mapDimensions.height)<500&&i.push(o);return i.map(o=>o.id)},isCompleted:!1,minDisplayTime:G0},{key:Zt.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const i=je(t,e,"berryBush",Xe,o=>o.food.length>0);return i?[i.id]:[]},isCompleted:!1},{key:Zt.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[Qo.FOOD_BAR]},{key:Zt.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>Bi(e,t).length>0,getTargets:(e,t)=>{const i=je(t,e,"human",Xe,o=>ls(t,o,e));return i?[i.id]:[]},isCompleted:!1},{key:Zt.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>Yh(e,t).some(o=>o.type===ue.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:Zt.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[Qo.COMMAND_BUTTONS],isCompleted:!1},{key:Zt.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(i=>i.type==="prey"||i.type==="predator"),isCompleted:!1,dependsOn:Zt.AUTOPILOT},{key:Zt.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const i=je(t,e,"prey",150);return t.hunger>40&&!!i},getTargets:(e,t)=>{const i=je(t,e,"prey",150);return i?[i.id]:[]},isCompleted:!1,dependsOn:Zt.ANIMALS_INTRODUCTION},{key:Zt.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!je(t,e,"predator",120),getTargets:(e,t)=>{const i=je(t,e,"predator",120);return i?[i.id]:[]},isCompleted:!1,dependsOn:Zt.HUNT_PREY}].map(e=>({...e,condition:e.condition?jM(e.condition):void 0,getTargets:e.getTargets?XM(e.getTargets):void 0}));function QI(){return{steps:WM.map(e=>({...e,isCompleted:!1}))}}function JI(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:Kt.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function YM(e){for(let t=0;t<e.tutorial.steps.length;t++){const i=e.tutorial.steps[t];if(!i.isCompleted)if(i.dependsOn){if(e.tutorialState.completedSteps.includes(i.dependsOn))return t}else return t}return null}function zM(e,t){const i=e.tutorialState;if(!i.isActive){i.transitionState=Kt.INACTIVE,i.highlightedEntityIds=[],i.activeUIHighlights=[];return}const o=At(e);if(!o){i.isActive=!1,i.transitionState=Kt.INACTIVE,i.highlightedEntityIds=[],i.activeUIHighlights=[];return}const s=e.tutorial.steps[i.currentStepIndex];if(!s){i.isActive=!1,i.transitionState=Kt.INACTIVE,i.highlightedEntityIds=[],i.activeUIHighlights=[];return}const l=1/i1;switch(i.transitionState){case Kt.FADING_IN:i.stepStartTime===null&&(i.stepStartTime=e.time),i.transitionAlpha+=l*t,i.transitionAlpha>=1&&(i.transitionAlpha=1,i.transitionState=Kt.ACTIVE);break;case Kt.ACTIVE:{const u=e.time-(i.stepStartTime||e.time)>=(s.minDisplayTime||0),h=sh[s.condition];h&&u&&h(e,o)&&(s.isCompleted=!0,i.completedSteps.includes(s.key)||i.completedSteps.push(s.key),i.transitionState=Kt.FADING_OUT);break}case Kt.FADING_OUT:if(i.transitionAlpha-=l*t,i.transitionAlpha<=0){i.transitionAlpha=0,i.stepStartTime=null;const d=YM(e);d!==null?(i.currentStepIndex=d,i.transitionState=Kt.FADING_IN):(i.isActive=!1,i.transitionState=Kt.INACTIVE)}break}if(i.transitionState!==Kt.FADING_OUT&&i.transitionState!==Kt.INACTIVE){const d=ah[s.getTargets||""];d?i.highlightedEntityIds=[...d(e,o)]:i.highlightedEntityIds=[],s.highlightedUIElements?i.activeUIHighlights=[...s.highlightedUIElements]:i.activeUIHighlights=[]}else i.highlightedEntityIds=[],i.activeUIHighlights=[]}function jM(e){const t=`condition_${Object.keys(sh).length+1}`;return sh[t]=e,t}function XM(e){const t=`getTargets_${Object.keys(ah).length+1}`;return ah[t]=e,t}function VM(){const e=KI(),t=0;for(let I=0;I<mv;I++){const v={x:Math.random()*Ue,y:Math.random()*Ge};Ya(e,v,t)}for(let I=0;I<gv;I++){const v={x:Math.random()*Ue,y:Math.random()*Ge};Fa(e,v,t)}const i=Ue/2,o=Ge/2;for(let I=0;I<5;I++){const v=I/5*Math.PI*2,T=100+Math.random()*100,A={x:i+Math.cos(v)*T,y:o+Math.sin(v)*T};Fa(e,A,t,So)}const s=jr(e,{x:i-25,y:o},t,"male",!0),l=jr(e,{x:i+25,y:o},t,"female",!1);l.leaderId=s.id,l.tribeInfo={tribeBadge:"",tribeColor:Jt[0]},s.aiType=Ao.TaskBased,l.aiType=Ao.TaskBased;for(let I=0;I<5;I++){const v=I/5*Math.PI*2,T=Ue/2,A=Ge/2,E={x:i+Math.cos(v)*T,y:o+Math.sin(v)*A},C=jr(e,{x:E.x,y:E.y},t,"male",!1);C.leaderId=C.id,C.tribeInfo={tribeBadge:Nc[I%Nc.length],tribeColor:Jt[I%Jt.length]};const _=jr(e,{x:E.x+50,y:E.y},t,"female",!1);_.leaderId=C.id,_.tribeInfo=C.tribeInfo}for(let I=0;I<OI;I++){const v={x:i+Ue*(Math.random()-Math.random()),y:o+Ge*(Math.random()-Math.random())};rs(e,v,"male",void 0,void 0,Na()),rs(e,{x:v.x+20,y:v.y},"female",void 0,void 0,Na())}const c={x:i+Ue*(Math.random()-Math.random()),y:o+Ge*(Math.random()-Math.random())};ss(e,c,"male",void 0,void 0,Ba()),ss(e,{x:c.x+20,y:c.y},"female",void 0,void 0,Ba());const d=[{id:"muteButton",action:me.ToggleMute,currentWidth:Pi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:St},{id:"pauseButton",action:me.TogglePause,currentWidth:Pi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:St},{id:"returnToIntroButton",action:me.ReturnToIntro,currentWidth:Pi,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:St}],u=QI(),h=JI(),g={time:t,entities:e,mapDimensions:{width:Ue,height:Ge},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:gI,isMuted:!1,uiButtons:d,tutorial:u,tutorialState:h,debugPanel:Ye.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:er.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:Xo,preyProcreationCooldown:Vo,predatorGestationPeriod:qo,predatorProcreationCooldown:Zo,preyHungerIncreasePerHour:uo,predatorHungerIncreasePerHour:fo,berryBushSpreadChance:Di},soilDepletion:Iv(),temperature:GI(Ue,Ge),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ue/Ee)*Math.ceil(Ge/Ee)).fill(null),tasks:{}},y=Wc(g);return console.log("Game world initialized:",y),y}function qM(){const e=KI(),t=0;for(let u=0;u<mv;u++){const h={x:Math.random()*Ue,y:Math.random()*Ge};Ya(e,h,t)}for(let u=0;u<gv;u++){const h={x:Math.random()*Ue,y:Math.random()*Ge};Fa(e,h,t)}const i=Ue/2,o=Ge/2;for(let u=0;u<5;u++){const h=u/5*Math.PI*2,g=100+Math.random()*100,y={x:i+Math.cos(h)*g,y:o+Math.sin(h)*g};Fa(e,y,t,So)}for(let u=0;u<qE;u++){const h={x:Math.random()*Ue,y:Math.random()*Ge},g=Math.random()<.5?"male":"female";jr(e,h,t,g,!1)}for(let u=0;u<OI;u++){const h={x:Math.random()*Ue,y:Math.random()*Ge};rs(e,h,"male",void 0,void 0,Na()),rs(e,{x:h.x+20,y:h.y},"female",void 0,void 0,Na())}const s={x:Math.random()*Ue,y:Math.random()*Ge};ss(e,s,"male",void 0,void 0,Ba()),ss(e,{x:s.x+20,y:s.y},"female",void 0,void 0,Ba());const l=QI(),c=JI(),d={time:t,entities:e,mapDimensions:{width:Ue,height:Ge},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Ue/2,y:Ge/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:gI,isMuted:!0,uiButtons:[],tutorial:l,tutorialState:c,debugPanel:Ye.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:Xo,preyProcreationCooldown:Vo,predatorGestationPeriod:qo,predatorProcreationCooldown:Zo,preyHungerIncreasePerHour:uo,predatorHungerIncreasePerHour:fo,berryBushSpreadChance:Di},soilDepletion:Iv(),temperature:GI(Ue,Ge),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ue/Ee)*Math.ceil(Ge/Ee)).fill(null),tasks:{}};return Wc(d)}const ZM="humanProcreation",KM="human",QM="human",JM=Xe,ek=(e,t,i)=>ls(e,t,i.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,tk=(e,t,i)=>{const{gameState:o}=i,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},l=e.gender==="male"?e:t,c=e.gender==="female"?e:t,d=(l.partnerIds||[]).length===0;if(e.stateMachine[0]!==Yo&&(e.stateMachine=[Yo,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:i.gameState.time+1}]),t.stateMachine[0]!==Yo&&(t.stateMachine=[Yo,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:i.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),d&&l.leaderId&&l.leaderId!==l.id){const u=o.entities.entities[l.leaderId];if(u){const h=ih(l,u),g=ih(c,u);if(!h&&!g){const y=Hc();l.leaderId=l.id,l.tribeInfo={tribeBadge:y,tribeColor:Jt[Math.floor(Math.random()*Jt.length)]},l.tribeControl={diplomacy:{}},c.leaderId=l.id,c.tribeInfo=l.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&l&&c){const u=Hc();l.leaderId=l.id,l.tribeInfo={tribeBadge:u,tribeColor:Jt[Math.floor(Math.random()*Jt.length)]},l.tribeControl={diplomacy:{}},c.leaderId=l.id,c.tribeInfo=l.tribeInfo}e.activeAction=void 0,be(o,ye.Procreation,s,Da),be(o,ye.Partnered,e.position,xe,e.id),be(o,ye.Partnered,t.position,xe,t.id),e.lastPartneredEffectTime=o.time,t.lastPartneredEffectTime=o.time,t.activeAction=void 0,we(i,Ie.Procreate,s)},nk={id:ZM,sourceType:KM,targetType:QM,maxDistance:JM,checker:ek,perform:tk},ik={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:Dv,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=mo&&e.activeAction==="feeding",perform:(e,t,i)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-mo),e.feedChildCooldownTime=ww,(!t.lastChildFedEffectTime||i.gameState.time-t.lastChildFedEffectTime>2)&&(be(i.gameState,ye.ChildFed,t.position,xe,t.id),t.lastChildFedEffectTime=i.gameState.time),we(i,Ie.ChildFed,t.position)}},ok={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:un,checker:(e,t,i)=>{var g,y;if(e.stateMachine[0]!==Io||e.attackTargetId!==t.id)return!1;const o=z(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),s=o<=yo,l=!s&&o<=un;if(!s&&!l||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((y=e.attackCooldown)==null?void 0:y.ranged)||0)>0)return!1;const d=s?Jc:Ph,u=e.stateMachine[1];return i.gameState.time-u.attackStartTime>=d},perform:(e,t,i)=>{const{gameState:o}=i,s=z(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),l=s>yo,c=ze(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),d=kT(Dt(c),t.direction);if(Math.abs(d)<Hw*Math.PI/180&&Math.random()<Fw)be(o,ye.AttackDeflected,t.position,xe,t.id);else{let g=l?Ch:_h;if(e.gender==="male"&&(g*=bw),e.isAdult||(g*=Nw),(!t.isAdult||t.age>=wh)&&e.isAdult&&(g*=Bw),l){const I=s/Rh;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+I,data:{attackerId:e.id,targetId:t.id,damage:g,pushbackForce:kh,attackerPosition:{...e.position}}}),be(o,ye.StoneProjectile,e.position,I,void 0,t.position,t.id),we(i,Ie.Attack,e.position)}else{t.hitpoints-=g,t.movementSlowdown={modifier:tu,endTime:o.time+nu},be(o,ye.Hit,t.position,xe,t.id);const I=ze(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),v=mt(I,Mw);t.forces.push(v),t.hitpoints<=0?we(i,Ie.HumanDeath,t.position):we(i,Ie.Attack,e.position),be(o,ye.Attack,e.position,xe,e.id)}}e.attackCooldown={melee:eu,ranged:Mh};const h=e.stateMachine[1];h.attackStartTime=o.time}},rk={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:ft*2,checker:(e,t,{gameState:i})=>z(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:i})=>{const o=z(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height);if(o===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const l=(e.radius+t.radius-o)*.05,c=Dt(dh(e.position,t.position)),d=mt(c,l);e.forces.push(d),t.forces.push(mt(d,-1))}},sk={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:ft*.6+$a*.4,checker:(e,t,{gameState:i})=>{const o=t.stateMachine[0];if(o==="fallen"||o==="stump")return!1;const s=t.radius*.25,l=e.radius*.4;return z(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height)<l+s},perform:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4,l=z(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height);if(l===0){e.forces.push({x:1,y:0});return}const c=s+o-l;if(c<=0)return;const d=c*2.5,u=Dt(ze(t.position,e.position,i.mapDimensions.width,i.mapDimensions.height)),h=mt(u,d);e.forces.push(h)}},ak={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:ft*.6+$a*.4,checker:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4;return z(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height)<s+o},perform:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4,l=z(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height);if(l===0){e.forces.push({x:1,y:0});return}const c=s+o-l;if(c<=0)return;const d=c*2.5,u=Dt(ze(t.position,e.position,i.mapDimensions.width,i.mapDimensions.height)),h=mt(u,d);e.forces.push(h)}},lk={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:ft*.6+$a*.4,checker:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4;return z(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height)<s+o},perform:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4,l=z(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height);if(l===0){e.forces.push({x:1,y:0});return}const c=s+o-l;if(c<=0)return;const d=c*2.5,u=Dt(ze(t.position,e.position,i.mapDimensions.width,i.mapDimensions.height)),h=mt(u,d);e.forces.push(h)}},ck={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:Xe,checker:(e,t,i)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===us&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<i.gameState.time)||!1,perform:(e,t,i)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=i.gameState.time+1,t.timeSinceLastHarvest=i.gameState.time,be(i.gameState,ye.BushClaimed,t.position,xe),we(i,Ie.Gather,e.position)}},uk={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:Xe,checker:(e,t,i)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===us&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<i.gameState.time)||!1,perform:(e,t,i)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=i.gameState.time+1,we(i,Ie.Gather,e.position)}},dk={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:Xe,checker:(e,t,i)=>e.isAdult&&t.stateMachine[0]===Yt&&t.wood.length>0&&e.stateMachine[0]===us&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<i.gameState.time)||!1,perform:(e,t,i)=>{const o=t.wood.pop();o&&(e.heldItem=o),e.gatheringCooldownTime=i.gameState.time+1,t.wood.length===0&&(t.stateMachine=[bi,{enteredAt:i.gameState.time,previousState:Yt}]),we(i,Ie.Gather,e.position)}},fk=[ck,uk,dk],hk={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:is,checker:(e,t,i)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<i.gameState.time)),perform:(e,t,i)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=xC,t.timeSinceLastHarvest=i.gameState.time,e.eatingCooldownTime=i.gameState.time+GC,be(i.gameState,ye.BushClaimed,t.position,xe,e.id),we(i,Ie.Gather,e.position))}},pk={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:jC,checker:(e,t,i)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,i)=>{t.hitpoints-=XC;const o=ze(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),s=mt(o,8);t.forces.push(s),e.huntCooldown=ZC,t.hitpoints<=0?(we(i,Ie.HumanDeath,t.position),be(i.gameState,ye.Hit,t.position,xe,t.id)):(be(i.gameState,ye.Hit,t.position,xe,t.id),t.fleeCooldown=5,we(i,Ie.Attack,e.position)),be(i.gameState,ye.Attack,e.position,xe,e.id)}},gk={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:un,checker:(e,t,i)=>{var g,y;if(e.stateMachine[0]!==Io||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=z(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),s=o<=yo,l=!s&&o<=un;if(!s&&!l||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((y=e.attackCooldown)==null?void 0:y.ranged)||0)>0)return!1;const d=s?Jc:Ph,u=e.stateMachine[1];return i.gameState.time-u.attackStartTime>=d},perform:(e,t,i)=>{const{gameState:o}=i,s=z(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),l=s>yo;let c=(l?Ch:_h)*1.2;if(e.gender==="male"&&(c*=1.3),l){const u=s/Rh;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+u,data:{attackerId:e.id,targetId:t.id,damage:c,pushbackForce:kh,attackerPosition:{...e.position}}}),be(o,ye.StoneProjectile,e.position,u,void 0,t.position,t.id),we(i,Ie.Attack,e.position)}else{t.hitpoints-=c;const u=ze(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),h=mt(u,6);t.forces.push(h),t.hitpoints<=0?(we(i,Ie.HumanDeath,t.position),be(o,ye.Hit,t.position,xe,t.id)):(be(o,ye.Hit,t.position,xe,t.id),t.fleeCooldown=8,we(i,Ie.Attack,e.position)),be(o,ye.Attack,e.position,xe,e.id)}e.attackCooldown={melee:eu,ranged:Mh};const d=e.stateMachine[1];d.attackStartTime=o.time}},mk={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:ar,checker:(e,t,i)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=i.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,i)=>{let o=MI;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:tu,endTime:i.gameState.time+nu};const s=ze(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=mt(s,7);t.forces.push(l),e.attackCooldown=kI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-jh),we(i,Ie.HumanDeath,t.position),be(i.gameState,ye.Hit,t.position,xe,t.id)):(be(i.gameState,ye.Hit,t.position,xe,t.id),we(i,Ie.Attack,e.position)),be(i.gameState,ye.Attack,e.position,xe,e.id)}},yk={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:un,checker:(e,t,i)=>{var g,y;if(e.stateMachine[0]!==Io||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=z(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),s=o<=yo,l=!s&&o<=un;if(!s&&!l||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((y=e.attackCooldown)==null?void 0:y.ranged)||0)>0)return!1;const d=s?Jc:Ph,u=e.stateMachine[1];return i.gameState.time-u.attackStartTime>=d},perform:(e,t,i)=>{const{gameState:o}=i,s=z(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),l=s>yo;let c=(l?Ch:_h)*.8;e.gender==="male"&&(c*=1.2);const d=Object.values(o.entities.entities).filter(h=>h.type==="human"&&h.id!==e.id).filter(h=>{const g=h;return Math.sqrt(Math.pow(g.position.x-e.position.x,2)+Math.pow(g.position.y-e.position.y,2))<100&&g.activeAction==="attacking"&&g.attackTargetId===t.id}).length;if(d>0&&(c*=1+d*.2),l){const h=s/Rh;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+h,data:{attackerId:e.id,targetId:t.id,damage:c,pushbackForce:kh,attackerPosition:{...e.position}}}),be(o,ye.StoneProjectile,e.position,h,void 0,t.position,t.id),we(i,Ie.Attack,e.position)}else{t.hitpoints-=c;const h=ze(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),g=mt(h,8);t.forces.push(g),t.hitpoints<=0?(we(i,Ie.HumanDeath,t.position),be(o,ye.Hit,t.position,xe,t.id)):(be(o,ye.Hit,t.position,xe,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),we(i,Ie.Attack,e.position)),be(o,ye.Attack,e.position,xe,e.id)}e.attackCooldown={melee:eu,ranged:Mh};const u=e.stateMachine[1];u.attackStartTime=o.time}},vk={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:is,checker:(e,t,i)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,i)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.gestationTime=i.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=i.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=i.gameState.ecosystem.preyProcreationCooldown,be(i.gameState,ye.Procreation,o.position,xe,o.id),we(i,Ie.Procreate,o.position)}},Ik={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:os,checker:(e,t,i)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,i)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.pregnancyFatherId=e.gender==="male"?e.id:t.id,o.gestationTime=i.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=i.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=i.gameState.ecosystem.predatorProcreationCooldown,be(i.gameState,ye.Procreation,o.position,xe,o.id),we(i,Ie.Procreate,o.position)}},Sk={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:bI,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Uc&&e.activeAction==="feeding",perform:(e,t,i)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-Uc),e.feedChildCooldownTime=NI,(!t.lastChildFedEffectTime||i.gameState.time-t.lastChildFedEffectTime>2)&&(be(i.gameState,ye.ChildFed,t.position,xe,t.id),t.lastChildFedEffectTime=i.gameState.time),we(i,Ie.ChildFed,t.position)}},Ak={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:bI,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Uc&&e.activeAction==="feeding",perform:(e,t,i)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-Uc),e.feedChildCooldownTime=NI,(!t.lastChildFedEffectTime||i.gameState.time-t.lastChildFedEffectTime>2)&&(be(i.gameState,ye.ChildFed,t.position,xe,t.id),t.lastChildFedEffectTime=i.gameState.time),we(i,Ie.ChildFed,t.position)}},Tk={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:os,checker:(e,t,i)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=i.gameState.time)),perform:(e,t,i)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-jh),e.eatingCooldownTime=i.gameState.time+2,be(i.gameState,ye.Eating,e.position,xe,e.id),we(i,Ie.Gather,e.position))}},Ek={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:ar,checker:(e,t,i)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=i.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,i)=>{let o=MI;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:tu,endTime:i.gameState.time+nu};const s=ze(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=mt(s,7);t.forces.push(l),e.attackCooldown=kI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-jh),we(i,Ie.HumanDeath,t.position),be(i.gameState,ye.Hit,t.position,xe,t.id)):(be(i.gameState,ye.Hit,t.position,xe,t.id),we(i,Ie.Attack,e.position)),be(i.gameState,ye.Attack,e.position,xe,e.id)}},wk=25;function ry(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function eS(e){const t=e.storedItems.length,i=ry(t+e.id)*2*Math.PI,o=ry(t+e.id+1)*wk;return{x:Math.cos(i)*o,y:Math.sin(i)*o}}const _k={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:Vn,checker:(e,t,i)=>{var h;const o=t.buildingType===de.StorageSpot,s=t.buildingType===de.Bonfire;if(!o&&!s||e.stateMachine[0]!==Sa||!t.isConstructed)return!1;const l=e.food.length>0,c=((h=e.heldItem)==null?void 0:h.type)===kt.Wood;if(s&&!c||!l&&!c)return!1;const d=t.storageCapacity??0;return!(t.storedItems.length>=d||e.leaderId!==t.ownerId||i.gameState.time-(t.lastDepositTime??0)<hC)},perform:(e,t,i)=>{var s;let o=null;t.buildingType===de.Bonfire?((s=e.heldItem)==null?void 0:s.type)===kt.Wood&&(o=e.heldItem,e.heldItem=void 0):e.heldItem?(o=e.heldItem,e.heldItem=void 0):o=e.food.pop()??null,o&&t.storedItems.push({item:o,positionOffset:eS(t)}),t.lastDepositTime=i.gameState.time,we(i,Ie.StorageDeposit,t.position)}},Ck={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:Vn,checker:(e,t,i)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Aa||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||i.gameState.time-(t.lastRetrieveTime??0)<pC),perform:(e,t,i)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&(e.food.push(o.item),eS(t)),t.lastRetrieveTime=i.gameState.time,we(i,Ie.StorageRetrieve,t.position)}},Pk={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:Vn,checker:(e,t,i)=>{var d;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==us||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const o=e.leaderId?i.gameState.entities.entities[e.leaderId]:void 0;if(!o||!((d=o.tribeControl)!=null&&d.diplomacy)||(t.ownerId?o.tribeControl.diplomacy[t.ownerId]:void 0)!==It.Hostile||i.gameState.time-(t.lastStealTime??0)<gC)return!1;const c=rI({leaderId:t.ownerId},i.gameState);for(const u of c)if(z(e.position,u.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<=mC)return!1;return!0},perform:(e,t,i)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&e.food.push(o.item),t.lastStealTime=i.gameState.time,we(i,Ie.StorageSteal,t.position),be(i.gameState,ye.Attack,t.position,.5)}},Rk={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,i)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!tr(e,t,i.gameState)||!Hv(t.position,es,e.id,i.gameState).valid),perform:(e,t,i)=>{t.ownerId=e.id,Uv(t.position,es,e.id,i.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",be(i.gameState,ye.BushClaimed,t.position,2,t.id)}},Mk={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,i)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!tr(e,t,i.gameState)||t.isBeingDestroyed),perform:(e,t,i)=>{t.isBeingDestroyed=!0,e.activeAction="idle",be(i.gameState,ye.Hit,t.position,1,t.id)}},kk={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:Qc,checker:(e,t,i)=>{const[o]=t.stateMachine??[],s=o===zn||o===bn||o===ui;return e.isAdult&&s&&e.stateMachine[0]===zh&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<i.gameState.time)||!1},perform:(e,t,i)=>{const{gameState:o}=i;if(t.stateMachine=[Yt,{enteredAt:o.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/So),l=Math.floor(ey+s*(du-ey));t.wood=Array.from({length:l},()=>({itemType:"item",type:kt.Wood,id:o.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=o.time+1,we(i,Ie.Gather,e.position)}},Dk=[rk,sk,ak,lk,...fk,nk,ik,ok,_k,Ck,Pk,Rk,Mk,kk,hk,Sk,Ak,Tk,pk,gk,yk,mk,Ek,vk,Ik],sy=Object.values(Dk.reduce((e,t)=>{const i=`${t.sourceType}-${t.targetType}`;e[i]||(e[i]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const o={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[i].interactions.push(o),e[i].maxDistance=Math.max(e[i].maxDistance,t.maxDistance),e},{}));let ay=0;function Ok(e){const{gameState:t}=e,i=t,{width:o,height:s}=t.mapDimensions;ay++;const l=ay%2===0;for(let c=0;c<sy.length;c++){const d=sy[c],u=i.search[d.sourceType].all();for(let h=0;h<u.length;h++){const g=u[h],y=i.search[d.targetType].byRadius(g.position,d.maxDistance);for(let I=0;I<y.length;I++){const v=y[I];if(g.id===v.id)continue;const T=cn(g.position,v.position,o,s);for(let A=0;A<d.interactions.length;A++){const E=d.interactions[A];!E.isCollision&&l||T<=E.maxDistanceSq&&E.checker(g,v,e)&&E.perform(g,v,e)}}}}}function tS(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function bk(e){const t=e.search.berryBush.byProperty("type","berryBush"),i=e.search.predator.byProperty("type","predator"),o=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let l;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,g=50+Math.random()*100;l={x:Math.max(50,Math.min(Ue-50,u.position.x+Math.cos(h)*g)),y:Math.max(50,Math.min(Ge-50,u.position.y+Math.sin(h)*g))}}else l={x:50+Math.random()*(Ue-100),y:50+Math.random()*(Ge-100)};let c=!0;const d=100;for(const u of i)if(Math.sqrt((l.x-u.position.x)**2+(l.y-u.position.y)**2)<d){c=!1;break}if(c){for(const u of o)if(Math.sqrt((l.x-u.position.x)**2+(l.y-u.position.y)**2)<d){c=!1;break}}if(c)return l}return{x:Ue*.3+Math.random()*Ue*.4,y:Ge*.3+Math.random()*Ge*.4}}function Nk(e){const t=e.search.prey.byProperty("type","prey"),i=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let l;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,g=100+Math.random()*150;l={x:Math.max(50,Math.min(Ue-50,u.position.x+Math.cos(h)*g)),y:Math.max(50,Math.min(Ge-50,u.position.y+Math.sin(h)*g))}}else l={x:50+Math.random()*(Ue-100),y:50+Math.random()*(Ge-100)};let c=!0;const d=150;for(const u of i)if(Math.sqrt((l.x-u.position.x)**2+(l.y-u.position.y)**2)<d){c=!1;break}if(c)return l}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Ue,y:50+Math.random()*100};case 1:return{x:Ue-150+Math.random()*100,y:Math.random()*Ge};case 2:return{x:Math.random()*Ue,y:Ge-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Ge}}}function Bk(e){const t=e.search.human.byProperty("type","human"),i=e.search.berryBush.byProperty("type","berryBush");for(let o=0;o<20;o++){const s={x:50+Math.random()*(Ue-100),y:50+Math.random()*(Ge-100)};let l=!0;const c=80,d=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){l=!1;break}if(l){for(const u of i)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<d){l=!1;break}}if(l)return s}return{x:Math.random()*Ue,y:Math.random()*Ge}}function nS(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const i=e;for(let o=0;o<t;o++){const s=bk(i),l=o%2===0?"male":"female";rs(e.entities,s,l,void 0,void 0,Na())}}function iS(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const i=e;for(let o=0;o<t;o++){const s=Nk(i),l=o%2===0?"male":"female";ss(e.entities,s,l,void 0,void 0,Ba())}}function Hk(e){const t=e,i=t.search.prey.count(),o=t.search.predator.count();let s=!1;return i===0&&(nS(e,6),s=!0),o===0&&(iS(e,3),s=!0),s}function Fk(e){const t=e,i=t.search.prey.count(),o=t.search.predator.count(),s=t.search.berryBush.count();let l=!1;if(i>0&&i<5){const c=Math.max(2,Math.floor(8-i));nS(e,c),l=!0}if(o>0&&o<2){const c=Math.max(1,Math.floor(3-o));iS(e,c),l=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let c=0;c<5;c++){const d=Bk(t);Ya(e.entities,d,e.time)}l=!0}return l}const Lk=1,Uk=.3,Gk=.8,ly=.8,xk=.99,$k=.05;var oS=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.NO_ACTION=14]="NO_ACTION",e))(oS||{});const bf=Object.keys(oS).length/2;class Wk{constructor(){Nt(this,"qTable",new Map);Nt(this,"epsilon",ly);Nt(this,"lastState",null);Nt(this,"lastAction",null)}discretizeState(t,i,o){const s=Math.min(4,Math.floor(t/25)),l=Math.min(4,Math.floor(i/5)),c=Math.min(4,Math.floor(o/15));return`${s}-${l}-${c}`}getQValue(t,i){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(i)||0}setQValue(t,i,o){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(i,o)}getBestAction(t){let i=0,o=this.getQValue(t,0);for(let s=1;s<bf;s++){const l=this.getQValue(t,s);l>o&&(o=l,i=s)}return i}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*bf):this.getBestAction(t)}applyEmergencyCorrections(t,i,o,s){t<Ri*.5&&(s.ecosystem.preyGestationPeriod=Math.max(Gr,s.ecosystem.preyGestationPeriod*.8),s.ecosystem.preyProcreationCooldown=Math.max(xr,s.ecosystem.preyProcreationCooldown*.8),s.ecosystem.preyHungerIncreasePerHour=Math.max(Yr,s.ecosystem.preyHungerIncreasePerHour*.9)),i<Mi*.6&&(s.ecosystem.predatorGestationPeriod=Math.max($r,s.ecosystem.predatorGestationPeriod*.75),s.ecosystem.predatorProcreationCooldown=Math.max(Wr,s.ecosystem.predatorProcreationCooldown*.75),s.ecosystem.predatorHungerIncreasePerHour=Math.max(zr,s.ecosystem.predatorHungerIncreasePerHour*.85)),o<ki*.5&&(s.ecosystem.berryBushSpreadChance=Math.min(ca,s.ecosystem.berryBushSpreadChance*1.2)),t>Ri*1.4&&(s.ecosystem.preyHungerIncreasePerHour=Math.min(uo,s.ecosystem.preyHungerIncreasePerHour*1.05)),i>Mi*1.4&&(s.ecosystem.predatorHungerIncreasePerHour=Math.min(fo,s.ecosystem.predatorHungerIncreasePerHour*1.05)),o>ki*1.4&&(s.ecosystem.berryBushSpreadChance=Math.max(Di,s.ecosystem.berryBushSpreadChance*.95))}calculateReward(t,i,o){const s=Math.abs(t-Ri),l=Math.abs(i-Mi),c=Math.abs(o-ki),d=s/Ri,u=l/Mi,h=c/ki,g=d+u+h;return 100*Math.exp(-g*2)-50}applyAction(t,i){switch(t){case 0:i.ecosystem.preyGestationPeriod=Math.min(Xo,i.ecosystem.preyGestationPeriod+.2*(Xo-Gr));break;case 1:i.ecosystem.preyGestationPeriod=Math.max(Gr,i.ecosystem.preyGestationPeriod-.2*(Xo-Gr));break;case 2:i.ecosystem.preyProcreationCooldown=Math.min(Vo,i.ecosystem.preyProcreationCooldown+.2*(Vo-xr));break;case 3:i.ecosystem.preyProcreationCooldown=Math.max(xr,i.ecosystem.preyProcreationCooldown-.2*(Vo-xr));break;case 4:i.ecosystem.preyHungerIncreasePerHour=Math.min(uo,i.ecosystem.preyHungerIncreasePerHour+.2*(uo-Yr));break;case 5:i.ecosystem.preyHungerIncreasePerHour=Math.max(Yr,i.ecosystem.preyHungerIncreasePerHour-.2*(uo-Yr));break;case 6:i.ecosystem.predatorGestationPeriod=Math.min(qo,i.ecosystem.predatorGestationPeriod+.2*(qo-$r));break;case 7:i.ecosystem.predatorGestationPeriod=Math.max($r,i.ecosystem.predatorGestationPeriod-.2*(qo-$r));break;case 8:i.ecosystem.predatorProcreationCooldown=Math.min(Zo,i.ecosystem.predatorProcreationCooldown+.2*(Zo-Wr));break;case 9:i.ecosystem.predatorProcreationCooldown=Math.max(Wr,i.ecosystem.predatorProcreationCooldown-.2*(Zo-Wr));break;case 10:i.ecosystem.predatorHungerIncreasePerHour=Math.min(fo,i.ecosystem.predatorHungerIncreasePerHour+.2*(fo-zr));break;case 11:i.ecosystem.predatorHungerIncreasePerHour=Math.max(zr,i.ecosystem.predatorHungerIncreasePerHour-.2*(fo-zr));break;case 12:i.ecosystem.berryBushSpreadChance=Math.min(ca,i.ecosystem.berryBushSpreadChance+.2*(ca-Di));break;case 13:i.ecosystem.berryBushSpreadChance=Math.max(Di,i.ecosystem.berryBushSpreadChance-.2*(ca-Di));break}}updateQTable(t,i,o,s){const l=this.getQValue(t,i),c=Math.max(...Array.from({length:bf},(u,h)=>this.getQValue(s,h))),d=l+Uk*(o+Gk*c-l);this.setQValue(t,i,d)}step(t){const i=t,o=i.search.prey.count(),s=i.search.predator.count(),l=i.search.berryBush.count();this.applyEmergencyCorrections(o,s,l,t);const c=this.discretizeState(o,s,l);if(this.lastState!==null&&this.lastAction!==null){const u=this.calculateReward(o,s,l);this.updateQTable(this.lastState,this.lastAction,u,c)}const d=this.chooseAction(c);this.applyAction(d,t),this.epsilon=Math.max($k,this.epsilon*xk),this.lastState=c,this.lastAction=d}reset(){this.qTable.clear(),this.epsilon=ly,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let rS=new Wk;function Yk(e){Hk(e),Fk(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=Gr+(Xo-Gr)*.3,e.ecosystem.preyProcreationCooldown=xr+(Vo-xr)*.3,e.ecosystem.preyHungerIncreasePerHour=Yr+(uo-Yr)*.3,e.ecosystem.predatorGestationPeriod=$r+(qo-$r)*.3,e.ecosystem.predatorProcreationCooldown=Wr+(Zo-Wr)*.3,e.ecosystem.predatorHungerIncreasePerHour=zr+(fo-zr)*.3,e.ecosystem.berryBushSpreadChance=Di+(ca-Di)*.7),rS.step(e)}function zk(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<Lk)&&(e.ecosystem.lastUpdateTime=e.time,Yk(e))}function jk(){return rS.getStats()}function Xk(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function Vk(e){const{gameState:t}=e,i=t.time,o=t.scheduledEvents.filter(l=>l.scheduledTime<=i),s=t.scheduledEvents.filter(l=>l.scheduledTime>i);t.scheduledEvents=s;for(const l of o)switch(l.type){case"ranged-impact":{const c=t.entities.entities[l.data.targetId];if(!c||c.hitpoints<=0)continue;c.hitpoints-=l.data.damage,c.movementSlowdown={modifier:tu,endTime:t.time+nu};const d=ze(l.data.attackerPosition,c.position,t.mapDimensions.width,t.mapDimensions.height),u=mt(d,l.data.pushbackForce);c.forces.push(u),be(t,ye.Hit,c.position,xe,c.id),c.hitpoints<=0?we(e,Ie.HumanDeath,c.position):we(e,Ie.Attack,c.position);break}}}const sS="ownedIndices",cy="frontierScanIndex",Ta="frontierCandidates";function qk(e){const{gameState:t}=e,i=t,s=i.search.human.all().filter(h=>h.leaderId===h.id),{width:l,height:c}=t.mapDimensions,d=Math.ceil(l/Ee),u=Math.ceil(c/Ee);for(const h of s){if(!h.aiBlackboard)continue;const g=Oe.get(h.aiBlackboard,sS)||[];if(g.length===0)continue;let y=Oe.get(h.aiBlackboard,cy)||0;const I=Oe.get(h.aiBlackboard,Ta)||{},v=ci(h.id,t),T=20;for(let E=0;E<T;E++){y>=g.length&&(y=0);const C=g[y];y=(y+1)%g.length;const _=C%d,w=Math.floor(C/d),R=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:N,dy:D}of R){const B=(_+N+d)%d,G=(w+D+u)%u,$=G*d+B,V=t.terrainOwnership[$],X=V!==null&&Hi(h.id,V,t);if(V===null||X){let q=0;for(const{dx:U,dy:se}of R){const ce=(B+U+d)%d,Re=(G+se+u)%u;t.terrainOwnership[Re*d+ce]===h.id&&q++}const re=q*20,ee=Jf($,l),ne=i.search.berryBush.byRadius(ee,100),oe=i.search.tree.byRadius(ee,100),te=ne.length*10+oe.length*5,W=X?50:0,Z=z(ee,v,l,c)/100*5,k=re+te+W-Z;I[$.toString()]={score:k,fromIdx:C,lastSeenTime:t.time}}}}const A=Object.entries(I).sort((E,C)=>C[1].score-E[1].score);if(A.length>50){const E={};for(let C=0;C<50;C++){const[_,w]=A[C];E[_]=w}Oe.set(h.aiBlackboard,Ta,E)}else Oe.set(h.aiBlackboard,Ta,I);Oe.set(h.aiBlackboard,cy,y)}}function Zk(e){var y;const{gameState:t}=e,i=t,o=i.search.human.all(),s=new Map,l=new Set;for(let I=0;I<o.length;I++){const v=o[I];v.leaderId&&(s.has(v.leaderId)||s.set(v.leaderId,[]),s.get(v.leaderId).push(v),v.leaderId===v.id&&l.add(v.id))}const c=Object.values(t.tasks),d=new Map;for(let I=0;I<c.length;I++){const v=c[I];v.creatorEntityId&&(d.has(v.creatorEntityId)||d.set(v.creatorEntityId,[]),d.get(v.creatorEntityId).push(v))}const u=i.search.building.all(),h=new Map;for(let I=0;I<u.length;I++){const v=u[I];if(v.ownerId){const T=t.entities.entities[v.ownerId],A=T==null?void 0:T.leaderId;A&&(h.has(A)||h.set(A,[]),h.get(A).push(v))}}const g=new Map;for(const I of l)g.set(I,ci(I,t));for(const I of l){const v=t.entities.entities[I];if(!v)continue;const T=[];for(let X=0;X<t.terrainOwnership.length;X++)t.terrainOwnership[X]===I&&T.push(X);Oe.set(v.aiBlackboard,sS,T);const A=s.get(I)||[];if(A.length<pI)continue;const E=A.filter(X=>X.isAdult);if(E.length===0)continue;const C=d.get(I)||[],_=X=>C.some(q=>q.type===X),w=h.get(I)||[],R=[];for(const[X,q]of g.entries())X!==I&&R.push(q);if(!_(x.HumanPlaceStorage)){const X=w.filter(oe=>oe.buildingType===de.StorageSpot);let q=0,re=0;for(let oe=0;oe<X.length;oe++){const te=X[oe];q+=((y=te.storedItems)==null?void 0:y.length)||0,re+=te.storageCapacity||0}const ee=re>0?q/re:0;if(X.length===0||ee>qw){const oe=X.length===0?Qw:vf,te=If(de.StorageSpot,I,t,yf,oe,v.position,R);te&&cc(I,x.HumanPlaceStorage,te,t)}}if(!_(x.HumanPlaceBonfire)){const X=w.filter(W=>W.buildingType===de.Bonfire),q=g.get(I),ee=Ha(t.temperature,q,t.time,t.mapDimensions.width,t.mapDimensions.height)<y_&&X.length===0,ne=X.length>0&&X.length<Math.ceil(E.length/A_);let oe;const te=A.filter(W=>Ha(t.temperature,W.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<jo+5?X.every(k=>z(W.position,k.position,t.mapDimensions.width,t.mapDimensions.height)>ma*1.5):!1);if(te.length>=3){const W=te.reduce((Z,k)=>Z+k.position.x,0)/te.length,Q=te.reduce((Z,k)=>Z+k.position.y,0)/te.length;oe={x:W,y:Q}}if(ee||ne||oe){const W=If(de.Bonfire,I,t,yf,vf,oe||v.position,R);W&&cc(I,x.HumanPlaceBonfire,W,t)}}if(!_(x.HumanPlacePlantingZone)){const q=w.filter(ee=>ee.buildingType===de.PlantingZone&&O1(ee,t)).reduce((ee,ne)=>ee+lI(ne),0),re=Math.max(Kw,E.length*Zw);if(q<re){const ee=If(de.PlantingZone,I,t,yf,vf,v.position,R);ee&&cc(I,x.HumanPlacePlantingZone,ee,t)}}const N=Oe.get(v.aiBlackboard,Ta)||{},{width:D,height:B}=t.mapDimensions,G=w.filter(X=>X.buildingType===de.BorderPost),$=C.filter(X=>X.type===x.HumanPlaceBorderPost);for(const X in N){const q=parseInt(X,10),re=t.terrainOwnership[q],ee=re!==null&&Hi(v.id,re,t);if(re===I||re!==null&&!ee){delete N[X];continue}const ne=Jf(q,D);(G.some(te=>cn(ne,te.position,D,B)<100*100)||$.some(te=>cn(ne,te.position,D,B)<100*100))&&delete N[X]}Oe.set(v.aiBlackboard,Ta,N);const V=3;if($.length<V){const X=Object.entries(N).map(([ne,oe])=>({idx:parseInt(ne,10),...oe})).sort((ne,oe)=>oe.score-ne.score),q=[];for(const ne of X){if(q.length>=V-$.length)break;const oe=Jf(ne.idx,D);q.every(W=>cn(oe,W,D,B)>100*100)&&q.push(oe)}const re=new Set($.map(ne=>{const oe=ne.id.split("-");return parseInt(oe[oe.length-1],10)}).filter(ne=>!isNaN(ne))),ee=[];for(let ne=0;ne<V;ne++)re.has(ne)||ee.push(ne);for(let ne=0;ne<q.length;ne++)cc(I,x.HumanPlaceBorderPost,q[ne],t,ee[ne])}}}function cc(e,t,i,o,s=0){const l=`${x[t]}-${e}-${s}`;o.tasks[l]={id:l,position:i,type:t,creatorEntityId:e,target:i,validUntilTime:o.time+12}}function Kk(e){const{gameState:t}=e,s=t.search.human.all().filter(l=>l.leaderId===l.id);for(const l of s){if(!l.aiBlackboard)continue;const c=`diplomacy-${l.id}`;if(t.tasks[c])continue;const d=Oe.get(l.aiBlackboard,"lastDiplomacyCheckTime")??-1/0;if(t.time-d<M0)continue;const u={id:c,type:x.HumanDiplomacy,position:l.position,creatorEntityId:l.id,validUntilTime:t.time+M0};t.tasks[c]=u}}const Qk=1/60;function Jk(e,t){if(!e.cameraFollowingPlayer)return;const i=At(e);i&&(e.viewportCenter=wc(e.viewportCenter,i.position,Mc*t))}function pu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const i=Date.now();i-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(ph(e),e.lastAutosaveTime=i)}for(;t>0;){const i=Wc(e),o=Math.min(t,Qk),s=o*(Mt/Ht);i.time+=s,Jk(i,o),$w(i),xP(i),zk(i),U1(i),bP(i),Ww(i),Vk({gameState:i}),FM({gameState:i,deltaTime:o}),Ok({gameState:i,deltaTime:o}),qk({gameState:i}),Math.floor(i.time)>Math.floor(i.time-s)&&(M1(i),Zk({gameState:i}),Kk({gameState:i})),tS(i),zM(i,o),Xk(i),e=i,t-=o}return e}function Nf(e,t,i){e.save();const{x:o,y:s,width:l,height:c}=t.rect,d=Vv;if(e.beginPath(),e.moveTo(o+d,s),e.lineTo(o+l-d,s),e.quadraticCurveTo(o+l,s,o+l,s+d),e.lineTo(o+l,s+c-d),e.quadraticCurveTo(o+l,s+c,o+l-d,s+c),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),e.lineTo(o,s+d),e.quadraticCurveTo(o,s,o+d,s),e.closePath(),e.fillStyle=t.isDisabled?qv:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*Jv)+1)/2;e.strokeStyle=Qv,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<Bc){const h=1-u/Bc;e.fillStyle=Kv,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}i&&!t.isDisabled&&(e.fillStyle=Hh,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?Zv:t.textColor,t.icon?(e.font=`${c*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+l/2,s+c/2),t.text&&(e.font=`${c*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+l-4,s+c-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+l/2,s+c/2)),e.restore()}function eD(e,t,i,o){e.save(),e.font=`${H0}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const l=e.measureText(i).width,c=H0,d=l+F0*2,u=c+F0*2,h=o.x-d/2,g=e.canvas.height,y=t.y<g/2?t.y+t.height-L0:t.y-u+L0;e.fillStyle=X_,e.fillRect(h,y,d,u),e.fillStyle=V_,e.fillText(i,o.x,y+u/2+c/2),e.restore()}function tD(e,t,i){e.save();const o=At(t),s=[{id:"fastForwardButton",action:me.FastForward,text:"FFWD [T]",currentWidth:Pi*1.3,backgroundColor:In,textColor:St,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:me.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?ua:In,currentWidth:t.isPaused?Pi*1.4:Pi*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:St},{id:"muteButton",action:me.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?ua:In,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:Pi,rect:{x:0,y:0,width:0,height:0},textColor:St},{id:"returnToIntroButton",action:me.ReturnToIntro,text:"EXIT",backgroundColor:In,tooltip:"Return to Main Menu [ESC]",currentWidth:Pi*.9,rect:{x:0,y:0,width:0,height:0},textColor:St}];if(t.uiButtons.push(...s),o){const h=Yh(t,o),g=new Set(h.map(_=>_.type));let y=[{playerAction:ue.Gather,buttonAction:me.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>o.isAdult===!0},{playerAction:ue.Eat,buttonAction:me.CommandEat,shortcut:"F",name:"Eat"},{playerAction:ue.Plant,buttonAction:me.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>o.isAdult===!0},{playerAction:ue.Procreate,buttonAction:me.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>o.isAdult===!0},{playerAction:ue.FeedChild,buttonAction:me.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>o.isAdult===!0},{playerAction:ue.Attack,buttonAction:me.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>o.isAdult===!0&&o.leaderId===o.id},{playerAction:ue.TribeSplit,buttonAction:me.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>o.leaderId!==void 0&&o.leaderId!==o.id&&o.isAdult===!0},{playerAction:ue.Build,buttonAction:me.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>o.isAdult===!0&&o.leaderId===o.id&&vo(o.id,t).length>pI}];y=y.filter(_=>_.condition?_.condition():!0);const I=1,v=y.length,T=v*mn+(v-1)*Lo,A=I*mn+(I-1)*Lo,E=(i-T)/2,C=e.canvas.height-A-20;if(y.forEach((_,w)=>{const R=w%v,N=Math.floor(w/v),D=E+R*(mn+Lo),B=C+N*(mn+Lo),G=!!_.toggleKey,$=G&&t.autopilotControls.behaviors[_.toggleKey],V=!g.has(_.playerAction),q=_.playerAction===ue.Build&&t.buildMenuOpen,re=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",ee=G?`${_.name}${re}`:_.name,ne=$||q?ua:In,oe={id:`commandButton_${_.name}`,action:_.buttonAction,rect:{x:D,y:B,width:mn,height:mn},icon:su[_.playerAction],text:_.shortcut,backgroundColor:ne,textColor:St,currentWidth:mn,tooltip:ee,isDisabled:V,activated:$||_.buttonAction===me.CommandBuild&&q};t.uiButtons.push(oe)}),t.buildMenuOpen){const _=[{id:"buildMenu_storageSpot",action:me.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:me.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_bonfire",action:me.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:me.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:me.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"}],w=_.length,R=w*mn+(w-1)*Lo,N=(i-R)/2,D=C-mn-Lo;_.forEach((B,G)=>{const $=N+G*(mn+Lo),V=D,X=B.action===me.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||B.action===me.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||B.action===me.SelectBorderPost&&t.selectedBuildingType==="borderPost"||B.action===me.SelectBonfire&&t.selectedBuildingType==="bonfire"||B.action===me.SelectRemovalTool&&t.selectedBuildingType==="removal",q={id:B.id,action:B.action,rect:{x:$,y:V,width:mn,height:mn},icon:B.icon,text:B.shortcut,backgroundColor:X?ua:In,textColor:St,currentWidth:mn,tooltip:B.name,activated:X};t.uiButtons.push(q),Nf(e,q,t.hoveredButtonId===q.id)})}}let l=i-qe;s.forEach(h=>{const g=qe,y=l-h.currentWidth;h.rect={x:y,y:g,width:h.currentWidth,height:Xv},Nf(e,h,t.hoveredButtonId===h.id),l-=h.currentWidth+j_});let c=null;t.uiButtons.filter(h=>h.id.startsWith("commandButton_")||h.id.startsWith("buildMenu_")).forEach(h=>{c||(c={x:h.rect.x,y:h.rect.y,width:h.rect.width,height:h.rect.height}),c.x=Math.min(c.x,h.rect.x),c.y=Math.min(c.y,h.rect.y),c.width=Math.max(c.width,h.rect.x+h.rect.width-c.x),c.height=Math.max(c.height,h.rect.y+h.rect.height-c.y),h.id.startsWith("commandButton_")&&Nf(e,h,t.hoveredButtonId===h.id)});const u=t.hoveredButtonId?t.uiButtons.find(h=>h.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&eD(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:c}}function nD(e){e.save(),e.fillStyle=q_,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=Z_,e.font=`${K_}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function lh(e,t,i,o){const s=t.x-i.width/2,l=t.y-i.height/2,c=s+e.x,d=l+e.y,u=(c%o.width+o.width)%o.width,h=(d%o.height+o.height)%o.height;return{x:u,y:h}}function za(e,t,i,o){let s=e.x-t.x,l=e.y-t.y;return Math.abs(s)>o.width/2&&(s=s-Math.sign(s)*o.width),Math.abs(l)>o.height/2&&(l=l-Math.sign(l)*o.height),{x:s+i.width/2,y:l+i.height/2}}function Ea(e,t,i,o){const s=za(e.position,t,i,o),c=("radius"in e?e.radius:20)+20;return s.x>=-c&&s.x<=i.width+c&&s.y>=-c&&s.y<=i.height+c}function Dn(e,t,i,o,s,...l){const c={...s.position};for(let d=-i;d<=i;d+=i)for(let u=-t;u<=t;u+=t)s.position.x=c.x+u,s.position.y=c.y+d,o(e,s,...l);s.position=c}function aS(e,t){const i=document.createElement("canvas");i.width=e,i.height=t;const o=i.getContext("2d");if(!o)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:i,ctx:o}}function Xr(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function or(e,t){return Math.round(e*t)/t}function Kh(e,t=8){const o=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(o/(Math.PI*2)*t)%t}function Qh(e,t=8){const i=e/t*Math.PI*2;return[Math.cos(i),Math.sin(i)]}const iD=25,oD=0,uy=28;function lS(e,t,i,o,s,l,c,d,u,h){e.save();const{x:g,y}=za(t,c,{width:d,height:u},h);e.strokeStyle=o,e.lineWidth=l,e.setLineDash(s),e.beginPath(),e.arc(g,y,i+iu,0,2*Math.PI),e.stroke(),e.restore()}function rD(e,t,i,o,s,l,c){if(t.length===0)return;e.save(),t.forEach(y=>{y.targetEntity&&lS(e,y.targetEntity.position,y.targetEntity.radius,Nh,Bh,2,o,s,l,c)}),e.font=`${ts}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:d,y:u}=za(i.position,o,{width:s,height:l},c);let h=0,g={};t.forEach(y=>{const I=su[y.type];if(y.targetEntity){g[y.targetEntity.id]=(g[y.targetEntity.id]||0)+1;const v=y.targetEntity.position.x-o.x+s/2,T=y.targetEntity.position.y-o.y+l/2,A=`${I}${y.key.toUpperCase()}`,E=T-y.targetEntity.radius-iu-ts/2-(g[y.targetEntity.id]-1)*uy;e.fillText(A,v,E)}else{e.textAlign="left";const v=`${I}${y.key.toUpperCase()}`,T=d+iD,E=u+oD+h*uy;e.fillText(v,T,E),h++,e.textAlign="center"}}),e.restore()}function sD(e,t,i,o,s,l,c){const h=Ef+8+30,g={x:W0,y:l-W0-h,width:Ef,height:Ef};t.minimapRect=g,e.save(),e.fillStyle=T1,e.fillRect(g.x,g.y,g.width,g.height),e.strokeStyle=A1,e.lineWidth=2,e.strokeRect(g.x,g.y,g.width,g.height);const{width:y,height:I}=t.mapDimensions,v=Math.ceil(y/Ee),T=Math.ceil(I/Ee),A=new Map;o.forEach((ae,Se)=>{const Te=ae.isPlayerTribe?0:Se%(Jt.length-1)+1;A.set(ae.leaderId,Jt[Te])});const E=g.width/v,C=g.height/T,_=g.x+g.width/2,w=g.y+g.height/2,R=v>400?4:v>200?2:1;for(let ae=0;ae<T;ae+=R)for(let Se=0;Se<v;Se+=R){const Te=ae*v+Se,ie=t.terrainOwnership[Te];if(ie!==null){const he=(Se+.5)*Ee,Ne=(ae+.5)*Ee,Ae=ze(i,{x:he,y:Ne},y,I),Sn=_+Ae.x/y*g.width,Ke=w+Ae.y/I*g.height,Ve=t.hoveredMinimapTribeId===ie;if(e.fillStyle=A.get(ie)||"#888",Ve){const An=(Math.sin(t.time*5)+1)/2;e.globalAlpha=.6+An*.4}else e.globalAlpha=.8;e.fillRect(Sn-E*R/2,Ke-C*R/2,E*R,C*R)}}e.globalAlpha=1,e.save(),e.beginPath(),e.rect(g.x,g.y,g.width,g.height),e.clip();for(const ae of o){if(!ae.territoryCenter)continue;const Se=ze(i,ae.territoryCenter,y,I),Te=_+Se.x/y*g.width,ie=w+Se.y/I*g.height;e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="white",e.fillText(ae.tribeBadge,Te,ie),ae.isPlayerTribe&&(e.strokeStyle="gold",e.lineWidth=1,e.beginPath(),e.arc(Te,ie,10,0,Math.PI*2),e.stroke())}e.restore();const N=s/c,D=l/c,B=N/y*g.width,G=D/I*g.height;e.save(),e.beginPath(),e.rect(g.x,g.y,g.width,g.height),e.clip(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.strokeRect(_-B/2,w-G/2,B,G),e.restore(),e.restore();const $=g.y+g.height+8,V=g.x,X=$,q="recenter_camera_btn",re={id:q,action:me.RecenterCamera,rect:{x:V,y:X,width:30,height:30},text:"",currentWidth:30,backgroundColor:t.cameraFollowingPlayer?ua:In,textColor:St,tooltip:"Lock camera to player"};t.uiButtons.push(re),e.fillStyle=t.hoveredButtonId===q?"#4a5568":re.backgroundColor,e.fillRect(V,X,30,30),e.strokeStyle="#666",e.strokeRect(V,X,30,30);const ee=V+30/2,ne=X+30/2,oe=30*.35;e.strokeStyle=St,e.lineWidth=2,e.beginPath(),e.arc(ee,ne,oe,0,Math.PI*2),e.stroke();const te=oe*.6;e.beginPath(),e.moveTo(ee-te,ne),e.lineTo(ee+te,ne),e.moveTo(ee,ne-te),e.lineTo(ee,ne+te),e.stroke(),e.fillStyle=St,e.beginPath(),e.arc(ee,ne,2,0,Math.PI*2),e.fill();const W="open_tribe_modal_btn",Q=`Tribes (${o.length})`;e.font='10px "Press Start 2P", Arial';const Z=e.measureText(Q),k=Math.max(30,Z.width+16),U=30,se=V+30+8,ce=$,Re={id:W,action:me.OpenTribeModal,rect:{x:se,y:ce,width:k,height:U},text:Q,currentWidth:k,backgroundColor:In,textColor:St,tooltip:"View all tribes and diplomacy"};t.uiButtons.push(Re),e.fillStyle=t.hoveredButtonId===W?"#4a5568":In,e.fillRect(se,ce,k,U),e.strokeStyle="#666",e.strokeRect(se,ce,k,U),e.fillStyle=St,e.textAlign="center",e.textBaseline="middle",e.fillText(Q,se+k/2,ce+U/2)}const Me=(e,t,i,o,s,l,c)=>{l==="transparent"||o<=0||s<=0||(e.fillStyle=l,e.fillRect(Math.floor(t*c),Math.floor(i*c),Math.ceil(o*c),Math.ceil(s*c)))},dy=10,fy=10,oi=6,Ti=4,uc=2,aD=5,kn=4,lD=2,xt=4,cD=2,ot=3,Br=2,ao=0,wa=ao+Ti-1,Vt=wa,dt=wa+kn-1,uD="rgba(0, 0, 0, 0.4)",dD=4,fD=1,Jh={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,i,o,s,l,c,d="male",u=20,h=[1,0],g=!1,y=0){const I=["dead","stunned"].includes(c),v=I?fy+4:dy,T=I?dy+4:fy+ot,A=.15,E=Math.min(o*(1-2*A)/v,s*(1-2*A)/T),C=v*E,_=T*E,w=t+(o-C)/2,R=i+(s-_)/2;e.save(),h[0]<0&&!I?(e.translate(w+C,R),e.scale(-1,1)):e.translate(w,R);const D="#D09A5A",B=u>50?"#BDBDBD":"#281808",G="#7F5C4A",$="#6B4F3A",V="#E0D8C0",X="#A0522D",q=1-Math.max(0,Math.min(100,y))/100*.2,re=d==="male"?1.1:.9,ee=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let ne=aD*q*re*ee,oe=lD*q*re*ee,te=cD*q*ee;g&&d==="female"&&(ne*=1.5);const W=Math.round((v-ne)/2),Q=Math.round((v-oi)/2),Z=W-oe,k=W+ne,U=1,se=W+(ne/2-U/2)-te,ce=W+(ne/2+U/2),Re=h[1]<-.2&&Math.abs(h[0])<.7,ae=ie=>{e.fillStyle=uD,e.beginPath();const he=v/2,Ne=ie;e.ellipse(Math.floor(he*E),Math.floor(Ne*E),Math.max(1,Math.floor(dD*E)),Math.max(1,Math.floor(fD*E)),0,0,2*Math.PI),e.fill()},Se=(ie,he)=>{d==="male"?(Me(e,W,wa+ie,ne,kn-Br,he,E),Me(e,W,wa+kn-Br+ie,ne,Br,G,E)):Me(e,W,wa+ie,ne,kn,$,E)},Te=(ie,he)=>{Re?Me(e,Q,ao+ie,oi,Ti,B,E):(Me(e,Q,ao+ie,oi,Ti,he,E),Me(e,Q,ao+ie,oi,uc,B,E),d==="female"?(Me(e,Q-1,ao+uc+ie,1,Ti,B,E),Me(e,Q+oi,ao+uc+ie,1,Ti,B,E)):Me(e,Q+1,ao+2+ie,oi-2,Ti-2,B,E))};switch(c){case"idle":{const ie=l*Math.PI*2,he=Math.sin(ie)*.5,Ae=(Math.cos(ie*2)+1)*.25;ae(dt+ot+1),Me(e,se+he,dt+Ae,te,ot,D,E),Me(e,ce-he,dt+Ae,te,ot,D,E),Se(Ae,D),Me(e,Z,Vt+Ae,oe,xt,D,E),Me(e,k,Vt+Ae,oe,xt,D,E),Te(Ae,D);break}case"walk":{const ie=l*Math.PI*2,he=Math.sin(ie)*2,Ae=Math.abs(Math.cos(ie))*1;ae(dt+ot+1),Me(e,se+he,dt+Ae,te,ot,D,E),Me(e,ce-he,dt+Ae,te,ot,D,E),Se(Ae,D),Me(e,Z-he,Vt+Ae,oe,xt,D,E),Me(e,k+he,Vt+Ae,oe,xt,D,E),Te(Ae,D);break}case"gathering":{const ie=l*Math.PI*2,he=1,Ne=(Math.sin(ie)+1)/2*2,Ae=he+Math.abs(Math.cos(ie))*.5;ae(dt+ot+1),Me(e,se,dt+Ae,te,ot-he,D,E),Me(e,ce,dt+Ae,te,ot-he,D,E),Se(Ae,D),Me(e,Z+1,Vt+Ae-Ne,oe,xt,D,E),Me(e,k-1,Vt+Ae-Ne,oe,xt,D,E),Te(Ae,D);break}case"eat":{ae(dt+ot+1),Me(e,se,dt+1,te,ot-1,D,E),Me(e,ce,dt+1,te,ot-1,D,E),Se(1,D);const Ne=(Math.sin(l*Math.PI*4)+1)/2,Ae=Q+oi/2,Sn=ao+Ti/2,Ke=k+(Ae-k)*Ne,Ve=Vt+1+(Sn-(Vt+1))*Ne;Me(e,Z,Vt+1,oe,xt,D,E),Me(e,Ke,Ve,oe,xt,D,E),Me(e,Ke,Ve-1,1,1,X,E),Te(1,D);break}case"procreate":{const ie=(Math.sin(l*Math.PI*8)+1)/4,he=(Math.sin(l*Math.PI*6)+1)*.5,Ne=1.5,Ae=Ne-he;ae(dt+ot+1),Me(e,se,dt+Ae,te,ot-Ne,D,E),Me(e,ce,dt+Ae,te,ot-Ne,D,E),Se(Ae,D),Me(e,Z,Vt+Ae,oe,xt,D,E),Me(e,k,Vt+Ae,oe,xt,D,E),Te(Ae,D),e.globalAlpha=ie,Se(Ae,"white"),e.globalAlpha=1;break}case"attacking":{const ie=Math.sin(l*Math.PI)*1.5,he=Math.abs(Math.sin(l*Math.PI));ae(dt+ot+1),Me(e,se-ie,dt+he,te,ot,D,E),Me(e,ce+ie*.5,dt+he,te,ot,D,E),Se(he,D),Me(e,Z,Vt+he-2,oe,xt,D,E),Me(e,k,Vt+he-2.5,oe,xt,D,E),Te(he,D);break}case"defending":{ae(dt+ot+1),Me(e,se,dt+1,te,ot-1,D,E),Me(e,ce,dt+1,te,ot-1,D,E),Se(1,D),Me(e,Z-1,Vt+1-1,oe,xt,D,E),Me(e,k+1,Vt+1-1,oe,xt,D,E),Te(1,D);break}case"stunned":case"dead":{const ie=c==="dead",he=ie?Math.min(1,l):0,Ne=he>.5?V:D,Ae=d==="male"?G:$,Sn=he>.8?"transparent":B,Ke=v/2,Ve=T/2,An=2;ae(T-1),Me(e,Ke-te-An,Ve,te,ot,Ne,E),Me(e,Ke+An,Ve,te,ot,Ne,E),Me(e,Ke-oe-An,Ve-kn+1,oe,xt,Ne,E),Me(e,Ke+An,Ve-kn+1,oe,xt,Ne,E);const en=Ke-ne/2,Tn=Ve-kn/2;d==="male"?(he<.7&&Me(e,en,Tn+kn-Br,ne,Br,Ae,E),Me(e,en,Tn,ne,kn-Br,Ne,E)):he<.7?Me(e,en,Tn,ne,kn,Ae,E):Me(e,en,Tn,ne,kn,Ne,E);const Zn=Ke-oi/2,Kn=Ve-kn/2-Ti+1;if(Me(e,Zn,Kn,oi,Ti,Ne,E),Sn!=="transparent"&&Me(e,Zn,Kn,oi,uc,Sn,E),ie&&he>.6){const Fi="#B0A890";for(let Eo=0;Eo<3;Eo++)Me(e,en+1,Tn+Eo*1+1,ne-2,.5,Fi,E)}break}default:Me(e,0,0,v,T,"magenta",E);break}e.restore()}};function hD(e,t,i,o,s){const l=t.x,c=t.y-i-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(l-o/2,c,o,o/2),e.fill(),e.beginPath(),e.moveTo(l-o/2,c),e.lineTo(l-o/4,c-o/3),e.lineTo(l-o/6,c),e.moveTo(l-o/6,c),e.lineTo(l,c-o/2),e.lineTo(l+o/6,c),e.moveTo(l+o/6,c),e.lineTo(l+o/4,c-o/3),e.lineTo(l+o/2,c),e.stroke(),e.restore()}function La(e,t,i,o,s,l=!1,c=!1,d=!1,u=!1){o<Eh&&(i=i*.75),Jh.render(e,t.x-i/2,t.y-i/2,i,i,0,"idle",s,o,[0,0],!1,0);let h,g;l?(h=L_,g=Wv):c?(h=U_,g=jv):d?(h=G_,g=zv):u&&(h=x_,g=Yv),h&&g&&hD(e,t,i/2,h,g)}function pD(e,t,i,o,s,l){if(e.save(),o.length===0){e.restore();return}const c=o.length*s,d=4;let u;const h=c+(o.length-1)*d;o.length>1&&h>l?u=(l-c)/(o.length-1):u=d,o.length<=1&&(u=0);for(let g=0;g<o.length;g++){const{member:y,isPlayer:I,isHeir:v,isPartner:T,isParent:A}=o[g],E=t+g*(s+u)+s/2,C=i+s/4;La(e,{x:E,y:C},s,y.age,y.gender,I,v,T,A)}e.restore()}function gD(e,t,i,o,s){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,o,s);const l=500,c=Math.min(s*.8,i.length*(Ks+N0)+120),d=(o-l)/2,u=(s-c)/2;e.fillStyle="#2d3748",e.strokeStyle="#4a5568",e.lineWidth=4,e.fillRect(d,u,l,c),e.strokeRect(d,u,l,c),e.fillStyle="#fff",e.font='20px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="top",e.fillText("WORLD TRIBES",o/2,u+30);const h=u+80,g=l-Qs*4,y=d+Qs*2;for(let _=0;_<i.length;_++){const w=i[_],R=h+_*(Ks+N0);if(R+Ks>u+c-60)break;const N=R+Ks/2;w.isPlayerTribe&&(e.fillStyle="rgba(255, 215, 0, 0.2)",e.fillRect(y,R,g,Ks));let D=y+Qs;if(e.font=`${Fo}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillStyle="white",e.fillText(w.tribeBadge,D,N),D+=Fo+Qs*2,w.isPlayerTribe)e.fillStyle="#aaa",e.font='10px "Press Start 2P", Arial',e.textAlign="left",e.fillText("(YOU)",D,N);else{const B=w.diplomacyStatus===It.Friendly?"":"",G=`modal_diplomacy_${w.leaderId}`,$={x:D,y:N-Fo/2,width:Fo*1.5,height:Fo},V={id:G,action:me.ToggleDiplomacy,rect:$,text:"",icon:B,backgroundColor:"transparent",textColor:"white",currentWidth:$.width,tooltip:`Set status to ${w.diplomacyStatus===It.Friendly?"Hostile":"Friendly"}`,targetTribeId:w.leaderId};t.uiButtons.push(V),t.hoveredButtonId===G&&(e.fillStyle=Hh,e.fillRect($.x,$.y,$.width,$.height)),e.font=`${Fo*.8}px Arial`,e.textAlign="center",e.fillText(B,$.x+$.width/2,N)}D+=Fo*2+Qs,La(e,{x:D+10,y:N},wi*.6,25,"male"),e.fillStyle="white",e.font=`${$_}px "Press Start 2P"`,e.fillText(`${w.adultCount}`,D+30,N),D+=80,La(e,{x:D+10,y:N},wi*.6,5,"female"),e.fillText(`${w.childCount}`,D+30,N)}const I=120,v=40,T=o/2-I/2,A=u+c-60,E="close_tribe_modal_btn",C={id:E,action:me.CloseTribeModal,rect:{x:T,y:A,width:I,height:v},text:"CLOSE",currentWidth:I,backgroundColor:In,textColor:St};t.uiButtons.push(C),e.fillStyle=t.hoveredButtonId===E?"#4a5568":In,e.fillRect(T,A,I,v),e.strokeStyle="#fff",e.strokeRect(T,A,I,v),e.fillStyle=St,e.font='12px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="middle",e.fillText("CLOSE",o/2,A+v/2),e.restore()}function mD(e,t,i,o,s){const l=nI,c=iI,d=t+o-l-c,u=i+c;e.save(),e.lineWidth=2,e.strokeStyle=s?a1:s1,e.beginPath();const h=5;e.moveTo(d+h,u+h),e.lineTo(d+l-h,u+l-h),e.moveTo(d+l-h,u+h),e.lineTo(d+h,u+l-h),e.stroke(),e.restore()}function yD(e,t,i,o){const{tutorialState:s,tutorial:l}=t;if(s.transitionState===Kt.INACTIVE)return;const c=l.steps[s.currentStepIndex];if(!c)return;e.save(),e.globalAlpha=s.transitionAlpha;const d=Q_,u=J_,h=e1,g=`${Af}px "Press Start 2P", Arial`,y=`${U0}px "Press Start 2P", Arial`,I=n1,v=U0*1.5;e.font=y;const T=c.text.split(" ");let A="";const E=[];for(let V=0;V<T.length;V++){const X=A+T[V]+" ";e.measureText(X).width>d-u*2&&V>0?(E.push(A),A=T[V]+" "):A=X}E.push(A);const C=u*2+Af+u/2+E.length*v,_=(i-d)/2,w=o-C-160;e.fillStyle=t1,e.beginPath(),e.moveTo(_+h,w),e.lineTo(_+d-h,w),e.quadraticCurveTo(_+d,w,_+d,w+h),e.lineTo(_+d,w+C-h),e.quadraticCurveTo(_+d,w+C,_+d-h,w+C),e.lineTo(_+h,w+C),e.quadraticCurveTo(_,w+C,_,w+C-h),e.lineTo(_,w+h),e.quadraticCurveTo(_,w,_+h,w),e.closePath(),e.fill(),e.fillStyle=I,e.textAlign="center",e.textBaseline="top",e.font=g,e.fillText(c.title,_+d/2,w+u),e.font=y;let R=w+u+Af+u/2;for(const V of E)e.fillText(V,_+d/2,R),R+=v;const N=t.hoveredButtonId==="tutorial-dismiss";mD(e,_,w,d,N),e.restore();const D=nI,B=iI,G=_+d-D-B,$=w+B;return{x:G,y:$,width:D,height:D}}function Bf(e,t,i){e.save();const o=r1,s={x:t.x-o,y:t.y-o,width:t.width+o*2,height:t.height+o*2};e.strokeStyle=eI,e.lineWidth=tI+Math.sin(i*Fh)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function vD(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const cS=10,ID=3,hy=cS*.7;function SD(e,t){const{position:i,food:o,maxFood:s}=t;if(e.beginPath(),e.arc(i.x,i.y,cS,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),o.length>0){const l=Math.PI*2/Math.min(o.length,s);for(let c=0;c<o.length;c++){const d=c*l,u=i.x+hy*Math.cos(d),h=i.y+hy*Math.sin(d);e.beginPath(),e.arc(u,h,ID,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const py=(e,t,i=70,o=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${i}%, ${o}%)`},AD=(e,t)=>{const i=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!i)return e;const[o,s,l]=[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])];return`hsl(${o}, ${s}%, ${Math.max(0,l-t)}%)`},dc=(e,t,i,o,s,l,c,d=!1)=>{e.save(),e.translate(t,i),e.rotate(l),e.fillStyle=d?AD(c,15):c,e.beginPath(),e.roundRect(-o/2,0,o,s,o/2),e.fill(),e.restore()},Hf=(e,t)=>{const i=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),o=75;if(!i)return`hsl(0, 0%, ${o}%)`;const[,s,l,c]=i.map(Number),d=l*(1-t),u=c+(o-c)*t;return`hsl(${s}, ${d}%, ${u}%)`},uS={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,i,o,s,l,c,d={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=o*.15,h=t+o/2,g=i+s/2,y=o-u*2,I=s-u*2,{gender:v,age:T,direction:A,isPregnant:E,hungryLevel:C,geneCode:_}=d,w=.8+Math.min(T,10)/10*.4,R=v==="male"?1.05:.95,N=1-C/100*.3,D=y*.5*N*w*R;let B=I*.3*w*R;const G=y*.15*w*R,$=D*.2,V=I*.3,X=py(_,0,30,50);let q=py(_,8,50,40);if(T>45){const ae=Math.min(1,(T-45)/15);q=Hf(q,ae)}e.translate(h,g),A[0]<0&&e.scale(-1,1);const re=Math.sin(l*Math.PI*2),ee=Math.cos(l*Math.PI*2),ne=V+B*.2;if(c==="dead"){const ae=Math.min(l,1);e.translate(0,I*.2),e.rotate(Math.PI/2);const Se=Hf(q,ae),Te=Hf(X,ae);e.globalAlpha=.5+ae*.5,e.strokeStyle=Se,e.lineWidth=$*.5,e.beginPath(),e.moveTo(-D*.4,0),e.lineTo(D*.4,0),e.stroke();for(let ie=-1;ie<=1;ie+=1)e.beginPath(),e.arc(0,0,B*.4,Math.PI*.4*ie-Math.PI*.2,Math.PI*.4*ie+Math.PI*.2),e.stroke();e.fillStyle=Te,e.beginPath(),e.arc(D*.5,0,G,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(D*.55,0,G*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,ne,D*.7,D*.25,0,0,2*Math.PI),e.fill();let oe=0,te=0,W=0,Q=0,Z=0,k=0;switch(c){case"idle":te=re*(I*.02),W=re*.05,Q=-re*.05,Z=-re*.05,k=re*.05;break;case"walk":te=Math.abs(ee)*(I*-.04),W=re*.7,Q=-re*.7,Z=-re*.7,k=re*.7;break;case"eat":oe=I*.1,te=I*.05,oe+=re*(I*.02);break;case"procreate":te=I*.05;const ae=(1-ee)*-y*.05;e.translate(ae,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}E&&v==="female"&&(B*=1.6);const U=te,se=U-B*.2;dc(e,D*-.35,se,$,V,Z,q,!0),dc(e,D*.35,se,$,V,k,q,!0),e.fillStyle=q,e.beginPath(),e.ellipse(0,U,D/2,B/2,0,0,2*Math.PI),e.fill();const ce=D*.45,Re=se+oe;e.fillStyle=X,e.beginPath(),e.arc(ce,Re,G,0,Math.PI*2),e.fill(),A[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(ce+G*.3,Re-G*.2,G*.15,0,Math.PI*2),e.fill()),dc(e,D*-.35,se,$,V,W,q),dc(e,D*.35,se,$,V,Q,q),e.restore()}};function TD(e,t){let[i,o,s]=e.match(/\d+/g).map(Number);return i=Math.max(0,i-t),o=Math.max(0,o-t),s=Math.max(0,s-t),`rgb(${i}, ${o}, ${s})`}function ED(e){const t=(e&16711680)>>16,i=(e&65280)>>8,o=e&255,s=`rgb(${t}, ${i}, ${o})`,l=TD(s,40),c=(e&255)%100+50,d=(e>>8&255)%100,u=(e>>16&255)%100,h=`rgb(${c}, ${d}, ${u})`,g=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:l,skinColor:h,eyeColor:g}}const dS={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,i,o,s,l,c,d={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:h,direction:g,isPregnant:y,hungryLevel:I,geneCode:v}=d;e.save();const T=o*.15,A=Math.max(1,Math.floor((o-T*2)/10)),E=g[0]<0;e.translate(t+o/2,i+s/2),E&&e.scale(-1,1);const C=ED(v),_=.8+Math.min(h,20)/20*.4,w=u==="male"?1.05:.95,R=1-I/100*.25,N=_*w*R,D=Math.max(0,Math.min(1,(h-15)/5));e.filter=`grayscale(${D})`;const B=C.furColor,G=C.darkerFurColor,$=C.eyeColor,V="#FFFFFF",X="#c75c5c",q="#E0E0E0",re="#A0A0A0",ee=s/2-2*A,ne=Math.sin(l*Math.PI*2),oe=Math.abs(ne);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,ee,A*4,A,0,0,2*Math.PI),e.fill(),e.filter="none",c==="dead"){const Ke=Math.min(1,l*2);e.save(),e.translate(0,ee-A*3),e.rotate(-Math.PI/2);const Ve=(An,en,Tn,Zn,Kn=!1)=>{e.fillStyle=Kn?re:q,e.fillRect(An*A,en*A,Tn*A,Zn*A)};Ke<1&&(e.globalAlpha=1-Ke,e.fillStyle=B,e.beginPath(),e.ellipse(0,0,A*3,A*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),Ke>0&&(e.globalAlpha=Ke,Ve(-1,-4,2,2),Ve(1,-3.5,1,1,!0),Ve(-.5,-2,1,5,!0),Ve(-2.5,-1,5,.5),Ve(-2.5,0,5,.5),Ve(-2.5,1,5,.5),Ve(-3,-2,-1,2,!0),Ve(3,-2,1,2),Ve(-3,2,-1,2,!0),Ve(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=B;let te=0,W=0,Q=0,Z=[0,0,0,0];switch(c){case"idle":te=ne*A*.1;break;case"walk":const Ke=Math.sin(l*Math.PI*4);te=Math.abs(Ke)*-A*.5,Z=[Ke*A,-Ke*A,-Ke*A,Ke*A];break;case"attacking":const Ve=Math.sin(l*Math.PI*4);W=A*2+Ve*A,Q=A*2,te=A;break;case"eat":Q=A*3+oe*A,te=A*1.5,e.fillStyle=X,e.fillRect(-A,ee-A,A*2,A);break;case"procreate":te=Math.sin(l*Math.PI*8)*A*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let en=0;en<5;en++){const Tn=(Math.random()-.5)*A*8,Zn=ee+(Math.random()-.5)*A*2;oe>.5&&e.fillRect(Tn,Zn,A*.5,A*.5)}break}const k=A*3*N*(y?1.3:1),U=A*5*N,se=-U/1.5,ce=ee-k-A*2.5+te;e.fillStyle=B,e.beginPath(),e.moveTo(se-A*.5,ce+k*.5),e.quadraticCurveTo(se-A*3,ce-A,se-A*2+ne*A,ce+k+A),e.fill();const Re=A*1.2*N,ae=A*3*N,Se=A*2.5*N,Te=se+U*.8,ie=se+U*.2;e.fillStyle=G,e.fillRect(ie,ee-Se,Re,Se+Z[2]),e.fillRect(Te,ee-ae,Re,ae+Z[0]),e.fillStyle=B,e.beginPath(),e.moveTo(se,ce+k),e.lineTo(se,ce+A),e.quadraticCurveTo(se+U/2,ce,se+U,ce+A),e.lineTo(se+U,ce+k),e.fill(),e.fillStyle=B,e.fillRect(ie+A/2,ee-Se,Re,Se+Z[3]),e.fillRect(Te+A/2,ee-ae,Re,ae+Z[1]);const he=A*3.5*N,Ne=se+U-he*.3+W,Ae=ce-he*.3+Q;e.fillStyle=B,e.beginPath(),e.arc(Ne,Ae,he/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(Ne+he*.4,Ae+he*.2,A*1.5,A,0,0,Math.PI*2),e.fill(),g[1]>=0&&(e.fillStyle=$,e.fillRect(Ne+A*.5,Ae-A*.5,A*.5,A*.5),c==="attacking"&&(e.fillStyle=V,e.fillRect(Ne+he*.5,Ae+he*.4,A,A*.4))),e.fillStyle=G,e.beginPath(),e.moveTo(Ne-he*.4,Ae-he*.3),e.lineTo(Ne,Ae-he*.7),e.lineTo(Ne,Ae-he*.2),e.fill(),e.restore()}};class ja{constructor(t=200){Nt(this,"cache",new Map);Nt(this,"maxSize");this.maxSize=t}getOrRender(t,i,o,s){const l=this.cache.get(t);if(l)return this.cache.delete(t),this.cache.set(t,l),l;const{canvas:c,ctx:d}=aS(i,o);if(s(d),this.cache.size>=this.maxSize){const u=this.cache.keys().next().value;u!==void 0&&this.cache.delete(u)}return this.cache.set(t,c),c}clear(){this.cache.clear()}}const wD=9,_D=new ja(200);function CD(e,t){const{position:i,gender:o,age:s,decayProgress:l,food:c,radius:d,originalEntityType:u,geneCode:h}=t,g=or(l,20),y=Math.floor(s),I=`${u}_${o}_${y}_${g}_${d}_${h||0}`,v=Math.ceil(d*2)+4,T=_D.getOrRender(I,v,v,A=>{A.translate(v/2,v/2),u==="human"?Jh.render(A,-v/2+2,-v/2+2,v-4,v-4,g,"dead",o,y,[0,0],!1,0):u==="prey"?uS.render(A,-v/2+2,-v/2+2,v-4,v-4,g,"dead",{gender:o,age:y,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024}):u==="predator"&&dS.render(A,-v/2+2,-v/2+2,v-4,v-4,g,"dead",{gender:o,age:y,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024})});if(e.save(),e.globalAlpha=1-l,e.drawImage(T,i.x-T.width/2,i.y-T.height/2),e.restore(),c.length>0){e.save(),e.font=`${wD}px Arial`,e.textAlign="center",e.textBaseline="middle";const A=ft*.9,E=Math.PI/Pv*3;c.forEach((C,_)=>{const w=_*E,R=i.x+A*Math.cos(w)*Math.atan2(_,_),N=i.y+A*Math.sin(w)*Math.atan2(_,_),D=Ah[C.type];e.fillText(D,R,N)}),e.restore()}}function ho(e,t,i,o,s,l,c,d){e.save(),e.fillStyle=c,e.fillRect(t,i,o,s),e.fillStyle=d,e.fillRect(t,i,o*Math.max(0,l),s),e.restore()}function PD(e,t,i,o,s,l){if(e.save(),o.length===0){e.restore();return}const c=o.length*s;let d;c>l||c+(o.length-1)*4>l?d=(l-c)/(o.length-1):d=4,o.length===1&&(d=0);for(let u=0;u<o.length;u++){const h=Ah[o[u].type];e.fillText(h,t+u*(s+d),i)}e.restore()}function RD(e,t,i,o,s){const l=t.autopilotControls.hoveredAutopilotAction;if(!l)return;let c,d=ft/2;const u=su[l.action],h=fI[l.action],g=`${u} ${h}`;if("targetEntityId"in l){const y=t.entities.entities[l.targetEntityId];y&&(c=y.position,d=y.radius)}else"position"in l&&(c=l.position);if(c){lS(e,c,d,Nh,Bh,2,i,o,s,t.mapDimensions),e.save(),e.font=`${ts}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:y,y:I}=za(c,i,{width:o,height:s},t.mapDimensions),v=I-d-iu-ts/2;e.fillText(g,y,v),e.restore()}}function MD(e,t,i,o,s){e.save();const l=(Math.sin(s*Fh)+1)/2,c=i+iu+l*5;e.strokeStyle=Nh,e.lineWidth=2,e.setLineDash(Bh),e.beginPath(),e.arc(t.x,t.y,c,0,Math.PI*2),e.stroke(),e.setLineDash([]);const d=su[o],u=fI[o];if(d){e.font=`${ts*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const h=t.y-c-25;e.fillText(d,t.x,h),e.font=`${ts*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,h+25)}e.restore()}function kD(e,t){const{activeAutopilotAction:i}=t.autopilotControls;if(At(t)&&i){let s,l=15;if("position"in i)s=i.position;else if("targetEntityId"in i){const c=t.entities.entities[i.targetEntityId];c&&(s=c.position,l=c.radius||(c.type==="building"?20:30))}if(s){const c=(d,u)=>{MD(d,u.position,l,i.action,t.time)};Dn(e,t.mapDimensions.width,t.mapDimensions.height,c,{position:{...s}},s,l+30)}}}function gy(e,t,i,o,s,l,c=!0){const d=t.split(" ");let u="";const h=[];for(let g=0;g<d.length;g++){const y=u+d[g]+" ";e.measureText(y).width>s&&g>0?(h.push(u),u=d[g]+" "):u=y}if(h.push(u),c)for(let g=0;g<h.length;g++)e.fillText(h[g],i,o+g*l);return h.length*l}function DD(e){return 1-Math.pow(1-e,3)}function OD(e,t,i,o){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(c=>!c.isDismissed);if(s.length===0)return;e.save();let l=o-m1;for(const c of s){const d=i-sc-Uo;e.font=`${Tf}px "Press Start 2P", Arial`;const u=d+Uo,h=sc-Uo*2,g=gy(e,c.message,-9999,-9999,h,Tf*1.2,!1),y=Uo*2+g+ii,I=l-y,v=Date.now()-c.creationTime,T=Math.min(v/g1,1),A=DD(T),E=o,C=E+(I-E)*A;e.fillStyle=c1,e.beginPath(),e.roundRect(d,C,sc,y,l1),e.fill(),e.fillStyle=u1,e.textBaseline="top",gy(e,c.message,u,C+Uo,h,Tf*1.2,!0);const _=C+y-ii-Uo/2,w=d+sc-ii-Uo/2,R={x:w,y:_,width:ii,height:ii};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[c.id]=R);const N=t.hoveredButtonId===`notification-dismiss-${c.id}`;if(e.fillStyle=N?$0:d1,e.font=`${ii}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",R.x+R.width/2,R.y+R.height/2),c.targetEntityIds||c.targetPosition||c.targetArea||c.targetRadius){const G={x:w-ii-x0,y:_,width:ii,height:ii};t.notificationButtonRects&&(t.notificationButtonRects.view[c.id]=G);const $=t.hoveredButtonId===`notification-view-${c.id}`;e.fillStyle=$?$0:f1,e.font=`${ii*($?1.5:1.2)}px Arial`,e.fillText("",G.x+G.width/2,G.y+G.height/2)}l-=y+x0}e.restore()}function bD(e){return e.length===0?0:e.reduce((i,o)=>i+o,0)/e.length}function Ff(e,t,i,o,s,l,c,d){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(o,s,l,c),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(o,s,l,c);const u=bD(i);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,o+qe,s+qe+8);const h=Math.max(...i,1),g=i.map(y=>y/h*c);if(e.beginPath(),e.strokeStyle=d,e.lineWidth=2,g.length>1){e.moveTo(o,s+c-g[0]);for(let y=1;y<g.length;y++){const I=o+y/(g.length-1)*l,v=s+c-g[y];e.lineTo(I,v)}}else if(g.length===1){const y=s+c-g[0];e.moveTo(o,y),e.lineTo(o+l,y)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${h.toFixed(2)}ms`,o+l-qe,s+qe+8),e.restore()}function ND(e,t,i){const{performanceMetrics:o}=t;if(!o)return;const s=280,l=240,c=i-s-qe,d=qe+ln*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(c,d,s,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(c,d,s,l),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=d+qe+5;const h=c+qe;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",h,u),u+=25,e.fillStyle="white",e.font="12px monospace";const g=BD(t);e.fillText(`FPS: ${g.toFixed(1)}`,h,u),u+=20;const y=s-qe*2,I=45,v=10;Ff(e,"Render",Lf(t,"renderTime"),h,u,y,I,"#4CAF50"),u+=I+v,Ff(e,"World Update",Lf(t,"worldUpdateTime"),h,u,y,I,"#2196F3"),u+=I+v,Ff(e,"AI Update",Lf(t,"aiUpdateTime"),h,u,y,I,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",c+s/2,d+l-10),e.restore()}function BD(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const i=t.history[t.history.length-1].bucketTime/(Mt/Ht);return t.history.filter(l=>i-l.bucketTime/(Mt/Ht)<1).length}function HD(e,t){if(e.length===0)return[];const i=new Map;for(const l of e){const c=Math.floor(l.bucketTime/(Mt/Ht));i.set(c,(i.get(c)||0)+l[t])}return Array.from(i.keys()).sort().map(l=>i.get(l)).slice(0,-1).slice(1).reverse()}function Lf(e,t){return HD(e.performanceMetrics.history,t)}const FD={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"},LD=new ja(1e4);function UD(e,t){const{radius:i,position:o,activeAction:s="idle"}=t,l=t.stateMachine[0]||"N/A",c=t.isAdult?ft+20:ft*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${l}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,o.x,o.y-c+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,i,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function GD(e,t,i,o,s){e.save(),e.font=`${ya}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(i,t.x,t.y-(o?ft:cs)-ya-s),e.restore()}function xD(e,t,i,o,s){const l=t.x,c=t.y-i-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(l-o/2,c,o,o/2),e.fill(),e.beginPath(),e.moveTo(l-o/2,c),e.lineTo(l-o/4,c-o/3),e.lineTo(l-o/6,c),e.moveTo(l-o/6,c),e.lineTo(l,c-o/2),e.lineTo(l+o/6,c),e.moveTo(l+o/6,c),e.lineTo(l+o/4,c-o/3),e.lineTo(l+o/2,c),e.stroke(),e.restore()}function $D(e,t,i){var d;const{position:o,radius:s}=t,l=o.x-Sf/2,c=o.y-s-W_;if(t.stateMachine[0]===Io){const u=t.stateMachine[1],h=i-u.attackStartTime,g=Math.min(h/Jc,1);ho(e,l,c,Sf,B0,g,co,Y_)}else if((d=t.attackCooldown)!=null&&d.melee&&t.attackCooldown.melee>0){const u=1-t.attackCooldown.melee/eu;ho(e,l,c,Sf,B0,u,co,z_)}}function WD(e,t,i=!1,o=!1,s=!1,l=!1,c=!1,d=!1,u=!1,h){var G,$;const{position:g,activeAction:y="idle"}=t,I=t.isAdult?ft:ft*.6,v=FD[y]||"idle",T=or(t.animationProgress||0,12),A=Kh(t.direction,8),E=Math.floor(t.age),C=or(t.hunger/100,5)*100,_=`${v}_${t.gender}_${E}_${A}_${T}_${t.isPregnant??!1}_${C}_${I}`,w=Math.ceil(I*2)+4,R=LD.getOrRender(_,w,w,V=>{V.translate(w/2,w/2);const X=Qh(A,8);Jh.render(V,-w/2+2,-w/2+2,w-4,w-4,T,v,t.gender,E,X,t.isPregnant??!1,C)});e.drawImage(R,g.x-R.width/2,g.y-R.height/2),d&&(e.save(),e.strokeStyle=__,e.lineWidth=2,e.beginPath(),e.arc(g.x,g.y,I+3,0,2*Math.PI),e.stroke(),e.restore());let N,D;if(c?(N=P_,D=jv):i?(N=C_,D=Wv):s?(N=R_,D=w_):o?(N=M_,D=Yv):l&&(N=k_,D=zv),N&&D&&xD(e,g,I,N,D),(G=t.tribeInfo)!=null&&G.tribeBadge&&GD(e,g,t.tribeInfo.tribeBadge,t.isAdult??!1,N??0),t.heldItem){const V=Lh[t.heldItem.type],X=($=t.tribeInfo)!=null&&$.tribeBadge?ya:0;e.save(),e.font=`${ya}px Arial`,e.textAlign="center",e.textBaseline="middle";const q=g.y-(t.isAdult?ft:cs)-ya-(N??0)-X;e.fillText(V,g.x,q),e.restore()}const B=u&&(h.debugCharacterId===void 0||t.id===h.debugCharacterId);$D(e,t,h.time),B&&UD(e,t)}const YD={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},zD=new ja(200);function jD(e,t){const{radius:i,position:o,activeAction:s="idle"}=t,l=t.stateMachine[0]||"N/A",c=t.isAdult?ft+20:ft*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${l}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-c+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,i,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function XD(e,t,i=!1,o){const{position:s,activeAction:l="idle"}=t,c=t.isAdult?t.radius:t.radius*.6,d=YD[l]||"idle",u=or(t.animationProgress||0,12),h=Kh(t.direction||{x:1,y:0},8),g=Math.floor(t.age),y=or(t.hunger/100,5)*100,I=`${d}_${g}_${h}_${u}_${t.isPregnant??!1}_${y}_${t.geneCode}_${c}`,v=Math.ceil(c*2)+4,T=zD.getOrRender(I,v,v,E=>{E.translate(v/2,v/2);const C=Qh(h,8);uS.render(E,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:g,direction:C,isPregnant:t.isPregnant??!1,hungryLevel:y,geneCode:t.geneCode})});if(e.drawImage(T,s.x-T.width/2,s.y-T.height/2),t.hitpoints<t.maxHitpoints){const E=c*1.5,C=3,_=s.x-E/2,w=s.y-c-8;e.fillStyle="#555",e.fillRect(_,w,E,C);const R=t.hitpoints/t.maxHitpoints;e.fillStyle=R>.5?"#4CAF50":R>.25?"#FFC107":"#F44336",e.fillRect(_,w,E*R,C)}i&&(o===void 0||t.id===o)&&jD(e,t)}const VD={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},qD=new ja(200);function ZD(e,t){const{radius:i,position:o,activeAction:s="idle"}=t,l=t.stateMachine[0]||"N/A",c=t.isAdult?ft+20:ft*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${l}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-c+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,i,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function KD(e,t,i=!1,o){const{position:s,activeAction:l="idle"}=t,c=t.isAdult?t.radius:t.radius*.6,d=VD[l]||"idle",u=or(t.animationProgress||0,12),h=Kh(t.direction||{x:1,y:0},8),g=Math.floor(t.age),y=or(t.hunger/100,5)*100,I=`${d}_${g}_${h}_${u}_${t.isPregnant??!1}_${y}_${t.geneCode}_${c}`,v=Math.ceil(c*2)+4,T=qD.getOrRender(I,v,v,E=>{E.translate(v/2,v/2);const C=Qh(h,8);dS.render(E,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:g,direction:C,isPregnant:t.isPregnant??!1,hungryLevel:y,geneCode:t.geneCode})});if(e.drawImage(T,s.x-T.width/2,s.y-T.height/2),t.hitpoints<t.maxHitpoints){const E=c*1.5,C=3,_=s.x-E/2,w=s.y-c-8;e.fillStyle="#555",e.fillRect(_,w,E,C);const R=t.hitpoints/t.maxHitpoints;e.fillStyle=R>.5?"#4CAF50":R>.25?"#FFC107":"#F44336",e.fillRect(_,w,E*R,C)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,c+3,0,2*Math.PI),e.stroke()),i&&(o===void 0||t.id===o)&&ZD(e,t)}const fS=15;function QD(e,t,i,o,s=1.5){const l=i-t.startTime,c=Math.min(l/t.duration,1),d=1-c,h=1+Math.sin(c*Math.PI*2)*(s-1),g=fS*h;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,g),0,Math.PI*2),e.fillStyle=o,e.fill(),e.restore()}function ta(e,t,i,o,s=2){const l=i-t.startTime,c=Math.min(l/t.duration,1),d=1-c,u=fS*2*c;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=o,e.lineWidth=s,e.stroke(),e.restore()}function Si(e,t,i,o){const s=i-t.startTime,l=Math.min(s/t.duration,1),c=1-l,d=-20*l;e.save(),e.globalAlpha=c,e.font="20px Arial",e.textAlign="center",e.fillText(o,t.position.x,t.position.y+d),e.restore()}function JD(e,t,i,o){const{width:s,height:l}=o.mapDimensions;let c=t.targetPosition;if(t.targetEntityId){const A=o.entities.entities[t.targetEntityId];A&&(c=A.position)}if(!c)return;const d=i-t.startTime,u=Math.min(d/t.duration,1);let h=c.x-t.position.x,g=c.y-t.position.y;h=h-Math.round(h/s)*s,g=g-Math.round(g/l)*l;const y={x:h,y:g},I=t.position.x+y.x*u,v=t.position.y+y.y*u,T=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(I,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(I,v+T),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function hS(e,t,i,o){switch(t.type){case ye.Procreation:Si(e,t,i,"");break;case ye.Pregnant:QD(e,t,i,"rgba(255, 105, 180, 0.7)",1.2);break;case ye.TargetAcquired:ta(e,t,i,"rgba(255, 0, 0, 0.8)",3);break;case ye.Attack:Si(e,t,i,"");break;case ye.Partnered:Si(e,t,i,"");break;case ye.BushClaimed:ta(e,t,i,"rgba(0, 255, 0, 0.7)",2);break;case ye.BushClaimLost:ta(e,t,i,"rgba(128, 128, 128, 0.7)",2);break;case ye.Eating:Si(e,t,i,"");break;case ye.ChildFed:Si(e,t,i,"");break;case ye.AttackDeflected:Si(e,t,i,"");break;case ye.AttackResisted:Si(e,t,i,"");break;case ye.Hit:Si(e,t,i,"");break;case ye.SeizeBuildup:ta(e,t,i,"rgba(255, 215, 0, 0.8)",4);break;case ye.BorderClaim:Si(e,t,i,"");break;case ye.Seize:ta(e,t,i,"rgba(148, 0, 211, 0.8)",4);break;case ye.StoneProjectile:JD(e,t,i,o);break}}function my(e,t,i,o,s,l,c){e.save();const{position:d}=t;e.strokeStyle=o,e.lineWidth=s+Math.sin(c*l)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(d.x,d.y,i,0,2*Math.PI),e.stroke(),e.restore()}const yy=8,eO=1.5,tO=.5,vy=2,nO="#5a5a5a",iO="#7e7e7e",oO="#8B0000",rO="#FF4444",sO=6,aO=new ja(1e3),Iy=20;function lO(e,t,i=!1,o=!0){if(i)return`ghost_${e.buildingType}_${o}`;const s=e,l=s.buildingType===de.Bonfire&&(s.fuelLevel??0)>0;return`${s.id}_${s.buildingType}_${s.width}_${s.height}_${t}_${s.isConstructed}_${l}`}function pS(e,t,i=!1,o=!0){const s=lO(e,t,i,o),{width:l,height:c,id:d,buildingType:u}=e,h=l+Iy*2,g=c+Iy*2;return aO.getOrRender(s,h,g,y=>{const I=To[u],v="isConstructed"in e?e.isConstructed:!0;if(y.translate(h/2,g/2),i){const T=o?"#4CAF50":"#F44336";Uf(y,l,c,9999,T),y.font=`${Math.min(l,c)*.5}px Arial`,y.textAlign="center",y.textBaseline="middle",y.fillStyle=T,y.fillText(I.icon,0,0)}else{const T=e;let A=I.icon;T.buildingType===de.Bonfire&&v&&(A=(T.fuelLevel??0)>0?"":""),t?Uf(y,l,c,d,oO,rO):Uf(y,l,c,d),y.globalAlpha=.5,y.font=`${Math.min(l,c,30)*.5}px Arial`,y.textAlign="center",y.textBaseline="middle",y.shadowColor="rgba(0,0,0,0.5)",y.shadowBlur=4,y.fillStyle="#FFFFFF",y.fillText(A,0,0)}})}function Uf(e,t,i,o,s,l){const c=(t+i)*2,d=Math.floor(c/yy),u=-t/2,h=t/2,g=-i/2,y=i/2;for(let I=0;I<d;I++){const v=o+I*13,T=Xr(v),A=Xr(v+1);let E=I*yy,C=0,_=0;E<t?(C=u+E,_=g):E<t+i?(C=h,_=g+(E-t)):E<t*2+i?(C=h-(E-(t+i)),_=y):(C=u,_=y-(E-(t*2+i)));const w=(A-.5)*vy,R=(Xr(v+2)-.5)*vy;e.beginPath();const N=eO+T*tO;s?e.fillStyle=s:e.fillStyle=T>.5?l||iO:s||nO,e.ellipse(C+w,_+R,N,N*.85,A*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function cO(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:i,storedItems:o}=t;e.save(),e.font=`${sO}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,o.forEach(s=>{const l=s.item.type,c=(Ah[l]||Lh[l])??"?",d={x:i.x+s.positionOffset.x,y:i.y+s.positionOffset.y};e.fillText(c,d.x,d.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function uO(e,t,i){const{position:o,width:s,height:l,constructionProgress:c,destructionProgress:d,isConstructed:u,isBeingDestroyed:h}=t,g=At(i),y=!!(g&&tr(g,t,i)),I=pS(t,y);e.save(),u||(e.globalAlpha=.3+c*.7),e.drawImage(I,o.x-I.width/2,o.y-I.height/2),e.restore();const v=s,T=o.x-v/2,A=o.y+l/2+HT;u?h&&ho(e,T,A,v,o0,1-d,co,BT):ho(e,T,A,v,o0,c,co,NT),(t.buildingType===de.StorageSpot||t.buildingType===de.Bonfire)&&u&&cO(e,t)}function dO(e,t,i,o,s){const l=To[i],{width:c,height:d}=l.dimensions,u=pS({buildingType:i,width:c,height:d,id:9999},!1,!0,o),h=(y,I)=>{y.save(),y.globalAlpha=bT,y.drawImage(u,I.x-u.width/2,I.y-u.height/2),y.restore()},g={position:{...t},radius:Math.max(c,d)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Oe.create()};Dn(e,s.width,s.height,(y,I)=>h(y,I.position),g)}const Lr=1,fO=20,Wn=4,Sy=8,hO="rgba(34, 85, 34, 0.25)",pO="rgba(139, 50, 50, 0.25)",Vr=new Map,gO=50;function mO(e,t){return e.map(i=>i.id).sort((i,o)=>i-o).join(",")+`_${t}`}function yO(){if(Vr.size>gO){const e=Vr.keys().next().value;e&&Vr.delete(e)}}function vO(e){const t=new Map;for(const i of e){const o=i.ownerId;o&&(t.has(o)||t.set(o,[]),t.get(o).push(i))}return t}function IO(e,t,i,o){let s=0;const l=Math.max(o.width,o.height)/2;for(const c of i){const d=e-c.position.x,u=t-c.position.y,h=d*d+u*u;h>0?s+=l*l/h:s+=100}return s}function SO(e,t,i){let o=1/0,s=1/0,l=-1/0,c=-1/0;for(const d of e)o=Math.min(o,d.position.x-t.width/2),s=Math.min(s,d.position.y-t.height/2),l=Math.max(l,d.position.x+t.width/2),c=Math.max(c,d.position.y+t.height/2);return{minX:o-i,minY:s-i,maxX:l+i,maxY:c+i}}function AO(e,t,i,o){const s=mO(e,o);if(Vr.has(s))return Vr.get(s);const l=i.maxX-i.minX,c=i.maxY-i.minY,d=Math.ceil(l/Wn),u=Math.ceil(c/Wn),h=[],g=[];for(let v=0;v<u;v++)h[v]=new Array(d);for(let v=0;v<u;v++)for(let T=0;T<d;T++){const A=i.minX+T*Wn,E=i.minY+v*Wn,C=IO(A,E,e,t);h[v][T]=C}for(let v=1;v<u-1;v++)for(let T=1;T<d-1;T++)if(h[v][T]>=Lr&&(h[v-1][T]<Lr||h[v+1][T]<Lr||h[v][T-1]<Lr||h[v][T+1]<Lr)){const E=i.minX+T*Wn,C=i.minY+v*Wn;g.push({x:E,y:C})}const y=wO(g),I={fieldValues:h,edgePoints:g,regions:y,bounds:i};return Vr.set(s,I),yO(),I}function TO(e,t,i,o,s,l){if(t.length===0)return;const{bounds:c}=l,d=10;if(!l.canvas){const u=c.maxX-c.minX+d*2,h=c.maxY-c.minY+d*2,{canvas:g,ctx:y}=aS(u,h);y.translate(-c.minX+d,-c.minY+d);const{fieldValues:I,regions:v}=l;EO(y,I,c,o);let T=s;for(const A of v){const E=_O(A);CO(y,E,o,T),T+=1e3}l.canvas=g}e.save(),e.globalAlpha=1,e.drawImage(l.canvas,c.minX-d,c.minY-d),e.restore()}function EO(e,t,i,o){const s=o?pO:hO;e.save(),e.fillStyle=s,e.beginPath();for(let l=0;l<t.length;l++)for(let c=0;c<t[l].length;c++)if(t[l][c]>=Lr){const d=i.minX+c*Wn,u=i.minY+l*Wn;e.rect(d,u,Wn,Wn)}e.fill(),e.restore()}function wO(e){if(e.length===0)return[];const t=Wn*2,i=t,o=new Map;function s(h,g){const y=Math.floor(h/i),I=Math.floor(g/i);return`${y},${I}`}for(let h=0;h<e.length;h++){const g=s(e[h].x,e[h].y);o.has(g)||o.set(g,[]),o.get(g).push(h)}function l(h,g){const y=[],I=Math.floor(h/i),v=Math.floor(g/i);for(let T=-1;T<=1;T++)for(let A=-1;A<=1;A++){const E=`${I+T},${v+A}`,C=o.get(E);C&&y.push(...C)}return y}const c=new Set,d=[],u=t*t;for(let h=0;h<e.length;h++){if(c.has(h))continue;const g=[],y=[h];for(;y.length>0;){const I=y.shift();if(c.has(I))continue;c.add(I),g.push(e[I]);const v=l(e[I].x,e[I].y);for(const T of v){if(c.has(T))continue;const A=e[T].x-e[I].x,E=e[T].y-e[I].y;A*A+E*E<=u&&y.push(T)}}g.length>0&&d.push(g)}return d}function _O(e){if(e.length<=1)return e;const t=[],i=[...e];for(t.push(i.shift());i.length>0;){const o=t[t.length-1];let s=0,l=1/0;for(let c=0;c<i.length;c++){const d=i[c].x-o.x,u=i[c].y-o.y,h=d*d+u*u;h<l&&(l=h,s=c)}t.push(i.splice(s,1)[0])}return t}function CO(e,t,i,o){if(t.length===0)return;let s=0,l=0;for(let c=1;c<t.length;c++){const d=t[c-1],u=t[c],h=u.x-d.x,g=u.y-d.y,y=Math.sqrt(h*h+g*g);for(s+=y;s>=Sy;){s-=Sy;const I=1-s/y,v=d.x+h*I,T=d.y+g*I;PO(e,v,T,i,o+l*13),l++}}}function PO(e,t,i,o,s){const l=Xr(s),c=Xr(s+1),d=(c-.5)*2,u=(Xr(s+2)-.5)*2;e.beginPath();const h=1.5+l*.5;o?e.fillStyle=l>.5?"#FF4444":"#8B0000":e.fillStyle=l>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+d,i+u,h,h*.85,c*Math.PI,0,Math.PI*2),e.fill(),o||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function RO(e,t,i,o){var y,I,v;const s=t;if(!((y=s.search)!=null&&y.building))return;const c=s.search.building.all().filter(T=>T.buildingType===de.PlantingZone&&T.isConstructed);if(c.length===0)return;const d=c.filter(T=>Ea(T,i,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(d.length===0)return;const u=To[de.PlantingZone].dimensions,h=vO(d),g=o?t.entities.entities[o]:void 0;for(const[T,A]of h){const E=((v=(I=g==null?void 0:g.tribeControl)==null?void 0:I.diplomacy)==null?void 0:v[T])==="Hostile",C=typeof T=="number"?T:0,_=SO(A,u,fO),w=AO(A,u,_,E);TO(e,A,u,E,C,w)}}const MO=.001,kO=.05,DO=12;function OO(e,t,i){const{position:o,age:s,swayOffset:l}=t,[c]=t.stateMachine??[],d=Math.min(1,Math.max(.4,s/So)),h=c!==Yt&&c!==bi?Math.sin(i*MO+l)*kO:0;if(e.save(),e.translate(o.x,o.y),e.scale(d,d),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=SP,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),c===bi?Gf(e,10,8):c===Yt?(e.rotate(Math.PI/2),Gf(e,10,30),e.translate(0,-25),Ay(e,40,20,40,15)):(e.rotate(h),Gf(e,10,30),e.translate(0,-25),e.rotate(h*.5),Ay(e,40,20,40,15)),e.restore(),(c===Yt||c===bi)&&t.wood&&t.wood.length>0){e.save(),e.font=`${DO}px Arial`,e.textAlign="center",e.textBaseline="middle";const g=t.radius*1.1,y=Math.PI*2/(du-1);t.wood.forEach((I,v)=>{const T=v===0?0:g,A=v===0?0:(v-1)*y,E=o.x+T*Math.cos(A),C=o.y+T*Math.sin(A),_=Lh[I.type];e.fillText(_,E,C)}),e.restore()}}function Gf(e,t,i){e.fillStyle=gP,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-i),e.lineTo(-10/2,-i+5),e.closePath(),e.fill(),e.fillStyle=mP,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-i+5),e.lineTo(0,-i),e.closePath(),e.fill()}function Ay(e,t,i,o,s){e.fillStyle=yP,Ty(e,t+4,i+4,o+2,s+2),e.translate(0,-2),e.fillStyle=vP,Ty(e,t,i,o,s),e.fillStyle=IP,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function Ty(e,t,i,o,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-i/2,-o),e.lineTo(0,-o-s),e.lineTo(i/2,-o),e.lineTo(t/2,0),e.closePath(),e.fill()}const fc=200;let oo=null;function bO(e,t,i,o,s){const l=OP(t.time);if(l<=0)return;oo||(oo=document.createElement("canvas")),(oo.width!==o.width||oo.height!==o.height)&&(oo.width=o.width,oo.height=o.height);const c=oo.getContext("2d");if(c){c.clearRect(0,0,o.width,o.height),c.fillStyle=`rgba(0, 0, 40, ${l*.85})`,c.fillRect(0,0,o.width,o.height),c.globalCompositeOperation="destination-out";for(const d of s){const u=za(d.position,i,o,t.mapDimensions),h=c.createRadialGradient(u.x,u.y,0,u.x,u.y,d.radius);h.addColorStop(0,`rgba(255, 255, 255, ${d.intensity})`),h.addColorStop(1,"rgba(255, 255, 255, 0)"),c.fillStyle=h,c.beginPath(),c.arc(u.x,u.y,d.radius,0,Math.PI*2),c.fill()}c.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(oo,0,0),e.restore()}}function Ey(e,t,i,o,s,l,c){for(let d=-s.height;d<=s.height;d+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const h={x:t.x+u,y:t.y+d};Ea({position:h,radius:i},l,c,s)&&e.push({position:h,radius:i,intensity:o})}}function NO(e,t,i,o,s,l=[]){const c=At(t),d=c?Bi(t,c):[],u=ns(d),{width:h,height:g}=t.mapDimensions,y=[];l.forEach(C=>{y.push({position:C,radius:30,intensity:.3})}),RO(e,t,o,c==null?void 0:c.leaderId);const I=t,v={left:o.x-s.width/2-fc,top:o.y-s.height/2-fc,right:o.x+s.width/2+fc,bottom:o.y+s.height/2+fc};[...I.search.human.byRect(v),...I.search.building.byRect(v),...I.search.berryBush.byRect(v),...I.search.tree.byRect(v),...I.search.corpse.byRect(v),...I.search.prey.byRect(v),...I.search.predator.byRect(v)].sort((C,_)=>i&&C.id===t.debugCharacterId&&C.id!==_.id||C.type==="building"&&_.type!=="building"||C.position.y<_.position.y?-1:C.position.y>_.position.y?1:C.id-_.id).forEach(C=>{var _,w;if(C.type==="building"){const R=C;if(R.isConstructed){const N=R.buildingType===de.Bonfire&&(R.fuelLevel??0)>0,D=N?180:60,B=N?.9:.4;Ey(y,R.position,D,B,t.mapDimensions,o,s)}if(R.buildingType===de.PlantingZone&&R.isConstructed)return;Dn(e,h,g,uO,R,t,c,t.time)}else if(C.type==="berryBush")Dn(e,h,g,SD,C,t,c,t.time);else if(C.type==="tree")Dn(e,h,g,OO,C,t.time);else if(C.type==="human"){const R=C,N=R.id===(c==null?void 0:c.id),D=d.some(X=>X.id===R.id),B=R.id===(u==null?void 0:u.id),G=c&&(R.id===c.motherId||R.id===c.fatherId),$=c&&(((_=R.partnerIds)==null?void 0:_.includes(c.id))||((w=c.partnerIds)==null?void 0:w.includes(R.id))),V=(c==null?void 0:c.attackTargetId)===R.id;Ey(y,R.position,40,.3,t.mapDimensions,o,s),Dn(e,h,g,WD,R,N,G,D,$,B,V,i,t)}else C.type==="corpse"?Dn(e,h,g,CD,C):C.type==="prey"?Dn(e,h,g,XD,C,i,t.time,t.debugCharacterId):C.type==="predator"&&Dn(e,h,g,KD,C,i,t.time,t.debugCharacterId)}),t.visualEffects.filter(C=>Ea(C,o,s,t.mapDimensions)).forEach(C=>{Dn(e,h,g,hS,C,t.time,t)});const E=t.notifications.filter(C=>!C.isDismissed);for(const C of E)if(C.highlightedEntityIds&&C.renderHighlights)for(const _ of C.highlightedEntityIds){const w=t.entities.entities[_];w&&Ea(w,o,s,t.mapDimensions)&&Dn(e,h,g,my,w,y1,v1,S1,I1,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const C of t.tutorialState.highlightedEntityIds){const _=t.entities.entities[C];_&&Ea(_,o,s,t.mapDimensions)&&Dn(e,h,g,my,_,o1,eI,tI,Fh,t.time)}bO(e,t,o,s,y)}function BO(e,t,i,o,s,l){let c=null,d=null;e.textAlign="left";let u=qe+ln;const g=t.time/(Mt/Ht)/Kc%1,y=Js[Hr.Time],I=25,v=qe+I;e.fillText(y,qe,u+gn/2+ln/3),ho(e,v,u,io,gn,g,co,F_),u+=gn+Ii;const T=u+wi/2,A=u+(wi-gn)/2,E=5;La(e,{x:qe*2,y:T},wi,5,i.gender,!1,!1,!1);const C=qe+wi+E,_=io+I-(wi+E)*2;ho(e,C,A,_,gn,Math.floor(i.age)/Ma,co,H_),La(e,{x:C+_+E+wi/2,y:T},wi,Ma,i.gender,!1,!1,!1),u+=gn+Ii*2;const w=[],R=new Set;if(w.push({member:i,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),R.add(i.id),o&&!R.has(o.id)&&(w.push({member:o,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),R.add(o.id)),s.forEach(ee=>{R.has(ee.id)||(w.push({member:ee,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),R.add(ee.id))}),l.forEach(ee=>{R.has(ee.id)||(w.push({member:ee,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),R.add(ee.id))}),i.motherId&&!R.has(i.motherId)){const ee=t.entities.entities[i.motherId];ee&&(w.push({member:ee,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),R.add(ee.id))}if(i.fatherId&&!R.has(i.fatherId)){const ee=t.entities.entities[i.fatherId];ee&&(w.push({member:ee,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),R.add(ee.id))}const N=Js[Hr.Family],D=10,B=qe+ln+D,G=io+I-(ln+D),$=u+rc/2;e.font=`${ln}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(N,qe,$);const V=u+rc/2;pD(e,B,V,w,rc,G),u+=rc+Ii,e.textBaseline="alphabetic";const X=Js[Hr.Hitpoints];e.fillText(X,qe,u+gn/2+ln/3),ho(e,v,u,io,gn,i.hitpoints/i.maxHitpoints,co,B_),u+=gn+Ii;const q=Js[Hr.Hunger];e.fillText(q,qe,u+gn/2+ln/3),ho(e,v,u,io,gn,(Wt-i.hunger)/Wt,co,N_),c={x:qe,y:u-Ii/2,width:io+I,height:gn+Ii},u+=gn+Ii,e.textBaseline="middle";const re=Js[Hr.Food];return e.fillText(re,qe,u+oc/2),PD(e,v,u+oc/2,i.food,oc,io),d={x:qe,y:u-Ii/5,width:io+I,height:oc+Ii},e.textBaseline="alphabetic",{hungerBarRect:c,foodBarRect:d}}let na=[],wy=0;const HO=36,FO=200;function LO(e,t,i,o){const s=t.search.prey.count(),l=t.search.predator.count(),c=t.search.berryBush.count();t.time-wy>=HO&&(na.push({time:t.time,prey:s,predators:l,bushes:c}),na.length>FO&&(na=na.slice(-200)),wy=t.time);const d=Ue*Ge,u=s/d*1e6,h=l/d*1e6,g=c/d*1e6,y=jk(),I=Math.floor(t.time/(24*365)),v=Math.floor(t.time%(24*365)/24),T=Math.floor(t.time%24),A=400,E=Math.min(o*.8,600),C=i-A-10,_=qe+ln*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(C,_,A,E),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(C,_,A,E),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let w=_+20;const R=14,N=C+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",N,w),w+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${I}, Day ${v}, Hour ${T}`,N,w),w+=R,e.fillText(`Map Size: ${Ue}  ${Ge} pixels`,N,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",N,w),w+=18,y&&(e.fillText(`Q-Table Size: ${y.qTableSize} entries`,N,w),w+=R,e.fillText(`Exploration Rate: ${(y.explorationRate*100).toFixed(1)}%`,N,w),w+=R);const D=na.slice(-20);D.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",N,w),w+=30,UO(e,N,w,D),w+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",N,w),w+=18,e.fillStyle="white",e.font="12px monospace";const B=(Ri/d*1e6).toFixed(2),G=(Mi/d*1e6).toFixed(2),$=(ki/d*1e6).toFixed(2);e.fillText(`Prey: ${u.toFixed(2)} (target: ${B})`,N,w),w+=R,e.fillText(`Predators: ${h.toFixed(2)} (target: ${G})`,N,w),w+=R,e.fillText(`Bushes: ${g.toFixed(2)} (target: ${$})`,N,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",N,w),w+=18,e.fillStyle="white",e.font="12px monospace";const V=Math.round(s/Ri*100),X=Math.round(l/Mi*100),q=Math.round(c/ki*100),re=ee=>ee<50?"#ff4444":ee<80?"#ffaa44":ee>120?"#44aaff":"#44ff44";e.fillStyle=re(V),e.fillText(`Prey: ${s}/${Ri} (${V}%)`,N,w),w+=R,e.fillStyle=re(X),e.fillText(`Predators: ${l}/${Mi} (${X}%)`,N,w),w+=R,e.fillStyle=re(q),e.fillText(`Bushes: ${c}/${ki} (${q}%)`,N,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",N,w),w+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",N,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,N,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,N,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,N,w),w+=13,e.fillText("Predators:",N,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,N,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,N,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,N,w),w+=13,e.fillText("Bushes:",N,w),w+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,N,w),w+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",C+A/2,_+E-10),e.restore()}function UO(e,t,i,o){if(o.length<2)return;const d={prey:Math.max(...o.map(h=>h.prey),Ri),predators:Math.max(...o.map(h=>h.predators),Mi),bushes:Math.max(...o.map(h=>h.bushes),ki)};[{data:o.map(h=>h.prey),color:"#44ff44",label:"Prey",target:Ri,max:d.prey},{data:o.map(h=>h.predators),color:"#ff4444",label:"Predators",target:Mi,max:d.predators},{data:o.map(h=>h.bushes),color:"#ffaa44",label:"Bushes",target:ki,max:d.bushes}].forEach((h,g)=>{const y=t+g*115,I=i;e.fillStyle=h.color,e.font="10px monospace",e.fillText(h.label,y,I-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(y,I,100,30),e.beginPath(),e.strokeStyle=h.color;for(let T=0;T<h.data.length;T++){const A=y+T/(h.data.length-1)*100,E=I+30-h.data[T]/h.max*30;T===0?e.moveTo(A,E):e.lineTo(A,E)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=I+30-h.target/h.max*30;e.moveTo(y,v),e.lineTo(y+100,v),e.stroke(),e.setLineDash([])})}function GO(e,t){const i=t.search.human.byProperty("leaderId",e),o={total:i.length,children:0,males:0,females:0,old:0};for(const s of i)s.isAdult||o.children++,s.gender==="male"?o.males++:s.gender==="female"&&o.females++,s.age>=wh&&o.old++;return o}function xO(e,t){const i=t.search,l=i.building.byProperty("ownerId",e).flatMap(h=>i.berryBush.byRadius(h.position,h.radius)).reduce((h,g)=>h+g.food.length,0),u=i.building.byProperty("ownerId",e).filter(h=>h.buildingType===de.StorageSpot).reduce((h,g)=>h+(g.storedItems.filter(y=>y.item.itemType==="food").length||0),0);return{totalBushFood:l,totalStorageFood:u,consumptionRate:0}}function $O(e,t,i){const s=t.search.human.byProperty("leaderId",e),l=t.entities.entities,c=new Map,d=new Map;for(const h of s){const g=Lc(h.id,t,c);d.has(g)||d.set(g,[]),d.get(g).push(h)}const u=[];for(const[h,g]of d.entries()){const y=l[h];y&&u.push({patriarch:y,memberCount:g.length,members:g.map(I=>I.id)})}return u.sort((h,g)=>g.memberCount-h.memberCount),u.slice(0,i)}let ia=[],ri=[],_y=0;const WO=36,Cy=200;function YO(e,t,i,o){var R;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let l=(R=qh(s,t))==null?void 0:R.id;if(!l)return;const c=GO(l,t),d=xO(l,t);if(t.time-_y>=WO){ia.push({time:t.time,total:c.total,children:c.children,males:c.males,females:c.females,old:c.old});const N=d.totalBushFood+d.totalStorageFood;ri.push({time:t.time,bushFood:d.totalBushFood,storageFood:d.totalStorageFood,totalFood:N}),ia.length>Cy&&(ia=ia.slice(-200)),ri.length>Cy&&(ri=ri.slice(-200)),_y=t.time}let u=0;if(ri.length>=2){const N=ri[ri.length-1],D=ri[ri.length-2],B=N.time-D.time;B>0&&(u=(D.totalFood-N.totalFood)/B)}const h=400,g=Math.min(o*.9,700),y=i-h-10,I=qe+ln*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(y,I,h,g),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(y,I,h,g),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=I+20;const T=13,A=y+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",A,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",A,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${c.total}`,A,v),v+=T,e.fillStyle="#00ffff",e.fillText(`Children: ${c.children}`,A,v),v+=T,e.fillStyle="#4488ff",e.fillText(`Males: ${c.males}`,A,v),v+=T,e.fillStyle="#ff88ff",e.fillText(`Females: ${c.females}`,A,v),v+=T,e.fillStyle="#888888",e.fillText(`Old (${c.old})`,A,v),v+=20;const E=ia.slice(-50);E.length>1&&(zO(e,A,v,E),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",A,v),v+=18;const C=d.totalBushFood+d.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${C}`,A,v),v+=T,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${d.totalBushFood}`,A,v),v+=T,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${d.totalStorageFood}`,A,v),v+=T,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,A,v),v+=20;const _=ri.slice(-50);_.length>1&&(jO(e,A,v,_),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",A,v),v+=18;const w=$O(l,t,5);e.fillStyle="white",e.font="11px monospace",w.length===0?(e.fillText("No families found",A,v),v+=T):w.forEach((N,D)=>{const G=`${D+1}. ${N.patriarch.isPlayer?"Player":"#"+N.patriarch.id} (${N.memberCount} members, can split: ${SI(N.patriarch,t).canSplit})`;e.fillText(G,A,v),v+=T}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",y+h/2,I+g-10),e.restore()}function zO(e,t,i,o){if(o.length<2)return;const c=Math.max(...o.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,i,350,80),[{data:o.map(u=>u.total),color:"#ffffff",label:"Total"},{data:o.map(u=>u.children),color:"#00ffff",label:"Children"},{data:o.map(u=>u.males),color:"#4488ff",label:"Males"},{data:o.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:o.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let h=0;h<u.data.length;h++){const g=t+h/(u.data.length-1)*350,y=i+80-u.data[h]/c*80;h===0?e.moveTo(g,y):e.lineTo(g,y)}e.stroke()})}function jO(e,t,i,o){if(o.length<2)return;const c=Math.max(...o.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,i,350,80),[{data:o.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:o.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:o.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let h=0;h<u.data.length;h++){const g=t+h/(u.data.length-1)*350,y=i+80-u.data[h]/c*80;h===0?e.moveTo(g,y):e.lineTo(g,y)}e.stroke()})}function Py(e,t,i){e.save();const{x:o,y:s,width:l,height:c}=t.rect,d=Vv;if(e.beginPath(),e.moveTo(o+d,s),e.lineTo(o+l-d,s),e.quadraticCurveTo(o+l,s,o+l,s+d),e.lineTo(o+l,s+c-d),e.quadraticCurveTo(o+l,s+c,o+l-d,s+c),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),e.lineTo(o,s+d),e.quadraticCurveTo(o,s,o+d,s),e.closePath(),e.fillStyle=t.isDisabled?qv:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*Jv)+1)/2;e.strokeStyle=Qv,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<Bc){const h=1-u/Bc;e.fillStyle=Kv,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}i&&!t.isDisabled&&(e.fillStyle=Hh,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?Zv:t.textColor,t.icon?(e.font=`${c*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+l/2,s+c/2),t.text&&(e.font=`${c*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+l-4,s+c-2))):(e.font=`${ln*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+l/2,s+c/2)),e.restore()}function XO(e,t,i,o){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,i,o);const s=500,l=150,c=(i-s)/2,d=(o-l)/2;e.fillStyle=St,e.font=`${ln*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",i/2,d+l/3-10),e.fillText("to the main menu?",i/2,d+l/3+10);const u=Pi*1.5,h=Xv,g=d+l-h-qe*2,y=20,I=u*2+y,v=c+(s-I)/2,T={id:"confirmExitYes",action:me.ConfirmExitYes,rect:{x:v,y:g,width:u,height:h},text:"Yes",backgroundColor:In,textColor:St,currentWidth:u},A=v+u+y,E={id:"confirmExitNo",action:me.ConfirmExitNo,rect:{x:A,y:g,width:u,height:h},text:"No",backgroundColor:In,textColor:St,currentWidth:u};t.uiButtons.push(T,E),Py(e,T,t.hoveredButtonId===T.id),Py(e,E,t.hoveredButtonId===E.id),e.restore()}let Ry="",My=null;function VO(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function qO(e){const t=new Set;for(const i of e)t.add(`${i.gridX},${i.gridY}`);return t}function hc(e,t,i,o,s,l,c){const d=((t+o)%l+l)%l,u=((i+s)%c+c)%c;return e.has(`${d},${u}`)}function ZO(e,t,i,o){const s=G1(t.soilDepletion,Ev);if(s.length===0)return;const{width:l,height:c}=t.mapDimensions,d=o.width/2,u=o.height/2,h=Math.ceil(l/Bt),g=Math.ceil(c/Bt),y=VO(s);y!==Ry&&(Ry=y,My=qO(s));const I=My,v=Bt*2,T=i.x-d-v,A=i.x+d+v,E=i.y-u-v,C=i.y+u+v;e.save();const _=e.globalAlpha;for(const w of s){const R=w.gridX*Bt,N=w.gridY*Bt,D=KO(R,N,l,c,T,A,E,C);for(const B of D)QO(e,B.x,B.y,w.health,w.gridX,w.gridY,I,h,g)}e.globalAlpha=_,e.restore()}function KO(e,t,i,o,s,l,c,d){const u=[],h=Bt,g=[{dx:0,dy:0},{dx:-i,dy:0},{dx:i,dy:0},{dx:0,dy:-o},{dx:0,dy:o},{dx:-i,dy:-o},{dx:i,dy:-o},{dx:-i,dy:o},{dx:i,dy:o}];for(const y of g){const I=e+y.dx,v=t+y.dy;I+h>=s&&I<=l&&v+h>=c&&v<=d&&u.push({x:I,y:v})}return u}function QO(e,t,i,o,s,l,c,d,u){const h=Math.floor(t),g=Math.floor(i),y=Bt,I=1-o/Ev,T=o<hw?A0:A0*I,A=!hc(c,s,l,0,-1,d,u),E=!hc(c,s,l,0,1,d,u),C=!hc(c,s,l,-1,0,d,u),_=!hc(c,s,l,1,0,d,u);e.globalAlpha=T,e.fillStyle=dw,e.fillRect(h,g,y,y);const w=3;e.fillStyle=fw,e.globalAlpha=T*1.2,A&&e.fillRect(h,g,y,w),E&&e.fillRect(h,g+y-w,y,w),C&&e.fillRect(h,g,w,y),_&&e.fillRect(h+y-w,g,w,y),e.globalAlpha=T*.5;const R=w+1;A&&C&&e.fillRect(h,g,R,R),A&&_&&e.fillRect(h+y-R,g,R,R),E&&C&&e.fillRect(h,g+y-R,R,R),E&&_&&e.fillRect(h+y-R,g+y-R,R,R),e.globalAlpha=1}const oa=8,ra=12,qt=24;function ky(e,t,i,o,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,i),e.lineTo(t,i-ra),e.stroke(),e.fillStyle=o,e.beginPath(),e.moveTo(t,i-ra),e.lineTo(t+oa,i-ra+oa/2),e.lineTo(t,i-ra+oa),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+oa/2,i-ra+oa/2))}function JO(e,t,i,o,s){const l=ou(t,s);let c=1;const d=new Map,u=new Map;for(const A of l){const C=A.leaderId===s?0:c++,_=Jt[C%Jt.length];d.set(A.leaderId,_),u.set(A.leaderId,A.tribeBadge||"")}const h=[],g=qt*2,y=Math.floor((i.x-o.width/2-g)/qt)*qt,I=Math.floor((i.x+o.width/2+g)/qt)*qt,v=Math.floor((i.y-o.height/2-g)/qt)*qt,T=Math.floor((i.y+o.height/2+g)/qt)*qt;for(let A=v;A<=T;A+=qt)for(let E=y;E<=I;E+=qt){const C=Xn(E,A,t),_=E+qt,w=Xn(_,A,t);if(C!==w){const D=C||w;if(D){const B=E+qt/2,G=A;ky(e,B,G,d.get(D)||"#000",u.get(D)||""),h.push({x:B,y:G})}}const R=A+qt,N=Xn(E,R,t);if(C!==N){const D=C||N;if(D){const B=E,G=A+qt/2;ky(e,B,G,d.get(D)||"#000",u.get(D)||""),h.push({x:B,y:G})}}}return h}const yn=12,pt=16,Mn=15;function Dy(e){switch(e){case O.Success:return"#4CAF50";case O.Failure:return"#F44336";case O.Running:return"#FFC107";case O.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function eb(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function tb(e,t,i,o){var B;const{debugCharacterId:s}=t,l=500,c=Math.min(o*.9,800),d=i-l-10,u=qe+ln*2;t.debugPanelRect={x:d,y:u,width:l,height:c},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(d,u,l,c),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(d,u,l,c),e.fillStyle="white",e.font=`${yn}px monospace`,e.textAlign="left",e.textBaseline="top";let h=u+20;const g=d+15;if(e.fillStyle="#66ccff",e.font=`bold ${yn+2}px monospace`,e.fillText(" Task AI Debugger",g,h),h+=25,!s){e.fillStyle="#888",e.font=`${yn}px monospace`,e.fillText("No character selected for debugging.",g,h),e.fillText("Click on a character to inspect their Task AI.",g,h+20),e.restore();return}const y=t.entities.entities[s];if(!y||y.type!=="human"&&y.type!=="predator"&&y.type!=="prey"){e.fillStyle="#ff4444",e.font=`${yn}px monospace`,e.fillText(`Character #${s} not found or not a character.`,g,h),e.restore();return}const I=y;e.fillStyle="white",e.font=`${yn}px monospace`,e.fillText(`Character: ${I.type} #${I.id} (${I.age.toFixed(1)}y)`,g,h),h+=pt*1.5,e.fillStyle="#66ccff",e.font=`bold ${yn}px monospace`,e.fillText(" Current Task",g,h),h+=pt*1.5;const v=Gc(I),T=v?t.tasks[v]:null;if(e.font=`${yn}px monospace`,T){const G=Oe.get(I.aiBlackboard,$I),$=Oe.get(I.aiBlackboard,WI),V=G!==void 0?O[G]:"N/A";e.fillStyle="white",e.fillText(`ID: ${T.id}`,g+Mn,h),h+=pt,e.fillText(`Type: ${x[T.type]}`,g+Mn,h),h+=pt,e.fillText(`Target: ${eb(T.target)}`,g+Mn,h),h+=pt,e.fillStyle=Dy(G),e.fillText(`Status: ${V}`,g+Mn,h),h+=pt,$&&(e.fillStyle="#aaa",e.fillText(`Message: ${$}`,g+Mn,h),h+=pt)}else e.fillStyle="#888",e.fillText("No active task.",g+Mn,h),h+=pt;h+=pt,e.fillStyle="#66ccff",e.font=`bold ${yn}px monospace`,e.fillText(" Recent Task History (Last 5)",g,h),h+=pt*1.5;const A=Oe.get(I.aiBlackboard,rh)||[];if(A.length===0)e.fillStyle="#888",e.font=`${yn}px monospace`,e.fillText("No task history yet.",g+Mn,h),h+=pt;else for(const G of A){e.fillStyle="white",e.font=`${yn}px monospace`;const $=x[G.type];e.fillText(` ${$}`,g+Mn,h);const V=O[G.result];e.fillStyle=Dy(G.result);const X=e.measureText(` ${$} `).width;e.fillText(`(${V})`,g+Mn+X,h),e.fillStyle="#666";const q=e.measureText(`(${V}) `).width;e.fillText(`@ ${G.completedAtTick.toFixed(1)}h`,g+Mn+X+q,h),h+=pt,G.message&&(e.fillStyle="#888",e.fillText(`   ${G.message}`,g+Mn,h),h+=pt)}h+=pt,e.fillStyle="#66ccff",e.font=`bold ${yn}px monospace`,e.fillText(" Available Tasks",g,h),h+=pt*1.5;const E=h,C=u+c-E-30;e.save(),e.beginPath(),e.rect(d,E,l,C),e.clip();const _=((B=t.debugPanelScroll)==null?void 0:B.y)??0;e.translate(0,-_);const w=t.search.tasks.byRadius(y.position,800);let R=0;if(w.length===0)e.fillStyle="#888",e.font=`${yn}px monospace`,e.fillText("No tasks available in the world.",g+Mn,h),h+=pt;else{const G=w.map($=>{const V=hu[$.type];return{task:$,score:V&&V.scorer&&I.type==="human"?V.scorer(I,$,{gameState:t,deltaTime:0}):null}});G.sort(($,V)=>{const X=$.score!==null?$.score:-1/0;return(V.score!==null?V.score:-1/0)-X});for(const{task:$,score:V}of G){let X="Unclaimed",q="#888";$.claimedByEntityId&&($.claimedByEntityId===I.id?(X="Claimed by this character",q="#4CAF50"):(X=`Claimed by #${$.claimedByEntityId}`,q="#F44336")),e.font=`${yn}px monospace`,e.fillStyle=q;const re=` Task ID: ${$.id}`;e.fillText(re,g,h),h+=pt,e.fillStyle="white",e.fillText(`  Type: ${x[$.type]}`,g,h),h+=pt;const ee=V!==null?V.toFixed(3):"N/A";e.fillStyle=V!==null&&V>0?"#FFC107":"#888",e.fillText(`  Score: ${ee}`,g,h),h+=pt,e.fillStyle=q,e.fillText(`  Status: ${X}`,g,h),h+=pt*1.5,R=Math.max(R,e.measureText(re).width+30)}}const N=h-E;t.debugPanelContentSize={width:R,height:N},e.restore();const D=u+c-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",d+l/2,D),e.restore()}function nb(e,t,i,o){const{debugCharacterId:s}=t;if(!s)return;const l=t.entities.entities[s];if(!(!l||l.type!=="human"&&l.type!=="predator"&&l.type!=="prey"))switch(l.aiType){case Ao.TaskBased:default:tb(e,t,i,o);break}}function $c(e,t,i,o,s,l=!1){var h;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-i.x,e.canvas.height/2-i.y),!l&&t.gameOver){e.restore(),vD(e,t);return}const c=At(t),d=JO(e,t,i,s,c==null?void 0:c.leaderId);if(ZO(e,t,i,s),NO(e,t,t.debugPanel===Ye.General,i,s,d),c&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const g=lh(t.mousePosition,i,s,t.mapDimensions),y=Oa(g,t.selectedBuildingType,c.leaderId,t);dO(e,g,t.selectedBuildingType,y,t.mapDimensions)}const u=t.notifications.filter(g=>!g.isDismissed);for(const g of u){const y=(Math.sin(t.time*p1)+1)/2;e.globalAlpha=y*.5+.25,e.fillStyle=h1,g.targetArea&&e.fillRect(g.targetArea.x,g.targetArea.y,g.targetArea.width,g.targetArea.height),g.targetRadius&&(e.beginPath(),e.arc(g.targetRadius.x,g.targetRadius.y,g.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,kD(e,t),e.restore(),!l){e.fillStyle=D_,e.font=`${ln}px "Press Start 2P", Arial`,e.shadowColor=O_,e.shadowBlur=b_,t.uiButtons=[];let g=null,y=null;if(c){const T=Bi(t,c),A=ns(T),E=((h=c.partnerIds)==null?void 0:h.map(_=>t.entities.entities[_]).filter(_=>_!==void 0))||[],C=BO(e,t,c,A,E,T);g=C.hungerBarRect,y=C.foodBarRect}const I=ou(t,c==null?void 0:c.leaderId);sD(e,t,i,I,e.canvas.width,e.canvas.height,t.cameraZoom);const{commandButtonsRect:v}=tD(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,c&&(RD(e,t,i,e.canvas.width,e.canvas.height),o.length>0&&rD(e,o,c,i,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:T}=t.tutorialState;T.includes(Qo.HUNGER_BAR)&&g&&Bf(e,g,t.time),T.includes(Qo.FOOD_BAR)&&y&&Bf(e,y,t.time),T.includes(Qo.COMMAND_BUTTONS)&&v&&Bf(e,v,t.time)}if(t.tutorialState.isActive){const T=yD(e,t,e.canvas.width,e.canvas.height);T&&t.uiButtons.push({id:"tutorial-dismiss",action:me.DismissTutorial,rect:T,text:"",currentWidth:T.width,backgroundColor:"transparent",textColor:"transparent"})}switch(OD(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case Ye.Ecosystem:LO(e,t,e.canvas.width,e.canvas.height);break;case Ye.Tribe:YO(e,t,e.canvas.width,e.canvas.height);break;case Ye.Performance:ND(e,t,s.width);break;case Ye.General:nb(e,t,e.canvas.width,e.canvas.height);break}t.tribeModalOpen&&gD(e,t,I,e.canvas.width,e.canvas.height),t.isPaused&&t.exitConfirmation!=="pending"&&nD(e),t.exitConfirmation==="pending"&&XO(e,t,e.canvas.width,e.canvas.height)}}const ib=Tt.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,ob=Tt.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,rb=Tt.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,sb=Tt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Oy=Tt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,ab=Tt.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,lb=Tt.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,pc="intro-soundtrack",by=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:i}=rr(),o=Pe.useRef(null),s=Pe.useRef(null),l=Pe.useRef(qM()),c=Pe.useRef(),d=Pe.useRef(l.current.viewportCenter),u=Pe.useRef(),h=Pe.useCallback(()=>{Rf(pc,2),i(),e("game")},[e,i]),g=Pe.useCallback(()=>{t&&(Rf(pc,2),e("game"))},[e,t]);Pe.useEffect(()=>{const v=T=>{(T.key==="Enter"||T.key===" ")&&(t?g():h())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[h,g,t]),Pe.useEffect(()=>(xh(Ie.SoundTrack1,{loop:!0,trackId:pc}),()=>{Rf(pc,2)}),[]),Pe.useEffect(()=>{const v=o.current;if(!v)return;s.current=v.getContext("2d");const T=()=>{v&&s.current&&(v.width=window.innerWidth,v.height=window.innerHeight,$c(s.current,l.current,d.current,[],{width:v.width,height:v.height},!0))};return T(),window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]),Pe.useEffect(()=>{const v=()=>{const A=Gv(l.current);if(A.length>0){const E=Math.floor(Math.random()*A.length);u.current=A[E].id}};v();const T=setInterval(v,ZE);return()=>clearInterval(T)},[]);const[y,I]=pv(v=>{var E,C;if(!s.current)return;if(c.current===void 0){c.current=v;return}const T=Math.min((v-c.current)/1e3,1);l.current=pu(l.current,T);const A=u.current?l.current.entities.entities[u.current]:void 0;if(A){const{mapDimensions:_}=l.current,{width:w,height:R}=_;let N={...A.position};const D=N.x-d.current.x;Math.abs(D)>w/2&&(D>0?N.x-=w:N.x+=w);const B=N.y-d.current.y;Math.abs(B)>R/2&&(B>0?N.y-=R:N.y+=R);let G=wc(d.current,N,Mc*T);G={x:(G.x%w+w)%w,y:(G.y%R+R)%R},d.current=G}$c(s.current,l.current,d.current,[],{width:((E=o.current)==null?void 0:E.width)||800,height:((C=o.current)==null?void 0:C.height)||600},!0),c.current=v});return Pe.useEffect(()=>(I(),y),[I,y]),ke.jsxs(ib,{children:[ke.jsx(ob,{ref:o}),ke.jsxs(rb,{children:[ke.jsx(sb,{children:"Tribe2"}),ke.jsxs(ab,{children:[ke.jsx(Oy,{onClick:h,children:"New Game"}),t&&ke.jsx(Oy,{onClick:g,children:"Load Game"})]}),ke.jsxs(lb,{children:["by"," ",ke.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function cb(){console.log("Tribe game initialized with detailed 2D world state.");const e=VM();return e.ecosystem={preyGestationPeriod:Xo,preyProcreationCooldown:Vo,predatorGestationPeriod:qo,predatorProcreationCooldown:Zo,preyHungerIncreasePerHour:uo,predatorHungerIncreasePerHour:fo,berryBushSpreadChance:Di},e.debugPanel=Ye.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const ub=({canvasRef:e,ctxRef:t,gameStateRef:i,viewportCenterRef:o,playerActionHintsRef:s})=>(Pe.useEffect(()=>{const l=e.current;if(!l)return;t.current=l.getContext("2d");const c=()=>{l&&t.current&&i.current&&(l.width=window.innerWidth,l.height=window.innerHeight,$c(t.current,i.current,o.current,s.current,{width:l.width,height:l.height},!1))};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),ke.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),db=(e,t,i,o=!1)=>{var c,d;let s;const l=d_(e,i);if(l){if(t.isAdult&&l.type==="berryBush"&&l.food.length>0)s={action:ue.AutopilotGather,targetEntityId:l.id};else if(t.isAdult&&l.type==="corpse"&&l.food.length>0)s={action:ue.AutopilotGather,targetEntityId:l.id};else if(l.type==="human"){const u=l;t.isAdult&&Ga(t,u,i)?s={action:ue.AutopilotAttack,targetEntityId:u.id}:ls(t,u,i)?s={action:ue.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:ue.AutopilotFeedChild,targetEntityId:u.id})}else if(l.type==="prey")s={action:ue.AutopilotAttack,targetEntityId:l.id};else if(l.type==="predator")s={action:ue.AutopilotAttack,targetEntityId:l.id};else if(l.type==="building"){const u=l;if(i.selectedBuildingType==="removal")t.leaderId===t.id&&tr(t,u,i)&&u.isConstructed?s={action:ue.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:ue.Removal,position:l.position};else if(t.leaderId===t.id&&tr(t,u,i)&&u.isConstructed)Hv(u.position,es,t.id,i).valid?s={action:ue.TakeOverBuilding,targetEntityId:u.id}:s={action:ue.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const h=u.ownerId===t.leaderId,g=u.storedItems.length>0,y=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(o&&u.isConstructed&&g&&t.food.length<t.maxFood)if(h)s={action:ue.AutopilotRetrieve,targetEntityId:l.id};else{const I=t.leaderId?i.entities.entities[t.leaderId]:void 0;I&&((c=I.tribeControl)!=null&&c.diplomacy)?(u.ownerId&&I.tribeControl.diplomacy[u.ownerId])===It.Hostile?s={action:ue.AutopilotGather,targetEntityId:l.id}:s={action:ue.AutopilotMove,position:e}:s={action:ue.AutopilotMove,position:e}}else h&&u.isConstructed?(t.food.length>0||t.heldItem)&&y?s={action:ue.AutopilotDeposit,targetEntityId:l.id}:t.food.length<t.maxFood&&g?s={action:ue.AutopilotRetrieve,targetEntityId:l.id}:s={action:ue.AutopilotMove,position:e}:s={action:ue.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(h=>h.type===qn.Berry).length>=Jo&&!Ni(e,i,Zc)&&!ir(i.soilDepletion,e,i.mapDimensions.width,i.mapDimensions.height)?s={action:ue.AutopilotPlant,position:e}:u.buildingType===de.Bonfire&&((d=t.heldItem)==null?void 0:d.type)===kt.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:ue.AutopilotDeposit,targetEntityId:u.id}:s={action:ue.AutopilotMove,position:e}}else if(l.type==="tree"){const u=l,[h]=u.stateMachine??[],g=h===zn||h===bn||h===ui;t.isAdult&&!t.heldItem&&g?s={action:ue.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&h===Yt&&u.wood.length>0?s={action:ue.AutopilotGather,targetEntityId:u.id}:s={action:ue.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===qn.Berry).length>=Jo&&(i.autopilotControls.isManuallyPlanting||xa(e,i,t))&&!ir(i.soilDepletion,e,i.mapDimensions.width,i.mapDimensions.height)?s={action:ue.AutopilotPlant,position:e}:s={action:ue.AutopilotMove,position:e};return s},fb=(e,t)=>{if(e.isPaused)return;const i=At(e);if(!i)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,l=z(i.position,t,e.mapDimensions.width,e.mapDimensions.height),c=100;l<=c?Oa(t,s,i.leaderId,e,i.position,c)&&(bh(t,s,i.leaderId,e),e.selectedBuildingType=null):Oa(t,s,i.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:ue.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=E_(t,e);s&&nh(s.id,e);return}const o=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,o?(e.autopilotControls.activeAutopilotAction=o,(o.action===ue.AutopilotMove||o.action===ue.AutopilotGather||o.action===ue.AutopilotChop)&&(e.hasPlayerMovedEver=!0),o.action===ue.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:ue.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},hb=(e,t)=>{var c,d,u,h,g,y;const i=e.key.toLowerCase(),o=e.ctrlKey||e.metaKey;let s=!0,l=t;if(o){switch(i){case"s":ph(t);break;default:s=!1;break}return{newState:l,handled:s}}switch(i){case"escape":const{autopilotControls:I}=t;I.activeAutopilotAction||I.isManuallyMoving||I.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(I.activeAutopilotAction=void 0,I.isManuallyMoving=!1,I.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):l.exitConfirmation==="pending"?(l.exitConfirmation="inactive",l.isPaused=!1):(l.exitConfirmation="pending",l.isPaused=!0);break;case"m":t.isMuted=!t.isMuted,va(t.masterVolume,t.isMuted);break;case"=":case"+":const v=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(v.toFixed(1)),va(t.masterVolume,t.isMuted);break;case"-":const T=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(T.toFixed(1)),va(t.masterVolume,t.isMuted);break;case"t":l=pu(t,hI);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":l.debugPanel===Ye.General?(l.debugPanel=Ye.None,l.debugCharacterId=void 0):(l.debugPanel=Ye.General,l.debugCharacterId||(l.debugCharacterId=((c=At(l))==null?void 0:c.id)??((d=Object.values(l.entities.entities).find(A=>A.type==="human"||A.type==="prey"||A.type==="predator"))==null?void 0:d.id)));break;case"!":if(e.shiftKey){if(l.debugPanel===Ye.Ecosystem){l.debugPanel=Ye.None;break}l.debugPanel=Ye.Ecosystem,l.debugCharacterId||(l.debugCharacterId=((u=At(l))==null?void 0:u.id)??((h=Object.values(l.entities.entities).find(A=>A.type==="human"||A.type==="prey"||A.type==="predator"))==null?void 0:h.id))}else s=!1;break;case"#":if(e.shiftKey){if(l.debugPanel===Ye.Tribe){l.debugPanel=Ye.None;break}l.debugPanel=Ye.Tribe,(!l.debugCharacterId||!l.entities.entities[l.debugCharacterId])&&(l.debugCharacterId=((g=At(l))==null?void 0:g.id)??((y=l.search.human.all().find(A=>A.leaderId===A.id))==null?void 0:y.id))}else s=!1;break;case"@":if(e.shiftKey){if(l.debugPanel===Ye.Performance){l.debugPanel=Ye.None;break}l.debugPanel=Ye.Performance}else s=!1;break;case"tab":if(l.debugPanel!==Ye.General&&l.debugPanel!==Ye.Tribe&&(l.debugPanel=Ye.General),l.debugPanel===Ye.General){const A=Object.values(l.entities.entities).filter(E=>E.type==="human"||E.type==="prey"||E.type==="predator");if(A.length>0){const E=A.sort((R,N)=>{if(R.type==="human"&&R.isPlayer)return-1;if(N.type==="human"&&N.isPlayer)return 1;if(R.type!==N.type){const D={human:0,prey:1,predator:2},B=D[R.type]??999,G=D[N.type]??999;return B-G}return R.id-N.id}),C=l.debugCharacterId,w=((C?E.findIndex(R=>R.id===C):-1)+1)%E.length;l.debugCharacterId=E[w].id}else l.debugCharacterId=void 0}else if(l.debugPanel===Ye.Tribe){const A=l.search.human.all().filter(C=>C.leaderId===C.id);let E=A.findIndex(C=>C.id===l.debugCharacterId)+1;(E===-1||E>A.length-1)&&(E=0),l.debugCharacterId=A[E].id}else l.debugPanel=Ye.None,l.debugCharacterId=void 0;break;default:s=!1;break}return{newState:l,handled:s}},pb=(e,t,i,o,s)=>{var c;const l={gameState:i};if(t&&["e","b","r","h","c"].includes(e)&&i.hasPlayerEnabledAutopilot++,i.buildMenuOpen){if(e==="1"){i.selectedBuildingType="storageSpot",we(l,Ie.ButtonClick,o.position);return}else if(e==="2"){i.selectedBuildingType="plantingZone",we(l,Ie.ButtonClick,o.position);return}else if(e==="4"){i.selectedBuildingType="bonfire",we(l,Ie.ButtonClick,o.position);return}else if(e==="5"){i.selectedBuildingType="borderPost",we(l,Ie.ButtonClick,o.position);return}else if(e==="6"){i.selectedBuildingType="removal",we(l,Ie.ButtonClick,o.position);return}}if(e==="escape"&&i.selectedBuildingType){i.selectedBuildingType=null;return}if(e==="e"){if(t){i.autopilotControls.behaviors.gathering=!i.autopilotControls.behaviors.gathering;return}const d=je(o,i,"berryBush",Xe,g=>g.food.length>0&&o.food.length<o.maxFood),u=je(o,i,"corpse",Xe,g=>g.food.length>0&&o.food.length<o.maxFood);let h=null;d&&u?h=z(o.position,d.position,i.mapDimensions.width,i.mapDimensions.height)<=z(o.position,u.position,i.mapDimensions.width,i.mapDimensions.height)?d:u:h=d||u,h&&(o.activeAction="gathering",we(l,Ie.Gather,o.position))}else if(e==="r"){if(t){i.autopilotControls.behaviors.procreation=!i.autopilotControls.behaviors.procreation;return}je(o,i,"human",Xe,u=>ls(o,u,i))&&(o.activeAction="procreating",we(l,Ie.Procreate,o.position))}else if(e==="f")o.food.length>0&&(o.activeAction="eating",we(l,Ie.Eat,o.position));else if(e==="h"){if(t){i.autopilotControls.behaviors.feedChildren=!i.autopilotControls.behaviors.feedChildren;return}const d=s.find(u=>u.type===ue.FeedChild);d&&d.targetEntity&&(o.activeAction="feeding",o.target=d.targetEntity.id)}else if(e==="arrowup"||e==="w")o.direction.y=-1,o.activeAction="moving",o.target=void 0,i.hasPlayerMovedEver=!0,i.autopilotControls.isManuallyMoving=!0,i.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")o.direction.y=1,o.activeAction="moving",o.target=void 0,i.hasPlayerMovedEver=!0,i.autopilotControls.isManuallyMoving=!0,i.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")o.direction.x=-1,o.activeAction="moving",o.target=void 0,i.hasPlayerMovedEver=!0,i.autopilotControls.isManuallyMoving=!0,i.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")o.direction.x=1,o.activeAction="moving",o.target=void 0,i.hasPlayerMovedEver=!0,i.autopilotControls.isManuallyMoving=!0,i.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){i.autopilotControls.behaviors.attack=!i.autopilotControls.behaviors.attack;return}const d=je(o,i,"human",un,u=>Ga(o,u,i))??je(o,i,"predator",un)??je(o,i,"prey",un);d&&(o.activeAction="attacking",o.attackTargetId=d.id)}else if(e==="b"){if(t){i.autopilotControls.behaviors.planting=!i.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===ue.Plant)){const u=Yw(o.position,i,50,Kf);u&&(o.activeAction="planting",o.target=u,i.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){i.autopilotControls.behaviors.gathering=!i.autopilotControls.behaviors.gathering;return}const d=je(o,i,"building",Vn,h=>{const g=h;return g.buildingType===de.Bonfire&&g.isConstructed&&g.storedItems.length<(g.storageCapacity||0)});if(((c=o.heldItem)==null?void 0:c.type)===kt.Wood&&d){o.activeAction="depositing",o.target=d.id,we(l,Ie.StorageDeposit,o.position);return}const u=je(o,i,"building",Vn,h=>{const g=h;return g.buildingType===de.StorageSpot&&g.ownerId===o.leaderId&&g.isConstructed&&g.storageCapacity!==void 0&&g.storedItems.length<g.storageCapacity});u&&(o.activeAction="idle",o.target=u.id,we(l,Ie.StorageDeposit,o.position))}else if(e==="z"){if(t){i.autopilotControls.behaviors.feedChildren=!i.autopilotControls.behaviors.feedChildren;return}const d=je(o,i,"building",Vn,u=>{const h=u;return h.buildingType==="storageSpot"&&h.ownerId===o.leaderId&&h.isConstructed&&h.storedItems.length>0});d&&(o.activeAction="idle",o.target=d.id,we(l,Ie.StorageRetrieve,o.position))}else if(e==="k")AI(o,i);else if(e==="l"){if(t){i.autopilotControls.behaviors.build=!i.autopilotControls.behaviors.build;return}i.buildMenuOpen=!i.buildMenuOpen,we(l,Ie.ButtonClick,o.position)}else if(e==="c"){if(t){i.autopilotControls.behaviors.chopping=!i.autopilotControls.behaviors.chopping;return}const d=je(o,i,"tree",Qc,u=>u.wood&&u.wood.length>0&&!o.heldItem);d&&(o.activeAction="chopping",o.target=d.id)}},gb=(e,t,i,o)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!o.current.has("arrowup")&&!o.current.has("arrowdown")&&!o.current.has("arrowleft")&&!o.current.has("arrowright")&&!o.current.has("w")&&!o.current.has("a")&&!o.current.has("s")&&!o.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),i.autopilotControls.isManuallyMoving=!1),!o.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!o.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!o.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!o.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!o.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},mb=(e,t,i)=>{const{mapDimensions:o}=e,{width:s,height:l}=o;if(!e.cameraFollowingPlayer){if(e.cameraTargetPosition){const u=ze(t,e.cameraTargetPosition,s,l);if(go(u)<1){const I=e.cameraTargetPosition;return e.cameraTargetPosition=void 0,I}const g=li(t,u);let y=wc(t,g,Mc*i);return y={x:(y.x%s+s)%s,y:(y.y%l+l)%l},y}return t}let d=At(e);if(e.debugCharacterId){const u=e.entities.entities[e.debugCharacterId];u&&"position"in u&&(d=u)}if(d){let u={...d.position};const h=u.x-t.x;Math.abs(h)>s/2&&(h>0?u.x-=s:u.x+=s);const g=u.y-t.y;Math.abs(g)>l/2&&(g>0?u.y-=l:u.y+=l);let y=wc(t,u,Mc*i);return y={x:(y.x%s+s)%s,y:(y.y%l+l)%l},y}return e.viewportCenter};function yb(e,t){const{width:i,height:o}=e.mapDimensions;e.cameraTargetPosition=void 0,e.viewportCenter={x:(t.x%i+i)%i,y:(t.y%o+o)%o}}const vb=(e,t,i,o)=>{var u,h;const s={gameState:i},l=At(i);l&&we(s,Ie.ButtonClick,l.position);const c=i.uiButtons.find(g=>g.id===e.id);c&&(c.lastActivated=Date.now()),t&&[me.CommandGather,me.CommandPlant,me.ToggleProcreationBehavior,me.CommandBuild].includes(e.action)&&i.hasPlayerEnabledAutopilot++;const{behaviors:d}=i.autopilotControls;switch(e.action){case me.ReturnToIntro:i.exitConfirmation="pending",i.isPaused=!0;break;case me.ConfirmExitYes:o(),i.exitConfirmation="inactive";break;case me.ConfirmExitNo:i.exitConfirmation="inactive",i.isPaused=!1;break;case me.ToggleMute:i.isMuted=!i.isMuted,va(i.masterVolume,i.isMuted);break;case me.TogglePause:i.isPaused=!i.isPaused;break;case me.FastForward:return pu(i,hI);case me.DismissTutorial:i.tutorialState.isActive=!1;break;case me.CommandEat:l&&l.food.length>0&&(l.activeAction="eating");break;case me.CommandGather:t?d.gathering=!d.gathering:l&&(l.activeAction="gathering");break;case me.CommandPlant:t?d.planting=!d.planting:l&&(i.autopilotControls.isManuallyPlanting=!0);break;case me.ToggleProcreationBehavior:d.procreation=!d.procreation;break;case me.ToggleAttackBehavior:d.attack=!d.attack;break;case me.ToggleFeedChildBehavior:d.feedChildren=!d.feedChildren;break;case me.CommandTribeSplit:l&&AI(l,i);break;case me.CommandBuild:t?d.build=!d.build:i.buildMenuOpen=!i.buildMenuOpen;break;case me.SelectStorageSpot:i.selectedBuildingType="storageSpot";break;case me.SelectPlantingZone:i.selectedBuildingType="plantingZone";break;case me.SelectRemovalTool:i.selectedBuildingType="removal";break;case me.SelectBorderPost:i.selectedBuildingType="borderPost";break;case me.SelectBonfire:i.selectedBuildingType="bonfire";break;case me.ToggleDiplomacy:if(l&&l.leaderId&&e.targetTribeId){const g=l.leaderId,y=e.targetTribeId,I=i.entities.entities[y],v=(u=l.tribeControl)==null?void 0:u.diplomacy,T=(h=I==null?void 0:I.tribeControl)==null?void 0:h.diplomacy;if(v&&T){const E=(v[y]||It.Friendly)===It.Friendly?It.Hostile:It.Friendly;v[y]=E,T[g]=E}}break;case me.OpenTribeModal:i.tribeModalOpen=!0;break;case me.RecenterCamera:i.cameraFollowingPlayer=!0;break;case me.CloseTribeModal:i.tribeModalOpen=!1;break}return i};function Ib(e,t,i){if(!e.notificationButtonRects)return!1;const o=At(e);for(const[s,l]of Object.entries(e.notificationButtonRects.dismiss))if(t>=l.x&&t<=l.x+l.width&&i>=l.y&&i<=l.y+l.height)return xw(e,s),o&&we({gameState:e},Ie.ButtonClick,o.position),!0;for(const[s,l]of Object.entries(e.notificationButtonRects.view))if(t>=l.x&&t<=l.x+l.width&&i>=l.y&&i<=l.y+l.height){const c=e.notifications.find(d=>d.id===s);if(c){let d=c.targetPosition;if(!d&&c.targetEntityIds&&c.targetEntityIds.length>0){const u=e.entities.entities[c.targetEntityIds[0]];u&&(d=u.position)}return d&&yb(e,d),o&&we({gameState:e},Ie.ButtonClick,o.position),c.highlightedEntityIds&&(c.renderHighlights=!c.renderHighlights),!0}}return!1}function gS(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const Sb=(e,t)=>{var i;if(t.debugPanel!==Ye.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(gS(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,l=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.height)??0)-s);return t.debugPanelScroll.y>l&&(t.debugPanelScroll.y=l),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},Ab=(e,t)=>t.debugPanel!==Ye.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:gS(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Ny=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},Tb=(e,t)=>{var i,o;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,l=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.width)??0)-s);t.debugPanelScroll.x>l&&(t.debugPanelScroll.x=l);const c=t.debugPanelRect.height-60,d=Math.max(0,(((o=t.debugPanelContentSize)==null?void 0:o.height)??0)-c);return t.debugPanelScroll.y>d&&(t.debugPanelScroll.y=d),{newState:t,handled:!0}}return{newState:t,handled:!1}};function Eb(e,t,i){if(!i.minimapRect)return;const{x:o,y:s,width:l,height:c}=i.minimapRect;e>=o&&e<=o+l&&t>=s&&t<=s+c&&(i.isDraggingMinimap=!0,i.minimapDragDistance=0)}function wb(e,t,i,o){i.isDraggingMinimap&&(i.isDraggingMinimap=!1,i.minimapDragDistance<5&&Cb(e,t,i,o,!1))}function _b(e,t,i,o,s){if(!i.minimapRect){i.hoveredMinimapTribeId=null;return}if(i.isDraggingMinimap){if(o){i.minimapDragDistance+=Math.sqrt(o.x*o.x+o.y*o.y),i.cameraFollowingPlayer=!1,i.cameraTargetPosition=void 0;const{width:c,height:d}=i.mapDimensions,{width:u,height:h}=i.minimapRect,g=o.x/u*c,y=o.y/h*d,I=i.viewportCenter.x-g,v=i.viewportCenter.y-y,T={x:(I%c+c)%c,y:(v%d+d)%d};i.viewportCenter=T,s&&(s.current=T)}return}const l=mS(e,t,i.minimapRect,i);l?i.hoveredMinimapTribeId=Xn(l.x,l.y,i):i.hoveredMinimapTribeId=null}function Cb(e,t,i,o,s=!1){if(!i.minimapRect)return;const l=mS(e,t,i.minimapRect,i);l&&(i.cameraFollowingPlayer=!1,s?(i.viewportCenter=l,i.cameraTargetPosition=void 0,o&&(o.current=l)):i.cameraTargetPosition=l)}function Pb(e,t,i,o,s){if(!o.minimapRect)return!1;const{x:l,y:c,width:d,height:u}=o.minimapRect;if(t>=l&&t<=l+d&&i>=c&&i<=c+u){o.cameraFollowingPlayer=!1,o.cameraTargetPosition=void 0;const{width:h,height:g}=o.mapDimensions,y=e.deltaX/d*h,I=e.deltaY/u*g,v=o.viewportCenter.x+y,T=o.viewportCenter.y+I,A={x:(v%h+h)%h,y:(T%g+g)%g};return o.viewportCenter=A,s&&(s.current=A),!0}return!1}function mS(e,t,i,o){const s=e-i.x,l=t-i.y;if(s<0||s>i.width||l<0||l>i.height)return null;const{width:c,height:d}=o.mapDimensions,u=i.width/2,h=i.height/2,g=s-u,y=l-h,I=g/i.width*c,v=y/i.height*d,T=o.viewportCenter.x+I,A=o.viewportCenter.y+v;return{x:(T%c+c)%c,y:(A%d+d)%d}}function Rb(e,t,i){t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,l=t.viewportCenter.x+e.deltaX,c=t.viewportCenter.y+e.deltaY,d={x:(l%o+o)%o,y:(c%s+s)%s};return t.viewportCenter=d,i.current=d,!0}function Mb(e,t){(e.button===1||e.button===2)&&(t.isDraggingViewport=!0,t.viewportDragButton=e.button,t.viewportDragDistance=0)}function kb(e,t,i){if(t.isDraggingViewport){t.viewportDragDistance+=Math.sqrt(e.movementX*e.movementX+e.movementY*e.movementY),t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,l=t.viewportCenter.x-e.movementX,c=t.viewportCenter.y-e.movementY,d={x:(l%o+o)%o,y:(c%s+s)%s};t.viewportCenter=d,i.current=d}}function Db(e,t){t.isDraggingViewport&&e.button===t.viewportDragButton&&(t.isDraggingViewport=!1,t.viewportDragButton=null)}const Ob=({isActive:e,gameStateRef:t,canvasRef:i,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:l,returnToIntro:c})=>(Pe.useEffect(()=>{const d=u=>{if(!e()||t.current.gameOver||!i.current)return;const h=i.current.getBoundingClientRect(),g=u.clientX-h.left,y=u.clientY-h.top;if(Pb(u,g,y,t.current,o)){u.preventDefault();return}const I=Sb(u,t.current);t.current=I.newState,!I.handled&&Rb(u,t.current,o)&&u.preventDefault()};return window.addEventListener("wheel",d,{passive:!1}),()=>{window.removeEventListener("wheel",d)}},[e,i,t,o]),Pe.useEffect(()=>{const d=h=>{if(!e()||t.current.gameOver||!i.current||!h.target||h.target!==i.current)return;const g=i.current.getBoundingClientRect(),y=h.clientX-g.left,I=h.clientY-g.top;if(Ib(t.current,y,I))return;const T=t.current.uiButtons.find(_=>y>=_.rect.x&&y<=_.rect.x+_.rect.width&&I>=_.rect.y&&I<=_.rect.y+_.rect.height);if(T){t.current=vb(T,h.shiftKey,t.current,c);return}const A=t.current.minimapRect;if(A&&y>=A.x&&y<=A.x+A.width&&I>=A.y&&I<=A.y+A.height){Eb(y,I,t.current);return}const E=Ab(h,t.current);if(t.current=E.newState,E.handled)return;Mb(h,t.current);const C=lh({x:y,y:I},o.current,{width:i.current.width,height:i.current.height},t.current.mapDimensions);fb(t.current,C)},u=h=>{if(!e()||!i.current)return;const g=i.current.getBoundingClientRect(),y=h.clientX-g.left,I=h.clientY-g.top;wb(y,I,t.current,o),Db(h,t.current);const v=Ny(h,t.current);t.current=v.newState};return window.addEventListener("mousedown",d),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("mouseup",u)}},[e,i,t,o,c]),Pe.useEffect(()=>{const d=u=>{if(!e()||!i.current)return;const h=Tb(u,t.current);if(t.current=h.newState,h.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const C=Ny(u,t.current);t.current=C.newState}const g=i.current.getBoundingClientRect(),y=u.clientX-g.left,I=u.clientY-g.top;kb(u,t.current,o),t.current.mousePosition={x:y,y:I};let v;if(t.current.notificationButtonRects){for(const[C,_]of Object.entries(t.current.notificationButtonRects.dismiss))if(y>=_.x&&y<=_.x+_.width&&I>=_.y&&I<=_.y+_.height){v=`notification-dismiss-${C}`;break}if(!v){for(const[C,_]of Object.entries(t.current.notificationButtonRects.view))if(y>=_.x&&y<=_.x+_.width&&I>=_.y&&I<=_.y+_.height){v=`notification-view-${C}`;break}}}if(!v)for(let C=t.current.uiButtons.length-1;C>=0;C--){const _=t.current.uiButtons[C];if(y>=_.rect.x&&y<=_.rect.x+_.rect.width&&I>=_.rect.y&&I<=_.rect.y+_.rect.height){v=_.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0,t.current.hoveredMinimapTribeId=null;return}const T=t.current.minimapRect,A=t.current.isDraggingMinimap;if(T&&y>=T.x&&y<=T.x+T.width&&I>=T.y&&I<=T.y+T.height||A){_b(y,I,t.current,{x:u.movementX,y:u.movementY},o),t.current.autopilotControls.hoveredAutopilotAction=void 0;return}else t.current.hoveredMinimapTribeId=null;const E=At(t.current);if(E){const C=lh({x:y,y:I},o.current,{width:i.current.width,height:i.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=db(C,E,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}},[e,i,t,o]),Pe.useEffect(()=>{const d=h=>{if(!e()||t.current.gameOver)return;const g=h.key.toLowerCase();(g===" "||g==="p"||g==="tab"||(h.ctrlKey||h.metaKey)&&(g==="s"||g==="a"))&&h.preventDefault();const y=hb(h,t.current);if(t.current=y.newState,y.handled)return;const I=At(t.current);I&&(l.current.add(g),pb(g,h.shiftKey,t.current,I,s.current))},u=h=>{if(!e()||t.current.gameOver)return;const g=h.key.toLowerCase();l.current.delete(g);const y=At(t.current);y&&gb(g,y,t.current,l)};return window.addEventListener("keydown",d),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}},[e,t,s,l,c]),Pe.useEffect(()=>{const d=i.current;if(!d)return;const u=h=>{e()&&h.preventDefault()};return d.addEventListener("contextmenu",u),()=>{d.removeEventListener("contextmenu",u)}},[i,e]),null),bb=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:i,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:l,canvasRef:c,setAppState:d,appState:u})=>{const h=Pe.useRef(),{returnToIntro:g}=rr(),[y,I,v]=pv(T=>{var R,N;if(!t.current||!h.current){h.current=T;return}const A=Math.min(T-h.current,1e3)/1e3,{performanceMetrics:E}=e.current;E.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const C=performance.now();e.current=pu(e.current,A),E.currentBucket.worldUpdateTime=performance.now()-C;const _=At(e.current);_?s.current=Yh(e.current,_):s.current=[],(e.current.viewportCenter.x!==o.current.x||e.current.viewportCenter.y!==o.current.y)&&(o.current=e.current.viewportCenter),o.current=mb(e.current,o.current,A),e.current.viewportCenter=o.current;const w=performance.now();$c(t.current,e.current,o.current,s.current,{width:((R=c.current)==null?void 0:R.width)||800,height:((N=c.current)==null?void 0:N.height)||600},!1),E.currentBucket.renderTime=performance.now()-w,E.history.push({bucketTime:e.current.time,...E.currentBucket}),E.history.length>KE&&E.history.shift(),h.current=T,e.current.gameOver&&u!=="gameOver"&&(xh(Ie.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),d("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return Pe.useEffect(()=>(I(),y),[I,y]),ke.jsx(Ob,{isActive:v,gameStateRef:e,canvasRef:c,viewportCenterRef:o,playerActionHintsRef:s,debugPanelTypeRef:i,keysPressed:l,returnToIntro:g})},By=()=>{const{savedGameState:e,contextReady:t}=rr(),[i,o]=Pe.useState(null);return Pe.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),o(e)):(console.log("Initializing new game state..."),o(cb())))},[t,e]),!t||!i?ke.jsx("div",{children:"Loading..."}):ke.jsx(Nb,{initialState:i})},Nb=({initialState:e})=>{const t=Pe.useRef(null),i=Pe.useRef(null),o=Pe.useRef(e),s=Pe.useRef(new Set),l=Pe.useRef(e.debugPanel),c=Pe.useRef(e.viewportCenter),d=Pe.useRef([]),{appState:u,setAppState:h}=rr();return ke.jsxs(ke.Fragment,{children:[ke.jsx(ub,{canvasRef:t,ctxRef:i,gameStateRef:o,debugPanelTypeRef:l,viewportCenterRef:c,playerActionHintsRef:d}),ke.jsx(bb,{gameStateRef:o,ctxRef:i,debugPanelTypeRef:l,viewportCenterRef:c,playerActionHintsRef:d,keysPressed:s,canvasRef:t,setAppState:h,appState:u})]})},Bb=Tt.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,Hb=Tt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,gc=Tt.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,Fb=Tt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,Lb=()=>{const{setAppState:e,gameOverDetails:t}=rr(),i=()=>{e("intro")};return ke.jsxs(Bb,{children:[ke.jsx(Hb,{children:"Game Over"}),ke.jsx(gc,{children:"Your tribe's lineage has ended."}),t&&ke.jsxs(ke.Fragment,{children:[ke.jsxs(gc,{children:["Generations Survived: ",t.generations]}),ke.jsxs(gc,{children:["Cause of Extinction: ",t.cause]})]}),!t&&ke.jsx(gc,{children:"Game details are unavailable."}),ke.jsx(Fb,{onClick:i,children:"Return to Menu"})]})},Ub=Tt.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,Gb=Tt.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,xb=Tt.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,$b=Tt.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,Wb=Tt.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,yS=Tt.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,Yb=Tt(yS)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,sa=800,aa=600,zb=()=>{const{returnToIntro:e}=rr(),t=Pe.useRef(null),i=Pe.useRef(),o=Pe.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:sa,height:aa}}),s=c=>{const d={x:sa/2,y:aa/2};let u;c===ye.StoneProjectile&&(u={x:d.x+200*(Math.random()-Math.random()),y:d.y+200*(Math.random()-Math.random())}),be(o.current,c,d,1,void 0,u)};Pe.useEffect(()=>{const c=()=>{o.current.time+=.016,tS(o.current);const u=t.current,h=u==null?void 0:u.getContext("2d");h&&(h.clearRect(0,0,sa,aa),h.fillStyle="#2c5234",h.fillRect(0,0,sa,aa),o.current.visualEffects.forEach(g=>{hS(h,g,o.current.time,o.current)})),i.current=requestAnimationFrame(c)};return i.current=requestAnimationFrame(c),()=>{i.current&&cancelAnimationFrame(i.current)}},[]);const l=Object.keys(ye).filter(c=>isNaN(Number(c))).map(c=>({name:c,value:ye[c]}));return ke.jsxs(Ub,{children:[ke.jsxs(Gb,{children:[ke.jsx(Wb,{children:"Visual Effects"}),l.map(c=>ke.jsx(yS,{onClick:()=>s(c.value),children:c.name},c.name)),ke.jsx(Yb,{onClick:e,children:"Back to Intro"})]}),ke.jsxs(xb,{children:[ke.jsx($b,{ref:t,width:sa,height:aa}),ke.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},jb=YE`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function Xb(e,t){Pe.useEffect(()=>{const i=()=>{const o=document.location.hash;t(o==="#game"?"game":o==="#effects"?"effects":"intro")};return window.addEventListener("hashchange",i),i(),()=>{window.removeEventListener("hashchange",i)}},[]),Pe.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const Vb=()=>{const{appState:e,setAppState:t}=rr();Xb(e,t);const i=()=>{switch(e){case"intro":return ke.jsx(by,{});case"game":return ke.jsx(By,{});case"effects":return ke.jsx(zb,{});case"gameOver":return ke.jsxs(ke.Fragment,{children:[ke.jsx(By,{}),ke.jsx(Lb,{})]});default:return ke.jsx(by,{})}};return ke.jsxs(ke.Fragment,{children:[ke.jsx(jb,{}),i()]})},Hy=document.getElementById("root");Hy?nC().then(()=>{_T.createRoot(Hy).render(ke.jsx(ai.StrictMode,{children:ke.jsx(WT,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:ke.jsx(Vb,{})})}))}):console.error("Failed to find the root element");
