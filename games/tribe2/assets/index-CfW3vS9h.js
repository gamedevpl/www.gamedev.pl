var NA=Object.defineProperty;var BA=(e,t,n)=>t in e?NA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Ht=(e,t,n)=>BA(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function Jy(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var vf={exports:{}},na={},Sf={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i0;function HA(){if(i0)return He;i0=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.iterator;function S(O){return O===null||typeof O!="object"?null:(O=y&&O[y]||O["@@iterator"],typeof O=="function"?O:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,I={};function E(O,x,ae){this.props=O,this.context=x,this.refs=I,this.updater=ae||v}E.prototype.isReactComponent={},E.prototype.setState=function(O,x){if(typeof O!="object"&&typeof O!="function"&&O!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,O,x,"setState")},E.prototype.forceUpdate=function(O){this.updater.enqueueForceUpdate(this,O,"forceUpdate")};function _(){}_.prototype=E.prototype;function w(O,x,ae){this.props=O,this.context=x,this.refs=I,this.updater=ae||v}var P=w.prototype=new _;P.constructor=w,A(P,E.prototype),P.isPureReactComponent=!0;var R=Array.isArray,C=Object.prototype.hasOwnProperty,k={current:null},D={key:!0,ref:!0,__self:!0,__source:!0};function F(O,x,ae){var ue,Me={},le=null,Ee=null;if(x!=null)for(ue in x.ref!==void 0&&(Ee=x.ref),x.key!==void 0&&(le=""+x.key),x)C.call(x,ue)&&!D.hasOwnProperty(ue)&&(Me[ue]=x[ue]);var _e=arguments.length-2;if(_e===1)Me.children=ae;else if(1<_e){for(var se=Array(_e),pe=0;pe<_e;pe++)se[pe]=arguments[pe+2];Me.children=se}if(O&&O.defaultProps)for(ue in _e=O.defaultProps,_e)Me[ue]===void 0&&(Me[ue]=_e[ue]);return{$$typeof:e,type:O,key:le,ref:Ee,props:Me,_owner:k.current}}function W(O,x){return{$$typeof:e,type:O.type,key:x,ref:O.ref,props:O.props,_owner:O._owner}}function Y(O){return typeof O=="object"&&O!==null&&O.$$typeof===e}function G(O){var x={"=":"=0",":":"=2"};return"$"+O.replace(/[=:]/g,function(ae){return x[ae]})}var j=/\/+/g;function ee(O,x){return typeof O=="object"&&O!==null&&O.key!=null?G(""+O.key):x.toString(36)}function V(O,x,ae,ue,Me){var le=typeof O;(le==="undefined"||le==="boolean")&&(O=null);var Ee=!1;if(O===null)Ee=!0;else switch(le){case"string":case"number":Ee=!0;break;case"object":switch(O.$$typeof){case e:case t:Ee=!0}}if(Ee)return Ee=O,Me=Me(Ee),O=ue===""?"."+ee(Ee,0):ue,R(Me)?(ae="",O!=null&&(ae=O.replace(j,"$&/")+"/"),V(Me,x,ae,"",function(pe){return pe})):Me!=null&&(Y(Me)&&(Me=W(Me,ae+(!Me.key||Ee&&Ee.key===Me.key?"":(""+Me.key).replace(j,"$&/")+"/")+O)),x.push(Me)),1;if(Ee=0,ue=ue===""?".":ue+":",R(O))for(var _e=0;_e<O.length;_e++){le=O[_e];var se=ue+ee(le,_e);Ee+=V(le,x,ae,se,Me)}else if(se=S(O),typeof se=="function")for(O=se.call(O),_e=0;!(le=O.next()).done;)le=le.value,se=ue+ee(le,_e++),Ee+=V(le,x,ae,se,Me);else if(le==="object")throw x=String(O),Error("Objects are not valid as a React child (found: "+(x==="[object Object]"?"object with keys {"+Object.keys(O).join(", ")+"}":x)+"). If you meant to render a collection of children, use an array instead.");return Ee}function te(O,x,ae){if(O==null)return O;var ue=[],Me=0;return V(O,ue,"","",function(le){return x.call(ae,le,Me++)}),ue}function re(O){if(O._status===-1){var x=O._result;x=x(),x.then(function(ae){(O._status===0||O._status===-1)&&(O._status=1,O._result=ae)},function(ae){(O._status===0||O._status===-1)&&(O._status=2,O._result=ae)}),O._status===-1&&(O._status=0,O._result=x)}if(O._status===1)return O._result.default;throw O._result}var ie={current:null},z={transition:null},ne={ReactCurrentDispatcher:ie,ReactCurrentBatchConfig:z,ReactCurrentOwner:k};function Q(){throw Error("act(...) is not supported in production builds of React.")}return He.Children={map:te,forEach:function(O,x,ae){te(O,function(){x.apply(this,arguments)},ae)},count:function(O){var x=0;return te(O,function(){x++}),x},toArray:function(O){return te(O,function(x){return x})||[]},only:function(O){if(!Y(O))throw Error("React.Children.only expected to receive a single React element child.");return O}},He.Component=E,He.Fragment=n,He.Profiler=s,He.PureComponent=w,He.StrictMode=o,He.Suspense=u,He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ne,He.act=Q,He.cloneElement=function(O,x,ae){if(O==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+O+".");var ue=A({},O.props),Me=O.key,le=O.ref,Ee=O._owner;if(x!=null){if(x.ref!==void 0&&(le=x.ref,Ee=k.current),x.key!==void 0&&(Me=""+x.key),O.type&&O.type.defaultProps)var _e=O.type.defaultProps;for(se in x)C.call(x,se)&&!D.hasOwnProperty(se)&&(ue[se]=x[se]===void 0&&_e!==void 0?_e[se]:x[se])}var se=arguments.length-2;if(se===1)ue.children=ae;else if(1<se){_e=Array(se);for(var pe=0;pe<se;pe++)_e[pe]=arguments[pe+2];ue.children=_e}return{$$typeof:e,type:O.type,key:Me,ref:le,props:ue,_owner:Ee}},He.createContext=function(O){return O={$$typeof:c,_currentValue:O,_currentValue2:O,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},O.Provider={$$typeof:a,_context:O},O.Consumer=O},He.createElement=F,He.createFactory=function(O){var x=F.bind(null,O);return x.type=O,x},He.createRef=function(){return{current:null}},He.forwardRef=function(O){return{$$typeof:d,render:O}},He.isValidElement=Y,He.lazy=function(O){return{$$typeof:p,_payload:{_status:-1,_result:O},_init:re}},He.memo=function(O,x){return{$$typeof:h,type:O,compare:x===void 0?null:x}},He.startTransition=function(O){var x=z.transition;z.transition={};try{O()}finally{z.transition=x}},He.unstable_act=Q,He.useCallback=function(O,x){return ie.current.useCallback(O,x)},He.useContext=function(O){return ie.current.useContext(O)},He.useDebugValue=function(){},He.useDeferredValue=function(O){return ie.current.useDeferredValue(O)},He.useEffect=function(O,x){return ie.current.useEffect(O,x)},He.useId=function(){return ie.current.useId()},He.useImperativeHandle=function(O,x,ae){return ie.current.useImperativeHandle(O,x,ae)},He.useInsertionEffect=function(O,x){return ie.current.useInsertionEffect(O,x)},He.useLayoutEffect=function(O,x){return ie.current.useLayoutEffect(O,x)},He.useMemo=function(O,x){return ie.current.useMemo(O,x)},He.useReducer=function(O,x,ae){return ie.current.useReducer(O,x,ae)},He.useRef=function(O){return ie.current.useRef(O)},He.useState=function(O){return ie.current.useState(O)},He.useSyncExternalStore=function(O,x,ae){return ie.current.useSyncExternalStore(O,x,ae)},He.useTransition=function(){return ie.current.useTransition()},He.version="18.3.1",He}var o0;function Ah(){return o0||(o0=1,Sf.exports=HA()),Sf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r0;function FA(){if(r0)return na;r0=1;var e=Ah(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(d,u,h){var p,y={},S=null,v=null;h!==void 0&&(S=""+h),u.key!==void 0&&(S=""+u.key),u.ref!==void 0&&(v=u.ref);for(p in u)o.call(u,p)&&!a.hasOwnProperty(p)&&(y[p]=u[p]);if(d&&d.defaultProps)for(p in u=d.defaultProps,u)y[p]===void 0&&(y[p]=u[p]);return{$$typeof:t,type:d,key:S,ref:v,props:y,_owner:s.current}}return na.Fragment=n,na.jsx=c,na.jsxs=c,na}var s0;function LA(){return s0||(s0=1,vf.exports=FA()),vf.exports}var ye=LA(),ge=Ah();const hi=Jy(ge);var hc={},If={exports:{}},cn={},Tf={exports:{}},Af={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var a0;function UA(){return a0||(a0=1,function(e){function t(z,ne){var Q=z.length;z.push(ne);e:for(;0<Q;){var O=Q-1>>>1,x=z[O];if(0<s(x,ne))z[O]=ne,z[Q]=x,Q=O;else break e}}function n(z){return z.length===0?null:z[0]}function o(z){if(z.length===0)return null;var ne=z[0],Q=z.pop();if(Q!==ne){z[0]=Q;e:for(var O=0,x=z.length,ae=x>>>1;O<ae;){var ue=2*(O+1)-1,Me=z[ue],le=ue+1,Ee=z[le];if(0>s(Me,Q))le<x&&0>s(Ee,Me)?(z[O]=Ee,z[le]=Q,O=le):(z[O]=Me,z[ue]=Q,O=ue);else if(le<x&&0>s(Ee,Q))z[O]=Ee,z[le]=Q,O=le;else break e}}return ne}function s(z,ne){var Q=z.sortIndex-ne.sortIndex;return Q!==0?Q:z.id-ne.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var c=Date,d=c.now();e.unstable_now=function(){return c.now()-d}}var u=[],h=[],p=1,y=null,S=3,v=!1,A=!1,I=!1,E=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function P(z){for(var ne=n(h);ne!==null;){if(ne.callback===null)o(h);else if(ne.startTime<=z)o(h),ne.sortIndex=ne.expirationTime,t(u,ne);else break;ne=n(h)}}function R(z){if(I=!1,P(z),!A)if(n(u)!==null)A=!0,re(C);else{var ne=n(h);ne!==null&&ie(R,ne.startTime-z)}}function C(z,ne){A=!1,I&&(I=!1,_(F),F=-1),v=!0;var Q=S;try{for(P(ne),y=n(u);y!==null&&(!(y.expirationTime>ne)||z&&!G());){var O=y.callback;if(typeof O=="function"){y.callback=null,S=y.priorityLevel;var x=O(y.expirationTime<=ne);ne=e.unstable_now(),typeof x=="function"?y.callback=x:y===n(u)&&o(u),P(ne)}else o(u);y=n(u)}if(y!==null)var ae=!0;else{var ue=n(h);ue!==null&&ie(R,ue.startTime-ne),ae=!1}return ae}finally{y=null,S=Q,v=!1}}var k=!1,D=null,F=-1,W=5,Y=-1;function G(){return!(e.unstable_now()-Y<W)}function j(){if(D!==null){var z=e.unstable_now();Y=z;var ne=!0;try{ne=D(!0,z)}finally{ne?ee():(k=!1,D=null)}}else k=!1}var ee;if(typeof w=="function")ee=function(){w(j)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,te=V.port2;V.port1.onmessage=j,ee=function(){te.postMessage(null)}}else ee=function(){E(j,0)};function re(z){D=z,k||(k=!0,ee())}function ie(z,ne){F=E(function(){z(e.unstable_now())},ne)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(z){z.callback=null},e.unstable_continueExecution=function(){A||v||(A=!0,re(C))},e.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<z?Math.floor(1e3/z):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(z){switch(S){case 1:case 2:case 3:var ne=3;break;default:ne=S}var Q=S;S=ne;try{return z()}finally{S=Q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(z,ne){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var Q=S;S=z;try{return ne()}finally{S=Q}},e.unstable_scheduleCallback=function(z,ne,Q){var O=e.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?O+Q:O):Q=O,z){case 1:var x=-1;break;case 2:x=250;break;case 5:x=1073741823;break;case 4:x=1e4;break;default:x=5e3}return x=Q+x,z={id:p++,callback:ne,priorityLevel:z,startTime:Q,expirationTime:x,sortIndex:-1},Q>O?(z.sortIndex=Q,t(h,z),n(u)===null&&z===n(h)&&(I?(_(F),F=-1):I=!0,ie(R,Q-O))):(z.sortIndex=x,t(u,z),A||v||(A=!0,re(C))),z},e.unstable_shouldYield=G,e.unstable_wrapCallback=function(z){var ne=S;return function(){var Q=S;S=ne;try{return z.apply(this,arguments)}finally{S=Q}}}}(Af)),Af}var l0;function GA(){return l0||(l0=1,Tf.exports=UA()),Tf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var c0;function xA(){if(c0)return cn;c0=1;var e=Ah(),t=GA();function n(i){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+i,l=1;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+i+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function a(i,r){c(i,r),c(i+"Capture",r)}function c(i,r){for(s[i]=r,i=0;i<r.length;i++)o.add(r[i])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},y={};function S(i){return u.call(y,i)?!0:u.call(p,i)?!1:h.test(i)?y[i]=!0:(p[i]=!0,!1)}function v(i,r,l,f){if(l!==null&&l.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return f?!1:l!==null?!l.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function A(i,r,l,f){if(r===null||typeof r>"u"||v(i,r,l,f))return!0;if(f)return!1;if(l!==null)switch(l.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function I(i,r,l,f,g,m,T){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=f,this.attributeNamespace=g,this.mustUseProperty=l,this.propertyName=i,this.type=r,this.sanitizeURL=m,this.removeEmptyString=T}var E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){E[i]=new I(i,0,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var r=i[0];E[r]=new I(r,1,!1,i[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){E[i]=new I(i,2,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){E[i]=new I(i,2,!1,i,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){E[i]=new I(i,3,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){E[i]=new I(i,3,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){E[i]=new I(i,4,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){E[i]=new I(i,6,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){E[i]=new I(i,5,!1,i.toLowerCase(),null,!1,!1)});var _=/[\-:]([a-z])/g;function w(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var r=i.replace(_,w);E[r]=new I(r,1,!1,i,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var r=i.replace(_,w);E[r]=new I(r,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var r=i.replace(_,w);E[r]=new I(r,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){E[i]=new I(i,1,!1,i.toLowerCase(),null,!1,!1)}),E.xlinkHref=new I("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){E[i]=new I(i,1,!1,i.toLowerCase(),null,!0,!0)});function P(i,r,l,f){var g=E.hasOwnProperty(r)?E[r]:null;(g!==null?g.type!==0:f||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(A(r,l,g,f)&&(l=null),f||g===null?S(r)&&(l===null?i.removeAttribute(r):i.setAttribute(r,""+l)):g.mustUseProperty?i[g.propertyName]=l===null?g.type===3?!1:"":l:(r=g.attributeName,f=g.attributeNamespace,l===null?i.removeAttribute(r):(g=g.type,l=g===3||g===4&&l===!0?"":""+l,f?i.setAttributeNS(f,r,l):i.setAttribute(r,l))))}var R=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,C=Symbol.for("react.element"),k=Symbol.for("react.portal"),D=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),Y=Symbol.for("react.provider"),G=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),ee=Symbol.for("react.suspense"),V=Symbol.for("react.suspense_list"),te=Symbol.for("react.memo"),re=Symbol.for("react.lazy"),ie=Symbol.for("react.offscreen"),z=Symbol.iterator;function ne(i){return i===null||typeof i!="object"?null:(i=z&&i[z]||i["@@iterator"],typeof i=="function"?i:null)}var Q=Object.assign,O;function x(i){if(O===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);O=r&&r[1]||""}return`
`+O+i}var ae=!1;function ue(i,r){if(!i||ae)return"";ae=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(U){var f=U}Reflect.construct(i,[],r)}else{try{r.call()}catch(U){f=U}i.call(r.prototype)}else{try{throw Error()}catch(U){f=U}i()}}catch(U){if(U&&f&&typeof U.stack=="string"){for(var g=U.stack.split(`
`),m=f.stack.split(`
`),T=g.length-1,M=m.length-1;1<=T&&0<=M&&g[T]!==m[M];)M--;for(;1<=T&&0<=M;T--,M--)if(g[T]!==m[M]){if(T!==1||M!==1)do if(T--,M--,0>M||g[T]!==m[M]){var b=`
`+g[T].replace(" at new "," at ");return i.displayName&&b.includes("<anonymous>")&&(b=b.replace("<anonymous>",i.displayName)),b}while(1<=T&&0<=M);break}}}finally{ae=!1,Error.prepareStackTrace=l}return(i=i?i.displayName||i.name:"")?x(i):""}function Me(i){switch(i.tag){case 5:return x(i.type);case 16:return x("Lazy");case 13:return x("Suspense");case 19:return x("SuspenseList");case 0:case 2:case 15:return i=ue(i.type,!1),i;case 11:return i=ue(i.type.render,!1),i;case 1:return i=ue(i.type,!0),i;default:return""}}function le(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case D:return"Fragment";case k:return"Portal";case W:return"Profiler";case F:return"StrictMode";case ee:return"Suspense";case V:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case G:return(i.displayName||"Context")+".Consumer";case Y:return(i._context.displayName||"Context")+".Provider";case j:var r=i.render;return i=i.displayName,i||(i=r.displayName||r.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case te:return r=i.displayName||null,r!==null?r:le(i.type)||"Memo";case re:r=i._payload,i=i._init;try{return le(i(r))}catch{}}return null}function Ee(i){var r=i.type;switch(i.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=r.render,i=i.displayName||i.name||"",r.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return le(r);case 8:return r===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function _e(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function se(i){var r=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function pe(i){var r=se(i)?"checked":"value",l=Object.getOwnPropertyDescriptor(i.constructor.prototype,r),f=""+i[r];if(!i.hasOwnProperty(r)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var g=l.get,m=l.set;return Object.defineProperty(i,r,{configurable:!0,get:function(){return g.call(this)},set:function(T){f=""+T,m.call(this,T)}}),Object.defineProperty(i,r,{enumerable:l.enumerable}),{getValue:function(){return f},setValue:function(T){f=""+T},stopTracking:function(){i._valueTracker=null,delete i[r]}}}}function Ne(i){i._valueTracker||(i._valueTracker=pe(i))}function we(i){if(!i)return!1;var r=i._valueTracker;if(!r)return!0;var l=r.getValue(),f="";return i&&(f=se(i)?i.checked?"true":"false":i.value),i=f,i!==l?(r.setValue(i),!0):!1}function Tn(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function et(i,r){var l=r.checked;return Q({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??i._wrapperState.initialChecked})}function Ze(i,r){var l=r.defaultValue==null?"":r.defaultValue,f=r.checked!=null?r.checked:r.defaultChecked;l=_e(r.value!=null?r.value:l),i._wrapperState={initialChecked:f,initialValue:l,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function An(i,r){r=r.checked,r!=null&&P(i,"checked",r,!1)}function nn(i,r){An(i,r);var l=_e(r.value),f=r.type;if(l!=null)f==="number"?(l===0&&i.value===""||i.value!=l)&&(i.value=""+l):i.value!==""+l&&(i.value=""+l);else if(f==="submit"||f==="reset"){i.removeAttribute("value");return}r.hasOwnProperty("value")?ni(i,r.type,l):r.hasOwnProperty("defaultValue")&&ni(i,r.type,_e(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(i.defaultChecked=!!r.defaultChecked)}function En(i,r,l){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var f=r.type;if(!(f!=="submit"&&f!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+i._wrapperState.initialValue,l||r===i.value||(i.value=r),i.defaultValue=r}l=i.name,l!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,l!==""&&(i.name=l)}function ni(i,r,l){(r!=="number"||Tn(i.ownerDocument)!==i)&&(l==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+l&&(i.defaultValue=""+l))}var ii=Array.isArray;function zi(i,r,l,f){if(i=i.options,r){r={};for(var g=0;g<l.length;g++)r["$"+l[g]]=!0;for(l=0;l<i.length;l++)g=r.hasOwnProperty("$"+i[l].value),i[l].selected!==g&&(i[l].selected=g),g&&f&&(i[l].defaultSelected=!0)}else{for(l=""+_e(l),r=null,g=0;g<i.length;g++){if(i[g].value===l){i[g].selected=!0,f&&(i[g].defaultSelected=!0);return}r!==null||i[g].disabled||(r=i[g])}r!==null&&(r.selected=!0)}}function Do(i,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return Q({},r,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function hp(i,r){var l=r.value;if(l==null){if(l=r.children,r=r.defaultValue,l!=null){if(r!=null)throw Error(n(92));if(ii(l)){if(1<l.length)throw Error(n(93));l=l[0]}r=l}r==null&&(r=""),l=r}i._wrapperState={initialValue:_e(l)}}function pp(i,r){var l=_e(r.value),f=_e(r.defaultValue);l!=null&&(l=""+l,l!==i.value&&(i.value=l),r.defaultValue==null&&i.defaultValue!==l&&(i.defaultValue=l)),f!=null&&(i.defaultValue=""+f)}function gp(i){var r=i.textContent;r===i._wrapperState.initialValue&&r!==""&&r!==null&&(i.value=r)}function mp(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ru(i,r){return i==null||i==="http://www.w3.org/1999/xhtml"?mp(r):i==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var rl,yp=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,l,f,g){MSApp.execUnsafeLocalFunction(function(){return i(r,l,f,g)})}:i}(function(i,r){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=r;else{for(rl=rl||document.createElement("div"),rl.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=rl.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;r.firstChild;)i.appendChild(r.firstChild)}});function vs(i,r){if(r){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=r;return}}i.textContent=r}var Ss={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},LI=["Webkit","ms","Moz","O"];Object.keys(Ss).forEach(function(i){LI.forEach(function(r){r=r+i.charAt(0).toUpperCase()+i.substring(1),Ss[r]=Ss[i]})});function vp(i,r,l){return r==null||typeof r=="boolean"||r===""?"":l||typeof r!="number"||r===0||Ss.hasOwnProperty(i)&&Ss[i]?(""+r).trim():r+"px"}function Sp(i,r){i=i.style;for(var l in r)if(r.hasOwnProperty(l)){var f=l.indexOf("--")===0,g=vp(l,r[l],f);l==="float"&&(l="cssFloat"),f?i.setProperty(l,g):i[l]=g}}var UI=Q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Mu(i,r){if(r){if(UI[i]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,i));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function ku(i,r){if(i.indexOf("-")===-1)return typeof r.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Du=null;function bu(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var Ou=null,yr=null,vr=null;function Ip(i){if(i=xs(i)){if(typeof Ou!="function")throw Error(n(280));var r=i.stateNode;r&&(r=Rl(r),Ou(i.stateNode,i.type,r))}}function Tp(i){yr?vr?vr.push(i):vr=[i]:yr=i}function Ap(){if(yr){var i=yr,r=vr;if(vr=yr=null,Ip(i),r)for(i=0;i<r.length;i++)Ip(r[i])}}function Ep(i,r){return i(r)}function wp(){}var Nu=!1;function _p(i,r,l){if(Nu)return i(r,l);Nu=!0;try{return Ep(i,r,l)}finally{Nu=!1,(yr!==null||vr!==null)&&(wp(),Ap())}}function Is(i,r){var l=i.stateNode;if(l===null)return null;var f=Rl(l);if(f===null)return null;l=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(n(231,r,typeof l));return l}var Bu=!1;if(d)try{var Ts={};Object.defineProperty(Ts,"passive",{get:function(){Bu=!0}}),window.addEventListener("test",Ts,Ts),window.removeEventListener("test",Ts,Ts)}catch{Bu=!1}function GI(i,r,l,f,g,m,T,M,b){var U=Array.prototype.slice.call(arguments,3);try{r.apply(l,U)}catch(K){this.onError(K)}}var As=!1,sl=null,al=!1,Hu=null,xI={onError:function(i){As=!0,sl=i}};function $I(i,r,l,f,g,m,T,M,b){As=!1,sl=null,GI.apply(xI,arguments)}function WI(i,r,l,f,g,m,T,M,b){if($I.apply(this,arguments),As){if(As){var U=sl;As=!1,sl=null}else throw Error(n(198));al||(al=!0,Hu=U)}}function bo(i){var r=i,l=i;if(i.alternate)for(;r.return;)r=r.return;else{i=r;do r=i,(r.flags&4098)!==0&&(l=r.return),i=r.return;while(i)}return r.tag===3?l:null}function Cp(i){if(i.tag===13){var r=i.memoizedState;if(r===null&&(i=i.alternate,i!==null&&(r=i.memoizedState)),r!==null)return r.dehydrated}return null}function Pp(i){if(bo(i)!==i)throw Error(n(188))}function YI(i){var r=i.alternate;if(!r){if(r=bo(i),r===null)throw Error(n(188));return r!==i?null:i}for(var l=i,f=r;;){var g=l.return;if(g===null)break;var m=g.alternate;if(m===null){if(f=g.return,f!==null){l=f;continue}break}if(g.child===m.child){for(m=g.child;m;){if(m===l)return Pp(g),i;if(m===f)return Pp(g),r;m=m.sibling}throw Error(n(188))}if(l.return!==f.return)l=g,f=m;else{for(var T=!1,M=g.child;M;){if(M===l){T=!0,l=g,f=m;break}if(M===f){T=!0,f=g,l=m;break}M=M.sibling}if(!T){for(M=m.child;M;){if(M===l){T=!0,l=m,f=g;break}if(M===f){T=!0,f=m,l=g;break}M=M.sibling}if(!T)throw Error(n(189))}}if(l.alternate!==f)throw Error(n(190))}if(l.tag!==3)throw Error(n(188));return l.stateNode.current===l?i:r}function Rp(i){return i=YI(i),i!==null?Mp(i):null}function Mp(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var r=Mp(i);if(r!==null)return r;i=i.sibling}return null}var kp=t.unstable_scheduleCallback,Dp=t.unstable_cancelCallback,zI=t.unstable_shouldYield,jI=t.unstable_requestPaint,ft=t.unstable_now,XI=t.unstable_getCurrentPriorityLevel,Fu=t.unstable_ImmediatePriority,bp=t.unstable_UserBlockingPriority,ll=t.unstable_NormalPriority,VI=t.unstable_LowPriority,Op=t.unstable_IdlePriority,cl=null,oi=null;function qI(i){if(oi&&typeof oi.onCommitFiberRoot=="function")try{oi.onCommitFiberRoot(cl,i,void 0,(i.current.flags&128)===128)}catch{}}var Un=Math.clz32?Math.clz32:QI,ZI=Math.log,KI=Math.LN2;function QI(i){return i>>>=0,i===0?32:31-(ZI(i)/KI|0)|0}var ul=64,dl=4194304;function Es(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function fl(i,r){var l=i.pendingLanes;if(l===0)return 0;var f=0,g=i.suspendedLanes,m=i.pingedLanes,T=l&268435455;if(T!==0){var M=T&~g;M!==0?f=Es(M):(m&=T,m!==0&&(f=Es(m)))}else T=l&~g,T!==0?f=Es(T):m!==0&&(f=Es(m));if(f===0)return 0;if(r!==0&&r!==f&&(r&g)===0&&(g=f&-f,m=r&-r,g>=m||g===16&&(m&4194240)!==0))return r;if((f&4)!==0&&(f|=l&16),r=i.entangledLanes,r!==0)for(i=i.entanglements,r&=f;0<r;)l=31-Un(r),g=1<<l,f|=i[l],r&=~g;return f}function JI(i,r){switch(i){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eT(i,r){for(var l=i.suspendedLanes,f=i.pingedLanes,g=i.expirationTimes,m=i.pendingLanes;0<m;){var T=31-Un(m),M=1<<T,b=g[T];b===-1?((M&l)===0||(M&f)!==0)&&(g[T]=JI(M,r)):b<=r&&(i.expiredLanes|=M),m&=~M}}function Lu(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Np(){var i=ul;return ul<<=1,(ul&4194240)===0&&(ul=64),i}function Uu(i){for(var r=[],l=0;31>l;l++)r.push(i);return r}function ws(i,r,l){i.pendingLanes|=r,r!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,r=31-Un(r),i[r]=l}function tT(i,r){var l=i.pendingLanes&~r;i.pendingLanes=r,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=r,i.mutableReadLanes&=r,i.entangledLanes&=r,r=i.entanglements;var f=i.eventTimes;for(i=i.expirationTimes;0<l;){var g=31-Un(l),m=1<<g;r[g]=0,f[g]=-1,i[g]=-1,l&=~m}}function Gu(i,r){var l=i.entangledLanes|=r;for(i=i.entanglements;l;){var f=31-Un(l),g=1<<f;g&r|i[f]&r&&(i[f]|=r),l&=~g}}var ze=0;function Bp(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var Hp,xu,Fp,Lp,Up,$u=!1,hl=[],ji=null,Xi=null,Vi=null,_s=new Map,Cs=new Map,qi=[],nT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gp(i,r){switch(i){case"focusin":case"focusout":ji=null;break;case"dragenter":case"dragleave":Xi=null;break;case"mouseover":case"mouseout":Vi=null;break;case"pointerover":case"pointerout":_s.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Cs.delete(r.pointerId)}}function Ps(i,r,l,f,g,m){return i===null||i.nativeEvent!==m?(i={blockedOn:r,domEventName:l,eventSystemFlags:f,nativeEvent:m,targetContainers:[g]},r!==null&&(r=xs(r),r!==null&&xu(r)),i):(i.eventSystemFlags|=f,r=i.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),i)}function iT(i,r,l,f,g){switch(r){case"focusin":return ji=Ps(ji,i,r,l,f,g),!0;case"dragenter":return Xi=Ps(Xi,i,r,l,f,g),!0;case"mouseover":return Vi=Ps(Vi,i,r,l,f,g),!0;case"pointerover":var m=g.pointerId;return _s.set(m,Ps(_s.get(m)||null,i,r,l,f,g)),!0;case"gotpointercapture":return m=g.pointerId,Cs.set(m,Ps(Cs.get(m)||null,i,r,l,f,g)),!0}return!1}function xp(i){var r=Oo(i.target);if(r!==null){var l=bo(r);if(l!==null){if(r=l.tag,r===13){if(r=Cp(l),r!==null){i.blockedOn=r,Up(i.priority,function(){Fp(l)});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function pl(i){if(i.blockedOn!==null)return!1;for(var r=i.targetContainers;0<r.length;){var l=Yu(i.domEventName,i.eventSystemFlags,r[0],i.nativeEvent);if(l===null){l=i.nativeEvent;var f=new l.constructor(l.type,l);Du=f,l.target.dispatchEvent(f),Du=null}else return r=xs(l),r!==null&&xu(r),i.blockedOn=l,!1;r.shift()}return!0}function $p(i,r,l){pl(i)&&l.delete(r)}function oT(){$u=!1,ji!==null&&pl(ji)&&(ji=null),Xi!==null&&pl(Xi)&&(Xi=null),Vi!==null&&pl(Vi)&&(Vi=null),_s.forEach($p),Cs.forEach($p)}function Rs(i,r){i.blockedOn===r&&(i.blockedOn=null,$u||($u=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,oT)))}function Ms(i){function r(g){return Rs(g,i)}if(0<hl.length){Rs(hl[0],i);for(var l=1;l<hl.length;l++){var f=hl[l];f.blockedOn===i&&(f.blockedOn=null)}}for(ji!==null&&Rs(ji,i),Xi!==null&&Rs(Xi,i),Vi!==null&&Rs(Vi,i),_s.forEach(r),Cs.forEach(r),l=0;l<qi.length;l++)f=qi[l],f.blockedOn===i&&(f.blockedOn=null);for(;0<qi.length&&(l=qi[0],l.blockedOn===null);)xp(l),l.blockedOn===null&&qi.shift()}var Sr=R.ReactCurrentBatchConfig,gl=!0;function rT(i,r,l,f){var g=ze,m=Sr.transition;Sr.transition=null;try{ze=1,Wu(i,r,l,f)}finally{ze=g,Sr.transition=m}}function sT(i,r,l,f){var g=ze,m=Sr.transition;Sr.transition=null;try{ze=4,Wu(i,r,l,f)}finally{ze=g,Sr.transition=m}}function Wu(i,r,l,f){if(gl){var g=Yu(i,r,l,f);if(g===null)ad(i,r,f,ml,l),Gp(i,f);else if(iT(g,i,r,l,f))f.stopPropagation();else if(Gp(i,f),r&4&&-1<nT.indexOf(i)){for(;g!==null;){var m=xs(g);if(m!==null&&Hp(m),m=Yu(i,r,l,f),m===null&&ad(i,r,f,ml,l),m===g)break;g=m}g!==null&&f.stopPropagation()}else ad(i,r,f,null,l)}}var ml=null;function Yu(i,r,l,f){if(ml=null,i=bu(f),i=Oo(i),i!==null)if(r=bo(i),r===null)i=null;else if(l=r.tag,l===13){if(i=Cp(r),i!==null)return i;i=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;i=null}else r!==i&&(i=null);return ml=i,null}function Wp(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(XI()){case Fu:return 1;case bp:return 4;case ll:case VI:return 16;case Op:return 536870912;default:return 16}default:return 16}}var Zi=null,zu=null,yl=null;function Yp(){if(yl)return yl;var i,r=zu,l=r.length,f,g="value"in Zi?Zi.value:Zi.textContent,m=g.length;for(i=0;i<l&&r[i]===g[i];i++);var T=l-i;for(f=1;f<=T&&r[l-f]===g[m-f];f++);return yl=g.slice(i,1<f?1-f:void 0)}function vl(i){var r=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&r===13&&(i=13)):i=r,i===10&&(i=13),32<=i||i===13?i:0}function Sl(){return!0}function zp(){return!1}function fn(i){function r(l,f,g,m,T){this._reactName=l,this._targetInst=g,this.type=f,this.nativeEvent=m,this.target=T,this.currentTarget=null;for(var M in i)i.hasOwnProperty(M)&&(l=i[M],this[M]=l?l(m):m[M]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?Sl:zp,this.isPropagationStopped=zp,this}return Q(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Sl)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Sl)},persist:function(){},isPersistent:Sl}),r}var Ir={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ju=fn(Ir),ks=Q({},Ir,{view:0,detail:0}),aT=fn(ks),Xu,Vu,Ds,Il=Q({},ks,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zu,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Ds&&(Ds&&i.type==="mousemove"?(Xu=i.screenX-Ds.screenX,Vu=i.screenY-Ds.screenY):Vu=Xu=0,Ds=i),Xu)},movementY:function(i){return"movementY"in i?i.movementY:Vu}}),jp=fn(Il),lT=Q({},Il,{dataTransfer:0}),cT=fn(lT),uT=Q({},ks,{relatedTarget:0}),qu=fn(uT),dT=Q({},Ir,{animationName:0,elapsedTime:0,pseudoElement:0}),fT=fn(dT),hT=Q({},Ir,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),pT=fn(hT),gT=Q({},Ir,{data:0}),Xp=fn(gT),mT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ST(i){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(i):(i=vT[i])?!!r[i]:!1}function Zu(){return ST}var IT=Q({},ks,{key:function(i){if(i.key){var r=mT[i.key]||i.key;if(r!=="Unidentified")return r}return i.type==="keypress"?(i=vl(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?yT[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zu,charCode:function(i){return i.type==="keypress"?vl(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?vl(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),TT=fn(IT),AT=Q({},Il,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Vp=fn(AT),ET=Q({},ks,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zu}),wT=fn(ET),_T=Q({},Ir,{propertyName:0,elapsedTime:0,pseudoElement:0}),CT=fn(_T),PT=Q({},Il,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),RT=fn(PT),MT=[9,13,27,32],Ku=d&&"CompositionEvent"in window,bs=null;d&&"documentMode"in document&&(bs=document.documentMode);var kT=d&&"TextEvent"in window&&!bs,qp=d&&(!Ku||bs&&8<bs&&11>=bs),Zp=" ",Kp=!1;function Qp(i,r){switch(i){case"keyup":return MT.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Jp(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Tr=!1;function DT(i,r){switch(i){case"compositionend":return Jp(r);case"keypress":return r.which!==32?null:(Kp=!0,Zp);case"textInput":return i=r.data,i===Zp&&Kp?null:i;default:return null}}function bT(i,r){if(Tr)return i==="compositionend"||!Ku&&Qp(i,r)?(i=Yp(),yl=zu=Zi=null,Tr=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return qp&&r.locale!=="ko"?null:r.data;default:return null}}var OT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function eg(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r==="input"?!!OT[i.type]:r==="textarea"}function tg(i,r,l,f){Tp(f),r=_l(r,"onChange"),0<r.length&&(l=new ju("onChange","change",null,l,f),i.push({event:l,listeners:r}))}var Os=null,Ns=null;function NT(i){Sg(i,0)}function Tl(i){var r=Cr(i);if(we(r))return i}function BT(i,r){if(i==="change")return r}var ng=!1;if(d){var Qu;if(d){var Ju="oninput"in document;if(!Ju){var ig=document.createElement("div");ig.setAttribute("oninput","return;"),Ju=typeof ig.oninput=="function"}Qu=Ju}else Qu=!1;ng=Qu&&(!document.documentMode||9<document.documentMode)}function og(){Os&&(Os.detachEvent("onpropertychange",rg),Ns=Os=null)}function rg(i){if(i.propertyName==="value"&&Tl(Ns)){var r=[];tg(r,Ns,i,bu(i)),_p(NT,r)}}function HT(i,r,l){i==="focusin"?(og(),Os=r,Ns=l,Os.attachEvent("onpropertychange",rg)):i==="focusout"&&og()}function FT(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Tl(Ns)}function LT(i,r){if(i==="click")return Tl(r)}function UT(i,r){if(i==="input"||i==="change")return Tl(r)}function GT(i,r){return i===r&&(i!==0||1/i===1/r)||i!==i&&r!==r}var Gn=typeof Object.is=="function"?Object.is:GT;function Bs(i,r){if(Gn(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;var l=Object.keys(i),f=Object.keys(r);if(l.length!==f.length)return!1;for(f=0;f<l.length;f++){var g=l[f];if(!u.call(r,g)||!Gn(i[g],r[g]))return!1}return!0}function sg(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function ag(i,r){var l=sg(i);i=0;for(var f;l;){if(l.nodeType===3){if(f=i+l.textContent.length,i<=r&&f>=r)return{node:l,offset:r-i};i=f}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=sg(l)}}function lg(i,r){return i&&r?i===r?!0:i&&i.nodeType===3?!1:r&&r.nodeType===3?lg(i,r.parentNode):"contains"in i?i.contains(r):i.compareDocumentPosition?!!(i.compareDocumentPosition(r)&16):!1:!1}function cg(){for(var i=window,r=Tn();r instanceof i.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)i=r.contentWindow;else break;r=Tn(i.document)}return r}function ed(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r&&(r==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||r==="textarea"||i.contentEditable==="true")}function xT(i){var r=cg(),l=i.focusedElem,f=i.selectionRange;if(r!==l&&l&&l.ownerDocument&&lg(l.ownerDocument.documentElement,l)){if(f!==null&&ed(l)){if(r=f.start,i=f.end,i===void 0&&(i=r),"selectionStart"in l)l.selectionStart=r,l.selectionEnd=Math.min(i,l.value.length);else if(i=(r=l.ownerDocument||document)&&r.defaultView||window,i.getSelection){i=i.getSelection();var g=l.textContent.length,m=Math.min(f.start,g);f=f.end===void 0?m:Math.min(f.end,g),!i.extend&&m>f&&(g=f,f=m,m=g),g=ag(l,m);var T=ag(l,f);g&&T&&(i.rangeCount!==1||i.anchorNode!==g.node||i.anchorOffset!==g.offset||i.focusNode!==T.node||i.focusOffset!==T.offset)&&(r=r.createRange(),r.setStart(g.node,g.offset),i.removeAllRanges(),m>f?(i.addRange(r),i.extend(T.node,T.offset)):(r.setEnd(T.node,T.offset),i.addRange(r)))}}for(r=[],i=l;i=i.parentNode;)i.nodeType===1&&r.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<r.length;l++)i=r[l],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var $T=d&&"documentMode"in document&&11>=document.documentMode,Ar=null,td=null,Hs=null,nd=!1;function ug(i,r,l){var f=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;nd||Ar==null||Ar!==Tn(f)||(f=Ar,"selectionStart"in f&&ed(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Hs&&Bs(Hs,f)||(Hs=f,f=_l(td,"onSelect"),0<f.length&&(r=new ju("onSelect","select",null,r,l),i.push({event:r,listeners:f}),r.target=Ar)))}function Al(i,r){var l={};return l[i.toLowerCase()]=r.toLowerCase(),l["Webkit"+i]="webkit"+r,l["Moz"+i]="moz"+r,l}var Er={animationend:Al("Animation","AnimationEnd"),animationiteration:Al("Animation","AnimationIteration"),animationstart:Al("Animation","AnimationStart"),transitionend:Al("Transition","TransitionEnd")},id={},dg={};d&&(dg=document.createElement("div").style,"AnimationEvent"in window||(delete Er.animationend.animation,delete Er.animationiteration.animation,delete Er.animationstart.animation),"TransitionEvent"in window||delete Er.transitionend.transition);function El(i){if(id[i])return id[i];if(!Er[i])return i;var r=Er[i],l;for(l in r)if(r.hasOwnProperty(l)&&l in dg)return id[i]=r[l];return i}var fg=El("animationend"),hg=El("animationiteration"),pg=El("animationstart"),gg=El("transitionend"),mg=new Map,yg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ki(i,r){mg.set(i,r),a(r,[i])}for(var od=0;od<yg.length;od++){var rd=yg[od],WT=rd.toLowerCase(),YT=rd[0].toUpperCase()+rd.slice(1);Ki(WT,"on"+YT)}Ki(fg,"onAnimationEnd"),Ki(hg,"onAnimationIteration"),Ki(pg,"onAnimationStart"),Ki("dblclick","onDoubleClick"),Ki("focusin","onFocus"),Ki("focusout","onBlur"),Ki(gg,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fs));function vg(i,r,l){var f=i.type||"unknown-event";i.currentTarget=l,WI(f,r,void 0,i),i.currentTarget=null}function Sg(i,r){r=(r&4)!==0;for(var l=0;l<i.length;l++){var f=i[l],g=f.event;f=f.listeners;e:{var m=void 0;if(r)for(var T=f.length-1;0<=T;T--){var M=f[T],b=M.instance,U=M.currentTarget;if(M=M.listener,b!==m&&g.isPropagationStopped())break e;vg(g,M,U),m=b}else for(T=0;T<f.length;T++){if(M=f[T],b=M.instance,U=M.currentTarget,M=M.listener,b!==m&&g.isPropagationStopped())break e;vg(g,M,U),m=b}}}if(al)throw i=Hu,al=!1,Hu=null,i}function nt(i,r){var l=r[hd];l===void 0&&(l=r[hd]=new Set);var f=i+"__bubble";l.has(f)||(Ig(r,i,2,!1),l.add(f))}function sd(i,r,l){var f=0;r&&(f|=4),Ig(l,i,f,r)}var wl="_reactListening"+Math.random().toString(36).slice(2);function Ls(i){if(!i[wl]){i[wl]=!0,o.forEach(function(l){l!=="selectionchange"&&(zT.has(l)||sd(l,!1,i),sd(l,!0,i))});var r=i.nodeType===9?i:i.ownerDocument;r===null||r[wl]||(r[wl]=!0,sd("selectionchange",!1,r))}}function Ig(i,r,l,f){switch(Wp(r)){case 1:var g=rT;break;case 4:g=sT;break;default:g=Wu}l=g.bind(null,r,l,i),g=void 0,!Bu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),f?g!==void 0?i.addEventListener(r,l,{capture:!0,passive:g}):i.addEventListener(r,l,!0):g!==void 0?i.addEventListener(r,l,{passive:g}):i.addEventListener(r,l,!1)}function ad(i,r,l,f,g){var m=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var T=f.tag;if(T===3||T===4){var M=f.stateNode.containerInfo;if(M===g||M.nodeType===8&&M.parentNode===g)break;if(T===4)for(T=f.return;T!==null;){var b=T.tag;if((b===3||b===4)&&(b=T.stateNode.containerInfo,b===g||b.nodeType===8&&b.parentNode===g))return;T=T.return}for(;M!==null;){if(T=Oo(M),T===null)return;if(b=T.tag,b===5||b===6){f=m=T;continue e}M=M.parentNode}}f=f.return}_p(function(){var U=m,K=bu(l),J=[];e:{var q=mg.get(i);if(q!==void 0){var ce=ju,me=i;switch(i){case"keypress":if(vl(l)===0)break e;case"keydown":case"keyup":ce=TT;break;case"focusin":me="focus",ce=qu;break;case"focusout":me="blur",ce=qu;break;case"beforeblur":case"afterblur":ce=qu;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ce=jp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ce=cT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ce=wT;break;case fg:case hg:case pg:ce=fT;break;case gg:ce=CT;break;case"scroll":ce=aT;break;case"wheel":ce=RT;break;case"copy":case"cut":case"paste":ce=pT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ce=Vp}var ve=(r&4)!==0,ht=!ve&&i==="scroll",H=ve?q!==null?q+"Capture":null:q;ve=[];for(var B=U,L;B!==null;){L=B;var oe=L.stateNode;if(L.tag===5&&oe!==null&&(L=oe,H!==null&&(oe=Is(B,H),oe!=null&&ve.push(Us(B,oe,L)))),ht)break;B=B.return}0<ve.length&&(q=new ce(q,me,null,l,K),J.push({event:q,listeners:ve}))}}if((r&7)===0){e:{if(q=i==="mouseover"||i==="pointerover",ce=i==="mouseout"||i==="pointerout",q&&l!==Du&&(me=l.relatedTarget||l.fromElement)&&(Oo(me)||me[yi]))break e;if((ce||q)&&(q=K.window===K?K:(q=K.ownerDocument)?q.defaultView||q.parentWindow:window,ce?(me=l.relatedTarget||l.toElement,ce=U,me=me?Oo(me):null,me!==null&&(ht=bo(me),me!==ht||me.tag!==5&&me.tag!==6)&&(me=null)):(ce=null,me=U),ce!==me)){if(ve=jp,oe="onMouseLeave",H="onMouseEnter",B="mouse",(i==="pointerout"||i==="pointerover")&&(ve=Vp,oe="onPointerLeave",H="onPointerEnter",B="pointer"),ht=ce==null?q:Cr(ce),L=me==null?q:Cr(me),q=new ve(oe,B+"leave",ce,l,K),q.target=ht,q.relatedTarget=L,oe=null,Oo(K)===U&&(ve=new ve(H,B+"enter",me,l,K),ve.target=L,ve.relatedTarget=ht,oe=ve),ht=oe,ce&&me)t:{for(ve=ce,H=me,B=0,L=ve;L;L=wr(L))B++;for(L=0,oe=H;oe;oe=wr(oe))L++;for(;0<B-L;)ve=wr(ve),B--;for(;0<L-B;)H=wr(H),L--;for(;B--;){if(ve===H||H!==null&&ve===H.alternate)break t;ve=wr(ve),H=wr(H)}ve=null}else ve=null;ce!==null&&Tg(J,q,ce,ve,!1),me!==null&&ht!==null&&Tg(J,ht,me,ve,!0)}}e:{if(q=U?Cr(U):window,ce=q.nodeName&&q.nodeName.toLowerCase(),ce==="select"||ce==="input"&&q.type==="file")var Te=BT;else if(eg(q))if(ng)Te=UT;else{Te=FT;var Pe=HT}else(ce=q.nodeName)&&ce.toLowerCase()==="input"&&(q.type==="checkbox"||q.type==="radio")&&(Te=LT);if(Te&&(Te=Te(i,U))){tg(J,Te,l,K);break e}Pe&&Pe(i,q,U),i==="focusout"&&(Pe=q._wrapperState)&&Pe.controlled&&q.type==="number"&&ni(q,"number",q.value)}switch(Pe=U?Cr(U):window,i){case"focusin":(eg(Pe)||Pe.contentEditable==="true")&&(Ar=Pe,td=U,Hs=null);break;case"focusout":Hs=td=Ar=null;break;case"mousedown":nd=!0;break;case"contextmenu":case"mouseup":case"dragend":nd=!1,ug(J,l,K);break;case"selectionchange":if($T)break;case"keydown":case"keyup":ug(J,l,K)}var Re;if(Ku)e:{switch(i){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else Tr?Qp(i,l)&&(be="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(be="onCompositionStart");be&&(qp&&l.locale!=="ko"&&(Tr||be!=="onCompositionStart"?be==="onCompositionEnd"&&Tr&&(Re=Yp()):(Zi=K,zu="value"in Zi?Zi.value:Zi.textContent,Tr=!0)),Pe=_l(U,be),0<Pe.length&&(be=new Xp(be,i,null,l,K),J.push({event:be,listeners:Pe}),Re?be.data=Re:(Re=Jp(l),Re!==null&&(be.data=Re)))),(Re=kT?DT(i,l):bT(i,l))&&(U=_l(U,"onBeforeInput"),0<U.length&&(K=new Xp("onBeforeInput","beforeinput",null,l,K),J.push({event:K,listeners:U}),K.data=Re))}Sg(J,r)})}function Us(i,r,l){return{instance:i,listener:r,currentTarget:l}}function _l(i,r){for(var l=r+"Capture",f=[];i!==null;){var g=i,m=g.stateNode;g.tag===5&&m!==null&&(g=m,m=Is(i,l),m!=null&&f.unshift(Us(i,m,g)),m=Is(i,r),m!=null&&f.push(Us(i,m,g))),i=i.return}return f}function wr(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Tg(i,r,l,f,g){for(var m=r._reactName,T=[];l!==null&&l!==f;){var M=l,b=M.alternate,U=M.stateNode;if(b!==null&&b===f)break;M.tag===5&&U!==null&&(M=U,g?(b=Is(l,m),b!=null&&T.unshift(Us(l,b,M))):g||(b=Is(l,m),b!=null&&T.push(Us(l,b,M)))),l=l.return}T.length!==0&&i.push({event:r,listeners:T})}var jT=/\r\n?/g,XT=/\u0000|\uFFFD/g;function Ag(i){return(typeof i=="string"?i:""+i).replace(jT,`
`).replace(XT,"")}function Cl(i,r,l){if(r=Ag(r),Ag(i)!==r&&l)throw Error(n(425))}function Pl(){}var ld=null,cd=null;function ud(i,r){return i==="textarea"||i==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var dd=typeof setTimeout=="function"?setTimeout:void 0,VT=typeof clearTimeout=="function"?clearTimeout:void 0,Eg=typeof Promise=="function"?Promise:void 0,qT=typeof queueMicrotask=="function"?queueMicrotask:typeof Eg<"u"?function(i){return Eg.resolve(null).then(i).catch(ZT)}:dd;function ZT(i){setTimeout(function(){throw i})}function fd(i,r){var l=r,f=0;do{var g=l.nextSibling;if(i.removeChild(l),g&&g.nodeType===8)if(l=g.data,l==="/$"){if(f===0){i.removeChild(g),Ms(r);return}f--}else l!=="$"&&l!=="$?"&&l!=="$!"||f++;l=g}while(l);Ms(r)}function Qi(i){for(;i!=null;i=i.nextSibling){var r=i.nodeType;if(r===1||r===3)break;if(r===8){if(r=i.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return i}function wg(i){i=i.previousSibling;for(var r=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"){if(r===0)return i;r--}else l==="/$"&&r++}i=i.previousSibling}return null}var _r=Math.random().toString(36).slice(2),ri="__reactFiber$"+_r,Gs="__reactProps$"+_r,yi="__reactContainer$"+_r,hd="__reactEvents$"+_r,KT="__reactListeners$"+_r,QT="__reactHandles$"+_r;function Oo(i){var r=i[ri];if(r)return r;for(var l=i.parentNode;l;){if(r=l[yi]||l[ri]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(i=wg(i);i!==null;){if(l=i[ri])return l;i=wg(i)}return r}i=l,l=i.parentNode}return null}function xs(i){return i=i[ri]||i[yi],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Cr(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(n(33))}function Rl(i){return i[Gs]||null}var pd=[],Pr=-1;function Ji(i){return{current:i}}function it(i){0>Pr||(i.current=pd[Pr],pd[Pr]=null,Pr--)}function tt(i,r){Pr++,pd[Pr]=i.current,i.current=r}var eo={},xt=Ji(eo),on=Ji(!1),No=eo;function Rr(i,r){var l=i.type.contextTypes;if(!l)return eo;var f=i.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===r)return f.__reactInternalMemoizedMaskedChildContext;var g={},m;for(m in l)g[m]=r[m];return f&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=g),g}function rn(i){return i=i.childContextTypes,i!=null}function Ml(){it(on),it(xt)}function _g(i,r,l){if(xt.current!==eo)throw Error(n(168));tt(xt,r),tt(on,l)}function Cg(i,r,l){var f=i.stateNode;if(r=r.childContextTypes,typeof f.getChildContext!="function")return l;f=f.getChildContext();for(var g in f)if(!(g in r))throw Error(n(108,Ee(i)||"Unknown",g));return Q({},l,f)}function kl(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||eo,No=xt.current,tt(xt,i),tt(on,on.current),!0}function Pg(i,r,l){var f=i.stateNode;if(!f)throw Error(n(169));l?(i=Cg(i,r,No),f.__reactInternalMemoizedMergedChildContext=i,it(on),it(xt),tt(xt,i)):it(on),tt(on,l)}var vi=null,Dl=!1,gd=!1;function Rg(i){vi===null?vi=[i]:vi.push(i)}function JT(i){Dl=!0,Rg(i)}function to(){if(!gd&&vi!==null){gd=!0;var i=0,r=ze;try{var l=vi;for(ze=1;i<l.length;i++){var f=l[i];do f=f(!0);while(f!==null)}vi=null,Dl=!1}catch(g){throw vi!==null&&(vi=vi.slice(i+1)),kp(Fu,to),g}finally{ze=r,gd=!1}}return null}var Mr=[],kr=0,bl=null,Ol=0,wn=[],_n=0,Bo=null,Si=1,Ii="";function Ho(i,r){Mr[kr++]=Ol,Mr[kr++]=bl,bl=i,Ol=r}function Mg(i,r,l){wn[_n++]=Si,wn[_n++]=Ii,wn[_n++]=Bo,Bo=i;var f=Si;i=Ii;var g=32-Un(f)-1;f&=~(1<<g),l+=1;var m=32-Un(r)+g;if(30<m){var T=g-g%5;m=(f&(1<<T)-1).toString(32),f>>=T,g-=T,Si=1<<32-Un(r)+g|l<<g|f,Ii=m+i}else Si=1<<m|l<<g|f,Ii=i}function md(i){i.return!==null&&(Ho(i,1),Mg(i,1,0))}function yd(i){for(;i===bl;)bl=Mr[--kr],Mr[kr]=null,Ol=Mr[--kr],Mr[kr]=null;for(;i===Bo;)Bo=wn[--_n],wn[_n]=null,Ii=wn[--_n],wn[_n]=null,Si=wn[--_n],wn[_n]=null}var hn=null,pn=null,rt=!1,xn=null;function kg(i,r){var l=Mn(5,null,null,0);l.elementType="DELETED",l.stateNode=r,l.return=i,r=i.deletions,r===null?(i.deletions=[l],i.flags|=16):r.push(l)}function Dg(i,r){switch(i.tag){case 5:var l=i.type;return r=r.nodeType!==1||l.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(i.stateNode=r,hn=i,pn=Qi(r.firstChild),!0):!1;case 6:return r=i.pendingProps===""||r.nodeType!==3?null:r,r!==null?(i.stateNode=r,hn=i,pn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(l=Bo!==null?{id:Si,overflow:Ii}:null,i.memoizedState={dehydrated:r,treeContext:l,retryLane:1073741824},l=Mn(18,null,null,0),l.stateNode=r,l.return=i,i.child=l,hn=i,pn=null,!0):!1;default:return!1}}function vd(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Sd(i){if(rt){var r=pn;if(r){var l=r;if(!Dg(i,r)){if(vd(i))throw Error(n(418));r=Qi(l.nextSibling);var f=hn;r&&Dg(i,r)?kg(f,l):(i.flags=i.flags&-4097|2,rt=!1,hn=i)}}else{if(vd(i))throw Error(n(418));i.flags=i.flags&-4097|2,rt=!1,hn=i}}}function bg(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;hn=i}function Nl(i){if(i!==hn)return!1;if(!rt)return bg(i),rt=!0,!1;var r;if((r=i.tag!==3)&&!(r=i.tag!==5)&&(r=i.type,r=r!=="head"&&r!=="body"&&!ud(i.type,i.memoizedProps)),r&&(r=pn)){if(vd(i))throw Og(),Error(n(418));for(;r;)kg(i,r),r=Qi(r.nextSibling)}if(bg(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));e:{for(i=i.nextSibling,r=0;i;){if(i.nodeType===8){var l=i.data;if(l==="/$"){if(r===0){pn=Qi(i.nextSibling);break e}r--}else l!=="$"&&l!=="$!"&&l!=="$?"||r++}i=i.nextSibling}pn=null}}else pn=hn?Qi(i.stateNode.nextSibling):null;return!0}function Og(){for(var i=pn;i;)i=Qi(i.nextSibling)}function Dr(){pn=hn=null,rt=!1}function Id(i){xn===null?xn=[i]:xn.push(i)}var eA=R.ReactCurrentBatchConfig;function $s(i,r,l){if(i=l.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(n(309));var f=l.stateNode}if(!f)throw Error(n(147,i));var g=f,m=""+i;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===m?r.ref:(r=function(T){var M=g.refs;T===null?delete M[m]:M[m]=T},r._stringRef=m,r)}if(typeof i!="string")throw Error(n(284));if(!l._owner)throw Error(n(290,i))}return i}function Bl(i,r){throw i=Object.prototype.toString.call(r),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i))}function Ng(i){var r=i._init;return r(i._payload)}function Bg(i){function r(H,B){if(i){var L=H.deletions;L===null?(H.deletions=[B],H.flags|=16):L.push(B)}}function l(H,B){if(!i)return null;for(;B!==null;)r(H,B),B=B.sibling;return null}function f(H,B){for(H=new Map;B!==null;)B.key!==null?H.set(B.key,B):H.set(B.index,B),B=B.sibling;return H}function g(H,B){return H=co(H,B),H.index=0,H.sibling=null,H}function m(H,B,L){return H.index=L,i?(L=H.alternate,L!==null?(L=L.index,L<B?(H.flags|=2,B):L):(H.flags|=2,B)):(H.flags|=1048576,B)}function T(H){return i&&H.alternate===null&&(H.flags|=2),H}function M(H,B,L,oe){return B===null||B.tag!==6?(B=ff(L,H.mode,oe),B.return=H,B):(B=g(B,L),B.return=H,B)}function b(H,B,L,oe){var Te=L.type;return Te===D?K(H,B,L.props.children,oe,L.key):B!==null&&(B.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===re&&Ng(Te)===B.type)?(oe=g(B,L.props),oe.ref=$s(H,B,L),oe.return=H,oe):(oe=rc(L.type,L.key,L.props,null,H.mode,oe),oe.ref=$s(H,B,L),oe.return=H,oe)}function U(H,B,L,oe){return B===null||B.tag!==4||B.stateNode.containerInfo!==L.containerInfo||B.stateNode.implementation!==L.implementation?(B=hf(L,H.mode,oe),B.return=H,B):(B=g(B,L.children||[]),B.return=H,B)}function K(H,B,L,oe,Te){return B===null||B.tag!==7?(B=Yo(L,H.mode,oe,Te),B.return=H,B):(B=g(B,L),B.return=H,B)}function J(H,B,L){if(typeof B=="string"&&B!==""||typeof B=="number")return B=ff(""+B,H.mode,L),B.return=H,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case C:return L=rc(B.type,B.key,B.props,null,H.mode,L),L.ref=$s(H,null,B),L.return=H,L;case k:return B=hf(B,H.mode,L),B.return=H,B;case re:var oe=B._init;return J(H,oe(B._payload),L)}if(ii(B)||ne(B))return B=Yo(B,H.mode,L,null),B.return=H,B;Bl(H,B)}return null}function q(H,B,L,oe){var Te=B!==null?B.key:null;if(typeof L=="string"&&L!==""||typeof L=="number")return Te!==null?null:M(H,B,""+L,oe);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case C:return L.key===Te?b(H,B,L,oe):null;case k:return L.key===Te?U(H,B,L,oe):null;case re:return Te=L._init,q(H,B,Te(L._payload),oe)}if(ii(L)||ne(L))return Te!==null?null:K(H,B,L,oe,null);Bl(H,L)}return null}function ce(H,B,L,oe,Te){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return H=H.get(L)||null,M(B,H,""+oe,Te);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case C:return H=H.get(oe.key===null?L:oe.key)||null,b(B,H,oe,Te);case k:return H=H.get(oe.key===null?L:oe.key)||null,U(B,H,oe,Te);case re:var Pe=oe._init;return ce(H,B,L,Pe(oe._payload),Te)}if(ii(oe)||ne(oe))return H=H.get(L)||null,K(B,H,oe,Te,null);Bl(B,oe)}return null}function me(H,B,L,oe){for(var Te=null,Pe=null,Re=B,be=B=0,Rt=null;Re!==null&&be<L.length;be++){Re.index>be?(Rt=Re,Re=null):Rt=Re.sibling;var $e=q(H,Re,L[be],oe);if($e===null){Re===null&&(Re=Rt);break}i&&Re&&$e.alternate===null&&r(H,Re),B=m($e,B,be),Pe===null?Te=$e:Pe.sibling=$e,Pe=$e,Re=Rt}if(be===L.length)return l(H,Re),rt&&Ho(H,be),Te;if(Re===null){for(;be<L.length;be++)Re=J(H,L[be],oe),Re!==null&&(B=m(Re,B,be),Pe===null?Te=Re:Pe.sibling=Re,Pe=Re);return rt&&Ho(H,be),Te}for(Re=f(H,Re);be<L.length;be++)Rt=ce(Re,H,be,L[be],oe),Rt!==null&&(i&&Rt.alternate!==null&&Re.delete(Rt.key===null?be:Rt.key),B=m(Rt,B,be),Pe===null?Te=Rt:Pe.sibling=Rt,Pe=Rt);return i&&Re.forEach(function(uo){return r(H,uo)}),rt&&Ho(H,be),Te}function ve(H,B,L,oe){var Te=ne(L);if(typeof Te!="function")throw Error(n(150));if(L=Te.call(L),L==null)throw Error(n(151));for(var Pe=Te=null,Re=B,be=B=0,Rt=null,$e=L.next();Re!==null&&!$e.done;be++,$e=L.next()){Re.index>be?(Rt=Re,Re=null):Rt=Re.sibling;var uo=q(H,Re,$e.value,oe);if(uo===null){Re===null&&(Re=Rt);break}i&&Re&&uo.alternate===null&&r(H,Re),B=m(uo,B,be),Pe===null?Te=uo:Pe.sibling=uo,Pe=uo,Re=Rt}if($e.done)return l(H,Re),rt&&Ho(H,be),Te;if(Re===null){for(;!$e.done;be++,$e=L.next())$e=J(H,$e.value,oe),$e!==null&&(B=m($e,B,be),Pe===null?Te=$e:Pe.sibling=$e,Pe=$e);return rt&&Ho(H,be),Te}for(Re=f(H,Re);!$e.done;be++,$e=L.next())$e=ce(Re,H,be,$e.value,oe),$e!==null&&(i&&$e.alternate!==null&&Re.delete($e.key===null?be:$e.key),B=m($e,B,be),Pe===null?Te=$e:Pe.sibling=$e,Pe=$e);return i&&Re.forEach(function(OA){return r(H,OA)}),rt&&Ho(H,be),Te}function ht(H,B,L,oe){if(typeof L=="object"&&L!==null&&L.type===D&&L.key===null&&(L=L.props.children),typeof L=="object"&&L!==null){switch(L.$$typeof){case C:e:{for(var Te=L.key,Pe=B;Pe!==null;){if(Pe.key===Te){if(Te=L.type,Te===D){if(Pe.tag===7){l(H,Pe.sibling),B=g(Pe,L.props.children),B.return=H,H=B;break e}}else if(Pe.elementType===Te||typeof Te=="object"&&Te!==null&&Te.$$typeof===re&&Ng(Te)===Pe.type){l(H,Pe.sibling),B=g(Pe,L.props),B.ref=$s(H,Pe,L),B.return=H,H=B;break e}l(H,Pe);break}else r(H,Pe);Pe=Pe.sibling}L.type===D?(B=Yo(L.props.children,H.mode,oe,L.key),B.return=H,H=B):(oe=rc(L.type,L.key,L.props,null,H.mode,oe),oe.ref=$s(H,B,L),oe.return=H,H=oe)}return T(H);case k:e:{for(Pe=L.key;B!==null;){if(B.key===Pe)if(B.tag===4&&B.stateNode.containerInfo===L.containerInfo&&B.stateNode.implementation===L.implementation){l(H,B.sibling),B=g(B,L.children||[]),B.return=H,H=B;break e}else{l(H,B);break}else r(H,B);B=B.sibling}B=hf(L,H.mode,oe),B.return=H,H=B}return T(H);case re:return Pe=L._init,ht(H,B,Pe(L._payload),oe)}if(ii(L))return me(H,B,L,oe);if(ne(L))return ve(H,B,L,oe);Bl(H,L)}return typeof L=="string"&&L!==""||typeof L=="number"?(L=""+L,B!==null&&B.tag===6?(l(H,B.sibling),B=g(B,L),B.return=H,H=B):(l(H,B),B=ff(L,H.mode,oe),B.return=H,H=B),T(H)):l(H,B)}return ht}var br=Bg(!0),Hg=Bg(!1),Hl=Ji(null),Fl=null,Or=null,Td=null;function Ad(){Td=Or=Fl=null}function Ed(i){var r=Hl.current;it(Hl),i._currentValue=r}function wd(i,r,l){for(;i!==null;){var f=i.alternate;if((i.childLanes&r)!==r?(i.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),i===l)break;i=i.return}}function Nr(i,r){Fl=i,Td=Or=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&r)!==0&&(sn=!0),i.firstContext=null)}function Cn(i){var r=i._currentValue;if(Td!==i)if(i={context:i,memoizedValue:r,next:null},Or===null){if(Fl===null)throw Error(n(308));Or=i,Fl.dependencies={lanes:0,firstContext:i}}else Or=Or.next=i;return r}var Fo=null;function _d(i){Fo===null?Fo=[i]:Fo.push(i)}function Fg(i,r,l,f){var g=r.interleaved;return g===null?(l.next=l,_d(r)):(l.next=g.next,g.next=l),r.interleaved=l,Ti(i,f)}function Ti(i,r){i.lanes|=r;var l=i.alternate;for(l!==null&&(l.lanes|=r),l=i,i=i.return;i!==null;)i.childLanes|=r,l=i.alternate,l!==null&&(l.childLanes|=r),l=i,i=i.return;return l.tag===3?l.stateNode:null}var no=!1;function Cd(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Lg(i,r){i=i.updateQueue,r.updateQueue===i&&(r.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Ai(i,r){return{eventTime:i,lane:r,tag:0,payload:null,callback:null,next:null}}function io(i,r,l){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,(xe&2)!==0){var g=f.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),f.pending=r,Ti(i,l)}return g=f.interleaved,g===null?(r.next=r,_d(f)):(r.next=g.next,g.next=r),f.interleaved=r,Ti(i,l)}function Ll(i,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194240)!==0)){var f=r.lanes;f&=i.pendingLanes,l|=f,r.lanes=l,Gu(i,l)}}function Ug(i,r){var l=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,l===f)){var g=null,m=null;if(l=l.firstBaseUpdate,l!==null){do{var T={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};m===null?g=m=T:m=m.next=T,l=l.next}while(l!==null);m===null?g=m=r:m=m.next=r}else g=m=r;l={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:m,shared:f.shared,effects:f.effects},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=r:i.next=r,l.lastBaseUpdate=r}function Ul(i,r,l,f){var g=i.updateQueue;no=!1;var m=g.firstBaseUpdate,T=g.lastBaseUpdate,M=g.shared.pending;if(M!==null){g.shared.pending=null;var b=M,U=b.next;b.next=null,T===null?m=U:T.next=U,T=b;var K=i.alternate;K!==null&&(K=K.updateQueue,M=K.lastBaseUpdate,M!==T&&(M===null?K.firstBaseUpdate=U:M.next=U,K.lastBaseUpdate=b))}if(m!==null){var J=g.baseState;T=0,K=U=b=null,M=m;do{var q=M.lane,ce=M.eventTime;if((f&q)===q){K!==null&&(K=K.next={eventTime:ce,lane:0,tag:M.tag,payload:M.payload,callback:M.callback,next:null});e:{var me=i,ve=M;switch(q=r,ce=l,ve.tag){case 1:if(me=ve.payload,typeof me=="function"){J=me.call(ce,J,q);break e}J=me;break e;case 3:me.flags=me.flags&-65537|128;case 0:if(me=ve.payload,q=typeof me=="function"?me.call(ce,J,q):me,q==null)break e;J=Q({},J,q);break e;case 2:no=!0}}M.callback!==null&&M.lane!==0&&(i.flags|=64,q=g.effects,q===null?g.effects=[M]:q.push(M))}else ce={eventTime:ce,lane:q,tag:M.tag,payload:M.payload,callback:M.callback,next:null},K===null?(U=K=ce,b=J):K=K.next=ce,T|=q;if(M=M.next,M===null){if(M=g.shared.pending,M===null)break;q=M,M=q.next,q.next=null,g.lastBaseUpdate=q,g.shared.pending=null}}while(!0);if(K===null&&(b=J),g.baseState=b,g.firstBaseUpdate=U,g.lastBaseUpdate=K,r=g.shared.interleaved,r!==null){g=r;do T|=g.lane,g=g.next;while(g!==r)}else m===null&&(g.shared.lanes=0);Go|=T,i.lanes=T,i.memoizedState=J}}function Gg(i,r,l){if(i=r.effects,r.effects=null,i!==null)for(r=0;r<i.length;r++){var f=i[r],g=f.callback;if(g!==null){if(f.callback=null,f=l,typeof g!="function")throw Error(n(191,g));g.call(f)}}}var Ws={},si=Ji(Ws),Ys=Ji(Ws),zs=Ji(Ws);function Lo(i){if(i===Ws)throw Error(n(174));return i}function Pd(i,r){switch(tt(zs,r),tt(Ys,i),tt(si,Ws),i=r.nodeType,i){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Ru(null,"");break;default:i=i===8?r.parentNode:r,r=i.namespaceURI||null,i=i.tagName,r=Ru(r,i)}it(si),tt(si,r)}function Br(){it(si),it(Ys),it(zs)}function xg(i){Lo(zs.current);var r=Lo(si.current),l=Ru(r,i.type);r!==l&&(tt(Ys,i),tt(si,l))}function Rd(i){Ys.current===i&&(it(si),it(Ys))}var at=Ji(0);function Gl(i){for(var r=i;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Md=[];function kd(){for(var i=0;i<Md.length;i++)Md[i]._workInProgressVersionPrimary=null;Md.length=0}var xl=R.ReactCurrentDispatcher,Dd=R.ReactCurrentBatchConfig,Uo=0,lt=null,It=null,Ct=null,$l=!1,js=!1,Xs=0,tA=0;function $t(){throw Error(n(321))}function bd(i,r){if(r===null)return!1;for(var l=0;l<r.length&&l<i.length;l++)if(!Gn(i[l],r[l]))return!1;return!0}function Od(i,r,l,f,g,m){if(Uo=m,lt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,xl.current=i===null||i.memoizedState===null?rA:sA,i=l(f,g),js){m=0;do{if(js=!1,Xs=0,25<=m)throw Error(n(301));m+=1,Ct=It=null,r.updateQueue=null,xl.current=aA,i=l(f,g)}while(js)}if(xl.current=zl,r=It!==null&&It.next!==null,Uo=0,Ct=It=lt=null,$l=!1,r)throw Error(n(300));return i}function Nd(){var i=Xs!==0;return Xs=0,i}function ai(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ct===null?lt.memoizedState=Ct=i:Ct=Ct.next=i,Ct}function Pn(){if(It===null){var i=lt.alternate;i=i!==null?i.memoizedState:null}else i=It.next;var r=Ct===null?lt.memoizedState:Ct.next;if(r!==null)Ct=r,It=i;else{if(i===null)throw Error(n(310));It=i,i={memoizedState:It.memoizedState,baseState:It.baseState,baseQueue:It.baseQueue,queue:It.queue,next:null},Ct===null?lt.memoizedState=Ct=i:Ct=Ct.next=i}return Ct}function Vs(i,r){return typeof r=="function"?r(i):r}function Bd(i){var r=Pn(),l=r.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=i;var f=It,g=f.baseQueue,m=l.pending;if(m!==null){if(g!==null){var T=g.next;g.next=m.next,m.next=T}f.baseQueue=g=m,l.pending=null}if(g!==null){m=g.next,f=f.baseState;var M=T=null,b=null,U=m;do{var K=U.lane;if((Uo&K)===K)b!==null&&(b=b.next={lane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),f=U.hasEagerState?U.eagerState:i(f,U.action);else{var J={lane:K,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null};b===null?(M=b=J,T=f):b=b.next=J,lt.lanes|=K,Go|=K}U=U.next}while(U!==null&&U!==m);b===null?T=f:b.next=M,Gn(f,r.memoizedState)||(sn=!0),r.memoizedState=f,r.baseState=T,r.baseQueue=b,l.lastRenderedState=f}if(i=l.interleaved,i!==null){g=i;do m=g.lane,lt.lanes|=m,Go|=m,g=g.next;while(g!==i)}else g===null&&(l.lanes=0);return[r.memoizedState,l.dispatch]}function Hd(i){var r=Pn(),l=r.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=i;var f=l.dispatch,g=l.pending,m=r.memoizedState;if(g!==null){l.pending=null;var T=g=g.next;do m=i(m,T.action),T=T.next;while(T!==g);Gn(m,r.memoizedState)||(sn=!0),r.memoizedState=m,r.baseQueue===null&&(r.baseState=m),l.lastRenderedState=m}return[m,f]}function $g(){}function Wg(i,r){var l=lt,f=Pn(),g=r(),m=!Gn(f.memoizedState,g);if(m&&(f.memoizedState=g,sn=!0),f=f.queue,Fd(jg.bind(null,l,f,i),[i]),f.getSnapshot!==r||m||Ct!==null&&Ct.memoizedState.tag&1){if(l.flags|=2048,qs(9,zg.bind(null,l,f,g,r),void 0,null),Pt===null)throw Error(n(349));(Uo&30)!==0||Yg(l,r,g)}return g}function Yg(i,r,l){i.flags|=16384,i={getSnapshot:r,value:l},r=lt.updateQueue,r===null?(r={lastEffect:null,stores:null},lt.updateQueue=r,r.stores=[i]):(l=r.stores,l===null?r.stores=[i]:l.push(i))}function zg(i,r,l,f){r.value=l,r.getSnapshot=f,Xg(r)&&Vg(i)}function jg(i,r,l){return l(function(){Xg(r)&&Vg(i)})}function Xg(i){var r=i.getSnapshot;i=i.value;try{var l=r();return!Gn(i,l)}catch{return!0}}function Vg(i){var r=Ti(i,1);r!==null&&zn(r,i,1,-1)}function qg(i){var r=ai();return typeof i=="function"&&(i=i()),r.memoizedState=r.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vs,lastRenderedState:i},r.queue=i,i=i.dispatch=oA.bind(null,lt,i),[r.memoizedState,i]}function qs(i,r,l,f){return i={tag:i,create:r,destroy:l,deps:f,next:null},r=lt.updateQueue,r===null?(r={lastEffect:null,stores:null},lt.updateQueue=r,r.lastEffect=i.next=i):(l=r.lastEffect,l===null?r.lastEffect=i.next=i:(f=l.next,l.next=i,i.next=f,r.lastEffect=i)),i}function Zg(){return Pn().memoizedState}function Wl(i,r,l,f){var g=ai();lt.flags|=i,g.memoizedState=qs(1|r,l,void 0,f===void 0?null:f)}function Yl(i,r,l,f){var g=Pn();f=f===void 0?null:f;var m=void 0;if(It!==null){var T=It.memoizedState;if(m=T.destroy,f!==null&&bd(f,T.deps)){g.memoizedState=qs(r,l,m,f);return}}lt.flags|=i,g.memoizedState=qs(1|r,l,m,f)}function Kg(i,r){return Wl(8390656,8,i,r)}function Fd(i,r){return Yl(2048,8,i,r)}function Qg(i,r){return Yl(4,2,i,r)}function Jg(i,r){return Yl(4,4,i,r)}function em(i,r){if(typeof r=="function")return i=i(),r(i),function(){r(null)};if(r!=null)return i=i(),r.current=i,function(){r.current=null}}function tm(i,r,l){return l=l!=null?l.concat([i]):null,Yl(4,4,em.bind(null,r,i),l)}function Ld(){}function nm(i,r){var l=Pn();r=r===void 0?null:r;var f=l.memoizedState;return f!==null&&r!==null&&bd(r,f[1])?f[0]:(l.memoizedState=[i,r],i)}function im(i,r){var l=Pn();r=r===void 0?null:r;var f=l.memoizedState;return f!==null&&r!==null&&bd(r,f[1])?f[0]:(i=i(),l.memoizedState=[i,r],i)}function om(i,r,l){return(Uo&21)===0?(i.baseState&&(i.baseState=!1,sn=!0),i.memoizedState=l):(Gn(l,r)||(l=Np(),lt.lanes|=l,Go|=l,i.baseState=!0),r)}function nA(i,r){var l=ze;ze=l!==0&&4>l?l:4,i(!0);var f=Dd.transition;Dd.transition={};try{i(!1),r()}finally{ze=l,Dd.transition=f}}function rm(){return Pn().memoizedState}function iA(i,r,l){var f=ao(i);if(l={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null},sm(i))am(r,l);else if(l=Fg(i,r,l,f),l!==null){var g=Zt();zn(l,i,f,g),lm(l,r,f)}}function oA(i,r,l){var f=ao(i),g={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null};if(sm(i))am(r,g);else{var m=i.alternate;if(i.lanes===0&&(m===null||m.lanes===0)&&(m=r.lastRenderedReducer,m!==null))try{var T=r.lastRenderedState,M=m(T,l);if(g.hasEagerState=!0,g.eagerState=M,Gn(M,T)){var b=r.interleaved;b===null?(g.next=g,_d(r)):(g.next=b.next,b.next=g),r.interleaved=g;return}}catch{}finally{}l=Fg(i,r,g,f),l!==null&&(g=Zt(),zn(l,i,f,g),lm(l,r,f))}}function sm(i){var r=i.alternate;return i===lt||r!==null&&r===lt}function am(i,r){js=$l=!0;var l=i.pending;l===null?r.next=r:(r.next=l.next,l.next=r),i.pending=r}function lm(i,r,l){if((l&4194240)!==0){var f=r.lanes;f&=i.pendingLanes,l|=f,r.lanes=l,Gu(i,l)}}var zl={readContext:Cn,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useInsertionEffect:$t,useLayoutEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useMutableSource:$t,useSyncExternalStore:$t,useId:$t,unstable_isNewReconciler:!1},rA={readContext:Cn,useCallback:function(i,r){return ai().memoizedState=[i,r===void 0?null:r],i},useContext:Cn,useEffect:Kg,useImperativeHandle:function(i,r,l){return l=l!=null?l.concat([i]):null,Wl(4194308,4,em.bind(null,r,i),l)},useLayoutEffect:function(i,r){return Wl(4194308,4,i,r)},useInsertionEffect:function(i,r){return Wl(4,2,i,r)},useMemo:function(i,r){var l=ai();return r=r===void 0?null:r,i=i(),l.memoizedState=[i,r],i},useReducer:function(i,r,l){var f=ai();return r=l!==void 0?l(r):r,f.memoizedState=f.baseState=r,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:r},f.queue=i,i=i.dispatch=iA.bind(null,lt,i),[f.memoizedState,i]},useRef:function(i){var r=ai();return i={current:i},r.memoizedState=i},useState:qg,useDebugValue:Ld,useDeferredValue:function(i){return ai().memoizedState=i},useTransition:function(){var i=qg(!1),r=i[0];return i=nA.bind(null,i[1]),ai().memoizedState=i,[r,i]},useMutableSource:function(){},useSyncExternalStore:function(i,r,l){var f=lt,g=ai();if(rt){if(l===void 0)throw Error(n(407));l=l()}else{if(l=r(),Pt===null)throw Error(n(349));(Uo&30)!==0||Yg(f,r,l)}g.memoizedState=l;var m={value:l,getSnapshot:r};return g.queue=m,Kg(jg.bind(null,f,m,i),[i]),f.flags|=2048,qs(9,zg.bind(null,f,m,l,r),void 0,null),l},useId:function(){var i=ai(),r=Pt.identifierPrefix;if(rt){var l=Ii,f=Si;l=(f&~(1<<32-Un(f)-1)).toString(32)+l,r=":"+r+"R"+l,l=Xs++,0<l&&(r+="H"+l.toString(32)),r+=":"}else l=tA++,r=":"+r+"r"+l.toString(32)+":";return i.memoizedState=r},unstable_isNewReconciler:!1},sA={readContext:Cn,useCallback:nm,useContext:Cn,useEffect:Fd,useImperativeHandle:tm,useInsertionEffect:Qg,useLayoutEffect:Jg,useMemo:im,useReducer:Bd,useRef:Zg,useState:function(){return Bd(Vs)},useDebugValue:Ld,useDeferredValue:function(i){var r=Pn();return om(r,It.memoizedState,i)},useTransition:function(){var i=Bd(Vs)[0],r=Pn().memoizedState;return[i,r]},useMutableSource:$g,useSyncExternalStore:Wg,useId:rm,unstable_isNewReconciler:!1},aA={readContext:Cn,useCallback:nm,useContext:Cn,useEffect:Fd,useImperativeHandle:tm,useInsertionEffect:Qg,useLayoutEffect:Jg,useMemo:im,useReducer:Hd,useRef:Zg,useState:function(){return Hd(Vs)},useDebugValue:Ld,useDeferredValue:function(i){var r=Pn();return It===null?r.memoizedState=i:om(r,It.memoizedState,i)},useTransition:function(){var i=Hd(Vs)[0],r=Pn().memoizedState;return[i,r]},useMutableSource:$g,useSyncExternalStore:Wg,useId:rm,unstable_isNewReconciler:!1};function $n(i,r){if(i&&i.defaultProps){r=Q({},r),i=i.defaultProps;for(var l in i)r[l]===void 0&&(r[l]=i[l]);return r}return r}function Ud(i,r,l,f){r=i.memoizedState,l=l(f,r),l=l==null?r:Q({},r,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var jl={isMounted:function(i){return(i=i._reactInternals)?bo(i)===i:!1},enqueueSetState:function(i,r,l){i=i._reactInternals;var f=Zt(),g=ao(i),m=Ai(f,g);m.payload=r,l!=null&&(m.callback=l),r=io(i,m,g),r!==null&&(zn(r,i,g,f),Ll(r,i,g))},enqueueReplaceState:function(i,r,l){i=i._reactInternals;var f=Zt(),g=ao(i),m=Ai(f,g);m.tag=1,m.payload=r,l!=null&&(m.callback=l),r=io(i,m,g),r!==null&&(zn(r,i,g,f),Ll(r,i,g))},enqueueForceUpdate:function(i,r){i=i._reactInternals;var l=Zt(),f=ao(i),g=Ai(l,f);g.tag=2,r!=null&&(g.callback=r),r=io(i,g,f),r!==null&&(zn(r,i,f,l),Ll(r,i,f))}};function cm(i,r,l,f,g,m,T){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,m,T):r.prototype&&r.prototype.isPureReactComponent?!Bs(l,f)||!Bs(g,m):!0}function um(i,r,l){var f=!1,g=eo,m=r.contextType;return typeof m=="object"&&m!==null?m=Cn(m):(g=rn(r)?No:xt.current,f=r.contextTypes,m=(f=f!=null)?Rr(i,g):eo),r=new r(l,m),i.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=jl,i.stateNode=r,r._reactInternals=i,f&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=g,i.__reactInternalMemoizedMaskedChildContext=m),r}function dm(i,r,l,f){i=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,f),r.state!==i&&jl.enqueueReplaceState(r,r.state,null)}function Gd(i,r,l,f){var g=i.stateNode;g.props=l,g.state=i.memoizedState,g.refs={},Cd(i);var m=r.contextType;typeof m=="object"&&m!==null?g.context=Cn(m):(m=rn(r)?No:xt.current,g.context=Rr(i,m)),g.state=i.memoizedState,m=r.getDerivedStateFromProps,typeof m=="function"&&(Ud(i,r,m,l),g.state=i.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(r=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),r!==g.state&&jl.enqueueReplaceState(g,g.state,null),Ul(i,l,g,f),g.state=i.memoizedState),typeof g.componentDidMount=="function"&&(i.flags|=4194308)}function Hr(i,r){try{var l="",f=r;do l+=Me(f),f=f.return;while(f);var g=l}catch(m){g=`
Error generating stack: `+m.message+`
`+m.stack}return{value:i,source:r,stack:g,digest:null}}function xd(i,r,l){return{value:i,source:null,stack:l??null,digest:r??null}}function $d(i,r){try{console.error(r.value)}catch(l){setTimeout(function(){throw l})}}var lA=typeof WeakMap=="function"?WeakMap:Map;function fm(i,r,l){l=Ai(-1,l),l.tag=3,l.payload={element:null};var f=r.value;return l.callback=function(){Jl||(Jl=!0,of=f),$d(i,r)},l}function hm(i,r,l){l=Ai(-1,l),l.tag=3;var f=i.type.getDerivedStateFromError;if(typeof f=="function"){var g=r.value;l.payload=function(){return f(g)},l.callback=function(){$d(i,r)}}var m=i.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(l.callback=function(){$d(i,r),typeof f!="function"&&(ro===null?ro=new Set([this]):ro.add(this));var T=r.stack;this.componentDidCatch(r.value,{componentStack:T!==null?T:""})}),l}function pm(i,r,l){var f=i.pingCache;if(f===null){f=i.pingCache=new lA;var g=new Set;f.set(r,g)}else g=f.get(r),g===void 0&&(g=new Set,f.set(r,g));g.has(l)||(g.add(l),i=AA.bind(null,i,r,l),r.then(i,i))}function gm(i){do{var r;if((r=i.tag===13)&&(r=i.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return i;i=i.return}while(i!==null);return null}function mm(i,r,l,f,g){return(i.mode&1)===0?(i===r?i.flags|=65536:(i.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(r=Ai(-1,1),r.tag=2,io(l,r,1))),l.lanes|=1),i):(i.flags|=65536,i.lanes=g,i)}var cA=R.ReactCurrentOwner,sn=!1;function qt(i,r,l,f){r.child=i===null?Hg(r,null,l,f):br(r,i.child,l,f)}function ym(i,r,l,f,g){l=l.render;var m=r.ref;return Nr(r,g),f=Od(i,r,l,f,m,g),l=Nd(),i!==null&&!sn?(r.updateQueue=i.updateQueue,r.flags&=-2053,i.lanes&=~g,Ei(i,r,g)):(rt&&l&&md(r),r.flags|=1,qt(i,r,f,g),r.child)}function vm(i,r,l,f,g){if(i===null){var m=l.type;return typeof m=="function"&&!df(m)&&m.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(r.tag=15,r.type=m,Sm(i,r,m,f,g)):(i=rc(l.type,null,f,r,r.mode,g),i.ref=r.ref,i.return=r,r.child=i)}if(m=i.child,(i.lanes&g)===0){var T=m.memoizedProps;if(l=l.compare,l=l!==null?l:Bs,l(T,f)&&i.ref===r.ref)return Ei(i,r,g)}return r.flags|=1,i=co(m,f),i.ref=r.ref,i.return=r,r.child=i}function Sm(i,r,l,f,g){if(i!==null){var m=i.memoizedProps;if(Bs(m,f)&&i.ref===r.ref)if(sn=!1,r.pendingProps=f=m,(i.lanes&g)!==0)(i.flags&131072)!==0&&(sn=!0);else return r.lanes=i.lanes,Ei(i,r,g)}return Wd(i,r,l,f,g)}function Im(i,r,l){var f=r.pendingProps,g=f.children,m=i!==null?i.memoizedState:null;if(f.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},tt(Lr,gn),gn|=l;else{if((l&1073741824)===0)return i=m!==null?m.baseLanes|l:l,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:i,cachePool:null,transitions:null},r.updateQueue=null,tt(Lr,gn),gn|=i,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=m!==null?m.baseLanes:l,tt(Lr,gn),gn|=f}else m!==null?(f=m.baseLanes|l,r.memoizedState=null):f=l,tt(Lr,gn),gn|=f;return qt(i,r,g,l),r.child}function Tm(i,r){var l=r.ref;(i===null&&l!==null||i!==null&&i.ref!==l)&&(r.flags|=512,r.flags|=2097152)}function Wd(i,r,l,f,g){var m=rn(l)?No:xt.current;return m=Rr(r,m),Nr(r,g),l=Od(i,r,l,f,m,g),f=Nd(),i!==null&&!sn?(r.updateQueue=i.updateQueue,r.flags&=-2053,i.lanes&=~g,Ei(i,r,g)):(rt&&f&&md(r),r.flags|=1,qt(i,r,l,g),r.child)}function Am(i,r,l,f,g){if(rn(l)){var m=!0;kl(r)}else m=!1;if(Nr(r,g),r.stateNode===null)Vl(i,r),um(r,l,f),Gd(r,l,f,g),f=!0;else if(i===null){var T=r.stateNode,M=r.memoizedProps;T.props=M;var b=T.context,U=l.contextType;typeof U=="object"&&U!==null?U=Cn(U):(U=rn(l)?No:xt.current,U=Rr(r,U));var K=l.getDerivedStateFromProps,J=typeof K=="function"||typeof T.getSnapshotBeforeUpdate=="function";J||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(M!==f||b!==U)&&dm(r,T,f,U),no=!1;var q=r.memoizedState;T.state=q,Ul(r,f,T,g),b=r.memoizedState,M!==f||q!==b||on.current||no?(typeof K=="function"&&(Ud(r,l,K,f),b=r.memoizedState),(M=no||cm(r,l,M,f,q,b,U))?(J||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(r.flags|=4194308)):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=b),T.props=f,T.state=b,T.context=U,f=M):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{T=r.stateNode,Lg(i,r),M=r.memoizedProps,U=r.type===r.elementType?M:$n(r.type,M),T.props=U,J=r.pendingProps,q=T.context,b=l.contextType,typeof b=="object"&&b!==null?b=Cn(b):(b=rn(l)?No:xt.current,b=Rr(r,b));var ce=l.getDerivedStateFromProps;(K=typeof ce=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(M!==J||q!==b)&&dm(r,T,f,b),no=!1,q=r.memoizedState,T.state=q,Ul(r,f,T,g);var me=r.memoizedState;M!==J||q!==me||on.current||no?(typeof ce=="function"&&(Ud(r,l,ce,f),me=r.memoizedState),(U=no||cm(r,l,U,f,q,me,b)||!1)?(K||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(f,me,b),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(f,me,b)),typeof T.componentDidUpdate=="function"&&(r.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof T.componentDidUpdate!="function"||M===i.memoizedProps&&q===i.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||M===i.memoizedProps&&q===i.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=me),T.props=f,T.state=me,T.context=b,f=U):(typeof T.componentDidUpdate!="function"||M===i.memoizedProps&&q===i.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||M===i.memoizedProps&&q===i.memoizedState||(r.flags|=1024),f=!1)}return Yd(i,r,l,f,m,g)}function Yd(i,r,l,f,g,m){Tm(i,r);var T=(r.flags&128)!==0;if(!f&&!T)return g&&Pg(r,l,!1),Ei(i,r,m);f=r.stateNode,cA.current=r;var M=T&&typeof l.getDerivedStateFromError!="function"?null:f.render();return r.flags|=1,i!==null&&T?(r.child=br(r,i.child,null,m),r.child=br(r,null,M,m)):qt(i,r,M,m),r.memoizedState=f.state,g&&Pg(r,l,!0),r.child}function Em(i){var r=i.stateNode;r.pendingContext?_g(i,r.pendingContext,r.pendingContext!==r.context):r.context&&_g(i,r.context,!1),Pd(i,r.containerInfo)}function wm(i,r,l,f,g){return Dr(),Id(g),r.flags|=256,qt(i,r,l,f),r.child}var zd={dehydrated:null,treeContext:null,retryLane:0};function jd(i){return{baseLanes:i,cachePool:null,transitions:null}}function _m(i,r,l){var f=r.pendingProps,g=at.current,m=!1,T=(r.flags&128)!==0,M;if((M=T)||(M=i!==null&&i.memoizedState===null?!1:(g&2)!==0),M?(m=!0,r.flags&=-129):(i===null||i.memoizedState!==null)&&(g|=1),tt(at,g&1),i===null)return Sd(r),i=r.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((r.mode&1)===0?r.lanes=1:i.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(T=f.children,i=f.fallback,m?(f=r.mode,m=r.child,T={mode:"hidden",children:T},(f&1)===0&&m!==null?(m.childLanes=0,m.pendingProps=T):m=sc(T,f,0,null),i=Yo(i,f,l,null),m.return=r,i.return=r,m.sibling=i,r.child=m,r.child.memoizedState=jd(l),r.memoizedState=zd,i):Xd(r,T));if(g=i.memoizedState,g!==null&&(M=g.dehydrated,M!==null))return uA(i,r,T,f,M,g,l);if(m){m=f.fallback,T=r.mode,g=i.child,M=g.sibling;var b={mode:"hidden",children:f.children};return(T&1)===0&&r.child!==g?(f=r.child,f.childLanes=0,f.pendingProps=b,r.deletions=null):(f=co(g,b),f.subtreeFlags=g.subtreeFlags&14680064),M!==null?m=co(M,m):(m=Yo(m,T,l,null),m.flags|=2),m.return=r,f.return=r,f.sibling=m,r.child=f,f=m,m=r.child,T=i.child.memoizedState,T=T===null?jd(l):{baseLanes:T.baseLanes|l,cachePool:null,transitions:T.transitions},m.memoizedState=T,m.childLanes=i.childLanes&~l,r.memoizedState=zd,f}return m=i.child,i=m.sibling,f=co(m,{mode:"visible",children:f.children}),(r.mode&1)===0&&(f.lanes=l),f.return=r,f.sibling=null,i!==null&&(l=r.deletions,l===null?(r.deletions=[i],r.flags|=16):l.push(i)),r.child=f,r.memoizedState=null,f}function Xd(i,r){return r=sc({mode:"visible",children:r},i.mode,0,null),r.return=i,i.child=r}function Xl(i,r,l,f){return f!==null&&Id(f),br(r,i.child,null,l),i=Xd(r,r.pendingProps.children),i.flags|=2,r.memoizedState=null,i}function uA(i,r,l,f,g,m,T){if(l)return r.flags&256?(r.flags&=-257,f=xd(Error(n(422))),Xl(i,r,T,f)):r.memoizedState!==null?(r.child=i.child,r.flags|=128,null):(m=f.fallback,g=r.mode,f=sc({mode:"visible",children:f.children},g,0,null),m=Yo(m,g,T,null),m.flags|=2,f.return=r,m.return=r,f.sibling=m,r.child=f,(r.mode&1)!==0&&br(r,i.child,null,T),r.child.memoizedState=jd(T),r.memoizedState=zd,m);if((r.mode&1)===0)return Xl(i,r,T,null);if(g.data==="$!"){if(f=g.nextSibling&&g.nextSibling.dataset,f)var M=f.dgst;return f=M,m=Error(n(419)),f=xd(m,f,void 0),Xl(i,r,T,f)}if(M=(T&i.childLanes)!==0,sn||M){if(f=Pt,f!==null){switch(T&-T){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=(g&(f.suspendedLanes|T))!==0?0:g,g!==0&&g!==m.retryLane&&(m.retryLane=g,Ti(i,g),zn(f,i,g,-1))}return uf(),f=xd(Error(n(421))),Xl(i,r,T,f)}return g.data==="$?"?(r.flags|=128,r.child=i.child,r=EA.bind(null,i),g._reactRetry=r,null):(i=m.treeContext,pn=Qi(g.nextSibling),hn=r,rt=!0,xn=null,i!==null&&(wn[_n++]=Si,wn[_n++]=Ii,wn[_n++]=Bo,Si=i.id,Ii=i.overflow,Bo=r),r=Xd(r,f.children),r.flags|=4096,r)}function Cm(i,r,l){i.lanes|=r;var f=i.alternate;f!==null&&(f.lanes|=r),wd(i.return,r,l)}function Vd(i,r,l,f,g){var m=i.memoizedState;m===null?i.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:l,tailMode:g}:(m.isBackwards=r,m.rendering=null,m.renderingStartTime=0,m.last=f,m.tail=l,m.tailMode=g)}function Pm(i,r,l){var f=r.pendingProps,g=f.revealOrder,m=f.tail;if(qt(i,r,f.children,l),f=at.current,(f&2)!==0)f=f&1|2,r.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=r.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Cm(i,l,r);else if(i.tag===19)Cm(i,l,r);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break e;for(;i.sibling===null;){if(i.return===null||i.return===r)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}f&=1}if(tt(at,f),(r.mode&1)===0)r.memoizedState=null;else switch(g){case"forwards":for(l=r.child,g=null;l!==null;)i=l.alternate,i!==null&&Gl(i)===null&&(g=l),l=l.sibling;l=g,l===null?(g=r.child,r.child=null):(g=l.sibling,l.sibling=null),Vd(r,!1,g,l,m);break;case"backwards":for(l=null,g=r.child,r.child=null;g!==null;){if(i=g.alternate,i!==null&&Gl(i)===null){r.child=g;break}i=g.sibling,g.sibling=l,l=g,g=i}Vd(r,!0,l,null,m);break;case"together":Vd(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Vl(i,r){(r.mode&1)===0&&i!==null&&(i.alternate=null,r.alternate=null,r.flags|=2)}function Ei(i,r,l){if(i!==null&&(r.dependencies=i.dependencies),Go|=r.lanes,(l&r.childLanes)===0)return null;if(i!==null&&r.child!==i.child)throw Error(n(153));if(r.child!==null){for(i=r.child,l=co(i,i.pendingProps),r.child=l,l.return=r;i.sibling!==null;)i=i.sibling,l=l.sibling=co(i,i.pendingProps),l.return=r;l.sibling=null}return r.child}function dA(i,r,l){switch(r.tag){case 3:Em(r),Dr();break;case 5:xg(r);break;case 1:rn(r.type)&&kl(r);break;case 4:Pd(r,r.stateNode.containerInfo);break;case 10:var f=r.type._context,g=r.memoizedProps.value;tt(Hl,f._currentValue),f._currentValue=g;break;case 13:if(f=r.memoizedState,f!==null)return f.dehydrated!==null?(tt(at,at.current&1),r.flags|=128,null):(l&r.child.childLanes)!==0?_m(i,r,l):(tt(at,at.current&1),i=Ei(i,r,l),i!==null?i.sibling:null);tt(at,at.current&1);break;case 19:if(f=(l&r.childLanes)!==0,(i.flags&128)!==0){if(f)return Pm(i,r,l);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),tt(at,at.current),f)break;return null;case 22:case 23:return r.lanes=0,Im(i,r,l)}return Ei(i,r,l)}var Rm,qd,Mm,km;Rm=function(i,r){for(var l=r.child;l!==null;){if(l.tag===5||l.tag===6)i.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return;l=l.return}l.sibling.return=l.return,l=l.sibling}},qd=function(){},Mm=function(i,r,l,f){var g=i.memoizedProps;if(g!==f){i=r.stateNode,Lo(si.current);var m=null;switch(l){case"input":g=et(i,g),f=et(i,f),m=[];break;case"select":g=Q({},g,{value:void 0}),f=Q({},f,{value:void 0}),m=[];break;case"textarea":g=Do(i,g),f=Do(i,f),m=[];break;default:typeof g.onClick!="function"&&typeof f.onClick=="function"&&(i.onclick=Pl)}Mu(l,f);var T;l=null;for(U in g)if(!f.hasOwnProperty(U)&&g.hasOwnProperty(U)&&g[U]!=null)if(U==="style"){var M=g[U];for(T in M)M.hasOwnProperty(T)&&(l||(l={}),l[T]="")}else U!=="dangerouslySetInnerHTML"&&U!=="children"&&U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&U!=="autoFocus"&&(s.hasOwnProperty(U)?m||(m=[]):(m=m||[]).push(U,null));for(U in f){var b=f[U];if(M=g!=null?g[U]:void 0,f.hasOwnProperty(U)&&b!==M&&(b!=null||M!=null))if(U==="style")if(M){for(T in M)!M.hasOwnProperty(T)||b&&b.hasOwnProperty(T)||(l||(l={}),l[T]="");for(T in b)b.hasOwnProperty(T)&&M[T]!==b[T]&&(l||(l={}),l[T]=b[T])}else l||(m||(m=[]),m.push(U,l)),l=b;else U==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,M=M?M.__html:void 0,b!=null&&M!==b&&(m=m||[]).push(U,b)):U==="children"?typeof b!="string"&&typeof b!="number"||(m=m||[]).push(U,""+b):U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&(s.hasOwnProperty(U)?(b!=null&&U==="onScroll"&&nt("scroll",i),m||M===b||(m=[])):(m=m||[]).push(U,b))}l&&(m=m||[]).push("style",l);var U=m;(r.updateQueue=U)&&(r.flags|=4)}},km=function(i,r,l,f){l!==f&&(r.flags|=4)};function Zs(i,r){if(!rt)switch(i.tailMode){case"hidden":r=i.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?r||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function Wt(i){var r=i.alternate!==null&&i.alternate.child===i.child,l=0,f=0;if(r)for(var g=i.child;g!==null;)l|=g.lanes|g.childLanes,f|=g.subtreeFlags&14680064,f|=g.flags&14680064,g.return=i,g=g.sibling;else for(g=i.child;g!==null;)l|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=i,g=g.sibling;return i.subtreeFlags|=f,i.childLanes=l,r}function fA(i,r,l){var f=r.pendingProps;switch(yd(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(r),null;case 1:return rn(r.type)&&Ml(),Wt(r),null;case 3:return f=r.stateNode,Br(),it(on),it(xt),kd(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(i===null||i.child===null)&&(Nl(r)?r.flags|=4:i===null||i.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,xn!==null&&(af(xn),xn=null))),qd(i,r),Wt(r),null;case 5:Rd(r);var g=Lo(zs.current);if(l=r.type,i!==null&&r.stateNode!=null)Mm(i,r,l,f,g),i.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!f){if(r.stateNode===null)throw Error(n(166));return Wt(r),null}if(i=Lo(si.current),Nl(r)){f=r.stateNode,l=r.type;var m=r.memoizedProps;switch(f[ri]=r,f[Gs]=m,i=(r.mode&1)!==0,l){case"dialog":nt("cancel",f),nt("close",f);break;case"iframe":case"object":case"embed":nt("load",f);break;case"video":case"audio":for(g=0;g<Fs.length;g++)nt(Fs[g],f);break;case"source":nt("error",f);break;case"img":case"image":case"link":nt("error",f),nt("load",f);break;case"details":nt("toggle",f);break;case"input":Ze(f,m),nt("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!m.multiple},nt("invalid",f);break;case"textarea":hp(f,m),nt("invalid",f)}Mu(l,m),g=null;for(var T in m)if(m.hasOwnProperty(T)){var M=m[T];T==="children"?typeof M=="string"?f.textContent!==M&&(m.suppressHydrationWarning!==!0&&Cl(f.textContent,M,i),g=["children",M]):typeof M=="number"&&f.textContent!==""+M&&(m.suppressHydrationWarning!==!0&&Cl(f.textContent,M,i),g=["children",""+M]):s.hasOwnProperty(T)&&M!=null&&T==="onScroll"&&nt("scroll",f)}switch(l){case"input":Ne(f),En(f,m,!0);break;case"textarea":Ne(f),gp(f);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(f.onclick=Pl)}f=g,r.updateQueue=f,f!==null&&(r.flags|=4)}else{T=g.nodeType===9?g:g.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=mp(l)),i==="http://www.w3.org/1999/xhtml"?l==="script"?(i=T.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof f.is=="string"?i=T.createElement(l,{is:f.is}):(i=T.createElement(l),l==="select"&&(T=i,f.multiple?T.multiple=!0:f.size&&(T.size=f.size))):i=T.createElementNS(i,l),i[ri]=r,i[Gs]=f,Rm(i,r,!1,!1),r.stateNode=i;e:{switch(T=ku(l,f),l){case"dialog":nt("cancel",i),nt("close",i),g=f;break;case"iframe":case"object":case"embed":nt("load",i),g=f;break;case"video":case"audio":for(g=0;g<Fs.length;g++)nt(Fs[g],i);g=f;break;case"source":nt("error",i),g=f;break;case"img":case"image":case"link":nt("error",i),nt("load",i),g=f;break;case"details":nt("toggle",i),g=f;break;case"input":Ze(i,f),g=et(i,f),nt("invalid",i);break;case"option":g=f;break;case"select":i._wrapperState={wasMultiple:!!f.multiple},g=Q({},f,{value:void 0}),nt("invalid",i);break;case"textarea":hp(i,f),g=Do(i,f),nt("invalid",i);break;default:g=f}Mu(l,g),M=g;for(m in M)if(M.hasOwnProperty(m)){var b=M[m];m==="style"?Sp(i,b):m==="dangerouslySetInnerHTML"?(b=b?b.__html:void 0,b!=null&&yp(i,b)):m==="children"?typeof b=="string"?(l!=="textarea"||b!=="")&&vs(i,b):typeof b=="number"&&vs(i,""+b):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(s.hasOwnProperty(m)?b!=null&&m==="onScroll"&&nt("scroll",i):b!=null&&P(i,m,b,T))}switch(l){case"input":Ne(i),En(i,f,!1);break;case"textarea":Ne(i),gp(i);break;case"option":f.value!=null&&i.setAttribute("value",""+_e(f.value));break;case"select":i.multiple=!!f.multiple,m=f.value,m!=null?zi(i,!!f.multiple,m,!1):f.defaultValue!=null&&zi(i,!!f.multiple,f.defaultValue,!0);break;default:typeof g.onClick=="function"&&(i.onclick=Pl)}switch(l){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Wt(r),null;case 6:if(i&&r.stateNode!=null)km(i,r,i.memoizedProps,f);else{if(typeof f!="string"&&r.stateNode===null)throw Error(n(166));if(l=Lo(zs.current),Lo(si.current),Nl(r)){if(f=r.stateNode,l=r.memoizedProps,f[ri]=r,(m=f.nodeValue!==l)&&(i=hn,i!==null))switch(i.tag){case 3:Cl(f.nodeValue,l,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&Cl(f.nodeValue,l,(i.mode&1)!==0)}m&&(r.flags|=4)}else f=(l.nodeType===9?l:l.ownerDocument).createTextNode(f),f[ri]=r,r.stateNode=f}return Wt(r),null;case 13:if(it(at),f=r.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(rt&&pn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)Og(),Dr(),r.flags|=98560,m=!1;else if(m=Nl(r),f!==null&&f.dehydrated!==null){if(i===null){if(!m)throw Error(n(318));if(m=r.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(n(317));m[ri]=r}else Dr(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Wt(r),m=!1}else xn!==null&&(af(xn),xn=null),m=!0;if(!m)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=l,r):(f=f!==null,f!==(i!==null&&i.memoizedState!==null)&&f&&(r.child.flags|=8192,(r.mode&1)!==0&&(i===null||(at.current&1)!==0?Tt===0&&(Tt=3):uf())),r.updateQueue!==null&&(r.flags|=4),Wt(r),null);case 4:return Br(),qd(i,r),i===null&&Ls(r.stateNode.containerInfo),Wt(r),null;case 10:return Ed(r.type._context),Wt(r),null;case 17:return rn(r.type)&&Ml(),Wt(r),null;case 19:if(it(at),m=r.memoizedState,m===null)return Wt(r),null;if(f=(r.flags&128)!==0,T=m.rendering,T===null)if(f)Zs(m,!1);else{if(Tt!==0||i!==null&&(i.flags&128)!==0)for(i=r.child;i!==null;){if(T=Gl(i),T!==null){for(r.flags|=128,Zs(m,!1),f=T.updateQueue,f!==null&&(r.updateQueue=f,r.flags|=4),r.subtreeFlags=0,f=l,l=r.child;l!==null;)m=l,i=f,m.flags&=14680066,T=m.alternate,T===null?(m.childLanes=0,m.lanes=i,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=T.childLanes,m.lanes=T.lanes,m.child=T.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=T.memoizedProps,m.memoizedState=T.memoizedState,m.updateQueue=T.updateQueue,m.type=T.type,i=T.dependencies,m.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),l=l.sibling;return tt(at,at.current&1|2),r.child}i=i.sibling}m.tail!==null&&ft()>Ur&&(r.flags|=128,f=!0,Zs(m,!1),r.lanes=4194304)}else{if(!f)if(i=Gl(T),i!==null){if(r.flags|=128,f=!0,l=i.updateQueue,l!==null&&(r.updateQueue=l,r.flags|=4),Zs(m,!0),m.tail===null&&m.tailMode==="hidden"&&!T.alternate&&!rt)return Wt(r),null}else 2*ft()-m.renderingStartTime>Ur&&l!==1073741824&&(r.flags|=128,f=!0,Zs(m,!1),r.lanes=4194304);m.isBackwards?(T.sibling=r.child,r.child=T):(l=m.last,l!==null?l.sibling=T:r.child=T,m.last=T)}return m.tail!==null?(r=m.tail,m.rendering=r,m.tail=r.sibling,m.renderingStartTime=ft(),r.sibling=null,l=at.current,tt(at,f?l&1|2:l&1),r):(Wt(r),null);case 22:case 23:return cf(),f=r.memoizedState!==null,i!==null&&i.memoizedState!==null!==f&&(r.flags|=8192),f&&(r.mode&1)!==0?(gn&1073741824)!==0&&(Wt(r),r.subtreeFlags&6&&(r.flags|=8192)):Wt(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function hA(i,r){switch(yd(r),r.tag){case 1:return rn(r.type)&&Ml(),i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 3:return Br(),it(on),it(xt),kd(),i=r.flags,(i&65536)!==0&&(i&128)===0?(r.flags=i&-65537|128,r):null;case 5:return Rd(r),null;case 13:if(it(at),i=r.memoizedState,i!==null&&i.dehydrated!==null){if(r.alternate===null)throw Error(n(340));Dr()}return i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 19:return it(at),null;case 4:return Br(),null;case 10:return Ed(r.type._context),null;case 22:case 23:return cf(),null;case 24:return null;default:return null}}var ql=!1,Yt=!1,pA=typeof WeakSet=="function"?WeakSet:Set,he=null;function Fr(i,r){var l=i.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(f){dt(i,r,f)}else l.current=null}function Zd(i,r,l){try{l()}catch(f){dt(i,r,f)}}var Dm=!1;function gA(i,r){if(ld=gl,i=cg(),ed(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else e:{l=(l=i.ownerDocument)&&l.defaultView||window;var f=l.getSelection&&l.getSelection();if(f&&f.rangeCount!==0){l=f.anchorNode;var g=f.anchorOffset,m=f.focusNode;f=f.focusOffset;try{l.nodeType,m.nodeType}catch{l=null;break e}var T=0,M=-1,b=-1,U=0,K=0,J=i,q=null;t:for(;;){for(var ce;J!==l||g!==0&&J.nodeType!==3||(M=T+g),J!==m||f!==0&&J.nodeType!==3||(b=T+f),J.nodeType===3&&(T+=J.nodeValue.length),(ce=J.firstChild)!==null;)q=J,J=ce;for(;;){if(J===i)break t;if(q===l&&++U===g&&(M=T),q===m&&++K===f&&(b=T),(ce=J.nextSibling)!==null)break;J=q,q=J.parentNode}J=ce}l=M===-1||b===-1?null:{start:M,end:b}}else l=null}l=l||{start:0,end:0}}else l=null;for(cd={focusedElem:i,selectionRange:l},gl=!1,he=r;he!==null;)if(r=he,i=r.child,(r.subtreeFlags&1028)!==0&&i!==null)i.return=r,he=i;else for(;he!==null;){r=he;try{var me=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(me!==null){var ve=me.memoizedProps,ht=me.memoizedState,H=r.stateNode,B=H.getSnapshotBeforeUpdate(r.elementType===r.type?ve:$n(r.type,ve),ht);H.__reactInternalSnapshotBeforeUpdate=B}break;case 3:var L=r.stateNode.containerInfo;L.nodeType===1?L.textContent="":L.nodeType===9&&L.documentElement&&L.removeChild(L.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(oe){dt(r,r.return,oe)}if(i=r.sibling,i!==null){i.return=r.return,he=i;break}he=r.return}return me=Dm,Dm=!1,me}function Ks(i,r,l){var f=r.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var g=f=f.next;do{if((g.tag&i)===i){var m=g.destroy;g.destroy=void 0,m!==void 0&&Zd(r,l,m)}g=g.next}while(g!==f)}}function Zl(i,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var l=r=r.next;do{if((l.tag&i)===i){var f=l.create;l.destroy=f()}l=l.next}while(l!==r)}}function Kd(i){var r=i.ref;if(r!==null){var l=i.stateNode;switch(i.tag){case 5:i=l;break;default:i=l}typeof r=="function"?r(i):r.current=i}}function bm(i){var r=i.alternate;r!==null&&(i.alternate=null,bm(r)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(r=i.stateNode,r!==null&&(delete r[ri],delete r[Gs],delete r[hd],delete r[KT],delete r[QT])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function Om(i){return i.tag===5||i.tag===3||i.tag===4}function Nm(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||Om(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Qd(i,r,l){var f=i.tag;if(f===5||f===6)i=i.stateNode,r?l.nodeType===8?l.parentNode.insertBefore(i,r):l.insertBefore(i,r):(l.nodeType===8?(r=l.parentNode,r.insertBefore(i,l)):(r=l,r.appendChild(i)),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=Pl));else if(f!==4&&(i=i.child,i!==null))for(Qd(i,r,l),i=i.sibling;i!==null;)Qd(i,r,l),i=i.sibling}function Jd(i,r,l){var f=i.tag;if(f===5||f===6)i=i.stateNode,r?l.insertBefore(i,r):l.appendChild(i);else if(f!==4&&(i=i.child,i!==null))for(Jd(i,r,l),i=i.sibling;i!==null;)Jd(i,r,l),i=i.sibling}var Nt=null,Wn=!1;function oo(i,r,l){for(l=l.child;l!==null;)Bm(i,r,l),l=l.sibling}function Bm(i,r,l){if(oi&&typeof oi.onCommitFiberUnmount=="function")try{oi.onCommitFiberUnmount(cl,l)}catch{}switch(l.tag){case 5:Yt||Fr(l,r);case 6:var f=Nt,g=Wn;Nt=null,oo(i,r,l),Nt=f,Wn=g,Nt!==null&&(Wn?(i=Nt,l=l.stateNode,i.nodeType===8?i.parentNode.removeChild(l):i.removeChild(l)):Nt.removeChild(l.stateNode));break;case 18:Nt!==null&&(Wn?(i=Nt,l=l.stateNode,i.nodeType===8?fd(i.parentNode,l):i.nodeType===1&&fd(i,l),Ms(i)):fd(Nt,l.stateNode));break;case 4:f=Nt,g=Wn,Nt=l.stateNode.containerInfo,Wn=!0,oo(i,r,l),Nt=f,Wn=g;break;case 0:case 11:case 14:case 15:if(!Yt&&(f=l.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){g=f=f.next;do{var m=g,T=m.destroy;m=m.tag,T!==void 0&&((m&2)!==0||(m&4)!==0)&&Zd(l,r,T),g=g.next}while(g!==f)}oo(i,r,l);break;case 1:if(!Yt&&(Fr(l,r),f=l.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=l.memoizedProps,f.state=l.memoizedState,f.componentWillUnmount()}catch(M){dt(l,r,M)}oo(i,r,l);break;case 21:oo(i,r,l);break;case 22:l.mode&1?(Yt=(f=Yt)||l.memoizedState!==null,oo(i,r,l),Yt=f):oo(i,r,l);break;default:oo(i,r,l)}}function Hm(i){var r=i.updateQueue;if(r!==null){i.updateQueue=null;var l=i.stateNode;l===null&&(l=i.stateNode=new pA),r.forEach(function(f){var g=wA.bind(null,i,f);l.has(f)||(l.add(f),f.then(g,g))})}}function Yn(i,r){var l=r.deletions;if(l!==null)for(var f=0;f<l.length;f++){var g=l[f];try{var m=i,T=r,M=T;e:for(;M!==null;){switch(M.tag){case 5:Nt=M.stateNode,Wn=!1;break e;case 3:Nt=M.stateNode.containerInfo,Wn=!0;break e;case 4:Nt=M.stateNode.containerInfo,Wn=!0;break e}M=M.return}if(Nt===null)throw Error(n(160));Bm(m,T,g),Nt=null,Wn=!1;var b=g.alternate;b!==null&&(b.return=null),g.return=null}catch(U){dt(g,r,U)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)Fm(r,i),r=r.sibling}function Fm(i,r){var l=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Yn(r,i),li(i),f&4){try{Ks(3,i,i.return),Zl(3,i)}catch(ve){dt(i,i.return,ve)}try{Ks(5,i,i.return)}catch(ve){dt(i,i.return,ve)}}break;case 1:Yn(r,i),li(i),f&512&&l!==null&&Fr(l,l.return);break;case 5:if(Yn(r,i),li(i),f&512&&l!==null&&Fr(l,l.return),i.flags&32){var g=i.stateNode;try{vs(g,"")}catch(ve){dt(i,i.return,ve)}}if(f&4&&(g=i.stateNode,g!=null)){var m=i.memoizedProps,T=l!==null?l.memoizedProps:m,M=i.type,b=i.updateQueue;if(i.updateQueue=null,b!==null)try{M==="input"&&m.type==="radio"&&m.name!=null&&An(g,m),ku(M,T);var U=ku(M,m);for(T=0;T<b.length;T+=2){var K=b[T],J=b[T+1];K==="style"?Sp(g,J):K==="dangerouslySetInnerHTML"?yp(g,J):K==="children"?vs(g,J):P(g,K,J,U)}switch(M){case"input":nn(g,m);break;case"textarea":pp(g,m);break;case"select":var q=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!m.multiple;var ce=m.value;ce!=null?zi(g,!!m.multiple,ce,!1):q!==!!m.multiple&&(m.defaultValue!=null?zi(g,!!m.multiple,m.defaultValue,!0):zi(g,!!m.multiple,m.multiple?[]:"",!1))}g[Gs]=m}catch(ve){dt(i,i.return,ve)}}break;case 6:if(Yn(r,i),li(i),f&4){if(i.stateNode===null)throw Error(n(162));g=i.stateNode,m=i.memoizedProps;try{g.nodeValue=m}catch(ve){dt(i,i.return,ve)}}break;case 3:if(Yn(r,i),li(i),f&4&&l!==null&&l.memoizedState.isDehydrated)try{Ms(r.containerInfo)}catch(ve){dt(i,i.return,ve)}break;case 4:Yn(r,i),li(i);break;case 13:Yn(r,i),li(i),g=i.child,g.flags&8192&&(m=g.memoizedState!==null,g.stateNode.isHidden=m,!m||g.alternate!==null&&g.alternate.memoizedState!==null||(nf=ft())),f&4&&Hm(i);break;case 22:if(K=l!==null&&l.memoizedState!==null,i.mode&1?(Yt=(U=Yt)||K,Yn(r,i),Yt=U):Yn(r,i),li(i),f&8192){if(U=i.memoizedState!==null,(i.stateNode.isHidden=U)&&!K&&(i.mode&1)!==0)for(he=i,K=i.child;K!==null;){for(J=he=K;he!==null;){switch(q=he,ce=q.child,q.tag){case 0:case 11:case 14:case 15:Ks(4,q,q.return);break;case 1:Fr(q,q.return);var me=q.stateNode;if(typeof me.componentWillUnmount=="function"){f=q,l=q.return;try{r=f,me.props=r.memoizedProps,me.state=r.memoizedState,me.componentWillUnmount()}catch(ve){dt(f,l,ve)}}break;case 5:Fr(q,q.return);break;case 22:if(q.memoizedState!==null){Gm(J);continue}}ce!==null?(ce.return=q,he=ce):Gm(J)}K=K.sibling}e:for(K=null,J=i;;){if(J.tag===5){if(K===null){K=J;try{g=J.stateNode,U?(m=g.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(M=J.stateNode,b=J.memoizedProps.style,T=b!=null&&b.hasOwnProperty("display")?b.display:null,M.style.display=vp("display",T))}catch(ve){dt(i,i.return,ve)}}}else if(J.tag===6){if(K===null)try{J.stateNode.nodeValue=U?"":J.memoizedProps}catch(ve){dt(i,i.return,ve)}}else if((J.tag!==22&&J.tag!==23||J.memoizedState===null||J===i)&&J.child!==null){J.child.return=J,J=J.child;continue}if(J===i)break e;for(;J.sibling===null;){if(J.return===null||J.return===i)break e;K===J&&(K=null),J=J.return}K===J&&(K=null),J.sibling.return=J.return,J=J.sibling}}break;case 19:Yn(r,i),li(i),f&4&&Hm(i);break;case 21:break;default:Yn(r,i),li(i)}}function li(i){var r=i.flags;if(r&2){try{e:{for(var l=i.return;l!==null;){if(Om(l)){var f=l;break e}l=l.return}throw Error(n(160))}switch(f.tag){case 5:var g=f.stateNode;f.flags&32&&(vs(g,""),f.flags&=-33);var m=Nm(i);Jd(i,m,g);break;case 3:case 4:var T=f.stateNode.containerInfo,M=Nm(i);Qd(i,M,T);break;default:throw Error(n(161))}}catch(b){dt(i,i.return,b)}i.flags&=-3}r&4096&&(i.flags&=-4097)}function mA(i,r,l){he=i,Lm(i)}function Lm(i,r,l){for(var f=(i.mode&1)!==0;he!==null;){var g=he,m=g.child;if(g.tag===22&&f){var T=g.memoizedState!==null||ql;if(!T){var M=g.alternate,b=M!==null&&M.memoizedState!==null||Yt;M=ql;var U=Yt;if(ql=T,(Yt=b)&&!U)for(he=g;he!==null;)T=he,b=T.child,T.tag===22&&T.memoizedState!==null?xm(g):b!==null?(b.return=T,he=b):xm(g);for(;m!==null;)he=m,Lm(m),m=m.sibling;he=g,ql=M,Yt=U}Um(i)}else(g.subtreeFlags&8772)!==0&&m!==null?(m.return=g,he=m):Um(i)}}function Um(i){for(;he!==null;){var r=he;if((r.flags&8772)!==0){var l=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:Yt||Zl(5,r);break;case 1:var f=r.stateNode;if(r.flags&4&&!Yt)if(l===null)f.componentDidMount();else{var g=r.elementType===r.type?l.memoizedProps:$n(r.type,l.memoizedProps);f.componentDidUpdate(g,l.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var m=r.updateQueue;m!==null&&Gg(r,m,f);break;case 3:var T=r.updateQueue;if(T!==null){if(l=null,r.child!==null)switch(r.child.tag){case 5:l=r.child.stateNode;break;case 1:l=r.child.stateNode}Gg(r,T,l)}break;case 5:var M=r.stateNode;if(l===null&&r.flags&4){l=M;var b=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":b.autoFocus&&l.focus();break;case"img":b.src&&(l.src=b.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var U=r.alternate;if(U!==null){var K=U.memoizedState;if(K!==null){var J=K.dehydrated;J!==null&&Ms(J)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Yt||r.flags&512&&Kd(r)}catch(q){dt(r,r.return,q)}}if(r===i){he=null;break}if(l=r.sibling,l!==null){l.return=r.return,he=l;break}he=r.return}}function Gm(i){for(;he!==null;){var r=he;if(r===i){he=null;break}var l=r.sibling;if(l!==null){l.return=r.return,he=l;break}he=r.return}}function xm(i){for(;he!==null;){var r=he;try{switch(r.tag){case 0:case 11:case 15:var l=r.return;try{Zl(4,r)}catch(b){dt(r,l,b)}break;case 1:var f=r.stateNode;if(typeof f.componentDidMount=="function"){var g=r.return;try{f.componentDidMount()}catch(b){dt(r,g,b)}}var m=r.return;try{Kd(r)}catch(b){dt(r,m,b)}break;case 5:var T=r.return;try{Kd(r)}catch(b){dt(r,T,b)}}}catch(b){dt(r,r.return,b)}if(r===i){he=null;break}var M=r.sibling;if(M!==null){M.return=r.return,he=M;break}he=r.return}}var yA=Math.ceil,Kl=R.ReactCurrentDispatcher,ef=R.ReactCurrentOwner,Rn=R.ReactCurrentBatchConfig,xe=0,Pt=null,yt=null,Bt=0,gn=0,Lr=Ji(0),Tt=0,Qs=null,Go=0,Ql=0,tf=0,Js=null,an=null,nf=0,Ur=1/0,wi=null,Jl=!1,of=null,ro=null,ec=!1,so=null,tc=0,ea=0,rf=null,nc=-1,ic=0;function Zt(){return(xe&6)!==0?ft():nc!==-1?nc:nc=ft()}function ao(i){return(i.mode&1)===0?1:(xe&2)!==0&&Bt!==0?Bt&-Bt:eA.transition!==null?(ic===0&&(ic=Np()),ic):(i=ze,i!==0||(i=window.event,i=i===void 0?16:Wp(i.type)),i)}function zn(i,r,l,f){if(50<ea)throw ea=0,rf=null,Error(n(185));ws(i,l,f),((xe&2)===0||i!==Pt)&&(i===Pt&&((xe&2)===0&&(Ql|=l),Tt===4&&lo(i,Bt)),ln(i,f),l===1&&xe===0&&(r.mode&1)===0&&(Ur=ft()+500,Dl&&to()))}function ln(i,r){var l=i.callbackNode;eT(i,r);var f=fl(i,i===Pt?Bt:0);if(f===0)l!==null&&Dp(l),i.callbackNode=null,i.callbackPriority=0;else if(r=f&-f,i.callbackPriority!==r){if(l!=null&&Dp(l),r===1)i.tag===0?JT(Wm.bind(null,i)):Rg(Wm.bind(null,i)),qT(function(){(xe&6)===0&&to()}),l=null;else{switch(Bp(f)){case 1:l=Fu;break;case 4:l=bp;break;case 16:l=ll;break;case 536870912:l=Op;break;default:l=ll}l=Km(l,$m.bind(null,i))}i.callbackPriority=r,i.callbackNode=l}}function $m(i,r){if(nc=-1,ic=0,(xe&6)!==0)throw Error(n(327));var l=i.callbackNode;if(Gr()&&i.callbackNode!==l)return null;var f=fl(i,i===Pt?Bt:0);if(f===0)return null;if((f&30)!==0||(f&i.expiredLanes)!==0||r)r=oc(i,f);else{r=f;var g=xe;xe|=2;var m=zm();(Pt!==i||Bt!==r)&&(wi=null,Ur=ft()+500,$o(i,r));do try{IA();break}catch(M){Ym(i,M)}while(!0);Ad(),Kl.current=m,xe=g,yt!==null?r=0:(Pt=null,Bt=0,r=Tt)}if(r!==0){if(r===2&&(g=Lu(i),g!==0&&(f=g,r=sf(i,g))),r===1)throw l=Qs,$o(i,0),lo(i,f),ln(i,ft()),l;if(r===6)lo(i,f);else{if(g=i.current.alternate,(f&30)===0&&!vA(g)&&(r=oc(i,f),r===2&&(m=Lu(i),m!==0&&(f=m,r=sf(i,m))),r===1))throw l=Qs,$o(i,0),lo(i,f),ln(i,ft()),l;switch(i.finishedWork=g,i.finishedLanes=f,r){case 0:case 1:throw Error(n(345));case 2:Wo(i,an,wi);break;case 3:if(lo(i,f),(f&130023424)===f&&(r=nf+500-ft(),10<r)){if(fl(i,0)!==0)break;if(g=i.suspendedLanes,(g&f)!==f){Zt(),i.pingedLanes|=i.suspendedLanes&g;break}i.timeoutHandle=dd(Wo.bind(null,i,an,wi),r);break}Wo(i,an,wi);break;case 4:if(lo(i,f),(f&4194240)===f)break;for(r=i.eventTimes,g=-1;0<f;){var T=31-Un(f);m=1<<T,T=r[T],T>g&&(g=T),f&=~m}if(f=g,f=ft()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*yA(f/1960))-f,10<f){i.timeoutHandle=dd(Wo.bind(null,i,an,wi),f);break}Wo(i,an,wi);break;case 5:Wo(i,an,wi);break;default:throw Error(n(329))}}}return ln(i,ft()),i.callbackNode===l?$m.bind(null,i):null}function sf(i,r){var l=Js;return i.current.memoizedState.isDehydrated&&($o(i,r).flags|=256),i=oc(i,r),i!==2&&(r=an,an=l,r!==null&&af(r)),i}function af(i){an===null?an=i:an.push.apply(an,i)}function vA(i){for(var r=i;;){if(r.flags&16384){var l=r.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var f=0;f<l.length;f++){var g=l[f],m=g.getSnapshot;g=g.value;try{if(!Gn(m(),g))return!1}catch{return!1}}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function lo(i,r){for(r&=~tf,r&=~Ql,i.suspendedLanes|=r,i.pingedLanes&=~r,i=i.expirationTimes;0<r;){var l=31-Un(r),f=1<<l;i[l]=-1,r&=~f}}function Wm(i){if((xe&6)!==0)throw Error(n(327));Gr();var r=fl(i,0);if((r&1)===0)return ln(i,ft()),null;var l=oc(i,r);if(i.tag!==0&&l===2){var f=Lu(i);f!==0&&(r=f,l=sf(i,f))}if(l===1)throw l=Qs,$o(i,0),lo(i,r),ln(i,ft()),l;if(l===6)throw Error(n(345));return i.finishedWork=i.current.alternate,i.finishedLanes=r,Wo(i,an,wi),ln(i,ft()),null}function lf(i,r){var l=xe;xe|=1;try{return i(r)}finally{xe=l,xe===0&&(Ur=ft()+500,Dl&&to())}}function xo(i){so!==null&&so.tag===0&&(xe&6)===0&&Gr();var r=xe;xe|=1;var l=Rn.transition,f=ze;try{if(Rn.transition=null,ze=1,i)return i()}finally{ze=f,Rn.transition=l,xe=r,(xe&6)===0&&to()}}function cf(){gn=Lr.current,it(Lr)}function $o(i,r){i.finishedWork=null,i.finishedLanes=0;var l=i.timeoutHandle;if(l!==-1&&(i.timeoutHandle=-1,VT(l)),yt!==null)for(l=yt.return;l!==null;){var f=l;switch(yd(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&Ml();break;case 3:Br(),it(on),it(xt),kd();break;case 5:Rd(f);break;case 4:Br();break;case 13:it(at);break;case 19:it(at);break;case 10:Ed(f.type._context);break;case 22:case 23:cf()}l=l.return}if(Pt=i,yt=i=co(i.current,null),Bt=gn=r,Tt=0,Qs=null,tf=Ql=Go=0,an=Js=null,Fo!==null){for(r=0;r<Fo.length;r++)if(l=Fo[r],f=l.interleaved,f!==null){l.interleaved=null;var g=f.next,m=l.pending;if(m!==null){var T=m.next;m.next=g,f.next=T}l.pending=f}Fo=null}return i}function Ym(i,r){do{var l=yt;try{if(Ad(),xl.current=zl,$l){for(var f=lt.memoizedState;f!==null;){var g=f.queue;g!==null&&(g.pending=null),f=f.next}$l=!1}if(Uo=0,Ct=It=lt=null,js=!1,Xs=0,ef.current=null,l===null||l.return===null){Tt=1,Qs=r,yt=null;break}e:{var m=i,T=l.return,M=l,b=r;if(r=Bt,M.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){var U=b,K=M,J=K.tag;if((K.mode&1)===0&&(J===0||J===11||J===15)){var q=K.alternate;q?(K.updateQueue=q.updateQueue,K.memoizedState=q.memoizedState,K.lanes=q.lanes):(K.updateQueue=null,K.memoizedState=null)}var ce=gm(T);if(ce!==null){ce.flags&=-257,mm(ce,T,M,m,r),ce.mode&1&&pm(m,U,r),r=ce,b=U;var me=r.updateQueue;if(me===null){var ve=new Set;ve.add(b),r.updateQueue=ve}else me.add(b);break e}else{if((r&1)===0){pm(m,U,r),uf();break e}b=Error(n(426))}}else if(rt&&M.mode&1){var ht=gm(T);if(ht!==null){(ht.flags&65536)===0&&(ht.flags|=256),mm(ht,T,M,m,r),Id(Hr(b,M));break e}}m=b=Hr(b,M),Tt!==4&&(Tt=2),Js===null?Js=[m]:Js.push(m),m=T;do{switch(m.tag){case 3:m.flags|=65536,r&=-r,m.lanes|=r;var H=fm(m,b,r);Ug(m,H);break e;case 1:M=b;var B=m.type,L=m.stateNode;if((m.flags&128)===0&&(typeof B.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(ro===null||!ro.has(L)))){m.flags|=65536,r&=-r,m.lanes|=r;var oe=hm(m,M,r);Ug(m,oe);break e}}m=m.return}while(m!==null)}Xm(l)}catch(Te){r=Te,yt===l&&l!==null&&(yt=l=l.return);continue}break}while(!0)}function zm(){var i=Kl.current;return Kl.current=zl,i===null?zl:i}function uf(){(Tt===0||Tt===3||Tt===2)&&(Tt=4),Pt===null||(Go&268435455)===0&&(Ql&268435455)===0||lo(Pt,Bt)}function oc(i,r){var l=xe;xe|=2;var f=zm();(Pt!==i||Bt!==r)&&(wi=null,$o(i,r));do try{SA();break}catch(g){Ym(i,g)}while(!0);if(Ad(),xe=l,Kl.current=f,yt!==null)throw Error(n(261));return Pt=null,Bt=0,Tt}function SA(){for(;yt!==null;)jm(yt)}function IA(){for(;yt!==null&&!zI();)jm(yt)}function jm(i){var r=Zm(i.alternate,i,gn);i.memoizedProps=i.pendingProps,r===null?Xm(i):yt=r,ef.current=null}function Xm(i){var r=i;do{var l=r.alternate;if(i=r.return,(r.flags&32768)===0){if(l=fA(l,r,gn),l!==null){yt=l;return}}else{if(l=hA(l,r),l!==null){l.flags&=32767,yt=l;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Tt=6,yt=null;return}}if(r=r.sibling,r!==null){yt=r;return}yt=r=i}while(r!==null);Tt===0&&(Tt=5)}function Wo(i,r,l){var f=ze,g=Rn.transition;try{Rn.transition=null,ze=1,TA(i,r,l,f)}finally{Rn.transition=g,ze=f}return null}function TA(i,r,l,f){do Gr();while(so!==null);if((xe&6)!==0)throw Error(n(327));l=i.finishedWork;var g=i.finishedLanes;if(l===null)return null;if(i.finishedWork=null,i.finishedLanes=0,l===i.current)throw Error(n(177));i.callbackNode=null,i.callbackPriority=0;var m=l.lanes|l.childLanes;if(tT(i,m),i===Pt&&(yt=Pt=null,Bt=0),(l.subtreeFlags&2064)===0&&(l.flags&2064)===0||ec||(ec=!0,Km(ll,function(){return Gr(),null})),m=(l.flags&15990)!==0,(l.subtreeFlags&15990)!==0||m){m=Rn.transition,Rn.transition=null;var T=ze;ze=1;var M=xe;xe|=4,ef.current=null,gA(i,l),Fm(l,i),xT(cd),gl=!!ld,cd=ld=null,i.current=l,mA(l),jI(),xe=M,ze=T,Rn.transition=m}else i.current=l;if(ec&&(ec=!1,so=i,tc=g),m=i.pendingLanes,m===0&&(ro=null),qI(l.stateNode),ln(i,ft()),r!==null)for(f=i.onRecoverableError,l=0;l<r.length;l++)g=r[l],f(g.value,{componentStack:g.stack,digest:g.digest});if(Jl)throw Jl=!1,i=of,of=null,i;return(tc&1)!==0&&i.tag!==0&&Gr(),m=i.pendingLanes,(m&1)!==0?i===rf?ea++:(ea=0,rf=i):ea=0,to(),null}function Gr(){if(so!==null){var i=Bp(tc),r=Rn.transition,l=ze;try{if(Rn.transition=null,ze=16>i?16:i,so===null)var f=!1;else{if(i=so,so=null,tc=0,(xe&6)!==0)throw Error(n(331));var g=xe;for(xe|=4,he=i.current;he!==null;){var m=he,T=m.child;if((he.flags&16)!==0){var M=m.deletions;if(M!==null){for(var b=0;b<M.length;b++){var U=M[b];for(he=U;he!==null;){var K=he;switch(K.tag){case 0:case 11:case 15:Ks(8,K,m)}var J=K.child;if(J!==null)J.return=K,he=J;else for(;he!==null;){K=he;var q=K.sibling,ce=K.return;if(bm(K),K===U){he=null;break}if(q!==null){q.return=ce,he=q;break}he=ce}}}var me=m.alternate;if(me!==null){var ve=me.child;if(ve!==null){me.child=null;do{var ht=ve.sibling;ve.sibling=null,ve=ht}while(ve!==null)}}he=m}}if((m.subtreeFlags&2064)!==0&&T!==null)T.return=m,he=T;else e:for(;he!==null;){if(m=he,(m.flags&2048)!==0)switch(m.tag){case 0:case 11:case 15:Ks(9,m,m.return)}var H=m.sibling;if(H!==null){H.return=m.return,he=H;break e}he=m.return}}var B=i.current;for(he=B;he!==null;){T=he;var L=T.child;if((T.subtreeFlags&2064)!==0&&L!==null)L.return=T,he=L;else e:for(T=B;he!==null;){if(M=he,(M.flags&2048)!==0)try{switch(M.tag){case 0:case 11:case 15:Zl(9,M)}}catch(Te){dt(M,M.return,Te)}if(M===T){he=null;break e}var oe=M.sibling;if(oe!==null){oe.return=M.return,he=oe;break e}he=M.return}}if(xe=g,to(),oi&&typeof oi.onPostCommitFiberRoot=="function")try{oi.onPostCommitFiberRoot(cl,i)}catch{}f=!0}return f}finally{ze=l,Rn.transition=r}}return!1}function Vm(i,r,l){r=Hr(l,r),r=fm(i,r,1),i=io(i,r,1),r=Zt(),i!==null&&(ws(i,1,r),ln(i,r))}function dt(i,r,l){if(i.tag===3)Vm(i,i,l);else for(;r!==null;){if(r.tag===3){Vm(r,i,l);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(ro===null||!ro.has(f))){i=Hr(l,i),i=hm(r,i,1),r=io(r,i,1),i=Zt(),r!==null&&(ws(r,1,i),ln(r,i));break}}r=r.return}}function AA(i,r,l){var f=i.pingCache;f!==null&&f.delete(r),r=Zt(),i.pingedLanes|=i.suspendedLanes&l,Pt===i&&(Bt&l)===l&&(Tt===4||Tt===3&&(Bt&130023424)===Bt&&500>ft()-nf?$o(i,0):tf|=l),ln(i,r)}function qm(i,r){r===0&&((i.mode&1)===0?r=1:(r=dl,dl<<=1,(dl&130023424)===0&&(dl=4194304)));var l=Zt();i=Ti(i,r),i!==null&&(ws(i,r,l),ln(i,l))}function EA(i){var r=i.memoizedState,l=0;r!==null&&(l=r.retryLane),qm(i,l)}function wA(i,r){var l=0;switch(i.tag){case 13:var f=i.stateNode,g=i.memoizedState;g!==null&&(l=g.retryLane);break;case 19:f=i.stateNode;break;default:throw Error(n(314))}f!==null&&f.delete(r),qm(i,l)}var Zm;Zm=function(i,r,l){if(i!==null)if(i.memoizedProps!==r.pendingProps||on.current)sn=!0;else{if((i.lanes&l)===0&&(r.flags&128)===0)return sn=!1,dA(i,r,l);sn=(i.flags&131072)!==0}else sn=!1,rt&&(r.flags&1048576)!==0&&Mg(r,Ol,r.index);switch(r.lanes=0,r.tag){case 2:var f=r.type;Vl(i,r),i=r.pendingProps;var g=Rr(r,xt.current);Nr(r,l),g=Od(null,r,f,i,g,l);var m=Nd();return r.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,rn(f)?(m=!0,kl(r)):m=!1,r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,Cd(r),g.updater=jl,r.stateNode=g,g._reactInternals=r,Gd(r,f,i,l),r=Yd(null,r,f,!0,m,l)):(r.tag=0,rt&&m&&md(r),qt(null,r,g,l),r=r.child),r;case 16:f=r.elementType;e:{switch(Vl(i,r),i=r.pendingProps,g=f._init,f=g(f._payload),r.type=f,g=r.tag=CA(f),i=$n(f,i),g){case 0:r=Wd(null,r,f,i,l);break e;case 1:r=Am(null,r,f,i,l);break e;case 11:r=ym(null,r,f,i,l);break e;case 14:r=vm(null,r,f,$n(f.type,i),l);break e}throw Error(n(306,f,""))}return r;case 0:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:$n(f,g),Wd(i,r,f,g,l);case 1:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:$n(f,g),Am(i,r,f,g,l);case 3:e:{if(Em(r),i===null)throw Error(n(387));f=r.pendingProps,m=r.memoizedState,g=m.element,Lg(i,r),Ul(r,f,null,l);var T=r.memoizedState;if(f=T.element,m.isDehydrated)if(m={element:f,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},r.updateQueue.baseState=m,r.memoizedState=m,r.flags&256){g=Hr(Error(n(423)),r),r=wm(i,r,f,l,g);break e}else if(f!==g){g=Hr(Error(n(424)),r),r=wm(i,r,f,l,g);break e}else for(pn=Qi(r.stateNode.containerInfo.firstChild),hn=r,rt=!0,xn=null,l=Hg(r,null,f,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Dr(),f===g){r=Ei(i,r,l);break e}qt(i,r,f,l)}r=r.child}return r;case 5:return xg(r),i===null&&Sd(r),f=r.type,g=r.pendingProps,m=i!==null?i.memoizedProps:null,T=g.children,ud(f,g)?T=null:m!==null&&ud(f,m)&&(r.flags|=32),Tm(i,r),qt(i,r,T,l),r.child;case 6:return i===null&&Sd(r),null;case 13:return _m(i,r,l);case 4:return Pd(r,r.stateNode.containerInfo),f=r.pendingProps,i===null?r.child=br(r,null,f,l):qt(i,r,f,l),r.child;case 11:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:$n(f,g),ym(i,r,f,g,l);case 7:return qt(i,r,r.pendingProps,l),r.child;case 8:return qt(i,r,r.pendingProps.children,l),r.child;case 12:return qt(i,r,r.pendingProps.children,l),r.child;case 10:e:{if(f=r.type._context,g=r.pendingProps,m=r.memoizedProps,T=g.value,tt(Hl,f._currentValue),f._currentValue=T,m!==null)if(Gn(m.value,T)){if(m.children===g.children&&!on.current){r=Ei(i,r,l);break e}}else for(m=r.child,m!==null&&(m.return=r);m!==null;){var M=m.dependencies;if(M!==null){T=m.child;for(var b=M.firstContext;b!==null;){if(b.context===f){if(m.tag===1){b=Ai(-1,l&-l),b.tag=2;var U=m.updateQueue;if(U!==null){U=U.shared;var K=U.pending;K===null?b.next=b:(b.next=K.next,K.next=b),U.pending=b}}m.lanes|=l,b=m.alternate,b!==null&&(b.lanes|=l),wd(m.return,l,r),M.lanes|=l;break}b=b.next}}else if(m.tag===10)T=m.type===r.type?null:m.child;else if(m.tag===18){if(T=m.return,T===null)throw Error(n(341));T.lanes|=l,M=T.alternate,M!==null&&(M.lanes|=l),wd(T,l,r),T=m.sibling}else T=m.child;if(T!==null)T.return=m;else for(T=m;T!==null;){if(T===r){T=null;break}if(m=T.sibling,m!==null){m.return=T.return,T=m;break}T=T.return}m=T}qt(i,r,g.children,l),r=r.child}return r;case 9:return g=r.type,f=r.pendingProps.children,Nr(r,l),g=Cn(g),f=f(g),r.flags|=1,qt(i,r,f,l),r.child;case 14:return f=r.type,g=$n(f,r.pendingProps),g=$n(f.type,g),vm(i,r,f,g,l);case 15:return Sm(i,r,r.type,r.pendingProps,l);case 17:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:$n(f,g),Vl(i,r),r.tag=1,rn(f)?(i=!0,kl(r)):i=!1,Nr(r,l),um(r,f,g),Gd(r,f,g,l),Yd(null,r,f,!0,i,l);case 19:return Pm(i,r,l);case 22:return Im(i,r,l)}throw Error(n(156,r.tag))};function Km(i,r){return kp(i,r)}function _A(i,r,l,f){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Mn(i,r,l,f){return new _A(i,r,l,f)}function df(i){return i=i.prototype,!(!i||!i.isReactComponent)}function CA(i){if(typeof i=="function")return df(i)?1:0;if(i!=null){if(i=i.$$typeof,i===j)return 11;if(i===te)return 14}return 2}function co(i,r){var l=i.alternate;return l===null?(l=Mn(i.tag,r,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=r,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&14680064,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,r=i.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l}function rc(i,r,l,f,g,m){var T=2;if(f=i,typeof i=="function")df(i)&&(T=1);else if(typeof i=="string")T=5;else e:switch(i){case D:return Yo(l.children,g,m,r);case F:T=8,g|=8;break;case W:return i=Mn(12,l,r,g|2),i.elementType=W,i.lanes=m,i;case ee:return i=Mn(13,l,r,g),i.elementType=ee,i.lanes=m,i;case V:return i=Mn(19,l,r,g),i.elementType=V,i.lanes=m,i;case ie:return sc(l,g,m,r);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Y:T=10;break e;case G:T=9;break e;case j:T=11;break e;case te:T=14;break e;case re:T=16,f=null;break e}throw Error(n(130,i==null?i:typeof i,""))}return r=Mn(T,l,r,g),r.elementType=i,r.type=f,r.lanes=m,r}function Yo(i,r,l,f){return i=Mn(7,i,f,r),i.lanes=l,i}function sc(i,r,l,f){return i=Mn(22,i,f,r),i.elementType=ie,i.lanes=l,i.stateNode={isHidden:!1},i}function ff(i,r,l){return i=Mn(6,i,null,r),i.lanes=l,i}function hf(i,r,l){return r=Mn(4,i.children!==null?i.children:[],i.key,r),r.lanes=l,r.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},r}function PA(i,r,l,f,g){this.tag=r,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Uu(0),this.expirationTimes=Uu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Uu(0),this.identifierPrefix=f,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function pf(i,r,l,f,g,m,T,M,b){return i=new PA(i,r,l,M,b),r===1?(r=1,m===!0&&(r|=8)):r=0,m=Mn(3,null,null,r),i.current=m,m.stateNode=i,m.memoizedState={element:f,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},Cd(m),i}function RA(i,r,l){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:k,key:f==null?null:""+f,children:i,containerInfo:r,implementation:l}}function Qm(i){if(!i)return eo;i=i._reactInternals;e:{if(bo(i)!==i||i.tag!==1)throw Error(n(170));var r=i;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(rn(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(i.tag===1){var l=i.type;if(rn(l))return Cg(i,l,r)}return r}function Jm(i,r,l,f,g,m,T,M,b){return i=pf(l,f,!0,i,g,m,T,M,b),i.context=Qm(null),l=i.current,f=Zt(),g=ao(l),m=Ai(f,g),m.callback=r??null,io(l,m,g),i.current.lanes=g,ws(i,g,f),ln(i,f),i}function ac(i,r,l,f){var g=r.current,m=Zt(),T=ao(g);return l=Qm(l),r.context===null?r.context=l:r.pendingContext=l,r=Ai(m,T),r.payload={element:i},f=f===void 0?null:f,f!==null&&(r.callback=f),i=io(g,r,T),i!==null&&(zn(i,g,T,m),Ll(i,g,T)),T}function lc(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function e0(i,r){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<r?l:r}}function gf(i,r){e0(i,r),(i=i.alternate)&&e0(i,r)}function MA(){return null}var t0=typeof reportError=="function"?reportError:function(i){console.error(i)};function mf(i){this._internalRoot=i}cc.prototype.render=mf.prototype.render=function(i){var r=this._internalRoot;if(r===null)throw Error(n(409));ac(i,r,null,null)},cc.prototype.unmount=mf.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var r=i.containerInfo;xo(function(){ac(null,i,null,null)}),r[yi]=null}};function cc(i){this._internalRoot=i}cc.prototype.unstable_scheduleHydration=function(i){if(i){var r=Lp();i={blockedOn:null,target:i,priority:r};for(var l=0;l<qi.length&&r!==0&&r<qi[l].priority;l++);qi.splice(l,0,i),l===0&&xp(i)}};function yf(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function uc(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function n0(){}function kA(i,r,l,f,g){if(g){if(typeof f=="function"){var m=f;f=function(){var U=lc(T);m.call(U)}}var T=Jm(r,f,i,0,null,!1,!1,"",n0);return i._reactRootContainer=T,i[yi]=T.current,Ls(i.nodeType===8?i.parentNode:i),xo(),T}for(;g=i.lastChild;)i.removeChild(g);if(typeof f=="function"){var M=f;f=function(){var U=lc(b);M.call(U)}}var b=pf(i,0,!1,null,null,!1,!1,"",n0);return i._reactRootContainer=b,i[yi]=b.current,Ls(i.nodeType===8?i.parentNode:i),xo(function(){ac(r,b,l,f)}),b}function dc(i,r,l,f,g){var m=l._reactRootContainer;if(m){var T=m;if(typeof g=="function"){var M=g;g=function(){var b=lc(T);M.call(b)}}ac(r,T,i,g)}else T=kA(l,r,i,g,f);return lc(T)}Hp=function(i){switch(i.tag){case 3:var r=i.stateNode;if(r.current.memoizedState.isDehydrated){var l=Es(r.pendingLanes);l!==0&&(Gu(r,l|1),ln(r,ft()),(xe&6)===0&&(Ur=ft()+500,to()))}break;case 13:xo(function(){var f=Ti(i,1);if(f!==null){var g=Zt();zn(f,i,1,g)}}),gf(i,1)}},xu=function(i){if(i.tag===13){var r=Ti(i,134217728);if(r!==null){var l=Zt();zn(r,i,134217728,l)}gf(i,134217728)}},Fp=function(i){if(i.tag===13){var r=ao(i),l=Ti(i,r);if(l!==null){var f=Zt();zn(l,i,r,f)}gf(i,r)}},Lp=function(){return ze},Up=function(i,r){var l=ze;try{return ze=i,r()}finally{ze=l}},Ou=function(i,r,l){switch(r){case"input":if(nn(i,l),r=l.name,l.type==="radio"&&r!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<l.length;r++){var f=l[r];if(f!==i&&f.form===i.form){var g=Rl(f);if(!g)throw Error(n(90));we(f),nn(f,g)}}}break;case"textarea":pp(i,l);break;case"select":r=l.value,r!=null&&zi(i,!!l.multiple,r,!1)}},Ep=lf,wp=xo;var DA={usingClientEntryPoint:!1,Events:[xs,Cr,Rl,Tp,Ap,lf]},ta={findFiberByHostInstance:Oo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},bA={bundleType:ta.bundleType,version:ta.version,rendererPackageName:ta.rendererPackageName,rendererConfig:ta.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:R.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=Rp(i),i===null?null:i.stateNode},findFiberByHostInstance:ta.findFiberByHostInstance||MA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fc.isDisabled&&fc.supportsFiber)try{cl=fc.inject(bA),oi=fc}catch{}}return cn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=DA,cn.createPortal=function(i,r){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!yf(r))throw Error(n(200));return RA(i,r,null,l)},cn.createRoot=function(i,r){if(!yf(i))throw Error(n(299));var l=!1,f="",g=t0;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(g=r.onRecoverableError)),r=pf(i,1,!1,null,null,l,!1,f,g),i[yi]=r.current,Ls(i.nodeType===8?i.parentNode:i),new mf(r)},cn.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var r=i._reactInternals;if(r===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=Rp(r),i=i===null?null:i.stateNode,i},cn.flushSync=function(i){return xo(i)},cn.hydrate=function(i,r,l){if(!uc(r))throw Error(n(200));return dc(null,i,r,!0,l)},cn.hydrateRoot=function(i,r,l){if(!yf(i))throw Error(n(405));var f=l!=null&&l.hydratedSources||null,g=!1,m="",T=t0;if(l!=null&&(l.unstable_strictMode===!0&&(g=!0),l.identifierPrefix!==void 0&&(m=l.identifierPrefix),l.onRecoverableError!==void 0&&(T=l.onRecoverableError)),r=Jm(r,null,i,1,l??null,g,!1,m,T),i[yi]=r.current,Ls(i),f)for(i=0;i<f.length;i++)l=f[i],g=l._getVersion,g=g(l._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[l,g]:r.mutableSourceEagerHydrationData.push(l,g);return new cc(r)},cn.render=function(i,r,l){if(!uc(r))throw Error(n(200));return dc(null,i,r,!1,l)},cn.unmountComponentAtNode=function(i){if(!uc(i))throw Error(n(40));return i._reactRootContainer?(xo(function(){dc(null,null,i,!1,function(){i._reactRootContainer=null,i[yi]=null})}),!0):!1},cn.unstable_batchedUpdates=lf,cn.unstable_renderSubtreeIntoContainer=function(i,r,l,f){if(!uc(l))throw Error(n(200));if(i==null||i._reactInternals===void 0)throw Error(n(38));return dc(i,r,l,!1,f)},cn.version="18.3.1-next-f1338f8080-20240426",cn}var u0;function $A(){if(u0)return If.exports;u0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),If.exports=xA(),If.exports}var d0;function WA(){if(d0)return hc;d0=1;var e=$A();return hc.createRoot=e.createRoot,hc.hydrateRoot=e.hydrateRoot,hc}var YA=WA();const zA=Jy(YA);class jA{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let o=this.length++;for(;o>0;){const s=o-1>>1,a=this.values[s];if(n>=a)break;this.ids[o]=this.ids[s],this.values[o]=a,o=s}this.ids[o]=t,this.values[o]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],o=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let c=(a<<1)+1;const d=c+1;let u=this.ids[c],h=this.values[c];const p=this.values[d];if(d<this.length&&p<h&&(c=d,u=this.ids[d],h=p),h>=o)break;this.ids[a]=u,this.values[a]=h,a=c}this.ids[a]=n,this.values[a]=o}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const f0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Ef=3;class Eh{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[o,s]=new Uint8Array(t,n+0,2);if(o!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==Ef)throw new Error(`Got v${a} data when expected v${Ef}.`);const c=f0[s&15];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,n+2,1),[u]=new Uint32Array(t,n+4,1);return new Eh(u,d,c,void 0,t,n)}constructor(t,n=16,o=Float64Array,s=ArrayBuffer,a,c=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=c;let d=t,u=d;this._levelBounds=[d*4];do d=Math.ceil(d/this.nodeSize),u+=d,this._levelBounds.push(u*4);while(d!==1);this.ArrayType=o,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const h=f0.indexOf(this.ArrayType),p=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,c+8,u*4),this._indices=new this.IndexArrayType(this.data,c+8+p,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+p+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+p,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Ef<<4)+h]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new jA}add(t,n,o=t,s=n){const a=this._pos>>2,c=this._boxes;return this._indices[a]=a,c[this._pos++]=t,c[this._pos++]=n,c[this._pos++]=o,c[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),o>this.maxX&&(this.maxX=o),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,o=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let c=0,d=0;c<this.numItems;c++){const u=t[d++],h=t[d++],p=t[d++],y=t[d++],S=Math.floor(a*((u+p)/2-this.minX)/n),v=Math.floor(a*((h+y)/2-this.minY)/o);s[c]=VA(S,v)}Jf(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let c=0,d=0;c<this._levelBounds.length-1;c++){const u=this._levelBounds[c];for(;d<u;){const h=d;let p=t[d++],y=t[d++],S=t[d++],v=t[d++];for(let A=1;A<this.nodeSize&&d<u;A++)p=Math.min(p,t[d++]),y=Math.min(y,t[d++]),S=Math.max(S,t[d++]),v=Math.max(v,t[d++]);this._indices[this._pos>>2]=h,t[this._pos++]=p,t[this._pos++]=y,t[this._pos++]=S,t[this._pos++]=v}}}search(t,n,o,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let c=this._boxes.length-4;const d=[],u=[];for(;c!==void 0;){const h=Math.min(c+this.nodeSize*4,p0(c,this._levelBounds));for(let p=c;p<h;p+=4){if(o<this._boxes[p]||s<this._boxes[p+1]||t>this._boxes[p+2]||n>this._boxes[p+3])continue;const y=this._indices[p>>2]|0;c>=this.numItems*4?d.push(y):(a===void 0||a(y))&&u.push(y)}c=d.pop()}return u}neighbors(t,n,o=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let c=this._boxes.length-4;const d=this._queue,u=[],h=s*s;e:for(;c!==void 0;){const p=Math.min(c+this.nodeSize*4,p0(c,this._levelBounds));for(let y=c;y<p;y+=4){const S=this._indices[y>>2]|0,v=h0(t,this._boxes[y],this._boxes[y+2]),A=h0(n,this._boxes[y+1],this._boxes[y+3]),I=v*v+A*A;I>h||(c>=this.numItems*4?d.push(S<<1,I):(a===void 0||a(S))&&d.push((S<<1)+1,I))}for(;d.length&&d.peek()&1;)if(d.peekValue()>h||(u.push(d.pop()>>1),u.length===o))break e;c=d.length?d.pop()>>1:void 0}return d.clear(),u}}function h0(e,t,n){return e<t?t-e:e<=n?0:e-n}function p0(e,t){let n=0,o=t.length-1;for(;n<o;){const s=n+o>>1;t[s]>e?o=s:n=s+1}return t[n]}function Jf(e,t,n,o,s,a){if(Math.floor(o/a)>=Math.floor(s/a))return;const c=e[o+s>>1];let d=o-1,u=s+1;for(;;){do d++;while(e[d]<c);do u--;while(e[u]>c);if(d>=u)break;XA(e,t,n,d,u)}Jf(e,t,n,o,u,a),Jf(e,t,n,u+1,s,a)}function XA(e,t,n,o,s){const a=e[o];e[o]=e[s],e[s]=a;const c=4*o,d=4*s,u=t[c],h=t[c+1],p=t[c+2],y=t[c+3];t[c]=t[d],t[c+1]=t[d+1],t[c+2]=t[d+2],t[c+3]=t[d+3],t[d]=u,t[d+1]=h,t[d+2]=p,t[d+3]=y;const S=n[o];n[o]=n[s],n[s]=S}function VA(e,t){let n=e^t,o=65535^n,s=65535^(e|t),a=e&(t^65535),c=n|o>>1,d=n>>1^n,u=s>>1^o&a>>1^s,h=n&s>>1^a>>1^a;n=c,o=d,s=u,a=h,c=n&n>>2^o&o>>2,d=n&o>>2^o&(n^o)>>2,u^=n&s>>2^o&a>>2,h^=o&s>>2^(n^o)&a>>2,n=c,o=d,s=u,a=h,c=n&n>>4^o&o>>4,d=n&o>>4^o&(n^o)>>4,u^=n&s>>4^o&a>>4,h^=o&s>>4^(n^o)&a>>4,n=c,o=d,s=u,a=h,u^=n&s>>8^o&a>>8,h^=o&s>>8^(n^o)&a>>8,n=u^u>>1,o=h^h>>1;let p=e^t,y=o|65535^(p|n);return p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|p)>>>0}function pi(e,t){return{x:e.x+t.x,y:e.y+t.y}}function wh(e,t){return{x:e.x-t.x,y:e.y-t.y}}function ut(e,t){return{x:e.x*t,y:e.y*t}}function Eo(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function mt(e){const t=Eo(e);return t===0?{x:0,y:0}:ut(e,1/t)}function Fn(e,t){return Eo(wh(e,t))}function Fc(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function g0(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,o)=>({x:n.x+o.x,y:n.y+o.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Le(e,t,n,o){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>o/2&&(a=a-Math.sign(a)*o),{x:s,y:a}}function Mt(e,t,n){const o=Le(e,t,n.width,n.height);return mt(o)}function X(e,t,n,o){const s=Le(e,t,n,o);return Eo(s)}function bt(e,t,n,o){const s=Le(e,t,n,o);return s.x*s.x+s.y*s.y}function qA(e,t){return e.x*t.x+e.y*t.y}function ZA(e,t){const n=qA(e,t),o=Eo(e),s=Eo(t);if(o===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(o*s)));return Math.acos(a)}function m0(e,t){const n=Math.cos(t),o=Math.sin(t);return{x:e.x*n-e.y*o,y:e.x*o+e.y*n}}function KA(e,t){return t.split(".").reduce((n,o)=>{if(n&&typeof n=="object"&&o in n)return n[o]},e)}function Pi(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],at:()=>{},byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new Eh(e.length),o=new Map,s=new Map;let a=0;const c=new Uint32Array(e.length);for(let u=0;u<e.length;u++){const h=e[u];h.width!==void 0&&h.height!==void 0?n.add(h.position.x,h.position.y,h.position.x+h.width,h.position.y+h.height):n.add(h.position.x,h.position.y,h.position.x,h.position.y)}return n.finish(),{all(){return e},byRect(u){const{width:h,height:p}=t,y=[];a++;const S=[];u.left<0?(S.push({left:u.left+h,right:h}),S.push({left:0,right:u.right})):u.right>h?(S.push({left:u.left,right:h}),S.push({left:0,right:u.right-h})):S.push({left:u.left,right:u.right});const v=[];u.top<0?(v.push({top:u.top+p,bottom:p}),v.push({top:0,bottom:u.bottom})):u.bottom>p?(v.push({top:u.top,bottom:p}),v.push({top:0,bottom:u.bottom-p})):v.push({top:u.top,bottom:u.bottom});for(let A=0;A<S.length;A++){const I=S[A];for(let E=0;E<v.length;E++){const _=v[E],w=n.search(I.left,_.top,I.right,_.bottom);for(let P=0;P<w.length;P++){const R=w[P];c[R]!==a&&(c[R]=a,y.push(e[R]))}}}return y},byRadius(u,h){const{width:p,height:y}=t,S=[];a++;const v=h*h,A=u.x-h,I=u.x+h,E=u.y-h,_=u.y+h,w=[];A<0?(w.push({left:A+p,right:p}),w.push({left:0,right:I})):I>p?(w.push({left:A,right:p}),w.push({left:0,right:I-p})):w.push({left:A,right:I});const P=[];E<0?(P.push({top:E+y,bottom:y}),P.push({top:0,bottom:_})):_>y?(P.push({top:E,bottom:y}),P.push({top:0,bottom:_-y})):P.push({top:E,bottom:_});for(let R=0;R<w.length;R++){const C=w[R];for(let k=0;k<P.length;k++){const D=P[k],F=n.search(C.left,D.top,C.right,D.bottom);for(let W=0;W<F.length;W++){const Y=F[W];if(c[Y]!==a){c[Y]=a;const G=e[Y];bt(u,G.position,p,y)<=v&&S.push(G)}}}}return S},at(u,h){return this.byRadius(u,h)[0]},byProperty(u,h){var p;if(!o.has(u)){const y=new Map;for(let S=0;S<e.length;S++){const v=e[S],A=v[u];y.has(A)||y.set(A,[]),y.get(A).push(v)}o.set(u,y)}return((p=o.get(u))==null?void 0:p.get(h))||[]},byPropertyPath(u,h){var p;if(!s.has(u)){const y=new Map;for(let S=0;S<e.length;S++){const v=e[S],A=KA(v,u);y.has(A)||y.set(A,[]),y.get(A).push(v)}s.set(u,y)}return((p=s.get(u))==null?void 0:p.get(h))||[]},resetPropertyCache(){o.clear(),s.clear()},count(){return e.length}}}function iu(e){var y,S;const t=e.entities.entities,n=[],o=[],s=[],a=[],c=[],d=[],u=[];for(const v in t){const A=t[v];switch(A.type){case"human":n.push(A);break;case"berryBush":o.push(A);break;case"corpse":s.push(A);break;case"prey":a.push(A);break;case"predator":c.push(A);break;case"building":d.push(A);break;case"tree":u.push(A);break}}const h=e.mapDimensions;return{...e,search:{human:Pi(n,h),berryBush:Pi(o,h),corpse:Pi(s,h),prey:Pi(a,h),predator:Pi(c,h),building:Pi(d,h),tree:Pi(u,h),tasks:((y=e.search)==null?void 0:y.tasks)??Pi([],h)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((S=e.cache)==null?void 0:S.tribeCenters)??{}}}}function QA(e){const t=[];for(const n in e.tasks)t.push(e.tasks[n]);e.search.tasks=Pi(t,e.mapDimensions)}const Z={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire",Palisade:"palisade",Gate:"gate"},ei={[Z.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[Z.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[Z.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[Z.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}},[Z.Palisade]:{name:"Palisade",description:"A defensive wall segment that blocks movement.",icon:"",dimensions:{width:20,height:20},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:1}},[Z.Gate]:{name:"Gate",description:"A gate that allows passage for tribe members.",icon:"",dimensions:{width:20,height:20},constructionTimeHours:.4,destructionTimeHours:.2,cost:{wood:3}}},JA=.5,eE="#FFA500",tE="#FF4500",y0=4,nE=10,_h=60;function Ch(e){return ei[e].dimensions}function iE(e){return ei[e].constructionTimeHours}function oE(e){return ei[e].destructionTimeHours}const ev=5;function rE(){return ei[Z.PlantingZone].dimensions}function v0(e,t,n){const o=e.position.x+n.width/2,a=t.position.x-n.width/2-o,c=e.position.y-n.height/2,d=e.position.y+n.height/2,u=t.position.y-n.height/2,h=t.position.y+n.height/2,p=Math.min(d,h)-Math.max(c,u);return a>=-5&&a<=ev&&p>n.height*.5}function S0(e,t,n){const o=e.position.y+n.height/2,a=t.position.y-n.height/2-o,c=e.position.x-n.width/2,d=e.position.x+n.width/2,u=t.position.x-n.width/2,h=t.position.x+n.width/2,p=Math.min(d,h)-Math.max(c,u);return a>=-5&&a<=ev&&p>n.width*.5}function sE(e){var c;const t={},n=rE(),o=e;if(!((c=o.search)!=null&&c.building))return t;const a=o.search.building.all().filter(d=>d.buildingType===Z.PlantingZone&&d.isConstructed);for(const d of a)t[d.id]={top:!1,bottom:!1,left:!1,right:!1};for(let d=0;d<a.length;d++){const u=a[d];for(let h=d+1;h<a.length;h++){const p=a[h];u.ownerId===p.ownerId&&(v0(u,p,n)&&(t[u.id].right=!0,t[p.id].left=!0),v0(p,u,n)&&(t[p.id].right=!0,t[u.id].left=!0),S0(u,p,n)&&(t[u.id].bottom=!0,t[p.id].top=!0),S0(p,u,n)&&(t[p.id].bottom=!0,t[u.id].top=!0))}}return t}function Oa(e){e.plantingZoneConnections=sE(e)}var Vo=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(Vo||{});class aE{constructor(){Ht(this,"worker",null);Ht(this,"pendingRequests",new Map);Ht(this,"requestQueue",[]);Ht(this,"isProcessing",!1);Ht(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case Vo.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case Vo.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case Vo.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,o)=>{if(!this.worker){o(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:o});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),o(s)}})}queueOperation(t){return new Promise((n,o)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){o(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),o=t,s={type:Vo.SAVE_REQUEST,id:n,gameState:o};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Vo.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Vo.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const Ph=new aE;async function Rh(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,tribeModalOpen:e.tribeModalOpen,cameraFollowingPlayer:e.cameraFollowingPlayer,cameraZoom:e.cameraZoom,isDraggingMinimap:e.isDraggingMinimap,minimapDragDistance:e.minimapDragDistance,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks,navigationGrid:e.navigationGrid,pathfindingQueue:e.pathfindingQueue,isDraggingViewport:e.isDraggingViewport,viewportDragButton:e.viewportDragButton,viewportDragDistance:e.viewportDragDistance};await Ph.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function lE(){try{const e=await Ph.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=iu(t);return Oa(n),n}catch(e){return console.error("Failed to load game:",e),await tv(),null}}async function tv(){try{await Ph.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const nv=ge.createContext(void 0),cE=({initialAppState:e,children:t})=>{const[n,o]=ge.useState(e),[s,a]=ge.useState(void 0),[c,d]=ge.useState(null),[u,h]=ge.useState(!1);ge.useEffect(()=>{lE().then(A=>{A&&d(A),h(!0)})},[]);const p=(A,I)=>{o(A),A==="gameOver"&&I?a(I):A!=="gameOver"&&a(void 0)},y=()=>{o("intro"),a(void 0),v()},S=A=>{Rh(A),d(A)},v=()=>{tv(),d(null)};return ye.jsx(nv.Provider,{value:{appState:n,setAppState:p,returnToIntro:y,gameOverDetails:s,contextReady:u,savedGameState:c,setSavedGameState:d,saveCurrentGame:S,clearCurrentSave:v},children:t})},ko=()=>{const e=ge.useContext(nv);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var jt=function(){return jt=Object.assign||function(t){for(var n,o=1,s=arguments.length;o<s;o++){n=arguments[o];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},jt.apply(this,arguments)};function Na(e,t,n){if(n||arguments.length===2)for(var o=0,s=t.length,a;o<s;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))}var ot="-ms-",Aa="-moz-",Ye="-webkit-",iv="comm",ou="rule",Mh="decl",uE="@import",ov="@keyframes",dE="@layer",rv=Math.abs,kh=String.fromCharCode,eh=Object.assign;function fE(e,t){return kt(e,0)^45?(((t<<2^kt(e,0))<<2^kt(e,1))<<2^kt(e,2))<<2^kt(e,3):0}function sv(e){return e.trim()}function ki(e,t){return(e=t.exec(e))?e[0]:e}function Be(e,t,n){return e.replace(t,n)}function Mc(e,t,n){return e.indexOf(t,n)}function kt(e,t){return e.charCodeAt(t)|0}function ns(e,t,n){return e.slice(t,n)}function fi(e){return e.length}function av(e){return e.length}function ga(e,t){return t.push(e),e}function hE(e,t){return e.map(t).join("")}function I0(e,t){return e.filter(function(n){return!ki(n,t)})}var ru=1,is=1,lv=0,Ln=0,St=0,hs="";function su(e,t,n,o,s,a,c,d){return{value:e,root:t,parent:n,type:o,props:s,children:a,line:ru,column:is,length:c,return:"",siblings:d}}function po(e,t){return eh(su("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function xr(e){for(;e.root;)e=po(e.root,{children:[e]});ga(e,e.siblings)}function pE(){return St}function gE(){return St=Ln>0?kt(hs,--Ln):0,is--,St===10&&(is=1,ru--),St}function Zn(){return St=Ln<lv?kt(hs,Ln++):0,is++,St===10&&(is=1,ru++),St}function Qo(){return kt(hs,Ln)}function kc(){return Ln}function au(e,t){return ns(hs,e,t)}function th(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function mE(e){return ru=is=1,lv=fi(hs=e),Ln=0,[]}function yE(e){return hs="",e}function wf(e){return sv(au(Ln-1,nh(e===91?e+2:e===40?e+1:e)))}function vE(e){for(;(St=Qo())&&St<33;)Zn();return th(e)>2||th(St)>3?"":" "}function SE(e,t){for(;--t&&Zn()&&!(St<48||St>102||St>57&&St<65||St>70&&St<97););return au(e,kc()+(t<6&&Qo()==32&&Zn()==32))}function nh(e){for(;Zn();)switch(St){case e:return Ln;case 34:case 39:e!==34&&e!==39&&nh(St);break;case 40:e===41&&nh(e);break;case 92:Zn();break}return Ln}function IE(e,t){for(;Zn()&&e+St!==57;)if(e+St===84&&Qo()===47)break;return"/*"+au(t,Ln-1)+"*"+kh(e===47?e:Zn())}function TE(e){for(;!th(Qo());)Zn();return au(e,Ln)}function AE(e){return yE(Dc("",null,null,null,[""],e=mE(e),0,[0],e))}function Dc(e,t,n,o,s,a,c,d,u){for(var h=0,p=0,y=c,S=0,v=0,A=0,I=1,E=1,_=1,w=0,P="",R=s,C=a,k=o,D=P;E;)switch(A=w,w=Zn()){case 40:if(A!=108&&kt(D,y-1)==58){Mc(D+=Be(wf(w),"&","&\f"),"&\f",rv(h?d[h-1]:0))!=-1&&(_=-1);break}case 34:case 39:case 91:D+=wf(w);break;case 9:case 10:case 13:case 32:D+=vE(A);break;case 92:D+=SE(kc()-1,7);continue;case 47:switch(Qo()){case 42:case 47:ga(EE(IE(Zn(),kc()),t,n,u),u);break;default:D+="/"}break;case 123*I:d[h++]=fi(D)*_;case 125*I:case 59:case 0:switch(w){case 0:case 125:E=0;case 59+p:_==-1&&(D=Be(D,/\f/g,"")),v>0&&fi(D)-y&&ga(v>32?A0(D+";",o,n,y-1,u):A0(Be(D," ","")+";",o,n,y-2,u),u);break;case 59:D+=";";default:if(ga(k=T0(D,t,n,h,p,s,d,P,R=[],C=[],y,a),a),w===123)if(p===0)Dc(D,t,k,k,R,a,y,d,C);else switch(S===99&&kt(D,3)===110?100:S){case 100:case 108:case 109:case 115:Dc(e,k,k,o&&ga(T0(e,k,k,0,0,s,d,P,s,R=[],y,C),C),s,C,y,d,o?R:C);break;default:Dc(D,k,k,k,[""],C,0,d,C)}}h=p=v=0,I=_=1,P=D="",y=c;break;case 58:y=1+fi(D),v=A;default:if(I<1){if(w==123)--I;else if(w==125&&I++==0&&gE()==125)continue}switch(D+=kh(w),w*I){case 38:_=p>0?1:(D+="\f",-1);break;case 44:d[h++]=(fi(D)-1)*_,_=1;break;case 64:Qo()===45&&(D+=wf(Zn())),S=Qo(),p=y=fi(P=D+=TE(kc())),w++;break;case 45:A===45&&fi(D)==2&&(I=0)}}return a}function T0(e,t,n,o,s,a,c,d,u,h,p,y){for(var S=s-1,v=s===0?a:[""],A=av(v),I=0,E=0,_=0;I<o;++I)for(var w=0,P=ns(e,S+1,S=rv(E=c[I])),R=e;w<A;++w)(R=sv(E>0?v[w]+" "+P:Be(P,/&\f/g,v[w])))&&(u[_++]=R);return su(e,t,n,s===0?ou:d,u,h,p,y)}function EE(e,t,n,o){return su(e,t,n,iv,kh(pE()),ns(e,2,-2),0,o)}function A0(e,t,n,o,s){return su(e,t,n,Mh,ns(e,0,o),ns(e,o+1,-1),o,s)}function cv(e,t,n){switch(fE(e,t)){case 5103:return Ye+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ye+e+e;case 4789:return Aa+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Ye+e+Aa+e+ot+e+e;case 5936:switch(kt(e,t+11)){case 114:return Ye+e+ot+Be(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Ye+e+ot+Be(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Ye+e+ot+Be(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Ye+e+ot+e+e;case 6165:return Ye+e+ot+"flex-"+e+e;case 5187:return Ye+e+Be(e,/(\w+).+(:[^]+)/,Ye+"box-$1$2"+ot+"flex-$1$2")+e;case 5443:return Ye+e+ot+"flex-item-"+Be(e,/flex-|-self/g,"")+(ki(e,/flex-|baseline/)?"":ot+"grid-row-"+Be(e,/flex-|-self/g,""))+e;case 4675:return Ye+e+ot+"flex-line-pack"+Be(e,/align-content|flex-|-self/g,"")+e;case 5548:return Ye+e+ot+Be(e,"shrink","negative")+e;case 5292:return Ye+e+ot+Be(e,"basis","preferred-size")+e;case 6060:return Ye+"box-"+Be(e,"-grow","")+Ye+e+ot+Be(e,"grow","positive")+e;case 4554:return Ye+Be(e,/([^-])(transform)/g,"$1"+Ye+"$2")+e;case 6187:return Be(Be(Be(e,/(zoom-|grab)/,Ye+"$1"),/(image-set)/,Ye+"$1"),e,"")+e;case 5495:case 3959:return Be(e,/(image-set\([^]*)/,Ye+"$1$`$1");case 4968:return Be(Be(e,/(.+:)(flex-)?(.*)/,Ye+"box-pack:$3"+ot+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ye+e+e;case 4200:if(!ki(e,/flex-|baseline/))return ot+"grid-column-align"+ns(e,t)+e;break;case 2592:case 3360:return ot+Be(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(o,s){return t=s,ki(o.props,/grid-\w+-end/)})?~Mc(e+(n=n[t].value),"span",0)?e:ot+Be(e,"-start","")+e+ot+"grid-row-span:"+(~Mc(n,"span",0)?ki(n,/\d+/):+ki(n,/\d+/)-+ki(e,/\d+/))+";":ot+Be(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(o){return ki(o.props,/grid-\w+-start/)})?e:ot+Be(Be(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return Be(e,/(.+)-inline(.+)/,Ye+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(fi(e)-1-t>6)switch(kt(e,t+1)){case 109:if(kt(e,t+4)!==45)break;case 102:return Be(e,/(.+:)(.+)-([^]+)/,"$1"+Ye+"$2-$3$1"+Aa+(kt(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Mc(e,"stretch",0)?cv(Be(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return Be(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(o,s,a,c,d,u,h){return ot+s+":"+a+h+(c?ot+s+"-span:"+(d?u:+u-+a)+h:"")+e});case 4949:if(kt(e,t+6)===121)return Be(e,":",":"+Ye)+e;break;case 6444:switch(kt(e,kt(e,14)===45?18:11)){case 120:return Be(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Ye+(kt(e,14)===45?"inline-":"")+"box$3$1"+Ye+"$2$3$1"+ot+"$2box$3")+e;case 100:return Be(e,":",":"+ot)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Be(e,"scroll-","scroll-snap-")+e}return e}function Lc(e,t){for(var n="",o=0;o<e.length;o++)n+=t(e[o],o,e,t)||"";return n}function wE(e,t,n,o){switch(e.type){case dE:if(e.children.length)break;case uE:case Mh:return e.return=e.return||e.value;case iv:return"";case ov:return e.return=e.value+"{"+Lc(e.children,o)+"}";case ou:if(!fi(e.value=e.props.join(",")))return""}return fi(n=Lc(e.children,o))?e.return=e.value+"{"+n+"}":""}function _E(e){var t=av(e);return function(n,o,s,a){for(var c="",d=0;d<t;d++)c+=e[d](n,o,s,a)||"";return c}}function CE(e){return function(t){t.root||(t=t.return)&&e(t)}}function PE(e,t,n,o){if(e.length>-1&&!e.return)switch(e.type){case Mh:e.return=cv(e.value,e.length,n);return;case ov:return Lc([po(e,{value:Be(e.value,"@","@"+Ye)})],o);case ou:if(e.length)return hE(n=e.props,function(s){switch(ki(s,o=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":xr(po(e,{props:[Be(s,/:(read-\w+)/,":"+Aa+"$1")]})),xr(po(e,{props:[s]})),eh(e,{props:I0(n,o)});break;case"::placeholder":xr(po(e,{props:[Be(s,/:(plac\w+)/,":"+Ye+"input-$1")]})),xr(po(e,{props:[Be(s,/:(plac\w+)/,":"+Aa+"$1")]})),xr(po(e,{props:[Be(s,/:(plac\w+)/,ot+"input-$1")]})),xr(po(e,{props:[s]})),eh(e,{props:I0(n,o)});break}return""})}}var RE={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Sn={},os=typeof process<"u"&&Sn!==void 0&&(Sn.REACT_APP_SC_ATTR||Sn.SC_ATTR)||"data-styled",uv="active",dv="data-styled-version",lu="6.1.13",Dh=`/*!sc*/
`,Uc=typeof window<"u"&&"HTMLElement"in window,ME=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Sn!==void 0&&Sn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Sn.REACT_APP_SC_DISABLE_SPEEDY!==""?Sn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Sn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Sn!==void 0&&Sn.SC_DISABLE_SPEEDY!==void 0&&Sn.SC_DISABLE_SPEEDY!==""&&Sn.SC_DISABLE_SPEEDY!=="false"&&Sn.SC_DISABLE_SPEEDY),kE={},cu=Object.freeze([]),rs=Object.freeze({});function fv(e,t,n){return n===void 0&&(n=rs),e.theme!==n.theme&&e.theme||t||n.theme}var hv=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),DE=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,bE=/(^-|-$)/g;function E0(e){return e.replace(DE,"-").replace(bE,"")}var OE=/(a)(d)/gi,pc=52,w0=function(e){return String.fromCharCode(e+(e>25?39:97))};function ih(e){var t,n="";for(t=Math.abs(e);t>pc;t=t/pc|0)n=w0(t%pc)+n;return(w0(t%pc)+n).replace(OE,"$1-$2")}var _f,pv=5381,jr=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},gv=function(e){return jr(pv,e)};function mv(e){return ih(gv(e)>>>0)}function NE(e){return e.displayName||e.name||"Component"}function Cf(e){return typeof e=="string"&&!0}var yv=typeof Symbol=="function"&&Symbol.for,vv=yv?Symbol.for("react.memo"):60115,BE=yv?Symbol.for("react.forward_ref"):60112,HE={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},FE={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Sv={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},LE=((_f={})[BE]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},_f[vv]=Sv,_f);function _0(e){return("type"in(t=e)&&t.type.$$typeof)===vv?Sv:"$$typeof"in e?LE[e.$$typeof]:HE;var t}var UE=Object.defineProperty,GE=Object.getOwnPropertyNames,C0=Object.getOwnPropertySymbols,xE=Object.getOwnPropertyDescriptor,$E=Object.getPrototypeOf,P0=Object.prototype;function Iv(e,t,n){if(typeof t!="string"){if(P0){var o=$E(t);o&&o!==P0&&Iv(e,o,n)}var s=GE(t);C0&&(s=s.concat(C0(t)));for(var a=_0(e),c=_0(t),d=0;d<s.length;++d){var u=s[d];if(!(u in FE||n&&n[u]||c&&u in c||a&&u in a)){var h=xE(t,u);try{UE(e,u,h)}catch{}}}}return e}function ss(e){return typeof e=="function"}function bh(e){return typeof e=="object"&&"styledComponentId"in e}function Zo(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function oh(e,t){if(e.length===0)return"";for(var n=e[0],o=1;o<e.length;o++)n+=e[o];return n}function Ba(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function rh(e,t,n){if(n===void 0&&(n=!1),!n&&!Ba(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var o=0;o<t.length;o++)e[o]=rh(e[o],t[o]);else if(Ba(t))for(var o in t)e[o]=rh(e[o],t[o]);return e}function Oh(e,t){Object.defineProperty(e,"toString",{value:t})}function Va(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var WE=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,o=0;o<t;o++)n+=this.groupSizes[o];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var o=this.groupSizes,s=o.length,a=s;t>=a;)if((a<<=1)<0)throw Va(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(o),this.length=a;for(var c=s;c<a;c++)this.groupSizes[c]=0}for(var d=this.indexOfGroup(t+1),u=(c=0,n.length);c<u;c++)this.tag.insertRule(d,n[c])&&(this.groupSizes[t]++,d++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],o=this.indexOfGroup(t),s=o+n;this.groupSizes[t]=0;for(var a=o;a<s;a++)this.tag.deleteRule(o)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var o=this.groupSizes[t],s=this.indexOfGroup(t),a=s+o,c=s;c<a;c++)n+="".concat(this.tag.getRule(c)).concat(Dh);return n},e}(),bc=new Map,Gc=new Map,Oc=1,gc=function(e){if(bc.has(e))return bc.get(e);for(;Gc.has(Oc);)Oc++;var t=Oc++;return bc.set(e,t),Gc.set(t,e),t},YE=function(e,t){Oc=t+1,bc.set(e,t),Gc.set(t,e)},zE="style[".concat(os,"][").concat(dv,'="').concat(lu,'"]'),jE=new RegExp("^".concat(os,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),XE=function(e,t,n){for(var o,s=n.split(","),a=0,c=s.length;a<c;a++)(o=s[a])&&e.registerName(t,o)},VE=function(e,t){for(var n,o=((n=t.textContent)!==null&&n!==void 0?n:"").split(Dh),s=[],a=0,c=o.length;a<c;a++){var d=o[a].trim();if(d){var u=d.match(jE);if(u){var h=0|parseInt(u[1],10),p=u[2];h!==0&&(YE(p,h),XE(e,p,u[3]),e.getTag().insertRules(h,s)),s.length=0}else s.push(d)}}},R0=function(e){for(var t=document.querySelectorAll(zE),n=0,o=t.length;n<o;n++){var s=t[n];s&&s.getAttribute(os)!==uv&&(VE(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function qE(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var Tv=function(e){var t=document.head,n=e||t,o=document.createElement("style"),s=function(d){var u=Array.from(d.querySelectorAll("style[".concat(os,"]")));return u[u.length-1]}(n),a=s!==void 0?s.nextSibling:null;o.setAttribute(os,uv),o.setAttribute(dv,lu);var c=qE();return c&&o.setAttribute("nonce",c),n.insertBefore(o,a),o},ZE=function(){function e(t){this.element=Tv(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var o=document.styleSheets,s=0,a=o.length;s<a;s++){var c=o[s];if(c.ownerNode===n)return c}throw Va(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),KE=function(){function e(t){this.element=Tv(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var o=document.createTextNode(n);return this.element.insertBefore(o,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),QE=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),M0=Uc,JE={isServer:!Uc,useCSSOMInjection:!ME},xc=function(){function e(t,n,o){t===void 0&&(t=rs),n===void 0&&(n={});var s=this;this.options=jt(jt({},JE),t),this.gs=n,this.names=new Map(o),this.server=!!t.isServer,!this.server&&Uc&&M0&&(M0=!1,R0(this)),Oh(this,function(){return function(a){for(var c=a.getTag(),d=c.length,u="",h=function(y){var S=function(_){return Gc.get(_)}(y);if(S===void 0)return"continue";var v=a.names.get(S),A=c.getGroup(y);if(v===void 0||!v.size||A.length===0)return"continue";var I="".concat(os,".g").concat(y,'[id="').concat(S,'"]'),E="";v!==void 0&&v.forEach(function(_){_.length>0&&(E+="".concat(_,","))}),u+="".concat(A).concat(I,'{content:"').concat(E,'"}').concat(Dh)},p=0;p<d;p++)h(p);return u}(s)})}return e.registerId=function(t){return gc(t)},e.prototype.rehydrate=function(){!this.server&&Uc&&R0(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(jt(jt({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var o=n.useCSSOMInjection,s=n.target;return n.isServer?new QE(s):o?new ZE(s):new KE(s)}(this.options),new WE(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(gc(t),this.names.has(t))this.names.get(t).add(n);else{var o=new Set;o.add(n),this.names.set(t,o)}},e.prototype.insertRules=function(t,n,o){this.registerName(t,n),this.getTag().insertRules(gc(t),o)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(gc(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),ew=/&/g,tw=/^\s*\/\/.*$/gm;function Av(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(o){return"".concat(t," ").concat(o)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=Av(n.children,t)),n})}function nw(e){var t,n,o,s=rs,a=s.options,c=a===void 0?rs:a,d=s.plugins,u=d===void 0?cu:d,h=function(S,v,A){return A.startsWith(n)&&A.endsWith(n)&&A.replaceAll(n,"").length>0?".".concat(t):S},p=u.slice();p.push(function(S){S.type===ou&&S.value.includes("&")&&(S.props[0]=S.props[0].replace(ew,n).replace(o,h))}),c.prefix&&p.push(PE),p.push(wE);var y=function(S,v,A,I){v===void 0&&(v=""),A===void 0&&(A=""),I===void 0&&(I="&"),t=I,n=v,o=new RegExp("\\".concat(n,"\\b"),"g");var E=S.replace(tw,""),_=AE(A||v?"".concat(A," ").concat(v," { ").concat(E," }"):E);c.namespace&&(_=Av(_,c.namespace));var w=[];return Lc(_,_E(p.concat(CE(function(P){return w.push(P)})))),w};return y.hash=u.length?u.reduce(function(S,v){return v.name||Va(15),jr(S,v.name)},pv).toString():"",y}var iw=new xc,sh=nw(),Ev=hi.createContext({shouldForwardProp:void 0,styleSheet:iw,stylis:sh});Ev.Consumer;hi.createContext(void 0);function ah(){return ge.useContext(Ev)}var ow=function(){function e(t,n){var o=this;this.inject=function(s,a){a===void 0&&(a=sh);var c=o.name+a.hash;s.hasNameForId(o.id,c)||s.insertRules(o.id,c,a(o.rules,c,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,Oh(this,function(){throw Va(12,String(o.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=sh),this.name+t.hash},e}(),rw=function(e){return e>="A"&&e<="Z"};function k0(e){for(var t="",n=0;n<e.length;n++){var o=e[n];if(n===1&&o==="-"&&e[0]==="-")return e;rw(o)?t+="-"+o.toLowerCase():t+=o}return t.startsWith("ms-")?"-"+t:t}var wv=function(e){return e==null||e===!1||e===""},_v=function(e){var t,n,o=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!wv(a)&&(Array.isArray(a)&&a.isCss||ss(a)?o.push("".concat(k0(s),":"),a,";"):Ba(a)?o.push.apply(o,Na(Na(["".concat(s," {")],_v(a),!1),["}"],!1)):o.push("".concat(k0(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in RE||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return o};function Ao(e,t,n,o){if(wv(e))return[];if(bh(e))return[".".concat(e.styledComponentId)];if(ss(e)){if(!ss(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return Ao(s,t,n,o)}var a;return e instanceof ow?n?(e.inject(n,o),[e.getName(o)]):[e]:Ba(e)?_v(e):Array.isArray(e)?Array.prototype.concat.apply(cu,e.map(function(c){return Ao(c,t,n,o)})):[e.toString()]}function Cv(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(ss(n)&&!bh(n))return!1}return!0}var sw=gv(lu),aw=function(){function e(t,n,o){this.rules=t,this.staticRulesId="",this.isStatic=(o===void 0||o.isStatic)&&Cv(t),this.componentId=n,this.baseHash=jr(sw,n),this.baseStyle=o,xc.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,o){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,o):"";if(this.isStatic&&!o.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=Zo(s,this.staticRulesId);else{var a=oh(Ao(this.rules,t,n,o)),c=ih(jr(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,c)){var d=o(a,".".concat(c),void 0,this.componentId);n.insertRules(this.componentId,c,d)}s=Zo(s,c),this.staticRulesId=c}else{for(var u=jr(this.baseHash,o.hash),h="",p=0;p<this.rules.length;p++){var y=this.rules[p];if(typeof y=="string")h+=y;else if(y){var S=oh(Ao(y,t,n,o));u=jr(u,S+p),h+=S}}if(h){var v=ih(u>>>0);n.hasNameForId(this.componentId,v)||n.insertRules(this.componentId,v,o(h,".".concat(v),void 0,this.componentId)),s=Zo(s,v)}}return s},e}(),Nh=hi.createContext(void 0);Nh.Consumer;var Pf={};function lw(e,t,n){var o=bh(e),s=e,a=!Cf(e),c=t.attrs,d=c===void 0?cu:c,u=t.componentId,h=u===void 0?function(R,C){var k=typeof R!="string"?"sc":E0(R);Pf[k]=(Pf[k]||0)+1;var D="".concat(k,"-").concat(mv(lu+k+Pf[k]));return C?"".concat(C,"-").concat(D):D}(t.displayName,t.parentComponentId):u,p=t.displayName,y=p===void 0?function(R){return Cf(R)?"styled.".concat(R):"Styled(".concat(NE(R),")")}(e):p,S=t.displayName&&t.componentId?"".concat(E0(t.displayName),"-").concat(t.componentId):t.componentId||h,v=o&&s.attrs?s.attrs.concat(d).filter(Boolean):d,A=t.shouldForwardProp;if(o&&s.shouldForwardProp){var I=s.shouldForwardProp;if(t.shouldForwardProp){var E=t.shouldForwardProp;A=function(R,C){return I(R,C)&&E(R,C)}}else A=I}var _=new aw(n,S,o?s.componentStyle:void 0);function w(R,C){return function(k,D,F){var W=k.attrs,Y=k.componentStyle,G=k.defaultProps,j=k.foldedComponentIds,ee=k.styledComponentId,V=k.target,te=hi.useContext(Nh),re=ah(),ie=k.shouldForwardProp||re.shouldForwardProp,z=fv(D,te,G)||rs,ne=function(Me,le,Ee){for(var _e,se=jt(jt({},le),{className:void 0,theme:Ee}),pe=0;pe<Me.length;pe+=1){var Ne=ss(_e=Me[pe])?_e(se):_e;for(var we in Ne)se[we]=we==="className"?Zo(se[we],Ne[we]):we==="style"?jt(jt({},se[we]),Ne[we]):Ne[we]}return le.className&&(se.className=Zo(se.className,le.className)),se}(W,D,z),Q=ne.as||V,O={};for(var x in ne)ne[x]===void 0||x[0]==="$"||x==="as"||x==="theme"&&ne.theme===z||(x==="forwardedAs"?O.as=ne.forwardedAs:ie&&!ie(x,Q)||(O[x]=ne[x]));var ae=function(Me,le){var Ee=ah(),_e=Me.generateAndInjectStyles(le,Ee.styleSheet,Ee.stylis);return _e}(Y,ne),ue=Zo(j,ee);return ae&&(ue+=" "+ae),ne.className&&(ue+=" "+ne.className),O[Cf(Q)&&!hv.has(Q)?"class":"className"]=ue,O.ref=F,ge.createElement(Q,O)}(P,R,C)}w.displayName=y;var P=hi.forwardRef(w);return P.attrs=v,P.componentStyle=_,P.displayName=y,P.shouldForwardProp=A,P.foldedComponentIds=o?Zo(s.foldedComponentIds,s.styledComponentId):"",P.styledComponentId=S,P.target=o?s.target:e,Object.defineProperty(P,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(R){this._foldedDefaultProps=o?function(C){for(var k=[],D=1;D<arguments.length;D++)k[D-1]=arguments[D];for(var F=0,W=k;F<W.length;F++)rh(C,W[F],!0);return C}({},s.defaultProps,R):R}}),Oh(P,function(){return".".concat(P.styledComponentId)}),a&&Iv(P,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),P}function D0(e,t){for(var n=[e[0]],o=0,s=t.length;o<s;o+=1)n.push(t[o],e[o+1]);return n}var b0=function(e){return Object.assign(e,{isCss:!0})};function Pv(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(ss(e)||Ba(e))return b0(Ao(D0(cu,Na([e],t,!0))));var o=e;return t.length===0&&o.length===1&&typeof o[0]=="string"?Ao(o):b0(Ao(D0(o,t)))}function lh(e,t,n){if(n===void 0&&(n=rs),!t)throw Va(1,t);var o=function(s){for(var a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];return e(t,n,Pv.apply(void 0,Na([s],a,!1)))};return o.attrs=function(s){return lh(e,t,jt(jt({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},o.withConfig=function(s){return lh(e,t,jt(jt({},n),s))},o}var Rv=function(e){return lh(lw,e)},qe=Rv;hv.forEach(function(e){qe[e]=Rv(e)});var cw=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=Cv(t),xc.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,o,s){var a=s(oh(Ao(this.rules,n,o,s)),""),c=this.componentId+t;o.insertRules(c,c,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,o,s){t>2&&xc.registerId(this.componentId+t),this.removeStyles(t,o),this.createStyles(t,n,o,s)},e}();function uw(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=Pv.apply(void 0,Na([e],t,!1)),s="sc-global-".concat(mv(JSON.stringify(o))),a=new cw(o,s),c=function(u){var h=ah(),p=hi.useContext(Nh),y=hi.useRef(h.styleSheet.allocateGSInstance(s)).current;return h.styleSheet.server&&d(y,u,h.styleSheet,p,h.stylis),hi.useLayoutEffect(function(){if(!h.styleSheet.server)return d(y,u,h.styleSheet,p,h.stylis),function(){return a.removeStyles(y,h.styleSheet)}},[y,u,h.styleSheet,p,h.stylis]),null};function d(u,h,p,y,S){if(a.isStatic)a.renderStyles(u,kE,p,S);else{var v=jt(jt({},h),{theme:fv(h,y,c.defaultProps)});a.renderStyles(u,v,p,S)}}return hi.memo(c)}function Mv(e,t){var n=ge.useRef(null),o=ge.useRef(!1),s=ge.useRef(e);s.current=e;var a=ge.useCallback(function(d){o.current&&(s.current(d),n.current=requestAnimationFrame(a))},[]),c=ge.useMemo(function(){return[function(){o.current&&(o.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){o.current||(o.current=!0,n.current=requestAnimationFrame(a))},function(){return o.current}]},[]);return ge.useEffect(function(){return c[0]},[]),c}function dw(e,t,n,o,s){var c;(c=e.onExit)==null||c.call(e,o,t);const a=s.find(({id:d})=>d===t);return a!=null&&a.onEnter?a.onEnter(o,n):{...n,enteredAt:o.updateContext.gameState.time}}function fw(e,t){return t.find(({id:n})=>n===e)}function hw(e,t){return e!==t}function pw(e){e&&console.warn(`No handler found for state: ${e}`)}const Ea="bushGrowing",qo="bushFull",Nc="bushSpreading",Ha="bushDying",Dt=24,Lt=10,Ue=4e3,Ge=4e3,$c=5,gw=15,mw=5e3,Bi=100,Hi=20,Fi=60,Li=200,kv=200,yw=1e3,vw=5,Sw=3,Iw=12,Tw=940,ch=20,O0=90,Dv=100,sr=5,Aw=.5,uu=30,Ui=.1,ma=.9,Ew=2,ww=2;var ti=(e=>(e.Berry="berry",e.Meat="meat",e))(ti||{});const Bh={berry:"",meat:""};function bv(e,t){return e+t*65536}function Ov(e){return{gridX:e%65536,gridY:Math.floor(e/65536)}}function _w(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function Nv(){return{lastUpdateTime:0,sectors:{}}}const Ft=20,Wc=100,Bv=20,Hv=0,Cw=20,Pw=1,Fv=.15,Rw=.5,Mw=.01,kw=24,Dw="#6B5344",bw="#4A3728",N0=.85,Lv=35,Ow=30,B0=1.25,H0=40,Rf=Math.PI/6,Uv=.5,Nw=1,du=10,Fa=80,Gv=3,ia=5,Xt=150,xv=Xt*.8,Bw=Xt*.2,Bn=Xt*.8,wo=30,$v=10,Hw=10,Fw=.5,Ve=30,Wv=Ve*.75,fu=30,Yv=fu*.75,zv=50,Lw=20,Uw=Fa*.8,Gw=.7,Yc=16,Hh=40,Fh=16,xw=72/3,F0=24,$w=1.25,Ww=1.5,L0=Xt*.6,jv=50,Yw=1,Lh=Fa*.65,zw=80,jw=50,Xw=1,Vw=128,Xv=10,U0=100,Uh=35,_o=30,hu=.5,qa=2.5,Gh=20,dn=250,xh=.4,$h=150,Wh=6,qw=5,Yh=2,pu=.5,gu=1.5,Zw=1,Kw=.5,Qw=.5,Jw=1.5,e1=.25,t1=2.5,n1=45,i1=.05;var At=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(At||{}),je=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e))(je||{}),ar=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(ar||{});const zc=24,o1=24;let r1=0;function s1(){return`notification-${Date.now()}-${r1++}`}function La(e,t){if(t.identifier){const o=e.notifications.find(s=>s.identifier===t.identifier);if(o){if(o.dismissedUntil&&e.time<o.dismissedUntil)return;o.message=t.message,o.timestamp=e.time,o.creationTime=Date.now(),o.duration=t.duration,o.targetEntityIds=t.targetEntityIds,o.highlightedEntityIds=t.highlightedEntityIds,o.targetPosition=t.targetPosition,o.targetArea=t.targetArea,o.targetRadius=t.targetRadius,o.isDismissed=!1,o.dismissedUntil=void 0;return}}const n={...t,id:s1(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function a1(e,t){const n=e.notifications.find(o=>o.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+o1))}function l1(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function c1(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const o of n.highlightedEntityIds){const s=e.entities.entities[o];s&&(s.isHighlighted=!0)}}function Vv(e,t,n,o){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,c={x:Math.cos(s)*a,y:Math.sin(s)*a},d=pi(e,c);return{x:(d.x%n+n)%n,y:(d.y%o+o)%o}}function $i(e,t,n,o){const s=t,{width:a,height:c}=t.mapDimensions,d={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},u=h=>{for(let p=0;p<h.length;p++){const y=h[p];if(o!==void 0&&y.id===o)continue;const S=bt(e,y.position,a,c),v=n+y.radius;if(S<v*v)return!0}return!1};return u(s.search.human.byRect(d))||u(s.search.berryBush.byRect(d))||u(s.search.corpse.byRect(d))}function u1(e,t,n,o,s){const a=t.mapDimensions.width,c=t.mapDimensions.height;if(!$i(e,t,o,s)&&!dr(t.soilDepletion,e,a,c))return e;const d=o;for(let u=d;u<=n;u+=d){const h=Math.ceil(2*Math.PI*u/d);for(let p=0;p<h;p++){const y=p/h*2*Math.PI,S={x:Math.cos(y)*u,y:Math.sin(y)*u},v=pi(e,S),A={x:(v.x%a+a)%a,y:(v.y%c+c)%c};if(!$i(A,t,o,s)&&!dr(t.soilDepletion,A,a,c))return A}}return null}function Kn(e,t){var c,d;const n=t;if((d=(c=n.cache)==null?void 0:c.tribeCenters)!=null&&d[e])return n.cache.tribeCenters[e];const o=t.search.building.byProperty("ownerId",e);if(o.length>0){const u=o.map(h=>h.position);return n.cache.tribeCenters[e]=g0(u)}const s=Co(e,t);if(s.length===0){const u=t.entities.entities[e];return n.cache.tribeCenters[e]=u?u.position:{x:0,y:0}}const a=s.map(u=>u.position);return n.cache.tribeCenters[e]=g0(a)}function G0(e,t,n){const o=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,c=e.y-t.position.y;return Math.abs(a)>o/2&&(a-=Math.sign(a)*o),Math.abs(c)>s/2&&(c-=Math.sign(c)*s),Math.abs(a)<=t.width/2&&Math.abs(c)<=t.height/2}const lr=80,Ut=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],Ae=20,Yi=(e,t,n)=>{var d,u,h,p;if(!e||!t||e===t)return!1;const o=n.entities.entities[e],s=n.entities.entities[t],a=(u=(d=o==null?void 0:o.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[t],c=(p=(h=s==null?void 0:s.tribeControl)==null?void 0:h.diplomacy)==null?void 0:p[e];return a===At.Hostile||c===At.Hostile},Za=(e,t,n)=>e.id===t.id?!1:Yi(e.leaderId,t.leaderId,n),cr=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:Yi(e.leaderId,t.ownerId,n),ps=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=Bn||t.hunger>=Bn||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||Za(e,t,n))return!1;const o=e.gender==="female"?e:t;return!(o.isPregnant||o.age>Hh)},x0=1,uh=150*.6,d1=800,f1=3,$0=24,h1=1.5,W0=.15,Y0=200,Mf=30*.75*1.2,p1=20,kf=800,g1=.7,m1=.5,y1=10,Df=400,v1=800,S1=8,I1=16,Ka=100,T1=100,qv=150,z0=600,j0=250,A1=.5,E1=.7,w1=300,_1=150;function C1(e){const t=Math.floor(e.x/Ae),n=Math.floor(e.y/Ae);return{x:t,y:n}}function dh(e,t){const n=Math.ceil(t/Ae),o=e%n*Ae+Ae/2,s=Math.floor(e/n)*Ae+Ae/2;return{x:o,y:s}}function P1(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(o/Ae),c=Math.floor(s/Ae),d=Math.ceil(t/Ae);return c*d+a}function Qn(e,t,n){const o=P1({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[o]||null}function zh(e,t){return t.terrainOwnership.includes(e)}function Zv(e,t,n,o){var c;const s=n;return(c=s.search)!=null&&c.human?s.search.human.byRadius(e,o).some(d=>Yi(t,d.leaderId,n)):!1}function R1(e,t,n,o,s=!1,a){if(s&&a&&Zv(e,a,o,qv))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:c,height:d}=o.mapDimensions,u=Math.ceil(c/Ae),h=Math.ceil(d/Ae),p=Math.ceil(t/Ae),y=t*t,S=Math.floor(e.x/Ae),v=Math.floor(e.y/Ae);let A=!1,I=!1;for(let E=-p;E<=p;E++)for(let _=-p;_<=p;_++){const w=((S+_)%u+u)%u,P=((v+E)%h+h)%h,R=w*Ae+Ae/2,C=P*Ae+Ae/2;if(bt(e,{x:R,y:C},c,d)<=y){const D=P*u+w,F=o.terrainOwnership[D];if(F===n)A=!0;else if(F!==null){if(s&&a&&Yi(a,F,o))continue;I=!0}}}return I?{valid:!1,reason:"Position overlaps with another tribe's territory"}:A?{valid:!0}:zh(n,o)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function Kv(e,t,n,o){if(!zh(n,o))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(Zv(e,n,o,qv))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=o.mapDimensions,c=Math.ceil(s/Ae),d=Math.ceil(a/Ae),u=Math.ceil(t/Ae),h=t*t,p=Math.floor(e.x/Ae),y=Math.floor(e.y/Ae);let S=!1;for(let v=-u;v<=u;v++){for(let A=-u;A<=u;A++){const I=((p+A)%c+c)%c,E=((y+v)%d+d)%d,_=I*Ae+Ae/2,w=E*Ae+Ae/2;if(bt(e,{x:_,y:w},s,a)<=h){const R=E*c+I;if(o.terrainOwnership[R]===n){S=!0;break}}}if(S)break}return S?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function M1(e,t,n,o=0,s=!1,a){if(o>0){const d=R1(e,o,t,n,s,a);return d.valid?{canPlace:!0}:{canPlace:!1,reason:d.reason}}const c=Qn(e.x,e.y,n);return c===null||c===t?{canPlace:!0}:s&&a&&Yi(a,c,n)?{canPlace:!0}:c!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function hr(e,t,n){const o=Qn(e.x,e.y,n);return o===null||o===t||!Yi(t,o,n)}function Qv(e,t,n,o,{allowOverwrite:s}){const{width:a,height:c}=o.mapDimensions,d=Math.ceil(a/Ae),u=Math.ceil(c/Ae),h=Math.ceil(t/Ae),p=Math.floor(e.x/Ae),y=Math.floor(e.y/Ae);for(let w=-h;w<=h;w++)for(let P=-h;P<=h;P++){const R=((p+P)%d+d)%d,C=((y+w)%u+u)%u,k=R*Ae+Ae/2,D=C*Ae+Ae/2;if(X(e,{x:k,y:D},a,c)<=t){const W=C*d+R,Y=o.terrainOwnership[W];(s||Y===null||Y===n)&&(o.terrainOwnership[W]=n)}}const S=3,v=h+S+2,A=[];for(let w=-v;w<=v;w++)for(let P=-v;P<=v;P++){const R=((p+P)%d+d)%d,C=((y+w)%u+u)%u,k=C*d+R;if(o.terrainOwnership[k]===null){let D=!1;const F=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const W of F){let Y=!1,G=!1;for(let j=1;j<=S;j++){const ee=((R+W.x*j)%d+d)%d,te=((C+W.y*j)%u+u)%u*d+ee;if(o.terrainOwnership[te]===n){Y=!0;break}}if(Y)for(let j=1;j<=S;j++){const ee=((R-W.x*j)%d+d)%d,te=((C-W.y*j)%u+u)%u*d+ee;if(o.terrainOwnership[te]===n){G=!0;break}}if(Y&&G){D=!0;break}}D&&A.push(k)}}for(const w of A)o.terrainOwnership[w]=n;const I=250,E=new Set;for(let w=-v;w<=v;w++)for(let P=-v;P<=v;P++){const R=((p+P)%d+d)%d,k=((y+w)%u+u)%u*d+R;if(o.terrainOwnership[k]===null&&!E.has(k)){const D=[],F=[k];E.add(k),D.push(k);let W=!0,Y=0;for(;Y<F.length;){const G=F[Y++];if(D.length>I){W=!1;break}const j=G%d,ee=Math.floor(G/d),V=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:te,ny:re}of V){const ie=((j+te)%d+d)%d,ne=((ee+re)%u+u)%u*d+ie;o.terrainOwnership[ne]===null&&!E.has(ne)&&(E.add(ne),W&&(D.push(ne),F.push(ne)))}}if(W&&D.length<=I)for(const G of D)o.terrainOwnership[G]=n}}const _=[];for(let w=-v;w<=v;w++)for(let P=-v;P<=v;P++){const R=((p+P)%d+d)%d,C=((y+w)%u+u)%u,k=C*d+R;if(o.terrainOwnership[k]===null){let D=0;for(let F=-1;F<=1;F++)for(let W=-1;W<=1;W++){if(W===0&&F===0)continue;const Y=((R+W)%d+d)%d,j=((C+F)%u+u)%u*d+Y;o.terrainOwnership[j]===n&&D++}D>=5&&_.push(k)}}for(const w of _)o.terrainOwnership[w]=n}function jh(e,t,n,o){Qv(e,t,n,o,{allowOverwrite:!1})}function Jv(e,t,n,o){Qv(e,t,n,o,{allowOverwrite:!0})}function jc(e,t,n){const o=e.terrainOwnership;for(let s=0;s<o.length;s++)o[s]===t&&(o[s]=n)}function Xe(e,t,n,o,s){const a=t,c=o,d="position"in e&&e.id?e:null,u=d?d.position:e,h=a.search[n].byRadius(u,c);let p=null,y=c;for(const S of h){if(S.id===(d==null?void 0:d.id)||s&&!s(S))continue;const v=X(u,S.position,t.mapDimensions.width,t.mapDimensions.height);v<y&&(y=v,p=S)}return p}function wt(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function k1(e,t){var c;const o=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const d of o){if(d.attackTargetId!==e)continue;const u=X(d.position,((c=t.entities.entities[e])==null?void 0:c.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<a&&(s=d,a=u)}return s}function eS(e){return e.search.human.all()}function D1(e,t,n){const{width:o,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const c of a){const d=X(e,c.position,o,s),u=c.type==="tree"?c.radius*2:c.radius;if(d<u)return c}}function b1(e,t,n,o,s){const{width:a,height:c}=o.mapDimensions,d=n*n;if(s){for(let S=0;S<s.length;S++)if(bt(e,s[S],a,c)<d)return!0;return!1}const u=eS(o),h=new Set;for(let S=0;S<u.length;S++){const v=u[S];v.leaderId&&v.leaderId!==t&&h.add(v.leaderId)}const p=h.values();let y=p.next();for(;!y.done;){const S=y.value,v=Kn(S,o);if(bt(e,v,a,c)<d)return!0;y=p.next()}return!1}var Se=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(Se||{});function Oe(e,t,n,o,s,a,c){const d={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:o,entityId:s,targetPosition:a,targetEntityId:c};return e.visualEffects.push(d),e.nextVisualEffectId++,d.id}const We=1,Ua=3,Oi=100,tS=20,Jo=10,O1=.5,wa=150,N1=25,B1=.5,fh=100,nS=25,H1=.5,F1=15,hh=4,L1=.75,U1=15,G1=8,x1=20;function Ga(e,t,n,o,s,a){if(n===void 0)return!1;const{width:c,height:d}=o.mapDimensions;if(s&&a!==void 0&&bt(s,e,c,d)>a*a)return!1;const u=Ch(t),h=Math.sqrt(u.width*u.width+u.height*u.height)/2;if($i(e,o,h*.8))return!1;if(t===Z.PlantingZone){const{depletedSectors:I}=_S(o.soilDepletion,e,u.width,u.height,c,d);if(I.length>0)return!1}const y=o.search.building.byRadius(e,h*2);for(const I of y){const E=bt(e,I.position,c,d),_=(Math.max(u.width,u.height)+Math.max(I.width,I.height))/2;if(E<_*_*.81)return!1}const S=t===Z.BorderPost;return!!M1(e,n,o,S?_h:lr,S,n).canPlace}function $1(e){const t=[],n=2*Math.PI/e;for(let o=0;o<e;o++){const s=o*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function bf(e,t,n,o,s,a,c){const d=performance.now(),u=n,h=Ch(e),p=n.mapDimensions.width,y=n.mapDimensions.height,S=u.search.building.byProperty("ownerId",t),v=[];if(S.length>0){a&&v.unshift(a);const w=Kn(t,n),P=[...S].sort((R,C)=>{const k=bt(R.position,w,p,y),D=bt(C.position,w,p,y);return k-D});v.push(...P.map(R=>R.position))}else v.push(Kn(t,n));const A=Math.min(v.length,S1),I=Math.max(h.width,h.height),E=I+20,_=I/2;for(let w=0;w<A;w++){const P=v[w];for(let R=E;R<=o;R+=_){const C=Math.max(8,Math.min(I1,Math.ceil(2*Math.PI*R/I))),k=$1(C);for(let D=0;D<C;D++){const F=k[D].cos*R,W=k[D].sin*R,Y=P.x+F,G=P.y+W,j=(Y%p+p)%p,ee=(G%y+y)%y;if(!b1({x:j,y:ee},t,s,n,c)&&Ga({x:j,y:ee},e,t,n))return performance.now()-d,{x:j,y:ee}}}}performance.now()-d}function Xh(e,t,n,o){if(t===Z.BorderPost)return Jv(e,_h,n,o),Oe(o,Se.BorderClaim,e,We,n),null;const s=fk(o.entities,e,t,n);return t===Z.Bonfire&&(s.storageCapacity=hh,s.storedItems=[]),jh(e,lr,n,o),t===Z.PlantingZone&&Oa(o),s}function ph(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===Z.PlantingZone&&Oa(t))}function W1(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let c=e.x-a.position.x,d=e.y-a.position.y;const u=t.mapDimensions.width,h=t.mapDimensions.height;if(Math.abs(c)>u/2&&(c-=Math.sign(c)*u),Math.abs(d)>h/2&&(d-=Math.sign(d)*h),Math.abs(c)<=a.width/2&&Math.abs(d)<=a.height/2)return a}}const gt=30,gs=gt*.6,iS="#4CAF50",oS="#FF5722",rS="#9C27B0",Y1="#2196F3",sS="#FFC107",z1="#DC143C",Vh="#FFFFFF",qh=[5,5],mu=5,as=15,j1=20,X1=16,V1=10,q1=16,Z1=16,Xc=["","","","","","","","","",""],_a=8,K1="#FFFFFF",un=18,Ke=15,Q1="rgba(0, 0, 0, 0.7)",J1=4,fo=150,mn=15,_i=10,vo="#555",e_="#f44336",t_="#4CAF50",n_="#2196F3",i_="#FFC107",mc=16,Di=32,yc=28,o_=10,r_=8,s_=8,a_=8,zo=28,oa=40,ra=10,X0=8,l_=11,Of=40,V0=5,c_=10,u_="#FFA500",d_="#808080",Ni=120,aS=30,f_=20,In="#2d3748",Et="#ffffff",ya="#4a5568",lS=5,Zh="#bdc9f792",cS="#272c36ff",uS="#a0aec0",Vc=300,dS="rgba(255, 255, 255, 0.5)",h_="rgba(0, 0, 0, 0.8)",p_="#FFFFFF",q0=14,Z0=8,K0=-15,fS="#FFD700",hS=5,g_="rgba(0, 0, 0, 0.5)",m_="#FFFFFF",y_=33,v_=400,S_=20,I_=10,T_="rgba(0, 0, 0, 0.7)",A_="#FFFFFF",Nf=20,Q0=16,E_=.5,J0=5,pS="#FFD700",w_=40,Kh=4,gS=3,__=5,mS=20,yS=5,C_="#FFFFFF",P_="#FF6B6B",yn=80,jo=10,vc=300,Xo=15,R_=8,M_="rgba(0, 0, 0, 0.8)",k_="#FFFFFF",Bf=14,ey=10,ci=20,D_="#FF6B6B",b_="#4CAF50",ty="#FFD700",O_="rgba(255, 255, 0, 0.3)",N_=2,B_=500,H_=120,F_=45,L_="#FFD700",U_=3,G_=4,Hf=225,ny=20,x_="#666",$_="#1a2a3a";let Ff=0;function qc(){const e=Xc[Ff];return Ff=(Ff+1)%Xc.length,e}function ls(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),o=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(o),t.length>0)return t[0];if(n.sort(o),n.length>0)return n[0]}function Wi(e,t){const n=e,o=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...o,...s]}function gh(e,t){var a,c,d,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(c=t.partnerIds)!=null&&c.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,o=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((d=e.ancestorIds)==null?void 0:d.some(h=>t.ancestorIds.includes(h)))||((u=t.ancestorIds)==null?void 0:u.some(h=>e.ancestorIds.includes(h)));return n||o||s}function vS(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const o=t.entities.entities[n];if(o&&o.gender==="male")return o}return null}function iy(e,t){var n;if(!e.isAdult){if(e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human")return o}if(e.motherId){const o=t.entities.entities[e.motherId];if(o&&o.type==="human")return o}}if(e.isAdult&&e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human"&&((n=ls(Wi(t,o)))==null?void 0:n.id)===e.id)return o}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?vS(e,t):null}function W_(e,t){let n=e;const o=new Set;o.add(n.id);for(let s=0;s<Gv;s++){let a=null;if(n.gender==="female"&&(a=vS(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||o.has(a.id))break;n=a,o.add(n.id)}return n}function Y_(e,t){var o;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(o=e.partnerIds)==null||o.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),Wi(t,e).forEach(s=>n.add(s)),Array.from(n)}function Zc(e,t){const n=new Map;function o(s){const a=Wi(t,s);for(const c of a)n.has(c.id)||(n.set(c.id,c),o(c))}return o(e),Array.from(n.values())}function Co(e,t){return t.search.human.byProperty("leaderId",e)}function Kc(e,t,n=new Map,o=new Set){var a;if(n.has(e))return n.get(e);if(o.has(e))return e;o.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const c=s.partnerIds.find(d=>{const u=t.entities.entities[d];return u&&u.gender==="male"});if(c){const d=Kc(c,t,n,o);return n.set(e,d),d}}if(s.fatherId&&t.entities.entities[s.fatherId]){const c=Kc(s.fatherId,t,n,o);return n.set(e,c),c}return n.set(e,e),e}function z_(e,t){e.leaderId=e.id,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{diplomacy:{}}),e.tribeInfo||(e.tribeInfo={tribeBadge:qc(),tribeColor:Ut[Math.floor(Math.random()*Ut.length)]}),e.tribeControl||(e.tribeControl={diplomacy:{}})}function j_(e,t){if(e.length===0)return null;const n=new Map,o=new Map;for(const c of e){const d=Kc(c.id,t,n);o.has(d)||o.set(d,[]),o.get(d).push(c)}let s=null,a=0;for(const[c,d]of o.entries())d.length>a&&(a=d.length,s=c);return s&&t.entities.entities[s]||null}function yu(e,t){var p,y,S;const n=new Map;for(let v=0;v<e.terrainOwnership.length;v++){const A=e.terrainOwnership[v];A!==null&&(n.has(A)||n.set(A,[]),n.get(A).push(v))}const{width:o,height:s}=e.mapDimensions,a=Math.ceil(o/Ae),c=new Map,d=Object.values(e.entities.entities).filter(v=>v.type==="human");for(const v of d)v.leaderId&&(c.has(v.leaderId)||c.set(v.leaderId,{leaderId:v.leaderId,tribeInfo:v.tribeInfo,members:[]}),(p=c.get(v.leaderId))==null||p.members.push(v));const u=t?(S=(y=e.entities.entities[t])==null?void 0:y.tribeControl)==null?void 0:S.diplomacy:void 0,h=Array.from(c.values()).map(v=>{var P,R;const A=e.entities.entities[v.leaderId],I=v.members.filter(C=>C.isAdult).length,E=v.members.length-I,_=n.get(v.leaderId)||[];let w=A==null?void 0:A.position;if(_.length>0){const C=_[0],k=C%a*Ae,D=Math.floor(C/a)*Ae,F={x:k,y:D};let W=0,Y=0;for(const ee of _){const V=ee%a*Ae,te=Math.floor(ee/a)*Ae,re=Le(F,{x:V,y:te},o,s);W+=re.x,Y+=re.y}const G=W/_.length,j=Y/_.length;w={x:((F.x+G)%o+o)%o,y:((F.y+j)%s+s)%s}}return{leaderId:v.leaderId,tribeBadge:((P=v==null?void 0:v.tribeInfo)==null?void 0:P.tribeBadge)||"",tribeColor:((R=v==null?void 0:v.tribeInfo)==null?void 0:R.tribeColor)||"",adultCount:I,childCount:E,isPlayerTribe:v.leaderId===t,leaderAge:(A==null?void 0:A.age)??0,leaderGender:(A==null?void 0:A.gender)??"male",diplomacyStatus:(u==null?void 0:u[v.leaderId??-1])??At.Friendly,territoryCenter:w}});return h.sort((v,A)=>v.isPlayerTribe?-1:A.isPlayerTribe?1:A.adultCount+A.childCount-(v.adultCount+v.childCount)),h}function SS(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function IS(e){var a;const t=new Set,o=e.search.human.all(),s=new Map;for(const c of o)c.leaderId&&(s.has(c.leaderId)||s.set(c.leaderId,[]),(a=s.get(c.leaderId))==null||a.push(c));for(const[c,d]of s){if(d.length===0)continue;const u=e.entities.entities[c],h=!u,p=u&&u.leaderId!==c;(h||p)&&t.add(c)}for(let c=0;c<e.terrainOwnership.length;c++){const d=e.terrainOwnership[c];d!==null&&!s.has(d)&&t.add(d)}return Array.from(t)}function X_(e,t){const n=new Map,s=t.search.human.all(),a=Y_(e,t);for(const d of a)n.set(d,3);for(const d of s)d.id===e.id||n.has(d)||gh(e,d)&&n.set(d,2);const c=Array.from(n.keys());for(const d of c)if(d.partnerIds)for(const u of d.partnerIds){const h=t.entities.entities[u];h&&!n.has(h)&&h.id!==e.id&&n.set(h,1)}return n}function V_(e,t){const n=Co(e,t);if(n.length===0)return null;const o=t.entities.entities[e];if(o&&o.leaderId&&o.leaderId!==o.id)return o.leaderId;const s=new Map;for(const d of n){const u=X_(d,t);for(const[h,p]of u)if(h.leaderId&&h.leaderId!==e){const y=h.leaderId,S=t.entities.entities[y];if(S&&S.leaderId===S.id){const v=s.get(y)||0;s.set(y,v+p)}}}let a=null,c=0;for(const[d,u]of s)u>c&&(c=u,a=d);return a}function oy(e,t,n){var p,y;const o=Co(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=o.length>0?(p=o[0].tribeInfo)==null?void 0:p.tribeBadge:"?",c=s.leaderId===e||!s.leaderId;if(c){const S=n.entities.entities[e];z_(s,S)}const d=((y=s.tribeInfo)==null?void 0:y.tribeBadge)??"?";for(const S of o)S.id!==t&&(S.leaderId=t,S.tribeInfo=s.tribeInfo);const h=n.search.building.byProperty("ownerId",e);for(const S of h)S.ownerId=t;jc(n,e,t),La(n,{identifier:`tribe-merge-${e}`,type:ar.TribeMerged,message:c?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${d}!`,duration:zc,targetEntityIds:[t],highlightedEntityIds:[t,...o.map(S=>S.id)]})}function q_(e){var n;const t=IS(e);for(const o of t){const s=Co(o,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",o);for(const h of u)ph(h.id,e);jc(e,o,null),La(e,{identifier:`tribe-dissolved-${o}`,type:ar.TribeMerged,message:"An extinct tribe has been dissolved.",duration:zc});continue}const a=j_(s,e);if(a){oy(o,a.id,e);continue}const c=V_(o,e);if(c)oy(o,c,e);else{const d=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const p of s)p.leaderId=void 0,p.tribeInfo=void 0;const h=e.search.building.byProperty("ownerId",o);for(const p of h)ph(p.id,e);jc(e,o,null),La(e,{identifier:`tribe-dissolved-${o}`,type:ar.TribeMerged,message:`Tribe ${d} has been dissolved due to lack of leadership.`,duration:zc})}}}var Ot=(e=>(e.Wood="wood",e))(Ot||{});const Qh={wood:""},Vn="treeGrowing",Hn="treeFull",gi="treeSpreading",Gt="treeFallen",mi="treeStump",ur="treeDying";function TS(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const n=SS({leaderId:e},t),o=0,c=t.search.building.byProperty("ownerId",e).reduce((A,I)=>{if(I.isConstructed)return A;const E=ei[I.buildingType].cost.wood||0;return A+E},0),u=tC(e,t).reduce((A,I)=>{const _=(I.maxFuelLevel||fh)-(I.fuelLevel||0);if(_<=0)return A;const w=Math.ceil(_/nS),P=I.storedItems.filter(C=>C.item.type===Ot.Wood).length,R=Math.max(0,w-P);return A+R},0),p=eC(e,t).reduce((A,I)=>{var _;const E=(_=I.storedItems)==null?void 0:_.filter(w=>w.item.type===Ot.Wood);return A+((E==null?void 0:E.length)||0)},0),y=n.reduce((A,I)=>{var E;return A+(((E=I.heldItem)==null?void 0:E.type)===Ot.Wood?1:0)},0),S=p+y,v=c+u+o;return t.cache.tribeWoodNeeds[e]=Math.max(0,v-S),t.cache.tribeWoodNeeds[e]}function Z_(e,t){const n=t;if(e&&n.cache.tribeAvailableWoodOnGround[e]!==void 0)return n.cache.tribeAvailableWoodOnGround[e];const o=n.search.tree.all().filter(s=>!(s.stateMachine[0]===Gt)||s.wood.length===0?!1:hr(s.position,e,t));return n.cache.tribeAvailableWoodOnGround[e]=o.reduce((s,a)=>s+a.wood.length,0),n.cache.tribeAvailableWoodOnGround[e]}function K_(e,t,n=!1){const o=typeof e=="object"?e.leaderId:e;return o?t.search.building.byProperty("buildingType",Z.PlantingZone).filter(a=>{if(!n&&!a.isConstructed)return!1;if(a.ownerId){const c=t.entities.entities[a.ownerId];return c&&c.leaderId===o}return!1}):[]}function Q_(e,t){const{width:n,height:o,position:s}=e,{width:a,height:c}=t.mapDimensions,{depletedSectors:d,totalSectorsCount:u}=_S(t.soilDepletion,s,n,o,a,c);return u===0?!0:d.length/u<.25}function AS(e){const t=uu*2,n=Math.floor(e.width/t),o=Math.floor(e.height/t);return n*o}function J_(e,t){const n=t,o=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,o).filter(c=>{const d=Math.abs(c.position.x-e.position.x),u=Math.abs(c.position.y-e.position.y);return d<=e.width/2&&u<=e.height/2}).length}function eC(e,t,n=!1){return t.search.building.byProperty("buildingType",Z.StorageSpot).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function tC(e,t,n=!1){return t.search.building.byProperty("buildingType",Z.Bonfire).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function Qa(e,t,n=void 0){return n?K_(n,t).some(c=>G0(e,c,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===Z.PlantingZone&&G0(e,a,t))}function vu(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(o/Ft),gridY:Math.floor(s/Ft)}}function ES(e,t,n){const o=bv(t,n);return e.sectors[o]||(e.sectors[o]=_w()),e.sectors[o]}function Jh(e,t,n){const o=bv(t,n),s=e.sectors[o];return s?s.health:Wc}function dr(e,t,n,o){const{gridX:s,gridY:a}=vu(t,n,o);return Jh(e,s,a)<Bv}function wS(e,t,n){return Jh(e,t,n)>=Bv}function nC(e,t,n,o,s,a,c){const{gridX:d,gridY:u}=vu(t,s,a),h=ES(e,d,u),p=h.lastAffectedBy[n]||0;if(o-p<Fv)return;const y=Qa(t,c)?Uv:1,S=Pw*y;h.health=Math.max(Hv,h.health-S),h.lastWalkTime=o,h.lastAffectedBy[n]=o}function iC(e,t,n,o,s,a){const{gridX:c,gridY:d}=vu(t,o,s),u=ES(e,c,d),h=Qa(t,a)?Uv:1,p=Cw*h;u.health=Math.max(Hv,u.health-p),u.lastPlantTime=n}function oC(e,t,n,o,s){let a=0;for(let c=-1;c<=1;c++)for(let d=-1;d<=1;d++){if(c===0&&d===0)continue;const u=((t+c)%o+o)%o,h=((n+d)%s+s)%s;wS(e,u,h)&&a++}return a}function rC({soilDepletion:e,time:t,mapDimensions:{width:n,height:o}}){if(t-e.lastUpdateTime<Nw)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/Ft),c=Math.ceil(o/Ft),d=[];for(const u of Object.keys(e.sectors)){const h=Number(u),p=e.sectors[h],y=Math.max(p.lastWalkTime,p.lastPlantTime);if(t-y<kw)continue;const{gridX:S,gridY:v}=Ov(h),A=oC(e,S,v,a,c),I=A>0?Mw*(A/8):0,E=Rw+I;p.health=Math.min(Wc,p.health+E*s),p.health>=Wc&&d.push(h);const _=t-Fv*10;for(const w of Object.keys(p.lastAffectedBy)){const P=Number(w);p.lastAffectedBy[P]<_&&delete p.lastAffectedBy[P]}}for(const u of d)delete e.sectors[u]}function sC(e,t){const n=[];for(const o of Object.keys(e.sectors)){const s=Number(o),a=e.sectors[s];if(a.health<t){const{gridX:c,gridY:d}=Ov(s);n.push({gridX:c,gridY:d,health:a.health})}}return n}function _S(e,t,n,o,s,a){const c=[],d=n/2,u=o/2,h=t.x-d,p=t.x+d,y=t.y-u,S=t.y+u,v=Math.floor(h/Ft),A=Math.floor((p-.001)/Ft),I=Math.floor(y/Ft),E=Math.floor((S-.001)/Ft),_=Math.ceil(s/Ft),w=Math.ceil(a/Ft);let P=0;for(let R=v;R<=A;R++)for(let C=I;C<=E;C++){P++;const k=(R%_+_)%_,D=(C%w+w)%w;wS(e,k,D)||c.push({gridX:k,gridY:D})}return{depletedSectors:c,totalSectorsCount:P}}function ry(e,t,n,o,s){const{gridX:a,gridY:c}=vu(t,n,o),d=Jh(e,a,c);return 1+(s-1)*Math.sqrt(1-d/Wc)}const aC={id:Ea,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Dt/Lt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Ha,data:{...e,enteredAt:o.gameState.time}};if(!dr(o.gameState.soilDepletion,n.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height)){const c=Qa(n.position,o.gameState)?ww:1;n.timeSinceLastBerryRegen+=s*c,n.timeSinceLastBerryRegen>=Iw&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:ti.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:qo,data:{...e,enteredAt:o.gameState.time,previousState:Ea}}:{nextState:Ea,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},lC={id:qo,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Dt/Lt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Ha,data:{...e,enteredAt:o.gameState.time,previousState:qo}};if(n.food.length<n.maxFood)return{nextState:Ea,data:{...e,enteredAt:o.gameState.time,previousState:qo}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=O0){n.timeSinceLastSpreadAttempt=0;const c=o.gameState.time-n.timeSinceLastHarvest>=O0,d=Qa(n.position,o.gameState)?Ew:1,u=o.gameState.ecosystem.berryBushSpreadChance*d;if(c&&Math.random()<u)return{nextState:Nc,data:{...e,enteredAt:o.gameState.time,previousState:qo}}}return{nextState:qo,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function sy(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let o=n.hitpoints;return o+=(n.maxAge-n.age)*.5,o+=n.food.length*2,t+o},0)}var de=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(de||{});const Su={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},CS={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var Wr=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(Wr||{});const sa={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var fe=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectPalisade="SelectPalisade",e.SelectGate="SelectGate",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenTribeModal="OpenTribeModal",e.RecenterCamera="RecenterCamera",e.CloseTribeModal="CloseTribeModal",e))(fe||{});const Lf=30,cC=.4,uC=100,dC=72,PS=10,RS=2,ay=600,fC=1.5,MS=.1,Uf=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,Gf=""+new URL("gather-CU75596W.mp3",import.meta.url).href,hC=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,ly=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,pC=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,gC=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,mC=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,yC=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,vC=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,SC=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Ie=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Ie||{});const IC=new Map([[0,Uf],[1,Gf],[2,hC],[3,ly],[4,pC],[5,gC],[6,mC],[12,yC],[13,vC],[7,Uf],[8,ly],[9,Gf],[10,Gf],[11,Uf],[14,SC]]);let aa,xa;function TC(){if(!(typeof window>"u"))return xa}function ep(){if(!(typeof window>"u"))return!aa&&typeof window.AudioContext=="function"&&(aa=new window.AudioContext,xa=aa.createGain(),xa.connect(aa.destination),Ca(.1,!1)),aa}function Ca(e,t){xa&&(xa.gain.value=t?0:e/10)}const kS=new Map;let Sc=!1,cy=!1;async function AC(){if(cy||Sc)return;const e=ep();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),Sc=!0,console.log("Starting sound loading...");const t=[];IC.forEach((n,o)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{kS.set(o,a)}).catch(a=>{console.error(`Error loading sound ${Ie[o]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),cy=!0,Sc=!1,console.log("All sounds loaded successfully.")}catch(n){Sc=!1,console.error("An error occurred while loading sounds:",n)}}const Pa=new Map;function tp(e,t){const n=ep(),o=TC();if(!n||!o||o.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=kS.get(e);if(!s){console.warn(`Sound buffer not found for type: ${Ie[e]}`);return}if(t!=null&&t.trackId&&Pa.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const c=n.createGain(),d=n.createStereoPanner();let u=c;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const h=Le(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),p=X(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(p>ay)return;const y=1-Math.pow(p/ay,fC);c.gain.value=Math.max(0,y);const S=Math.sin(h.x/p*(Math.PI/2));d.pan.value=isNaN(S)?0:S,c.connect(d),u=d}else{const h=e===Ie.GameOver?.4:e===Ie.SoundTrack1?1:.2;c.gain.value=h}a.connect(u),u.connect(o),a.start(0),t!=null&&t.trackId&&(Pa.set(t.trackId,{sourceNode:a,gainNode:c}),a.onended=()=>{Pa.delete(t.trackId)})}function xf(e,t=1){const n=Pa.get(e),o=ep();if(n&&o){const{sourceNode:s,gainNode:a}=n,c=o.currentTime;a.gain.setValueAtTime(a.gain.value,c),a.gain.linearRampToValueAtTime(0,c+t),s.stop(c+t),s.onended=null,Pa.delete(e)}}function Ce(e,t,n){const o=wt(e.gameState);o&&tp(t,{position:n,listenerPosition:o.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}const De={create(){return{data:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e}},EC="tribeSplit_phase",Iu="tribeSplit_strategy",DS="tribeSplit_targetPosition",np="tribeSplit_targetBuildingId",ip="tribeSplit_familyIds",bS="tribeSplit_lastFailureTime";function wC(e,t){De.set(e,EC,"idle"),De.delete(e,Iu),De.delete(e,DS),De.delete(e,np),De.delete(e,ip),De.set(e,bS,t)}function _C(e,t){const n=De.get(e,bS);return n?t-n>=dC:!0}function OS(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(IS(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!_C(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const o=t.entities.entities[e.leaderId];if(!o||o.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=ls(Wi(t,o));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(W_(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const c=Co(e.leaderId,t).filter(v=>v.isAdult);if(c.length<Lf)return{canSplit:!1,reason:"Tribe too small"};const u=Zc(e,t).length+1,p=Zc(o,t).length+1;if(u>=p&&u>Lf)return{canSplit:!0,progress:1,strategy:uy(e,t)};const y=Math.max(c.length*cC,Lf),S=u/y;if(u>=y){const v=uy(e,t);return{canSplit:!0,progress:S,strategy:v}}return{canSplit:!1,progress:S,reason:`Family too small: ${u} < ${y}`}}function uy(e,t){if(!e.leaderId)return"migration";const n=t;if(!(Qn(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===Z.StorageSpot&&a.isConstructed);return s.length>0&&s.find(c=>X(e.position,c.position,t.mapDimensions.width,t.mapDimensions.height)<=uC)?"concentration":"migration"}function CC(e,t){if(!e.aiBlackboard)return!1;const n=De.get(e.aiBlackboard,Iu);if(!n)return!1;const o=Zc(e,t),s=[e.id,...o.map(a=>a.id)];return De.set(e.aiBlackboard,ip,s),n==="migration"?RC(e,t):n==="concentration"?MC(e,t):!1}function PC(e,t,n){if($i(e,n,30))return!1;const s=Qn(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function RC(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,o=t.mapDimensions.height,s=Math.min(n,o)/2,a=50,c=50;for(let d=0;d<=s;d+=a){const u=d===0?1:Math.max(8,Math.ceil(2*Math.PI*d/c)),h=d===0?0:2*Math.PI/u;for(let p=0;p<u;p++){const y=p*h,S=Math.cos(y)*d,v=Math.sin(y)*d,A=e.position.x+S,I=e.position.y+v,E={x:(A%n+n)%n,y:(I%o+o)%o};if(PC(E,e.leaderId,t))return De.set(e.aiBlackboard,DS,E),!0}}return!1}function MC(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const o=t.search.building.byProperty("ownerId",e.leaderId).filter(c=>c.buildingType===Z.StorageSpot&&c.isConstructed);if(o.length===0)return!1;let s=null,a=1/0;for(const c of o){const d=X(e.position,c.position,t.mapDimensions.width,t.mapDimensions.height);d<a&&(a=d,s=c)}return s?(De.set(e.aiBlackboard,np,s.id),!0):!1}function kC(e,t){var u;if(!e.aiBlackboard)return!1;const n=De.get(e.aiBlackboard,Iu),o=De.get(e.aiBlackboard,ip);if(!n||!o)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=qc(),c=Ut[Math.floor(Math.random()*Ut.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:c},e.tribeControl={diplomacy:{}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=At.Hostile);for(const h of o){if(h===e.id)continue;const p=t.entities.entities[h];!p||p.type!=="human"||(p.leaderId=e.id,p.tribeInfo={tribeBadge:a,tribeColor:c})}if(n==="concentration"){const h=De.get(e.aiBlackboard,np);if(h){const p=t.entities.entities[h];p&&p.type==="building"&&(p.ownerId=e.id)}}return La(t,{type:ar.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:zc,targetEntityIds:[e.id],highlightedEntityIds:o}),Ce({gameState:t},Ie.TribeSplit,e.position),wC(e.aiBlackboard,t.time),!0}function DC(e,t){De.set(e,Iu,t)}function NS(e,t){const n=OS(e,t);return{canSplit:n.canSplit,progress:n.progress}}function BS(e,t){if(!e.aiBlackboard)return;const n=OS(e,t);!n.canSplit||!n.strategy||(DC(e.aiBlackboard,n.strategy),CC(e,t)&&kC(e,t))}const bC=20,Jn=30,OC=.5,NC=.3,BC=2,HC=50;function op(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>wo&&n.push({type:de.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const c=Xe(t,e,"berryBush",Ve,h=>h.food.length>0),d=Xe(t,e,"corpse",Ve,h=>h.food.length>0);let u=null;c&&d?u=X(t.position,c.position,e.mapDimensions.width,e.mapDimensions.height)<=X(t.position,d.position,e.mapDimensions.width,e.mapDimensions.height)?c:d:u=c||d,u&&n.push({type:de.Gather,action:"gathering",key:"e",targetEntity:u})}const o=Xe(t,e,"human",Ve,c=>ps(t,c,e));if(o&&n.push({type:de.Procreate,action:"procreating",key:"r",targetEntity:o}),t.food.length>0&&t.isAdult){const c=Xe(t,e,"human",Ve,d=>{const u=d;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=wo});c&&n.push({type:de.FeedChild,action:"feeding",key:"h",targetEntity:c})}const s=Xe(t,e,"human",dn,c=>Za(t,c,e))??Xe(t,e,"predator",dn)??Xe(t,e,"prey",dn);if(s&&n.push({type:de.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(c=>c.type===ti.Berry).length>=sr&&n.push({type:de.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const c=Xe(t,e,"building",Jn,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});c&&n.push({type:de.Deposit,action:"idle",key:"x",targetEntity:c})}if(t.food.length<t.maxFood&&t.isAdult){const c=Xe(t,e,"building",Jn,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});c&&n.push({type:de.Retrieve,action:"idle",key:"z",targetEntity:c})}if(((a=t.heldItem)==null?void 0:a.type)===Ot.Wood){const c=Xe(t,e,"building",Jn,d=>{const u=d;return u.buildingType===Z.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});c&&n.push({type:de.Deposit,action:"depositing",key:"x",targetEntity:c})}if(NS(t,e).canSplit&&n.push({type:de.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const c=Xe(t,e,"tree",fu,d=>d.wood&&d.wood.length>0);c&&n.push({type:de.Chop,action:"chopping",key:"c",targetEntity:c})}return n}const FC={id:Nc,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o,a=o.deltaTime*(Dt/Lt);if(n.age+=a,n.age>=n.lifespan)return{nextState:Ha,data:{...e,enteredAt:s.time,previousState:Nc}};const c=Vv(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return $i(c,s,15)||nl(s.entities,c,s.time),{nextState:qo,data:{...e,enteredAt:s.time,previousState:Nc}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},LC={id:Ha,update:e=>({nextState:Ha,data:e}),onEnter:(e,t)=>(mr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},UC=[aC,lC,FC,LC],ct="humanIdle",Ri="humanMoving",va="humanEating",ms="humanGathering",Ra="humanDepositing",Ma="humanRetrieving",Ko="humanProcreating",Po="humanAttacking",Bc="humanPlanting",rp="humanChopping",GC={id:ct,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:Po,data:{...e,enteredAt:o.gameState.time,previousState:ct,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:(n.hunger>=xv?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:o.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:Ri,data:{...e,enteredAt:o.gameState.time,previousState:ct,target:n.target}}:n.activeAction==="gathering"?{nextState:ms,data:{...e,enteredAt:o.gameState.time,previousState:ct,target:n.target}}:n.activeAction==="eating"?{nextState:va,data:{...e,enteredAt:o.gameState.time,previousState:ct}}:n.activeAction==="planting"&&n.target?{nextState:Bc,data:{...e,enteredAt:o.gameState.time,previousState:ct,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:Ra,data:{...e,enteredAt:o.gameState.time,previousState:ct}}:n.activeAction==="retrieving"?{nextState:Ma,data:{...e,enteredAt:o.gameState.time,previousState:ct}}:n.activeAction==="chopping"&&n.target?{nextState:rp,data:{...e,enteredAt:o.gameState.time,previousState:ct,state:"chopping"}}:{nextState:ct,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function HS(e,t=1){let n=Hw;return e.hunger>=xv&&(n*=Fw),e.age>=Uw&&(n*=Gw),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const Fe=10;function FS(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(o/Fe),c=Math.floor(s/Fe),d=Math.ceil(t/Fe);return c*d+a}function Qc(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{x:Math.floor(o/Fe),y:Math.floor(s/Fe)}}function LS(e,t){const n=Math.ceil(e/Fe),o=Math.ceil(t/Fe),s=n*o;return{staticObstacles:new Uint8Array(s),gateOwners:new Array(s).fill(null)}}function $a(e,t,n,o,s=null){const{width:a,height:c}=e.mapDimensions,d=Math.ceil(a/Fe),u=Math.ceil(c/Fe),h=Math.ceil(n/Fe),p=Qc(t,a,c),y=p.y*d+p.x;e.navigationGrid.staticObstacles[y]=o?1:0,e.navigationGrid.gateOwners[y]=o?s:null;for(let S=-h;S<=h;S++)for(let v=-h;v<=h;v++){const A=(p.x+v+d)%d,I=(p.y+S+u)%u,E=A*Fe+Fe/2,_=I*Fe+Fe/2;if(X(t,{x:E,y:_},a,c)<=n){const P=I*d+A;e.navigationGrid.staticObstacles[P]=o?1:0,e.navigationGrid.gateOwners[P]=o?s:null}}}function dy(e,t,n,o){const{width:s,height:a}=e.mapDimensions,c=Le(t,n,s,a),d=Math.sqrt(c.x*c.x+c.y*c.y),u=Math.ceil(d/(Fe/2)),h=c.x/u,p=c.y/u,y=e.navigationGrid;for(let S=1;S<u;S++){const v={x:t.x+h*S,y:t.y+p*S},A=[{dx:0,dy:0},{dx:4,dy:0},{dx:-4,dy:0},{dx:0,dy:4},{dx:0,dy:-4}];for(const I of A){const E={x:v.x+I.dx,y:v.y+I.dy},_=FS(E,s,a);if(y.staticObstacles[_]){const w=y.gateOwners[_];if(w!==null&&w===o.leaderId)continue;return!0}}}return!1}function xC(e,t,n,o){const{width:s,height:a}=e.mapDimensions,c=Math.ceil(s/Fe),d=Math.ceil(a/Fe),u=Qc(t,s,a),h=Qc(n,s,a);if(u.x===h.x&&u.y===h.y)return[n];const p=e.navigationGrid,y=[u.y*c+u.x],S=new Map,v=new Map,A=new Map,I=u.y*c+u.x;v.set(I,0),A.set(I,fy(u,h,c,d));const E=2e3;let _=0;for(;y.length>0&&_<E;){_++;let w=y[0],P=A.get(w)??1/0,R=0;for(let D=1;D<y.length;D++){const F=A.get(y[D])??1/0;F<P&&(P=F,w=y[D],R=D)}const C=w%c,k=Math.floor(w/c);if(C===h.x&&k===h.y)return $C(S,w,c,n);y.splice(R,1);for(let D=-1;D<=1;D++)for(let F=-1;F<=1;F++){if(F===0&&D===0)continue;const W=(C+F+c)%c,Y=(k+D+d)%d,G=Y*c+W;if(p.staticObstacles[G]){const V=p.gateOwners[G];if(V===null||V!==o.leaderId)continue}const j=F!==0&&D!==0?1.414:1,ee=(v.get(w)??0)+j;ee<(v.get(G)??1/0)&&(S.set(G,w),v.set(G,ee),A.set(G,ee+fy({x:W,y:Y},h,c,d)),y.includes(G)||y.push(G))}}return null}function fy(e,t,n,o){let s=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);s>n/2&&(s=n-s),a>o/2&&(a=o-a);const c=1;return c*(s+a)+(1.414-2*c)*Math.min(s,a)}function $C(e,t,n,o){const s=[o];let a=t;const c=new Set;for(;e.has(a)&&!c.has(a);)c.add(a),a=e.get(a),s.unshift({x:a%n*Fe+Fe/2,y:Math.floor(a/n)*Fe+Fe/2});return s.shift(),s}const Ic=10;class WC{constructor(){Ht(this,"id",Ri)}update(t,n){var I;const{entity:o,updateContext:s}=n;if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:Po,data:{...t,enteredAt:s.gameState.time,previousState:Ri,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:ct,data:{...t,enteredAt:s.gameState.time,previousState:Ri}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(I=n.updateContext.gameState.entities.entities[o.target])==null?void 0:I.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*Ic*2,y:o.position.y+o.direction.y*Ic*2}),!a)return{nextState:ct,data:{...t,enteredAt:s.gameState.time,previousState:Ri}};const{width:c,height:d}=s.gameState.mapDimensions,u=X(o.position,a,c,d);if(u<Ic)return{nextState:ct,data:{...t,enteredAt:s.gameState.time,previousState:Ri}};const h=dy(s.gameState,o.position,a,o);if(o.path&&o.pathTarget&&(X(o.pathTarget,a,c,d)>40||!h&&u<150)&&(o.path=void 0,o.pathTarget=void 0),h&&!o.path)return s.gameState.pathfindingQueue.includes(o.id)||s.gameState.pathfindingQueue.push(o.id),o.acceleration=0,{nextState:Ri,data:t};let p=a;if(o.path&&o.path.length>0){if(p=o.path[0],dy(s.gameState,o.position,p,o))return o.path=void 0,o.pathTarget=void 0,s.gameState.pathfindingQueue.includes(o.id)||s.gameState.pathfindingQueue.push(o.id),o.acceleration=0,{nextState:Ri,data:t};X(o.position,p,c,d)<Ic&&(o.path.shift(),o.path.length>0?p=o.path[0]:p=a)}const y=Le(o.position,p,c,d),S=X(o.position,p,c,d),v=mt(y);if(S>H0){const E=m0(v,-Rf),_=m0(v,Rf),w=[v,E,_],P=w.map((C,k)=>{const D=pi(o.position,ut(C,H0)),F={x:(D.x%c+c)%c,y:(D.y%d+d)%d},W=ry(s.gameState.soilDepletion,F,c,d,B0),G=Math.cos(k===0?0:Rf);return W*G});let R=0;for(let C=1;C<P.length;C++)P[C]>P[R]&&(R=C);o.direction=w[R]}else o.direction=v;const A=ry(s.gameState.soilDepletion,o.position,c,d,B0);return o.acceleration=HS(o,A),{nextState:Ri,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const YC=new WC,zC={id:va,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction!=="eating"?{nextState:ct,data:{...e,enteredAt:o.gameState.time,previousState:va}}:(n.food.length>0&&(!n.eatingCooldownTime||o.gameState.time>=n.eatingCooldownTime)&&n.hunger>wo&&(n.hunger=Math.max(0,n.hunger-wo),n.food.pop(),n.eatingCooldownTime=o.gameState.time+1,Ce(o,Ie.Eat,n.position),(!n.lastEatingEffectTime||o.gameState.time-n.lastEatingEffectTime>2)&&(Oe(o.gameState,Se.Eating,n.position,We,n.id),n.lastEatingEffectTime=o.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:ct,data:{...e,enteredAt:o.gameState.time,previousState:va}}:{nextState:va,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class jC{constructor(){Ht(this,"id",ms)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const XC=new jC,VC={id:Ra,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:ct,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Ra}}:{nextState:Ra,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},qC={id:Ma,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:ct,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Ma}}:{nextState:Ma,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},ZC=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),KC=(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(s.time<(e.procreationEndTime||0))return{nextState:Ko,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<Bn&&a.hunger<Bn&&!n.procreationCooldown&&!a.procreationCooldown){const c=n.gender==="female"?n:a.gender==="female"?a:void 0,d=n.gender==="male"?n:a.gender==="male"?a:void 0;c&&d&&(c.isPregnant=!0,c.gestationTime=xw,c.pregnancyFatherId=d.id,n.procreationCooldown=F0,a.procreationCooldown=F0,Ce(o,Ie.Procreate,c.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:ct,data:{...e,enteredAt:s.time,previousState:Ko}}},QC={id:Ko,onEnter:ZC,update:KC},JC={id:Po,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:ct,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:ct,data:{...e}};const o=X(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Le(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=mt(s),o<=_o||o<=dn&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=HS(t.entity),{nextState:Po,data:e}}},eP={id:Bc,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(s.time-e.enteredAt>=Aw){const c=n.food.filter(u=>u.type===ti.Berry).length,d=dr(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(c>=sr&&!d){for(let u=0;u<sr;u++){const h=n.food.findIndex(p=>p.type===ti.Berry);h>-1&&n.food.splice(h,1)}nl(s.entities,e.plantingSpot,s.time),iC(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:ct,data:{...e,enteredAt:s.time,previousState:Bc}}}return{nextState:Bc,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class tP{constructor(){Ht(this,"id",rp)}update(t,n){const{entity:o,updateContext:s}=n;return o.activeAction!=="chopping"||o.heldItem?{nextState:ct,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const nP=new tP,iP=[GC,YC,zC,XC,VC,qC,QC,JC,eP,nP],Xn="preyIdle",yo="preyMoving",Sa="preyGrazing",Ia="preyProcreating",oP={id:Xn,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:yo,data:{...e,enteredAt:o.gameState.time,previousState:Xn,target:n.target}}:n.activeAction==="grazing"?{nextState:Sa,data:{...e,enteredAt:o.gameState.time,previousState:Xn}}:n.activeAction==="procreating"?{nextState:Ia,data:{...e,enteredAt:o.gameState.time,previousState:Xn}}:{nextState:Xn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},US=12,Tu=120,hy=50,rP=12,GS=30,sP=2,cs=50,aP=100,xS=2,lP=.9,cP=1,uP=50,dP=.5,$S=20,Au=140,py=40,fP=12,WS=40,hP=3,us=60,pr=40,pP=50,YS=320,zS=25,gP=60,jS=2,mP=90,yP=.7,vP=1,XS=3,sp=80,VS=10,Eu=80,qS=40,ZS=2,Jc=30,Xr=20,er=40,Vr=24,tr=48,qr=12,nr=40,Zr=20,ir=60,Kr=.75,So=2.5,Qr=.25,Io=2,KS=4;function SP(e){let t=rP;return e.isAdult||(t*=.7),e.hunger>=uP&&(t*=dP),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function IP(e,t){const n=e>>16&255,o=e>>8&255,s=e&255,a=t>>16&255,c=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),h=Math.floor((o+c)/2),p=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|h<<8|p}function Wa(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const $f=10;class TP{constructor(){Ht(this,"id",yo)}update(t,n){var u;const{entity:o,updateContext:s}=n;if(o.activeAction!=="moving")return{nextState:Xn,data:{...t,enteredAt:s.gameState.time,previousState:yo}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[o.target])==null?void 0:u.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*$f*2,y:o.position.y+o.direction.y*$f*2}),!a)return{nextState:Xn,data:{...t,enteredAt:s.gameState.time,previousState:yo}};const c=Le(o.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return o.direction=mt(c),o.acceleration=SP(o),X(o.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<$f?{nextState:Xn,data:{...t,enteredAt:s.gameState.time,previousState:yo}}:{nextState:yo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const AP=new TP,EP={id:Sa,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:yo,data:{...e,enteredAt:o.gameState.time,previousState:Sa,target:n.target}}:n.activeAction!=="grazing"?{nextState:Xn,data:{...e,enteredAt:o.gameState.time,previousState:Sa}}:{nextState:Sa,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},wP={id:Ia,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:yo,data:{...e,enteredAt:o.gameState.time,previousState:Ia,target:n.target}}:n.activeAction!=="procreating"?{nextState:Xn,data:{...e,enteredAt:o.gameState.time,previousState:Ia}}:{nextState:Ia,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},_P=[oP,AP,EP,wP],tn="predatorIdle",go="predatorMoving",bi="predatorAttacking",Yr="predatorProcreating",or="predatorEating",CP={id:tn,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="eating"?{nextState:or,data:{...e,enteredAt:o.gameState.time,previousState:tn,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:bi,data:{...e,enteredAt:o.gameState.time,previousState:tn,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:n.activeAction==="moving"?{nextState:go,data:{...e,enteredAt:o.gameState.time,previousState:tn,target:n.target}}:n.activeAction==="procreating"?{nextState:Yr,data:{...e,enteredAt:o.gameState.time,previousState:tn}}:{nextState:tn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function QS(e){let t=fP;return e.hunger>=mP&&(t*=yP),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function PP(e,t){const n=e>>16&255,o=e>>8&255,s=e&255,a=t>>16&255,c=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),h=Math.floor((o+c)/2),p=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|h<<8|p}function Ya(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const Wf=12;class RP{constructor(){Ht(this,"id",go)}update(t,n){var u;const{entity:o,updateContext:s}=n;if(o.activeAction==="eating")return{nextState:or,data:{...t,enteredAt:s.gameState.time,previousState:go,preyId:o.attackTargetId,eatingStartTime:s.gameState.time}};if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:bi,data:{...t,enteredAt:s.gameState.time,previousState:go,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:tn,data:{...t,enteredAt:s.gameState.time,previousState:go}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[o.target])==null?void 0:u.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*Wf*2,y:o.position.y+o.direction.y*Wf*2}),!a)return{nextState:tn,data:{...t,enteredAt:s.gameState.time,previousState:go}};const c=Le(o.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return o.direction=mt(c),o.acceleration=QS(o),X(o.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Wf?{nextState:tn,data:{...t,enteredAt:s.gameState.time,previousState:go}}:{nextState:go,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const MP=new RP,kP={id:bi,update:(e,t)=>{const{entity:n,updateContext:o}=t;if(n.activeAction==="eating")return{nextState:or,data:{...e,enteredAt:o.gameState.time,previousState:bi,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:tn,data:{...e,enteredAt:o.gameState.time,previousState:bi}};const s=o.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:tn,data:{...e,enteredAt:o.gameState.time,previousState:bi}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:tn,data:{...e,enteredAt:o.gameState.time,previousState:bi}};const c=X(n.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height),d=Le(n.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height);return n.direction=mt(d),c>pr?n.acceleration=QS(n):n.acceleration=0,{nextState:bi,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},DP={id:Yr,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="eating"?{nextState:or,data:{...e,enteredAt:o.gameState.time,previousState:Yr,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:bi,data:{...e,enteredAt:o.gameState.time,previousState:Yr,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:n.activeAction!=="procreating"?{nextState:tn,data:{...e,enteredAt:o.gameState.time,previousState:Yr}}:{nextState:Yr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},bP={id:or,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction!=="eating"?{nextState:tn,data:{...e,enteredAt:o.gameState.time,previousState:or}}:{nextState:or,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},OP=[CP,MP,kP,DP,bP],NP=24*30*10,Ro=24*5,BP=48,HP=72,Ja=20,FP="#3b2016",LP="#5c3a21",UP="#376d31",GP="#76a331",xP="#a6c44a",$P="rgba(0, 0, 0, 0.25)",WP=60,YP=24*7,Gi=.01,Ta=.5,gy=1,wu=5,zP={id:Vn,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.age>=n.lifespan?{nextState:ur,data:{enteredAt:o.gameState.time,previousState:Vn}}:n.age>=Ro?{nextState:Hn,data:{enteredAt:o.gameState.time,previousState:Vn}}:{nextState:Vn,data:e}}},jP={id:Hn,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Dt/Lt);return n.age>=n.lifespan?{nextState:ur,data:{...e,enteredAt:o.gameState.time,previousState:Hn}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=YP&&(n.timeSinceLastSpreadAttempt=0,Math.random()<o.gameState.ecosystem.treeSpreadChance)?{nextState:gi,data:{...e,enteredAt:o.gameState.time,previousState:Hn}}:{nextState:Hn,data:e})}},XP={id:gi,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(n.age>=n.lifespan)return{nextState:ur,data:{...e,enteredAt:s.time,previousState:gi}};const a=Vv(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return $i(a,s,25)||ja(s.entities,a,s.time),{nextState:Hn,data:{...e,enteredAt:s.time,previousState:gi}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},VP={id:Gt,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=BP?{nextState:mi,data:{enteredAt:n.gameState.time,previousState:Gt}}:{nextState:Gt,data:e}}},qP={id:mi,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=HP?{nextState:ur,data:{enteredAt:n.gameState.time,previousState:mi}}:{nextState:mi,data:e}}},ZP={id:ur,update:e=>({nextState:ur,data:e}),onEnter:(e,t)=>(mr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},KP=[zP,jP,XP,VP,qP,ZP],my=[...UC,...iP,..._P,...OP,...KP];function QP(e,t,n){const o=fw(e,my);if(!o)return pw(e),[e,t];const{nextState:s,data:a}=o.update(t,n);return hw(e,s)?[s,dw(o,s,a,n,my)]:[s,a]}function ap(e,t){return`${e},${t}`}const yy=Dt*10;function JS(e){return e%yy/yy}function eI(e){const t=JS(e);return(Math.cos(t*2*Math.PI)+1)/2}function JP(e){const t=JS(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function tI(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(o/Oi),gridY:Math.floor(s/Oi)}}function za(e,t,n,o,s){const{gridX:a,gridY:c}=tI(t,o,s),d=ap(a,c),u=e.sectors[d],h=u?u.currentTemperature:tS,y=(eI(n)*2-1)*U1;return h+y}function eR(e){const{sectors:t}=e.temperature,{width:n,height:o}=e.mapDimensions,s=Math.ceil(n/Oi),a=Math.ceil(o/Oi);for(const d in t){const u=t[d];u.currentTemperature=u.baseTemperature}const c=Math.ceil(wa/Oi);Object.values(e.entities.entities).forEach(d=>{if(d.type==="building"){const u=d;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const h=tI(u.position,n,o);for(let p=-c;p<=c;p++)for(let y=-c;y<=c;y++){const S=(h.gridX+y+s)%s,v=(h.gridY+p+a)%a,A=ap(S,v),I=t[A];if(I){const E={x:(S+.5)*Oi,y:(v+.5)*Oi},_=X(u.position,E,n,o);if(_<wa){const w=N1*(1-_/wa);I.currentTemperature+=w}}}}}})}function nI(e,t){const n={},o=Math.ceil(e/Oi),s=Math.ceil(t/Oi);for(let a=0;a<s;a++)for(let c=0;c<o;c++){const d=ap(c,a);let u=tS;const h=a/s*10-5;u+=h,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),n[d]={baseTemperature:u,currentTemperature:u}}return{sectors:n}}function tR(e,t,n){var d;const{gameState:o}=t,s=n*(Dt/Lt);e.isAdult=e.age>=Fh;const a=za(o.temperature,e.position,o.time,o.mapDimensions.width,o.mapDimensions.height);if(a<Jo){const u=(Jo-a)*O1*s;e.hitpoints-=u}if(e.movementSlowdown&&o.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<Xt){const u=1-e.hunger/Xt*Kw,h=Zw*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+h)}if(e.hunger+=n*(ia/(Dt/Lt)),e.hunger>=Xt)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-wo);else{const u=Qw*s;e.hitpoints-=u}if(e.age+=n/du,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((ia*$w-ia)/(Dt/Lt)),(!e.lastPregnantEffectTime||o.time-e.lastPregnantEffectTime>Ua*3)&&(Oe(o,Se.Pregnant,e.position,Ua,e.id),e.lastPregnantEffectTime=o.time),e.gestationTime<=0&&(dk(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===gs&&(e.radius=gt):e.hunger+=n*((ia*Ww-ia)/(Dt/Lt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const h=o.entities.entities[e.motherId];h&&u.push(h)}if(e.fatherId){const h=o.entities.entities[e.fatherId];h&&u.push(h)}for(const h of u)if(h.age>=Lh&&h.hunger>=zw&&X(e.position,h.position,o.mapDimensions.width,o.mapDimensions.height)<=jw){e.food.pop(),h.hunger=Math.max(0,h.hunger-wo),e.feedParentCooldownTime=Xw;break}}let c;if(e.hitpoints<=0?a<Jo?c="hypothermia":e.hunger>=Xt?c="hunger":c="killed":e.age>=e.maxAge&&(c="oldAge"),c){if(e.leaderId===e.id){const u=ls(Wi(o,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeControl=e.tribeControl??{diplomacy:{}};const h=o;jc(o,e.id,u.id);const p=h.search.human.byProperty("leaderId",e.id);for(const v of p)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const y=h.search.building.byProperty("ownerId",e.id);for(const v of y)v.ownerId=u.id;for(const v of Zc(u,o))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const S=yu(o).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of S){const A=o.entities.entities[v.leaderId];if((d=A==null?void 0:A.tribeControl)!=null&&d.diplomacy){const I=A.tribeControl.diplomacy[e.id];I!==void 0&&(A.tribeControl.diplomacy[u.id]=I,delete A.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=ls(Wi(o,e));u?(u.isPlayer=!0,o.generationCount++):(o.gameOver=!0,o.causeOfGameOver=c,La(o,{identifier:"no_heir",type:ar.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}lk(o.entities,e.position,e.gender,e.age,e.radius,e.id,o.time,e.food,e.hunger),mr(o.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function nR(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/Vw);const o=Math.floor(Xv*(1-e.decayProgress));e.food.length>o&&e.food.splice(o),e.decayProgress>=1&&e.food.length<=0&&mr(t.gameState.entities,e.id)}function iR(e,t,n){const o=n*(Dt/Lt);e.age+=n/du,e.isAdult=e.age>=xS;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=Tu){const c=KS*o;e.hitpoints-=c}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const c={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};c.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,c.x)),c.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,c.y));const d=Math.random()<.5?"male":"female",u=e,h=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let p;if(h)p=IP(u.geneCode,h.geneCode);else{p=u.geneCode;const y=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+y))}ds(t.gameState.entities,c,d,0,GS*.5,p,e.id,e.fatherId,e.aiType),Oe(t.gameState,Se.Procreation,e.position,Ua,e.id),Ce(t,Ie.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=o,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=US&&(a=!0),a&&(ck(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),mr(t.gameState.entities,e.id))}function oR(e,t,n){const o=n*(Dt/Lt);e.age+=n/du,e.isAdult=e.age>=XS;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=Au){const c=KS*o;e.hitpoints-=c}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const c={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};c.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,c.x)),c.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,c.y));const d=Math.random()<.5?"male":"female",u=e,h=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let p;if(h)p=PP(u.geneCode,h.geneCode);else{p=u.geneCode;const y=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+y))}fs(t.gameState.entities,c,d,0,WS*.6,p,e.id,e.pregnancyFatherId,e.aiType),Oe(t.gameState,Se.Procreation,e.position,Ua,e.id),Ce(t,Ie.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=o,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=o,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=$S&&(a=!0),a&&(uk(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),mr(t.gameState.entities,e.id))}var Mo=(e=>(e[e.TaskBased=0]="TaskBased",e))(Mo||{}),$=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e[e.HumanDiplomacy=25]="HumanDiplomacy",e[e.HumanPlacePalisade=26]="HumanPlacePalisade",e[e.HumanPlaceGate=27]="HumanPlaceGate",e[e.HumanAttackBuilding=28]="HumanAttackBuilding",e[e.AnimalFlee=29]="AnimalFlee",e[e.AnimalGraze=30]="AnimalGraze",e[e.AnimalHunt=31]="AnimalHunt",e[e.AnimalAttack=32]="AnimalAttack",e[e.AnimalProcreate=33]="AnimalProcreate",e[e.AnimalWander=34]="AnimalWander",e[e.AnimalFeedChild=35]="AnimalFeedChild",e[e.AnimalSeekFoodFromParent=36]="AnimalSeekFoodFromParent",e[e.AnimalHerd=37]="AnimalHerd",e[e.AnimalTerritorial=38]="AnimalTerritorial",e[e.AnimalPack=39]="AnimalPack",e))($||{}),N=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(N||{});const _t=3,rR=250,iI=.8,sR=100,aR=5,mh="currentAiTask",oI="lastTaskResult",rI="lastTaskMessage",yh="taskHistory";function eu({aiBlackboard:e}){return De.get(e,mh)||null}function xi({aiBlackboard:e},t){t?De.set(e,mh,t):De.delete(e,mh)}function lR(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function cR(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function sI(e,t,n,o){const s=t.type===$.Wait?uR:o[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=N.Failure;const[c,d,u]=cR(a);if(De.set(e.aiBlackboard,oI,c),De.set(e.aiBlackboard,rI,d),c!==N.Running){const h=De.get(e.aiBlackboard,yh)||[];if(h.unshift({type:t.type,result:c,completedAtTick:n.gameState.time,message:d}),h.length>5&&h.pop(),De.set(e.aiBlackboard,yh,h),delete n.gameState.tasks[t.id],xi(e,null),c===N.Success){const p=u||t.nextTask;p&&(n.gameState.tasks[p.id]=p,p.claimedByEntityId=e.id,xi(e,p.id))}}return c}function Qe(e){return 1/(1+e/rR)}function el(e,t,n){for(let o=0;o<n.length;o++){const s=n[o];if(!s.producer)continue;const a=s.producer(e,t);for(const c in a){const d=a[c],u=t.gameState.tasks[c];t.gameState.tasks[c]=d,u&&(t.gameState.tasks[c].claimedByEntityId=u.claimedByEntityId)}}}const Tc=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:$.Wait,creatorEntityId:e.id,validUntilTime:t+_t}),uR={type:$.Wait,executor:(e,t,n)=>n.gameState.time>=e.validUntilTime-1?[N.Success,"Wait complete"]:[N.Running,"Waiting"]};function Je(e){const{type:t,requireAdult:n,autopilotBehavior:o,producer:s,scorer:a,executor:c}=e;return{type:t,producer:s,scorer:a?(h,p,y)=>n&&!h.isAdult||o&&h.isPlayer&&!y.gameState.autopilotControls.behaviors[o]?null:a(h,p,y):void 0,executor:c?(h,p,y)=>n&&!p.isAdult||o&&p.isPlayer&&!y.gameState.autopilotControls.behaviors[o]?N.Failure:y.gameState.autopilotControls.activeAutopilotAction&&h.type!==$.HumanPlayerCommand&&p.isPlayer?[N.Failure,"Autopilot action active",{id:`player-command-${p.id}`,type:$.HumanPlayerCommand,position:p.position,creatorEntityId:p.id,validUntilTime:y.gameState.time+_t}]:c(h,p,y):void 0}}const dR=Je({type:$.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>uh&&e.food.length>0){const o=`eat-task-${e.id}`;n[o]={id:o,type:$.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/Xt,executor:(e,t)=>e.target!==t.id?N.Empty:t.hunger<uh?N.Success:t.food.length===0?N.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",N.Running)}),fR=Je({type:$.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="berryBush"||o.food.length===0||e.leaderId&&!hr(o.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qe(s),c=e.hunger/Xt;return(a+c)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];return!o||o.type!=="berryBush"||o.food.length===0||t.food.length>=t.maxFood?[N.Success,"Bush is empty"]:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ve?(t.target=o.position,t.activeAction="moving",[N.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[N.Running,"Gathering berries"])}}),hR=Je({type:$.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="corpse"||o.food.length===0||e.leaderId&&!hr(o.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qe(s),c=e.hunger/Xt;return(a+c)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.type!=="corpse"||o.food.length===0||t.food.length>=t.maxFood?N.Success:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ve?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",N.Running)}}),pR=Je({type:$.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=Yc&&e.age<=Hh&&e.hunger<Bn&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:$.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<Yc||e.hunger>=Bn||(e.procreationCooldown||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="female"||o.isPregnant||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(s)*iI},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="female"||t.hunger>=Bn?N.Failure:o.isPregnant?N.Success:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ve?(t.target=o.position,t.activeAction="moving",t.direction=Mt(t.position,o.position,n.gameState.mapDimensions),N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",N.Running)}}),gR=Je({type:$.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=Yc&&e.hunger<Bn&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:$.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<Yc||e.age>Hh||e.hunger>=Bn||(e.procreationCooldown||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="male"||o.hunger>=Bn||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(s)*iI},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="male"||o.hunger>=Bn?N.Failure:t.isPregnant?N.Success:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ve?(t.target=o.position,t.activeAction="moving",t.direction=Mt(t.position,o.position,n.gameState.mapDimensions),N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",N.Running)}}),mR=Je({type:$.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=L0){const o=`feed-child-task-${e.id}`;n[o]={id:o,type:$.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.isAdult||!(o.motherId===e.id||o.fatherId===e.id))return null;const a=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=Qe(a),d=o.hunger/Xt;return(c+d)/2},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.isAdult||t.food.length===0?N.Failure:o.hunger<L0/2?N.Success:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>jv?(t.target=o.position,t.activeAction="moving",t.direction=Mt(t.position,o.position,n.gameState.mapDimensions),N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="feeding",N.Running)}});function tl(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const o=X(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(o)}function yR(e,t,n){if(e.leaderId!==t.creatorEntityId||!e.leaderId)return null;const o=t.target;if(!o)return null;const{width:s,height:a}=n.gameState.mapDimensions,c=X(e.position,o,s,a),d=Qe(c)*.5,u=Kn(e.leaderId,n.gameState),h=X(u,o,s,a),p=Math.max(0,1-h/800)*.25,y=Math.ceil(s/Ae),S=Math.ceil(a/Ae),v=C1(o);let A=0;for(let E=-1;E<=1;E++)for(let _=-1;_<=1;_++){if(_===0&&E===0)continue;const w=((v.x+_)%y+y)%y,P=((v.y+E)%S+S)%S;n.gameState.terrainOwnership[P*y+w]===e.leaderId&&A++}const I=A/8*.25;return d+p+I}function ys(e,t,n,o,s){const a=e.target;return X(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",N.Running):(Xh(a,o,t.leaderId,n.gameState),N.Success)}const vR=Je({type:$.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:tl,executor:(e,t,n)=>ys(e,t,n,Z.StorageSpot,Ka)}),SR=Je({type:$.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:tl,executor:(e,t,n)=>ys(e,t,n,Z.Bonfire,Ka)}),IR=Je({type:$.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:tl,executor:(e,t,n)=>ys(e,t,n,Z.PlantingZone,Ka)}),TR=Je({type:$.HumanPlaceBorderPost,scorer:yR,requireAdult:!0,autopilotBehavior:"build",executor:(e,t,n)=>ys(e,t,n,Z.BorderPost,T1)}),AR=Je({type:$.HumanPlacePalisade,requireAdult:!0,autopilotBehavior:"build",scorer:tl,executor:(e,t,n)=>ys(e,t,n,Z.Palisade,Ka)}),ER=Je({type:$.HumanPlaceGate,requireAdult:!0,autopilotBehavior:"build",scorer:tl,executor:(e,t,n)=>ys(e,t,n,Z.Gate,Ka)}),wR=Je({type:$.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(u=>u.type===ti.Berry).length<sr)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const c=t.target,d=X(e.position,c,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(d)},executor:(e,t,n)=>{if(t.food.filter(d=>d.type===ti.Berry).length<sr)return t.activeAction="idle",N.Failure;const s=e.target;return X(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Wv?(t.target=s,t.activeAction="moving",N.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(d=>d.type==="berryBush"&&X(d.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<aR)?(t.activeAction="idle",N.Success):N.Running)}}),_R=Je({type:$.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var h;if(typeof t.target!="number")return null;const o=e.food.length>0,s=((h=e.heldItem)==null?void 0:h.type)===Ot.Wood;if(!o&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==Z.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const c=X(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=Qe(c),u=s?.6:e.food.length/e.maxFood*.4;return(d+u)/2},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==Z.StorageSpot)return N.Failure;const s=t.food.length>0,a=((d=t.heldItem)==null?void 0:d.type)===Ot.Wood;return!s&&!a?N.Success:o.storedItems.length>=o.storageCapacity?N.Failure:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ve?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",N.Running)}}),CR=Je({type:$.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var d;if(typeof t.target!="number"||!(((d=e.heldItem)==null?void 0:d.type)===Ot.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==Z.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||hh;if(s.storedItems.length>=a)return null;const c=X(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(c)},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==Z.Bonfire)return N.Failure;if(!(((d=t.heldItem)==null?void 0:d.type)===Ot.Wood))return N.Success;const a=o.storageCapacity||hh;return o.storedItems.length>=a?N.Failure:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ve?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",N.Running)}}),PR=Je({type:$.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=uh||e.food.length>0||typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="building"||o.buildingType!==Z.StorageSpot||o.ownerId!==e.leaderId||!o.storedItems.some(u=>u.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qe(s),c=e.hunger/Xt,d=1-e.food.length/e.maxFood;return(a+c+d)/3},executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.type!=="building"||o.buildingType!==Z.StorageSpot||!o.storedItems.some(a=>a.item.itemType==="food")?N.Failure:t.food.length>0?N.Success:t.food.length>=t.maxFood?N.Failure:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ve?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="retrieving",N.Running)}}),RR=2;function lp(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}const MR=Je({type:$.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="tree")return null;const[s]=o.stateMachine??[];if(!(s===Vn||s===Hn||s===gi)||e.leaderId&&!hr(o.position,e.leaderId,n.gameState)||e.heldItem||e.food.length===0)return null;const c=lp(e,n.gameState);if(!c)return null;const d=TS(c.id,n.gameState);if(d<=0)return null;const u=Z_(c.id,n.gameState);if(u>=d)return null;const h=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),p=Qe(h),y=Math.min(1,(d-u)/10);return(p+y)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="tree")return[N.Failure,"Tree not found"];const[s]=o.stateMachine??[];if(s===Gt){const d={id:`gather-wood-${t.id}-${n.gameState.time}`,type:$.HumanGatherWood,position:o.position,creatorEntityId:t.id,target:o.id,validUntilTime:n.gameState.time+1};return[N.Success,"Tree fell!",d]}return s===Vn||s===Hn||s===gi?t.heldItem?[N.Failure,"Hands full"]:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Yv?(t.target=o.position,t.activeAction="moving",[N.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="chopping",[N.Running,"Chopping tree"]):[N.Failure,"Tree is not standing"]}}),kR=Je({type:$.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="tree"||o.wood.length===0)return null;const[s]=o.stateMachine??[];if(s!==Gt||e.leaderId&&!hr(o.position,e.leaderId,n.gameState)||e.heldItem)return null;const a=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=Qe(a),d=lp(e,n.gameState),u=d?TS(d.id,n.gameState):0,h=Math.min(1,u/10);return(c+h)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[N.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[N.Success,"Already holding wood"];const o=n.gameState.entities.entities[e.target];return!o||o.type!=="tree"||o.wood.length===0||t.heldItem?[N.Failure,"Tree gone, empty, or human full"]:X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ve?(t.target=o.position,t.activeAction="moving",[N.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[N.Running,"Gathering wood"])}}),DR=Je({type:$.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="prey"||o.hitpoints<=0||e.leaderId&&!hr(o.position,e.leaderId,n.gameState))return null;const s=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const d=Kn(e.leaderId,n.gameState);if(X(e.position,d,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>d1)return null}const a=Qe(s),c=e.hunger/Xt;return(a+c)/2*.6},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[N.Success,"Prey is dead"];const s=X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Ve?[N.Running,"Chasing prey"]:[N.Running,"Attacking prey"]}}),bR=Je({type:$.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="predator"||o.hitpoints<=0||e.leaderId&&!hr(o.position,e.leaderId,n.gameState))return null;const s=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(Qe(s)+.3)/1.3},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[N.Failure,"Too injured to continue"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[N.Success,"Predator eliminated"];const s=X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Ve?[N.Running,"Chasing predator"]:[N.Running,"Fighting predator"]}});function OR(e,t,n,o){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,N.Failure;const a=X(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?dn:_o;return a<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,N.Success):(t.activeAction="moving",t.target=s.id,t.direction=Mt(t.position,s.position,e.mapDimensions),N.Running)}const NR=Je({type:$.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const o=`player-command-${e.id}`;n[o]={id:o,type:$.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+_t}}return n},scorer:(e,t)=>t.type===$.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a;const{gameState:o}=n,s=o.autopilotControls.activeAutopilotAction;if(!s)return[N.Failure,"No active autopilot action"];switch(s.action){case de.AutopilotMove:{if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,N.Failure;const c=s.position;return X(t.position,c,o.mapDimensions.width,o.mapDimensions.height)<p1?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[N.Success,"Reached target position"]):(t.activeAction="moving",t.target=c,t.direction=Mt(t.position,c,o.mapDimensions),[N.Running,"Moving to target"])}case de.AutopilotGather:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Target entity not found"];let d=!1;if(c.type==="berryBush")d=c.food.length===0;else if(c.type==="corpse")d=c.food.length===0;else if(c.type==="tree"){const h=c;d=h.stateMachine[0]!==Gt||h.wood.length===0}else return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target type"];return d?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Target is depleted"]):X(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)>Wv?(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[N.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"At target, gathering",Tc(t,o.time)])}case de.AutopilotChop:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.type!=="tree")return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target entity"];const[d]=c.stateMachine??[];return!(d===Vn||d===Hn||d===gi)||t.heldItem?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Tree is not standing or human is holding an item"]):X(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)>Yv?(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[N.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"At tree, chopping",Tc(t,o.time)])}case de.AutopilotAttack:return"targetEntityId"in s?OR(o,t,s):(o.autopilotControls.activeAutopilotAction=void 0,N.Failure);case de.AutopilotProcreate:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.type!=="human"||!ps(t,c,o))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target for procreation"];const d=X(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height);return c.isPregnant||t.isPregnant?t.gender==="male"&&c.pregnancyFatherId!==t.id?[N.Failure,"Target is pregnant by another"]:[N.Success,"Procreation conditions met"]:d<=Mf?(t.activeAction="procreating",o.autopilotControls.activeAutopilotAction=void 0,[N.Running,"Procreating"]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[N.Running,"Moving to procreation target"])}case de.AutopilotPlant:{if(t.activeAction==="planting")return[N.Running,"Planting"];if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No position specified"];const c=s.position;return $i(c,o,uu,t.id)?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Position is occupied"]):X(t.position,c,o.mapDimensions.width,o.mapDimensions.height)<=Mf?(t.activeAction="planting",t.target=c,o.autopilotControls.activeAutopilotAction=void 0,o.hasPlayerPlantedBush=!0,[N.Running,"Planting"]):(t.activeAction="moving",t.target=c,t.direction=Mt(t.position,c,o.mapDimensions),[N.Running,"Moving to planting target"])}case de.AutopilotFeedChild:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="human"||c.isAdult||t.food.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target for feeding child"]):X(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Mf?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[N.Success,"Feeding child"]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[N.Running,"Moving to feeding target"])}case de.AutopilotDeposit:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.buildingType!==Z.StorageSpot&&c.buildingType!==Z.Bonfire||!c.isConstructed)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"];const d=c.storageCapacity??0;if(c.storedItems.length>=d)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Storage is full"];if(t.leaderId!==c.ownerId)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Human does not belong to the same tribe as the building"];const h=t.food.length>0,p=!!t.heldItem;if(c.buildingType===Z.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==Ot.Wood)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Bonfires only accept wood"]}else if(!h&&!p)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No items to deposit"];return X(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Jn?(t.activeAction="depositing",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Depositing items",Tc(t,o.time)]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[N.Running,"Moving to deposit target"])}case de.AutopilotRetrieve:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.buildingType!==Z.StorageSpot||!c.isConstructed||c.storedItems.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"]):t.leaderId!==c.ownerId?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Storage is full"]):X(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Jn?(t.activeAction="retrieving",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Retrieving items",Tc(t,o.time)]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[N.Running,"Moving to retrieve target"])}case de.TakeOverBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!cr(t,c,o)?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Only leaders can take over buildings"]):X(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Ve?(t.activeAction="takingOverBuilding",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Taking over building"]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[N.Running,"Moving to takeover target"])}case de.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!cr(t,c,o)?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Only leaders can remove enemy buildings"]):X(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Ve?(t.activeAction="destroyingBuilding",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[N.Running,"Moving to removal target"])}case de.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return o.autopilotControls.activeAutopilotAction=void 0,N.Failure;const c=s.position,d=s.buildingType;if(!d)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No building type specified"];const u=X(t.position,c,o.mapDimensions.width,o.mapDimensions.height),h=100;return u<=h?Ga(c,d,t.leaderId,o,t.position,h)?(Xh(c,d,t.leaderId,o),o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[N.Success,"Building placed"]):(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=c,t.direction=Mt(t.position,c,o.mapDimensions),[N.Running,"Moving to placement target"])}default:return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Unknown or unhandled action"]}}}),BR=Je({type:$.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:n}=t,o={},s=Qn(e.position.x,e.position.y,n),a=s!==null&&s!==e.leaderId&&Yi(e.leaderId,s,n),c=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(a||c){const d=`attack-human-${e.id}`;o[d]={id:d,type:$.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:n.time+_t}}return o},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="human"||o.hitpoints<=0||o.id===e.id||o.leaderId===e.leaderId)return null;const{gameState:s}=n,a=Za(e,o,s),c=Qn(o.position.x,o.position.y,s)===e.leaderId,d=o.activeAction==="attacking"&&o.attackTargetId!==void 0;if(!a&&!d)return null;let u=.5;const h=X(e.position,o.position,s.mapDimensions.width,s.mapDimensions.height),p=Qe(h);return c&&a&&(u+=.1),(p+u)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[N.Success,"Target eliminated"];const s=X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Ve?[N.Running,"Chasing human target"]:[N.Running,"Fighting human target"]}}),HR=Je({type:$.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,n)=>{if(typeof t.target!="number"||eI(n.gameState.time)>.5)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.buildingType!==Z.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0||e.leaderId!==o.ownerId)return null;const s=za(n.gameState.temperature,e.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Jo+5;if(s>=a)return null;const c=(a-s)/15,d=(1-e.hitpoints/e.maxHitpoints)*.8,u=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),h=Qe(u);let p=(c+d+h)/2;return e.hitpoints/e.maxHitpoints<.2&&s<Jo&&(p=Math.max(p,1.2)),p},executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.buildingType!==Z.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0)return N.Failure;const s=za(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Jo+5;if(s>=a)return t.activeAction="idle",[N.Success,"Comfortable temperature reached"];const c=t.id*137%360*(Math.PI/180),d=wa*.4,u=n.gameState.mapDimensions.width,h=n.gameState.mapDimensions.height,p={x:(o.position.x+Math.cos(c)*d+u)%u,y:(o.position.y+Math.sin(c)*d+h)%h},y=X(t.position,p,u,h);return y>10?(t.activeAction="moving",t.target=p,t.direction=Mt(t.position,p,n.gameState.mapDimensions),[N.Running,`Moving to warmth spot (${y.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[N.Running,"Staying warm at bonfire"])}}),FR=Je({type:$.HumanFlee,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hitpoints<e.maxHitpoints*W0){const o=k1(e.id,t.gameState);if(o){const s=`flee-task-${e.id}`;n[s]={id:s,type:$.HumanFlee,position:e.position,creatorEntityId:e.id,target:o.id,validUntilTime:t.gameState.time+_t}}}return n},scorer:(e,t,n)=>typeof t.target!="number"||!n.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*W0?.9:null,executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o)return t.activeAction="idle",t.attackTargetId=void 0,N.Success;if(X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Y0)return t.activeAction="idle",t.target=void 0,N.Success;t.activeAction="moving",t.attackTargetId=void 0;const a=Le(o.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=mt(a),d=pi(t.position,ut(c,Y0));return t.target={x:(d.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(d.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,N.Running}}),LR=Je({type:$.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,o={};if(!e.leaderId||e.id===e.leaderId)return o;const s=Kn(e.leaderId,n),a=`stay-near-tribe-${e.id}`;return o[a]={id:a,type:$.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:n.time+_t},o},scorer:(e,t,n)=>{if(!e.leaderId||e.id===e.leaderId)return null;const o=Kn(e.leaderId,n.gameState),s=X(e.position,o,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=z0)return null;const a=s-z0;return Math.min(.95,.5+a/1e3*A1)},executor:(e,t,n)=>{if(!t.leaderId)return N.Failure;const o=Kn(t.leaderId,n.gameState),s=X(t.position,o,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<w1?(t.activeAction="idle",t.target=void 0,N.Success):(t.activeAction="moving",t.target=o,t.direction=Mt(t.position,o,n.gameState.mapDimensions),[N.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),UR=Je({type:$.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,o={};if(e.isAdult)return o;const s=iy(e,n);if(!s)return o;const a=`stay-near-parent-${e.id}`;return o[a]={id:a,type:$.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:n.time+_t},o},scorer:(e,t,n)=>{if(e.isAdult)return null;const o=iy(e,n.gameState);if(!o||o.id!==t.target||e.leaderId&&zh(e.leaderId,n.gameState)&&Qn(o.position.x,o.position.y,n.gameState)!==e.leaderId)return null;const s=X(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=j0)return null;const a=s-j0;return Math.min(.98,.6+a/500*E1)},executor:(e,t,n)=>{if(typeof e.target!="number")return t.activeAction="idle",N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="human")return t.activeAction="idle",t.target=void 0,N.Failure;const s=X(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<=_1?(t.activeAction="idle",t.target=void 0,N.Success):(t.activeAction="moving",t.target=o.id,t.direction=Mt(t.position,o.position,n.gameState.mapDimensions),[N.Running,`Returning to parent (${Math.round(s)}px away)`])}}),GR=Je({type:$.HumanDiplomacy,requireAdult:!0,scorer:(e,t)=>e.id===e.leaderId&&t.creatorEntityId===e.id?1:null,executor:(e,t,n)=>{var d,u,h,p,y,S;const{gameState:o}=n,s=Co(t.id,o),a=sy(s),c=yu(o).filter(v=>v.leaderId!==t.id);for(const v of c){const A=Co(v.leaderId,o),I=sy(A),E=((u=(d=t.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[v.leaderId])||At.Friendly,_=o.entities.entities[v.leaderId];((p=(h=_==null?void 0:_.tribeControl)==null?void 0:h.diplomacy)==null?void 0:p[t.id])===At.Hostile||a>I*h1?E!==At.Hostile&&((y=t.tribeControl)!=null&&y.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=At.Hostile):E!==At.Friendly&&((S=t.tribeControl)!=null&&S.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=At.Friendly)}return t.aiBlackboard&&De.set(t.aiBlackboard,"lastDiplomacyCheckTime",o.time),N.Success}}),xR={type:$.HumanAttackBuilding,executor:(e,t,n)=>{const{gameState:o}=n,s=e.target;return o.entities.entities[s]?(t.activeAction="attacking",t.attackTargetId=s,N.Running):N.Success}},_u=[dR,fR,hR,pR,gR,mR,vR,SR,IR,TR,AR,ER,wR,_R,CR,PR,MR,kR,DR,bR,NR,BR,HR,FR,LR,UR,GR,xR].reduce((e,t)=>(e[t.type]=t,e),{}),$R=Object.values(_u);function WR(e,t){el(e,t,$R)}function YR(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const o=eu(e);if(o){const s=t.gameState.tasks[o];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),xi(e,null)}return}let n=eu(e);if(n){const o=t.gameState.tasks[n];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(xi(e,null),n=null)}if(!n){const o=zR(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];n=o,xi(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const o=t.gameState.tasks[n];o?sI(e,o,t,_u):xi(e,null)}}function zR(e,t){let n=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const c=_u[a.type];if(!c||!c.scorer)continue;const d=c.scorer(e,a,t);d!==null&&d>o&&(o=d,n=a.id)}return o>0?n:null}function jR(e,t){const n=performance.now();switch(e.aiType){case Mo.TaskBased:default:YR(e,t);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}const XR=(e,t)=>{const n={};for(let o=0;o<RR;o++){const s=`hunt-prey-${e.id}-${o}`;n[s]={id:s,type:$.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},VR=(e,t)=>{const n={};if(e.hitpoints<=0)return n;const o=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((o==null?void 0:o.type)==="human"))return n;for(let a=0;a<f1;a++){const c=`hunt-predator-${e.id}-${a}`;n[c]={id:c,type:$.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},tu=aP*1.5,qR=(e,t)=>{const n={},o=t.gameState,s=[...o.search.human.byRadius(e.position,tu),...o.search.predator.byRadius(e.position,tu)].filter(u=>{if(u.id===e.id)return!1;if(e.type==="prey")return u.type==="human"||u.type==="predator";if(e.type==="predator"){if(u.type==="human")return!0;if(u.type==="predator")return u.geneCode!==e.geneCode}return!1});if(s.length===0)return n;let a=s[0],c=Fn(e.position,a.position);for(let u=1;u<s.length;u++){const h=Fn(e.position,s[u].position);h<c&&(c=h,a=s[u])}const d=`animal-flee-${e.id}-${a.id}`;return n[d]={id:d,type:$.AnimalFlee,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1},n},ZR=(e,t,n)=>{const o=n.gameState.entities.entities[t.target];if(!o)return null;const s=Fn(e.position,o.position);return s>tu?null:Qe(s)*.95},KR=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];if(!o)return N.Failure;if(Fn(t.position,o.position)>tu*1.2)return N.Success;const a=mt(wh(t.position,o.position)),c=pi(t.position,ut(a,100));return t.activeAction="moving",t.target=c,N.Running},QR={type:$.AnimalFlee,producer:qR,scorer:ZR,executor:KR},aI=600,JR=(e,t)=>{if(e.type!=="prey")return{};const n={},s=t.gameState.search.berryBush.byRadius(e.position,aI).filter(a=>a.food.length>0);for(const a of s){const c=`animal-graze-${e.id}-${a.id}`;n[c]={id:c,type:$.AnimalGraze,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},eM=(e,t,n)=>{if(e.type!=="prey")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.food.length===0)return null;const s=Fn(e.position,o.position);if(s>aI)return null;const a=Qe(s),c=Math.max(0,e.hunger/Tu);return e.hunger<20&&s>100?null:a*c*.65},tM=(e,t,n)=>{if(t.type!=="prey")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.food.length===0||(t.activeAction="grazing",t.target=o.id,t.hunger<5)?N.Success:N.Running},nM={type:$.AnimalGraze,producer:JR,scorer:eM,executor:tM},lI=800,iM=(e,t)=>{if(e.type!=="predator")return{};const n={},s=t.gameState.search.prey.byRadius(e.position,lI).filter(a=>a.type==="prey");for(const a of s){const c=`animal-hunt-${e.id}-${a.id}`;n[c]={id:c,type:$.AnimalHunt,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},oM=(e,t,n)=>{if(e.type!=="predator")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.hitpoints<=0)return null;const s=Fn(e.position,o.position);if(s>lI)return null;const a=Qe(s),c=Math.max(0,e.hunger/Au);return e.hunger<30&&s>200?null:a*c*.8},rM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.hitpoints<=0||(t.activeAction="attacking",t.target=o.id,t.hunger<10)?N.Success:N.Running},sM={type:$.AnimalHunt,producer:iM,scorer:oM,executor:rM},cI=500,aM=(e,t)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,cI).filter(a=>{if(a.id===e.id||a.type!==e.type)return!1;const c=a;return c.isAdult&&c.gender!==e.gender&&(!c.procreationCooldown||c.procreationCooldown<=0)&&!c.isPregnant});for(const a of s){const c=`animal-procreate-${e.id}-${a.id}`;n[c]={id:c,type:$.AnimalProcreate,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},lM=(e,t,n)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return null;const o=n.gameState.entities.entities[t.target];if(!o||!o.isAdult||o.gender===e.gender||o.procreationCooldown&&o.procreationCooldown>0||o.isPregnant)return null;const s=Fn(e.position,o.position);return s>cI?null:Qe(s)*.6},cM=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||o.isPregnant||o.procreationCooldown&&o.procreationCooldown>0?N.Failure:(t.activeAction="procreating",t.target=o.id,t.isPregnant||t.procreationCooldown&&t.procreationCooldown>0?N.Success:N.Running)},uM={type:$.AnimalProcreate,producer:aM,scorer:lM,executor:cM},dM=200,fM=(e,t)=>{const n=`animal-wander-${e.id}`,o=Math.random()*Math.PI*2,s=Math.random()*dM,a={x:e.position.x+Math.cos(o)*s,y:e.position.y+Math.sin(o)*s};a.x=Math.max(0,Math.min(t.gameState.mapDimensions.width,a.x)),a.y=Math.max(0,Math.min(t.gameState.mapDimensions.height,a.y));const c={};return c[n]={id:n,type:$.AnimalWander,position:a,creatorEntityId:e.id,validUntilTime:t.gameState.time+5},c},hM=()=>.1,pM=(e,t)=>Fn(t.position,e.position)<10?(t.activeAction="idle",N.Success):(t.activeAction="moving",t.target=e.position,N.Running),gM={type:$.AnimalWander,producer:fM,scorer:hM,executor:pM},mM=(e,t)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,600).filter(a=>{if(a.type!==e.type)return!1;const c=a;return c.motherId===e.id&&c.hunger>=Eu});for(const a of s){const c=`animal-feed-child-${e.id}-${a.id}`;n[c]={id:c,type:$.AnimalFeedChild,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},yM=(e,t,n)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.motherId!==e.id)return null;const s=Fn(e.position,o.position),a=Qe(s),c=e.type==="prey"?Tu:Au,d=Math.max(0,o.hunger/c);return a*d*.9},vM=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||o.hunger<Eu/2?N.Success:Fn(t.position,o.position)<30?(t.activeAction="feeding",N.Running):(t.activeAction="moving",t.target=o.id,N.Running)},SM={type:$.AnimalFeedChild,producer:mM,scorer:yM,executor:vM},IM=(e,t)=>{if(e.isAdult||e.hunger<Eu||!e.motherId)return{};const n=t.gameState.entities.entities[e.motherId];if(!n)return{};const o={},s=`animal-seek-food-${e.id}-${n.id}`;return o[s]={id:s,type:$.AnimalSeekFoodFromParent,position:n.position,creatorEntityId:e.id,target:n.id,validUntilTime:t.gameState.time+1},o},TM=(e,t,n)=>{if(e.isAdult||!e.motherId)return null;const o=n.gameState.entities.entities[e.motherId];if(!o)return null;const s=Fn(e.position,o.position),a=Qe(s),c=e.type==="prey"?Tu:Au,d=Math.max(0,e.hunger/c);return a*d*.85},AM=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||t.hunger<Eu/2?N.Success:(Fn(t.position,o.position)<30||(t.activeAction="moving",t.target=o.id),N.Running)},EM={type:$.AnimalSeekFoodFromParent,producer:IM,scorer:TM,executor:AM},wM=(e,t)=>{if(e.type!=="prey")return{};if(e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return{};const n={},o=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,c=o.search.prey.byRadius(e.position,cs*5),d=[];for(const u of c)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&d.push(u);if(d.length>=2){let u=0,h=0;for(const S of d)u+=S.position.x,h+=S.position.y;u/=d.length,h/=d.length;const p={x:u,y:h};if(X(e.position,p,s,a)>cs*2){const S=`animal-herd-${e.id}`;n[S]={id:S,type:$.AnimalHerd,position:p,creatorEntityId:e.id,target:p,validUntilTime:t.gameState.time+1}}}return n},_M=(e,t,n)=>{if(e.type!=="prey"||e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return null;const o=t.target,{width:s,height:a}=n.gameState.mapDimensions,c=X(e.position,o,s,a);return c<=cs*2?null:Qe(c)*.4},CM=(e,t,n)=>{if(t.type!=="prey")return N.Failure;const o=e.target,{width:s,height:a}=n.gameState.mapDimensions;if(X(t.position,o,s,a)<=cs*2)return t.activeAction="idle",t.direction={x:0,y:0},N.Success;t.activeAction="moving",t.target=o;const d=Le(t.position,o,s,a);return t.direction=mt(d),N.Running},PM={type:$.AnimalHerd,producer:wM,scorer:_M,executor:CM},RM=(e,t)=>{if(e.type!=="predator")return{};const n=e.hunger>100,o=e.hitpoints<e.maxHitpoints*.5;if(!n&&!o)return{};if(e.attackCooldown&&e.attackCooldown>0)return{};const s={},c=t.gameState.search.human.byRadius(e.position,pr*2);let d=null,u=1/0;for(const h of c)if(h.hitpoints>0){const p=X(e.position,h.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);p<u&&(u=p,d=h)}if(d){const h=`animal-attack-human-${e.id}-${d.id}`;s[h]={id:h,type:$.AnimalAttack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return s},MM=(e,t,n)=>{if(e.type!=="predator")return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const a=X(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>pr*2.5?null:Qe(a)*.75},kM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return N.Success;const{width:a,height:c}=n.gameState.mapDimensions;if(X(t.position,s.position,a,c)<=pr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},N.Running;{t.activeAction="moving",t.target=s.id;const u=Le(t.position,s.position,a,c);return t.direction=mt(u),N.Running}},DM={type:$.AnimalAttack,producer:RM,scorer:MM,executor:kM},bM=(e,t)=>{if(e.type!=="predator")return{};if(!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120||e.attackCooldown&&e.attackCooldown>0)return{};const n={},s=t.gameState.search.predator.byRadius(e.position,YS);let a=null,c=1/0;for(const d of s)if(d.id!==e.id&&d.hitpoints>0&&d.isAdult&&e.fatherId!==d.fatherId&&e.gender===d.gender&&e.fatherId!==void 0&&d.fatherId!==void 0){const u=X(e.position,d.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);u<c&&(c=u,a=d)}if(a){const d=`animal-territorial-${e.id}-${a.id}`;n[d]={id:d,type:$.AnimalTerritorial,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},OM=(e,t,n)=>{if(e.type!=="predator"||!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120)return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const a=X(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>YS*1.2?null:Qe(a)*.7},NM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return N.Success;const{width:a,height:c}=n.gameState.mapDimensions;if(X(t.position,s.position,a,c)<=pr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},N.Running;{t.activeAction="moving",t.target=s.id;const u=Le(t.position,s.position,a,c);return t.direction=mt(u),N.Running}},BM={type:$.AnimalTerritorial,producer:bM,scorer:OM,executor:NM},HM=(e,t)=>{if(e.type!=="predator")return{};if(e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return{};if(e.fatherId===void 0)return{};const n={},o=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,c=o.search.predator.byRadius(e.position,us*4);let d=null;for(const u of c)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&u.fatherId===e.fatherId&&(u.age>=e.age||u.hitpoints>e.hitpoints)&&(!d||u.age>d.age)&&(d=u);if(d&&X(e.position,d.position,s,a)>us*2){const h=`animal-pack-follow-${e.id}-${d.id}`;n[h]={id:h,type:$.AnimalPack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return n},FM=(e,t,n)=>{if(e.type!=="predator"||e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const{width:a,height:c}=n.gameState.mapDimensions,d=X(e.position,s.position,a,c);return d<=us*2?null:Qe(d)*.35},LM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return N.Success;const{width:a,height:c}=n.gameState.mapDimensions;if(X(t.position,s.position,a,c)<=us*2)return t.activeAction="idle",t.direction={x:0,y:0},N.Success;t.activeAction="moving",t.target=s.id;const u=Le(t.position,s.position,a,c);return t.direction=mt(u),N.Running},UM={type:$.AnimalPack,producer:HM,scorer:FM,executor:LM},Vt={};Vt[$.HumanHuntPrey]={type:$.HumanHuntPrey,producer:XR};Vt[$.HumanHuntPredator]={type:$.HumanHuntPredator,producer:VR};Vt[$.AnimalFlee]=QR;Vt[$.AnimalGraze]=nM;Vt[$.AnimalHunt]=sM;Vt[$.AnimalAttack]=DM;Vt[$.AnimalProcreate]=uM;Vt[$.AnimalWander]=gM;Vt[$.AnimalFeedChild]=SM;Vt[$.AnimalSeekFoodFromParent]=EM;Vt[$.AnimalHerd]=PM;Vt[$.AnimalTerritorial]=BM;Vt[$.AnimalPack]=UM;function vy(e,t){el(e,t,Object.values(Vt))}function uI(e,t){let n=eu(e);if(n){const o=t.gameState.tasks[n];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(xi(e,null),n=null)}if(!n){const o=GM(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];n=o,xi(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const o=t.gameState.tasks[n];o?sI(e,o,t,Vt):xi(e,null)}}function GM(e,t){let n=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,1e3);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const c=Vt[a.type];if(!c||!c.scorer)continue;const d=c.scorer(e,a,t);d!==null&&d>o&&(o=d,n=a.id)}return o>0?n:null}function xM(e,t){uI(e,t)}function $M(e,t){uI(e,t)}const WM=(e,t)=>{if(e.buildingType!==Z.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,o=AS(e);if(J_(e,n)>=o)return{};const a=n.search.tasks.byProperty("creatorEntityId",e.id).find(p=>p.type===$.HumanPlantBush);if(a)return{[a.id]:a};const c=n.mapDimensions.width,d=n.mapDimensions.height,u=n.soilDepletion,h=10;for(let p=0;p<h;p++){const y=e.position.x+(Math.random()-.5)*e.width,S=e.position.y+(Math.random()-.5)*e.height,v={x:(y%c+c)%c,y:(S%d+d)%d};if(!dr(u,v,c,d)&&!$i(v,n,uu)){const A=`plant-bush-${e.id}`,I={id:A,type:$.HumanPlantBush,position:v,creatorEntityId:e.id,target:v,validUntilTime:n.time+sR};return{[A]:I}}}return{}},YM=(e,t)=>{const n={};if(e.buildingType===Z.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const o=`stockpile-${e.id}`;n[o]={id:o,type:$.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n},zM=(e,t)=>{const n={};if(e.buildingType===Z.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*H1){const o=`fuel-bonfire-${e.id}`;n[o]={id:o,type:$.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n},jM=(e,t)=>{const n={};if(e.buildingType===Z.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let o=0;o<G1;o++){const s=`seek-warmth-${e.id}-${o}`;n[s]={id:s,type:$.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n},XM=(e,t)=>{const n={};if(e.buildingType===Z.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(o=>o.item.itemType==="food")){const o=`retrieve-from-${e.id}`;n[o]={id:o,type:$.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n},VM={[$.HumanPlantBush]:{type:$.HumanPlantBush,producer:WM},[$.HumanStockpile]:{type:$.HumanStockpile,producer:YM},[$.HumanFuelBonfire]:{type:$.HumanFuelBonfire,producer:zM},[$.HumanSeekWarmth]:{type:$.HumanSeekWarmth,producer:jM},[$.HumanRetrieve]:{type:$.HumanRetrieve,producer:XM}};function dI(e,t){el(e,t,Object.values(VM))}function qM(e,t){const{gameState:n,deltaTime:o}=t,s=o*(Dt/Lt);if(e.isBeingDestroyed){const a=oE(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){(e.buildingType===Z.Palisade||e.buildingType===Z.Gate)&&$a(n,e.position,e.radius,!1);const c=e.buildingType===Z.PlantingZone;mr(n.entities,e.id),c&&Oa(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=iE(e.buildingType);a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&jh(e.position,lr,e.ownerId,n),(e.buildingType===Z.Palisade||e.buildingType===Z.Gate)&&$a(n,e.position,e.radius,!0,e.ownerId),e.buildingType===Z.PlantingZone&&Oa(n))}if(e.buildingType===Z.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*B1,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*L1)){const a=e.storedItems.findIndex(c=>c.item.itemType==="item"&&c.item.type===Ot.Wood);a!==-1&&(e.storedItems.splice(a,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+nS))}dI(e,t)}function ZM(e,t){const n=t.deltaTime*Dt/Lt;if(e.age+=n,!e.stateMachine)return;const[o]=e.stateMachine,s=e.stateMachine[1];(o===Gt||o===mi)&&s.enteredAt>=t.gameState.time-n&&$a(t.gameState,e.position,e.radius,!1),o!==Gt&&o!==mi&&o!==ur&&(e.age>=Ro&&!e.woodGenerated&&(e.wood=Array.from({length:wu},()=>({itemType:"item",type:Ot.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=Ja*Math.min(1,Math.max(.4,e.age/Ro)))}const KM={type:$.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const o=`gather-berries-${e.id}`;n[o]={id:o,type:$.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n}},QM={type:$.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[o]=e.stateMachine??[];if(o===Vn||o===Hn||o===gi){const a=`chop-tree-${e.id}`;n[a]={id:a,type:$.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n}},JM={type:$.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[o]=e.stateMachine??[];if(o===Gt&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:$.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n}},ek=[KM,QM,JM].reduce((e,t)=>(e[t.type]=t,e),{});function Sy(e,t){el(e,t,Object.values(ek))}const tk={type:$.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const o=`gather-meat-${e.id}`;n[o]={id:o,type:$.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+_t}}return n}},nk=[tk].reduce((e,t)=>(e[t.type]=t,e),{});function ik(e,t){el(e,t,Object.values(nk))}var Hc=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(Hc||{});function Yf(e,t,n){switch(n){case 0:ok(e,t);break;case 1:rk(e,t);break;case 2:sk(e,t);break}}function ok(e,t){e.forces.push(ut(e.velocity,-.1));const n=ut(mt(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(o=>{t.gameState.time-o.startTime<o.duration&&o.type==="slow"&&(e.velocity=ut(e.velocity,.5))}),e.debuffs=e.debuffs.filter(o=>t.gameState.time-o.startTime<o.duration),e.velocity=pi(e.velocity,e.forces.reduce(pi,{x:0,y:0})),Eo(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=pi(e.position,ut(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&Eo(e.velocity)>.1&&nC(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?tR(e,t,t.deltaTime):e.type==="corpse"?nR(e,t):e.type==="prey"?iR(e,t,t.deltaTime):e.type==="predator"?oR(e,t,t.deltaTime):e.type==="building"?qM(e,t):e.type==="tree"?ZM(e,t):e.type,e.stateMachine&&(e.stateMachine=QP(...e.stateMachine,{entity:e,updateContext:t}))}function rk(e,t){fI(e,t)&&(e.type==="human"?WR(e,t):e.type==="corpse"?ik(e,t):e.type==="prey"||e.type==="predator"?vy(e,t):e.type==="building"?dI(e,t):(e.type==="tree"||e.type==="berryBush")&&Sy(e,t))}function sk(e,t){fI(e,t)&&(e.type==="human"?jR(e,t):e.type==="corpse"||(e.type==="prey"?xM(e,t):e.type==="predator"?$M(e,t):e.type==="building"||e.type==="tree"||e.type),De.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function fI(e,t){const n=De.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-n+(Math.random()-Math.random())*x0/10>x0}function ak(e){const t=e.gameState.entities.entities;for(const n in t)Yf(t[n],e,Hc.Physics);for(const n in t)Yf(t[n],e,Hc.PrepareAI);QA(e.gameState);for(const n in t)Yf(t[n],e,Hc.ExecuteAI)}function hI(){return{entities:{},nextEntityId:1}}function gr(e,t,n){const o={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:De.create(),...n};return e.entities[o.id]=o,o}function nl(e,t,n){return gr(e,"berryBush",{position:t,radius:ch,food:Array.from({length:Sw},()=>({itemType:"food",type:ti.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:vw,lifespan:Tw,age:0,spreadRadius:ch,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:De.create(),stateMachine:[Ea,{enteredAt:n,previousState:void 0}]})}function ja(e,t,n,o=0){const s=o>=Ro;return gr(e,"tree",{position:t,radius:Ja,age:o,lifespan:NP,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:WP,stateMachine:[Vn,{enteredAt:n,previousState:void 0}],aiBlackboard:De.create(),wood:s?Array.from({length:wu},()=>({itemType:"item",type:Ot.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function Jr(e,t,n,o,s=!1,a=Lw,c=zv,d,u,h=[],p,y,S=Mo.TaskBased){const v=a>=Fh;return gr(e,"human",{position:t,radius:v?gt:gs,hunger:c,hitpoints:U0,maxHitpoints:U0,age:a,gender:o,isPlayer:s,food:[],maxFood:$v,maxAge:Fa,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:d,fatherId:u,ancestorIds:h,stateMachine:[ct,{enteredAt:n,previousState:void 0}],leaderId:p,tribeInfo:y,aiType:S,aiBlackboard:De.create()})}function cp(e,t,n,o,s,a,c,d,u,h,p){let y,S;switch(c){case"human":y=Xv,S=Bn;break;case"prey":y=2,S=120;break;case"predator":y=4,S=140;break}return gr(e,"corpse",{position:t,radius:s,gender:n,age:o,originalEntityId:a,originalEntityType:c,timeOfDeath:d,decayProgress:0,geneCode:p,food:[...Array.from({length:Math.max(y*Math.max(S-h,0)/S,0)},()=>({itemType:"food",type:ti.Meat})),...u].map(A=>({...A,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:De.create()})}function lk(e,t,n,o,s,a,c,d,u){return cp(e,t,n,o,s,a,"human",c,d,u)}function ck(e,t,n,o,s,a,c,d){return cp(e,t,n,o,s,a,"prey",c,[],0,d)}function uk(e,t,n,o,s,a,c,d){return cp(e,t,n,o,s,a,"predator",c,[],0,d)}function dk(e,t,n){const o=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=o?[...o.ancestorIds||[],o.id]:[],c=[...s,...a],d=[...new Set(c)],u=d.slice(Math.max(d.length-Gv,0)),h=Math.random()<.5?"male":"female",p=pi(e.position,{x:5,y:5}),y=Jr(n.gameState.entities,p,n.gameState.time,h,!1,0,zv/2,e.id,t,u,(o==null?void 0:o.leaderId)??e.leaderId,(o==null?void 0:o.tribeInfo)??e.tribeInfo,e.aiType);return Ce(n,Ie.Birth,e.position),y}function mr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function ds(e,t,n,o=sP,s=GS,a,c,d,u=Mo.TaskBased){const h=o>=xS,p=Date.now();return gr(e,"prey",{position:t,radius:h?gt*.7:gs*.7,hunger:s,hitpoints:hy,maxHitpoints:hy,age:o,maxAge:US,gender:n,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:c,fatherId:d,stateMachine:[Xn,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:De.create()})}function fs(e,t,n,o=hP,s=WS,a,c,d,u=Mo.TaskBased){const h=o>=XS,p=Date.now();return gr(e,"predator",{position:t,radius:h?gt*.9:gs*.9,hunger:s,hitpoints:py,maxHitpoints:py,age:o,maxAge:$S,gender:n,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:c,fatherId:d,stateMachine:[tn,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:De.create()})}function fk(e,t,n,o){const s=Ch(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:o,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:bC,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===Z.Bonfire?fh:void 0,maxFuelLevel:n===Z.Bonfire?fh:void 0,aiBlackboard:De.create(),stateMachine:["",{enteredAt:0}]};return gr(e,"building",a)}var Jt=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(Jt||{}),rr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(rr||{}),en=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(en||{});const vh={},Sh={},hk=[{key:Jt.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:Jt.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>Bw,isCompleted:!1,minDisplayTime:J0,highlightedUIElements:[rr.HUNGER_BAR]},{key:Jt.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!Xe(t,e,"berryBush",Ve*5,o=>o.food.length>0),getTargets:(e,t)=>{const n=[];for(const o of Object.values(e.entities.entities))o.type==="berryBush"&&o.food.length>0&&X(t.position,o.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(o);return n.map(o=>o.id)},isCompleted:!1,minDisplayTime:J0},{key:Jt.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=Xe(t,e,"berryBush",Ve,o=>o.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:Jt.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[rr.FOOD_BAR]},{key:Jt.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>Wi(e,t).length>0,getTargets:(e,t)=>{const n=Xe(t,e,"human",Ve,o=>ps(t,o,e));return n?[n.id]:[]},isCompleted:!1},{key:Jt.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>op(e,t).some(o=>o.type===de.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:Jt.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[rr.COMMAND_BUTTONS],isCompleted:!1},{key:Jt.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:Jt.AUTOPILOT},{key:Jt.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=Xe(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=Xe(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:Jt.ANIMALS_INTRODUCTION},{key:Jt.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!Xe(t,e,"predator",120),getTargets:(e,t)=>{const n=Xe(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:Jt.HUNT_PREY}].map(e=>({...e,condition:e.condition?mk(e.condition):void 0,getTargets:e.getTargets?yk(e.getTargets):void 0}));function pI(){return{steps:hk.map(e=>({...e,isCompleted:!1}))}}function gI(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:en.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function pk(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function gk(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=en.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const o=wt(e);if(!o){n.isActive=!1,n.transitionState=en.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=en.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/E_;switch(n.transitionState){case en.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=en.ACTIVE);break;case en.ACTIVE:{const u=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),h=vh[s.condition];h&&u&&h(e,o)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=en.FADING_OUT);break}case en.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const d=pk(e);d!==null?(n.currentStepIndex=d,n.transitionState=en.FADING_IN):(n.isActive=!1,n.transitionState=en.INACTIVE)}break}if(n.transitionState!==en.FADING_OUT&&n.transitionState!==en.INACTIVE){const d=Sh[s.getTargets||""];d?n.highlightedEntityIds=[...d(e,o)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function mk(e){const t=`condition_${Object.keys(vh).length+1}`;return vh[t]=e,t}function yk(e){const t=`getTargets_${Object.keys(Sh).length+1}`;return Sh[t]=e,t}function vk(){const e=hI(),t=0;for(let S=0;S<Dv;S++){const v={x:Math.random()*Ue,y:Math.random()*Ge};nl(e,v,t)}for(let S=0;S<kv;S++){const v={x:Math.random()*Ue,y:Math.random()*Ge};ja(e,v,t)}const n=Ue/2,o=Ge/2;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,A=100+Math.random()*100,I={x:n+Math.cos(v)*A,y:o+Math.sin(v)*A};ja(e,I,t,Ro)}const s=Jr(e,{x:n-25,y:o},t,"male",!0),a=Jr(e,{x:n+25,y:o},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:Ut[0]},s.aiType=Mo.TaskBased,a.aiType=Mo.TaskBased;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,A=Ue/2,I=Ge/2,E={x:n+Math.cos(v)*A,y:o+Math.sin(v)*I},_=Jr(e,{x:E.x,y:E.y},t,"male",!1);_.leaderId=_.id,_.tribeInfo={tribeBadge:Xc[S%Xc.length],tribeColor:Ut[S%Ut.length]};const w=Jr(e,{x:E.x+50,y:E.y},t,"female",!1);w.leaderId=_.id,w.tribeInfo=_.tribeInfo}for(let S=0;S<VS;S++){const v={x:n+Ue*(Math.random()-Math.random()),y:o+Ge*(Math.random()-Math.random())};ds(e,v,"male",void 0,void 0,Wa()),ds(e,{x:v.x+20,y:v.y},"female",void 0,void 0,Wa())}const c={x:n+Ue*(Math.random()-Math.random()),y:o+Ge*(Math.random()-Math.random())};fs(e,c,"male",void 0,void 0,Ya()),fs(e,{x:c.x+20,y:c.y},"female",void 0,void 0,Ya());const d=[{id:"muteButton",action:fe.ToggleMute,currentWidth:Ni,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Et},{id:"pauseButton",action:fe.TogglePause,currentWidth:Ni,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Et},{id:"returnToIntroButton",action:fe.ReturnToIntro,currentWidth:Ni,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:Et}],u=pI(),h=gI(),p={time:t,entities:e,mapDimensions:{width:Ue,height:Ge},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:MS,isMuted:!1,uiButtons:d,tutorial:u,tutorialState:h,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:ar.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:er,preyProcreationCooldown:tr,predatorGestationPeriod:nr,predatorProcreationCooldown:ir,preyHungerIncreasePerHour:So,predatorHungerIncreasePerHour:Io,berryBushSpreadChance:Ui,treeSpreadChance:Gi},soilDepletion:Nv(),temperature:nI(Ue,Ge),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ue/Ae)*Math.ceil(Ge/Ae)).fill(null),navigationGrid:LS(Ue,Ge),pathfindingQueue:[],tasks:{}};Object.values(p.entities.entities).forEach(S=>{S.type==="tree"&&$a(p,S.position,S.radius,!0)});const y=iu(p);return console.log("Game world initialized:",y),y}function Sk(){const e=hI(),t=0;for(let u=0;u<Dv;u++){const h={x:Math.random()*Ue,y:Math.random()*Ge};nl(e,h,t)}for(let u=0;u<kv;u++){const h={x:Math.random()*Ue,y:Math.random()*Ge};ja(e,h,t)}const n=Ue/2,o=Ge/2;for(let u=0;u<5;u++){const h=u/5*Math.PI*2,p=100+Math.random()*100,y={x:n+Math.cos(h)*p,y:o+Math.sin(h)*p};ja(e,y,t,Ro)}for(let u=0;u<gw;u++){const h={x:Math.random()*Ue,y:Math.random()*Ge},p=Math.random()<.5?"male":"female";Jr(e,h,t,p,!1)}for(let u=0;u<VS;u++){const h={x:Math.random()*Ue,y:Math.random()*Ge};ds(e,h,"male",void 0,void 0,Wa()),ds(e,{x:h.x+20,y:h.y},"female",void 0,void 0,Wa())}const s={x:Math.random()*Ue,y:Math.random()*Ge};fs(e,s,"male",void 0,void 0,Ya()),fs(e,{x:s.x+20,y:s.y},"female",void 0,void 0,Ya());const a=pI(),c=gI(),d={time:t,entities:e,mapDimensions:{width:Ue,height:Ge},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Ue/2,y:Ge/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:MS,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:c,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:er,preyProcreationCooldown:tr,predatorGestationPeriod:nr,predatorProcreationCooldown:ir,preyHungerIncreasePerHour:So,predatorHungerIncreasePerHour:Io,berryBushSpreadChance:Ui,treeSpreadChance:Gi},soilDepletion:Nv(),temperature:nI(Ue,Ge),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ue/Ae)*Math.ceil(Ge/Ae)).fill(null),navigationGrid:LS(Ue,Ge),pathfindingQueue:[],tasks:{}};return Object.values(d.entities.entities).forEach(u=>{u.type==="tree"&&$a(d,u.position,u.radius,!0)}),iu(d)}const Ik="humanProcreation",Tk="human",Ak="human",Ek=Ve,wk=(e,t,n)=>ps(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,_k=(e,t,n)=>{const{gameState:o}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,c=e.gender==="female"?e:t,d=(a.partnerIds||[]).length===0;if(e.stateMachine[0]!==Ko&&(e.stateMachine=[Ko,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:n.gameState.time+1}]),t.stateMachine[0]!==Ko&&(t.stateMachine=[Ko,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),d&&a.leaderId&&a.leaderId!==a.id){const u=o.entities.entities[a.leaderId];if(u){const h=gh(a,u),p=gh(c,u);if(!h&&!p){const y=qc();a.leaderId=a.id,a.tribeInfo={tribeBadge:y,tribeColor:Ut[Math.floor(Math.random()*Ut.length)]},a.tribeControl={diplomacy:{}},c.leaderId=a.id,c.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&c){const u=qc();a.leaderId=a.id,a.tribeInfo={tribeBadge:u,tribeColor:Ut[Math.floor(Math.random()*Ut.length)]},a.tribeControl={diplomacy:{}},c.leaderId=a.id,c.tribeInfo=a.tribeInfo}e.activeAction=void 0,Oe(o,Se.Procreation,s,Ua),Oe(o,Se.Partnered,e.position,We,e.id),Oe(o,Se.Partnered,t.position,We,t.id),e.lastPartneredEffectTime=o.time,t.lastPartneredEffectTime=o.time,t.activeAction=void 0,Ce(n,Ie.Procreate,s)},Ck={id:Ik,sourceType:Tk,targetType:Ak,maxDistance:Ek,checker:wk,perform:_k},Pk={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:jv,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=wo&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-wo),e.feedChildCooldownTime=Yw,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Oe(n.gameState,Se.ChildFed,t.position,We,t.id),t.lastChildFedEffectTime=n.gameState.time),Ce(n,Ie.ChildFed,t.position)}},Rk={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:dn,checker:(e,t,n)=>{var p,y;if(e.stateMachine[0]!==Po||e.attackTargetId!==t.id)return!1;const o=X(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=_o,a=!s&&o<=dn;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((y=e.attackCooldown)==null?void 0:y.ranged)||0)>0)return!1;const d=s?hu:xh,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:o}=n,s=X(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>_o,c=Le(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),d=ZA(mt(c),t.direction);if(Math.abs(d)<n1*Math.PI/180&&Math.random()<i1)Oe(o,Se.AttackDeflected,t.position,We,t.id);else{let p=a?Gh:Uh;if(e.gender==="male"&&(p*=Jw),e.isAdult||(p*=e1),(!t.isAdult||t.age>=Lh)&&e.isAdult&&(p*=t1),a){const S=s/$h;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+S,data:{attackerId:e.id,targetId:t.id,damage:p,pushbackForce:Yh,attackerPosition:{...e.position}}}),Oe(o,Se.StoneProjectile,e.position,S,void 0,t.position,t.id),Ce(n,Ie.Attack,e.position)}else{t.hitpoints-=p,t.movementSlowdown={modifier:pu,endTime:o.time+gu},Oe(o,Se.Hit,t.position,We,t.id);const S=Le(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),v=ut(S,qw);t.forces.push(v),t.hitpoints<=0?Ce(n,Ie.HumanDeath,t.position):Ce(n,Ie.Attack,e.position),Oe(o,Se.Attack,e.position,We,e.id)}}e.attackCooldown={melee:qa,ranged:Wh};const h=e.stateMachine[1];h.attackStartTime=o.time}},Mk={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:gt*2,checker:(e,t,{gameState:n})=>X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const o=X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(o===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const a=(e.radius+t.radius-o)*.05,c=mt(wh(e.position,t.position)),d=ut(c,a);e.forces.push(d),t.forces.push(ut(d,-1))}},kk={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:gt*.6+Ja*.4,checker:(e,t,{gameState:n})=>{const o=t.stateMachine[0];if(o==="fallen"||o==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=s+o-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ut(u,d);e.forces.push(h)}},Dk={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:gt*.6+Ja*.4,checker:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4;return X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+o},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=s+o-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ut(u,d);e.forces.push(h)}},bk={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:gt*.6+Ja*.4,checker:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4;return X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+o},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=s+o-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ut(u,d);e.forces.push(h)}},Ok={id:"human-building-collision",sourceType:"human",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==Z.Palisade&&t.buildingType!==Z.Gate||!t.isConstructed||t.buildingType===Z.Gate&&e.leaderId===t.ownerId)return!1;const o=e.radius*.4,s=t.radius;return X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.4,s=t.radius,a=X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=o+s-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ut(u,d);e.forces.push(h)}},Nk={id:"prey-building-collision",sourceType:"prey",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==Z.Palisade&&t.buildingType!==Z.Gate||!t.isConstructed)return!1;const o=e.radius*.4,s=t.radius;return X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.4,s=t.radius,a=X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=o+s-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ut(u,d);e.forces.push(h)}},Bk={id:"predator-building-collision",sourceType:"predator",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==Z.Palisade&&t.buildingType!==Z.Gate||!t.isConstructed)return!1;const o=e.radius*.4,s=t.radius;return X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.4,s=t.radius,a=X(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=o+s-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ut(u,d);e.forces.push(h)}},Hk={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:Ve,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===ms&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Oe(n.gameState,Se.BushClaimed,t.position,We),Ce(n,Ie.Gather,e.position)}},Fk={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:Ve,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===ms&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=n.gameState.time+1,Ce(n,Ie.Gather,e.position)}},Lk={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:Ve,checker:(e,t,n)=>e.isAdult&&t.stateMachine[0]===Gt&&t.wood.length>0&&e.stateMachine[0]===ms&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.wood.pop();o&&(e.heldItem=o),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[mi,{enteredAt:n.gameState.time,previousState:Gt}]),Ce(n,Ie.Gather,e.position)}},Uk=[Hk,Fk,Lk],Gk={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:cs,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=cP,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+lP,Oe(n.gameState,Se.BushClaimed,t.position,We,e.id),Ce(n,Ie.Gather,e.position))}},xk={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:pP,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=gP;const o=Le(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=ut(o,8);t.forces.push(s),e.huntCooldown=vP,t.hitpoints<=0?(Ce(n,Ie.HumanDeath,t.position),Oe(n.gameState,Se.Hit,t.position,We,t.id)):(Oe(n.gameState,Se.Hit,t.position,We,t.id),t.fleeCooldown=5,Ce(n,Ie.Attack,e.position)),Oe(n.gameState,Se.Attack,e.position,We,e.id)}},$k={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:dn,checker:(e,t,n)=>{var p,y;if(e.stateMachine[0]!==Po||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=X(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=_o,a=!s&&o<=dn;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((y=e.attackCooldown)==null?void 0:y.ranged)||0)>0)return!1;const d=s?hu:xh,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:o}=n,s=X(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>_o;let c=(a?Gh:Uh)*1.2;if(e.gender==="male"&&(c*=1.3),a){const u=s/$h;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+u,data:{attackerId:e.id,targetId:t.id,damage:c,pushbackForce:Yh,attackerPosition:{...e.position}}}),Oe(o,Se.StoneProjectile,e.position,u,void 0,t.position,t.id),Ce(n,Ie.Attack,e.position)}else{t.hitpoints-=c;const u=Le(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),h=ut(u,6);t.forces.push(h),t.hitpoints<=0?(Ce(n,Ie.HumanDeath,t.position),Oe(o,Se.Hit,t.position,We,t.id)):(Oe(o,Se.Hit,t.position,We,t.id),t.fleeCooldown=8,Ce(n,Ie.Attack,e.position)),Oe(o,Se.Attack,e.position,We,e.id)}e.attackCooldown={melee:qa,ranged:Wh};const d=e.stateMachine[1];d.attackStartTime=o.time}},Wk={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:pr,checker:(e,t,n)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=n.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,n)=>{let o=zS;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:pu,endTime:n.gameState.time+gu};const s=Le(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=ut(s,7);t.forces.push(a),e.attackCooldown=jS,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-sp),Ce(n,Ie.HumanDeath,t.position),Oe(n.gameState,Se.Hit,t.position,We,t.id)):(Oe(n.gameState,Se.Hit,t.position,We,t.id),Ce(n,Ie.Attack,e.position)),Oe(n.gameState,Se.Attack,e.position,We,e.id)}},Yk={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:dn,checker:(e,t,n)=>{var p,y;if(e.stateMachine[0]!==Po||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=X(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=_o,a=!s&&o<=dn;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((y=e.attackCooldown)==null?void 0:y.ranged)||0)>0)return!1;const d=s?hu:xh,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:o}=n,s=X(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>_o;let c=(a?Gh:Uh)*.8;e.gender==="male"&&(c*=1.2);const d=Object.values(o.entities.entities).filter(h=>h.type==="human"&&h.id!==e.id).filter(h=>{const p=h;return Math.sqrt(Math.pow(p.position.x-e.position.x,2)+Math.pow(p.position.y-e.position.y,2))<100&&p.activeAction==="attacking"&&p.attackTargetId===t.id}).length;if(d>0&&(c*=1+d*.2),a){const h=s/$h;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+h,data:{attackerId:e.id,targetId:t.id,damage:c,pushbackForce:Yh,attackerPosition:{...e.position}}}),Oe(o,Se.StoneProjectile,e.position,h,void 0,t.position,t.id),Ce(n,Ie.Attack,e.position)}else{t.hitpoints-=c;const h=Le(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),p=ut(h,8);t.forces.push(p),t.hitpoints<=0?(Ce(n,Ie.HumanDeath,t.position),Oe(o,Se.Hit,t.position,We,t.id)):(Oe(o,Se.Hit,t.position,We,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),Ce(n,Ie.Attack,e.position)),Oe(o,Se.Attack,e.position,We,e.id)}e.attackCooldown={melee:qa,ranged:Wh};const u=e.stateMachine[1];u.attackStartTime=o.time}},zk={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:cs,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Oe(n.gameState,Se.Procreation,o.position,We,o.id),Ce(n,Ie.Procreate,o.position)}},jk={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:us,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.pregnancyFatherId=e.gender==="male"?e.id:t.id,o.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Oe(n.gameState,Se.Procreation,o.position,We,o.id),Ce(n,Ie.Procreate,o.position)}},Xk={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:qS,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Jc&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-Jc),e.feedChildCooldownTime=ZS,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Oe(n.gameState,Se.ChildFed,t.position,We,t.id),t.lastChildFedEffectTime=n.gameState.time),Ce(n,Ie.ChildFed,t.position)}},Vk={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:qS,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Jc&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-Jc),e.feedChildCooldownTime=ZS,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Oe(n.gameState,Se.ChildFed,t.position,We,t.id),t.lastChildFedEffectTime=n.gameState.time),Ce(n,Ie.ChildFed,t.position)}},qk={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:us,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-sp),e.eatingCooldownTime=n.gameState.time+2,Oe(n.gameState,Se.Eating,e.position,We,e.id),Ce(n,Ie.Gather,e.position))}},Zk={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:pr,checker:(e,t,n)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=n.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,n)=>{let o=zS;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:pu,endTime:n.gameState.time+gu};const s=Le(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=ut(s,7);t.forces.push(a),e.attackCooldown=jS,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-sp),Ce(n,Ie.HumanDeath,t.position),Oe(n.gameState,Se.Hit,t.position,We,t.id)):(Oe(n.gameState,Se.Hit,t.position,We,t.id),Ce(n,Ie.Attack,e.position)),Oe(n.gameState,Se.Attack,e.position,We,e.id)}},Kk=25;function Iy(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function mI(e){const t=e.storedItems.length,n=Iy(t+e.id)*2*Math.PI,o=Iy(t+e.id+1)*Kk;return{x:Math.cos(n)*o,y:Math.sin(n)*o}}const Qk={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:Jn,checker:(e,t,n)=>{var h;const o=t.buildingType===Z.StorageSpot,s=t.buildingType===Z.Bonfire;if(!o&&!s||e.stateMachine[0]!==Ra||!t.isConstructed)return!1;const a=e.food.length>0,c=((h=e.heldItem)==null?void 0:h.type)===Ot.Wood;if(s&&!c||!a&&!c)return!1;const d=t.storageCapacity??0;return!(t.storedItems.length>=d||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<OC)},perform:(e,t,n)=>{var s;let o=null;t.buildingType===Z.Bonfire?((s=e.heldItem)==null?void 0:s.type)===Ot.Wood&&(o=e.heldItem,e.heldItem=void 0):e.heldItem?(o=e.heldItem,e.heldItem=void 0):o=e.food.pop()??null,o&&t.storedItems.push({item:o,positionOffset:mI(t)}),t.lastDepositTime=n.gameState.time,Ce(n,Ie.StorageDeposit,t.position)}},Jk={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:Jn,checker:(e,t,n)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Ma||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<NC),perform:(e,t,n)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&(e.food.push(o.item),mI(t)),t.lastRetrieveTime=n.gameState.time,Ce(n,Ie.StorageRetrieve,t.position)}},eD={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:Jn,checker:(e,t,n)=>{var d;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==ms||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const o=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!o||!((d=o.tribeControl)!=null&&d.diplomacy)||(t.ownerId?o.tribeControl.diplomacy[t.ownerId]:void 0)!==At.Hostile||n.gameState.time-(t.lastStealTime??0)<BC)return!1;const c=SS({leaderId:t.ownerId},n.gameState);for(const u of c)if(X(e.position,u.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=HC)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&e.food.push(o.item),t.lastStealTime=n.gameState.time,Ce(n,Ie.StorageSteal,t.position),Oe(n.gameState,Se.Attack,t.position,.5)}},tD={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!cr(e,t,n.gameState)||!Kv(t.position,lr,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,Jv(t.position,lr,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Oe(n.gameState,Se.BushClaimed,t.position,2,t.id)}},nD={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!cr(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Oe(n.gameState,Se.Hit,t.position,1,t.id)}},iD={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:fu,checker:(e,t,n)=>{const[o]=t.stateMachine??[],s=o===Vn||o===Hn||o===gi;return e.isAdult&&s&&e.stateMachine[0]===rp&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const{gameState:o}=n;if(t.stateMachine=[Gt,{enteredAt:o.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/Ro),a=Math.floor(gy+s*(wu-gy));t.wood=Array.from({length:a},()=>({itemType:"item",type:Ot.Wood,id:o.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=o.time+1,Ce(n,Ie.Gather,e.position)}},oD={id:"human-attack-building",sourceType:"human",targetType:"building",maxDistance:40,checker:(e,t,n)=>{const{gameState:o}=n;return!(t.buildingType!==Z.Palisade&&t.buildingType!==Z.Gate||!t.ownerId||t.ownerId===e.leaderId||e.attackCooldown&&e.attackCooldown.melee>o.time)},perform:(e,t,n)=>{const{gameState:o}=n;t.isBeingDestroyed=!0;const s=.1;t.destructionProgress=Math.min(1,t.destructionProgress+s),e.attackCooldown||(e.attackCooldown={melee:0,ranged:0}),e.attackCooldown.melee=o.time+qa,Oe(o,Se.Hit,t.position,.5,e.id,void 0,t.id)}},rD=[Mk,kk,Dk,bk,Ok,Nk,Bk,...Uk,Ck,Pk,Rk,Qk,Jk,eD,tD,nD,iD,oD,Gk,Xk,Vk,qk,xk,$k,Yk,Wk,Zk,zk,jk],Ty=Object.values(rD.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const o={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[n].interactions.push(o),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));let Ay=0;function sD(e){const{gameState:t}=e,n=t,{width:o,height:s}=t.mapDimensions;Ay++;const a=Ay%2===0;for(let c=0;c<Ty.length;c++){const d=Ty[c],u=n.search[d.sourceType].all();for(let h=0;h<u.length;h++){const p=u[h],y=n.search[d.targetType].byRadius(p.position,d.maxDistance);for(let S=0;S<y.length;S++){const v=y[S];if(p.id===v.id)continue;const A=bt(p.position,v.position,o,s);for(let I=0;I<d.interactions.length;I++){const E=d.interactions[I];!E.isCollision&&a||A<=E.maxDistanceSq&&E.checker(p,v,e)&&E.perform(p,v,e)}}}}}function yI(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function aD(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),o=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,p=50+Math.random()*100;a={x:Math.max(50,Math.min(Ue-50,u.position.x+Math.cos(h)*p)),y:Math.max(50,Math.min(Ge-50,u.position.y+Math.sin(h)*p))}}else a={x:50+Math.random()*(Ue-100),y:50+Math.random()*(Ge-100)};let c=!0;const d=100;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){c=!1;break}if(c){for(const u of o)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){c=!1;break}}if(c)return a}return{x:Ue*.3+Math.random()*Ue*.4,y:Ge*.3+Math.random()*Ge*.4}}function lD(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,p=100+Math.random()*150;a={x:Math.max(50,Math.min(Ue-50,u.position.x+Math.cos(h)*p)),y:Math.max(50,Math.min(Ge-50,u.position.y+Math.sin(h)*p))}}else a={x:50+Math.random()*(Ue-100),y:50+Math.random()*(Ge-100)};let c=!0;const d=150;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){c=!1;break}if(c)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Ue,y:50+Math.random()*100};case 1:return{x:Ue-150+Math.random()*100,y:Math.random()*Ge};case 2:return{x:Math.random()*Ue,y:Ge-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Ge}}}function cD(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let o=0;o<20;o++){const s={x:50+Math.random()*(Ue-100),y:50+Math.random()*(Ge-100)};let a=!0;const c=80,d=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){a=!1;break}if(a){for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<d){a=!1;break}}if(a)return s}return{x:Math.random()*Ue,y:Math.random()*Ge}}function vI(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let o=0;o<t;o++){const s=aD(n),a=o%2===0?"male":"female";ds(e.entities,s,a,void 0,void 0,Wa())}}function SI(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let o=0;o<t;o++){const s=lD(n),a=o%2===0?"male":"female";fs(e.entities,s,a,void 0,void 0,Ya())}}function uD(e){const t=e,n=t.search.prey.count(),o=t.search.predator.count();let s=!1;return n===0&&(vI(e,6),s=!0),o===0&&(SI(e,3),s=!0),s}function dD(e){const t=e,n=t.search.prey.count(),o=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const c=Math.max(2,Math.floor(8-n));vI(e,c),a=!0}if(o>0&&o<2){const c=Math.max(1,Math.floor(3-o));SI(e,c),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let c=0;c<5;c++){const d=cD(t);nl(e.entities,d,e.time)}a=!0}return a}const fD=1,hD=.3,pD=.8,Ey=.8,gD=.99,mD=.05;var II=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.INCREASE_TREE_SPREAD=14]="INCREASE_TREE_SPREAD",e[e.DECREASE_TREE_SPREAD=15]="DECREASE_TREE_SPREAD",e[e.NO_ACTION=16]="NO_ACTION",e))(II||{});const zf=Object.keys(II).length/2;class yD{constructor(){Ht(this,"qTable",new Map);Ht(this,"epsilon",Ey);Ht(this,"lastState",null);Ht(this,"lastAction",null)}discretizeState(t,n,o,s){const a=Math.min(4,Math.floor(t/25)),c=Math.min(4,Math.floor(n/5)),d=Math.min(4,Math.floor(o/15)),u=Math.min(4,Math.floor(s/50));return`${a}-${c}-${d}-${u}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,o){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,o)}getBestAction(t){let n=0,o=this.getQValue(t,0);for(let s=1;s<zf;s++){const a=this.getQValue(t,s);a>o&&(o=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*zf):this.getBestAction(t)}applyEmergencyCorrections(t,n,o,s,a){t<Bi*.5&&(a.ecosystem.preyGestationPeriod=Math.max(Xr,a.ecosystem.preyGestationPeriod*.8),a.ecosystem.preyProcreationCooldown=Math.max(Vr,a.ecosystem.preyProcreationCooldown*.8),a.ecosystem.preyHungerIncreasePerHour=Math.max(Kr,a.ecosystem.preyHungerIncreasePerHour*.9)),n<Hi*.6&&(a.ecosystem.predatorGestationPeriod=Math.max(qr,a.ecosystem.predatorGestationPeriod*.75),a.ecosystem.predatorProcreationCooldown=Math.max(Zr,a.ecosystem.predatorProcreationCooldown*.75),a.ecosystem.predatorHungerIncreasePerHour=Math.max(Qr,a.ecosystem.predatorHungerIncreasePerHour*.85)),o<Fi*.5&&(a.ecosystem.berryBushSpreadChance=Math.min(ma,a.ecosystem.berryBushSpreadChance*1.2)),s<Li*.5&&(a.ecosystem.treeSpreadChance=Math.min(Ta,a.ecosystem.treeSpreadChance*1.2)),t>Bi*1.4&&(a.ecosystem.preyHungerIncreasePerHour=Math.min(So,a.ecosystem.preyHungerIncreasePerHour*1.05)),n>Hi*1.4&&(a.ecosystem.predatorHungerIncreasePerHour=Math.min(Io,a.ecosystem.predatorHungerIncreasePerHour*1.05)),o>Fi*1.4&&(a.ecosystem.berryBushSpreadChance=Math.max(Ui,a.ecosystem.berryBushSpreadChance*.95)),s>Li*1.4&&(a.ecosystem.treeSpreadChance=Math.max(Gi,a.ecosystem.treeSpreadChance*.95))}calculateReward(t,n,o,s){const a=Math.abs(t-Bi),c=Math.abs(n-Hi),d=Math.abs(o-Fi),u=Math.abs(s-Li),h=a/Bi,p=c/Hi,y=d/Fi,S=u/Li,v=h+p+y+S;return 100*Math.exp(-v*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(er,n.ecosystem.preyGestationPeriod+.2*(er-Xr));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(Xr,n.ecosystem.preyGestationPeriod-.2*(er-Xr));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(tr,n.ecosystem.preyProcreationCooldown+.2*(tr-Vr));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max(Vr,n.ecosystem.preyProcreationCooldown-.2*(tr-Vr));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(So,n.ecosystem.preyHungerIncreasePerHour+.2*(So-Kr));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(Kr,n.ecosystem.preyHungerIncreasePerHour-.2*(So-Kr));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(nr,n.ecosystem.predatorGestationPeriod+.2*(nr-qr));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max(qr,n.ecosystem.predatorGestationPeriod-.2*(nr-qr));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min(ir,n.ecosystem.predatorProcreationCooldown+.2*(ir-Zr));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(Zr,n.ecosystem.predatorProcreationCooldown-.2*(ir-Zr));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(Io,n.ecosystem.predatorHungerIncreasePerHour+.2*(Io-Qr));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(Qr,n.ecosystem.predatorHungerIncreasePerHour-.2*(Io-Qr));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(ma,n.ecosystem.berryBushSpreadChance+.2*(ma-Ui));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(Ui,n.ecosystem.berryBushSpreadChance-.2*(ma-Ui));break;case 14:n.ecosystem.treeSpreadChance=Math.min(Ta,n.ecosystem.treeSpreadChance+.2*(Ta-Gi));break;case 15:n.ecosystem.treeSpreadChance=Math.max(Gi,n.ecosystem.treeSpreadChance-.2*(Ta-Gi));break}}updateQTable(t,n,o,s){const a=this.getQValue(t,n),c=Math.max(...Array.from({length:zf},(u,h)=>this.getQValue(s,h))),d=a+hD*(o+pD*c-a);this.setQValue(t,n,d)}step(t){const n=t,o=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count(),c=n.search.tree.count();this.applyEmergencyCorrections(o,s,a,c,t);const d=this.discretizeState(o,s,a,c);if(this.lastState!==null&&this.lastAction!==null){const h=this.calculateReward(o,s,a,c);this.updateQTable(this.lastState,this.lastAction,h,d)}const u=this.chooseAction(d);this.applyAction(u,t),this.epsilon=Math.max(mD,this.epsilon*gD),this.lastState=d,this.lastAction=u}reset(){this.qTable.clear(),this.epsilon=Ey,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let TI=new yD;function vD(e){uD(e),dD(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=Xr+(er-Xr)*.3,e.ecosystem.preyProcreationCooldown=Vr+(tr-Vr)*.3,e.ecosystem.preyHungerIncreasePerHour=Kr+(So-Kr)*.3,e.ecosystem.predatorGestationPeriod=qr+(nr-qr)*.3,e.ecosystem.predatorProcreationCooldown=Zr+(ir-Zr)*.3,e.ecosystem.predatorHungerIncreasePerHour=Qr+(Io-Qr)*.3,e.ecosystem.berryBushSpreadChance=Ui+(ma-Ui)*.7,e.ecosystem.treeSpreadChance=Gi+(Ta-Gi)*.2),TI.step(e)}function SD(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<fD)&&(e.ecosystem.lastUpdateTime=e.time,vD(e))}function ID(){return TI.getStats()}function TD(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function AD(e){const{gameState:t}=e,n=t.time,o=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of o)switch(a.type){case"ranged-impact":{const c=t.entities.entities[a.data.targetId];if(!c||c.hitpoints<=0)continue;c.hitpoints-=a.data.damage,c.movementSlowdown={modifier:pu,endTime:t.time+gu};const d=Le(a.data.attackerPosition,c.position,t.mapDimensions.width,t.mapDimensions.height),u=ut(d,a.data.pushbackForce);c.forces.push(u),Oe(t,Se.Hit,c.position,We,c.id),c.hitpoints<=0?Ce(e,Ie.HumanDeath,c.position):Ce(e,Ie.Attack,c.position);break}}}const AI="ownedIndices",wy="frontierScanIndex",ka="frontierCandidates";function ED(e){const{gameState:t}=e,n=t,s=n.search.human.all().filter(h=>h.leaderId===h.id),{width:a,height:c}=t.mapDimensions,d=Math.ceil(a/Ae),u=Math.ceil(c/Ae);for(const h of s){if(!h.aiBlackboard)continue;const p=De.get(h.aiBlackboard,AI)||[];if(p.length===0)continue;let y=De.get(h.aiBlackboard,wy)||0;const S=De.get(h.aiBlackboard,ka)||{},v=Kn(h.id,t),A=20;for(let E=0;E<A;E++){y>=p.length&&(y=0);const _=p[y];y=(y+1)%p.length;const w=_%d,P=Math.floor(_/d),R=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:C,dy:k}of R){const D=(w+C+d)%d,F=(P+k+u)%u,W=F*d+D,Y=t.terrainOwnership[W],G=Y!==null&&Yi(h.id,Y,t);if(Y===null||G){let j=0;for(const{dx:x,dy:ae}of R){const ue=(D+x+d)%d,Me=(F+ae+u)%u;t.terrainOwnership[Me*d+ue]===h.id&&j++}const ee=j*20,V=dh(W,a),te=n.search.berryBush.byRadius(V,100),re=n.search.tree.byRadius(V,100),ie=te.length*10+re.length*5,z=G?50:0,Q=X(V,v,a,c)/100*5,O=ee+ie+z-Q;S[W.toString()]={score:O,fromIdx:_,lastSeenTime:t.time}}}}const I=Object.entries(S).sort((E,_)=>_[1].score-E[1].score);if(I.length>50){const E={};for(let _=0;_<50;_++){const[w,P]=I[_];E[w]=P}De.set(h.aiBlackboard,ka,E)}else De.set(h.aiBlackboard,ka,S);De.set(h.aiBlackboard,wy,y)}}function wD(e,t,n){const o=[],s=new Set,a=150*150;for(let c=0;c<e.length;c++){if(s.has(c))continue;const d=[e[c]];s.add(c);const u=[e[c]];for(;u.length>0;){const h=u.shift();for(let p=0;p<e.length;p++){if(s.has(p))continue;bt(h.position,e[p].position,t,n)<a&&(s.add(p),d.push(e[p]),u.push(e[p]))}}o.push(d)}return o}function _D(e,t,n){const{gameState:o}=n,s=o,{width:a,height:c}=o.mapDimensions,d=Math.ceil(a/Fe),u=Math.ceil(c/Fe),h=t.filter(y=>y.buildingType===Z.Bonfire||y.buildingType===Z.StorageSpot),p=wD(h,a,c);for(const y of p){if(y.length===0)continue;const S=y[0].position,v=Qc(S,a,c);let A=0,I=0,E=0,_=0;for(const G of y){const j=Le(S,G.position,a,c),ee=Math.round(j.x/Fe),V=Math.round(j.y/Fe);A=Math.min(A,ee),I=Math.max(I,ee),E=Math.min(E,V),_=Math.max(_,V)}const w=12,P=A-w,R=I+w,C=E-w,k=_+w,D=[],F=(G,j)=>{const ee=(v.x+G+d)%d,V=(v.y+j+u)%u;D.push({x:ee*Fe+Fe/2,y:V*Fe+Fe/2})};for(let G=P;G<=R;G++)F(G,C),F(G,k);for(let G=C+1;G<k;G++)F(P,G),F(R,G);const W=Kn(e,o);D.sort((G,j)=>{const ee=bt(G,W,a,c),V=bt(j,W,a,c);return ee-V});let Y=0;for(const G of D){const j=`${Math.floor(G.x)}-${Math.floor(G.y)}`,ee=s.search.building.at(G,Fe/2);if(ee){ee.buildingType===Z.Gate&&ee.ownerId===e?Y=1:Y++;continue}const V=Object.values(o.tasks).find(z=>(z.type===$.HumanPlacePalisade||z.type===$.HumanPlaceGate)&&bt(z.position,G,a,c)<5*5);if(V){V.type===$.HumanPlaceGate?Y=1:Y++;continue}const te=s.search.tree.byRadius(G,Fe/2);if(te.length>0){const z=te[0],ne=`Chop-Gord-${z.id}`;o.tasks[ne]||(o.tasks[ne]={id:ne,type:$.HumanChopTree,position:z.position,creatorEntityId:e,target:z.id,validUntilTime:o.time+12});continue}const re=Y===0||Y>=15?$.HumanPlaceGate:$.HumanPlacePalisade,ie=`${$[re]}-${e}-${j}`;o.tasks[ie]={id:ie,type:re,position:G,creatorEntityId:e,target:G,validUntilTime:o.time+24},re===$.HumanPlaceGate?Y=1:Y++}}}function CD(e){var y;const{gameState:t}=e,n=t,o=n.search.human.all(),s=new Map,a=new Set;for(let S=0;S<o.length;S++){const v=o[S];v.leaderId&&(s.has(v.leaderId)||s.set(v.leaderId,[]),s.get(v.leaderId).push(v),v.leaderId===v.id&&a.add(v.id))}const c=Object.values(t.tasks),d=new Map;for(let S=0;S<c.length;S++){const v=c[S];v.creatorEntityId&&(d.has(v.creatorEntityId)||d.set(v.creatorEntityId,[]),d.get(v.creatorEntityId).push(v))}const u=n.search.building.all(),h=new Map;for(let S=0;S<u.length;S++){const v=u[S];if(v.ownerId){const A=t.entities.entities[v.ownerId],I=A==null?void 0:A.leaderId;I&&(h.has(I)||h.set(I,[]),h.get(I).push(v))}}const p=new Map;for(const S of a)p.set(S,Kn(S,t));for(const S of a){const v=t.entities.entities[S];if(!v)continue;const A=[];for(let G=0;G<t.terrainOwnership.length;G++)t.terrainOwnership[G]===S&&A.push(G);De.set(v.aiBlackboard,AI,A);const I=s.get(S)||[];if(I.length<RS)continue;const E=I.filter(G=>G.isAdult);if(E.length===0)continue;const _=d.get(S)||[],w=G=>_.some(j=>j.type===G),P=h.get(S)||[];_D(S,P,e);const R=[];for(const[G,j]of p.entries())G!==S&&R.push(j);if(!w($.HumanPlaceStorage)){const G=P.filter(re=>re.buildingType===Z.StorageSpot);let j=0,ee=0;for(let re=0;re<G.length;re++){const ie=G[re];j+=((y=ie.storedItems)==null?void 0:y.length)||0,ee+=ie.storageCapacity||0}const V=ee>0?j/ee:0;if(G.length===0||V>g1){const re=G.length===0?v1:Df,ie=bf(Z.StorageSpot,S,t,kf,re,v.position,R);ie&&Ac(S,$.HumanPlaceStorage,ie,t)}}if(!w($.HumanPlaceBonfire)){const G=P.filter(z=>z.buildingType===Z.Bonfire),j=p.get(S),V=za(t.temperature,j,t.time,t.mapDimensions.width,t.mapDimensions.height)<F1&&G.length===0,te=G.length>0&&G.length<Math.ceil(E.length/x1);let re;const ie=I.filter(z=>za(t.temperature,z.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<Jo+5?G.every(O=>X(z.position,O.position,t.mapDimensions.width,t.mapDimensions.height)>wa*1.5):!1);if(ie.length>=3){const z=ie.reduce((Q,O)=>Q+O.position.x,0)/ie.length,ne=ie.reduce((Q,O)=>Q+O.position.y,0)/ie.length;re={x:z,y:ne}}if(V||te||re){const z=bf(Z.Bonfire,S,t,kf,Df,re||v.position,R);z&&Ac(S,$.HumanPlaceBonfire,z,t)}}if(!w($.HumanPlacePlantingZone)){const j=P.filter(V=>V.buildingType===Z.PlantingZone&&Q_(V,t)).reduce((V,te)=>V+AS(te),0),ee=Math.max(y1,E.length*m1);if(j<ee){const V=bf(Z.PlantingZone,S,t,kf,Df,v.position,R);V&&Ac(S,$.HumanPlacePlantingZone,V,t)}}const C=De.get(v.aiBlackboard,ka)||{},{width:k,height:D}=t.mapDimensions,F=P.filter(G=>G.buildingType===Z.BorderPost),W=_.filter(G=>G.type===$.HumanPlaceBorderPost);for(const G in C){const j=parseInt(G,10),ee=t.terrainOwnership[j],V=ee!==null&&Yi(v.id,ee,t);if(ee===S||ee!==null&&!V){delete C[G];continue}const te=dh(j,k);(F.some(ie=>bt(te,ie.position,k,D)<100*100)||W.some(ie=>bt(te,ie.position,k,D)<100*100))&&delete C[G]}De.set(v.aiBlackboard,ka,C);const Y=3;if(W.length<Y){const G=Object.entries(C).map(([te,re])=>({idx:parseInt(te,10),...re})).sort((te,re)=>re.score-te.score),j=[];for(const te of G){if(j.length>=Y-W.length)break;const re=dh(te.idx,k);j.every(z=>bt(re,z,k,D)>100*100)&&j.push(re)}const ee=new Set(W.map(te=>{const re=te.id.split("-");return parseInt(re[re.length-1],10)}).filter(te=>!isNaN(te))),V=[];for(let te=0;te<Y;te++)ee.has(te)||V.push(te);for(let te=0;te<j.length;te++)Ac(S,$.HumanPlaceBorderPost,j[te],t,V[te])}}}function Ac(e,t,n,o,s=0){const a=`${$[t]}-${e}-${s}`;o.tasks[a]={id:a,position:n,type:t,creatorEntityId:e,target:n,validUntilTime:o.time+12}}function PD(e){const{gameState:t}=e,s=t.search.human.all().filter(a=>a.leaderId===a.id);for(const a of s){if(!a.aiBlackboard)continue;const c=`diplomacy-${a.id}`;if(t.tasks[c])continue;const d=De.get(a.aiBlackboard,"lastDiplomacyCheckTime")??-1/0;if(t.time-d<$0)continue;const u={id:c,type:$.HumanDiplomacy,position:a.position,creatorEntityId:a.id,validUntilTime:t.time+$0};t.tasks[c]=u}}function RD(e,t){var s;const o=e.pathfindingQueue.splice(0,10);for(const a of o){const c=e.entities.entities[a];if(c&&c.type==="human"&&c.target){let d;if(typeof c.target=="object"?d=c.target:d=(s=e.entities.entities[c.target])==null?void 0:s.position,d){const u=xC(e,c.position,d,c);if(u)c.path=u,c.pathTarget={...d};else{const{width:h,height:p}=e.mapDimensions,y=Le(c.position,d,h,p),S=Math.sqrt(y.x*y.x+y.y*y.y),v=Math.ceil(S/(Fe/2)),A=y.x/v,I=y.y/v;for(let E=1;E<Math.min(v,40);E++){const _={x:c.position.x+A*E,y:c.position.y+I*E},w=FS(_,h,p);if(e.navigationGrid.staticObstacles[w]){const P=e.navigationGrid.gateOwners[w];if(P!==null&&P===c.leaderId)continue;const R=e.search.building.at(_,Fe*1.5);if(R&&(R.buildingType===Z.Palisade||R.buildingType===Z.Gate)&&R.ownerId!==c.leaderId){const C=`Breach-${c.id}`;e.tasks[C]||(e.tasks[C]={id:C,type:$.HumanAttackBuilding,position:R.position,creatorEntityId:c.id,target:R.id,validUntilTime:e.time+.5,claimedByEntityId:c.id});break}}}}}}}}const MD=1/60;function kD(e,t){if(!e.cameraFollowingPlayer)return;const n=wt(e);n&&(e.viewportCenter=Fc(e.viewportCenter,n.position,$c*t))}function Cu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(Rh(e),e.lastAutosaveTime=n)}for(;t>0;){const n=iu(e),o=Math.min(t,MD),s=o*(Dt/Lt);n.time+=s,kD(n,o),l1(n),lR(n),SD(n),rC(n),eR(n),c1(n),AD({gameState:n}),ak({gameState:n,deltaTime:o}),sD({gameState:n,deltaTime:o}),ED({gameState:n}),RD(n),Math.floor(n.time)>Math.floor(n.time-s)&&(q_(n),CD({gameState:n}),PD({gameState:n})),yI(n),gk(n,o),TD(n),e=n,t-=o}return e}function jf(e,t,n){e.save();const{x:o,y:s,width:a,height:c}=t.rect,d=lS;if(e.beginPath(),e.moveTo(o+d,s),e.lineTo(o+a-d,s),e.quadraticCurveTo(o+a,s,o+a,s+d),e.lineTo(o+a,s+c-d),e.quadraticCurveTo(o+a,s+c,o+a-d,s+c),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),e.lineTo(o,s+d),e.quadraticCurveTo(o,s,o+d,s),e.closePath(),e.fillStyle=t.isDisabled?cS:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*hS)+1)/2;e.strokeStyle=fS,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<Vc){const h=1-u/Vc;e.fillStyle=dS,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Zh,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?uS:t.textColor,t.icon?(e.font=`${c*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+a/2,s+c/2),t.text&&(e.font=`${c*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+a-4,s+c-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+a/2,s+c/2)),e.restore()}function DD(e,t,n,o){e.save(),e.font=`${q0}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,c=q0,d=a+Z0*2,u=c+Z0*2,h=o.x-d/2,p=e.canvas.height,y=t.y<p/2?t.y+t.height-K0:t.y-u+K0;e.fillStyle=h_,e.fillRect(h,y,d,u),e.fillStyle=p_,e.fillText(n,o.x,y+u/2+c/2),e.restore()}function bD(e,t,n){e.save();const o=wt(t),s=[{id:"fastForwardButton",action:fe.FastForward,text:"FFWD [T]",currentWidth:Ni*1.3,backgroundColor:In,textColor:Et,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:fe.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?ya:In,currentWidth:t.isPaused?Ni*1.4:Ni*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:Et},{id:"muteButton",action:fe.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?ya:In,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:Ni,rect:{x:0,y:0,width:0,height:0},textColor:Et},{id:"returnToIntroButton",action:fe.ReturnToIntro,text:"EXIT",backgroundColor:In,tooltip:"Return to Main Menu [ESC]",currentWidth:Ni*.9,rect:{x:0,y:0,width:0,height:0},textColor:Et}];if(t.uiButtons.push(...s),o){const h=op(t,o),p=new Set(h.map(w=>w.type));let y=[{playerAction:de.Gather,buttonAction:fe.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>o.isAdult===!0},{playerAction:de.Eat,buttonAction:fe.CommandEat,shortcut:"F",name:"Eat"},{playerAction:de.Plant,buttonAction:fe.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>o.isAdult===!0},{playerAction:de.Procreate,buttonAction:fe.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>o.isAdult===!0},{playerAction:de.FeedChild,buttonAction:fe.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>o.isAdult===!0},{playerAction:de.Attack,buttonAction:fe.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>o.isAdult===!0&&o.leaderId===o.id},{playerAction:de.TribeSplit,buttonAction:fe.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>o.leaderId!==void 0&&o.leaderId!==o.id&&o.isAdult===!0},{playerAction:de.Build,buttonAction:fe.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>o.isAdult===!0&&o.leaderId===o.id&&Co(o.id,t).length>RS}];y=y.filter(w=>w.condition?w.condition():!0);const S=1,v=y.length,A=v*yn+(v-1)*jo,I=S*yn+(S-1)*jo,E=(n-A)/2,_=e.canvas.height-I-20;if(y.forEach((w,P)=>{const R=P%v,C=Math.floor(P/v),k=E+R*(yn+jo),D=_+C*(yn+jo),F=!!w.toggleKey,W=F&&t.autopilotControls.behaviors[w.toggleKey],Y=!p.has(w.playerAction),j=w.playerAction===de.Build&&t.buildMenuOpen,ee=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",V=F?`${w.name}${ee}`:w.name,te=W||j?ya:In,re={id:`commandButton_${w.name}`,action:w.buttonAction,rect:{x:k,y:D,width:yn,height:yn},icon:Su[w.playerAction],text:w.shortcut,backgroundColor:te,textColor:Et,currentWidth:yn,tooltip:V,isDisabled:Y,activated:W||w.buttonAction===fe.CommandBuild&&j};t.uiButtons.push(re)}),t.buildMenuOpen){const w=[{id:"buildMenu_storageSpot",action:fe.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:fe.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_palisade",action:fe.SelectPalisade,icon:"",shortcut:"3",name:"Palisade"},{id:"buildMenu_bonfire",action:fe.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:fe.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:fe.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"},{id:"buildMenu_gate",action:fe.SelectGate,icon:"",shortcut:"7",name:"Gate"}],P=w.length,R=P*yn+(P-1)*jo,C=(n-R)/2,k=_-yn-jo;w.forEach((D,F)=>{const W=C+F*(yn+jo),Y=k,G=D.action===fe.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||D.action===fe.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||D.action===fe.SelectPalisade&&t.selectedBuildingType==="palisade"||D.action===fe.SelectBorderPost&&t.selectedBuildingType==="borderPost"||D.action===fe.SelectBonfire&&t.selectedBuildingType==="bonfire"||D.action===fe.SelectRemovalTool&&t.selectedBuildingType==="removal"||D.action===fe.SelectGate&&t.selectedBuildingType==="gate",j={id:D.id,action:D.action,rect:{x:W,y:Y,width:yn,height:yn},icon:D.icon,text:D.shortcut,backgroundColor:G?ya:In,textColor:Et,currentWidth:yn,tooltip:D.name,activated:G};t.uiButtons.push(j),jf(e,j,t.hoveredButtonId===j.id)})}}let a=n-Ke;s.forEach(h=>{const p=Ke,y=a-h.currentWidth;h.rect={x:y,y:p,width:h.currentWidth,height:aS},jf(e,h,t.hoveredButtonId===h.id),a-=h.currentWidth+f_});let c=null;t.uiButtons.filter(h=>h.id.startsWith("commandButton_")||h.id.startsWith("buildMenu_")).forEach(h=>{c||(c={x:h.rect.x,y:h.rect.y,width:h.rect.width,height:h.rect.height}),c.x=Math.min(c.x,h.rect.x),c.y=Math.min(c.y,h.rect.y),c.width=Math.max(c.width,h.rect.x+h.rect.width-c.x),c.height=Math.max(c.height,h.rect.y+h.rect.height-c.y),h.id.startsWith("commandButton_")&&jf(e,h,t.hoveredButtonId===h.id)});const u=t.hoveredButtonId?t.uiButtons.find(h=>h.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&DD(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:c}}function OD(e){e.save(),e.fillStyle=g_,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=m_,e.font=`${y_}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function Ih(e,t,n,o){const s=t.x-n.width/2,a=t.y-n.height/2,c=s+e.x,d=a+e.y,u=(c%o.width+o.width)%o.width,h=(d%o.height+o.height)%o.height;return{x:u,y:h}}function il(e,t,n,o){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>o.width/2&&(s=s-Math.sign(s)*o.width),Math.abs(a)>o.height/2&&(a=a-Math.sign(a)*o.height),{x:s+n.width/2,y:a+n.height/2}}function Da(e,t,n,o){const s=il(e.position,t,n,o),c=("radius"in e?e.radius:20)+20;return s.x>=-c&&s.x<=n.width+c&&s.y>=-c&&s.y<=n.height+c}function bn(e,t,n,o,s,...a){const c={...s.position};for(let d=-n;d<=n;d+=n)for(let u=-t;u<=t;u+=t)s.position.x=c.x+u,s.position.y=c.y+d,o(e,s,...a);s.position=c}function EI(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const o=n.getContext("2d");if(!o)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:n,ctx:o}}function qn(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function fr(e,t){return Math.round(e*t)/t}function up(e,t=8){const o=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(o/(Math.PI*2)*t)%t}function dp(e,t=8){const n=e/t*Math.PI*2;return[Math.cos(n),Math.sin(n)]}const ND=25,BD=0,_y=28;function wI(e,t,n,o,s,a,c,d,u,h){e.save();const{x:p,y}=il(t,c,{width:d,height:u},h);e.strokeStyle=o,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(p,y,n+mu,0,2*Math.PI),e.stroke(),e.restore()}function HD(e,t,n,o,s,a,c){if(t.length===0)return;e.save(),t.forEach(y=>{y.targetEntity&&wI(e,y.targetEntity.position,y.targetEntity.radius,Vh,qh,2,o,s,a,c)}),e.font=`${as}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:d,y:u}=il(n.position,o,{width:s,height:a},c);let h=0,p={};t.forEach(y=>{const S=Su[y.type];if(y.targetEntity){p[y.targetEntity.id]=(p[y.targetEntity.id]||0)+1;const v=y.targetEntity.position.x-o.x+s/2,A=y.targetEntity.position.y-o.y+a/2,I=`${S}${y.key.toUpperCase()}`,E=A-y.targetEntity.radius-mu-as/2-(p[y.targetEntity.id]-1)*_y;e.fillText(I,v,E)}else{e.textAlign="left";const v=`${S}${y.key.toUpperCase()}`,A=d+ND,E=u+BD+h*_y;e.fillText(v,A,E),h++,e.textAlign="center"}}),e.restore()}function FD(e,t,n,o,s,a,c){const h=Hf+8+30,p={x:ny,y:a-ny-h,width:Hf,height:Hf};t.minimapRect=p,e.save(),e.fillStyle=$_,e.fillRect(p.x,p.y,p.width,p.height),e.strokeStyle=x_,e.lineWidth=2,e.strokeRect(p.x,p.y,p.width,p.height);const{width:y,height:S}=t.mapDimensions,v=Math.ceil(y/Ae),A=Math.ceil(S/Ae),I=new Map;o.forEach((le,Ee)=>{const _e=le.isPlayerTribe?0:Ee%(Ut.length-1)+1;I.set(le.leaderId,Ut[_e])});const E=p.width/v,_=p.height/A,w=p.x+p.width/2,P=p.y+p.height/2,R=v>400?4:v>200?2:1;for(let le=0;le<A;le+=R)for(let Ee=0;Ee<v;Ee+=R){const _e=le*v+Ee,se=t.terrainOwnership[_e];if(se!==null){const pe=(Ee+.5)*Ae,Ne=(le+.5)*Ae,we=Le(n,{x:pe,y:Ne},y,S),Tn=w+we.x/y*p.width,et=P+we.y/S*p.height,Ze=t.hoveredMinimapTribeId===se;if(e.fillStyle=I.get(se)||"#888",Ze){const An=(Math.sin(t.time*5)+1)/2;e.globalAlpha=.6+An*.4}else e.globalAlpha=.8;e.fillRect(Tn-E*R/2,et-_*R/2,E*R,_*R)}}e.globalAlpha=1,e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip();for(const le of o){if(!le.territoryCenter)continue;const Ee=Le(n,le.territoryCenter,y,S),_e=w+Ee.x/y*p.width,se=P+Ee.y/S*p.height;e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="white",e.fillText(le.tribeBadge,_e,se),le.isPlayerTribe&&(e.strokeStyle="gold",e.lineWidth=1,e.beginPath(),e.arc(_e,se,10,0,Math.PI*2),e.stroke())}e.restore();const C=s/c,k=a/c,D=C/y*p.width,F=k/S*p.height;e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.strokeRect(w-D/2,P-F/2,D,F),e.restore(),e.restore();const W=p.y+p.height+8,Y=p.x,G=W,j="recenter_camera_btn",ee={id:j,action:fe.RecenterCamera,rect:{x:Y,y:G,width:30,height:30},text:"",currentWidth:30,backgroundColor:t.cameraFollowingPlayer?ya:In,textColor:Et,tooltip:"Lock camera to player"};t.uiButtons.push(ee),e.fillStyle=t.hoveredButtonId===j?"#4a5568":ee.backgroundColor,e.fillRect(Y,G,30,30),e.strokeStyle="#666",e.strokeRect(Y,G,30,30);const V=Y+30/2,te=G+30/2,re=30*.35;e.strokeStyle=Et,e.lineWidth=2,e.beginPath(),e.arc(V,te,re,0,Math.PI*2),e.stroke();const ie=re*.6;e.beginPath(),e.moveTo(V-ie,te),e.lineTo(V+ie,te),e.moveTo(V,te-ie),e.lineTo(V,te+ie),e.stroke(),e.fillStyle=Et,e.beginPath(),e.arc(V,te,2,0,Math.PI*2),e.fill();const z="open_tribe_modal_btn",ne=`Tribes (${o.length})`;e.font='10px "Press Start 2P", Arial';const Q=e.measureText(ne),O=Math.max(30,Q.width+16),x=30,ae=Y+30+8,ue=W,Me={id:z,action:fe.OpenTribeModal,rect:{x:ae,y:ue,width:O,height:x},text:ne,currentWidth:O,backgroundColor:In,textColor:Et,tooltip:"View all tribes and diplomacy"};t.uiButtons.push(Me),e.fillStyle=t.hoveredButtonId===z?"#4a5568":In,e.fillRect(ae,ue,O,x),e.strokeStyle="#666",e.strokeRect(ae,ue,O,x),e.fillStyle=Et,e.textAlign="center",e.textBaseline="middle",e.fillText(ne,ae+O/2,ue+x/2)}const ke=(e,t,n,o,s,a,c)=>{a==="transparent"||o<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*c),Math.floor(n*c),Math.ceil(o*c),Math.ceil(s*c)))},Cy=10,Py=10,ui=6,Mi=4,Ec=2,LD=5,Dn=4,UD=2,zt=4,GD=2,st=3,$r=2,mo=0,ba=mo+Mi-1,Kt=ba,pt=ba+Dn-1,xD="rgba(0, 0, 0, 0.4)",$D=4,WD=1,fp={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,o,s,a,c,d="male",u=20,h=[1,0],p=!1,y=0){const S=["dead","stunned"].includes(c),v=S?Py+4:Cy,A=S?Cy+4:Py+st,I=.15,E=Math.min(o*(1-2*I)/v,s*(1-2*I)/A),_=v*E,w=A*E,P=t+(o-_)/2,R=n+(s-w)/2;e.save(),h[0]<0&&!S?(e.translate(P+_,R),e.scale(-1,1)):e.translate(P,R);const k="#D09A5A",D=u>50?"#BDBDBD":"#281808",F="#7F5C4A",W="#6B4F3A",Y="#E0D8C0",G="#A0522D",j=1-Math.max(0,Math.min(100,y))/100*.2,ee=d==="male"?1.1:.9,V=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let te=LD*j*ee*V,re=UD*j*ee*V,ie=GD*j*V;p&&d==="female"&&(te*=1.5);const z=Math.round((v-te)/2),ne=Math.round((v-ui)/2),Q=z-re,O=z+te,x=1,ae=z+(te/2-x/2)-ie,ue=z+(te/2+x/2),Me=h[1]<-.2&&Math.abs(h[0])<.7,le=se=>{e.fillStyle=xD,e.beginPath();const pe=v/2,Ne=se;e.ellipse(Math.floor(pe*E),Math.floor(Ne*E),Math.max(1,Math.floor($D*E)),Math.max(1,Math.floor(WD*E)),0,0,2*Math.PI),e.fill()},Ee=(se,pe)=>{d==="male"?(ke(e,z,ba+se,te,Dn-$r,pe,E),ke(e,z,ba+Dn-$r+se,te,$r,F,E)):ke(e,z,ba+se,te,Dn,W,E)},_e=(se,pe)=>{Me?ke(e,ne,mo+se,ui,Mi,D,E):(ke(e,ne,mo+se,ui,Mi,pe,E),ke(e,ne,mo+se,ui,Ec,D,E),d==="female"?(ke(e,ne-1,mo+Ec+se,1,Mi,D,E),ke(e,ne+ui,mo+Ec+se,1,Mi,D,E)):ke(e,ne+1,mo+2+se,ui-2,Mi-2,D,E))};switch(c){case"idle":{const se=a*Math.PI*2,pe=Math.sin(se)*.5,we=(Math.cos(se*2)+1)*.25;le(pt+st+1),ke(e,ae+pe,pt+we,ie,st,k,E),ke(e,ue-pe,pt+we,ie,st,k,E),Ee(we,k),ke(e,Q,Kt+we,re,zt,k,E),ke(e,O,Kt+we,re,zt,k,E),_e(we,k);break}case"walk":{const se=a*Math.PI*2,pe=Math.sin(se)*2,we=Math.abs(Math.cos(se))*1;le(pt+st+1),ke(e,ae+pe,pt+we,ie,st,k,E),ke(e,ue-pe,pt+we,ie,st,k,E),Ee(we,k),ke(e,Q-pe,Kt+we,re,zt,k,E),ke(e,O+pe,Kt+we,re,zt,k,E),_e(we,k);break}case"gathering":{const se=a*Math.PI*2,pe=1,Ne=(Math.sin(se)+1)/2*2,we=pe+Math.abs(Math.cos(se))*.5;le(pt+st+1),ke(e,ae,pt+we,ie,st-pe,k,E),ke(e,ue,pt+we,ie,st-pe,k,E),Ee(we,k),ke(e,Q+1,Kt+we-Ne,re,zt,k,E),ke(e,O-1,Kt+we-Ne,re,zt,k,E),_e(we,k);break}case"eat":{le(pt+st+1),ke(e,ae,pt+1,ie,st-1,k,E),ke(e,ue,pt+1,ie,st-1,k,E),Ee(1,k);const Ne=(Math.sin(a*Math.PI*4)+1)/2,we=ne+ui/2,Tn=mo+Mi/2,et=O+(we-O)*Ne,Ze=Kt+1+(Tn-(Kt+1))*Ne;ke(e,Q,Kt+1,re,zt,k,E),ke(e,et,Ze,re,zt,k,E),ke(e,et,Ze-1,1,1,G,E),_e(1,k);break}case"procreate":{const se=(Math.sin(a*Math.PI*8)+1)/4,pe=(Math.sin(a*Math.PI*6)+1)*.5,Ne=1.5,we=Ne-pe;le(pt+st+1),ke(e,ae,pt+we,ie,st-Ne,k,E),ke(e,ue,pt+we,ie,st-Ne,k,E),Ee(we,k),ke(e,Q,Kt+we,re,zt,k,E),ke(e,O,Kt+we,re,zt,k,E),_e(we,k),e.globalAlpha=se,Ee(we,"white"),e.globalAlpha=1;break}case"attacking":{const se=Math.sin(a*Math.PI)*1.5,pe=Math.abs(Math.sin(a*Math.PI));le(pt+st+1),ke(e,ae-se,pt+pe,ie,st,k,E),ke(e,ue+se*.5,pt+pe,ie,st,k,E),Ee(pe,k),ke(e,Q,Kt+pe-2,re,zt,k,E),ke(e,O,Kt+pe-2.5,re,zt,k,E),_e(pe,k);break}case"defending":{le(pt+st+1),ke(e,ae,pt+1,ie,st-1,k,E),ke(e,ue,pt+1,ie,st-1,k,E),Ee(1,k),ke(e,Q-1,Kt+1-1,re,zt,k,E),ke(e,O+1,Kt+1-1,re,zt,k,E),_e(1,k);break}case"stunned":case"dead":{const se=c==="dead",pe=se?Math.min(1,a):0,Ne=pe>.5?Y:k,we=d==="male"?F:W,Tn=pe>.8?"transparent":D,et=v/2,Ze=A/2,An=2;le(A-1),ke(e,et-ie-An,Ze,ie,st,Ne,E),ke(e,et+An,Ze,ie,st,Ne,E),ke(e,et-re-An,Ze-Dn+1,re,zt,Ne,E),ke(e,et+An,Ze-Dn+1,re,zt,Ne,E);const nn=et-te/2,En=Ze-Dn/2;d==="male"?(pe<.7&&ke(e,nn,En+Dn-$r,te,$r,we,E),ke(e,nn,En,te,Dn-$r,Ne,E)):pe<.7?ke(e,nn,En,te,Dn,we,E):ke(e,nn,En,te,Dn,Ne,E);const ni=et-ui/2,ii=Ze-Dn/2-Mi+1;if(ke(e,ni,ii,ui,Mi,Ne,E),Tn!=="transparent"&&ke(e,ni,ii,ui,Ec,Tn,E),se&&pe>.6){const zi="#B0A890";for(let Do=0;Do<3;Do++)ke(e,nn+1,En+Do*1+1,te-2,.5,zi,E)}break}default:ke(e,0,0,v,A,"magenta",E);break}e.restore()}};function YD(e,t,n,o,s){const a=t.x,c=t.y-n-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-o/2,c,o,o/2),e.fill(),e.beginPath(),e.moveTo(a-o/2,c),e.lineTo(a-o/4,c-o/3),e.lineTo(a-o/6,c),e.moveTo(a-o/6,c),e.lineTo(a,c-o/2),e.lineTo(a+o/6,c),e.moveTo(a+o/6,c),e.lineTo(a+o/4,c-o/3),e.lineTo(a+o/2,c),e.stroke(),e.restore()}function Xa(e,t,n,o,s,a=!1,c=!1,d=!1,u=!1){o<Fh&&(n=n*.75),fp.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,o,[0,0],!1,0);let h,p;a?(h=o_,p=iS):c?(h=r_,p=sS):d?(h=s_,p=rS):u&&(h=a_,p=oS),h&&p&&YD(e,t,n/2,h,p)}function zD(e,t,n,o,s,a){if(e.save(),o.length===0){e.restore();return}const c=o.length*s,d=4;let u;const h=c+(o.length-1)*d;o.length>1&&h>a?u=(a-c)/(o.length-1):u=d,o.length<=1&&(u=0);for(let p=0;p<o.length;p++){const{member:y,isPlayer:S,isHeir:v,isPartner:A,isParent:I}=o[p],E=t+p*(s+u)+s/2,_=n+s/4;Xa(e,{x:E,y:_},s,y.age,y.gender,S,v,A,I)}e.restore()}function jD(e,t,n,o,s){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,o,s);const a=500,c=Math.min(s*.8,n.length*(oa+X0)+120),d=(o-a)/2,u=(s-c)/2;e.fillStyle="#2d3748",e.strokeStyle="#4a5568",e.lineWidth=4,e.fillRect(d,u,a,c),e.strokeRect(d,u,a,c),e.fillStyle="#fff",e.font='20px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="top",e.fillText("WORLD TRIBES",o/2,u+30);const h=u+80,p=a-ra*4,y=d+ra*2;for(let w=0;w<n.length;w++){const P=n[w],R=h+w*(oa+X0);if(R+oa>u+c-60)break;const C=R+oa/2;P.isPlayerTribe&&(e.fillStyle="rgba(255, 215, 0, 0.2)",e.fillRect(y,R,p,oa));let k=y+ra;if(e.font=`${zo}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillStyle="white",e.fillText(P.tribeBadge,k,C),k+=zo+ra*2,P.isPlayerTribe)e.fillStyle="#aaa",e.font='10px "Press Start 2P", Arial',e.textAlign="left",e.fillText("(YOU)",k,C);else{const D=P.diplomacyStatus===At.Friendly?"":"",F=`modal_diplomacy_${P.leaderId}`,W={x:k,y:C-zo/2,width:zo*1.5,height:zo},Y={id:F,action:fe.ToggleDiplomacy,rect:W,text:"",icon:D,backgroundColor:"transparent",textColor:"white",currentWidth:W.width,tooltip:`Set status to ${P.diplomacyStatus===At.Friendly?"Hostile":"Friendly"}`,targetTribeId:P.leaderId};t.uiButtons.push(Y),t.hoveredButtonId===F&&(e.fillStyle=Zh,e.fillRect(W.x,W.y,W.width,W.height)),e.font=`${zo*.8}px Arial`,e.textAlign="center",e.fillText(D,W.x+W.width/2,C)}k+=zo*2+ra,Xa(e,{x:k+10,y:C},Di*.6,25,"male"),e.fillStyle="white",e.font=`${l_}px "Press Start 2P"`,e.fillText(`${P.adultCount}`,k+30,C),k+=80,Xa(e,{x:k+10,y:C},Di*.6,5,"female"),e.fillText(`${P.childCount}`,k+30,C)}const S=120,v=40,A=o/2-S/2,I=u+c-60,E="close_tribe_modal_btn",_={id:E,action:fe.CloseTribeModal,rect:{x:A,y:I,width:S,height:v},text:"CLOSE",currentWidth:S,backgroundColor:In,textColor:Et};t.uiButtons.push(_),e.fillStyle=t.hoveredButtonId===E?"#4a5568":In,e.fillRect(A,I,S,v),e.strokeStyle="#fff",e.strokeRect(A,I,S,v),e.fillStyle=Et,e.font='12px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="middle",e.fillText("CLOSE",o/2,I+v/2),e.restore()}function XD(e,t,n,o,s){const a=mS,c=yS,d=t+o-a-c,u=n+c;e.save(),e.lineWidth=2,e.strokeStyle=s?P_:C_,e.beginPath();const h=5;e.moveTo(d+h,u+h),e.lineTo(d+a-h,u+a-h),e.moveTo(d+a-h,u+h),e.lineTo(d+h,u+a-h),e.stroke(),e.restore()}function VD(e,t,n,o){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===en.INACTIVE)return;const c=a.steps[s.currentStepIndex];if(!c)return;e.save(),e.globalAlpha=s.transitionAlpha;const d=v_,u=S_,h=I_,p=`${Nf}px "Press Start 2P", Arial`,y=`${Q0}px "Press Start 2P", Arial`,S=A_,v=Q0*1.5;e.font=y;const A=c.text.split(" ");let I="";const E=[];for(let Y=0;Y<A.length;Y++){const G=I+A[Y]+" ";e.measureText(G).width>d-u*2&&Y>0?(E.push(I),I=A[Y]+" "):I=G}E.push(I);const _=u*2+Nf+u/2+E.length*v,w=(n-d)/2,P=o-_-160;e.fillStyle=T_,e.beginPath(),e.moveTo(w+h,P),e.lineTo(w+d-h,P),e.quadraticCurveTo(w+d,P,w+d,P+h),e.lineTo(w+d,P+_-h),e.quadraticCurveTo(w+d,P+_,w+d-h,P+_),e.lineTo(w+h,P+_),e.quadraticCurveTo(w,P+_,w,P+_-h),e.lineTo(w,P+h),e.quadraticCurveTo(w,P,w+h,P),e.closePath(),e.fill(),e.fillStyle=S,e.textAlign="center",e.textBaseline="top",e.font=p,e.fillText(c.title,w+d/2,P+u),e.font=y;let R=P+u+Nf+u/2;for(const Y of E)e.fillText(Y,w+d/2,R),R+=v;const C=t.hoveredButtonId==="tutorial-dismiss";XD(e,w,P,d,C),e.restore();const k=mS,D=yS,F=w+d-k-D,W=P+D;return{x:F,y:W,width:k,height:k}}function Xf(e,t,n){e.save();const o=__,s={x:t.x-o,y:t.y-o,width:t.width+o*2,height:t.height+o*2};e.strokeStyle=pS,e.lineWidth=gS+Math.sin(n*Kh)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function qD(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const _I=10,ZD=3,Ry=_I*.7;function KD(e,t){const{position:n,food:o,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,_I,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),o.length>0){const a=Math.PI*2/Math.min(o.length,s);for(let c=0;c<o.length;c++){const d=c*a,u=n.x+Ry*Math.cos(d),h=n.y+Ry*Math.sin(d);e.beginPath(),e.arc(u,h,ZD,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const My=(e,t,n=70,o=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${o}%)`},QD=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[o,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${o}, ${s}%, ${Math.max(0,a-t)}%)`},wc=(e,t,n,o,s,a,c,d=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=d?QD(c,15):c,e.beginPath(),e.roundRect(-o/2,0,o,s,o/2),e.fill(),e.restore()},Vf=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),o=75;if(!n)return`hsl(0, 0%, ${o}%)`;const[,s,a,c]=n.map(Number),d=a*(1-t),u=c+(o-c)*t;return`hsl(${s}, ${d}%, ${u}%)`},CI={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,o,s,a,c,d={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=o*.15,h=t+o/2,p=n+s/2,y=o-u*2,S=s-u*2,{gender:v,age:A,direction:I,isPregnant:E,hungryLevel:_,geneCode:w}=d,P=.8+Math.min(A,10)/10*.4,R=v==="male"?1.05:.95,C=1-_/100*.3,k=y*.5*C*P*R;let D=S*.3*P*R;const F=y*.15*P*R,W=k*.2,Y=S*.3,G=My(w,0,30,50);let j=My(w,8,50,40);if(A>45){const le=Math.min(1,(A-45)/15);j=Vf(j,le)}e.translate(h,p),I[0]<0&&e.scale(-1,1);const ee=Math.sin(a*Math.PI*2),V=Math.cos(a*Math.PI*2),te=Y+D*.2;if(c==="dead"){const le=Math.min(a,1);e.translate(0,S*.2),e.rotate(Math.PI/2);const Ee=Vf(j,le),_e=Vf(G,le);e.globalAlpha=.5+le*.5,e.strokeStyle=Ee,e.lineWidth=W*.5,e.beginPath(),e.moveTo(-k*.4,0),e.lineTo(k*.4,0),e.stroke();for(let se=-1;se<=1;se+=1)e.beginPath(),e.arc(0,0,D*.4,Math.PI*.4*se-Math.PI*.2,Math.PI*.4*se+Math.PI*.2),e.stroke();e.fillStyle=_e,e.beginPath(),e.arc(k*.5,0,F,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(k*.55,0,F*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,te,k*.7,k*.25,0,0,2*Math.PI),e.fill();let re=0,ie=0,z=0,ne=0,Q=0,O=0;switch(c){case"idle":ie=ee*(S*.02),z=ee*.05,ne=-ee*.05,Q=-ee*.05,O=ee*.05;break;case"walk":ie=Math.abs(V)*(S*-.04),z=ee*.7,ne=-ee*.7,Q=-ee*.7,O=ee*.7;break;case"eat":re=S*.1,ie=S*.05,re+=ee*(S*.02);break;case"procreate":ie=S*.05;const le=(1-V)*-y*.05;e.translate(le,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}E&&v==="female"&&(D*=1.6);const x=ie,ae=x-D*.2;wc(e,k*-.35,ae,W,Y,Q,j,!0),wc(e,k*.35,ae,W,Y,O,j,!0),e.fillStyle=j,e.beginPath(),e.ellipse(0,x,k/2,D/2,0,0,2*Math.PI),e.fill();const ue=k*.45,Me=ae+re;e.fillStyle=G,e.beginPath(),e.arc(ue,Me,F,0,Math.PI*2),e.fill(),I[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(ue+F*.3,Me-F*.2,F*.15,0,Math.PI*2),e.fill()),wc(e,k*-.35,ae,W,Y,z,j),wc(e,k*.35,ae,W,Y,ne,j),e.restore()}};function JD(e,t){let[n,o,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),o=Math.max(0,o-t),s=Math.max(0,s-t),`rgb(${n}, ${o}, ${s})`}function eb(e){const t=(e&16711680)>>16,n=(e&65280)>>8,o=e&255,s=`rgb(${t}, ${n}, ${o})`,a=JD(s,40),c=(e&255)%100+50,d=(e>>8&255)%100,u=(e>>16&255)%100,h=`rgb(${c}, ${d}, ${u})`,p=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:h,eyeColor:p}}const PI={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,o,s,a,c,d={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:h,direction:p,isPregnant:y,hungryLevel:S,geneCode:v}=d;e.save();const A=o*.15,I=Math.max(1,Math.floor((o-A*2)/10)),E=p[0]<0;e.translate(t+o/2,n+s/2),E&&e.scale(-1,1);const _=eb(v),w=.8+Math.min(h,20)/20*.4,P=u==="male"?1.05:.95,R=1-S/100*.25,C=w*P*R,k=Math.max(0,Math.min(1,(h-15)/5));e.filter=`grayscale(${k})`;const D=_.furColor,F=_.darkerFurColor,W=_.eyeColor,Y="#FFFFFF",G="#c75c5c",j="#E0E0E0",ee="#A0A0A0",V=s/2-2*I,te=Math.sin(a*Math.PI*2),re=Math.abs(te);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,V,I*4,I,0,0,2*Math.PI),e.fill(),e.filter="none",c==="dead"){const et=Math.min(1,a*2);e.save(),e.translate(0,V-I*3),e.rotate(-Math.PI/2);const Ze=(An,nn,En,ni,ii=!1)=>{e.fillStyle=ii?ee:j,e.fillRect(An*I,nn*I,En*I,ni*I)};et<1&&(e.globalAlpha=1-et,e.fillStyle=D,e.beginPath(),e.ellipse(0,0,I*3,I*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),et>0&&(e.globalAlpha=et,Ze(-1,-4,2,2),Ze(1,-3.5,1,1,!0),Ze(-.5,-2,1,5,!0),Ze(-2.5,-1,5,.5),Ze(-2.5,0,5,.5),Ze(-2.5,1,5,.5),Ze(-3,-2,-1,2,!0),Ze(3,-2,1,2),Ze(-3,2,-1,2,!0),Ze(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=D;let ie=0,z=0,ne=0,Q=[0,0,0,0];switch(c){case"idle":ie=te*I*.1;break;case"walk":const et=Math.sin(a*Math.PI*4);ie=Math.abs(et)*-I*.5,Q=[et*I,-et*I,-et*I,et*I];break;case"attacking":const Ze=Math.sin(a*Math.PI*4);z=I*2+Ze*I,ne=I*2,ie=I;break;case"eat":ne=I*3+re*I,ie=I*1.5,e.fillStyle=G,e.fillRect(-I,V-I,I*2,I);break;case"procreate":ie=Math.sin(a*Math.PI*8)*I*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let nn=0;nn<5;nn++){const En=(Math.random()-.5)*I*8,ni=V+(Math.random()-.5)*I*2;re>.5&&e.fillRect(En,ni,I*.5,I*.5)}break}const O=I*3*C*(y?1.3:1),x=I*5*C,ae=-x/1.5,ue=V-O-I*2.5+ie;e.fillStyle=D,e.beginPath(),e.moveTo(ae-I*.5,ue+O*.5),e.quadraticCurveTo(ae-I*3,ue-I,ae-I*2+te*I,ue+O+I),e.fill();const Me=I*1.2*C,le=I*3*C,Ee=I*2.5*C,_e=ae+x*.8,se=ae+x*.2;e.fillStyle=F,e.fillRect(se,V-Ee,Me,Ee+Q[2]),e.fillRect(_e,V-le,Me,le+Q[0]),e.fillStyle=D,e.beginPath(),e.moveTo(ae,ue+O),e.lineTo(ae,ue+I),e.quadraticCurveTo(ae+x/2,ue,ae+x,ue+I),e.lineTo(ae+x,ue+O),e.fill(),e.fillStyle=D,e.fillRect(se+I/2,V-Ee,Me,Ee+Q[3]),e.fillRect(_e+I/2,V-le,Me,le+Q[1]);const pe=I*3.5*C,Ne=ae+x-pe*.3+z,we=ue-pe*.3+ne;e.fillStyle=D,e.beginPath(),e.arc(Ne,we,pe/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(Ne+pe*.4,we+pe*.2,I*1.5,I,0,0,Math.PI*2),e.fill(),p[1]>=0&&(e.fillStyle=W,e.fillRect(Ne+I*.5,we-I*.5,I*.5,I*.5),c==="attacking"&&(e.fillStyle=Y,e.fillRect(Ne+pe*.5,we+pe*.4,I,I*.4))),e.fillStyle=F,e.beginPath(),e.moveTo(Ne-pe*.4,we-pe*.3),e.lineTo(Ne,we-pe*.7),e.lineTo(Ne,we-pe*.2),e.fill(),e.restore()}};class ol{constructor(t=200){Ht(this,"cache",new Map);Ht(this,"maxSize");this.maxSize=t}getOrRender(t,n,o,s){const a=this.cache.get(t);if(a)return this.cache.delete(t),this.cache.set(t,a),a;const{canvas:c,ctx:d}=EI(n,o);if(s(d),this.cache.size>=this.maxSize){const u=this.cache.keys().next().value;u!==void 0&&this.cache.delete(u)}return this.cache.set(t,c),c}clear(){this.cache.clear()}}const tb=9,nb=new ol(200);function ib(e,t){const{position:n,gender:o,age:s,decayProgress:a,food:c,radius:d,originalEntityType:u,geneCode:h}=t,p=fr(a,20),y=Math.floor(s),S=`${u}_${o}_${y}_${p}_${d}_${h||0}`,v=Math.ceil(d*2)+4,A=nb.getOrRender(S,v,v,I=>{I.translate(v/2,v/2),u==="human"?fp.render(I,-v/2+2,-v/2+2,v-4,v-4,p,"dead",o,y,[0,0],!1,0):u==="prey"?CI.render(I,-v/2+2,-v/2+2,v-4,v-4,p,"dead",{gender:o,age:y,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024}):u==="predator"&&PI.render(I,-v/2+2,-v/2+2,v-4,v-4,p,"dead",{gender:o,age:y,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024})});if(e.save(),e.globalAlpha=1-a,e.drawImage(A,n.x-A.width/2,n.y-A.height/2),e.restore(),c.length>0){e.save(),e.font=`${tb}px Arial`,e.textAlign="center",e.textBaseline="middle";const I=gt*.9,E=Math.PI/$v*3;c.forEach((_,w)=>{const P=w*E,R=n.x+I*Math.cos(P)*Math.atan2(w,w),C=n.y+I*Math.sin(P)*Math.atan2(w,w),k=Bh[_.type];e.fillText(k,R,C)}),e.restore()}}function To(e,t,n,o,s,a,c,d){e.save(),e.fillStyle=c,e.fillRect(t,n,o,s),e.fillStyle=d,e.fillRect(t,n,o*Math.max(0,a),s),e.restore()}function ob(e,t,n,o,s,a){if(e.save(),o.length===0){e.restore();return}const c=o.length*s;let d;c>a||c+(o.length-1)*4>a?d=(a-c)/(o.length-1):d=4,o.length===1&&(d=0);for(let u=0;u<o.length;u++){const h=Bh[o[u].type];e.fillText(h,t+u*(s+d),n)}e.restore()}function rb(e,t,n,o,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let c,d=gt/2;const u=Su[a.action],h=CS[a.action],p=`${u} ${h}`;if("targetEntityId"in a){const y=t.entities.entities[a.targetEntityId];y&&(c=y.position,d=y.radius)}else"position"in a&&(c=a.position);if(c){wI(e,c,d,Vh,qh,2,n,o,s,t.mapDimensions),e.save(),e.font=`${as}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:y,y:S}=il(c,n,{width:o,height:s},t.mapDimensions),v=S-d-mu-as/2;e.fillText(p,y,v),e.restore()}}function sb(e,t,n,o,s){e.save();const a=(Math.sin(s*Kh)+1)/2,c=n+mu+a*5;e.strokeStyle=Vh,e.lineWidth=2,e.setLineDash(qh),e.beginPath(),e.arc(t.x,t.y,c,0,Math.PI*2),e.stroke(),e.setLineDash([]);const d=Su[o],u=CS[o];if(d){e.font=`${as*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const h=t.y-c-25;e.fillText(d,t.x,h),e.font=`${as*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,h+25)}e.restore()}function ab(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(wt(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const c=t.entities.entities[n.targetEntityId];c&&(s=c.position,a=c.radius||(c.type==="building"?20:30))}if(s){const c=(d,u)=>{sb(d,u.position,a,n.action,t.time)};bn(e,t.mapDimensions.width,t.mapDimensions.height,c,{position:{...s}},s,a+30)}}}function ky(e,t,n,o,s,a,c=!0){const d=t.split(" ");let u="";const h=[];for(let p=0;p<d.length;p++){const y=u+d[p]+" ";e.measureText(y).width>s&&p>0?(h.push(u),u=d[p]+" "):u=y}if(h.push(u),c)for(let p=0;p<h.length;p++)e.fillText(h[p],n,o+p*a);return h.length*a}function lb(e){return 1-Math.pow(1-e,3)}function cb(e,t,n,o){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(c=>!c.isDismissed);if(s.length===0)return;e.save();let a=o-H_;for(const c of s){const d=n-vc-Xo;e.font=`${Bf}px "Press Start 2P", Arial`;const u=d+Xo,h=vc-Xo*2,p=ky(e,c.message,-9999,-9999,h,Bf*1.2,!1),y=Xo*2+p+ci,S=a-y,v=Date.now()-c.creationTime,A=Math.min(v/B_,1),I=lb(A),E=o,_=E+(S-E)*I;e.fillStyle=M_,e.beginPath(),e.roundRect(d,_,vc,y,R_),e.fill(),e.fillStyle=k_,e.textBaseline="top",ky(e,c.message,u,_+Xo,h,Bf*1.2,!0);const w=_+y-ci-Xo/2,P=d+vc-ci-Xo/2,R={x:P,y:w,width:ci,height:ci};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[c.id]=R);const C=t.hoveredButtonId===`notification-dismiss-${c.id}`;if(e.fillStyle=C?ty:D_,e.font=`${ci}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",R.x+R.width/2,R.y+R.height/2),c.targetEntityIds||c.targetPosition||c.targetArea||c.targetRadius){const F={x:P-ci-ey,y:w,width:ci,height:ci};t.notificationButtonRects&&(t.notificationButtonRects.view[c.id]=F);const W=t.hoveredButtonId===`notification-view-${c.id}`;e.fillStyle=W?ty:b_,e.font=`${ci*(W?1.5:1.2)}px Arial`,e.fillText("",F.x+F.width/2,F.y+F.height/2)}a-=y+ey}e.restore()}function ub(e){return e.length===0?0:e.reduce((n,o)=>n+o,0)/e.length}function qf(e,t,n,o,s,a,c,d){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(o,s,a,c),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(o,s,a,c);const u=ub(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,o+Ke,s+Ke+8);const h=Math.max(...n,1),p=n.map(y=>y/h*c);if(e.beginPath(),e.strokeStyle=d,e.lineWidth=2,p.length>1){e.moveTo(o,s+c-p[0]);for(let y=1;y<p.length;y++){const S=o+y/(p.length-1)*a,v=s+c-p[y];e.lineTo(S,v)}}else if(p.length===1){const y=s+c-p[0];e.moveTo(o,y),e.lineTo(o+a,y)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${h.toFixed(2)}ms`,o+a-Ke,s+Ke+8),e.restore()}function db(e,t,n){const{performanceMetrics:o}=t;if(!o)return;const s=280,a=240,c=n-s-Ke,d=Ke+un*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(c,d,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(c,d,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=d+Ke+5;const h=c+Ke;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",h,u),u+=25,e.fillStyle="white",e.font="12px monospace";const p=fb(t);e.fillText(`FPS: ${p.toFixed(1)}`,h,u),u+=20;const y=s-Ke*2,S=45,v=10;qf(e,"Render",Zf(t,"renderTime"),h,u,y,S,"#4CAF50"),u+=S+v,qf(e,"World Update",Zf(t,"worldUpdateTime"),h,u,y,S,"#2196F3"),u+=S+v,qf(e,"AI Update",Zf(t,"aiUpdateTime"),h,u,y,S,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",c+s/2,d+a-10),e.restore()}function fb(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(Dt/Lt);return t.history.filter(a=>n-a.bucketTime/(Dt/Lt)<1).length}function hb(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const c=Math.floor(a.bucketTime/(Dt/Lt));n.set(c,(n.get(c)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function Zf(e,t){return hb(e.performanceMetrics.history,t)}const pb={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"},gb=new ol(1e4);function mb(e,t){const{radius:n,position:o,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",c=t.isAdult?gt+20:gt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${a}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,o.x,o.y-c+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function yb(e,t,n,o,s){e.save(),e.font=`${_a}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(o?gt:gs)-_a-s),e.restore()}function vb(e,t,n,o,s){const a=t.x,c=t.y-n-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-o/2,c,o,o/2),e.fill(),e.beginPath(),e.moveTo(a-o/2,c),e.lineTo(a-o/4,c-o/3),e.lineTo(a-o/6,c),e.moveTo(a-o/6,c),e.lineTo(a,c-o/2),e.lineTo(a+o/6,c),e.moveTo(a+o/6,c),e.lineTo(a+o/4,c-o/3),e.lineTo(a+o/2,c),e.stroke(),e.restore()}function Sb(e,t,n){var d;const{position:o,radius:s}=t,a=o.x-Of/2,c=o.y-s-c_;if(t.stateMachine[0]===Po){const u=t.stateMachine[1],h=n-u.attackStartTime,p=Math.min(h/hu,1);To(e,a,c,Of,V0,p,vo,u_)}else if((d=t.attackCooldown)!=null&&d.melee&&t.attackCooldown.melee>0){const u=1-t.attackCooldown.melee/qa;To(e,a,c,Of,V0,u,vo,d_)}}function Ib(e,t,n=!1,o=!1,s=!1,a=!1,c=!1,d=!1,u=!1,h){var F,W;const{position:p,activeAction:y="idle"}=t,S=t.isAdult?gt:gt*.6,v=pb[y]||"idle",A=fr(t.animationProgress||0,12),I=up(t.direction,8),E=Math.floor(t.age),_=fr(t.hunger/100,5)*100,w=`${v}_${t.gender}_${E}_${I}_${A}_${t.isPregnant??!1}_${_}_${S}`,P=Math.ceil(S*2)+4,R=gb.getOrRender(w,P,P,Y=>{Y.translate(P/2,P/2);const G=dp(I,8);fp.render(Y,-P/2+2,-P/2+2,P-4,P-4,A,v,t.gender,E,G,t.isPregnant??!1,_)});e.drawImage(R,p.x-R.width/2,p.y-R.height/2),d&&(e.save(),e.strokeStyle=z1,e.lineWidth=2,e.beginPath(),e.arc(p.x,p.y,S+3,0,2*Math.PI),e.stroke(),e.restore());let C,k;if(c?(C=X1,k=sS):n?(C=j1,k=iS):s?(C=V1,k=Y1):o?(C=q1,k=oS):a&&(C=Z1,k=rS),C&&k&&vb(e,p,S,C,k),(F=t.tribeInfo)!=null&&F.tribeBadge&&yb(e,p,t.tribeInfo.tribeBadge,t.isAdult??!1,C??0),t.heldItem){const Y=Qh[t.heldItem.type],G=(W=t.tribeInfo)!=null&&W.tribeBadge?_a:0;e.save(),e.font=`${_a}px Arial`,e.textAlign="center",e.textBaseline="middle";const j=p.y-(t.isAdult?gt:gs)-_a-(C??0)-G;e.fillText(Y,p.x,j),e.restore()}const D=u&&(h.debugCharacterId===void 0||t.id===h.debugCharacterId);Sb(e,t,h.time),D&&mb(e,t)}const Tb={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},Ab=new ol(200);function Eb(e,t){const{radius:n,position:o,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",c=t.isAdult?gt+20:gt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${a}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-c+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function wb(e,t,n=!1,o){const{position:s,activeAction:a="idle"}=t,c=t.isAdult?t.radius:t.radius*.6,d=Tb[a]||"idle",u=fr(t.animationProgress||0,12),h=up(t.direction||{x:1,y:0},8),p=Math.floor(t.age),y=fr(t.hunger/100,5)*100,S=`${d}_${p}_${h}_${u}_${t.isPregnant??!1}_${y}_${t.geneCode}_${c}`,v=Math.ceil(c*2)+4,A=Ab.getOrRender(S,v,v,E=>{E.translate(v/2,v/2);const _=dp(h,8);CI.render(E,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:p,direction:_,isPregnant:t.isPregnant??!1,hungryLevel:y,geneCode:t.geneCode})});if(e.drawImage(A,s.x-A.width/2,s.y-A.height/2),t.hitpoints<t.maxHitpoints){const E=c*1.5,_=3,w=s.x-E/2,P=s.y-c-8;e.fillStyle="#555",e.fillRect(w,P,E,_);const R=t.hitpoints/t.maxHitpoints;e.fillStyle=R>.5?"#4CAF50":R>.25?"#FFC107":"#F44336",e.fillRect(w,P,E*R,_)}n&&(o===void 0||t.id===o)&&Eb(e,t)}const _b={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},Cb=new ol(200);function Pb(e,t){const{radius:n,position:o,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",c=t.isAdult?gt+20:gt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${a}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-c+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function Rb(e,t,n=!1,o){const{position:s,activeAction:a="idle"}=t,c=t.isAdult?t.radius:t.radius*.6,d=_b[a]||"idle",u=fr(t.animationProgress||0,12),h=up(t.direction||{x:1,y:0},8),p=Math.floor(t.age),y=fr(t.hunger/100,5)*100,S=`${d}_${p}_${h}_${u}_${t.isPregnant??!1}_${y}_${t.geneCode}_${c}`,v=Math.ceil(c*2)+4,A=Cb.getOrRender(S,v,v,E=>{E.translate(v/2,v/2);const _=dp(h,8);PI.render(E,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:p,direction:_,isPregnant:t.isPregnant??!1,hungryLevel:y,geneCode:t.geneCode})});if(e.drawImage(A,s.x-A.width/2,s.y-A.height/2),t.hitpoints<t.maxHitpoints){const E=c*1.5,_=3,w=s.x-E/2,P=s.y-c-8;e.fillStyle="#555",e.fillRect(w,P,E,_);const R=t.hitpoints/t.maxHitpoints;e.fillStyle=R>.5?"#4CAF50":R>.25?"#FFC107":"#F44336",e.fillRect(w,P,E*R,_)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,c+3,0,2*Math.PI),e.stroke()),n&&(o===void 0||t.id===o)&&Pb(e,t)}const RI=15;function Mb(e,t,n,o,s=1.5){const a=n-t.startTime,c=Math.min(a/t.duration,1),d=1-c,h=1+Math.sin(c*Math.PI*2)*(s-1),p=RI*h;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,p),0,Math.PI*2),e.fillStyle=o,e.fill(),e.restore()}function la(e,t,n,o,s=2){const a=n-t.startTime,c=Math.min(a/t.duration,1),d=1-c,u=RI*2*c;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=o,e.lineWidth=s,e.stroke(),e.restore()}function Ci(e,t,n,o){const s=n-t.startTime,a=Math.min(s/t.duration,1),c=1-a,d=-20*a;e.save(),e.globalAlpha=c,e.font="20px Arial",e.textAlign="center",e.fillText(o,t.position.x,t.position.y+d),e.restore()}function kb(e,t,n,o){const{width:s,height:a}=o.mapDimensions;let c=t.targetPosition;if(t.targetEntityId){const I=o.entities.entities[t.targetEntityId];I&&(c=I.position)}if(!c)return;const d=n-t.startTime,u=Math.min(d/t.duration,1);let h=c.x-t.position.x,p=c.y-t.position.y;h=h-Math.round(h/s)*s,p=p-Math.round(p/a)*a;const y={x:h,y:p},S=t.position.x+y.x*u,v=t.position.y+y.y*u,A=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(S,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(S,v+A),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function MI(e,t,n,o){switch(t.type){case Se.Procreation:Ci(e,t,n,"");break;case Se.Pregnant:Mb(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Se.TargetAcquired:la(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Se.Attack:Ci(e,t,n,"");break;case Se.Partnered:Ci(e,t,n,"");break;case Se.BushClaimed:la(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Se.BushClaimLost:la(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Se.Eating:Ci(e,t,n,"");break;case Se.ChildFed:Ci(e,t,n,"");break;case Se.AttackDeflected:Ci(e,t,n,"");break;case Se.AttackResisted:Ci(e,t,n,"");break;case Se.Hit:Ci(e,t,n,"");break;case Se.SeizeBuildup:la(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Se.BorderClaim:Ci(e,t,n,"");break;case Se.Seize:la(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Se.StoneProjectile:kb(e,t,n,o);break}}function Dy(e,t,n,o,s,a,c){e.save();const{position:d}=t;e.strokeStyle=o,e.lineWidth=s+Math.sin(c*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(d.x,d.y,n,0,2*Math.PI),e.stroke(),e.restore()}const by=8,Db=1.5,bb=.5,Oy=2,Ob="#5a5a5a",Nb="#7e7e7e",Bb="#8B0000",Hb="#FF4444",Fb=6,es="#8B4513",Lb="#A0522D",Ub="rgba(40, 40, 40, 0.7)",Gb=new ol(1e3),Ny=20,Pu={top:!1,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};function xb(e,t,n=!1,o=!0,s=Pu){if(n)return`ghost_${e.buildingType}_${o}`;const a=e,c=a.buildingType===Z.Bonfire&&(a.fuelLevel??0)>0,d=s,u=`${d.top}${d.right}${d.bottom}${d.left}${d.topRight}${d.bottomRight}${d.bottomLeft}${d.topLeft}`;return`${a.id}_${a.buildingType}_${a.width}_${a.height}_${t}_${a.isConstructed}_${c}_${u}`}function kI(e,t,n=!1,o=!0,s=Pu){const a=xb(e,t,n,o,s),{width:c,height:d,id:u,buildingType:h}=e,p=c+Ny*2,y=d+Ny*2;return Gb.getOrRender(a,p,y,S=>{const v=ei[h],A="isConstructed"in e?e.isConstructed:!0;if(S.translate(p/2,y/2),n){const I=o?"#4CAF50":"#F44336";h===Z.Palisade||h===Z.Gate?$b(S,c,d,I):Kf(S,c,d,9999,I),S.font=`${Math.min(c,d)*.5}px Arial`,S.textAlign="center",S.textBaseline="middle",S.fillStyle=I,S.fillText(v.icon,0,0)}else{const I=e;let E=v.icon,_="#FFFFFF";I.ownerId!==void 0&&I.ownerId!==null&&(_=Ut[I.ownerId%Ut.length]),h===Z.Palisade?Wb(S,c,d,u,_,s):h===Z.Gate?Yb(S,c,d,_,s):(I.buildingType===Z.Bonfire&&A&&(E=(I.fuelLevel??0)>0?"":""),t?Kf(S,c,d,u,Bb,Hb):Kf(S,c,d,u),S.globalAlpha=.5,S.font=`${Math.min(c,d,30)*.5}px Arial`,S.textAlign="center",S.textBaseline="middle",S.shadowColor="rgba(0,0,0,0.5)",S.shadowBlur=4,S.fillStyle="#FFFFFF",S.fillText(E,0,0))}})}function $b(e,t,n,o){e.fillStyle=o,e.fillRect(-t/2,-n/2,t,n),e.strokeStyle="rgba(0,0,0,0.2)",e.strokeRect(-t/2,-n/2,t,n)}function Wb(e,t,n,o,s,a){const c=t/2,d=n/2,u=n/4;e.fillStyle=es,a.right&&e.fillRect(0,-u/2,c,u),a.left&&e.fillRect(-c,-u/2,c,u),a.bottom&&e.fillRect(-u/2,0,u,d),a.top&&e.fillRect(-u/2,-d,u,d),e.lineWidth=u,e.strokeStyle=es,e.lineCap="round";const h=(y,S)=>{e.beginPath(),e.moveTo(0,0),e.lineTo(y,S),e.stroke()};a.topRight&&h(c,-d),a.bottomRight&&h(c,d),a.bottomLeft&&h(-c,d),a.topLeft&&h(-c,-d);const p=t/2;e.fillStyle=es,e.fillRect(-p/2,-d,p,n),e.fillStyle=Lb,e.fillRect(-p/4,-d,p/2,n),a.top||(e.fillStyle=es,e.beginPath(),e.moveTo(-p/2,-d),e.lineTo(0,-d-5),e.lineTo(p/2,-d),e.fill()),e.fillStyle=s,e.fillRect(-p/2,-n/8,p,n/4),e.strokeStyle="rgba(0,0,0,0.1)",e.lineWidth=1;for(let y=0;y<3;y++){const S=(qn(o+y)-.5)*p;e.beginPath(),e.moveTo(S,-d),e.lineTo(S,d),e.stroke()}}function Yb(e,t,n,o,s){(s.top||s.bottom)&&e.rotate(Math.PI/2);const a=t/4,c=t/2,d=n/2;e.fillStyle=es,e.fillRect(-c,-d,a,n),e.fillRect(c-a,-d,a,n),e.fillStyle="#5D2906",e.fillRect(-c,-d,t,a),e.fillStyle=es;const u=(t-a*2)/2;e.fillRect(-c+a+1,-d+a+1,u-2,n-a-2),e.fillRect(1,-d+a+1,u-2,n-a-2),e.strokeStyle="rgba(0,0,0,0.1)",e.lineWidth=1;for(let h=-1;h<=1;h+=2){const p=h*(u/2);e.beginPath(),e.moveTo(p,-d+a),e.lineTo(p,d),e.stroke()}e.fillStyle=o,e.beginPath(),e.arc(0,a/2,4,0,Math.PI*2),e.fill(),e.fillStyle="#C0C0C0",e.fillRect(-2,a/2-1,1,2),e.fillRect(1,a/2-1,1,2)}function zb(e,t,n,o,s){if(o<=0)return;e.save(),e.strokeStyle=Ub,e.lineWidth=1,e.lineCap="round";const a=Math.floor(o*10)+1;for(let c=0;c<a;c++){const d=s+c*17;let u=(qn(d)-.5)*t,h=(qn(d+1)-.5)*n;e.beginPath(),e.moveTo(u,h);const p=5+qn(d+2)*10,y=qn(d+3)*Math.PI*2;for(let S=0;S<3;S++)u+=Math.cos(y)*(p/3),h+=Math.sin(y)*(p/3),e.lineTo(u,h);e.stroke()}e.restore()}function Kf(e,t,n,o,s,a){const c=(t+n)*2,d=Math.floor(c/by),u=-t/2,h=t/2,p=-n/2,y=n/2;for(let S=0;S<d;S++){const v=o+S*13,A=qn(v),I=qn(v+1);let E=S*by,_=0,w=0;E<t?(_=u+E,w=p):E<t+n?(_=h,w=p+(E-t)):E<t*2+n?(_=h-(E-(t+n)),w=y):(_=u,w=y-(E-(t*2+n)));const P=(I-.5)*Oy,R=(qn(v+2)-.5)*Oy;e.beginPath();const C=Db+A*bb;s?e.fillStyle=s:e.fillStyle=A>.5?a||Nb:s||Ob,e.ellipse(_+P,w+R,C,C*.85,I*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function jb(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:o}=t;e.save(),e.font=`${Fb}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,o.forEach(s=>{const a=s.item.type,c=(Bh[a]||Qh[a])??"?",d={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(c,d.x,d.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function DI(e,t,n){const{position:o,width:s,height:a,constructionProgress:c,destructionProgress:d,isConstructed:u,isBeingDestroyed:h,buildingType:p,ownerId:y,id:S}=t,v=wt(n),A=!!(v&&cr(v,t,n));let I={...Pu};if(p===Z.Palisade||p===Z.Gate){const{width:R,height:C}=n.mapDimensions,k=n.search.building.byRadius(o,Fe*1.5);for(const D of k)if(D.id!==S&&(D.buildingType===Z.Palisade||D.buildingType===Z.Gate)&&D.ownerId===y){const F=Le(o,D.position,R,C),W=Fe*.5,Y=F.x>W,G=F.x<-5,j=F.y>W,ee=F.y<-5,V=Math.abs(F.x),te=Math.abs(F.y);V>W&&te<W?(Y&&(I.right=!0),G&&(I.left=!0)):te>W&&V<W?(j&&(I.bottom=!0),ee&&(I.top=!0)):V>W&&te>W&&(Y&&ee&&(I.topRight=!0),Y&&j&&(I.bottomRight=!0),G&&j&&(I.bottomLeft=!0),G&&ee&&(I.topLeft=!0))}}const E=kI(t,A,!1,!0,I);e.save(),u||(e.globalAlpha=.3+c*.7),e.drawImage(E,o.x-E.width/2,o.y-E.height/2),h&&u&&(e.translate(o.x,o.y),zb(e,s,a,d,S)),e.restore();const _=s,w=o.x-_/2,P=o.y+a/2+nE;u?h&&To(e,w,P,_,y0,1-d,vo,tE):To(e,w,P,_,y0,c,vo,eE),(t.buildingType===Z.StorageSpot||t.buildingType===Z.Bonfire)&&u&&jb(e,t)}function bI(e,t,n,o,s){const a=ei[n],{width:c,height:d}=a.dimensions,u=kI({buildingType:n,width:c,height:d,id:9999},!1,!0,o,Pu),h=(y,S)=>{y.save(),y.globalAlpha=JA,y.drawImage(u,S.x-u.width/2,S.y-u.height/2),y.restore()},p={position:{...t},radius:Math.max(c,d)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:De.create()};bn(e,s.width,s.height,(y,S)=>h(y,S.position),p)}const zr=1,Xb=20,jn=4,By=8,Vb="rgba(34, 85, 34, 0.25)",qb="rgba(139, 50, 50, 0.25)",ts=new Map,Zb=50;function Kb(e,t){return e.map(n=>n.id).sort((n,o)=>n-o).join(",")+`_${t}`}function Qb(){if(ts.size>Zb){const e=ts.keys().next().value;e&&ts.delete(e)}}function Jb(e){const t=new Map;for(const n of e){const o=n.ownerId;o&&(t.has(o)||t.set(o,[]),t.get(o).push(n))}return t}function eO(e,t,n,o){let s=0;const a=Math.max(o.width,o.height)/2;for(const c of n){const d=e-c.position.x,u=t-c.position.y,h=d*d+u*u;h>0?s+=a*a/h:s+=100}return s}function tO(e,t,n){let o=1/0,s=1/0,a=-1/0,c=-1/0;for(const d of e)o=Math.min(o,d.position.x-t.width/2),s=Math.min(s,d.position.y-t.height/2),a=Math.max(a,d.position.x+t.width/2),c=Math.max(c,d.position.y+t.height/2);return{minX:o-n,minY:s-n,maxX:a+n,maxY:c+n}}function nO(e,t,n,o){const s=Kb(e,o);if(ts.has(s))return ts.get(s);const a=n.maxX-n.minX,c=n.maxY-n.minY,d=Math.ceil(a/jn),u=Math.ceil(c/jn),h=[],p=[];for(let v=0;v<u;v++)h[v]=new Array(d);for(let v=0;v<u;v++)for(let A=0;A<d;A++){const I=n.minX+A*jn,E=n.minY+v*jn,_=eO(I,E,e,t);h[v][A]=_}for(let v=1;v<u-1;v++)for(let A=1;A<d-1;A++)if(h[v][A]>=zr&&(h[v-1][A]<zr||h[v+1][A]<zr||h[v][A-1]<zr||h[v][A+1]<zr)){const E=n.minX+A*jn,_=n.minY+v*jn;p.push({x:E,y:_})}const y=rO(p),S={fieldValues:h,edgePoints:p,regions:y,bounds:n};return ts.set(s,S),Qb(),S}function iO(e,t,n,o,s,a){if(t.length===0)return;const{bounds:c}=a,d=10;if(!a.canvas){const u=c.maxX-c.minX+d*2,h=c.maxY-c.minY+d*2,{canvas:p,ctx:y}=EI(u,h);y.translate(-c.minX+d,-c.minY+d);const{fieldValues:S,regions:v}=a;oO(y,S,c,o);let A=s;for(const I of v){const E=sO(I);aO(y,E,o,A),A+=1e3}a.canvas=p}e.save(),e.globalAlpha=1,e.drawImage(a.canvas,c.minX-d,c.minY-d),e.restore()}function oO(e,t,n,o){const s=o?qb:Vb;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let c=0;c<t[a].length;c++)if(t[a][c]>=zr){const d=n.minX+c*jn,u=n.minY+a*jn;e.rect(d,u,jn,jn)}e.fill(),e.restore()}function rO(e){if(e.length===0)return[];const t=jn*2,n=t,o=new Map;function s(h,p){const y=Math.floor(h/n),S=Math.floor(p/n);return`${y},${S}`}for(let h=0;h<e.length;h++){const p=s(e[h].x,e[h].y);o.has(p)||o.set(p,[]),o.get(p).push(h)}function a(h,p){const y=[],S=Math.floor(h/n),v=Math.floor(p/n);for(let A=-1;A<=1;A++)for(let I=-1;I<=1;I++){const E=`${S+A},${v+I}`,_=o.get(E);_&&y.push(..._)}return y}const c=new Set,d=[],u=t*t;for(let h=0;h<e.length;h++){if(c.has(h))continue;const p=[],y=[h];for(;y.length>0;){const S=y.shift();if(c.has(S))continue;c.add(S),p.push(e[S]);const v=a(e[S].x,e[S].y);for(const A of v){if(c.has(A))continue;const I=e[A].x-e[S].x,E=e[A].y-e[S].y;I*I+E*E<=u&&y.push(A)}}p.length>0&&d.push(p)}return d}function sO(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const o=t[t.length-1];let s=0,a=1/0;for(let c=0;c<n.length;c++){const d=n[c].x-o.x,u=n[c].y-o.y,h=d*d+u*u;h<a&&(a=h,s=c)}t.push(n.splice(s,1)[0])}return t}function aO(e,t,n,o){if(t.length===0)return;let s=0,a=0;for(let c=1;c<t.length;c++){const d=t[c-1],u=t[c],h=u.x-d.x,p=u.y-d.y,y=Math.sqrt(h*h+p*p);for(s+=y;s>=By;){s-=By;const S=1-s/y,v=d.x+h*S,A=d.y+p*S;lO(e,v,A,n,o+a*13),a++}}}function lO(e,t,n,o,s){const a=qn(s),c=qn(s+1),d=(c-.5)*2,u=(qn(s+2)-.5)*2;e.beginPath();const h=1.5+a*.5;o?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+d,n+u,h,h*.85,c*Math.PI,0,Math.PI*2),e.fill(),o||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function OI(e,t,n,o){var y,S,v;const s=t;if(!((y=s.search)!=null&&y.building))return;const c=s.search.building.all().filter(A=>A.buildingType===Z.PlantingZone&&A.isConstructed);if(c.length===0)return;const d=c.filter(A=>Da(A,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(d.length===0)return;const u=ei[Z.PlantingZone].dimensions,h=Jb(d),p=o?t.entities.entities[o]:void 0;for(const[A,I]of h){const E=((v=(S=p==null?void 0:p.tribeControl)==null?void 0:S.diplomacy)==null?void 0:v[A])==="Hostile",_=typeof A=="number"?A:0,w=tO(I,u,Xb),P=nO(I,u,w,E);iO(e,I,u,E,_,P)}}const cO=.001,uO=.05,dO=12;function fO(e,t,n){const{position:o,age:s,swayOffset:a}=t,[c]=t.stateMachine??[],d=Math.min(1,Math.max(.4,s/Ro)),h=c!==Gt&&c!==mi?Math.sin(n*cO+a)*uO:0;if(e.save(),e.translate(o.x,o.y),e.scale(d,d),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=$P,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),c===mi?Qf(e,10,8):c===Gt?(e.rotate(Math.PI/2),Qf(e,10,30),e.translate(0,-25),Hy(e,40,20,40,15)):(e.rotate(h),Qf(e,10,30),e.translate(0,-25),e.rotate(h*.5),Hy(e,40,20,40,15)),e.restore(),(c===Gt||c===mi)&&t.wood&&t.wood.length>0){e.save(),e.font=`${dO}px Arial`,e.textAlign="center",e.textBaseline="middle";const p=t.radius*1.1,y=Math.PI*2/(wu-1);t.wood.forEach((S,v)=>{const A=v===0?0:p,I=v===0?0:(v-1)*y,E=o.x+A*Math.cos(I),_=o.y+A*Math.sin(I),w=Qh[S.type];e.fillText(w,E,_)}),e.restore()}}function Qf(e,t,n){e.fillStyle=FP,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=LP,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function Hy(e,t,n,o,s){e.fillStyle=UP,Fy(e,t+4,n+4,o+2,s+2),e.translate(0,-2),e.fillStyle=GP,Fy(e,t,n,o,s),e.fillStyle=xP,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function Fy(e,t,n,o,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-o),e.lineTo(0,-o-s),e.lineTo(n/2,-o),e.lineTo(t/2,0),e.closePath(),e.fill()}const _c=200;let ho=null;function hO(e,t,n,o,s){const a=JP(t.time);if(a<=0)return;ho||(ho=document.createElement("canvas")),(ho.width!==o.width||ho.height!==o.height)&&(ho.width=o.width,ho.height=o.height);const c=ho.getContext("2d");if(c){c.clearRect(0,0,o.width,o.height),c.fillStyle=`rgba(0, 0, 40, ${a*.85})`,c.fillRect(0,0,o.width,o.height),c.globalCompositeOperation="destination-out";for(const d of s){const u=il(d.position,n,o,t.mapDimensions),h=c.createRadialGradient(u.x,u.y,0,u.x,u.y,d.radius);h.addColorStop(0,`rgba(255, 255, 255, ${d.intensity})`),h.addColorStop(1,"rgba(255, 255, 255, 0)"),c.fillStyle=h,c.beginPath(),c.arc(u.x,u.y,d.radius,0,Math.PI*2),c.fill()}c.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(ho,0,0),e.restore()}}function Ly(e,t,n,o,s,a,c){for(let d=-s.height;d<=s.height;d+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const h={x:t.x+u,y:t.y+d};Da({position:h,radius:n},a,c,s)&&e.push({position:h,radius:n,intensity:o})}}function pO(e,t,n,o,s,a=[]){const c=wt(t),d=c?Wi(t,c):[],u=ls(d),{width:h,height:p}=t.mapDimensions,y=[];a.forEach(_=>{y.push({position:_,radius:30,intensity:.3})}),OI(e,t,o,c==null?void 0:c.leaderId);const S=t,v={left:o.x-s.width/2-_c,top:o.y-s.height/2-_c,right:o.x+s.width/2+_c,bottom:o.y+s.height/2+_c};[...S.search.human.byRect(v),...S.search.building.byRect(v),...S.search.berryBush.byRect(v),...S.search.tree.byRect(v),...S.search.corpse.byRect(v),...S.search.prey.byRect(v),...S.search.predator.byRect(v)].sort((_,w)=>n&&_.id===t.debugCharacterId&&_.id!==w.id||_.type==="building"&&w.type!=="building"||_.position.y<w.position.y?-1:_.position.y>w.position.y?1:_.id-w.id).forEach(_=>{var w,P;if(_.type==="building"){const R=_;if(R.isConstructed){const C=R.buildingType===Z.Bonfire&&(R.fuelLevel??0)>0,k=C?180:60,D=C?.9:.4;Ly(y,R.position,k,D,t.mapDimensions,o,s)}if(R.buildingType===Z.PlantingZone&&R.isConstructed)return;bn(e,h,p,DI,R,t,c,t.time)}else if(_.type==="berryBush")bn(e,h,p,KD,_,t,c,t.time);else if(_.type==="tree")bn(e,h,p,fO,_,t.time);else if(_.type==="human"){const R=_,C=R.id===(c==null?void 0:c.id),k=d.some(G=>G.id===R.id),D=R.id===(u==null?void 0:u.id),F=c&&(R.id===c.motherId||R.id===c.fatherId),W=c&&(((w=R.partnerIds)==null?void 0:w.includes(c.id))||((P=c.partnerIds)==null?void 0:P.includes(R.id))),Y=(c==null?void 0:c.attackTargetId)===R.id;Ly(y,R.position,40,.3,t.mapDimensions,o,s),bn(e,h,p,Ib,R,C,F,k,W,D,Y,n,t)}else _.type==="corpse"?bn(e,h,p,ib,_):_.type==="prey"?bn(e,h,p,wb,_,n,t.time,t.debugCharacterId):_.type==="predator"&&bn(e,h,p,Rb,_,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(_=>Da(_,o,s,t.mapDimensions)).forEach(_=>{bn(e,h,p,MI,_,t.time,t)});const E=t.notifications.filter(_=>!_.isDismissed);for(const _ of E)if(_.highlightedEntityIds&&_.renderHighlights)for(const w of _.highlightedEntityIds){const P=t.entities.entities[w];P&&Da(P,o,s,t.mapDimensions)&&bn(e,h,p,Dy,P,F_,L_,G_,U_,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const _ of t.tutorialState.highlightedEntityIds){const w=t.entities.entities[_];w&&Da(w,o,s,t.mapDimensions)&&bn(e,h,p,Dy,w,w_,pS,gS,Kh,t.time)}hO(e,t,o,s,y)}function gO(e,t,n,o,s,a){let c=null,d=null;e.textAlign="left";let u=Ke+un;const p=t.time/(Dt/Lt)/du%1,y=sa[Wr.Time],S=25,v=Ke+S;e.fillText(y,Ke,u+mn/2+un/3),To(e,v,u,fo,mn,p,vo,i_),u+=mn+_i;const A=u+Di/2,I=u+(Di-mn)/2,E=5;Xa(e,{x:Ke*2,y:A},Di,5,n.gender,!1,!1,!1);const _=Ke+Di+E,w=fo+S-(Di+E)*2;To(e,_,I,w,mn,Math.floor(n.age)/Fa,vo,n_),Xa(e,{x:_+w+E+Di/2,y:A},Di,Fa,n.gender,!1,!1,!1),u+=mn+_i*2;const P=[],R=new Set;if(P.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),R.add(n.id),o&&!R.has(o.id)&&(P.push({member:o,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),R.add(o.id)),s.forEach(V=>{R.has(V.id)||(P.push({member:V,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),R.add(V.id))}),a.forEach(V=>{R.has(V.id)||(P.push({member:V,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),R.add(V.id))}),n.motherId&&!R.has(n.motherId)){const V=t.entities.entities[n.motherId];V&&(P.push({member:V,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),R.add(V.id))}if(n.fatherId&&!R.has(n.fatherId)){const V=t.entities.entities[n.fatherId];V&&(P.push({member:V,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),R.add(V.id))}const C=sa[Wr.Family],k=10,D=Ke+un+k,F=fo+S-(un+k),W=u+yc/2;e.font=`${un}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(C,Ke,W);const Y=u+yc/2;zD(e,D,Y,P,yc,F),u+=yc+_i,e.textBaseline="alphabetic";const G=sa[Wr.Hitpoints];e.fillText(G,Ke,u+mn/2+un/3),To(e,v,u,fo,mn,n.hitpoints/n.maxHitpoints,vo,t_),u+=mn+_i;const j=sa[Wr.Hunger];e.fillText(j,Ke,u+mn/2+un/3),To(e,v,u,fo,mn,(Xt-n.hunger)/Xt,vo,e_),c={x:Ke,y:u-_i/2,width:fo+S,height:mn+_i},u+=mn+_i,e.textBaseline="middle";const ee=sa[Wr.Food];return e.fillText(ee,Ke,u+mc/2),ob(e,v,u+mc/2,n.food,mc,fo),d={x:Ke,y:u-_i/5,width:fo+S,height:mc+_i},e.textBaseline="alphabetic",{hungerBarRect:c,foodBarRect:d}}let ca=[],Uy=0;const mO=36,yO=200;function vO(e,t,n,o){const s=t.search.prey.count(),a=t.search.predator.count(),c=t.search.berryBush.count(),d=t.search.tree.count();t.time-Uy>=mO&&(ca.push({time:t.time,prey:s,predators:a,bushes:c,trees:d}),ca.length>yO&&(ca=ca.slice(-200)),Uy=t.time);const u=Ue*Ge,h=s/u*1e6,p=a/u*1e6,y=c/u*1e6,S=d/u*1e6,v=ID(),A=Math.floor(t.time/(24*365)),I=Math.floor(t.time%(24*365)/24),E=Math.floor(t.time%24),_=400,w=Math.min(o*.8,600),P=n-_-10,R=Ke+un*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(P,R,_,w),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(P,R,_,w),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let C=R+20;const k=14,D=P+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",D,C),C+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${A}, Day ${I}, Hour ${E}`,D,C),C+=k,e.fillText(`Map Size: ${Ue}  ${Ge} pixels`,D,C),C+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",D,C),C+=18,v&&(e.fillText(`Q-Table Size: ${v.qTableSize} entries`,D,C),C+=k,e.fillText(`Exploration Rate: ${(v.explorationRate*100).toFixed(1)}%`,D,C),C+=k);const F=ca.slice(-20);F.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",D,C),C+=30,SO(e,D,C,F),C+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",D,C),C+=18,e.fillStyle="white",e.font="12px monospace";const W=(Bi/u*1e6).toFixed(2),Y=(Hi/u*1e6).toFixed(2),G=(Fi/u*1e6).toFixed(2),j=(Li/u*1e6).toFixed(2);e.fillText(`Prey: ${h.toFixed(2)} (target: ${W})`,D,C),C+=k,e.fillText(`Predators: ${p.toFixed(2)} (target: ${Y})`,D,C),C+=k,e.fillText(`Bushes: ${y.toFixed(2)} (target: ${G})`,D,C),C+=k,e.fillText(`Trees: ${S.toFixed(2)} (target: ${j})`,D,C),C+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",D,C),C+=18,e.fillStyle="white",e.font="12px monospace";const ee=Math.round(s/Bi*100),V=Math.round(a/Hi*100),te=Math.round(c/Fi*100),re=Math.round(d/Li*100),ie=z=>z<50?"#ff4444":z<80?"#ffaa44":z>120?"#44aaff":"#44ff44";e.fillStyle=ie(ee),e.fillText(`Prey: ${s}/${Bi} (${ee}%)`,D,C),C+=k,e.fillStyle=ie(V),e.fillText(`Predators: ${a}/${Hi} (${V}%)`,D,C),C+=k,e.fillStyle=ie(re),e.fillText(`Trees: ${d}/${Li} (${re}%)`,D,C),C+=k,e.fillStyle=ie(te),e.fillText(`Bushes: ${c}/${Fi} (${te}%)`,D,C),C+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",D,C),C+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",D,C),C+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,D,C),C+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,D,C),C+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,D,C),C+=13,e.fillText("Predators:",D,C),C+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,D,C),C+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,D,C),C+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,D,C),C+=13,e.fillText("Bushes:",D,C),C+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,D,C),C+=15,e.fillText("Trees:",D,C),C+=13,e.fillText(` Spread Chance: ${(t.ecosystem.treeSpreadChance*100).toFixed(1)}%`,D,C),C+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",P+_/2,R+w-10),e.restore()}function SO(e,t,n,o){if(o.length<2)return;const d={prey:Math.max(...o.map(h=>h.prey),Bi),predators:Math.max(...o.map(h=>h.predators),Hi),bushes:Math.max(...o.map(h=>h.bushes),Fi),trees:Math.max(...o.map(h=>h.trees),Li)};[{data:o.map(h=>h.prey),color:"#44ff44",label:"Prey",target:Bi,max:d.prey},{data:o.map(h=>h.predators),color:"#ff4444",label:"Predators",target:Hi,max:d.predators},{data:o.map(h=>h.trees),color:"#76a331",label:"Trees",target:Li,max:d.trees},{data:o.map(h=>h.bushes),color:"#ffaa44",label:"Bushes",target:Fi,max:d.bushes}].forEach((h,p)=>{const y=t+p%2*115,S=n+Math.floor(p/2)*55;e.fillStyle=h.color,e.font="10px monospace",e.textAlign="left",e.fillText(h.label,y,S-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(y,S,100,30),e.beginPath(),e.strokeStyle=h.color;for(let A=0;A<h.data.length;A++){const I=y+A/(h.data.length-1)*100,E=S+30-h.data[A]/h.max*30;A===0?e.moveTo(I,E):e.lineTo(I,E)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=S+30-h.target/h.max*30;e.moveTo(y,v),e.lineTo(y+100,v),e.stroke(),e.setLineDash([])})}function IO(e,t){const n=t.search.human.byProperty("leaderId",e),o={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||o.children++,s.gender==="male"?o.males++:s.gender==="female"&&o.females++,s.age>=Lh&&o.old++;return o}function TO(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(h=>n.berryBush.byRadius(h.position,h.radius)).reduce((h,p)=>h+p.food.length,0),u=n.building.byProperty("ownerId",e).filter(h=>h.buildingType===Z.StorageSpot).reduce((h,p)=>h+(p.storedItems.filter(y=>y.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:u,consumptionRate:0}}function AO(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,c=new Map,d=new Map;for(const h of s){const p=Kc(h.id,t,c);d.has(p)||d.set(p,[]),d.get(p).push(h)}const u=[];for(const[h,p]of d.entries()){const y=a[h];y&&u.push({patriarch:y,memberCount:p.length,members:p.map(S=>S.id)})}return u.sort((h,p)=>p.memberCount-h.memberCount),u.slice(0,n)}let ua=[],di=[],Gy=0;const EO=36,xy=200;function wO(e,t,n,o){var R;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(R=lp(s,t))==null?void 0:R.id;if(!a)return;const c=IO(a,t),d=TO(a,t);if(t.time-Gy>=EO){ua.push({time:t.time,total:c.total,children:c.children,males:c.males,females:c.females,old:c.old});const C=d.totalBushFood+d.totalStorageFood;di.push({time:t.time,bushFood:d.totalBushFood,storageFood:d.totalStorageFood,totalFood:C}),ua.length>xy&&(ua=ua.slice(-200)),di.length>xy&&(di=di.slice(-200)),Gy=t.time}let u=0;if(di.length>=2){const C=di[di.length-1],k=di[di.length-2],D=C.time-k.time;D>0&&(u=(k.totalFood-C.totalFood)/D)}const h=400,p=Math.min(o*.9,700),y=n-h-10,S=Ke+un*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(y,S,h,p),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(y,S,h,p),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=S+20;const A=13,I=y+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",I,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",I,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${c.total}`,I,v),v+=A,e.fillStyle="#00ffff",e.fillText(`Children: ${c.children}`,I,v),v+=A,e.fillStyle="#4488ff",e.fillText(`Males: ${c.males}`,I,v),v+=A,e.fillStyle="#ff88ff",e.fillText(`Females: ${c.females}`,I,v),v+=A,e.fillStyle="#888888",e.fillText(`Old (${c.old})`,I,v),v+=20;const E=ua.slice(-50);E.length>1&&(_O(e,I,v,E),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",I,v),v+=18;const _=d.totalBushFood+d.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${_}`,I,v),v+=A,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${d.totalBushFood}`,I,v),v+=A,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${d.totalStorageFood}`,I,v),v+=A,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,I,v),v+=20;const w=di.slice(-50);w.length>1&&(CO(e,I,v,w),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",I,v),v+=18;const P=AO(a,t,5);e.fillStyle="white",e.font="11px monospace",P.length===0?(e.fillText("No families found",I,v),v+=A):P.forEach((C,k)=>{const F=`${k+1}. ${C.patriarch.isPlayer?"Player":"#"+C.patriarch.id} (${C.memberCount} members, can split: ${NS(C.patriarch,t).canSplit})`;e.fillText(F,I,v),v+=A}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",y+h/2,S+p-10),e.restore()}function _O(e,t,n,o){if(o.length<2)return;const c=Math.max(...o.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:o.map(u=>u.total),color:"#ffffff",label:"Total"},{data:o.map(u=>u.children),color:"#00ffff",label:"Children"},{data:o.map(u=>u.males),color:"#4488ff",label:"Males"},{data:o.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:o.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let h=0;h<u.data.length;h++){const p=t+h/(u.data.length-1)*350,y=n+80-u.data[h]/c*80;h===0?e.moveTo(p,y):e.lineTo(p,y)}e.stroke()})}function CO(e,t,n,o){if(o.length<2)return;const c=Math.max(...o.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:o.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:o.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:o.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let h=0;h<u.data.length;h++){const p=t+h/(u.data.length-1)*350,y=n+80-u.data[h]/c*80;h===0?e.moveTo(p,y):e.lineTo(p,y)}e.stroke()})}function $y(e,t,n){e.save();const{x:o,y:s,width:a,height:c}=t.rect,d=lS;if(e.beginPath(),e.moveTo(o+d,s),e.lineTo(o+a-d,s),e.quadraticCurveTo(o+a,s,o+a,s+d),e.lineTo(o+a,s+c-d),e.quadraticCurveTo(o+a,s+c,o+a-d,s+c),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),e.lineTo(o,s+d),e.quadraticCurveTo(o,s,o+d,s),e.closePath(),e.fillStyle=t.isDisabled?cS:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*hS)+1)/2;e.strokeStyle=fS,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<Vc){const h=1-u/Vc;e.fillStyle=dS,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Zh,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?uS:t.textColor,t.icon?(e.font=`${c*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+a/2,s+c/2),t.text&&(e.font=`${c*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+a-4,s+c-2))):(e.font=`${un*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+a/2,s+c/2)),e.restore()}function PO(e,t,n,o){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,o);const s=500,a=150,c=(n-s)/2,d=(o-a)/2;e.fillStyle=Et,e.font=`${un*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,d+a/3-10),e.fillText("to the main menu?",n/2,d+a/3+10);const u=Ni*1.5,h=aS,p=d+a-h-Ke*2,y=20,S=u*2+y,v=c+(s-S)/2,A={id:"confirmExitYes",action:fe.ConfirmExitYes,rect:{x:v,y:p,width:u,height:h},text:"Yes",backgroundColor:In,textColor:Et,currentWidth:u},I=v+u+y,E={id:"confirmExitNo",action:fe.ConfirmExitNo,rect:{x:I,y:p,width:u,height:h},text:"No",backgroundColor:In,textColor:Et,currentWidth:u};t.uiButtons.push(A,E),$y(e,A,t.hoveredButtonId===A.id),$y(e,E,t.hoveredButtonId===E.id),e.restore()}let Wy="",Yy=null;function RO(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function MO(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function Cc(e,t,n,o,s,a,c){const d=((t+o)%a+a)%a,u=((n+s)%c+c)%c;return e.has(`${d},${u}`)}function kO(e,t,n,o){const s=sC(t.soilDepletion,Lv);if(s.length===0)return;const{width:a,height:c}=t.mapDimensions,d=o.width/2,u=o.height/2,h=Math.ceil(a/Ft),p=Math.ceil(c/Ft),y=RO(s);y!==Wy&&(Wy=y,Yy=MO(s));const S=Yy,v=Ft*2,A=n.x-d-v,I=n.x+d+v,E=n.y-u-v,_=n.y+u+v;e.save();const w=e.globalAlpha;for(const P of s){const R=P.gridX*Ft,C=P.gridY*Ft,k=DO(R,C,a,c,A,I,E,_);for(const D of k)bO(e,D.x,D.y,P.health,P.gridX,P.gridY,S,h,p)}e.globalAlpha=w,e.restore()}function DO(e,t,n,o,s,a,c,d){const u=[],h=Ft,p=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-o},{dx:0,dy:o},{dx:-n,dy:-o},{dx:n,dy:-o},{dx:-n,dy:o},{dx:n,dy:o}];for(const y of p){const S=e+y.dx,v=t+y.dy;S+h>=s&&S<=a&&v+h>=c&&v<=d&&u.push({x:S,y:v})}return u}function bO(e,t,n,o,s,a,c,d,u){const h=Math.floor(t),p=Math.floor(n),y=Ft,S=1-o/Lv,A=o<Ow?N0:N0*S,I=!Cc(c,s,a,0,-1,d,u),E=!Cc(c,s,a,0,1,d,u),_=!Cc(c,s,a,-1,0,d,u),w=!Cc(c,s,a,1,0,d,u);e.globalAlpha=A,e.fillStyle=Dw,e.fillRect(h,p,y,y);const P=3;e.fillStyle=bw,e.globalAlpha=A*1.2,I&&e.fillRect(h,p,y,P),E&&e.fillRect(h,p+y-P,y,P),_&&e.fillRect(h,p,P,y),w&&e.fillRect(h+y-P,p,P,y),e.globalAlpha=A*.5;const R=P+1;I&&_&&e.fillRect(h,p,R,R),I&&w&&e.fillRect(h+y-R,p,R,R),E&&_&&e.fillRect(h,p+y-R,R,R),E&&w&&e.fillRect(h+y-R,p+y-R,R,R),e.globalAlpha=1}const da=8,fa=12,Qt=24;function zy(e,t,n,o,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-fa),e.stroke(),e.fillStyle=o,e.beginPath(),e.moveTo(t,n-fa),e.lineTo(t+da,n-fa+da/2),e.lineTo(t,n-fa+da),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+da/2,n-fa+da/2))}function NI(e,t,n,o,s){const a=yu(t,s);let c=1;const d=new Map,u=new Map;for(const I of a){const _=I.leaderId===s?0:c++,w=Ut[_%Ut.length];d.set(I.leaderId,w),u.set(I.leaderId,I.tribeBadge||"")}const h=[],p=Qt*2,y=Math.floor((n.x-o.width/2-p)/Qt)*Qt,S=Math.floor((n.x+o.width/2+p)/Qt)*Qt,v=Math.floor((n.y-o.height/2-p)/Qt)*Qt,A=Math.floor((n.y+o.height/2+p)/Qt)*Qt;for(let I=v;I<=A;I+=Qt)for(let E=y;E<=S;E+=Qt){const _=Qn(E,I,t),w=E+Qt,P=Qn(w,I,t);if(_!==P){const k=_||P;if(k){const D=E+Qt/2,F=I;zy(e,D,F,d.get(k)||"#000",u.get(k)||""),h.push({x:D,y:F})}}const R=I+Qt,C=Qn(E,R,t);if(_!==C){const k=_||C;if(k){const D=E,F=I+Qt/2;zy(e,D,F,d.get(k)||"#000",u.get(k)||""),h.push({x:D,y:F})}}}return h}const vn=12,vt=16,kn=15;function jy(e){switch(e){case N.Success:return"#4CAF50";case N.Failure:return"#F44336";case N.Running:return"#FFC107";case N.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function OO(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function NO(e,t,n,o){var D;const{debugCharacterId:s}=t,a=500,c=Math.min(o*.9,800),d=n-a-10,u=Ke+un*2;t.debugPanelRect={x:d,y:u,width:a,height:c},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(d,u,a,c),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(d,u,a,c),e.fillStyle="white",e.font=`${vn}px monospace`,e.textAlign="left",e.textBaseline="top";let h=u+20;const p=d+15;if(e.fillStyle="#66ccff",e.font=`bold ${vn+2}px monospace`,e.fillText(" Task AI Debugger",p,h),h+=25,!s){e.fillStyle="#888",e.font=`${vn}px monospace`,e.fillText("No character selected for debugging.",p,h),e.fillText("Click on a character to inspect their Task AI.",p,h+20),e.restore();return}const y=t.entities.entities[s];if(!y||y.type!=="human"&&y.type!=="predator"&&y.type!=="prey"){e.fillStyle="#ff4444",e.font=`${vn}px monospace`,e.fillText(`Character #${s} not found or not a character.`,p,h),e.restore();return}const S=y;e.fillStyle="white",e.font=`${vn}px monospace`,e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,p,h),h+=vt*1.5,e.fillStyle="#66ccff",e.font=`bold ${vn}px monospace`,e.fillText(" Current Task",p,h),h+=vt*1.5;const v=eu(S),A=v?t.tasks[v]:null;if(e.font=`${vn}px monospace`,A){const F=De.get(S.aiBlackboard,oI),W=De.get(S.aiBlackboard,rI),Y=F!==void 0?N[F]:"N/A";e.fillStyle="white",e.fillText(`ID: ${A.id}`,p+kn,h),h+=vt,e.fillText(`Type: ${$[A.type]}`,p+kn,h),h+=vt,e.fillText(`Target: ${OO(A.target)}`,p+kn,h),h+=vt,e.fillStyle=jy(F),e.fillText(`Status: ${Y}`,p+kn,h),h+=vt,W&&(e.fillStyle="#aaa",e.fillText(`Message: ${W}`,p+kn,h),h+=vt)}else e.fillStyle="#888",e.fillText("No active task.",p+kn,h),h+=vt;h+=vt,e.fillStyle="#66ccff",e.font=`bold ${vn}px monospace`,e.fillText(" Recent Task History (Last 5)",p,h),h+=vt*1.5;const I=De.get(S.aiBlackboard,yh)||[];if(I.length===0)e.fillStyle="#888",e.font=`${vn}px monospace`,e.fillText("No task history yet.",p+kn,h),h+=vt;else for(const F of I){e.fillStyle="white",e.font=`${vn}px monospace`;const W=$[F.type];e.fillText(` ${W}`,p+kn,h);const Y=N[F.result];e.fillStyle=jy(F.result);const G=e.measureText(` ${W} `).width;e.fillText(`(${Y})`,p+kn+G,h),e.fillStyle="#666";const j=e.measureText(`(${Y}) `).width;e.fillText(`@ ${F.completedAtTick.toFixed(1)}h`,p+kn+G+j,h),h+=vt,F.message&&(e.fillStyle="#888",e.fillText(`   ${F.message}`,p+kn,h),h+=vt)}h+=vt,e.fillStyle="#66ccff",e.font=`bold ${vn}px monospace`,e.fillText(" Available Tasks",p,h),h+=vt*1.5;const E=h,_=u+c-E-30;e.save(),e.beginPath(),e.rect(d,E,a,_),e.clip();const w=((D=t.debugPanelScroll)==null?void 0:D.y)??0;e.translate(0,-w);const P=t.search.tasks.byRadius(y.position,800);let R=0;if(P.length===0)e.fillStyle="#888",e.font=`${vn}px monospace`,e.fillText("No tasks available in the world.",p+kn,h),h+=vt;else{const F=P.map(W=>{const Y=_u[W.type];return{task:W,score:Y&&Y.scorer&&S.type==="human"?Y.scorer(S,W,{gameState:t,deltaTime:0}):null}});F.sort((W,Y)=>{const G=W.score!==null?W.score:-1/0;return(Y.score!==null?Y.score:-1/0)-G});for(const{task:W,score:Y}of F){let G="Unclaimed",j="#888";W.claimedByEntityId&&(W.claimedByEntityId===S.id?(G="Claimed by this character",j="#4CAF50"):(G=`Claimed by #${W.claimedByEntityId}`,j="#F44336")),e.font=`${vn}px monospace`,e.fillStyle=j;const ee=` Task ID: ${W.id}`;e.fillText(ee,p,h),h+=vt,e.fillStyle="white",e.fillText(`  Type: ${$[W.type]}`,p,h),h+=vt;const V=Y!==null?Y.toFixed(3):"N/A";e.fillStyle=Y!==null&&Y>0?"#FFC107":"#888",e.fillText(`  Score: ${V}`,p,h),h+=vt,e.fillStyle=j,e.fillText(`  Status: ${G}`,p,h),h+=vt*1.5,R=Math.max(R,e.measureText(ee).width+30)}}const C=h-E;t.debugPanelContentSize={width:R,height:C},e.restore();const k=u+c-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",d+a/2,k),e.restore()}function BO(e,t,n,o){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey"))switch(a.aiType){case Mo.TaskBased:default:NO(e,t,n,o);break}}function nu(e,t,n,o,s,a=!1){var h;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),qD(e,t);return}const c=wt(t),d=NI(e,t,n,s,c==null?void 0:c.leaderId);if(kO(e,t,n,s),pO(e,t,t.debugPanel===je.General,n,s,d),c&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const p=Ih(t.mousePosition,n,s,t.mapDimensions),y=Ga(p,t.selectedBuildingType,c.leaderId,t);bI(e,p,t.selectedBuildingType,y,t.mapDimensions)}const u=t.notifications.filter(p=>!p.isDismissed);for(const p of u){const y=(Math.sin(t.time*N_)+1)/2;e.globalAlpha=y*.5+.25,e.fillStyle=O_,p.targetArea&&e.fillRect(p.targetArea.x,p.targetArea.y,p.targetArea.width,p.targetArea.height),p.targetRadius&&(e.beginPath(),e.arc(p.targetRadius.x,p.targetRadius.y,p.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,ab(e,t),e.restore(),!a){e.fillStyle=K1,e.font=`${un}px "Press Start 2P", Arial`,e.shadowColor=Q1,e.shadowBlur=J1,t.uiButtons=[];let p=null,y=null;if(c){const A=Wi(t,c),I=ls(A),E=((h=c.partnerIds)==null?void 0:h.map(w=>t.entities.entities[w]).filter(w=>w!==void 0))||[],_=gO(e,t,c,I,E,A);p=_.hungerBarRect,y=_.foodBarRect}const S=yu(t,c==null?void 0:c.leaderId);FD(e,t,n,S,e.canvas.width,e.canvas.height,t.cameraZoom);const{commandButtonsRect:v}=bD(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,c&&(rb(e,t,n,e.canvas.width,e.canvas.height),o.length>0&&HD(e,o,c,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:A}=t.tutorialState;A.includes(rr.HUNGER_BAR)&&p&&Xf(e,p,t.time),A.includes(rr.FOOD_BAR)&&y&&Xf(e,y,t.time),A.includes(rr.COMMAND_BUTTONS)&&v&&Xf(e,v,t.time)}if(t.tutorialState.isActive){const A=VD(e,t,e.canvas.width,e.canvas.height);A&&t.uiButtons.push({id:"tutorial-dismiss",action:fe.DismissTutorial,rect:A,text:"",currentWidth:A.width,backgroundColor:"transparent",textColor:"transparent"})}switch(cb(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case je.Ecosystem:vO(e,t,e.canvas.width,e.canvas.height);break;case je.Tribe:wO(e,t,e.canvas.width,e.canvas.height);break;case je.Performance:db(e,t,s.width);break;case je.General:BO(e,t,e.canvas.width,e.canvas.height);break}t.tribeModalOpen&&jD(e,t,S,e.canvas.width,e.canvas.height),t.isPaused&&t.exitConfirmation!=="pending"&&OD(e),t.exitConfirmation==="pending"&&PO(e,t,e.canvas.width,e.canvas.height)}}const HO=qe.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,FO=qe.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,LO=qe.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,UO=qe.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Xy=qe.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,GO=qe.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,xO=qe.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,Pc="intro-soundtrack",Vy=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=ko(),o=ge.useRef(null),s=ge.useRef(null),a=ge.useRef(Sk()),c=ge.useRef(),d=ge.useRef(a.current.viewportCenter),u=ge.useRef(),h=ge.useCallback(()=>{xf(Pc,2),n(),e("game")},[e,n]),p=ge.useCallback(()=>{t&&(xf(Pc,2),e("game"))},[e,t]);ge.useEffect(()=>{const v=A=>{(A.key==="Enter"||A.key===" ")&&(t?p():h())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[h,p,t]),ge.useEffect(()=>(tp(Ie.SoundTrack1,{loop:!0,trackId:Pc}),()=>{xf(Pc,2)}),[]),ge.useEffect(()=>{const v=o.current;if(!v)return;s.current=v.getContext("2d");const A=()=>{v&&s.current&&(v.width=window.innerWidth,v.height=window.innerHeight,nu(s.current,a.current,d.current,[],{width:v.width,height:v.height},!0))};return A(),window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]),ge.useEffect(()=>{const v=()=>{const I=eS(a.current);if(I.length>0){const E=Math.floor(Math.random()*I.length);u.current=I[E].id}};v();const A=setInterval(v,mw);return()=>clearInterval(A)},[]);const[y,S]=Mv(v=>{var E,_;if(!s.current)return;if(c.current===void 0){c.current=v;return}const A=Math.min((v-c.current)/1e3,1);a.current=Cu(a.current,A);const I=u.current?a.current.entities.entities[u.current]:void 0;if(I){const{mapDimensions:w}=a.current,{width:P,height:R}=w;let C={...I.position};const k=C.x-d.current.x;Math.abs(k)>P/2&&(k>0?C.x-=P:C.x+=P);const D=C.y-d.current.y;Math.abs(D)>R/2&&(D>0?C.y-=R:C.y+=R);let F=Fc(d.current,C,$c*A);F={x:(F.x%P+P)%P,y:(F.y%R+R)%R},d.current=F}nu(s.current,a.current,d.current,[],{width:((E=o.current)==null?void 0:E.width)||800,height:((_=o.current)==null?void 0:_.height)||600},!0),c.current=v});return ge.useEffect(()=>(S(),y),[S,y]),ye.jsxs(HO,{children:[ye.jsx(FO,{ref:o}),ye.jsxs(LO,{children:[ye.jsx(UO,{children:"Tribe2"}),ye.jsxs(GO,{children:[ye.jsx(Xy,{onClick:h,children:"New Game"}),t&&ye.jsx(Xy,{onClick:p,children:"Load Game"})]}),ye.jsxs(xO,{children:["by"," ",ye.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function $O(){console.log("Tribe game initialized with detailed 2D world state.");const e=vk();return e.ecosystem={preyGestationPeriod:er,preyProcreationCooldown:tr,predatorGestationPeriod:nr,predatorProcreationCooldown:ir,preyHungerIncreasePerHour:So,predatorHungerIncreasePerHour:Io,berryBushSpreadChance:Ui,treeSpreadChance:Gi},e.debugPanel=je.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const WO=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:o,playerActionHintsRef:s})=>(ge.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const c=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,nu(t.current,n.current,o.current,s.current,{width:a.width,height:a.height},!1))};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),ye.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),YO=(e,t,n,o=!1)=>{var c,d;let s;const a=D1(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:de.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:de.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const u=a;t.isAdult&&Za(t,u,n)?s={action:de.AutopilotAttack,targetEntityId:u.id}:ps(t,u,n)?s={action:de.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:de.AutopilotFeedChild,targetEntityId:u.id})}else if(a.type==="prey")s={action:de.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:de.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const u=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&cr(t,u,n)&&u.isConstructed?s={action:de.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:de.Removal,position:a.position};else if(t.leaderId===t.id&&cr(t,u,n)&&u.isConstructed)Kv(u.position,lr,t.id,n).valid?s={action:de.TakeOverBuilding,targetEntityId:u.id}:s={action:de.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const h=u.ownerId===t.leaderId,p=u.storedItems.length>0,y=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(o&&u.isConstructed&&p&&t.food.length<t.maxFood)if(h)s={action:de.AutopilotRetrieve,targetEntityId:a.id};else{const S=t.leaderId?n.entities.entities[t.leaderId]:void 0;S&&((c=S.tribeControl)!=null&&c.diplomacy)?(u.ownerId&&S.tribeControl.diplomacy[u.ownerId])===At.Hostile?s={action:de.AutopilotGather,targetEntityId:a.id}:s={action:de.AutopilotMove,position:e}:s={action:de.AutopilotMove,position:e}}else h&&u.isConstructed?(t.food.length>0||t.heldItem)&&y?s={action:de.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&p?s={action:de.AutopilotRetrieve,targetEntityId:a.id}:s={action:de.AutopilotMove,position:e}:s={action:de.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(h=>h.type===ti.Berry).length>=sr&&!$i(e,n,uu)&&!dr(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:de.AutopilotPlant,position:e}:u.buildingType===Z.Bonfire&&((d=t.heldItem)==null?void 0:d.type)===Ot.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:de.AutopilotDeposit,targetEntityId:u.id}:s={action:de.AutopilotMove,position:e}}else if(a.type==="tree"){const u=a,[h]=u.stateMachine??[],p=h===Vn||h===Hn||h===gi;t.isAdult&&!t.heldItem&&p?s={action:de.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&h===Gt&&u.wood.length>0?s={action:de.AutopilotGather,targetEntityId:u.id}:s={action:de.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===ti.Berry).length>=sr&&(n.autopilotControls.isManuallyPlanting||Qa(e,n,t))&&!dr(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:de.AutopilotPlant,position:e}:s={action:de.AutopilotMove,position:e};return s},zO=(e,t)=>{if(e.isPaused)return;const n=wt(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=X(n.position,t,e.mapDimensions.width,e.mapDimensions.height),c=100;a<=c?Ga(t,s,n.leaderId,e,n.position,c)&&(Xh(t,s,n.leaderId,e),e.selectedBuildingType=null):Ga(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:de.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=W1(t,e);s&&ph(s.id,e);return}const o=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,o?(e.autopilotControls.activeAutopilotAction=o,(o.action===de.AutopilotMove||o.action===de.AutopilotGather||o.action===de.AutopilotChop)&&(e.hasPlayerMovedEver=!0),o.action===de.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:de.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},jO=(e,t)=>{var c,d,u,h,p,y;const n=e.key.toLowerCase(),o=e.ctrlKey||e.metaKey;let s=!0,a=t;if(o){switch(n){case"s":Rh(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:S}=t;S.activeAutopilotAction||S.isManuallyMoving||S.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(S.activeAutopilotAction=void 0,S.isManuallyMoving=!1,S.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"m":t.isMuted=!t.isMuted,Ca(t.masterVolume,t.isMuted);break;case"=":case"+":const v=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(v.toFixed(1)),Ca(t.masterVolume,t.isMuted);break;case"-":const A=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(A.toFixed(1)),Ca(t.masterVolume,t.isMuted);break;case"t":a=Cu(t,PS);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===je.General?(a.debugPanel=je.None,a.debugCharacterId=void 0):(a.debugPanel=je.General,a.debugCharacterId||(a.debugCharacterId=((c=wt(a))==null?void 0:c.id)??((d=Object.values(a.entities.entities).find(I=>I.type==="human"||I.type==="prey"||I.type==="predator"))==null?void 0:d.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===je.Ecosystem){a.debugPanel=je.None;break}a.debugPanel=je.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((u=wt(a))==null?void 0:u.id)??((h=Object.values(a.entities.entities).find(I=>I.type==="human"||I.type==="prey"||I.type==="predator"))==null?void 0:h.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===je.Tribe){a.debugPanel=je.None;break}a.debugPanel=je.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((p=wt(a))==null?void 0:p.id)??((y=a.search.human.all().find(I=>I.leaderId===I.id))==null?void 0:y.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===je.Performance){a.debugPanel=je.None;break}a.debugPanel=je.Performance}else s=!1;break;case"tab":if(a.debugPanel!==je.General&&a.debugPanel!==je.Tribe&&(a.debugPanel=je.General),a.debugPanel===je.General){const I=Object.values(a.entities.entities).filter(E=>E.type==="human"||E.type==="prey"||E.type==="predator");if(I.length>0){const E=I.sort((R,C)=>{if(R.type==="human"&&R.isPlayer)return-1;if(C.type==="human"&&C.isPlayer)return 1;if(R.type!==C.type){const k={human:0,prey:1,predator:2},D=k[R.type]??999,F=k[C.type]??999;return D-F}return R.id-C.id}),_=a.debugCharacterId,P=((_?E.findIndex(R=>R.id===_):-1)+1)%E.length;a.debugCharacterId=E[P].id}else a.debugCharacterId=void 0}else if(a.debugPanel===je.Tribe){const I=a.search.human.all().filter(_=>_.leaderId===_.id);let E=I.findIndex(_=>_.id===a.debugCharacterId)+1;(E===-1||E>I.length-1)&&(E=0),a.debugCharacterId=I[E].id}else a.debugPanel=je.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},XO=(e,t,n,o,s)=>{var c;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",Ce(a,Ie.ButtonClick,o.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",Ce(a,Ie.ButtonClick,o.position);return}else if(e==="3"){n.selectedBuildingType="palisade",Ce(a,Ie.ButtonClick,o.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",Ce(a,Ie.ButtonClick,o.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",Ce(a,Ie.ButtonClick,o.position);return}else if(e==="6"){n.selectedBuildingType="removal",Ce(a,Ie.ButtonClick,o.position);return}else if(e==="7"){n.selectedBuildingType="gate",Ce(a,Ie.ButtonClick,o.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=Xe(o,n,"berryBush",Ve,p=>p.food.length>0&&o.food.length<o.maxFood),u=Xe(o,n,"corpse",Ve,p=>p.food.length>0&&o.food.length<o.maxFood);let h=null;d&&u?h=X(o.position,d.position,n.mapDimensions.width,n.mapDimensions.height)<=X(o.position,u.position,n.mapDimensions.width,n.mapDimensions.height)?d:u:h=d||u,h&&(o.activeAction="gathering",Ce(a,Ie.Gather,o.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}Xe(o,n,"human",Ve,u=>ps(o,u,n))&&(o.activeAction="procreating",Ce(a,Ie.Procreate,o.position))}else if(e==="f")o.food.length>0&&(o.activeAction="eating",Ce(a,Ie.Eat,o.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=s.find(u=>u.type===de.FeedChild);d&&d.targetEntity&&(o.activeAction="feeding",o.target=d.targetEntity.id)}else if(e==="arrowup"||e==="w")o.direction.y=-1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")o.direction.y=1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")o.direction.x=-1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")o.direction.x=1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const d=Xe(o,n,"human",dn,u=>Za(o,u,n))??Xe(o,n,"predator",dn)??Xe(o,n,"prey",dn);d&&(o.activeAction="attacking",o.attackTargetId=d.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===de.Plant)){const u=u1(o.position,n,50,ch);u&&(o.activeAction="planting",o.target=u,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=Xe(o,n,"building",Jn,h=>{const p=h;return p.buildingType===Z.Bonfire&&p.isConstructed&&p.storedItems.length<(p.storageCapacity||0)});if(((c=o.heldItem)==null?void 0:c.type)===Ot.Wood&&d){o.activeAction="depositing",o.target=d.id,Ce(a,Ie.StorageDeposit,o.position);return}const u=Xe(o,n,"building",Jn,h=>{const p=h;return p.buildingType===Z.StorageSpot&&p.ownerId===o.leaderId&&p.isConstructed&&p.storageCapacity!==void 0&&p.storedItems.length<p.storageCapacity});u&&(o.activeAction="idle",o.target=u.id,Ce(a,Ie.StorageDeposit,o.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=Xe(o,n,"building",Jn,u=>{const h=u;return h.buildingType==="storageSpot"&&h.ownerId===o.leaderId&&h.isConstructed&&h.storedItems.length>0});d&&(o.activeAction="idle",o.target=d.id,Ce(a,Ie.StorageRetrieve,o.position))}else if(e==="k")BS(o,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,Ce(a,Ie.ButtonClick,o.position)}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const d=Xe(o,n,"tree",fu,u=>u.wood&&u.wood.length>0&&!o.heldItem);d&&(o.activeAction="chopping",o.target=d.id)}},VO=(e,t,n,o)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!o.current.has("arrowup")&&!o.current.has("arrowdown")&&!o.current.has("arrowleft")&&!o.current.has("arrowright")&&!o.current.has("w")&&!o.current.has("a")&&!o.current.has("s")&&!o.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!o.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!o.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!o.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!o.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!o.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},qO=(e,t,n)=>{const{mapDimensions:o}=e,{width:s,height:a}=o;if(!e.cameraFollowingPlayer){if(e.cameraTargetPosition){const u=Le(t,e.cameraTargetPosition,s,a);if(Eo(u)<1){const S=e.cameraTargetPosition;return e.cameraTargetPosition=void 0,S}const p=pi(t,u);let y=Fc(t,p,$c*n);return y={x:(y.x%s+s)%s,y:(y.y%a+a)%a},y}return t}let d=wt(e);if(e.debugCharacterId){const u=e.entities.entities[e.debugCharacterId];u&&"position"in u&&(d=u)}if(d){let u={...d.position};const h=u.x-t.x;Math.abs(h)>s/2&&(h>0?u.x-=s:u.x+=s);const p=u.y-t.y;Math.abs(p)>a/2&&(p>0?u.y-=a:u.y+=a);let y=Fc(t,u,$c*n);return y={x:(y.x%s+s)%s,y:(y.y%a+a)%a},y}return e.viewportCenter};function ZO(e,t){const{width:n,height:o}=e.mapDimensions;e.cameraTargetPosition=void 0,e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%o+o)%o}}const KO=(e,t,n,o)=>{var u,h;const s={gameState:n},a=wt(n);a&&Ce(s,Ie.ButtonClick,a.position);const c=n.uiButtons.find(p=>p.id===e.id);c&&(c.lastActivated=Date.now()),t&&[fe.CommandGather,fe.CommandPlant,fe.ToggleProcreationBehavior,fe.CommandBuild].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:d}=n.autopilotControls;switch(e.action){case fe.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case fe.ConfirmExitYes:o(),n.exitConfirmation="inactive";break;case fe.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case fe.ToggleMute:n.isMuted=!n.isMuted,Ca(n.masterVolume,n.isMuted);break;case fe.TogglePause:n.isPaused=!n.isPaused;break;case fe.FastForward:return Cu(n,PS);case fe.DismissTutorial:n.tutorialState.isActive=!1;break;case fe.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case fe.CommandGather:t?d.gathering=!d.gathering:a&&(a.activeAction="gathering");break;case fe.CommandPlant:t?d.planting=!d.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case fe.ToggleProcreationBehavior:d.procreation=!d.procreation;break;case fe.ToggleAttackBehavior:d.attack=!d.attack;break;case fe.ToggleFeedChildBehavior:d.feedChildren=!d.feedChildren;break;case fe.CommandTribeSplit:a&&BS(a,n);break;case fe.CommandBuild:t?d.build=!d.build:n.buildMenuOpen=!n.buildMenuOpen;break;case fe.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case fe.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case fe.SelectRemovalTool:n.selectedBuildingType="removal";break;case fe.SelectBorderPost:n.selectedBuildingType="borderPost";break;case fe.SelectBonfire:n.selectedBuildingType="bonfire";break;case fe.SelectPalisade:n.selectedBuildingType="palisade";break;case fe.SelectGate:n.selectedBuildingType="gate";break;case fe.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const p=a.leaderId,y=e.targetTribeId,S=n.entities.entities[y],v=(u=a.tribeControl)==null?void 0:u.diplomacy,A=(h=S==null?void 0:S.tribeControl)==null?void 0:h.diplomacy;if(v&&A){const E=(v[y]||At.Friendly)===At.Friendly?At.Hostile:At.Friendly;v[y]=E,A[p]=E}}break;case fe.OpenTribeModal:n.tribeModalOpen=!0;break;case fe.RecenterCamera:n.cameraFollowingPlayer=!0;break;case fe.CloseTribeModal:n.tribeModalOpen=!1;break}return n};function QO(e,t,n){if(!e.notificationButtonRects)return!1;const o=wt(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return a1(e,s),o&&Ce({gameState:e},Ie.ButtonClick,o.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const c=e.notifications.find(d=>d.id===s);if(c){let d=c.targetPosition;if(!d&&c.targetEntityIds&&c.targetEntityIds.length>0){const u=e.entities.entities[c.targetEntityIds[0]];u&&(d=u.position)}return d&&ZO(e,d),o&&Ce({gameState:e},Ie.ButtonClick,o.position),c.highlightedEntityIds&&(c.renderHighlights=!c.renderHighlights),!0}}return!1}function BI(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const JO=(e,t)=>{var n;if(t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(BI(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},eN=(e,t)=>t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:BI(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},qy=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},tN=(e,t)=>{var n,o;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const c=t.debugPanelRect.height-60,d=Math.max(0,(((o=t.debugPanelContentSize)==null?void 0:o.height)??0)-c);return t.debugPanelScroll.y>d&&(t.debugPanelScroll.y=d),{newState:t,handled:!0}}return{newState:t,handled:!1}};function nN(e,t,n){if(!n.minimapRect)return;const{x:o,y:s,width:a,height:c}=n.minimapRect;e>=o&&e<=o+a&&t>=s&&t<=s+c&&(n.isDraggingMinimap=!0,n.minimapDragDistance=0)}function iN(e,t,n,o){n.isDraggingMinimap&&(n.isDraggingMinimap=!1,n.minimapDragDistance<5&&rN(e,t,n,o,!1))}function oN(e,t,n,o,s){if(!n.minimapRect){n.hoveredMinimapTribeId=null;return}if(n.isDraggingMinimap){if(o){n.minimapDragDistance+=Math.sqrt(o.x*o.x+o.y*o.y),n.cameraFollowingPlayer=!1,n.cameraTargetPosition=void 0;const{width:c,height:d}=n.mapDimensions,{width:u,height:h}=n.minimapRect,p=o.x/u*c,y=o.y/h*d,S=n.viewportCenter.x-p,v=n.viewportCenter.y-y,A={x:(S%c+c)%c,y:(v%d+d)%d};n.viewportCenter=A,s&&(s.current=A)}return}const a=HI(e,t,n.minimapRect,n);a?n.hoveredMinimapTribeId=Qn(a.x,a.y,n):n.hoveredMinimapTribeId=null}function rN(e,t,n,o,s=!1){if(!n.minimapRect)return;const a=HI(e,t,n.minimapRect,n);a&&(n.cameraFollowingPlayer=!1,s?(n.viewportCenter=a,n.cameraTargetPosition=void 0,o&&(o.current=a)):n.cameraTargetPosition=a)}function sN(e,t,n,o,s){if(!o.minimapRect)return!1;const{x:a,y:c,width:d,height:u}=o.minimapRect;if(t>=a&&t<=a+d&&n>=c&&n<=c+u){o.cameraFollowingPlayer=!1,o.cameraTargetPosition=void 0;const{width:h,height:p}=o.mapDimensions,y=e.deltaX/d*h,S=e.deltaY/u*p,v=o.viewportCenter.x+y,A=o.viewportCenter.y+S,I={x:(v%h+h)%h,y:(A%p+p)%p};return o.viewportCenter=I,s&&(s.current=I),!0}return!1}function HI(e,t,n,o){const s=e-n.x,a=t-n.y;if(s<0||s>n.width||a<0||a>n.height)return null;const{width:c,height:d}=o.mapDimensions,u=n.width/2,h=n.height/2,p=s-u,y=a-h,S=p/n.width*c,v=y/n.height*d,A=o.viewportCenter.x+S,I=o.viewportCenter.y+v;return{x:(A%c+c)%c,y:(I%d+d)%d}}function aN(e,t,n){t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,a=t.viewportCenter.x+e.deltaX,c=t.viewportCenter.y+e.deltaY,d={x:(a%o+o)%o,y:(c%s+s)%s};return t.viewportCenter=d,n.current=d,!0}function lN(e,t){(e.button===1||e.button===2)&&(t.isDraggingViewport=!0,t.viewportDragButton=e.button,t.viewportDragDistance=0)}function cN(e,t,n){if(t.isDraggingViewport){t.viewportDragDistance+=Math.sqrt(e.movementX*e.movementX+e.movementY*e.movementY),t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,a=t.viewportCenter.x-e.movementX,c=t.viewportCenter.y-e.movementY,d={x:(a%o+o)%o,y:(c%s+s)%s};t.viewportCenter=d,n.current=d}}function uN(e,t){t.isDraggingViewport&&e.button===t.viewportDragButton&&(t.isDraggingViewport=!1,t.viewportDragButton=null)}const dN=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:a,returnToIntro:c})=>(ge.useEffect(()=>{const d=u=>{if(!e()||t.current.gameOver||!n.current)return;const h=n.current.getBoundingClientRect(),p=u.clientX-h.left,y=u.clientY-h.top;if(sN(u,p,y,t.current,o)){u.preventDefault();return}const S=JO(u,t.current);t.current=S.newState,!S.handled&&aN(u,t.current,o)&&u.preventDefault()};return window.addEventListener("wheel",d,{passive:!1}),()=>{window.removeEventListener("wheel",d)}},[e,n,t,o]),ge.useEffect(()=>{const d=h=>{if(!e()||t.current.gameOver||!n.current||!h.target||h.target!==n.current)return;const p=n.current.getBoundingClientRect(),y=h.clientX-p.left,S=h.clientY-p.top;if(QO(t.current,y,S))return;const A=t.current.uiButtons.find(w=>y>=w.rect.x&&y<=w.rect.x+w.rect.width&&S>=w.rect.y&&S<=w.rect.y+w.rect.height);if(A){t.current=KO(A,h.shiftKey,t.current,c);return}const I=t.current.minimapRect;if(I&&y>=I.x&&y<=I.x+I.width&&S>=I.y&&S<=I.y+I.height){nN(y,S,t.current);return}const E=eN(h,t.current);if(t.current=E.newState,E.handled)return;lN(h,t.current);const _=Ih({x:y,y:S},o.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);zO(t.current,_)},u=h=>{if(!e()||!n.current)return;const p=n.current.getBoundingClientRect(),y=h.clientX-p.left,S=h.clientY-p.top;iN(y,S,t.current,o),uN(h,t.current);const v=qy(h,t.current);t.current=v.newState};return window.addEventListener("mousedown",d),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("mouseup",u)}},[e,n,t,o,c]),ge.useEffect(()=>{const d=u=>{if(!e()||!n.current)return;const h=tN(u,t.current);if(t.current=h.newState,h.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const _=qy(u,t.current);t.current=_.newState}const p=n.current.getBoundingClientRect(),y=u.clientX-p.left,S=u.clientY-p.top;cN(u,t.current,o),t.current.mousePosition={x:y,y:S};let v;if(t.current.notificationButtonRects){for(const[_,w]of Object.entries(t.current.notificationButtonRects.dismiss))if(y>=w.x&&y<=w.x+w.width&&S>=w.y&&S<=w.y+w.height){v=`notification-dismiss-${_}`;break}if(!v){for(const[_,w]of Object.entries(t.current.notificationButtonRects.view))if(y>=w.x&&y<=w.x+w.width&&S>=w.y&&S<=w.y+w.height){v=`notification-view-${_}`;break}}}if(!v)for(let _=t.current.uiButtons.length-1;_>=0;_--){const w=t.current.uiButtons[_];if(y>=w.rect.x&&y<=w.rect.x+w.rect.width&&S>=w.rect.y&&S<=w.rect.y+w.rect.height){v=w.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0,t.current.hoveredMinimapTribeId=null;return}const A=t.current.minimapRect,I=t.current.isDraggingMinimap;if(A&&y>=A.x&&y<=A.x+A.width&&S>=A.y&&S<=A.y+A.height||I){oN(y,S,t.current,{x:u.movementX,y:u.movementY},o),t.current.autopilotControls.hoveredAutopilotAction=void 0;return}else t.current.hoveredMinimapTribeId=null;const E=wt(t.current);if(E){const _=Ih({x:y,y:S},o.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=YO(_,E,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}},[e,n,t,o]),ge.useEffect(()=>{const d=h=>{if(!e()||t.current.gameOver)return;const p=h.key.toLowerCase();(p===" "||p==="p"||p==="tab"||(h.ctrlKey||h.metaKey)&&(p==="s"||p==="a"))&&h.preventDefault();const y=jO(h,t.current);if(t.current=y.newState,y.handled)return;const S=wt(t.current);S&&(a.current.add(p),XO(p,h.shiftKey,t.current,S,s.current))},u=h=>{if(!e()||t.current.gameOver)return;const p=h.key.toLowerCase();a.current.delete(p);const y=wt(t.current);y&&VO(p,y,t.current,a)};return window.addEventListener("keydown",d),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}},[e,t,s,a,c]),ge.useEffect(()=>{const d=n.current;if(!d)return;const u=h=>{e()&&h.preventDefault()};return d.addEventListener("contextmenu",u),()=>{d.removeEventListener("contextmenu",u)}},[n,e]),null),fN=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:a,canvasRef:c,setAppState:d,appState:u})=>{const h=ge.useRef(),{returnToIntro:p}=ko(),[y,S,v]=Mv(A=>{var R,C;if(!t.current||!h.current){h.current=A;return}const I=Math.min(A-h.current,1e3)/1e3,{performanceMetrics:E}=e.current;E.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const _=performance.now();e.current=Cu(e.current,I),E.currentBucket.worldUpdateTime=performance.now()-_;const w=wt(e.current);w?s.current=op(e.current,w):s.current=[],(e.current.viewportCenter.x!==o.current.x||e.current.viewportCenter.y!==o.current.y)&&(o.current=e.current.viewportCenter),o.current=qO(e.current,o.current,I),e.current.viewportCenter=o.current;const P=performance.now();nu(t.current,e.current,o.current,s.current,{width:((R=c.current)==null?void 0:R.width)||800,height:((C=c.current)==null?void 0:C.height)||600},!1),E.currentBucket.renderTime=performance.now()-P,E.history.push({bucketTime:e.current.time,...E.currentBucket}),E.history.length>yw&&E.history.shift(),h.current=A,e.current.gameOver&&u!=="gameOver"&&(tp(Ie.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),d("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return ge.useEffect(()=>(S(),y),[S,y]),ye.jsx(dN,{isActive:v,gameStateRef:e,canvasRef:c,viewportCenterRef:o,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:p})},Zy=()=>{const{savedGameState:e,contextReady:t}=ko(),[n,o]=ge.useState(null);return ge.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),o(e)):(console.log("Initializing new game state..."),o($O())))},[t,e]),!t||!n?ye.jsx("div",{children:"Loading..."}):ye.jsx(hN,{initialState:n})},hN=({initialState:e})=>{const t=ge.useRef(null),n=ge.useRef(null),o=ge.useRef(e),s=ge.useRef(new Set),a=ge.useRef(e.debugPanel),c=ge.useRef(e.viewportCenter),d=ge.useRef([]),{appState:u,setAppState:h}=ko();return ye.jsxs(ye.Fragment,{children:[ye.jsx(WO,{canvasRef:t,ctxRef:n,gameStateRef:o,debugPanelTypeRef:a,viewportCenterRef:c,playerActionHintsRef:d}),ye.jsx(fN,{gameStateRef:o,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:c,playerActionHintsRef:d,keysPressed:s,canvasRef:t,setAppState:h,appState:u})]})},pN=qe.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,gN=qe.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Rc=qe.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,mN=qe.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,yN=()=>{const{setAppState:e,gameOverDetails:t}=ko(),n=()=>{e("intro")};return ye.jsxs(pN,{children:[ye.jsx(gN,{children:"Game Over"}),ye.jsx(Rc,{children:"Your tribe's lineage has ended."}),t&&ye.jsxs(ye.Fragment,{children:[ye.jsxs(Rc,{children:["Generations Survived: ",t.generations]}),ye.jsxs(Rc,{children:["Cause of Extinction: ",t.cause]})]}),!t&&ye.jsx(Rc,{children:"Game details are unavailable."}),ye.jsx(mN,{onClick:n,children:"Return to Menu"})]})},vN=qe.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,SN=qe.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,IN=qe.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,TN=qe.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,AN=qe.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,FI=qe.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,EN=qe(FI)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,ha=800,pa=600,wN=()=>{const{returnToIntro:e}=ko(),t=ge.useRef(null),n=ge.useRef(),o=ge.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:ha,height:pa}}),s=c=>{const d={x:ha/2,y:pa/2};let u;c===Se.StoneProjectile&&(u={x:d.x+200*(Math.random()-Math.random()),y:d.y+200*(Math.random()-Math.random())}),Oe(o.current,c,d,1,void 0,u)};ge.useEffect(()=>{const c=()=>{o.current.time+=.016,yI(o.current);const u=t.current,h=u==null?void 0:u.getContext("2d");h&&(h.clearRect(0,0,ha,pa),h.fillStyle="#2c5234",h.fillRect(0,0,ha,pa),o.current.visualEffects.forEach(p=>{MI(h,p,o.current.time,o.current)})),n.current=requestAnimationFrame(c)};return n.current=requestAnimationFrame(c),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(Se).filter(c=>isNaN(Number(c))).map(c=>({name:c,value:Se[c]}));return ye.jsxs(vN,{children:[ye.jsxs(SN,{children:[ye.jsx(AN,{children:"Visual Effects"}),a.map(c=>ye.jsx(FI,{onClick:()=>s(c.value),children:c.name},c.name)),ye.jsx(EN,{onClick:e,children:"Back to Intro"})]}),ye.jsxs(IN,{children:[ye.jsx(TN,{ref:t,width:ha,height:pa}),ye.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},_N=qe.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,CN=qe.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,PN=qe.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,RN=qe.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,MN=qe.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,Ky=qe.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,Th=qe.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,kN=qe(Th)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,DN=qe.label`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  cursor: pointer;

  input {
    margin-right: 8px;
  }
`,On=800,Nn=600,bN=(e,t)=>{const n=e.reduce((s,a)=>(s[a.id]=a,s),{});n[1]={id:1,type:"human",leaderId:1,isPlayer:!0,tribeInfo:{tribeBadge:"",tribeColor:"#4CAF50"},position:{x:0,y:0},radius:10,isAdult:!0,gender:"male",age:25},n[2]={id:2,type:"human",leaderId:2,isPlayer:!1,tribeInfo:{tribeBadge:"",tribeColor:"#F44336"},position:{x:0,y:0},radius:10,isAdult:!0,gender:"male",age:30,tribeControl:{diplomacy:{1:"Hostile"}}};const o={time:0,mapDimensions:{width:On,height:Nn},entities:{entities:n},terrainOwnership:t,notifications:[],visualEffects:[],tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[]},plantingZoneConnections:{}};return o.search={building:{all:()=>e,byRadius:(s,a)=>e.filter(c=>X(s,c.position,On,Nn)<=a),byRect:()=>e,byProperty:(s,a)=>e.filter(c=>c[s]===a)},human:{all:()=>[n[1],n[2]],byProperty:(s,a)=>Object.values(n).filter(c=>c.type==="human"&&c[s]===a),byRadius:()=>[],byRect:()=>Object.values(n).filter(s=>s.type==="human")},berryBush:{byRect:()=>[],all:()=>[]},tree:{byRect:()=>[],all:()=>[]},corpse:{byRect:()=>[],all:()=>[]},prey:{byRect:()=>[],all:()=>[]},predator:{byRect:()=>[],all:()=>[]},tasks:{byRect:()=>[],all:()=>[]}},o},ON=(e,t,n,o)=>{const s=ei[t];return{id:e,type:"building",buildingType:t,position:n,ownerId:o,constructionProgress:1,destructionProgress:0,isConstructed:!0,isBeingDestroyed:!1,width:s.dimensions.width,height:s.dimensions.height,storedItems:[],storageCapacity:10,radius:Math.max(s.dimensions.width,s.dimensions.height)/2,direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:De.create()}},NN=()=>{const{returnToIntro:e}=ko(),t=ge.useRef(null),n=ge.useRef(),[o,s]=ge.useState(Z.Palisade),[a,c]=ge.useState(!1),[d,u]=ge.useState([]),[h,p]=ge.useState(null),[y,S]=ge.useState(10),[v,A]=ge.useState(new Array(Math.ceil(On/Ae)*Math.ceil(Nn/Ae)).fill(null)),I=ge.useCallback((P,R)=>{const C=Fe;return{x:Math.round(P/C)*C,y:Math.round(R/C)*C}},[]),E=ge.useCallback(P=>{const R=t.current;if(!R)return;const C=R.getBoundingClientRect(),k=P.clientX-C.left,D=P.clientY-C.top,F=I(k,D);if(!d.some(Y=>Math.abs(Y.position.x-F.x)<5&&Math.abs(Y.position.y-F.y)<5)){const Y=a?2:1,G=ON(y,o,F,Y),j=[...v],ee={mapDimensions:{width:On,height:Nn},terrainOwnership:j},V=o===Z.BorderPost?_h:lr;jh(F,V,Y,ee),A(j),o!==Z.BorderPost&&u(te=>[...te,G]),S(te=>te+1)}},[o,a,y,I,d,v]),_=ge.useCallback(P=>{const R=t.current;if(!R)return;const C=R.getBoundingClientRect(),k=P.clientX-C.left,D=P.clientY-C.top;p(I(k,D))},[I]),w=ge.useCallback(()=>{u([]),S(10),A(new Array(Math.ceil(On/Ae)*Math.ceil(Nn/Ae)).fill(null))},[]);return ge.useEffect(()=>{const P=()=>{const R=t.current,C=R==null?void 0:R.getContext("2d");if(!C)return;const k={x:On/2,y:Nn/2},D=bN(d,v);C.fillStyle="#2c5234",C.fillRect(0,0,On,Nn),NI(C,D,k,{width:On,height:Nn},1),OI(C,D,k,1),C.strokeStyle="rgba(255,255,255,0.05)",C.lineWidth=1;for(let F=0;F<=On;F+=Fe)C.beginPath(),C.moveTo(F,0),C.lineTo(F,Nn),C.stroke();for(let F=0;F<=Nn;F+=Fe)C.beginPath(),C.moveTo(0,F),C.lineTo(On,F),C.stroke();for(const F of d)F.buildingType!==Z.PlantingZone&&DI(C,F,D);h&&bI(C,h,o,!0,{width:On,height:Nn}),n.current=requestAnimationFrame(P)};return n.current=requestAnimationFrame(P),()=>{n.current&&cancelAnimationFrame(n.current)}},[d,h,o,v]),ye.jsxs(_N,{children:[ye.jsxs(CN,{children:[ye.jsx(MN,{children:"Building Test"}),ye.jsx(Ky,{children:"Settings"}),ye.jsxs(DN,{children:[ye.jsx("input",{type:"checkbox",checked:a,onChange:P=>c(P.target.checked)}),"Show as Hostile"]}),ye.jsx(Ky,{children:"Building Type"}),Object.values(Z).map(P=>ye.jsxs(Th,{onClick:()=>s(P),style:{backgroundColor:o===P?"#666":"#444",borderLeft:o===P?"3px solid #4CAF50":"none"},children:[ei[P].icon," ",ei[P].name]},P)),ye.jsx(Th,{onClick:w,style:{backgroundColor:"#a33",marginTop:"20px",textAlign:"center"},children:" Clear All"}),ye.jsx(kN,{onClick:e,children:"Back to Intro"})]}),ye.jsxs(PN,{children:[ye.jsx(RN,{ref:t,width:On,height:Nn,onClick:E,onMouseMove:_,onMouseLeave:()=>p(null),style:{cursor:"crosshair"}}),ye.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Click to place buildings. Test palisade connectivity by placing them adjacent to each other."})]})]})},BN=uw`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function HN(e,t){ge.useEffect(()=>{const n=()=>{const o=document.location.hash;t(o==="#game"?"game":o==="#effects"?"effects":o==="#buildings"?"buildings":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),ge.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const FN=()=>{const{appState:e,setAppState:t}=ko();HN(e,t);const n=()=>{switch(e){case"intro":return ye.jsx(Vy,{});case"game":return ye.jsx(Zy,{});case"effects":return ye.jsx(wN,{});case"buildings":return ye.jsx(NN,{});case"gameOver":return ye.jsxs(ye.Fragment,{children:[ye.jsx(Zy,{}),ye.jsx(yN,{})]});default:return ye.jsx(Vy,{})}};return ye.jsxs(ye.Fragment,{children:[ye.jsx(BN,{}),n()]})},Qy=document.getElementById("root");Qy?AC().then(()=>{zA.createRoot(Qy).render(ye.jsx(hi.StrictMode,{children:ye.jsx(cE,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:ye.jsx(FN,{})})}))}):console.error("Failed to find the root element");
