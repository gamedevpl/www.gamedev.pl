var kC=Object.defineProperty;var bC=(e,t,n)=>t in e?kC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Re=(e,t,n)=>bC(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function $v(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Fh={exports:{}},rl={},Lh={exports:{}},Ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hy;function BC(){if(Hy)return Ye;Hy=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.iterator;function S(F){return F===null||typeof F!="object"?null:(F=m&&F[m]||F["@@iterator"],typeof F=="function"?F:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,I={};function T(F,Y,ue){this.props=F,this.context=Y,this.refs=I,this.updater=ue||v}T.prototype.isReactComponent={},T.prototype.setState=function(F,Y){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,Y,"setState")},T.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function P(){}P.prototype=T.prototype;function R(F,Y,ue){this.props=F,this.context=Y,this.refs=I,this.updater=ue||v}var w=R.prototype=new P;w.constructor=R,A(w,T.prototype),w.isPureReactComponent=!0;var k=Array.isArray,M=Object.prototype.hasOwnProperty,D={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function b(F,Y,ue){var pe,Pe={},me=null,Me=null;if(Y!=null)for(pe in Y.ref!==void 0&&(Me=Y.ref),Y.key!==void 0&&(me=""+Y.key),Y)M.call(Y,pe)&&!N.hasOwnProperty(pe)&&(Pe[pe]=Y[pe]);var De=arguments.length-2;if(De===1)Pe.children=ue;else if(1<De){for(var fe=Array(De),ve=0;ve<De;ve++)fe[ve]=arguments[ve+2];Pe.children=fe}if(F&&F.defaultProps)for(pe in De=F.defaultProps,De)Pe[pe]===void 0&&(Pe[pe]=De[pe]);return{$$typeof:e,type:F,key:me,ref:Me,props:Pe,_owner:D.current}}function H(F,Y){return{$$typeof:e,type:F.type,key:Y,ref:F.ref,props:F.props,_owner:F._owner}}function z(F){return typeof F=="object"&&F!==null&&F.$$typeof===e}function V(F){var Y={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(ue){return Y[ue]})}var j=/\/+/g;function ee(F,Y){return typeof F=="object"&&F!==null&&F.key!=null?V(""+F.key):Y.toString(36)}function ne(F,Y,ue,pe,Pe){var me=typeof F;(me==="undefined"||me==="boolean")&&(F=null);var Me=!1;if(F===null)Me=!0;else switch(me){case"string":case"number":Me=!0;break;case"object":switch(F.$$typeof){case e:case t:Me=!0}}if(Me)return Me=F,Pe=Pe(Me),F=pe===""?"."+ee(Me,0):pe,k(Pe)?(ue="",F!=null&&(ue=F.replace(j,"$&/")+"/"),ne(Pe,Y,ue,"",function(ve){return ve})):Pe!=null&&(z(Pe)&&(Pe=H(Pe,ue+(!Pe.key||Me&&Me.key===Pe.key?"":(""+Pe.key).replace(j,"$&/")+"/")+F)),Y.push(Pe)),1;if(Me=0,pe=pe===""?".":pe+":",k(F))for(var De=0;De<F.length;De++){me=F[De];var fe=pe+ee(me,De);Me+=ne(me,Y,ue,fe,Pe)}else if(fe=S(F),typeof fe=="function")for(F=fe.call(F),De=0;!(me=F.next()).done;)me=me.value,fe=pe+ee(me,De++),Me+=ne(me,Y,ue,fe,Pe);else if(me==="object")throw Y=String(F),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.");return Me}function Se(F,Y,ue){if(F==null)return F;var pe=[],Pe=0;return ne(F,pe,"","",function(me){return Y.call(ue,me,Pe++)}),pe}function ce(F){if(F._status===-1){var Y=F._result;Y=Y(),Y.then(function(ue){(F._status===0||F._status===-1)&&(F._status=1,F._result=ue)},function(ue){(F._status===0||F._status===-1)&&(F._status=2,F._result=ue)}),F._status===-1&&(F._status=0,F._result=Y)}if(F._status===1)return F._result.default;throw F._result}var oe={current:null},X={transition:null},q={ReactCurrentDispatcher:oe,ReactCurrentBatchConfig:X,ReactCurrentOwner:D};function Z(){throw Error("act(...) is not supported in production builds of React.")}return Ye.Children={map:Se,forEach:function(F,Y,ue){Se(F,function(){Y.apply(this,arguments)},ue)},count:function(F){var Y=0;return Se(F,function(){Y++}),Y},toArray:function(F){return Se(F,function(Y){return Y})||[]},only:function(F){if(!z(F))throw Error("React.Children.only expected to receive a single React element child.");return F}},Ye.Component=T,Ye.Fragment=n,Ye.Profiler=s,Ye.PureComponent=R,Ye.StrictMode=i,Ye.Suspense=u,Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=q,Ye.act=Z,Ye.cloneElement=function(F,Y,ue){if(F==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+F+".");var pe=A({},F.props),Pe=F.key,me=F.ref,Me=F._owner;if(Y!=null){if(Y.ref!==void 0&&(me=Y.ref,Me=D.current),Y.key!==void 0&&(Pe=""+Y.key),F.type&&F.type.defaultProps)var De=F.type.defaultProps;for(fe in Y)M.call(Y,fe)&&!N.hasOwnProperty(fe)&&(pe[fe]=Y[fe]===void 0&&De!==void 0?De[fe]:Y[fe])}var fe=arguments.length-2;if(fe===1)pe.children=ue;else if(1<fe){De=Array(fe);for(var ve=0;ve<fe;ve++)De[ve]=arguments[ve+2];pe.children=De}return{$$typeof:e,type:F.type,key:Pe,ref:me,props:pe,_owner:Me}},Ye.createContext=function(F){return F={$$typeof:l,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},F.Provider={$$typeof:a,_context:F},F.Consumer=F},Ye.createElement=b,Ye.createFactory=function(F){var Y=b.bind(null,F);return Y.type=F,Y},Ye.createRef=function(){return{current:null}},Ye.forwardRef=function(F){return{$$typeof:d,render:F}},Ye.isValidElement=z,Ye.lazy=function(F){return{$$typeof:g,_payload:{_status:-1,_result:F},_init:ce}},Ye.memo=function(F,Y){return{$$typeof:f,type:F,compare:Y===void 0?null:Y}},Ye.startTransition=function(F){var Y=X.transition;X.transition={};try{F()}finally{X.transition=Y}},Ye.unstable_act=Z,Ye.useCallback=function(F,Y){return oe.current.useCallback(F,Y)},Ye.useContext=function(F){return oe.current.useContext(F)},Ye.useDebugValue=function(){},Ye.useDeferredValue=function(F){return oe.current.useDeferredValue(F)},Ye.useEffect=function(F,Y){return oe.current.useEffect(F,Y)},Ye.useId=function(){return oe.current.useId()},Ye.useImperativeHandle=function(F,Y,ue){return oe.current.useImperativeHandle(F,Y,ue)},Ye.useInsertionEffect=function(F,Y){return oe.current.useInsertionEffect(F,Y)},Ye.useLayoutEffect=function(F,Y){return oe.current.useLayoutEffect(F,Y)},Ye.useMemo=function(F,Y){return oe.current.useMemo(F,Y)},Ye.useReducer=function(F,Y,ue){return oe.current.useReducer(F,Y,ue)},Ye.useRef=function(F){return oe.current.useRef(F)},Ye.useState=function(F){return oe.current.useState(F)},Ye.useSyncExternalStore=function(F,Y,ue){return oe.current.useSyncExternalStore(F,Y,ue)},Ye.useTransition=function(){return oe.current.useTransition()},Ye.version="18.3.1",Ye}var Gy;function Jg(){return Gy||(Gy=1,Lh.exports=BC()),Lh.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $y;function FC(){if($y)return rl;$y=1;var e=Jg(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(d,u,f){var g,m={},S=null,v=null;f!==void 0&&(S=""+f),u.key!==void 0&&(S=""+u.key),u.ref!==void 0&&(v=u.ref);for(g in u)i.call(u,g)&&!a.hasOwnProperty(g)&&(m[g]=u[g]);if(d&&d.defaultProps)for(g in u=d.defaultProps,u)m[g]===void 0&&(m[g]=u[g]);return{$$typeof:t,type:d,key:S,ref:v,props:m,_owner:s.current}}return rl.Fragment=n,rl.jsx=l,rl.jsxs=l,rl}var xy;function LC(){return xy||(xy=1,Fh.exports=FC()),Fh.exports}var Ue=LC(),Be=Jg();const Bi=$v(Be);var gd={},Uh={exports:{}},Rn={},Hh={exports:{}},Gh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wy;function UC(){return Wy||(Wy=1,function(e){function t(X,q){var Z=X.length;X.push(q);e:for(;0<Z;){var F=Z-1>>>1,Y=X[F];if(0<s(Y,q))X[F]=q,X[Z]=Y,Z=F;else break e}}function n(X){return X.length===0?null:X[0]}function i(X){if(X.length===0)return null;var q=X[0],Z=X.pop();if(Z!==q){X[0]=Z;e:for(var F=0,Y=X.length,ue=Y>>>1;F<ue;){var pe=2*(F+1)-1,Pe=X[pe],me=pe+1,Me=X[me];if(0>s(Pe,Z))me<Y&&0>s(Me,Pe)?(X[F]=Me,X[me]=Z,F=me):(X[F]=Pe,X[pe]=Z,F=pe);else if(me<Y&&0>s(Me,Z))X[F]=Me,X[me]=Z,F=me;else break e}}return q}function s(X,q){var Z=X.sortIndex-q.sortIndex;return Z!==0?Z:X.id-q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var l=Date,d=l.now();e.unstable_now=function(){return l.now()-d}}var u=[],f=[],g=1,m=null,S=3,v=!1,A=!1,I=!1,T=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(X){for(var q=n(f);q!==null;){if(q.callback===null)i(f);else if(q.startTime<=X)i(f),q.sortIndex=q.expirationTime,t(u,q);else break;q=n(f)}}function k(X){if(I=!1,w(X),!A)if(n(u)!==null)A=!0,ce(M);else{var q=n(f);q!==null&&oe(k,q.startTime-X)}}function M(X,q){A=!1,I&&(I=!1,P(b),b=-1),v=!0;var Z=S;try{for(w(q),m=n(u);m!==null&&(!(m.expirationTime>q)||X&&!V());){var F=m.callback;if(typeof F=="function"){m.callback=null,S=m.priorityLevel;var Y=F(m.expirationTime<=q);q=e.unstable_now(),typeof Y=="function"?m.callback=Y:m===n(u)&&i(u),w(q)}else i(u);m=n(u)}if(m!==null)var ue=!0;else{var pe=n(f);pe!==null&&oe(k,pe.startTime-q),ue=!1}return ue}finally{m=null,S=Z,v=!1}}var D=!1,N=null,b=-1,H=5,z=-1;function V(){return!(e.unstable_now()-z<H)}function j(){if(N!==null){var X=e.unstable_now();z=X;var q=!0;try{q=N(!0,X)}finally{q?ee():(D=!1,N=null)}}else D=!1}var ee;if(typeof R=="function")ee=function(){R(j)};else if(typeof MessageChannel<"u"){var ne=new MessageChannel,Se=ne.port2;ne.port1.onmessage=j,ee=function(){Se.postMessage(null)}}else ee=function(){T(j,0)};function ce(X){N=X,D||(D=!0,ee())}function oe(X,q){b=T(function(){X(e.unstable_now())},q)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(X){X.callback=null},e.unstable_continueExecution=function(){A||v||(A=!0,ce(M))},e.unstable_forceFrameRate=function(X){0>X||125<X?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<X?Math.floor(1e3/X):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(X){switch(S){case 1:case 2:case 3:var q=3;break;default:q=S}var Z=S;S=q;try{return X()}finally{S=Z}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(X,q){switch(X){case 1:case 2:case 3:case 4:case 5:break;default:X=3}var Z=S;S=X;try{return q()}finally{S=Z}},e.unstable_scheduleCallback=function(X,q,Z){var F=e.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?F+Z:F):Z=F,X){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=Z+Y,X={id:g++,callback:q,priorityLevel:X,startTime:Z,expirationTime:Y,sortIndex:-1},Z>F?(X.sortIndex=Z,t(f,X),n(u)===null&&X===n(f)&&(I?(P(b),b=-1):I=!0,oe(k,Z-F))):(X.sortIndex=Y,t(u,X),A||v||(A=!0,ce(M))),X},e.unstable_shouldYield=V,e.unstable_wrapCallback=function(X){var q=S;return function(){var Z=S;S=q;try{return X.apply(this,arguments)}finally{S=Z}}}}(Gh)),Gh}var Yy;function HC(){return Yy||(Yy=1,Hh.exports=UC()),Hh.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zy;function GC(){if(zy)return Rn;zy=1;var e=Jg(),t=HC();function n(o){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+o,c=1;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+o+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function a(o,r){l(o,r),l(o+"Capture",r)}function l(o,r){for(s[o]=r,o=0;o<r.length;o++)i.add(r[o])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},m={};function S(o){return u.call(m,o)?!0:u.call(g,o)?!1:f.test(o)?m[o]=!0:(g[o]=!0,!1)}function v(o,r,c,h){if(c!==null&&c.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return h?!1:c!==null?!c.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function A(o,r,c,h){if(r===null||typeof r>"u"||v(o,r,c,h))return!0;if(h)return!1;if(c!==null)switch(c.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function I(o,r,c,h,p,y,_){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=h,this.attributeNamespace=p,this.mustUseProperty=c,this.propertyName=o,this.type=r,this.sanitizeURL=y,this.removeEmptyString=_}var T={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){T[o]=new I(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var r=o[0];T[r]=new I(r,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){T[o]=new I(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){T[o]=new I(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){T[o]=new I(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){T[o]=new I(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){T[o]=new I(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){T[o]=new I(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){T[o]=new I(o,5,!1,o.toLowerCase(),null,!1,!1)});var P=/[\-:]([a-z])/g;function R(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var r=o.replace(P,R);T[r]=new I(r,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var r=o.replace(P,R);T[r]=new I(r,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var r=o.replace(P,R);T[r]=new I(r,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){T[o]=new I(o,1,!1,o.toLowerCase(),null,!1,!1)}),T.xlinkHref=new I("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){T[o]=new I(o,1,!1,o.toLowerCase(),null,!0,!0)});function w(o,r,c,h){var p=T.hasOwnProperty(r)?T[r]:null;(p!==null?p.type!==0:h||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(A(r,c,p,h)&&(c=null),h||p===null?S(r)&&(c===null?o.removeAttribute(r):o.setAttribute(r,""+c)):p.mustUseProperty?o[p.propertyName]=c===null?p.type===3?!1:"":c:(r=p.attributeName,h=p.attributeNamespace,c===null?o.removeAttribute(r):(p=p.type,c=p===3||p===4&&c===!0?"":""+c,h?o.setAttributeNS(h,r,c):o.setAttribute(r,c))))}var k=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),D=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),b=Symbol.for("react.strict_mode"),H=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),V=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),ee=Symbol.for("react.suspense"),ne=Symbol.for("react.suspense_list"),Se=Symbol.for("react.memo"),ce=Symbol.for("react.lazy"),oe=Symbol.for("react.offscreen"),X=Symbol.iterator;function q(o){return o===null||typeof o!="object"?null:(o=X&&o[X]||o["@@iterator"],typeof o=="function"?o:null)}var Z=Object.assign,F;function Y(o){if(F===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);F=r&&r[1]||""}return`
`+F+o}var ue=!1;function pe(o,r){if(!o||ue)return"";ue=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(W){var h=W}Reflect.construct(o,[],r)}else{try{r.call()}catch(W){h=W}o.call(r.prototype)}else{try{throw Error()}catch(W){h=W}o()}}catch(W){if(W&&h&&typeof W.stack=="string"){for(var p=W.stack.split(`
`),y=h.stack.split(`
`),_=p.length-1,O=y.length-1;1<=_&&0<=O&&p[_]!==y[O];)O--;for(;1<=_&&0<=O;_--,O--)if(p[_]!==y[O]){if(_!==1||O!==1)do if(_--,O--,0>O||p[_]!==y[O]){var B=`
`+p[_].replace(" at new "," at ");return o.displayName&&B.includes("<anonymous>")&&(B=B.replace("<anonymous>",o.displayName)),B}while(1<=_&&0<=O);break}}}finally{ue=!1,Error.prepareStackTrace=c}return(o=o?o.displayName||o.name:"")?Y(o):""}function Pe(o){switch(o.tag){case 5:return Y(o.type);case 16:return Y("Lazy");case 13:return Y("Suspense");case 19:return Y("SuspenseList");case 0:case 2:case 15:return o=pe(o.type,!1),o;case 11:return o=pe(o.type.render,!1),o;case 1:return o=pe(o.type,!0),o;default:return""}}function me(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case N:return"Fragment";case D:return"Portal";case H:return"Profiler";case b:return"StrictMode";case ee:return"Suspense";case ne:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case V:return(o.displayName||"Context")+".Consumer";case z:return(o._context.displayName||"Context")+".Provider";case j:var r=o.render;return o=o.displayName,o||(o=r.displayName||r.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case Se:return r=o.displayName||null,r!==null?r:me(o.type)||"Memo";case ce:r=o._payload,o=o._init;try{return me(o(r))}catch{}}return null}function Me(o){var r=o.type;switch(o.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=r.render,o=o.displayName||o.name||"",r.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return me(r);case 8:return r===b?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function De(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function fe(o){var r=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function ve(o){var r=fe(o)?"checked":"value",c=Object.getOwnPropertyDescriptor(o.constructor.prototype,r),h=""+o[r];if(!o.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,y=c.set;return Object.defineProperty(o,r,{configurable:!0,get:function(){return p.call(this)},set:function(_){h=""+_,y.call(this,_)}}),Object.defineProperty(o,r,{enumerable:c.enumerable}),{getValue:function(){return h},setValue:function(_){h=""+_},stopTracking:function(){o._valueTracker=null,delete o[r]}}}}function xe(o){o._valueTracker||(o._valueTracker=ve(o))}function Te(o){if(!o)return!1;var r=o._valueTracker;if(!r)return!0;var c=r.getValue(),h="";return o&&(h=fe(o)?o.checked?"true":"false":o.value),o=h,o!==c?(r.setValue(o),!0):!1}function si(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function nt(o,r){var c=r.checked;return Z({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??o._wrapperState.initialChecked})}function at(o,r){var c=r.defaultValue==null?"":r.defaultValue,h=r.checked!=null?r.checked:r.defaultChecked;c=De(r.value!=null?r.value:c),o._wrapperState={initialChecked:h,initialValue:c,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function vi(o,r){r=r.checked,r!=null&&w(o,"checked",r,!1)}function In(o,r){vi(o,r);var c=De(r.value),h=r.type;if(c!=null)h==="number"?(c===0&&o.value===""||o.value!=c)&&(o.value=""+c):o.value!==""+c&&(o.value=""+c);else if(h==="submit"||h==="reset"){o.removeAttribute("value");return}r.hasOwnProperty("value")?Ai(o,r.type,c):r.hasOwnProperty("defaultValue")&&Ai(o,r.type,De(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(o.defaultChecked=!!r.defaultChecked)}function Xn(o,r,c){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var h=r.type;if(!(h!=="submit"&&h!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+o._wrapperState.initialValue,c||r===o.value||(o.value=r),o.defaultValue=r}c=o.name,c!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,c!==""&&(o.name=c)}function Ai(o,r,c){(r!=="number"||si(o.ownerDocument)!==o)&&(c==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+c&&(o.defaultValue=""+c))}var Ii=Array.isArray;function ho(o,r,c,h){if(o=o.options,r){r={};for(var p=0;p<c.length;p++)r["$"+c[p]]=!0;for(c=0;c<o.length;c++)p=r.hasOwnProperty("$"+o[c].value),o[c].selected!==p&&(o[c].selected=p),p&&h&&(o[c].defaultSelected=!0)}else{for(c=""+De(c),r=null,p=0;p<o.length;p++){if(o[p].value===c){o[p].selected=!0,h&&(o[p].defaultSelected=!0);return}r!==null||o[p].disabled||(r=o[p])}r!==null&&(r.selected=!0)}}function sr(o,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return Z({},r,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function Kp(o,r){var c=r.value;if(c==null){if(c=r.children,r=r.defaultValue,c!=null){if(r!=null)throw Error(n(92));if(Ii(c)){if(1<c.length)throw Error(n(93));c=c[0]}r=c}r==null&&(r=""),c=r}o._wrapperState={initialValue:De(c)}}function qp(o,r){var c=De(r.value),h=De(r.defaultValue);c!=null&&(c=""+c,c!==o.value&&(o.value=c),r.defaultValue==null&&o.defaultValue!==c&&(o.defaultValue=c)),h!=null&&(o.defaultValue=""+h)}function Zp(o){var r=o.textContent;r===o._wrapperState.initialValue&&r!==""&&r!==null&&(o.value=r)}function Qp(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ju(o,r){return o==null||o==="http://www.w3.org/1999/xhtml"?Qp(r):o==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var sc,Jp=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,c,h,p){MSApp.execUnsafeLocalFunction(function(){return o(r,c,h,p)})}:o}(function(o,r){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=r;else{for(sc=sc||document.createElement("div"),sc.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=sc.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;r.firstChild;)o.appendChild(r.firstChild)}});function Ia(o,r){if(r){var c=o.firstChild;if(c&&c===o.lastChild&&c.nodeType===3){c.nodeValue=r;return}}o.textContent=r}var Ta={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},LT=["Webkit","ms","Moz","O"];Object.keys(Ta).forEach(function(o){LT.forEach(function(r){r=r+o.charAt(0).toUpperCase()+o.substring(1),Ta[r]=Ta[o]})});function em(o,r,c){return r==null||typeof r=="boolean"||r===""?"":c||typeof r!="number"||r===0||Ta.hasOwnProperty(o)&&Ta[o]?(""+r).trim():r+"px"}function tm(o,r){o=o.style;for(var c in r)if(r.hasOwnProperty(c)){var h=c.indexOf("--")===0,p=em(c,r[c],h);c==="float"&&(c="cssFloat"),h?o.setProperty(c,p):o[c]=p}}var UT=Z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Xu(o,r){if(r){if(UT[o]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,o));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function Vu(o,r){if(o.indexOf("-")===-1)return typeof r.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ku=null;function qu(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Zu=null,Jr=null,es=null;function nm(o){if(o=Ya(o)){if(typeof Zu!="function")throw Error(n(280));var r=o.stateNode;r&&(r=Dc(r),Zu(o.stateNode,o.type,r))}}function im(o){Jr?es?es.push(o):es=[o]:Jr=o}function om(){if(Jr){var o=Jr,r=es;if(es=Jr=null,nm(o),r)for(o=0;o<r.length;o++)nm(r[o])}}function rm(o,r){return o(r)}function sm(){}var Qu=!1;function am(o,r,c){if(Qu)return o(r,c);Qu=!0;try{return rm(o,r,c)}finally{Qu=!1,(Jr!==null||es!==null)&&(sm(),om())}}function Ea(o,r){var c=o.stateNode;if(c===null)return null;var h=Dc(c);if(h===null)return null;c=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(o=o.type,h=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!h;break e;default:o=!1}if(o)return null;if(c&&typeof c!="function")throw Error(n(231,r,typeof c));return c}var Ju=!1;if(d)try{var Ca={};Object.defineProperty(Ca,"passive",{get:function(){Ju=!0}}),window.addEventListener("test",Ca,Ca),window.removeEventListener("test",Ca,Ca)}catch{Ju=!1}function HT(o,r,c,h,p,y,_,O,B){var W=Array.prototype.slice.call(arguments,3);try{r.apply(c,W)}catch(Q){this.onError(Q)}}var _a=!1,ac=null,lc=!1,ef=null,GT={onError:function(o){_a=!0,ac=o}};function $T(o,r,c,h,p,y,_,O,B){_a=!1,ac=null,HT.apply(GT,arguments)}function xT(o,r,c,h,p,y,_,O,B){if($T.apply(this,arguments),_a){if(_a){var W=ac;_a=!1,ac=null}else throw Error(n(198));lc||(lc=!0,ef=W)}}function ar(o){var r=o,c=o;if(o.alternate)for(;r.return;)r=r.return;else{o=r;do r=o,(r.flags&4098)!==0&&(c=r.return),o=r.return;while(o)}return r.tag===3?c:null}function lm(o){if(o.tag===13){var r=o.memoizedState;if(r===null&&(o=o.alternate,o!==null&&(r=o.memoizedState)),r!==null)return r.dehydrated}return null}function cm(o){if(ar(o)!==o)throw Error(n(188))}function WT(o){var r=o.alternate;if(!r){if(r=ar(o),r===null)throw Error(n(188));return r!==o?null:o}for(var c=o,h=r;;){var p=c.return;if(p===null)break;var y=p.alternate;if(y===null){if(h=p.return,h!==null){c=h;continue}break}if(p.child===y.child){for(y=p.child;y;){if(y===c)return cm(p),o;if(y===h)return cm(p),r;y=y.sibling}throw Error(n(188))}if(c.return!==h.return)c=p,h=y;else{for(var _=!1,O=p.child;O;){if(O===c){_=!0,c=p,h=y;break}if(O===h){_=!0,h=p,c=y;break}O=O.sibling}if(!_){for(O=y.child;O;){if(O===c){_=!0,c=y,h=p;break}if(O===h){_=!0,h=y,c=p;break}O=O.sibling}if(!_)throw Error(n(189))}}if(c.alternate!==h)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?o:r}function dm(o){return o=WT(o),o!==null?um(o):null}function um(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var r=um(o);if(r!==null)return r;o=o.sibling}return null}var fm=t.unstable_scheduleCallback,hm=t.unstable_cancelCallback,YT=t.unstable_shouldYield,zT=t.unstable_requestPaint,It=t.unstable_now,jT=t.unstable_getCurrentPriorityLevel,tf=t.unstable_ImmediatePriority,gm=t.unstable_UserBlockingPriority,cc=t.unstable_NormalPriority,XT=t.unstable_LowPriority,pm=t.unstable_IdlePriority,dc=null,Ti=null;function VT(o){if(Ti&&typeof Ti.onCommitFiberRoot=="function")try{Ti.onCommitFiberRoot(dc,o,void 0,(o.current.flags&128)===128)}catch{}}var ai=Math.clz32?Math.clz32:ZT,KT=Math.log,qT=Math.LN2;function ZT(o){return o>>>=0,o===0?32:31-(KT(o)/qT|0)|0}var uc=64,fc=4194304;function wa(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function hc(o,r){var c=o.pendingLanes;if(c===0)return 0;var h=0,p=o.suspendedLanes,y=o.pingedLanes,_=c&268435455;if(_!==0){var O=_&~p;O!==0?h=wa(O):(y&=_,y!==0&&(h=wa(y)))}else _=c&~p,_!==0?h=wa(_):y!==0&&(h=wa(y));if(h===0)return 0;if(r!==0&&r!==h&&(r&p)===0&&(p=h&-h,y=r&-r,p>=y||p===16&&(y&4194240)!==0))return r;if((h&4)!==0&&(h|=c&16),r=o.entangledLanes,r!==0)for(o=o.entanglements,r&=h;0<r;)c=31-ai(r),p=1<<c,h|=o[c],r&=~p;return h}function QT(o,r){switch(o){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function JT(o,r){for(var c=o.suspendedLanes,h=o.pingedLanes,p=o.expirationTimes,y=o.pendingLanes;0<y;){var _=31-ai(y),O=1<<_,B=p[_];B===-1?((O&c)===0||(O&h)!==0)&&(p[_]=QT(O,r)):B<=r&&(o.expiredLanes|=O),y&=~O}}function nf(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function mm(){var o=uc;return uc<<=1,(uc&4194240)===0&&(uc=64),o}function of(o){for(var r=[],c=0;31>c;c++)r.push(o);return r}function Ra(o,r,c){o.pendingLanes|=r,r!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,r=31-ai(r),o[r]=c}function eE(o,r){var c=o.pendingLanes&~r;o.pendingLanes=r,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=r,o.mutableReadLanes&=r,o.entangledLanes&=r,r=o.entanglements;var h=o.eventTimes;for(o=o.expirationTimes;0<c;){var p=31-ai(c),y=1<<p;r[p]=0,h[p]=-1,o[p]=-1,c&=~y}}function rf(o,r){var c=o.entangledLanes|=r;for(o=o.entanglements;c;){var h=31-ai(c),p=1<<h;p&r|o[h]&r&&(o[h]|=r),c&=~p}}var tt=0;function ym(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var Sm,sf,vm,Am,Im,af=!1,gc=[],go=null,po=null,mo=null,Pa=new Map,Da=new Map,yo=[],tE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Tm(o,r){switch(o){case"focusin":case"focusout":go=null;break;case"dragenter":case"dragleave":po=null;break;case"mouseover":case"mouseout":mo=null;break;case"pointerover":case"pointerout":Pa.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Da.delete(r.pointerId)}}function Na(o,r,c,h,p,y){return o===null||o.nativeEvent!==y?(o={blockedOn:r,domEventName:c,eventSystemFlags:h,nativeEvent:y,targetContainers:[p]},r!==null&&(r=Ya(r),r!==null&&sf(r)),o):(o.eventSystemFlags|=h,r=o.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),o)}function nE(o,r,c,h,p){switch(r){case"focusin":return go=Na(go,o,r,c,h,p),!0;case"dragenter":return po=Na(po,o,r,c,h,p),!0;case"mouseover":return mo=Na(mo,o,r,c,h,p),!0;case"pointerover":var y=p.pointerId;return Pa.set(y,Na(Pa.get(y)||null,o,r,c,h,p)),!0;case"gotpointercapture":return y=p.pointerId,Da.set(y,Na(Da.get(y)||null,o,r,c,h,p)),!0}return!1}function Em(o){var r=lr(o.target);if(r!==null){var c=ar(r);if(c!==null){if(r=c.tag,r===13){if(r=lm(c),r!==null){o.blockedOn=r,Im(o.priority,function(){vm(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){o.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}o.blockedOn=null}function pc(o){if(o.blockedOn!==null)return!1;for(var r=o.targetContainers;0<r.length;){var c=cf(o.domEventName,o.eventSystemFlags,r[0],o.nativeEvent);if(c===null){c=o.nativeEvent;var h=new c.constructor(c.type,c);Ku=h,c.target.dispatchEvent(h),Ku=null}else return r=Ya(c),r!==null&&sf(r),o.blockedOn=c,!1;r.shift()}return!0}function Cm(o,r,c){pc(o)&&c.delete(r)}function iE(){af=!1,go!==null&&pc(go)&&(go=null),po!==null&&pc(po)&&(po=null),mo!==null&&pc(mo)&&(mo=null),Pa.forEach(Cm),Da.forEach(Cm)}function Ma(o,r){o.blockedOn===r&&(o.blockedOn=null,af||(af=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,iE)))}function Oa(o){function r(p){return Ma(p,o)}if(0<gc.length){Ma(gc[0],o);for(var c=1;c<gc.length;c++){var h=gc[c];h.blockedOn===o&&(h.blockedOn=null)}}for(go!==null&&Ma(go,o),po!==null&&Ma(po,o),mo!==null&&Ma(mo,o),Pa.forEach(r),Da.forEach(r),c=0;c<yo.length;c++)h=yo[c],h.blockedOn===o&&(h.blockedOn=null);for(;0<yo.length&&(c=yo[0],c.blockedOn===null);)Em(c),c.blockedOn===null&&yo.shift()}var ts=k.ReactCurrentBatchConfig,mc=!0;function oE(o,r,c,h){var p=tt,y=ts.transition;ts.transition=null;try{tt=1,lf(o,r,c,h)}finally{tt=p,ts.transition=y}}function rE(o,r,c,h){var p=tt,y=ts.transition;ts.transition=null;try{tt=4,lf(o,r,c,h)}finally{tt=p,ts.transition=y}}function lf(o,r,c,h){if(mc){var p=cf(o,r,c,h);if(p===null)wf(o,r,h,yc,c),Tm(o,h);else if(nE(p,o,r,c,h))h.stopPropagation();else if(Tm(o,h),r&4&&-1<tE.indexOf(o)){for(;p!==null;){var y=Ya(p);if(y!==null&&Sm(y),y=cf(o,r,c,h),y===null&&wf(o,r,h,yc,c),y===p)break;p=y}p!==null&&h.stopPropagation()}else wf(o,r,h,null,c)}}var yc=null;function cf(o,r,c,h){if(yc=null,o=qu(h),o=lr(o),o!==null)if(r=ar(o),r===null)o=null;else if(c=r.tag,c===13){if(o=lm(r),o!==null)return o;o=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;o=null}else r!==o&&(o=null);return yc=o,null}function _m(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(jT()){case tf:return 1;case gm:return 4;case cc:case XT:return 16;case pm:return 536870912;default:return 16}default:return 16}}var So=null,df=null,Sc=null;function wm(){if(Sc)return Sc;var o,r=df,c=r.length,h,p="value"in So?So.value:So.textContent,y=p.length;for(o=0;o<c&&r[o]===p[o];o++);var _=c-o;for(h=1;h<=_&&r[c-h]===p[y-h];h++);return Sc=p.slice(o,1<h?1-h:void 0)}function vc(o){var r=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&r===13&&(o=13)):o=r,o===10&&(o=13),32<=o||o===13?o:0}function Ac(){return!0}function Rm(){return!1}function Mn(o){function r(c,h,p,y,_){this._reactName=c,this._targetInst=p,this.type=h,this.nativeEvent=y,this.target=_,this.currentTarget=null;for(var O in o)o.hasOwnProperty(O)&&(c=o[O],this[O]=c?c(y):y[O]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Ac:Rm,this.isPropagationStopped=Rm,this}return Z(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Ac)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Ac)},persist:function(){},isPersistent:Ac}),r}var ns={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},uf=Mn(ns),ka=Z({},ns,{view:0,detail:0}),sE=Mn(ka),ff,hf,ba,Ic=Z({},ka,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pf,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==ba&&(ba&&o.type==="mousemove"?(ff=o.screenX-ba.screenX,hf=o.screenY-ba.screenY):hf=ff=0,ba=o),ff)},movementY:function(o){return"movementY"in o?o.movementY:hf}}),Pm=Mn(Ic),aE=Z({},Ic,{dataTransfer:0}),lE=Mn(aE),cE=Z({},ka,{relatedTarget:0}),gf=Mn(cE),dE=Z({},ns,{animationName:0,elapsedTime:0,pseudoElement:0}),uE=Mn(dE),fE=Z({},ns,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),hE=Mn(fE),gE=Z({},ns,{data:0}),Dm=Mn(gE),pE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},mE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},yE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function SE(o){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(o):(o=yE[o])?!!r[o]:!1}function pf(){return SE}var vE=Z({},ka,{key:function(o){if(o.key){var r=pE[o.key]||o.key;if(r!=="Unidentified")return r}return o.type==="keypress"?(o=vc(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?mE[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pf,charCode:function(o){return o.type==="keypress"?vc(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?vc(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),AE=Mn(vE),IE=Z({},Ic,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Nm=Mn(IE),TE=Z({},ka,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pf}),EE=Mn(TE),CE=Z({},ns,{propertyName:0,elapsedTime:0,pseudoElement:0}),_E=Mn(CE),wE=Z({},Ic,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),RE=Mn(wE),PE=[9,13,27,32],mf=d&&"CompositionEvent"in window,Ba=null;d&&"documentMode"in document&&(Ba=document.documentMode);var DE=d&&"TextEvent"in window&&!Ba,Mm=d&&(!mf||Ba&&8<Ba&&11>=Ba),Om=" ",km=!1;function bm(o,r){switch(o){case"keyup":return PE.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Bm(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var is=!1;function NE(o,r){switch(o){case"compositionend":return Bm(r);case"keypress":return r.which!==32?null:(km=!0,Om);case"textInput":return o=r.data,o===Om&&km?null:o;default:return null}}function ME(o,r){if(is)return o==="compositionend"||!mf&&bm(o,r)?(o=wm(),Sc=df=So=null,is=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Mm&&r.locale!=="ko"?null:r.data;default:return null}}var OE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Fm(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r==="input"?!!OE[o.type]:r==="textarea"}function Lm(o,r,c,h){im(h),r=wc(r,"onChange"),0<r.length&&(c=new uf("onChange","change",null,c,h),o.push({event:c,listeners:r}))}var Fa=null,La=null;function kE(o){t0(o,0)}function Tc(o){var r=ls(o);if(Te(r))return o}function bE(o,r){if(o==="change")return r}var Um=!1;if(d){var yf;if(d){var Sf="oninput"in document;if(!Sf){var Hm=document.createElement("div");Hm.setAttribute("oninput","return;"),Sf=typeof Hm.oninput=="function"}yf=Sf}else yf=!1;Um=yf&&(!document.documentMode||9<document.documentMode)}function Gm(){Fa&&(Fa.detachEvent("onpropertychange",$m),La=Fa=null)}function $m(o){if(o.propertyName==="value"&&Tc(La)){var r=[];Lm(r,La,o,qu(o)),am(kE,r)}}function BE(o,r,c){o==="focusin"?(Gm(),Fa=r,La=c,Fa.attachEvent("onpropertychange",$m)):o==="focusout"&&Gm()}function FE(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Tc(La)}function LE(o,r){if(o==="click")return Tc(r)}function UE(o,r){if(o==="input"||o==="change")return Tc(r)}function HE(o,r){return o===r&&(o!==0||1/o===1/r)||o!==o&&r!==r}var li=typeof Object.is=="function"?Object.is:HE;function Ua(o,r){if(li(o,r))return!0;if(typeof o!="object"||o===null||typeof r!="object"||r===null)return!1;var c=Object.keys(o),h=Object.keys(r);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var p=c[h];if(!u.call(r,p)||!li(o[p],r[p]))return!1}return!0}function xm(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Wm(o,r){var c=xm(o);o=0;for(var h;c;){if(c.nodeType===3){if(h=o+c.textContent.length,o<=r&&h>=r)return{node:c,offset:r-o};o=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=xm(c)}}function Ym(o,r){return o&&r?o===r?!0:o&&o.nodeType===3?!1:r&&r.nodeType===3?Ym(o,r.parentNode):"contains"in o?o.contains(r):o.compareDocumentPosition?!!(o.compareDocumentPosition(r)&16):!1:!1}function zm(){for(var o=window,r=si();r instanceof o.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)o=r.contentWindow;else break;r=si(o.document)}return r}function vf(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r&&(r==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||r==="textarea"||o.contentEditable==="true")}function GE(o){var r=zm(),c=o.focusedElem,h=o.selectionRange;if(r!==c&&c&&c.ownerDocument&&Ym(c.ownerDocument.documentElement,c)){if(h!==null&&vf(c)){if(r=h.start,o=h.end,o===void 0&&(o=r),"selectionStart"in c)c.selectionStart=r,c.selectionEnd=Math.min(o,c.value.length);else if(o=(r=c.ownerDocument||document)&&r.defaultView||window,o.getSelection){o=o.getSelection();var p=c.textContent.length,y=Math.min(h.start,p);h=h.end===void 0?y:Math.min(h.end,p),!o.extend&&y>h&&(p=h,h=y,y=p),p=Wm(c,y);var _=Wm(c,h);p&&_&&(o.rangeCount!==1||o.anchorNode!==p.node||o.anchorOffset!==p.offset||o.focusNode!==_.node||o.focusOffset!==_.offset)&&(r=r.createRange(),r.setStart(p.node,p.offset),o.removeAllRanges(),y>h?(o.addRange(r),o.extend(_.node,_.offset)):(r.setEnd(_.node,_.offset),o.addRange(r)))}}for(r=[],o=c;o=o.parentNode;)o.nodeType===1&&r.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<r.length;c++)o=r[c],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var $E=d&&"documentMode"in document&&11>=document.documentMode,os=null,Af=null,Ha=null,If=!1;function jm(o,r,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;If||os==null||os!==si(h)||(h=os,"selectionStart"in h&&vf(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Ha&&Ua(Ha,h)||(Ha=h,h=wc(Af,"onSelect"),0<h.length&&(r=new uf("onSelect","select",null,r,c),o.push({event:r,listeners:h}),r.target=os)))}function Ec(o,r){var c={};return c[o.toLowerCase()]=r.toLowerCase(),c["Webkit"+o]="webkit"+r,c["Moz"+o]="moz"+r,c}var rs={animationend:Ec("Animation","AnimationEnd"),animationiteration:Ec("Animation","AnimationIteration"),animationstart:Ec("Animation","AnimationStart"),transitionend:Ec("Transition","TransitionEnd")},Tf={},Xm={};d&&(Xm=document.createElement("div").style,"AnimationEvent"in window||(delete rs.animationend.animation,delete rs.animationiteration.animation,delete rs.animationstart.animation),"TransitionEvent"in window||delete rs.transitionend.transition);function Cc(o){if(Tf[o])return Tf[o];if(!rs[o])return o;var r=rs[o],c;for(c in r)if(r.hasOwnProperty(c)&&c in Xm)return Tf[o]=r[c];return o}var Vm=Cc("animationend"),Km=Cc("animationiteration"),qm=Cc("animationstart"),Zm=Cc("transitionend"),Qm=new Map,Jm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function vo(o,r){Qm.set(o,r),a(r,[o])}for(var Ef=0;Ef<Jm.length;Ef++){var Cf=Jm[Ef],xE=Cf.toLowerCase(),WE=Cf[0].toUpperCase()+Cf.slice(1);vo(xE,"on"+WE)}vo(Vm,"onAnimationEnd"),vo(Km,"onAnimationIteration"),vo(qm,"onAnimationStart"),vo("dblclick","onDoubleClick"),vo("focusin","onFocus"),vo("focusout","onBlur"),vo(Zm,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ga="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),YE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ga));function e0(o,r,c){var h=o.type||"unknown-event";o.currentTarget=c,xT(h,r,void 0,o),o.currentTarget=null}function t0(o,r){r=(r&4)!==0;for(var c=0;c<o.length;c++){var h=o[c],p=h.event;h=h.listeners;e:{var y=void 0;if(r)for(var _=h.length-1;0<=_;_--){var O=h[_],B=O.instance,W=O.currentTarget;if(O=O.listener,B!==y&&p.isPropagationStopped())break e;e0(p,O,W),y=B}else for(_=0;_<h.length;_++){if(O=h[_],B=O.instance,W=O.currentTarget,O=O.listener,B!==y&&p.isPropagationStopped())break e;e0(p,O,W),y=B}}}if(lc)throw o=ef,lc=!1,ef=null,o}function lt(o,r){var c=r[Of];c===void 0&&(c=r[Of]=new Set);var h=o+"__bubble";c.has(h)||(n0(r,o,2,!1),c.add(h))}function _f(o,r,c){var h=0;r&&(h|=4),n0(c,o,h,r)}var _c="_reactListening"+Math.random().toString(36).slice(2);function $a(o){if(!o[_c]){o[_c]=!0,i.forEach(function(c){c!=="selectionchange"&&(YE.has(c)||_f(c,!1,o),_f(c,!0,o))});var r=o.nodeType===9?o:o.ownerDocument;r===null||r[_c]||(r[_c]=!0,_f("selectionchange",!1,r))}}function n0(o,r,c,h){switch(_m(r)){case 1:var p=oE;break;case 4:p=rE;break;default:p=lf}c=p.bind(null,r,c,o),p=void 0,!Ju||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),h?p!==void 0?o.addEventListener(r,c,{capture:!0,passive:p}):o.addEventListener(r,c,!0):p!==void 0?o.addEventListener(r,c,{passive:p}):o.addEventListener(r,c,!1)}function wf(o,r,c,h,p){var y=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var _=h.tag;if(_===3||_===4){var O=h.stateNode.containerInfo;if(O===p||O.nodeType===8&&O.parentNode===p)break;if(_===4)for(_=h.return;_!==null;){var B=_.tag;if((B===3||B===4)&&(B=_.stateNode.containerInfo,B===p||B.nodeType===8&&B.parentNode===p))return;_=_.return}for(;O!==null;){if(_=lr(O),_===null)return;if(B=_.tag,B===5||B===6){h=y=_;continue e}O=O.parentNode}}h=h.return}am(function(){var W=y,Q=qu(c),J=[];e:{var K=Qm.get(o);if(K!==void 0){var ge=uf,Ae=o;switch(o){case"keypress":if(vc(c)===0)break e;case"keydown":case"keyup":ge=AE;break;case"focusin":Ae="focus",ge=gf;break;case"focusout":Ae="blur",ge=gf;break;case"beforeblur":case"afterblur":ge=gf;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=Pm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=lE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=EE;break;case Vm:case Km:case qm:ge=uE;break;case Zm:ge=_E;break;case"scroll":ge=sE;break;case"wheel":ge=RE;break;case"copy":case"cut":case"paste":ge=hE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=Nm}var Ee=(r&4)!==0,Tt=!Ee&&o==="scroll",$=Ee?K!==null?K+"Capture":null:K;Ee=[];for(var L=W,x;L!==null;){x=L;var te=x.stateNode;if(x.tag===5&&te!==null&&(x=te,$!==null&&(te=Ea(L,$),te!=null&&Ee.push(xa(L,te,x)))),Tt)break;L=L.return}0<Ee.length&&(K=new ge(K,Ae,null,c,Q),J.push({event:K,listeners:Ee}))}}if((r&7)===0){e:{if(K=o==="mouseover"||o==="pointerover",ge=o==="mouseout"||o==="pointerout",K&&c!==Ku&&(Ae=c.relatedTarget||c.fromElement)&&(lr(Ae)||Ae[Gi]))break e;if((ge||K)&&(K=Q.window===Q?Q:(K=Q.ownerDocument)?K.defaultView||K.parentWindow:window,ge?(Ae=c.relatedTarget||c.toElement,ge=W,Ae=Ae?lr(Ae):null,Ae!==null&&(Tt=ar(Ae),Ae!==Tt||Ae.tag!==5&&Ae.tag!==6)&&(Ae=null)):(ge=null,Ae=W),ge!==Ae)){if(Ee=Pm,te="onMouseLeave",$="onMouseEnter",L="mouse",(o==="pointerout"||o==="pointerover")&&(Ee=Nm,te="onPointerLeave",$="onPointerEnter",L="pointer"),Tt=ge==null?K:ls(ge),x=Ae==null?K:ls(Ae),K=new Ee(te,L+"leave",ge,c,Q),K.target=Tt,K.relatedTarget=x,te=null,lr(Q)===W&&(Ee=new Ee($,L+"enter",Ae,c,Q),Ee.target=x,Ee.relatedTarget=Tt,te=Ee),Tt=te,ge&&Ae)t:{for(Ee=ge,$=Ae,L=0,x=Ee;x;x=ss(x))L++;for(x=0,te=$;te;te=ss(te))x++;for(;0<L-x;)Ee=ss(Ee),L--;for(;0<x-L;)$=ss($),x--;for(;L--;){if(Ee===$||$!==null&&Ee===$.alternate)break t;Ee=ss(Ee),$=ss($)}Ee=null}else Ee=null;ge!==null&&i0(J,K,ge,Ee,!1),Ae!==null&&Tt!==null&&i0(J,Tt,Ae,Ee,!0)}}e:{if(K=W?ls(W):window,ge=K.nodeName&&K.nodeName.toLowerCase(),ge==="select"||ge==="input"&&K.type==="file")var we=bE;else if(Fm(K))if(Um)we=UE;else{we=FE;var Oe=BE}else(ge=K.nodeName)&&ge.toLowerCase()==="input"&&(K.type==="checkbox"||K.type==="radio")&&(we=LE);if(we&&(we=we(o,W))){Lm(J,we,c,Q);break e}Oe&&Oe(o,K,W),o==="focusout"&&(Oe=K._wrapperState)&&Oe.controlled&&K.type==="number"&&Ai(K,"number",K.value)}switch(Oe=W?ls(W):window,o){case"focusin":(Fm(Oe)||Oe.contentEditable==="true")&&(os=Oe,Af=W,Ha=null);break;case"focusout":Ha=Af=os=null;break;case"mousedown":If=!0;break;case"contextmenu":case"mouseup":case"dragend":If=!1,jm(J,c,Q);break;case"selectionchange":if($E)break;case"keydown":case"keyup":jm(J,c,Q)}var ke;if(mf)e:{switch(o){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else is?bm(o,c)&&(He="onCompositionEnd"):o==="keydown"&&c.keyCode===229&&(He="onCompositionStart");He&&(Mm&&c.locale!=="ko"&&(is||He!=="onCompositionStart"?He==="onCompositionEnd"&&is&&(ke=wm()):(So=Q,df="value"in So?So.value:So.textContent,is=!0)),Oe=wc(W,He),0<Oe.length&&(He=new Dm(He,o,null,c,Q),J.push({event:He,listeners:Oe}),ke?He.data=ke:(ke=Bm(c),ke!==null&&(He.data=ke)))),(ke=DE?NE(o,c):ME(o,c))&&(W=wc(W,"onBeforeInput"),0<W.length&&(Q=new Dm("onBeforeInput","beforeinput",null,c,Q),J.push({event:Q,listeners:W}),Q.data=ke))}t0(J,r)})}function xa(o,r,c){return{instance:o,listener:r,currentTarget:c}}function wc(o,r){for(var c=r+"Capture",h=[];o!==null;){var p=o,y=p.stateNode;p.tag===5&&y!==null&&(p=y,y=Ea(o,c),y!=null&&h.unshift(xa(o,y,p)),y=Ea(o,r),y!=null&&h.push(xa(o,y,p))),o=o.return}return h}function ss(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function i0(o,r,c,h,p){for(var y=r._reactName,_=[];c!==null&&c!==h;){var O=c,B=O.alternate,W=O.stateNode;if(B!==null&&B===h)break;O.tag===5&&W!==null&&(O=W,p?(B=Ea(c,y),B!=null&&_.unshift(xa(c,B,O))):p||(B=Ea(c,y),B!=null&&_.push(xa(c,B,O)))),c=c.return}_.length!==0&&o.push({event:r,listeners:_})}var zE=/\r\n?/g,jE=/\u0000|\uFFFD/g;function o0(o){return(typeof o=="string"?o:""+o).replace(zE,`
`).replace(jE,"")}function Rc(o,r,c){if(r=o0(r),o0(o)!==r&&c)throw Error(n(425))}function Pc(){}var Rf=null,Pf=null;function Df(o,r){return o==="textarea"||o==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Nf=typeof setTimeout=="function"?setTimeout:void 0,XE=typeof clearTimeout=="function"?clearTimeout:void 0,r0=typeof Promise=="function"?Promise:void 0,VE=typeof queueMicrotask=="function"?queueMicrotask:typeof r0<"u"?function(o){return r0.resolve(null).then(o).catch(KE)}:Nf;function KE(o){setTimeout(function(){throw o})}function Mf(o,r){var c=r,h=0;do{var p=c.nextSibling;if(o.removeChild(c),p&&p.nodeType===8)if(c=p.data,c==="/$"){if(h===0){o.removeChild(p),Oa(r);return}h--}else c!=="$"&&c!=="$?"&&c!=="$!"||h++;c=p}while(c);Oa(r)}function Ao(o){for(;o!=null;o=o.nextSibling){var r=o.nodeType;if(r===1||r===3)break;if(r===8){if(r=o.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return o}function s0(o){o=o.previousSibling;for(var r=0;o;){if(o.nodeType===8){var c=o.data;if(c==="$"||c==="$!"||c==="$?"){if(r===0)return o;r--}else c==="/$"&&r++}o=o.previousSibling}return null}var as=Math.random().toString(36).slice(2),Ei="__reactFiber$"+as,Wa="__reactProps$"+as,Gi="__reactContainer$"+as,Of="__reactEvents$"+as,qE="__reactListeners$"+as,ZE="__reactHandles$"+as;function lr(o){var r=o[Ei];if(r)return r;for(var c=o.parentNode;c;){if(r=c[Gi]||c[Ei]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(o=s0(o);o!==null;){if(c=o[Ei])return c;o=s0(o)}return r}o=c,c=o.parentNode}return null}function Ya(o){return o=o[Ei]||o[Gi],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function ls(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(n(33))}function Dc(o){return o[Wa]||null}var kf=[],cs=-1;function Io(o){return{current:o}}function ct(o){0>cs||(o.current=kf[cs],kf[cs]=null,cs--)}function st(o,r){cs++,kf[cs]=o.current,o.current=r}var To={},Qt=Io(To),Tn=Io(!1),cr=To;function ds(o,r){var c=o.type.contextTypes;if(!c)return To;var h=o.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===r)return h.__reactInternalMemoizedMaskedChildContext;var p={},y;for(y in c)p[y]=r[y];return h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=r,o.__reactInternalMemoizedMaskedChildContext=p),p}function En(o){return o=o.childContextTypes,o!=null}function Nc(){ct(Tn),ct(Qt)}function a0(o,r,c){if(Qt.current!==To)throw Error(n(168));st(Qt,r),st(Tn,c)}function l0(o,r,c){var h=o.stateNode;if(r=r.childContextTypes,typeof h.getChildContext!="function")return c;h=h.getChildContext();for(var p in h)if(!(p in r))throw Error(n(108,Me(o)||"Unknown",p));return Z({},c,h)}function Mc(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||To,cr=Qt.current,st(Qt,o),st(Tn,Tn.current),!0}function c0(o,r,c){var h=o.stateNode;if(!h)throw Error(n(169));c?(o=l0(o,r,cr),h.__reactInternalMemoizedMergedChildContext=o,ct(Tn),ct(Qt),st(Qt,o)):ct(Tn),st(Tn,c)}var $i=null,Oc=!1,bf=!1;function d0(o){$i===null?$i=[o]:$i.push(o)}function QE(o){Oc=!0,d0(o)}function Eo(){if(!bf&&$i!==null){bf=!0;var o=0,r=tt;try{var c=$i;for(tt=1;o<c.length;o++){var h=c[o];do h=h(!0);while(h!==null)}$i=null,Oc=!1}catch(p){throw $i!==null&&($i=$i.slice(o+1)),fm(tf,Eo),p}finally{tt=r,bf=!1}}return null}var us=[],fs=0,kc=null,bc=0,Vn=[],Kn=0,dr=null,xi=1,Wi="";function ur(o,r){us[fs++]=bc,us[fs++]=kc,kc=o,bc=r}function u0(o,r,c){Vn[Kn++]=xi,Vn[Kn++]=Wi,Vn[Kn++]=dr,dr=o;var h=xi;o=Wi;var p=32-ai(h)-1;h&=~(1<<p),c+=1;var y=32-ai(r)+p;if(30<y){var _=p-p%5;y=(h&(1<<_)-1).toString(32),h>>=_,p-=_,xi=1<<32-ai(r)+p|c<<p|h,Wi=y+o}else xi=1<<y|c<<p|h,Wi=o}function Bf(o){o.return!==null&&(ur(o,1),u0(o,1,0))}function Ff(o){for(;o===kc;)kc=us[--fs],us[fs]=null,bc=us[--fs],us[fs]=null;for(;o===dr;)dr=Vn[--Kn],Vn[Kn]=null,Wi=Vn[--Kn],Vn[Kn]=null,xi=Vn[--Kn],Vn[Kn]=null}var On=null,kn=null,ut=!1,ci=null;function f0(o,r){var c=Jn(5,null,null,0);c.elementType="DELETED",c.stateNode=r,c.return=o,r=o.deletions,r===null?(o.deletions=[c],o.flags|=16):r.push(c)}function h0(o,r){switch(o.tag){case 5:var c=o.type;return r=r.nodeType!==1||c.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(o.stateNode=r,On=o,kn=Ao(r.firstChild),!0):!1;case 6:return r=o.pendingProps===""||r.nodeType!==3?null:r,r!==null?(o.stateNode=r,On=o,kn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(c=dr!==null?{id:xi,overflow:Wi}:null,o.memoizedState={dehydrated:r,treeContext:c,retryLane:1073741824},c=Jn(18,null,null,0),c.stateNode=r,c.return=o,o.child=c,On=o,kn=null,!0):!1;default:return!1}}function Lf(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Uf(o){if(ut){var r=kn;if(r){var c=r;if(!h0(o,r)){if(Lf(o))throw Error(n(418));r=Ao(c.nextSibling);var h=On;r&&h0(o,r)?f0(h,c):(o.flags=o.flags&-4097|2,ut=!1,On=o)}}else{if(Lf(o))throw Error(n(418));o.flags=o.flags&-4097|2,ut=!1,On=o}}}function g0(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;On=o}function Bc(o){if(o!==On)return!1;if(!ut)return g0(o),ut=!0,!1;var r;if((r=o.tag!==3)&&!(r=o.tag!==5)&&(r=o.type,r=r!=="head"&&r!=="body"&&!Df(o.type,o.memoizedProps)),r&&(r=kn)){if(Lf(o))throw p0(),Error(n(418));for(;r;)f0(o,r),r=Ao(r.nextSibling)}if(g0(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,r=0;o;){if(o.nodeType===8){var c=o.data;if(c==="/$"){if(r===0){kn=Ao(o.nextSibling);break e}r--}else c!=="$"&&c!=="$!"&&c!=="$?"||r++}o=o.nextSibling}kn=null}}else kn=On?Ao(o.stateNode.nextSibling):null;return!0}function p0(){for(var o=kn;o;)o=Ao(o.nextSibling)}function hs(){kn=On=null,ut=!1}function Hf(o){ci===null?ci=[o]:ci.push(o)}var JE=k.ReactCurrentBatchConfig;function za(o,r,c){if(o=c.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(n(309));var h=c.stateNode}if(!h)throw Error(n(147,o));var p=h,y=""+o;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===y?r.ref:(r=function(_){var O=p.refs;_===null?delete O[y]:O[y]=_},r._stringRef=y,r)}if(typeof o!="string")throw Error(n(284));if(!c._owner)throw Error(n(290,o))}return o}function Fc(o,r){throw o=Object.prototype.toString.call(r),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o))}function m0(o){var r=o._init;return r(o._payload)}function y0(o){function r($,L){if(o){var x=$.deletions;x===null?($.deletions=[L],$.flags|=16):x.push(L)}}function c($,L){if(!o)return null;for(;L!==null;)r($,L),L=L.sibling;return null}function h($,L){for($=new Map;L!==null;)L.key!==null?$.set(L.key,L):$.set(L.index,L),L=L.sibling;return $}function p($,L){return $=Mo($,L),$.index=0,$.sibling=null,$}function y($,L,x){return $.index=x,o?(x=$.alternate,x!==null?(x=x.index,x<L?($.flags|=2,L):x):($.flags|=2,L)):($.flags|=1048576,L)}function _($){return o&&$.alternate===null&&($.flags|=2),$}function O($,L,x,te){return L===null||L.tag!==6?(L=Nh(x,$.mode,te),L.return=$,L):(L=p(L,x),L.return=$,L)}function B($,L,x,te){var we=x.type;return we===N?Q($,L,x.props.children,te,x.key):L!==null&&(L.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===ce&&m0(we)===L.type)?(te=p(L,x.props),te.ref=za($,L,x),te.return=$,te):(te=sd(x.type,x.key,x.props,null,$.mode,te),te.ref=za($,L,x),te.return=$,te)}function W($,L,x,te){return L===null||L.tag!==4||L.stateNode.containerInfo!==x.containerInfo||L.stateNode.implementation!==x.implementation?(L=Mh(x,$.mode,te),L.return=$,L):(L=p(L,x.children||[]),L.return=$,L)}function Q($,L,x,te,we){return L===null||L.tag!==7?(L=vr(x,$.mode,te,we),L.return=$,L):(L=p(L,x),L.return=$,L)}function J($,L,x){if(typeof L=="string"&&L!==""||typeof L=="number")return L=Nh(""+L,$.mode,x),L.return=$,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case M:return x=sd(L.type,L.key,L.props,null,$.mode,x),x.ref=za($,null,L),x.return=$,x;case D:return L=Mh(L,$.mode,x),L.return=$,L;case ce:var te=L._init;return J($,te(L._payload),x)}if(Ii(L)||q(L))return L=vr(L,$.mode,x,null),L.return=$,L;Fc($,L)}return null}function K($,L,x,te){var we=L!==null?L.key:null;if(typeof x=="string"&&x!==""||typeof x=="number")return we!==null?null:O($,L,""+x,te);if(typeof x=="object"&&x!==null){switch(x.$$typeof){case M:return x.key===we?B($,L,x,te):null;case D:return x.key===we?W($,L,x,te):null;case ce:return we=x._init,K($,L,we(x._payload),te)}if(Ii(x)||q(x))return we!==null?null:Q($,L,x,te,null);Fc($,x)}return null}function ge($,L,x,te,we){if(typeof te=="string"&&te!==""||typeof te=="number")return $=$.get(x)||null,O(L,$,""+te,we);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case M:return $=$.get(te.key===null?x:te.key)||null,B(L,$,te,we);case D:return $=$.get(te.key===null?x:te.key)||null,W(L,$,te,we);case ce:var Oe=te._init;return ge($,L,x,Oe(te._payload),we)}if(Ii(te)||q(te))return $=$.get(x)||null,Q(L,$,te,we,null);Fc(L,te)}return null}function Ae($,L,x,te){for(var we=null,Oe=null,ke=L,He=L=0,Ft=null;ke!==null&&He<x.length;He++){ke.index>He?(Ft=ke,ke=null):Ft=ke.sibling;var qe=K($,ke,x[He],te);if(qe===null){ke===null&&(ke=Ft);break}o&&ke&&qe.alternate===null&&r($,ke),L=y(qe,L,He),Oe===null?we=qe:Oe.sibling=qe,Oe=qe,ke=Ft}if(He===x.length)return c($,ke),ut&&ur($,He),we;if(ke===null){for(;He<x.length;He++)ke=J($,x[He],te),ke!==null&&(L=y(ke,L,He),Oe===null?we=ke:Oe.sibling=ke,Oe=ke);return ut&&ur($,He),we}for(ke=h($,ke);He<x.length;He++)Ft=ge(ke,$,He,x[He],te),Ft!==null&&(o&&Ft.alternate!==null&&ke.delete(Ft.key===null?He:Ft.key),L=y(Ft,L,He),Oe===null?we=Ft:Oe.sibling=Ft,Oe=Ft);return o&&ke.forEach(function(Oo){return r($,Oo)}),ut&&ur($,He),we}function Ee($,L,x,te){var we=q(x);if(typeof we!="function")throw Error(n(150));if(x=we.call(x),x==null)throw Error(n(151));for(var Oe=we=null,ke=L,He=L=0,Ft=null,qe=x.next();ke!==null&&!qe.done;He++,qe=x.next()){ke.index>He?(Ft=ke,ke=null):Ft=ke.sibling;var Oo=K($,ke,qe.value,te);if(Oo===null){ke===null&&(ke=Ft);break}o&&ke&&Oo.alternate===null&&r($,ke),L=y(Oo,L,He),Oe===null?we=Oo:Oe.sibling=Oo,Oe=Oo,ke=Ft}if(qe.done)return c($,ke),ut&&ur($,He),we;if(ke===null){for(;!qe.done;He++,qe=x.next())qe=J($,qe.value,te),qe!==null&&(L=y(qe,L,He),Oe===null?we=qe:Oe.sibling=qe,Oe=qe);return ut&&ur($,He),we}for(ke=h($,ke);!qe.done;He++,qe=x.next())qe=ge(ke,$,He,qe.value,te),qe!==null&&(o&&qe.alternate!==null&&ke.delete(qe.key===null?He:qe.key),L=y(qe,L,He),Oe===null?we=qe:Oe.sibling=qe,Oe=qe);return o&&ke.forEach(function(OC){return r($,OC)}),ut&&ur($,He),we}function Tt($,L,x,te){if(typeof x=="object"&&x!==null&&x.type===N&&x.key===null&&(x=x.props.children),typeof x=="object"&&x!==null){switch(x.$$typeof){case M:e:{for(var we=x.key,Oe=L;Oe!==null;){if(Oe.key===we){if(we=x.type,we===N){if(Oe.tag===7){c($,Oe.sibling),L=p(Oe,x.props.children),L.return=$,$=L;break e}}else if(Oe.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===ce&&m0(we)===Oe.type){c($,Oe.sibling),L=p(Oe,x.props),L.ref=za($,Oe,x),L.return=$,$=L;break e}c($,Oe);break}else r($,Oe);Oe=Oe.sibling}x.type===N?(L=vr(x.props.children,$.mode,te,x.key),L.return=$,$=L):(te=sd(x.type,x.key,x.props,null,$.mode,te),te.ref=za($,L,x),te.return=$,$=te)}return _($);case D:e:{for(Oe=x.key;L!==null;){if(L.key===Oe)if(L.tag===4&&L.stateNode.containerInfo===x.containerInfo&&L.stateNode.implementation===x.implementation){c($,L.sibling),L=p(L,x.children||[]),L.return=$,$=L;break e}else{c($,L);break}else r($,L);L=L.sibling}L=Mh(x,$.mode,te),L.return=$,$=L}return _($);case ce:return Oe=x._init,Tt($,L,Oe(x._payload),te)}if(Ii(x))return Ae($,L,x,te);if(q(x))return Ee($,L,x,te);Fc($,x)}return typeof x=="string"&&x!==""||typeof x=="number"?(x=""+x,L!==null&&L.tag===6?(c($,L.sibling),L=p(L,x),L.return=$,$=L):(c($,L),L=Nh(x,$.mode,te),L.return=$,$=L),_($)):c($,L)}return Tt}var gs=y0(!0),S0=y0(!1),Lc=Io(null),Uc=null,ps=null,Gf=null;function $f(){Gf=ps=Uc=null}function xf(o){var r=Lc.current;ct(Lc),o._currentValue=r}function Wf(o,r,c){for(;o!==null;){var h=o.alternate;if((o.childLanes&r)!==r?(o.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),o===c)break;o=o.return}}function ms(o,r){Uc=o,Gf=ps=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&r)!==0&&(Cn=!0),o.firstContext=null)}function qn(o){var r=o._currentValue;if(Gf!==o)if(o={context:o,memoizedValue:r,next:null},ps===null){if(Uc===null)throw Error(n(308));ps=o,Uc.dependencies={lanes:0,firstContext:o}}else ps=ps.next=o;return r}var fr=null;function Yf(o){fr===null?fr=[o]:fr.push(o)}function v0(o,r,c,h){var p=r.interleaved;return p===null?(c.next=c,Yf(r)):(c.next=p.next,p.next=c),r.interleaved=c,Yi(o,h)}function Yi(o,r){o.lanes|=r;var c=o.alternate;for(c!==null&&(c.lanes|=r),c=o,o=o.return;o!==null;)o.childLanes|=r,c=o.alternate,c!==null&&(c.childLanes|=r),c=o,o=o.return;return c.tag===3?c.stateNode:null}var Co=!1;function zf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function A0(o,r){o=o.updateQueue,r.updateQueue===o&&(r.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function zi(o,r){return{eventTime:o,lane:r,tag:0,payload:null,callback:null,next:null}}function _o(o,r,c){var h=o.updateQueue;if(h===null)return null;if(h=h.shared,(Ve&2)!==0){var p=h.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),h.pending=r,Yi(o,c)}return p=h.interleaved,p===null?(r.next=r,Yf(h)):(r.next=p.next,p.next=r),h.interleaved=r,Yi(o,c)}function Hc(o,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194240)!==0)){var h=r.lanes;h&=o.pendingLanes,c|=h,r.lanes=c,rf(o,c)}}function I0(o,r){var c=o.updateQueue,h=o.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var p=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var _={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};y===null?p=y=_:y=y.next=_,c=c.next}while(c!==null);y===null?p=y=r:y=y.next=r}else p=y=r;c={baseState:h.baseState,firstBaseUpdate:p,lastBaseUpdate:y,shared:h.shared,effects:h.effects},o.updateQueue=c;return}o=c.lastBaseUpdate,o===null?c.firstBaseUpdate=r:o.next=r,c.lastBaseUpdate=r}function Gc(o,r,c,h){var p=o.updateQueue;Co=!1;var y=p.firstBaseUpdate,_=p.lastBaseUpdate,O=p.shared.pending;if(O!==null){p.shared.pending=null;var B=O,W=B.next;B.next=null,_===null?y=W:_.next=W,_=B;var Q=o.alternate;Q!==null&&(Q=Q.updateQueue,O=Q.lastBaseUpdate,O!==_&&(O===null?Q.firstBaseUpdate=W:O.next=W,Q.lastBaseUpdate=B))}if(y!==null){var J=p.baseState;_=0,Q=W=B=null,O=y;do{var K=O.lane,ge=O.eventTime;if((h&K)===K){Q!==null&&(Q=Q.next={eventTime:ge,lane:0,tag:O.tag,payload:O.payload,callback:O.callback,next:null});e:{var Ae=o,Ee=O;switch(K=r,ge=c,Ee.tag){case 1:if(Ae=Ee.payload,typeof Ae=="function"){J=Ae.call(ge,J,K);break e}J=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=Ee.payload,K=typeof Ae=="function"?Ae.call(ge,J,K):Ae,K==null)break e;J=Z({},J,K);break e;case 2:Co=!0}}O.callback!==null&&O.lane!==0&&(o.flags|=64,K=p.effects,K===null?p.effects=[O]:K.push(O))}else ge={eventTime:ge,lane:K,tag:O.tag,payload:O.payload,callback:O.callback,next:null},Q===null?(W=Q=ge,B=J):Q=Q.next=ge,_|=K;if(O=O.next,O===null){if(O=p.shared.pending,O===null)break;K=O,O=K.next,K.next=null,p.lastBaseUpdate=K,p.shared.pending=null}}while(!0);if(Q===null&&(B=J),p.baseState=B,p.firstBaseUpdate=W,p.lastBaseUpdate=Q,r=p.shared.interleaved,r!==null){p=r;do _|=p.lane,p=p.next;while(p!==r)}else y===null&&(p.shared.lanes=0);pr|=_,o.lanes=_,o.memoizedState=J}}function T0(o,r,c){if(o=r.effects,r.effects=null,o!==null)for(r=0;r<o.length;r++){var h=o[r],p=h.callback;if(p!==null){if(h.callback=null,h=c,typeof p!="function")throw Error(n(191,p));p.call(h)}}}var ja={},Ci=Io(ja),Xa=Io(ja),Va=Io(ja);function hr(o){if(o===ja)throw Error(n(174));return o}function jf(o,r){switch(st(Va,r),st(Xa,o),st(Ci,ja),o=r.nodeType,o){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:ju(null,"");break;default:o=o===8?r.parentNode:r,r=o.namespaceURI||null,o=o.tagName,r=ju(r,o)}ct(Ci),st(Ci,r)}function ys(){ct(Ci),ct(Xa),ct(Va)}function E0(o){hr(Va.current);var r=hr(Ci.current),c=ju(r,o.type);r!==c&&(st(Xa,o),st(Ci,c))}function Xf(o){Xa.current===o&&(ct(Ci),ct(Xa))}var gt=Io(0);function $c(o){for(var r=o;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Vf=[];function Kf(){for(var o=0;o<Vf.length;o++)Vf[o]._workInProgressVersionPrimary=null;Vf.length=0}var xc=k.ReactCurrentDispatcher,qf=k.ReactCurrentBatchConfig,gr=0,pt=null,Nt=null,bt=null,Wc=!1,Ka=!1,qa=0,eC=0;function Jt(){throw Error(n(321))}function Zf(o,r){if(r===null)return!1;for(var c=0;c<r.length&&c<o.length;c++)if(!li(o[c],r[c]))return!1;return!0}function Qf(o,r,c,h,p,y){if(gr=y,pt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,xc.current=o===null||o.memoizedState===null?oC:rC,o=c(h,p),Ka){y=0;do{if(Ka=!1,qa=0,25<=y)throw Error(n(301));y+=1,bt=Nt=null,r.updateQueue=null,xc.current=sC,o=c(h,p)}while(Ka)}if(xc.current=jc,r=Nt!==null&&Nt.next!==null,gr=0,bt=Nt=pt=null,Wc=!1,r)throw Error(n(300));return o}function Jf(){var o=qa!==0;return qa=0,o}function _i(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bt===null?pt.memoizedState=bt=o:bt=bt.next=o,bt}function Zn(){if(Nt===null){var o=pt.alternate;o=o!==null?o.memoizedState:null}else o=Nt.next;var r=bt===null?pt.memoizedState:bt.next;if(r!==null)bt=r,Nt=o;else{if(o===null)throw Error(n(310));Nt=o,o={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},bt===null?pt.memoizedState=bt=o:bt=bt.next=o}return bt}function Za(o,r){return typeof r=="function"?r(o):r}function eh(o){var r=Zn(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=o;var h=Nt,p=h.baseQueue,y=c.pending;if(y!==null){if(p!==null){var _=p.next;p.next=y.next,y.next=_}h.baseQueue=p=y,c.pending=null}if(p!==null){y=p.next,h=h.baseState;var O=_=null,B=null,W=y;do{var Q=W.lane;if((gr&Q)===Q)B!==null&&(B=B.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),h=W.hasEagerState?W.eagerState:o(h,W.action);else{var J={lane:Q,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};B===null?(O=B=J,_=h):B=B.next=J,pt.lanes|=Q,pr|=Q}W=W.next}while(W!==null&&W!==y);B===null?_=h:B.next=O,li(h,r.memoizedState)||(Cn=!0),r.memoizedState=h,r.baseState=_,r.baseQueue=B,c.lastRenderedState=h}if(o=c.interleaved,o!==null){p=o;do y=p.lane,pt.lanes|=y,pr|=y,p=p.next;while(p!==o)}else p===null&&(c.lanes=0);return[r.memoizedState,c.dispatch]}function th(o){var r=Zn(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=o;var h=c.dispatch,p=c.pending,y=r.memoizedState;if(p!==null){c.pending=null;var _=p=p.next;do y=o(y,_.action),_=_.next;while(_!==p);li(y,r.memoizedState)||(Cn=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),c.lastRenderedState=y}return[y,h]}function C0(){}function _0(o,r){var c=pt,h=Zn(),p=r(),y=!li(h.memoizedState,p);if(y&&(h.memoizedState=p,Cn=!0),h=h.queue,nh(P0.bind(null,c,h,o),[o]),h.getSnapshot!==r||y||bt!==null&&bt.memoizedState.tag&1){if(c.flags|=2048,Qa(9,R0.bind(null,c,h,p,r),void 0,null),Bt===null)throw Error(n(349));(gr&30)!==0||w0(c,r,p)}return p}function w0(o,r,c){o.flags|=16384,o={getSnapshot:r,value:c},r=pt.updateQueue,r===null?(r={lastEffect:null,stores:null},pt.updateQueue=r,r.stores=[o]):(c=r.stores,c===null?r.stores=[o]:c.push(o))}function R0(o,r,c,h){r.value=c,r.getSnapshot=h,D0(r)&&N0(o)}function P0(o,r,c){return c(function(){D0(r)&&N0(o)})}function D0(o){var r=o.getSnapshot;o=o.value;try{var c=r();return!li(o,c)}catch{return!0}}function N0(o){var r=Yi(o,1);r!==null&&hi(r,o,1,-1)}function M0(o){var r=_i();return typeof o=="function"&&(o=o()),r.memoizedState=r.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Za,lastRenderedState:o},r.queue=o,o=o.dispatch=iC.bind(null,pt,o),[r.memoizedState,o]}function Qa(o,r,c,h){return o={tag:o,create:r,destroy:c,deps:h,next:null},r=pt.updateQueue,r===null?(r={lastEffect:null,stores:null},pt.updateQueue=r,r.lastEffect=o.next=o):(c=r.lastEffect,c===null?r.lastEffect=o.next=o:(h=c.next,c.next=o,o.next=h,r.lastEffect=o)),o}function O0(){return Zn().memoizedState}function Yc(o,r,c,h){var p=_i();pt.flags|=o,p.memoizedState=Qa(1|r,c,void 0,h===void 0?null:h)}function zc(o,r,c,h){var p=Zn();h=h===void 0?null:h;var y=void 0;if(Nt!==null){var _=Nt.memoizedState;if(y=_.destroy,h!==null&&Zf(h,_.deps)){p.memoizedState=Qa(r,c,y,h);return}}pt.flags|=o,p.memoizedState=Qa(1|r,c,y,h)}function k0(o,r){return Yc(8390656,8,o,r)}function nh(o,r){return zc(2048,8,o,r)}function b0(o,r){return zc(4,2,o,r)}function B0(o,r){return zc(4,4,o,r)}function F0(o,r){if(typeof r=="function")return o=o(),r(o),function(){r(null)};if(r!=null)return o=o(),r.current=o,function(){r.current=null}}function L0(o,r,c){return c=c!=null?c.concat([o]):null,zc(4,4,F0.bind(null,r,o),c)}function ih(){}function U0(o,r){var c=Zn();r=r===void 0?null:r;var h=c.memoizedState;return h!==null&&r!==null&&Zf(r,h[1])?h[0]:(c.memoizedState=[o,r],o)}function H0(o,r){var c=Zn();r=r===void 0?null:r;var h=c.memoizedState;return h!==null&&r!==null&&Zf(r,h[1])?h[0]:(o=o(),c.memoizedState=[o,r],o)}function G0(o,r,c){return(gr&21)===0?(o.baseState&&(o.baseState=!1,Cn=!0),o.memoizedState=c):(li(c,r)||(c=mm(),pt.lanes|=c,pr|=c,o.baseState=!0),r)}function tC(o,r){var c=tt;tt=c!==0&&4>c?c:4,o(!0);var h=qf.transition;qf.transition={};try{o(!1),r()}finally{tt=c,qf.transition=h}}function $0(){return Zn().memoizedState}function nC(o,r,c){var h=Do(o);if(c={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null},x0(o))W0(r,c);else if(c=v0(o,r,c,h),c!==null){var p=un();hi(c,o,h,p),Y0(c,r,h)}}function iC(o,r,c){var h=Do(o),p={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null};if(x0(o))W0(r,p);else{var y=o.alternate;if(o.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var _=r.lastRenderedState,O=y(_,c);if(p.hasEagerState=!0,p.eagerState=O,li(O,_)){var B=r.interleaved;B===null?(p.next=p,Yf(r)):(p.next=B.next,B.next=p),r.interleaved=p;return}}catch{}finally{}c=v0(o,r,p,h),c!==null&&(p=un(),hi(c,o,h,p),Y0(c,r,h))}}function x0(o){var r=o.alternate;return o===pt||r!==null&&r===pt}function W0(o,r){Ka=Wc=!0;var c=o.pending;c===null?r.next=r:(r.next=c.next,c.next=r),o.pending=r}function Y0(o,r,c){if((c&4194240)!==0){var h=r.lanes;h&=o.pendingLanes,c|=h,r.lanes=c,rf(o,c)}}var jc={readContext:qn,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useInsertionEffect:Jt,useLayoutEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useMutableSource:Jt,useSyncExternalStore:Jt,useId:Jt,unstable_isNewReconciler:!1},oC={readContext:qn,useCallback:function(o,r){return _i().memoizedState=[o,r===void 0?null:r],o},useContext:qn,useEffect:k0,useImperativeHandle:function(o,r,c){return c=c!=null?c.concat([o]):null,Yc(4194308,4,F0.bind(null,r,o),c)},useLayoutEffect:function(o,r){return Yc(4194308,4,o,r)},useInsertionEffect:function(o,r){return Yc(4,2,o,r)},useMemo:function(o,r){var c=_i();return r=r===void 0?null:r,o=o(),c.memoizedState=[o,r],o},useReducer:function(o,r,c){var h=_i();return r=c!==void 0?c(r):r,h.memoizedState=h.baseState=r,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:r},h.queue=o,o=o.dispatch=nC.bind(null,pt,o),[h.memoizedState,o]},useRef:function(o){var r=_i();return o={current:o},r.memoizedState=o},useState:M0,useDebugValue:ih,useDeferredValue:function(o){return _i().memoizedState=o},useTransition:function(){var o=M0(!1),r=o[0];return o=tC.bind(null,o[1]),_i().memoizedState=o,[r,o]},useMutableSource:function(){},useSyncExternalStore:function(o,r,c){var h=pt,p=_i();if(ut){if(c===void 0)throw Error(n(407));c=c()}else{if(c=r(),Bt===null)throw Error(n(349));(gr&30)!==0||w0(h,r,c)}p.memoizedState=c;var y={value:c,getSnapshot:r};return p.queue=y,k0(P0.bind(null,h,y,o),[o]),h.flags|=2048,Qa(9,R0.bind(null,h,y,c,r),void 0,null),c},useId:function(){var o=_i(),r=Bt.identifierPrefix;if(ut){var c=Wi,h=xi;c=(h&~(1<<32-ai(h)-1)).toString(32)+c,r=":"+r+"R"+c,c=qa++,0<c&&(r+="H"+c.toString(32)),r+=":"}else c=eC++,r=":"+r+"r"+c.toString(32)+":";return o.memoizedState=r},unstable_isNewReconciler:!1},rC={readContext:qn,useCallback:U0,useContext:qn,useEffect:nh,useImperativeHandle:L0,useInsertionEffect:b0,useLayoutEffect:B0,useMemo:H0,useReducer:eh,useRef:O0,useState:function(){return eh(Za)},useDebugValue:ih,useDeferredValue:function(o){var r=Zn();return G0(r,Nt.memoizedState,o)},useTransition:function(){var o=eh(Za)[0],r=Zn().memoizedState;return[o,r]},useMutableSource:C0,useSyncExternalStore:_0,useId:$0,unstable_isNewReconciler:!1},sC={readContext:qn,useCallback:U0,useContext:qn,useEffect:nh,useImperativeHandle:L0,useInsertionEffect:b0,useLayoutEffect:B0,useMemo:H0,useReducer:th,useRef:O0,useState:function(){return th(Za)},useDebugValue:ih,useDeferredValue:function(o){var r=Zn();return Nt===null?r.memoizedState=o:G0(r,Nt.memoizedState,o)},useTransition:function(){var o=th(Za)[0],r=Zn().memoizedState;return[o,r]},useMutableSource:C0,useSyncExternalStore:_0,useId:$0,unstable_isNewReconciler:!1};function di(o,r){if(o&&o.defaultProps){r=Z({},r),o=o.defaultProps;for(var c in o)r[c]===void 0&&(r[c]=o[c]);return r}return r}function oh(o,r,c,h){r=o.memoizedState,c=c(h,r),c=c==null?r:Z({},r,c),o.memoizedState=c,o.lanes===0&&(o.updateQueue.baseState=c)}var Xc={isMounted:function(o){return(o=o._reactInternals)?ar(o)===o:!1},enqueueSetState:function(o,r,c){o=o._reactInternals;var h=un(),p=Do(o),y=zi(h,p);y.payload=r,c!=null&&(y.callback=c),r=_o(o,y,p),r!==null&&(hi(r,o,p,h),Hc(r,o,p))},enqueueReplaceState:function(o,r,c){o=o._reactInternals;var h=un(),p=Do(o),y=zi(h,p);y.tag=1,y.payload=r,c!=null&&(y.callback=c),r=_o(o,y,p),r!==null&&(hi(r,o,p,h),Hc(r,o,p))},enqueueForceUpdate:function(o,r){o=o._reactInternals;var c=un(),h=Do(o),p=zi(c,h);p.tag=2,r!=null&&(p.callback=r),r=_o(o,p,h),r!==null&&(hi(r,o,h,c),Hc(r,o,h))}};function z0(o,r,c,h,p,y,_){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(h,y,_):r.prototype&&r.prototype.isPureReactComponent?!Ua(c,h)||!Ua(p,y):!0}function j0(o,r,c){var h=!1,p=To,y=r.contextType;return typeof y=="object"&&y!==null?y=qn(y):(p=En(r)?cr:Qt.current,h=r.contextTypes,y=(h=h!=null)?ds(o,p):To),r=new r(c,y),o.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Xc,o.stateNode=r,r._reactInternals=o,h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=p,o.__reactInternalMemoizedMaskedChildContext=y),r}function X0(o,r,c,h){o=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,h),r.state!==o&&Xc.enqueueReplaceState(r,r.state,null)}function rh(o,r,c,h){var p=o.stateNode;p.props=c,p.state=o.memoizedState,p.refs={},zf(o);var y=r.contextType;typeof y=="object"&&y!==null?p.context=qn(y):(y=En(r)?cr:Qt.current,p.context=ds(o,y)),p.state=o.memoizedState,y=r.getDerivedStateFromProps,typeof y=="function"&&(oh(o,r,y,c),p.state=o.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(r=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),r!==p.state&&Xc.enqueueReplaceState(p,p.state,null),Gc(o,c,p,h),p.state=o.memoizedState),typeof p.componentDidMount=="function"&&(o.flags|=4194308)}function Ss(o,r){try{var c="",h=r;do c+=Pe(h),h=h.return;while(h);var p=c}catch(y){p=`
Error generating stack: `+y.message+`
`+y.stack}return{value:o,source:r,stack:p,digest:null}}function sh(o,r,c){return{value:o,source:null,stack:c??null,digest:r??null}}function ah(o,r){try{console.error(r.value)}catch(c){setTimeout(function(){throw c})}}var aC=typeof WeakMap=="function"?WeakMap:Map;function V0(o,r,c){c=zi(-1,c),c.tag=3,c.payload={element:null};var h=r.value;return c.callback=function(){ed||(ed=!0,Th=h),ah(o,r)},c}function K0(o,r,c){c=zi(-1,c),c.tag=3;var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var p=r.value;c.payload=function(){return h(p)},c.callback=function(){ah(o,r)}}var y=o.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(c.callback=function(){ah(o,r),typeof h!="function"&&(Ro===null?Ro=new Set([this]):Ro.add(this));var _=r.stack;this.componentDidCatch(r.value,{componentStack:_!==null?_:""})}),c}function q0(o,r,c){var h=o.pingCache;if(h===null){h=o.pingCache=new aC;var p=new Set;h.set(r,p)}else p=h.get(r),p===void 0&&(p=new Set,h.set(r,p));p.has(c)||(p.add(c),o=IC.bind(null,o,r,c),r.then(o,o))}function Z0(o){do{var r;if((r=o.tag===13)&&(r=o.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return o;o=o.return}while(o!==null);return null}function Q0(o,r,c,h,p){return(o.mode&1)===0?(o===r?o.flags|=65536:(o.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(r=zi(-1,1),r.tag=2,_o(c,r,1))),c.lanes|=1),o):(o.flags|=65536,o.lanes=p,o)}var lC=k.ReactCurrentOwner,Cn=!1;function dn(o,r,c,h){r.child=o===null?S0(r,null,c,h):gs(r,o.child,c,h)}function J0(o,r,c,h,p){c=c.render;var y=r.ref;return ms(r,p),h=Qf(o,r,c,h,y,p),c=Jf(),o!==null&&!Cn?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,ji(o,r,p)):(ut&&c&&Bf(r),r.flags|=1,dn(o,r,h,p),r.child)}function ey(o,r,c,h,p){if(o===null){var y=c.type;return typeof y=="function"&&!Dh(y)&&y.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(r.tag=15,r.type=y,ty(o,r,y,h,p)):(o=sd(c.type,null,h,r,r.mode,p),o.ref=r.ref,o.return=r,r.child=o)}if(y=o.child,(o.lanes&p)===0){var _=y.memoizedProps;if(c=c.compare,c=c!==null?c:Ua,c(_,h)&&o.ref===r.ref)return ji(o,r,p)}return r.flags|=1,o=Mo(y,h),o.ref=r.ref,o.return=r,r.child=o}function ty(o,r,c,h,p){if(o!==null){var y=o.memoizedProps;if(Ua(y,h)&&o.ref===r.ref)if(Cn=!1,r.pendingProps=h=y,(o.lanes&p)!==0)(o.flags&131072)!==0&&(Cn=!0);else return r.lanes=o.lanes,ji(o,r,p)}return lh(o,r,c,h,p)}function ny(o,r,c){var h=r.pendingProps,p=h.children,y=o!==null?o.memoizedState:null;if(h.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},st(As,bn),bn|=c;else{if((c&1073741824)===0)return o=y!==null?y.baseLanes|c:c,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:o,cachePool:null,transitions:null},r.updateQueue=null,st(As,bn),bn|=o,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=y!==null?y.baseLanes:c,st(As,bn),bn|=h}else y!==null?(h=y.baseLanes|c,r.memoizedState=null):h=c,st(As,bn),bn|=h;return dn(o,r,p,c),r.child}function iy(o,r){var c=r.ref;(o===null&&c!==null||o!==null&&o.ref!==c)&&(r.flags|=512,r.flags|=2097152)}function lh(o,r,c,h,p){var y=En(c)?cr:Qt.current;return y=ds(r,y),ms(r,p),c=Qf(o,r,c,h,y,p),h=Jf(),o!==null&&!Cn?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,ji(o,r,p)):(ut&&h&&Bf(r),r.flags|=1,dn(o,r,c,p),r.child)}function oy(o,r,c,h,p){if(En(c)){var y=!0;Mc(r)}else y=!1;if(ms(r,p),r.stateNode===null)Kc(o,r),j0(r,c,h),rh(r,c,h,p),h=!0;else if(o===null){var _=r.stateNode,O=r.memoizedProps;_.props=O;var B=_.context,W=c.contextType;typeof W=="object"&&W!==null?W=qn(W):(W=En(c)?cr:Qt.current,W=ds(r,W));var Q=c.getDerivedStateFromProps,J=typeof Q=="function"||typeof _.getSnapshotBeforeUpdate=="function";J||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(O!==h||B!==W)&&X0(r,_,h,W),Co=!1;var K=r.memoizedState;_.state=K,Gc(r,h,_,p),B=r.memoizedState,O!==h||K!==B||Tn.current||Co?(typeof Q=="function"&&(oh(r,c,Q,h),B=r.memoizedState),(O=Co||z0(r,c,O,h,K,B,W))?(J||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount()),typeof _.componentDidMount=="function"&&(r.flags|=4194308)):(typeof _.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=B),_.props=h,_.state=B,_.context=W,h=O):(typeof _.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{_=r.stateNode,A0(o,r),O=r.memoizedProps,W=r.type===r.elementType?O:di(r.type,O),_.props=W,J=r.pendingProps,K=_.context,B=c.contextType,typeof B=="object"&&B!==null?B=qn(B):(B=En(c)?cr:Qt.current,B=ds(r,B));var ge=c.getDerivedStateFromProps;(Q=typeof ge=="function"||typeof _.getSnapshotBeforeUpdate=="function")||typeof _.UNSAFE_componentWillReceiveProps!="function"&&typeof _.componentWillReceiveProps!="function"||(O!==J||K!==B)&&X0(r,_,h,B),Co=!1,K=r.memoizedState,_.state=K,Gc(r,h,_,p);var Ae=r.memoizedState;O!==J||K!==Ae||Tn.current||Co?(typeof ge=="function"&&(oh(r,c,ge,h),Ae=r.memoizedState),(W=Co||z0(r,c,W,h,K,Ae,B)||!1)?(Q||typeof _.UNSAFE_componentWillUpdate!="function"&&typeof _.componentWillUpdate!="function"||(typeof _.componentWillUpdate=="function"&&_.componentWillUpdate(h,Ae,B),typeof _.UNSAFE_componentWillUpdate=="function"&&_.UNSAFE_componentWillUpdate(h,Ae,B)),typeof _.componentDidUpdate=="function"&&(r.flags|=4),typeof _.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof _.componentDidUpdate!="function"||O===o.memoizedProps&&K===o.memoizedState||(r.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||O===o.memoizedProps&&K===o.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=Ae),_.props=h,_.state=Ae,_.context=B,h=W):(typeof _.componentDidUpdate!="function"||O===o.memoizedProps&&K===o.memoizedState||(r.flags|=4),typeof _.getSnapshotBeforeUpdate!="function"||O===o.memoizedProps&&K===o.memoizedState||(r.flags|=1024),h=!1)}return ch(o,r,c,h,y,p)}function ch(o,r,c,h,p,y){iy(o,r);var _=(r.flags&128)!==0;if(!h&&!_)return p&&c0(r,c,!1),ji(o,r,y);h=r.stateNode,lC.current=r;var O=_&&typeof c.getDerivedStateFromError!="function"?null:h.render();return r.flags|=1,o!==null&&_?(r.child=gs(r,o.child,null,y),r.child=gs(r,null,O,y)):dn(o,r,O,y),r.memoizedState=h.state,p&&c0(r,c,!0),r.child}function ry(o){var r=o.stateNode;r.pendingContext?a0(o,r.pendingContext,r.pendingContext!==r.context):r.context&&a0(o,r.context,!1),jf(o,r.containerInfo)}function sy(o,r,c,h,p){return hs(),Hf(p),r.flags|=256,dn(o,r,c,h),r.child}var dh={dehydrated:null,treeContext:null,retryLane:0};function uh(o){return{baseLanes:o,cachePool:null,transitions:null}}function ay(o,r,c){var h=r.pendingProps,p=gt.current,y=!1,_=(r.flags&128)!==0,O;if((O=_)||(O=o!==null&&o.memoizedState===null?!1:(p&2)!==0),O?(y=!0,r.flags&=-129):(o===null||o.memoizedState!==null)&&(p|=1),st(gt,p&1),o===null)return Uf(r),o=r.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((r.mode&1)===0?r.lanes=1:o.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(_=h.children,o=h.fallback,y?(h=r.mode,y=r.child,_={mode:"hidden",children:_},(h&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=_):y=ad(_,h,0,null),o=vr(o,h,c,null),y.return=r,o.return=r,y.sibling=o,r.child=y,r.child.memoizedState=uh(c),r.memoizedState=dh,o):fh(r,_));if(p=o.memoizedState,p!==null&&(O=p.dehydrated,O!==null))return cC(o,r,_,h,O,p,c);if(y){y=h.fallback,_=r.mode,p=o.child,O=p.sibling;var B={mode:"hidden",children:h.children};return(_&1)===0&&r.child!==p?(h=r.child,h.childLanes=0,h.pendingProps=B,r.deletions=null):(h=Mo(p,B),h.subtreeFlags=p.subtreeFlags&14680064),O!==null?y=Mo(O,y):(y=vr(y,_,c,null),y.flags|=2),y.return=r,h.return=r,h.sibling=y,r.child=h,h=y,y=r.child,_=o.child.memoizedState,_=_===null?uh(c):{baseLanes:_.baseLanes|c,cachePool:null,transitions:_.transitions},y.memoizedState=_,y.childLanes=o.childLanes&~c,r.memoizedState=dh,h}return y=o.child,o=y.sibling,h=Mo(y,{mode:"visible",children:h.children}),(r.mode&1)===0&&(h.lanes=c),h.return=r,h.sibling=null,o!==null&&(c=r.deletions,c===null?(r.deletions=[o],r.flags|=16):c.push(o)),r.child=h,r.memoizedState=null,h}function fh(o,r){return r=ad({mode:"visible",children:r},o.mode,0,null),r.return=o,o.child=r}function Vc(o,r,c,h){return h!==null&&Hf(h),gs(r,o.child,null,c),o=fh(r,r.pendingProps.children),o.flags|=2,r.memoizedState=null,o}function cC(o,r,c,h,p,y,_){if(c)return r.flags&256?(r.flags&=-257,h=sh(Error(n(422))),Vc(o,r,_,h)):r.memoizedState!==null?(r.child=o.child,r.flags|=128,null):(y=h.fallback,p=r.mode,h=ad({mode:"visible",children:h.children},p,0,null),y=vr(y,p,_,null),y.flags|=2,h.return=r,y.return=r,h.sibling=y,r.child=h,(r.mode&1)!==0&&gs(r,o.child,null,_),r.child.memoizedState=uh(_),r.memoizedState=dh,y);if((r.mode&1)===0)return Vc(o,r,_,null);if(p.data==="$!"){if(h=p.nextSibling&&p.nextSibling.dataset,h)var O=h.dgst;return h=O,y=Error(n(419)),h=sh(y,h,void 0),Vc(o,r,_,h)}if(O=(_&o.childLanes)!==0,Cn||O){if(h=Bt,h!==null){switch(_&-_){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=(p&(h.suspendedLanes|_))!==0?0:p,p!==0&&p!==y.retryLane&&(y.retryLane=p,Yi(o,p),hi(h,o,p,-1))}return Ph(),h=sh(Error(n(421))),Vc(o,r,_,h)}return p.data==="$?"?(r.flags|=128,r.child=o.child,r=TC.bind(null,o),p._reactRetry=r,null):(o=y.treeContext,kn=Ao(p.nextSibling),On=r,ut=!0,ci=null,o!==null&&(Vn[Kn++]=xi,Vn[Kn++]=Wi,Vn[Kn++]=dr,xi=o.id,Wi=o.overflow,dr=r),r=fh(r,h.children),r.flags|=4096,r)}function ly(o,r,c){o.lanes|=r;var h=o.alternate;h!==null&&(h.lanes|=r),Wf(o.return,r,c)}function hh(o,r,c,h,p){var y=o.memoizedState;y===null?o.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:p}:(y.isBackwards=r,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=c,y.tailMode=p)}function cy(o,r,c){var h=r.pendingProps,p=h.revealOrder,y=h.tail;if(dn(o,r,h.children,c),h=gt.current,(h&2)!==0)h=h&1|2,r.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=r.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&ly(o,c,r);else if(o.tag===19)ly(o,c,r);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}h&=1}if(st(gt,h),(r.mode&1)===0)r.memoizedState=null;else switch(p){case"forwards":for(c=r.child,p=null;c!==null;)o=c.alternate,o!==null&&$c(o)===null&&(p=c),c=c.sibling;c=p,c===null?(p=r.child,r.child=null):(p=c.sibling,c.sibling=null),hh(r,!1,p,c,y);break;case"backwards":for(c=null,p=r.child,r.child=null;p!==null;){if(o=p.alternate,o!==null&&$c(o)===null){r.child=p;break}o=p.sibling,p.sibling=c,c=p,p=o}hh(r,!0,c,null,y);break;case"together":hh(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Kc(o,r){(r.mode&1)===0&&o!==null&&(o.alternate=null,r.alternate=null,r.flags|=2)}function ji(o,r,c){if(o!==null&&(r.dependencies=o.dependencies),pr|=r.lanes,(c&r.childLanes)===0)return null;if(o!==null&&r.child!==o.child)throw Error(n(153));if(r.child!==null){for(o=r.child,c=Mo(o,o.pendingProps),r.child=c,c.return=r;o.sibling!==null;)o=o.sibling,c=c.sibling=Mo(o,o.pendingProps),c.return=r;c.sibling=null}return r.child}function dC(o,r,c){switch(r.tag){case 3:ry(r),hs();break;case 5:E0(r);break;case 1:En(r.type)&&Mc(r);break;case 4:jf(r,r.stateNode.containerInfo);break;case 10:var h=r.type._context,p=r.memoizedProps.value;st(Lc,h._currentValue),h._currentValue=p;break;case 13:if(h=r.memoizedState,h!==null)return h.dehydrated!==null?(st(gt,gt.current&1),r.flags|=128,null):(c&r.child.childLanes)!==0?ay(o,r,c):(st(gt,gt.current&1),o=ji(o,r,c),o!==null?o.sibling:null);st(gt,gt.current&1);break;case 19:if(h=(c&r.childLanes)!==0,(o.flags&128)!==0){if(h)return cy(o,r,c);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),st(gt,gt.current),h)break;return null;case 22:case 23:return r.lanes=0,ny(o,r,c)}return ji(o,r,c)}var dy,gh,uy,fy;dy=function(o,r){for(var c=r.child;c!==null;){if(c.tag===5||c.tag===6)o.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===r)break;for(;c.sibling===null;){if(c.return===null||c.return===r)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},gh=function(){},uy=function(o,r,c,h){var p=o.memoizedProps;if(p!==h){o=r.stateNode,hr(Ci.current);var y=null;switch(c){case"input":p=nt(o,p),h=nt(o,h),y=[];break;case"select":p=Z({},p,{value:void 0}),h=Z({},h,{value:void 0}),y=[];break;case"textarea":p=sr(o,p),h=sr(o,h),y=[];break;default:typeof p.onClick!="function"&&typeof h.onClick=="function"&&(o.onclick=Pc)}Xu(c,h);var _;c=null;for(W in p)if(!h.hasOwnProperty(W)&&p.hasOwnProperty(W)&&p[W]!=null)if(W==="style"){var O=p[W];for(_ in O)O.hasOwnProperty(_)&&(c||(c={}),c[_]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(s.hasOwnProperty(W)?y||(y=[]):(y=y||[]).push(W,null));for(W in h){var B=h[W];if(O=p!=null?p[W]:void 0,h.hasOwnProperty(W)&&B!==O&&(B!=null||O!=null))if(W==="style")if(O){for(_ in O)!O.hasOwnProperty(_)||B&&B.hasOwnProperty(_)||(c||(c={}),c[_]="");for(_ in B)B.hasOwnProperty(_)&&O[_]!==B[_]&&(c||(c={}),c[_]=B[_])}else c||(y||(y=[]),y.push(W,c)),c=B;else W==="dangerouslySetInnerHTML"?(B=B?B.__html:void 0,O=O?O.__html:void 0,B!=null&&O!==B&&(y=y||[]).push(W,B)):W==="children"?typeof B!="string"&&typeof B!="number"||(y=y||[]).push(W,""+B):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(s.hasOwnProperty(W)?(B!=null&&W==="onScroll"&&lt("scroll",o),y||O===B||(y=[])):(y=y||[]).push(W,B))}c&&(y=y||[]).push("style",c);var W=y;(r.updateQueue=W)&&(r.flags|=4)}},fy=function(o,r,c,h){c!==h&&(r.flags|=4)};function Ja(o,r){if(!ut)switch(o.tailMode){case"hidden":r=o.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?o.tail=null:c.sibling=null;break;case"collapsed":c=o.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?r||o.tail===null?o.tail=null:o.tail.sibling=null:h.sibling=null}}function en(o){var r=o.alternate!==null&&o.alternate.child===o.child,c=0,h=0;if(r)for(var p=o.child;p!==null;)c|=p.lanes|p.childLanes,h|=p.subtreeFlags&14680064,h|=p.flags&14680064,p.return=o,p=p.sibling;else for(p=o.child;p!==null;)c|=p.lanes|p.childLanes,h|=p.subtreeFlags,h|=p.flags,p.return=o,p=p.sibling;return o.subtreeFlags|=h,o.childLanes=c,r}function uC(o,r,c){var h=r.pendingProps;switch(Ff(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return en(r),null;case 1:return En(r.type)&&Nc(),en(r),null;case 3:return h=r.stateNode,ys(),ct(Tn),ct(Qt),Kf(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(Bc(r)?r.flags|=4:o===null||o.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,ci!==null&&(_h(ci),ci=null))),gh(o,r),en(r),null;case 5:Xf(r);var p=hr(Va.current);if(c=r.type,o!==null&&r.stateNode!=null)uy(o,r,c,h,p),o.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!h){if(r.stateNode===null)throw Error(n(166));return en(r),null}if(o=hr(Ci.current),Bc(r)){h=r.stateNode,c=r.type;var y=r.memoizedProps;switch(h[Ei]=r,h[Wa]=y,o=(r.mode&1)!==0,c){case"dialog":lt("cancel",h),lt("close",h);break;case"iframe":case"object":case"embed":lt("load",h);break;case"video":case"audio":for(p=0;p<Ga.length;p++)lt(Ga[p],h);break;case"source":lt("error",h);break;case"img":case"image":case"link":lt("error",h),lt("load",h);break;case"details":lt("toggle",h);break;case"input":at(h,y),lt("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!y.multiple},lt("invalid",h);break;case"textarea":Kp(h,y),lt("invalid",h)}Xu(c,y),p=null;for(var _ in y)if(y.hasOwnProperty(_)){var O=y[_];_==="children"?typeof O=="string"?h.textContent!==O&&(y.suppressHydrationWarning!==!0&&Rc(h.textContent,O,o),p=["children",O]):typeof O=="number"&&h.textContent!==""+O&&(y.suppressHydrationWarning!==!0&&Rc(h.textContent,O,o),p=["children",""+O]):s.hasOwnProperty(_)&&O!=null&&_==="onScroll"&&lt("scroll",h)}switch(c){case"input":xe(h),Xn(h,y,!0);break;case"textarea":xe(h),Zp(h);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(h.onclick=Pc)}h=p,r.updateQueue=h,h!==null&&(r.flags|=4)}else{_=p.nodeType===9?p:p.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=Qp(c)),o==="http://www.w3.org/1999/xhtml"?c==="script"?(o=_.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof h.is=="string"?o=_.createElement(c,{is:h.is}):(o=_.createElement(c),c==="select"&&(_=o,h.multiple?_.multiple=!0:h.size&&(_.size=h.size))):o=_.createElementNS(o,c),o[Ei]=r,o[Wa]=h,dy(o,r,!1,!1),r.stateNode=o;e:{switch(_=Vu(c,h),c){case"dialog":lt("cancel",o),lt("close",o),p=h;break;case"iframe":case"object":case"embed":lt("load",o),p=h;break;case"video":case"audio":for(p=0;p<Ga.length;p++)lt(Ga[p],o);p=h;break;case"source":lt("error",o),p=h;break;case"img":case"image":case"link":lt("error",o),lt("load",o),p=h;break;case"details":lt("toggle",o),p=h;break;case"input":at(o,h),p=nt(o,h),lt("invalid",o);break;case"option":p=h;break;case"select":o._wrapperState={wasMultiple:!!h.multiple},p=Z({},h,{value:void 0}),lt("invalid",o);break;case"textarea":Kp(o,h),p=sr(o,h),lt("invalid",o);break;default:p=h}Xu(c,p),O=p;for(y in O)if(O.hasOwnProperty(y)){var B=O[y];y==="style"?tm(o,B):y==="dangerouslySetInnerHTML"?(B=B?B.__html:void 0,B!=null&&Jp(o,B)):y==="children"?typeof B=="string"?(c!=="textarea"||B!=="")&&Ia(o,B):typeof B=="number"&&Ia(o,""+B):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?B!=null&&y==="onScroll"&&lt("scroll",o):B!=null&&w(o,y,B,_))}switch(c){case"input":xe(o),Xn(o,h,!1);break;case"textarea":xe(o),Zp(o);break;case"option":h.value!=null&&o.setAttribute("value",""+De(h.value));break;case"select":o.multiple=!!h.multiple,y=h.value,y!=null?ho(o,!!h.multiple,y,!1):h.defaultValue!=null&&ho(o,!!h.multiple,h.defaultValue,!0);break;default:typeof p.onClick=="function"&&(o.onclick=Pc)}switch(c){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return en(r),null;case 6:if(o&&r.stateNode!=null)fy(o,r,o.memoizedProps,h);else{if(typeof h!="string"&&r.stateNode===null)throw Error(n(166));if(c=hr(Va.current),hr(Ci.current),Bc(r)){if(h=r.stateNode,c=r.memoizedProps,h[Ei]=r,(y=h.nodeValue!==c)&&(o=On,o!==null))switch(o.tag){case 3:Rc(h.nodeValue,c,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&Rc(h.nodeValue,c,(o.mode&1)!==0)}y&&(r.flags|=4)}else h=(c.nodeType===9?c:c.ownerDocument).createTextNode(h),h[Ei]=r,r.stateNode=h}return en(r),null;case 13:if(ct(gt),h=r.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(ut&&kn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)p0(),hs(),r.flags|=98560,y=!1;else if(y=Bc(r),h!==null&&h.dehydrated!==null){if(o===null){if(!y)throw Error(n(318));if(y=r.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[Ei]=r}else hs(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;en(r),y=!1}else ci!==null&&(_h(ci),ci=null),y=!0;if(!y)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=c,r):(h=h!==null,h!==(o!==null&&o.memoizedState!==null)&&h&&(r.child.flags|=8192,(r.mode&1)!==0&&(o===null||(gt.current&1)!==0?Mt===0&&(Mt=3):Ph())),r.updateQueue!==null&&(r.flags|=4),en(r),null);case 4:return ys(),gh(o,r),o===null&&$a(r.stateNode.containerInfo),en(r),null;case 10:return xf(r.type._context),en(r),null;case 17:return En(r.type)&&Nc(),en(r),null;case 19:if(ct(gt),y=r.memoizedState,y===null)return en(r),null;if(h=(r.flags&128)!==0,_=y.rendering,_===null)if(h)Ja(y,!1);else{if(Mt!==0||o!==null&&(o.flags&128)!==0)for(o=r.child;o!==null;){if(_=$c(o),_!==null){for(r.flags|=128,Ja(y,!1),h=_.updateQueue,h!==null&&(r.updateQueue=h,r.flags|=4),r.subtreeFlags=0,h=c,c=r.child;c!==null;)y=c,o=h,y.flags&=14680066,_=y.alternate,_===null?(y.childLanes=0,y.lanes=o,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=_.childLanes,y.lanes=_.lanes,y.child=_.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=_.memoizedProps,y.memoizedState=_.memoizedState,y.updateQueue=_.updateQueue,y.type=_.type,o=_.dependencies,y.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),c=c.sibling;return st(gt,gt.current&1|2),r.child}o=o.sibling}y.tail!==null&&It()>Is&&(r.flags|=128,h=!0,Ja(y,!1),r.lanes=4194304)}else{if(!h)if(o=$c(_),o!==null){if(r.flags|=128,h=!0,c=o.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),Ja(y,!0),y.tail===null&&y.tailMode==="hidden"&&!_.alternate&&!ut)return en(r),null}else 2*It()-y.renderingStartTime>Is&&c!==1073741824&&(r.flags|=128,h=!0,Ja(y,!1),r.lanes=4194304);y.isBackwards?(_.sibling=r.child,r.child=_):(c=y.last,c!==null?c.sibling=_:r.child=_,y.last=_)}return y.tail!==null?(r=y.tail,y.rendering=r,y.tail=r.sibling,y.renderingStartTime=It(),r.sibling=null,c=gt.current,st(gt,h?c&1|2:c&1),r):(en(r),null);case 22:case 23:return Rh(),h=r.memoizedState!==null,o!==null&&o.memoizedState!==null!==h&&(r.flags|=8192),h&&(r.mode&1)!==0?(bn&1073741824)!==0&&(en(r),r.subtreeFlags&6&&(r.flags|=8192)):en(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function fC(o,r){switch(Ff(r),r.tag){case 1:return En(r.type)&&Nc(),o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 3:return ys(),ct(Tn),ct(Qt),Kf(),o=r.flags,(o&65536)!==0&&(o&128)===0?(r.flags=o&-65537|128,r):null;case 5:return Xf(r),null;case 13:if(ct(gt),o=r.memoizedState,o!==null&&o.dehydrated!==null){if(r.alternate===null)throw Error(n(340));hs()}return o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 19:return ct(gt),null;case 4:return ys(),null;case 10:return xf(r.type._context),null;case 22:case 23:return Rh(),null;case 24:return null;default:return null}}var qc=!1,tn=!1,hC=typeof WeakSet=="function"?WeakSet:Set,ye=null;function vs(o,r){var c=o.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(h){St(o,r,h)}else c.current=null}function ph(o,r,c){try{c()}catch(h){St(o,r,h)}}var hy=!1;function gC(o,r){if(Rf=mc,o=zm(),vf(o)){if("selectionStart"in o)var c={start:o.selectionStart,end:o.selectionEnd};else e:{c=(c=o.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var p=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var _=0,O=-1,B=-1,W=0,Q=0,J=o,K=null;t:for(;;){for(var ge;J!==c||p!==0&&J.nodeType!==3||(O=_+p),J!==y||h!==0&&J.nodeType!==3||(B=_+h),J.nodeType===3&&(_+=J.nodeValue.length),(ge=J.firstChild)!==null;)K=J,J=ge;for(;;){if(J===o)break t;if(K===c&&++W===p&&(O=_),K===y&&++Q===h&&(B=_),(ge=J.nextSibling)!==null)break;J=K,K=J.parentNode}J=ge}c=O===-1||B===-1?null:{start:O,end:B}}else c=null}c=c||{start:0,end:0}}else c=null;for(Pf={focusedElem:o,selectionRange:c},mc=!1,ye=r;ye!==null;)if(r=ye,o=r.child,(r.subtreeFlags&1028)!==0&&o!==null)o.return=r,ye=o;else for(;ye!==null;){r=ye;try{var Ae=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(Ae!==null){var Ee=Ae.memoizedProps,Tt=Ae.memoizedState,$=r.stateNode,L=$.getSnapshotBeforeUpdate(r.elementType===r.type?Ee:di(r.type,Ee),Tt);$.__reactInternalSnapshotBeforeUpdate=L}break;case 3:var x=r.stateNode.containerInfo;x.nodeType===1?x.textContent="":x.nodeType===9&&x.documentElement&&x.removeChild(x.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(te){St(r,r.return,te)}if(o=r.sibling,o!==null){o.return=r.return,ye=o;break}ye=r.return}return Ae=hy,hy=!1,Ae}function el(o,r,c){var h=r.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var p=h=h.next;do{if((p.tag&o)===o){var y=p.destroy;p.destroy=void 0,y!==void 0&&ph(r,c,y)}p=p.next}while(p!==h)}}function Zc(o,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var c=r=r.next;do{if((c.tag&o)===o){var h=c.create;c.destroy=h()}c=c.next}while(c!==r)}}function mh(o){var r=o.ref;if(r!==null){var c=o.stateNode;switch(o.tag){case 5:o=c;break;default:o=c}typeof r=="function"?r(o):r.current=o}}function gy(o){var r=o.alternate;r!==null&&(o.alternate=null,gy(r)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(r=o.stateNode,r!==null&&(delete r[Ei],delete r[Wa],delete r[Of],delete r[qE],delete r[ZE])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function py(o){return o.tag===5||o.tag===3||o.tag===4}function my(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||py(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function yh(o,r,c){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?c.nodeType===8?c.parentNode.insertBefore(o,r):c.insertBefore(o,r):(c.nodeType===8?(r=c.parentNode,r.insertBefore(o,c)):(r=c,r.appendChild(o)),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=Pc));else if(h!==4&&(o=o.child,o!==null))for(yh(o,r,c),o=o.sibling;o!==null;)yh(o,r,c),o=o.sibling}function Sh(o,r,c){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?c.insertBefore(o,r):c.appendChild(o);else if(h!==4&&(o=o.child,o!==null))for(Sh(o,r,c),o=o.sibling;o!==null;)Sh(o,r,c),o=o.sibling}var Wt=null,ui=!1;function wo(o,r,c){for(c=c.child;c!==null;)yy(o,r,c),c=c.sibling}function yy(o,r,c){if(Ti&&typeof Ti.onCommitFiberUnmount=="function")try{Ti.onCommitFiberUnmount(dc,c)}catch{}switch(c.tag){case 5:tn||vs(c,r);case 6:var h=Wt,p=ui;Wt=null,wo(o,r,c),Wt=h,ui=p,Wt!==null&&(ui?(o=Wt,c=c.stateNode,o.nodeType===8?o.parentNode.removeChild(c):o.removeChild(c)):Wt.removeChild(c.stateNode));break;case 18:Wt!==null&&(ui?(o=Wt,c=c.stateNode,o.nodeType===8?Mf(o.parentNode,c):o.nodeType===1&&Mf(o,c),Oa(o)):Mf(Wt,c.stateNode));break;case 4:h=Wt,p=ui,Wt=c.stateNode.containerInfo,ui=!0,wo(o,r,c),Wt=h,ui=p;break;case 0:case 11:case 14:case 15:if(!tn&&(h=c.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){p=h=h.next;do{var y=p,_=y.destroy;y=y.tag,_!==void 0&&((y&2)!==0||(y&4)!==0)&&ph(c,r,_),p=p.next}while(p!==h)}wo(o,r,c);break;case 1:if(!tn&&(vs(c,r),h=c.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=c.memoizedProps,h.state=c.memoizedState,h.componentWillUnmount()}catch(O){St(c,r,O)}wo(o,r,c);break;case 21:wo(o,r,c);break;case 22:c.mode&1?(tn=(h=tn)||c.memoizedState!==null,wo(o,r,c),tn=h):wo(o,r,c);break;default:wo(o,r,c)}}function Sy(o){var r=o.updateQueue;if(r!==null){o.updateQueue=null;var c=o.stateNode;c===null&&(c=o.stateNode=new hC),r.forEach(function(h){var p=EC.bind(null,o,h);c.has(h)||(c.add(h),h.then(p,p))})}}function fi(o,r){var c=r.deletions;if(c!==null)for(var h=0;h<c.length;h++){var p=c[h];try{var y=o,_=r,O=_;e:for(;O!==null;){switch(O.tag){case 5:Wt=O.stateNode,ui=!1;break e;case 3:Wt=O.stateNode.containerInfo,ui=!0;break e;case 4:Wt=O.stateNode.containerInfo,ui=!0;break e}O=O.return}if(Wt===null)throw Error(n(160));yy(y,_,p),Wt=null,ui=!1;var B=p.alternate;B!==null&&(B.return=null),p.return=null}catch(W){St(p,r,W)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)vy(r,o),r=r.sibling}function vy(o,r){var c=o.alternate,h=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(fi(r,o),wi(o),h&4){try{el(3,o,o.return),Zc(3,o)}catch(Ee){St(o,o.return,Ee)}try{el(5,o,o.return)}catch(Ee){St(o,o.return,Ee)}}break;case 1:fi(r,o),wi(o),h&512&&c!==null&&vs(c,c.return);break;case 5:if(fi(r,o),wi(o),h&512&&c!==null&&vs(c,c.return),o.flags&32){var p=o.stateNode;try{Ia(p,"")}catch(Ee){St(o,o.return,Ee)}}if(h&4&&(p=o.stateNode,p!=null)){var y=o.memoizedProps,_=c!==null?c.memoizedProps:y,O=o.type,B=o.updateQueue;if(o.updateQueue=null,B!==null)try{O==="input"&&y.type==="radio"&&y.name!=null&&vi(p,y),Vu(O,_);var W=Vu(O,y);for(_=0;_<B.length;_+=2){var Q=B[_],J=B[_+1];Q==="style"?tm(p,J):Q==="dangerouslySetInnerHTML"?Jp(p,J):Q==="children"?Ia(p,J):w(p,Q,J,W)}switch(O){case"input":In(p,y);break;case"textarea":qp(p,y);break;case"select":var K=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!y.multiple;var ge=y.value;ge!=null?ho(p,!!y.multiple,ge,!1):K!==!!y.multiple&&(y.defaultValue!=null?ho(p,!!y.multiple,y.defaultValue,!0):ho(p,!!y.multiple,y.multiple?[]:"",!1))}p[Wa]=y}catch(Ee){St(o,o.return,Ee)}}break;case 6:if(fi(r,o),wi(o),h&4){if(o.stateNode===null)throw Error(n(162));p=o.stateNode,y=o.memoizedProps;try{p.nodeValue=y}catch(Ee){St(o,o.return,Ee)}}break;case 3:if(fi(r,o),wi(o),h&4&&c!==null&&c.memoizedState.isDehydrated)try{Oa(r.containerInfo)}catch(Ee){St(o,o.return,Ee)}break;case 4:fi(r,o),wi(o);break;case 13:fi(r,o),wi(o),p=o.child,p.flags&8192&&(y=p.memoizedState!==null,p.stateNode.isHidden=y,!y||p.alternate!==null&&p.alternate.memoizedState!==null||(Ih=It())),h&4&&Sy(o);break;case 22:if(Q=c!==null&&c.memoizedState!==null,o.mode&1?(tn=(W=tn)||Q,fi(r,o),tn=W):fi(r,o),wi(o),h&8192){if(W=o.memoizedState!==null,(o.stateNode.isHidden=W)&&!Q&&(o.mode&1)!==0)for(ye=o,Q=o.child;Q!==null;){for(J=ye=Q;ye!==null;){switch(K=ye,ge=K.child,K.tag){case 0:case 11:case 14:case 15:el(4,K,K.return);break;case 1:vs(K,K.return);var Ae=K.stateNode;if(typeof Ae.componentWillUnmount=="function"){h=K,c=K.return;try{r=h,Ae.props=r.memoizedProps,Ae.state=r.memoizedState,Ae.componentWillUnmount()}catch(Ee){St(h,c,Ee)}}break;case 5:vs(K,K.return);break;case 22:if(K.memoizedState!==null){Ty(J);continue}}ge!==null?(ge.return=K,ye=ge):Ty(J)}Q=Q.sibling}e:for(Q=null,J=o;;){if(J.tag===5){if(Q===null){Q=J;try{p=J.stateNode,W?(y=p.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(O=J.stateNode,B=J.memoizedProps.style,_=B!=null&&B.hasOwnProperty("display")?B.display:null,O.style.display=em("display",_))}catch(Ee){St(o,o.return,Ee)}}}else if(J.tag===6){if(Q===null)try{J.stateNode.nodeValue=W?"":J.memoizedProps}catch(Ee){St(o,o.return,Ee)}}else if((J.tag!==22&&J.tag!==23||J.memoizedState===null||J===o)&&J.child!==null){J.child.return=J,J=J.child;continue}if(J===o)break e;for(;J.sibling===null;){if(J.return===null||J.return===o)break e;Q===J&&(Q=null),J=J.return}Q===J&&(Q=null),J.sibling.return=J.return,J=J.sibling}}break;case 19:fi(r,o),wi(o),h&4&&Sy(o);break;case 21:break;default:fi(r,o),wi(o)}}function wi(o){var r=o.flags;if(r&2){try{e:{for(var c=o.return;c!==null;){if(py(c)){var h=c;break e}c=c.return}throw Error(n(160))}switch(h.tag){case 5:var p=h.stateNode;h.flags&32&&(Ia(p,""),h.flags&=-33);var y=my(o);Sh(o,y,p);break;case 3:case 4:var _=h.stateNode.containerInfo,O=my(o);yh(o,O,_);break;default:throw Error(n(161))}}catch(B){St(o,o.return,B)}o.flags&=-3}r&4096&&(o.flags&=-4097)}function pC(o,r,c){ye=o,Ay(o)}function Ay(o,r,c){for(var h=(o.mode&1)!==0;ye!==null;){var p=ye,y=p.child;if(p.tag===22&&h){var _=p.memoizedState!==null||qc;if(!_){var O=p.alternate,B=O!==null&&O.memoizedState!==null||tn;O=qc;var W=tn;if(qc=_,(tn=B)&&!W)for(ye=p;ye!==null;)_=ye,B=_.child,_.tag===22&&_.memoizedState!==null?Ey(p):B!==null?(B.return=_,ye=B):Ey(p);for(;y!==null;)ye=y,Ay(y),y=y.sibling;ye=p,qc=O,tn=W}Iy(o)}else(p.subtreeFlags&8772)!==0&&y!==null?(y.return=p,ye=y):Iy(o)}}function Iy(o){for(;ye!==null;){var r=ye;if((r.flags&8772)!==0){var c=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:tn||Zc(5,r);break;case 1:var h=r.stateNode;if(r.flags&4&&!tn)if(c===null)h.componentDidMount();else{var p=r.elementType===r.type?c.memoizedProps:di(r.type,c.memoizedProps);h.componentDidUpdate(p,c.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var y=r.updateQueue;y!==null&&T0(r,y,h);break;case 3:var _=r.updateQueue;if(_!==null){if(c=null,r.child!==null)switch(r.child.tag){case 5:c=r.child.stateNode;break;case 1:c=r.child.stateNode}T0(r,_,c)}break;case 5:var O=r.stateNode;if(c===null&&r.flags&4){c=O;var B=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":B.autoFocus&&c.focus();break;case"img":B.src&&(c.src=B.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var W=r.alternate;if(W!==null){var Q=W.memoizedState;if(Q!==null){var J=Q.dehydrated;J!==null&&Oa(J)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}tn||r.flags&512&&mh(r)}catch(K){St(r,r.return,K)}}if(r===o){ye=null;break}if(c=r.sibling,c!==null){c.return=r.return,ye=c;break}ye=r.return}}function Ty(o){for(;ye!==null;){var r=ye;if(r===o){ye=null;break}var c=r.sibling;if(c!==null){c.return=r.return,ye=c;break}ye=r.return}}function Ey(o){for(;ye!==null;){var r=ye;try{switch(r.tag){case 0:case 11:case 15:var c=r.return;try{Zc(4,r)}catch(B){St(r,c,B)}break;case 1:var h=r.stateNode;if(typeof h.componentDidMount=="function"){var p=r.return;try{h.componentDidMount()}catch(B){St(r,p,B)}}var y=r.return;try{mh(r)}catch(B){St(r,y,B)}break;case 5:var _=r.return;try{mh(r)}catch(B){St(r,_,B)}}}catch(B){St(r,r.return,B)}if(r===o){ye=null;break}var O=r.sibling;if(O!==null){O.return=r.return,ye=O;break}ye=r.return}}var mC=Math.ceil,Qc=k.ReactCurrentDispatcher,vh=k.ReactCurrentOwner,Qn=k.ReactCurrentBatchConfig,Ve=0,Bt=null,wt=null,Yt=0,bn=0,As=Io(0),Mt=0,tl=null,pr=0,Jc=0,Ah=0,nl=null,_n=null,Ih=0,Is=1/0,Xi=null,ed=!1,Th=null,Ro=null,td=!1,Po=null,nd=0,il=0,Eh=null,id=-1,od=0;function un(){return(Ve&6)!==0?It():id!==-1?id:id=It()}function Do(o){return(o.mode&1)===0?1:(Ve&2)!==0&&Yt!==0?Yt&-Yt:JE.transition!==null?(od===0&&(od=mm()),od):(o=tt,o!==0||(o=window.event,o=o===void 0?16:_m(o.type)),o)}function hi(o,r,c,h){if(50<il)throw il=0,Eh=null,Error(n(185));Ra(o,c,h),((Ve&2)===0||o!==Bt)&&(o===Bt&&((Ve&2)===0&&(Jc|=c),Mt===4&&No(o,Yt)),wn(o,h),c===1&&Ve===0&&(r.mode&1)===0&&(Is=It()+500,Oc&&Eo()))}function wn(o,r){var c=o.callbackNode;JT(o,r);var h=hc(o,o===Bt?Yt:0);if(h===0)c!==null&&hm(c),o.callbackNode=null,o.callbackPriority=0;else if(r=h&-h,o.callbackPriority!==r){if(c!=null&&hm(c),r===1)o.tag===0?QE(_y.bind(null,o)):d0(_y.bind(null,o)),VE(function(){(Ve&6)===0&&Eo()}),c=null;else{switch(ym(h)){case 1:c=tf;break;case 4:c=gm;break;case 16:c=cc;break;case 536870912:c=pm;break;default:c=cc}c=ky(c,Cy.bind(null,o))}o.callbackPriority=r,o.callbackNode=c}}function Cy(o,r){if(id=-1,od=0,(Ve&6)!==0)throw Error(n(327));var c=o.callbackNode;if(Ts()&&o.callbackNode!==c)return null;var h=hc(o,o===Bt?Yt:0);if(h===0)return null;if((h&30)!==0||(h&o.expiredLanes)!==0||r)r=rd(o,h);else{r=h;var p=Ve;Ve|=2;var y=Ry();(Bt!==o||Yt!==r)&&(Xi=null,Is=It()+500,yr(o,r));do try{vC();break}catch(O){wy(o,O)}while(!0);$f(),Qc.current=y,Ve=p,wt!==null?r=0:(Bt=null,Yt=0,r=Mt)}if(r!==0){if(r===2&&(p=nf(o),p!==0&&(h=p,r=Ch(o,p))),r===1)throw c=tl,yr(o,0),No(o,h),wn(o,It()),c;if(r===6)No(o,h);else{if(p=o.current.alternate,(h&30)===0&&!yC(p)&&(r=rd(o,h),r===2&&(y=nf(o),y!==0&&(h=y,r=Ch(o,y))),r===1))throw c=tl,yr(o,0),No(o,h),wn(o,It()),c;switch(o.finishedWork=p,o.finishedLanes=h,r){case 0:case 1:throw Error(n(345));case 2:Sr(o,_n,Xi);break;case 3:if(No(o,h),(h&130023424)===h&&(r=Ih+500-It(),10<r)){if(hc(o,0)!==0)break;if(p=o.suspendedLanes,(p&h)!==h){un(),o.pingedLanes|=o.suspendedLanes&p;break}o.timeoutHandle=Nf(Sr.bind(null,o,_n,Xi),r);break}Sr(o,_n,Xi);break;case 4:if(No(o,h),(h&4194240)===h)break;for(r=o.eventTimes,p=-1;0<h;){var _=31-ai(h);y=1<<_,_=r[_],_>p&&(p=_),h&=~y}if(h=p,h=It()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*mC(h/1960))-h,10<h){o.timeoutHandle=Nf(Sr.bind(null,o,_n,Xi),h);break}Sr(o,_n,Xi);break;case 5:Sr(o,_n,Xi);break;default:throw Error(n(329))}}}return wn(o,It()),o.callbackNode===c?Cy.bind(null,o):null}function Ch(o,r){var c=nl;return o.current.memoizedState.isDehydrated&&(yr(o,r).flags|=256),o=rd(o,r),o!==2&&(r=_n,_n=c,r!==null&&_h(r)),o}function _h(o){_n===null?_n=o:_n.push.apply(_n,o)}function yC(o){for(var r=o;;){if(r.flags&16384){var c=r.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var h=0;h<c.length;h++){var p=c[h],y=p.getSnapshot;p=p.value;try{if(!li(y(),p))return!1}catch{return!1}}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function No(o,r){for(r&=~Ah,r&=~Jc,o.suspendedLanes|=r,o.pingedLanes&=~r,o=o.expirationTimes;0<r;){var c=31-ai(r),h=1<<c;o[c]=-1,r&=~h}}function _y(o){if((Ve&6)!==0)throw Error(n(327));Ts();var r=hc(o,0);if((r&1)===0)return wn(o,It()),null;var c=rd(o,r);if(o.tag!==0&&c===2){var h=nf(o);h!==0&&(r=h,c=Ch(o,h))}if(c===1)throw c=tl,yr(o,0),No(o,r),wn(o,It()),c;if(c===6)throw Error(n(345));return o.finishedWork=o.current.alternate,o.finishedLanes=r,Sr(o,_n,Xi),wn(o,It()),null}function wh(o,r){var c=Ve;Ve|=1;try{return o(r)}finally{Ve=c,Ve===0&&(Is=It()+500,Oc&&Eo())}}function mr(o){Po!==null&&Po.tag===0&&(Ve&6)===0&&Ts();var r=Ve;Ve|=1;var c=Qn.transition,h=tt;try{if(Qn.transition=null,tt=1,o)return o()}finally{tt=h,Qn.transition=c,Ve=r,(Ve&6)===0&&Eo()}}function Rh(){bn=As.current,ct(As)}function yr(o,r){o.finishedWork=null,o.finishedLanes=0;var c=o.timeoutHandle;if(c!==-1&&(o.timeoutHandle=-1,XE(c)),wt!==null)for(c=wt.return;c!==null;){var h=c;switch(Ff(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&Nc();break;case 3:ys(),ct(Tn),ct(Qt),Kf();break;case 5:Xf(h);break;case 4:ys();break;case 13:ct(gt);break;case 19:ct(gt);break;case 10:xf(h.type._context);break;case 22:case 23:Rh()}c=c.return}if(Bt=o,wt=o=Mo(o.current,null),Yt=bn=r,Mt=0,tl=null,Ah=Jc=pr=0,_n=nl=null,fr!==null){for(r=0;r<fr.length;r++)if(c=fr[r],h=c.interleaved,h!==null){c.interleaved=null;var p=h.next,y=c.pending;if(y!==null){var _=y.next;y.next=p,h.next=_}c.pending=h}fr=null}return o}function wy(o,r){do{var c=wt;try{if($f(),xc.current=jc,Wc){for(var h=pt.memoizedState;h!==null;){var p=h.queue;p!==null&&(p.pending=null),h=h.next}Wc=!1}if(gr=0,bt=Nt=pt=null,Ka=!1,qa=0,vh.current=null,c===null||c.return===null){Mt=1,tl=r,wt=null;break}e:{var y=o,_=c.return,O=c,B=r;if(r=Yt,O.flags|=32768,B!==null&&typeof B=="object"&&typeof B.then=="function"){var W=B,Q=O,J=Q.tag;if((Q.mode&1)===0&&(J===0||J===11||J===15)){var K=Q.alternate;K?(Q.updateQueue=K.updateQueue,Q.memoizedState=K.memoizedState,Q.lanes=K.lanes):(Q.updateQueue=null,Q.memoizedState=null)}var ge=Z0(_);if(ge!==null){ge.flags&=-257,Q0(ge,_,O,y,r),ge.mode&1&&q0(y,W,r),r=ge,B=W;var Ae=r.updateQueue;if(Ae===null){var Ee=new Set;Ee.add(B),r.updateQueue=Ee}else Ae.add(B);break e}else{if((r&1)===0){q0(y,W,r),Ph();break e}B=Error(n(426))}}else if(ut&&O.mode&1){var Tt=Z0(_);if(Tt!==null){(Tt.flags&65536)===0&&(Tt.flags|=256),Q0(Tt,_,O,y,r),Hf(Ss(B,O));break e}}y=B=Ss(B,O),Mt!==4&&(Mt=2),nl===null?nl=[y]:nl.push(y),y=_;do{switch(y.tag){case 3:y.flags|=65536,r&=-r,y.lanes|=r;var $=V0(y,B,r);I0(y,$);break e;case 1:O=B;var L=y.type,x=y.stateNode;if((y.flags&128)===0&&(typeof L.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(Ro===null||!Ro.has(x)))){y.flags|=65536,r&=-r,y.lanes|=r;var te=K0(y,O,r);I0(y,te);break e}}y=y.return}while(y!==null)}Dy(c)}catch(we){r=we,wt===c&&c!==null&&(wt=c=c.return);continue}break}while(!0)}function Ry(){var o=Qc.current;return Qc.current=jc,o===null?jc:o}function Ph(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),Bt===null||(pr&268435455)===0&&(Jc&268435455)===0||No(Bt,Yt)}function rd(o,r){var c=Ve;Ve|=2;var h=Ry();(Bt!==o||Yt!==r)&&(Xi=null,yr(o,r));do try{SC();break}catch(p){wy(o,p)}while(!0);if($f(),Ve=c,Qc.current=h,wt!==null)throw Error(n(261));return Bt=null,Yt=0,Mt}function SC(){for(;wt!==null;)Py(wt)}function vC(){for(;wt!==null&&!YT();)Py(wt)}function Py(o){var r=Oy(o.alternate,o,bn);o.memoizedProps=o.pendingProps,r===null?Dy(o):wt=r,vh.current=null}function Dy(o){var r=o;do{var c=r.alternate;if(o=r.return,(r.flags&32768)===0){if(c=uC(c,r,bn),c!==null){wt=c;return}}else{if(c=fC(c,r),c!==null){c.flags&=32767,wt=c;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{Mt=6,wt=null;return}}if(r=r.sibling,r!==null){wt=r;return}wt=r=o}while(r!==null);Mt===0&&(Mt=5)}function Sr(o,r,c){var h=tt,p=Qn.transition;try{Qn.transition=null,tt=1,AC(o,r,c,h)}finally{Qn.transition=p,tt=h}return null}function AC(o,r,c,h){do Ts();while(Po!==null);if((Ve&6)!==0)throw Error(n(327));c=o.finishedWork;var p=o.finishedLanes;if(c===null)return null;if(o.finishedWork=null,o.finishedLanes=0,c===o.current)throw Error(n(177));o.callbackNode=null,o.callbackPriority=0;var y=c.lanes|c.childLanes;if(eE(o,y),o===Bt&&(wt=Bt=null,Yt=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||td||(td=!0,ky(cc,function(){return Ts(),null})),y=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||y){y=Qn.transition,Qn.transition=null;var _=tt;tt=1;var O=Ve;Ve|=4,vh.current=null,gC(o,c),vy(c,o),GE(Pf),mc=!!Rf,Pf=Rf=null,o.current=c,pC(c),zT(),Ve=O,tt=_,Qn.transition=y}else o.current=c;if(td&&(td=!1,Po=o,nd=p),y=o.pendingLanes,y===0&&(Ro=null),VT(c.stateNode),wn(o,It()),r!==null)for(h=o.onRecoverableError,c=0;c<r.length;c++)p=r[c],h(p.value,{componentStack:p.stack,digest:p.digest});if(ed)throw ed=!1,o=Th,Th=null,o;return(nd&1)!==0&&o.tag!==0&&Ts(),y=o.pendingLanes,(y&1)!==0?o===Eh?il++:(il=0,Eh=o):il=0,Eo(),null}function Ts(){if(Po!==null){var o=ym(nd),r=Qn.transition,c=tt;try{if(Qn.transition=null,tt=16>o?16:o,Po===null)var h=!1;else{if(o=Po,Po=null,nd=0,(Ve&6)!==0)throw Error(n(331));var p=Ve;for(Ve|=4,ye=o.current;ye!==null;){var y=ye,_=y.child;if((ye.flags&16)!==0){var O=y.deletions;if(O!==null){for(var B=0;B<O.length;B++){var W=O[B];for(ye=W;ye!==null;){var Q=ye;switch(Q.tag){case 0:case 11:case 15:el(8,Q,y)}var J=Q.child;if(J!==null)J.return=Q,ye=J;else for(;ye!==null;){Q=ye;var K=Q.sibling,ge=Q.return;if(gy(Q),Q===W){ye=null;break}if(K!==null){K.return=ge,ye=K;break}ye=ge}}}var Ae=y.alternate;if(Ae!==null){var Ee=Ae.child;if(Ee!==null){Ae.child=null;do{var Tt=Ee.sibling;Ee.sibling=null,Ee=Tt}while(Ee!==null)}}ye=y}}if((y.subtreeFlags&2064)!==0&&_!==null)_.return=y,ye=_;else e:for(;ye!==null;){if(y=ye,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:el(9,y,y.return)}var $=y.sibling;if($!==null){$.return=y.return,ye=$;break e}ye=y.return}}var L=o.current;for(ye=L;ye!==null;){_=ye;var x=_.child;if((_.subtreeFlags&2064)!==0&&x!==null)x.return=_,ye=x;else e:for(_=L;ye!==null;){if(O=ye,(O.flags&2048)!==0)try{switch(O.tag){case 0:case 11:case 15:Zc(9,O)}}catch(we){St(O,O.return,we)}if(O===_){ye=null;break e}var te=O.sibling;if(te!==null){te.return=O.return,ye=te;break e}ye=O.return}}if(Ve=p,Eo(),Ti&&typeof Ti.onPostCommitFiberRoot=="function")try{Ti.onPostCommitFiberRoot(dc,o)}catch{}h=!0}return h}finally{tt=c,Qn.transition=r}}return!1}function Ny(o,r,c){r=Ss(c,r),r=V0(o,r,1),o=_o(o,r,1),r=un(),o!==null&&(Ra(o,1,r),wn(o,r))}function St(o,r,c){if(o.tag===3)Ny(o,o,c);else for(;r!==null;){if(r.tag===3){Ny(r,o,c);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Ro===null||!Ro.has(h))){o=Ss(c,o),o=K0(r,o,1),r=_o(r,o,1),o=un(),r!==null&&(Ra(r,1,o),wn(r,o));break}}r=r.return}}function IC(o,r,c){var h=o.pingCache;h!==null&&h.delete(r),r=un(),o.pingedLanes|=o.suspendedLanes&c,Bt===o&&(Yt&c)===c&&(Mt===4||Mt===3&&(Yt&130023424)===Yt&&500>It()-Ih?yr(o,0):Ah|=c),wn(o,r)}function My(o,r){r===0&&((o.mode&1)===0?r=1:(r=fc,fc<<=1,(fc&130023424)===0&&(fc=4194304)));var c=un();o=Yi(o,r),o!==null&&(Ra(o,r,c),wn(o,c))}function TC(o){var r=o.memoizedState,c=0;r!==null&&(c=r.retryLane),My(o,c)}function EC(o,r){var c=0;switch(o.tag){case 13:var h=o.stateNode,p=o.memoizedState;p!==null&&(c=p.retryLane);break;case 19:h=o.stateNode;break;default:throw Error(n(314))}h!==null&&h.delete(r),My(o,c)}var Oy;Oy=function(o,r,c){if(o!==null)if(o.memoizedProps!==r.pendingProps||Tn.current)Cn=!0;else{if((o.lanes&c)===0&&(r.flags&128)===0)return Cn=!1,dC(o,r,c);Cn=(o.flags&131072)!==0}else Cn=!1,ut&&(r.flags&1048576)!==0&&u0(r,bc,r.index);switch(r.lanes=0,r.tag){case 2:var h=r.type;Kc(o,r),o=r.pendingProps;var p=ds(r,Qt.current);ms(r,c),p=Qf(null,r,h,o,p,c);var y=Jf();return r.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,En(h)?(y=!0,Mc(r)):y=!1,r.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,zf(r),p.updater=Xc,r.stateNode=p,p._reactInternals=r,rh(r,h,o,c),r=ch(null,r,h,!0,y,c)):(r.tag=0,ut&&y&&Bf(r),dn(null,r,p,c),r=r.child),r;case 16:h=r.elementType;e:{switch(Kc(o,r),o=r.pendingProps,p=h._init,h=p(h._payload),r.type=h,p=r.tag=_C(h),o=di(h,o),p){case 0:r=lh(null,r,h,o,c);break e;case 1:r=oy(null,r,h,o,c);break e;case 11:r=J0(null,r,h,o,c);break e;case 14:r=ey(null,r,h,di(h.type,o),c);break e}throw Error(n(306,h,""))}return r;case 0:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:di(h,p),lh(o,r,h,p,c);case 1:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:di(h,p),oy(o,r,h,p,c);case 3:e:{if(ry(r),o===null)throw Error(n(387));h=r.pendingProps,y=r.memoizedState,p=y.element,A0(o,r),Gc(r,h,null,c);var _=r.memoizedState;if(h=_.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:_.cache,pendingSuspenseBoundaries:_.pendingSuspenseBoundaries,transitions:_.transitions},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){p=Ss(Error(n(423)),r),r=sy(o,r,h,c,p);break e}else if(h!==p){p=Ss(Error(n(424)),r),r=sy(o,r,h,c,p);break e}else for(kn=Ao(r.stateNode.containerInfo.firstChild),On=r,ut=!0,ci=null,c=S0(r,null,h,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(hs(),h===p){r=ji(o,r,c);break e}dn(o,r,h,c)}r=r.child}return r;case 5:return E0(r),o===null&&Uf(r),h=r.type,p=r.pendingProps,y=o!==null?o.memoizedProps:null,_=p.children,Df(h,p)?_=null:y!==null&&Df(h,y)&&(r.flags|=32),iy(o,r),dn(o,r,_,c),r.child;case 6:return o===null&&Uf(r),null;case 13:return ay(o,r,c);case 4:return jf(r,r.stateNode.containerInfo),h=r.pendingProps,o===null?r.child=gs(r,null,h,c):dn(o,r,h,c),r.child;case 11:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:di(h,p),J0(o,r,h,p,c);case 7:return dn(o,r,r.pendingProps,c),r.child;case 8:return dn(o,r,r.pendingProps.children,c),r.child;case 12:return dn(o,r,r.pendingProps.children,c),r.child;case 10:e:{if(h=r.type._context,p=r.pendingProps,y=r.memoizedProps,_=p.value,st(Lc,h._currentValue),h._currentValue=_,y!==null)if(li(y.value,_)){if(y.children===p.children&&!Tn.current){r=ji(o,r,c);break e}}else for(y=r.child,y!==null&&(y.return=r);y!==null;){var O=y.dependencies;if(O!==null){_=y.child;for(var B=O.firstContext;B!==null;){if(B.context===h){if(y.tag===1){B=zi(-1,c&-c),B.tag=2;var W=y.updateQueue;if(W!==null){W=W.shared;var Q=W.pending;Q===null?B.next=B:(B.next=Q.next,Q.next=B),W.pending=B}}y.lanes|=c,B=y.alternate,B!==null&&(B.lanes|=c),Wf(y.return,c,r),O.lanes|=c;break}B=B.next}}else if(y.tag===10)_=y.type===r.type?null:y.child;else if(y.tag===18){if(_=y.return,_===null)throw Error(n(341));_.lanes|=c,O=_.alternate,O!==null&&(O.lanes|=c),Wf(_,c,r),_=y.sibling}else _=y.child;if(_!==null)_.return=y;else for(_=y;_!==null;){if(_===r){_=null;break}if(y=_.sibling,y!==null){y.return=_.return,_=y;break}_=_.return}y=_}dn(o,r,p.children,c),r=r.child}return r;case 9:return p=r.type,h=r.pendingProps.children,ms(r,c),p=qn(p),h=h(p),r.flags|=1,dn(o,r,h,c),r.child;case 14:return h=r.type,p=di(h,r.pendingProps),p=di(h.type,p),ey(o,r,h,p,c);case 15:return ty(o,r,r.type,r.pendingProps,c);case 17:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:di(h,p),Kc(o,r),r.tag=1,En(h)?(o=!0,Mc(r)):o=!1,ms(r,c),j0(r,h,p),rh(r,h,p,c),ch(null,r,h,!0,o,c);case 19:return cy(o,r,c);case 22:return ny(o,r,c)}throw Error(n(156,r.tag))};function ky(o,r){return fm(o,r)}function CC(o,r,c,h){this.tag=o,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jn(o,r,c,h){return new CC(o,r,c,h)}function Dh(o){return o=o.prototype,!(!o||!o.isReactComponent)}function _C(o){if(typeof o=="function")return Dh(o)?1:0;if(o!=null){if(o=o.$$typeof,o===j)return 11;if(o===Se)return 14}return 2}function Mo(o,r){var c=o.alternate;return c===null?(c=Jn(o.tag,r,o.key,o.mode),c.elementType=o.elementType,c.type=o.type,c.stateNode=o.stateNode,c.alternate=o,o.alternate=c):(c.pendingProps=r,c.type=o.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=o.flags&14680064,c.childLanes=o.childLanes,c.lanes=o.lanes,c.child=o.child,c.memoizedProps=o.memoizedProps,c.memoizedState=o.memoizedState,c.updateQueue=o.updateQueue,r=o.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=o.sibling,c.index=o.index,c.ref=o.ref,c}function sd(o,r,c,h,p,y){var _=2;if(h=o,typeof o=="function")Dh(o)&&(_=1);else if(typeof o=="string")_=5;else e:switch(o){case N:return vr(c.children,p,y,r);case b:_=8,p|=8;break;case H:return o=Jn(12,c,r,p|2),o.elementType=H,o.lanes=y,o;case ee:return o=Jn(13,c,r,p),o.elementType=ee,o.lanes=y,o;case ne:return o=Jn(19,c,r,p),o.elementType=ne,o.lanes=y,o;case oe:return ad(c,p,y,r);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case z:_=10;break e;case V:_=9;break e;case j:_=11;break e;case Se:_=14;break e;case ce:_=16,h=null;break e}throw Error(n(130,o==null?o:typeof o,""))}return r=Jn(_,c,r,p),r.elementType=o,r.type=h,r.lanes=y,r}function vr(o,r,c,h){return o=Jn(7,o,h,r),o.lanes=c,o}function ad(o,r,c,h){return o=Jn(22,o,h,r),o.elementType=oe,o.lanes=c,o.stateNode={isHidden:!1},o}function Nh(o,r,c){return o=Jn(6,o,null,r),o.lanes=c,o}function Mh(o,r,c){return r=Jn(4,o.children!==null?o.children:[],o.key,r),r.lanes=c,r.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},r}function wC(o,r,c,h,p){this.tag=r,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=of(0),this.expirationTimes=of(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=of(0),this.identifierPrefix=h,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function Oh(o,r,c,h,p,y,_,O,B){return o=new wC(o,r,c,O,B),r===1?(r=1,y===!0&&(r|=8)):r=0,y=Jn(3,null,null,r),o.current=y,y.stateNode=o,y.memoizedState={element:h,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},zf(y),o}function RC(o,r,c){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:h==null?null:""+h,children:o,containerInfo:r,implementation:c}}function by(o){if(!o)return To;o=o._reactInternals;e:{if(ar(o)!==o||o.tag!==1)throw Error(n(170));var r=o;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(En(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(o.tag===1){var c=o.type;if(En(c))return l0(o,c,r)}return r}function By(o,r,c,h,p,y,_,O,B){return o=Oh(c,h,!0,o,p,y,_,O,B),o.context=by(null),c=o.current,h=un(),p=Do(c),y=zi(h,p),y.callback=r??null,_o(c,y,p),o.current.lanes=p,Ra(o,p,h),wn(o,h),o}function ld(o,r,c,h){var p=r.current,y=un(),_=Do(p);return c=by(c),r.context===null?r.context=c:r.pendingContext=c,r=zi(y,_),r.payload={element:o},h=h===void 0?null:h,h!==null&&(r.callback=h),o=_o(p,r,_),o!==null&&(hi(o,p,_,y),Hc(o,p,_)),_}function cd(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function Fy(o,r){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var c=o.retryLane;o.retryLane=c!==0&&c<r?c:r}}function kh(o,r){Fy(o,r),(o=o.alternate)&&Fy(o,r)}function PC(){return null}var Ly=typeof reportError=="function"?reportError:function(o){console.error(o)};function bh(o){this._internalRoot=o}dd.prototype.render=bh.prototype.render=function(o){var r=this._internalRoot;if(r===null)throw Error(n(409));ld(o,r,null,null)},dd.prototype.unmount=bh.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var r=o.containerInfo;mr(function(){ld(null,o,null,null)}),r[Gi]=null}};function dd(o){this._internalRoot=o}dd.prototype.unstable_scheduleHydration=function(o){if(o){var r=Am();o={blockedOn:null,target:o,priority:r};for(var c=0;c<yo.length&&r!==0&&r<yo[c].priority;c++);yo.splice(c,0,o),c===0&&Em(o)}};function Bh(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function ud(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function Uy(){}function DC(o,r,c,h,p){if(p){if(typeof h=="function"){var y=h;h=function(){var W=cd(_);y.call(W)}}var _=By(r,h,o,0,null,!1,!1,"",Uy);return o._reactRootContainer=_,o[Gi]=_.current,$a(o.nodeType===8?o.parentNode:o),mr(),_}for(;p=o.lastChild;)o.removeChild(p);if(typeof h=="function"){var O=h;h=function(){var W=cd(B);O.call(W)}}var B=Oh(o,0,!1,null,null,!1,!1,"",Uy);return o._reactRootContainer=B,o[Gi]=B.current,$a(o.nodeType===8?o.parentNode:o),mr(function(){ld(r,B,c,h)}),B}function fd(o,r,c,h,p){var y=c._reactRootContainer;if(y){var _=y;if(typeof p=="function"){var O=p;p=function(){var B=cd(_);O.call(B)}}ld(r,_,o,p)}else _=DC(c,r,o,p,h);return cd(_)}Sm=function(o){switch(o.tag){case 3:var r=o.stateNode;if(r.current.memoizedState.isDehydrated){var c=wa(r.pendingLanes);c!==0&&(rf(r,c|1),wn(r,It()),(Ve&6)===0&&(Is=It()+500,Eo()))}break;case 13:mr(function(){var h=Yi(o,1);if(h!==null){var p=un();hi(h,o,1,p)}}),kh(o,1)}},sf=function(o){if(o.tag===13){var r=Yi(o,134217728);if(r!==null){var c=un();hi(r,o,134217728,c)}kh(o,134217728)}},vm=function(o){if(o.tag===13){var r=Do(o),c=Yi(o,r);if(c!==null){var h=un();hi(c,o,r,h)}kh(o,r)}},Am=function(){return tt},Im=function(o,r){var c=tt;try{return tt=o,r()}finally{tt=c}},Zu=function(o,r,c){switch(r){case"input":if(In(o,c),r=c.name,c.type==="radio"&&r!=null){for(c=o;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<c.length;r++){var h=c[r];if(h!==o&&h.form===o.form){var p=Dc(h);if(!p)throw Error(n(90));Te(h),In(h,p)}}}break;case"textarea":qp(o,c);break;case"select":r=c.value,r!=null&&ho(o,!!c.multiple,r,!1)}},rm=wh,sm=mr;var NC={usingClientEntryPoint:!1,Events:[Ya,ls,Dc,im,om,wh]},ol={findFiberByHostInstance:lr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},MC={bundleType:ol.bundleType,version:ol.version,rendererPackageName:ol.rendererPackageName,rendererConfig:ol.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=dm(o),o===null?null:o.stateNode},findFiberByHostInstance:ol.findFiberByHostInstance||PC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var hd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!hd.isDisabled&&hd.supportsFiber)try{dc=hd.inject(MC),Ti=hd}catch{}}return Rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=NC,Rn.createPortal=function(o,r){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Bh(r))throw Error(n(200));return RC(o,r,null,c)},Rn.createRoot=function(o,r){if(!Bh(o))throw Error(n(299));var c=!1,h="",p=Ly;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),r=Oh(o,1,!1,null,null,c,!1,h,p),o[Gi]=r.current,$a(o.nodeType===8?o.parentNode:o),new bh(r)},Rn.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var r=o._reactInternals;if(r===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=dm(r),o=o===null?null:o.stateNode,o},Rn.flushSync=function(o){return mr(o)},Rn.hydrate=function(o,r,c){if(!ud(r))throw Error(n(200));return fd(null,o,r,!0,c)},Rn.hydrateRoot=function(o,r,c){if(!Bh(o))throw Error(n(405));var h=c!=null&&c.hydratedSources||null,p=!1,y="",_=Ly;if(c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(y=c.identifierPrefix),c.onRecoverableError!==void 0&&(_=c.onRecoverableError)),r=By(r,null,o,1,c??null,p,!1,y,_),o[Gi]=r.current,$a(o),h)for(o=0;o<h.length;o++)c=h[o],p=c._getVersion,p=p(c._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[c,p]:r.mutableSourceEagerHydrationData.push(c,p);return new dd(r)},Rn.render=function(o,r,c){if(!ud(r))throw Error(n(200));return fd(null,o,r,!1,c)},Rn.unmountComponentAtNode=function(o){if(!ud(o))throw Error(n(40));return o._reactRootContainer?(mr(function(){fd(null,null,o,!1,function(){o._reactRootContainer=null,o[Gi]=null})}),!0):!1},Rn.unstable_batchedUpdates=wh,Rn.unstable_renderSubtreeIntoContainer=function(o,r,c,h){if(!ud(c))throw Error(n(200));if(o==null||o._reactInternals===void 0)throw Error(n(38));return fd(o,r,c,!1,h)},Rn.version="18.3.1-next-f1338f8080-20240426",Rn}var jy;function $C(){if(jy)return Uh.exports;jy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Uh.exports=GC(),Uh.exports}var Xy;function xC(){if(Xy)return gd;Xy=1;var e=$C();return gd.createRoot=e.createRoot,gd.hydrateRoot=e.hydrateRoot,gd}var WC=xC();const YC=$v(WC);class zC{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let i=this.length++;for(;i>0;){const s=i-1>>1,a=this.values[s];if(n>=a)break;this.ids[i]=this.ids[s],this.values[i]=a,i=s}this.ids[i]=t,this.values[i]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let l=(a<<1)+1;const d=l+1;let u=this.ids[l],f=this.values[l];const g=this.values[d];if(d<this.length&&g<f&&(l=d,u=this.ids[d],f=g),f>=i)break;this.ids[a]=u,this.values[a]=f,a=l}this.ids[a]=n,this.values[a]=i}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Vy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],$h=3;class ep{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[i,s]=new Uint8Array(t,n+0,2);if(i!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==$h)throw new Error(`Got v${a} data when expected v${$h}.`);const l=Vy[s&15];if(!l)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,n+2,1),[u]=new Uint32Array(t,n+4,1);return new ep(u,d,l,void 0,t,n)}constructor(t,n=16,i=Float64Array,s=ArrayBuffer,a,l=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=l;let d=t,u=d;this._levelBounds=[d*4];do d=Math.ceil(d/this.nodeSize),u+=d,this._levelBounds.push(u*4);while(d!==1);this.ArrayType=i,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const f=Vy.indexOf(this.ArrayType),g=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(f<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,l+8,u*4),this._indices=new this.IndexArrayType(this.data,l+8+g,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+g+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+g,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,($h<<4)+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new zC}add(t,n,i=t,s=n){const a=this._pos>>2,l=this._boxes;return this._indices[a]=a,l[this._pos++]=t,l[this._pos++]=n,l[this._pos++]=i,l[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),i>this.maxX&&(this.maxX=i),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,i=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let l=0,d=0;l<this.numItems;l++){const u=t[d++],f=t[d++],g=t[d++],m=t[d++],S=Math.floor(a*((u+g)/2-this.minX)/n),v=Math.floor(a*((f+m)/2-this.minY)/i);s[l]=XC(S,v)}Tg(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let l=0,d=0;l<this._levelBounds.length-1;l++){const u=this._levelBounds[l];for(;d<u;){const f=d;let g=t[d++],m=t[d++],S=t[d++],v=t[d++];for(let A=1;A<this.nodeSize&&d<u;A++)g=Math.min(g,t[d++]),m=Math.min(m,t[d++]),S=Math.max(S,t[d++]),v=Math.max(v,t[d++]);this._indices[this._pos>>2]=f,t[this._pos++]=g,t[this._pos++]=m,t[this._pos++]=S,t[this._pos++]=v}}}search(t,n,i,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const d=[],u=[];for(;l!==void 0;){const f=Math.min(l+this.nodeSize*4,qy(l,this._levelBounds));for(let g=l;g<f;g+=4){if(i<this._boxes[g]||s<this._boxes[g+1]||t>this._boxes[g+2]||n>this._boxes[g+3])continue;const m=this._indices[g>>2]|0;l>=this.numItems*4?d.push(m):(a===void 0||a(m))&&u.push(m)}l=d.pop()}return u}neighbors(t,n,i=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const d=this._queue,u=[],f=s*s;e:for(;l!==void 0;){const g=Math.min(l+this.nodeSize*4,qy(l,this._levelBounds));for(let m=l;m<g;m+=4){const S=this._indices[m>>2]|0,v=Ky(t,this._boxes[m],this._boxes[m+2]),A=Ky(n,this._boxes[m+1],this._boxes[m+3]),I=v*v+A*A;I>f||(l>=this.numItems*4?d.push(S<<1,I):(a===void 0||a(S))&&d.push((S<<1)+1,I))}for(;d.length&&d.peek()&1;)if(d.peekValue()>f||(u.push(d.pop()>>1),u.length===i))break e;l=d.length?d.pop()>>1:void 0}return d.clear(),u}}function Ky(e,t,n){return e<t?t-e:e<=n?0:e-n}function qy(e,t){let n=0,i=t.length-1;for(;n<i;){const s=n+i>>1;t[s]>e?i=s:n=s+1}return t[n]}function Tg(e,t,n,i,s,a){if(Math.floor(i/a)>=Math.floor(s/a))return;const l=e[i+s>>1];let d=i-1,u=s+1;for(;;){do d++;while(e[d]<l);do u--;while(e[u]>l);if(d>=u)break;jC(e,t,n,d,u)}Tg(e,t,n,i,u,a),Tg(e,t,n,u+1,s,a)}function jC(e,t,n,i,s){const a=e[i];e[i]=e[s],e[s]=a;const l=4*i,d=4*s,u=t[l],f=t[l+1],g=t[l+2],m=t[l+3];t[l]=t[d],t[l+1]=t[d+1],t[l+2]=t[d+2],t[l+3]=t[d+3],t[d]=u,t[d+1]=f,t[d+2]=g,t[d+3]=m;const S=n[i];n[i]=n[s],n[s]=S}function XC(e,t){let n=e^t,i=65535^n,s=65535^(e|t),a=e&(t^65535),l=n|i>>1,d=n>>1^n,u=s>>1^i&a>>1^s,f=n&s>>1^a>>1^a;n=l,i=d,s=u,a=f,l=n&n>>2^i&i>>2,d=n&i>>2^i&(n^i)>>2,u^=n&s>>2^i&a>>2,f^=i&s>>2^(n^i)&a>>2,n=l,i=d,s=u,a=f,l=n&n>>4^i&i>>4,d=n&i>>4^i&(n^i)>>4,u^=n&s>>4^i&a>>4,f^=i&s>>4^(n^i)&a>>4,n=l,i=d,s=u,a=f,u^=n&s>>8^i&a>>8,f^=i&s>>8^(n^i)&a>>8,n=u^u>>1,i=f^f>>1;let g=e^t,m=i|65535^(g|n);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|g)>>>0}function oi(e,t){return{x:e.x+t.x,y:e.y+t.y}}function VC(e,t){return{x:e.x-t.x,y:e.y-t.y}}function At(e,t){return{x:e.x*t,y:e.y*t}}function ea(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function ot(e){const t=ea(e);return t===0?{x:0,y:0}:At(e,1/t)}function tp(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function Kd(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,i)=>({x:n.x+i.x,y:n.y+i.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Xe(e,t,n,i){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>i/2&&(a=a-Math.sign(a)*i),{x:s,y:a}}function $e(e,t,n){const i=Xe(e,t,n.width,n.height);return ot(i)}function U(e,t,n,i){const s=Xe(e,t,n,i);return ea(s)}function Si(e,t,n,i){const s=Xe(e,t,n,i);return s.x*s.x+s.y*s.y}function xv(e,t){return e.x*t.x+e.y*t.y}function KC(e,t){const n=xv(e,t),i=ea(e),s=ea(t);if(i===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(i*s)));return Math.acos(a)}function Eg(e,t){const n=Math.cos(t),i=Math.sin(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function qC(e,t,n){const i=Math.max(0,Math.min(1,n)),s={r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16)},a={r:parseInt(t.substring(1,3),16),g:parseInt(t.substring(3,5),16),b:parseInt(t.substring(5,7),16)},l=Math.round(s.r+(a.r-s.r)*i),d=Math.round(s.g+(a.g-s.g)*i),u=Math.round(s.b+(a.b-s.b)*i),f=g=>("00"+g.toString(16)).slice(-2);return`#${f(l)}${f(d)}${f(u)}`}function ZC(e,t){return t.split(".").reduce((n,i)=>{if(n&&typeof n=="object"&&i in n)return n[i]},e)}function qi(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new ep(e.length),i=new Map,s=new Map;let a=0;const l=new Uint32Array(e.length);for(let u=0;u<e.length;u++){const f=e[u];f.width!==void 0&&f.height!==void 0?n.add(f.position.x,f.position.y,f.position.x+f.width,f.position.y+f.height):n.add(f.position.x,f.position.y,f.position.x,f.position.y)}return n.finish(),{all(){return e},byRect(u){const{width:f,height:g}=t,m=[];a++;const S=[];u.left<0?(S.push({left:u.left+f,right:f}),S.push({left:0,right:u.right})):u.right>f?(S.push({left:u.left,right:f}),S.push({left:0,right:u.right-f})):S.push({left:u.left,right:u.right});const v=[];u.top<0?(v.push({top:u.top+g,bottom:g}),v.push({top:0,bottom:u.bottom})):u.bottom>g?(v.push({top:u.top,bottom:g}),v.push({top:0,bottom:u.bottom-g})):v.push({top:u.top,bottom:u.bottom});for(let A=0;A<S.length;A++){const I=S[A];for(let T=0;T<v.length;T++){const P=v[T],R=n.search(I.left,P.top,I.right,P.bottom);for(let w=0;w<R.length;w++){const k=R[w];l[k]!==a&&(l[k]=a,m.push(e[k]))}}}return m},byRadius(u,f){const{width:g,height:m}=t,S=[];a++;const v=f*f,A=u.x-f,I=u.x+f,T=u.y-f,P=u.y+f,R=[];A<0?(R.push({left:A+g,right:g}),R.push({left:0,right:I})):I>g?(R.push({left:A,right:g}),R.push({left:0,right:I-g})):R.push({left:A,right:I});const w=[];T<0?(w.push({top:T+m,bottom:m}),w.push({top:0,bottom:P})):P>m?(w.push({top:T,bottom:m}),w.push({top:0,bottom:P-m})):w.push({top:T,bottom:P});for(let k=0;k<R.length;k++){const M=R[k];for(let D=0;D<w.length;D++){const N=w[D],b=n.search(M.left,N.top,M.right,N.bottom);for(let H=0;H<b.length;H++){const z=b[H];if(l[z]!==a){l[z]=a;const V=e[z];Si(u,V.position,g,m)<=v&&S.push(V)}}}}return S},byProperty(u,f){var g;if(!i.has(u)){const m=new Map;for(let S=0;S<e.length;S++){const v=e[S],A=v[u];m.has(A)||m.set(A,[]),m.get(A).push(v)}i.set(u,m)}return((g=i.get(u))==null?void 0:g.get(f))||[]},byPropertyPath(u,f){var g;if(!s.has(u)){const m=new Map;for(let S=0;S<e.length;S++){const v=e[S],A=ZC(v,u);m.has(A)||m.set(A,[]),m.get(A).push(v)}s.set(u,m)}return((g=s.get(u))==null?void 0:g.get(f))||[]},resetPropertyCache(){i.clear(),s.clear()},count(){return e.length}}}function mu(e){var m,S;const t=e.entities.entities,n=[],i=[],s=[],a=[],l=[],d=[],u=[];for(const v in t){const A=t[v];switch(A.type){case"human":n.push(A);break;case"berryBush":i.push(A);break;case"corpse":s.push(A);break;case"prey":a.push(A);break;case"predator":l.push(A);break;case"building":d.push(A);break;case"tree":u.push(A);break}}const f=e.mapDimensions;return{...e,search:{human:qi(n,f),berryBush:qi(i,f),corpse:qi(s,f),prey:qi(a,f),predator:qi(l,f),building:qi(d,f),tree:qi(u,f),tasks:((m=e.search)==null?void 0:m.tasks)??qi([],f)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((S=e.cache)==null?void 0:S.tribeCenters)??{}}}}function QC(e){const t=[];for(const n in e.tasks)t.push(e.tasks[n]);e.search.tasks=qi(t,e.mapDimensions)}const le={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire"},nr={[le.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[le.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[le.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[le.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}}},JC=.5,e_="#FFA500",t_="#FF4500",Zy=4,n_=10,np=60;function ip(e){return nr[e].dimensions}function i_(e){return nr[e].constructionTimeHours}function o_(e){return nr[e].destructionTimeHours}const Wv=5;function r_(){return nr[le.PlantingZone].dimensions}function Qy(e,t,n){const i=e.position.x+n.width/2,a=t.position.x-n.width/2-i,l=e.position.y-n.height/2,d=e.position.y+n.height/2,u=t.position.y-n.height/2,f=t.position.y+n.height/2,g=Math.min(d,f)-Math.max(l,u);return a>=-5&&a<=Wv&&g>n.height*.5}function Jy(e,t,n){const i=e.position.y+n.height/2,a=t.position.y-n.height/2-i,l=e.position.x-n.width/2,d=e.position.x+n.width/2,u=t.position.x-n.width/2,f=t.position.x+n.width/2,g=Math.min(d,f)-Math.max(l,u);return a>=-5&&a<=Wv&&g>n.width*.5}function s_(e){var l;const t={},n=r_(),i=e;if(!((l=i.search)!=null&&l.building))return t;const a=i.search.building.all().filter(d=>d.buildingType===le.PlantingZone&&d.isConstructed);for(const d of a)t[d.id]={top:!1,bottom:!1,left:!1,right:!1};for(let d=0;d<a.length;d++){const u=a[d];for(let f=d+1;f<a.length;f++){const g=a[f];u.ownerId===g.ownerId&&(Qy(u,g,n)&&(t[u.id].right=!0,t[g.id].left=!0),Qy(g,u,n)&&(t[g.id].right=!0,t[u.id].left=!0),Jy(u,g,n)&&(t[u.id].bottom=!0,t[g.id].top=!0),Jy(g,u,n)&&(t[g.id].bottom=!0,t[u.id].top=!0))}}return t}function Bl(e){e.plantingZoneConnections=s_(e)}var Dr=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(Dr||{});class a_{constructor(){Re(this,"worker",null);Re(this,"pendingRequests",new Map);Re(this,"requestQueue",[]);Re(this,"isProcessing",!1);Re(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case Dr.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case Dr.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case Dr.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,i)=>{if(!this.worker){i(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:i});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),i(s)}})}queueOperation(t){return new Promise((n,i)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){i(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),i=t,s={type:Dr.SAVE_REQUEST,id:n,gameState:i};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Dr.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Dr.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const op=new a_;async function rp(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,roleManagerOpen:e.roleManagerOpen,armyControlOpen:e.armyControlOpen,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks};await op.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function l_(){try{const e=await op.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=mu(t);return Bl(n),n}catch(e){return console.error("Failed to load game:",e),await Yv(),null}}async function Yv(){try{await op.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const zv=Be.createContext(void 0),c_=({initialAppState:e,children:t})=>{const[n,i]=Be.useState(e),[s,a]=Be.useState(void 0),[l,d]=Be.useState(null),[u,f]=Be.useState(!1);Be.useEffect(()=>{l_().then(A=>{A&&d(A),f(!0)})},[]);const g=(A,I)=>{i(A),A==="gameOver"&&I?a(I):A!=="gameOver"&&a(void 0)},m=()=>{i("intro"),a(void 0),v()},S=A=>{rp(A),d(A)},v=()=>{Yv(),d(null)};return Ue.jsx(zv.Provider,{value:{appState:n,setAppState:g,returnToIntro:m,gameOverDetails:s,contextReady:u,savedGameState:l,setSavedGameState:d,saveCurrentGame:S,clearCurrentSave:v},children:t})},Kr=()=>{const e=Be.useContext(zv);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var on=function(){return on=Object.assign||function(t){for(var n,i=1,s=arguments.length;i<s;i++){n=arguments[i];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},on.apply(this,arguments)};function Fl(e,t,n){if(n||arguments.length===2)for(var i=0,s=t.length,a;i<s;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return e.concat(a||Array.prototype.slice.call(t))}var dt="-ms-",_l="-moz-",Je="-webkit-",jv="comm",yu="rule",sp="decl",d_="@import",Xv="@keyframes",u_="@layer",Vv=Math.abs,ap=String.fromCharCode,Cg=Object.assign;function f_(e,t){return Lt(e,0)^45?(((t<<2^Lt(e,0))<<2^Lt(e,1))<<2^Lt(e,2))<<2^Lt(e,3):0}function Kv(e){return e.trim()}function Qi(e,t){return(e=t.exec(e))?e[0]:e}function We(e,t,n){return e.replace(t,n)}function Ud(e,t,n){return e.indexOf(t,n)}function Lt(e,t){return e.charCodeAt(t)|0}function ta(e,t,n){return e.slice(t,n)}function bi(e){return e.length}function qv(e){return e.length}function vl(e,t){return t.push(e),e}function h_(e,t){return e.map(t).join("")}function eS(e,t){return e.filter(function(n){return!Qi(n,t)})}var Su=1,na=1,Zv=0,ri=0,Pt=0,pa="";function vu(e,t,n,i,s,a,l,d){return{value:e,root:t,parent:n,type:i,props:s,children:a,line:Su,column:na,length:l,return:"",siblings:d}}function Ho(e,t){return Cg(vu("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Es(e){for(;e.root;)e=Ho(e.root,{children:[e]});vl(e,e.siblings)}function g_(){return Pt}function p_(){return Pt=ri>0?Lt(pa,--ri):0,na--,Pt===10&&(na=1,Su--),Pt}function yi(){return Pt=ri<Zv?Lt(pa,ri++):0,na++,Pt===10&&(na=1,Su++),Pt}function Br(){return Lt(pa,ri)}function Hd(){return ri}function Au(e,t){return ta(pa,e,t)}function _g(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function m_(e){return Su=na=1,Zv=bi(pa=e),ri=0,[]}function y_(e){return pa="",e}function xh(e){return Kv(Au(ri-1,wg(e===91?e+2:e===40?e+1:e)))}function S_(e){for(;(Pt=Br())&&Pt<33;)yi();return _g(e)>2||_g(Pt)>3?"":" "}function v_(e,t){for(;--t&&yi()&&!(Pt<48||Pt>102||Pt>57&&Pt<65||Pt>70&&Pt<97););return Au(e,Hd()+(t<6&&Br()==32&&yi()==32))}function wg(e){for(;yi();)switch(Pt){case e:return ri;case 34:case 39:e!==34&&e!==39&&wg(Pt);break;case 40:e===41&&wg(e);break;case 92:yi();break}return ri}function A_(e,t){for(;yi()&&e+Pt!==57;)if(e+Pt===84&&Br()===47)break;return"/*"+Au(t,ri-1)+"*"+ap(e===47?e:yi())}function I_(e){for(;!_g(Br());)yi();return Au(e,ri)}function T_(e){return y_(Gd("",null,null,null,[""],e=m_(e),0,[0],e))}function Gd(e,t,n,i,s,a,l,d,u){for(var f=0,g=0,m=l,S=0,v=0,A=0,I=1,T=1,P=1,R=0,w="",k=s,M=a,D=i,N=w;T;)switch(A=R,R=yi()){case 40:if(A!=108&&Lt(N,m-1)==58){Ud(N+=We(xh(R),"&","&\f"),"&\f",Vv(f?d[f-1]:0))!=-1&&(P=-1);break}case 34:case 39:case 91:N+=xh(R);break;case 9:case 10:case 13:case 32:N+=S_(A);break;case 92:N+=v_(Hd()-1,7);continue;case 47:switch(Br()){case 42:case 47:vl(E_(A_(yi(),Hd()),t,n,u),u);break;default:N+="/"}break;case 123*I:d[f++]=bi(N)*P;case 125*I:case 59:case 0:switch(R){case 0:case 125:T=0;case 59+g:P==-1&&(N=We(N,/\f/g,"")),v>0&&bi(N)-m&&vl(v>32?nS(N+";",i,n,m-1,u):nS(We(N," ","")+";",i,n,m-2,u),u);break;case 59:N+=";";default:if(vl(D=tS(N,t,n,f,g,s,d,w,k=[],M=[],m,a),a),R===123)if(g===0)Gd(N,t,D,D,k,a,m,d,M);else switch(S===99&&Lt(N,3)===110?100:S){case 100:case 108:case 109:case 115:Gd(e,D,D,i&&vl(tS(e,D,D,0,0,s,d,w,s,k=[],m,M),M),s,M,m,d,i?k:M);break;default:Gd(N,D,D,D,[""],M,0,d,M)}}f=g=v=0,I=P=1,w=N="",m=l;break;case 58:m=1+bi(N),v=A;default:if(I<1){if(R==123)--I;else if(R==125&&I++==0&&p_()==125)continue}switch(N+=ap(R),R*I){case 38:P=g>0?1:(N+="\f",-1);break;case 44:d[f++]=(bi(N)-1)*P,P=1;break;case 64:Br()===45&&(N+=xh(yi())),S=Br(),g=m=bi(w=N+=I_(Hd())),R++;break;case 45:A===45&&bi(N)==2&&(I=0)}}return a}function tS(e,t,n,i,s,a,l,d,u,f,g,m){for(var S=s-1,v=s===0?a:[""],A=qv(v),I=0,T=0,P=0;I<i;++I)for(var R=0,w=ta(e,S+1,S=Vv(T=l[I])),k=e;R<A;++R)(k=Kv(T>0?v[R]+" "+w:We(w,/&\f/g,v[R])))&&(u[P++]=k);return vu(e,t,n,s===0?yu:d,u,f,g,m)}function E_(e,t,n,i){return vu(e,t,n,jv,ap(g_()),ta(e,2,-2),0,i)}function nS(e,t,n,i,s){return vu(e,t,n,sp,ta(e,0,i),ta(e,i+1,-1),i,s)}function Qv(e,t,n){switch(f_(e,t)){case 5103:return Je+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Je+e+e;case 4789:return _l+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Je+e+_l+e+dt+e+e;case 5936:switch(Lt(e,t+11)){case 114:return Je+e+dt+We(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Je+e+dt+We(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Je+e+dt+We(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Je+e+dt+e+e;case 6165:return Je+e+dt+"flex-"+e+e;case 5187:return Je+e+We(e,/(\w+).+(:[^]+)/,Je+"box-$1$2"+dt+"flex-$1$2")+e;case 5443:return Je+e+dt+"flex-item-"+We(e,/flex-|-self/g,"")+(Qi(e,/flex-|baseline/)?"":dt+"grid-row-"+We(e,/flex-|-self/g,""))+e;case 4675:return Je+e+dt+"flex-line-pack"+We(e,/align-content|flex-|-self/g,"")+e;case 5548:return Je+e+dt+We(e,"shrink","negative")+e;case 5292:return Je+e+dt+We(e,"basis","preferred-size")+e;case 6060:return Je+"box-"+We(e,"-grow","")+Je+e+dt+We(e,"grow","positive")+e;case 4554:return Je+We(e,/([^-])(transform)/g,"$1"+Je+"$2")+e;case 6187:return We(We(We(e,/(zoom-|grab)/,Je+"$1"),/(image-set)/,Je+"$1"),e,"")+e;case 5495:case 3959:return We(e,/(image-set\([^]*)/,Je+"$1$`$1");case 4968:return We(We(e,/(.+:)(flex-)?(.*)/,Je+"box-pack:$3"+dt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Je+e+e;case 4200:if(!Qi(e,/flex-|baseline/))return dt+"grid-column-align"+ta(e,t)+e;break;case 2592:case 3360:return dt+We(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(i,s){return t=s,Qi(i.props,/grid-\w+-end/)})?~Ud(e+(n=n[t].value),"span",0)?e:dt+We(e,"-start","")+e+dt+"grid-row-span:"+(~Ud(n,"span",0)?Qi(n,/\d+/):+Qi(n,/\d+/)-+Qi(e,/\d+/))+";":dt+We(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(i){return Qi(i.props,/grid-\w+-start/)})?e:dt+We(We(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return We(e,/(.+)-inline(.+)/,Je+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(bi(e)-1-t>6)switch(Lt(e,t+1)){case 109:if(Lt(e,t+4)!==45)break;case 102:return We(e,/(.+:)(.+)-([^]+)/,"$1"+Je+"$2-$3$1"+_l+(Lt(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Ud(e,"stretch",0)?Qv(We(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return We(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,s,a,l,d,u,f){return dt+s+":"+a+f+(l?dt+s+"-span:"+(d?u:+u-+a)+f:"")+e});case 4949:if(Lt(e,t+6)===121)return We(e,":",":"+Je)+e;break;case 6444:switch(Lt(e,Lt(e,14)===45?18:11)){case 120:return We(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Je+(Lt(e,14)===45?"inline-":"")+"box$3$1"+Je+"$2$3$1"+dt+"$2box$3")+e;case 100:return We(e,":",":"+dt)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return We(e,"scroll-","scroll-snap-")+e}return e}function qd(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function C_(e,t,n,i){switch(e.type){case u_:if(e.children.length)break;case d_:case sp:return e.return=e.return||e.value;case jv:return"";case Xv:return e.return=e.value+"{"+qd(e.children,i)+"}";case yu:if(!bi(e.value=e.props.join(",")))return""}return bi(n=qd(e.children,i))?e.return=e.value+"{"+n+"}":""}function __(e){var t=qv(e);return function(n,i,s,a){for(var l="",d=0;d<t;d++)l+=e[d](n,i,s,a)||"";return l}}function w_(e){return function(t){t.root||(t=t.return)&&e(t)}}function R_(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case sp:e.return=Qv(e.value,e.length,n);return;case Xv:return qd([Ho(e,{value:We(e.value,"@","@"+Je)})],i);case yu:if(e.length)return h_(n=e.props,function(s){switch(Qi(s,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Es(Ho(e,{props:[We(s,/:(read-\w+)/,":"+_l+"$1")]})),Es(Ho(e,{props:[s]})),Cg(e,{props:eS(n,i)});break;case"::placeholder":Es(Ho(e,{props:[We(s,/:(plac\w+)/,":"+Je+"input-$1")]})),Es(Ho(e,{props:[We(s,/:(plac\w+)/,":"+_l+"$1")]})),Es(Ho(e,{props:[We(s,/:(plac\w+)/,dt+"input-$1")]})),Es(Ho(e,{props:[s]})),Cg(e,{props:eS(n,i)});break}return""})}}var P_={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Un={},ia=typeof process<"u"&&Un!==void 0&&(Un.REACT_APP_SC_ATTR||Un.SC_ATTR)||"data-styled",Jv="active",eA="data-styled-version",Iu="6.1.13",lp=`/*!sc*/
`,Zd=typeof window<"u"&&"HTMLElement"in window,D_=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Un!==void 0&&Un.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Un.REACT_APP_SC_DISABLE_SPEEDY!==""?Un.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Un.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Un!==void 0&&Un.SC_DISABLE_SPEEDY!==void 0&&Un.SC_DISABLE_SPEEDY!==""&&Un.SC_DISABLE_SPEEDY!=="false"&&Un.SC_DISABLE_SPEEDY),N_={},Tu=Object.freeze([]),oa=Object.freeze({});function tA(e,t,n){return n===void 0&&(n=oa),e.theme!==n.theme&&e.theme||t||n.theme}var nA=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),M_=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,O_=/(^-|-$)/g;function iS(e){return e.replace(M_,"-").replace(O_,"")}var k_=/(a)(d)/gi,pd=52,oS=function(e){return String.fromCharCode(e+(e>25?39:97))};function Rg(e){var t,n="";for(t=Math.abs(e);t>pd;t=t/pd|0)n=oS(t%pd)+n;return(oS(t%pd)+n).replace(k_,"$1-$2")}var Wh,iA=5381,Ls=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},oA=function(e){return Ls(iA,e)};function rA(e){return Rg(oA(e)>>>0)}function b_(e){return e.displayName||e.name||"Component"}function Yh(e){return typeof e=="string"&&!0}var sA=typeof Symbol=="function"&&Symbol.for,aA=sA?Symbol.for("react.memo"):60115,B_=sA?Symbol.for("react.forward_ref"):60112,F_={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},L_={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},lA={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},U_=((Wh={})[B_]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Wh[aA]=lA,Wh);function rS(e){return("type"in(t=e)&&t.type.$$typeof)===aA?lA:"$$typeof"in e?U_[e.$$typeof]:F_;var t}var H_=Object.defineProperty,G_=Object.getOwnPropertyNames,sS=Object.getOwnPropertySymbols,$_=Object.getOwnPropertyDescriptor,x_=Object.getPrototypeOf,aS=Object.prototype;function cA(e,t,n){if(typeof t!="string"){if(aS){var i=x_(t);i&&i!==aS&&cA(e,i,n)}var s=G_(t);sS&&(s=s.concat(sS(t)));for(var a=rS(e),l=rS(t),d=0;d<s.length;++d){var u=s[d];if(!(u in L_||n&&n[u]||l&&u in l||a&&u in a)){var f=$_(t,u);try{H_(e,u,f)}catch{}}}}return e}function ra(e){return typeof e=="function"}function cp(e){return typeof e=="object"&&"styledComponentId"in e}function kr(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function Pg(e,t){if(e.length===0)return"";for(var n=e[0],i=1;i<e.length;i++)n+=e[i];return n}function Ll(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function Dg(e,t,n){if(n===void 0&&(n=!1),!n&&!Ll(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)e[i]=Dg(e[i],t[i]);else if(Ll(t))for(var i in t)e[i]=Dg(e[i],t[i]);return e}function dp(e,t){Object.defineProperty(e,"toString",{value:t})}function ql(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var W_=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,i=0;i<t;i++)n+=this.groupSizes[i];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var i=this.groupSizes,s=i.length,a=s;t>=a;)if((a<<=1)<0)throw ql(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(i),this.length=a;for(var l=s;l<a;l++)this.groupSizes[l]=0}for(var d=this.indexOfGroup(t+1),u=(l=0,n.length);l<u;l++)this.tag.insertRule(d,n[l])&&(this.groupSizes[t]++,d++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],i=this.indexOfGroup(t),s=i+n;this.groupSizes[t]=0;for(var a=i;a<s;a++)this.tag.deleteRule(i)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var i=this.groupSizes[t],s=this.indexOfGroup(t),a=s+i,l=s;l<a;l++)n+="".concat(this.tag.getRule(l)).concat(lp);return n},e}(),$d=new Map,Qd=new Map,xd=1,md=function(e){if($d.has(e))return $d.get(e);for(;Qd.has(xd);)xd++;var t=xd++;return $d.set(e,t),Qd.set(t,e),t},Y_=function(e,t){xd=t+1,$d.set(e,t),Qd.set(t,e)},z_="style[".concat(ia,"][").concat(eA,'="').concat(Iu,'"]'),j_=new RegExp("^".concat(ia,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),X_=function(e,t,n){for(var i,s=n.split(","),a=0,l=s.length;a<l;a++)(i=s[a])&&e.registerName(t,i)},V_=function(e,t){for(var n,i=((n=t.textContent)!==null&&n!==void 0?n:"").split(lp),s=[],a=0,l=i.length;a<l;a++){var d=i[a].trim();if(d){var u=d.match(j_);if(u){var f=0|parseInt(u[1],10),g=u[2];f!==0&&(Y_(g,f),X_(e,g,u[3]),e.getTag().insertRules(f,s)),s.length=0}else s.push(d)}}},lS=function(e){for(var t=document.querySelectorAll(z_),n=0,i=t.length;n<i;n++){var s=t[n];s&&s.getAttribute(ia)!==Jv&&(V_(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function K_(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var dA=function(e){var t=document.head,n=e||t,i=document.createElement("style"),s=function(d){var u=Array.from(d.querySelectorAll("style[".concat(ia,"]")));return u[u.length-1]}(n),a=s!==void 0?s.nextSibling:null;i.setAttribute(ia,Jv),i.setAttribute(eA,Iu);var l=K_();return l&&i.setAttribute("nonce",l),n.insertBefore(i,a),i},q_=function(){function e(t){this.element=dA(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,s=0,a=i.length;s<a;s++){var l=i[s];if(l.ownerNode===n)return l}throw ql(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),Z_=function(){function e(t){this.element=dA(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),Q_=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),cS=Zd,J_={isServer:!Zd,useCSSOMInjection:!D_},Jd=function(){function e(t,n,i){t===void 0&&(t=oa),n===void 0&&(n={});var s=this;this.options=on(on({},J_),t),this.gs=n,this.names=new Map(i),this.server=!!t.isServer,!this.server&&Zd&&cS&&(cS=!1,lS(this)),dp(this,function(){return function(a){for(var l=a.getTag(),d=l.length,u="",f=function(m){var S=function(P){return Qd.get(P)}(m);if(S===void 0)return"continue";var v=a.names.get(S),A=l.getGroup(m);if(v===void 0||!v.size||A.length===0)return"continue";var I="".concat(ia,".g").concat(m,'[id="').concat(S,'"]'),T="";v!==void 0&&v.forEach(function(P){P.length>0&&(T+="".concat(P,","))}),u+="".concat(A).concat(I,'{content:"').concat(T,'"}').concat(lp)},g=0;g<d;g++)f(g);return u}(s)})}return e.registerId=function(t){return md(t)},e.prototype.rehydrate=function(){!this.server&&Zd&&lS(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(on(on({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var i=n.useCSSOMInjection,s=n.target;return n.isServer?new Q_(s):i?new q_(s):new Z_(s)}(this.options),new W_(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(md(t),this.names.has(t))this.names.get(t).add(n);else{var i=new Set;i.add(n),this.names.set(t,i)}},e.prototype.insertRules=function(t,n,i){this.registerName(t,n),this.getTag().insertRules(md(t),i)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(md(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),ew=/&/g,tw=/^\s*\/\/.*$/gm;function uA(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(i){return"".concat(t," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=uA(n.children,t)),n})}function nw(e){var t,n,i,s=oa,a=s.options,l=a===void 0?oa:a,d=s.plugins,u=d===void 0?Tu:d,f=function(S,v,A){return A.startsWith(n)&&A.endsWith(n)&&A.replaceAll(n,"").length>0?".".concat(t):S},g=u.slice();g.push(function(S){S.type===yu&&S.value.includes("&")&&(S.props[0]=S.props[0].replace(ew,n).replace(i,f))}),l.prefix&&g.push(R_),g.push(C_);var m=function(S,v,A,I){v===void 0&&(v=""),A===void 0&&(A=""),I===void 0&&(I="&"),t=I,n=v,i=new RegExp("\\".concat(n,"\\b"),"g");var T=S.replace(tw,""),P=T_(A||v?"".concat(A," ").concat(v," { ").concat(T," }"):T);l.namespace&&(P=uA(P,l.namespace));var R=[];return qd(P,__(g.concat(w_(function(w){return R.push(w)})))),R};return m.hash=u.length?u.reduce(function(S,v){return v.name||ql(15),Ls(S,v.name)},iA).toString():"",m}var iw=new Jd,Ng=nw(),fA=Bi.createContext({shouldForwardProp:void 0,styleSheet:iw,stylis:Ng});fA.Consumer;Bi.createContext(void 0);function Mg(){return Be.useContext(fA)}var ow=function(){function e(t,n){var i=this;this.inject=function(s,a){a===void 0&&(a=Ng);var l=i.name+a.hash;s.hasNameForId(i.id,l)||s.insertRules(i.id,l,a(i.rules,l,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,dp(this,function(){throw ql(12,String(i.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Ng),this.name+t.hash},e}(),rw=function(e){return e>="A"&&e<="Z"};function dS(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(n===1&&i==="-"&&e[0]==="-")return e;rw(i)?t+="-"+i.toLowerCase():t+=i}return t.startsWith("ms-")?"-"+t:t}var hA=function(e){return e==null||e===!1||e===""},gA=function(e){var t,n,i=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!hA(a)&&(Array.isArray(a)&&a.isCss||ra(a)?i.push("".concat(dS(s),":"),a,";"):Ll(a)?i.push.apply(i,Fl(Fl(["".concat(s," {")],gA(a),!1),["}"],!1)):i.push("".concat(dS(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in P_||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function Vo(e,t,n,i){if(hA(e))return[];if(cp(e))return[".".concat(e.styledComponentId)];if(ra(e)){if(!ra(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return Vo(s,t,n,i)}var a;return e instanceof ow?n?(e.inject(n,i),[e.getName(i)]):[e]:Ll(e)?gA(e):Array.isArray(e)?Array.prototype.concat.apply(Tu,e.map(function(l){return Vo(l,t,n,i)})):[e.toString()]}function pA(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(ra(n)&&!cp(n))return!1}return!0}var sw=oA(Iu),aw=function(){function e(t,n,i){this.rules=t,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&pA(t),this.componentId=n,this.baseHash=Ls(sw,n),this.baseStyle=i,Jd.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,i){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=kr(s,this.staticRulesId);else{var a=Pg(Vo(this.rules,t,n,i)),l=Rg(Ls(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,l)){var d=i(a,".".concat(l),void 0,this.componentId);n.insertRules(this.componentId,l,d)}s=kr(s,l),this.staticRulesId=l}else{for(var u=Ls(this.baseHash,i.hash),f="",g=0;g<this.rules.length;g++){var m=this.rules[g];if(typeof m=="string")f+=m;else if(m){var S=Pg(Vo(m,t,n,i));u=Ls(u,S+g),f+=S}}if(f){var v=Rg(u>>>0);n.hasNameForId(this.componentId,v)||n.insertRules(this.componentId,v,i(f,".".concat(v),void 0,this.componentId)),s=kr(s,v)}}return s},e}(),up=Bi.createContext(void 0);up.Consumer;var zh={};function lw(e,t,n){var i=cp(e),s=e,a=!Yh(e),l=t.attrs,d=l===void 0?Tu:l,u=t.componentId,f=u===void 0?function(k,M){var D=typeof k!="string"?"sc":iS(k);zh[D]=(zh[D]||0)+1;var N="".concat(D,"-").concat(rA(Iu+D+zh[D]));return M?"".concat(M,"-").concat(N):N}(t.displayName,t.parentComponentId):u,g=t.displayName,m=g===void 0?function(k){return Yh(k)?"styled.".concat(k):"Styled(".concat(b_(k),")")}(e):g,S=t.displayName&&t.componentId?"".concat(iS(t.displayName),"-").concat(t.componentId):t.componentId||f,v=i&&s.attrs?s.attrs.concat(d).filter(Boolean):d,A=t.shouldForwardProp;if(i&&s.shouldForwardProp){var I=s.shouldForwardProp;if(t.shouldForwardProp){var T=t.shouldForwardProp;A=function(k,M){return I(k,M)&&T(k,M)}}else A=I}var P=new aw(n,S,i?s.componentStyle:void 0);function R(k,M){return function(D,N,b){var H=D.attrs,z=D.componentStyle,V=D.defaultProps,j=D.foldedComponentIds,ee=D.styledComponentId,ne=D.target,Se=Bi.useContext(up),ce=Mg(),oe=D.shouldForwardProp||ce.shouldForwardProp,X=tA(N,Se,V)||oa,q=function(Pe,me,Me){for(var De,fe=on(on({},me),{className:void 0,theme:Me}),ve=0;ve<Pe.length;ve+=1){var xe=ra(De=Pe[ve])?De(fe):De;for(var Te in xe)fe[Te]=Te==="className"?kr(fe[Te],xe[Te]):Te==="style"?on(on({},fe[Te]),xe[Te]):xe[Te]}return me.className&&(fe.className=kr(fe.className,me.className)),fe}(H,N,X),Z=q.as||ne,F={};for(var Y in q)q[Y]===void 0||Y[0]==="$"||Y==="as"||Y==="theme"&&q.theme===X||(Y==="forwardedAs"?F.as=q.forwardedAs:oe&&!oe(Y,Z)||(F[Y]=q[Y]));var ue=function(Pe,me){var Me=Mg(),De=Pe.generateAndInjectStyles(me,Me.styleSheet,Me.stylis);return De}(z,q),pe=kr(j,ee);return ue&&(pe+=" "+ue),q.className&&(pe+=" "+q.className),F[Yh(Z)&&!nA.has(Z)?"class":"className"]=pe,F.ref=b,Be.createElement(Z,F)}(w,k,M)}R.displayName=m;var w=Bi.forwardRef(R);return w.attrs=v,w.componentStyle=P,w.displayName=m,w.shouldForwardProp=A,w.foldedComponentIds=i?kr(s.foldedComponentIds,s.styledComponentId):"",w.styledComponentId=S,w.target=i?s.target:e,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(k){this._foldedDefaultProps=i?function(M){for(var D=[],N=1;N<arguments.length;N++)D[N-1]=arguments[N];for(var b=0,H=D;b<H.length;b++)Dg(M,H[b],!0);return M}({},s.defaultProps,k):k}}),dp(w,function(){return".".concat(w.styledComponentId)}),a&&cA(w,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function uS(e,t){for(var n=[e[0]],i=0,s=t.length;i<s;i+=1)n.push(t[i],e[i+1]);return n}var fS=function(e){return Object.assign(e,{isCss:!0})};function mA(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(ra(e)||Ll(e))return fS(Vo(uS(Tu,Fl([e],t,!0))));var i=e;return t.length===0&&i.length===1&&typeof i[0]=="string"?Vo(i):fS(Vo(uS(i,t)))}function Og(e,t,n){if(n===void 0&&(n=oa),!t)throw ql(1,t);var i=function(s){for(var a=[],l=1;l<arguments.length;l++)a[l-1]=arguments[l];return e(t,n,mA.apply(void 0,Fl([s],a,!1)))};return i.attrs=function(s){return Og(e,t,on(on({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},i.withConfig=function(s){return Og(e,t,on(on({},n),s))},i}var yA=function(e){return Og(lw,e)},Ot=yA;nA.forEach(function(e){Ot[e]=yA(e)});var cw=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=pA(t),Jd.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,i,s){var a=s(Pg(Vo(this.rules,n,i,s)),""),l=this.componentId+t;i.insertRules(l,l,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,i,s){t>2&&Jd.registerId(this.componentId+t),this.removeStyles(t,i),this.createStyles(t,n,i,s)},e}();function dw(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=mA.apply(void 0,Fl([e],t,!1)),s="sc-global-".concat(rA(JSON.stringify(i))),a=new cw(i,s),l=function(u){var f=Mg(),g=Bi.useContext(up),m=Bi.useRef(f.styleSheet.allocateGSInstance(s)).current;return f.styleSheet.server&&d(m,u,f.styleSheet,g,f.stylis),Bi.useLayoutEffect(function(){if(!f.styleSheet.server)return d(m,u,f.styleSheet,g,f.stylis),function(){return a.removeStyles(m,f.styleSheet)}},[m,u,f.styleSheet,g,f.stylis]),null};function d(u,f,g,m,S){if(a.isStatic)a.renderStyles(u,N_,g,S);else{var v=on(on({},f),{theme:tA(f,m,l.defaultProps)});a.renderStyles(u,v,g,S)}}return Bi.memo(l)}function SA(e,t){var n=Be.useRef(null),i=Be.useRef(!1),s=Be.useRef(e);s.current=e;var a=Be.useCallback(function(d){i.current&&(s.current(d),n.current=requestAnimationFrame(a))},[]),l=Be.useMemo(function(){return[function(){i.current&&(i.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){i.current||(i.current=!0,n.current=requestAnimationFrame(a))},function(){return i.current}]},[]);return Be.useEffect(function(){return l[0]},[]),l}function uw(e,t,n,i,s){var l;(l=e.onExit)==null||l.call(e,i,t);const a=s.find(({id:d})=>d===t);return a!=null&&a.onEnter?a.onEnter(i,n):{...n,enteredAt:i.updateContext.gameState.time}}function fw(e,t){return t.find(({id:n})=>n===e)}function hw(e,t){return e!==t}function gw(e){e&&console.warn(`No handler found for state: ${e}`)}const wl="bushGrowing",Mr="bushFull",Wd="bushSpreading",Ul="bushDying",Ct=24,Dt=10,Ze=4e3,Qe=4e3,fp=2,pw=15,mw=5e3,oo=100,ro=20,so=60,vA=200,yw=1e3,Sw=5,vw=3,Aw=12,Iw=940,kg=20,hS=90,AA=100,uo=5,Tw=.5,Zo=30,ao=.1,Al=.9,Ew=2,Cw=2;var An=(e=>(e.Berry="berry",e.Meat="meat",e))(An||{});const hp={berry:"",meat:""};function IA(e,t){return`${e},${t}`}function TA(e){const[t,n]=e.split(",").map(Number);return{gridX:t,gridY:n}}function _w(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function EA(){return{lastUpdateTime:0,sectors:{}}}const Xt=20,eu=100,CA=20,_A=0,ww=20,Rw=1,wA=.15,Pw=.5,Dw=.01,Nw=24,Mw="#6B5344",Ow="#4A3728",gS=.85,RA=35,kw=30,pS=1.25,mS=40,jh=Math.PI/6,PA=.5,bw=1,Eu=10,Hl=80,DA=3,sl=5,rn=150,gp=rn*.8,Bw=rn*.2,sn=rn*.8,Qo=30,NA=10,Fw=10,Lw=.5,ze=30,Yr=ze*.75,Cu=30,Zl=Cu*.75,MA=50,Uw=20,Hw=Hl*.8,Gw=.7,Gl=16,_u=40,$w=24,pp=16,xw=72/3,yS=24,Ww=1.25,Yw=1.5,sa=rn*.6,wu=50,zw=1,jw=350,mp=Hl*.65,Xw=80,Vw=50,Kw=1,qw=128,OA=10,SS=100,yp=35,fo=30,Ru=.5,Pu=2.5,Sp=20,Sn=250,vp=.4,Ap=150,Ip=6,Zw=5,Tp=2,Du=.5,Nu=1.5,Qw=1,Jw=.5,eR=.5,tR=1.5,nR=.25,iR=2.5,oR=45,rR=.05,sR=200;var Ut=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(Ut||{}),je=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e[e.SupplyChain=5]="SupplyChain",e))(je||{}),zr=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(zr||{});const tu=24,aR=24;let lR=0;function cR(){return`notification-${Date.now()}-${lR++}`}function $l(e,t){if(t.identifier){const i=e.notifications.find(s=>s.identifier===t.identifier);if(i){if(i.dismissedUntil&&e.time<i.dismissedUntil)return;i.message=t.message,i.timestamp=e.time,i.creationTime=Date.now(),i.duration=t.duration,i.targetEntityIds=t.targetEntityIds,i.highlightedEntityIds=t.highlightedEntityIds,i.targetPosition=t.targetPosition,i.targetArea=t.targetArea,i.targetRadius=t.targetRadius,i.isDismissed=!1,i.dismissedUntil=void 0;return}}const n={...t,id:cR(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function dR(e,t){const n=e.notifications.find(i=>i.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+aR))}function uR(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function fR(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const i of n.highlightedEntityIds){const s=e.entities.entities[i];s&&(s.isHighlighted=!0)}}function Ep(e,t,n,i){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,l={x:Math.cos(s)*a,y:Math.sin(s)*a},d=oi(e,l);return{x:(d.x%n+n)%n,y:(d.y%i+i)%i}}function zn(e,t,n,i){const s=t,{width:a,height:l}=t.mapDimensions,d={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},u=f=>{for(let g=0;g<f.length;g++){const m=f[g];if(i!==void 0&&m.id===i)continue;const S=Si(e,m.position,a,l),v=n+m.radius;if(S<v*v)return!0}return!1};return u(s.search.human.byRect(d))||u(s.search.berryBush.byRect(d))||u(s.search.corpse.byRect(d))}function hR(e,t,n,i,s){const a=t.mapDimensions.width,l=t.mapDimensions.height;if(!zn(e,t,i,s)&&!Ui(t.soilDepletion,e,a,l))return e;const d=i;for(let u=d;u<=n;u+=d){const f=Math.ceil(2*Math.PI*u/d);for(let g=0;g<f;g++){const m=g/f*2*Math.PI,S={x:Math.cos(m)*u,y:Math.sin(m)*u},v=oi(e,S),A={x:(v.x%a+a)%a,y:(v.y%l+l)%l};if(!zn(A,t,i,s)&&!Ui(t.soilDepletion,A,a,l))return A}}return null}function $n(e,t){var l,d;const n=t;if((d=(l=n.cache)==null?void 0:l.tribeCenters)!=null&&d[e])return n.cache.tribeCenters[e];const i=t.search.building.byProperty("ownerId",e);if(i.length>0){const u=i.map(f=>f.position);return n.cache.tribeCenters[e]=Kd(u)}const s=Li(e,t);if(s.length===0){const u=t.entities.entities[e];return n.cache.tribeCenters[e]=u?u.position:{x:0,y:0}}const a=s.map(u=>u.position);return n.cache.tribeCenters[e]=Kd(a)}function vS(e,t){const i=[...Wl(e,t),e].map(s=>s.position);return Kd(i)}function bg(e,t,n){const i=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,l=e.y-t.position.y;return Math.abs(a)>i/2&&(a-=Math.sign(a)*i),Math.abs(l)>s/2&&(l-=Math.sign(l)*s),Math.abs(a)<=t.width/2&&Math.abs(l)<=t.height/2}const aa=80,Gn=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],Le=20,ir=(e,t,n)=>{var d,u,f,g;if(!e||!t||e===t)return!1;const i=n.entities.entities[e],s=n.entities.entities[t],a=(u=(d=i==null?void 0:i.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[t],l=(g=(f=s==null?void 0:s.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[e];return a===Ut.Hostile||l===Ut.Hostile},qr=(e,t,n)=>e.id===t.id?!1:ir(e.leaderId,t.leaderId,n),Vt=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:ir(e.leaderId,t.ownerId,n),or=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=sn||t.hunger>=sn||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||qr(e,t,n))return!1;const i=e.gender==="female"?e:t;return!(i.isPregnant||i.age>_u)},la=1,ca=150*.6,AS=150*.25,gR=150*.7,pR=150*.8,mR=400,kA=800,yR=150,SR=300,vR=2,IS=800,AR=500,IR=150*.85,TR=150,bA=3,ER=24,BA=600,CR=1,_R=1,wR=.5,RR=1,PR=.5,DR=2,Os=24,Us=12,NR=24,MR=1.5,OR=150,kR=200,bR=100,BR=.7,FR=300,LR=400,Xh=600,UR=600,nu=.15,Bg=200,Ks=30*.75*1.2,FA=20,LA=.3,UA=.6,HA=.8,HR=1,GR=3,$R=5,xR=6,TS=.5,WR=.4,YR=.6,zR=.8,jR=2,Ji=800,ES=2,Fg=.7,Lg=.5,Hs=10,XR=.5,qs=400,GA=800,VR=8,CS=5,KR=16,$A=5,xA=600,eo=100,qR=100,WA=150,_S=600,wS=250,ZR=.5,QR=.7,JR=300,e1=150;function t1(e){const t=Math.floor(e.x/Le),n=Math.floor(e.y/Le);return{x:t,y:n}}function n1(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(i/Le),l=Math.floor(s/Le),d=Math.ceil(t/Le);return l*d+a}function xn(e,t,n){const i=n1({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[i]||null}function iu(e,t){return t.terrainOwnership.includes(e)}function YA(e,t,n,i){var l;const s=n;return(l=s.search)!=null&&l.human?s.search.human.byRadius(e,i).some(d=>ir(t,d.leaderId,n)):!1}function i1(e,t,n,i,s=!1,a){if(s&&a&&YA(e,a,i,WA))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:l,height:d}=i.mapDimensions,u=Math.ceil(l/Le),f=Math.ceil(d/Le),g=Math.ceil(t/Le),m=t*t,S=Math.floor(e.x/Le),v=Math.floor(e.y/Le);let A=!1,I=!1;for(let T=-g;T<=g;T++)for(let P=-g;P<=g;P++){const R=((S+P)%u+u)%u,w=((v+T)%f+f)%f,k=R*Le+Le/2,M=w*Le+Le/2;if(Si(e,{x:k,y:M},l,d)<=m){const N=w*u+R,b=i.terrainOwnership[N];if(b===n)A=!0;else if(b!==null){if(s&&a&&ir(a,b,i))continue;I=!0}}}return I?{valid:!1,reason:"Position overlaps with another tribe's territory"}:A?{valid:!0}:iu(n,i)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function zA(e,t,n,i){if(!iu(n,i))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(YA(e,n,i,WA))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=i.mapDimensions,l=Math.ceil(s/Le),d=Math.ceil(a/Le),u=Math.ceil(t/Le),f=t*t,g=Math.floor(e.x/Le),m=Math.floor(e.y/Le);let S=!1;for(let v=-u;v<=u;v++){for(let A=-u;A<=u;A++){const I=((g+A)%l+l)%l,T=((m+v)%d+d)%d,P=I*Le+Le/2,R=T*Le+Le/2;if(Si(e,{x:P,y:R},s,a)<=f){const k=T*l+I;if(i.terrainOwnership[k]===n){S=!0;break}}}if(S)break}return S?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function jA(e,t,n,i=0,s=!1,a){if(i>0){const d=i1(e,i,t,n,s,a);return d.valid?{canPlace:!0}:{canPlace:!1,reason:d.reason}}const l=xn(e.x,e.y,n);return l===null||l===t?{canPlace:!0}:s&&a&&ir(a,l,n)?{canPlace:!0}:l!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function Ug(e,t,n){const i=xn(e.x,e.y,n);return i===null||i===t}function Wn(e,t,n){const i=xn(e.x,e.y,n);return i===null||i===t||!ir(t,i,n)}function o1(e,t,n,i){if(Ug(t,n,i))return t;const{width:s,height:a}=i.mapDimensions,l=Xe(e,t,s,a),d=Math.sqrt(l.x**2+l.y**2);if(d===0)return e;let u=e;const f=U(e,t,s,a),g=f/10;for(let m=g;m<=f;m+=g){const S={x:((e.x+l.x*m/d)%s+s)%s,y:((e.y+l.y*m/d)%a+a)%a};if(Ug(S,n,i))u=S;else break}return u}function XA(e,t,n,i,{allowOverwrite:s}){const{width:a,height:l}=i.mapDimensions,d=Math.ceil(a/Le),u=Math.ceil(l/Le),f=Math.ceil(t/Le),g=Math.floor(e.x/Le),m=Math.floor(e.y/Le);for(let R=-f;R<=f;R++)for(let w=-f;w<=f;w++){const k=((g+w)%d+d)%d,M=((m+R)%u+u)%u,D=k*Le+Le/2,N=M*Le+Le/2;if(U(e,{x:D,y:N},a,l)<=t){const H=M*d+k,z=i.terrainOwnership[H];(s||z===null||z===n)&&(i.terrainOwnership[H]=n)}}const S=3,v=f+S+2,A=[];for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const k=((g+w)%d+d)%d,M=((m+R)%u+u)%u,D=M*d+k;if(i.terrainOwnership[D]===null){let N=!1;const b=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const H of b){let z=!1,V=!1;for(let j=1;j<=S;j++){const ee=((k+H.x*j)%d+d)%d,Se=((M+H.y*j)%u+u)%u*d+ee;if(i.terrainOwnership[Se]===n){z=!0;break}}if(z)for(let j=1;j<=S;j++){const ee=((k-H.x*j)%d+d)%d,Se=((M-H.y*j)%u+u)%u*d+ee;if(i.terrainOwnership[Se]===n){V=!0;break}}if(z&&V){N=!0;break}}N&&A.push(D)}}for(const R of A)i.terrainOwnership[R]=n;const I=250,T=new Set;for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const k=((g+w)%d+d)%d,D=((m+R)%u+u)%u*d+k;if(i.terrainOwnership[D]===null&&!T.has(D)){const N=[],b=[D];T.add(D),N.push(D);let H=!0,z=0;for(;z<b.length;){const V=b[z++];if(N.length>I){H=!1;break}const j=V%d,ee=Math.floor(V/d),ne=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:Se,ny:ce}of ne){const oe=((j+Se)%d+d)%d,q=((ee+ce)%u+u)%u*d+oe;i.terrainOwnership[q]===null&&!T.has(q)&&(T.add(q),H&&(N.push(q),b.push(q)))}}if(H&&N.length<=I)for(const V of N)i.terrainOwnership[V]=n}}const P=[];for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const k=((g+w)%d+d)%d,M=((m+R)%u+u)%u,D=M*d+k;if(i.terrainOwnership[D]===null){let N=0;for(let b=-1;b<=1;b++)for(let H=-1;H<=1;H++){if(H===0&&b===0)continue;const z=((k+H)%d+d)%d,j=((M+b)%u+u)%u*d+z;i.terrainOwnership[j]===n&&N++}N>=5&&P.push(D)}}for(const R of P)i.terrainOwnership[R]=n}function VA(e,t,n,i){XA(e,t,n,i,{allowOverwrite:!1})}function KA(e,t,n,i){XA(e,t,n,i,{allowOverwrite:!0})}function qA(e,t,n){const{width:i,height:s}=n.mapDimensions,a=Math.ceil(i/Le),l=Math.ceil(s/Le),d=Math.floor(e.x/Le),u=Math.floor(e.y/Le),f=50;for(let g=0;g<=f;g++){const m=-g,S=g,v=-g,A=g;for(let I=v;I<=A;I++)for(let T=m;T<=S;T++){if(g>0&&T>m&&T<S&&I>v&&I<A)continue;const P=((d+T)%a+a)%a,R=((u+I)%l+l)%l,w=R*a+P;if(n.terrainOwnership[w]===t){let k=!1;const M=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:D,ny:N}of M){const b=((P+D)%a+a)%a,z=((R+N)%l+l)%l*a+b;if(n.terrainOwnership[z]!==t){k=!0;break}}if(k)return{x:P*Le+Le/2,y:R*Le+Le/2}}}}return null}function ou(e,t,n){const i=e.terrainOwnership;for(let s=0;s<i.length;s++)i[s]===t&&(i[s]=n)}function be(e,t,n,i,s){const a=t,l=i,d="position"in e&&e.id?e:null,u=d?d.position:e,f=a.search[n].byRadius(u,l);let g=null,m=l;for(const S of f){if(S.id===(d==null?void 0:d.id)||s&&!s(S))continue;const v=U(u,S.position,t.mapDimensions.width,t.mapDimensions.height);v<m&&(m=v,g=S)}return g}function r1(e,t,n,i){return t.search[n].byRadius(e,i)}function RS(e,t,n,i){return r1(e,t,n,i).length}function vt(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function ZA(e,t){var l;const i=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const d of i){if(d.attackTargetId!==e)continue;const u=U(d.position,((l=t.entities.entities[e])==null?void 0:l.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<a&&(s=d,a=u)}return s}function QA(e){return e.search.human.all()}function s1(e,t,n){const{width:i,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const l of a){const d=U(e,l.position,i,s),u=l.type==="tree"?l.radius*2:l.radius;if(d<u)return l}}function a1(e,t,n,i,s){const{width:a,height:l}=i.mapDimensions,d=n*n;if(s){for(let S=0;S<s.length;S++)if(Si(e,s[S],a,l)<d)return!0;return!1}const u=QA(i),f=new Set;for(let S=0;S<u.length;S++){const v=u[S];v.leaderId&&v.leaderId!==t&&f.add(v.leaderId)}const g=f.values();let m=g.next();for(;!m.done;){const S=m.value,v=$n(S,i);if(Si(e,v,a,l)<d)return!0;m=g.next()}return!1}var Ce=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(Ce||{});function Ge(e,t,n,i,s,a,l){const d={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:i,entityId:s,targetPosition:a,targetEntityId:l};return e.visualEffects.push(d),e.nextVisualEffectId++,d.id}const Ke=1,xl=3,no=100,JA=20,lo=10,l1=.5,Fr=150,c1=25,d1=.5,Lr=100,eI=25,Cp=.5,tI=15,ru=4,u1=.75,f1=15,Hg=8,nI=20,h1=.5;function da(e,t,n,i,s,a){if(n===void 0)return!1;const{width:l,height:d}=i.mapDimensions;if(s&&a!==void 0&&Si(s,e,l,d)>a*a)return!1;const u=ip(t),f=Math.sqrt(u.width*u.width+u.height*u.height)/2;if(zn(e,i,f*.8))return!1;if(t===le.PlantingZone){const{depletedSectors:I}=DI(i.soilDepletion,e,u.width,u.height,l,d);if(I.length>0)return!1}const m=i.search.building.byRadius(e,f*2);for(const I of m){const T=Si(e,I.position,l,d),P=(Math.max(u.width,u.height)+Math.max(I.width,I.height))/2;if(T<P*P*.81)return!1}const S=t===le.BorderPost;return!!jA(e,n,i,S?np:aa,S,n).canPlace}function g1(e){const t=[],n=2*Math.PI/e;for(let i=0;i<e;i++){const s=i*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function Zs(e,t,n,i,s,a,l){const d=performance.now(),u={totalTimeMs:0,anchorsSearched:0,candidatesTested:0,canPlaceChecks:0,tribeDistanceChecks:0},f=n,g=ip(e),m=n.mapDimensions.width,S=n.mapDimensions.height,v=f.search.building.byProperty("ownerId",t),A=[];if(v.length>0){a&&A.unshift(a);const w=$n(t,n),k=[...v].sort((M,D)=>{const N=Si(M.position,w,m,S),b=Si(D.position,w,m,S);return N-b});A.push(...k.map(M=>M.position))}else A.push($n(t,n));const I=Math.min(A.length,VR),T=Math.max(g.width,g.height),P=T+20,R=T/2;for(let w=0;w<I;w++){const k=A[w];u.anchorsSearched++;for(let M=P;M<=i;M+=R){const D=Math.max(8,Math.min(KR,Math.ceil(2*Math.PI*M/T))),N=g1(D);for(let b=0;b<D;b++){u.candidatesTested++;const H=N[b].cos*M,z=N[b].sin*M,V=k.x+H,j=k.y+z,ee=(V%m+m)%m,ne=(j%S+S)%S;if(u.tribeDistanceChecks++,!a1({x:ee,y:ne},t,s,n,l)&&(u.canPlaceChecks++,da({x:ee,y:ne},e,t,n)))return u.totalTimeMs=performance.now()-d,u.totalTimeMs>CS&&console.log(`[BuildingPlacement] Slow search for ${e}: ${u.totalTimeMs.toFixed(2)}ms | anchors=${u.anchorsSearched}, candidates=${u.candidatesTested}, canPlace=${u.canPlaceChecks}, tribeDist=${u.tribeDistanceChecks}`),{x:ee,y:ne}}}}u.totalTimeMs=performance.now()-d,u.totalTimeMs>CS&&console.log(`[BuildingPlacement] Slow search (no valid location) for ${e}: ${u.totalTimeMs.toFixed(2)}ms | anchors=${u.anchorsSearched}, candidates=${u.candidatesTested}, canPlace=${u.canPlaceChecks}, tribeDist=${u.tribeDistanceChecks}`)}function Ko(e,t,n,i){if(t===le.BorderPost)return KA(e,np,n,i),Ge(i,Ce.BorderClaim,e,Ke,n),null;const s=Gk(i.entities,e,t,n);return t===le.Bonfire&&(s.storageCapacity=ru,s.storedItems=[]),VA(e,aa,n,i),t===le.PlantingZone&&Bl(i),s}function Gg(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===le.PlantingZone&&Bl(t))}function p1(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let l=e.x-a.position.x,d=e.y-a.position.y;const u=t.mapDimensions.width,f=t.mapDimensions.height;if(Math.abs(l)>u/2&&(l-=Math.sign(l)*u),Math.abs(d)>f/2&&(d-=Math.sign(d)*f),Math.abs(l)<=a.width/2&&Math.abs(d)<=a.height/2)return a}}var ie=(e=>(e.Leader="leader",e.Gatherer="gatherer",e.Planter="planter",e.Hunter="hunter",e.Mover="mover",e.Warrior="warrior",e))(ie||{});const _t=30,ma=_t*.6,iI="#4CAF50",oI="#FF5722",rI="#9C27B0",m1="#2196F3",sI="#FFC107",y1="#DC143C",_p="#FFFFFF",wp=[5,5],Mu=5,ua=15,S1=20,v1=16,A1=10,I1=16,T1=16,su=["","","","","","","","","",""],Rl=8,E1="#FFFFFF",it=18,et=15,C1="rgba(0, 0, 0, 0.7)",_1=4,ko=150,Bn=15,Vi=10,Yo="#555",w1="#f44336",R1="#4CAF50",P1="#2196F3",D1="#FFC107",yd=16,Ar=32,Sd=28,N1=10,M1=8,O1=8,k1=8,ei=28,vd=40,b1="rgba(255, 215, 0, 0.7)",B1="rgba(0, 0, 0, 0.3)",Ri=10,PS=8,Vh=11,bo=20,Kh=40,DS=5,F1=10,L1="#FFA500",U1="#808080",io=120,aI=30,H1=20,xo="#2d3748",Ht="#ffffff",Ad="#4a5568",lI=5,Rp="#bdc9f792",cI="#272c36ff",dI="#a0aec0",au=300,uI="rgba(255, 255, 255, 0.5)",G1="rgba(0, 0, 0, 0.8)",$1="#FFFFFF",NS=14,MS=8,OS=-15,fI="#FFD700",hI=5,x1=10,qh=12,W1=10,Y1="#4CAF50",z1="#F44336",j1="#FFC107",X1="rgba(255, 255, 255, 0.2)",kS="#FFFFFF",V1="#FF6B6B",K1=5,gI=30,al=50,Id=8,bS=10,q1="rgba(0, 0, 0, 0.5)",Z1="#FFFFFF",Q1=33,J1=400,eP=20,tP=10,nP="rgba(0, 0, 0, 0.7)",iP="#FFFFFF",Zh=20,BS=16,oP=.5,FS=5,pI="#FFD700",rP=40,Pp=4,mI=3,sP=5,yI=20,SI=5,aP="#FFFFFF",lP="#FF6B6B",Fn=80,Ir=10,Td=300,Tr=15,cP=8,dP="rgba(0, 0, 0, 0.8)",uP="#FFFFFF",Qh=14,LS=10,Pi=20,fP="#FF6B6B",hP="#4CAF50",US="#FFD700",gP="rgba(255, 255, 0, 0.3)",pP=2,mP=500,yP=120,SP=45,vP="#FFD700",AP=3,IP=4;let Jh=0;function lu(){const e=su[Jh];return Jh=(Jh+1)%su.length,e}function HS(e,t,n){return t.search.human.byRadius(e.position,n).filter(a=>{var d;return!(a.id===e.id||a.gender===e.gender||!a.isAdult||a.hunger>=sn||(a.procreationCooldown||0)>0||a.gender==="female"&&a.isPregnant||(e.motherId===a.id||e.fatherId===a.id)&&((d=a.partnerIds)!=null&&d.length))}).sort((a,l)=>{const d=a.id===e.motherId||a.id===e.fatherId,u=e.id===a.motherId||e.id===a.fatherId,f=l.id===e.motherId||l.id===e.fatherId,g=e.id===l.motherId||e.id===l.fatherId;return d||u?1:f||g?-1:a.age-l.age})}function jr(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),i=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(i),t.length>0)return t[0];if(n.sort(i),n.length>0)return n[0]}function Dn(e,t){const n=e,i=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...i,...s]}function TP(e,t,n){var s;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||e.motherId&&e.motherId===t.motherId||e.fatherId&&e.fatherId===t.fatherId||(s=e.partnerIds)!=null&&s.includes(t.id))return!0;if(e.motherId){const a=n.entities.entities[e.motherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(e.fatherId){const a=n.entities.entities[e.fatherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(t.motherId){const a=n.entities.entities[t.motherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}if(t.fatherId){const a=n.entities.entities[t.fatherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}return!1}function $g(e,t){var a,l,d,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(l=t.partnerIds)!=null&&l.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,i=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((d=e.ancestorIds)==null?void 0:d.some(f=>t.ancestorIds.includes(f)))||((u=t.ancestorIds)==null?void 0:u.some(f=>e.ancestorIds.includes(f)));return n||i||s}function EP(e,t){const n=[];if(e.motherId){const i=t.entities.entities[e.motherId];i&&n.push(i)}if(e.fatherId){const i=t.entities.entities[e.fatherId];i&&n.push(i)}return n}function vI(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const i=t.entities.entities[n];if(i&&i.gender==="male")return i}return null}function xg(e,t){var n;if(!e.isAdult){if(e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human")return i}if(e.motherId){const i=t.entities.entities[e.motherId];if(i&&i.type==="human")return i}}if(e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human"&&((n=jr(Dn(t,i)))==null?void 0:n.id)===e.id)return i}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?vI(e,t):null}function cu(e,t){let n=e;const i=new Set;i.add(n.id);for(let s=0;s<DA;s++){let a=null;if(n.gender==="female"&&(a=vI(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||i.has(a.id))break;n=a,i.add(n.id)}return n}function Wl(e,t){var i;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(i=e.partnerIds)==null||i.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),Dn(t,e).forEach(s=>n.add(s)),Array.from(n)}function du(e,t){const n=new Map;function i(s){const a=Dn(t,s);for(const l of a)n.has(l.id)||(n.set(l.id,l),i(l))}return i(e),Array.from(n.values())}function Li(e,t){return t.search.human.byProperty("leaderId",e)}function uu(e,t,n=new Map,i=new Set){var a;if(n.has(e))return n.get(e);if(i.has(e))return e;i.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const l=s.partnerIds.find(d=>{const u=t.entities.entities[d];return u&&u.gender==="male"});if(l){const d=uu(l,t,n,i);return n.set(e,d),d}}if(s.fatherId&&t.entities.entities[s.fatherId]){const l=uu(s.fatherId,t,n,i);return n.set(e,l),l}return n.set(e,e),e}function CP(e,t){e.leaderId=e.id,e.tribeRole=ie.Leader,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{roleWeights:{[ie.Leader]:0,[ie.Gatherer]:2,[ie.Planter]:2,[ie.Hunter]:2,[ie.Mover]:2,[ie.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}}),e.tribeInfo||(e.tribeInfo={tribeBadge:lu(),tribeColor:Gn[Math.floor(Math.random()*Gn.length)]}),e.tribeControl||(e.tribeControl={roleWeights:{[ie.Leader]:0,[ie.Gatherer]:2,[ie.Planter]:2,[ie.Hunter]:2,[ie.Mover]:2,[ie.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}})}function _P(e,t){if(e.length===0)return null;const n=new Map,i=new Map;for(const l of e){const d=uu(l.id,t,n);i.has(d)||i.set(d,[]),i.get(d).push(l)}let s=null,a=0;for(const[l,d]of i.entries())d.length>a&&(a=d.length,s=l);return s&&t.entities.entities[s]||null}function Ou(e,t){var l,d,u;const n=new Map,i=Object.values(e.entities.entities).filter(f=>f.type==="human");for(const f of i)f.leaderId&&(n.has(f.leaderId)||n.set(f.leaderId,{leaderId:f.leaderId,tribeInfo:f.tribeInfo,members:[]}),(l=n.get(f.leaderId))==null||l.members.push(f));const s=t?(u=(d=e.entities.entities[t])==null?void 0:d.tribeControl)==null?void 0:u.diplomacy:void 0,a=Array.from(n.values()).map(f=>{var v,A;const g=e.entities.entities[f.leaderId],m=f.members.filter(I=>I.isAdult).length,S=f.members.length-m;return{leaderId:f.leaderId,tribeBadge:((v=f==null?void 0:f.tribeInfo)==null?void 0:v.tribeBadge)||"",tribeColor:((A=f==null?void 0:f.tribeInfo)==null?void 0:A.tribeColor)||"",adultCount:m,childCount:S,isPlayerTribe:f.leaderId===t,leaderAge:(g==null?void 0:g.age)??0,leaderGender:(g==null?void 0:g.gender)??"male",diplomacyStatus:(s==null?void 0:s[f.leaderId??-1])??Ut.Friendly}});return a.sort((f,g)=>f.isPlayerTribe?-1:g.isPlayerTribe?1:g.adultCount+g.childCount-(f.adultCount+f.childCount)),a}function jn(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function AI(e){var a;const t=new Set,i=e.search.human.all(),s=new Map;for(const l of i)l.leaderId&&(s.has(l.leaderId)||s.set(l.leaderId,[]),(a=s.get(l.leaderId))==null||a.push(l));for(const[l,d]of s){if(d.length===0)continue;const u=e.entities.entities[l],f=!u,g=u&&u.leaderId!==l;(f||g)&&t.add(l)}for(let l=0;l<e.terrainOwnership.length;l++){const d=e.terrainOwnership[l];d!==null&&!s.has(d)&&t.add(d)}return Array.from(t)}function wP(e,t){const n=new Map,s=t.search.human.all(),a=Wl(e,t);for(const d of a)n.set(d,3);for(const d of s)d.id===e.id||n.has(d)||$g(e,d)&&n.set(d,2);const l=Array.from(n.keys());for(const d of l)if(d.partnerIds)for(const u of d.partnerIds){const f=t.entities.entities[u];f&&!n.has(f)&&f.id!==e.id&&n.set(f,1)}return n}function RP(e,t){const n=Li(e,t);if(n.length===0)return null;const i=t.entities.entities[e];if(i&&i.leaderId&&i.leaderId!==i.id)return i.leaderId;const s=new Map;for(const d of n){const u=wP(d,t);for(const[f,g]of u)if(f.leaderId&&f.leaderId!==e){const m=f.leaderId,S=t.entities.entities[m];if(S&&S.leaderId===S.id){const v=s.get(m)||0;s.set(m,v+g)}}}let a=null,l=0;for(const[d,u]of s)u>l&&(l=u,a=d);return a}function GS(e,t,n){var g,m;const i=Li(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=i.length>0?(g=i[0].tribeInfo)==null?void 0:g.tribeBadge:"?",l=s.leaderId===e||!s.leaderId;if(l){const S=n.entities.entities[e];CP(s,S)}const d=((m=s.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const S of i)S.id!==t&&(S.leaderId=t,S.tribeInfo=s.tribeInfo,S.tribeRole=void 0);const f=n.search.building.byProperty("ownerId",e);for(const S of f)S.ownerId=t;ou(n,e,t),$l(n,{identifier:`tribe-merge-${e}`,type:zr.TribeMerged,message:l?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${d}!`,duration:tu,targetEntityIds:[t],highlightedEntityIds:[t,...i.map(S=>S.id)]})}function PP(e){var n;const t=AI(e);for(const i of t){const s=Li(i,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",i);for(const f of u)Gg(f.id,e);ou(e,i,null),$l(e,{identifier:`tribe-dissolved-${i}`,type:zr.TribeMerged,message:"An extinct tribe has been dissolved.",duration:tu});continue}const a=_P(s,e);if(a){GS(i,a.id,e);continue}const l=RP(i,e);if(l)GS(i,l,e);else{const d=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const g of s)g.leaderId=void 0,g.tribeInfo=void 0,g.tribeRole=void 0;const f=e.search.building.byProperty("ownerId",i);for(const g of f)Gg(g.id,e);ou(e,i,null),$l(e,{identifier:`tribe-dissolved-${i}`,type:zr.TribeMerged,message:`Tribe ${d} has been dissolved due to lack of leadership.`,duration:tu})}}}var yt=(e=>(e.Wood="wood",e))(yt||{});const Dp={wood:""},an="treeGrowing",Kt="treeFull",vn="treeSpreading",Gt="treeFallen",co="treeStump",Xr="treeDying",DP=500;function NP(e,t){if(!e.leaderId)return 0;const n=MP(e.leaderId,t),i=OP(e.leaderId,t);return i===0?0:Math.min(1,n/i)}function MP(e,t){const n=jn({leaderId:e},t),i=ya(e,t),s=n.reduce((l,d)=>l+d.food.length,0),a=i.reduce((l,d)=>{var f;const u=(f=d.storedItems)==null?void 0:f.filter(g=>g.item.type===An.Berry||g.item.type===An.Meat);return l+((u==null?void 0:u.length)||0)},0);return s+a}function OP(e,t){const n=jn({leaderId:e},t),i=ya(e,t),s=n.reduce((l,d)=>l+d.maxFood,0),a=i.reduce((l,d)=>l+(d.storageCapacity||0),0);return s+a}function II(e,t,n=!1){const i=ya(e,t,n);if(i.length===0)return 0;const s=i.reduce((l,d)=>{var u;return l+(((u=d.storedItems)==null?void 0:u.length)||0)},0),a=i.reduce((l,d)=>l+(d.storageCapacity||0),0);return a===0?0:Math.min(1,s/a)}function Yl(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const n=jn({leaderId:e},t),i=0,l=t.search.building.byProperty("ownerId",e).reduce((A,I)=>{if(I.isConstructed)return A;const T=nr[I.buildingType].cost.wood||0;return A+T},0),u=fa(e,t).reduce((A,I)=>{const P=(I.maxFuelLevel||Lr)-(I.fuelLevel||0);if(P<=0)return A;const R=Math.ceil(P/eI),w=I.storedItems.filter(M=>M.item.type===yt.Wood).length,k=Math.max(0,R-w);return A+k},0),g=ya(e,t).reduce((A,I)=>{var P;const T=(P=I.storedItems)==null?void 0:P.filter(R=>R.item.type===yt.Wood);return A+((T==null?void 0:T.length)||0)},0),m=n.reduce((A,I)=>{var T;return A+(((T=I.heldItem)==null?void 0:T.type)===yt.Wood?1:0)},0),S=g+m,v=l+u+i;return t.cache.tribeWoodNeeds[e]=Math.max(0,v-S),t.cache.tribeWoodNeeds[e]}function TI(e,t){const n=t;if(e&&n.cache.tribeAvailableWoodOnGround[e]!==void 0)return n.cache.tribeAvailableWoodOnGround[e];const i=n.search.tree.all().filter(s=>!(s.stateMachine[0]===Gt)||s.wood.length===0?!1:Wn(s.position,e,t));return n.cache.tribeAvailableWoodOnGround[e]=i.reduce((s,a)=>s+a.wood.length,0),n.cache.tribeAvailableWoodOnGround[e]}function EI(e,t){const n=jn({leaderId:e},t);if(n.length===0)return{count:0,ratio:0};const i=kP(e,t);return{count:i,ratio:i/n.length}}function kP(e,t){return t.search.berryBush.all().filter(a=>xn(a.position.x,a.position.y,t)===e).filter(a=>{const l=a.stateMachine&&a.stateMachine[0]==="bushDying",d=a.food.length>0,u=Ui(t.soilDepletion,a.position,t.mapDimensions.width,t.mapDimensions.height);return!l&&d&&!u}).length}function ku(e,t,n=!1){const i=typeof e=="object"?e.leaderId:e;return i?t.search.building.byProperty("buildingType",le.PlantingZone).filter(a=>{if(!n&&!a.isConstructed)return!1;if(a.ownerId){const l=t.entities.entities[a.ownerId];return l&&l.leaderId===i}return!1}):[]}function bP(e,t){const{width:n,height:i,position:s}=e,{width:a,height:l}=t.mapDimensions,{depletedSectors:d,totalSectorsCount:u}=DI(t.soilDepletion,s,n,i,a,l);return u===0?!0:d.length/u<.25}function Np(e){const t=Zo*2,n=Math.floor(e.width/t),i=Math.floor(e.height/t);return n*i}function CI(e,t){const n=t,i=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,i).filter(l=>{const d=Math.abs(l.position.x-e.position.x),u=Math.abs(l.position.y-e.position.y);return d<=e.width/2&&u<=e.height/2}).length}function BP(e,t){if(!e.leaderId)return[];const n=ya(e.leaderId,t),i=jn(e,t);return n.map(s=>{var f;const a=s.storageCapacity||0,l=((f=s.storedItems)==null?void 0:f.length)||0,d=i.filter(g=>{if(g.activeAction!=="depositing")return!1;if(typeof g.target=="object"&&"x"in g.target){const m=g.target;return U(m,s.position,t.mapDimensions.width,t.mapDimensions.height)<=50}return!1}).length,u=U(e.position,s.position,t.mapDimensions.width,t.mapDimensions.height);return{storage:s,capacity:a,currentItems:l,assignedDepositors:d,distance:u}})}function _I(e,t){const n=BP(e,t);if(n.length===0)return null;const i=n.filter(s=>{const a=s.currentItems<s.capacity,l=s.distance<=DP;return a&&l});return i.length===0?null:(i.sort((s,a)=>{const l=s.currentItems/s.capacity,d=a.currentItems/a.capacity;return Math.abs(l-d)>.1?l-d:s.assignedDepositors!==a.assignedDepositors?s.assignedDepositors-a.assignedDepositors:s.distance-a.distance}),i[0].storage)}function FP(e,t){if(!e.leaderId)return null;const i=fa(e.leaderId,t).filter(s=>{const a=s.storageCapacity||ru;return s.storedItems.length<a});if(i.length>0){const s=i.filter(a=>{const l=a.fuelLevel??0,d=a.maxFuelLevel??Lr;return l<d*Cp});return s.length>0?(s.sort((a,l)=>{const d=a.fuelLevel??0,u=l.fuelLevel??0,f=a.maxFuelLevel??Lr,g=l.maxFuelLevel??Lr,m=d/f,S=u/g,v=m<.25,A=S<.25;return v!==A?v?-1:1:d-u}),s[0]):(i.sort((a,l)=>{const d=U(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height),u=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);return d-u}),i[0])}return _I(e,t)}function wI(e,t,n){return jn({leaderId:e},t).filter(s=>s.activeAction===n).length}function ya(e,t,n=!1){return t.search.building.byProperty("buildingType",le.StorageSpot).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function fa(e,t,n=!1){return t.search.building.byProperty("buildingType",le.Bonfire).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function LP(e,t){const n=ku(e,t);if(n.length===0)return null;const i=t.mapDimensions.width,s=t.mapDimensions.height,a=t.soilDepletion;for(const l of n){const d=Np(l);if(CI(l,t)>=d)continue;const f=20;for(let g=0;g<f;g++){const m=l.position.x+(Math.random()-.5)*l.width,S=l.position.y+(Math.random()-.5)*l.height,v={x:(m%i+i)%i,y:(S%s+s)%s};if(!Ui(a,v,i,s)&&!zn(v,t,Zo))return{position:v,zoneId:l.id}}}return null}function Ql(e,t,n=void 0){return n?ku(n,t).some(l=>bg(e,l,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===le.PlantingZone&&bg(e,a,t))}function bu(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/Xt),gridY:Math.floor(s/Xt)}}function RI(e,t,n){const i=IA(t,n);return e.sectors[i]||(e.sectors[i]=_w()),e.sectors[i]}function Mp(e,t,n){const i=IA(t,n),s=e.sectors[i];return s?s.health:eu}function Ui(e,t,n,i){const{gridX:s,gridY:a}=bu(t,n,i);return Mp(e,s,a)<CA}function PI(e,t,n){return Mp(e,t,n)>=CA}function UP(e,t,n,i,s,a,l){const{gridX:d,gridY:u}=bu(t,s,a),f=RI(e,d,u),g=f.lastAffectedBy[n]||0;if(i-g<wA)return;const m=Ql(t,l)?PA:1,S=Rw*m;f.health=Math.max(_A,f.health-S),f.lastWalkTime=i,f.lastAffectedBy[n]=i}function HP(e,t,n,i,s,a){const{gridX:l,gridY:d}=bu(t,i,s),u=RI(e,l,d),f=Ql(t,a)?PA:1,g=ww*f;u.health=Math.max(_A,u.health-g),u.lastPlantTime=n}function GP(e,t,n,i,s){let a=0;for(let l=-1;l<=1;l++)for(let d=-1;d<=1;d++){if(l===0&&d===0)continue;const u=((t+l)%i+i)%i,f=((n+d)%s+s)%s;PI(e,u,f)&&a++}return a}function $P({soilDepletion:e,time:t,mapDimensions:{width:n,height:i}}){if(t-e.lastUpdateTime<bw)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/Xt),l=Math.ceil(i/Xt),d=[];for(const u of Object.keys(e.sectors)){const f=e.sectors[u],g=Math.max(f.lastWalkTime,f.lastPlantTime);if(t-g<Nw)continue;const{gridX:m,gridY:S}=TA(u),v=GP(e,m,S,a,l),A=v>0?Dw*(v/8):0,I=Pw+A;f.health=Math.min(eu,f.health+I*s),f.health>=eu&&d.push(u);const T=t-wA*10;for(const P of Object.keys(f.lastAffectedBy))f.lastAffectedBy[Number(P)]<T&&delete f.lastAffectedBy[Number(P)]}for(const u of d)delete e.sectors[u]}function xP(e,t){const n=[];for(const i of Object.keys(e.sectors)){const s=e.sectors[i];if(s.health<t){const{gridX:a,gridY:l}=TA(i);n.push({gridX:a,gridY:l,health:s.health})}}return n}function DI(e,t,n,i,s,a){const l=[],d=n/2,u=i/2,f=t.x-d,g=t.x+d,m=t.y-u,S=t.y+u,v=Math.floor(f/Xt),A=Math.floor((g-.001)/Xt),I=Math.floor(m/Xt),T=Math.floor((S-.001)/Xt),P=Math.ceil(s/Xt),R=Math.ceil(a/Xt);let w=0;for(let k=v;k<=A;k++)for(let M=I;M<=T;M++){w++;const D=(k%P+P)%P,N=(M%R+R)%R;PI(e,D,N)||l.push({gridX:D,gridY:N})}return{depletedSectors:l,totalSectorsCount:w}}function $S(e,t,n,i,s){const{gridX:a,gridY:l}=bu(t,n,i),d=Mp(e,a,l);return 1+(s-1)*Math.sqrt(1-d/eu)}const WP={id:wl,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ct/Dt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Ul,data:{...e,enteredAt:i.gameState.time}};if(!Ui(i.gameState.soilDepletion,n.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)){const l=Ql(n.position,i.gameState)?Cw:1;n.timeSinceLastBerryRegen+=s*l,n.timeSinceLastBerryRegen>=Aw&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:An.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:Mr,data:{...e,enteredAt:i.gameState.time,previousState:wl}}:{nextState:wl,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},YP={id:Mr,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ct/Dt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Ul,data:{...e,enteredAt:i.gameState.time,previousState:Mr}};if(n.food.length<n.maxFood)return{nextState:wl,data:{...e,enteredAt:i.gameState.time,previousState:Mr}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=hS){n.timeSinceLastSpreadAttempt=0;const l=i.gameState.time-n.timeSinceLastHarvest>=hS,d=Ql(n.position,i.gameState)?Ew:1,u=i.gameState.ecosystem.berryBushSpreadChance*d;if(l&&Math.random()<u)return{nextState:Wd,data:{...e,enteredAt:i.gameState.time,previousState:Mr}}}return{nextState:Mr,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function zP(e,t,n){const i=Wl(e,t),s=t;for(const a of i){if(U(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height)>n)continue;const d=s.search.human.byProperty("attackTargetId",a.id);for(const u of d)if(u.leaderId!==e.leaderId&&U(e.position,u.position,t.mapDimensions.width,t.mapDimensions.height)<=n)return{familyMember:a,aggressor:u}}}function jP(e,t){const i=t.search.human.byRadius(e.position,FR);let s,a=1/0;for(const l of i){if(l.id===e.id||l.hitpoints<=0||l.hitpoints/l.maxHitpoints>BR||TP(e,l,t)||e.leaderId===l.leaderId&&e.leaderId)continue;const d=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);d<a&&(a=d,s=l)}return s}function XP(e,t,n){return t.search.human.byRadius(e.position,n).filter(s=>qr(e,s,t))}function VP(e,t,n){const i=n.search.human.byProperty("leaderId",e);let s=0;for(const a of i)a.attackTargetId===t&&s++;return s}function xS(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let i=n.hitpoints;return i+=(n.maxAge-n.age)*.5,i+=n.food.length*2,t+i},0)}var re=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(re||{});const Bu={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},NI={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var ks=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(ks||{});const ll={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var de=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenRoleManager="OpenRoleManager",e.CloseRoleManager="CloseRoleManager",e.IncreaseRoleWeight="IncreaseRoleWeight",e.DecreaseRoleWeight="DecreaseRoleWeight",e.OpenArmyControl="OpenArmyControl",e.CloseArmyControl="CloseArmyControl",e.IncreaseArmyObjective="IncreaseArmyObjective",e.DecreaseArmyObjective="DecreaseArmyObjective",e.SwitchAIType="SwitchAIType",e))(de||{});const eg=30,KP=.4,qP=24,MI=50,ZP=100,QP=160,JP=72,OI=10,Op=2,eD=10,tD=15,Wg=5,Yg=5,zg=5,WS=600,nD=1.5,kI=.1,tg=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,ng=""+new URL("gather-CU75596W.mp3",import.meta.url).href,iD=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,YS=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,oD=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,rD=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,sD=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,aD=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,lD=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,cD=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var _e=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(_e||{});const dD=new Map([[0,tg],[1,ng],[2,iD],[3,YS],[4,oD],[5,rD],[6,sD],[12,aD],[13,lD],[7,tg],[8,YS],[9,ng],[10,ng],[11,tg],[14,cD]]);let cl,zl;function uD(){if(!(typeof window>"u"))return zl}function kp(){if(!(typeof window>"u"))return!cl&&typeof window.AudioContext=="function"&&(cl=new window.AudioContext,zl=cl.createGain(),zl.connect(cl.destination),Pl(.1,!1)),cl}function Pl(e,t){zl&&(zl.gain.value=t?0:e/10)}const bI=new Map;let Ed=!1,zS=!1;async function fD(){if(zS||Ed)return;const e=kp();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),Ed=!0,console.log("Starting sound loading...");const t=[];dD.forEach((n,i)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{bI.set(i,a)}).catch(a=>{console.error(`Error loading sound ${_e[i]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),zS=!0,Ed=!1,console.log("All sounds loaded successfully.")}catch(n){Ed=!1,console.error("An error occurred while loading sounds:",n)}}const Dl=new Map;function bp(e,t){const n=kp(),i=uD();if(!n||!i||i.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=bI.get(e);if(!s){console.warn(`Sound buffer not found for type: ${_e[e]}`);return}if(t!=null&&t.trackId&&Dl.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const l=n.createGain(),d=n.createStereoPanner();let u=l;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const f=Xe(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),g=U(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(g>WS)return;const m=1-Math.pow(g/WS,nD);l.gain.value=Math.max(0,m);const S=Math.sin(f.x/g*(Math.PI/2));d.pan.value=isNaN(S)?0:S,l.connect(d),u=d}else{const f=e===_e.GameOver?.4:e===_e.SoundTrack1?1:.2;l.gain.value=f}a.connect(u),u.connect(i),a.start(0),t!=null&&t.trackId&&(Dl.set(t.trackId,{sourceNode:a,gainNode:l}),a.onended=()=>{Dl.delete(t.trackId)})}function ig(e,t=1){const n=Dl.get(e),i=kp();if(n&&i){const{sourceNode:s,gainNode:a}=n,l=i.currentTime;a.gain.setValueAtTime(a.gain.value,l),a.gain.linearRampToValueAtTime(0,l+t),s.stop(l+t),s.onended=null,Dl.delete(e)}}function Ne(e,t,n){const i=vt(e.gameState);i&&bp(t,{position:n,listenerPosition:i.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}var E=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.FAILURE=1]="FAILURE",e[e.RUNNING=2]="RUNNING",e[e.NOT_EVALUATED=3]="NOT_EVALUATED",e))(E||{});class Nn{constructor(){Re(this,"name");Re(this,"depth");Re(this,"children");Re(this,"child")}getLastStatus(t){return C.get(t.aiBlackboard,`${this.name}_lastStatus`)??3}setLastStatus(t,n){C.set(t.aiBlackboard,`${this.name}_lastStatus`,n)}getRunningChildIndex(t){return C.get(t.aiBlackboard,`${this.name}_runningChildIndex`)}setRunningChildIndex(t,n){C.set(t.aiBlackboard,`${this.name}_runningChildIndex`,n)}}const C={create(){return{data:{},nodeExecutionData:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e},recordNodeExecution({nodeExecutionData:e},t,n,i,s,a){const l=e[t]||{lastExecuted:0,status:E.FAILURE,depth:0,debugInfo:"",executionHistory:[]},d=l.executionHistory[l.executionHistory.length-1];d&&i-(d==null?void 0:d.time)>la&&l.executionHistory.push({time:d.time+la,status:E.NOT_EVALUATED}),l.executionHistory.push({time:i,status:n});const u=gI/Dt*Ct,f=i-u;l.executionHistory=l.executionHistory.filter(m=>m.time>=f);const g={...l,lastExecuted:i,status:n,depth:s,debugInfo:a};e[t]=g},getNodeExecutionData({nodeExecutionData:e}){return e},cleanupOldEntries({nodeExecutionData:e},t){const n=ER,i=[];for(const[s,a]of Object.entries(e))t-a.lastExecuted>n&&i.push(s);for(const s of i)delete e[s]}},Bp="tribeSplit_phase",Jl="tribeSplit_strategy",Fp="tribeSplit_targetPosition",Fu="tribeSplit_targetBuildingId",Lu="tribeSplit_familyIds",BI="tribeSplit_phaseStartTime",FI="tribeSplit_lastFailureTime";function LI(e,t){C.set(e,Bp,"idle"),C.delete(e,Jl),C.delete(e,Fp),C.delete(e,Fu),C.delete(e,Lu),C.set(e,FI,t)}function hD(e,t){const n=C.get(e,FI);return n?t-n>=JP:!0}function gD(e,t){const n=C.get(e,BI);return n?t-n>=QP:!1}function Lp(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(AI(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!hD(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const i=t.entities.entities[e.leaderId];if(!i||i.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=jr(Dn(t,i));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(cu(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const l=Li(e.leaderId,t).filter(v=>v.isAdult);if(l.length<eg)return{canSplit:!1,reason:"Tribe too small"};const u=du(e,t).length+1,g=du(i,t).length+1;if(u>=g&&u>eg)return{canSplit:!0,progress:1,strategy:jS(e,t)};const m=Math.max(l.length*KP,eg),S=u/m;if(u>=m){const v=jS(e,t);return{canSplit:!0,progress:S,strategy:v}}return{canSplit:!1,progress:S,reason:`Family too small: ${u} < ${m}`}}function jS(e,t){if(!e.leaderId)return"migration";const n=t;if(!(xn(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===le.StorageSpot&&a.isConstructed);return s.length>0&&s.find(l=>U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height)<=ZP)?"concentration":"migration"}function UI(e,t){if(!e.aiBlackboard)return!1;const n=C.get(e.aiBlackboard,Jl);if(!n)return!1;const i=du(e,t),s=[e.id,...i.map(a=>a.id)];return C.set(e.aiBlackboard,Lu,s),n==="migration"?mD(e,t):n==="concentration"?yD(e,t):!1}function pD(e,t,n){if(zn(e,n,30))return!1;const s=xn(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function mD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,i=t.mapDimensions.height,s=Math.min(n,i)/2,a=50,l=50;for(let d=0;d<=s;d+=a){const u=d===0?1:Math.max(8,Math.ceil(2*Math.PI*d/l)),f=d===0?0:2*Math.PI/u;for(let g=0;g<u;g++){const m=g*f,S=Math.cos(m)*d,v=Math.sin(m)*d,A=e.position.x+S,I=e.position.y+v,T={x:(A%n+n)%n,y:(I%i+i)%i};if(pD(T,e.leaderId,t))return C.set(e.aiBlackboard,Fp,T),!0}}return!1}function yD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const i=t.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===le.StorageSpot&&l.isConstructed);if(i.length===0)return!1;let s=null,a=1/0;for(const l of i){const d=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);d<a&&(a=d,s=l)}return s?(C.set(e.aiBlackboard,Fu,s.id),!0):!1}function SD(e,t){var d;if(!e.aiBlackboard)return[!1,0];const n=C.get(e.aiBlackboard,Jl),i=(d=C.get(e.aiBlackboard,Lu))==null?void 0:d.filter(u=>!!t.entities.entities[u]);if(!n||!i)return[!1,0];let s;if(n==="migration"){const u=C.get(e.aiBlackboard,Fp);if(!u)return[!1,0];s=u}else if(n==="concentration"){const u=C.get(e.aiBlackboard,Fu);if(!u)return[!1,0];const f=t.entities.entities[u];if(!f)return[!1,0];s=f.position}else return[!1,0];let a=0;for(const u of i){const f=t.entities.entities[u];if(!f||f.type!=="human")continue;U(f.position,s,t.mapDimensions.width,t.mapDimensions.height)<=MI&&a++}const l=Math.ceil(i.length*.5);return[a>=l,a/l]}function HI(e,t){var u;if(!e.aiBlackboard)return!1;const n=C.get(e.aiBlackboard,Jl),i=C.get(e.aiBlackboard,Lu);if(!n||!i)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=lu(),l=Gn[Math.floor(Math.random()*Gn.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:l},e.tribeRole=ie.Leader,e.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=Ut.Hostile);for(const f of i){if(f===e.id)continue;const g=t.entities.entities[f];!g||g.type!=="human"||(g.leaderId=e.id,g.tribeInfo={tribeBadge:a,tribeColor:l})}if(n==="concentration"){const f=C.get(e.aiBlackboard,Fu);if(f){const g=t.entities.entities[f];g&&g.type==="building"&&(g.ownerId=e.id)}}return $l(t,{type:zr.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:tu,targetEntityIds:[e.id],highlightedEntityIds:i}),Ne({gameState:t},_e.TribeSplit,e.position),LI(e.aiBlackboard,t.time),!0}function Il(e){return e?C.get(e,Bp)??"idle":"idle"}function Cs(e,t,n){C.set(e,Bp,t),C.set(e,BI,n)}function GI(e,t){C.set(e,Jl,t)}function vD(e,t){LI(e,t)}function AD(e,t){return gD(e,t)?(vD(e,t),!0):!1}function $I(e,t){const n=Lp(e,t);return{canSplit:n.canSplit,progress:n.progress}}function xI(e,t){if(!e.aiBlackboard)return;const n=Lp(e,t);!n.canSplit||!n.strategy||(GI(e.aiBlackboard,n.strategy),UI(e,t)&&HI(e,t))}const ID=20,qt=30,TD=.5,ED=.3,CD=2,_D=50;function Up(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>Qo&&n.push({type:re.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const l=be(t,e,"berryBush",ze,f=>f.food.length>0),d=be(t,e,"corpse",ze,f=>f.food.length>0);let u=null;l&&d?u=U(t.position,l.position,e.mapDimensions.width,e.mapDimensions.height)<=U(t.position,d.position,e.mapDimensions.width,e.mapDimensions.height)?l:d:u=l||d,u&&n.push({type:re.Gather,action:"gathering",key:"e",targetEntity:u})}const i=be(t,e,"human",ze,l=>or(t,l,e));if(i&&n.push({type:re.Procreate,action:"procreating",key:"r",targetEntity:i}),t.food.length>0&&t.isAdult){const l=be(t,e,"human",ze,d=>{const u=d;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=Qo});l&&n.push({type:re.FeedChild,action:"feeding",key:"h",targetEntity:l})}const s=be(t,e,"human",Sn,l=>qr(t,l,e))??be(t,e,"predator",Sn)??be(t,e,"prey",Sn);if(s&&n.push({type:re.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(l=>l.type===An.Berry).length>=uo&&n.push({type:re.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const l=be(t,e,"building",qt,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});l&&n.push({type:re.Deposit,action:"idle",key:"x",targetEntity:l})}if(t.food.length<t.maxFood&&t.isAdult){const l=be(t,e,"building",qt,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});l&&n.push({type:re.Retrieve,action:"idle",key:"z",targetEntity:l})}if(((a=t.heldItem)==null?void 0:a.type)===yt.Wood){const l=be(t,e,"building",qt,d=>{const u=d;return u.buildingType===le.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});l&&n.push({type:re.Deposit,action:"depositing",key:"x",targetEntity:l})}if($I(t,e).canSplit&&n.push({type:re.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const l=be(t,e,"tree",Cu,d=>d.wood&&d.wood.length>0);l&&n.push({type:re.Chop,action:"chopping",key:"c",targetEntity:l})}return n}const wD={id:Wd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i,a=i.deltaTime*(Ct/Dt);if(n.age+=a,n.age>=n.lifespan)return{nextState:Ul,data:{...e,enteredAt:s.time,previousState:Wd}};const l=Ep(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return zn(l,s,15)||ic(s.entities,l,s.time),{nextState:Mr,data:{...e,enteredAt:s.time,previousState:Wd}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},RD={id:Ul,update:e=>({nextState:Ul,data:e}),onEnter:(e,t)=>(Qr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},PD=[WP,YP,wD,RD],mt="humanIdle",Nr="humanMoving",Tl="humanEating",Sa="humanGathering",Nl="humanDepositing",Ml="humanRetrieving",br="humanProcreating",Jo="humanAttacking",Yd="humanPlanting",Hp="humanChopping",DD={id:mt,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:Jo,data:{...e,enteredAt:i.gameState.time,previousState:mt,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:(n.hunger>=gp?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:i.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:Nr,data:{...e,enteredAt:i.gameState.time,previousState:mt,target:n.target}}:n.activeAction==="gathering"?{nextState:Sa,data:{...e,enteredAt:i.gameState.time,previousState:mt,target:n.target}}:n.activeAction==="eating"?{nextState:Tl,data:{...e,enteredAt:i.gameState.time,previousState:mt}}:n.activeAction==="planting"&&n.target?{nextState:Yd,data:{...e,enteredAt:i.gameState.time,previousState:mt,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:Nl,data:{...e,enteredAt:i.gameState.time,previousState:mt}}:n.activeAction==="retrieving"?{nextState:Ml,data:{...e,enteredAt:i.gameState.time,previousState:mt}}:n.activeAction==="chopping"&&n.target?{nextState:Hp,data:{...e,enteredAt:i.gameState.time,previousState:mt,state:"chopping"}}:{nextState:mt,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function WI(e,t=1){let n=Fw;return e.hunger>=gp&&(n*=Lw),e.age>=Hw&&(n*=Gw),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const og=7.5;class ND{constructor(){Re(this,"id",Nr)}update(t,n){var S;const{entity:i,updateContext:s}=n;if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:Jo,data:{...t,enteredAt:s.gameState.time,previousState:Nr,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:Nr}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(S=n.updateContext.gameState.entities.entities[i.target])==null?void 0:S.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*og*2,y:i.position.y+i.direction.y*og*2}),!a)return{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:Nr}};const{width:l,height:d}=s.gameState.mapDimensions,u=U(i.position,a,l,d);if(u<og)return{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:Nr}};const f=Xe(i.position,a,l,d),g=ot(f);if(u>mS){const v=Eg(g,-jh),A=Eg(g,jh),I=[g,v,A],T=I.map((R,w)=>{const k=oi(i.position,At(R,mS)),M={x:(k.x%l+l)%l,y:(k.y%d+d)%d},D=$S(s.gameState.soilDepletion,M,l,d,pS),b=Math.cos(w===0?0:jh);return D*b});let P=0;for(let R=1;R<T.length;R++)T[R]>T[P]&&(P=R);i.direction=I[P]}else i.direction=g;const m=$S(s.gameState.soilDepletion,i.position,l,d,pS);return i.acceleration=WI(i,m),{nextState:Nr,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const MD=new ND,OD={id:Tl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:mt,data:{...e,enteredAt:i.gameState.time,previousState:Tl}}:(n.food.length>0&&(!n.eatingCooldownTime||i.gameState.time>=n.eatingCooldownTime)&&n.hunger>Qo&&(n.hunger=Math.max(0,n.hunger-Qo),n.food.pop(),n.eatingCooldownTime=i.gameState.time+1,Ne(i,_e.Eat,n.position),(!n.lastEatingEffectTime||i.gameState.time-n.lastEatingEffectTime>2)&&(Ge(i.gameState,Ce.Eating,n.position,Ke,n.id),n.lastEatingEffectTime=i.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:mt,data:{...e,enteredAt:i.gameState.time,previousState:Tl}}:{nextState:Tl,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class kD{constructor(){Re(this,"id",Sa)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const bD=new kD,BD={id:Nl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:mt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Nl}}:{nextState:Nl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},FD={id:Ml,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:mt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Ml}}:{nextState:Ml,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},LD=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),UD=(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time<(e.procreationEndTime||0))return{nextState:br,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<sn&&a.hunger<sn&&!n.procreationCooldown&&!a.procreationCooldown){const l=n.gender==="female"?n:a.gender==="female"?a:void 0,d=n.gender==="male"?n:a.gender==="male"?a:void 0;l&&d&&(l.isPregnant=!0,l.gestationTime=xw,l.pregnancyFatherId=d.id,n.procreationCooldown=yS,a.procreationCooldown=yS,Ne(i,_e.Procreate,l.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:mt,data:{...e,enteredAt:s.time,previousState:br}}},HD={id:br,onEnter:LD,update:UD},GD={id:Jo,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:mt,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:mt,data:{...e}};const i=U(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Xe(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=ot(s),i<=fo||i<=Sn&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=WI(t.entity),{nextState:Jo,data:e}}},$D={id:Yd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time-e.enteredAt>=Tw){const l=n.food.filter(u=>u.type===An.Berry).length,d=Ui(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(l>=uo&&!d){for(let u=0;u<uo;u++){const f=n.food.findIndex(g=>g.type===An.Berry);f>-1&&n.food.splice(f,1)}ic(s.entities,e.plantingSpot,s.time),HP(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:mt,data:{...e,enteredAt:s.time,previousState:Yd}}}return{nextState:Yd,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class xD{constructor(){Re(this,"id",Hp)}update(t,n){const{entity:i,updateContext:s}=n;return i.activeAction!=="chopping"||i.heldItem?{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const WD=new xD,YD=[DD,MD,OD,bD,BD,FD,HD,GD,$D,WD],pi="preyIdle",Wo="preyMoving",El="preyGrazing",Cl="preyProcreating",zD={id:pi,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Wo,data:{...e,enteredAt:i.gameState.time,previousState:pi,target:n.target}}:n.activeAction==="grazing"?{nextState:El,data:{...e,enteredAt:i.gameState.time,previousState:pi}}:n.activeAction==="procreating"?{nextState:Cl,data:{...e,enteredAt:i.gameState.time,previousState:pi}}:{nextState:pi,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},YI=12,jD=120,XS=50,XD=12,zI=30,VD=2,yn=50,KD=100,Ol=2,rg=3,qD=.9,ZD=1,QD=50,JD=.5,jI=20,eN=140,VS=40,tN=12,XI=40,nN=3,qo=60,mi=40,bs=50,KS=320,VI=25,iN=60,KI=2,oN=90,rN=.7,sN=1,kl=3,sg=15,Gp=80,qI=10,Uu=80,va=40,ZI=2,fu=30,Gs=20,Ur=40,$s=24,Hr=48,xs=12,Gr=40,Ws=20,$r=60,Ys=.75,zo=2.5,zs=.25,jo=2,QI=4;function aN(e){let t=XD;return e.isAdult||(t*=.7),e.hunger>=QD&&(t*=JD),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function lN(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),g=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function jl(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const ag=10;class cN{constructor(){Re(this,"id",Wo)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction!=="moving")return{nextState:pi,data:{...t,enteredAt:s.gameState.time,previousState:Wo}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*ag*2,y:i.position.y+i.direction.y*ag*2}),!a)return{nextState:pi,data:{...t,enteredAt:s.gameState.time,previousState:Wo}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=ot(l),i.acceleration=aN(i),U(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<ag?{nextState:pi,data:{...t,enteredAt:s.gameState.time,previousState:Wo}}:{nextState:Wo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const dN=new cN,uN={id:El,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Wo,data:{...e,enteredAt:i.gameState.time,previousState:El,target:n.target}}:n.activeAction!=="grazing"?{nextState:pi,data:{...e,enteredAt:i.gameState.time,previousState:El}}:{nextState:El,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},fN={id:Cl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Wo,data:{...e,enteredAt:i.gameState.time,previousState:Cl,target:n.target}}:n.activeAction!=="procreating"?{nextState:pi,data:{...e,enteredAt:i.gameState.time,previousState:Cl}}:{nextState:Cl,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},hN=[zD,dN,uN,fN],mn="predatorIdle",Go="predatorMoving",to="predatorAttacking",Bs="predatorProcreating",xr="predatorEating",gN={id:mn,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:xr,data:{...e,enteredAt:i.gameState.time,previousState:mn,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:to,data:{...e,enteredAt:i.gameState.time,previousState:mn,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction==="moving"?{nextState:Go,data:{...e,enteredAt:i.gameState.time,previousState:mn,target:n.target}}:n.activeAction==="procreating"?{nextState:Bs,data:{...e,enteredAt:i.gameState.time,previousState:mn}}:{nextState:mn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function JI(e){let t=tN;return e.hunger>=oN&&(t*=rN),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function pN(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),g=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function Xl(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const lg=12;class mN{constructor(){Re(this,"id",Go)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction==="eating")return{nextState:xr,data:{...t,enteredAt:s.gameState.time,previousState:Go,preyId:i.attackTargetId,eatingStartTime:s.gameState.time}};if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:to,data:{...t,enteredAt:s.gameState.time,previousState:Go,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:Go}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*lg*2,y:i.position.y+i.direction.y*lg*2}),!a)return{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:Go}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=ot(l),i.acceleration=JI(i),U(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<lg?{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:Go}}:{nextState:Go,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const yN=new mN,SN={id:to,update:(e,t)=>{const{entity:n,updateContext:i}=t;if(n.activeAction==="eating")return{nextState:xr,data:{...e,enteredAt:i.gameState.time,previousState:to,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:to}};const s=i.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:to}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:to}};const l=U(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),d=Xe(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return n.direction=ot(d),l>mi?n.acceleration=JI(n):n.acceleration=0,{nextState:to,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},vN={id:Bs,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:xr,data:{...e,enteredAt:i.gameState.time,previousState:Bs,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:to,data:{...e,enteredAt:i.gameState.time,previousState:Bs,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction!=="procreating"?{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:Bs}}:{nextState:Bs,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},AN={id:xr,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:xr}}:{nextState:xr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},IN=[gN,yN,SN,vN,AN],TN=24*30*10,er=24*5,EN=48,CN=72,ec=20,_N="#3b2016",wN="#5c3a21",RN="#376d31",PN="#76a331",DN="#a6c44a",NN="rgba(0, 0, 0, 0.25)",MN=60,ON=24*7,kN=.1,qS=1,Hu=5,bN={id:an,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.age>=n.lifespan?{nextState:Xr,data:{enteredAt:i.gameState.time,previousState:an}}:n.age>=er?{nextState:Kt,data:{enteredAt:i.gameState.time,previousState:an}}:{nextState:an,data:e}}},BN={id:Kt,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ct/Dt);return n.age>=n.lifespan?{nextState:Xr,data:{...e,enteredAt:i.gameState.time,previousState:Kt}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=ON&&(n.timeSinceLastSpreadAttempt=0,Math.random()<kN)?{nextState:vn,data:{...e,enteredAt:i.gameState.time,previousState:Kt}}:{nextState:Kt,data:e})}},FN={id:vn,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(n.age>=n.lifespan)return{nextState:Xr,data:{...e,enteredAt:s.time,previousState:vn}};const a=Ep(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return zn(a,s,25)||Vl(s.entities,a,s.time),{nextState:Kt,data:{...e,enteredAt:s.time,previousState:vn}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},LN={id:Gt,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=EN?{nextState:co,data:{enteredAt:n.gameState.time,previousState:Gt}}:{nextState:Gt,data:e}}},UN={id:co,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=CN?{nextState:Xr,data:{enteredAt:n.gameState.time,previousState:co}}:{nextState:co,data:e}}},HN={id:Xr,update:e=>({nextState:Xr,data:e}),onEnter:(e,t)=>(Qr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},GN=[bN,BN,FN,LN,UN,HN],ZS=[...PD,...YD,...hN,...IN,...GN];function $N(e,t,n){const i=fw(e,ZS);if(!i)return gw(e),[e,t];const{nextState:s,data:a}=i.update(t,n);return hw(e,s)?[s,uw(i,s,a,n,ZS)]:[s,a]}function $p(e,t){return`${e},${t}`}const QS=Ct*10;function eT(e){return e%QS/QS}function tT(e){const t=eT(e);return(Math.cos(t*2*Math.PI)+1)/2}function xN(e){const t=eT(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function nT(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/no),gridY:Math.floor(s/no)}}function tr(e,t,n,i,s){const{gridX:a,gridY:l}=nT(t,i,s),d=$p(a,l),u=e.sectors[d],f=u?u.currentTemperature:JA,m=(tT(n)*2-1)*f1;return f+m}function WN(e){const{sectors:t}=e.temperature,{width:n,height:i}=e.mapDimensions,s=Math.ceil(n/no),a=Math.ceil(i/no);for(const d in t){const u=t[d];u.currentTemperature=u.baseTemperature}const l=Math.ceil(Fr/no);Object.values(e.entities.entities).forEach(d=>{if(d.type==="building"){const u=d;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const f=nT(u.position,n,i);for(let g=-l;g<=l;g++)for(let m=-l;m<=l;m++){const S=(f.gridX+m+s)%s,v=(f.gridY+g+a)%a,A=$p(S,v),I=t[A];if(I){const T={x:(S+.5)*no,y:(v+.5)*no},P=U(u.position,T,n,i);if(P<Fr){const R=c1*(1-P/Fr);I.currentTemperature+=R}}}}}})}function iT(e,t){const n={},i=Math.ceil(e/no),s=Math.ceil(t/no);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const d=$p(l,a);let u=JA;const f=a/s*10-5;u+=f,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),n[d]={baseTemperature:u,currentTemperature:u}}return{sectors:n}}function YN(e,t,n){var d;const{gameState:i}=t,s=n*(Ct/Dt);e.isAdult=e.age>=pp;const a=tr(i.temperature,e.position,i.time,i.mapDimensions.width,i.mapDimensions.height);if(a<lo){const u=(lo-a)*l1*s;e.hitpoints-=u}if(e.movementSlowdown&&i.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<rn){const u=1-e.hunger/rn*Jw,f=Qw*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+f)}if(e.hunger+=n*(sl/(Ct/Dt)),e.hunger>=rn)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-Qo);else{const u=eR*s;e.hitpoints-=u}if(e.age+=n/Eu,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((sl*Ww-sl)/(Ct/Dt)),(!e.lastPregnantEffectTime||i.time-e.lastPregnantEffectTime>xl*3)&&(Ge(i,Ce.Pregnant,e.position,xl,e.id),e.lastPregnantEffectTime=i.time),e.gestationTime<=0&&(Hk(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===ma&&(e.radius=_t):e.hunger+=n*((sl*Yw-sl)/(Ct/Dt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const f=i.entities.entities[e.motherId];f&&u.push(f)}if(e.fatherId){const f=i.entities.entities[e.fatherId];f&&u.push(f)}for(const f of u)if(f.age>=mp&&f.hunger>=Xw&&U(e.position,f.position,i.mapDimensions.width,i.mapDimensions.height)<=Vw){e.food.pop(),f.hunger=Math.max(0,f.hunger-Qo),e.feedParentCooldownTime=Kw;break}}let l;if(e.hitpoints<=0?a<lo?l="hypothermia":e.hunger>=rn?l="hunger":l="killed":e.age>=e.maxAge&&(l="oldAge"),l){if(e.leaderId===e.id){const u=jr(Dn(i,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeRole=ie.Leader,u.tribeControl=e.tribeControl??{roleWeights:{[ie.Leader]:0,[ie.Gatherer]:2,[ie.Planter]:2,[ie.Hunter]:2,[ie.Mover]:2,[ie.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}};const f=i;ou(i,e.id,u.id);const g=f.search.human.byProperty("leaderId",e.id);for(const v of g)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const m=f.search.building.byProperty("ownerId",e.id);for(const v of m)v.ownerId=u.id;for(const v of du(u,i))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const S=Ou(i).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of S){const A=i.entities.entities[v.leaderId];if((d=A==null?void 0:A.tribeControl)!=null&&d.diplomacy){const I=A.tribeControl.diplomacy[e.id];I!==void 0&&(A.tribeControl.diplomacy[u.id]=I,delete A.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=jr(Dn(i,e));u?(u.isPlayer=!0,i.generationCount++):(i.gameOver=!0,i.causeOfGameOver=l,$l(i,{identifier:"no_heir",type:zr.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}Fk(i.entities,e.position,e.gender,e.age,e.radius,e.id,i.time,e.food,e.hunger),Qr(i.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function zN(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/qw);const i=Math.floor(OA*(1-e.decayProgress));e.food.length>i&&e.food.splice(i),e.decayProgress>=1&&e.food.length<=0&&Qr(t.gameState.entities,e.id)}function jN(e,t,n){const i=n*(Ct/Dt);e.age+=n/Eu,e.isAdult=e.age>=Ol;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=jD){const l=QI*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};l.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,l.x)),l.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,l.y));const d=Math.random()<.5?"male":"female",u=e,f=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let g;if(f)g=lN(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}ha(t.gameState.entities,l,d,0,zI*.5,g,e.id,e.fatherId,e.aiType),Ge(t.gameState,Ce.Procreation,e.position,xl,e.id),Ne(t,_e.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=i,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=YI&&(a=!0),a&&(Lk(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Qr(t.gameState.entities,e.id))}function XN(e,t,n){const i=n*(Ct/Dt);e.age+=n/Eu,e.isAdult=e.age>=kl;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=eN){const l=QI*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};l.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,l.x)),l.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,l.y));const d=Math.random()<.5?"male":"female",u=e,f=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let g;if(f)g=pN(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}ga(t.gameState.entities,l,d,0,XI*.6,g,e.id,e.pregnancyFatherId,e.aiType),Ge(t.gameState,Ce.Procreation,e.position,xl,e.id),Ne(t,_e.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=i,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=i,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=jI&&(a=!0),a&&(Uk(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Qr(t.gameState.entities,e.id))}var $t=(e=>(e[e.BehaviorTreeBased=0]="BehaviorTreeBased",e[e.TaskBased=1]="TaskBased",e))($t||{});const Fi=24,Gu=2,xp=3;function xt(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}function VN(e,t){if(!e.aiBlackboard)return;const n=e.aiBlackboard.data,i=[];for(const s in n)if(s.startsWith("tribal_")){const a=n[s];a&&typeof a=="object"&&"startTime"in a&&t-a.startTime>Fi&&i.push(s)}for(const s of i)C.delete(e.aiBlackboard,s)}const tc="tribe_logistics_demands",KN=8;function rr(e){return C.get(e,tc)||[]}function oT(e,t,n,i){const s=rr(e),a=s.find(l=>l.requesterId===t&&l.resourceType===n);if(a)a.updatedAt=i;else{const l={requesterId:t,resourceType:n,updatedAt:i};s.push(l)}C.set(e,tc,s)}function qN(e,t,n,i,s){const a=rr(e),l=a.find(d=>d.requesterId===t&&d.resourceType===n);return l&&!l.claimedBy?(l.updatedAt=s,l.claimedBy=i,C.set(e,tc,a),!0):!1}function ZN(e){return rr(e).filter(n=>!n.claimedBy).sort((n,i)=>n.updatedAt-i.updatedAt)}function rT(e,t,n){let i=rr(e);i=i.filter(s=>!(s.requesterId===t&&s.resourceType===n)),C.set(e,tc,i)}function sT(e,t,n){return rr(e).find(s=>s.requesterId===t&&s.resourceType===n)}function QN(e,t){let n=rr(e);n=n.filter(i=>t-i.updatedAt<=KN),C.set(e,tc,n)}function Wp(e,t,n){const i=xt(e,t.gameState);i&&i.id===e.id&&i.aiBlackboard&&(VN(i,t.gameState.time),QN(i.aiBlackboard,t.gameState.time)),n.execute(e,t,e.aiBlackboard)}const JS="Human Behavior",JN=1;class eM{constructor(){Re(this,"nodeData",new Map);Re(this,"pathStack",[]);Re(this,"startTimeStack",[])}nodeStart(t){this.pathStack.push(t),this.startTimeStack.push(performance.now())}nodeEnd(){if(this.startTimeStack.length===0||this.pathStack.length===0){console.error("BTProfiler: nodeEnd() called without a matching nodeStart().");return}const t=performance.now(),n=this.startTimeStack.pop(),i=t-n,s=this.pathStack.join(" > "),a=this.nodeData.get(s)??{path:s,totalTime:0,callCount:0,minTime:1/0,maxTime:-1/0};a.totalTime+=i,a.callCount++,a.minTime=Math.min(a.minTime,i),a.maxTime=Math.max(a.maxTime,i),this.nodeData.set(s,a),this.pathStack.pop()}report(t={}){const{showAll:n=!1}=t,i=Array.from(this.nodeData.values());if(i.length===0){console.log("--- Behavior Tree Profiler: No data collected. ---");return}let s=i,a="--- Behavior Tree Full Report ---";if(!n){const d=this.nodeData.get(JS);if(d){const u=d.totalTime*JN/100;s=i.filter(f=>f.totalTime>u&&f.path!==JS),a="--- Behavior Tree Problem Report ---"}else console.log('BTProfiler: Root node "Human Behavior" not found. Showing full report.'),a="--- Behavior Tree Full Report (Root Not Found) ---"}const l=s.sort((d,u)=>u.totalTime-d.totalTime);console.log(a),l.length>0?console.table(l.map(d=>({Path:d.path,"Total Time (ms)":d.totalTime.toFixed(3),Calls:d.callCount,"Avg Time (ms)":(d.totalTime/d.callCount).toFixed(3),"Min Time (ms)":d.minTime.toFixed(3),"Max Time (ms)":d.maxTime.toFixed(3)}))):console.log("No significant performance problems detected."),console.log("------------------------------------")}reset(){this.nodeData.clear(),this.pathStack=[],this.startTimeStack=[]}getNodeData(t){return this.nodeData.get(t)}}const rt=new eM;function Zt(e){return Array.isArray(e)?e:[e,""]}class Ie extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{for(const a of this.children){const[l,d]=Zt(a.execute(n,i,s));if(l!==E.SUCCESS)return this.setLastStatus(n,l),this.name&&C.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,d),l}return this.setLastStatus(n,E.SUCCESS),this.name&&C.recordNodeExecution(s,this.name,E.SUCCESS,i.gameState.time,this.depth,""),E.SUCCESS}finally{this.name&&rt.nodeEnd()}}}class ln extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const a=this.getRunningChildIndex(n)??0;for(let l=a;l<this.children.length;l++){const d=this.children[l],[u,f]=Zt(d.execute(n,i,s));if(u!==E.FAILURE){if(u===E.SUCCESS)return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,E.SUCCESS),this.name&&C.recordNodeExecution(s,this.name,E.SUCCESS,i.gameState.time,this.depth,f),E.SUCCESS;if(u===E.RUNNING)return this.setRunningChildIndex(n,l),this.setLastStatus(n,E.RUNNING),this.name&&C.recordNodeExecution(s,this.name,E.RUNNING,i.gameState.time,this.depth,f),E.RUNNING}}return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,E.FAILURE),this.name&&C.recordNodeExecution(s,this.name,E.FAILURE,i.gameState.time,this.depth,""),E.FAILURE}finally{this.name&&rt.nodeEnd()}}}class ev extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{let a=!0;for(const d of this.children){const[u,f]=Zt(d.execute(n,i,s));u===E.FAILURE&&(a=!1),this.name&&C.recordNodeExecution(s,this.name,u,i.gameState.time,this.depth,f)}const l=a?E.SUCCESS:E.FAILURE;return this.setLastStatus(n,l),l}finally{this.name&&rt.nodeEnd()}}}class ae extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.action=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=Zt(this.action(n,i,s));return this.setLastStatus(n,a),this.name&&C.recordNodeExecution(s,this.name,a,i.gameState.time,this.depth,l),a}finally{this.name&&rt.nodeEnd()}}}class he extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.condition=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=Zt(this.condition(n,i,s)),d=a?E.SUCCESS:E.FAILURE;return this.setLastStatus(n,d),this.name&&C.recordNodeExecution(s,this.name,d,i.gameState.time,this.depth,l),d}finally{this.name&&rt.nodeEnd()}}}class tM extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=Zt(this.child.execute(n,i,s));let d;switch(a){case E.SUCCESS:d=E.FAILURE;break;case E.FAILURE:d=E.SUCCESS;break;case E.RUNNING:default:d=a;break}return this.setLastStatus(n,d),this.name&&C.recordNodeExecution(s,this.name,d,i.gameState.time,this.depth,l),d}finally{this.name&&rt.nodeEnd()}}}class nM extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[,a]=Zt(this.child.execute(n,i,s)),l=E.SUCCESS;return this.setLastStatus(n,l),this.name&&C.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,a),l}finally{this.name&&rt.nodeEnd()}}}class Or extends Nn{constructor(n,i,s,a=0){super();Re(this,"name");Re(this,"depth");Re(this,"startTimeKey");this.child=n,this.timeoutDurationHours=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.startTimeKey=`timeout_${this.name}_startTime`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time;let l=C.get(s,this.startTimeKey);const[d,u]=Zt(this.child.execute(n,i,s));if(d===E.RUNNING){l===void 0&&(C.set(s,this.startTimeKey,a),l=a);const f=a-l;if(f>this.timeoutDurationHours){C.delete(s,this.startTimeKey),this.setLastStatus(n,E.FAILURE);const m=`Timed out after ${f.toFixed(2)}h.`;return C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m),this.getLastStatus(n)}this.setLastStatus(n,E.RUNNING);const g=`Running for ${f.toFixed(2)}h. ${u}`;return C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}return l!==void 0&&C.delete(s,this.startTimeKey),this.setLastStatus(n,d),C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class Hn extends Nn{constructor(n,i,s,a=0,l){super();Re(this,"name");Re(this,"depth");Re(this,"statusKey");Re(this,"timestampKey");this.child=n,this.cacheDurationHours=i,this.validityCheck=l,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.statusKey=`caching_${this.name}_status`,this.timestampKey=`caching_${this.name}_timestamp`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time,l=C.get(s,this.statusKey),d=C.get(s,this.timestampKey);if(l!==void 0&&d!==void 0){const m=a-d>this.cacheDurationHours,S=this.validityCheck?this.validityCheck(n,i,s):!0;if(!m&&S){const v=(d+this.cacheDurationHours-a).toFixed(2),A=`Cache hit. Status: ${E[l]}. ${v}h left.`;return this.setLastStatus(n,l),C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,A),this.getLastStatus(n)}}const[u,f]=Zt(this.child.execute(n,i,s));(u===E.SUCCESS||u===E.FAILURE)&&(C.set(s,this.statusKey,u),C.set(s,this.timestampKey,a)),this.setLastStatus(n,u);const g=`Cache miss. Child returned ${E[u]}. ${f}`;return C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class Aa extends Nn{constructor(n,i,s,a=0){super();Re(this,"name");Re(this,"depth");Re(this,"cooldownKey");this.cooldownDurationHours=n,this.child=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.cooldownKey=`cooldown_${this.name}`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time,l=C.get(s,this.cooldownKey);if(this.child.getLastStatus(n)===E.RUNNING){const[f,g]=Zt(this.child.execute(n,i,s));if(this.setLastStatus(n,f),this.name){const m=`Continuing running child. ${g}`;C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m)}return this.getLastStatus(n)}if(l!==void 0&&a<l){const g=`Cooldown active, ${(l-a).toFixed(2)}h left`;return this.setLastStatus(n,E.FAILURE),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}const[d,u]=Zt(this.child.execute(n,i,s));return d===E.SUCCESS&&C.set(s,this.cooldownKey,a+this.cooldownDurationHours),this.setLastStatus(n,d),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class Pn extends Nn{constructor(n,i,s,a=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.behaviorKey=i,this.name=s,this.depth=a;const l=(d,u)=>{d.depth=u,d.children?d.children.forEach(f=>l(f,u+1)):d.child&&l(d.child,u+1)};l(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer&&!i.gameState.autopilotControls.behaviors[this.behaviorKey]){const u=`Player autopilot for '${this.behaviorKey}' is disabled.`;return this.setLastStatus(n,E.FAILURE),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,u),this.getLastStatus(n)}const[l,d]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,l),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,d),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class iM extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,d)=>{l.depth=d,l.children?l.children.forEach(u=>a(u,d+1)):l.child&&a(l.child,d+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer&&i.gameState.autopilotControls.isManuallyMoving)return this.setLastStatus(n,E.FAILURE),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Manual movement active, AI blocked."),this.getLastStatus(n);const[a,l]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class _s extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,d)=>{l.depth=d,l.children?l.children.forEach(u=>a(u,d+1)):l.child&&a(l.child,d+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer)return this.setLastStatus(n,E.FAILURE),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Player controlled, AI blocked."),this.getLastStatus(n);const[a,l]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class Hi extends Nn{constructor(n,i,s,a=0){super();Re(this,"name");Re(this,"depth");Re(this,"registeredKey");this.child=n,this.config=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.registeredKey=`${this.name}_registered`}execute(n,i,s){rt.nodeStart(this.name);try{const a=xt(n,i.gameState);if(!a||!a.aiBlackboard){const[A,I]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,A),C.recordNodeExecution(s,this.name,A,i.gameState.time,this.depth,`No coordination: ${I}`),A}const l=i.gameState.time,d=C.get(s,this.registeredKey)??!1,u=this.getTaskTarget(n,i,s);if(!u)return this.setLastStatus(n,E.FAILURE),C.recordNodeExecution(s,this.name,E.FAILURE,l,this.depth,"No task target found"),E.FAILURE;const f=this.getTaskKey(u);if(d){const[A,I]=Zt(this.child.execute(n,i,s));return A===E.RUNNING?(this.refreshTaskTimestamp(a.aiBlackboard,f,n.id,l),this.setLastStatus(n,A),C.recordNodeExecution(s,this.name,A,l,this.depth,`Continuing: ${I}`),A):(this.removeFromTask(a.aiBlackboard,f,n.id),C.delete(s,this.registeredKey),this.setLastStatus(n,A),C.recordNodeExecution(s,this.name,A,l,this.depth,`Completed: ${I}`),A)}if(!this.canJoinTask(a.aiBlackboard,f,n.id,l)){this.setLastStatus(n,E.FAILURE);const A=C.get(a.aiBlackboard,f),I=(A==null?void 0:A.memberIds.length)??0,T=this.config.maxCapacity??1;return C.recordNodeExecution(s,this.name,E.FAILURE,l,this.depth,`Task full: ${I}/${T}`),E.FAILURE}if(!this.registerTask(a.aiBlackboard,f,n.id,l))return this.setLastStatus(n,E.FAILURE),C.recordNodeExecution(s,this.name,E.FAILURE,l,this.depth,"Failed to register task"),E.FAILURE;C.set(s,this.registeredKey,!0);const[S,v]=Zt(this.child.execute(n,i,s));if(S===E.RUNNING){this.setLastStatus(n,S);const A=C.get(a.aiBlackboard,f),I=(A==null?void 0:A.memberIds.length)??0,T=this.config.maxCapacity??1;return C.recordNodeExecution(s,this.name,S,l,this.depth,`Started (${I}/${T}): ${v}`),S}else return this.removeFromTask(a.aiBlackboard,f,n.id),C.delete(s,this.registeredKey),this.setLastStatus(n,S),C.recordNodeExecution(s,this.name,S,l,this.depth,`Immediate result: ${v}`),S}finally{rt.nodeEnd()}}getTaskTarget(n,i,s){var l,d,u,f;if(this.config.taskType==="procreation")return((d=(l=this.config).getTargetId)==null?void 0:d.call(l,n,i,s))??null;const a=(f=(u=this.config).getTargetId)==null?void 0:f.call(u,n,i,s);return a??null}getTaskKey(n){return this.config.generateTaskKey?this.config.generateTaskKey(this.config.taskType,n):`tribal_${this.config.taskType}_${n}`}canJoinTask(n,i,s,a){const l=C.get(n,i);if(!l||a-l.startTime>Fi||l.memberIds.includes(s))return!0;const d=this.config.maxCapacity??1;return l.memberIds.length<d}registerTask(n,i,s,a){let l=C.get(n,i);return l?a-l.startTime>Fi?(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},C.set(n,i,l),!0):l.memberIds.length>=(this.config.maxCapacity??1)?!!l.memberIds.includes(s):(l.memberIds.includes(s)||(l.memberIds.push(s),C.set(n,i,l)),!0):(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},C.set(n,i,l),!0)}refreshTaskTimestamp(n,i,s,a){const l=C.get(n,i);l&&l.memberIds.includes(s)&&(l.startTime=a,C.set(n,i,l))}removeFromTask(n,i,s){const a=C.get(n,i);a&&(a.memberIds=a.memberIds.filter(l=>l!==s),a.memberIds.length===0?C.delete(n,i):C.set(n,i,a))}}function oM(e){return new Ie([new he((t,n)=>{const i=t.hunger>=ca,s=t.food.length>0,a=!t.eatingCooldownTime||n.gameState.time>=t.eatingCooldownTime;return[!!(i&&s&&a),`${Math.floor(t.hunger-ca)}, ${t.food.length}, ${t.eatingCooldownTime?Math.floor(t.eatingCooldownTime-n.gameState.time):""}`]},"Can Eat",e+1),new ae(t=>(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",E.RUNNING),"Eat",e+1)],"Eating",e)}function Yn(e,t,n){return $u(e,n)?e.tribeRole===t:!0}function $u(e,t){if(!e.leaderId)return!1;const n=t.entities.entities[e.leaderId];return!n||!n.tribeControl?!1:t.search.human.byProperty("leaderId",n.id).filter(s=>s.isAdult).length>=eD}function rM(e){return new Ie([new he((n,i)=>{if(!!!n.leaderId||!$u(n,i.gameState))return!1;const a=n.id===n.leaderId,l=Yn(n,ie.Warrior,i.gameState)||Yn(n,ie.Hunter,i.gameState),d=!n.isAdult&&(!n.fatherId||!i.gameState.entities.entities[n.fatherId])&&(!n.motherId||!i.gameState.entities.entities[n.motherId]);return a||l||d},"Demand eligible?",e+1),new ae((n,i)=>{const s=xt(n,i.gameState);if(!s||!s.aiBlackboard)return[E.NOT_EVALUATED,"No leader for coordination"];if(n.food.length<n.maxFood*.5){oT(s.aiBlackboard,n.id,"food",i.gameState.time);const a=sT(s.aiBlackboard,n.id,"food");if(a&&a.claimedBy){const l=i.gameState.entities.entities[a.claimedBy];if(!l||l.type!=="human")return[E.NOT_EVALUATED,"Supplier not found or invalid"];const d=U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return d>sR?[E.NOT_EVALUATED,`Supplier too far (${d.toFixed(1)}px), waiting`]:d<=ze?(n.activeAction="retrieving",n.target=l.id,[E.RUNNING,`Retrieving from supplier ${l.id}`]):(n.target=l.id,n.activeAction="moving",[E.RUNNING,`Moving to supplier ${l.id}, distance: ${d.toFixed(1)}`])}return[E.NOT_EVALUATED,"Waiting for supplier"]}return[E.NOT_EVALUATED,"No demand needed"]},"Create Demand",e+1)],"Demand",e)}const Yp=400,sM=25;function tv(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function aM(e,t,n=Yp){return t.search.building.byRadius(e.position,n).some(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed&&l.storageCapacity&&l.storedItems.length<l.storageCapacity})}function lM(e,t,n=Yp,i,s){return t.search.building.byRadius(e.position,n).filter(d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===e.leaderId&&u.isConstructed&&u.storedItems.filter(f=>f.item.itemType==="food").length>0}).filter(d=>{if(i){const u=`tribal_storage_${d.id}`,f=C.get(i,u);if(f&&f.memberIds.length>=xp&&(!s||!f.memberIds.includes(s)))return!1}return!0})}function cM(e,t,n=Yp){return t.search.building.byRadius(e.position,n).filter(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed})}function aT(e,t,n){if(t.length===0)return null;let i=null,s=1/0;for(const a of t){const l=U(e.position,a.position,n.mapDimensions.width,n.mapDimensions.height);l<s&&(s=l,i=a)}return i?{storage:i,distance:s}:null}function lT(e){const t=e.storedItems.length,n=tv(t+e.id)*2*Math.PI,i=tv(t+e.id+1)*sM;return{x:Math.cos(n)*i,y:Math.sin(n)*i}}const nv="FINDING_DEMAND",iv="RETRIEVING_FROM_STORAGE",ov="DELIVERING_TO_DEMANDER",zd="supply_phase",jg="supply_targetDemanderId",cT="supply_targetStorageId",jd="supply_targetResourceType";function Di(e){e.aiBlackboard&&(C.delete(e.aiBlackboard,zd),C.delete(e.aiBlackboard,jg),C.delete(e.aiBlackboard,cT),C.delete(e.aiBlackboard,jd))}function dM(e){return new ae((t,n)=>{var a;if(!$u(t,n.gameState))return Di(t),[E.FAILURE,"Tribe roles not effective"];if(!Yn(t,ie.Mover,n.gameState))return Di(t),[E.FAILURE,"Not a Mover"];const i=xt(t,n.gameState);if(!i||!i.aiBlackboard)return Di(t),[E.FAILURE,"No leader or blackboard"];if(!t.aiBlackboard)return[E.FAILURE,"No AI blackboard"];const s=C.get(t.aiBlackboard,zd)||nv;if(s===nv){const l=ZN(i.aiBlackboard).filter(f=>f.requesterId!==t.id);if(l.length===0)return[E.FAILURE,"No unclaimed demands"];const d=l[0];return qN(i.aiBlackboard,d.requesterId,d.resourceType,t.id,n.gameState.time)?(C.set(t.aiBlackboard,jg,d.requesterId),C.set(t.aiBlackboard,jd,d.resourceType),C.set(t.aiBlackboard,zd,iv),[E.RUNNING,`Claimed ${d.resourceType} demand for ${d.requesterId}, moving to retrieval phase`]):(Di(t),[E.FAILURE,"Failed to claim demand"])}if(s===iv){const l=C.get(t.aiBlackboard,jd),d=l==="food"&&t.food.length>0,u=l==="wood"&&((a=t.heldItem)==null?void 0:a.type)===yt.Wood;if(d||u)return C.set(t.aiBlackboard,zd,ov),[E.RUNNING,`${l} retrieved, moving to delivery phase`];const f=cM(t,n.gameState,400).filter(v=>l==="food"?v.storedItems.some(A=>A.item.itemType==="food"):l==="wood"?v.storedItems.some(A=>A.item.type===yt.Wood):!1);if(f.length===0)return[E.FAILURE,`No storage with ${l} found nearby`];const g=aT(t,f,n.gameState);if(!g)return Di(t),[E.FAILURE,"Could not find closest storage"];const{storage:m,distance:S}=g;return C.set(t.aiBlackboard,cT,m.id),S<=qt?(t.activeAction="retrieving",t.target=m.id,[E.RUNNING,`Retrieving from storage ${m.id}`]):(t.target=m.id,t.activeAction="moving",[E.RUNNING,`Moving to storage ${m.id}, distance: ${S.toFixed(1)}`])}if(s===ov){const l=C.get(t.aiBlackboard,jd)||"food",d=C.get(t.aiBlackboard,jg);if(!d)return Di(t),[E.FAILURE,"Demander ID not found in blackboard"];const u=sT(i.aiBlackboard,d,l);if(!u||u.claimedBy!==t.id)return Di(t),[E.FAILURE,"Demand not found"];const f=n.gameState.entities.entities[d];if(!f)return Di(t),[E.FAILURE,"Demander not found"];if(l==="food"?t.food.length===0:!t.heldItem)return Di(t),[E.SUCCESS,`Successfully delivered ${l} to ${d}`];const m=U(t.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),S=f.type==="building"&&f.buildingType===le.Bonfire?qt:ze;return m<=S?(t.activeAction="depositing",l==="food"&&(t.activeActionPayload={amount:Math.min(f.maxFood/2||1,t.food.length||1)}),t.target=f.id,[E.RUNNING,`Delivering to demander ${f.id}`]):(t.target=f.id,t.activeAction="moving",[E.RUNNING,`Moving to demander ${f.id}, distance: ${m.toFixed(1)}`])}return Di(t),[E.FAILURE,"Unknown supply phase"]},"Supply",e)}function uM(e){return new Ie([new he((t,n,i)=>{if(t.isAdult&&t.hitpoints>t.maxHitpoints*nu||!(t.hitpoints<t.maxHitpoints*.1)&&t.isAdult&&t.hunger>IR)return!1;const a=ZA(t.id,n.gameState);return a?(C.set(i,"fleeThreat",a.id),!0):!1},"Should Flee",e+1),new ae((t,n,i)=>{const s=C.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;t.activeAction="moving";const l=Xe(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=ot(l),u=oi(t.position,At(d,Bg));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=d,E.RUNNING},"Execute Flee",e+1)],"Flee",e)}const Er="resourceSource";function fM(e){const t=new ae((i,s,a)=>{const l=xt(i,s.gameState),d=l?Yl(l.id,s.gameState):0,u=i.hunger>AS,f=Dn(s.gameState,i).filter(I=>I.hunger>sa),g=u||f.length>0,m=Yn(i,ie.Gatherer,s.gameState),S=()=>{const I=be(i,s.gameState,"berryBush",Xh,P=>{if(P.food.length===0||i.leaderId&&!Wn(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${P.id}`,w=C.get(l.aiBlackboard,R);if(w&&s.gameState.time-w.startTime<=Fi&&!w.memberIds.includes(i.id))return!1}return!0}),T=be(i,s.gameState,"corpse",Xh,P=>{if(P.food.length===0||i.leaderId&&!Wn(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${P.id}`,w=C.get(l.aiBlackboard,R);if(w&&s.gameState.time-w.startTime<=Fi&&!w.memberIds.includes(i.id))return!1}return!0});if(I&&T){const P=U(i.position,I.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height),R=U(i.position,T.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);return P<=R?I:T}return I||T},v=()=>be(i,s.gameState,"tree",Xh,I=>{if(I.stateMachine[0]!==Gt||I.wood.length===0||i.leaderId&&!Wn(I.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const T=`tribal_gather_${I.id}`,P=C.get(l.aiBlackboard,T);if(P&&s.gameState.time-P.startTime<=Fi&&!P.memberIds.includes(i.id))return!1}return!0});let A=null;return g&&i.food.length<i.maxFood?A=S():d>0&&!i.heldItem?A=v():m&&(i.heldItem||(A=v()),!A&&i.food.length<i.maxFood&&(A=S())),A?(C.set(a,Er,A.id),[E.SUCCESS,`Found ${A.type}: ${A.id} at ${A.position.x.toFixed(0)},${A.position.y.toFixed(0)}`]):[E.FAILURE,"No resource found"]},"Find Closest Resource Source",e+4),n=new Hi(new ae((i,s,a)=>{const l=C.get(a,Er);if(!l)return[E.FAILURE,"No target in blackboard"];const d=s.gameState.entities.entities[l];return d?(d.type==="tree"&&"wood"in d?d.wood.length===0:d.food.length===0)?(C.delete(a,Er),[E.FAILURE,"Resource source is depleted"]):U(i.position,d.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Yr?(i.activeAction="gathering",i.direction={x:0,y:0},i.target=d.id,C.delete(a,Er),[E.SUCCESS,`Gathering from ${d.type}`]):(i.activeAction="moving",i.target=d.id,i.direction=$e(i.position,d.position,s.gameState.mapDimensions),[E.RUNNING,`Moving to ${d.type}`]):(C.delete(a,Er),[E.FAILURE,"Resource source is invalid"])},"Move To Resource and Gather",e+3),{taskType:"gather",maxCapacity:2,getTargetId:(i,s,a)=>C.get(a,Er)??null},"Tribal Gather Task",e+3);return new Ie([new he((i,s)=>{const a=xt(i,s.gameState),l=a?Yl(a.id,s.gameState):0,d=i.food.length<i.maxFood,u=!i.heldItem,f=i.hunger>AS,g=Dn(s.gameState,i).filter(I=>I.hunger>sa),m=Yn(i,ie.Gatherer,s.gameState),S=aM(i,s.gameState),v=d&&(f||g.length>0||m&&S),A=u&&(l>0||m&&S);return[(i.isAdult&&(v||A))??!1,`${f?"Hungry ":""}${g.length>0?"Children("+g.length+") ":""}${l>0?"WoodNeed("+l+") ":""}${A&&l<=0?"Wood ":""}${S?"Storage":""}`]},"Should Gather Resources",e+1),new ln([new Ie([new he((i,s,a)=>C.has(a,Er),"Has Resource Source?",e+2),n],"Continue Gathering Action",e+2),new Ie([new Hn(t,wR,"Cache Resource Source Search",e+3),n],"Find New Resource Source and Gather",e+2)],"Perform or Start Gathering",e+1)],"Gather Resources",e)}const hM=.5;function gM(e){return new ae((t,n,i)=>{const{gameState:s}=n,{width:a,height:l}=s.mapDimensions;let d=C.get(i,"wanderTarget");const u=C.get(i,"lastWanderTime")??0,f=s.time;if(!d||f-u>hM||U(t.position,d,a,l)<20){const m=Ep(t.position,yR,a,l);t.leaderId?Ug(m,t.leaderId,s)?d=m:d=o1(t.position,m,t.leaderId,s):d=m,C.set(i,"wanderTarget",d),C.set(i,"lastWanderTime",f)}if(d&&U(t.position,d,a,l)>10){t.activeAction="moving",t.target=d;let S=d.x-t.position.x,v=d.y-t.position.y;return Math.abs(S)>a/2&&(S=S>0?S-a:S+a),Math.abs(v)>l/2&&(v=v>0?v-l:v+l),t.direction=ot({x:S,y:v}),E.RUNNING}return t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,E.SUCCESS},"Idle/Wander",e)}const Cd="procreationWanderStartTime",rv=(e,t,n)=>t.find(i=>or(e,i,n)),sv={taskType:"procreation",maxCapacity:2,getTargetId:(e,t,n)=>C.get(n,"procreationPartner")??null};function pM(e){const t=new he((a,l,d)=>{const u=HS(a,l.gameState,Yr),f=rv(a,u,l.gameState);return f?(C.set(d,"procreationPartner",f.id),!0):[!1,"No immediate partner found"]},"Find Immediate Partner"),n=new Hi(new ae((a,l,d)=>{var g;const u=C.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=void 0,C.delete(d,"procreationPartner"),C.delete(d,Cd),(g=a.partnerIds)!=null&&g.includes(f.id)||(a.partnerIds=a.partnerIds?[...a.partnerIds,f.id]:[f.id]),E.SUCCESS):E.FAILURE},"Start Procreating"),sv,"Tribal Start Procreating",e+2),i=new he((a,l,d)=>{const u=HS(a,l.gameState,AR),f=rv(a,u,l.gameState);return f?(C.set(d,"procreationPartner",f.id),!0):[!1,"No distant partner found"]},"Locate Distant Partner"),s=new Hi(new ae((a,l,d)=>{const u=C.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return[E.FAILURE,"No partner found"];if(f.isPregnant)return[E.FAILURE,"Partner is pregnant"];if(a.hunger>sn)return[E.FAILURE,"Too hungry to procreate"];const g=U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);if(g<Yr)return[E.SUCCESS,"Reached partner"];if(a.leaderId&&!Wn(f.position,a.leaderId,l.gameState))return[E.FAILURE,"Partner out of operating range"];a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),[E.RUNNING,`${g.toFixed(1)} units away`]},"Move Towards Partner"),sv,"Tribal Move To Partner",e+3);return new Ie([new he(a=>!a.isAdult||a.gender==="female"&&a.isPregnant?[!1,"Not adult or pregnant"]:a.age<Gl||a.gender==="female"&&a.age>_u?[!1,"Not fertile due to age or pregnancy status"]:a.hunger>=sn?[!1,"Too hungry"]:!0,"Is Fertile (age, not pregnant)",e+1),new he(a=>a.hunger<sn,"Is Healthy (hunger)",e+1),new he(a=>(a.procreationCooldown||0)<=0,"Is Ready (cooldown)",e+1),new ln([new Ie([new he((a,l)=>{const d=RS(a.position,l.gameState,"berryBush",IS);return[d>=vR,`Found ${d} bushes`]},"Is Environment Viable (food)",e+3),new ae((a,l,d)=>(C.delete(d,Cd),E.SUCCESS),"Clear Wander Timer",e+3)],"Sufficient Food Path",e+2),new Ie([new he((a,l)=>{const d=Dn(l.gameState,a);return jr(d)?[!1,"Has an heir"]:!0},"Is Male Without Heir",e+3),new ae((a,l,d)=>{const u=C.get(d,Cd);if(u===void 0)return C.set(d,Cd,l.gameState.time),[E.FAILURE,"Starting heirless wander timer"];const f=l.gameState.time-u;return f>=$w?RS(a.position,l.gameState,"berryBush",IS)>=1?[E.SUCCESS,`Wandered for ${f.toFixed(1)}h, minimum food found`]:[E.FAILURE,"Desperate but no food sources nearby"]:[E.FAILURE,`Wandering for heir, ${f.toFixed(1)}h elapsed`]},"Check Wander Timer",e+3)],"Heirless Desperation Path",e+2)],"Check Environment Or Desperation",e+1),new he((a,l,d)=>{var f;const u=C.get(d,"procreationPartner");return u&&((f=u.partnerIds)!=null&&f.length)&&!u.partnerIds.includes(a.id)&&a.leaderId!==a.id&&a.leaderId&&u.partnerIds.map(g=>l.gameState.entities.entities[g]).filter(g=>!!g).some(g=>U(a.position,g.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<LR)?[!1,"Partner's primary partner is too close"]:!0},"Is Partner's Primary Partner Nearby",e+1),new ln([new Ie([t,n],"Procreate With Immediate Partner",e+2),new Aa(CR,new Ie([i,s,n],"Seek Distant Partner Action",e+3),"Seek Distant Partner Cooldown",e+2)],"Find Partner And Procreate",e+1)],"Procreate",e)}const ws="attackTarget",Cr="homeCenter",cg=150;function mM(e){return new Ie([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.hitpoints>0&&U(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=cg){if(C.set(i,ws,l.id),!C.get(i,Cr)){const d=t.leaderId?$n(t.leaderId,s):Wl(t,s).length>0?vS(t,s):t.position;C.set(i,Cr,d)}return!0}}if(!Yn(t,ie.Warrior,s))return[!1,"Not a Warrior"];const a=be(t,s,"human",cg,l=>l.hitpoints>0&&qr(t,l,s));if(a){C.set(i,ws,a.id);const l=t.leaderId?$n(t.leaderId,s):Wl(t,s).length>0?vS(t,s):t.position;return C.set(i,Cr,l),!0}return C.set(i,ws,void 0),C.set(i,Cr,void 0),!1},"Find Attack Target",e+1),new ae((t,n,i)=>{const s=C.get(i,ws),a=s&&n.gameState.entities.entities[s],l=C.get(i,Cr);if(!a||!l)return E.FAILURE;const{gameState:d}=n;return U(t.position,l,d.mapDimensions.width,d.mapDimensions.height)>BA?(t.activeAction="idle",t.attackTargetId=void 0,C.set(i,ws,void 0),C.set(i,Cr,void 0),E.FAILURE):a.hitpoints<=0||U(t.position,a.position,d.mapDimensions.width,d.mapDimensions.height)>cg?(t.activeAction==="attacking"&&(t.activeAction="idle",t.attackTargetId=void 0),C.set(i,ws,void 0),C.set(i,Cr,void 0),E.SUCCESS):(t.activeAction==="attacking"&&t.attackTargetId===a.id||(t.activeAction="attacking",t.attackTargetId=a.id),E.RUNNING)},"Execute Attack",e+1)],"Attack",e)}const yM=(e,t,n)=>{const i=Dn(t.gameState,e).filter(l=>!l.isAdult);if(i.length===0)return E.FAILURE;let s=null,a=sa;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(C.set(n,"targetChild",s.id),E.SUCCESS):E.FAILURE},SM=(e,t,n)=>{const i=C.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>wu?(e.activeAction="moving",e.target=s.id,e.direction=$e(e.position,s.position,t.gameState.mapDimensions),E.RUNNING):(e.activeAction="feeding",e.target=void 0,C.set(n,"targetChild",void 0),E.SUCCESS):E.FAILURE};function vM(e){return new Ie([new he(t=>(t.isAdult&&t.food.length>0&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child",e+1),new ae(yM,"Find Hungriest Child",e+1),new ae(SM,"Move To Child and Feed",e+1)],"Feed Child",e)}function AM(e){return new Ie([new he(t=>!t.isAdult&&t.hunger>=sa,"Is Hungry Child",e+1),new ae((t,n,i)=>{const s=EP(t,n.gameState);if(s.length===0)return E.FAILURE;const a=be(t,n.gameState,"human",jw,l=>s.some(d=>d.id===l.id)&&l.food.length>0);return a?(C.set(i,"targetParent",a.id),E.SUCCESS):E.FAILURE},"Find Parent With Food",e+1),new ae((t,n,i)=>{const s=C.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=wu?(t.target=void 0,E.SUCCESS):(t.target=a.id,t.activeAction="moving",E.RUNNING)},"Move To Parent",e+1)],"Seek Food From Parent",e)}const _r="plantingSpot",Rs="plantingZoneId",IM=50;function TM(e,t,n,i){const s=Xe(e,t,n,i);return oi(e,s)}function EM(e){const t=new ae((s,a,l)=>{const d=C.get(l,_r);if(!d)return C.delete(l,_r),C.delete(l,Rs),[E.FAILURE,"Planting spot is missing"];if(Ui(a.gameState.soilDepletion,d,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height))return C.delete(l,_r),C.delete(l,Rs),[E.FAILURE,"Soil is depleted at planting spot"];if(zn(d,a.gameState,Zo,s.id))return C.delete(l,_r),C.delete(l,Rs),[E.FAILURE,"Planting spot is occupied"];const u=TM(s.position,d,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height),f=U(s.position,u,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height);return f>Yr?(s.activeAction="moving",s.target=u,s.direction=$e(s.position,u,a.gameState.mapDimensions),[E.RUNNING,"Moving to planting spot: "+f.toFixed(2)+" units away"]):zn(d,a.gameState,Zo,s.id)?(C.delete(l,_r),C.delete(l,Rs),[E.FAILURE,"Planting spot is now occupied"]):(s.activeAction="planting",s.target=d,[E.RUNNING,"Planting state initiated"])},"Move To Spot and Plant",e+4),n=new Hi(t,{taskType:"plant",maxCapacity:2,proximityRadius:IM,getTargetId:(s,a,l)=>C.get(l,Rs)??null},"Coordinated Planting",e+3),i=new ae((s,a,l)=>{const d=LP(s,a.gameState);return d?(C.set(l,_r,d.position),C.set(l,Rs,d.zoneId),[E.SUCCESS,`Found new spot at ${d.position.x.toFixed(0)}, ${d.position.y.toFixed(0)} (Zone ${d.zoneId})`]):[E.FAILURE,"No suitable planting spot found"]},"Find Optimal Planting Spot",e+3);return new Ie([new he((s,a)=>{if(!Yn(s,ie.Planter,a.gameState))return[!1,"Not a Planter"];const l=s.food.filter(f=>f.type===An.Berry).length>=uo,d=s.hunger<gR,u=(s.isAdult&&l&&d)??!1;return[u,u?"Can plant":`Cannot plant: adult=${s.isAdult}, berries=${s.food.filter(f=>f.type===An.Berry).length}/${uo}, hunger=${s.hunger.toFixed(0)}`]},"Can Plant",e+1),new he((s,a)=>{if(!s.leaderId)return[!1,"No tribe"];const l=NP(s,a.gameState),{count:d,ratio:u}=EI(s.leaderId,a.gameState);let f;return l<LA?f=HR:l<UA?f=GR:l<HA?f=$R:f=xR,[u<f||d<=Hs,`Food security: ${(l*100).toFixed(0)}%, Bush density: ${u.toFixed(1)}/${f}`]},"Needs More Bushes (Adaptive)",e+1),new he((s,a)=>{if(!s.leaderId)return[!0,"No tribe coordination needed"];const l=jn(s,a.gameState),d=wI(s.leaderId,a.gameState,"planting"),u=Math.max(1,Math.ceil(l.length*.3));return[d<u,`Active planters: ${d}/${u}`]},"Not Too Many Planters",e+1),new ln([new Ie([new he((s,a,l)=>C.has(l,_r),"Has Planting Spot?",e+2),n],"Continue Planting Action",e+2),new Aa(_R,i,"Find Planting Spot Cooldown",e+2)],"Perform or Start Planting",e+1)],"Plant Bush",e)}const av="lastDepositTime",Ps="assignedStorageSpot";function CM(e){return new ln([new Ie([new he((t,n,i)=>{var d;const s=((d=t.heldItem)==null?void 0:d.type)===yt.Wood;if(!t.isAdult)return[!1,"Not an adult"];if(!t.leaderId)return[!1,"No tribe"];let a=null,l="";if(s)a=FP(t,n.gameState),l=`Holding wood${a?` (Target: ${a.id})`:""}`;else{if(!Yn(t,ie.Gatherer,n.gameState)&&!Yn(t,ie.Mover,n.gameState)&&!Yn(t,ie.Hunter,n.gameState))return[!1,"Not a Gatherer/Mover/Hunter and not holding wood"];const u=C.get(i,av)||0,f=n.gameState.time-u;if(f<TS)return[!1,`Cooldown: ${(TS-f).toFixed(1)}h remaining`];const g=II(t.leaderId,n.gameState);let m;g<.3?m=WR:g<.7?m=YR:m=zR;const S=t.food.length/t.maxFood;if(S<=m)return[!1,`Food ${(S*100).toFixed(0)}% < threshold ${(m*100).toFixed(0)}%`];a=_I(t,n.gameState),l=`Storage util: ${(g*100).toFixed(0)}%, Personal: ${(S*100).toFixed(0)}%`}return a?(C.set(i,Ps,a.id),[!0,l]):[!1,"No available tribe storage nearby"]},"Check for Excess Food and Storage",e+1),new he((t,n)=>{if(!t.leaderId)return[!0,"No tribe coordination needed"];const i=wI(t.leaderId,n.gameState,"depositing"),s=jn(t,n.gameState),a=fa(t.leaderId,n.gameState).length,l=Math.max(2,Math.ceil(s.length*.4)+a);return[i<l,`Active depositors: ${i}/${l}`]},"Not Too Many Depositors",e+1),new Hi(new ae((t,n,i)=>{var d,u;const s=C.get(i,Ps);if(!s)return[E.FAILURE,"No storage assigned"];const a=n.gameState.entities.entities[s];if(!a)return C.delete(i,Ps),[E.FAILURE,"Storage entity missing"];if((((d=a.storedItems)==null?void 0:d.length)??0)>=(a.storageCapacity??0))return C.delete(i,Ps),[E.FAILURE,"Storage full"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l<=qt){t.activeAction="depositing",t.target=void 0,C.set(i,av,n.gameState.time),C.delete(i,Ps);const f=((u=t.heldItem)==null?void 0:u.type)===yt.Wood;return[E.SUCCESS,f?"Depositing wood":"Depositing food"]}return t.activeAction="moving",t.target=a.position,[E.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`]},"Navigate to Storage and Deposit",e+2),{taskType:"storage",maxCapacity:xp,storageAction:"deposit",getTargetId:(t,n,i)=>C.get(i,Ps)??null},"Tribal Storage Deposit Task",e+1)],"Deposit Sequence",e)],"Storage Deposit Behavior",e)}const _d="retrievalStorageId";function _M(e){return new ln([new Ie([new he((t,n,i)=>{if(t.hunger<=ca)return[!1,"Not hungry enough"];if(t.food.length>=t.maxFood)return[!1,"Inventory full"];const s=xt(t,n.gameState),a=lM(t,n.gameState,void 0,s==null?void 0:s.aiBlackboard,t.id),l=aT(t,a,n.gameState),d=l==null?void 0:l.storage;return d?(C.set(i,_d,d.id),[!0,`Storage with food found at distance ${l.distance.toFixed(1)}`]):[!1,"No tribe storage with food nearby"]},"Check for Hunger and Storage Food",e+1),new Hi(new ae((t,n,i)=>{const s=C.get(i,_d);if(!s)return[E.FAILURE,"No storage target"];const a=n.gameState.entities.entities[s];if(!a)return C.delete(i,_d),[E.FAILURE,"Storage not found"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=qt?(t.activeAction="retrieving",t.target=void 0,[E.SUCCESS,"Retrieving food"]):(t.activeAction="moving",t.target=a.position,[E.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`])},"Navigate to Storage and Retrieve",e+2),{taskType:"storage",maxCapacity:xp,storageAction:"retrieve",getTargetId:(t,n,i)=>C.get(i,_d)??null},"Coordinated Storage Retrieve",e+1)],"Retrieve Sequence",e)],"Storage Retrieve Behavior",e)}const dg="combatTarget",ug="homeCenter";function wM(e){const t=new he(a=>a.isAdult&&a.leaderId?a.id!==a.leaderId:!1,"Is Tribe Follower?",e+1),n=new he(a=>a.hunger<pR&&a.hitpoints>=a.maxHitpoints*nu,"Is Fit for Combat?",e+1),i=new ae((a,l,d)=>{const{gameState:u}=l,f=u.entities.entities[a.leaderId];if(!f)return E.FAILURE;const g=XP(f,u,TR);if(g.length===0)return E.FAILURE;g.sort((m,S)=>{const v=U(a.position,m.position,u.mapDimensions.width,u.mapDimensions.height),A=U(a.position,S.position,u.mapDimensions.width,u.mapDimensions.height);return v-A});for(const m of g)if(VP(f.id,m.id,u)<bA){C.set(d,dg,m.id);const v=$n(f.id,u);return C.set(d,ug,v),E.SUCCESS}return E.FAILURE},"Find Best Target",e+1),s=new ae((a,l,d)=>{const u=C.get(d,dg),f=u&&l.gameState.entities.entities[u],g=C.get(d,ug);if(!f||!g)return E.FAILURE;const{gameState:m}=l;return U(a.position,g,m.mapDimensions.width,m.mapDimensions.height)>BA?(a.activeAction==="attacking"&&a.attackTargetId===f.id&&(a.activeAction="idle",a.attackTargetId=void 0),C.set(d,dg,void 0),C.set(d,ug,void 0),E.FAILURE):((!a.lastTargetAcquiredEffectTime||l.gameState.time-a.lastTargetAcquiredEffectTime>Ke*5)&&(Ge(l.gameState,Ce.TargetAcquired,a.position,Ke,a.id),a.lastTargetAcquiredEffectTime=l.gameState.time),a.activeAction="attacking",a.attackTargetId=f.id,a.target=void 0,E.RUNNING)},"Attack Target",e+1);return new Ie([t,n,i,s],"Tribe Member Combat",e)}function RM(e){const t=new he((M,D)=>!M.leaderId||M.leaderId!==M.id?[!1,"Not a tribe leader"]:Dn(D.gameState,M).length<Op?[!1,"Leader has no children"]:[!0,"Is tribe leader"],"Is Leader",e+1),n=new ae((M,D,N)=>{const b=jn(M,D.gameState),H=b.filter(X=>X.isAdult),z=ya(M.leaderId,D.gameState,!0),V=ku(M,D.gameState,!0).filter(X=>bP(X,D.gameState)),j=II(M.leaderId,D.gameState),{count:ee,ratio:ne}=EI(M.leaderId,D.gameState),Se=V.length/Math.max(1,b.length),ce=Math.ceil(H.length*(1+XR)),oe=fa(M.leaderId,D.gameState,!0);return C.set(N,"tribeAnalysis_adultCount",H.length),C.set(N,"tribeAnalysis_existingStorageSpots",z.length),C.set(N,"tribeAnalysis_existingPlantingZones",V.length),C.set(N,"tribeAnalysis_existingBonfires",oe.length),C.set(N,"tribeAnalysis_storageUtilization",j),C.set(N,"tribeAnalysis_bushCount",ee),C.set(N,"tribeAnalysis_bushDensity",ne),C.set(N,"tribeAnalysis_zoneDensity",Se),C.set(N,"tribeAnalysis_projectedAdultCount",ce),[E.SUCCESS,`Analyzed tribe: ${H.length} adults, ${z.length} storage, ${V.length} viable planting zones, ${oe.length} bonfires`]},"Analyze Tribe",e+1),i=new Hn(n,1,"Cached Tribe Analysis",e+1),s=new he((M,D,N)=>{const b=C.get(N,"tribeAnalysis_adultCount");return b===void 0?[!1,"No tribe analysis available"]:b<ES?[!1,`Tribe too small: ${b}/${ES} adults`]:[!0,`Tribe size sufficient: ${b} adults`]},"Has Minimum Tribe Size",e+1),a=new he((M,D,N)=>{if(C.has(N,"buildingPlacement_storageTarget"))return[!0,"Placement already in progress"];const b=C.get(N,"tribeAnalysis_adultCount"),H=C.get(N,"tribeAnalysis_existingStorageSpots"),z=C.get(N,"tribeAnalysis_storageUtilization"),V=C.get(N,"tribeAnalysis_projectedAdultCount");if(b===void 0||H===void 0||z===void 0||V===void 0)return[!1,"No tribe analysis available"];const j=H===0,ee=z*(V/Math.max(1,b));return j||z>Fg||ee>Fg?[!0,j?"Bootstrap: First storage spot":`Utilization: ${(z*100).toFixed(0)}% (projected: ${(ee*100).toFixed(0)}%)`]:[!1,`Storage adequate: ${H}, util: ${(z*100).toFixed(0)}%`]},"Needs Storage",e+2),l=new ae((M,D,N)=>{if(C.has(N,"buildingPlacement_storageTarget"))return[E.SUCCESS,"Using existing storage placement target"];const b=C.get(N,"tribeAnalysis_existingStorageSpots");if(b===void 0)return[E.FAILURE,"No tribe analysis available"];const z=b===0?GA:qs,V=Zs(le.StorageSpot,M.id,D.gameState,Ji,z,M.position);return V?(C.set(N,"buildingPlacement_storageTarget",V),[E.SUCCESS,`Found storage location at (${V.x.toFixed(0)}, ${V.y.toFixed(0)})`]):[E.FAILURE,`No valid location found for storage within ${Ji}px`]},"Find Storage Location",e+2),d=new ae((M,D,N)=>{const b=C.get(N,"buildingPlacement_storageTarget");if(!b)return[E.FAILURE,"No target location in blackboard"];const H=U(M.position,b,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return H<=eo?[E.SUCCESS,`Reached storage location (${H.toFixed(0)}px away)`]:(M.activeAction="moving",M.target=b,M.direction=$e(M.position,b,D.gameState.mapDimensions),[E.RUNNING,`Moving to storage location (${H.toFixed(0)}px away)`])},"Move To Storage Location",e+2),u=new ae((M,D,N)=>{const b=C.get(N,"buildingPlacement_storageTarget");if(!b)return[E.FAILURE,"No target location in blackboard"];const H=U(M.position,b,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return H>eo?[E.FAILURE,`Too far from placement location: ${H.toFixed(0)}px`]:(Ko(b,le.StorageSpot,M.id,D.gameState),C.delete(N,"buildingPlacement_storageTarget"),C.delete(N,"caching_Cached Tribe Analysis_status"),C.delete(N,"caching_Cached Tribe Analysis_timestamp"),delete N.nodeExecutionData["Cached Tribe Analysis"],[E.SUCCESS,`Placed storage at (${b.x.toFixed(0)}, ${b.y.toFixed(0)})`])},"Place Storage",e+2),f=new Ie([a,l,d,u],"Storage Sequence",e+1),g=new he((M,D,N)=>{if(!M.leaderId)return[!1,"No tribe"];if(C.has(N,"buildingPlacement_bonfireTarget"))return[!0,"Placement already in progress"];const b=C.get(N,"tribeAnalysis_existingBonfires")||0,H=C.get(N,"tribeAnalysis_adultCount")||0,z=$n(M.leaderId,D.gameState),V=tr(D.gameState.temperature,z,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height),j=V<tI&&b===0,ee=b>0&&b<Math.ceil(H/nI),ne=jn(M,D.gameState),Se=fa(M.leaderId,D.gameState,!0),ce=ne.filter(X=>tr(D.gameState.temperature,X.position,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)<lo+5?Se.every(Y=>U(X.position,Y.position,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)>Fr*1.5):!1),oe=ce.length>=3;if(j||ee||oe){if(oe){const q=ce.reduce((Z,F)=>({x:Z.x+F.position.x,y:Z.y+F.position.y}),{x:0,y:0});q.x/=ce.length,q.y/=ce.length,C.set(N,"buildingPlacement_coldClusterPos",q)}else C.delete(N,"buildingPlacement_coldClusterPos");let X="";return j?X=`Cold at center: ${V.toFixed(1)}C`:ee?X=`Tribe size: ${H}/${b} fires`:X=`Cold cluster: ${ce.length} members`,[!0,X]}return[!1,`Adequate heating: ${b} fires for ${H} adults`]},"Needs Bonfire",e+2),m=new ae((M,D,N)=>{if(C.has(N,"buildingPlacement_bonfireTarget"))return[E.SUCCESS,"Using existing bonfire placement target"];const b=C.get(N,"buildingPlacement_coldClusterPos"),H=Zs(le.Bonfire,M.id,D.gameState,Ji,qs,b||M.position);return H?(C.set(N,"buildingPlacement_bonfireTarget",H),[E.SUCCESS,`Found bonfire location at (${H.x.toFixed(0)}, ${H.y.toFixed(0)})`]):[E.FAILURE,`No valid location found for bonfire within ${Ji}px`]},"Find Bonfire Location",e+2),S=new ae((M,D,N)=>{const b=C.get(N,"buildingPlacement_bonfireTarget");if(!b)return[E.FAILURE,"No target location in blackboard"];const H=U(M.position,b,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return H<=eo?[E.SUCCESS,`Reached bonfire location (${H.toFixed(0)}px away)`]:(M.activeAction="moving",M.target=b,M.direction=$e(M.position,b,D.gameState.mapDimensions),[E.RUNNING,`Moving to bonfire location (${H.toFixed(0)}px away)`])},"Move To Bonfire Location",e+2),v=new ae((M,D,N)=>{const b=C.get(N,"buildingPlacement_bonfireTarget");if(!b)return[E.FAILURE,"No target location in blackboard"];const H=U(M.position,b,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return H>eo?[E.FAILURE,`Too far from placement location: ${H.toFixed(0)}px`]:(Ko(b,le.Bonfire,M.id,D.gameState),C.delete(N,"buildingPlacement_bonfireTarget"),C.delete(N,"caching_Cached Tribe Analysis_status"),C.delete(N,"caching_Cached Tribe Analysis_timestamp"),delete N.nodeExecutionData["Cached Tribe Analysis"],[E.SUCCESS,`Placed bonfire at (${b.x.toFixed(0)}, ${b.y.toFixed(0)})`])},"Place Bonfire",e+2),A=new Ie([g,m,S,v],"Bonfire Sequence",e+1),I=new he((M,D,N)=>{if(C.has(N,"buildingPlacement_plantingTarget"))return[!0,"Placement already in progress"];const b=C.get(N,"tribeAnalysis_adultCount"),H=C.get(N,"tribeAnalysis_existingPlantingZones"),z=C.get(N,"tribeAnalysis_bushDensity"),V=C.get(N,"tribeAnalysis_bushCount"),j=C.get(N,"tribeAnalysis_zoneDensity"),ee=C.get(N,"tribeAnalysis_projectedAdultCount");if(b===void 0||H===void 0||z===void 0||V===void 0||j===void 0||ee===void 0)return[!1,"No tribe analysis available"];const ne=z*(b/Math.max(1,ee)),ce=H===0||z<Lg||ne<Lg||V<=Hs&&H<=Hs;return ce&&j>ne&&(V>Hs||H>Hs)?[!1,`Planting zone density (${j.toFixed(2)}) exceeds projected density (${ne.toFixed(2)})`]:ce?[!0,`Low bush density: ${z.toFixed(1)}, count: ${V}/${H} (projected: ${ne.toFixed(1)})`]:[!1,`Planting zones adequate: ${H}, density: ${z.toFixed(1)}`]},"Needs Planting Zone",e+2),T=new ae((M,D,N)=>{if(C.has(N,"buildingPlacement_plantingTarget"))return[E.SUCCESS,"Using existing planting zone placement target"];const b=Zs(le.PlantingZone,M.id,D.gameState,Ji,qs,M.position);return b?(C.set(N,"buildingPlacement_plantingTarget",b),[E.SUCCESS,`Found planting zone location at (${b.x.toFixed(0)}, ${b.y.toFixed(0)})`]):[E.FAILURE,`No valid location found for planting zone within ${Ji}px`]},"Find Planting Zone Location",e+2),P=new ae((M,D,N)=>{const b=C.get(N,"buildingPlacement_plantingTarget");if(!b)return[E.FAILURE,"No target location in blackboard"];const H=U(M.position,b,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return H<=eo?[E.SUCCESS,`Reached planting zone location (${H.toFixed(0)}px away)`]:(M.activeAction="moving",M.target=b,M.direction=$e(M.position,b,D.gameState.mapDimensions),[E.RUNNING,`Moving to planting zone location (${H.toFixed(0)}px away)`])},"Move To Planting Zone Location",e+2),R=new ae((M,D,N)=>{const b=C.get(N,"buildingPlacement_plantingTarget");if(!b)return[E.FAILURE,"No target location in blackboard"];const H=U(M.position,b,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return H>eo?[E.FAILURE,`Too far from placement location: ${H.toFixed(0)}px`]:(Ko(b,le.PlantingZone,M.id,D.gameState),C.delete(N,"buildingPlacement_plantingTarget"),C.delete(N,"caching_Cached Tribe Analysis_status"),C.delete(N,"caching_Cached Tribe Analysis_timestamp"),delete N.nodeExecutionData["Cached Tribe Analysis"],[E.SUCCESS,`Placed planting zone at (${b.x.toFixed(0)}, ${b.y.toFixed(0)})`])},"Place Planting Zone",e+2),w=new Ie([I,T,P,R],"Planting Zone Sequence",e+1),k=new ln([f,A,w],"Building Type Selector",e+1);return new Ie([t,i,s,k],"Leader Building Placement",e)}const Bo="takeOverBuildingTarget";function PM(e){const t=new Ie([new he((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=C.get(s,Bo);if(a){const d=i.gameState.entities.entities[a];if(d&&d.type==="building"&&Vt(n,d,i.gameState))return[!0,`Continuing to target building ${a}`];C.delete(s,Bo)}const l=be(n,i.gameState,"building",xA,d=>Vt(n,d,i.gameState)&&d.isConstructed);return l?(C.set(s,Bo,l.id),[!0,`Found enemy building at distance ${U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Take Over",e+2),new ae((n,i,s)=>{const a=C.get(s,Bo);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(C.delete(s,Bo),n.activeAction="idle",n.target=void 0,E.FAILURE):U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<ze?(n.activeAction="idle",n.target=void 0,E.SUCCESS):(n.activeAction="moving",n.target=l.id,E.RUNNING)},"Move to Enemy Building",e+2),new ae((n,i,s)=>{const a=C.get(s,Bo);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(C.delete(s,Bo),E.FAILURE):(n.activeAction="takingOverBuilding",n.target=l.id,C.delete(s,Bo),E.SUCCESS)},"Initiate Building Takeover",e+2)],"Take Over Building Action",e+1);return new Aa($A,t,"Take Over Building Cooldown",e)}const lv=2,DM=40,cv=3;function NM(e){const t=new he(a=>{if(!a.isAdult)return[!1,"Not an adult"];if(a.hunger>gp)return[!1,`Too hungry (${a.hunger.toFixed(1)})`];const l=a.leaderId===a.id,d=a.tribeRole===ie.Warrior;return!l&&!d?[!1,`Not a Warrior or Leader (role: ${a.tribeRole||"none"})`]:[!0,l?"Is Leader":"Is Warrior"]},"Is Warrior or Leader",e+1),n=new he(a=>{var d,u;if(a.leaderId!==a.id)return[!0,"Warrior follows leader strategy"];const l=((u=(d=a.tribeControl)==null?void 0:d.armyControl)==null?void 0:u.expandBorders)??0;return l<lv?[!1,`Expand borders weight too low: ${l}/${lv}`]:[!0,`Expand borders weight: ${l}`]},"Has Expand Borders Weight",e+1),i=new he((a,l)=>{if(!a.leaderId)return[!1,"No tribe leader"];const u=l.gameState.search.building.byProperty("ownerId",a.leaderId);return u.length===0?[!1,"No territory to expand"]:[!0,`Tribe has ${u.length} buildings`]},"Has Territory",e+1),s=new ae((a,l,d)=>{if(!a.leaderId)return[E.FAILURE,"No leader"];const u=l.gameState,f=u.mapDimensions.width,g=u.mapDimensions.height,m=qA(a.position,a.leaderId,u);if(!m)return[E.FAILURE,"Could not find territory edge"];const S=U(a.position,m,f,g);if(S>DM)return a.activeAction="moving",a.target=m,[E.RUNNING,`Approaching territory edge (${S.toFixed(0)}px)`];const A=u.search.building.byProperty("ownerId",a.leaderId),I=Kd(A.map(b=>b.position));C.get(d,"pioneerOrbitDirection")===void 0&&C.set(d,"pioneerOrbitDirection",1);const T=Math.ceil(f/Le),P=Math.ceil(g/Le),R=t1(a.position),w=[];for(let b=-3;b<=cv;b++)for(let H=-3;H<=cv;H++){if(H===0&&b===0)continue;const z=((R.x+H)%T+T)%T,V=((R.y+b)%P+P)%P,j=V*T+z,ee=u.terrainOwnership[j],ne=ee!==null&&ir(a.leaderId,ee,u);if(ee!==null&&!ne)continue;const Se={x:z*Le+Le/2,y:V*Le+Le/2};jA(Se,a.leaderId,u,np,!0,a.leaderId).canPlace&&w.push({pos:Se,gx:z,gy:V})}if(w.length===0)return C.set(d,"pioneerOrbitDirection",-C.get(d,"pioneerOrbitDirection")),[E.RUNNING,"Blocked, reversing orbit direction"];const k=ot(Xe(I,a.position,f,g)),M=Eg(k,C.get(d,"pioneerOrbitDirection")*(Math.PI/2));let D=w[0],N=-1/0;for(const b of w){let H=0;for(let ce=-1;ce<=1;ce++)for(let oe=-1;oe<=1;oe++){if(oe===0&&ce===0)continue;const X=((b.gx+oe)%T+T)%T,q=((b.gy+ce)%P+P)%P;u.terrainOwnership[q*T+X]===a.leaderId&&H++}const z=ot(Xe(a.position,b.pos,f,g)),V=xv(z,M),j=U(I,b.pos,f,g),ee=U(I,a.position,f,g),ne=j>ee?1:0,Se=H*2+V*1.5+ne*.5;Se>N&&(N=Se,D=b)}return Ko(a.position,le.BorderPost,a.leaderId,u),a.target=D.pos,a.activeAction="moving",[E.RUNNING,"Expanding territory (cell-based)"]},"Pioneer Expansion",e+1);return new Ie([t,n,i,s],"Border Expansion",e)}const Fo="removeEnemyBuildingTarget";function MM(e){const t=new Ie([new he((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=C.get(s,Fo);if(a){const d=i.gameState.entities.entities[a];if(d&&d.type==="building"&&Vt(n,d,i.gameState))return[!0,`Continuing to target building ${a}`];C.delete(s,Fo)}const l=be(n,i.gameState,"building",xA,d=>Vt(n,d,i.gameState)&&d.isConstructed);return l?(C.set(s,Fo,l.id),[!0,`Found enemy building at distance ${U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Destroy",e+2),new ae((n,i,s)=>{const a=C.get(s,Fo);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(C.delete(s,Fo),n.activeAction="idle",n.target=void 0,E.FAILURE):U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<ze?(n.activeAction="idle",n.target=void 0,E.SUCCESS):(n.activeAction="moving",n.target=l.id,E.RUNNING)},"Move to Enemy Building",e+2),new ae((n,i,s)=>{const a=C.get(s,Fo);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(C.delete(s,Fo),E.FAILURE):(n.activeAction="destroyingBuilding",n.target=l.id,C.delete(s,Fo),E.SUCCESS)},"Initiate Building Destruction",e+2)],"Remove Enemy Building Action",e+1);return new Aa($A,t,"Remove Enemy Building Cooldown",e)}function OM(e){return new Ie([new ae((t,n,i)=>{const s=xg(t,n.gameState);return s?(C.set(i,"patriarchTarget",s.id),[E.SUCCESS,`Found patriarch: ${s.id}`]):(C.delete(i,"patriarchTarget"),[E.FAILURE,"No patriarch found"])},"Find Patriarch",e+1),new ae((t,n,i)=>{const s=C.get(i,"patriarchTarget"),a=s&&n.gameState.entities.entities[s];if(!a)return[E.FAILURE,"Patriarch target missing from blackboard"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l>SR){t.activeAction="moving",t.target=a.id;const d=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(d),[E.RUNNING,`Moving to patriarch at ${l.toFixed(0)}`]}return t.activeAction="idle",t.target=void 0,t.direction={x:0,y:0},[E.SUCCESS,`Arrived at patriarch at ${l.toFixed(0)}`]},"Move Towards Patriarch",e+1)],"Follow Patriarch",e)}function kM(e){const t=new ln([new Ie([new he((n,i)=>{if(!n.aiBlackboard)return[!1,"No blackboard"];if(!n.leaderId||n.leaderId===n.id)return[!1,"No tribe or the leader"];if(cu(n,i.gameState).id!==n.id)return[!1,"Not patriarch"];const a=Il(n.aiBlackboard);return a!=="idle"&&AD(n.aiBlackboard,i.gameState.time)?(Cs(n.aiBlackboard,"idle",i.gameState.time),[!1,"Phase timed out, reset to idle"]):[a==="idle",`Phase: ${a}`]},"Is Idle?",e+2),new ae((n,i)=>{if(!n.aiBlackboard)return E.FAILURE;const s=Lp(n,i.gameState);return s.canSplit&&s.strategy?(Cs(n.aiBlackboard,"planning",i.gameState.time),GI(n.aiBlackboard,s.strategy),E.SUCCESS):[E.FAILURE,s.reason||"Cannot split"]},"Check Split Conditions",e+2)],"Check Phase",e+1),new Ie([new he(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Il(n.aiBlackboard);return[i==="planning",`Phase: ${i}`]},"Is Planning?",e+2),new ae((n,i)=>n.aiBlackboard?UI(n,i.gameState)?(Cs(n.aiBlackboard,"gathering",i.gameState.time),E.SUCCESS):(Cs(n.aiBlackboard,"idle",i.gameState.time),E.FAILURE):E.FAILURE,"Plan Split Strategy",e+2)],"Planning Phase",e+1),new Ie([new he(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Il(n.aiBlackboard);return[i==="gathering",`Phase: ${i}`]},"Is Gathering?",e+2),new ae((n,i)=>{if(!n.aiBlackboard)return E.FAILURE;const[s,a]=SD(n,i.gameState);return s?(Cs(n.aiBlackboard,"executing",i.gameState.time),E.SUCCESS):[E.RUNNING,`Progress: ${a.toFixed(2)}`]},"Wait for Family to Gather",e+2)],"Gathering Phase",e+1),new Ie([new he(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Il(n.aiBlackboard);return[i==="executing",`Phase: ${i}`]},"Is Executing?",e+2),new ae((n,i)=>n.aiBlackboard?HI(n,i.gameState)?E.SUCCESS:(Cs(n.aiBlackboard,"idle",i.gameState.time),E.FAILURE):E.FAILURE,"Execute Tribe Split",e+2)],"Execution Phase",e+1)],"Tribe Split State Machine",e+1);return new Aa(qP,t,"Tribe Split Cooldown",e)}const wd="jealousyAttackTarget";function bM(e){return new Ie([new he((t,n,i)=>{var l,d;if(!t.isAdult)return[!1,"Not an adult"];if(t.gender!=="male")return[!1,"Not male"];const s=((d=(l=t.partnerIds)==null?void 0:l.map(u=>{var f;return(f=n.gameState.entities.entities[u])==null?void 0:f.pregnancyFatherId}))==null?void 0:d.filter(u=>!!u&&u!==t.id))??[],a=n.gameState.search.human.byRadius(t.position,OR).find(u=>s.includes(u.id));return a?t.leaderId&&a.id===t.leaderId?[!1,"Stranger is the tribe leader - no attack"]:(C.set(i,wd,a.id),[!0,`Partner cheating with ${a.id}`]):(C.delete(i,wd),!1)},"Check for Infidelity",e+1),new ae((t,n,i)=>{const s=C.get(i,wd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(C.delete(i,wd),[E.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?E.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[E.RUNNING,`Attacking ${a.id}`])},"Execute Jealousy Attack",e+1)],"Jealousy Attack",e)}const Rd="defendAggressor";function BM(e){return new Ie([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const s=zP(t,n.gameState,kR);return s?(C.set(i,Rd,s.aggressor.id),[!0,`Family member ${s.familyMember.id} attacked by ${s.aggressor.id}`]):(C.delete(i,Rd),!1)},"Check Family Under Attack",e+1),new ae((t,n,i)=>{const s=C.get(i,Rd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(C.delete(i,Rd),[E.FAILURE,"Target invalid/dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?E.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[E.RUNNING,`Attacking aggressor ${a.id}`])},"Execute Family Defense Attack",e+1)],"Defend Family",e)}const Pd="desperateAttackTarget";function FM(e){return new Ie([new he(t=>t.hunger>bR,"Is Starving",e+1),new he((t,n)=>{if(!t.isAdult)return[!1,"Not an adult"];const i=be(t,n.gameState,"berryBush",ze,a=>a.food.length>0),s=be(t,n.gameState,"corpse",ze,a=>a.food.length>0);return!i&&!s},"No Other Food Available",e+1),new he((t,n,i)=>{const s=jP(t,n.gameState);return s?(C.set(i,Pd,s.id),[!0,`Found weak target ${s.id}`]):(C.delete(i,Pd),!1)},"Find Weak Target",e+1),new ae((t,n,i)=>{const s=C.get(i,Pd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(C.delete(i,Pd),[E.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?E.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[E.RUNNING,`Desperately attacking ${a.id}`])},"Execute Desperate Attack",e+1)],"Desperate Attack",e)}function LM(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const a=U(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?Sn:fo;return a<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=s.id,t.direction=$e(t.position,s.position,e.mapDimensions),E.RUNNING)}function UM(e){return new Ie([new he((t,n)=>t.isPlayer===!0&&!!n.gameState.autopilotControls.activeAutopilotAction,"Has Player Command",e+1),new ae((t,n)=>{var a;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return E.FAILURE;switch(s.action){case re.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=s.position;return U(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<FA?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),E.SUCCESS):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),E.RUNNING)}case re.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;let d=!1;if(l.type==="berryBush")d=l.food.length===0;else if(l.type==="corpse")d=l.food.length===0;else if(l.type==="tree"){const f=l;d=f.stateMachine[0]!==Gt||f.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;return d?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Yr?(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),E.RUNNING):(t.activeAction="gathering",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS)}case re.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const[d]=l.stateMachine??[];return!(d===an||d===Kt||d===vn)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Zl?(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),E.RUNNING):(t.activeAction="chopping",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS)}case re.AutopilotAttack:return"targetEntityId"in s?LM(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE);case re.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||!or(t,l,n.gameState)?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),E.RUNNING)}case re.AutopilotPlant:{if(t.activeAction==="planting")return E.RUNNING;if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=s.position;return zn(l,i,Zo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(t.activeAction="planting",t.target=l,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,E.RUNNING):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),E.RUNNING)}case re.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),E.RUNNING)}case re.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l||l.buildingType!==le.StorageSpot&&l.buildingType!==le.Bonfire||!l.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const d=l.storageCapacity??0;if(l.storedItems.length>=d||t.leaderId!==l.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const f=t.food.length>0,g=!!t.heldItem;if(l.buildingType===le.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==yt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE}else if(!f&&!g)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;return U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),E.RUNNING)}case re.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.buildingType!==le.StorageSpot||!l.isConstructed||l.storedItems.length===0||t.leaderId!==l.ownerId||t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),E.RUNNING)}case re.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="takingOverBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),E.RUNNING)}case re.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="destroyingBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),E.RUNNING)}case re.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=s.position,d=s.buildingType;if(!d)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const u=U(t.position,l,i.mapDimensions.width,i.mapDimensions.height),f=100;return u<=f?da(l,d,t.leaderId,i,t.position,f)?(Ko(l,d,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",E.SUCCESS):(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),E.RUNNING)}default:return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE}},"Execute Player Command",e+1)],"Player Command Handler",e)}function HM(e){const t=new he(i=>i.id===i.leaderId,"Is Leader?",e+1),n=new ae((i,s)=>{var f,g,m,S,v,A;const{gameState:a}=s,l=Li(i.id,a),d=xS(l),u=Ou(a).filter(I=>I.leaderId!==i.id);for(const I of u){const T=Li(I.leaderId,a),P=xS(T),R=((g=(f=i.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[I.leaderId])||Ut.Friendly,w=a.entities.entities[I.leaderId];((S=(m=w==null?void 0:w.tribeControl)==null?void 0:m.diplomacy)==null?void 0:S[i.id])===Ut.Hostile||d>P*MR?R!==Ut.Hostile&&((v=i.tribeControl)!=null&&v.diplomacy)&&(i.tribeControl.diplomacy[I.leaderId]=Ut.Hostile):R!==Ut.Friendly&&((A=i.tribeControl)!=null&&A.diplomacy)&&(i.tribeControl.diplomacy[I.leaderId]=Ut.Friendly)}return E.SUCCESS},"Evaluate Diplomacy",e+2);return new Ie([t,new Aa(NR,n,"Diplomacy Cooldown",e+1)],"Manage Diplomacy",e)}const dl="huntTarget";function GM(e){return new Ie([new Hn(new he((n,i,s)=>{if(!n.isAdult)return[!1,"Not an adult"];if(!n.leaderId)return[!1,"Not in a tribe"];if(!Yn(n,ie.Hunter,i.gameState))return[!1,"Not a Hunter"];const a=be(n.position,i.gameState,"prey",mR,l=>!(n.leaderId&&!Wn(l.position,n.leaderId,i.gameState)));return a?(C.set(s,dl,a.id),[!0,"Found prey"]):[!1,"No suitable prey found"]},"Find Prey Target",e+2),DR,"Cache Find Prey",e+1),new Hi(new Or(new ae((n,i,s)=>{if(!n.leaderId)return E.FAILURE;const a=C.get(s,dl);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];if(!l||l.hitpoints<=0)return C.delete(s,dl),n.activeAction="idle",n.attackTargetId=void 0,E.SUCCESS;const{gameState:d}=i,u=$n(n.leaderId,d);return U(n.position,u,d.mapDimensions.width,d.mapDimensions.height)>kA?(C.delete(s,dl),n.activeAction="idle",n.attackTargetId=void 0,E.FAILURE):(n.activeAction="attacking",n.attackTargetId=l.id,E.RUNNING)},"Hunt Prey Action",e+3),Os,"Hunt Prey Timeout",e+2),{taskType:"hunt",maxCapacity:Gu,getTargetId:(n,i,s)=>C.get(s,dl)??null},"Tribal Hunt Task",e+1)],"Human Hunt Prey Sequence",e)}const Dd="defendTarget",fg=150;function $M(e){return new Ie([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult - children flee instead"];if(t.hitpoints<=t.maxHitpoints*.3)return[!1,"Too injured to defend"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.type==="predator"&&l.hitpoints>0&&U(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=fg)return C.set(i,Dd,l.id),[!0,"Continuing defense"]}const a=be(t,s,"predator",fg,l=>l.hitpoints>0&&(l.isAdult||!1));if(a){const l=U(t.position,a.position,s.mapDimensions.width,s.mapDimensions.height),d=a.attackTargetId===t.id,u=l<80;if(d||u)return C.set(i,Dd,a.id),[!0,"Predator threat detected"]}return C.set(i,Dd,void 0),[!1,"No predator threat"]},"Detect Predator Threat",e+1),new ae((t,n,i)=>{const s=C.get(i,Dd),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;const{gameState:l}=n,d=U(t.position,a.position,l.mapDimensions.width,l.mapDimensions.height);return t.hitpoints<t.maxHitpoints*.3?E.FAILURE:a.hitpoints<=0||d>fg*1.5?(t.activeAction="idle",t.attackTargetId=void 0,E.SUCCESS):(t.activeAction="attacking",t.attackTargetId=a.id,E.RUNNING)},"Defend Against Predator",e+1)],"Human Defend Against Predator",e)}function xM(e){const t=new ae((n,i)=>{if(!n.leaderId||!n.isAdult)return E.FAILURE;const s=i.gameState.entities.entities[n.leaderId];if(!s||!s.tribeControl)return E.FAILURE;if(n.id===s.id)return n.tribeRole!==ie.Leader&&(n.tribeRole=ie.Leader),E.SUCCESS;const l=jn(s,i.gameState).filter(I=>I.id!==s.id),d=l.length;if(d===0)return E.SUCCESS;const u=s.tribeControl.roleWeights;let f=0;const g=[];for(const I of Object.values(ie))I!==ie.Leader&&(f+=u[I]||0,g.push(I));if(f===0)return n.tribeRole||(n.tribeRole=ie.Gatherer),E.SUCCESS;const m={},S={},v={};for(const I of g)m[I]=0,S[I]=u[I]/f*d;for(const I of l)I.tribeRole&&I.tribeRole!==ie.Leader&&(m[I.tribeRole]=(m[I.tribeRole]||0)+1);for(const I of g)v[I]=S[I]-m[I];let A=!1;if((!n.tribeRole||n.tribeRole===ie.Leader||v[n.tribeRole]<-.5&&g.some(P=>v[P]>.5))&&(A=!0),A){let I=null,T=-1/0;const P=[...g].sort(()=>Math.random()-.5);for(const R of P){const w=v[R];w>T&&(T=w,I=R)}if(I)n.tribeRole=I;else{const R=Math.random()*f;let w=0;for(const k of g)if(w+=u[k],R<=w){n.tribeRole=k;break}}}return E.SUCCESS},"Assign Tribe Role",e+1);return new Hn(t,Us,"Cache Tribe Role Assignment",e)}const WM=5,YM=0,zM=10;function jM(e){return e<LA?{[ie.Leader]:0,[ie.Gatherer]:7,[ie.Planter]:2,[ie.Hunter]:1,[ie.Mover]:1,[ie.Warrior]:0}:e<UA?{[ie.Leader]:0,[ie.Gatherer]:5,[ie.Planter]:4,[ie.Hunter]:2,[ie.Mover]:2,[ie.Warrior]:1}:e<HA?{[ie.Leader]:0,[ie.Gatherer]:4,[ie.Planter]:3,[ie.Hunter]:3,[ie.Mover]:3,[ie.Warrior]:2}:{[ie.Leader]:0,[ie.Gatherer]:3,[ie.Planter]:3,[ie.Hunter]:4,[ie.Mover]:3,[ie.Warrior]:3}}function XM(e){if(e.length===0)return 0;let t=0,n=0;for(const i of e)t+=i.food.length,n+=i.maxFood;return n===0?0:t/n}function VM(e,t){return e<t?Math.min(e+1,zM):e>t?Math.max(e-1,YM):e}function KM(e){const t=new ae((n,i)=>{if(!n.leaderId||n.id!==n.leaderId||!n.tribeControl)return E.FAILURE;const s=jn(n,i.gameState);if(s.filter(m=>m.isAdult).length<WM)return E.FAILURE;const l=XM(s),d=jM(l),u=n.tribeControl.roleWeights;let f=!1;const g=[ie.Gatherer,ie.Planter,ie.Hunter,ie.Mover,ie.Warrior];for(const m of g){const S=u[m]||0,v=d[m],A=VM(S,v);A!==S&&(u[m]=A,f=!0)}if(f){const m=`Adjusted weights for food security: ${(l*100).toFixed(1)}%`;return[E.SUCCESS,m]}return E.FAILURE},"Manage Tribe Role Weights",e+1);return new Hn(t,Us,"Cache Role Management",e)}const wr="treeTarget";function qM(e){const t=new ae((i,s,a)=>{const l=xt(i,s.gameState),d=be(i,s.gameState,"tree",UR,u=>{const[f]=u.stateMachine??[];if(!(f===an||f===Kt||f===vn)||i.leaderId&&!Wn(u.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const m=`tribal_chop_${u.id}`,S=C.get(l.aiBlackboard,m);if(S&&s.gameState.time-S.startTime<=Fi&&!S.memberIds.includes(i.id))return!1}return!0});return d?(C.set(a,wr,d.id),[E.SUCCESS,`Found tree: ${d.id} at ${d.position.x.toFixed(0)},${d.position.y.toFixed(0)}`]):[E.FAILURE,"No tree found"]},"Find Closest Tree",e+4),n=new Hi(new ae((i,s,a)=>{const l=C.get(a,wr);if(!l)return[E.FAILURE,"No target in blackboard"];const d=s.gameState.entities.entities[l];if(!d)return C.delete(a,wr),[E.FAILURE,"Tree no longer exists"];const[u]=d.stateMachine??[];return u===an||u===Kt||u===vn?U(i.position,d.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Zl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=d.id,C.delete(a,wr),[E.SUCCESS,`Chopping tree ${d.id}`]):(i.activeAction="moving",i.target=d.id,i.direction=$e(i.position,d.position,s.gameState.mapDimensions),[E.RUNNING,`Moving to tree ${d.id}`]):(C.delete(a,wr),[E.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop",e+3),{taskType:"chop",maxCapacity:1,getTargetId:(i,s,a)=>C.get(a,wr)??null},"Tribal Chop Task",e+3);return new Ie([new he((i,s)=>{const a=xt(i,s.gameState);if(!a)return[!1,"No leader for coordination"];const l=Yl(a.id,s.gameState);if(l<=0)return[!1,"No wood need"];const d=TI(a.id,s.gameState);return[l>d,`Wood need: ${l}, Available on ground: ${d}`]},"Need Wood?",e+1),new he(i=>{const s=!i.heldItem;return[(i.isAdult&&s)??!1,`${s?"Can chop":"Holding item"}`]},"Should Chop Tree",e+1),new ln([new Ie([new he((i,s,a)=>C.has(a,wr),"Has Tree Target?",e+2),n],"Continue Chopping Action",e+2),new Ie([new Hn(t,RR,"Cache Tree Search",e+3),n],"Find New Tree and Chop",e+2)],"Perform or Start Chopping",e+1)],"Chop Tree",e)}const Rr="cleanupTreeTarget";function ZM(e){const t=new ae((i,s,a)=>{const l=xt(i,s.gameState),d=ku(i,s.gameState);if(d.length===0)return[E.FAILURE,"No planting zones found"];const u=s.gameState;let f=null,g=1/0;for(const m of d){const S=Math.sqrt(m.width*m.width+m.height*m.height)/2,v=u.search.tree.byRadius(m.position,S);for(const A of v){const[I]=A.stateMachine??[];if(!(I===an||I===Kt||I===vn)||!bg(A.position,m,s.gameState))continue;if(l&&l.aiBlackboard){const R=`tribal_cleanup_tree_${A.id}`,w=C.get(l.aiBlackboard,R);if(w&&s.gameState.time-w.startTime<=Fi&&!w.memberIds.includes(i.id))continue}const P=U(i.position,A.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);P<g&&(g=P,f=A)}}return f?(C.set(a,Rr,f.id),[E.SUCCESS,`Found nuisance tree: ${f.id} at ${f.position.x.toFixed(0)},${f.position.y.toFixed(0)}`]):[E.FAILURE,"No nuisance trees found in planting zones"]},"Find Nuisance Tree",e+4),n=new Hi(new ae((i,s,a)=>{const l=C.get(a,Rr);if(!l)return[E.FAILURE,"No target in blackboard"];const d=s.gameState.entities.entities[l];if(!d)return C.delete(a,Rr),[E.FAILURE,"Tree no longer exists"];const[u]=d.stateMachine??[];return u===an||u===Kt||u===vn?U(i.position,d.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Zl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=d.id,C.delete(a,Rr),[E.SUCCESS,`Chopping nuisance tree ${d.id}`]):(i.activeAction="moving",i.target=d.id,i.direction=$e(i.position,d.position,s.gameState.mapDimensions),[E.RUNNING,`Moving to nuisance tree ${d.id}`]):(C.delete(a,Rr),[E.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop (Cleanup)",e+3),{taskType:"cleanup_tree",maxCapacity:1,getTargetId:(i,s,a)=>C.get(a,Rr)??null},"Tribal Cleanup Tree Task",e+3);return new Ie([new he((i,s)=>{const a=Yn(i,ie.Planter,s.gameState),l=Yn(i,ie.Gatherer,s.gameState),d=!i.heldItem;return[!!(i.isAdult&&(a||l)&&d),`${d?"Planter/Gatherer role eligible":"Holding item"}`]},"Should Cleanup Zone?",e+1),new ln([new Ie([new he((i,s,a)=>C.has(a,Rr),"Has Cleanup Target?",e+2),n],"Continue Cleanup Action",e+2),new Ie([new Hn(t,PR,"Cache Cleanup Search",e+3),n],"Find New Nuisance Tree and Chop",e+2)],"Perform or Start Cleanup",e+1)],"Cleanup Planting Zones",e)}const ul="bonfireTargetId",QM=800;function JM(e){return new Ie([new he((t,n)=>{const i=tr(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<lo+8;return[s,`Temp: ${i.toFixed(1)}C`+(s?" (Cold)":"")]},"Is Cold?",e+1),new ae((t,n,i)=>{const s=xt(t,n.gameState),a=be(t,n.gameState,"building",QM,l=>{if(!(l.buildingType===le.Bonfire&&l.isConstructed&&!l.isBeingDestroyed&&(l.fuelLevel??0)>0)||l.ownerId!==t.leaderId)return!1;if(s&&s.aiBlackboard){const u=`tribal_warmth_${l.id}`,f=C.get(s.aiBlackboard,u);if(f&&n.gameState.time-f.startTime<=Fi&&f.memberIds.length>=Hg&&!f.memberIds.includes(t.id))return!1}return!0});return a?(C.set(i,ul,a.id),[E.SUCCESS,`Found bonfire ${a.id}`]):(C.delete(i,ul),[E.FAILURE,"No available fueled bonfires found"])},"Find Bonfire",e+1),new Hi(new ae((t,n,i)=>{const s=C.get(i,ul),a=s&&n.gameState.entities.entities[s];if(!a||(a.fuelLevel??0)<=0||!a.isConstructed)return C.delete(i,ul),E.FAILURE;const l=t.id*137%360*(Math.PI/180),d=Fr*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,g={x:(a.position.x+Math.cos(l)*d+u)%u,y:(a.position.y+Math.sin(l)*d+f)%f},m=U(t.position,g,u,f);return m>10?(t.activeAction="moving",t.target=g,t.direction=$e(t.position,g,n.gameState.mapDimensions),[E.RUNNING,`Moving to personal warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[E.RUNNING,"Staying warm at personal spot"])},"Move to Warmth Spot",e+2),{taskType:"warmth",maxCapacity:Hg,getTargetId:(t,n,i)=>C.get(i,ul)??null},"Tribal Warmth Task",e+1)],"Gather at Bonfire Sequence",e)}function eO(e){const t=new ae((n,i,s)=>{if(!n.leaderId||n.id!==n.leaderId)return[E.FAILURE,"Not a tribe leader"];const a=fa(n.id,i.gameState);let l=0;for(const d of a)if(d.isConstructed&&d.fuelLevel!==void 0){const u=d.maxFuelLevel??Lr;d.fuelLevel<u*Cp&&(oT(s,d.id,"wood",i.gameState.time),l++)}return[E.SUCCESS,`Tribe logistics: ${l} wood demands registered for bonfires`]},"Manage Tribe Logistics",e+1);return new Hn(t,h1,"Cached Tribe Logistics",e)}function tO(e){return new Ie([new he((t,n,i)=>{const s=be(t,n.gameState,"predator",yn*2,()=>!0),a=be(t,n.gameState,"human",yn*2,()=>!0);let l=null,d=1/0;if(s){const u=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<d&&(d=u,l=s)}if(a){const u=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<d&&(d=u,l=a)}return l&&d<yn*1.5?(C.set(i,"fleeThreat",l.id),C.set(i,"fleeDistance",d),!0):!1},"Detect Threat",e+1),new ae((t,n,i)=>{const s=C.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;t.activeAction="moving";const l=Xe(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=ot(l),u=oi(t.position,At(d,KD));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=d,t.fleeCooldown=n.gameState.time+2,E.RUNNING},"Execute Flee",e+1)],"Prey Flee",e)}function nO(e){return new Ie([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=30||t.eatingCooldownTime&&t.eatingCooldownTime>n.gameState.time)return!1;const s=be(t,n.gameState,"berryBush",yn*10,a=>a.food.length>0);return s?U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=yn?(C.set(i,"grazingTarget",s.id),!0):(C.set(i,"grazingTarget",s.id),C.set(i,"needToMoveToTarget",!0),!0):!1},"Find Berry Bush",e+1),new ae((t,n,i)=>{const s=C.get(i,"grazingTarget"),a=s&&n.gameState.entities.entities[s],l=C.get(i,"needToMoveToTarget");if(!a)return E.FAILURE;const d=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=yn)return t.activeAction="grazing",t.target=a.id,t.direction={x:0,y:0},C.delete(i,"needToMoveToTarget"),E.RUNNING;if(l||d>yn){t.activeAction="moving",t.target=a.id;const u=$e(t.position,a.position,n.gameState.mapDimensions);return t.direction=u,E.RUNNING}return E.FAILURE},"Move to Bush or Graze",e+1)],"Prey Graze",e)}function iO(e){const t=new he((a,l,d)=>{const u=be(a,l.gameState,"prey",yn,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Ol&&f.age<=rg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(d,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new ae((a,l,d)=>{const u=C.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},C.delete(d,"procreationPartner"),E.SUCCESS):E.FAILURE},"Start Procreating",e+2),i=new he((a,l,d)=>{const u=be(a,l.gameState,"prey",yn*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Ol&&f.age<=rg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(d,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new ae((a,l,d)=>{const u=C.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return E.FAILURE;if(U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=yn)return E.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),E.RUNNING},"Move Towards Partner",e+2);return new Ie([new he(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=Ol&&a.age<=rg&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new ln([new Ie([t,n],"Procreate With Immediate Partner",e+2),new Ie([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Prey Procreate",e)}const oO=(e,t,n)=>{const i=t.gameState.search.prey.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="prey");if(i.length===0)return E.FAILURE;let s=null,a=Uu;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(C.set(n,"targetChild",s.id),E.SUCCESS):E.FAILURE},rO=(e,t,n)=>{const i=C.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>va?(e.activeAction="moving",e.target=s.id,e.direction=$e(e.position,s.position,t.gameState.mapDimensions),E.RUNNING):(e.activeAction="feeding",e.target=void 0,C.set(n,"targetChild",void 0),E.SUCCESS):E.FAILURE};function sO(e){return new Ie([new he(t=>(t.isAdult&&t.gender==="female"&&t.hunger<80&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new ae(oO,"Find Hungriest Prey Child",e+1),new ae(rO,"Move To Child and Feed",e+1)],"Feed Prey Child",e)}function aO(e){return new Ie([new he(t=>!t.isAdult&&t.hunger>=Uu,"Is Hungry Prey Child",e+1),new ae((t,n,i)=>{if(!t.motherId)return E.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(C.set(i,"targetParent",s.id),E.SUCCESS):E.FAILURE},"Find Female Parent",e+1),new ae((t,n,i)=>{const s=C.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=va?(t.target=void 0,E.SUCCESS):(t.target=a.id,t.activeAction="moving",E.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}const Nd="huntTarget";function lO(e,t,n){if(!(e!=null&&e.aiBlackboard))return!0;const i=`tribal_hunt_${t}`,s=C.get(e.aiBlackboard,i);return!s||n-s.startTime>Fi?!0:s.memberIds.length<(s.maxCapacity||Gu)}function cO(e,t,n,i){if(!(e!=null&&e.aiBlackboard))return;const s=`tribal_hunt_${n}`;let a=C.get(e.aiBlackboard,s);a||(a={memberIds:[],startTime:i,maxCapacity:Gu},C.set(e.aiBlackboard,s,a)),a.memberIds.includes(t.id)||a.memberIds.push(t.id)}function dO(e,t){if(!(e!=null&&e.aiBlackboard))return 0;const n=`tribal_hunt_${t}`,i=C.get(e.aiBlackboard,n);return(i==null?void 0:i.memberIds.length)??0}function Xd(e,t,n=new Set){if(n.has(e.id))return e;n.add(e.id);for(const i of[e.fatherId,e.pregnancyFatherId,e.motherId]){if(!i||i===e.id)continue;const s=t.entities.entities[i];if(s)return Xd(s,t,n)}return e}function uO(e){return new Ie([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=50||t.huntCooldown&&t.huntCooldown>0)return!1;const s=be(t,n.gameState,"prey",bs*10,a=>{if(a.hitpoints<=0)return!1;const l=Xd(t,n.gameState);return!(l&&!lO(l,a.id,n.gameState.time))});if(s){const a=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Xd(t,n.gameState),d=l?dO(l,s.id):0;if(a<=bs)return C.set(i,Nd,s.id),[!0,`Prey in range (${d} hunters)`];if(a<=bs*10)return C.set(i,Nd,s.id),C.set(i,"needToApproach",!0),[!0,`Approaching prey (${d} hunters)`]}return!1},"Find Prey Target",e+1),new Or(new ae((t,n,i)=>{const s=C.get(i,Nd),a=s&&n.gameState.entities.entities[s],l=C.get(i,"needToApproach");if(!a||a.hitpoints<=0)return C.delete(i,Nd),C.delete(i,"needToApproach"),E.SUCCESS;const d=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=bs)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},C.delete(i,"needToApproach"),E.RUNNING;if(l||d>bs){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),cO(Xd(t,n.gameState),t,a.id,n.gameState.time),E.RUNNING}return E.FAILURE},"Hunt or Approach Prey",e+3),10,"Hunt Timeout (10 hour)",e+2)],"Predator Hunt",e)}function fO(e){return new Ie([new he((t,n,i)=>{const s=t.hunger>100,a=t.hitpoints<t.maxHitpoints*.5;if(!s&&!a||t.attackCooldown&&t.attackCooldown>0)return!1;const l=be(t,n.gameState,"human",mi*2,d=>d.hitpoints>0);if(l){const d=U(t.position,l.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=mi)return C.set(i,"attackTarget",l.id),!0;if(s&&d<=mi*2)return C.set(i,"attackTarget",l.id),C.set(i,"needToApproach",!0),!0}return!1},"Find Human Target",e+1),new ae((t,n,i)=>{const s=C.get(i,"attackTarget"),a=s&&n.gameState.entities.entities[s],l=C.get(i,"needToApproach");if(!a||a.hitpoints<=0)return E.FAILURE;const d=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=mi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},C.delete(i,"needToApproach"),E.RUNNING;if(l||d>mi){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),E.RUNNING}return E.FAILURE},"Attack or Approach Human",e+1)],"Predator Attack Human",e)}function hO(e){const t=new he((a,l,d)=>{const u=be(a,l.gameState,"predator",qo,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=kl&&f.age<=sg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(d,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new ae((a,l,d)=>{const u=C.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},C.delete(d,"procreationPartner"),E.SUCCESS):E.FAILURE},"Start Procreating",e+2),i=new he((a,l,d)=>{const u=be(a,l.gameState,"predator",qo*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=kl&&f.age<=sg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(d,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new ae((a,l,d)=>{const u=C.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return E.FAILURE;if(U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=qo)return E.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),E.RUNNING},"Move Towards Partner",e+2);return new Ie([new he(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=kl&&a.age<=sg&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new ln([new Ie([t,n],"Procreate With Immediate Partner",e+2),new Ie([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Predator Procreate",e)}const gO=(e,t,n)=>{const i=t.gameState.search.predator.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="predator");if(i.length===0)return E.FAILURE;let s=null,a=Uu;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(C.set(n,"targetChild",s.id),E.SUCCESS):E.FAILURE},pO=(e,t,n)=>{const i=C.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>va?(e.activeAction="moving",e.target=s.id,e.direction=$e(e.position,s.position,t.gameState.mapDimensions),E.RUNNING):(e.activeAction="feeding",e.target=void 0,C.set(n,"targetChild",void 0),E.SUCCESS):E.FAILURE};function mO(e){return new Ie([new he(t=>(t.isAdult&&t.gender==="female"&&t.hunger<90&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new ae(gO,"Find Hungriest Predator Child",e+1),new ae(pO,"Move To Child and Feed",e+1)],"Feed Predator Child",e)}function yO(e){return new Ie([new he(t=>!t.isAdult&&t.hunger>=Uu,"Is Hungry Predator Child",e+1),new ae((t,n,i)=>{if(!t.motherId)return E.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(C.set(i,"targetParent",s.id),E.SUCCESS):E.FAILURE},"Find Female Parent",e+1),new ae((t,n,i)=>{const s=C.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=va?(t.target=void 0,E.SUCCESS):(t.target=a.id,t.activeAction="moving",E.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}function dT(e){return new ae((t,n,i)=>{t.activeAction="idle";let s=C.get(i,"wanderTarget"),a=C.get(i,"wanderStartTime");const l=n.gameState.time;if(!s||!a||l-a>2){const d=Math.random()*2*Math.PI,u=50+Math.random()*100,f={x:Math.cos(d),y:Math.sin(d)},g=oi(t.position,At(f,u));s={x:(g.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(g.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},C.set(i,"wanderTarget",s),C.set(i,"wanderStartTime",l)}if(s){t.target=s;let d=s.x-t.position.x,u=s.y-t.position.y;const f=n.gameState.mapDimensions.width,g=n.gameState.mapDimensions.height;Math.abs(d)>f/2&&(d=d>0?d-f:d+f),Math.abs(u)>g/2&&(u=u>0?u-g:u+g);const m=ot({x:d,y:u});t.direction=m}return E.SUCCESS},"Animal Wander",e)}function SO(e){return new Ie([new he((t,n,i)=>{if(t.hunger>90||t.hitpoints<t.maxHitpoints*.3||t.activeAction==="grazing"||t.activeAction==="procreating")return!1;const s=Object.values(n.gameState.entities.entities),a=[];for(const l of s)if(l.type==="prey"&&l.id!==t.id){const d=l;d.hitpoints>0&&d.isAdult&&U(t.position,d.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=yn*5&&a.push(d)}if(a.length>=2){let l=0,d=0;for(const g of a)l+=g.position.x,d+=g.position.y;l/=a.length,d/=a.length;const u={x:l,y:d};if(U(t.position,u,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>yn*2)return C.set(i,"herdCenter",u),C.set(i,"herdSize",a.length),!0}return!1},"Find Herd",e+1),new ae((t,n,i)=>{const s=C.get(i,"herdCenter");if(!s)return E.FAILURE;if(U(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>yn*2){t.activeAction="moving",t.target=s;const l=Xe(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(l),E.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},E.SUCCESS},"Join Herd",e+1)],"Prey Herd Behavior",e)}function vO(e){return new Ie([new he((t,n,i)=>{if(t.hunger>100||t.hitpoints<t.maxHitpoints*.4||t.activeAction==="attacking"||t.activeAction==="procreating")return!1;const s=be(t,n.gameState,"predator",qo*4,a=>a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==void 0&&a.fatherId===t.fatherId&&a.age>=t.age||a.hitpoints>t.hitpoints);return s&&U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>qo*2?(C.set(i,"packLeader",s.id),!0):!1},"Find Pack Leader",e+1),new ae((t,n,i)=>{const s=C.get(i,"packLeader"),a=s&&n.gameState.entities.entities[s];if(!a||a.hitpoints<=0)return E.FAILURE;if(U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>qo*2){t.activeAction="moving",t.target=a.id;const d=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(d),E.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},E.SUCCESS},"Follow Pack Leader",e+1)],"Predator Pack Behavior",e)}function AO(e){return new Ie([new he((t,n,i)=>{if(!t.isAdult||t.hitpoints<t.maxHitpoints*.6||t.hunger>120||t.attackCooldown&&t.attackCooldown>0)return!1;const s=be(t,n.gameState,"predator",KS,a=>!!(a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==a.fatherId&&t.gender===a.gender&&t.fatherId!==void 0&&a.fatherId!==void 0));if(s){const a=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(a<=mi)return C.set(i,"territorialTarget",s.id),!0;if(a<=KS)return C.set(i,"territorialTarget",s.id),C.set(i,"needToApproach",!0),!0}return!1},"Find Territorial Rival",e+1),new ae((t,n,i)=>{const s=C.get(i,"territorialTarget"),a=s&&n.gameState.entities.entities[s],l=C.get(i,"needToApproach");if(!a||a.hitpoints<=0)return E.FAILURE;const d=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(d<=mi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},C.delete(i,"needToApproach"),E.RUNNING;if(l||d>mi){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),E.RUNNING}return E.FAILURE},"Territorial Fight or Approach",e+1)],"Predator Territorial Defense",e)}const IO="tribeSplit_strategy",TO="tribeSplit_targetPosition",EO="tribeSplit_targetBuildingId",CO="tribeSplit_familyIds";function _O(e){return new Ie([new he((t,n)=>{const i=cu(t,n.gameState);if(!i.aiBlackboard)return[!1,"Patriarch has no blackboard"];const s=Il(i.aiBlackboard);if(s!=="gathering")return[!1,`Patriarch phase: ${s}`];const a=C.get(i.aiBlackboard,CO);return!a||!a.includes(t.id)?[!1,"Not in split family"]:[!0,"Gathering for split"]},"Should Gather for Split?",e+1),new ae((t,n)=>{const i=cu(t,n.gameState),s=C.get(i.aiBlackboard,IO);let a;if(s==="migration")a=C.get(i.aiBlackboard,TO);else if(s==="concentration"){const d=C.get(i.aiBlackboard,EO);if(d){const u=n.gameState.entities.entities[d];u&&(a=u.position)}}if(!a)return E.FAILURE;const l=U(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=MI?(t.activeAction="idle",t.target=void 0,E.SUCCESS):(t.activeAction="moving",t.target=a,[E.RUNNING,`Distance: ${l.toFixed(2)}`])},"Move to Split Gathering Point",e+1)],"Tribe Split Gather Behavior",e)}function wO(){const e=new ln([uM(2),BM(2),new Pn($M(2),"attack","Gated Defend Against Predator",2),new Pn(bM(2),"attack","Gated Jealousy Attack",2),new Pn(FM(2),"attack","Gated Desperate Attack",2),UM(2),new _s(new ln([new Hn(PM(5),Us,"Cache Take Over Building",4),new Hn(MM(5),Us,"Cache Remove Enemy Building",4)],"Building Interaction Selector",3),"Gated Leader Building Interactions",2),wM(2),new Pn(mM(3),"attack","Gated Attacking",2),JM(2),oM(2),rM(2),_M(2),new Pn(new Hn(RM(4),jR,"Cache Building Placement",3),"build","Gated Leader Building Placement",2),new _s(new Hn(NM(4),Us,"Cache Border Post Placement",3),"Gated Border Post Placement",2),kM(2),_O(2),dM(2),new Pn(pM(3),"procreation","Gated Procreation",2),new Or(new Pn(ZM(4),"chopping","Gated Cleanup Trees",3),Os,"Timeout Cleanup Trees",2),new Or(new Pn(EM(4),"planting","Gated Planting",3),Os,"Timeout Planting",2),new Pn(CM(3),"gathering","Gated Storage Deposit",2),new Pn(vM(3),"feedChildren","Gated Feed Child",2),new Or(new Pn(fM(4),"gathering","Gated Gathering",3),Os,"Timeout Gathering",2),new Or(new Pn(qM(4),"chopping","Gated Chopping",3),Os,"Timeout Chopping",2),AM(2),new Pn(GM(3),"attack","Gated Hunt Prey",2),new _s(OM(2),"Gated Follow Patriarch",2),new Or(new _s(gM(2),"Gated Idle Wander",3),Os,"Timeout Idle Wander",2)],"AI Root Selector",1),t=new ev([new tM(new nM(xM(4),"Role Assignment Success",3),"Role Assignment Gate",2),new Pn(new Hn(KM(4),Us,"Cache Role Management",3),"roleManagement","Gated Role Management",2),new _s(HM(3),"Gated Diplomacy",2),new _s(eO(2),"Gated Logistics Management",2)],"Non blocking",1),n=new ev([e,t],"AI Root Sequence",1);return new iM(n,"Manual Control Gate",0)}var se=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e))(se||{}),G=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(G||{});const kt=2,RO=250,uT=.8,PO=100,DO=5,Xg="currentAiTask",fT="lastTaskResult",hT="lastTaskMessage",Vg="taskHistory";function Kg({aiBlackboard:e}){return C.get(e,Xg)||null}function js({aiBlackboard:e},t){t?C.set(e,Xg,t):C.delete(e,Xg)}function NO(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function MO(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function OO(e,t,n,i){const s=t.type===se.Wait?kO:i[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=G.Failure;const[l,d,u]=MO(a);if(C.set(e.aiBlackboard,fT,l),C.set(e.aiBlackboard,hT,d),l!==G.Running){const f=C.get(e.aiBlackboard,Vg)||[];if(f.unshift({type:t.type,result:l,completedAtTick:n.gameState.time,message:d}),f.length>5&&f.pop(),C.set(e.aiBlackboard,Vg,f),delete n.gameState.tasks[t.id],js(e,null),l===G.Success){const g=u||t.nextTask;g&&(n.gameState.tasks[g.id]=g,g.claimedByEntityId=e.id,js(e,g.id))}}return l}function cn(e){return 1/(1+e/RO)}function nc(e,t,n){for(let i=0;i<n.length;i++){const s=n[i];if(!s.producer)continue;const a=s.producer(e,t);for(const l in a){const d=a[l],u=t.gameState.tasks[l];t.gameState.tasks[l]=d,u&&(t.gameState.tasks[l].claimedByEntityId=u.claimedByEntityId)}}}const Md=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:se.Wait,creatorEntityId:e.id,validUntilTime:t+kt}),kO={type:se.Wait,executor:(e,t,n)=>n.gameState.time>=e.validUntilTime-1?[G.Success,"Wait complete"]:[G.Running,"Waiting"]};function ht(e){const{type:t,requireAdult:n,autopilotBehavior:i,producer:s,scorer:a,executor:l}=e;return{type:t,producer:s,scorer:a?(f,g,m)=>n&&!f.isAdult||i&&f.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?null:a(f,g,m):void 0,executor:l?(f,g,m)=>n&&!g.isAdult||i&&g.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?G.Failure:m.gameState.autopilotControls.activeAutopilotAction&&f.type!==se.HumanPlayerCommand&&g.isPlayer?[G.Failure,"Autopilot action active",{id:`player-command-${g.id}`,type:se.HumanPlayerCommand,position:g.position,creatorEntityId:g.id,validUntilTime:m.gameState.time+kt}]:l(f,g,m):void 0}}const bO=ht({type:se.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>ca&&e.food.length>0){const i=`eat-task-${e.id}`;n[i]={id:i,type:se.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/rn,executor:(e,t)=>e.target!==t.id?G.Empty:t.hunger<ca?G.Success:t.food.length===0?G.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",G.Running)}),BO=ht({type:se.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="berryBush"||i.food.length===0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=cn(s),l=e.hunger/rn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="berryBush"||i.food.length===0||t.food.length>=t.maxFood?[G.Success,"Bush is empty"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",[G.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[G.Running,"Gathering berries"])}}),FO=ht({type:se.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="corpse"||i.food.length===0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=cn(s),l=e.hunger/rn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="corpse"||i.food.length===0||t.food.length>=t.maxFood?G.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",G.Running)}}),LO=ht({type:se.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=Gl&&e.age<=_u&&e.hunger<sn&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:se.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<Gl||e.hunger>=sn||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="female"||i.isPregnant||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(s)*uT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="female"||t.hunger>=sn?G.Failure:i.isPregnant?G.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",t.direction=$e(t.position,i.position,n.gameState.mapDimensions),G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",G.Running)}}),UO=ht({type:se.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=Gl&&e.hunger<sn&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:se.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<Gl||e.age>_u||e.hunger>=sn||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="male"||i.hunger>=sn||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(s)*uT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="male"||i.hunger>=sn?G.Failure:t.isPregnant?G.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",t.direction=$e(t.position,i.position,n.gameState.mapDimensions),G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",G.Running)}}),HO=ht({type:se.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=sa){const i=`feed-child-task-${e.id}`;n[i]={id:i,type:se.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.isAdult||!(i.motherId===e.id||i.fatherId===e.id))return null;const a=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=cn(a),d=i.hunger/rn;return(l+d)/2},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.isAdult||t.food.length===0?G.Failure:i.hunger<sa/2?G.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>wu?(t.target=i.position,t.activeAction="moving",t.direction=$e(t.position,i.position,n.gameState.mapDimensions),G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="feeding",G.Running)}});function xu(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const i=U(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(i)}function Wu(e,t,n,i,s){const a=e.target;return U(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",G.Running):(Ko(a,i,t.leaderId,n.gameState),G.Success)}const GO=ht({type:se.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:xu,executor:(e,t,n)=>Wu(e,t,n,le.StorageSpot,eo)}),$O=ht({type:se.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:xu,executor:(e,t,n)=>Wu(e,t,n,le.Bonfire,eo)}),xO=ht({type:se.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:xu,executor:(e,t,n)=>Wu(e,t,n,le.PlantingZone,eo)}),WO=ht({type:se.HumanPlaceBorderPost,requireAdult:!0,autopilotBehavior:"build",scorer:xu,executor:(e,t,n)=>Wu(e,t,n,le.BorderPost,qR)}),YO=ht({type:se.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(u=>u.type===An.Berry).length<uo)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const l=t.target,d=U(e.position,l,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(d)},executor:(e,t,n)=>{if(t.food.filter(d=>d.type===An.Berry).length<uo)return t.activeAction="idle",G.Failure;const s=e.target;return U(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Yr?(t.target=s,t.activeAction="moving",G.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(d=>d.type==="berryBush"&&U(d.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<DO)?(t.activeAction="idle",G.Success):G.Running)}}),zO=ht({type:se.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var f;if(typeof t.target!="number")return null;const i=e.food.length>0,s=((f=e.heldItem)==null?void 0:f.type)===yt.Wood;if(!i&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==le.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const l=U(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=cn(l),u=s?.6:e.food.length/e.maxFood*.4;return(d+u)/2},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==le.StorageSpot)return G.Failure;const s=t.food.length>0,a=((d=t.heldItem)==null?void 0:d.type)===yt.Wood;return!s&&!a?G.Success:i.storedItems.length>=i.storageCapacity?G.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",G.Running)}}),jO=ht({type:se.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var d;if(typeof t.target!="number"||!(((d=e.heldItem)==null?void 0:d.type)===yt.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==le.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||ru;if(s.storedItems.length>=a)return null;const l=U(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(l)},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==le.Bonfire)return G.Failure;if(!(((d=t.heldItem)==null?void 0:d.type)===yt.Wood))return G.Success;const a=i.storageCapacity||ru;return i.storedItems.length>=a?G.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",G.Running)}}),XO=ht({type:se.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=ca||e.food.length>0||typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="building"||i.buildingType!==le.StorageSpot||i.ownerId!==e.leaderId||!i.storedItems.some(u=>u.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=cn(s),l=e.hunger/rn,d=1-e.food.length/e.maxFood;return(a+l+d)/3},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="building"||i.buildingType!==le.StorageSpot||!i.storedItems.some(a=>a.item.itemType==="food")?G.Failure:t.food.length>0?G.Success:t.food.length>=t.maxFood?G.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="retrieving",G.Running)}}),VO=ht({type:se.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree")return null;const[s]=i.stateMachine??[];if(!(s===an||s===Kt||s===vn)||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.heldItem||e.food.length===0)return null;const l=xt(e,n.gameState);if(!l)return null;const d=Yl(l.id,n.gameState);if(d<=0)return null;const u=TI(l.id,n.gameState);if(u>=d)return null;const f=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),g=cn(f),m=Math.min(1,(d-u)/10);return(g+m)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="tree")return[G.Failure,"Tree not found"];const[s]=i.stateMachine??[];if(s===Gt){const d={id:`gather-wood-${t.id}-${n.gameState.time}`,type:se.HumanGatherWood,position:i.position,creatorEntityId:t.id,target:i.id,validUntilTime:n.gameState.time+1};return[G.Success,"Tree fell!",d]}return s===an||s===Kt||s===vn?t.heldItem?[G.Failure,"Hands full"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Zl?(t.target=i.position,t.activeAction="moving",[G.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="chopping",[G.Running,"Chopping tree"]):[G.Failure,"Tree is not standing"]}}),KO=ht({type:se.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree"||i.wood.length===0)return null;const[s]=i.stateMachine??[];if(s!==Gt||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.heldItem)return null;const a=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=cn(a),d=xt(e,n.gameState),u=d?Yl(d.id,n.gameState):0,f=Math.min(1,u/10);return(l+f)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[G.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[G.Success,"Already holding wood"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="tree"||i.wood.length===0||t.heldItem?[G.Failure,"Tree gone, empty, or human full"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",[G.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[G.Running,"Gathering wood"])}}),qO=ht({type:se.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="prey"||i.hitpoints<=0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState))return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const d=$n(e.leaderId,n.gameState);if(U(e.position,d,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>kA)return null}const a=cn(s),l=e.hunger/rn;return(a+l)/2*.6},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[G.Success,"Prey is dead"];const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[G.Running,"Chasing prey"]:[G.Running,"Attacking prey"]}}),ZO=ht({type:se.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="predator"||i.hitpoints<=0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState))return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(cn(s)+.3)/1.3},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[G.Failure,"Too injured to continue"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[G.Success,"Predator eliminated"];const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[G.Running,"Chasing predator"]:[G.Running,"Fighting predator"]}});function QO(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,G.Failure;const a=U(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?Sn:fo;return a<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,G.Success):(t.activeAction="moving",t.target=s.id,t.direction=$e(t.position,s.position,e.mapDimensions),G.Running)}const JO=ht({type:se.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const i=`player-command-${e.id}`;n[i]={id:i,type:se.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+kt}}return n},scorer:(e,t)=>t.type===se.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return[G.Failure,"No active autopilot action"];switch(s.action){case re.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,G.Failure;const l=s.position;return U(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<FA?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[G.Success,"Reached target position"]):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),[G.Running,"Moving to target"])}case re.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Target entity not found"];let d=!1;if(l.type==="berryBush")d=l.food.length===0;else if(l.type==="corpse")d=l.food.length===0;else if(l.type==="tree"){const f=l;d=f.stateMachine[0]!==Gt||f.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target type"];return d?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Target is depleted"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Yr?(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"At target, gathering",Md(t,i.time)])}case re.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target entity"];const[d]=l.stateMachine??[];return!(d===an||d===Kt||d===vn)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Tree is not standing or human is holding an item"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Zl?(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"At tree, chopping",Md(t,i.time)])}case re.AutopilotAttack:return"targetEntityId"in s?QO(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,G.Failure);case re.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="human"||!or(t,l,i))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target for procreation"];const d=U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height);return l.isPregnant||t.isPregnant?t.gender==="male"&&l.pregnancyFatherId!==t.id?[G.Failure,"Target is pregnant by another"]:[G.Success,"Procreation conditions met"]:d<=Ks?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,[G.Running,"Procreating"]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to procreation target"])}case re.AutopilotPlant:{if(t.activeAction==="planting")return[G.Running,"Planting"];if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No position specified"];const l=s.position;return zn(l,i,Zo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Position is occupied"]):U(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(t.activeAction="planting",t.target=l,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,[G.Running,"Planting"]):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),[G.Running,"Moving to planting target"])}case re.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target for feeding child"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[G.Success,"Feeding child"]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to feeding target"])}case re.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.buildingType!==le.StorageSpot&&l.buildingType!==le.Bonfire||!l.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"];const d=l.storageCapacity??0;if(l.storedItems.length>=d)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Storage is full"];if(t.leaderId!==l.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Human does not belong to the same tribe as the building"];const f=t.food.length>0,g=!!t.heldItem;if(l.buildingType===le.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==yt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Bonfires only accept wood"]}else if(!f&&!g)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No items to deposit"];return U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Depositing items",Md(t,i.time)]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to deposit target"])}case re.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.buildingType!==le.StorageSpot||!l.isConstructed||l.storedItems.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"]):t.leaderId!==l.ownerId?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Storage is full"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Retrieving items",Md(t,i.time)]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to retrieve target"])}case re.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Only leaders can take over buildings"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="takingOverBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Taking over building"]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to takeover target"])}case re.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Only leaders can remove enemy buildings"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="destroyingBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=l.id,t.direction=$e(t.position,l.position,i.mapDimensions),[G.Running,"Moving to removal target"])}case re.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,G.Failure;const l=s.position,d=s.buildingType;if(!d)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No building type specified"];const u=U(t.position,l,i.mapDimensions.width,i.mapDimensions.height),f=100;return u<=f?da(l,d,t.leaderId,i,t.position,f)?(Ko(l,d,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[G.Success,"Building placed"]):(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=l,t.direction=$e(t.position,l,i.mapDimensions),[G.Running,"Moving to placement target"])}default:return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Unknown or unhandled action"]}}}),ek=ht({type:se.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:n}=t,i={},s=xn(e.position.x,e.position.y,n),a=s!==null&&s!==e.leaderId&&ir(e.leaderId,s,n),l=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(a||l){const d=`attack-human-${e.id}-${n.time.toFixed(2)}`;i[d]={id:d,type:se.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:n.time+kt}}return i},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="human"||i.hitpoints<=0||i.id===e.id||i.leaderId===e.leaderId)return null;const{gameState:s}=n,a=qr(e,i,s),l=xn(i.position.x,i.position.y,s)===e.leaderId,d=i.activeAction==="attacking"&&i.attackTargetId!==void 0;if(!a&&!d)return null;let u=.5;const f=U(e.position,i.position,s.mapDimensions.width,s.mapDimensions.height),g=cn(f);return l&&a&&(u+=.1),(g+u)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[G.Success,"Target eliminated"];const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[G.Running,"Chasing human target"]:[G.Running,"Fighting human target"]}}),tk=ht({type:se.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,n)=>{if(typeof t.target!="number"||tT(n.gameState.time)>.5)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.buildingType!==le.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0||e.leaderId!==i.ownerId)return null;const s=tr(n.gameState.temperature,e.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=lo+5;if(s>=a)return null;const l=(a-s)/15,d=(1-e.hitpoints/e.maxHitpoints)*.8,u=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),f=cn(u);let g=(l+d+f)/2;return e.hitpoints/e.maxHitpoints<.2&&s<lo&&(g=Math.max(g,1.2)),g},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.buildingType!==le.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0)return G.Failure;const s=tr(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=lo+5;if(s>=a)return t.activeAction="idle",[G.Success,"Comfortable temperature reached"];const l=t.id*137%360*(Math.PI/180),d=Fr*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,g={x:(i.position.x+Math.cos(l)*d+u)%u,y:(i.position.y+Math.sin(l)*d+f)%f},m=U(t.position,g,u,f);return m>10?(t.activeAction="moving",t.target=g,t.direction=$e(t.position,g,n.gameState.mapDimensions),[G.Running,`Moving to warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[G.Running,"Staying warm at bonfire"])}}),nk=ht({type:se.HumanFlee,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hitpoints<e.maxHitpoints*nu){const i=ZA(e.id,t.gameState);if(i){const s=`flee-task-${e.id}`;n[s]={id:s,type:se.HumanFlee,position:e.position,creatorEntityId:e.id,target:i.id,validUntilTime:t.gameState.time+kt}}}return n},scorer:(e,t,n)=>typeof t.target!="number"||!n.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*nu?.9:null,executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i)return t.activeAction="idle",t.attackTargetId=void 0,G.Success;if(U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Bg)return t.activeAction="idle",t.target=void 0,G.Success;t.activeAction="moving",t.attackTargetId=void 0;const a=Xe(i.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=ot(a),d=oi(t.position,At(l,Bg));return t.target={x:(d.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(d.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=l,G.Running}}),ik=ht({type:se.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(!e.leaderId||e.id===e.leaderId)return i;const s=$n(e.leaderId,n),a=`stay-near-tribe-${e.id}`;return i[a]={id:a,type:se.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:n.time+kt},i},scorer:(e,t,n)=>{if(!e.leaderId||e.id===e.leaderId)return null;const i=$n(e.leaderId,n.gameState),s=U(e.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=_S)return null;const a=s-_S;return Math.min(.95,.5+a/1e3*ZR)},executor:(e,t,n)=>{if(!t.leaderId)return G.Failure;const i=$n(t.leaderId,n.gameState),s=U(t.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<JR?(t.activeAction="idle",t.target=void 0,G.Success):(t.activeAction="moving",t.target=i,t.direction=$e(t.position,i,n.gameState.mapDimensions),[G.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),ok=ht({type:se.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(e.isAdult)return i;const s=xg(e,n);if(!s||e.leaderId&&iu(e.leaderId,n)&&xn(s.position.x,s.position.y,n)!==e.leaderId)return i;const a=`stay-near-parent-${e.id}`;return i[a]={id:a,type:se.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:n.time+kt},i},scorer:(e,t,n)=>{if(e.isAdult)return null;const i=xg(e,n.gameState);if(!i||i.id!==t.target||e.leaderId&&iu(e.leaderId,n.gameState)&&xn(i.position.x,i.position.y,n.gameState)!==e.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=wS)return null;const a=s-wS;return Math.min(.98,.6+a/500*QR)},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="human")return t.activeAction="idle",G.Failure;const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<=e1?(t.activeAction="idle",t.target=void 0,t.direction={x:0,y:0},G.Success):(t.activeAction="moving",t.target=i.id,t.direction=$e(t.position,i.position,n.gameState.mapDimensions),[G.Running,`Returning to parent (${Math.round(s)}px away)`])}}),Yu=[bO,BO,FO,LO,UO,HO,GO,$O,xO,WO,YO,zO,jO,XO,VO,KO,qO,ZO,JO,ek,tk,nk,ik,ok].reduce((e,t)=>(e[t.type]=t,e),{}),rk=Object.values(Yu);function sk(e,t){nc(e,t,rk)}function ak(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const i=Kg(e);if(i){const s=t.gameState.tasks[i];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),js(e,null)}return}let n=Kg(e);if(n){const i=t.gameState.tasks[n];(!i||i.claimedByEntityId&&i.claimedByEntityId!==e.id)&&(js(e,null),n=null)}if(!n){const i=lk(e,t);if(i&&t.gameState.tasks[i]){const s=t.gameState.tasks[i];n=i,js(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const i=t.gameState.tasks[n];i?OO(e,i,t,Yu):js(e,null)}}function lk(e,t){let n=null,i=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=Yu[a.type];if(!l||!l.scorer)continue;const d=l.scorer(e,a,t);d!==null&&d>i&&(i=d,n=a.id)}return i>0?n:null}const gT=wO();function ck(e,t){const n=performance.now();switch(e.aiType){case $t.TaskBased:ak(e,t);break;case $t.BehaviorTreeBased:default:Wp(e,t,gT);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}function dk(){return new ln([tO(1),sO(1),aO(1),nO(1),iO(1),SO(1),dT(1)],"Prey Behavior Root",0)}function uk(){return new ln([uO(1),fO(1),mO(1),yO(1),AO(1),hO(1),vO(1),dT(1)],"Predator Behavior Root",0)}const fk=(e,t)=>{const n={};for(let i=0;i<Gu;i++){const s=`hunt-prey-${e.id}-${i}`;n[s]={id:s,type:se.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},hk=(e,t)=>{const n={};if(e.hitpoints<=0)return n;const i=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((i==null?void 0:i.type)==="human"))return n;for(let a=0;a<bA;a++){const l=`hunt-predator-${e.id}-${a}`;n[l]={id:l,type:se.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},gk={[se.HumanHuntPrey]:{type:se.HumanHuntPrey,producer:fk},[se.HumanHuntPredator]:{type:se.HumanHuntPredator,producer:hk}};function hu(e,t){nc(e,t,Object.values(gk))}const pT=dk();function pk(e,t){switch(e.aiType){case $t.TaskBased:hu(e,t);break;case $t.BehaviorTreeBased:default:Wp(e,t,pT);break}}const mT=uk();function mk(e,t){switch(e.aiType){case $t.TaskBased:hu(e,t);break;case $t.BehaviorTreeBased:default:Wp(e,t,mT);break}}const yk=(e,t)=>{if(e.buildingType!==le.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,i=Np(e);if(CI(e,n)>=i)return{};const a=n.search.tasks.byProperty("creatorEntityId",e.id).find(g=>g.type===se.HumanPlantBush);if(a)return{[a.id]:a};const l=n.mapDimensions.width,d=n.mapDimensions.height,u=n.soilDepletion,f=10;for(let g=0;g<f;g++){const m=e.position.x+(Math.random()-.5)*e.width,S=e.position.y+(Math.random()-.5)*e.height,v={x:(m%l+l)%l,y:(S%d+d)%d};if(!Ui(u,v,l,d)&&!zn(v,n,Zo)){const A=`plant-bush-${e.id}-${n.time}`,I={id:A,type:se.HumanPlantBush,position:v,creatorEntityId:e.id,target:v,validUntilTime:n.time+PO};return{[A]:I}}}return{}},Sk=(e,t)=>{const n={};if(e.buildingType===le.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const i=`stockpile-${e.id}`;n[i]={id:i,type:se.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n},vk=(e,t)=>{const n={};if(e.buildingType===le.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*Cp){const i=`fuel-bonfire-${e.id}`;n[i]={id:i,type:se.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n},Ak=(e,t)=>{const n={};if(e.buildingType===le.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let i=0;i<Hg;i++){const s=`seek-warmth-${e.id}-${i}`;n[s]={id:s,type:se.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n},Ik=(e,t)=>{const n={};if(e.buildingType===le.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(i=>i.item.itemType==="food")){const i=`retrieve-from-${e.id}`;n[i]={id:i,type:se.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n},Tk={[se.HumanPlantBush]:{type:se.HumanPlantBush,producer:yk},[se.HumanStockpile]:{type:se.HumanStockpile,producer:Sk},[se.HumanFuelBonfire]:{type:se.HumanFuelBonfire,producer:vk},[se.HumanSeekWarmth]:{type:se.HumanSeekWarmth,producer:Ak},[se.HumanRetrieve]:{type:se.HumanRetrieve,producer:Ik}};function yT(e,t){nc(e,t,Object.values(Tk))}function Ek(e,t){const{gameState:n,deltaTime:i}=t,s=i*(Ct/Dt);if(e.isBeingDestroyed){const a=o_(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){const l=e.buildingType===le.PlantingZone;Qr(n.entities,e.id),l&&Bl(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=i_(e.buildingType);a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&VA(e.position,aa,e.ownerId,n),e.buildingType===le.PlantingZone&&Bl(n))}if(e.buildingType===le.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*d1,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*u1)){const a=e.storedItems.findIndex(l=>l.item.itemType==="item"&&l.item.type===yt.Wood);a!==-1&&(e.storedItems.splice(a,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+eI))}yT(e,t)}function Ck(e,t){const n=t.deltaTime*Ct/Dt;if(e.age+=n,!e.stateMachine)return;const[i]=e.stateMachine;i!==Gt&&i!==co&&i!==Xr&&(e.age>=er&&!e.woodGenerated&&(e.wood=Array.from({length:Hu},()=>({itemType:"item",type:yt.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=ec*Math.min(1,Math.max(.4,e.age/er)))}const _k={type:se.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const i=`gather-berries-${e.id}`;n[i]={id:i,type:se.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n}},wk={type:se.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===an||i===Kt||i===vn){const a=`chop-tree-${e.id}`;n[a]={id:a,type:se.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n}},Rk={type:se.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===Gt&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:se.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n}},Pk=[_k,wk,Rk].reduce((e,t)=>(e[t.type]=t,e),{});function dv(e,t){nc(e,t,Object.values(Pk))}const Dk={type:se.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const i=`gather-meat-${e.id}`;n[i]={id:i,type:se.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+kt}}return n}},Nk=[Dk].reduce((e,t)=>(e[t.type]=t,e),{});function Mk(e,t){nc(e,t,Object.values(Nk))}var Vd=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(Vd||{});function hg(e,t,n){switch(n){case 0:Ok(e,t);break;case 1:kk(e,t);break;case 2:bk(e,t);break}}function Ok(e,t){e.forces.push(At(e.velocity,-.1));const n=At(ot(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(i=>{t.gameState.time-i.startTime<i.duration&&i.type==="slow"&&(e.velocity=At(e.velocity,.5))}),e.debuffs=e.debuffs.filter(i=>t.gameState.time-i.startTime<i.duration),e.velocity=oi(e.velocity,e.forces.reduce(oi,{x:0,y:0})),ea(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=oi(e.position,At(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&ea(e.velocity)>.1&&UP(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?YN(e,t,t.deltaTime):e.type==="corpse"?zN(e,t):e.type==="prey"?jN(e,t,t.deltaTime):e.type==="predator"?XN(e,t,t.deltaTime):e.type==="building"?Ek(e,t):e.type==="tree"?Ck(e,t):e.type,e.stateMachine&&(e.stateMachine=$N(...e.stateMachine,{entity:e,updateContext:t}))}function kk(e,t){ST(e,t)&&(e.type==="human"?sk(e,t):e.type==="corpse"?Mk(e,t):e.type==="prey"||e.type==="predator"?hu(e,t):e.type==="building"?yT(e,t):(e.type==="tree"||e.type==="berryBush")&&dv(e,t))}function bk(e,t){ST(e,t)&&(C.cleanupOldEntries(e.aiBlackboard,t.gameState.time),e.type==="human"?ck(e,t):e.type==="corpse"||(e.type==="prey"?pk(e,t):e.type==="predator"?mk(e,t):e.type==="building"||e.type==="tree"||e.type),C.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function ST(e,t){const n=C.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-n+(Math.random()-Math.random())*la/10>la}function Bk(e){const t=e.gameState.entities.entities;for(const n in t)hg(t[n],e,Vd.Physics);for(const n in t)hg(t[n],e,Vd.PrepareAI);QC(e.gameState);for(const n in t)hg(t[n],e,Vd.ExecuteAI)}function vT(){return{entities:{},nextEntityId:1}}function Zr(e,t,n){const i={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:C.create(),...n};return e.entities[i.id]=i,i}function ic(e,t,n){return Zr(e,"berryBush",{position:t,radius:kg,food:Array.from({length:vw},()=>({itemType:"food",type:An.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:Sw,lifespan:Iw,age:0,spreadRadius:kg,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:C.create(),stateMachine:[wl,{enteredAt:n,previousState:void 0}]})}function Vl(e,t,n,i=0){const s=i>=er;return Zr(e,"tree",{position:t,radius:ec,age:i,lifespan:TN,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:MN,stateMachine:[an,{enteredAt:n,previousState:void 0}],aiBlackboard:C.create(),wood:s?Array.from({length:Hu},()=>({itemType:"item",type:yt.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function Xs(e,t,n,i,s=!1,a=Uw,l=MA,d,u,f=[],g,m,S=$t.TaskBased){const v=a>=pp;return Zr(e,"human",{position:t,radius:v?_t:ma,hunger:l,hitpoints:SS,maxHitpoints:SS,age:a,gender:i,isPlayer:s,food:[],maxFood:NA,maxAge:Hl,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:d,fatherId:u,ancestorIds:f,stateMachine:[mt,{enteredAt:n,previousState:void 0}],leaderId:g,tribeInfo:m,aiType:S,aiBlackboard:C.create()})}function zp(e,t,n,i,s,a,l,d,u,f,g){let m,S;switch(l){case"human":m=OA,S=sn;break;case"prey":m=2,S=120;break;case"predator":m=4,S=140;break}return Zr(e,"corpse",{position:t,radius:s,gender:n,age:i,originalEntityId:a,originalEntityType:l,timeOfDeath:d,decayProgress:0,geneCode:g,food:[...Array.from({length:Math.max(m*Math.max(S-f,0)/S,0)},()=>({itemType:"food",type:An.Meat})),...u].map(A=>({...A,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:C.create()})}function Fk(e,t,n,i,s,a,l,d,u){return zp(e,t,n,i,s,a,"human",l,d,u)}function Lk(e,t,n,i,s,a,l,d){return zp(e,t,n,i,s,a,"prey",l,[],0,d)}function Uk(e,t,n,i,s,a,l,d){return zp(e,t,n,i,s,a,"predator",l,[],0,d)}function Hk(e,t,n){const i=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=i?[...i.ancestorIds||[],i.id]:[],l=[...s,...a],d=[...new Set(l)],u=d.slice(Math.max(d.length-DA,0)),f=Math.random()<.5?"male":"female",g=oi(e.position,{x:5,y:5}),m=Xs(n.gameState.entities,g,n.gameState.time,f,!1,0,MA/2,e.id,t,u,(i==null?void 0:i.leaderId)??e.leaderId,(i==null?void 0:i.tribeInfo)??e.tribeInfo,e.aiType);return Ne(n,_e.Birth,e.position),m}function Qr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function ha(e,t,n,i=VD,s=zI,a,l,d,u=$t.BehaviorTreeBased){const f=i>=Ol,g=Date.now();return Zr(e,"prey",{position:t,radius:f?_t*.7:ma*.7,hunger:s,hitpoints:XS,maxHitpoints:XS,age:i,maxAge:YI,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:d,stateMachine:[pi,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:C.create()})}function ga(e,t,n,i=nN,s=XI,a,l,d,u=$t.BehaviorTreeBased){const f=i>=kl,g=Date.now();return Zr(e,"predator",{position:t,radius:f?_t*.9:ma*.9,hunger:s,hitpoints:VS,maxHitpoints:VS,age:i,maxAge:jI,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:d,stateMachine:[mn,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:C.create()})}function Gk(e,t,n,i){const s=ip(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:i,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:ID,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===le.Bonfire?Lr:void 0,maxFuelLevel:n===le.Bonfire?Lr:void 0,aiBlackboard:C.create(),stateMachine:["",{enteredAt:0}]};return Zr(e,"building",a)}var gn=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(gn||{}),Wr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(Wr||{}),pn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(pn||{});const qg={},Zg={},$k=[{key:gn.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:gn.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>Bw,isCompleted:!1,minDisplayTime:FS,highlightedUIElements:[Wr.HUNGER_BAR]},{key:gn.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!be(t,e,"berryBush",ze*5,i=>i.food.length>0),getTargets:(e,t)=>{const n=[];for(const i of Object.values(e.entities.entities))i.type==="berryBush"&&i.food.length>0&&U(t.position,i.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(i);return n.map(i=>i.id)},isCompleted:!1,minDisplayTime:FS},{key:gn.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=be(t,e,"berryBush",ze,i=>i.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:gn.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[Wr.FOOD_BAR]},{key:gn.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>Dn(e,t).length>0,getTargets:(e,t)=>{const n=be(t,e,"human",ze,i=>or(t,i,e));return n?[n.id]:[]},isCompleted:!1},{key:gn.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>Up(e,t).some(i=>i.type===re.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:gn.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[Wr.COMMAND_BUTTONS],isCompleted:!1},{key:gn.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:gn.AUTOPILOT},{key:gn.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=be(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=be(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:gn.ANIMALS_INTRODUCTION},{key:gn.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!be(t,e,"predator",120),getTargets:(e,t)=>{const n=be(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:gn.HUNT_PREY}].map(e=>({...e,condition:e.condition?Yk(e.condition):void 0,getTargets:e.getTargets?zk(e.getTargets):void 0}));function AT(){return{steps:$k.map(e=>({...e,isCompleted:!1}))}}function IT(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:pn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function xk(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function Wk(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const i=vt(e);if(!i){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/oP;switch(n.transitionState){case pn.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=pn.ACTIVE);break;case pn.ACTIVE:{const u=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),f=qg[s.condition];f&&u&&f(e,i)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=pn.FADING_OUT);break}case pn.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const d=xk(e);d!==null?(n.currentStepIndex=d,n.transitionState=pn.FADING_IN):(n.isActive=!1,n.transitionState=pn.INACTIVE)}break}if(n.transitionState!==pn.FADING_OUT&&n.transitionState!==pn.INACTIVE){const d=Zg[s.getTargets||""];d?n.highlightedEntityIds=[...d(e,i)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function Yk(e){const t=`condition_${Object.keys(qg).length+1}`;return qg[t]=e,t}function zk(e){const t=`getTargets_${Object.keys(Zg).length+1}`;return Zg[t]=e,t}function jk(){const e=vT(),t=0;for(let S=0;S<AA;S++){const v={x:Math.random()*Ze,y:Math.random()*Qe};ic(e,v,t)}for(let S=0;S<vA;S++){const v={x:Math.random()*Ze,y:Math.random()*Qe};Vl(e,v,t)}const n=Ze/2,i=Qe/2;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,A=100+Math.random()*100,I={x:n+Math.cos(v)*A,y:i+Math.sin(v)*A};Vl(e,I,t,er)}const s=Xs(e,{x:n-25,y:i},t,"male",!0),a=Xs(e,{x:n+25,y:i},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:Gn[0]},s.aiType=$t.TaskBased,a.aiType=$t.TaskBased;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,A=Ze/2,I=Qe/2,T={x:n+Math.cos(v)*A,y:i+Math.sin(v)*I},P=Xs(e,{x:T.x,y:T.y},t,"male",!1);P.leaderId=P.id,P.tribeInfo={tribeBadge:su[S%su.length],tribeColor:Gn[S%Gn.length]};const R=Xs(e,{x:T.x+50,y:T.y},t,"female",!1);R.leaderId=P.id,R.tribeInfo=P.tribeInfo}for(let S=0;S<qI;S++){const v={x:n+Ze*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};ha(e,v,"male",void 0,void 0,jl()),ha(e,{x:v.x+20,y:v.y},"female",void 0,void 0,jl())}const l={x:n+Ze*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};ga(e,l,"male",void 0,void 0,Xl()),ga(e,{x:l.x+20,y:l.y},"female",void 0,void 0,Xl());const d=[{id:"muteButton",action:de.ToggleMute,currentWidth:io,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Ht},{id:"pauseButton",action:de.TogglePause,currentWidth:io,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Ht},{id:"returnToIntroButton",action:de.ReturnToIntro,currentWidth:io,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:Ht}],u=AT(),f=IT(),g={time:t,entities:e,mapDimensions:{width:Ze,height:Qe},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:kI,isMuted:!1,uiButtons:d,tutorial:u,tutorialState:f,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:zr.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:Ur,preyProcreationCooldown:Hr,predatorGestationPeriod:Gr,predatorProcreationCooldown:$r,preyHungerIncreasePerHour:zo,predatorHungerIncreasePerHour:jo,berryBushSpreadChance:ao},soilDepletion:EA(),temperature:iT(Ze,Qe),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ze/Le)*Math.ceil(Qe/Le)).fill(null),tasks:{}},m=mu(g);return console.log("Game world initialized:",m),m}function Xk(){const e=vT(),t=0;for(let u=0;u<AA;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};ic(e,f,t)}for(let u=0;u<vA;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};Vl(e,f,t)}const n=Ze/2,i=Qe/2;for(let u=0;u<5;u++){const f=u/5*Math.PI*2,g=100+Math.random()*100,m={x:n+Math.cos(f)*g,y:i+Math.sin(f)*g};Vl(e,m,t,er)}for(let u=0;u<pw;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe},g=Math.random()<.5?"male":"female";Xs(e,f,t,g,!1)}for(let u=0;u<qI;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};ha(e,f,"male",void 0,void 0,jl()),ha(e,{x:f.x+20,y:f.y},"female",void 0,void 0,jl())}const s={x:Math.random()*Ze,y:Math.random()*Qe};ga(e,s,"male",void 0,void 0,Xl()),ga(e,{x:s.x+20,y:s.y},"female",void 0,void 0,Xl());const a=AT(),l=IT(),d={time:t,entities:e,mapDimensions:{width:Ze,height:Qe},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Ze/2,y:Qe/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:kI,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:l,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:Ur,preyProcreationCooldown:Hr,predatorGestationPeriod:Gr,predatorProcreationCooldown:$r,preyHungerIncreasePerHour:zo,predatorHungerIncreasePerHour:jo,berryBushSpreadChance:ao},soilDepletion:EA(),temperature:iT(Ze,Qe),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ze/Le)*Math.ceil(Qe/Le)).fill(null),tasks:{}};return mu(d)}const Vk="humanProcreation",Kk="human",qk="human",Zk=ze,Qk=(e,t,n)=>or(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,Jk=(e,t,n)=>{const{gameState:i}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,l=e.gender==="female"?e:t,d=(a.partnerIds||[]).length===0;if(e.stateMachine[0]!==br&&(e.stateMachine=[br,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:n.gameState.time+1}]),t.stateMachine[0]!==br&&(t.stateMachine=[br,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),d&&a.leaderId&&a.leaderId!==a.id){const u=i.entities.entities[a.leaderId];if(u){const f=$g(a,u),g=$g(l,u);if(!f&&!g){const m=lu();a.leaderId=a.id,a.tribeInfo={tribeBadge:m,tribeColor:Gn[Math.floor(Math.random()*Gn.length)]},a.tribeRole=ie.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&l){const u=lu();a.leaderId=a.id,a.tribeInfo={tribeBadge:u,tribeColor:Gn[Math.floor(Math.random()*Gn.length)]},a.tribeRole=ie.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}e.activeAction=void 0,Ge(i,Ce.Procreation,s,xl),Ge(i,Ce.Partnered,e.position,Ke,e.id),Ge(i,Ce.Partnered,t.position,Ke,t.id),e.lastPartneredEffectTime=i.time,t.lastPartneredEffectTime=i.time,t.activeAction=void 0,Ne(n,_e.Procreate,s)},eb={id:Vk,sourceType:Kk,targetType:qk,maxDistance:Zk,checker:Qk,perform:Jk},tb={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:wu,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Qo&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-Qo),e.feedChildCooldownTime=zw,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ce.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Ne(n,_e.ChildFed,t.position)}},nb={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:Sn,checker:(e,t,n)=>{var g,m;if(e.stateMachine[0]!==Jo||e.attackTargetId!==t.id)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=fo,a=!s&&i<=Sn;if(!s&&!a||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?Ru:vp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>fo,l=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),d=KC(ot(l),t.direction);if(Math.abs(d)<oR*Math.PI/180&&Math.random()<rR)Ge(i,Ce.AttackDeflected,t.position,Ke,t.id);else{let g=a?Sp:yp;if(e.gender==="male"&&(g*=tR),e.isAdult||(g*=nR),(!t.isAdult||t.age>=mp)&&e.isAdult&&(g*=iR),a){const S=s/Ap;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+S,data:{attackerId:e.id,targetId:t.id,damage:g,pushbackForce:Tp,attackerPosition:{...e.position}}}),Ge(i,Ce.StoneProjectile,e.position,S,void 0,t.position,t.id),Ne(n,_e.Attack,e.position)}else{t.hitpoints-=g,t.movementSlowdown={modifier:Du,endTime:i.time+Nu},Ge(i,Ce.Hit,t.position,Ke,t.id);const S=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),v=At(S,Zw);t.forces.push(v),t.hitpoints<=0?Ne(n,_e.HumanDeath,t.position):Ne(n,_e.Attack,e.position),Ge(i,Ce.Attack,e.position,Ke,e.id)}}e.attackCooldown={melee:Pu,ranged:Ip};const f=e.stateMachine[1];f.attackStartTime=i.time}},ib={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:_t*2,checker:(e,t,{gameState:n})=>U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const i=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(i===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const a=(e.radius+t.radius-i)*.05,l=ot(VC(e.position,t.position)),d=At(l,a);e.forces.push(d),t.forces.push(At(d,-1))}},ob={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:_t*.6+ec*.4,checker:(e,t,{gameState:n})=>{const i=t.stateMachine[0];if(i==="fallen"||i==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const d=l*2.5,u=ot(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=At(u,d);e.forces.push(f)}},rb={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:_t*.6+ec*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const d=l*2.5,u=ot(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=At(u,d);e.forces.push(f)}},sb={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:_t*.6+ec*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const d=l*2.5,u=ot(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=At(u,d);e.forces.push(f)}},ab={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:ze,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Sa&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Ge(n.gameState,Ce.BushClaimed,t.position,Ke),Ne(n,_e.Gather,e.position)}},lb={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:ze,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Sa&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,Ne(n,_e.Gather,e.position)}},cb={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:ze,checker:(e,t,n)=>e.isAdult&&t.stateMachine[0]===Gt&&t.wood.length>0&&e.stateMachine[0]===Sa&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.wood.pop();i&&(e.heldItem=i),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[co,{enteredAt:n.gameState.time,previousState:Gt}]),Ne(n,_e.Gather,e.position)}},db=[ab,lb,cb],ub={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:yn,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=ZD,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+qD,Ge(n.gameState,Ce.BushClaimed,t.position,Ke,e.id),Ne(n,_e.Gather,e.position))}},fb={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:bs,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=iN;const i=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=At(i,8);t.forces.push(s),e.huntCooldown=sN,t.hitpoints<=0?(Ne(n,_e.HumanDeath,t.position),Ge(n.gameState,Ce.Hit,t.position,Ke,t.id)):(Ge(n.gameState,Ce.Hit,t.position,Ke,t.id),t.fleeCooldown=5,Ne(n,_e.Attack,e.position)),Ge(n.gameState,Ce.Attack,e.position,Ke,e.id)}},hb={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:Sn,checker:(e,t,n)=>{var g,m;if(e.stateMachine[0]!==Jo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=fo,a=!s&&i<=Sn;if(!s&&!a||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?Ru:vp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>fo;let l=(a?Sp:yp)*1.2;if(e.gender==="male"&&(l*=1.3),a){const u=s/Ap;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+u,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Tp,attackerPosition:{...e.position}}}),Ge(i,Ce.StoneProjectile,e.position,u,void 0,t.position,t.id),Ne(n,_e.Attack,e.position)}else{t.hitpoints-=l;const u=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),f=At(u,6);t.forces.push(f),t.hitpoints<=0?(Ne(n,_e.HumanDeath,t.position),Ge(i,Ce.Hit,t.position,Ke,t.id)):(Ge(i,Ce.Hit,t.position,Ke,t.id),t.fleeCooldown=8,Ne(n,_e.Attack,e.position)),Ge(i,Ce.Attack,e.position,Ke,e.id)}e.attackCooldown={melee:Pu,ranged:Ip};const d=e.stateMachine[1];d.attackStartTime=i.time}},gb={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:mi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=VI;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:Du,endTime:n.gameState.time+Nu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=At(s,7);t.forces.push(a),e.attackCooldown=KI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Gp),Ne(n,_e.HumanDeath,t.position),Ge(n.gameState,Ce.Hit,t.position,Ke,t.id)):(Ge(n.gameState,Ce.Hit,t.position,Ke,t.id),Ne(n,_e.Attack,e.position)),Ge(n.gameState,Ce.Attack,e.position,Ke,e.id)}},pb={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:Sn,checker:(e,t,n)=>{var g,m;if(e.stateMachine[0]!==Jo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=fo,a=!s&&i<=Sn;if(!s&&!a||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?Ru:vp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>fo;let l=(a?Sp:yp)*.8;e.gender==="male"&&(l*=1.2);const d=Object.values(i.entities.entities).filter(f=>f.type==="human"&&f.id!==e.id).filter(f=>{const g=f;return Math.sqrt(Math.pow(g.position.x-e.position.x,2)+Math.pow(g.position.y-e.position.y,2))<100&&g.activeAction==="attacking"&&g.attackTargetId===t.id}).length;if(d>0&&(l*=1+d*.2),a){const f=s/Ap;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+f,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Tp,attackerPosition:{...e.position}}}),Ge(i,Ce.StoneProjectile,e.position,f,void 0,t.position,t.id),Ne(n,_e.Attack,e.position)}else{t.hitpoints-=l;const f=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),g=At(f,8);t.forces.push(g),t.hitpoints<=0?(Ne(n,_e.HumanDeath,t.position),Ge(i,Ce.Hit,t.position,Ke,t.id)):(Ge(i,Ce.Hit,t.position,Ke,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),Ne(n,_e.Attack,e.position)),Ge(i,Ce.Attack,e.position,Ke,e.id)}e.attackCooldown={melee:Pu,ranged:Ip};const u=e.stateMachine[1];u.attackStartTime=i.time}},mb={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:yn,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Ge(n.gameState,Ce.Procreation,i.position,Ke,i.id),Ne(n,_e.Procreate,i.position)}},yb={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:qo,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.pregnancyFatherId=e.gender==="male"?e.id:t.id,i.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Ge(n.gameState,Ce.Procreation,i.position,Ke,i.id),Ne(n,_e.Procreate,i.position)}},Sb={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:va,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=fu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-fu),e.feedChildCooldownTime=ZI,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ce.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Ne(n,_e.ChildFed,t.position)}},vb={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:va,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=fu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-fu),e.feedChildCooldownTime=ZI,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ce.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Ne(n,_e.ChildFed,t.position)}},Ab={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:qo,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-Gp),e.eatingCooldownTime=n.gameState.time+2,Ge(n.gameState,Ce.Eating,e.position,Ke,e.id),Ne(n,_e.Gather,e.position))}},Ib={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:mi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=VI;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:Du,endTime:n.gameState.time+Nu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=At(s,7);t.forces.push(a),e.attackCooldown=KI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Gp),Ne(n,_e.HumanDeath,t.position),Ge(n.gameState,Ce.Hit,t.position,Ke,t.id)):(Ge(n.gameState,Ce.Hit,t.position,Ke,t.id),Ne(n,_e.Attack,e.position)),Ge(n.gameState,Ce.Attack,e.position,Ke,e.id)}},Tb={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>{var f;const i=t.buildingType===le.StorageSpot,s=t.buildingType===le.Bonfire;if(!i&&!s||e.stateMachine[0]!==Nl||!t.isConstructed)return!1;const a=e.food.length>0,l=((f=e.heldItem)==null?void 0:f.type)===yt.Wood;if(s&&!l||!a&&!l)return!1;const d=t.storageCapacity??0;return!(t.storedItems.length>=d||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<TD)},perform:(e,t,n)=>{var s;let i=null;if(t.buildingType===le.Bonfire?((s=e.heldItem)==null?void 0:s.type)===yt.Wood&&(i=e.heldItem,e.heldItem=void 0):e.heldItem?(i=e.heldItem,e.heldItem=void 0):i=e.food.pop()??null,i&&(t.storedItems.push({item:i,positionOffset:lT(t)}),t.buildingType===le.Bonfire)){const a=xt(e,n.gameState);a&&a.aiBlackboard&&rT(a.aiBlackboard,t.id,"wood")}t.lastDepositTime=n.gameState.time,Ne(n,_e.StorageDeposit,t.position)}},Eb={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Ml||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<ED),perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&(e.food.push(i.item),lT(t)),t.lastRetrieveTime=n.gameState.time,Ne(n,_e.StorageRetrieve,t.position)}},Cb={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>{var d;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Sa||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const i=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!i||!((d=i.tribeControl)!=null&&d.diplomacy)||(t.ownerId?i.tribeControl.diplomacy[t.ownerId]:void 0)!==Ut.Hostile||n.gameState.time-(t.lastStealTime??0)<CD)return!1;const l=jn({leaderId:t.ownerId},n.gameState);for(const u of l)if(U(e.position,u.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=_D)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&e.food.push(i.item),t.lastStealTime=n.gameState.time,Ne(n,_e.StorageSteal,t.position),Ge(n.gameState,Ce.Attack,t.position,.5)}},_b={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!Vt(e,t,n.gameState)||!zA(t.position,aa,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,KA(t.position,aa,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Ge(n.gameState,Ce.BushClaimed,t.position,2,t.id)}},wb={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!Vt(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Ge(n.gameState,Ce.Hit,t.position,1,t.id)}},Rb={id:"supplyTransfer",sourceType:"human",targetType:"human",maxDistance:ze,checker:(e,t)=>!(e.activeAction!=="depositing"||t.activeAction!=="retrieving"||e.leaderId!==t.leaderId||e.food.length===0||t.food.length>=t.maxFood),perform:(e,t,n)=>{var l;const i=Math.min(((l=e.activeActionPayload)==null?void 0:l.amount)||1,e.food.length,t.maxFood-t.food.length),s=e.food.splice(0,i);t.food.push(...s);const a=xt(t,n.gameState);a&&a.aiBlackboard&&rT(a.aiBlackboard,t.id,"food"),e.activeAction="idle",e.target=void 0,e.activeActionPayload=void 0,t.activeAction="idle",t.target=void 0,Ne(n,_e.StorageDeposit,t.position)}},Pb={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:Cu,checker:(e,t,n)=>{const[i]=t.stateMachine??[],s=i===an||i===Kt||i===vn;return e.isAdult&&s&&e.stateMachine[0]===Hp&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const{gameState:i}=n;if(t.stateMachine=[Gt,{enteredAt:i.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/er),a=Math.floor(qS+s*(Hu-qS));t.wood=Array.from({length:a},()=>({itemType:"item",type:yt.Wood,id:i.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=i.time+1,Ne(n,_e.Gather,e.position)}},Db=[ib,ob,rb,sb,...db,eb,tb,nb,Tb,Eb,Cb,_b,wb,Rb,Pb,ub,Sb,vb,Ab,fb,hb,pb,gb,Ib,mb,yb],uv=Object.values(Db.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const i={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[n].interactions.push(i),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));let fv=0;function Nb(e){const{gameState:t}=e,n=t,{width:i,height:s}=t.mapDimensions;fv++;const a=fv%2===0;for(let l=0;l<uv.length;l++){const d=uv[l],u=n.search[d.sourceType].all();for(let f=0;f<u.length;f++){const g=u[f],m=n.search[d.targetType].byRadius(g.position,d.maxDistance);for(let S=0;S<m.length;S++){const v=m[S];if(g.id===v.id)continue;const A=Si(g.position,v.position,i,s);for(let I=0;I<d.interactions.length;I++){const T=d.interactions[I];!T.isCollision&&a||A<=T.maxDistanceSq&&T.checker(g,v,e)&&T.perform(g,v,e)}}}}}function TT(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function Mb(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),i=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=50+Math.random()*100;a={x:Math.max(50,Math.min(Ze-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*g))}}else a={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let l=!0;const d=100;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){l=!1;break}if(l){for(const u of i)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){l=!1;break}}if(l)return a}return{x:Ze*.3+Math.random()*Ze*.4,y:Qe*.3+Math.random()*Qe*.4}}function Ob(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=100+Math.random()*150;a={x:Math.max(50,Math.min(Ze-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*g))}}else a={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let l=!0;const d=150;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){l=!1;break}if(l)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Ze,y:50+Math.random()*100};case 1:return{x:Ze-150+Math.random()*100,y:Math.random()*Qe};case 2:return{x:Math.random()*Ze,y:Qe-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Qe}}}function kb(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let i=0;i<20;i++){const s={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let a=!0;const l=80,d=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<l){a=!1;break}if(a){for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<d){a=!1;break}}if(a)return s}return{x:Math.random()*Ze,y:Math.random()*Qe}}function ET(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=Mb(n),a=i%2===0?"male":"female";ha(e.entities,s,a,void 0,void 0,jl())}}function CT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=Ob(n),a=i%2===0?"male":"female";ga(e.entities,s,a,void 0,void 0,Xl())}}function bb(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count();let s=!1;return n===0&&(ET(e,6),s=!0),i===0&&(CT(e,3),s=!0),s}function Bb(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const l=Math.max(2,Math.floor(8-n));ET(e,l),a=!0}if(i>0&&i<2){const l=Math.max(1,Math.floor(3-i));CT(e,l),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let l=0;l<5;l++){const d=kb(t);ic(e.entities,d,e.time)}a=!0}return a}const Fb=1,Lb=.3,Ub=.8,hv=.8,Hb=.99,Gb=.05;var _T=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.NO_ACTION=14]="NO_ACTION",e))(_T||{});const gg=Object.keys(_T).length/2;class $b{constructor(){Re(this,"qTable",new Map);Re(this,"epsilon",hv);Re(this,"lastState",null);Re(this,"lastAction",null)}discretizeState(t,n,i){const s=Math.min(4,Math.floor(t/25)),a=Math.min(4,Math.floor(n/5)),l=Math.min(4,Math.floor(i/15));return`${s}-${a}-${l}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,i){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,i)}getBestAction(t){let n=0,i=this.getQValue(t,0);for(let s=1;s<gg;s++){const a=this.getQValue(t,s);a>i&&(i=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*gg):this.getBestAction(t)}applyEmergencyCorrections(t,n,i,s){t<oo*.5&&(s.ecosystem.preyGestationPeriod=Math.max(Gs,s.ecosystem.preyGestationPeriod*.8),s.ecosystem.preyProcreationCooldown=Math.max($s,s.ecosystem.preyProcreationCooldown*.8),s.ecosystem.preyHungerIncreasePerHour=Math.max(Ys,s.ecosystem.preyHungerIncreasePerHour*.9)),n<ro*.6&&(s.ecosystem.predatorGestationPeriod=Math.max(xs,s.ecosystem.predatorGestationPeriod*.75),s.ecosystem.predatorProcreationCooldown=Math.max(Ws,s.ecosystem.predatorProcreationCooldown*.75),s.ecosystem.predatorHungerIncreasePerHour=Math.max(zs,s.ecosystem.predatorHungerIncreasePerHour*.85)),i<so*.5&&(s.ecosystem.berryBushSpreadChance=Math.min(Al,s.ecosystem.berryBushSpreadChance*1.2)),t>oo*1.4&&(s.ecosystem.preyHungerIncreasePerHour=Math.min(zo,s.ecosystem.preyHungerIncreasePerHour*1.05)),n>ro*1.4&&(s.ecosystem.predatorHungerIncreasePerHour=Math.min(jo,s.ecosystem.predatorHungerIncreasePerHour*1.05)),i>so*1.4&&(s.ecosystem.berryBushSpreadChance=Math.max(ao,s.ecosystem.berryBushSpreadChance*.95))}calculateReward(t,n,i){const s=Math.abs(t-oo),a=Math.abs(n-ro),l=Math.abs(i-so),d=s/oo,u=a/ro,f=l/so,g=d+u+f;return 100*Math.exp(-g*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(Ur,n.ecosystem.preyGestationPeriod+.2*(Ur-Gs));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(Gs,n.ecosystem.preyGestationPeriod-.2*(Ur-Gs));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(Hr,n.ecosystem.preyProcreationCooldown+.2*(Hr-$s));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max($s,n.ecosystem.preyProcreationCooldown-.2*(Hr-$s));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(zo,n.ecosystem.preyHungerIncreasePerHour+.2*(zo-Ys));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(Ys,n.ecosystem.preyHungerIncreasePerHour-.2*(zo-Ys));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(Gr,n.ecosystem.predatorGestationPeriod+.2*(Gr-xs));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max(xs,n.ecosystem.predatorGestationPeriod-.2*(Gr-xs));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min($r,n.ecosystem.predatorProcreationCooldown+.2*($r-Ws));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(Ws,n.ecosystem.predatorProcreationCooldown-.2*($r-Ws));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(jo,n.ecosystem.predatorHungerIncreasePerHour+.2*(jo-zs));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(zs,n.ecosystem.predatorHungerIncreasePerHour-.2*(jo-zs));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(Al,n.ecosystem.berryBushSpreadChance+.2*(Al-ao));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(ao,n.ecosystem.berryBushSpreadChance-.2*(Al-ao));break}}updateQTable(t,n,i,s){const a=this.getQValue(t,n),l=Math.max(...Array.from({length:gg},(u,f)=>this.getQValue(s,f))),d=a+Lb*(i+Ub*l-a);this.setQValue(t,n,d)}step(t){const n=t,i=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count();this.applyEmergencyCorrections(i,s,a,t);const l=this.discretizeState(i,s,a);if(this.lastState!==null&&this.lastAction!==null){const u=this.calculateReward(i,s,a);this.updateQTable(this.lastState,this.lastAction,u,l)}const d=this.chooseAction(l);this.applyAction(d,t),this.epsilon=Math.max(Gb,this.epsilon*Hb),this.lastState=l,this.lastAction=d}reset(){this.qTable.clear(),this.epsilon=hv,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let wT=new $b;function xb(e){bb(e),Bb(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=Gs+(Ur-Gs)*.3,e.ecosystem.preyProcreationCooldown=$s+(Hr-$s)*.3,e.ecosystem.preyHungerIncreasePerHour=Ys+(zo-Ys)*.3,e.ecosystem.predatorGestationPeriod=xs+(Gr-xs)*.3,e.ecosystem.predatorProcreationCooldown=Ws+($r-Ws)*.3,e.ecosystem.predatorHungerIncreasePerHour=zs+(jo-zs)*.3,e.ecosystem.berryBushSpreadChance=ao+(Al-ao)*.7),wT.step(e)}function Wb(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<Fb)&&(e.ecosystem.lastUpdateTime=e.time,xb(e))}function Yb(){return wT.getStats()}function zb(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function jb(e){const{gameState:t}=e,n=t.time,i=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of i)switch(a.type){case"ranged-impact":{const l=t.entities.entities[a.data.targetId];if(!l||l.hitpoints<=0)continue;l.hitpoints-=a.data.damage,l.movementSlowdown={modifier:Du,endTime:t.time+Nu};const d=Xe(a.data.attackerPosition,l.position,t.mapDimensions.width,t.mapDimensions.height),u=At(d,a.data.pushbackForce);l.forces.push(u),Ge(t,Ce.Hit,l.position,Ke,l.id),l.hitpoints<=0?Ne(e,_e.HumanDeath,l.position):Ne(e,_e.Attack,l.position);break}}}function Xb(e){var m,S,v;const{gameState:t}=e,n=t,i=n.search.human.all(),s=new Map,a=new Set;for(let A=0;A<i.length;A++){const I=i[A];I.leaderId&&(s.has(I.leaderId)||s.set(I.leaderId,[]),s.get(I.leaderId).push(I),I.leaderId===I.id&&a.add(I.id))}const l=Object.values(t.tasks),d=new Map;for(let A=0;A<l.length;A++){const I=l[A];I.creatorEntityId&&(d.has(I.creatorEntityId)||d.set(I.creatorEntityId,[]),d.get(I.creatorEntityId).push(I))}const u=n.search.building.all(),f=new Map;for(let A=0;A<u.length;A++){const I=u[A];if(I.ownerId){const T=t.entities.entities[I.ownerId],P=T==null?void 0:T.leaderId;P&&(f.has(P)||f.set(P,[]),f.get(P).push(I))}}const g=new Map;for(const A of a)g.set(A,$n(A,t));for(const A of a){const I=t.entities.entities[A];if(!I)continue;const T=s.get(A)||[];if(T.length<Op)continue;const P=T.filter(D=>D.isAdult);if(P.length===0)continue;const R=d.get(A)||[],w=D=>R.some(N=>N.type===D),k=f.get(A)||[],M=[];for(const[D,N]of g.entries())D!==A&&M.push(N);if(!w(se.HumanPlaceStorage)){const D=k.filter(V=>V.buildingType===le.StorageSpot);let N=0,b=0;for(let V=0;V<D.length;V++){const j=D[V];N+=((m=j.storedItems)==null?void 0:m.length)||0,b+=j.storageCapacity||0}const H=b>0?N/b:0;if(D.length===0||H>Fg){const V=D.length===0?GA:qs,j=Zs(le.StorageSpot,A,t,Ji,V,I.position,M);j&&Od(A,se.HumanPlaceStorage,j,t)}}if(!w(se.HumanPlaceBonfire)){const D=k.filter(ee=>ee.buildingType===le.Bonfire),N=g.get(A),H=tr(t.temperature,N,t.time,t.mapDimensions.width,t.mapDimensions.height)<tI&&D.length===0,z=D.length>0&&D.length<Math.ceil(P.length/nI);let V;const j=T.filter(ee=>tr(t.temperature,ee.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<lo+5?D.every(ce=>U(ee.position,ce.position,t.mapDimensions.width,t.mapDimensions.height)>Fr*1.5):!1);if(j.length>=3){const ee=j.reduce((Se,ce)=>Se+ce.position.x,0)/j.length,ne=j.reduce((Se,ce)=>Se+ce.position.y,0)/j.length;V={x:ee,y:ne}}if(H||z||V){const ee=Zs(le.Bonfire,A,t,Ji,qs,V||I.position,M);ee&&Od(A,se.HumanPlaceBonfire,ee,t)}}if(!w(se.HumanPlacePlantingZone)){const N=k.filter(H=>H.buildingType===le.PlantingZone).reduce((H,z)=>H+Np(z),0),b=Math.max(Hs,P.length*Lg);if(N<b){const H=Zs(le.PlantingZone,A,t,Ji,qs,I.position,M);H&&Od(A,se.HumanPlacePlantingZone,H,t)}}if(!w(se.HumanPlaceBorderPost)&&(((v=(S=I.tribeControl)==null?void 0:S.armyControl)==null?void 0:v.expandBorders)??0)>=2){const N=qA(I.position,A,t);N&&Od(A,se.HumanPlaceBorderPost,N,t)}}}function Od(e,t,n,i){const s=`${se[t]}-${e}-${i.time.toFixed(2)}`;i.tasks[s]={id:s,position:n,type:t,creatorEntityId:e,target:n,validUntilTime:i.time+12}}const Vb=1/60;function Kb(e,t){const n=vt(e);n&&(e.viewportCenter=tp(e.viewportCenter,n.position,fp*t))}function zu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(rp(e),e.lastAutosaveTime=n)}for(;t>0;){const n=mu(e),i=Math.min(t,Vb),s=i*(Ct/Dt);n.time+=s,Kb(n,i),uR(n),NO(n),Wb(n),$P(n),WN(n),fR(n),jb({gameState:n}),Bk({gameState:n,deltaTime:i}),Nb({gameState:n,deltaTime:i}),Math.floor(n.time)>Math.floor(n.time-s)&&(PP(n),Xb({gameState:n})),TT(n),Wk(n,i),zb(n),e=n,t-=i}return e}function pg(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,d=lI;if(e.beginPath(),e.moveTo(i+d,s),e.lineTo(i+a-d,s),e.quadraticCurveTo(i+a,s,i+a,s+d),e.lineTo(i+a,s+l-d),e.quadraticCurveTo(i+a,s+l,i+a-d,s+l),e.lineTo(i+d,s+l),e.quadraticCurveTo(i,s+l,i,s+l-d),e.lineTo(i,s+d),e.quadraticCurveTo(i,s,i+d,s),e.closePath(),e.fillStyle=t.isDisabled?cI:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*hI)+1)/2;e.strokeStyle=fI,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<au){const f=1-u/au;e.fillStyle=uI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Rp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?dI:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function qb(e,t,n,i){e.save(),e.font=`${NS}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,l=NS,d=a+MS*2,u=l+MS*2,f=i.x-d/2,g=e.canvas.height,m=t.y<g/2?t.y+t.height-OS:t.y-u+OS;e.fillStyle=G1,e.fillRect(f,m,d,u),e.fillStyle=$1,e.fillText(n,i.x,m+u/2+l/2),e.restore()}function Zb(e,t,n){e.save();const i=vt(t),s=[{id:"fastForwardButton",action:de.FastForward,text:"FFWD [T]",currentWidth:io*1.3,backgroundColor:xo,textColor:Ht,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:de.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?Ad:xo,currentWidth:t.isPaused?io*1.4:io*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:Ht},{id:"muteButton",action:de.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?Ad:xo,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:io,rect:{x:0,y:0,width:0,height:0},textColor:Ht},{id:"returnToIntroButton",action:de.ReturnToIntro,text:"EXIT",backgroundColor:xo,tooltip:"Return to Main Menu [ESC]",currentWidth:io*.9,rect:{x:0,y:0,width:0,height:0},textColor:Ht}];if(t.uiButtons.push(...s),i){const f=Up(t,i),g=new Set(f.map(R=>R.type));let m=[{playerAction:re.Gather,buttonAction:de.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>i.isAdult===!0},{playerAction:re.Eat,buttonAction:de.CommandEat,shortcut:"F",name:"Eat"},{playerAction:re.Plant,buttonAction:de.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>i.isAdult===!0},{playerAction:re.Procreate,buttonAction:de.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>i.isAdult===!0},{playerAction:re.FeedChild,buttonAction:de.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>i.isAdult===!0},{playerAction:re.Attack,buttonAction:de.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>i.isAdult===!0&&i.leaderId===i.id},{playerAction:re.ArmyControl,buttonAction:de.OpenArmyControl,shortcut:"V",name:"Army Control",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Li(i.id,t).length>tD},{playerAction:re.TribeSplit,buttonAction:de.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>i.leaderId!==void 0&&i.leaderId!==i.id&&i.isAdult===!0},{playerAction:re.Build,buttonAction:de.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Li(i.id,t).length>Op},{playerAction:re.Build,buttonAction:de.OpenRoleManager,shortcut:"U",name:"Roles",toggleKey:"roleManagement",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&$u(i,t)}];m=m.filter(R=>R.condition?R.condition():!0);const S=1,v=m.length,A=v*Fn+(v-1)*Ir,I=S*Fn+(S-1)*Ir,T=(n-A)/2,P=e.canvas.height-I-20;if(m.forEach((R,w)=>{const k=w%v,M=Math.floor(w/v),D=T+k*(Fn+Ir),N=P+M*(Fn+Ir),b=!!R.toggleKey,H=b&&t.autopilotControls.behaviors[R.toggleKey],z=!g.has(R.playerAction),j=R.playerAction===re.Build&&t.buildMenuOpen,ee=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",ne=b?`${R.name}${ee}`:R.name,Se=H||j||R.buttonAction===de.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)?Ad:xo,ce={id:`commandButton_${R.name}`,action:R.buttonAction,rect:{x:D,y:N,width:Fn,height:Fn},icon:R.buttonAction===de.OpenRoleManager?"":Bu[R.playerAction],text:R.shortcut,backgroundColor:Se,textColor:Ht,currentWidth:Fn,tooltip:ne,isDisabled:z,activated:H||R.buttonAction===de.CommandBuild&&j||R.buttonAction===de.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)};t.uiButtons.push(ce)}),t.buildMenuOpen){const R=[{id:"buildMenu_storageSpot",action:de.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:de.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_bonfire",action:de.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:de.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:de.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"}],w=R.length,k=w*Fn+(w-1)*Ir,M=(n-k)/2,D=P-Fn-Ir;R.forEach((N,b)=>{const H=M+b*(Fn+Ir),z=D,V=N.action===de.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||N.action===de.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||N.action===de.SelectBorderPost&&t.selectedBuildingType==="borderPost"||N.action===de.SelectBonfire&&t.selectedBuildingType==="bonfire"||N.action===de.SelectRemovalTool&&t.selectedBuildingType==="removal",j={id:N.id,action:N.action,rect:{x:H,y:z,width:Fn,height:Fn},icon:N.icon,text:N.shortcut,backgroundColor:V?Ad:xo,textColor:Ht,currentWidth:Fn,tooltip:N.name,activated:V};t.uiButtons.push(j),pg(e,j,t.hoveredButtonId===j.id)})}}let a=n-et;s.forEach(f=>{const g=et,m=a-f.currentWidth;f.rect={x:m,y:g,width:f.currentWidth,height:aI},pg(e,f,t.hoveredButtonId===f.id),a-=f.currentWidth+H1});let l=null;t.uiButtons.filter(f=>f.id.startsWith("commandButton_")||f.id.startsWith("buildMenu_")).forEach(f=>{l||(l={x:f.rect.x,y:f.rect.y,width:f.rect.width,height:f.rect.height}),l.x=Math.min(l.x,f.rect.x),l.y=Math.min(l.y,f.rect.y),l.width=Math.max(l.width,f.rect.x+f.rect.width-l.x),l.height=Math.max(l.height,f.rect.y+f.rect.height-l.y),f.id.startsWith("commandButton_")&&pg(e,f,t.hoveredButtonId===f.id)});const u=t.hoveredButtonId?t.uiButtons.find(f=>f.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&qb(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:l}}function Qb(e){e.save(),e.fillStyle=q1,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=Z1,e.font=`${Q1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function Qg(e,t,n,i){const s=t.x-n.width/2,a=t.y-n.height/2,l=s+e.x,d=a+e.y,u=(l%i.width+i.width)%i.width,f=(d%i.height+i.height)%i.height;return{x:u,y:f}}function oc(e,t,n,i){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>i.width/2&&(s=s-Math.sign(s)*i.width),Math.abs(a)>i.height/2&&(a=a-Math.sign(a)*i.height),{x:s+n.width/2,y:a+n.height/2}}function Vs(e,t,n,i){const s=oc(e.position,t,n,i),l=("radius"in e?e.radius:20)+20;return s.x>=-l&&s.x<=n.width+l&&s.y>=-l&&s.y<=n.height+l}function ii(e,t,n,i,s,...a){const l={...s.position};for(let d=-n;d<=n;d+=n)for(let u=-t;u<=t;u+=t)s.position.x=l.x+u,s.position.y=l.y+d,i(e,s,...a);s.position=l}function RT(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const i=n.getContext("2d");if(!i)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:n,ctx:i}}function Qs(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function Vr(e,t){return Math.round(e*t)/t}function jp(e,t=8){const i=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(i/(Math.PI*2)*t)%t}function Xp(e,t=8){const n=e/t*Math.PI*2;return[Math.cos(n),Math.sin(n)]}const Jb=25,eB=0,gv=28;function PT(e,t,n,i,s,a,l,d,u,f){e.save();const{x:g,y:m}=oc(t,l,{width:d,height:u},f);e.strokeStyle=i,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(g,m,n+Mu,0,2*Math.PI),e.stroke(),e.restore()}function tB(e,t,n,i,s,a,l){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&PT(e,m.targetEntity.position,m.targetEntity.radius,_p,wp,2,i,s,a,l)}),e.font=`${ua}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:d,y:u}=oc(n.position,i,{width:s,height:a},l);let f=0,g={};t.forEach(m=>{const S=Bu[m.type];if(m.targetEntity){g[m.targetEntity.id]=(g[m.targetEntity.id]||0)+1;const v=m.targetEntity.position.x-i.x+s/2,A=m.targetEntity.position.y-i.y+a/2,I=`${S}${m.key.toUpperCase()}`,T=A-m.targetEntity.radius-Mu-ua/2-(g[m.targetEntity.id]-1)*gv;e.fillText(I,v,T)}else{e.textAlign="left";const v=`${S}${m.key.toUpperCase()}`,A=d+Jb,T=u+eB+f*gv;e.fillText(v,A,T),f++,e.textAlign="center"}}),e.restore()}const Fe=(e,t,n,i,s,a,l)=>{a==="transparent"||i<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*l),Math.floor(n*l),Math.ceil(i*l),Math.ceil(s*l)))},pv=10,mv=10,Ni=6,Zi=4,kd=2,nB=5,ni=4,iB=2,nn=4,oB=2,ft=3,Ds=2,$o=0,bl=$o+Zi-1,fn=bl,Et=bl+ni-1,rB="rgba(0, 0, 0, 0.4)",sB=4,aB=1,Vp={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,i,s,a,l,d="male",u=20,f=[1,0],g=!1,m=0){const S=["dead","stunned"].includes(l),v=S?mv+4:pv,A=S?pv+4:mv+ft,I=.15,T=Math.min(i*(1-2*I)/v,s*(1-2*I)/A),P=v*T,R=A*T,w=t+(i-P)/2,k=n+(s-R)/2;e.save(),f[0]<0&&!S?(e.translate(w+P,k),e.scale(-1,1)):e.translate(w,k);const D="#D09A5A",N=u>50?"#BDBDBD":"#281808",b="#7F5C4A",H="#6B4F3A",z="#E0D8C0",V="#A0522D",j=1-Math.max(0,Math.min(100,m))/100*.2,ee=d==="male"?1.1:.9,ne=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let Se=nB*j*ee*ne,ce=iB*j*ee*ne,oe=oB*j*ne;g&&d==="female"&&(Se*=1.5);const X=Math.round((v-Se)/2),q=Math.round((v-Ni)/2),Z=X-ce,F=X+Se,Y=1,ue=X+(Se/2-Y/2)-oe,pe=X+(Se/2+Y/2),Pe=f[1]<-.2&&Math.abs(f[0])<.7,me=fe=>{e.fillStyle=rB,e.beginPath();const ve=v/2,xe=fe;e.ellipse(Math.floor(ve*T),Math.floor(xe*T),Math.max(1,Math.floor(sB*T)),Math.max(1,Math.floor(aB*T)),0,0,2*Math.PI),e.fill()},Me=(fe,ve)=>{d==="male"?(Fe(e,X,bl+fe,Se,ni-Ds,ve,T),Fe(e,X,bl+ni-Ds+fe,Se,Ds,b,T)):Fe(e,X,bl+fe,Se,ni,H,T)},De=(fe,ve)=>{Pe?Fe(e,q,$o+fe,Ni,Zi,N,T):(Fe(e,q,$o+fe,Ni,Zi,ve,T),Fe(e,q,$o+fe,Ni,kd,N,T),d==="female"?(Fe(e,q-1,$o+kd+fe,1,Zi,N,T),Fe(e,q+Ni,$o+kd+fe,1,Zi,N,T)):Fe(e,q+1,$o+2+fe,Ni-2,Zi-2,N,T))};switch(l){case"idle":{const fe=a*Math.PI*2,ve=Math.sin(fe)*.5,Te=(Math.cos(fe*2)+1)*.25;me(Et+ft+1),Fe(e,ue+ve,Et+Te,oe,ft,D,T),Fe(e,pe-ve,Et+Te,oe,ft,D,T),Me(Te,D),Fe(e,Z,fn+Te,ce,nn,D,T),Fe(e,F,fn+Te,ce,nn,D,T),De(Te,D);break}case"walk":{const fe=a*Math.PI*2,ve=Math.sin(fe)*2,Te=Math.abs(Math.cos(fe))*1;me(Et+ft+1),Fe(e,ue+ve,Et+Te,oe,ft,D,T),Fe(e,pe-ve,Et+Te,oe,ft,D,T),Me(Te,D),Fe(e,Z-ve,fn+Te,ce,nn,D,T),Fe(e,F+ve,fn+Te,ce,nn,D,T),De(Te,D);break}case"gathering":{const fe=a*Math.PI*2,ve=1,xe=(Math.sin(fe)+1)/2*2,Te=ve+Math.abs(Math.cos(fe))*.5;me(Et+ft+1),Fe(e,ue,Et+Te,oe,ft-ve,D,T),Fe(e,pe,Et+Te,oe,ft-ve,D,T),Me(Te,D),Fe(e,Z+1,fn+Te-xe,ce,nn,D,T),Fe(e,F-1,fn+Te-xe,ce,nn,D,T),De(Te,D);break}case"eat":{me(Et+ft+1),Fe(e,ue,Et+1,oe,ft-1,D,T),Fe(e,pe,Et+1,oe,ft-1,D,T),Me(1,D);const xe=(Math.sin(a*Math.PI*4)+1)/2,Te=q+Ni/2,si=$o+Zi/2,nt=F+(Te-F)*xe,at=fn+1+(si-(fn+1))*xe;Fe(e,Z,fn+1,ce,nn,D,T),Fe(e,nt,at,ce,nn,D,T),Fe(e,nt,at-1,1,1,V,T),De(1,D);break}case"procreate":{const fe=(Math.sin(a*Math.PI*8)+1)/4,ve=(Math.sin(a*Math.PI*6)+1)*.5,xe=1.5,Te=xe-ve;me(Et+ft+1),Fe(e,ue,Et+Te,oe,ft-xe,D,T),Fe(e,pe,Et+Te,oe,ft-xe,D,T),Me(Te,D),Fe(e,Z,fn+Te,ce,nn,D,T),Fe(e,F,fn+Te,ce,nn,D,T),De(Te,D),e.globalAlpha=fe,Me(Te,"white"),e.globalAlpha=1;break}case"attacking":{const fe=Math.sin(a*Math.PI)*1.5,ve=Math.abs(Math.sin(a*Math.PI));me(Et+ft+1),Fe(e,ue-fe,Et+ve,oe,ft,D,T),Fe(e,pe+fe*.5,Et+ve,oe,ft,D,T),Me(ve,D),Fe(e,Z,fn+ve-2,ce,nn,D,T),Fe(e,F,fn+ve-2.5,ce,nn,D,T),De(ve,D);break}case"defending":{me(Et+ft+1),Fe(e,ue,Et+1,oe,ft-1,D,T),Fe(e,pe,Et+1,oe,ft-1,D,T),Me(1,D),Fe(e,Z-1,fn+1-1,ce,nn,D,T),Fe(e,F+1,fn+1-1,ce,nn,D,T),De(1,D);break}case"stunned":case"dead":{const fe=l==="dead",ve=fe?Math.min(1,a):0,xe=ve>.5?z:D,Te=d==="male"?b:H,si=ve>.8?"transparent":N,nt=v/2,at=A/2,vi=2;me(A-1),Fe(e,nt-oe-vi,at,oe,ft,xe,T),Fe(e,nt+vi,at,oe,ft,xe,T),Fe(e,nt-ce-vi,at-ni+1,ce,nn,xe,T),Fe(e,nt+vi,at-ni+1,ce,nn,xe,T);const In=nt-Se/2,Xn=at-ni/2;d==="male"?(ve<.7&&Fe(e,In,Xn+ni-Ds,Se,Ds,Te,T),Fe(e,In,Xn,Se,ni-Ds,xe,T)):ve<.7?Fe(e,In,Xn,Se,ni,Te,T):Fe(e,In,Xn,Se,ni,xe,T);const Ai=nt-Ni/2,Ii=at-ni/2-Zi+1;if(Fe(e,Ai,Ii,Ni,Zi,xe,T),si!=="transparent"&&Fe(e,Ai,Ii,Ni,kd,si,T),fe&&ve>.6){const ho="#B0A890";for(let sr=0;sr<3;sr++)Fe(e,In+1,Xn+sr*1+1,Se-2,.5,ho,T)}break}default:Fe(e,0,0,v,A,"magenta",T);break}e.restore()}};function lB(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function Kl(e,t,n,i,s,a=!1,l=!1,d=!1,u=!1){i<pp&&(n=n*.75),Vp.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,i,[0,0],!1,0);let f,g;a?(f=N1,g=iI):l?(f=M1,g=sI):d?(f=O1,g=rI):u&&(f=k1,g=oI),f&&g&&lB(e,t,n/2,f,g)}function cB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s,d=4;let u;const f=l+(i.length-1)*d;i.length>1&&f>a?u=(a-l)/(i.length-1):u=d,i.length<=1&&(u=0);for(let g=0;g<i.length;g++){const{member:m,isPlayer:S,isHeir:v,isPartner:A,isParent:I}=i[g],T=t+g*(s+u)+s/2,P=n+s/4;Kl(e,{x:T,y:P},s,m.age,m.gender,S,v,A,I)}e.restore()}function dB(e,t,n,i,s){if(n.length===0)return;e.save();const a=Ri,l=" 00",d=" 00";e.font=`${Vh}px "Press Start 2P", Arial`;const u=e.measureText(l).width,f=e.measureText(d).width,g=Ri+ei+Ri+ei+Ri+bo+u+Ri/2+bo+f,m=n.length*vd+(n.length-1)*PS,S=s-m-Ri;e.fillStyle=B1,e.fillRect(a,S,g,m);for(let v=0;v<n.length;v++){const A=n[v],I=S+v*(vd+PS),T=I+vd/2;A.isPlayerTribe&&(e.fillStyle=b1,e.fillRect(a,I,g,vd));let P=a+Ri;if(e.font=`${ei}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillText(A.tribeBadge,P,T-ei/4),P+=ei+Ri,!A.isPlayerTribe){const R=A.diplomacyStatus===Ut.Friendly?"":"",w=`diplomacyButton_${A.leaderId}`,k={x:P-2,y:T-ei/2-2,width:ei+4,height:ei+4},M={id:w,action:de.ToggleDiplomacy,rect:k,text:"",icon:R,backgroundColor:"transparent",textColor:"white",currentWidth:ei,tooltip:`Toggle diplomacy with this tribe (Currently: ${A.diplomacyStatus})`,targetTribeId:A.leaderId};t.uiButtons.push(M),t.hoveredButtonId===w&&(e.fillStyle=Rp,e.globalAlpha=.5,e.fillRect(k.x,k.y,k.width,k.height),e.globalAlpha=1),e.font=`${ei*.8}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="center",e.fillText(R,P+ei/2,T)}P+=ei+Ri,A.adultCount>0&&(Kl(e,{x:P+bo/2,y:T},bo,25,"male"),P+=bo/2,e.font=`${Vh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${A.adultCount}`,P,T),P+=e.measureText(` ${A.adultCount}`).width+Ri/2),A.childCount>0&&(Kl(e,{x:P+bo/2,y:T},bo,1,"female"),P+=bo/2,e.font=`${Vh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${A.childCount}`,P,T))}e.restore()}function uB(e,t,n,i,s){const a=yI,l=SI,d=t+i-a-l,u=n+l;e.save(),e.lineWidth=2,e.strokeStyle=s?lP:aP,e.beginPath();const f=5;e.moveTo(d+f,u+f),e.lineTo(d+a-f,u+a-f),e.moveTo(d+a-f,u+f),e.lineTo(d+f,u+a-f),e.stroke(),e.restore()}function fB(e,t,n,i){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===pn.INACTIVE)return;const l=a.steps[s.currentStepIndex];if(!l)return;e.save(),e.globalAlpha=s.transitionAlpha;const d=J1,u=eP,f=tP,g=`${Zh}px "Press Start 2P", Arial`,m=`${BS}px "Press Start 2P", Arial`,S=iP,v=BS*1.5;e.font=m;const A=l.text.split(" ");let I="";const T=[];for(let z=0;z<A.length;z++){const V=I+A[z]+" ";e.measureText(V).width>d-u*2&&z>0?(T.push(I),I=A[z]+" "):I=V}T.push(I);const P=u*2+Zh+u/2+T.length*v,R=(n-d)/2,w=i-P-160;e.fillStyle=nP,e.beginPath(),e.moveTo(R+f,w),e.lineTo(R+d-f,w),e.quadraticCurveTo(R+d,w,R+d,w+f),e.lineTo(R+d,w+P-f),e.quadraticCurveTo(R+d,w+P,R+d-f,w+P),e.lineTo(R+f,w+P),e.quadraticCurveTo(R,w+P,R,w+P-f),e.lineTo(R,w+f),e.quadraticCurveTo(R,w,R+f,w),e.closePath(),e.fill(),e.fillStyle=S,e.textAlign="center",e.textBaseline="top",e.font=g,e.fillText(l.title,R+d/2,w+u),e.font=m;let k=w+u+Zh+u/2;for(const z of T)e.fillText(z,R+d/2,k),k+=v;const M=t.hoveredButtonId==="tutorial-dismiss";uB(e,R,w,d,M),e.restore();const D=yI,N=SI,b=R+d-D-N,H=w+N;return{x:b,y:H,width:D,height:D}}function mg(e,t,n){e.save();const i=sP,s={x:t.x-i,y:t.y-i,width:t.width+i*2,height:t.height+i*2};e.strokeStyle=pI,e.lineWidth=mI+Math.sin(n*Pp)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function hB(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const DT=10,gB=3,yv=DT*.7;function pB(e,t){const{position:n,food:i,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,DT,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),i.length>0){const a=Math.PI*2/Math.min(i.length,s);for(let l=0;l<i.length;l++){const d=l*a,u=n.x+yv*Math.cos(d),f=n.y+yv*Math.sin(d);e.beginPath(),e.arc(u,f,gB,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const Sv=(e,t,n=70,i=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${i}%)`},mB=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[i,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${i}, ${s}%, ${Math.max(0,a-t)}%)`},bd=(e,t,n,i,s,a,l,d=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=d?mB(l,15):l,e.beginPath(),e.roundRect(-i/2,0,i,s,i/2),e.fill(),e.restore()},yg=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),i=75;if(!n)return`hsl(0, 0%, ${i}%)`;const[,s,a,l]=n.map(Number),d=a*(1-t),u=l+(i-l)*t;return`hsl(${s}, ${d}%, ${u}%)`},NT={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,i,s,a,l,d={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=i*.15,f=t+i/2,g=n+s/2,m=i-u*2,S=s-u*2,{gender:v,age:A,direction:I,isPregnant:T,hungryLevel:P,geneCode:R}=d,w=.8+Math.min(A,10)/10*.4,k=v==="male"?1.05:.95,M=1-P/100*.3,D=m*.5*M*w*k;let N=S*.3*w*k;const b=m*.15*w*k,H=D*.2,z=S*.3,V=Sv(R,0,30,50);let j=Sv(R,8,50,40);if(A>45){const me=Math.min(1,(A-45)/15);j=yg(j,me)}e.translate(f,g),I[0]<0&&e.scale(-1,1);const ee=Math.sin(a*Math.PI*2),ne=Math.cos(a*Math.PI*2),Se=z+N*.2;if(l==="dead"){const me=Math.min(a,1);e.translate(0,S*.2),e.rotate(Math.PI/2);const Me=yg(j,me),De=yg(V,me);e.globalAlpha=.5+me*.5,e.strokeStyle=Me,e.lineWidth=H*.5,e.beginPath(),e.moveTo(-D*.4,0),e.lineTo(D*.4,0),e.stroke();for(let fe=-1;fe<=1;fe+=1)e.beginPath(),e.arc(0,0,N*.4,Math.PI*.4*fe-Math.PI*.2,Math.PI*.4*fe+Math.PI*.2),e.stroke();e.fillStyle=De,e.beginPath(),e.arc(D*.5,0,b,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(D*.55,0,b*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,Se,D*.7,D*.25,0,0,2*Math.PI),e.fill();let ce=0,oe=0,X=0,q=0,Z=0,F=0;switch(l){case"idle":oe=ee*(S*.02),X=ee*.05,q=-ee*.05,Z=-ee*.05,F=ee*.05;break;case"walk":oe=Math.abs(ne)*(S*-.04),X=ee*.7,q=-ee*.7,Z=-ee*.7,F=ee*.7;break;case"eat":ce=S*.1,oe=S*.05,ce+=ee*(S*.02);break;case"procreate":oe=S*.05;const me=(1-ne)*-m*.05;e.translate(me,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}T&&v==="female"&&(N*=1.6);const Y=oe,ue=Y-N*.2;bd(e,D*-.35,ue,H,z,Z,j,!0),bd(e,D*.35,ue,H,z,F,j,!0),e.fillStyle=j,e.beginPath(),e.ellipse(0,Y,D/2,N/2,0,0,2*Math.PI),e.fill();const pe=D*.45,Pe=ue+ce;e.fillStyle=V,e.beginPath(),e.arc(pe,Pe,b,0,Math.PI*2),e.fill(),I[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(pe+b*.3,Pe-b*.2,b*.15,0,Math.PI*2),e.fill()),bd(e,D*-.35,ue,H,z,X,j),bd(e,D*.35,ue,H,z,q,j),e.restore()}};function yB(e,t){let[n,i,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),i=Math.max(0,i-t),s=Math.max(0,s-t),`rgb(${n}, ${i}, ${s})`}function SB(e){const t=(e&16711680)>>16,n=(e&65280)>>8,i=e&255,s=`rgb(${t}, ${n}, ${i})`,a=yB(s,40),l=(e&255)%100+50,d=(e>>8&255)%100,u=(e>>16&255)%100,f=`rgb(${l}, ${d}, ${u})`,g=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:f,eyeColor:g}}const MT={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,i,s,a,l,d={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:f,direction:g,isPregnant:m,hungryLevel:S,geneCode:v}=d;e.save();const A=i*.15,I=Math.max(1,Math.floor((i-A*2)/10)),T=g[0]<0;e.translate(t+i/2,n+s/2),T&&e.scale(-1,1);const P=SB(v),R=.8+Math.min(f,20)/20*.4,w=u==="male"?1.05:.95,k=1-S/100*.25,M=R*w*k,D=Math.max(0,Math.min(1,(f-15)/5));e.filter=`grayscale(${D})`;const N=P.furColor,b=P.darkerFurColor,H=P.eyeColor,z="#FFFFFF",V="#c75c5c",j="#E0E0E0",ee="#A0A0A0",ne=s/2-2*I,Se=Math.sin(a*Math.PI*2),ce=Math.abs(Se);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,ne,I*4,I,0,0,2*Math.PI),e.fill(),e.filter="none",l==="dead"){const nt=Math.min(1,a*2);e.save(),e.translate(0,ne-I*3),e.rotate(-Math.PI/2);const at=(vi,In,Xn,Ai,Ii=!1)=>{e.fillStyle=Ii?ee:j,e.fillRect(vi*I,In*I,Xn*I,Ai*I)};nt<1&&(e.globalAlpha=1-nt,e.fillStyle=N,e.beginPath(),e.ellipse(0,0,I*3,I*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),nt>0&&(e.globalAlpha=nt,at(-1,-4,2,2),at(1,-3.5,1,1,!0),at(-.5,-2,1,5,!0),at(-2.5,-1,5,.5),at(-2.5,0,5,.5),at(-2.5,1,5,.5),at(-3,-2,-1,2,!0),at(3,-2,1,2),at(-3,2,-1,2,!0),at(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=N;let oe=0,X=0,q=0,Z=[0,0,0,0];switch(l){case"idle":oe=Se*I*.1;break;case"walk":const nt=Math.sin(a*Math.PI*4);oe=Math.abs(nt)*-I*.5,Z=[nt*I,-nt*I,-nt*I,nt*I];break;case"attacking":const at=Math.sin(a*Math.PI*4);X=I*2+at*I,q=I*2,oe=I;break;case"eat":q=I*3+ce*I,oe=I*1.5,e.fillStyle=V,e.fillRect(-I,ne-I,I*2,I);break;case"procreate":oe=Math.sin(a*Math.PI*8)*I*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let In=0;In<5;In++){const Xn=(Math.random()-.5)*I*8,Ai=ne+(Math.random()-.5)*I*2;ce>.5&&e.fillRect(Xn,Ai,I*.5,I*.5)}break}const F=I*3*M*(m?1.3:1),Y=I*5*M,ue=-Y/1.5,pe=ne-F-I*2.5+oe;e.fillStyle=N,e.beginPath(),e.moveTo(ue-I*.5,pe+F*.5),e.quadraticCurveTo(ue-I*3,pe-I,ue-I*2+Se*I,pe+F+I),e.fill();const Pe=I*1.2*M,me=I*3*M,Me=I*2.5*M,De=ue+Y*.8,fe=ue+Y*.2;e.fillStyle=b,e.fillRect(fe,ne-Me,Pe,Me+Z[2]),e.fillRect(De,ne-me,Pe,me+Z[0]),e.fillStyle=N,e.beginPath(),e.moveTo(ue,pe+F),e.lineTo(ue,pe+I),e.quadraticCurveTo(ue+Y/2,pe,ue+Y,pe+I),e.lineTo(ue+Y,pe+F),e.fill(),e.fillStyle=N,e.fillRect(fe+I/2,ne-Me,Pe,Me+Z[3]),e.fillRect(De+I/2,ne-me,Pe,me+Z[1]);const ve=I*3.5*M,xe=ue+Y-ve*.3+X,Te=pe-ve*.3+q;e.fillStyle=N,e.beginPath(),e.arc(xe,Te,ve/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(xe+ve*.4,Te+ve*.2,I*1.5,I,0,0,Math.PI*2),e.fill(),g[1]>=0&&(e.fillStyle=H,e.fillRect(xe+I*.5,Te-I*.5,I*.5,I*.5),l==="attacking"&&(e.fillStyle=z,e.fillRect(xe+ve*.5,Te+ve*.4,I,I*.4))),e.fillStyle=b,e.beginPath(),e.moveTo(xe-ve*.4,Te-ve*.3),e.lineTo(xe,Te-ve*.7),e.lineTo(xe,Te-ve*.2),e.fill(),e.restore()}};class rc{constructor(t=200){Re(this,"cache",new Map);Re(this,"maxSize");this.maxSize=t}getOrRender(t,n,i,s){const a=this.cache.get(t);if(a)return this.cache.delete(t),this.cache.set(t,a),a;const{canvas:l,ctx:d}=RT(n,i);if(s(d),this.cache.size>=this.maxSize){const u=this.cache.keys().next().value;u!==void 0&&this.cache.delete(u)}return this.cache.set(t,l),l}clear(){this.cache.clear()}}const vB=9,AB=new rc(200);function IB(e,t){const{position:n,gender:i,age:s,decayProgress:a,food:l,radius:d,originalEntityType:u,geneCode:f}=t,g=Vr(a,20),m=Math.floor(s),S=`${u}_${i}_${m}_${g}_${d}_${f||0}`,v=Math.ceil(d*2)+4,A=AB.getOrRender(S,v,v,I=>{I.translate(v/2,v/2),u==="human"?Vp.render(I,-v/2+2,-v/2+2,v-4,v-4,g,"dead",i,m,[0,0],!1,0):u==="prey"?NT.render(I,-v/2+2,-v/2+2,v-4,v-4,g,"dead",{gender:i,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}):u==="predator"&&MT.render(I,-v/2+2,-v/2+2,v-4,v-4,g,"dead",{gender:i,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024})});if(e.save(),e.globalAlpha=1-a,e.drawImage(A,n.x-A.width/2,n.y-A.height/2),e.restore(),l.length>0){e.save(),e.font=`${vB}px Arial`,e.textAlign="center",e.textBaseline="middle";const I=_t*.9,T=Math.PI/NA*3;l.forEach((P,R)=>{const w=R*T,k=n.x+I*Math.cos(w)*Math.atan2(R,R),M=n.y+I*Math.sin(w)*Math.atan2(R,R),D=hp[P.type];e.fillText(D,k,M)}),e.restore()}}function Xo(e,t,n,i,s,a,l,d){e.save(),e.fillStyle=l,e.fillRect(t,n,i,s),e.fillStyle=d,e.fillRect(t,n,i*Math.max(0,a),s),e.restore()}function TB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s;let d;l>a||l+(i.length-1)*4>a?d=(a-l)/(i.length-1):d=4,i.length===1&&(d=0);for(let u=0;u<i.length;u++){const f=hp[i[u].type];e.fillText(f,t+u*(s+d),n)}e.restore()}function EB(e,t,n,i,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let l,d=_t/2;const u=Bu[a.action],f=NI[a.action],g=`${u} ${f}`;if("targetEntityId"in a){const m=t.entities.entities[a.targetEntityId];m&&(l=m.position,d=m.radius)}else"position"in a&&(l=a.position);if(l){PT(e,l,d,_p,wp,2,n,i,s,t.mapDimensions),e.save(),e.font=`${ua}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:S}=oc(l,n,{width:i,height:s},t.mapDimensions),v=S-d-Mu-ua/2;e.fillText(g,m,v),e.restore()}}function CB(e,t,n,i,s){e.save();const a=(Math.sin(s*Pp)+1)/2,l=n+Mu+a*5;e.strokeStyle=_p,e.lineWidth=2,e.setLineDash(wp),e.beginPath(),e.arc(t.x,t.y,l,0,Math.PI*2),e.stroke(),e.setLineDash([]);const d=Bu[i],u=NI[i];if(d){e.font=`${ua*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const f=t.y-l-25;e.fillText(d,t.x,f),e.font=`${ua*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,f+25)}e.restore()}function _B(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(vt(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const l=t.entities.entities[n.targetEntityId];l&&(s=l.position,a=l.radius||(l.type==="building"?20:30))}if(s){const l=(d,u)=>{CB(d,u.position,a,n.action,t.time)};ii(e,t.mapDimensions.width,t.mapDimensions.height,l,{position:{...s}},s,a+30)}}}function vv(e,t,n,i,s,a,l=!0){const d=t.split(" ");let u="";const f=[];for(let g=0;g<d.length;g++){const m=u+d[g]+" ";e.measureText(m).width>s&&g>0?(f.push(u),u=d[g]+" "):u=m}if(f.push(u),l)for(let g=0;g<f.length;g++)e.fillText(f[g],n,i+g*a);return f.length*a}function wB(e){return 1-Math.pow(1-e,3)}function RB(e,t,n,i){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(l=>!l.isDismissed);if(s.length===0)return;e.save();let a=i-yP;for(const l of s){const d=n-Td-Tr;e.font=`${Qh}px "Press Start 2P", Arial`;const u=d+Tr,f=Td-Tr*2,g=vv(e,l.message,-9999,-9999,f,Qh*1.2,!1),m=Tr*2+g+Pi,S=a-m,v=Date.now()-l.creationTime,A=Math.min(v/mP,1),I=wB(A),T=i,P=T+(S-T)*I;e.fillStyle=dP,e.beginPath(),e.roundRect(d,P,Td,m,cP),e.fill(),e.fillStyle=uP,e.textBaseline="top",vv(e,l.message,u,P+Tr,f,Qh*1.2,!0);const R=P+m-Pi-Tr/2,w=d+Td-Pi-Tr/2,k={x:w,y:R,width:Pi,height:Pi};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[l.id]=k);const M=t.hoveredButtonId===`notification-dismiss-${l.id}`;if(e.fillStyle=M?US:fP,e.font=`${Pi}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",k.x+k.width/2,k.y+k.height/2),l.targetEntityIds||l.targetPosition||l.targetArea||l.targetRadius){const b={x:w-Pi-LS,y:R,width:Pi,height:Pi};t.notificationButtonRects&&(t.notificationButtonRects.view[l.id]=b);const H=t.hoveredButtonId===`notification-view-${l.id}`;e.fillStyle=H?US:hP,e.font=`${Pi*(H?1.5:1.2)}px Arial`,e.fillText("",b.x+b.width/2,b.y+b.height/2)}a-=m+LS}e.restore()}function PB(e){return e.length===0?0:e.reduce((n,i)=>n+i,0)/e.length}function Sg(e,t,n,i,s,a,l,d){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(i,s,a,l),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(i,s,a,l);const u=PB(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,i+et,s+et+8);const f=Math.max(...n,1),g=n.map(m=>m/f*l);if(e.beginPath(),e.strokeStyle=d,e.lineWidth=2,g.length>1){e.moveTo(i,s+l-g[0]);for(let m=1;m<g.length;m++){const S=i+m/(g.length-1)*a,v=s+l-g[m];e.lineTo(S,v)}}else if(g.length===1){const m=s+l-g[0];e.moveTo(i,m),e.lineTo(i+a,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${f.toFixed(2)}ms`,i+a-et,s+et+8),e.restore()}function DB(e,t,n){const{performanceMetrics:i}=t;if(!i)return;const s=280,a=240,l=n-s-et,d=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(l,d,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(l,d,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=d+et+5;const f=l+et;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",f,u),u+=25,e.fillStyle="white",e.font="12px monospace";const g=NB(t);e.fillText(`FPS: ${g.toFixed(1)}`,f,u),u+=20;const m=s-et*2,S=45,v=10;Sg(e,"Render",vg(t,"renderTime"),f,u,m,S,"#4CAF50"),u+=S+v,Sg(e,"World Update",vg(t,"worldUpdateTime"),f,u,m,S,"#2196F3"),u+=S+v,Sg(e,"AI Update",vg(t,"aiUpdateTime"),f,u,m,S,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",l+s/2,d+a-10),e.restore()}function NB(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(Ct/Dt);return t.history.filter(a=>n-a.bucketTime/(Ct/Dt)<1).length}function MB(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const l=Math.floor(a.bucketTime/(Ct/Dt));n.set(l,(n.get(l)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function vg(e,t){return MB(e.performanceMetrics.history,t)}function OB(e,t,n,i){const{debugCharacterId:s,time:a}=t,l=500,d=Math.min(i*.9,800),u=n-l-10,f=et+it*2;t.debugPanelRect={x:u,y:f,width:l,height:d},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(u,f,l,d),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(u,f,l,d),e.fillStyle="white",e.font="12px monospace",e.textAlign="left",e.textBaseline="top";let g=f+20;const m=u+15;if(e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Behavior Tree Debugger",m,g),g+=25,!s){e.fillStyle="#888",e.font="12px monospace",e.fillText("No character selected for debugging.",m,g),e.fillText("Click on a character to inspect behavior.",m,g+20),e.restore();return}const S=t.entities.entities[s];if(!S){e.fillStyle="#ff4444",e.font="12px monospace",e.fillText(`Character #${s} not found (might be dead).`,m,g),e.restore();return}if(!S.aiBlackboard){e.fillStyle="#ffaa44",e.font="12px monospace",e.fillText(`Character #${s} has no AI Blackboard.`,m,g),e.restore();return}e.fillStyle="white",e.font="12px monospace",e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,m,g),g+=20,kB(e,S,a,m,g,l-30,d-(g-f)-10,t),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '~' to toggle this debugger",u+l/2,f+d-10),e.restore()}function kB(e,t,n,i,s,a,l,d){var P,R;const u=t.aiBlackboard.nodeExecutionData,f=t.type==="human"?gT:t.type==="predator"?mT:t.type==="prey"?pT:null;if(!f)return;const g=((P=d.debugPanelScroll)==null?void 0:P.x)??0,m=((R=d.debugPanelScroll)==null?void 0:R.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-g,-m),e.font=`${x1}px Arial`,e.textAlign="left",e.textBaseline="top";const S=w=>{switch(w){case E.SUCCESS:return Y1;case E.FAILURE:return z1;case E.RUNNING:return j1;case E.NOT_EVALUATED:case null:default:return X1}};let v=0;const A=(w,k)=>{if(!w.name||!u[w.name])return k;let M=k;const D=M+qh>s+m&&M<s+l+m,N=u[w.name],b=i+(w.depth??0)*W1;let H=E.NOT_EVALUATED,z=kS,V="";if(N){H=N.status,V=N.debugInfo;const oe=K1/Dt*Ct,X=n-N.lastExecuted,q=Math.max(0,1-X/oe);z=qC(kS,V1,q),X>la&&(H=E.NOT_EVALUATED)}const j=S(H),ee=` ${w.name}`+(V?`: ${V}`:""),ne=e.measureText(ee).width,Se=al+bS,ce=b-i+8+ne+Se;if(ce>v&&(v=ce),D&&(e.fillStyle=j,e.fillText("",b,M),e.fillStyle=z,e.fillText(ee,b+8,M),N&&N.executionHistory.length>0)){const{executionHistory:oe}=N,X=gI/Dt*Ct,q=n,Z=q-X,F=i+a-al-bS;let Y=F;const ue=M+(qh-Id)/2,pe=oe.filter(Te=>Te.time<Z);let Pe=pe.length>0?pe[pe.length-1].status:null,me=Z;const Me=oe.filter(Te=>Te.time>=Z&&Te.time<=q),De=al/X;e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(F,ue,al,Id);for(const Te of Me){const nt=(Te.time-me)*De;nt>0&&(e.fillStyle=S(Pe),e.fillRect(Y,ue,nt,Id),Y+=nt),Pe=Te.status,me=Te.time}n-me>la&&(Pe=E.NOT_EVALUATED);const ve=(q-me)*De;e.fillStyle=S(Pe);const xe=F+al-Y;e.fillRect(Y,ue,Math.min(ve,xe),Id)}if(M+=qh,w.children)for(const oe of w.children)M=A(oe,M);else w.child&&(M=A(w.child,M));return M},T=A(f,s)-s;d.debugPanelContentSize={width:v,height:T},e.restore()}function gu(e,t,n,i,s,a,l){e.save();const{position:d}=t;e.strokeStyle=i,e.lineWidth=s+Math.sin(l*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(d.x,d.y,n,0,2*Math.PI),e.stroke(),e.restore()}function bB(e,t,n,i){if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;const a=xt(s,t);if(!a||!a.aiBlackboard)return;const l=rr(a.aiBlackboard),d=500,u=Math.min(i*.9,700),f=n-d-10,g=et+it*2;t.debugPanelRect={x:f,y:g,width:d,height:u},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(f,g,d,u),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(f,g,d,u),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";const m=14,S=f+15;let v=g+20;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Supply Chain Debugger",S,v),v+=25,e.fillStyle="#aaaaaa",e.font="11px monospace",e.fillText(`Tribe Leader: ${a.isPlayer?"Player":"#"+a.id}`,S,v),v+=m,e.fillText(`Current Time: ${t.time.toFixed(1)}h`,S,v),v+=20;const A=v,I=u-(A-g)-30;BB(e,t,l,S,A,d-30,I,m),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+4' to toggle this debugger",f+d/2,g+u-10),e.restore()}function BB(e,t,n,i,s,a,l,d){var A,I;const u=((A=t.debugPanelScroll)==null?void 0:A.x)??0,f=((I=t.debugPanelScroll)==null?void 0:I.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-u,-f);let g=s;e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(` Active Demands (${n.length})`,i,g),g+=18,n.length===0?(e.fillStyle="#888888",e.font="11px monospace",e.fillText("No active demands",i,g),g+=d):[...n].sort((P,R)=>R.updatedAt-P.updatedAt).forEach((P,R)=>{const w=t.entities.entities[P.requesterId];let k=w?w.isPlayer?"Player":`Human #${w.id}`:`Unknown #${P.requesterId}`;w&&(k+=` (Food: ${w.food.length}), Active action: ${w.activeAction||"idle"}`);let M="None";if(P.claimedBy){const H=t.entities.entities[P.claimedBy];M=H?H.isPlayer?"Player":`Human #${H.id}`:`Unknown #${P.claimedBy}`,H&&(M+=" (Food: "+H.food.length+"), Active action: "+(H.activeAction||"idle")+")")}const D=t.time-P.updatedAt,N=g,b=d*5+10;e.fillStyle=P.claimedBy?"rgba(50, 100, 50, 0.3)":"rgba(50, 50, 50, 0.3)",e.fillRect(i-5,N-2,a,b),e.strokeStyle=P.claimedBy?"#44ff44":"#666666",e.lineWidth=1,e.strokeRect(i-5,N-2,a,b),e.fillStyle="#ffaa00",e.font="bold 12px monospace",e.fillText(`#${R+1}`,i,g),g+=d,e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Requester: ${k}`,i+10,g),g+=d,e.fillStyle="#ffff88",e.fillText(`Resource: ${P.resourceType}`,i+10,g),g+=d,e.fillStyle=P.claimedBy?"#44ff44":"#ff8844",e.fillText(`Status: ${P.claimedBy?"Claimed":"Pending"}`,i+10,g),g+=d,P.claimedBy?(e.fillStyle="#aaffaa",e.fillText(`Mover: ${M}`,i+10,g)):(e.fillStyle="#888888",e.fillText(`Mover: ${M}`,i+10,g)),g+=d,e.fillStyle="#aaaaaa",e.font="10px monospace",e.fillText(`Updated: ${D.toFixed(1)}h ago`,i+10,g),g+=d+5}),g+=10,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Statistics",i,g),g+=18;const m=n.filter(T=>!T.claimedBy).length,S=n.filter(T=>T.claimedBy).length;e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Total Demands: ${n.length}`,i,g),g+=d,e.fillStyle="#ff8844",e.fillText(`Pending: ${m}`,i,g),g+=d,e.fillStyle="#44ff44",e.fillText(`Claimed: ${S}`,i,g),g+=d;const v=g-s;t.debugPanelContentSize={width:a,height:v},e.restore()}function FB(e,t,n){if(!n.debugCharacterId)return;const i=n.search.human.byProperty("id",n.debugCharacterId)[0];if(!i)return;const s=xt(i,n);if(!s||!s.aiBlackboard||s.id!==t.leaderId)return;rr(s.aiBlackboard).some(l=>l.requesterId===t.id)&&gu(e,t,t.radius+15,"#ff6644",3,2,n.time),t.tribeRole===ie.Mover&&gu(e,t,t.radius+15,"#44ff44",3,2,n.time)}const LB={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"},UB=new rc(500);function HB(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?_t+20:_t*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,i.x,i.y-l+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function GB(e,t,n,i,s){e.save(),e.font=`${Rl}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(i?_t:ma)-Rl-s),e.restore()}function $B(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function xB(e,t,n){var d;const{position:i,radius:s}=t,a=i.x-Kh/2,l=i.y-s-F1;if(t.stateMachine[0]===Jo){const u=t.stateMachine[1],f=n-u.attackStartTime,g=Math.min(f/Ru,1);Xo(e,a,l,Kh,DS,g,Yo,L1)}else if((d=t.attackCooldown)!=null&&d.melee&&t.attackCooldown.melee>0){const u=1-t.attackCooldown.melee/Pu;Xo(e,a,l,Kh,DS,u,Yo,U1)}}function WB(e,t,n=!1,i=!1,s=!1,a=!1,l=!1,d=!1,u=!1,f){var b,H;const{position:g,activeAction:m="idle"}=t,S=t.isAdult?_t:_t*.6,v=LB[m]||"idle",A=Vr(t.animationProgress||0,12),I=jp(t.direction,8),T=Math.floor(t.age),P=Vr(t.hunger/100,5)*100,R=`${v}_${t.gender}_${T}_${I}_${A}_${t.isPregnant??!1}_${P}_${S}`,w=Math.ceil(S*2)+4,k=UB.getOrRender(R,w,w,z=>{z.translate(w/2,w/2);const V=Xp(I,8);Vp.render(z,-w/2+2,-w/2+2,w-4,w-4,A,v,t.gender,T,V,t.isPregnant??!1,P)});e.drawImage(k,g.x-k.width/2,g.y-k.height/2),d&&(e.save(),e.strokeStyle=y1,e.lineWidth=2,e.beginPath(),e.arc(g.x,g.y,S+3,0,2*Math.PI),e.stroke(),e.restore());let M,D;if(l?(M=v1,D=sI):n?(M=S1,D=iI):s?(M=A1,D=m1):i?(M=I1,D=oI):a&&(M=T1,D=rI),M&&D&&$B(e,g,S,M,D),(b=t.tribeInfo)!=null&&b.tribeBadge&&GB(e,g,t.tribeInfo.tribeBadge,t.isAdult??!1,M??0),t.heldItem){const z=Dp[t.heldItem.type],V=(H=t.tribeInfo)!=null&&H.tribeBadge?Rl:0;e.save(),e.font=`${Rl}px Arial`,e.textAlign="center",e.textBaseline="middle";const j=g.y-(t.isAdult?_t:ma)-Rl-(M??0)-V;e.fillText(z,g.x,j),e.restore()}const N=u&&(f.debugCharacterId===void 0||t.id===f.debugCharacterId);xB(e,t,f.time),N&&HB(e,t),f.debugPanel===je.SupplyChain&&FB(e,t,f)}const YB={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},zB=new rc(200);function jB(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?_t+20:_t*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function XB(e,t,n=!1,i){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,d=YB[a]||"idle",u=Vr(t.animationProgress||0,12),f=jp(t.direction||{x:1,y:0},8),g=Math.floor(t.age),m=Vr(t.hunger/100,5)*100,S=`${d}_${g}_${f}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,v=Math.ceil(l*2)+4,A=zB.getOrRender(S,v,v,T=>{T.translate(v/2,v/2);const P=Xp(f,8);NT.render(T,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:g,direction:P,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(A,s.x-A.width/2,s.y-A.height/2),t.hitpoints<t.maxHitpoints){const T=l*1.5,P=3,R=s.x-T/2,w=s.y-l-8;e.fillStyle="#555",e.fillRect(R,w,T,P);const k=t.hitpoints/t.maxHitpoints;e.fillStyle=k>.5?"#4CAF50":k>.25?"#FFC107":"#F44336",e.fillRect(R,w,T*k,P)}n&&(i===void 0||t.id===i)&&jB(e,t)}const VB={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},KB=new rc(200);function qB(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?_t+20:_t*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function ZB(e,t,n=!1,i){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,d=VB[a]||"idle",u=Vr(t.animationProgress||0,12),f=jp(t.direction||{x:1,y:0},8),g=Math.floor(t.age),m=Vr(t.hunger/100,5)*100,S=`${d}_${g}_${f}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,v=Math.ceil(l*2)+4,A=KB.getOrRender(S,v,v,T=>{T.translate(v/2,v/2);const P=Xp(f,8);MT.render(T,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:g,direction:P,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(A,s.x-A.width/2,s.y-A.height/2),t.hitpoints<t.maxHitpoints){const T=l*1.5,P=3,R=s.x-T/2,w=s.y-l-8;e.fillStyle="#555",e.fillRect(R,w,T,P);const k=t.hitpoints/t.maxHitpoints;e.fillStyle=k>.5?"#4CAF50":k>.25?"#FFC107":"#F44336",e.fillRect(R,w,T*k,P)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,l+3,0,2*Math.PI),e.stroke()),n&&(i===void 0||t.id===i)&&qB(e,t)}const OT=15;function QB(e,t,n,i,s=1.5){const a=n-t.startTime,l=Math.min(a/t.duration,1),d=1-l,f=1+Math.sin(l*Math.PI*2)*(s-1),g=OT*f;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,g),0,Math.PI*2),e.fillStyle=i,e.fill(),e.restore()}function fl(e,t,n,i,s=2){const a=n-t.startTime,l=Math.min(a/t.duration,1),d=1-l,u=OT*2*l;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=i,e.lineWidth=s,e.stroke(),e.restore()}function Ki(e,t,n,i){const s=n-t.startTime,a=Math.min(s/t.duration,1),l=1-a,d=-20*a;e.save(),e.globalAlpha=l,e.font="20px Arial",e.textAlign="center",e.fillText(i,t.position.x,t.position.y+d),e.restore()}function JB(e,t,n,i){const{width:s,height:a}=i.mapDimensions;let l=t.targetPosition;if(t.targetEntityId){const I=i.entities.entities[t.targetEntityId];I&&(l=I.position)}if(!l)return;const d=n-t.startTime,u=Math.min(d/t.duration,1);let f=l.x-t.position.x,g=l.y-t.position.y;f=f-Math.round(f/s)*s,g=g-Math.round(g/a)*a;const m={x:f,y:g},S=t.position.x+m.x*u,v=t.position.y+m.y*u,A=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(S,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(S,v+A),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function kT(e,t,n,i){switch(t.type){case Ce.Procreation:Ki(e,t,n,"");break;case Ce.Pregnant:QB(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Ce.TargetAcquired:fl(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Ce.Attack:Ki(e,t,n,"");break;case Ce.Partnered:Ki(e,t,n,"");break;case Ce.BushClaimed:fl(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Ce.BushClaimLost:fl(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Ce.Eating:Ki(e,t,n,"");break;case Ce.ChildFed:Ki(e,t,n,"");break;case Ce.AttackDeflected:Ki(e,t,n,"");break;case Ce.AttackResisted:Ki(e,t,n,"");break;case Ce.Hit:Ki(e,t,n,"");break;case Ce.SeizeBuildup:fl(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Ce.BorderClaim:Ki(e,t,n,"");break;case Ce.Seize:fl(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Ce.StoneProjectile:JB(e,t,n,i);break}}const Av=8,eF=1.5,tF=.5,Iv=2,nF="#5a5a5a",iF="#7e7e7e",oF="#8B0000",rF="#FF4444",sF=6,aF=new rc(200),Tv=20;function lF(e,t,n=!1,i=!0){if(n)return`ghost_${e.buildingType}_${i}`;const s=e,a=s.buildingType===le.Bonfire&&(s.fuelLevel??0)>0;return`${s.id}_${s.buildingType}_${s.width}_${s.height}_${t}_${s.isConstructed}_${a}`}function bT(e,t,n=!1,i=!0){const s=lF(e,t,n,i),{width:a,height:l,id:d,buildingType:u}=e,f=a+Tv*2,g=l+Tv*2;return aF.getOrRender(s,f,g,m=>{const S=nr[u],v="isConstructed"in e?e.isConstructed:!0;if(m.translate(f/2,g/2),n){const A=i?"#4CAF50":"#F44336";Ag(m,a,l,9999,A),m.font=`${Math.min(a,l)*.5}px Arial`,m.textAlign="center",m.textBaseline="middle",m.fillStyle=A,m.fillText(S.icon,0,0)}else{const A=e;let I=S.icon;A.buildingType===le.Bonfire&&v&&(I=(A.fuelLevel??0)>0?"":""),t?Ag(m,a,l,d,oF,rF):Ag(m,a,l,d),m.globalAlpha=.5,m.font=`${Math.min(a,l,30)*.5}px Arial`,m.textAlign="center",m.textBaseline="middle",m.shadowColor="rgba(0,0,0,0.5)",m.shadowBlur=4,m.fillStyle="#FFFFFF",m.fillText(I,0,0)}})}function Ag(e,t,n,i,s,a){const l=(t+n)*2,d=Math.floor(l/Av),u=-t/2,f=t/2,g=-n/2,m=n/2;for(let S=0;S<d;S++){const v=i+S*13,A=Qs(v),I=Qs(v+1);let T=S*Av,P=0,R=0;T<t?(P=u+T,R=g):T<t+n?(P=f,R=g+(T-t)):T<t*2+n?(P=f-(T-(t+n)),R=m):(P=u,R=m-(T-(t*2+n)));const w=(I-.5)*Iv,k=(Qs(v+2)-.5)*Iv;e.beginPath();const M=eF+A*tF;s?e.fillStyle=s:e.fillStyle=A>.5?a||iF:s||nF,e.ellipse(P+w,R+k,M,M*.85,I*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function cF(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:i}=t;e.save(),e.font=`${sF}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,i.forEach(s=>{const a=s.item.type,l=(hp[a]||Dp[a])??"?",d={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(l,d.x,d.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function dF(e,t,n){const{position:i,width:s,height:a,constructionProgress:l,destructionProgress:d,isConstructed:u,isBeingDestroyed:f}=t,g=vt(n),m=!!(g&&Vt(g,t,n)),S=bT(t,m);e.save(),u||(e.globalAlpha=.3+l*.7),e.drawImage(S,i.x-S.width/2,i.y-S.height/2),e.restore();const v=s,A=i.x-v/2,I=i.y+a/2+n_;u?f&&Xo(e,A,I,v,Zy,1-d,Yo,t_):Xo(e,A,I,v,Zy,l,Yo,e_),(t.buildingType===le.StorageSpot||t.buildingType===le.Bonfire)&&u&&cF(e,t)}function uF(e,t,n,i,s){const a=nr[n],{width:l,height:d}=a.dimensions,u=bT({buildingType:n,width:l,height:d,id:9999},!1,!0,i),f=(m,S)=>{m.save(),m.globalAlpha=JC,m.drawImage(u,S.x-u.width/2,S.y-u.height/2),m.restore()},g={position:{...t},radius:Math.max(l,d)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:C.create()};ii(e,s.width,s.height,(m,S)=>f(m,S.position),g)}const Fs=1,fF=20,gi=4,Ev=8,hF="rgba(34, 85, 34, 0.25)",gF="rgba(139, 50, 50, 0.25)",Js=new Map,pF=50;function mF(e,t){return e.map(n=>n.id).sort((n,i)=>n-i).join(",")+`_${t}`}function yF(){if(Js.size>pF){const e=Js.keys().next().value;e&&Js.delete(e)}}function SF(e){const t=new Map;for(const n of e){const i=n.ownerId;i&&(t.has(i)||t.set(i,[]),t.get(i).push(n))}return t}function vF(e,t,n,i){let s=0;const a=Math.max(i.width,i.height)/2;for(const l of n){const d=e-l.position.x,u=t-l.position.y,f=d*d+u*u;f>0?s+=a*a/f:s+=100}return s}function AF(e,t,n){let i=1/0,s=1/0,a=-1/0,l=-1/0;for(const d of e)i=Math.min(i,d.position.x-t.width/2),s=Math.min(s,d.position.y-t.height/2),a=Math.max(a,d.position.x+t.width/2),l=Math.max(l,d.position.y+t.height/2);return{minX:i-n,minY:s-n,maxX:a+n,maxY:l+n}}function IF(e,t,n,i){const s=mF(e,i);if(Js.has(s))return Js.get(s);const a=n.maxX-n.minX,l=n.maxY-n.minY,d=Math.ceil(a/gi),u=Math.ceil(l/gi),f=[],g=[];for(let v=0;v<u;v++)f[v]=new Array(d);for(let v=0;v<u;v++)for(let A=0;A<d;A++){const I=n.minX+A*gi,T=n.minY+v*gi,P=vF(I,T,e,t);f[v][A]=P}for(let v=1;v<u-1;v++)for(let A=1;A<d-1;A++)if(f[v][A]>=Fs&&(f[v-1][A]<Fs||f[v+1][A]<Fs||f[v][A-1]<Fs||f[v][A+1]<Fs)){const T=n.minX+A*gi,P=n.minY+v*gi;g.push({x:T,y:P})}const m=CF(g),S={fieldValues:f,edgePoints:g,regions:m,bounds:n};return Js.set(s,S),yF(),S}function TF(e,t,n,i,s,a){if(t.length===0)return;const{bounds:l}=a,d=10;if(!a.canvas){const u=l.maxX-l.minX+d*2,f=l.maxY-l.minY+d*2,{canvas:g,ctx:m}=RT(u,f);m.translate(-l.minX+d,-l.minY+d);const{fieldValues:S,regions:v}=a;EF(m,S,l,i);let A=s;for(const I of v){const T=_F(I);wF(m,T,i,A),A+=1e3}a.canvas=g}e.save(),e.globalAlpha=1,e.drawImage(a.canvas,l.minX-d,l.minY-d),e.restore()}function EF(e,t,n,i){const s=i?gF:hF;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++)if(t[a][l]>=Fs){const d=n.minX+l*gi,u=n.minY+a*gi;e.rect(d,u,gi,gi)}e.fill(),e.restore()}function CF(e){if(e.length===0)return[];const t=gi*2,n=t,i=new Map;function s(f,g){const m=Math.floor(f/n),S=Math.floor(g/n);return`${m},${S}`}for(let f=0;f<e.length;f++){const g=s(e[f].x,e[f].y);i.has(g)||i.set(g,[]),i.get(g).push(f)}function a(f,g){const m=[],S=Math.floor(f/n),v=Math.floor(g/n);for(let A=-1;A<=1;A++)for(let I=-1;I<=1;I++){const T=`${S+A},${v+I}`,P=i.get(T);P&&m.push(...P)}return m}const l=new Set,d=[],u=t*t;for(let f=0;f<e.length;f++){if(l.has(f))continue;const g=[],m=[f];for(;m.length>0;){const S=m.shift();if(l.has(S))continue;l.add(S),g.push(e[S]);const v=a(e[S].x,e[S].y);for(const A of v){if(l.has(A))continue;const I=e[A].x-e[S].x,T=e[A].y-e[S].y;I*I+T*T<=u&&m.push(A)}}g.length>0&&d.push(g)}return d}function _F(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const i=t[t.length-1];let s=0,a=1/0;for(let l=0;l<n.length;l++){const d=n[l].x-i.x,u=n[l].y-i.y,f=d*d+u*u;f<a&&(a=f,s=l)}t.push(n.splice(s,1)[0])}return t}function wF(e,t,n,i){if(t.length===0)return;let s=0,a=0;for(let l=1;l<t.length;l++){const d=t[l-1],u=t[l],f=u.x-d.x,g=u.y-d.y,m=Math.sqrt(f*f+g*g);for(s+=m;s>=Ev;){s-=Ev;const S=1-s/m,v=d.x+f*S,A=d.y+g*S;RF(e,v,A,n,i+a*13),a++}}}function RF(e,t,n,i,s){const a=Qs(s),l=Qs(s+1),d=(l-.5)*2,u=(Qs(s+2)-.5)*2;e.beginPath();const f=1.5+a*.5;i?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+d,n+u,f,f*.85,l*Math.PI,0,Math.PI*2),e.fill(),i||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function PF(e,t,n,i){var m,S,v;const s=t;if(!((m=s.search)!=null&&m.building))return;const l=s.search.building.all().filter(A=>A.buildingType===le.PlantingZone&&A.isConstructed);if(l.length===0)return;const d=l.filter(A=>Vs(A,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(d.length===0)return;const u=nr[le.PlantingZone].dimensions,f=SF(d),g=i?t.entities.entities[i]:void 0;for(const[A,I]of f){const T=((v=(S=g==null?void 0:g.tribeControl)==null?void 0:S.diplomacy)==null?void 0:v[A])==="Hostile",P=typeof A=="number"?A:0,R=AF(I,u,fF),w=IF(I,u,R,T);TF(e,I,u,T,P,w)}}const DF=.001,NF=.05,MF=12;function OF(e,t,n){const{position:i,age:s,swayOffset:a}=t,[l]=t.stateMachine??[],d=Math.min(1,Math.max(.4,s/er)),f=l!==Gt&&l!==co?Math.sin(n*DF+a)*NF:0;if(e.save(),e.translate(i.x,i.y),e.scale(d,d),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=NN,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),l===co?Ig(e,10,8):l===Gt?(e.rotate(Math.PI/2),Ig(e,10,30),e.translate(0,-25),Cv(e,40,20,40,15)):(e.rotate(f),Ig(e,10,30),e.translate(0,-25),e.rotate(f*.5),Cv(e,40,20,40,15)),e.restore(),(l===Gt||l===co)&&t.wood&&t.wood.length>0){e.save(),e.font=`${MF}px Arial`,e.textAlign="center",e.textBaseline="middle";const g=t.radius*1.1,m=Math.PI*2/(Hu-1);t.wood.forEach((S,v)=>{const A=v===0?0:g,I=v===0?0:(v-1)*m,T=i.x+A*Math.cos(I),P=i.y+A*Math.sin(I),R=Dp[S.type];e.fillText(R,T,P)}),e.restore()}}function Ig(e,t,n){e.fillStyle=_N,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=wN,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function Cv(e,t,n,i,s){e.fillStyle=RN,_v(e,t+4,n+4,i+2,s+2),e.translate(0,-2),e.fillStyle=PN,_v(e,t,n,i,s),e.fillStyle=DN,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function _v(e,t,n,i,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-i),e.lineTo(0,-i-s),e.lineTo(n/2,-i),e.lineTo(t/2,0),e.closePath(),e.fill()}let Lo=null;function kF(e,t,n,i,s){const a=xN(t.time);if(a<=0)return;Lo||(Lo=document.createElement("canvas")),(Lo.width!==i.width||Lo.height!==i.height)&&(Lo.width=i.width,Lo.height=i.height);const l=Lo.getContext("2d");if(l){l.clearRect(0,0,i.width,i.height),l.fillStyle=`rgba(0, 0, 40, ${a*.85})`,l.fillRect(0,0,i.width,i.height),l.globalCompositeOperation="destination-out";for(const d of s){const u=oc(d.position,n,i,t.mapDimensions),f=l.createRadialGradient(u.x,u.y,0,u.x,u.y,d.radius);f.addColorStop(0,`rgba(255, 255, 255, ${d.intensity})`),f.addColorStop(1,"rgba(255, 255, 255, 0)"),l.fillStyle=f,l.beginPath(),l.arc(u.x,u.y,d.radius,0,Math.PI*2),l.fill()}l.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(Lo,0,0),e.restore()}}function wv(e,t,n,i,s,a,l){for(let d=-s.height;d<=s.height;d+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const f={x:t.x+u,y:t.y+d};Vs({position:f,radius:n},a,l,s)&&e.push({position:f,radius:n,intensity:i})}}function bF(e,t,n,i,s,a=[]){const l=vt(t),d=l?Dn(t,l):[],u=jr(d),{width:f,height:g}=t.mapDimensions,m=[];a.forEach(T=>{m.push({position:T,radius:30,intensity:.3})}),PF(e,t,i,l==null?void 0:l.leaderId),Object.values(t.entities.entities).sort((T,P)=>n&&T.id===t.debugCharacterId&&T.id!==P.id||T.type==="building"&&P.type!=="building"?-1:T.position.y-P.position.y||T.id-P.id).filter(T=>Vs(T,i,s,t.mapDimensions)).forEach(T=>{var P,R;if(T.type==="building"){const w=T;if(w.isConstructed){const k=w.buildingType===le.Bonfire&&(w.fuelLevel??0)>0,M=k?180:60,D=k?.9:.4;wv(m,w.position,M,D,t.mapDimensions,i,s)}if(w.buildingType===le.PlantingZone&&w.isConstructed)return;ii(e,f,g,dF,w,t,l,t.time)}else if(T.type==="berryBush")ii(e,f,g,pB,T,t,l,t.time);else if(T.type==="tree")ii(e,f,g,OF,T,t.time);else if(T.type==="human"){const w=T,k=w.id===(l==null?void 0:l.id),M=d.some(z=>z.id===w.id),D=w.id===(u==null?void 0:u.id),N=l&&(w.id===l.motherId||w.id===l.fatherId),b=l&&(((P=w.partnerIds)==null?void 0:P.includes(l.id))||((R=l.partnerIds)==null?void 0:R.includes(w.id))),H=(l==null?void 0:l.attackTargetId)===w.id;wv(m,w.position,40,.3,t.mapDimensions,i,s),ii(e,f,g,WB,w,k,N,M,b,D,H,n,t)}else T.type==="corpse"?ii(e,f,g,IB,T):T.type==="prey"?ii(e,f,g,XB,T,n,t.time,t.debugCharacterId):T.type==="predator"&&ii(e,f,g,ZB,T,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(T=>Vs(T,i,s,t.mapDimensions)).forEach(T=>{ii(e,f,g,kT,T,t.time,t)});const I=t.notifications.filter(T=>!T.isDismissed);for(const T of I)if(T.highlightedEntityIds&&T.renderHighlights)for(const P of T.highlightedEntityIds){const R=t.entities.entities[P];R&&Vs(R,i,s,t.mapDimensions)&&ii(e,f,g,gu,R,SP,vP,IP,AP,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const T of t.tutorialState.highlightedEntityIds){const P=t.entities.entities[T];P&&Vs(P,i,s,t.mapDimensions)&&ii(e,f,g,gu,P,rP,pI,mI,Pp,t.time)}kF(e,t,i,s,m)}function BF(e,t,n,i,s,a){let l=null,d=null;e.textAlign="left";let u=et+it;const g=t.time/(Ct/Dt)/Eu%1,m=ll[ks.Time],S=25,v=et+S;e.fillText(m,et,u+Bn/2+it/3),Xo(e,v,u,ko,Bn,g,Yo,D1),u+=Bn+Vi;const A=u+Ar/2,I=u+(Ar-Bn)/2,T=5;Kl(e,{x:et*2,y:A},Ar,5,n.gender,!1,!1,!1);const P=et+Ar+T,R=ko+S-(Ar+T)*2;Xo(e,P,I,R,Bn,Math.floor(n.age)/Hl,Yo,P1),Kl(e,{x:P+R+T+Ar/2,y:A},Ar,Hl,n.gender,!1,!1,!1),u+=Bn+Vi*2;const w=[],k=new Set;if(w.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),k.add(n.id),i&&!k.has(i.id)&&(w.push({member:i,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),k.add(i.id)),s.forEach(ne=>{k.has(ne.id)||(w.push({member:ne,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),k.add(ne.id))}),a.forEach(ne=>{k.has(ne.id)||(w.push({member:ne,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),k.add(ne.id))}),n.motherId&&!k.has(n.motherId)){const ne=t.entities.entities[n.motherId];ne&&(w.push({member:ne,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),k.add(ne.id))}if(n.fatherId&&!k.has(n.fatherId)){const ne=t.entities.entities[n.fatherId];ne&&(w.push({member:ne,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),k.add(ne.id))}const M=ll[ks.Family],D=10,N=et+it+D,b=ko+S-(it+D),H=u+Sd/2;e.font=`${it}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(M,et,H);const z=u+Sd/2;cB(e,N,z,w,Sd,b),u+=Sd+Vi,e.textBaseline="alphabetic";const V=ll[ks.Hitpoints];e.fillText(V,et,u+Bn/2+it/3),Xo(e,v,u,ko,Bn,n.hitpoints/n.maxHitpoints,Yo,R1),u+=Bn+Vi;const j=ll[ks.Hunger];e.fillText(j,et,u+Bn/2+it/3),Xo(e,v,u,ko,Bn,(rn-n.hunger)/rn,Yo,w1),l={x:et,y:u-Vi/2,width:ko+S,height:Bn+Vi},u+=Bn+Vi,e.textBaseline="middle";const ee=ll[ks.Food];return e.fillText(ee,et,u+yd/2),TB(e,v,u+yd/2,n.food,yd,ko),d={x:et,y:u-Vi/5,width:ko+S,height:yd+Vi},e.textBaseline="alphabetic",{hungerBarRect:l,foodBarRect:d}}let hl=[],Rv=0;const FF=36,LF=200;function UF(e,t,n,i){const s=t.search.prey.count(),a=t.search.predator.count(),l=t.search.berryBush.count();t.time-Rv>=FF&&(hl.push({time:t.time,prey:s,predators:a,bushes:l}),hl.length>LF&&(hl=hl.slice(-200)),Rv=t.time);const d=Ze*Qe,u=s/d*1e6,f=a/d*1e6,g=l/d*1e6,m=Yb(),S=Math.floor(t.time/(24*365)),v=Math.floor(t.time%(24*365)/24),A=Math.floor(t.time%24),I=400,T=Math.min(i*.8,600),P=n-I-10,R=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(P,R,I,T),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(P,R,I,T),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let w=R+20;const k=14,M=P+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",M,w),w+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${S}, Day ${v}, Hour ${A}`,M,w),w+=k,e.fillText(`Map Size: ${Ze}  ${Qe} pixels`,M,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",M,w),w+=18,m&&(e.fillText(`Q-Table Size: ${m.qTableSize} entries`,M,w),w+=k,e.fillText(`Exploration Rate: ${(m.explorationRate*100).toFixed(1)}%`,M,w),w+=k);const D=hl.slice(-20);D.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",M,w),w+=30,HF(e,M,w,D),w+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",M,w),w+=18,e.fillStyle="white",e.font="12px monospace";const N=(oo/d*1e6).toFixed(2),b=(ro/d*1e6).toFixed(2),H=(so/d*1e6).toFixed(2);e.fillText(`Prey: ${u.toFixed(2)} (target: ${N})`,M,w),w+=k,e.fillText(`Predators: ${f.toFixed(2)} (target: ${b})`,M,w),w+=k,e.fillText(`Bushes: ${g.toFixed(2)} (target: ${H})`,M,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",M,w),w+=18,e.fillStyle="white",e.font="12px monospace";const z=Math.round(s/oo*100),V=Math.round(a/ro*100),j=Math.round(l/so*100),ee=ne=>ne<50?"#ff4444":ne<80?"#ffaa44":ne>120?"#44aaff":"#44ff44";e.fillStyle=ee(z),e.fillText(`Prey: ${s}/${oo} (${z}%)`,M,w),w+=k,e.fillStyle=ee(V),e.fillText(`Predators: ${a}/${ro} (${V}%)`,M,w),w+=k,e.fillStyle=ee(j),e.fillText(`Bushes: ${l}/${so} (${j}%)`,M,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",M,w),w+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",M,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,M,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,M,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,M,w),w+=13,e.fillText("Predators:",M,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,M,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,M,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,M,w),w+=13,e.fillText("Bushes:",M,w),w+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,M,w),w+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",P+I/2,R+T-10),e.restore()}function HF(e,t,n,i){if(i.length<2)return;const d={prey:Math.max(...i.map(f=>f.prey),oo),predators:Math.max(...i.map(f=>f.predators),ro),bushes:Math.max(...i.map(f=>f.bushes),so)};[{data:i.map(f=>f.prey),color:"#44ff44",label:"Prey",target:oo,max:d.prey},{data:i.map(f=>f.predators),color:"#ff4444",label:"Predators",target:ro,max:d.predators},{data:i.map(f=>f.bushes),color:"#ffaa44",label:"Bushes",target:so,max:d.bushes}].forEach((f,g)=>{const m=t+g*115,S=n;e.fillStyle=f.color,e.font="10px monospace",e.fillText(f.label,m,S-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,S,100,30),e.beginPath(),e.strokeStyle=f.color;for(let A=0;A<f.data.length;A++){const I=m+A/(f.data.length-1)*100,T=S+30-f.data[A]/f.max*30;A===0?e.moveTo(I,T):e.lineTo(I,T)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=S+30-f.target/f.max*30;e.moveTo(m,v),e.lineTo(m+100,v),e.stroke(),e.setLineDash([])})}function GF(e,t){const n=t.search.human.byProperty("leaderId",e),i={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||i.children++,s.gender==="male"?i.males++:s.gender==="female"&&i.females++,s.age>=mp&&i.old++;return i}function $F(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(f=>n.berryBush.byRadius(f.position,f.radius)).reduce((f,g)=>f+g.food.length,0),u=n.building.byProperty("ownerId",e).filter(f=>f.buildingType===le.StorageSpot).reduce((f,g)=>f+(g.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:u,consumptionRate:0}}function xF(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,l=new Map,d=new Map;for(const f of s){const g=uu(f.id,t,l);d.has(g)||d.set(g,[]),d.get(g).push(f)}const u=[];for(const[f,g]of d.entries()){const m=a[f];m&&u.push({patriarch:m,memberCount:g.length,members:g.map(S=>S.id)})}return u.sort((f,g)=>g.memberCount-f.memberCount),u.slice(0,n)}let gl=[],Mi=[],Pv=0;const WF=36,Dv=200;function YF(e,t,n,i){var k;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(k=xt(s,t))==null?void 0:k.id;if(!a)return;const l=GF(a,t),d=$F(a,t);if(t.time-Pv>=WF){gl.push({time:t.time,total:l.total,children:l.children,males:l.males,females:l.females,old:l.old});const M=d.totalBushFood+d.totalStorageFood;Mi.push({time:t.time,bushFood:d.totalBushFood,storageFood:d.totalStorageFood,totalFood:M}),gl.length>Dv&&(gl=gl.slice(-200)),Mi.length>Dv&&(Mi=Mi.slice(-200)),Pv=t.time}let u=0;if(Mi.length>=2){const M=Mi[Mi.length-1],D=Mi[Mi.length-2],N=M.time-D.time;N>0&&(u=(D.totalFood-M.totalFood)/N)}const f=400,g=Math.min(i*.9,700),m=n-f-10,S=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,S,f,g),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,S,f,g),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=S+20;const A=13,I=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",I,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",I,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${l.total}`,I,v),v+=A,e.fillStyle="#00ffff",e.fillText(`Children: ${l.children}`,I,v),v+=A,e.fillStyle="#4488ff",e.fillText(`Males: ${l.males}`,I,v),v+=A,e.fillStyle="#ff88ff",e.fillText(`Females: ${l.females}`,I,v),v+=A,e.fillStyle="#888888",e.fillText(`Old (${l.old})`,I,v),v+=20;const T=gl.slice(-50);T.length>1&&(zF(e,I,v,T),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",I,v),v+=18;const P=d.totalBushFood+d.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${P}`,I,v),v+=A,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${d.totalBushFood}`,I,v),v+=A,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${d.totalStorageFood}`,I,v),v+=A,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,I,v),v+=20;const R=Mi.slice(-50);R.length>1&&(jF(e,I,v,R),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",I,v),v+=18;const w=xF(a,t,5);e.fillStyle="white",e.font="11px monospace",w.length===0?(e.fillText("No families found",I,v),v+=A):w.forEach((M,D)=>{const b=`${D+1}. ${M.patriarch.isPlayer?"Player":"#"+M.patriarch.id} (${M.memberCount} members, can split: ${$I(M.patriarch,t).canSplit})`;e.fillText(b,I,v),v+=A}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+f/2,S+g-10),e.restore()}function zF(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.total),color:"#ffffff",label:"Total"},{data:i.map(u=>u.children),color:"#00ffff",label:"Children"},{data:i.map(u=>u.males),color:"#4488ff",label:"Males"},{data:i.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:i.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function jF(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:i.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:i.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function Nv(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,d=lI;if(e.beginPath(),e.moveTo(i+d,s),e.lineTo(i+a-d,s),e.quadraticCurveTo(i+a,s,i+a,s+d),e.lineTo(i+a,s+l-d),e.quadraticCurveTo(i+a,s+l,i+a-d,s+l),e.lineTo(i+d,s+l),e.quadraticCurveTo(i,s+l,i,s+l-d),e.lineTo(i,s+d),e.quadraticCurveTo(i,s,i+d,s),e.closePath(),e.fillStyle=t.isDisabled?cI:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*hI)+1)/2;e.strokeStyle=fI,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<au){const f=1-u/au;e.fillStyle=uI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Rp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?dI:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.font=`${it*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function XF(e,t,n,i){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,i);const s=500,a=150,l=(n-s)/2,d=(i-a)/2;e.fillStyle=Ht,e.font=`${it*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,d+a/3-10),e.fillText("to the main menu?",n/2,d+a/3+10);const u=io*1.5,f=aI,g=d+a-f-et*2,m=20,S=u*2+m,v=l+(s-S)/2,A={id:"confirmExitYes",action:de.ConfirmExitYes,rect:{x:v,y:g,width:u,height:f},text:"Yes",backgroundColor:xo,textColor:Ht,currentWidth:u},I=v+u+m,T={id:"confirmExitNo",action:de.ConfirmExitNo,rect:{x:I,y:g,width:u,height:f},text:"No",backgroundColor:xo,textColor:Ht,currentWidth:u};t.uiButtons.push(A,T),Nv(e,A,t.hoveredButtonId===A.id),Nv(e,T,t.hoveredButtonId===T.id),e.restore()}const Uo=600,Ns=30,Oi=60,zt=30,VF="";function KF(e,t,n){const i=[];if(!n.tribeControl||!n.leaderId)return i;const{width:s,height:a}=e.canvas,l=(s-Uo)/2,d=480,u=(a-d)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(l,u,Uo,d,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Ht,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Tribe Roles",l+Uo/2,u+Ns);const f=30,g=l+Uo-Ns-f,m=u+Ns,S=t.hoveredButtonId==="roleManager_close";e.fillStyle=S?"#ff7777":"#ff5555",e.fillRect(g,m,f,f),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",g+f/2,m+f/2),i.push({id:"roleManager_close",action:de.CloseRoleManager,rect:{x:g,y:m,width:f,height:f},text:"X",currentWidth:f,backgroundColor:"#ff5555",textColor:"#ffffff"});const A=Li(n.leaderId,t).filter(j=>j.isAdult),I={[ie.Leader]:0,[ie.Gatherer]:0,[ie.Planter]:0,[ie.Hunter]:0,[ie.Mover]:0,[ie.Warrior]:0};A.forEach(j=>{j.tribeRole&&I[j.tribeRole]++});const T=n.tribeControl.roleWeights,P=[{role:ie.Gatherer,emoji:"",name:"Gatherer"},{role:ie.Planter,emoji:"",name:"Planter"},{role:ie.Hunter,emoji:"",name:"Hunter"},{role:ie.Mover,emoji:"",name:"Mover"},{role:ie.Warrior,emoji:"",name:"Warrior"}];let R=0;P.forEach(j=>{R+=T[j.role]||0});let w=u+Ns+70;const k=l+Ns,M=l+Uo-Ns;P.forEach(j=>{const ee=T[j.role]||0,ne=R>0?Math.round(ee/R*100):0,Se=I[j.role]||0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${j.emoji} ${Se} ${j.name}`,k,w+Oi/2);const ce=l+220,oe=ce+zt+15,q=oe+200+15,Z=`role_minus_${j.role}`,F=t.hoveredButtonId===Z,Y=ee<=0,ue=Y?"#555":F?"#dd6666":"#cc4444";e.fillStyle=ue,e.fillRect(ce,w+(Oi-zt)/2,zt,zt),e.fillStyle=Y?"#888":"#fff",e.textAlign="center",e.fillText("-",ce+zt/2,w+Oi/2+2),i.push({id:Z,action:de.DecreaseRoleWeight,targetRole:j.role,rect:{x:ce,y:w+(Oi-zt)/2,width:zt,height:zt},text:"-",currentWidth:zt,backgroundColor:ue,textColor:"#fff",isDisabled:Y}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#fff";let pe=oe;for(let fe=0;fe<ee;fe++)e.fillText(VF,pe,w+Oi/2+2),pe+=18;const Pe=`role_plus_${j.role}`,me=t.hoveredButtonId===Pe,Me=ee>=10,De=Me?"#555":me?"#66dd66":"#44cc44";e.fillStyle=De,e.fillRect(q,w+(Oi-zt)/2,zt,zt),e.fillStyle=Me?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",q+zt/2,w+Oi/2+4),i.push({id:Pe,action:de.IncreaseRoleWeight,targetRole:j.role,rect:{x:q,y:w+(Oi-zt)/2,width:zt,height:zt},text:"+",currentWidth:zt,backgroundColor:De,textColor:"#fff",isDisabled:Me}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${ne}%`,M,w+Oi/2),w+=Oi});const D=I[ie.Leader],N=Object.values(I).reduce((j,ee)=>j+ee,0),b=A.length-N;e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`Adults: ${A.length} | Leader: ${D} | Assigned: ${N} | Unassigned: ${b}`,l+Uo/2,w+10),e.fillText("(Adjust weights to control role distribution)",l+Uo/2,w+30);const H=t.autopilotControls.behaviors.roleManagement,z=H?" Auto-adjust: ON":" Auto-adjust: OFF",V=H?"#4CAF50":"#888";return e.fillStyle=V,e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`${z} (Shift+U to toggle)`,l+Uo/2,w+50),e.restore(),i}const Pr=600,Ms=30,ki=60,jt=30,Mv=[{key:"protectHomeland",emoji:"",name:"Protect Homeland",description:"Stay inside territory and protect from enemies"},{key:"expandBorders",emoji:"",name:"Expand Borders",description:"Expand territory by placing border posts (Coming Soon)"},{key:"invadeEnemies",emoji:"",name:"Invade Enemies",description:"Attack enemies outside of our border"}];function qF(e,t,n){const i=[];if(!n.tribeControl||n.leaderId!==n.id)return i;const s=n.tribeControl.armyControl??{protectHomeland:Wg,expandBorders:Yg,invadeEnemies:zg},{width:a,height:l}=e.canvas,d=(a-Pr)/2,u=350,f=(l-u)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(d,f,Pr,u,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Ht,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Army Control",d+Pr/2,f+Ms);const g=30,m=d+Pr-Ms-g,S=f+Ms,v=t.hoveredButtonId==="armyControl_close";e.fillStyle=v?"#ff7777":"#ff5555",e.fillRect(m,S,g,g),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",m+g/2,S+g/2),i.push({id:"armyControl_close",action:de.CloseArmyControl,rect:{x:m,y:S,width:g,height:g},text:"X",currentWidth:g,backgroundColor:"#ff5555",textColor:"#ffffff"});let A=0;Mv.forEach(R=>{A+=s[R.key]||0});let I=f+Ms+70;const T=d+Ms,P=d+Pr-Ms;return Mv.forEach(R=>{const w=s[R.key]||0,k=A>0?Math.round(w/A*100):0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${R.emoji} ${R.name}`,T,I+ki/2);const M=d+320,D=M+jt+15,N=120,b=D+N+15,H=`army_minus_${R.key}`,z=t.hoveredButtonId===H,V=w<=0,j=V?"#555":z?"#dd6666":"#cc4444";e.fillStyle=j,e.fillRect(M,I+(ki-jt)/2,jt,jt),e.fillStyle=V?"#888":"#fff",e.textAlign="center",e.fillText("-",M+jt/2,I+ki/2+2),i.push({id:H,action:de.DecreaseArmyObjective,targetArmyObjective:R.key,rect:{x:M,y:I+(ki-jt)/2,width:jt,height:jt},text:"-",currentWidth:jt,backgroundColor:j,textColor:"#fff",isDisabled:V}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#4CAF50";const ee=N-10,ne=12,Se=I+ki/2-ne/2;e.fillStyle="#333",e.fillRect(D,Se,ee,ne);const ce=w/10*ee;e.fillStyle="#4CAF50",e.fillRect(D,Se,ce,ne);const oe=`army_plus_${R.key}`,X=t.hoveredButtonId===oe,q=w>=10,Z=q?"#555":X?"#66dd66":"#44cc44";e.fillStyle=Z,e.fillRect(b,I+(ki-jt)/2,jt,jt),e.fillStyle=q?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",b+jt/2,I+ki/2+4),i.push({id:oe,action:de.IncreaseArmyObjective,targetArmyObjective:R.key,rect:{x:b,y:I+(ki-jt)/2,width:jt,height:jt},text:"+",currentWidth:jt,backgroundColor:Z,textColor:"#fff",isDisabled:q}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${k}%`,P,I+ki/2),I+=ki}),e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText("Adjust priorities for warrior objectives",d+Pr/2,I+10),e.fillText("Higher values = higher priority",d+Pr/2,I+30),e.restore(),i}let Ov="",kv=null;function ZF(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function QF(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function Bd(e,t,n,i,s,a,l){const d=((t+i)%a+a)%a,u=((n+s)%l+l)%l;return e.has(`${d},${u}`)}function JF(e,t,n,i){const s=xP(t.soilDepletion,RA);if(s.length===0)return;const{width:a,height:l}=t.mapDimensions,d=i.width/2,u=i.height/2,f=Math.ceil(a/Xt),g=Math.ceil(l/Xt),m=ZF(s);m!==Ov&&(Ov=m,kv=QF(s));const S=kv,v=Xt*2,A=n.x-d-v,I=n.x+d+v,T=n.y-u-v,P=n.y+u+v;e.save();const R=e.globalAlpha;for(const w of s){const k=w.gridX*Xt,M=w.gridY*Xt,D=eL(k,M,a,l,A,I,T,P);for(const N of D)tL(e,N.x,N.y,w.health,w.gridX,w.gridY,S,f,g)}e.globalAlpha=R,e.restore()}function eL(e,t,n,i,s,a,l,d){const u=[],f=Xt,g=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-i},{dx:0,dy:i},{dx:-n,dy:-i},{dx:n,dy:-i},{dx:-n,dy:i},{dx:n,dy:i}];for(const m of g){const S=e+m.dx,v=t+m.dy;S+f>=s&&S<=a&&v+f>=l&&v<=d&&u.push({x:S,y:v})}return u}function tL(e,t,n,i,s,a,l,d,u){const f=Math.floor(t),g=Math.floor(n),m=Xt,S=1-i/RA,A=i<kw?gS:gS*S,I=!Bd(l,s,a,0,-1,d,u),T=!Bd(l,s,a,0,1,d,u),P=!Bd(l,s,a,-1,0,d,u),R=!Bd(l,s,a,1,0,d,u);e.globalAlpha=A,e.fillStyle=Mw,e.fillRect(f,g,m,m);const w=3;e.fillStyle=Ow,e.globalAlpha=A*1.2,I&&e.fillRect(f,g,m,w),T&&e.fillRect(f,g+m-w,m,w),P&&e.fillRect(f,g,w,m),R&&e.fillRect(f+m-w,g,w,m),e.globalAlpha=A*.5;const k=w+1;I&&P&&e.fillRect(f,g,k,k),I&&R&&e.fillRect(f+m-k,g,k,k),T&&P&&e.fillRect(f,g+m-k,k,k),T&&R&&e.fillRect(f+m-k,g+m-k,k,k),e.globalAlpha=1}const pl=8,ml=12,hn=24;function bv(e,t,n,i,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-ml),e.stroke(),e.fillStyle=i,e.beginPath(),e.moveTo(t,n-ml),e.lineTo(t+pl,n-ml+pl/2),e.lineTo(t,n-ml+pl),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+pl/2,n-ml+pl/2))}function nL(e,t,n,i,s){const a=Ou(t,s);let l=1;const d=new Map,u=new Map;for(const I of a){const P=I.leaderId===s?0:l++,R=Gn[P%Gn.length];d.set(I.leaderId,R),u.set(I.leaderId,I.tribeBadge||"")}const f=[],g=hn*2,m=Math.floor((n.x-i.width/2-g)/hn)*hn,S=Math.floor((n.x+i.width/2+g)/hn)*hn,v=Math.floor((n.y-i.height/2-g)/hn)*hn,A=Math.floor((n.y+i.height/2+g)/hn)*hn;for(let I=v;I<=A;I+=hn)for(let T=m;T<=S;T+=hn){const P=xn(T,I,t),R=T+hn,w=xn(R,I,t);if(P!==w){const D=P||w;if(D){const N=T+hn/2,b=I;bv(e,N,b,d.get(D)||"#000",u.get(D)||""),f.push({x:N,y:b})}}const k=I+hn,M=xn(T,k,t);if(P!==M){const D=P||M;if(D){const N=T,b=I+hn/2;bv(e,N,b,d.get(D)||"#000",u.get(D)||""),f.push({x:N,y:b})}}}return f}const Ln=12,Rt=16,ti=15;function Bv(e){switch(e){case G.Success:return"#4CAF50";case G.Failure:return"#F44336";case G.Running:return"#FFC107";case G.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function iL(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function oL(e,t,n,i){var N;const{debugCharacterId:s}=t,a=500,l=Math.min(i*.9,800),d=n-a-10,u=et+it*2;t.debugPanelRect={x:d,y:u,width:a,height:l},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(d,u,a,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(d,u,a,l),e.fillStyle="white",e.font=`${Ln}px monospace`,e.textAlign="left",e.textBaseline="top";let f=u+20;const g=d+15;if(e.fillStyle="#66ccff",e.font=`bold ${Ln+2}px monospace`,e.fillText(" Task AI Debugger",g,f),f+=25,!s){e.fillStyle="#888",e.font=`${Ln}px monospace`,e.fillText("No character selected for debugging.",g,f),e.fillText("Click on a character to inspect their Task AI.",g,f+20),e.restore();return}const m=t.entities.entities[s];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${Ln}px monospace`,e.fillText(`Character #${s} not found or not a character.`,g,f),e.restore();return}const S=m;e.fillStyle="white",e.font=`${Ln}px monospace`,e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,g,f),f+=Rt*1.5,e.fillStyle="#66ccff",e.font=`bold ${Ln}px monospace`,e.fillText(" Current Task",g,f),f+=Rt*1.5;const v=Kg(S),A=v?t.tasks[v]:null;if(e.font=`${Ln}px monospace`,A){const b=C.get(S.aiBlackboard,fT),H=C.get(S.aiBlackboard,hT),z=b!==void 0?G[b]:"N/A";e.fillStyle="white",e.fillText(`ID: ${A.id}`,g+ti,f),f+=Rt,e.fillText(`Type: ${se[A.type]}`,g+ti,f),f+=Rt,e.fillText(`Target: ${iL(A.target)}`,g+ti,f),f+=Rt,e.fillStyle=Bv(b),e.fillText(`Status: ${z}`,g+ti,f),f+=Rt,H&&(e.fillStyle="#aaa",e.fillText(`Message: ${H}`,g+ti,f),f+=Rt)}else e.fillStyle="#888",e.fillText("No active task.",g+ti,f),f+=Rt;f+=Rt,e.fillStyle="#66ccff",e.font=`bold ${Ln}px monospace`,e.fillText(" Recent Task History (Last 5)",g,f),f+=Rt*1.5;const I=C.get(S.aiBlackboard,Vg)||[];if(I.length===0)e.fillStyle="#888",e.font=`${Ln}px monospace`,e.fillText("No task history yet.",g+ti,f),f+=Rt;else for(const b of I){e.fillStyle="white",e.font=`${Ln}px monospace`;const H=se[b.type];e.fillText(` ${H}`,g+ti,f);const z=G[b.result];e.fillStyle=Bv(b.result);const V=e.measureText(` ${H} `).width;e.fillText(`(${z})`,g+ti+V,f),e.fillStyle="#666";const j=e.measureText(`(${z}) `).width;e.fillText(`@ ${b.completedAtTick.toFixed(1)}h`,g+ti+V+j,f),f+=Rt,b.message&&(e.fillStyle="#888",e.fillText(`   ${b.message}`,g+ti,f),f+=Rt)}f+=Rt,e.fillStyle="#66ccff",e.font=`bold ${Ln}px monospace`,e.fillText(" Available Tasks",g,f),f+=Rt*1.5;const T=f,P=u+l-T-30;e.save(),e.beginPath(),e.rect(d,T,a,P),e.clip();const R=((N=t.debugPanelScroll)==null?void 0:N.y)??0;e.translate(0,-R);const w=t.search.tasks.byRadius(m.position,800);let k=0;if(w.length===0)e.fillStyle="#888",e.font=`${Ln}px monospace`,e.fillText("No tasks available in the world.",g+ti,f),f+=Rt;else{const b=w.map(H=>{const z=Yu[H.type];return{task:H,score:z&&z.scorer&&S.type==="human"?z.scorer(S,H,{gameState:t,deltaTime:0}):null}});b.sort((H,z)=>{const V=H.score!==null?H.score:-1/0;return(z.score!==null?z.score:-1/0)-V});for(const{task:H,score:z}of b){let V="Unclaimed",j="#888";H.claimedByEntityId&&(H.claimedByEntityId===S.id?(V="Claimed by this character",j="#4CAF50"):(V=`Claimed by #${H.claimedByEntityId}`,j="#F44336")),e.font=`${Ln}px monospace`,e.fillStyle=j;const ee=` Task ID: ${H.id}`;e.fillText(ee,g,f),f+=Rt,e.fillStyle="white",e.fillText(`  Type: ${se[H.type]}`,g,f),f+=Rt;const ne=z!==null?z.toFixed(3):"N/A";e.fillStyle=z!==null&&z>0?"#FFC107":"#888",e.fillText(`  Score: ${ne}`,g,f),f+=Rt,e.fillStyle=j,e.fillText(`  Status: ${V}`,g,f),f+=Rt*1.5,k=Math.max(k,e.measureText(ee).width+30)}}const M=f-T;t.debugPanelContentSize={width:k,height:M},e.restore();const D=u+l-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",d+a/2,D),e.restore()}function rL(e,t,n,i){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey")return;switch(a.aiType){case $t.TaskBased:oL(e,t,n,i);break;case $t.BehaviorTreeBased:OB(e,t,n,i);break}const l=500,d=n-l-10,u=et+it*2,f=150,g=25,m=d+l-f-15,S=u+15,v={x:m,y:S,width:f,height:g};t.uiButtons.push({id:"switch-ai-type-button",action:de.SwitchAIType,rect:v,text:"",currentWidth:f,backgroundColor:"rgba(100, 100, 100, 0.5)",textColor:"white"}),e.save(),e.fillStyle="rgba(100, 100, 100, 0.8)",e.fillRect(m,S,f,g),e.strokeStyle="#fff",e.lineWidth=1,e.strokeRect(m,S,f,g),e.fillStyle="white",e.font="10px monospace",e.textAlign="center",e.textBaseline="middle";const A=a.aiType===$t.BehaviorTreeBased?"BT":"Task";e.fillText(`AI: ${A} (Switch)`,m+f/2,S+g/2),e.restore()}function pu(e,t,n,i,s,a=!1){var f;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),hB(e,t);return}const l=vt(t),d=nL(e,t,n,s,l==null?void 0:l.leaderId);if(JF(e,t,n,s),bF(e,t,t.debugPanel===je.General,n,s,d),l&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const g=Qg(t.mousePosition,n,s,t.mapDimensions),m=da(g,t.selectedBuildingType,l.leaderId,t);uF(e,g,t.selectedBuildingType,m,t.mapDimensions)}const u=t.notifications.filter(g=>!g.isDismissed);for(const g of u){const m=(Math.sin(t.time*pP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=gP,g.targetArea&&e.fillRect(g.targetArea.x,g.targetArea.y,g.targetArea.width,g.targetArea.height),g.targetRadius&&(e.beginPath(),e.arc(g.targetRadius.x,g.targetRadius.y,g.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,_B(e,t),e.restore(),!a){e.fillStyle=E1,e.font=`${it}px "Press Start 2P", Arial`,e.shadowColor=C1,e.shadowBlur=_1,t.uiButtons=[];let g=null,m=null;if(l){const A=Dn(t,l),I=jr(A),T=((f=l.partnerIds)==null?void 0:f.map(R=>t.entities.entities[R]).filter(R=>R!==void 0))||[],P=BF(e,t,l,I,T,A);g=P.hungerBarRect,m=P.foodBarRect}const S=Ou(t,l==null?void 0:l.leaderId);dB(e,t,S,e.canvas.width,e.canvas.height);const{commandButtonsRect:v}=Zb(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,l&&(EB(e,t,n,e.canvas.width,e.canvas.height),i.length>0&&tB(e,i,l,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:A}=t.tutorialState;A.includes(Wr.HUNGER_BAR)&&g&&mg(e,g,t.time),A.includes(Wr.FOOD_BAR)&&m&&mg(e,m,t.time),A.includes(Wr.COMMAND_BUTTONS)&&v&&mg(e,v,t.time)}if(t.tutorialState.isActive){const A=fB(e,t,e.canvas.width,e.canvas.height);A&&t.uiButtons.push({id:"tutorial-dismiss",action:de.DismissTutorial,rect:A,text:"",currentWidth:A.width,backgroundColor:"transparent",textColor:"transparent"})}switch(RB(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case je.Ecosystem:UF(e,t,e.canvas.width,e.canvas.height);break;case je.Tribe:YF(e,t,e.canvas.width,e.canvas.height);break;case je.SupplyChain:bB(e,t,e.canvas.width,e.canvas.height);break;case je.Performance:DB(e,t,s.width);break;case je.General:rL(e,t,e.canvas.width,e.canvas.height);break}if(t.roleManagerOpen&&l&&l.leaderId===l.id){const A=KF(e,t,l);t.uiButtons.push(...A)}if(t.armyControlOpen&&l&&l.leaderId===l.id){const A=qF(e,t,l);t.uiButtons.push(...A)}t.isPaused&&t.exitConfirmation!=="pending"&&Qb(e),t.exitConfirmation==="pending"&&XF(e,t,e.canvas.width,e.canvas.height)}}const sL=Ot.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,aL=Ot.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,lL=Ot.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,cL=Ot.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Fv=Ot.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,dL=Ot.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,uL=Ot.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,Fd="intro-soundtrack",Lv=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=Kr(),i=Be.useRef(null),s=Be.useRef(null),a=Be.useRef(Xk()),l=Be.useRef(),d=Be.useRef(a.current.viewportCenter),u=Be.useRef(),f=Be.useCallback(()=>{ig(Fd,2),n(),e("game")},[e,n]),g=Be.useCallback(()=>{t&&(ig(Fd,2),e("game"))},[e,t]);Be.useEffect(()=>{const v=A=>{(A.key==="Enter"||A.key===" ")&&(t?g():f())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[f,g,t]),Be.useEffect(()=>(bp(_e.SoundTrack1,{loop:!0,trackId:Fd}),()=>{ig(Fd,2)}),[]),Be.useEffect(()=>{const v=i.current;if(!v)return;s.current=v.getContext("2d");const A=()=>{v&&s.current&&(v.width=window.innerWidth,v.height=window.innerHeight,pu(s.current,a.current,d.current,[],{width:v.width,height:v.height},!0))};return A(),window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]),Be.useEffect(()=>{const v=()=>{const I=QA(a.current);if(I.length>0){const T=Math.floor(Math.random()*I.length);u.current=I[T].id}};v();const A=setInterval(v,mw);return()=>clearInterval(A)},[]);const[m,S]=SA(v=>{var T,P;if(!s.current)return;if(l.current===void 0){l.current=v;return}const A=Math.min((v-l.current)/1e3,1);a.current=zu(a.current,A);const I=u.current?a.current.entities.entities[u.current]:void 0;if(I){const{mapDimensions:R}=a.current,{width:w,height:k}=R;let M={...I.position};const D=M.x-d.current.x;Math.abs(D)>w/2&&(D>0?M.x-=w:M.x+=w);const N=M.y-d.current.y;Math.abs(N)>k/2&&(N>0?M.y-=k:M.y+=k);let b=tp(d.current,M,fp*A);b={x:(b.x%w+w)%w,y:(b.y%k+k)%k},d.current=b}pu(s.current,a.current,d.current,[],{width:((T=i.current)==null?void 0:T.width)||800,height:((P=i.current)==null?void 0:P.height)||600},!0),l.current=v});return Be.useEffect(()=>(S(),m),[S,m]),Ue.jsxs(sL,{children:[Ue.jsx(aL,{ref:i}),Ue.jsxs(lL,{children:[Ue.jsx(cL,{children:"Tribe2"}),Ue.jsxs(dL,{children:[Ue.jsx(Fv,{onClick:f,children:"New Game"}),t&&Ue.jsx(Fv,{onClick:g,children:"Load Game"})]}),Ue.jsxs(uL,{children:["by"," ",Ue.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function fL(){console.log("Tribe game initialized with detailed 2D world state.");const e=jk();return e.ecosystem={preyGestationPeriod:Ur,preyProcreationCooldown:Hr,predatorGestationPeriod:Gr,predatorProcreationCooldown:$r,preyHungerIncreasePerHour:zo,predatorHungerIncreasePerHour:jo,berryBushSpreadChance:ao},e.debugPanel=je.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const hL=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:i,playerActionHintsRef:s})=>(Be.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const l=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,pu(t.current,n.current,i.current,s.current,{width:a.width,height:a.height},!1))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),Ue.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),gL=(e,t,n,i=!1)=>{var l,d;let s;const a=s1(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:re.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:re.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const u=a;t.isAdult&&qr(t,u,n)?s={action:re.AutopilotAttack,targetEntityId:u.id}:or(t,u,n)?s={action:re.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:re.AutopilotFeedChild,targetEntityId:u.id})}else if(a.type==="prey")s={action:re.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:re.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const u=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&Vt(t,u,n)&&u.isConstructed?s={action:re.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:re.Removal,position:a.position};else if(t.leaderId===t.id&&Vt(t,u,n)&&u.isConstructed)zA(u.position,aa,t.id,n).valid?s={action:re.TakeOverBuilding,targetEntityId:u.id}:s={action:re.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const f=u.ownerId===t.leaderId,g=u.storedItems.length>0,m=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(i&&u.isConstructed&&g&&t.food.length<t.maxFood)if(f)s={action:re.AutopilotRetrieve,targetEntityId:a.id};else{const S=t.leaderId?n.entities.entities[t.leaderId]:void 0;S&&((l=S.tribeControl)!=null&&l.diplomacy)?(u.ownerId&&S.tribeControl.diplomacy[u.ownerId])===Ut.Hostile?s={action:re.AutopilotGather,targetEntityId:a.id}:s={action:re.AutopilotMove,position:e}:s={action:re.AutopilotMove,position:e}}else f&&u.isConstructed?(t.food.length>0||t.heldItem)&&m?s={action:re.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&g?s={action:re.AutopilotRetrieve,targetEntityId:a.id}:s={action:re.AutopilotMove,position:e}:s={action:re.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(f=>f.type===An.Berry).length>=uo&&!zn(e,n,Zo)&&!Ui(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:re.AutopilotPlant,position:e}:u.buildingType===le.Bonfire&&((d=t.heldItem)==null?void 0:d.type)===yt.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:re.AutopilotDeposit,targetEntityId:u.id}:s={action:re.AutopilotMove,position:e}}else if(a.type==="tree"){const u=a,[f]=u.stateMachine??[],g=f===an||f===Kt||f===vn;t.isAdult&&!t.heldItem&&g?s={action:re.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&f===Gt&&u.wood.length>0?s={action:re.AutopilotGather,targetEntityId:u.id}:s={action:re.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===An.Berry).length>=uo&&(n.autopilotControls.isManuallyPlanting||Ql(e,n,t))&&!Ui(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:re.AutopilotPlant,position:e}:s={action:re.AutopilotMove,position:e};return s},pL=(e,t)=>{if(e.isPaused)return;const n=vt(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=U(n.position,t,e.mapDimensions.width,e.mapDimensions.height),l=100;a<=l?da(t,s,n.leaderId,e,n.position,l)&&(Ko(t,s,n.leaderId,e),e.selectedBuildingType=null):da(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:re.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=p1(t,e);s&&Gg(s.id,e);return}const i=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,i?(e.autopilotControls.activeAutopilotAction=i,(i.action===re.AutopilotMove||i.action===re.AutopilotGather||i.action===re.AutopilotChop)&&(e.hasPlayerMovedEver=!0),i.action===re.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:re.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},mL=(e,t)=>{var l,d,u,f,g,m,S,v;const n=e.key.toLowerCase(),i=e.ctrlKey||e.metaKey;let s=!0,a=t;if(i){switch(n){case"s":rp(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:A}=t;A.activeAutopilotAction||A.isManuallyMoving||A.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(A.activeAutopilotAction=void 0,A.isManuallyMoving=!1,A.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"u":const I=vt(t);I&&I.isAdult&&I.leaderId===I.id&&(e.shiftKey?t.autopilotControls.behaviors.roleManagement=!t.autopilotControls.behaviors.roleManagement:t.roleManagerOpen=!t.roleManagerOpen);break;case"v":{const R=vt(t);R&&R.isAdult&&R.leaderId===R.id&&(t.armyControlOpen=!t.armyControlOpen);break}case"m":t.isMuted=!t.isMuted,Pl(t.masterVolume,t.isMuted);break;case"=":case"+":const T=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(T.toFixed(1)),Pl(t.masterVolume,t.isMuted);break;case"-":const P=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(P.toFixed(1)),Pl(t.masterVolume,t.isMuted);break;case"t":a=zu(t,OI);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===je.General?(a.debugPanel=je.None,a.debugCharacterId=void 0):(a.debugPanel=je.General,a.debugCharacterId||(a.debugCharacterId=((l=vt(a))==null?void 0:l.id)??((d=Object.values(a.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:d.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===je.Ecosystem){a.debugPanel=je.None;break}a.debugPanel=je.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((u=vt(a))==null?void 0:u.id)??((f=Object.values(a.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:f.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===je.Tribe){a.debugPanel=je.None;break}a.debugPanel=je.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((g=vt(a))==null?void 0:g.id)??((m=a.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:m.id))}else s=!1;break;case"$":if(e.shiftKey){if(a.debugPanel===je.SupplyChain){a.debugPanel=je.None;break}a.debugPanel=je.SupplyChain,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((S=vt(a))==null?void 0:S.id)??((v=a.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:v.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===je.Performance){a.debugPanel=je.None;break}a.debugPanel=je.Performance}else s=!1;break;case"tab":if(a.debugPanel!==je.General&&a.debugPanel!==je.Tribe&&a.debugPanel!==je.SupplyChain&&(a.debugPanel=je.General),a.debugPanel===je.General){const R=Object.values(a.entities.entities).filter(w=>w.type==="human"||w.type==="prey"||w.type==="predator");if(R.length>0){const w=R.sort((N,b)=>{if(N.type==="human"&&N.isPlayer)return-1;if(b.type==="human"&&b.isPlayer)return 1;if(N.type!==b.type){const H={human:0,prey:1,predator:2},z=H[N.type]??999,V=H[b.type]??999;return z-V}return N.id-b.id}),k=a.debugCharacterId,D=((k?w.findIndex(N=>N.id===k):-1)+1)%w.length;a.debugCharacterId=w[D].id}else a.debugCharacterId=void 0}else if(a.debugPanel===je.Tribe||a.debugPanel===je.SupplyChain){const R=a.search.human.all().filter(k=>k.leaderId===k.id);let w=R.findIndex(k=>k.id===a.debugCharacterId)+1;(w===-1||w>R.length-1)&&(w=0),a.debugCharacterId=R[w].id}else a.debugPanel=je.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},yL=(e,t,n,i,s)=>{var l;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",Ne(a,_e.ButtonClick,i.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",Ne(a,_e.ButtonClick,i.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",Ne(a,_e.ButtonClick,i.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",Ne(a,_e.ButtonClick,i.position);return}else if(e==="6"){n.selectedBuildingType="removal",Ne(a,_e.ButtonClick,i.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=be(i,n,"berryBush",ze,g=>g.food.length>0&&i.food.length<i.maxFood),u=be(i,n,"corpse",ze,g=>g.food.length>0&&i.food.length<i.maxFood);let f=null;d&&u?f=U(i.position,d.position,n.mapDimensions.width,n.mapDimensions.height)<=U(i.position,u.position,n.mapDimensions.width,n.mapDimensions.height)?d:u:f=d||u,f&&(i.activeAction="gathering",Ne(a,_e.Gather,i.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}be(i,n,"human",ze,u=>or(i,u,n))&&(i.activeAction="procreating",Ne(a,_e.Procreate,i.position))}else if(e==="f")i.food.length>0&&(i.activeAction="eating",Ne(a,_e.Eat,i.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=s.find(u=>u.type===re.FeedChild);d&&d.targetEntity&&(i.activeAction="feeding",i.target=d.targetEntity.id)}else if(e==="arrowup"||e==="w")i.direction.y=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")i.direction.y=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")i.direction.x=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")i.direction.x=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const d=be(i,n,"human",Sn,u=>qr(i,u,n))??be(i,n,"predator",Sn)??be(i,n,"prey",Sn);d&&(i.activeAction="attacking",i.attackTargetId=d.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===re.Plant)){const u=hR(i.position,n,50,kg);u&&(i.activeAction="planting",i.target=u,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=be(i,n,"building",qt,f=>{const g=f;return g.buildingType===le.Bonfire&&g.isConstructed&&g.storedItems.length<(g.storageCapacity||0)});if(((l=i.heldItem)==null?void 0:l.type)===yt.Wood&&d){i.activeAction="depositing",i.target=d.id,Ne(a,_e.StorageDeposit,i.position);return}const u=be(i,n,"building",qt,f=>{const g=f;return g.buildingType===le.StorageSpot&&g.ownerId===i.leaderId&&g.isConstructed&&g.storageCapacity!==void 0&&g.storedItems.length<g.storageCapacity});u&&(i.activeAction="idle",i.target=u.id,Ne(a,_e.StorageDeposit,i.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=be(i,n,"building",qt,u=>{const f=u;return f.buildingType==="storageSpot"&&f.ownerId===i.leaderId&&f.isConstructed&&f.storedItems.length>0});d&&(i.activeAction="idle",i.target=d.id,Ne(a,_e.StorageRetrieve,i.position))}else if(e==="k")xI(i,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,Ne(a,_e.ButtonClick,i.position)}else if(e==="u"){if(t){n.autopilotControls.behaviors.roleManagement=!n.autopilotControls.behaviors.roleManagement;return}}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const d=be(i,n,"tree",Cu,u=>u.wood&&u.wood.length>0&&!i.heldItem);d&&(i.activeAction="chopping",i.target=d.id)}},SL=(e,t,n,i)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!i.current.has("arrowup")&&!i.current.has("arrowdown")&&!i.current.has("arrowleft")&&!i.current.has("arrowright")&&!i.current.has("w")&&!i.current.has("a")&&!i.current.has("s")&&!i.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!i.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!i.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!i.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!i.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!i.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},vL=(e,t,n)=>{let s=vt(e);if(e.debugCharacterId){const a=e.entities.entities[e.debugCharacterId];a&&"position"in a&&(s=a)}if(s){const{mapDimensions:a}=e,{width:l,height:d}=a;let u={...s.position};const f=u.x-t.x;Math.abs(f)>l/2&&(f>0?u.x-=l:u.x+=l);const g=u.y-t.y;Math.abs(g)>d/2&&(g>0?u.y-=d:u.y+=d);let m=tp(t,u,fp*n);return m={x:(m.x%l+l)%l,y:(m.y%d+d)%d},m}return e.viewportCenter};function AL(e,t){const{width:n,height:i}=e.mapDimensions;e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%i+i)%i}}const IL=(e,t,n,i)=>{var u,f;const s={gameState:n},a=vt(n);a&&Ne(s,_e.ButtonClick,a.position);const l=n.uiButtons.find(g=>g.id===e.id);l&&(l.lastActivated=Date.now()),t&&[de.CommandGather,de.CommandPlant,de.ToggleProcreationBehavior,de.CommandBuild,de.OpenRoleManager].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:d}=n.autopilotControls;switch(e.action){case de.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case de.ConfirmExitYes:i(),n.exitConfirmation="inactive";break;case de.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case de.ToggleMute:n.isMuted=!n.isMuted,Pl(n.masterVolume,n.isMuted);break;case de.TogglePause:n.isPaused=!n.isPaused;break;case de.FastForward:return zu(n,OI);case de.DismissTutorial:n.tutorialState.isActive=!1;break;case de.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case de.CommandGather:t?d.gathering=!d.gathering:a&&(a.activeAction="gathering");break;case de.CommandPlant:t?d.planting=!d.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case de.ToggleProcreationBehavior:d.procreation=!d.procreation;break;case de.ToggleAttackBehavior:d.attack=!d.attack;break;case de.ToggleFeedChildBehavior:d.feedChildren=!d.feedChildren;break;case de.CommandTribeSplit:a&&xI(a,n);break;case de.CommandBuild:t?d.build=!d.build:n.buildMenuOpen=!n.buildMenuOpen;break;case de.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case de.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case de.SelectRemovalTool:n.selectedBuildingType="removal";break;case de.SelectBorderPost:n.selectedBuildingType="borderPost";break;case de.SelectBonfire:n.selectedBuildingType="bonfire";break;case de.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const g=a.leaderId,m=e.targetTribeId,S=n.entities.entities[m],v=(u=a.tribeControl)==null?void 0:u.diplomacy,A=(f=S==null?void 0:S.tribeControl)==null?void 0:f.diplomacy;if(v&&A){const T=(v[m]||Ut.Friendly)===Ut.Friendly?Ut.Hostile:Ut.Friendly;v[m]=T,A[g]=T}}break;case de.OpenRoleManager:t?d.roleManagement=!d.roleManagement:n.roleManagerOpen=!0;break;case de.CloseRoleManager:n.roleManagerOpen=!1;break;case de.IncreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const g=a.tribeControl.roleWeights[e.targetRole]||0;g<10&&(a.tribeControl.roleWeights[e.targetRole]=g+1)}break;case de.DecreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const g=a.tribeControl.roleWeights[e.targetRole]||0;g>0&&(a.tribeControl.roleWeights[e.targetRole]=g-1)}break;case de.OpenArmyControl:n.armyControlOpen=!0;break;case de.CloseArmyControl:n.armyControlOpen=!1;break;case de.IncreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Wg,expandBorders:Yg,invadeEnemies:zg});const g=a.tribeControl.armyControl[e.targetArmyObjective]||0;g<10&&(a.tribeControl.armyControl[e.targetArmyObjective]=g+1)}break;case de.DecreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Wg,expandBorders:Yg,invadeEnemies:zg});const g=a.tribeControl.armyControl[e.targetArmyObjective]||0;g>0&&(a.tribeControl.armyControl[e.targetArmyObjective]=g-1)}break;case de.SwitchAIType:if(n.debugCharacterId){const g=n.entities.entities[n.debugCharacterId];g&&(g.aiType=g.aiType===$t.BehaviorTreeBased?$t.TaskBased:$t.BehaviorTreeBased)}break}return n};function TL(e,t,n){if(!e.notificationButtonRects)return!1;const i=vt(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return dR(e,s),i&&Ne({gameState:e},_e.ButtonClick,i.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const l=e.notifications.find(d=>d.id===s);if(l){let d=l.targetPosition;if(!d&&l.targetEntityIds&&l.targetEntityIds.length>0){const u=e.entities.entities[l.targetEntityIds[0]];u&&(d=u.position)}return d&&AL(e,d),i&&Ne({gameState:e},_e.ButtonClick,i.position),l.highlightedEntityIds&&(l.renderHighlights=!l.renderHighlights),!0}}return!1}function BT(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const EL=(e,t)=>{var n;if(t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(BT(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},CL=(e,t)=>t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:BT(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Uv=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},_L=(e,t)=>{var n,i;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const l=t.debugPanelRect.height-60,d=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.height)??0)-l);return t.debugPanelScroll.y>d&&(t.debugPanelScroll.y=d),{newState:t,handled:!0}}return{newState:t,handled:!1}},wL=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,returnToIntro:l})=>(Be.useEffect(()=>{const d=u=>{if(!e()||t.current.gameOver||!n.current)return;const f=EL(u,t.current);t.current=f.newState,f.handled};return window.addEventListener("wheel",d,{passive:!1}),()=>{window.removeEventListener("wheel",d)}},[e,n,t]),Be.useEffect(()=>{const d=f=>{if(!e()||t.current.gameOver||!n.current||!f.target||f.target!==n.current)return;const g=n.current.getBoundingClientRect(),m=f.clientX-g.left,S=f.clientY-g.top;if(TL(t.current,m,S))return;const A=t.current.uiButtons.find(P=>m>=P.rect.x&&m<=P.rect.x+P.rect.width&&S>=P.rect.y&&S<=P.rect.y+P.rect.height);if(A){t.current=IL(A,f.shiftKey,t.current,l);return}const I=CL(f,t.current);if(t.current=I.newState,I.handled)return;const T=Qg({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);pL(t.current,T)},u=f=>{if(!e()||!n.current)return;const g=Uv(f,t.current);t.current=g.newState};return window.addEventListener("mousedown",d),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("mouseup",u)}},[e,n,t,i,l]),Be.useEffect(()=>{const d=u=>{if(!e()||!n.current)return;const f=_L(u,t.current);if(t.current=f.newState,f.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const I=Uv(u,t.current);t.current=I.newState}const g=n.current.getBoundingClientRect(),m=u.clientX-g.left,S=u.clientY-g.top;t.current.mousePosition={x:m,y:S};let v;if(t.current.notificationButtonRects){for(const[I,T]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=T.x&&m<=T.x+T.width&&S>=T.y&&S<=T.y+T.height){v=`notification-dismiss-${I}`;break}if(!v){for(const[I,T]of Object.entries(t.current.notificationButtonRects.view))if(m>=T.x&&m<=T.x+T.width&&S>=T.y&&S<=T.y+T.height){v=`notification-view-${I}`;break}}}if(!v)for(let I=t.current.uiButtons.length-1;I>=0;I--){const T=t.current.uiButtons[I];if(m>=T.rect.x&&m<=T.rect.x+T.rect.width&&S>=T.rect.y&&S<=T.rect.y+T.rect.height){v=T.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0;return}const A=vt(t.current);if(A){const I=Qg({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=gL(I,A,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}},[e,n,t,i]),Be.useEffect(()=>{const d=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();(g===" "||g==="p"||g==="tab"||(f.ctrlKey||f.metaKey)&&(g==="s"||g==="a"))&&f.preventDefault();const m=mL(f,t.current);if(t.current=m.newState,m.handled)return;const S=vt(t.current);S&&(a.current.add(g),yL(g,f.shiftKey,t.current,S,s.current))},u=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();a.current.delete(g);const m=vt(t.current);m&&SL(g,m,t.current,a)};return window.addEventListener("keydown",d),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}},[e,t,s,a,l]),null),RL=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,canvasRef:l,setAppState:d,appState:u})=>{const f=Be.useRef(),{returnToIntro:g}=Kr(),[m,S,v]=SA(A=>{var k,M;if(!t.current||!f.current){f.current=A;return}const I=Math.min(A-f.current,1e3)/1e3,{performanceMetrics:T}=e.current;T.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const P=performance.now();e.current=zu(e.current,I),T.currentBucket.worldUpdateTime=performance.now()-P;const R=vt(e.current);R?s.current=Up(e.current,R):s.current=[],i.current=vL(e.current,i.current,I);const w=performance.now();pu(t.current,e.current,i.current,s.current,{width:((k=l.current)==null?void 0:k.width)||800,height:((M=l.current)==null?void 0:M.height)||600},!1),T.currentBucket.renderTime=performance.now()-w,T.history.push({bucketTime:e.current.time,...T.currentBucket}),T.history.length>yw&&T.history.shift(),f.current=A,e.current.gameOver&&u!=="gameOver"&&(bp(_e.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),d("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return Be.useEffect(()=>(S(),m),[S,m]),Ue.jsx(wL,{isActive:v,gameStateRef:e,canvasRef:l,viewportCenterRef:i,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:g})},Hv=()=>{const{savedGameState:e,contextReady:t}=Kr(),[n,i]=Be.useState(null);return Be.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),i(e)):(console.log("Initializing new game state..."),i(fL())))},[t,e]),!t||!n?Ue.jsx("div",{children:"Loading..."}):Ue.jsx(PL,{initialState:n})},PL=({initialState:e})=>{const t=Be.useRef(null),n=Be.useRef(null),i=Be.useRef(e),s=Be.useRef(new Set),a=Be.useRef(e.debugPanel),l=Be.useRef(e.viewportCenter),d=Be.useRef([]),{appState:u,setAppState:f}=Kr();return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(hL,{canvasRef:t,ctxRef:n,gameStateRef:i,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:d}),Ue.jsx(RL,{gameStateRef:i,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:d,keysPressed:s,canvasRef:t,setAppState:f,appState:u})]})},DL=Ot.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,NL=Ot.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Ld=Ot.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,ML=Ot.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,OL=()=>{const{setAppState:e,gameOverDetails:t}=Kr(),n=()=>{e("intro")};return Ue.jsxs(DL,{children:[Ue.jsx(NL,{children:"Game Over"}),Ue.jsx(Ld,{children:"Your tribe's lineage has ended."}),t&&Ue.jsxs(Ue.Fragment,{children:[Ue.jsxs(Ld,{children:["Generations Survived: ",t.generations]}),Ue.jsxs(Ld,{children:["Cause of Extinction: ",t.cause]})]}),!t&&Ue.jsx(Ld,{children:"Game details are unavailable."}),Ue.jsx(ML,{onClick:n,children:"Return to Menu"})]})},kL=Ot.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,bL=Ot.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,BL=Ot.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,FL=Ot.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,LL=Ot.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,FT=Ot.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,UL=Ot(FT)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,yl=800,Sl=600,HL=()=>{const{returnToIntro:e}=Kr(),t=Be.useRef(null),n=Be.useRef(),i=Be.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:yl,height:Sl}}),s=l=>{const d={x:yl/2,y:Sl/2};let u;l===Ce.StoneProjectile&&(u={x:d.x+200*(Math.random()-Math.random()),y:d.y+200*(Math.random()-Math.random())}),Ge(i.current,l,d,1,void 0,u)};Be.useEffect(()=>{const l=()=>{i.current.time+=.016,TT(i.current);const u=t.current,f=u==null?void 0:u.getContext("2d");f&&(f.clearRect(0,0,yl,Sl),f.fillStyle="#2c5234",f.fillRect(0,0,yl,Sl),i.current.visualEffects.forEach(g=>{kT(f,g,i.current.time,i.current)})),n.current=requestAnimationFrame(l)};return n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(Ce).filter(l=>isNaN(Number(l))).map(l=>({name:l,value:Ce[l]}));return Ue.jsxs(kL,{children:[Ue.jsxs(bL,{children:[Ue.jsx(LL,{children:"Visual Effects"}),a.map(l=>Ue.jsx(FT,{onClick:()=>s(l.value),children:l.name},l.name)),Ue.jsx(UL,{onClick:e,children:"Back to Intro"})]}),Ue.jsxs(BL,{children:[Ue.jsx(FL,{ref:t,width:yl,height:Sl}),Ue.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},GL=dw`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function $L(e,t){Be.useEffect(()=>{const n=()=>{const i=document.location.hash;t(i==="#game"?"game":i==="#effects"?"effects":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),Be.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const xL=()=>{const{appState:e,setAppState:t}=Kr();$L(e,t);const n=()=>{switch(e){case"intro":return Ue.jsx(Lv,{});case"game":return Ue.jsx(Hv,{});case"effects":return Ue.jsx(HL,{});case"gameOver":return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(Hv,{}),Ue.jsx(OL,{})]});default:return Ue.jsx(Lv,{})}};return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(GL,{}),n()]})},Gv=document.getElementById("root");Gv?fD().then(()=>{YC.createRoot(Gv).render(Ue.jsx(Bi.StrictMode,{children:Ue.jsx(c_,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:Ue.jsx(xL,{})})}))}):console.error("Failed to find the root element");
