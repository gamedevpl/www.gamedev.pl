var F1=Object.defineProperty;var L1=(e,t,n)=>t in e?F1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var xt=(e,t,n)=>L1(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function Zv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Zf={exports:{}},Ca={},Kf={exports:{}},We={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W0;function x1(){if(W0)return We;W0=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.iterator;function v(D){return D===null||typeof D!="object"?null:(D=m&&D[m]||D["@@iterator"],typeof D=="function"?D:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,T={};function A(D,L,fe){this.props=D,this.context=L,this.refs=T,this.updater=fe||y}A.prototype.isReactComponent={},A.prototype.setState=function(D,L){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,L,"setState")},A.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function R(){}R.prototype=A.prototype;function _(D,L,fe){this.props=D,this.context=L,this.refs=T,this.updater=fe||y}var C=_.prototype=new R;C.constructor=_,I(C,A.prototype),C.isPureReactComponent=!0;var M=Array.isArray,E=Object.prototype.hasOwnProperty,P={current:null},k={key:!0,ref:!0,__self:!0,__source:!0};function B(D,L,fe){var pe,re={},oe=null,me=null;if(L!=null)for(pe in L.ref!==void 0&&(me=L.ref),L.key!==void 0&&(oe=""+L.key),L)E.call(L,pe)&&!k.hasOwnProperty(pe)&&(re[pe]=L[pe]);var F=arguments.length-2;if(F===1)re.children=fe;else if(1<F){for(var ae=Array(F),ye=0;ye<F;ye++)ae[ye]=arguments[ye+2];re.children=ae}if(D&&D.defaultProps)for(pe in F=D.defaultProps,F)re[pe]===void 0&&(re[pe]=F[pe]);return{$$typeof:e,type:D,key:oe,ref:me,props:re,_owner:P.current}}function j(D,L){return{$$typeof:e,type:D.type,key:L,ref:D.ref,props:D.props,_owner:D._owner}}function Z(D){return typeof D=="object"&&D!==null&&D.$$typeof===e}function X(D){var L={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(fe){return L[fe]})}var ie=/\/+/g;function ee(D,L){return typeof D=="object"&&D!==null&&D.key!=null?X(""+D.key):L.toString(36)}function te(D,L,fe,pe,re){var oe=typeof D;(oe==="undefined"||oe==="boolean")&&(D=null);var me=!1;if(D===null)me=!0;else switch(oe){case"string":case"number":me=!0;break;case"object":switch(D.$$typeof){case e:case t:me=!0}}if(me)return me=D,re=re(me),D=pe===""?"."+ee(me,0):pe,M(re)?(fe="",D!=null&&(fe=D.replace(ie,"$&/")+"/"),te(re,L,fe,"",function(ye){return ye})):re!=null&&(Z(re)&&(re=j(re,fe+(!re.key||me&&me.key===re.key?"":(""+re.key).replace(ie,"$&/")+"/")+D)),L.push(re)),1;if(me=0,pe=pe===""?".":pe+":",M(D))for(var F=0;F<D.length;F++){oe=D[F];var ae=pe+ee(oe,F);me+=te(oe,L,fe,ae,re)}else if(ae=v(D),typeof ae=="function")for(D=ae.call(D),F=0;!(oe=D.next()).done;)oe=oe.value,ae=pe+ee(oe,F++),me+=te(oe,L,fe,ae,re);else if(oe==="object")throw L=String(D),Error("Objects are not valid as a React child (found: "+(L==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":L)+"). If you meant to render a collection of children, use an array instead.");return me}function K(D,L,fe){if(D==null)return D;var pe=[],re=0;return te(D,pe,"","",function(oe){return L.call(fe,oe,re++)}),pe}function ue(D){if(D._status===-1){var L=D._result;L=L(),L.then(function(fe){(D._status===0||D._status===-1)&&(D._status=1,D._result=fe)},function(fe){(D._status===0||D._status===-1)&&(D._status=2,D._result=fe)}),D._status===-1&&(D._status=0,D._result=L)}if(D._status===1)return D._result.default;throw D._result}var ce={current:null},Y={transition:null},J={ReactCurrentDispatcher:ce,ReactCurrentBatchConfig:Y,ReactCurrentOwner:P};function V(){throw Error("act(...) is not supported in production builds of React.")}return We.Children={map:K,forEach:function(D,L,fe){K(D,function(){L.apply(this,arguments)},fe)},count:function(D){var L=0;return K(D,function(){L++}),L},toArray:function(D){return K(D,function(L){return L})||[]},only:function(D){if(!Z(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},We.Component=A,We.Fragment=n,We.Profiler=s,We.PureComponent=_,We.StrictMode=o,We.Suspense=d,We.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=J,We.act=V,We.cloneElement=function(D,L,fe){if(D==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+D+".");var pe=I({},D.props),re=D.key,oe=D.ref,me=D._owner;if(L!=null){if(L.ref!==void 0&&(oe=L.ref,me=P.current),L.key!==void 0&&(re=""+L.key),D.type&&D.type.defaultProps)var F=D.type.defaultProps;for(ae in L)E.call(L,ae)&&!k.hasOwnProperty(ae)&&(pe[ae]=L[ae]===void 0&&F!==void 0?F[ae]:L[ae])}var ae=arguments.length-2;if(ae===1)pe.children=fe;else if(1<ae){F=Array(ae);for(var ye=0;ye<ae;ye++)F[ye]=arguments[ye+2];pe.children=F}return{$$typeof:e,type:D.type,key:re,ref:oe,props:pe,_owner:me}},We.createContext=function(D){return D={$$typeof:l,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},D.Provider={$$typeof:a,_context:D},D.Consumer=D},We.createElement=B,We.createFactory=function(D){var L=B.bind(null,D);return L.type=D,L},We.createRef=function(){return{current:null}},We.forwardRef=function(D){return{$$typeof:u,render:D}},We.isValidElement=Z,We.lazy=function(D){return{$$typeof:p,_payload:{_status:-1,_result:D},_init:ue}},We.memo=function(D,L){return{$$typeof:f,type:D,compare:L===void 0?null:L}},We.startTransition=function(D){var L=Y.transition;Y.transition={};try{D()}finally{Y.transition=L}},We.unstable_act=V,We.useCallback=function(D,L){return ce.current.useCallback(D,L)},We.useContext=function(D){return ce.current.useContext(D)},We.useDebugValue=function(){},We.useDeferredValue=function(D){return ce.current.useDeferredValue(D)},We.useEffect=function(D,L){return ce.current.useEffect(D,L)},We.useId=function(){return ce.current.useId()},We.useImperativeHandle=function(D,L,fe){return ce.current.useImperativeHandle(D,L,fe)},We.useInsertionEffect=function(D,L){return ce.current.useInsertionEffect(D,L)},We.useLayoutEffect=function(D,L){return ce.current.useLayoutEffect(D,L)},We.useMemo=function(D,L){return ce.current.useMemo(D,L)},We.useReducer=function(D,L,fe){return ce.current.useReducer(D,L,fe)},We.useRef=function(D){return ce.current.useRef(D)},We.useState=function(D){return ce.current.useState(D)},We.useSyncExternalStore=function(D,L,fe){return ce.current.useSyncExternalStore(D,L,fe)},We.useTransition=function(){return ce.current.useTransition()},We.version="18.3.1",We}var Y0;function sp(){return Y0||(Y0=1,Kf.exports=x1()),Kf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var j0;function U1(){if(j0)return Ca;j0=1;var e=sp(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(u,d,f){var p,m={},v=null,y=null;f!==void 0&&(v=""+f),d.key!==void 0&&(v=""+d.key),d.ref!==void 0&&(y=d.ref);for(p in d)o.call(d,p)&&!a.hasOwnProperty(p)&&(m[p]=d[p]);if(u&&u.defaultProps)for(p in d=u.defaultProps,d)m[p]===void 0&&(m[p]=d[p]);return{$$typeof:t,type:u,key:v,ref:y,props:m,_owner:s.current}}return Ca.Fragment=n,Ca.jsx=l,Ca.jsxs=l,Ca}var z0;function G1(){return z0||(z0=1,Zf.exports=U1()),Zf.exports}var G=G1(),ne=sp();const wi=Zv(ne);var Gc={},Qf={exports:{}},Tn={},Jf={exports:{}},eh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var X0;function $1(){return X0||(X0=1,function(e){function t(Y,J){var V=Y.length;Y.push(J);e:for(;0<V;){var D=V-1>>>1,L=Y[D];if(0<s(L,J))Y[D]=J,Y[V]=L,V=D;else break e}}function n(Y){return Y.length===0?null:Y[0]}function o(Y){if(Y.length===0)return null;var J=Y[0],V=Y.pop();if(V!==J){Y[0]=V;e:for(var D=0,L=Y.length,fe=L>>>1;D<fe;){var pe=2*(D+1)-1,re=Y[pe],oe=pe+1,me=Y[oe];if(0>s(re,V))oe<L&&0>s(me,re)?(Y[D]=me,Y[oe]=V,D=oe):(Y[D]=re,Y[pe]=V,D=pe);else if(oe<L&&0>s(me,V))Y[D]=me,Y[oe]=V,D=oe;else break e}}return J}function s(Y,J){var V=Y.sortIndex-J.sortIndex;return V!==0?V:Y.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();e.unstable_now=function(){return l.now()-u}}var d=[],f=[],p=1,m=null,v=3,y=!1,I=!1,T=!1,A=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C(Y){for(var J=n(f);J!==null;){if(J.callback===null)o(f);else if(J.startTime<=Y)o(f),J.sortIndex=J.expirationTime,t(d,J);else break;J=n(f)}}function M(Y){if(T=!1,C(Y),!I)if(n(d)!==null)I=!0,ue(E);else{var J=n(f);J!==null&&ce(M,J.startTime-Y)}}function E(Y,J){I=!1,T&&(T=!1,R(B),B=-1),y=!0;var V=v;try{for(C(J),m=n(d);m!==null&&(!(m.expirationTime>J)||Y&&!X());){var D=m.callback;if(typeof D=="function"){m.callback=null,v=m.priorityLevel;var L=D(m.expirationTime<=J);J=e.unstable_now(),typeof L=="function"?m.callback=L:m===n(d)&&o(d),C(J)}else o(d);m=n(d)}if(m!==null)var fe=!0;else{var pe=n(f);pe!==null&&ce(M,pe.startTime-J),fe=!1}return fe}finally{m=null,v=V,y=!1}}var P=!1,k=null,B=-1,j=5,Z=-1;function X(){return!(e.unstable_now()-Z<j)}function ie(){if(k!==null){var Y=e.unstable_now();Z=Y;var J=!0;try{J=k(!0,Y)}finally{J?ee():(P=!1,k=null)}}else P=!1}var ee;if(typeof _=="function")ee=function(){_(ie)};else if(typeof MessageChannel<"u"){var te=new MessageChannel,K=te.port2;te.port1.onmessage=ie,ee=function(){K.postMessage(null)}}else ee=function(){A(ie,0)};function ue(Y){k=Y,P||(P=!0,ee())}function ce(Y,J){B=A(function(){Y(e.unstable_now())},J)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Y){Y.callback=null},e.unstable_continueExecution=function(){I||y||(I=!0,ue(E))},e.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<Y?Math.floor(1e3/Y):5},e.unstable_getCurrentPriorityLevel=function(){return v},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(Y){switch(v){case 1:case 2:case 3:var J=3;break;default:J=v}var V=v;v=J;try{return Y()}finally{v=V}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Y,J){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var V=v;v=Y;try{return J()}finally{v=V}},e.unstable_scheduleCallback=function(Y,J,V){var D=e.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?D+V:D):V=D,Y){case 1:var L=-1;break;case 2:L=250;break;case 5:L=1073741823;break;case 4:L=1e4;break;default:L=5e3}return L=V+L,Y={id:p++,callback:J,priorityLevel:Y,startTime:V,expirationTime:L,sortIndex:-1},V>D?(Y.sortIndex=V,t(f,Y),n(d)===null&&Y===n(f)&&(T?(R(B),B=-1):T=!0,ce(M,V-D))):(Y.sortIndex=L,t(d,Y),I||y||(I=!0,ue(E))),Y},e.unstable_shouldYield=X,e.unstable_wrapCallback=function(Y){var J=v;return function(){var V=v;v=J;try{return Y.apply(this,arguments)}finally{v=V}}}}(eh)),eh}var V0;function W1(){return V0||(V0=1,Jf.exports=$1()),Jf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var q0;function Y1(){if(q0)return Tn;q0=1;var e=sp(),t=W1();function n(i){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+i,c=1;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+i+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function a(i,r){l(i,r),l(i+"Capture",r)}function l(i,r){for(s[i]=r,i=0;i<r.length;i++)o.add(r[i])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function v(i){return d.call(m,i)?!0:d.call(p,i)?!1:f.test(i)?m[i]=!0:(p[i]=!0,!1)}function y(i,r,c,h){if(c!==null&&c.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return h?!1:c!==null?!c.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function I(i,r,c,h){if(r===null||typeof r>"u"||y(i,r,c,h))return!0;if(h)return!1;if(c!==null)switch(c.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function T(i,r,c,h,g,S,w){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=h,this.attributeNamespace=g,this.mustUseProperty=c,this.propertyName=i,this.type=r,this.sanitizeURL=S,this.removeEmptyString=w}var A={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){A[i]=new T(i,0,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var r=i[0];A[r]=new T(r,1,!1,i[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){A[i]=new T(i,2,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){A[i]=new T(i,2,!1,i,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){A[i]=new T(i,3,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){A[i]=new T(i,3,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){A[i]=new T(i,4,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){A[i]=new T(i,6,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){A[i]=new T(i,5,!1,i.toLowerCase(),null,!1,!1)});var R=/[\-:]([a-z])/g;function _(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var r=i.replace(R,_);A[r]=new T(r,1,!1,i,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var r=i.replace(R,_);A[r]=new T(r,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var r=i.replace(R,_);A[r]=new T(r,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){A[i]=new T(i,1,!1,i.toLowerCase(),null,!1,!1)}),A.xlinkHref=new T("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){A[i]=new T(i,1,!1,i.toLowerCase(),null,!0,!0)});function C(i,r,c,h){var g=A.hasOwnProperty(r)?A[r]:null;(g!==null?g.type!==0:h||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(I(r,c,g,h)&&(c=null),h||g===null?v(r)&&(c===null?i.removeAttribute(r):i.setAttribute(r,""+c)):g.mustUseProperty?i[g.propertyName]=c===null?g.type===3?!1:"":c:(r=g.attributeName,h=g.attributeNamespace,c===null?i.removeAttribute(r):(g=g.type,c=g===3||g===4&&c===!0?"":""+c,h?i.setAttributeNS(h,r,c):i.setAttribute(r,c))))}var M=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,E=Symbol.for("react.element"),P=Symbol.for("react.portal"),k=Symbol.for("react.fragment"),B=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),Z=Symbol.for("react.provider"),X=Symbol.for("react.context"),ie=Symbol.for("react.forward_ref"),ee=Symbol.for("react.suspense"),te=Symbol.for("react.suspense_list"),K=Symbol.for("react.memo"),ue=Symbol.for("react.lazy"),ce=Symbol.for("react.offscreen"),Y=Symbol.iterator;function J(i){return i===null||typeof i!="object"?null:(i=Y&&i[Y]||i["@@iterator"],typeof i=="function"?i:null)}var V=Object.assign,D;function L(i){if(D===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);D=r&&r[1]||""}return`
`+D+i}var fe=!1;function pe(i,r){if(!i||fe)return"";fe=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(W){var h=W}Reflect.construct(i,[],r)}else{try{r.call()}catch(W){h=W}i.call(r.prototype)}else{try{throw Error()}catch(W){h=W}i()}}catch(W){if(W&&h&&typeof W.stack=="string"){for(var g=W.stack.split(`
`),S=h.stack.split(`
`),w=g.length-1,b=S.length-1;1<=w&&0<=b&&g[w]!==S[b];)b--;for(;1<=w&&0<=b;w--,b--)if(g[w]!==S[b]){if(w!==1||b!==1)do if(w--,b--,0>b||g[w]!==S[b]){var N=`
`+g[w].replace(" at new "," at ");return i.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",i.displayName)),N}while(1<=w&&0<=b);break}}}finally{fe=!1,Error.prepareStackTrace=c}return(i=i?i.displayName||i.name:"")?L(i):""}function re(i){switch(i.tag){case 5:return L(i.type);case 16:return L("Lazy");case 13:return L("Suspense");case 19:return L("SuspenseList");case 0:case 2:case 15:return i=pe(i.type,!1),i;case 11:return i=pe(i.type.render,!1),i;case 1:return i=pe(i.type,!0),i;default:return""}}function oe(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case k:return"Fragment";case P:return"Portal";case j:return"Profiler";case B:return"StrictMode";case ee:return"Suspense";case te:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case X:return(i.displayName||"Context")+".Consumer";case Z:return(i._context.displayName||"Context")+".Provider";case ie:var r=i.render;return i=i.displayName,i||(i=r.displayName||r.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case K:return r=i.displayName||null,r!==null?r:oe(i.type)||"Memo";case ue:r=i._payload,i=i._init;try{return oe(i(r))}catch{}}return null}function me(i){var r=i.type;switch(i.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=r.render,i=i.displayName||i.name||"",r.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return oe(r);case 8:return r===B?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function F(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function ae(i){var r=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function ye(i){var r=ae(i)?"checked":"value",c=Object.getOwnPropertyDescriptor(i.constructor.prototype,r),h=""+i[r];if(!i.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,S=c.set;return Object.defineProperty(i,r,{configurable:!0,get:function(){return g.call(this)},set:function(w){h=""+w,S.call(this,w)}}),Object.defineProperty(i,r,{enumerable:c.enumerable}),{getValue:function(){return h},setValue:function(w){h=""+w},stopTracking:function(){i._valueTracker=null,delete i[r]}}}}function Se(i){i._valueTracker||(i._valueTracker=ye(i))}function q(i){if(!i)return!1;var r=i._valueTracker;if(!r)return!0;var c=r.getValue(),h="";return i&&(h=ae(i)?i.checked?"true":"false":i.value),i=h,i!==c?(r.setValue(i),!0):!1}function $e(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function xe(i,r){var c=r.checked;return V({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??i._wrapperState.initialChecked})}function He(i,r){var c=r.defaultValue==null?"":r.defaultValue,h=r.checked!=null?r.checked:r.defaultChecked;c=F(r.value!=null?r.value:c),i._wrapperState={initialChecked:h,initialValue:c,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function rt(i,r){r=r.checked,r!=null&&C(i,"checked",r,!1)}function At(i,r){rt(i,r);var c=F(r.value),h=r.type;if(c!=null)h==="number"?(c===0&&i.value===""||i.value!=c)&&(i.value=""+c):i.value!==""+c&&(i.value=""+c);else if(h==="submit"||h==="reset"){i.removeAttribute("value");return}r.hasOwnProperty("value")?st(i,r.type,c):r.hasOwnProperty("defaultValue")&&st(i,r.type,F(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(i.defaultChecked=!!r.defaultChecked)}function _t(i,r,c){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var h=r.type;if(!(h!=="submit"&&h!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+i._wrapperState.initialValue,c||r===i.value||(i.value=r),i.defaultValue=r}c=i.name,c!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,c!==""&&(i.name=c)}function st(i,r,c){(r!=="number"||$e(i.ownerDocument)!==i)&&(c==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+c&&(i.defaultValue=""+c))}var qt=Array.isArray;function Cn(i,r,c,h){if(i=i.options,r){r={};for(var g=0;g<c.length;g++)r["$"+c[g]]=!0;for(c=0;c<i.length;c++)g=r.hasOwnProperty("$"+i[c].value),i[c].selected!==g&&(i[c].selected=g),g&&h&&(i[c].defaultSelected=!0)}else{for(c=""+F(c),r=null,g=0;g<i.length;g++){if(i[g].value===c){i[g].selected=!0,h&&(i[g].defaultSelected=!0);return}r!==null||i[g].disabled||(r=i[g])}r!==null&&(r.selected=!0)}}function no(i,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return V({},r,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Ls(i,r){var c=r.value;if(c==null){if(c=r.children,r=r.defaultValue,c!=null){if(r!=null)throw Error(n(92));if(qt(c)){if(1<c.length)throw Error(n(93));c=c[0]}r=c}r==null&&(r=""),c=r}i._wrapperState={initialValue:F(c)}}function xs(i,r){var c=F(r.value),h=F(r.defaultValue);c!=null&&(c=""+c,c!==i.value&&(i.value=c),r.defaultValue==null&&i.defaultValue!==c&&(i.defaultValue=c)),h!=null&&(i.defaultValue=""+h)}function Us(i){var r=i.textContent;r===i._wrapperState.initialValue&&r!==""&&r!==null&&(i.value=r)}function Go(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function sd(i,r){return i==null||i==="http://www.w3.org/1999/xhtml"?Go(r):i==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Ol,ig=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,c,h,g){MSApp.execUnsafeLocalFunction(function(){return i(r,c,h,g)})}:i}(function(i,r){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=r;else{for(Ol=Ol||document.createElement("div"),Ol.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=Ol.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;r.firstChild;)i.appendChild(r.firstChild)}});function Gs(i,r){if(r){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=r;return}}i.textContent=r}var $s={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},GT=["Webkit","ms","Moz","O"];Object.keys($s).forEach(function(i){GT.forEach(function(r){r=r+i.charAt(0).toUpperCase()+i.substring(1),$s[r]=$s[i]})});function og(i,r,c){return r==null||typeof r=="boolean"||r===""?"":c||typeof r!="number"||r===0||$s.hasOwnProperty(i)&&$s[i]?(""+r).trim():r+"px"}function rg(i,r){i=i.style;for(var c in r)if(r.hasOwnProperty(c)){var h=c.indexOf("--")===0,g=og(c,r[c],h);c==="float"&&(c="cssFloat"),h?i.setProperty(c,g):i[c]=g}}var $T=V({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ad(i,r){if(r){if($T[i]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,i));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function ld(i,r){if(i.indexOf("-")===-1)return typeof r.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var cd=null;function ud(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var dd=null,kr=null,br=null;function sg(i){if(i=ua(i)){if(typeof dd!="function")throw Error(n(280));var r=i.stateNode;r&&(r=nc(r),dd(i.stateNode,i.type,r))}}function ag(i){kr?br?br.push(i):br=[i]:kr=i}function lg(){if(kr){var i=kr,r=br;if(br=kr=null,sg(i),r)for(i=0;i<r.length;i++)sg(r[i])}}function cg(i,r){return i(r)}function ug(){}var fd=!1;function dg(i,r,c){if(fd)return i(r,c);fd=!0;try{return cg(i,r,c)}finally{fd=!1,(kr!==null||br!==null)&&(ug(),lg())}}function Ws(i,r){var c=i.stateNode;if(c===null)return null;var h=nc(c);if(h===null)return null;c=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(i=i.type,h=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!h;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(n(231,r,typeof c));return c}var hd=!1;if(u)try{var Ys={};Object.defineProperty(Ys,"passive",{get:function(){hd=!0}}),window.addEventListener("test",Ys,Ys),window.removeEventListener("test",Ys,Ys)}catch{hd=!1}function WT(i,r,c,h,g,S,w,b,N){var W=Array.prototype.slice.call(arguments,3);try{r.apply(c,W)}catch(le){this.onError(le)}}var js=!1,Nl=null,Bl=!1,pd=null,YT={onError:function(i){js=!0,Nl=i}};function jT(i,r,c,h,g,S,w,b,N){js=!1,Nl=null,WT.apply(YT,arguments)}function zT(i,r,c,h,g,S,w,b,N){if(jT.apply(this,arguments),js){if(js){var W=Nl;js=!1,Nl=null}else throw Error(n(198));Bl||(Bl=!0,pd=W)}}function $o(i){var r=i,c=i;if(i.alternate)for(;r.return;)r=r.return;else{i=r;do r=i,(r.flags&4098)!==0&&(c=r.return),i=r.return;while(i)}return r.tag===3?c:null}function fg(i){if(i.tag===13){var r=i.memoizedState;if(r===null&&(i=i.alternate,i!==null&&(r=i.memoizedState)),r!==null)return r.dehydrated}return null}function hg(i){if($o(i)!==i)throw Error(n(188))}function XT(i){var r=i.alternate;if(!r){if(r=$o(i),r===null)throw Error(n(188));return r!==i?null:i}for(var c=i,h=r;;){var g=c.return;if(g===null)break;var S=g.alternate;if(S===null){if(h=g.return,h!==null){c=h;continue}break}if(g.child===S.child){for(S=g.child;S;){if(S===c)return hg(g),i;if(S===h)return hg(g),r;S=S.sibling}throw Error(n(188))}if(c.return!==h.return)c=g,h=S;else{for(var w=!1,b=g.child;b;){if(b===c){w=!0,c=g,h=S;break}if(b===h){w=!0,h=g,c=S;break}b=b.sibling}if(!w){for(b=S.child;b;){if(b===c){w=!0,c=S,h=g;break}if(b===h){w=!0,h=S,c=g;break}b=b.sibling}if(!w)throw Error(n(189))}}if(c.alternate!==h)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?i:r}function pg(i){return i=XT(i),i!==null?gg(i):null}function gg(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var r=gg(i);if(r!==null)return r;i=i.sibling}return null}var mg=t.unstable_scheduleCallback,yg=t.unstable_cancelCallback,VT=t.unstable_shouldYield,qT=t.unstable_requestPaint,wt=t.unstable_now,ZT=t.unstable_getCurrentPriorityLevel,gd=t.unstable_ImmediatePriority,vg=t.unstable_UserBlockingPriority,Hl=t.unstable_NormalPriority,KT=t.unstable_LowPriority,Sg=t.unstable_IdlePriority,Fl=null,di=null;function QT(i){if(di&&typeof di.onCommitFiberRoot=="function")try{di.onCommitFiberRoot(Fl,i,void 0,(i.current.flags&128)===128)}catch{}}var Kn=Math.clz32?Math.clz32:tA,JT=Math.log,eA=Math.LN2;function tA(i){return i>>>=0,i===0?32:31-(JT(i)/eA|0)|0}var Ll=64,xl=4194304;function zs(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Ul(i,r){var c=i.pendingLanes;if(c===0)return 0;var h=0,g=i.suspendedLanes,S=i.pingedLanes,w=c&268435455;if(w!==0){var b=w&~g;b!==0?h=zs(b):(S&=w,S!==0&&(h=zs(S)))}else w=c&~g,w!==0?h=zs(w):S!==0&&(h=zs(S));if(h===0)return 0;if(r!==0&&r!==h&&(r&g)===0&&(g=h&-h,S=r&-r,g>=S||g===16&&(S&4194240)!==0))return r;if((h&4)!==0&&(h|=c&16),r=i.entangledLanes,r!==0)for(i=i.entanglements,r&=h;0<r;)c=31-Kn(r),g=1<<c,h|=i[c],r&=~g;return h}function nA(i,r){switch(i){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function iA(i,r){for(var c=i.suspendedLanes,h=i.pingedLanes,g=i.expirationTimes,S=i.pendingLanes;0<S;){var w=31-Kn(S),b=1<<w,N=g[w];N===-1?((b&c)===0||(b&h)!==0)&&(g[w]=nA(b,r)):N<=r&&(i.expiredLanes|=b),S&=~b}}function md(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function Ig(){var i=Ll;return Ll<<=1,(Ll&4194240)===0&&(Ll=64),i}function yd(i){for(var r=[],c=0;31>c;c++)r.push(i);return r}function Xs(i,r,c){i.pendingLanes|=r,r!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,r=31-Kn(r),i[r]=c}function oA(i,r){var c=i.pendingLanes&~r;i.pendingLanes=r,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=r,i.mutableReadLanes&=r,i.entangledLanes&=r,r=i.entanglements;var h=i.eventTimes;for(i=i.expirationTimes;0<c;){var g=31-Kn(c),S=1<<g;r[g]=0,h[g]=-1,i[g]=-1,c&=~S}}function vd(i,r){var c=i.entangledLanes|=r;for(i=i.entanglements;c;){var h=31-Kn(c),g=1<<h;g&r|i[h]&r&&(i[h]|=r),c&=~g}}var Ke=0;function Tg(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var Ag,Sd,wg,Eg,Cg,Id=!1,Gl=[],io=null,oo=null,ro=null,Vs=new Map,qs=new Map,so=[],rA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Pg(i,r){switch(i){case"focusin":case"focusout":io=null;break;case"dragenter":case"dragleave":oo=null;break;case"mouseover":case"mouseout":ro=null;break;case"pointerover":case"pointerout":Vs.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":qs.delete(r.pointerId)}}function Zs(i,r,c,h,g,S){return i===null||i.nativeEvent!==S?(i={blockedOn:r,domEventName:c,eventSystemFlags:h,nativeEvent:S,targetContainers:[g]},r!==null&&(r=ua(r),r!==null&&Sd(r)),i):(i.eventSystemFlags|=h,r=i.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),i)}function sA(i,r,c,h,g){switch(r){case"focusin":return io=Zs(io,i,r,c,h,g),!0;case"dragenter":return oo=Zs(oo,i,r,c,h,g),!0;case"mouseover":return ro=Zs(ro,i,r,c,h,g),!0;case"pointerover":var S=g.pointerId;return Vs.set(S,Zs(Vs.get(S)||null,i,r,c,h,g)),!0;case"gotpointercapture":return S=g.pointerId,qs.set(S,Zs(qs.get(S)||null,i,r,c,h,g)),!0}return!1}function _g(i){var r=Wo(i.target);if(r!==null){var c=$o(r);if(c!==null){if(r=c.tag,r===13){if(r=fg(c),r!==null){i.blockedOn=r,Cg(i.priority,function(){wg(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function $l(i){if(i.blockedOn!==null)return!1;for(var r=i.targetContainers;0<r.length;){var c=Ad(i.domEventName,i.eventSystemFlags,r[0],i.nativeEvent);if(c===null){c=i.nativeEvent;var h=new c.constructor(c.type,c);cd=h,c.target.dispatchEvent(h),cd=null}else return r=ua(c),r!==null&&Sd(r),i.blockedOn=c,!1;r.shift()}return!0}function Rg(i,r,c){$l(i)&&c.delete(r)}function aA(){Id=!1,io!==null&&$l(io)&&(io=null),oo!==null&&$l(oo)&&(oo=null),ro!==null&&$l(ro)&&(ro=null),Vs.forEach(Rg),qs.forEach(Rg)}function Ks(i,r){i.blockedOn===r&&(i.blockedOn=null,Id||(Id=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,aA)))}function Qs(i){function r(g){return Ks(g,i)}if(0<Gl.length){Ks(Gl[0],i);for(var c=1;c<Gl.length;c++){var h=Gl[c];h.blockedOn===i&&(h.blockedOn=null)}}for(io!==null&&Ks(io,i),oo!==null&&Ks(oo,i),ro!==null&&Ks(ro,i),Vs.forEach(r),qs.forEach(r),c=0;c<so.length;c++)h=so[c],h.blockedOn===i&&(h.blockedOn=null);for(;0<so.length&&(c=so[0],c.blockedOn===null);)_g(c),c.blockedOn===null&&so.shift()}var Dr=M.ReactCurrentBatchConfig,Wl=!0;function lA(i,r,c,h){var g=Ke,S=Dr.transition;Dr.transition=null;try{Ke=1,Td(i,r,c,h)}finally{Ke=g,Dr.transition=S}}function cA(i,r,c,h){var g=Ke,S=Dr.transition;Dr.transition=null;try{Ke=4,Td(i,r,c,h)}finally{Ke=g,Dr.transition=S}}function Td(i,r,c,h){if(Wl){var g=Ad(i,r,c,h);if(g===null)xd(i,r,h,Yl,c),Pg(i,h);else if(sA(g,i,r,c,h))h.stopPropagation();else if(Pg(i,h),r&4&&-1<rA.indexOf(i)){for(;g!==null;){var S=ua(g);if(S!==null&&Ag(S),S=Ad(i,r,c,h),S===null&&xd(i,r,h,Yl,c),S===g)break;g=S}g!==null&&h.stopPropagation()}else xd(i,r,h,null,c)}}var Yl=null;function Ad(i,r,c,h){if(Yl=null,i=ud(h),i=Wo(i),i!==null)if(r=$o(i),r===null)i=null;else if(c=r.tag,c===13){if(i=fg(r),i!==null)return i;i=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;i=null}else r!==i&&(i=null);return Yl=i,null}function Mg(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ZT()){case gd:return 1;case vg:return 4;case Hl:case KT:return 16;case Sg:return 536870912;default:return 16}default:return 16}}var ao=null,wd=null,jl=null;function kg(){if(jl)return jl;var i,r=wd,c=r.length,h,g="value"in ao?ao.value:ao.textContent,S=g.length;for(i=0;i<c&&r[i]===g[i];i++);var w=c-i;for(h=1;h<=w&&r[c-h]===g[S-h];h++);return jl=g.slice(i,1<h?1-h:void 0)}function zl(i){var r=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&r===13&&(i=13)):i=r,i===10&&(i=13),32<=i||i===13?i:0}function Xl(){return!0}function bg(){return!1}function Pn(i){function r(c,h,g,S,w){this._reactName=c,this._targetInst=g,this.type=h,this.nativeEvent=S,this.target=w,this.currentTarget=null;for(var b in i)i.hasOwnProperty(b)&&(c=i[b],this[b]=c?c(S):S[b]);return this.isDefaultPrevented=(S.defaultPrevented!=null?S.defaultPrevented:S.returnValue===!1)?Xl:bg,this.isPropagationStopped=bg,this}return V(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Xl)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Xl)},persist:function(){},isPersistent:Xl}),r}var Or={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ed=Pn(Or),Js=V({},Or,{view:0,detail:0}),uA=Pn(Js),Cd,Pd,ea,Vl=V({},Js,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Rd,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==ea&&(ea&&i.type==="mousemove"?(Cd=i.screenX-ea.screenX,Pd=i.screenY-ea.screenY):Pd=Cd=0,ea=i),Cd)},movementY:function(i){return"movementY"in i?i.movementY:Pd}}),Dg=Pn(Vl),dA=V({},Vl,{dataTransfer:0}),fA=Pn(dA),hA=V({},Js,{relatedTarget:0}),_d=Pn(hA),pA=V({},Or,{animationName:0,elapsedTime:0,pseudoElement:0}),gA=Pn(pA),mA=V({},Or,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),yA=Pn(mA),vA=V({},Or,{data:0}),Og=Pn(vA),SA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},IA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},TA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function AA(i){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(i):(i=TA[i])?!!r[i]:!1}function Rd(){return AA}var wA=V({},Js,{key:function(i){if(i.key){var r=SA[i.key]||i.key;if(r!=="Unidentified")return r}return i.type==="keypress"?(i=zl(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?IA[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Rd,charCode:function(i){return i.type==="keypress"?zl(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?zl(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),EA=Pn(wA),CA=V({},Vl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ng=Pn(CA),PA=V({},Js,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Rd}),_A=Pn(PA),RA=V({},Or,{propertyName:0,elapsedTime:0,pseudoElement:0}),MA=Pn(RA),kA=V({},Vl,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),bA=Pn(kA),DA=[9,13,27,32],Md=u&&"CompositionEvent"in window,ta=null;u&&"documentMode"in document&&(ta=document.documentMode);var OA=u&&"TextEvent"in window&&!ta,Bg=u&&(!Md||ta&&8<ta&&11>=ta),Hg=" ",Fg=!1;function Lg(i,r){switch(i){case"keyup":return DA.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xg(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Nr=!1;function NA(i,r){switch(i){case"compositionend":return xg(r);case"keypress":return r.which!==32?null:(Fg=!0,Hg);case"textInput":return i=r.data,i===Hg&&Fg?null:i;default:return null}}function BA(i,r){if(Nr)return i==="compositionend"||!Md&&Lg(i,r)?(i=kg(),jl=wd=ao=null,Nr=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Bg&&r.locale!=="ko"?null:r.data;default:return null}}var HA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ug(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r==="input"?!!HA[i.type]:r==="textarea"}function Gg(i,r,c,h){ag(h),r=Jl(r,"onChange"),0<r.length&&(c=new Ed("onChange","change",null,c,h),i.push({event:c,listeners:r}))}var na=null,ia=null;function FA(i){rm(i,0)}function ql(i){var r=xr(i);if(q(r))return i}function LA(i,r){if(i==="change")return r}var $g=!1;if(u){var kd;if(u){var bd="oninput"in document;if(!bd){var Wg=document.createElement("div");Wg.setAttribute("oninput","return;"),bd=typeof Wg.oninput=="function"}kd=bd}else kd=!1;$g=kd&&(!document.documentMode||9<document.documentMode)}function Yg(){na&&(na.detachEvent("onpropertychange",jg),ia=na=null)}function jg(i){if(i.propertyName==="value"&&ql(ia)){var r=[];Gg(r,ia,i,ud(i)),dg(FA,r)}}function xA(i,r,c){i==="focusin"?(Yg(),na=r,ia=c,na.attachEvent("onpropertychange",jg)):i==="focusout"&&Yg()}function UA(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return ql(ia)}function GA(i,r){if(i==="click")return ql(r)}function $A(i,r){if(i==="input"||i==="change")return ql(r)}function WA(i,r){return i===r&&(i!==0||1/i===1/r)||i!==i&&r!==r}var Qn=typeof Object.is=="function"?Object.is:WA;function oa(i,r){if(Qn(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;var c=Object.keys(i),h=Object.keys(r);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var g=c[h];if(!d.call(r,g)||!Qn(i[g],r[g]))return!1}return!0}function zg(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Xg(i,r){var c=zg(i);i=0;for(var h;c;){if(c.nodeType===3){if(h=i+c.textContent.length,i<=r&&h>=r)return{node:c,offset:r-i};i=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=zg(c)}}function Vg(i,r){return i&&r?i===r?!0:i&&i.nodeType===3?!1:r&&r.nodeType===3?Vg(i,r.parentNode):"contains"in i?i.contains(r):i.compareDocumentPosition?!!(i.compareDocumentPosition(r)&16):!1:!1}function qg(){for(var i=window,r=$e();r instanceof i.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)i=r.contentWindow;else break;r=$e(i.document)}return r}function Dd(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r&&(r==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||r==="textarea"||i.contentEditable==="true")}function YA(i){var r=qg(),c=i.focusedElem,h=i.selectionRange;if(r!==c&&c&&c.ownerDocument&&Vg(c.ownerDocument.documentElement,c)){if(h!==null&&Dd(c)){if(r=h.start,i=h.end,i===void 0&&(i=r),"selectionStart"in c)c.selectionStart=r,c.selectionEnd=Math.min(i,c.value.length);else if(i=(r=c.ownerDocument||document)&&r.defaultView||window,i.getSelection){i=i.getSelection();var g=c.textContent.length,S=Math.min(h.start,g);h=h.end===void 0?S:Math.min(h.end,g),!i.extend&&S>h&&(g=h,h=S,S=g),g=Xg(c,S);var w=Xg(c,h);g&&w&&(i.rangeCount!==1||i.anchorNode!==g.node||i.anchorOffset!==g.offset||i.focusNode!==w.node||i.focusOffset!==w.offset)&&(r=r.createRange(),r.setStart(g.node,g.offset),i.removeAllRanges(),S>h?(i.addRange(r),i.extend(w.node,w.offset)):(r.setEnd(w.node,w.offset),i.addRange(r)))}}for(r=[],i=c;i=i.parentNode;)i.nodeType===1&&r.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<r.length;c++)i=r[c],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var jA=u&&"documentMode"in document&&11>=document.documentMode,Br=null,Od=null,ra=null,Nd=!1;function Zg(i,r,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Nd||Br==null||Br!==$e(h)||(h=Br,"selectionStart"in h&&Dd(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),ra&&oa(ra,h)||(ra=h,h=Jl(Od,"onSelect"),0<h.length&&(r=new Ed("onSelect","select",null,r,c),i.push({event:r,listeners:h}),r.target=Br)))}function Zl(i,r){var c={};return c[i.toLowerCase()]=r.toLowerCase(),c["Webkit"+i]="webkit"+r,c["Moz"+i]="moz"+r,c}var Hr={animationend:Zl("Animation","AnimationEnd"),animationiteration:Zl("Animation","AnimationIteration"),animationstart:Zl("Animation","AnimationStart"),transitionend:Zl("Transition","TransitionEnd")},Bd={},Kg={};u&&(Kg=document.createElement("div").style,"AnimationEvent"in window||(delete Hr.animationend.animation,delete Hr.animationiteration.animation,delete Hr.animationstart.animation),"TransitionEvent"in window||delete Hr.transitionend.transition);function Kl(i){if(Bd[i])return Bd[i];if(!Hr[i])return i;var r=Hr[i],c;for(c in r)if(r.hasOwnProperty(c)&&c in Kg)return Bd[i]=r[c];return i}var Qg=Kl("animationend"),Jg=Kl("animationiteration"),em=Kl("animationstart"),tm=Kl("transitionend"),nm=new Map,im="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function lo(i,r){nm.set(i,r),a(r,[i])}for(var Hd=0;Hd<im.length;Hd++){var Fd=im[Hd],zA=Fd.toLowerCase(),XA=Fd[0].toUpperCase()+Fd.slice(1);lo(zA,"on"+XA)}lo(Qg,"onAnimationEnd"),lo(Jg,"onAnimationIteration"),lo(em,"onAnimationStart"),lo("dblclick","onDoubleClick"),lo("focusin","onFocus"),lo("focusout","onBlur"),lo(tm,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),VA=new Set("cancel close invalid load scroll toggle".split(" ").concat(sa));function om(i,r,c){var h=i.type||"unknown-event";i.currentTarget=c,zT(h,r,void 0,i),i.currentTarget=null}function rm(i,r){r=(r&4)!==0;for(var c=0;c<i.length;c++){var h=i[c],g=h.event;h=h.listeners;e:{var S=void 0;if(r)for(var w=h.length-1;0<=w;w--){var b=h[w],N=b.instance,W=b.currentTarget;if(b=b.listener,N!==S&&g.isPropagationStopped())break e;om(g,b,W),S=N}else for(w=0;w<h.length;w++){if(b=h[w],N=b.instance,W=b.currentTarget,b=b.listener,N!==S&&g.isPropagationStopped())break e;om(g,b,W),S=N}}}if(Bl)throw i=pd,Bl=!1,pd=null,i}function at(i,r){var c=r[jd];c===void 0&&(c=r[jd]=new Set);var h=i+"__bubble";c.has(h)||(sm(r,i,2,!1),c.add(h))}function Ld(i,r,c){var h=0;r&&(h|=4),sm(c,i,h,r)}var Ql="_reactListening"+Math.random().toString(36).slice(2);function aa(i){if(!i[Ql]){i[Ql]=!0,o.forEach(function(c){c!=="selectionchange"&&(VA.has(c)||Ld(c,!1,i),Ld(c,!0,i))});var r=i.nodeType===9?i:i.ownerDocument;r===null||r[Ql]||(r[Ql]=!0,Ld("selectionchange",!1,r))}}function sm(i,r,c,h){switch(Mg(r)){case 1:var g=lA;break;case 4:g=cA;break;default:g=Td}c=g.bind(null,r,c,i),g=void 0,!hd||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),h?g!==void 0?i.addEventListener(r,c,{capture:!0,passive:g}):i.addEventListener(r,c,!0):g!==void 0?i.addEventListener(r,c,{passive:g}):i.addEventListener(r,c,!1)}function xd(i,r,c,h,g){var S=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var w=h.tag;if(w===3||w===4){var b=h.stateNode.containerInfo;if(b===g||b.nodeType===8&&b.parentNode===g)break;if(w===4)for(w=h.return;w!==null;){var N=w.tag;if((N===3||N===4)&&(N=w.stateNode.containerInfo,N===g||N.nodeType===8&&N.parentNode===g))return;w=w.return}for(;b!==null;){if(w=Wo(b),w===null)return;if(N=w.tag,N===5||N===6){h=S=w;continue e}b=b.parentNode}}h=h.return}dg(function(){var W=S,le=ud(c),de=[];e:{var se=nm.get(i);if(se!==void 0){var ve=Ed,Ae=i;switch(i){case"keypress":if(zl(c)===0)break e;case"keydown":case"keyup":ve=EA;break;case"focusin":Ae="focus",ve=_d;break;case"focusout":Ae="blur",ve=_d;break;case"beforeblur":case"afterblur":ve=_d;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=Dg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=fA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=_A;break;case Qg:case Jg:case em:ve=gA;break;case tm:ve=MA;break;case"scroll":ve=uA;break;case"wheel":ve=bA;break;case"copy":case"cut":case"paste":ve=yA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=Ng}var we=(r&4)!==0,Et=!we&&i==="scroll",x=we?se!==null?se+"Capture":null:se;we=[];for(var H=W,U;H!==null;){U=H;var he=U.stateNode;if(U.tag===5&&he!==null&&(U=he,x!==null&&(he=Ws(H,x),he!=null&&we.push(la(H,he,U)))),Et)break;H=H.return}0<we.length&&(se=new ve(se,Ae,null,c,le),de.push({event:se,listeners:we}))}}if((r&7)===0){e:{if(se=i==="mouseover"||i==="pointerover",ve=i==="mouseout"||i==="pointerout",se&&c!==cd&&(Ae=c.relatedTarget||c.fromElement)&&(Wo(Ae)||Ae[Ri]))break e;if((ve||se)&&(se=le.window===le?le:(se=le.ownerDocument)?se.defaultView||se.parentWindow:window,ve?(Ae=c.relatedTarget||c.toElement,ve=W,Ae=Ae?Wo(Ae):null,Ae!==null&&(Et=$o(Ae),Ae!==Et||Ae.tag!==5&&Ae.tag!==6)&&(Ae=null)):(ve=null,Ae=W),ve!==Ae)){if(we=Dg,he="onMouseLeave",x="onMouseEnter",H="mouse",(i==="pointerout"||i==="pointerover")&&(we=Ng,he="onPointerLeave",x="onPointerEnter",H="pointer"),Et=ve==null?se:xr(ve),U=Ae==null?se:xr(Ae),se=new we(he,H+"leave",ve,c,le),se.target=Et,se.relatedTarget=U,he=null,Wo(le)===W&&(we=new we(x,H+"enter",Ae,c,le),we.target=U,we.relatedTarget=Et,he=we),Et=he,ve&&Ae)t:{for(we=ve,x=Ae,H=0,U=we;U;U=Fr(U))H++;for(U=0,he=x;he;he=Fr(he))U++;for(;0<H-U;)we=Fr(we),H--;for(;0<U-H;)x=Fr(x),U--;for(;H--;){if(we===x||x!==null&&we===x.alternate)break t;we=Fr(we),x=Fr(x)}we=null}else we=null;ve!==null&&am(de,se,ve,we,!1),Ae!==null&&Et!==null&&am(de,Et,Ae,we,!0)}}e:{if(se=W?xr(W):window,ve=se.nodeName&&se.nodeName.toLowerCase(),ve==="select"||ve==="input"&&se.type==="file")var Pe=LA;else if(Ug(se))if($g)Pe=$A;else{Pe=UA;var ke=xA}else(ve=se.nodeName)&&ve.toLowerCase()==="input"&&(se.type==="checkbox"||se.type==="radio")&&(Pe=GA);if(Pe&&(Pe=Pe(i,W))){Gg(de,Pe,c,le);break e}ke&&ke(i,se,W),i==="focusout"&&(ke=se._wrapperState)&&ke.controlled&&se.type==="number"&&st(se,"number",se.value)}switch(ke=W?xr(W):window,i){case"focusin":(Ug(ke)||ke.contentEditable==="true")&&(Br=ke,Od=W,ra=null);break;case"focusout":ra=Od=Br=null;break;case"mousedown":Nd=!0;break;case"contextmenu":case"mouseup":case"dragend":Nd=!1,Zg(de,c,le);break;case"selectionchange":if(jA)break;case"keydown":case"keyup":Zg(de,c,le)}var be;if(Md)e:{switch(i){case"compositionstart":var Fe="onCompositionStart";break e;case"compositionend":Fe="onCompositionEnd";break e;case"compositionupdate":Fe="onCompositionUpdate";break e}Fe=void 0}else Nr?Lg(i,c)&&(Fe="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(Fe="onCompositionStart");Fe&&(Bg&&c.locale!=="ko"&&(Nr||Fe!=="onCompositionStart"?Fe==="onCompositionEnd"&&Nr&&(be=kg()):(ao=le,wd="value"in ao?ao.value:ao.textContent,Nr=!0)),ke=Jl(W,Fe),0<ke.length&&(Fe=new Og(Fe,i,null,c,le),de.push({event:Fe,listeners:ke}),be?Fe.data=be:(be=xg(c),be!==null&&(Fe.data=be)))),(be=OA?NA(i,c):BA(i,c))&&(W=Jl(W,"onBeforeInput"),0<W.length&&(le=new Og("onBeforeInput","beforeinput",null,c,le),de.push({event:le,listeners:W}),le.data=be))}rm(de,r)})}function la(i,r,c){return{instance:i,listener:r,currentTarget:c}}function Jl(i,r){for(var c=r+"Capture",h=[];i!==null;){var g=i,S=g.stateNode;g.tag===5&&S!==null&&(g=S,S=Ws(i,c),S!=null&&h.unshift(la(i,S,g)),S=Ws(i,r),S!=null&&h.push(la(i,S,g))),i=i.return}return h}function Fr(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function am(i,r,c,h,g){for(var S=r._reactName,w=[];c!==null&&c!==h;){var b=c,N=b.alternate,W=b.stateNode;if(N!==null&&N===h)break;b.tag===5&&W!==null&&(b=W,g?(N=Ws(c,S),N!=null&&w.unshift(la(c,N,b))):g||(N=Ws(c,S),N!=null&&w.push(la(c,N,b)))),c=c.return}w.length!==0&&i.push({event:r,listeners:w})}var qA=/\r\n?/g,ZA=/\u0000|\uFFFD/g;function lm(i){return(typeof i=="string"?i:""+i).replace(qA,`
`).replace(ZA,"")}function ec(i,r,c){if(r=lm(r),lm(i)!==r&&c)throw Error(n(425))}function tc(){}var Ud=null,Gd=null;function $d(i,r){return i==="textarea"||i==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Wd=typeof setTimeout=="function"?setTimeout:void 0,KA=typeof clearTimeout=="function"?clearTimeout:void 0,cm=typeof Promise=="function"?Promise:void 0,QA=typeof queueMicrotask=="function"?queueMicrotask:typeof cm<"u"?function(i){return cm.resolve(null).then(i).catch(JA)}:Wd;function JA(i){setTimeout(function(){throw i})}function Yd(i,r){var c=r,h=0;do{var g=c.nextSibling;if(i.removeChild(c),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(h===0){i.removeChild(g),Qs(r);return}h--}else c!=="$"&&c!=="$?"&&c!=="$!"||h++;c=g}while(c);Qs(r)}function co(i){for(;i!=null;i=i.nextSibling){var r=i.nodeType;if(r===1||r===3)break;if(r===8){if(r=i.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return i}function um(i){i=i.previousSibling;for(var r=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"){if(r===0)return i;r--}else c==="/$"&&r++}i=i.previousSibling}return null}var Lr=Math.random().toString(36).slice(2),fi="__reactFiber$"+Lr,ca="__reactProps$"+Lr,Ri="__reactContainer$"+Lr,jd="__reactEvents$"+Lr,e1="__reactListeners$"+Lr,t1="__reactHandles$"+Lr;function Wo(i){var r=i[fi];if(r)return r;for(var c=i.parentNode;c;){if(r=c[Ri]||c[fi]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(i=um(i);i!==null;){if(c=i[fi])return c;i=um(i)}return r}i=c,c=i.parentNode}return null}function ua(i){return i=i[fi]||i[Ri],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function xr(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(n(33))}function nc(i){return i[ca]||null}var zd=[],Ur=-1;function uo(i){return{current:i}}function lt(i){0>Ur||(i.current=zd[Ur],zd[Ur]=null,Ur--)}function it(i,r){Ur++,zd[Ur]=i.current,i.current=r}var fo={},Zt=uo(fo),mn=uo(!1),Yo=fo;function Gr(i,r){var c=i.type.contextTypes;if(!c)return fo;var h=i.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===r)return h.__reactInternalMemoizedMaskedChildContext;var g={},S;for(S in c)g[S]=r[S];return h&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=g),g}function yn(i){return i=i.childContextTypes,i!=null}function ic(){lt(mn),lt(Zt)}function dm(i,r,c){if(Zt.current!==fo)throw Error(n(168));it(Zt,r),it(mn,c)}function fm(i,r,c){var h=i.stateNode;if(r=r.childContextTypes,typeof h.getChildContext!="function")return c;h=h.getChildContext();for(var g in h)if(!(g in r))throw Error(n(108,me(i)||"Unknown",g));return V({},c,h)}function oc(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||fo,Yo=Zt.current,it(Zt,i),it(mn,mn.current),!0}function hm(i,r,c){var h=i.stateNode;if(!h)throw Error(n(169));c?(i=fm(i,r,Yo),h.__reactInternalMemoizedMergedChildContext=i,lt(mn),lt(Zt),it(Zt,i)):lt(mn),it(mn,c)}var Mi=null,rc=!1,Xd=!1;function pm(i){Mi===null?Mi=[i]:Mi.push(i)}function n1(i){rc=!0,pm(i)}function ho(){if(!Xd&&Mi!==null){Xd=!0;var i=0,r=Ke;try{var c=Mi;for(Ke=1;i<c.length;i++){var h=c[i];do h=h(!0);while(h!==null)}Mi=null,rc=!1}catch(g){throw Mi!==null&&(Mi=Mi.slice(i+1)),mg(gd,ho),g}finally{Ke=r,Xd=!1}}return null}var $r=[],Wr=0,sc=null,ac=0,Bn=[],Hn=0,jo=null,ki=1,bi="";function zo(i,r){$r[Wr++]=ac,$r[Wr++]=sc,sc=i,ac=r}function gm(i,r,c){Bn[Hn++]=ki,Bn[Hn++]=bi,Bn[Hn++]=jo,jo=i;var h=ki;i=bi;var g=32-Kn(h)-1;h&=~(1<<g),c+=1;var S=32-Kn(r)+g;if(30<S){var w=g-g%5;S=(h&(1<<w)-1).toString(32),h>>=w,g-=w,ki=1<<32-Kn(r)+g|c<<g|h,bi=S+i}else ki=1<<S|c<<g|h,bi=i}function Vd(i){i.return!==null&&(zo(i,1),gm(i,1,0))}function qd(i){for(;i===sc;)sc=$r[--Wr],$r[Wr]=null,ac=$r[--Wr],$r[Wr]=null;for(;i===jo;)jo=Bn[--Hn],Bn[Hn]=null,bi=Bn[--Hn],Bn[Hn]=null,ki=Bn[--Hn],Bn[Hn]=null}var _n=null,Rn=null,pt=!1,Jn=null;function mm(i,r){var c=Un(5,null,null,0);c.elementType="DELETED",c.stateNode=r,c.return=i,r=i.deletions,r===null?(i.deletions=[c],i.flags|=16):r.push(c)}function ym(i,r){switch(i.tag){case 5:var c=i.type;return r=r.nodeType!==1||c.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(i.stateNode=r,_n=i,Rn=co(r.firstChild),!0):!1;case 6:return r=i.pendingProps===""||r.nodeType!==3?null:r,r!==null?(i.stateNode=r,_n=i,Rn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(c=jo!==null?{id:ki,overflow:bi}:null,i.memoizedState={dehydrated:r,treeContext:c,retryLane:1073741824},c=Un(18,null,null,0),c.stateNode=r,c.return=i,i.child=c,_n=i,Rn=null,!0):!1;default:return!1}}function Zd(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Kd(i){if(pt){var r=Rn;if(r){var c=r;if(!ym(i,r)){if(Zd(i))throw Error(n(418));r=co(c.nextSibling);var h=_n;r&&ym(i,r)?mm(h,c):(i.flags=i.flags&-4097|2,pt=!1,_n=i)}}else{if(Zd(i))throw Error(n(418));i.flags=i.flags&-4097|2,pt=!1,_n=i}}}function vm(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;_n=i}function lc(i){if(i!==_n)return!1;if(!pt)return vm(i),pt=!0,!1;var r;if((r=i.tag!==3)&&!(r=i.tag!==5)&&(r=i.type,r=r!=="head"&&r!=="body"&&!$d(i.type,i.memoizedProps)),r&&(r=Rn)){if(Zd(i))throw Sm(),Error(n(418));for(;r;)mm(i,r),r=co(r.nextSibling)}if(vm(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));e:{for(i=i.nextSibling,r=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"){if(r===0){Rn=co(i.nextSibling);break e}r--}else c!=="$"&&c!=="$!"&&c!=="$?"||r++}i=i.nextSibling}Rn=null}}else Rn=_n?co(i.stateNode.nextSibling):null;return!0}function Sm(){for(var i=Rn;i;)i=co(i.nextSibling)}function Yr(){Rn=_n=null,pt=!1}function Qd(i){Jn===null?Jn=[i]:Jn.push(i)}var i1=M.ReactCurrentBatchConfig;function da(i,r,c){if(i=c.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(n(309));var h=c.stateNode}if(!h)throw Error(n(147,i));var g=h,S=""+i;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===S?r.ref:(r=function(w){var b=g.refs;w===null?delete b[S]:b[S]=w},r._stringRef=S,r)}if(typeof i!="string")throw Error(n(284));if(!c._owner)throw Error(n(290,i))}return i}function cc(i,r){throw i=Object.prototype.toString.call(r),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i))}function Im(i){var r=i._init;return r(i._payload)}function Tm(i){function r(x,H){if(i){var U=x.deletions;U===null?(x.deletions=[H],x.flags|=16):U.push(H)}}function c(x,H){if(!i)return null;for(;H!==null;)r(x,H),H=H.sibling;return null}function h(x,H){for(x=new Map;H!==null;)H.key!==null?x.set(H.key,H):x.set(H.index,H),H=H.sibling;return x}function g(x,H){return x=To(x,H),x.index=0,x.sibling=null,x}function S(x,H,U){return x.index=U,i?(U=x.alternate,U!==null?(U=U.index,U<H?(x.flags|=2,H):U):(x.flags|=2,H)):(x.flags|=1048576,H)}function w(x){return i&&x.alternate===null&&(x.flags|=2),x}function b(x,H,U,he){return H===null||H.tag!==6?(H=Yf(U,x.mode,he),H.return=x,H):(H=g(H,U),H.return=x,H)}function N(x,H,U,he){var Pe=U.type;return Pe===k?le(x,H,U.props.children,he,U.key):H!==null&&(H.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===ue&&Im(Pe)===H.type)?(he=g(H,U.props),he.ref=da(x,H,U),he.return=x,he):(he=Oc(U.type,U.key,U.props,null,x.mode,he),he.ref=da(x,H,U),he.return=x,he)}function W(x,H,U,he){return H===null||H.tag!==4||H.stateNode.containerInfo!==U.containerInfo||H.stateNode.implementation!==U.implementation?(H=jf(U,x.mode,he),H.return=x,H):(H=g(H,U.children||[]),H.return=x,H)}function le(x,H,U,he,Pe){return H===null||H.tag!==7?(H=er(U,x.mode,he,Pe),H.return=x,H):(H=g(H,U),H.return=x,H)}function de(x,H,U){if(typeof H=="string"&&H!==""||typeof H=="number")return H=Yf(""+H,x.mode,U),H.return=x,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case E:return U=Oc(H.type,H.key,H.props,null,x.mode,U),U.ref=da(x,null,H),U.return=x,U;case P:return H=jf(H,x.mode,U),H.return=x,H;case ue:var he=H._init;return de(x,he(H._payload),U)}if(qt(H)||J(H))return H=er(H,x.mode,U,null),H.return=x,H;cc(x,H)}return null}function se(x,H,U,he){var Pe=H!==null?H.key:null;if(typeof U=="string"&&U!==""||typeof U=="number")return Pe!==null?null:b(x,H,""+U,he);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case E:return U.key===Pe?N(x,H,U,he):null;case P:return U.key===Pe?W(x,H,U,he):null;case ue:return Pe=U._init,se(x,H,Pe(U._payload),he)}if(qt(U)||J(U))return Pe!==null?null:le(x,H,U,he,null);cc(x,U)}return null}function ve(x,H,U,he,Pe){if(typeof he=="string"&&he!==""||typeof he=="number")return x=x.get(U)||null,b(H,x,""+he,Pe);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case E:return x=x.get(he.key===null?U:he.key)||null,N(H,x,he,Pe);case P:return x=x.get(he.key===null?U:he.key)||null,W(H,x,he,Pe);case ue:var ke=he._init;return ve(x,H,U,ke(he._payload),Pe)}if(qt(he)||J(he))return x=x.get(U)||null,le(H,x,he,Pe,null);cc(H,he)}return null}function Ae(x,H,U,he){for(var Pe=null,ke=null,be=H,Fe=H=0,Lt=null;be!==null&&Fe<U.length;Fe++){be.index>Fe?(Lt=be,be=null):Lt=be.sibling;var Xe=se(x,be,U[Fe],he);if(Xe===null){be===null&&(be=Lt);break}i&&be&&Xe.alternate===null&&r(x,be),H=S(Xe,H,Fe),ke===null?Pe=Xe:ke.sibling=Xe,ke=Xe,be=Lt}if(Fe===U.length)return c(x,be),pt&&zo(x,Fe),Pe;if(be===null){for(;Fe<U.length;Fe++)be=de(x,U[Fe],he),be!==null&&(H=S(be,H,Fe),ke===null?Pe=be:ke.sibling=be,ke=be);return pt&&zo(x,Fe),Pe}for(be=h(x,be);Fe<U.length;Fe++)Lt=ve(be,x,Fe,U[Fe],he),Lt!==null&&(i&&Lt.alternate!==null&&be.delete(Lt.key===null?Fe:Lt.key),H=S(Lt,H,Fe),ke===null?Pe=Lt:ke.sibling=Lt,ke=Lt);return i&&be.forEach(function(Ao){return r(x,Ao)}),pt&&zo(x,Fe),Pe}function we(x,H,U,he){var Pe=J(U);if(typeof Pe!="function")throw Error(n(150));if(U=Pe.call(U),U==null)throw Error(n(151));for(var ke=Pe=null,be=H,Fe=H=0,Lt=null,Xe=U.next();be!==null&&!Xe.done;Fe++,Xe=U.next()){be.index>Fe?(Lt=be,be=null):Lt=be.sibling;var Ao=se(x,be,Xe.value,he);if(Ao===null){be===null&&(be=Lt);break}i&&be&&Ao.alternate===null&&r(x,be),H=S(Ao,H,Fe),ke===null?Pe=Ao:ke.sibling=Ao,ke=Ao,be=Lt}if(Xe.done)return c(x,be),pt&&zo(x,Fe),Pe;if(be===null){for(;!Xe.done;Fe++,Xe=U.next())Xe=de(x,Xe.value,he),Xe!==null&&(H=S(Xe,H,Fe),ke===null?Pe=Xe:ke.sibling=Xe,ke=Xe);return pt&&zo(x,Fe),Pe}for(be=h(x,be);!Xe.done;Fe++,Xe=U.next())Xe=ve(be,x,Fe,Xe.value,he),Xe!==null&&(i&&Xe.alternate!==null&&be.delete(Xe.key===null?Fe:Xe.key),H=S(Xe,H,Fe),ke===null?Pe=Xe:ke.sibling=Xe,ke=Xe);return i&&be.forEach(function(H1){return r(x,H1)}),pt&&zo(x,Fe),Pe}function Et(x,H,U,he){if(typeof U=="object"&&U!==null&&U.type===k&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case E:e:{for(var Pe=U.key,ke=H;ke!==null;){if(ke.key===Pe){if(Pe=U.type,Pe===k){if(ke.tag===7){c(x,ke.sibling),H=g(ke,U.props.children),H.return=x,x=H;break e}}else if(ke.elementType===Pe||typeof Pe=="object"&&Pe!==null&&Pe.$$typeof===ue&&Im(Pe)===ke.type){c(x,ke.sibling),H=g(ke,U.props),H.ref=da(x,ke,U),H.return=x,x=H;break e}c(x,ke);break}else r(x,ke);ke=ke.sibling}U.type===k?(H=er(U.props.children,x.mode,he,U.key),H.return=x,x=H):(he=Oc(U.type,U.key,U.props,null,x.mode,he),he.ref=da(x,H,U),he.return=x,x=he)}return w(x);case P:e:{for(ke=U.key;H!==null;){if(H.key===ke)if(H.tag===4&&H.stateNode.containerInfo===U.containerInfo&&H.stateNode.implementation===U.implementation){c(x,H.sibling),H=g(H,U.children||[]),H.return=x,x=H;break e}else{c(x,H);break}else r(x,H);H=H.sibling}H=jf(U,x.mode,he),H.return=x,x=H}return w(x);case ue:return ke=U._init,Et(x,H,ke(U._payload),he)}if(qt(U))return Ae(x,H,U,he);if(J(U))return we(x,H,U,he);cc(x,U)}return typeof U=="string"&&U!==""||typeof U=="number"?(U=""+U,H!==null&&H.tag===6?(c(x,H.sibling),H=g(H,U),H.return=x,x=H):(c(x,H),H=Yf(U,x.mode,he),H.return=x,x=H),w(x)):c(x,H)}return Et}var jr=Tm(!0),Am=Tm(!1),uc=uo(null),dc=null,zr=null,Jd=null;function ef(){Jd=zr=dc=null}function tf(i){var r=uc.current;lt(uc),i._currentValue=r}function nf(i,r,c){for(;i!==null;){var h=i.alternate;if((i.childLanes&r)!==r?(i.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),i===c)break;i=i.return}}function Xr(i,r){dc=i,Jd=zr=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&r)!==0&&(vn=!0),i.firstContext=null)}function Fn(i){var r=i._currentValue;if(Jd!==i)if(i={context:i,memoizedValue:r,next:null},zr===null){if(dc===null)throw Error(n(308));zr=i,dc.dependencies={lanes:0,firstContext:i}}else zr=zr.next=i;return r}var Xo=null;function of(i){Xo===null?Xo=[i]:Xo.push(i)}function wm(i,r,c,h){var g=r.interleaved;return g===null?(c.next=c,of(r)):(c.next=g.next,g.next=c),r.interleaved=c,Di(i,h)}function Di(i,r){i.lanes|=r;var c=i.alternate;for(c!==null&&(c.lanes|=r),c=i,i=i.return;i!==null;)i.childLanes|=r,c=i.alternate,c!==null&&(c.childLanes|=r),c=i,i=i.return;return c.tag===3?c.stateNode:null}var po=!1;function rf(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Em(i,r){i=i.updateQueue,r.updateQueue===i&&(r.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Oi(i,r){return{eventTime:i,lane:r,tag:0,payload:null,callback:null,next:null}}function go(i,r,c){var h=i.updateQueue;if(h===null)return null;if(h=h.shared,(ze&2)!==0){var g=h.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),h.pending=r,Di(i,c)}return g=h.interleaved,g===null?(r.next=r,of(h)):(r.next=g.next,g.next=r),h.interleaved=r,Di(i,c)}function fc(i,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194240)!==0)){var h=r.lanes;h&=i.pendingLanes,c|=h,r.lanes=c,vd(i,c)}}function Cm(i,r){var c=i.updateQueue,h=i.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var g=null,S=null;if(c=c.firstBaseUpdate,c!==null){do{var w={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};S===null?g=S=w:S=S.next=w,c=c.next}while(c!==null);S===null?g=S=r:S=S.next=r}else g=S=r;c={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:S,shared:h.shared,effects:h.effects},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=r:i.next=r,c.lastBaseUpdate=r}function hc(i,r,c,h){var g=i.updateQueue;po=!1;var S=g.firstBaseUpdate,w=g.lastBaseUpdate,b=g.shared.pending;if(b!==null){g.shared.pending=null;var N=b,W=N.next;N.next=null,w===null?S=W:w.next=W,w=N;var le=i.alternate;le!==null&&(le=le.updateQueue,b=le.lastBaseUpdate,b!==w&&(b===null?le.firstBaseUpdate=W:b.next=W,le.lastBaseUpdate=N))}if(S!==null){var de=g.baseState;w=0,le=W=N=null,b=S;do{var se=b.lane,ve=b.eventTime;if((h&se)===se){le!==null&&(le=le.next={eventTime:ve,lane:0,tag:b.tag,payload:b.payload,callback:b.callback,next:null});e:{var Ae=i,we=b;switch(se=r,ve=c,we.tag){case 1:if(Ae=we.payload,typeof Ae=="function"){de=Ae.call(ve,de,se);break e}de=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=we.payload,se=typeof Ae=="function"?Ae.call(ve,de,se):Ae,se==null)break e;de=V({},de,se);break e;case 2:po=!0}}b.callback!==null&&b.lane!==0&&(i.flags|=64,se=g.effects,se===null?g.effects=[b]:se.push(b))}else ve={eventTime:ve,lane:se,tag:b.tag,payload:b.payload,callback:b.callback,next:null},le===null?(W=le=ve,N=de):le=le.next=ve,w|=se;if(b=b.next,b===null){if(b=g.shared.pending,b===null)break;se=b,b=se.next,se.next=null,g.lastBaseUpdate=se,g.shared.pending=null}}while(!0);if(le===null&&(N=de),g.baseState=N,g.firstBaseUpdate=W,g.lastBaseUpdate=le,r=g.shared.interleaved,r!==null){g=r;do w|=g.lane,g=g.next;while(g!==r)}else S===null&&(g.shared.lanes=0);Zo|=w,i.lanes=w,i.memoizedState=de}}function Pm(i,r,c){if(i=r.effects,r.effects=null,i!==null)for(r=0;r<i.length;r++){var h=i[r],g=h.callback;if(g!==null){if(h.callback=null,h=c,typeof g!="function")throw Error(n(191,g));g.call(h)}}}var fa={},hi=uo(fa),ha=uo(fa),pa=uo(fa);function Vo(i){if(i===fa)throw Error(n(174));return i}function sf(i,r){switch(it(pa,r),it(ha,i),it(hi,fa),i=r.nodeType,i){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:sd(null,"");break;default:i=i===8?r.parentNode:r,r=i.namespaceURI||null,i=i.tagName,r=sd(r,i)}lt(hi),it(hi,r)}function Vr(){lt(hi),lt(ha),lt(pa)}function _m(i){Vo(pa.current);var r=Vo(hi.current),c=sd(r,i.type);r!==c&&(it(ha,i),it(hi,c))}function af(i){ha.current===i&&(lt(hi),lt(ha))}var mt=uo(0);function pc(i){for(var r=i;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var lf=[];function cf(){for(var i=0;i<lf.length;i++)lf[i]._workInProgressVersionPrimary=null;lf.length=0}var gc=M.ReactCurrentDispatcher,uf=M.ReactCurrentBatchConfig,qo=0,yt=null,Dt=null,Ht=null,mc=!1,ga=!1,ma=0,o1=0;function Kt(){throw Error(n(321))}function df(i,r){if(r===null)return!1;for(var c=0;c<r.length&&c<i.length;c++)if(!Qn(i[c],r[c]))return!1;return!0}function ff(i,r,c,h,g,S){if(qo=S,yt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,gc.current=i===null||i.memoizedState===null?l1:c1,i=c(h,g),ga){S=0;do{if(ga=!1,ma=0,25<=S)throw Error(n(301));S+=1,Ht=Dt=null,r.updateQueue=null,gc.current=u1,i=c(h,g)}while(ga)}if(gc.current=Sc,r=Dt!==null&&Dt.next!==null,qo=0,Ht=Dt=yt=null,mc=!1,r)throw Error(n(300));return i}function hf(){var i=ma!==0;return ma=0,i}function pi(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ht===null?yt.memoizedState=Ht=i:Ht=Ht.next=i,Ht}function Ln(){if(Dt===null){var i=yt.alternate;i=i!==null?i.memoizedState:null}else i=Dt.next;var r=Ht===null?yt.memoizedState:Ht.next;if(r!==null)Ht=r,Dt=i;else{if(i===null)throw Error(n(310));Dt=i,i={memoizedState:Dt.memoizedState,baseState:Dt.baseState,baseQueue:Dt.baseQueue,queue:Dt.queue,next:null},Ht===null?yt.memoizedState=Ht=i:Ht=Ht.next=i}return Ht}function ya(i,r){return typeof r=="function"?r(i):r}function pf(i){var r=Ln(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=i;var h=Dt,g=h.baseQueue,S=c.pending;if(S!==null){if(g!==null){var w=g.next;g.next=S.next,S.next=w}h.baseQueue=g=S,c.pending=null}if(g!==null){S=g.next,h=h.baseState;var b=w=null,N=null,W=S;do{var le=W.lane;if((qo&le)===le)N!==null&&(N=N.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),h=W.hasEagerState?W.eagerState:i(h,W.action);else{var de={lane:le,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};N===null?(b=N=de,w=h):N=N.next=de,yt.lanes|=le,Zo|=le}W=W.next}while(W!==null&&W!==S);N===null?w=h:N.next=b,Qn(h,r.memoizedState)||(vn=!0),r.memoizedState=h,r.baseState=w,r.baseQueue=N,c.lastRenderedState=h}if(i=c.interleaved,i!==null){g=i;do S=g.lane,yt.lanes|=S,Zo|=S,g=g.next;while(g!==i)}else g===null&&(c.lanes=0);return[r.memoizedState,c.dispatch]}function gf(i){var r=Ln(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=i;var h=c.dispatch,g=c.pending,S=r.memoizedState;if(g!==null){c.pending=null;var w=g=g.next;do S=i(S,w.action),w=w.next;while(w!==g);Qn(S,r.memoizedState)||(vn=!0),r.memoizedState=S,r.baseQueue===null&&(r.baseState=S),c.lastRenderedState=S}return[S,h]}function Rm(){}function Mm(i,r){var c=yt,h=Ln(),g=r(),S=!Qn(h.memoizedState,g);if(S&&(h.memoizedState=g,vn=!0),h=h.queue,mf(Dm.bind(null,c,h,i),[i]),h.getSnapshot!==r||S||Ht!==null&&Ht.memoizedState.tag&1){if(c.flags|=2048,va(9,bm.bind(null,c,h,g,r),void 0,null),Ft===null)throw Error(n(349));(qo&30)!==0||km(c,r,g)}return g}function km(i,r,c){i.flags|=16384,i={getSnapshot:r,value:c},r=yt.updateQueue,r===null?(r={lastEffect:null,stores:null},yt.updateQueue=r,r.stores=[i]):(c=r.stores,c===null?r.stores=[i]:c.push(i))}function bm(i,r,c,h){r.value=c,r.getSnapshot=h,Om(r)&&Nm(i)}function Dm(i,r,c){return c(function(){Om(r)&&Nm(i)})}function Om(i){var r=i.getSnapshot;i=i.value;try{var c=r();return!Qn(i,c)}catch{return!0}}function Nm(i){var r=Di(i,1);r!==null&&ii(r,i,1,-1)}function Bm(i){var r=pi();return typeof i=="function"&&(i=i()),r.memoizedState=r.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ya,lastRenderedState:i},r.queue=i,i=i.dispatch=a1.bind(null,yt,i),[r.memoizedState,i]}function va(i,r,c,h){return i={tag:i,create:r,destroy:c,deps:h,next:null},r=yt.updateQueue,r===null?(r={lastEffect:null,stores:null},yt.updateQueue=r,r.lastEffect=i.next=i):(c=r.lastEffect,c===null?r.lastEffect=i.next=i:(h=c.next,c.next=i,i.next=h,r.lastEffect=i)),i}function Hm(){return Ln().memoizedState}function yc(i,r,c,h){var g=pi();yt.flags|=i,g.memoizedState=va(1|r,c,void 0,h===void 0?null:h)}function vc(i,r,c,h){var g=Ln();h=h===void 0?null:h;var S=void 0;if(Dt!==null){var w=Dt.memoizedState;if(S=w.destroy,h!==null&&df(h,w.deps)){g.memoizedState=va(r,c,S,h);return}}yt.flags|=i,g.memoizedState=va(1|r,c,S,h)}function Fm(i,r){return yc(8390656,8,i,r)}function mf(i,r){return vc(2048,8,i,r)}function Lm(i,r){return vc(4,2,i,r)}function xm(i,r){return vc(4,4,i,r)}function Um(i,r){if(typeof r=="function")return i=i(),r(i),function(){r(null)};if(r!=null)return i=i(),r.current=i,function(){r.current=null}}function Gm(i,r,c){return c=c!=null?c.concat([i]):null,vc(4,4,Um.bind(null,r,i),c)}function yf(){}function $m(i,r){var c=Ln();r=r===void 0?null:r;var h=c.memoizedState;return h!==null&&r!==null&&df(r,h[1])?h[0]:(c.memoizedState=[i,r],i)}function Wm(i,r){var c=Ln();r=r===void 0?null:r;var h=c.memoizedState;return h!==null&&r!==null&&df(r,h[1])?h[0]:(i=i(),c.memoizedState=[i,r],i)}function Ym(i,r,c){return(qo&21)===0?(i.baseState&&(i.baseState=!1,vn=!0),i.memoizedState=c):(Qn(c,r)||(c=Ig(),yt.lanes|=c,Zo|=c,i.baseState=!0),r)}function r1(i,r){var c=Ke;Ke=c!==0&&4>c?c:4,i(!0);var h=uf.transition;uf.transition={};try{i(!1),r()}finally{Ke=c,uf.transition=h}}function jm(){return Ln().memoizedState}function s1(i,r,c){var h=So(i);if(c={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null},zm(i))Xm(r,c);else if(c=wm(i,r,c,h),c!==null){var g=ln();ii(c,i,h,g),Vm(c,r,h)}}function a1(i,r,c){var h=So(i),g={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null};if(zm(i))Xm(r,g);else{var S=i.alternate;if(i.lanes===0&&(S===null||S.lanes===0)&&(S=r.lastRenderedReducer,S!==null))try{var w=r.lastRenderedState,b=S(w,c);if(g.hasEagerState=!0,g.eagerState=b,Qn(b,w)){var N=r.interleaved;N===null?(g.next=g,of(r)):(g.next=N.next,N.next=g),r.interleaved=g;return}}catch{}finally{}c=wm(i,r,g,h),c!==null&&(g=ln(),ii(c,i,h,g),Vm(c,r,h))}}function zm(i){var r=i.alternate;return i===yt||r!==null&&r===yt}function Xm(i,r){ga=mc=!0;var c=i.pending;c===null?r.next=r:(r.next=c.next,c.next=r),i.pending=r}function Vm(i,r,c){if((c&4194240)!==0){var h=r.lanes;h&=i.pendingLanes,c|=h,r.lanes=c,vd(i,c)}}var Sc={readContext:Fn,useCallback:Kt,useContext:Kt,useEffect:Kt,useImperativeHandle:Kt,useInsertionEffect:Kt,useLayoutEffect:Kt,useMemo:Kt,useReducer:Kt,useRef:Kt,useState:Kt,useDebugValue:Kt,useDeferredValue:Kt,useTransition:Kt,useMutableSource:Kt,useSyncExternalStore:Kt,useId:Kt,unstable_isNewReconciler:!1},l1={readContext:Fn,useCallback:function(i,r){return pi().memoizedState=[i,r===void 0?null:r],i},useContext:Fn,useEffect:Fm,useImperativeHandle:function(i,r,c){return c=c!=null?c.concat([i]):null,yc(4194308,4,Um.bind(null,r,i),c)},useLayoutEffect:function(i,r){return yc(4194308,4,i,r)},useInsertionEffect:function(i,r){return yc(4,2,i,r)},useMemo:function(i,r){var c=pi();return r=r===void 0?null:r,i=i(),c.memoizedState=[i,r],i},useReducer:function(i,r,c){var h=pi();return r=c!==void 0?c(r):r,h.memoizedState=h.baseState=r,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:r},h.queue=i,i=i.dispatch=s1.bind(null,yt,i),[h.memoizedState,i]},useRef:function(i){var r=pi();return i={current:i},r.memoizedState=i},useState:Bm,useDebugValue:yf,useDeferredValue:function(i){return pi().memoizedState=i},useTransition:function(){var i=Bm(!1),r=i[0];return i=r1.bind(null,i[1]),pi().memoizedState=i,[r,i]},useMutableSource:function(){},useSyncExternalStore:function(i,r,c){var h=yt,g=pi();if(pt){if(c===void 0)throw Error(n(407));c=c()}else{if(c=r(),Ft===null)throw Error(n(349));(qo&30)!==0||km(h,r,c)}g.memoizedState=c;var S={value:c,getSnapshot:r};return g.queue=S,Fm(Dm.bind(null,h,S,i),[i]),h.flags|=2048,va(9,bm.bind(null,h,S,c,r),void 0,null),c},useId:function(){var i=pi(),r=Ft.identifierPrefix;if(pt){var c=bi,h=ki;c=(h&~(1<<32-Kn(h)-1)).toString(32)+c,r=":"+r+"R"+c,c=ma++,0<c&&(r+="H"+c.toString(32)),r+=":"}else c=o1++,r=":"+r+"r"+c.toString(32)+":";return i.memoizedState=r},unstable_isNewReconciler:!1},c1={readContext:Fn,useCallback:$m,useContext:Fn,useEffect:mf,useImperativeHandle:Gm,useInsertionEffect:Lm,useLayoutEffect:xm,useMemo:Wm,useReducer:pf,useRef:Hm,useState:function(){return pf(ya)},useDebugValue:yf,useDeferredValue:function(i){var r=Ln();return Ym(r,Dt.memoizedState,i)},useTransition:function(){var i=pf(ya)[0],r=Ln().memoizedState;return[i,r]},useMutableSource:Rm,useSyncExternalStore:Mm,useId:jm,unstable_isNewReconciler:!1},u1={readContext:Fn,useCallback:$m,useContext:Fn,useEffect:mf,useImperativeHandle:Gm,useInsertionEffect:Lm,useLayoutEffect:xm,useMemo:Wm,useReducer:gf,useRef:Hm,useState:function(){return gf(ya)},useDebugValue:yf,useDeferredValue:function(i){var r=Ln();return Dt===null?r.memoizedState=i:Ym(r,Dt.memoizedState,i)},useTransition:function(){var i=gf(ya)[0],r=Ln().memoizedState;return[i,r]},useMutableSource:Rm,useSyncExternalStore:Mm,useId:jm,unstable_isNewReconciler:!1};function ei(i,r){if(i&&i.defaultProps){r=V({},r),i=i.defaultProps;for(var c in i)r[c]===void 0&&(r[c]=i[c]);return r}return r}function vf(i,r,c,h){r=i.memoizedState,c=c(h,r),c=c==null?r:V({},r,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var Ic={isMounted:function(i){return(i=i._reactInternals)?$o(i)===i:!1},enqueueSetState:function(i,r,c){i=i._reactInternals;var h=ln(),g=So(i),S=Oi(h,g);S.payload=r,c!=null&&(S.callback=c),r=go(i,S,g),r!==null&&(ii(r,i,g,h),fc(r,i,g))},enqueueReplaceState:function(i,r,c){i=i._reactInternals;var h=ln(),g=So(i),S=Oi(h,g);S.tag=1,S.payload=r,c!=null&&(S.callback=c),r=go(i,S,g),r!==null&&(ii(r,i,g,h),fc(r,i,g))},enqueueForceUpdate:function(i,r){i=i._reactInternals;var c=ln(),h=So(i),g=Oi(c,h);g.tag=2,r!=null&&(g.callback=r),r=go(i,g,h),r!==null&&(ii(r,i,h,c),fc(r,i,h))}};function qm(i,r,c,h,g,S,w){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(h,S,w):r.prototype&&r.prototype.isPureReactComponent?!oa(c,h)||!oa(g,S):!0}function Zm(i,r,c){var h=!1,g=fo,S=r.contextType;return typeof S=="object"&&S!==null?S=Fn(S):(g=yn(r)?Yo:Zt.current,h=r.contextTypes,S=(h=h!=null)?Gr(i,g):fo),r=new r(c,S),i.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Ic,i.stateNode=r,r._reactInternals=i,h&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=g,i.__reactInternalMemoizedMaskedChildContext=S),r}function Km(i,r,c,h){i=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,h),r.state!==i&&Ic.enqueueReplaceState(r,r.state,null)}function Sf(i,r,c,h){var g=i.stateNode;g.props=c,g.state=i.memoizedState,g.refs={},rf(i);var S=r.contextType;typeof S=="object"&&S!==null?g.context=Fn(S):(S=yn(r)?Yo:Zt.current,g.context=Gr(i,S)),g.state=i.memoizedState,S=r.getDerivedStateFromProps,typeof S=="function"&&(vf(i,r,S,c),g.state=i.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(r=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),r!==g.state&&Ic.enqueueReplaceState(g,g.state,null),hc(i,c,g,h),g.state=i.memoizedState),typeof g.componentDidMount=="function"&&(i.flags|=4194308)}function qr(i,r){try{var c="",h=r;do c+=re(h),h=h.return;while(h);var g=c}catch(S){g=`
Error generating stack: `+S.message+`
`+S.stack}return{value:i,source:r,stack:g,digest:null}}function If(i,r,c){return{value:i,source:null,stack:c??null,digest:r??null}}function Tf(i,r){try{console.error(r.value)}catch(c){setTimeout(function(){throw c})}}var d1=typeof WeakMap=="function"?WeakMap:Map;function Qm(i,r,c){c=Oi(-1,c),c.tag=3,c.payload={element:null};var h=r.value;return c.callback=function(){_c||(_c=!0,Hf=h),Tf(i,r)},c}function Jm(i,r,c){c=Oi(-1,c),c.tag=3;var h=i.type.getDerivedStateFromError;if(typeof h=="function"){var g=r.value;c.payload=function(){return h(g)},c.callback=function(){Tf(i,r)}}var S=i.stateNode;return S!==null&&typeof S.componentDidCatch=="function"&&(c.callback=function(){Tf(i,r),typeof h!="function"&&(yo===null?yo=new Set([this]):yo.add(this));var w=r.stack;this.componentDidCatch(r.value,{componentStack:w!==null?w:""})}),c}function e0(i,r,c){var h=i.pingCache;if(h===null){h=i.pingCache=new d1;var g=new Set;h.set(r,g)}else g=h.get(r),g===void 0&&(g=new Set,h.set(r,g));g.has(c)||(g.add(c),i=C1.bind(null,i,r,c),r.then(i,i))}function t0(i){do{var r;if((r=i.tag===13)&&(r=i.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return i;i=i.return}while(i!==null);return null}function n0(i,r,c,h,g){return(i.mode&1)===0?(i===r?i.flags|=65536:(i.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(r=Oi(-1,1),r.tag=2,go(c,r,1))),c.lanes|=1),i):(i.flags|=65536,i.lanes=g,i)}var f1=M.ReactCurrentOwner,vn=!1;function an(i,r,c,h){r.child=i===null?Am(r,null,c,h):jr(r,i.child,c,h)}function i0(i,r,c,h,g){c=c.render;var S=r.ref;return Xr(r,g),h=ff(i,r,c,h,S,g),c=hf(),i!==null&&!vn?(r.updateQueue=i.updateQueue,r.flags&=-2053,i.lanes&=~g,Ni(i,r,g)):(pt&&c&&Vd(r),r.flags|=1,an(i,r,h,g),r.child)}function o0(i,r,c,h,g){if(i===null){var S=c.type;return typeof S=="function"&&!Wf(S)&&S.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(r.tag=15,r.type=S,r0(i,r,S,h,g)):(i=Oc(c.type,null,h,r,r.mode,g),i.ref=r.ref,i.return=r,r.child=i)}if(S=i.child,(i.lanes&g)===0){var w=S.memoizedProps;if(c=c.compare,c=c!==null?c:oa,c(w,h)&&i.ref===r.ref)return Ni(i,r,g)}return r.flags|=1,i=To(S,h),i.ref=r.ref,i.return=r,r.child=i}function r0(i,r,c,h,g){if(i!==null){var S=i.memoizedProps;if(oa(S,h)&&i.ref===r.ref)if(vn=!1,r.pendingProps=h=S,(i.lanes&g)!==0)(i.flags&131072)!==0&&(vn=!0);else return r.lanes=i.lanes,Ni(i,r,g)}return Af(i,r,c,h,g)}function s0(i,r,c){var h=r.pendingProps,g=h.children,S=i!==null?i.memoizedState:null;if(h.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},it(Kr,Mn),Mn|=c;else{if((c&1073741824)===0)return i=S!==null?S.baseLanes|c:c,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:i,cachePool:null,transitions:null},r.updateQueue=null,it(Kr,Mn),Mn|=i,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=S!==null?S.baseLanes:c,it(Kr,Mn),Mn|=h}else S!==null?(h=S.baseLanes|c,r.memoizedState=null):h=c,it(Kr,Mn),Mn|=h;return an(i,r,g,c),r.child}function a0(i,r){var c=r.ref;(i===null&&c!==null||i!==null&&i.ref!==c)&&(r.flags|=512,r.flags|=2097152)}function Af(i,r,c,h,g){var S=yn(c)?Yo:Zt.current;return S=Gr(r,S),Xr(r,g),c=ff(i,r,c,h,S,g),h=hf(),i!==null&&!vn?(r.updateQueue=i.updateQueue,r.flags&=-2053,i.lanes&=~g,Ni(i,r,g)):(pt&&h&&Vd(r),r.flags|=1,an(i,r,c,g),r.child)}function l0(i,r,c,h,g){if(yn(c)){var S=!0;oc(r)}else S=!1;if(Xr(r,g),r.stateNode===null)Ac(i,r),Zm(r,c,h),Sf(r,c,h,g),h=!0;else if(i===null){var w=r.stateNode,b=r.memoizedProps;w.props=b;var N=w.context,W=c.contextType;typeof W=="object"&&W!==null?W=Fn(W):(W=yn(c)?Yo:Zt.current,W=Gr(r,W));var le=c.getDerivedStateFromProps,de=typeof le=="function"||typeof w.getSnapshotBeforeUpdate=="function";de||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(b!==h||N!==W)&&Km(r,w,h,W),po=!1;var se=r.memoizedState;w.state=se,hc(r,h,w,g),N=r.memoizedState,b!==h||se!==N||mn.current||po?(typeof le=="function"&&(vf(r,c,le,h),N=r.memoizedState),(b=po||qm(r,c,b,h,se,N,W))?(de||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(r.flags|=4194308)):(typeof w.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=N),w.props=h,w.state=N,w.context=W,h=b):(typeof w.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{w=r.stateNode,Em(i,r),b=r.memoizedProps,W=r.type===r.elementType?b:ei(r.type,b),w.props=W,de=r.pendingProps,se=w.context,N=c.contextType,typeof N=="object"&&N!==null?N=Fn(N):(N=yn(c)?Yo:Zt.current,N=Gr(r,N));var ve=c.getDerivedStateFromProps;(le=typeof ve=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(b!==de||se!==N)&&Km(r,w,h,N),po=!1,se=r.memoizedState,w.state=se,hc(r,h,w,g);var Ae=r.memoizedState;b!==de||se!==Ae||mn.current||po?(typeof ve=="function"&&(vf(r,c,ve,h),Ae=r.memoizedState),(W=po||qm(r,c,W,h,se,Ae,N)||!1)?(le||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(h,Ae,N),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(h,Ae,N)),typeof w.componentDidUpdate=="function"&&(r.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof w.componentDidUpdate!="function"||b===i.memoizedProps&&se===i.memoizedState||(r.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||b===i.memoizedProps&&se===i.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=Ae),w.props=h,w.state=Ae,w.context=N,h=W):(typeof w.componentDidUpdate!="function"||b===i.memoizedProps&&se===i.memoizedState||(r.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||b===i.memoizedProps&&se===i.memoizedState||(r.flags|=1024),h=!1)}return wf(i,r,c,h,S,g)}function wf(i,r,c,h,g,S){a0(i,r);var w=(r.flags&128)!==0;if(!h&&!w)return g&&hm(r,c,!1),Ni(i,r,S);h=r.stateNode,f1.current=r;var b=w&&typeof c.getDerivedStateFromError!="function"?null:h.render();return r.flags|=1,i!==null&&w?(r.child=jr(r,i.child,null,S),r.child=jr(r,null,b,S)):an(i,r,b,S),r.memoizedState=h.state,g&&hm(r,c,!0),r.child}function c0(i){var r=i.stateNode;r.pendingContext?dm(i,r.pendingContext,r.pendingContext!==r.context):r.context&&dm(i,r.context,!1),sf(i,r.containerInfo)}function u0(i,r,c,h,g){return Yr(),Qd(g),r.flags|=256,an(i,r,c,h),r.child}var Ef={dehydrated:null,treeContext:null,retryLane:0};function Cf(i){return{baseLanes:i,cachePool:null,transitions:null}}function d0(i,r,c){var h=r.pendingProps,g=mt.current,S=!1,w=(r.flags&128)!==0,b;if((b=w)||(b=i!==null&&i.memoizedState===null?!1:(g&2)!==0),b?(S=!0,r.flags&=-129):(i===null||i.memoizedState!==null)&&(g|=1),it(mt,g&1),i===null)return Kd(r),i=r.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((r.mode&1)===0?r.lanes=1:i.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(w=h.children,i=h.fallback,S?(h=r.mode,S=r.child,w={mode:"hidden",children:w},(h&1)===0&&S!==null?(S.childLanes=0,S.pendingProps=w):S=Nc(w,h,0,null),i=er(i,h,c,null),S.return=r,i.return=r,S.sibling=i,r.child=S,r.child.memoizedState=Cf(c),r.memoizedState=Ef,i):Pf(r,w));if(g=i.memoizedState,g!==null&&(b=g.dehydrated,b!==null))return h1(i,r,w,h,b,g,c);if(S){S=h.fallback,w=r.mode,g=i.child,b=g.sibling;var N={mode:"hidden",children:h.children};return(w&1)===0&&r.child!==g?(h=r.child,h.childLanes=0,h.pendingProps=N,r.deletions=null):(h=To(g,N),h.subtreeFlags=g.subtreeFlags&14680064),b!==null?S=To(b,S):(S=er(S,w,c,null),S.flags|=2),S.return=r,h.return=r,h.sibling=S,r.child=h,h=S,S=r.child,w=i.child.memoizedState,w=w===null?Cf(c):{baseLanes:w.baseLanes|c,cachePool:null,transitions:w.transitions},S.memoizedState=w,S.childLanes=i.childLanes&~c,r.memoizedState=Ef,h}return S=i.child,i=S.sibling,h=To(S,{mode:"visible",children:h.children}),(r.mode&1)===0&&(h.lanes=c),h.return=r,h.sibling=null,i!==null&&(c=r.deletions,c===null?(r.deletions=[i],r.flags|=16):c.push(i)),r.child=h,r.memoizedState=null,h}function Pf(i,r){return r=Nc({mode:"visible",children:r},i.mode,0,null),r.return=i,i.child=r}function Tc(i,r,c,h){return h!==null&&Qd(h),jr(r,i.child,null,c),i=Pf(r,r.pendingProps.children),i.flags|=2,r.memoizedState=null,i}function h1(i,r,c,h,g,S,w){if(c)return r.flags&256?(r.flags&=-257,h=If(Error(n(422))),Tc(i,r,w,h)):r.memoizedState!==null?(r.child=i.child,r.flags|=128,null):(S=h.fallback,g=r.mode,h=Nc({mode:"visible",children:h.children},g,0,null),S=er(S,g,w,null),S.flags|=2,h.return=r,S.return=r,h.sibling=S,r.child=h,(r.mode&1)!==0&&jr(r,i.child,null,w),r.child.memoizedState=Cf(w),r.memoizedState=Ef,S);if((r.mode&1)===0)return Tc(i,r,w,null);if(g.data==="$!"){if(h=g.nextSibling&&g.nextSibling.dataset,h)var b=h.dgst;return h=b,S=Error(n(419)),h=If(S,h,void 0),Tc(i,r,w,h)}if(b=(w&i.childLanes)!==0,vn||b){if(h=Ft,h!==null){switch(w&-w){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=(g&(h.suspendedLanes|w))!==0?0:g,g!==0&&g!==S.retryLane&&(S.retryLane=g,Di(i,g),ii(h,i,g,-1))}return $f(),h=If(Error(n(421))),Tc(i,r,w,h)}return g.data==="$?"?(r.flags|=128,r.child=i.child,r=P1.bind(null,i),g._reactRetry=r,null):(i=S.treeContext,Rn=co(g.nextSibling),_n=r,pt=!0,Jn=null,i!==null&&(Bn[Hn++]=ki,Bn[Hn++]=bi,Bn[Hn++]=jo,ki=i.id,bi=i.overflow,jo=r),r=Pf(r,h.children),r.flags|=4096,r)}function f0(i,r,c){i.lanes|=r;var h=i.alternate;h!==null&&(h.lanes|=r),nf(i.return,r,c)}function _f(i,r,c,h,g){var S=i.memoizedState;S===null?i.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:g}:(S.isBackwards=r,S.rendering=null,S.renderingStartTime=0,S.last=h,S.tail=c,S.tailMode=g)}function h0(i,r,c){var h=r.pendingProps,g=h.revealOrder,S=h.tail;if(an(i,r,h.children,c),h=mt.current,(h&2)!==0)h=h&1|2,r.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=r.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&f0(i,c,r);else if(i.tag===19)f0(i,c,r);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break e;for(;i.sibling===null;){if(i.return===null||i.return===r)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}h&=1}if(it(mt,h),(r.mode&1)===0)r.memoizedState=null;else switch(g){case"forwards":for(c=r.child,g=null;c!==null;)i=c.alternate,i!==null&&pc(i)===null&&(g=c),c=c.sibling;c=g,c===null?(g=r.child,r.child=null):(g=c.sibling,c.sibling=null),_f(r,!1,g,c,S);break;case"backwards":for(c=null,g=r.child,r.child=null;g!==null;){if(i=g.alternate,i!==null&&pc(i)===null){r.child=g;break}i=g.sibling,g.sibling=c,c=g,g=i}_f(r,!0,c,null,S);break;case"together":_f(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Ac(i,r){(r.mode&1)===0&&i!==null&&(i.alternate=null,r.alternate=null,r.flags|=2)}function Ni(i,r,c){if(i!==null&&(r.dependencies=i.dependencies),Zo|=r.lanes,(c&r.childLanes)===0)return null;if(i!==null&&r.child!==i.child)throw Error(n(153));if(r.child!==null){for(i=r.child,c=To(i,i.pendingProps),r.child=c,c.return=r;i.sibling!==null;)i=i.sibling,c=c.sibling=To(i,i.pendingProps),c.return=r;c.sibling=null}return r.child}function p1(i,r,c){switch(r.tag){case 3:c0(r),Yr();break;case 5:_m(r);break;case 1:yn(r.type)&&oc(r);break;case 4:sf(r,r.stateNode.containerInfo);break;case 10:var h=r.type._context,g=r.memoizedProps.value;it(uc,h._currentValue),h._currentValue=g;break;case 13:if(h=r.memoizedState,h!==null)return h.dehydrated!==null?(it(mt,mt.current&1),r.flags|=128,null):(c&r.child.childLanes)!==0?d0(i,r,c):(it(mt,mt.current&1),i=Ni(i,r,c),i!==null?i.sibling:null);it(mt,mt.current&1);break;case 19:if(h=(c&r.childLanes)!==0,(i.flags&128)!==0){if(h)return h0(i,r,c);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),it(mt,mt.current),h)break;return null;case 22:case 23:return r.lanes=0,s0(i,r,c)}return Ni(i,r,c)}var p0,Rf,g0,m0;p0=function(i,r){for(var c=r.child;c!==null;){if(c.tag===5||c.tag===6)i.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===r)break;for(;c.sibling===null;){if(c.return===null||c.return===r)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},Rf=function(){},g0=function(i,r,c,h){var g=i.memoizedProps;if(g!==h){i=r.stateNode,Vo(hi.current);var S=null;switch(c){case"input":g=xe(i,g),h=xe(i,h),S=[];break;case"select":g=V({},g,{value:void 0}),h=V({},h,{value:void 0}),S=[];break;case"textarea":g=no(i,g),h=no(i,h),S=[];break;default:typeof g.onClick!="function"&&typeof h.onClick=="function"&&(i.onclick=tc)}ad(c,h);var w;c=null;for(W in g)if(!h.hasOwnProperty(W)&&g.hasOwnProperty(W)&&g[W]!=null)if(W==="style"){var b=g[W];for(w in b)b.hasOwnProperty(w)&&(c||(c={}),c[w]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(s.hasOwnProperty(W)?S||(S=[]):(S=S||[]).push(W,null));for(W in h){var N=h[W];if(b=g!=null?g[W]:void 0,h.hasOwnProperty(W)&&N!==b&&(N!=null||b!=null))if(W==="style")if(b){for(w in b)!b.hasOwnProperty(w)||N&&N.hasOwnProperty(w)||(c||(c={}),c[w]="");for(w in N)N.hasOwnProperty(w)&&b[w]!==N[w]&&(c||(c={}),c[w]=N[w])}else c||(S||(S=[]),S.push(W,c)),c=N;else W==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,b=b?b.__html:void 0,N!=null&&b!==N&&(S=S||[]).push(W,N)):W==="children"?typeof N!="string"&&typeof N!="number"||(S=S||[]).push(W,""+N):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(s.hasOwnProperty(W)?(N!=null&&W==="onScroll"&&at("scroll",i),S||b===N||(S=[])):(S=S||[]).push(W,N))}c&&(S=S||[]).push("style",c);var W=S;(r.updateQueue=W)&&(r.flags|=4)}},m0=function(i,r,c,h){c!==h&&(r.flags|=4)};function Sa(i,r){if(!pt)switch(i.tailMode){case"hidden":r=i.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?r||i.tail===null?i.tail=null:i.tail.sibling=null:h.sibling=null}}function Qt(i){var r=i.alternate!==null&&i.alternate.child===i.child,c=0,h=0;if(r)for(var g=i.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags&14680064,h|=g.flags&14680064,g.return=i,g=g.sibling;else for(g=i.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=i,g=g.sibling;return i.subtreeFlags|=h,i.childLanes=c,r}function g1(i,r,c){var h=r.pendingProps;switch(qd(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qt(r),null;case 1:return yn(r.type)&&ic(),Qt(r),null;case 3:return h=r.stateNode,Vr(),lt(mn),lt(Zt),cf(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(i===null||i.child===null)&&(lc(r)?r.flags|=4:i===null||i.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Jn!==null&&(xf(Jn),Jn=null))),Rf(i,r),Qt(r),null;case 5:af(r);var g=Vo(pa.current);if(c=r.type,i!==null&&r.stateNode!=null)g0(i,r,c,h,g),i.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!h){if(r.stateNode===null)throw Error(n(166));return Qt(r),null}if(i=Vo(hi.current),lc(r)){h=r.stateNode,c=r.type;var S=r.memoizedProps;switch(h[fi]=r,h[ca]=S,i=(r.mode&1)!==0,c){case"dialog":at("cancel",h),at("close",h);break;case"iframe":case"object":case"embed":at("load",h);break;case"video":case"audio":for(g=0;g<sa.length;g++)at(sa[g],h);break;case"source":at("error",h);break;case"img":case"image":case"link":at("error",h),at("load",h);break;case"details":at("toggle",h);break;case"input":He(h,S),at("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!S.multiple},at("invalid",h);break;case"textarea":Ls(h,S),at("invalid",h)}ad(c,S),g=null;for(var w in S)if(S.hasOwnProperty(w)){var b=S[w];w==="children"?typeof b=="string"?h.textContent!==b&&(S.suppressHydrationWarning!==!0&&ec(h.textContent,b,i),g=["children",b]):typeof b=="number"&&h.textContent!==""+b&&(S.suppressHydrationWarning!==!0&&ec(h.textContent,b,i),g=["children",""+b]):s.hasOwnProperty(w)&&b!=null&&w==="onScroll"&&at("scroll",h)}switch(c){case"input":Se(h),_t(h,S,!0);break;case"textarea":Se(h),Us(h);break;case"select":case"option":break;default:typeof S.onClick=="function"&&(h.onclick=tc)}h=g,r.updateQueue=h,h!==null&&(r.flags|=4)}else{w=g.nodeType===9?g:g.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=Go(c)),i==="http://www.w3.org/1999/xhtml"?c==="script"?(i=w.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof h.is=="string"?i=w.createElement(c,{is:h.is}):(i=w.createElement(c),c==="select"&&(w=i,h.multiple?w.multiple=!0:h.size&&(w.size=h.size))):i=w.createElementNS(i,c),i[fi]=r,i[ca]=h,p0(i,r,!1,!1),r.stateNode=i;e:{switch(w=ld(c,h),c){case"dialog":at("cancel",i),at("close",i),g=h;break;case"iframe":case"object":case"embed":at("load",i),g=h;break;case"video":case"audio":for(g=0;g<sa.length;g++)at(sa[g],i);g=h;break;case"source":at("error",i),g=h;break;case"img":case"image":case"link":at("error",i),at("load",i),g=h;break;case"details":at("toggle",i),g=h;break;case"input":He(i,h),g=xe(i,h),at("invalid",i);break;case"option":g=h;break;case"select":i._wrapperState={wasMultiple:!!h.multiple},g=V({},h,{value:void 0}),at("invalid",i);break;case"textarea":Ls(i,h),g=no(i,h),at("invalid",i);break;default:g=h}ad(c,g),b=g;for(S in b)if(b.hasOwnProperty(S)){var N=b[S];S==="style"?rg(i,N):S==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,N!=null&&ig(i,N)):S==="children"?typeof N=="string"?(c!=="textarea"||N!=="")&&Gs(i,N):typeof N=="number"&&Gs(i,""+N):S!=="suppressContentEditableWarning"&&S!=="suppressHydrationWarning"&&S!=="autoFocus"&&(s.hasOwnProperty(S)?N!=null&&S==="onScroll"&&at("scroll",i):N!=null&&C(i,S,N,w))}switch(c){case"input":Se(i),_t(i,h,!1);break;case"textarea":Se(i),Us(i);break;case"option":h.value!=null&&i.setAttribute("value",""+F(h.value));break;case"select":i.multiple=!!h.multiple,S=h.value,S!=null?Cn(i,!!h.multiple,S,!1):h.defaultValue!=null&&Cn(i,!!h.multiple,h.defaultValue,!0);break;default:typeof g.onClick=="function"&&(i.onclick=tc)}switch(c){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Qt(r),null;case 6:if(i&&r.stateNode!=null)m0(i,r,i.memoizedProps,h);else{if(typeof h!="string"&&r.stateNode===null)throw Error(n(166));if(c=Vo(pa.current),Vo(hi.current),lc(r)){if(h=r.stateNode,c=r.memoizedProps,h[fi]=r,(S=h.nodeValue!==c)&&(i=_n,i!==null))switch(i.tag){case 3:ec(h.nodeValue,c,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&ec(h.nodeValue,c,(i.mode&1)!==0)}S&&(r.flags|=4)}else h=(c.nodeType===9?c:c.ownerDocument).createTextNode(h),h[fi]=r,r.stateNode=h}return Qt(r),null;case 13:if(lt(mt),h=r.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(pt&&Rn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)Sm(),Yr(),r.flags|=98560,S=!1;else if(S=lc(r),h!==null&&h.dehydrated!==null){if(i===null){if(!S)throw Error(n(318));if(S=r.memoizedState,S=S!==null?S.dehydrated:null,!S)throw Error(n(317));S[fi]=r}else Yr(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Qt(r),S=!1}else Jn!==null&&(xf(Jn),Jn=null),S=!0;if(!S)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=c,r):(h=h!==null,h!==(i!==null&&i.memoizedState!==null)&&h&&(r.child.flags|=8192,(r.mode&1)!==0&&(i===null||(mt.current&1)!==0?Ot===0&&(Ot=3):$f())),r.updateQueue!==null&&(r.flags|=4),Qt(r),null);case 4:return Vr(),Rf(i,r),i===null&&aa(r.stateNode.containerInfo),Qt(r),null;case 10:return tf(r.type._context),Qt(r),null;case 17:return yn(r.type)&&ic(),Qt(r),null;case 19:if(lt(mt),S=r.memoizedState,S===null)return Qt(r),null;if(h=(r.flags&128)!==0,w=S.rendering,w===null)if(h)Sa(S,!1);else{if(Ot!==0||i!==null&&(i.flags&128)!==0)for(i=r.child;i!==null;){if(w=pc(i),w!==null){for(r.flags|=128,Sa(S,!1),h=w.updateQueue,h!==null&&(r.updateQueue=h,r.flags|=4),r.subtreeFlags=0,h=c,c=r.child;c!==null;)S=c,i=h,S.flags&=14680066,w=S.alternate,w===null?(S.childLanes=0,S.lanes=i,S.child=null,S.subtreeFlags=0,S.memoizedProps=null,S.memoizedState=null,S.updateQueue=null,S.dependencies=null,S.stateNode=null):(S.childLanes=w.childLanes,S.lanes=w.lanes,S.child=w.child,S.subtreeFlags=0,S.deletions=null,S.memoizedProps=w.memoizedProps,S.memoizedState=w.memoizedState,S.updateQueue=w.updateQueue,S.type=w.type,i=w.dependencies,S.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),c=c.sibling;return it(mt,mt.current&1|2),r.child}i=i.sibling}S.tail!==null&&wt()>Qr&&(r.flags|=128,h=!0,Sa(S,!1),r.lanes=4194304)}else{if(!h)if(i=pc(w),i!==null){if(r.flags|=128,h=!0,c=i.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),Sa(S,!0),S.tail===null&&S.tailMode==="hidden"&&!w.alternate&&!pt)return Qt(r),null}else 2*wt()-S.renderingStartTime>Qr&&c!==1073741824&&(r.flags|=128,h=!0,Sa(S,!1),r.lanes=4194304);S.isBackwards?(w.sibling=r.child,r.child=w):(c=S.last,c!==null?c.sibling=w:r.child=w,S.last=w)}return S.tail!==null?(r=S.tail,S.rendering=r,S.tail=r.sibling,S.renderingStartTime=wt(),r.sibling=null,c=mt.current,it(mt,h?c&1|2:c&1),r):(Qt(r),null);case 22:case 23:return Gf(),h=r.memoizedState!==null,i!==null&&i.memoizedState!==null!==h&&(r.flags|=8192),h&&(r.mode&1)!==0?(Mn&1073741824)!==0&&(Qt(r),r.subtreeFlags&6&&(r.flags|=8192)):Qt(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function m1(i,r){switch(qd(r),r.tag){case 1:return yn(r.type)&&ic(),i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 3:return Vr(),lt(mn),lt(Zt),cf(),i=r.flags,(i&65536)!==0&&(i&128)===0?(r.flags=i&-65537|128,r):null;case 5:return af(r),null;case 13:if(lt(mt),i=r.memoizedState,i!==null&&i.dehydrated!==null){if(r.alternate===null)throw Error(n(340));Yr()}return i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 19:return lt(mt),null;case 4:return Vr(),null;case 10:return tf(r.type._context),null;case 22:case 23:return Gf(),null;case 24:return null;default:return null}}var wc=!1,Jt=!1,y1=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function Zr(i,r){var c=i.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(h){St(i,r,h)}else c.current=null}function Mf(i,r,c){try{c()}catch(h){St(i,r,h)}}var y0=!1;function v1(i,r){if(Ud=Wl,i=qg(),Dd(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var g=h.anchorOffset,S=h.focusNode;h=h.focusOffset;try{c.nodeType,S.nodeType}catch{c=null;break e}var w=0,b=-1,N=-1,W=0,le=0,de=i,se=null;t:for(;;){for(var ve;de!==c||g!==0&&de.nodeType!==3||(b=w+g),de!==S||h!==0&&de.nodeType!==3||(N=w+h),de.nodeType===3&&(w+=de.nodeValue.length),(ve=de.firstChild)!==null;)se=de,de=ve;for(;;){if(de===i)break t;if(se===c&&++W===g&&(b=w),se===S&&++le===h&&(N=w),(ve=de.nextSibling)!==null)break;de=se,se=de.parentNode}de=ve}c=b===-1||N===-1?null:{start:b,end:N}}else c=null}c=c||{start:0,end:0}}else c=null;for(Gd={focusedElem:i,selectionRange:c},Wl=!1,Ie=r;Ie!==null;)if(r=Ie,i=r.child,(r.subtreeFlags&1028)!==0&&i!==null)i.return=r,Ie=i;else for(;Ie!==null;){r=Ie;try{var Ae=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(Ae!==null){var we=Ae.memoizedProps,Et=Ae.memoizedState,x=r.stateNode,H=x.getSnapshotBeforeUpdate(r.elementType===r.type?we:ei(r.type,we),Et);x.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var U=r.stateNode.containerInfo;U.nodeType===1?U.textContent="":U.nodeType===9&&U.documentElement&&U.removeChild(U.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(he){St(r,r.return,he)}if(i=r.sibling,i!==null){i.return=r.return,Ie=i;break}Ie=r.return}return Ae=y0,y0=!1,Ae}function Ia(i,r,c){var h=r.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var g=h=h.next;do{if((g.tag&i)===i){var S=g.destroy;g.destroy=void 0,S!==void 0&&Mf(r,c,S)}g=g.next}while(g!==h)}}function Ec(i,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var c=r=r.next;do{if((c.tag&i)===i){var h=c.create;c.destroy=h()}c=c.next}while(c!==r)}}function kf(i){var r=i.ref;if(r!==null){var c=i.stateNode;switch(i.tag){case 5:i=c;break;default:i=c}typeof r=="function"?r(i):r.current=i}}function v0(i){var r=i.alternate;r!==null&&(i.alternate=null,v0(r)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(r=i.stateNode,r!==null&&(delete r[fi],delete r[ca],delete r[jd],delete r[e1],delete r[t1])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function S0(i){return i.tag===5||i.tag===3||i.tag===4}function I0(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||S0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function bf(i,r,c){var h=i.tag;if(h===5||h===6)i=i.stateNode,r?c.nodeType===8?c.parentNode.insertBefore(i,r):c.insertBefore(i,r):(c.nodeType===8?(r=c.parentNode,r.insertBefore(i,c)):(r=c,r.appendChild(i)),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=tc));else if(h!==4&&(i=i.child,i!==null))for(bf(i,r,c),i=i.sibling;i!==null;)bf(i,r,c),i=i.sibling}function Df(i,r,c){var h=i.tag;if(h===5||h===6)i=i.stateNode,r?c.insertBefore(i,r):c.appendChild(i);else if(h!==4&&(i=i.child,i!==null))for(Df(i,r,c),i=i.sibling;i!==null;)Df(i,r,c),i=i.sibling}var Wt=null,ti=!1;function mo(i,r,c){for(c=c.child;c!==null;)T0(i,r,c),c=c.sibling}function T0(i,r,c){if(di&&typeof di.onCommitFiberUnmount=="function")try{di.onCommitFiberUnmount(Fl,c)}catch{}switch(c.tag){case 5:Jt||Zr(c,r);case 6:var h=Wt,g=ti;Wt=null,mo(i,r,c),Wt=h,ti=g,Wt!==null&&(ti?(i=Wt,c=c.stateNode,i.nodeType===8?i.parentNode.removeChild(c):i.removeChild(c)):Wt.removeChild(c.stateNode));break;case 18:Wt!==null&&(ti?(i=Wt,c=c.stateNode,i.nodeType===8?Yd(i.parentNode,c):i.nodeType===1&&Yd(i,c),Qs(i)):Yd(Wt,c.stateNode));break;case 4:h=Wt,g=ti,Wt=c.stateNode.containerInfo,ti=!0,mo(i,r,c),Wt=h,ti=g;break;case 0:case 11:case 14:case 15:if(!Jt&&(h=c.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){g=h=h.next;do{var S=g,w=S.destroy;S=S.tag,w!==void 0&&((S&2)!==0||(S&4)!==0)&&Mf(c,r,w),g=g.next}while(g!==h)}mo(i,r,c);break;case 1:if(!Jt&&(Zr(c,r),h=c.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=c.memoizedProps,h.state=c.memoizedState,h.componentWillUnmount()}catch(b){St(c,r,b)}mo(i,r,c);break;case 21:mo(i,r,c);break;case 22:c.mode&1?(Jt=(h=Jt)||c.memoizedState!==null,mo(i,r,c),Jt=h):mo(i,r,c);break;default:mo(i,r,c)}}function A0(i){var r=i.updateQueue;if(r!==null){i.updateQueue=null;var c=i.stateNode;c===null&&(c=i.stateNode=new y1),r.forEach(function(h){var g=_1.bind(null,i,h);c.has(h)||(c.add(h),h.then(g,g))})}}function ni(i,r){var c=r.deletions;if(c!==null)for(var h=0;h<c.length;h++){var g=c[h];try{var S=i,w=r,b=w;e:for(;b!==null;){switch(b.tag){case 5:Wt=b.stateNode,ti=!1;break e;case 3:Wt=b.stateNode.containerInfo,ti=!0;break e;case 4:Wt=b.stateNode.containerInfo,ti=!0;break e}b=b.return}if(Wt===null)throw Error(n(160));T0(S,w,g),Wt=null,ti=!1;var N=g.alternate;N!==null&&(N.return=null),g.return=null}catch(W){St(g,r,W)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)w0(r,i),r=r.sibling}function w0(i,r){var c=i.alternate,h=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(ni(r,i),gi(i),h&4){try{Ia(3,i,i.return),Ec(3,i)}catch(we){St(i,i.return,we)}try{Ia(5,i,i.return)}catch(we){St(i,i.return,we)}}break;case 1:ni(r,i),gi(i),h&512&&c!==null&&Zr(c,c.return);break;case 5:if(ni(r,i),gi(i),h&512&&c!==null&&Zr(c,c.return),i.flags&32){var g=i.stateNode;try{Gs(g,"")}catch(we){St(i,i.return,we)}}if(h&4&&(g=i.stateNode,g!=null)){var S=i.memoizedProps,w=c!==null?c.memoizedProps:S,b=i.type,N=i.updateQueue;if(i.updateQueue=null,N!==null)try{b==="input"&&S.type==="radio"&&S.name!=null&&rt(g,S),ld(b,w);var W=ld(b,S);for(w=0;w<N.length;w+=2){var le=N[w],de=N[w+1];le==="style"?rg(g,de):le==="dangerouslySetInnerHTML"?ig(g,de):le==="children"?Gs(g,de):C(g,le,de,W)}switch(b){case"input":At(g,S);break;case"textarea":xs(g,S);break;case"select":var se=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!S.multiple;var ve=S.value;ve!=null?Cn(g,!!S.multiple,ve,!1):se!==!!S.multiple&&(S.defaultValue!=null?Cn(g,!!S.multiple,S.defaultValue,!0):Cn(g,!!S.multiple,S.multiple?[]:"",!1))}g[ca]=S}catch(we){St(i,i.return,we)}}break;case 6:if(ni(r,i),gi(i),h&4){if(i.stateNode===null)throw Error(n(162));g=i.stateNode,S=i.memoizedProps;try{g.nodeValue=S}catch(we){St(i,i.return,we)}}break;case 3:if(ni(r,i),gi(i),h&4&&c!==null&&c.memoizedState.isDehydrated)try{Qs(r.containerInfo)}catch(we){St(i,i.return,we)}break;case 4:ni(r,i),gi(i);break;case 13:ni(r,i),gi(i),g=i.child,g.flags&8192&&(S=g.memoizedState!==null,g.stateNode.isHidden=S,!S||g.alternate!==null&&g.alternate.memoizedState!==null||(Bf=wt())),h&4&&A0(i);break;case 22:if(le=c!==null&&c.memoizedState!==null,i.mode&1?(Jt=(W=Jt)||le,ni(r,i),Jt=W):ni(r,i),gi(i),h&8192){if(W=i.memoizedState!==null,(i.stateNode.isHidden=W)&&!le&&(i.mode&1)!==0)for(Ie=i,le=i.child;le!==null;){for(de=Ie=le;Ie!==null;){switch(se=Ie,ve=se.child,se.tag){case 0:case 11:case 14:case 15:Ia(4,se,se.return);break;case 1:Zr(se,se.return);var Ae=se.stateNode;if(typeof Ae.componentWillUnmount=="function"){h=se,c=se.return;try{r=h,Ae.props=r.memoizedProps,Ae.state=r.memoizedState,Ae.componentWillUnmount()}catch(we){St(h,c,we)}}break;case 5:Zr(se,se.return);break;case 22:if(se.memoizedState!==null){P0(de);continue}}ve!==null?(ve.return=se,Ie=ve):P0(de)}le=le.sibling}e:for(le=null,de=i;;){if(de.tag===5){if(le===null){le=de;try{g=de.stateNode,W?(S=g.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none"):(b=de.stateNode,N=de.memoizedProps.style,w=N!=null&&N.hasOwnProperty("display")?N.display:null,b.style.display=og("display",w))}catch(we){St(i,i.return,we)}}}else if(de.tag===6){if(le===null)try{de.stateNode.nodeValue=W?"":de.memoizedProps}catch(we){St(i,i.return,we)}}else if((de.tag!==22&&de.tag!==23||de.memoizedState===null||de===i)&&de.child!==null){de.child.return=de,de=de.child;continue}if(de===i)break e;for(;de.sibling===null;){if(de.return===null||de.return===i)break e;le===de&&(le=null),de=de.return}le===de&&(le=null),de.sibling.return=de.return,de=de.sibling}}break;case 19:ni(r,i),gi(i),h&4&&A0(i);break;case 21:break;default:ni(r,i),gi(i)}}function gi(i){var r=i.flags;if(r&2){try{e:{for(var c=i.return;c!==null;){if(S0(c)){var h=c;break e}c=c.return}throw Error(n(160))}switch(h.tag){case 5:var g=h.stateNode;h.flags&32&&(Gs(g,""),h.flags&=-33);var S=I0(i);Df(i,S,g);break;case 3:case 4:var w=h.stateNode.containerInfo,b=I0(i);bf(i,b,w);break;default:throw Error(n(161))}}catch(N){St(i,i.return,N)}i.flags&=-3}r&4096&&(i.flags&=-4097)}function S1(i,r,c){Ie=i,E0(i)}function E0(i,r,c){for(var h=(i.mode&1)!==0;Ie!==null;){var g=Ie,S=g.child;if(g.tag===22&&h){var w=g.memoizedState!==null||wc;if(!w){var b=g.alternate,N=b!==null&&b.memoizedState!==null||Jt;b=wc;var W=Jt;if(wc=w,(Jt=N)&&!W)for(Ie=g;Ie!==null;)w=Ie,N=w.child,w.tag===22&&w.memoizedState!==null?_0(g):N!==null?(N.return=w,Ie=N):_0(g);for(;S!==null;)Ie=S,E0(S),S=S.sibling;Ie=g,wc=b,Jt=W}C0(i)}else(g.subtreeFlags&8772)!==0&&S!==null?(S.return=g,Ie=S):C0(i)}}function C0(i){for(;Ie!==null;){var r=Ie;if((r.flags&8772)!==0){var c=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:Jt||Ec(5,r);break;case 1:var h=r.stateNode;if(r.flags&4&&!Jt)if(c===null)h.componentDidMount();else{var g=r.elementType===r.type?c.memoizedProps:ei(r.type,c.memoizedProps);h.componentDidUpdate(g,c.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var S=r.updateQueue;S!==null&&Pm(r,S,h);break;case 3:var w=r.updateQueue;if(w!==null){if(c=null,r.child!==null)switch(r.child.tag){case 5:c=r.child.stateNode;break;case 1:c=r.child.stateNode}Pm(r,w,c)}break;case 5:var b=r.stateNode;if(c===null&&r.flags&4){c=b;var N=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":N.autoFocus&&c.focus();break;case"img":N.src&&(c.src=N.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var W=r.alternate;if(W!==null){var le=W.memoizedState;if(le!==null){var de=le.dehydrated;de!==null&&Qs(de)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Jt||r.flags&512&&kf(r)}catch(se){St(r,r.return,se)}}if(r===i){Ie=null;break}if(c=r.sibling,c!==null){c.return=r.return,Ie=c;break}Ie=r.return}}function P0(i){for(;Ie!==null;){var r=Ie;if(r===i){Ie=null;break}var c=r.sibling;if(c!==null){c.return=r.return,Ie=c;break}Ie=r.return}}function _0(i){for(;Ie!==null;){var r=Ie;try{switch(r.tag){case 0:case 11:case 15:var c=r.return;try{Ec(4,r)}catch(N){St(r,c,N)}break;case 1:var h=r.stateNode;if(typeof h.componentDidMount=="function"){var g=r.return;try{h.componentDidMount()}catch(N){St(r,g,N)}}var S=r.return;try{kf(r)}catch(N){St(r,S,N)}break;case 5:var w=r.return;try{kf(r)}catch(N){St(r,w,N)}}}catch(N){St(r,r.return,N)}if(r===i){Ie=null;break}var b=r.sibling;if(b!==null){b.return=r.return,Ie=b;break}Ie=r.return}}var I1=Math.ceil,Cc=M.ReactCurrentDispatcher,Of=M.ReactCurrentOwner,xn=M.ReactCurrentBatchConfig,ze=0,Ft=null,Rt=null,Yt=0,Mn=0,Kr=uo(0),Ot=0,Ta=null,Zo=0,Pc=0,Nf=0,Aa=null,Sn=null,Bf=0,Qr=1/0,Bi=null,_c=!1,Hf=null,yo=null,Rc=!1,vo=null,Mc=0,wa=0,Ff=null,kc=-1,bc=0;function ln(){return(ze&6)!==0?wt():kc!==-1?kc:kc=wt()}function So(i){return(i.mode&1)===0?1:(ze&2)!==0&&Yt!==0?Yt&-Yt:i1.transition!==null?(bc===0&&(bc=Ig()),bc):(i=Ke,i!==0||(i=window.event,i=i===void 0?16:Mg(i.type)),i)}function ii(i,r,c,h){if(50<wa)throw wa=0,Ff=null,Error(n(185));Xs(i,c,h),((ze&2)===0||i!==Ft)&&(i===Ft&&((ze&2)===0&&(Pc|=c),Ot===4&&Io(i,Yt)),In(i,h),c===1&&ze===0&&(r.mode&1)===0&&(Qr=wt()+500,rc&&ho()))}function In(i,r){var c=i.callbackNode;iA(i,r);var h=Ul(i,i===Ft?Yt:0);if(h===0)c!==null&&yg(c),i.callbackNode=null,i.callbackPriority=0;else if(r=h&-h,i.callbackPriority!==r){if(c!=null&&yg(c),r===1)i.tag===0?n1(M0.bind(null,i)):pm(M0.bind(null,i)),QA(function(){(ze&6)===0&&ho()}),c=null;else{switch(Tg(h)){case 1:c=gd;break;case 4:c=vg;break;case 16:c=Hl;break;case 536870912:c=Sg;break;default:c=Hl}c=F0(c,R0.bind(null,i))}i.callbackPriority=r,i.callbackNode=c}}function R0(i,r){if(kc=-1,bc=0,(ze&6)!==0)throw Error(n(327));var c=i.callbackNode;if(Jr()&&i.callbackNode!==c)return null;var h=Ul(i,i===Ft?Yt:0);if(h===0)return null;if((h&30)!==0||(h&i.expiredLanes)!==0||r)r=Dc(i,h);else{r=h;var g=ze;ze|=2;var S=b0();(Ft!==i||Yt!==r)&&(Bi=null,Qr=wt()+500,Qo(i,r));do try{w1();break}catch(b){k0(i,b)}while(!0);ef(),Cc.current=S,ze=g,Rt!==null?r=0:(Ft=null,Yt=0,r=Ot)}if(r!==0){if(r===2&&(g=md(i),g!==0&&(h=g,r=Lf(i,g))),r===1)throw c=Ta,Qo(i,0),Io(i,h),In(i,wt()),c;if(r===6)Io(i,h);else{if(g=i.current.alternate,(h&30)===0&&!T1(g)&&(r=Dc(i,h),r===2&&(S=md(i),S!==0&&(h=S,r=Lf(i,S))),r===1))throw c=Ta,Qo(i,0),Io(i,h),In(i,wt()),c;switch(i.finishedWork=g,i.finishedLanes=h,r){case 0:case 1:throw Error(n(345));case 2:Jo(i,Sn,Bi);break;case 3:if(Io(i,h),(h&130023424)===h&&(r=Bf+500-wt(),10<r)){if(Ul(i,0)!==0)break;if(g=i.suspendedLanes,(g&h)!==h){ln(),i.pingedLanes|=i.suspendedLanes&g;break}i.timeoutHandle=Wd(Jo.bind(null,i,Sn,Bi),r);break}Jo(i,Sn,Bi);break;case 4:if(Io(i,h),(h&4194240)===h)break;for(r=i.eventTimes,g=-1;0<h;){var w=31-Kn(h);S=1<<w,w=r[w],w>g&&(g=w),h&=~S}if(h=g,h=wt()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*I1(h/1960))-h,10<h){i.timeoutHandle=Wd(Jo.bind(null,i,Sn,Bi),h);break}Jo(i,Sn,Bi);break;case 5:Jo(i,Sn,Bi);break;default:throw Error(n(329))}}}return In(i,wt()),i.callbackNode===c?R0.bind(null,i):null}function Lf(i,r){var c=Aa;return i.current.memoizedState.isDehydrated&&(Qo(i,r).flags|=256),i=Dc(i,r),i!==2&&(r=Sn,Sn=c,r!==null&&xf(r)),i}function xf(i){Sn===null?Sn=i:Sn.push.apply(Sn,i)}function T1(i){for(var r=i;;){if(r.flags&16384){var c=r.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var h=0;h<c.length;h++){var g=c[h],S=g.getSnapshot;g=g.value;try{if(!Qn(S(),g))return!1}catch{return!1}}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Io(i,r){for(r&=~Nf,r&=~Pc,i.suspendedLanes|=r,i.pingedLanes&=~r,i=i.expirationTimes;0<r;){var c=31-Kn(r),h=1<<c;i[c]=-1,r&=~h}}function M0(i){if((ze&6)!==0)throw Error(n(327));Jr();var r=Ul(i,0);if((r&1)===0)return In(i,wt()),null;var c=Dc(i,r);if(i.tag!==0&&c===2){var h=md(i);h!==0&&(r=h,c=Lf(i,h))}if(c===1)throw c=Ta,Qo(i,0),Io(i,r),In(i,wt()),c;if(c===6)throw Error(n(345));return i.finishedWork=i.current.alternate,i.finishedLanes=r,Jo(i,Sn,Bi),In(i,wt()),null}function Uf(i,r){var c=ze;ze|=1;try{return i(r)}finally{ze=c,ze===0&&(Qr=wt()+500,rc&&ho())}}function Ko(i){vo!==null&&vo.tag===0&&(ze&6)===0&&Jr();var r=ze;ze|=1;var c=xn.transition,h=Ke;try{if(xn.transition=null,Ke=1,i)return i()}finally{Ke=h,xn.transition=c,ze=r,(ze&6)===0&&ho()}}function Gf(){Mn=Kr.current,lt(Kr)}function Qo(i,r){i.finishedWork=null,i.finishedLanes=0;var c=i.timeoutHandle;if(c!==-1&&(i.timeoutHandle=-1,KA(c)),Rt!==null)for(c=Rt.return;c!==null;){var h=c;switch(qd(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&ic();break;case 3:Vr(),lt(mn),lt(Zt),cf();break;case 5:af(h);break;case 4:Vr();break;case 13:lt(mt);break;case 19:lt(mt);break;case 10:tf(h.type._context);break;case 22:case 23:Gf()}c=c.return}if(Ft=i,Rt=i=To(i.current,null),Yt=Mn=r,Ot=0,Ta=null,Nf=Pc=Zo=0,Sn=Aa=null,Xo!==null){for(r=0;r<Xo.length;r++)if(c=Xo[r],h=c.interleaved,h!==null){c.interleaved=null;var g=h.next,S=c.pending;if(S!==null){var w=S.next;S.next=g,h.next=w}c.pending=h}Xo=null}return i}function k0(i,r){do{var c=Rt;try{if(ef(),gc.current=Sc,mc){for(var h=yt.memoizedState;h!==null;){var g=h.queue;g!==null&&(g.pending=null),h=h.next}mc=!1}if(qo=0,Ht=Dt=yt=null,ga=!1,ma=0,Of.current=null,c===null||c.return===null){Ot=1,Ta=r,Rt=null;break}e:{var S=i,w=c.return,b=c,N=r;if(r=Yt,b.flags|=32768,N!==null&&typeof N=="object"&&typeof N.then=="function"){var W=N,le=b,de=le.tag;if((le.mode&1)===0&&(de===0||de===11||de===15)){var se=le.alternate;se?(le.updateQueue=se.updateQueue,le.memoizedState=se.memoizedState,le.lanes=se.lanes):(le.updateQueue=null,le.memoizedState=null)}var ve=t0(w);if(ve!==null){ve.flags&=-257,n0(ve,w,b,S,r),ve.mode&1&&e0(S,W,r),r=ve,N=W;var Ae=r.updateQueue;if(Ae===null){var we=new Set;we.add(N),r.updateQueue=we}else Ae.add(N);break e}else{if((r&1)===0){e0(S,W,r),$f();break e}N=Error(n(426))}}else if(pt&&b.mode&1){var Et=t0(w);if(Et!==null){(Et.flags&65536)===0&&(Et.flags|=256),n0(Et,w,b,S,r),Qd(qr(N,b));break e}}S=N=qr(N,b),Ot!==4&&(Ot=2),Aa===null?Aa=[S]:Aa.push(S),S=w;do{switch(S.tag){case 3:S.flags|=65536,r&=-r,S.lanes|=r;var x=Qm(S,N,r);Cm(S,x);break e;case 1:b=N;var H=S.type,U=S.stateNode;if((S.flags&128)===0&&(typeof H.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(yo===null||!yo.has(U)))){S.flags|=65536,r&=-r,S.lanes|=r;var he=Jm(S,b,r);Cm(S,he);break e}}S=S.return}while(S!==null)}O0(c)}catch(Pe){r=Pe,Rt===c&&c!==null&&(Rt=c=c.return);continue}break}while(!0)}function b0(){var i=Cc.current;return Cc.current=Sc,i===null?Sc:i}function $f(){(Ot===0||Ot===3||Ot===2)&&(Ot=4),Ft===null||(Zo&268435455)===0&&(Pc&268435455)===0||Io(Ft,Yt)}function Dc(i,r){var c=ze;ze|=2;var h=b0();(Ft!==i||Yt!==r)&&(Bi=null,Qo(i,r));do try{A1();break}catch(g){k0(i,g)}while(!0);if(ef(),ze=c,Cc.current=h,Rt!==null)throw Error(n(261));return Ft=null,Yt=0,Ot}function A1(){for(;Rt!==null;)D0(Rt)}function w1(){for(;Rt!==null&&!VT();)D0(Rt)}function D0(i){var r=H0(i.alternate,i,Mn);i.memoizedProps=i.pendingProps,r===null?O0(i):Rt=r,Of.current=null}function O0(i){var r=i;do{var c=r.alternate;if(i=r.return,(r.flags&32768)===0){if(c=g1(c,r,Mn),c!==null){Rt=c;return}}else{if(c=m1(c,r),c!==null){c.flags&=32767,Rt=c;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Ot=6,Rt=null;return}}if(r=r.sibling,r!==null){Rt=r;return}Rt=r=i}while(r!==null);Ot===0&&(Ot=5)}function Jo(i,r,c){var h=Ke,g=xn.transition;try{xn.transition=null,Ke=1,E1(i,r,c,h)}finally{xn.transition=g,Ke=h}return null}function E1(i,r,c,h){do Jr();while(vo!==null);if((ze&6)!==0)throw Error(n(327));c=i.finishedWork;var g=i.finishedLanes;if(c===null)return null;if(i.finishedWork=null,i.finishedLanes=0,c===i.current)throw Error(n(177));i.callbackNode=null,i.callbackPriority=0;var S=c.lanes|c.childLanes;if(oA(i,S),i===Ft&&(Rt=Ft=null,Yt=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||Rc||(Rc=!0,F0(Hl,function(){return Jr(),null})),S=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||S){S=xn.transition,xn.transition=null;var w=Ke;Ke=1;var b=ze;ze|=4,Of.current=null,v1(i,c),w0(c,i),YA(Gd),Wl=!!Ud,Gd=Ud=null,i.current=c,S1(c),qT(),ze=b,Ke=w,xn.transition=S}else i.current=c;if(Rc&&(Rc=!1,vo=i,Mc=g),S=i.pendingLanes,S===0&&(yo=null),QT(c.stateNode),In(i,wt()),r!==null)for(h=i.onRecoverableError,c=0;c<r.length;c++)g=r[c],h(g.value,{componentStack:g.stack,digest:g.digest});if(_c)throw _c=!1,i=Hf,Hf=null,i;return(Mc&1)!==0&&i.tag!==0&&Jr(),S=i.pendingLanes,(S&1)!==0?i===Ff?wa++:(wa=0,Ff=i):wa=0,ho(),null}function Jr(){if(vo!==null){var i=Tg(Mc),r=xn.transition,c=Ke;try{if(xn.transition=null,Ke=16>i?16:i,vo===null)var h=!1;else{if(i=vo,vo=null,Mc=0,(ze&6)!==0)throw Error(n(331));var g=ze;for(ze|=4,Ie=i.current;Ie!==null;){var S=Ie,w=S.child;if((Ie.flags&16)!==0){var b=S.deletions;if(b!==null){for(var N=0;N<b.length;N++){var W=b[N];for(Ie=W;Ie!==null;){var le=Ie;switch(le.tag){case 0:case 11:case 15:Ia(8,le,S)}var de=le.child;if(de!==null)de.return=le,Ie=de;else for(;Ie!==null;){le=Ie;var se=le.sibling,ve=le.return;if(v0(le),le===W){Ie=null;break}if(se!==null){se.return=ve,Ie=se;break}Ie=ve}}}var Ae=S.alternate;if(Ae!==null){var we=Ae.child;if(we!==null){Ae.child=null;do{var Et=we.sibling;we.sibling=null,we=Et}while(we!==null)}}Ie=S}}if((S.subtreeFlags&2064)!==0&&w!==null)w.return=S,Ie=w;else e:for(;Ie!==null;){if(S=Ie,(S.flags&2048)!==0)switch(S.tag){case 0:case 11:case 15:Ia(9,S,S.return)}var x=S.sibling;if(x!==null){x.return=S.return,Ie=x;break e}Ie=S.return}}var H=i.current;for(Ie=H;Ie!==null;){w=Ie;var U=w.child;if((w.subtreeFlags&2064)!==0&&U!==null)U.return=w,Ie=U;else e:for(w=H;Ie!==null;){if(b=Ie,(b.flags&2048)!==0)try{switch(b.tag){case 0:case 11:case 15:Ec(9,b)}}catch(Pe){St(b,b.return,Pe)}if(b===w){Ie=null;break e}var he=b.sibling;if(he!==null){he.return=b.return,Ie=he;break e}Ie=b.return}}if(ze=g,ho(),di&&typeof di.onPostCommitFiberRoot=="function")try{di.onPostCommitFiberRoot(Fl,i)}catch{}h=!0}return h}finally{Ke=c,xn.transition=r}}return!1}function N0(i,r,c){r=qr(c,r),r=Qm(i,r,1),i=go(i,r,1),r=ln(),i!==null&&(Xs(i,1,r),In(i,r))}function St(i,r,c){if(i.tag===3)N0(i,i,c);else for(;r!==null;){if(r.tag===3){N0(r,i,c);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(yo===null||!yo.has(h))){i=qr(c,i),i=Jm(r,i,1),r=go(r,i,1),i=ln(),r!==null&&(Xs(r,1,i),In(r,i));break}}r=r.return}}function C1(i,r,c){var h=i.pingCache;h!==null&&h.delete(r),r=ln(),i.pingedLanes|=i.suspendedLanes&c,Ft===i&&(Yt&c)===c&&(Ot===4||Ot===3&&(Yt&130023424)===Yt&&500>wt()-Bf?Qo(i,0):Nf|=c),In(i,r)}function B0(i,r){r===0&&((i.mode&1)===0?r=1:(r=xl,xl<<=1,(xl&130023424)===0&&(xl=4194304)));var c=ln();i=Di(i,r),i!==null&&(Xs(i,r,c),In(i,c))}function P1(i){var r=i.memoizedState,c=0;r!==null&&(c=r.retryLane),B0(i,c)}function _1(i,r){var c=0;switch(i.tag){case 13:var h=i.stateNode,g=i.memoizedState;g!==null&&(c=g.retryLane);break;case 19:h=i.stateNode;break;default:throw Error(n(314))}h!==null&&h.delete(r),B0(i,c)}var H0;H0=function(i,r,c){if(i!==null)if(i.memoizedProps!==r.pendingProps||mn.current)vn=!0;else{if((i.lanes&c)===0&&(r.flags&128)===0)return vn=!1,p1(i,r,c);vn=(i.flags&131072)!==0}else vn=!1,pt&&(r.flags&1048576)!==0&&gm(r,ac,r.index);switch(r.lanes=0,r.tag){case 2:var h=r.type;Ac(i,r),i=r.pendingProps;var g=Gr(r,Zt.current);Xr(r,c),g=ff(null,r,h,i,g,c);var S=hf();return r.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,yn(h)?(S=!0,oc(r)):S=!1,r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,rf(r),g.updater=Ic,r.stateNode=g,g._reactInternals=r,Sf(r,h,i,c),r=wf(null,r,h,!0,S,c)):(r.tag=0,pt&&S&&Vd(r),an(null,r,g,c),r=r.child),r;case 16:h=r.elementType;e:{switch(Ac(i,r),i=r.pendingProps,g=h._init,h=g(h._payload),r.type=h,g=r.tag=M1(h),i=ei(h,i),g){case 0:r=Af(null,r,h,i,c);break e;case 1:r=l0(null,r,h,i,c);break e;case 11:r=i0(null,r,h,i,c);break e;case 14:r=o0(null,r,h,ei(h.type,i),c);break e}throw Error(n(306,h,""))}return r;case 0:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:ei(h,g),Af(i,r,h,g,c);case 1:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:ei(h,g),l0(i,r,h,g,c);case 3:e:{if(c0(r),i===null)throw Error(n(387));h=r.pendingProps,S=r.memoizedState,g=S.element,Em(i,r),hc(r,h,null,c);var w=r.memoizedState;if(h=w.element,S.isDehydrated)if(S={element:h,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},r.updateQueue.baseState=S,r.memoizedState=S,r.flags&256){g=qr(Error(n(423)),r),r=u0(i,r,h,c,g);break e}else if(h!==g){g=qr(Error(n(424)),r),r=u0(i,r,h,c,g);break e}else for(Rn=co(r.stateNode.containerInfo.firstChild),_n=r,pt=!0,Jn=null,c=Am(r,null,h,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Yr(),h===g){r=Ni(i,r,c);break e}an(i,r,h,c)}r=r.child}return r;case 5:return _m(r),i===null&&Kd(r),h=r.type,g=r.pendingProps,S=i!==null?i.memoizedProps:null,w=g.children,$d(h,g)?w=null:S!==null&&$d(h,S)&&(r.flags|=32),a0(i,r),an(i,r,w,c),r.child;case 6:return i===null&&Kd(r),null;case 13:return d0(i,r,c);case 4:return sf(r,r.stateNode.containerInfo),h=r.pendingProps,i===null?r.child=jr(r,null,h,c):an(i,r,h,c),r.child;case 11:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:ei(h,g),i0(i,r,h,g,c);case 7:return an(i,r,r.pendingProps,c),r.child;case 8:return an(i,r,r.pendingProps.children,c),r.child;case 12:return an(i,r,r.pendingProps.children,c),r.child;case 10:e:{if(h=r.type._context,g=r.pendingProps,S=r.memoizedProps,w=g.value,it(uc,h._currentValue),h._currentValue=w,S!==null)if(Qn(S.value,w)){if(S.children===g.children&&!mn.current){r=Ni(i,r,c);break e}}else for(S=r.child,S!==null&&(S.return=r);S!==null;){var b=S.dependencies;if(b!==null){w=S.child;for(var N=b.firstContext;N!==null;){if(N.context===h){if(S.tag===1){N=Oi(-1,c&-c),N.tag=2;var W=S.updateQueue;if(W!==null){W=W.shared;var le=W.pending;le===null?N.next=N:(N.next=le.next,le.next=N),W.pending=N}}S.lanes|=c,N=S.alternate,N!==null&&(N.lanes|=c),nf(S.return,c,r),b.lanes|=c;break}N=N.next}}else if(S.tag===10)w=S.type===r.type?null:S.child;else if(S.tag===18){if(w=S.return,w===null)throw Error(n(341));w.lanes|=c,b=w.alternate,b!==null&&(b.lanes|=c),nf(w,c,r),w=S.sibling}else w=S.child;if(w!==null)w.return=S;else for(w=S;w!==null;){if(w===r){w=null;break}if(S=w.sibling,S!==null){S.return=w.return,w=S;break}w=w.return}S=w}an(i,r,g.children,c),r=r.child}return r;case 9:return g=r.type,h=r.pendingProps.children,Xr(r,c),g=Fn(g),h=h(g),r.flags|=1,an(i,r,h,c),r.child;case 14:return h=r.type,g=ei(h,r.pendingProps),g=ei(h.type,g),o0(i,r,h,g,c);case 15:return r0(i,r,r.type,r.pendingProps,c);case 17:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:ei(h,g),Ac(i,r),r.tag=1,yn(h)?(i=!0,oc(r)):i=!1,Xr(r,c),Zm(r,h,g),Sf(r,h,g,c),wf(null,r,h,!0,i,c);case 19:return h0(i,r,c);case 22:return s0(i,r,c)}throw Error(n(156,r.tag))};function F0(i,r){return mg(i,r)}function R1(i,r,c,h){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Un(i,r,c,h){return new R1(i,r,c,h)}function Wf(i){return i=i.prototype,!(!i||!i.isReactComponent)}function M1(i){if(typeof i=="function")return Wf(i)?1:0;if(i!=null){if(i=i.$$typeof,i===ie)return 11;if(i===K)return 14}return 2}function To(i,r){var c=i.alternate;return c===null?(c=Un(i.tag,r,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=r,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&14680064,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,r=i.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c}function Oc(i,r,c,h,g,S){var w=2;if(h=i,typeof i=="function")Wf(i)&&(w=1);else if(typeof i=="string")w=5;else e:switch(i){case k:return er(c.children,g,S,r);case B:w=8,g|=8;break;case j:return i=Un(12,c,r,g|2),i.elementType=j,i.lanes=S,i;case ee:return i=Un(13,c,r,g),i.elementType=ee,i.lanes=S,i;case te:return i=Un(19,c,r,g),i.elementType=te,i.lanes=S,i;case ce:return Nc(c,g,S,r);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case Z:w=10;break e;case X:w=9;break e;case ie:w=11;break e;case K:w=14;break e;case ue:w=16,h=null;break e}throw Error(n(130,i==null?i:typeof i,""))}return r=Un(w,c,r,g),r.elementType=i,r.type=h,r.lanes=S,r}function er(i,r,c,h){return i=Un(7,i,h,r),i.lanes=c,i}function Nc(i,r,c,h){return i=Un(22,i,h,r),i.elementType=ce,i.lanes=c,i.stateNode={isHidden:!1},i}function Yf(i,r,c){return i=Un(6,i,null,r),i.lanes=c,i}function jf(i,r,c){return r=Un(4,i.children!==null?i.children:[],i.key,r),r.lanes=c,r.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},r}function k1(i,r,c,h,g){this.tag=r,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=yd(0),this.expirationTimes=yd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=yd(0),this.identifierPrefix=h,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function zf(i,r,c,h,g,S,w,b,N){return i=new k1(i,r,c,b,N),r===1?(r=1,S===!0&&(r|=8)):r=0,S=Un(3,null,null,r),i.current=S,S.stateNode=i,S.memoizedState={element:h,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},rf(S),i}function b1(i,r,c){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:P,key:h==null?null:""+h,children:i,containerInfo:r,implementation:c}}function L0(i){if(!i)return fo;i=i._reactInternals;e:{if($o(i)!==i||i.tag!==1)throw Error(n(170));var r=i;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(yn(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(i.tag===1){var c=i.type;if(yn(c))return fm(i,c,r)}return r}function x0(i,r,c,h,g,S,w,b,N){return i=zf(c,h,!0,i,g,S,w,b,N),i.context=L0(null),c=i.current,h=ln(),g=So(c),S=Oi(h,g),S.callback=r??null,go(c,S,g),i.current.lanes=g,Xs(i,g,h),In(i,h),i}function Bc(i,r,c,h){var g=r.current,S=ln(),w=So(g);return c=L0(c),r.context===null?r.context=c:r.pendingContext=c,r=Oi(S,w),r.payload={element:i},h=h===void 0?null:h,h!==null&&(r.callback=h),i=go(g,r,w),i!==null&&(ii(i,g,w,S),fc(i,g,w)),w}function Hc(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function U0(i,r){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<r?c:r}}function Xf(i,r){U0(i,r),(i=i.alternate)&&U0(i,r)}function D1(){return null}var G0=typeof reportError=="function"?reportError:function(i){console.error(i)};function Vf(i){this._internalRoot=i}Fc.prototype.render=Vf.prototype.render=function(i){var r=this._internalRoot;if(r===null)throw Error(n(409));Bc(i,r,null,null)},Fc.prototype.unmount=Vf.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var r=i.containerInfo;Ko(function(){Bc(null,i,null,null)}),r[Ri]=null}};function Fc(i){this._internalRoot=i}Fc.prototype.unstable_scheduleHydration=function(i){if(i){var r=Eg();i={blockedOn:null,target:i,priority:r};for(var c=0;c<so.length&&r!==0&&r<so[c].priority;c++);so.splice(c,0,i),c===0&&_g(i)}};function qf(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Lc(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function $0(){}function O1(i,r,c,h,g){if(g){if(typeof h=="function"){var S=h;h=function(){var W=Hc(w);S.call(W)}}var w=x0(r,h,i,0,null,!1,!1,"",$0);return i._reactRootContainer=w,i[Ri]=w.current,aa(i.nodeType===8?i.parentNode:i),Ko(),w}for(;g=i.lastChild;)i.removeChild(g);if(typeof h=="function"){var b=h;h=function(){var W=Hc(N);b.call(W)}}var N=zf(i,0,!1,null,null,!1,!1,"",$0);return i._reactRootContainer=N,i[Ri]=N.current,aa(i.nodeType===8?i.parentNode:i),Ko(function(){Bc(r,N,c,h)}),N}function xc(i,r,c,h,g){var S=c._reactRootContainer;if(S){var w=S;if(typeof g=="function"){var b=g;g=function(){var N=Hc(w);b.call(N)}}Bc(r,w,i,g)}else w=O1(c,r,i,g,h);return Hc(w)}Ag=function(i){switch(i.tag){case 3:var r=i.stateNode;if(r.current.memoizedState.isDehydrated){var c=zs(r.pendingLanes);c!==0&&(vd(r,c|1),In(r,wt()),(ze&6)===0&&(Qr=wt()+500,ho()))}break;case 13:Ko(function(){var h=Di(i,1);if(h!==null){var g=ln();ii(h,i,1,g)}}),Xf(i,1)}},Sd=function(i){if(i.tag===13){var r=Di(i,134217728);if(r!==null){var c=ln();ii(r,i,134217728,c)}Xf(i,134217728)}},wg=function(i){if(i.tag===13){var r=So(i),c=Di(i,r);if(c!==null){var h=ln();ii(c,i,r,h)}Xf(i,r)}},Eg=function(){return Ke},Cg=function(i,r){var c=Ke;try{return Ke=i,r()}finally{Ke=c}},dd=function(i,r,c){switch(r){case"input":if(At(i,c),r=c.name,c.type==="radio"&&r!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<c.length;r++){var h=c[r];if(h!==i&&h.form===i.form){var g=nc(h);if(!g)throw Error(n(90));q(h),At(h,g)}}}break;case"textarea":xs(i,c);break;case"select":r=c.value,r!=null&&Cn(i,!!c.multiple,r,!1)}},cg=Uf,ug=Ko;var N1={usingClientEntryPoint:!1,Events:[ua,xr,nc,ag,lg,Uf]},Ea={findFiberByHostInstance:Wo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},B1={bundleType:Ea.bundleType,version:Ea.version,rendererPackageName:Ea.rendererPackageName,rendererConfig:Ea.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:M.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=pg(i),i===null?null:i.stateNode},findFiberByHostInstance:Ea.findFiberByHostInstance||D1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Uc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Uc.isDisabled&&Uc.supportsFiber)try{Fl=Uc.inject(B1),di=Uc}catch{}}return Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N1,Tn.createPortal=function(i,r){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!qf(r))throw Error(n(200));return b1(i,r,null,c)},Tn.createRoot=function(i,r){if(!qf(i))throw Error(n(299));var c=!1,h="",g=G0;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(g=r.onRecoverableError)),r=zf(i,1,!1,null,null,c,!1,h,g),i[Ri]=r.current,aa(i.nodeType===8?i.parentNode:i),new Vf(r)},Tn.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var r=i._reactInternals;if(r===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=pg(r),i=i===null?null:i.stateNode,i},Tn.flushSync=function(i){return Ko(i)},Tn.hydrate=function(i,r,c){if(!Lc(r))throw Error(n(200));return xc(null,i,r,!0,c)},Tn.hydrateRoot=function(i,r,c){if(!qf(i))throw Error(n(405));var h=c!=null&&c.hydratedSources||null,g=!1,S="",w=G0;if(c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(S=c.identifierPrefix),c.onRecoverableError!==void 0&&(w=c.onRecoverableError)),r=x0(r,null,i,1,c??null,g,!1,S,w),i[Ri]=r.current,aa(i),h)for(i=0;i<h.length;i++)c=h[i],g=c._getVersion,g=g(c._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[c,g]:r.mutableSourceEagerHydrationData.push(c,g);return new Fc(r)},Tn.render=function(i,r,c){if(!Lc(r))throw Error(n(200));return xc(null,i,r,!1,c)},Tn.unmountComponentAtNode=function(i){if(!Lc(i))throw Error(n(40));return i._reactRootContainer?(Ko(function(){xc(null,null,i,!1,function(){i._reactRootContainer=null,i[Ri]=null})}),!0):!1},Tn.unstable_batchedUpdates=Uf,Tn.unstable_renderSubtreeIntoContainer=function(i,r,c,h){if(!Lc(c))throw Error(n(200));if(i==null||i._reactInternals===void 0)throw Error(n(38));return xc(i,r,c,!1,h)},Tn.version="18.3.1-next-f1338f8080-20240426",Tn}var Z0;function j1(){if(Z0)return Qf.exports;Z0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Qf.exports=Y1(),Qf.exports}var K0;function z1(){if(K0)return Gc;K0=1;var e=j1();return Gc.createRoot=e.createRoot,Gc.hydrateRoot=e.hydrateRoot,Gc}var X1=z1();const V1=Zv(X1);class q1{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let o=this.length++;for(;o>0;){const s=o-1>>1,a=this.values[s];if(n>=a)break;this.ids[o]=this.ids[s],this.values[o]=a,o=s}this.ids[o]=t,this.values[o]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],o=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let l=(a<<1)+1;const u=l+1;let d=this.ids[l],f=this.values[l];const p=this.values[u];if(u<this.length&&p<f&&(l=u,d=this.ids[u],f=p),f>=o)break;this.ids[a]=d,this.values[a]=f,a=l}this.ids[a]=n,this.values[a]=o}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Q0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],th=3;class ap{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[o,s]=new Uint8Array(t,n+0,2);if(o!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==th)throw new Error(`Got v${a} data when expected v${th}.`);const l=Q0[s&15];if(!l)throw new Error("Unrecognized array type.");const[u]=new Uint16Array(t,n+2,1),[d]=new Uint32Array(t,n+4,1);return new ap(d,u,l,void 0,t,n)}constructor(t,n=16,o=Float64Array,s=ArrayBuffer,a,l=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=l;let u=t,d=u;this._levelBounds=[u*4];do u=Math.ceil(u/this.nodeSize),d+=u,this._levelBounds.push(d*4);while(u!==1);this.ArrayType=o,this.IndexArrayType=d<16384?Uint16Array:Uint32Array;const f=Q0.indexOf(this.ArrayType),p=d*4*this.ArrayType.BYTES_PER_ELEMENT;if(f<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,l+8,d*4),this._indices=new this.IndexArrayType(this.data,l+8+p,d),this._pos=d*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+p+d*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,d*4),this._indices=new this.IndexArrayType(this.data,8+p,d),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(th<<4)+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new q1}add(t,n,o=t,s=n){const a=this._pos>>2,l=this._boxes;return this._indices[a]=a,l[this._pos++]=t,l[this._pos++]=n,l[this._pos++]=o,l[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),o>this.maxX&&(this.maxX=o),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,o=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let l=0,u=0;l<this.numItems;l++){const d=t[u++],f=t[u++],p=t[u++],m=t[u++],v=Math.floor(a*((d+p)/2-this.minX)/n),y=Math.floor(a*((f+m)/2-this.minY)/o);s[l]=K1(v,y)}Oh(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let l=0,u=0;l<this._levelBounds.length-1;l++){const d=this._levelBounds[l];for(;u<d;){const f=u;let p=t[u++],m=t[u++],v=t[u++],y=t[u++];for(let I=1;I<this.nodeSize&&u<d;I++)p=Math.min(p,t[u++]),m=Math.min(m,t[u++]),v=Math.max(v,t[u++]),y=Math.max(y,t[u++]);this._indices[this._pos>>2]=f,t[this._pos++]=p,t[this._pos++]=m,t[this._pos++]=v,t[this._pos++]=y}}}search(t,n,o,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const u=[],d=[];for(;l!==void 0;){const f=Math.min(l+this.nodeSize*4,ey(l,this._levelBounds));for(let p=l;p<f;p+=4){if(o<this._boxes[p]||s<this._boxes[p+1]||t>this._boxes[p+2]||n>this._boxes[p+3])continue;const m=this._indices[p>>2]|0;l>=this.numItems*4?u.push(m):(a===void 0||a(m))&&d.push(m)}l=u.pop()}return d}neighbors(t,n,o=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const u=this._queue,d=[],f=s*s;e:for(;l!==void 0;){const p=Math.min(l+this.nodeSize*4,ey(l,this._levelBounds));for(let m=l;m<p;m+=4){const v=this._indices[m>>2]|0,y=J0(t,this._boxes[m],this._boxes[m+2]),I=J0(n,this._boxes[m+1],this._boxes[m+3]),T=y*y+I*I;T>f||(l>=this.numItems*4?u.push(v<<1,T):(a===void 0||a(v))&&u.push((v<<1)+1,T))}for(;u.length&&u.peek()&1;)if(u.peekValue()>f||(d.push(u.pop()>>1),d.length===o))break e;l=u.length?u.pop()>>1:void 0}return u.clear(),d}}function J0(e,t,n){return e<t?t-e:e<=n?0:e-n}function ey(e,t){let n=0,o=t.length-1;for(;n<o;){const s=n+o>>1;t[s]>e?o=s:n=s+1}return t[n]}function Oh(e,t,n,o,s,a){if(Math.floor(o/a)>=Math.floor(s/a))return;const l=e[o+s>>1];let u=o-1,d=s+1;for(;;){do u++;while(e[u]<l);do d--;while(e[d]>l);if(u>=d)break;Z1(e,t,n,u,d)}Oh(e,t,n,o,d,a),Oh(e,t,n,d+1,s,a)}function Z1(e,t,n,o,s){const a=e[o];e[o]=e[s],e[s]=a;const l=4*o,u=4*s,d=t[l],f=t[l+1],p=t[l+2],m=t[l+3];t[l]=t[u],t[l+1]=t[u+1],t[l+2]=t[u+2],t[l+3]=t[u+3],t[u]=d,t[u+1]=f,t[u+2]=p,t[u+3]=m;const v=n[o];n[o]=n[s],n[s]=v}function K1(e,t){let n=e^t,o=65535^n,s=65535^(e|t),a=e&(t^65535),l=n|o>>1,u=n>>1^n,d=s>>1^o&a>>1^s,f=n&s>>1^a>>1^a;n=l,o=u,s=d,a=f,l=n&n>>2^o&o>>2,u=n&o>>2^o&(n^o)>>2,d^=n&s>>2^o&a>>2,f^=o&s>>2^(n^o)&a>>2,n=l,o=u,s=d,a=f,l=n&n>>4^o&o>>4,u=n&o>>4^o&(n^o)>>4,d^=n&s>>4^o&a>>4,f^=o&s>>4^(n^o)&a>>4,n=l,o=u,s=d,a=f,d^=n&s>>8^o&a>>8,f^=o&s>>8^(n^o)&a>>8,n=d^d>>1,o=f^f>>1;let p=e^t,m=o|65535^(p|n);return p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|p)>>>0}function Qi(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Q1(e,t){e.x+=t.x,e.y+=t.y}function J1(e,t){e.x*=t,e.y*=t}function ty(e,t,n){e.x+=t.x*n,e.y+=t.y*n}function Kv(e,t){return{x:e.x-t.x,y:e.y-t.y}}function nt(e,t){return{x:e.x*t,y:e.y*t}}function ms(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function Tt(e){const t=ms(e);return t===0?{x:0,y:0}:nt(e,1/t)}function qn(e,t){return ms(Kv(e,t))}function hu(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function ny(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,o)=>({x:n.x+o.x,y:n.y+o.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Ue(e,t,n,o){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>o/2&&(a=a-Math.sign(a)*o),{x:s,y:a}}function jt(e,t,n){const o=Ue(e,t,n.width,n.height);return Tt(o)}function Q(e,t,n,o){const s=Ue(e,t,n,o);return ms(s)}function Pt(e,t,n,o){const s=Ue(e,t,n,o);return s.x*s.x+s.y*s.y}function ew(e,t){return e.x*t.x+e.y*t.y}function tw(e,t){const n=ew(e,t),o=ms(e),s=ms(t);if(o===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(o*s)));return Math.acos(a)}function pu(e,t){const n=Math.cos(t),o=Math.sin(t);return{x:e.x*n-e.y*o,y:e.x*o+e.y*n}}function nw(e,t){return t.split(".").reduce((n,o)=>{if(n&&typeof n=="object"&&o in n)return n[o]},e)}function Li(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],at:()=>{},byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new ap(e.length),o=new Map,s=new Map;let a=0;const l=new Uint32Array(e.length);for(let d=0;d<e.length;d++){const f=e[d];f.width!==void 0&&f.height!==void 0?n.add(f.position.x,f.position.y,f.position.x+f.width,f.position.y+f.height):n.add(f.position.x,f.position.y,f.position.x,f.position.y)}return n.finish(),{all(){return e},byRect(d){const{width:f,height:p}=t,m=[];a++;const v=[];d.left<0?(v.push({left:d.left+f,right:f}),v.push({left:0,right:d.right})):d.right>f?(v.push({left:d.left,right:f}),v.push({left:0,right:d.right-f})):v.push({left:d.left,right:d.right});const y=[];d.top<0?(y.push({top:d.top+p,bottom:p}),y.push({top:0,bottom:d.bottom})):d.bottom>p?(y.push({top:d.top,bottom:p}),y.push({top:0,bottom:d.bottom-p})):y.push({top:d.top,bottom:d.bottom});for(let I=0;I<v.length;I++){const T=v[I];for(let A=0;A<y.length;A++){const R=y[A],_=n.search(T.left,R.top,T.right,R.bottom);for(let C=0;C<_.length;C++){const M=_[C];l[M]!==a&&(l[M]=a,m.push(e[M]))}}}return m},byRadius(d,f){const{width:p,height:m}=t,v=[];a++;const y=f*f,I=d.x-f,T=d.x+f,A=d.y-f,R=d.y+f,_=[];I<0?(_.push({left:I+p,right:p}),_.push({left:0,right:T})):T>p?(_.push({left:I,right:p}),_.push({left:0,right:T-p})):_.push({left:I,right:T});const C=[];A<0?(C.push({top:A+m,bottom:m}),C.push({top:0,bottom:R})):R>m?(C.push({top:A,bottom:m}),C.push({top:0,bottom:R-m})):C.push({top:A,bottom:R});for(let M=0;M<_.length;M++){const E=_[M];for(let P=0;P<C.length;P++){const k=C[P],B=n.search(E.left,k.top,E.right,k.bottom);for(let j=0;j<B.length;j++){const Z=B[j];if(l[Z]!==a){l[Z]=a;const X=e[Z];Pt(d,X.position,p,m)<=y&&v.push(X)}}}}return v},at(d,f){return this.byRadius(d,f)[0]},byProperty(d,f){var p;if(!o.has(d)){const m=new Map;for(let v=0;v<e.length;v++){const y=e[v],I=y[d];m.has(I)||m.set(I,[]),m.get(I).push(y)}o.set(d,m)}return((p=o.get(d))==null?void 0:p.get(f))||[]},byPropertyPath(d,f){var p;if(!s.has(d)){const m=new Map;for(let v=0;v<e.length;v++){const y=e[v],I=nw(y,d);m.has(I)||m.set(I,[]),m.get(I).push(y)}s.set(d,m)}return((p=s.get(d))==null?void 0:p.get(f))||[]},resetPropertyCache(){o.clear(),s.clear()},count(){return e.length}}}function wl(e){var m,v;const t=e.entities.entities,n=[],o=[],s=[],a=[],l=[],u=[],d=[];for(const y in t){const I=t[y];switch(I.type){case"human":n.push(I);break;case"berryBush":o.push(I);break;case"corpse":s.push(I);break;case"prey":a.push(I);break;case"predator":l.push(I);break;case"building":u.push(I);break;case"tree":d.push(I);break}}const f=e.mapDimensions;return{...e,search:{human:Li(n,f),berryBush:Li(o,f),corpse:Li(s,f),prey:Li(a,f),predator:Li(l,f),building:Li(u,f),tree:Li(d,f),tasks:((m=e.search)==null?void 0:m.tasks)??Li([],f)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((v=e.cache)==null?void 0:v.tribeCenters)??{}}}}function iw(e){const t=[];for(const n in e.tasks)t.push(e.tasks[n]);e.search.tasks=Li(t,e.mapDimensions)}const hs=80,Xt=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],ge=20,$={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire",Palisade:"palisade",Gate:"gate"},ow=.5,rw="#FFA500",sw="#FF4500",iy=4,aw=10,lp=60,ft={[$.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{},territoryRadius:hs},[$.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{},territoryRadius:hs},[$.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2},territoryRadius:lp},[$.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5},territoryRadius:hs},[$.Palisade]:{name:"Palisade",description:"A defensive wall segment that blocks movement.",icon:"",dimensions:{width:20,height:20},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:1},territoryRadius:0},[$.Gate]:{name:"Gate",description:"A gate that allows passage for tribe members.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.4,destructionTimeHours:.2,cost:{wood:3},territoryRadius:0}};function cp(e){return ft[e].dimensions}function lw(e){return ft[e].constructionTimeHours}function cw(e){return ft[e].destructionTimeHours}function lr(e){return ft[e].territoryRadius}const Qv=5;function uw(){return ft[$.PlantingZone].dimensions}function oy(e,t,n){const o=e.position.x+n.width/2,a=t.position.x-n.width/2-o,l=e.position.y-n.height/2,u=e.position.y+n.height/2,d=t.position.y-n.height/2,f=t.position.y+n.height/2,p=Math.min(u,f)-Math.max(l,d);return a>=-5&&a<=Qv&&p>n.height*.5}function ry(e,t,n){const o=e.position.y+n.height/2,a=t.position.y-n.height/2-o,l=e.position.x-n.width/2,u=e.position.x+n.width/2,d=t.position.x-n.width/2,f=t.position.x+n.width/2,p=Math.min(u,f)-Math.max(l,d);return a>=-5&&a<=Qv&&p>n.width*.5}function dw(e){var l;const t={},n=uw(),o=e;if(!((l=o.search)!=null&&l.building))return t;const a=o.search.building.all().filter(u=>u.buildingType===$.PlantingZone&&u.isConstructed);for(const u of a)t[u.id]={top:!1,bottom:!1,left:!1,right:!1};for(let u=0;u<a.length;u++){const d=a[u];for(let f=u+1;f<a.length;f++){const p=a[f];d.ownerId===p.ownerId&&(oy(d,p,n)&&(t[d.id].right=!0,t[p.id].left=!0),oy(p,d,n)&&(t[p.id].right=!0,t[d.id].left=!0),ry(d,p,n)&&(t[d.id].bottom=!0,t[p.id].top=!0),ry(p,d,n)&&(t[p.id].bottom=!0,t[d.id].top=!0))}}return t}function al(e){e.plantingZoneConnections=dw(e)}var ir=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(ir||{});class fw{constructor(){xt(this,"worker",null);xt(this,"pendingRequests",new Map);xt(this,"requestQueue",[]);xt(this,"isProcessing",!1);xt(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case ir.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case ir.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case ir.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,o)=>{if(!this.worker){o(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:o});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),o(s)}})}queueOperation(t){return new Promise((n,o)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){o(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),o=t,s={type:ir.SAVE_REQUEST,id:n,gameState:o};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:ir.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:ir.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const up=new fw;async function dp(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,tribeModalOpen:e.tribeModalOpen,cameraFollowingPlayer:e.cameraFollowingPlayer,cameraZoom:e.cameraZoom,isDraggingMinimap:e.isDraggingMinimap,minimapDragDistance:e.minimapDragDistance,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,strategicMenuOpen:e.strategicMenuOpen,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks,navigationGrid:e.navigationGrid,pathfindingQueue:e.pathfindingQueue,isDraggingViewport:e.isDraggingViewport,viewportDragButton:e.viewportDragButton,viewportDragDistance:e.viewportDragDistance};await up.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function hw(){try{const e=await up.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=wl(t);return al(n),n}catch(e){return console.error("Failed to load game:",e),await Jv(),null}}async function Jv(){try{await up.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const eS=ne.createContext(void 0),pw=({initialAppState:e,children:t})=>{const[n,o]=ne.useState(e),[s,a]=ne.useState(void 0),[l,u]=ne.useState(null),[d,f]=ne.useState(!1);ne.useEffect(()=>{hw().then(I=>{I&&u(I),f(!0)})},[]);const p=(I,T)=>{o(I),I==="gameOver"&&T?a(T):I!=="gameOver"&&a(void 0)},m=()=>{o("intro"),a(void 0),y()},v=I=>{dp(I),u(I)},y=()=>{Jv(),u(null)};return G.jsx(eS.Provider,{value:{appState:n,setAppState:p,returnToIntro:m,gameOverDetails:s,contextReady:d,savedGameState:l,setSavedGameState:u,saveCurrentGame:v,clearCurrentSave:y},children:t})},_i=()=>{const e=ne.useContext(eS);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var on=function(){return on=Object.assign||function(t){for(var n,o=1,s=arguments.length;o<s;o++){n=arguments[o];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},on.apply(this,arguments)};function ll(e,t,n){if(n||arguments.length===2)for(var o=0,s=t.length,a;o<s;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))}var ut="-ms-",qa="-moz-",qe="-webkit-",tS="comm",Bu="rule",fp="decl",gw="@import",nS="@keyframes",mw="@layer",iS=Math.abs,hp=String.fromCharCode,Nh=Object.assign;function yw(e,t){return Ut(e,0)^45?(((t<<2^Ut(e,0))<<2^Ut(e,1))<<2^Ut(e,2))<<2^Ut(e,3):0}function oS(e){return e.trim()}function Ui(e,t){return(e=t.exec(e))?e[0]:e}function Ge(e,t,n){return e.replace(t,n)}function iu(e,t,n){return e.indexOf(t,n)}function Ut(e,t){return e.charCodeAt(t)|0}function ys(e,t,n){return e.slice(t,n)}function Ai(e){return e.length}function rS(e){return e.length}function $a(e,t){return t.push(e),e}function vw(e,t){return e.map(t).join("")}function sy(e,t){return e.filter(function(n){return!Ui(n,t)})}var Hu=1,vs=1,sS=0,Zn=0,Mt=0,Ds="";function Fu(e,t,n,o,s,a,l,u){return{value:e,root:t,parent:n,type:o,props:s,children:a,line:Hu,column:vs,length:l,return:"",siblings:u}}function Po(e,t){return Nh(Fu("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function es(e){for(;e.root;)e=Po(e.root,{children:[e]});$a(e,e.siblings)}function Sw(){return Mt}function Iw(){return Mt=Zn>0?Ut(Ds,--Zn):0,vs--,Mt===10&&(vs=1,Hu--),Mt}function si(){return Mt=Zn<sS?Ut(Ds,Zn++):0,vs++,Mt===10&&(vs=1,Hu++),Mt}function cr(){return Ut(Ds,Zn)}function ou(){return Zn}function Lu(e,t){return ys(Ds,e,t)}function Bh(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Tw(e){return Hu=vs=1,sS=Ai(Ds=e),Zn=0,[]}function Aw(e){return Ds="",e}function nh(e){return oS(Lu(Zn-1,Hh(e===91?e+2:e===40?e+1:e)))}function ww(e){for(;(Mt=cr())&&Mt<33;)si();return Bh(e)>2||Bh(Mt)>3?"":" "}function Ew(e,t){for(;--t&&si()&&!(Mt<48||Mt>102||Mt>57&&Mt<65||Mt>70&&Mt<97););return Lu(e,ou()+(t<6&&cr()==32&&si()==32))}function Hh(e){for(;si();)switch(Mt){case e:return Zn;case 34:case 39:e!==34&&e!==39&&Hh(Mt);break;case 40:e===41&&Hh(e);break;case 92:si();break}return Zn}function Cw(e,t){for(;si()&&e+Mt!==57;)if(e+Mt===84&&cr()===47)break;return"/*"+Lu(t,Zn-1)+"*"+hp(e===47?e:si())}function Pw(e){for(;!Bh(cr());)si();return Lu(e,Zn)}function _w(e){return Aw(ru("",null,null,null,[""],e=Tw(e),0,[0],e))}function ru(e,t,n,o,s,a,l,u,d){for(var f=0,p=0,m=l,v=0,y=0,I=0,T=1,A=1,R=1,_=0,C="",M=s,E=a,P=o,k=C;A;)switch(I=_,_=si()){case 40:if(I!=108&&Ut(k,m-1)==58){iu(k+=Ge(nh(_),"&","&\f"),"&\f",iS(f?u[f-1]:0))!=-1&&(R=-1);break}case 34:case 39:case 91:k+=nh(_);break;case 9:case 10:case 13:case 32:k+=ww(I);break;case 92:k+=Ew(ou()-1,7);continue;case 47:switch(cr()){case 42:case 47:$a(Rw(Cw(si(),ou()),t,n,d),d);break;default:k+="/"}break;case 123*T:u[f++]=Ai(k)*R;case 125*T:case 59:case 0:switch(_){case 0:case 125:A=0;case 59+p:R==-1&&(k=Ge(k,/\f/g,"")),y>0&&Ai(k)-m&&$a(y>32?ly(k+";",o,n,m-1,d):ly(Ge(k," ","")+";",o,n,m-2,d),d);break;case 59:k+=";";default:if($a(P=ay(k,t,n,f,p,s,u,C,M=[],E=[],m,a),a),_===123)if(p===0)ru(k,t,P,P,M,a,m,u,E);else switch(v===99&&Ut(k,3)===110?100:v){case 100:case 108:case 109:case 115:ru(e,P,P,o&&$a(ay(e,P,P,0,0,s,u,C,s,M=[],m,E),E),s,E,m,u,o?M:E);break;default:ru(k,P,P,P,[""],E,0,u,E)}}f=p=y=0,T=R=1,C=k="",m=l;break;case 58:m=1+Ai(k),y=I;default:if(T<1){if(_==123)--T;else if(_==125&&T++==0&&Iw()==125)continue}switch(k+=hp(_),_*T){case 38:R=p>0?1:(k+="\f",-1);break;case 44:u[f++]=(Ai(k)-1)*R,R=1;break;case 64:cr()===45&&(k+=nh(si())),v=cr(),p=m=Ai(C=k+=Pw(ou())),_++;break;case 45:I===45&&Ai(k)==2&&(T=0)}}return a}function ay(e,t,n,o,s,a,l,u,d,f,p,m){for(var v=s-1,y=s===0?a:[""],I=rS(y),T=0,A=0,R=0;T<o;++T)for(var _=0,C=ys(e,v+1,v=iS(A=l[T])),M=e;_<I;++_)(M=oS(A>0?y[_]+" "+C:Ge(C,/&\f/g,y[_])))&&(d[R++]=M);return Fu(e,t,n,s===0?Bu:u,d,f,p,m)}function Rw(e,t,n,o){return Fu(e,t,n,tS,hp(Sw()),ys(e,2,-2),0,o)}function ly(e,t,n,o,s){return Fu(e,t,n,fp,ys(e,0,o),ys(e,o+1,-1),o,s)}function aS(e,t,n){switch(yw(e,t)){case 5103:return qe+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return qe+e+e;case 4789:return qa+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return qe+e+qa+e+ut+e+e;case 5936:switch(Ut(e,t+11)){case 114:return qe+e+ut+Ge(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return qe+e+ut+Ge(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return qe+e+ut+Ge(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return qe+e+ut+e+e;case 6165:return qe+e+ut+"flex-"+e+e;case 5187:return qe+e+Ge(e,/(\w+).+(:[^]+)/,qe+"box-$1$2"+ut+"flex-$1$2")+e;case 5443:return qe+e+ut+"flex-item-"+Ge(e,/flex-|-self/g,"")+(Ui(e,/flex-|baseline/)?"":ut+"grid-row-"+Ge(e,/flex-|-self/g,""))+e;case 4675:return qe+e+ut+"flex-line-pack"+Ge(e,/align-content|flex-|-self/g,"")+e;case 5548:return qe+e+ut+Ge(e,"shrink","negative")+e;case 5292:return qe+e+ut+Ge(e,"basis","preferred-size")+e;case 6060:return qe+"box-"+Ge(e,"-grow","")+qe+e+ut+Ge(e,"grow","positive")+e;case 4554:return qe+Ge(e,/([^-])(transform)/g,"$1"+qe+"$2")+e;case 6187:return Ge(Ge(Ge(e,/(zoom-|grab)/,qe+"$1"),/(image-set)/,qe+"$1"),e,"")+e;case 5495:case 3959:return Ge(e,/(image-set\([^]*)/,qe+"$1$`$1");case 4968:return Ge(Ge(e,/(.+:)(flex-)?(.*)/,qe+"box-pack:$3"+ut+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+qe+e+e;case 4200:if(!Ui(e,/flex-|baseline/))return ut+"grid-column-align"+ys(e,t)+e;break;case 2592:case 3360:return ut+Ge(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(o,s){return t=s,Ui(o.props,/grid-\w+-end/)})?~iu(e+(n=n[t].value),"span",0)?e:ut+Ge(e,"-start","")+e+ut+"grid-row-span:"+(~iu(n,"span",0)?Ui(n,/\d+/):+Ui(n,/\d+/)-+Ui(e,/\d+/))+";":ut+Ge(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(o){return Ui(o.props,/grid-\w+-start/)})?e:ut+Ge(Ge(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return Ge(e,/(.+)-inline(.+)/,qe+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ai(e)-1-t>6)switch(Ut(e,t+1)){case 109:if(Ut(e,t+4)!==45)break;case 102:return Ge(e,/(.+:)(.+)-([^]+)/,"$1"+qe+"$2-$3$1"+qa+(Ut(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~iu(e,"stretch",0)?aS(Ge(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return Ge(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(o,s,a,l,u,d,f){return ut+s+":"+a+f+(l?ut+s+"-span:"+(u?d:+d-+a)+f:"")+e});case 4949:if(Ut(e,t+6)===121)return Ge(e,":",":"+qe)+e;break;case 6444:switch(Ut(e,Ut(e,14)===45?18:11)){case 120:return Ge(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+qe+(Ut(e,14)===45?"inline-":"")+"box$3$1"+qe+"$2$3$1"+ut+"$2box$3")+e;case 100:return Ge(e,":",":"+ut)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Ge(e,"scroll-","scroll-snap-")+e}return e}function gu(e,t){for(var n="",o=0;o<e.length;o++)n+=t(e[o],o,e,t)||"";return n}function Mw(e,t,n,o){switch(e.type){case mw:if(e.children.length)break;case gw:case fp:return e.return=e.return||e.value;case tS:return"";case nS:return e.return=e.value+"{"+gu(e.children,o)+"}";case Bu:if(!Ai(e.value=e.props.join(",")))return""}return Ai(n=gu(e.children,o))?e.return=e.value+"{"+n+"}":""}function kw(e){var t=rS(e);return function(n,o,s,a){for(var l="",u=0;u<t;u++)l+=e[u](n,o,s,a)||"";return l}}function bw(e){return function(t){t.root||(t=t.return)&&e(t)}}function Dw(e,t,n,o){if(e.length>-1&&!e.return)switch(e.type){case fp:e.return=aS(e.value,e.length,n);return;case nS:return gu([Po(e,{value:Ge(e.value,"@","@"+qe)})],o);case Bu:if(e.length)return vw(n=e.props,function(s){switch(Ui(s,o=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":es(Po(e,{props:[Ge(s,/:(read-\w+)/,":"+qa+"$1")]})),es(Po(e,{props:[s]})),Nh(e,{props:sy(n,o)});break;case"::placeholder":es(Po(e,{props:[Ge(s,/:(plac\w+)/,":"+qe+"input-$1")]})),es(Po(e,{props:[Ge(s,/:(plac\w+)/,":"+qa+"$1")]})),es(Po(e,{props:[Ge(s,/:(plac\w+)/,ut+"input-$1")]})),es(Po(e,{props:[s]})),Nh(e,{props:sy(n,o)});break}return""})}}var Ow={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},bn={},Ss=typeof process<"u"&&bn!==void 0&&(bn.REACT_APP_SC_ATTR||bn.SC_ATTR)||"data-styled",lS="active",cS="data-styled-version",xu="6.1.13",pp=`/*!sc*/
`,mu=typeof window<"u"&&"HTMLElement"in window,Nw=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&bn!==void 0&&bn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&bn.REACT_APP_SC_DISABLE_SPEEDY!==""?bn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&bn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&bn!==void 0&&bn.SC_DISABLE_SPEEDY!==void 0&&bn.SC_DISABLE_SPEEDY!==""&&bn.SC_DISABLE_SPEEDY!=="false"&&bn.SC_DISABLE_SPEEDY),Bw={},Uu=Object.freeze([]),Is=Object.freeze({});function uS(e,t,n){return n===void 0&&(n=Is),e.theme!==n.theme&&e.theme||t||n.theme}var dS=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),Hw=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Fw=/(^-|-$)/g;function cy(e){return e.replace(Hw,"-").replace(Fw,"")}var Lw=/(a)(d)/gi,$c=52,uy=function(e){return String.fromCharCode(e+(e>25?39:97))};function Fh(e){var t,n="";for(t=Math.abs(e);t>$c;t=t/$c|0)n=uy(t%$c)+n;return(uy(t%$c)+n).replace(Lw,"$1-$2")}var ih,fS=5381,ss=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},hS=function(e){return ss(fS,e)};function pS(e){return Fh(hS(e)>>>0)}function xw(e){return e.displayName||e.name||"Component"}function oh(e){return typeof e=="string"&&!0}var gS=typeof Symbol=="function"&&Symbol.for,mS=gS?Symbol.for("react.memo"):60115,Uw=gS?Symbol.for("react.forward_ref"):60112,Gw={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},$w={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},yS={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Ww=((ih={})[Uw]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},ih[mS]=yS,ih);function dy(e){return("type"in(t=e)&&t.type.$$typeof)===mS?yS:"$$typeof"in e?Ww[e.$$typeof]:Gw;var t}var Yw=Object.defineProperty,jw=Object.getOwnPropertyNames,fy=Object.getOwnPropertySymbols,zw=Object.getOwnPropertyDescriptor,Xw=Object.getPrototypeOf,hy=Object.prototype;function vS(e,t,n){if(typeof t!="string"){if(hy){var o=Xw(t);o&&o!==hy&&vS(e,o,n)}var s=jw(t);fy&&(s=s.concat(fy(t)));for(var a=dy(e),l=dy(t),u=0;u<s.length;++u){var d=s[u];if(!(d in $w||n&&n[d]||l&&d in l||a&&d in a)){var f=zw(t,d);try{Yw(e,d,f)}catch{}}}}return e}function Ts(e){return typeof e=="function"}function gp(e){return typeof e=="object"&&"styledComponentId"in e}function rr(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function Lh(e,t){if(e.length===0)return"";for(var n=e[0],o=1;o<e.length;o++)n+=e[o];return n}function cl(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function xh(e,t,n){if(n===void 0&&(n=!1),!n&&!cl(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var o=0;o<t.length;o++)e[o]=xh(e[o],t[o]);else if(cl(t))for(var o in t)e[o]=xh(e[o],t[o]);return e}function mp(e,t){Object.defineProperty(e,"toString",{value:t})}function El(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var Vw=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,o=0;o<t;o++)n+=this.groupSizes[o];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var o=this.groupSizes,s=o.length,a=s;t>=a;)if((a<<=1)<0)throw El(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(o),this.length=a;for(var l=s;l<a;l++)this.groupSizes[l]=0}for(var u=this.indexOfGroup(t+1),d=(l=0,n.length);l<d;l++)this.tag.insertRule(u,n[l])&&(this.groupSizes[t]++,u++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],o=this.indexOfGroup(t),s=o+n;this.groupSizes[t]=0;for(var a=o;a<s;a++)this.tag.deleteRule(o)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var o=this.groupSizes[t],s=this.indexOfGroup(t),a=s+o,l=s;l<a;l++)n+="".concat(this.tag.getRule(l)).concat(pp);return n},e}(),su=new Map,yu=new Map,au=1,Wc=function(e){if(su.has(e))return su.get(e);for(;yu.has(au);)au++;var t=au++;return su.set(e,t),yu.set(t,e),t},qw=function(e,t){au=t+1,su.set(e,t),yu.set(t,e)},Zw="style[".concat(Ss,"][").concat(cS,'="').concat(xu,'"]'),Kw=new RegExp("^".concat(Ss,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Qw=function(e,t,n){for(var o,s=n.split(","),a=0,l=s.length;a<l;a++)(o=s[a])&&e.registerName(t,o)},Jw=function(e,t){for(var n,o=((n=t.textContent)!==null&&n!==void 0?n:"").split(pp),s=[],a=0,l=o.length;a<l;a++){var u=o[a].trim();if(u){var d=u.match(Kw);if(d){var f=0|parseInt(d[1],10),p=d[2];f!==0&&(qw(p,f),Qw(e,p,d[3]),e.getTag().insertRules(f,s)),s.length=0}else s.push(u)}}},py=function(e){for(var t=document.querySelectorAll(Zw),n=0,o=t.length;n<o;n++){var s=t[n];s&&s.getAttribute(Ss)!==lS&&(Jw(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function eE(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var SS=function(e){var t=document.head,n=e||t,o=document.createElement("style"),s=function(u){var d=Array.from(u.querySelectorAll("style[".concat(Ss,"]")));return d[d.length-1]}(n),a=s!==void 0?s.nextSibling:null;o.setAttribute(Ss,lS),o.setAttribute(cS,xu);var l=eE();return l&&o.setAttribute("nonce",l),n.insertBefore(o,a),o},tE=function(){function e(t){this.element=SS(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var o=document.styleSheets,s=0,a=o.length;s<a;s++){var l=o[s];if(l.ownerNode===n)return l}throw El(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),nE=function(){function e(t){this.element=SS(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var o=document.createTextNode(n);return this.element.insertBefore(o,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),iE=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),gy=mu,oE={isServer:!mu,useCSSOMInjection:!Nw},vu=function(){function e(t,n,o){t===void 0&&(t=Is),n===void 0&&(n={});var s=this;this.options=on(on({},oE),t),this.gs=n,this.names=new Map(o),this.server=!!t.isServer,!this.server&&mu&&gy&&(gy=!1,py(this)),mp(this,function(){return function(a){for(var l=a.getTag(),u=l.length,d="",f=function(m){var v=function(R){return yu.get(R)}(m);if(v===void 0)return"continue";var y=a.names.get(v),I=l.getGroup(m);if(y===void 0||!y.size||I.length===0)return"continue";var T="".concat(Ss,".g").concat(m,'[id="').concat(v,'"]'),A="";y!==void 0&&y.forEach(function(R){R.length>0&&(A+="".concat(R,","))}),d+="".concat(I).concat(T,'{content:"').concat(A,'"}').concat(pp)},p=0;p<u;p++)f(p);return d}(s)})}return e.registerId=function(t){return Wc(t)},e.prototype.rehydrate=function(){!this.server&&mu&&py(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(on(on({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var o=n.useCSSOMInjection,s=n.target;return n.isServer?new iE(s):o?new tE(s):new nE(s)}(this.options),new Vw(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(Wc(t),this.names.has(t))this.names.get(t).add(n);else{var o=new Set;o.add(n),this.names.set(t,o)}},e.prototype.insertRules=function(t,n,o){this.registerName(t,n),this.getTag().insertRules(Wc(t),o)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(Wc(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),rE=/&/g,sE=/^\s*\/\/.*$/gm;function IS(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(o){return"".concat(t," ").concat(o)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=IS(n.children,t)),n})}function aE(e){var t,n,o,s=Is,a=s.options,l=a===void 0?Is:a,u=s.plugins,d=u===void 0?Uu:u,f=function(v,y,I){return I.startsWith(n)&&I.endsWith(n)&&I.replaceAll(n,"").length>0?".".concat(t):v},p=d.slice();p.push(function(v){v.type===Bu&&v.value.includes("&")&&(v.props[0]=v.props[0].replace(rE,n).replace(o,f))}),l.prefix&&p.push(Dw),p.push(Mw);var m=function(v,y,I,T){y===void 0&&(y=""),I===void 0&&(I=""),T===void 0&&(T="&"),t=T,n=y,o=new RegExp("\\".concat(n,"\\b"),"g");var A=v.replace(sE,""),R=_w(I||y?"".concat(I," ").concat(y," { ").concat(A," }"):A);l.namespace&&(R=IS(R,l.namespace));var _=[];return gu(R,kw(p.concat(bw(function(C){return _.push(C)})))),_};return m.hash=d.length?d.reduce(function(v,y){return y.name||El(15),ss(v,y.name)},fS).toString():"",m}var lE=new vu,Uh=aE(),TS=wi.createContext({shouldForwardProp:void 0,styleSheet:lE,stylis:Uh});TS.Consumer;wi.createContext(void 0);function Gh(){return ne.useContext(TS)}var cE=function(){function e(t,n){var o=this;this.inject=function(s,a){a===void 0&&(a=Uh);var l=o.name+a.hash;s.hasNameForId(o.id,l)||s.insertRules(o.id,l,a(o.rules,l,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,mp(this,function(){throw El(12,String(o.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Uh),this.name+t.hash},e}(),uE=function(e){return e>="A"&&e<="Z"};function my(e){for(var t="",n=0;n<e.length;n++){var o=e[n];if(n===1&&o==="-"&&e[0]==="-")return e;uE(o)?t+="-"+o.toLowerCase():t+=o}return t.startsWith("ms-")?"-"+t:t}var AS=function(e){return e==null||e===!1||e===""},wS=function(e){var t,n,o=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!AS(a)&&(Array.isArray(a)&&a.isCss||Ts(a)?o.push("".concat(my(s),":"),a,";"):cl(a)?o.push.apply(o,ll(ll(["".concat(s," {")],wS(a),!1),["}"],!1)):o.push("".concat(my(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in Ow||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return o};function Bo(e,t,n,o){if(AS(e))return[];if(gp(e))return[".".concat(e.styledComponentId)];if(Ts(e)){if(!Ts(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return Bo(s,t,n,o)}var a;return e instanceof cE?n?(e.inject(n,o),[e.getName(o)]):[e]:cl(e)?wS(e):Array.isArray(e)?Array.prototype.concat.apply(Uu,e.map(function(l){return Bo(l,t,n,o)})):[e.toString()]}function ES(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(Ts(n)&&!gp(n))return!1}return!0}var dE=hS(xu),fE=function(){function e(t,n,o){this.rules=t,this.staticRulesId="",this.isStatic=(o===void 0||o.isStatic)&&ES(t),this.componentId=n,this.baseHash=ss(dE,n),this.baseStyle=o,vu.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,o){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,o):"";if(this.isStatic&&!o.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=rr(s,this.staticRulesId);else{var a=Lh(Bo(this.rules,t,n,o)),l=Fh(ss(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,l)){var u=o(a,".".concat(l),void 0,this.componentId);n.insertRules(this.componentId,l,u)}s=rr(s,l),this.staticRulesId=l}else{for(var d=ss(this.baseHash,o.hash),f="",p=0;p<this.rules.length;p++){var m=this.rules[p];if(typeof m=="string")f+=m;else if(m){var v=Lh(Bo(m,t,n,o));d=ss(d,v+p),f+=v}}if(f){var y=Fh(d>>>0);n.hasNameForId(this.componentId,y)||n.insertRules(this.componentId,y,o(f,".".concat(y),void 0,this.componentId)),s=rr(s,y)}}return s},e}(),yp=wi.createContext(void 0);yp.Consumer;var rh={};function hE(e,t,n){var o=gp(e),s=e,a=!oh(e),l=t.attrs,u=l===void 0?Uu:l,d=t.componentId,f=d===void 0?function(M,E){var P=typeof M!="string"?"sc":cy(M);rh[P]=(rh[P]||0)+1;var k="".concat(P,"-").concat(pS(xu+P+rh[P]));return E?"".concat(E,"-").concat(k):k}(t.displayName,t.parentComponentId):d,p=t.displayName,m=p===void 0?function(M){return oh(M)?"styled.".concat(M):"Styled(".concat(xw(M),")")}(e):p,v=t.displayName&&t.componentId?"".concat(cy(t.displayName),"-").concat(t.componentId):t.componentId||f,y=o&&s.attrs?s.attrs.concat(u).filter(Boolean):u,I=t.shouldForwardProp;if(o&&s.shouldForwardProp){var T=s.shouldForwardProp;if(t.shouldForwardProp){var A=t.shouldForwardProp;I=function(M,E){return T(M,E)&&A(M,E)}}else I=T}var R=new fE(n,v,o?s.componentStyle:void 0);function _(M,E){return function(P,k,B){var j=P.attrs,Z=P.componentStyle,X=P.defaultProps,ie=P.foldedComponentIds,ee=P.styledComponentId,te=P.target,K=wi.useContext(yp),ue=Gh(),ce=P.shouldForwardProp||ue.shouldForwardProp,Y=uS(k,K,X)||Is,J=function(re,oe,me){for(var F,ae=on(on({},oe),{className:void 0,theme:me}),ye=0;ye<re.length;ye+=1){var Se=Ts(F=re[ye])?F(ae):F;for(var q in Se)ae[q]=q==="className"?rr(ae[q],Se[q]):q==="style"?on(on({},ae[q]),Se[q]):Se[q]}return oe.className&&(ae.className=rr(ae.className,oe.className)),ae}(j,k,Y),V=J.as||te,D={};for(var L in J)J[L]===void 0||L[0]==="$"||L==="as"||L==="theme"&&J.theme===Y||(L==="forwardedAs"?D.as=J.forwardedAs:ce&&!ce(L,V)||(D[L]=J[L]));var fe=function(re,oe){var me=Gh(),F=re.generateAndInjectStyles(oe,me.styleSheet,me.stylis);return F}(Z,J),pe=rr(ie,ee);return fe&&(pe+=" "+fe),J.className&&(pe+=" "+J.className),D[oh(V)&&!dS.has(V)?"class":"className"]=pe,D.ref=B,ne.createElement(V,D)}(C,M,E)}_.displayName=m;var C=wi.forwardRef(_);return C.attrs=y,C.componentStyle=R,C.displayName=m,C.shouldForwardProp=I,C.foldedComponentIds=o?rr(s.foldedComponentIds,s.styledComponentId):"",C.styledComponentId=v,C.target=o?s.target:e,Object.defineProperty(C,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(M){this._foldedDefaultProps=o?function(E){for(var P=[],k=1;k<arguments.length;k++)P[k-1]=arguments[k];for(var B=0,j=P;B<j.length;B++)xh(E,j[B],!0);return E}({},s.defaultProps,M):M}}),mp(C,function(){return".".concat(C.styledComponentId)}),a&&vS(C,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),C}function yy(e,t){for(var n=[e[0]],o=0,s=t.length;o<s;o+=1)n.push(t[o],e[o+1]);return n}var vy=function(e){return Object.assign(e,{isCss:!0})};function CS(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Ts(e)||cl(e))return vy(Bo(yy(Uu,ll([e],t,!0))));var o=e;return t.length===0&&o.length===1&&typeof o[0]=="string"?Bo(o):vy(Bo(yy(o,t)))}function $h(e,t,n){if(n===void 0&&(n=Is),!t)throw El(1,t);var o=function(s){for(var a=[],l=1;l<arguments.length;l++)a[l-1]=arguments[l];return e(t,n,CS.apply(void 0,ll([s],a,!1)))};return o.attrs=function(s){return $h(e,t,on(on({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},o.withConfig=function(s){return $h(e,t,on(on({},n),s))},o}var PS=function(e){return $h(hE,e)},Be=PS;dS.forEach(function(e){Be[e]=PS(e)});var pE=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=ES(t),vu.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,o,s){var a=s(Lh(Bo(this.rules,n,o,s)),""),l=this.componentId+t;o.insertRules(l,l,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,o,s){t>2&&vu.registerId(this.componentId+t),this.removeStyles(t,o),this.createStyles(t,n,o,s)},e}();function gE(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=CS.apply(void 0,ll([e],t,!1)),s="sc-global-".concat(pS(JSON.stringify(o))),a=new pE(o,s),l=function(d){var f=Gh(),p=wi.useContext(yp),m=wi.useRef(f.styleSheet.allocateGSInstance(s)).current;return f.styleSheet.server&&u(m,d,f.styleSheet,p,f.stylis),wi.useLayoutEffect(function(){if(!f.styleSheet.server)return u(m,d,f.styleSheet,p,f.stylis),function(){return a.removeStyles(m,f.styleSheet)}},[m,d,f.styleSheet,p,f.stylis]),null};function u(d,f,p,m,v){if(a.isStatic)a.renderStyles(d,Bw,p,v);else{var y=on(on({},f),{theme:uS(f,m,l.defaultProps)});a.renderStyles(d,y,p,v)}}return wi.memo(l)}function vp(e,t){t===void 0&&(t=!0);var n=ne.useRef(null),o=ne.useRef(!1),s=ne.useRef(e);s.current=e;var a=ne.useCallback(function(u){o.current&&(s.current(u),n.current=requestAnimationFrame(a))},[]),l=ne.useMemo(function(){return[function(){o.current&&(o.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){o.current||(o.current=!0,n.current=requestAnimationFrame(a))},function(){return o.current}]},[]);return ne.useEffect(function(){return t&&l[1](),l[0]},[]),l}function mE(e,t,n,o,s){var l;(l=e.onExit)==null||l.call(e,o,t);const a=s.find(({id:u})=>u===t);return a!=null&&a.onEnter?a.onEnter(o,n):{...n,enteredAt:o.updateContext.gameState.time}}function yE(e,t){return t.find(({id:n})=>n===e)}function vE(e,t){return e!==t}function SE(e){e&&console.warn(`No handler found for state: ${e}`)}const Za="bushGrowing",or="bushFull",lu="bushSpreading",ul="bushDying",Bt=24,Gt=10,Ye=4e3,je=4e3,Su=5,IE=15,TE=5e3,ji=100,zi=20,Xi=60,Vi=200,_S=200,AE=1e3,wE=5,EE=3,CE=12,PE=940,Wh=20,Sy=90,RS=100,vr=5,_E=.5,Gu=30,qi=.1,Wa=.9,RE=2,ME=2;var ci=(e=>(e.Berry="berry",e.Meat="meat",e))(ci||{});const Sp={berry:"",meat:""};function MS(e,t){return e+t*65536}function kS(e){return{gridX:e%65536,gridY:Math.floor(e/65536)}}function kE(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function Ip(){return{lastUpdateTime:0,sectors:{}}}const zt=20,Iu=100,bS=20,DS=0,bE=20,DE=1,OS=.15,OE=.5,NE=.01,BE=24,HE="#6B5344",FE="#4A3728",Iy=.85,NS=35,LE=30,Ty=1.25,Yh=40,Ka=Math.PI/6,BS=.5,xE=1,$u=10,dl=80,HS=3,Pa=5,rn=150,FS=rn*.8,UE=rn*.2,zn=rn*.8,Ho=30,LS=10,GE=10,$E=.5,et=30,xS=et*.75,Wu=30,US=Wu*.75,GS=50,WE=20,YE=dl*.8,jE=.7,Tu=16,Tp=40,Ap=16,zE=72/3,Ay=24,XE=1.25,VE=1.5,wy=rn*.6,$S=50,qE=1,wp=dl*.65,ZE=80,KE=50,QE=1,JE=128,WS=10,Ey=100,Ep=35,Fo=30,Yu=.5,Cl=2.5,Cp=20,En=250,Pp=.4,_p=150,Rp=6,eC=5,Mp=2,ju=.5,zu=1.5,tC=1,nC=.5,iC=.5,oC=1.5,rC=.25,sC=2.5,aC=45,lC=.05;var Nt=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(Nt||{}),Ze=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e))(Ze||{}),Sr=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(Sr||{});const Au=24,cC=24;let uC=0;function dC(){return`notification-${Date.now()}-${uC++}`}function fl(e,t){if(t.identifier){const o=e.notifications.find(s=>s.identifier===t.identifier);if(o){if(o.dismissedUntil&&e.time<o.dismissedUntil)return;o.message=t.message,o.timestamp=e.time,o.creationTime=Date.now(),o.duration=t.duration,o.targetEntityIds=t.targetEntityIds,o.highlightedEntityIds=t.highlightedEntityIds,o.targetPosition=t.targetPosition,o.targetArea=t.targetArea,o.targetRadius=t.targetRadius,o.isDismissed=!1,o.dismissedUntil=void 0;return}}const n={...t,id:dC(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function fC(e,t){const n=e.notifications.find(o=>o.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+cC))}function hC(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function pC(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const o of n.highlightedEntityIds){const s=e.entities.entities[o];s&&(s.isHighlighted=!0)}}function YS(e,t,n,o){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,l={x:Math.cos(s)*a,y:Math.sin(s)*a},u=Qi(e,l);return{x:(u.x%n+n)%n,y:(u.y%o+o)%o}}function Ji(e,t,n,o){const s=t,{width:a,height:l}=t.mapDimensions,u={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},d=f=>{for(let p=0;p<f.length;p++){const m=f[p];if(o!==void 0&&m.id===o)continue;const v=Pt(e,m.position,a,l),y=n+m.radius;if(v<y*y)return!0}return!1};return d(s.search.human.byRect(u))||d(s.search.berryBush.byRect(u))||d(s.search.corpse.byRect(u))||d(s.search.tree.byRect(u))}function gC(e,t,n,o,s){const a=t.mapDimensions.width,l=t.mapDimensions.height;if(!Ji(e,t,o,s)&&!Er(t.soilDepletion,e,a,l))return e;const u=o;for(let d=u;d<=n;d+=u){const f=Math.ceil(2*Math.PI*d/u);for(let p=0;p<f;p++){const m=p/f*2*Math.PI,v={x:Math.cos(m)*d,y:Math.sin(m)*d},y=Qi(e,v),I={x:(y.x%a+a)%a,y:(y.y%l+l)%l};if(!Ji(I,t,o,s)&&!Er(t.soilDepletion,I,a,l))return I}}return null}function Ei(e,t){var l,u;const n=t;if((u=(l=n.cache)==null?void 0:l.tribeCenters)!=null&&u[e])return n.cache.tribeCenters[e];const o=t.search.building.byProperty("ownerId",e);if(o.length>0){const d=o.map(f=>f.position);return n.cache.tribeCenters[e]=ny(d)}const s=Lo(e,t);if(s.length===0){const d=t.entities.entities[e];return n.cache.tribeCenters[e]=d?d.position:{x:0,y:0}}const a=s.map(d=>d.position);return n.cache.tribeCenters[e]=ny(a)}function Cy(e,t,n){const o=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,l=e.y-t.position.y;return Math.abs(a)>o/2&&(a-=Math.sign(a)*o),Math.abs(l)>s/2&&(l-=Math.sign(l)*s),Math.abs(a)<=t.width/2&&Math.abs(l)<=t.height/2}const ui=(e,t,n)=>{var u,d,f,p;if(!e||!t||e===t)return!1;const o=n.entities.entities[e],s=n.entities.entities[t],a=(d=(u=o==null?void 0:o.tribeControl)==null?void 0:u.diplomacy)==null?void 0:d[t],l=(p=(f=s==null?void 0:s.tribeControl)==null?void 0:f.diplomacy)==null?void 0:p[e];return a===Nt.Hostile||l===Nt.Hostile},Pl=(e,t,n)=>e.id===t.id?!1:ui(e.leaderId,t.leaderId,n),Ir=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:ui(e.leaderId,t.ownerId,n),Os=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=zn||t.hunger>=zn||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||Pl(e,t,n))return!1;const o=e.gender==="female"?e:t;return!(o.isPregnant||o.age>Tp)},Py=1,jh=150*.6,mC=800,yC=3,_y=24,vC=1.5,Ry=.15,My=200,sh=30*.75*1.2,SC=20,ah=800,IC=.7,TC=.5,AC=10,lh=400,wC=800,EC=8,CC=16,_l=100,PC=100,jS=150,ky=600,by=250,_C=.5,RC=.7,MC=300,kC=150,bC=.4,As=100,zS=500,hl=10;function DC(e){const t=Math.floor(e.x/ge),n=Math.floor(e.y/ge);return{x:t,y:n}}function Tr(e,t){const n=Math.ceil(t/ge),o=e%n*ge+ge/2,s=Math.floor(e/n)*ge+ge/2;return{x:o,y:s}}function XS(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(o/ge),l=Math.floor(s/ge),u=Math.ceil(t/ge);return l*u+a}function ai(e,t,n){const o=XS({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[o]||null}function kp(e,t){return t.terrainOwnership.includes(e)}function VS(e,t,n,o){var l;const s=n;return(l=s.search)!=null&&l.human?s.search.human.byRadius(e,o).some(u=>ui(t,u.leaderId,n)):!1}function OC(e,t,n,o,s=!1,a){if(s&&a&&VS(e,a,o,jS))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:l,height:u}=o.mapDimensions,d=Math.ceil(l/ge),f=Math.ceil(u/ge),p=Math.ceil(t/ge),m=t*t,v=Math.floor(e.x/ge),y=Math.floor(e.y/ge);let I=!1,T=!1;for(let A=-p;A<=p;A++)for(let R=-p;R<=p;R++){const _=((v+R)%d+d)%d,C=((y+A)%f+f)%f,M=_*ge+ge/2,E=C*ge+ge/2;if(Pt(e,{x:M,y:E},l,u)<=m){const k=C*d+_,B=o.terrainOwnership[k];if(B===n)I=!0;else if(B!==null){if(s&&a&&ui(a,B,o))continue;T=!0}}}return T?{valid:!1,reason:"Position overlaps with another tribe's territory"}:I?{valid:!0}:kp(n,o)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function qS(e,t,n,o){if(!kp(n,o))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(VS(e,n,o,jS))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=o.mapDimensions,l=Math.ceil(s/ge),u=Math.ceil(a/ge),d=Math.ceil(t/ge),f=t*t,p=Math.floor(e.x/ge),m=Math.floor(e.y/ge);let v=!1;for(let y=-d;y<=d;y++){for(let I=-d;I<=d;I++){const T=((p+I)%l+l)%l,A=((m+y)%u+u)%u,R=T*ge+ge/2,_=A*ge+ge/2;if(Pt(e,{x:R,y:_},s,a)<=f){const M=A*l+T;if(o.terrainOwnership[M]===n){v=!0;break}}}if(v)break}return v?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function NC(e,t,n,o=0,s=!1,a){if(o>0){const u=OC(e,o,t,n,s,a);return u.valid?{canPlace:!0}:{canPlace:!1,reason:u.reason}}const l=ai(e.x,e.y,n);return l===null||l===t?{canPlace:!0}:s&&a&&ui(a,l,n)?{canPlace:!0}:l!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function _r(e,t,n){const o=ai(e.x,e.y,n);return o===null||o===t||!ui(t,o,n)}function ZS(e,t,n,o,{allowOverwrite:s,ignoreBuildingId:a}){const{width:l,height:u}=o.mapDimensions,d=o;let f=[];if(d.search&&d.search.building){const E=t+100;f=d.search.building.byRadius(e,E).filter(k=>k.id===a||!k.isConstructed||!k.ownerId?!1:ui(n,k.ownerId,o))}const p=Math.ceil(l/ge),m=Math.ceil(u/ge),v=Math.ceil(t/ge),y=Math.floor(e.x/ge),I=Math.floor(e.y/ge);for(let E=-v;E<=v;E++)for(let P=-v;P<=v;P++){const k=((y+P)%p+p)%p,B=((I+E)%m+m)%m,j=k*ge+ge/2,Z=B*ge+ge/2;let X=!1;for(const ee of f)if(Pt({x:j,y:Z},ee.position,l,u)<ee.radius*ee.radius){X=!0;break}if(X)continue;if(Q(e,{x:j,y:Z},l,u)<=t){const ee=B*p+k,te=o.terrainOwnership[ee];(s||te===null||te===n)&&(o.terrainOwnership[ee]=n)}}const T=3,A=v+T+2,R=[];for(let E=-A;E<=A;E++)for(let P=-A;P<=A;P++){const k=((y+P)%p+p)%p,B=((I+E)%m+m)%m,j=B*p+k;if(o.terrainOwnership[j]===null){let Z=!1;const X=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const ie of X){let ee=!1,te=!1;for(let K=1;K<=T;K++){const ue=((k+ie.x*K)%p+p)%p,Y=((B+ie.y*K)%m+m)%m*p+ue;if(o.terrainOwnership[Y]===n){ee=!0;break}}if(ee)for(let K=1;K<=T;K++){const ue=((k-ie.x*K)%p+p)%p,Y=((B-ie.y*K)%m+m)%m*p+ue;if(o.terrainOwnership[Y]===n){te=!0;break}}if(ee&&te){Z=!0;break}}Z&&R.push(j)}}for(const E of R)o.terrainOwnership[E]=n;const _=250,C=new Set;for(let E=-A;E<=A;E++)for(let P=-A;P<=A;P++){const k=((y+P)%p+p)%p,j=((I+E)%m+m)%m*p+k;if(o.terrainOwnership[j]===null&&!C.has(j)){const Z=[],X=[j];C.add(j),Z.push(j);let ie=!0,ee=0;for(;ee<X.length;){const te=X[ee++];if(Z.length>_){ie=!1;break}const K=te%p,ue=Math.floor(te/p),ce=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:Y,ny:J}of ce){const V=((K+Y)%p+p)%p,L=((ue+J)%m+m)%m*p+V;o.terrainOwnership[L]===null&&!C.has(L)&&(C.add(L),ie&&(Z.push(L),X.push(L)))}}if(ie&&Z.length<=_)for(const te of Z)o.terrainOwnership[te]=n}}const M=[];for(let E=-A;E<=A;E++)for(let P=-A;P<=A;P++){const k=((y+P)%p+p)%p,B=((I+E)%m+m)%m,j=B*p+k;if(o.terrainOwnership[j]===null){let Z=0;for(let X=-1;X<=1;X++)for(let ie=-1;ie<=1;ie++){if(ie===0&&X===0)continue;const ee=((k+ie)%p+p)%p,K=((B+X)%m+m)%m*p+ee;o.terrainOwnership[K]===n&&Z++}Z>=5&&M.push(j)}}for(const E of M)o.terrainOwnership[E]=n}function ps(e,t,n,o){ZS(e,t,n,o,{allowOverwrite:!1})}function KS(e,t,n,o,s){ZS(e,t,n,o,{allowOverwrite:!0,ignoreBuildingId:s})}function wu(e,t,n){const o=e.terrainOwnership;for(let s=0;s<o.length;s++)o[s]===t&&(o[s]=n)}function Je(e,t,n,o,s){const a=t,l=o,u="position"in e&&e.id?e:null,d=u?u.position:e,f=a.search[n].byRadius(d,l);let p=null,m=l;for(const v of f){if(v.id===(u==null?void 0:u.id)||s&&!s(v))continue;const y=Q(d,v.position,t.mapDimensions.width,t.mapDimensions.height);y<m&&(m=y,p=v)}return p}function kt(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function BC(e,t){var l;const o=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const u of o){if(u.attackTargetId!==e)continue;const d=Q(u.position,((l=t.entities.entities[e])==null?void 0:l.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);d<a&&(s=u,a=d)}return s}function QS(e){return e.search.human.all()}function HC(e,t,n){const{width:o,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const l of a){const u=Q(e,l.position,o,s),d=l.type==="tree"?l.radius*2:l.radius;if(u<d)return l}}function FC(e,t,n,o,s){const{width:a,height:l}=o.mapDimensions,u=n*n;if(s){for(let v=0;v<s.length;v++)if(Pt(e,s[v],a,l)<u)return!0;return!1}const d=QS(o),f=new Set;for(let v=0;v<d.length;v++){const y=d[v];y.leaderId&&y.leaderId!==t&&f.add(y.leaderId)}const p=f.values();let m=p.next();for(;!m.done;){const v=m.value,y=Ei(v,o);if(Pt(e,y,a,l)<u)return!0;m=p.next()}return!1}var Te=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e[e.Fire=17]="Fire",e[e.Smoke=18]="Smoke",e))(Te||{});function Le(e,t,n,o,s,a,l,u){const d={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:o,entityId:a,intensity:s,targetPosition:l,targetEntityId:u};return e.visualEffects.push(d),e.nextVisualEffectId++,d.id}const Ve=1,pl=3,Wi=100,JS=20,ur=10,LC=.5,Qa=150,xC=25,UC=.5,zh=100,eI=25,GC=.5,$C=15,Xh=4,WC=.75,YC=15,jC=8,zC=20;function Ar(e,t,n,o,s,a){if(n===void 0)return!1;const{width:l,height:u}=o.mapDimensions;if(s&&a!==void 0&&Pt(s,e,l,u)>a*a)return!1;const d=cp(t),f=Math.sqrt(d.width*d.width+d.height*d.height)/2;if(Ji(e,o,f*.8))return!1;if(t===$.PlantingZone){const{depletedSectors:I}=II(o.soilDepletion,e,d.width,d.height,l,u);if(I.length>0)return!1}const p=o,m=p.search.building.byRadius(e,f*2);for(const I of m){const T=Pt(e,I.position,l,u),A=(Math.max(d.width,d.height)+Math.max(I.width,I.height))/2;if(T<A*A*.81)return!1}if(t===$.BorderPost){const I=lp,T=p.search.building.byRadius(e,I+100);for(const A of T)if(A.isConstructed&&A.ownerId&&ui(n,A.ownerId,o)){const R=Pt(e,A.position,l,u),_=I+A.radius;if(R<_*_)return!1}}const v=lr(t);return!!NC(e,n,o,v,t===$.BorderPost,n).canPlace}function XC(e){const t=[],n=2*Math.PI/e;for(let o=0;o<e;o++){const s=o*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function cu(e,t,n,o,s,a,l){const u=performance.now(),d=n,f=cp(e),p=n.mapDimensions.width,m=n.mapDimensions.height,v=d.search.building.byProperty("ownerId",t),y=[];if(v.length>0){a&&y.unshift(a);const _=Ei(t,n),C=[...v].sort((M,E)=>{const P=Pt(M.position,_,p,m),k=Pt(E.position,_,p,m);return P-k});y.push(...C.map(M=>M.position))}else y.push(Ei(t,n));const I=Math.min(y.length,EC),T=Math.max(f.width,f.height),A=T+20,R=T/2;for(let _=0;_<I;_++){const C=y[_];for(let M=A;M<=o;M+=R){const E=Math.max(8,Math.min(CC,Math.ceil(2*Math.PI*M/T))),P=XC(E);for(let k=0;k<E;k++){const B=P[k].cos*M,j=P[k].sin*M,Z=C.x+B,X=C.y+j,ie=(Z%p+p)%p,ee=(X%m+m)%m;if(!FC({x:ie,y:ee},t,s,n,l)&&Ar({x:ie,y:ee},e,t,n))return performance.now()-u,{x:ie,y:ee}}}}performance.now()-u}function bp(e,t,n,o){if(t===$.BorderPost)return KS(e,lp,n,o),Le(o,Te.BorderClaim,e,Ve,n),null;const s=fT(o.entities,e,t,n);return t===$.Bonfire&&(s.storageCapacity=Xh,s.storedItems=[]),ps(e,lr(t),n,o),t===$.PlantingZone&&al(o),(t===$.Palisade||t===$.Gate)&&(o.buildingVersion=(o.buildingVersion??0)+1),s}function Vh(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===$.PlantingZone&&al(t))}function VC(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let l=e.x-a.position.x,u=e.y-a.position.y;const d=t.mapDimensions.width,f=t.mapDimensions.height;if(Math.abs(l)>d/2&&(l-=Math.sign(l)*d),Math.abs(u)>f/2&&(u-=Math.sign(u)*f),Math.abs(l)<=a.width/2&&Math.abs(u)<=a.height/2)return a}}const ht=30,Ns=ht*.6,tI="#4CAF50",nI="#FF5722",iI="#9C27B0",qC="#2196F3",oI="#FFC107",ZC="#DC143C",Dp="#FFFFFF",Op=[5,5],Xu=5,ws=15,KC=20,QC=16,JC=10,eP=16,tP=16,Eu=["","","","","","","","","",""],Ja=8,nP="#FFFFFF",It=18,Re=15,iP="rgba(0, 0, 0, 0.7)",oP=4,wo=150,kn=15,Hi=10,bo="#555",rP="#f44336",sP="#4CAF50",aP="#2196F3",lP="#FFC107",Yc=16,Gi=32,jc=28,cP=10,uP=8,dP=8,fP=8,tr=28,_a=40,Ra=10,Dy=8,hP=11,ch=40,Oy=5,pP=10,gP="#FFA500",mP="#808080",Yi=120,Cu=30,yP=20,gn="#2d3748",dt="#ffffff",jn="#4a5568",rI=5,Np="#bdc9f792",sI="#272c36ff",Bp="#a0aec0",Pu=300,aI="rgba(255, 255, 255, 0.5)",vP="rgba(0, 0, 0, 0.8)",SP="#FFFFFF",Ny=14,By=8,Hy=-15,_u="#FFD700",lI=5,IP="rgba(0, 0, 0, 0.5)",TP="#FFFFFF",AP=33,wP=400,EP=20,CP=10,PP="rgba(0, 0, 0, 0.7)",_P="#FFFFFF",uh=20,Fy=16,RP=.5,Ly=5,cI="#FFD700",MP=40,Hp=4,uI=3,kP=5,dI=20,fI=5,bP="#FFFFFF",DP="#FF6B6B",qh=80,OP=10,zc=300,nr=15,NP=8,BP="rgba(0, 0, 0, 0.8)",HP="#FFFFFF",dh=14,xy=10,mi=20,FP="#FF6B6B",LP="#4CAF50",Uy="#FFD700",xP="rgba(255, 255, 0, 0.3)",UP=2,GP=500,$P=120,WP=45,YP="#FFD700",jP=3,zP=4,fh=225,Gy=20,XP="#666",VP="#1a2a3a";let hh=0;function Ru(){const e=Eu[hh];return hh=(hh+1)%Eu.length,e}function Es(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),o=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(o),t.length>0)return t[0];if(n.sort(o),n.length>0)return n[0]}function eo(e,t){const n=e,o=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...o,...s]}function Zh(e,t){var a,l,u,d;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(l=t.partnerIds)!=null&&l.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,o=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((u=e.ancestorIds)==null?void 0:u.some(f=>t.ancestorIds.includes(f)))||((d=t.ancestorIds)==null?void 0:d.some(f=>e.ancestorIds.includes(f)));return n||o||s}function hI(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const o=t.entities.entities[n];if(o&&o.gender==="male")return o}return null}function $y(e,t){var n;if(!e.isAdult){if(e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human")return o}if(e.motherId){const o=t.entities.entities[e.motherId];if(o&&o.type==="human")return o}}if(e.isAdult&&e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human"&&((n=Es(eo(t,o)))==null?void 0:n.id)===e.id)return o}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?hI(e,t):null}function qP(e,t){let n=e;const o=new Set;o.add(n.id);for(let s=0;s<HS;s++){let a=null;if(n.gender==="female"&&(a=hI(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||o.has(a.id))break;n=a,o.add(n.id)}return n}function ZP(e,t){var o;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(o=e.partnerIds)==null||o.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),eo(t,e).forEach(s=>n.add(s)),Array.from(n)}function Mu(e,t){const n=new Map;function o(s){const a=eo(t,s);for(const l of a)n.has(l.id)||(n.set(l.id,l),o(l))}return o(e),Array.from(n.values())}function Lo(e,t){return t.search.human.byProperty("leaderId",e)}function ku(e,t,n=new Map,o=new Set){var a;if(n.has(e))return n.get(e);if(o.has(e))return e;o.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const l=s.partnerIds.find(u=>{const d=t.entities.entities[u];return d&&d.gender==="male"});if(l){const u=ku(l,t,n,o);return n.set(e,u),u}}if(s.fatherId&&t.entities.entities[s.fatherId]){const l=ku(s.fatherId,t,n,o);return n.set(e,l),l}return n.set(e,e),e}function KP(e,t){e.leaderId=e.id,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{diplomacy:{}}),e.tribeInfo||(e.tribeInfo={tribeBadge:Ru(),tribeColor:Xt[Math.floor(Math.random()*Xt.length)]}),e.tribeControl||(e.tribeControl={diplomacy:{}})}function QP(e,t){if(e.length===0)return null;const n=new Map,o=new Map;for(const l of e){const u=ku(l.id,t,n);o.has(u)||o.set(u,[]),o.get(u).push(l)}let s=null,a=0;for(const[l,u]of o.entries())u.length>a&&(a=u.length,s=l);return s&&t.entities.entities[s]||null}function Vu(e,t){var p,m,v;const n=new Map;for(let y=0;y<e.terrainOwnership.length;y++){const I=e.terrainOwnership[y];I!==null&&(n.has(I)||n.set(I,[]),n.get(I).push(y))}const{width:o,height:s}=e.mapDimensions,a=Math.ceil(o/ge),l=new Map,u=Object.values(e.entities.entities).filter(y=>y.type==="human");for(const y of u)y.leaderId&&(l.has(y.leaderId)||l.set(y.leaderId,{leaderId:y.leaderId,tribeInfo:y.tribeInfo,members:[]}),(p=l.get(y.leaderId))==null||p.members.push(y));const d=t?(v=(m=e.entities.entities[t])==null?void 0:m.tribeControl)==null?void 0:v.diplomacy:void 0,f=Array.from(l.values()).map(y=>{var C,M;const I=e.entities.entities[y.leaderId],T=y.members.filter(E=>E.isAdult).length,A=y.members.length-T,R=n.get(y.leaderId)||[];let _=I==null?void 0:I.position;if(R.length>0){const E=R[0],P=E%a*ge,k=Math.floor(E/a)*ge,B={x:P,y:k};let j=0,Z=0;for(const ee of R){const te=ee%a*ge,K=Math.floor(ee/a)*ge,ue=Ue(B,{x:te,y:K},o,s);j+=ue.x,Z+=ue.y}const X=j/R.length,ie=Z/R.length;_={x:((B.x+X)%o+o)%o,y:((B.y+ie)%s+s)%s}}return{leaderId:y.leaderId,tribeBadge:((C=y==null?void 0:y.tribeInfo)==null?void 0:C.tribeBadge)||"",tribeColor:((M=y==null?void 0:y.tribeInfo)==null?void 0:M.tribeColor)||"",adultCount:T,childCount:A,isPlayerTribe:y.leaderId===t,leaderAge:(I==null?void 0:I.age)??0,leaderGender:(I==null?void 0:I.gender)??"male",diplomacyStatus:(d==null?void 0:d[y.leaderId??-1])??Nt.Friendly,territoryCenter:_}});return f.sort((y,I)=>y.isPlayerTribe?-1:I.isPlayerTribe?1:I.adultCount+I.childCount-(y.adultCount+y.childCount)),f}function pI(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function gI(e){var a;const t=new Set,o=e.search.human.all(),s=new Map;for(const l of o)l.leaderId&&(s.has(l.leaderId)||s.set(l.leaderId,[]),(a=s.get(l.leaderId))==null||a.push(l));for(const[l,u]of s){if(u.length===0)continue;const d=e.entities.entities[l],f=!d,p=d&&d.leaderId!==l;(f||p)&&t.add(l)}for(let l=0;l<e.terrainOwnership.length;l++){const u=e.terrainOwnership[l];u!==null&&!s.has(u)&&t.add(u)}return Array.from(t)}function JP(e,t){const n=new Map,s=t.search.human.all(),a=ZP(e,t);for(const u of a)n.set(u,3);for(const u of s)u.id===e.id||n.has(u)||Zh(e,u)&&n.set(u,2);const l=Array.from(n.keys());for(const u of l)if(u.partnerIds)for(const d of u.partnerIds){const f=t.entities.entities[d];f&&!n.has(f)&&f.id!==e.id&&n.set(f,1)}return n}function e_(e,t){const n=Lo(e,t);if(n.length===0)return null;const o=t.entities.entities[e];if(o&&o.leaderId&&o.leaderId!==o.id)return o.leaderId;const s=new Map;for(const u of n){const d=JP(u,t);for(const[f,p]of d)if(f.leaderId&&f.leaderId!==e){const m=f.leaderId,v=t.entities.entities[m];if(v&&v.leaderId===v.id){const y=s.get(m)||0;s.set(m,y+p)}}}let a=null,l=0;for(const[u,d]of s)d>l&&(l=d,a=u);return a}function Wy(e,t,n){var p,m;const o=Lo(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=o.length>0?(p=o[0].tribeInfo)==null?void 0:p.tribeBadge:"?",l=s.leaderId===e||!s.leaderId;if(l){const v=n.entities.entities[e];KP(s,v)}const u=((m=s.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const v of o)v.id!==t&&(v.leaderId=t,v.tribeInfo=s.tribeInfo);const f=n.search.building.byProperty("ownerId",e);for(const v of f)v.ownerId=t;wu(n,e,t),fl(n,{identifier:`tribe-merge-${e}`,type:Sr.TribeMerged,message:l?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${u}!`,duration:Au,targetEntityIds:[t],highlightedEntityIds:[t,...o.map(v=>v.id)]})}function t_(e){var n;const t=gI(e);for(const o of t){const s=Lo(o,e);if(s.length===0){const d=e.search.building.byProperty("ownerId",o);for(const f of d)Vh(f.id,e);wu(e,o,null),fl(e,{identifier:`tribe-dissolved-${o}`,type:Sr.TribeMerged,message:"An extinct tribe has been dissolved.",duration:Au});continue}const a=QP(s,e);if(a){Wy(o,a.id,e);continue}const l=e_(o,e);if(l)Wy(o,l,e);else{const u=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const p of s)p.leaderId=void 0,p.tribeInfo=void 0;const f=e.search.building.byProperty("ownerId",o);for(const p of f)Vh(p.id,e);wu(e,o,null),fl(e,{identifier:`tribe-dissolved-${o}`,type:Sr.TribeMerged,message:`Tribe ${u} has been dissolved due to lack of leadership.`,duration:Au})}}}var $t=(e=>(e.Wood="wood",e))($t||{});const Fp={wood:""},Xn="treeGrowing",wn="treeFull",Vn="treeSpreading",Vt="treeFallen",Ci="treeStump",wr="treeDying";function mI(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const n=pI({leaderId:e},t),o=0,l=t.search.building.byProperty("ownerId",e).reduce((I,T)=>{if(T.isConstructed)return I;const A=ft[T.buildingType].cost.wood||0;return I+A},0),d=a_(e,t).reduce((I,T)=>{const R=(T.maxFuelLevel||zh)-(T.fuelLevel||0);if(R<=0)return I;const _=Math.ceil(R/eI),C=T.storedItems.filter(E=>E.item.type===$t.Wood).length,M=Math.max(0,_-C);return I+M},0),p=s_(e,t).reduce((I,T)=>{var R;const A=(R=T.storedItems)==null?void 0:R.filter(_=>_.item.type===$t.Wood);return I+((A==null?void 0:A.length)||0)},0),m=n.reduce((I,T)=>{var A;return I+(((A=T.heldItem)==null?void 0:A.type)===$t.Wood?1:0)},0),v=p+m,y=l+d+o;return t.cache.tribeWoodNeeds[e]=Math.max(0,y-v),t.cache.tribeWoodNeeds[e]}function n_(e,t){const n=t;if(e&&n.cache.tribeAvailableWoodOnGround[e]!==void 0)return n.cache.tribeAvailableWoodOnGround[e];const o=n.search.tree.all().filter(s=>!(s.stateMachine[0]===Vt)||s.wood.length===0?!1:_r(s.position,e,t));return n.cache.tribeAvailableWoodOnGround[e]=o.reduce((s,a)=>s+a.wood.length,0),n.cache.tribeAvailableWoodOnGround[e]}function i_(e,t,n=!1){const o=typeof e=="object"?e.leaderId:e;return o?t.search.building.byProperty("buildingType",$.PlantingZone).filter(a=>{if(!n&&!a.isConstructed)return!1;if(a.ownerId){const l=t.entities.entities[a.ownerId];return l&&l.leaderId===o}return!1}):[]}function o_(e,t){const{width:n,height:o,position:s}=e,{width:a,height:l}=t.mapDimensions,{depletedSectors:u,totalSectorsCount:d}=II(t.soilDepletion,s,n,o,a,l);return d===0?!0:u.length/d<.25}function yI(e){const t=Gu*2,n=Math.floor(e.width/t),o=Math.floor(e.height/t);return n*o}function r_(e,t){const n=t,o=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,o).filter(l=>{const u=Math.abs(l.position.x-e.position.x),d=Math.abs(l.position.y-e.position.y);return u<=e.width/2&&d<=e.height/2}).length}function s_(e,t,n=!1){return t.search.building.byProperty("buildingType",$.StorageSpot).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function a_(e,t,n=!1){return t.search.building.byProperty("buildingType",$.Bonfire).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function Rl(e,t,n=void 0){return n?i_(n,t).some(l=>Cy(e,l,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===$.PlantingZone&&Cy(e,a,t))}function qu(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(o/zt),gridY:Math.floor(s/zt)}}function vI(e,t,n){const o=MS(t,n);return e.sectors[o]||(e.sectors[o]=kE()),e.sectors[o]}function Lp(e,t,n){const o=MS(t,n),s=e.sectors[o];return s?s.health:Iu}function Er(e,t,n,o){const{gridX:s,gridY:a}=qu(t,n,o);return Lp(e,s,a)<bS}function SI(e,t,n){return Lp(e,t,n)>=bS}function l_(e,t,n,o,s,a,l){const{gridX:u,gridY:d}=qu(t,s,a),f=vI(e,u,d),p=f.lastAffectedBy[n]||0;if(o-p<OS)return;const m=Rl(t,l)?BS:1,v=DE*m;f.health=Math.max(DS,f.health-v),f.lastWalkTime=o,f.lastAffectedBy[n]=o}function c_(e,t,n,o,s,a){const{gridX:l,gridY:u}=qu(t,o,s),d=vI(e,l,u),f=Rl(t,a)?BS:1,p=bE*f;d.health=Math.max(DS,d.health-p),d.lastPlantTime=n}function u_(e,t,n,o,s){let a=0;for(let l=-1;l<=1;l++)for(let u=-1;u<=1;u++){if(l===0&&u===0)continue;const d=((t+l)%o+o)%o,f=((n+u)%s+s)%s;SI(e,d,f)&&a++}return a}function d_({soilDepletion:e,time:t,mapDimensions:{width:n,height:o}}){if(t-e.lastUpdateTime<xE)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/zt),l=Math.ceil(o/zt),u=[];for(const d of Object.keys(e.sectors)){const f=Number(d),p=e.sectors[f],m=Math.max(p.lastWalkTime,p.lastPlantTime);if(t-m<BE)continue;const{gridX:v,gridY:y}=kS(f),I=u_(e,v,y,a,l),T=I>0?NE*(I/8):0,A=OE+T;p.health=Math.min(Iu,p.health+A*s),p.health>=Iu&&u.push(f);const R=t-OS*10;for(const _ of Object.keys(p.lastAffectedBy)){const C=Number(_);p.lastAffectedBy[C]<R&&delete p.lastAffectedBy[C]}}for(const d of u)delete e.sectors[d]}function f_(e,t){const n=[];for(const o of Object.keys(e.sectors)){const s=Number(o),a=e.sectors[s];if(a.health<t){const{gridX:l,gridY:u}=kS(s);n.push({gridX:l,gridY:u,health:a.health})}}return n}function II(e,t,n,o,s,a){const l=[],u=n/2,d=o/2,f=t.x-u,p=t.x+u,m=t.y-d,v=t.y+d,y=Math.floor(f/zt),I=Math.floor((p-.001)/zt),T=Math.floor(m/zt),A=Math.floor((v-.001)/zt),R=Math.ceil(s/zt),_=Math.ceil(a/zt);let C=0;for(let M=y;M<=I;M++)for(let E=T;E<=A;E++){C++;const P=(M%R+R)%R,k=(E%_+_)%_;SI(e,P,k)||l.push({gridX:P,gridY:k})}return{depletedSectors:l,totalSectorsCount:C}}function Yy(e,t,n,o,s){const{gridX:a,gridY:l}=qu(t,n,o),u=Lp(e,a,l);return 1+(s-1)*Math.sqrt(1-u/Iu)}const h_={id:Za,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Bt/Gt);if(n.age+=s,n.age>=n.lifespan)return{nextState:ul,data:{...e,enteredAt:o.gameState.time}};if(!Er(o.gameState.soilDepletion,n.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height)){const l=Rl(n.position,o.gameState)?ME:1;n.timeSinceLastBerryRegen+=s*l,n.timeSinceLastBerryRegen>=CE&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:ci.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:or,data:{...e,enteredAt:o.gameState.time,previousState:Za}}:{nextState:Za,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},p_={id:or,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Bt/Gt);if(n.age+=s,n.age>=n.lifespan)return{nextState:ul,data:{...e,enteredAt:o.gameState.time,previousState:or}};if(n.food.length<n.maxFood)return{nextState:Za,data:{...e,enteredAt:o.gameState.time,previousState:or}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=Sy){n.timeSinceLastSpreadAttempt=0;const l=o.gameState.time-n.timeSinceLastHarvest>=Sy,u=Rl(n.position,o.gameState)?RE:1,d=o.gameState.ecosystem.berryBushSpreadChance*u;if(l&&Math.random()<d)return{nextState:lu,data:{...e,enteredAt:o.gameState.time,previousState:or}}}return{nextState:or,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function jy(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let o=n.hitpoints;return o+=(n.maxAge-n.age)*.5,o+=n.food.length*2,t+o},0)}var _e=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.StrategicCommand="StrategicCommand",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(_e||{});const xp={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",StrategicCommand:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},TI={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",StrategicCommand:"Strategic Command",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var is=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(is||{});const Ma={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var Oe=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectPalisade="SelectPalisade",e.SelectGate="SelectGate",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenTribeModal="OpenTribeModal",e.RecenterCamera="RecenterCamera",e.CloseTribeModal="CloseTribeModal",e.ToggleStrategicMenu="ToggleStrategicMenu",e.SelectStrategicObjective="SelectStrategicObjective",e))(Oe||{});const ph=30,g_=.4,m_=100,y_=72,AI=10,v_=2,zy=600,S_=1.5,wI=.1,gh=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,mh=""+new URL("gather-CU75596W.mp3",import.meta.url).href,I_=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,Xy=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,T_=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,A_=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,w_=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,E_=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,C_=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,P_=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Ee=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Ee||{});const __=new Map([[0,gh],[1,mh],[2,I_],[3,Xy],[4,T_],[5,A_],[6,w_],[12,E_],[13,C_],[7,gh],[8,Xy],[9,mh],[10,mh],[11,gh],[14,P_]]);let ka,gl;function R_(){if(!(typeof window>"u"))return gl}function Up(){if(!(typeof window>"u"))return!ka&&typeof window.AudioContext=="function"&&(ka=new window.AudioContext,gl=ka.createGain(),gl.connect(ka.destination),el(.1,!1)),ka}function el(e,t){gl&&(gl.gain.value=t?0:e/10)}const EI=new Map;let Xc=!1,Vy=!1;async function M_(){if(Vy||Xc)return;const e=Up();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),Xc=!0,console.log("Starting sound loading...");const t=[];__.forEach((n,o)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{EI.set(o,a)}).catch(a=>{console.error(`Error loading sound ${Ee[o]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),Vy=!0,Xc=!1,console.log("All sounds loaded successfully.")}catch(n){Xc=!1,console.error("An error occurred while loading sounds:",n)}}const tl=new Map;function Gp(e,t){const n=Up(),o=R_();if(!n||!o||o.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=EI.get(e);if(!s){console.warn(`Sound buffer not found for type: ${Ee[e]}`);return}if(t!=null&&t.trackId&&tl.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const l=n.createGain(),u=n.createStereoPanner();let d=l;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const f=Ue(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),p=Q(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(p>zy)return;const m=1-Math.pow(p/zy,S_);l.gain.value=Math.max(0,m);const v=Math.sin(f.x/p*(Math.PI/2));u.pan.value=isNaN(v)?0:v,l.connect(u),d=u}else{const f=e===Ee.GameOver?.4:e===Ee.SoundTrack1?1:.2;l.gain.value=f}a.connect(d),d.connect(o),a.start(0),t!=null&&t.trackId&&(tl.set(t.trackId,{sourceNode:a,gainNode:l}),a.onended=()=>{tl.delete(t.trackId)})}function yh(e,t=1){const n=tl.get(e),o=Up();if(n&&o){const{sourceNode:s,gainNode:a}=n,l=o.currentTime;a.gain.setValueAtTime(a.gain.value,l),a.gain.linearRampToValueAtTime(0,l+t),s.stop(l+t),s.onended=null,tl.delete(e)}}function Me(e,t,n){const o=kt(e.gameState);o&&Gp(t,{position:n,listenerPosition:o.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}const Ne={create(){return{data:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e}},k_="tribeSplit_phase",Zu="tribeSplit_strategy",CI="tribeSplit_targetPosition",$p="tribeSplit_targetBuildingId",Wp="tribeSplit_familyIds",PI="tribeSplit_lastFailureTime";function b_(e,t){Ne.set(e,k_,"idle"),Ne.delete(e,Zu),Ne.delete(e,CI),Ne.delete(e,$p),Ne.delete(e,Wp),Ne.set(e,PI,t)}function D_(e,t){const n=Ne.get(e,PI);return n?t-n>=y_:!0}function _I(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(gI(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!D_(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const o=t.entities.entities[e.leaderId];if(!o||o.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=Es(eo(t,o));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(qP(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const l=Lo(e.leaderId,t).filter(y=>y.isAdult);if(l.length<ph)return{canSplit:!1,reason:"Tribe too small"};const d=Mu(e,t).length+1,p=Mu(o,t).length+1;if(d>=p&&d>ph)return{canSplit:!0,progress:1,strategy:qy(e,t)};const m=Math.max(l.length*g_,ph),v=d/m;if(d>=m){const y=qy(e,t);return{canSplit:!0,progress:v,strategy:y}}return{canSplit:!1,progress:v,reason:`Family too small: ${d} < ${m}`}}function qy(e,t){if(!e.leaderId)return"migration";const n=t;if(!(ai(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===$.StorageSpot&&a.isConstructed);return s.length>0&&s.find(l=>Q(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height)<=m_)?"concentration":"migration"}function O_(e,t){if(!e.aiBlackboard)return!1;const n=Ne.get(e.aiBlackboard,Zu);if(!n)return!1;const o=Mu(e,t),s=[e.id,...o.map(a=>a.id)];return Ne.set(e.aiBlackboard,Wp,s),n==="migration"?B_(e,t):n==="concentration"?H_(e,t):!1}function N_(e,t,n){if(Ji(e,n,30))return!1;const s=ai(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function B_(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,o=t.mapDimensions.height,s=Math.min(n,o)/2,a=50,l=50;for(let u=0;u<=s;u+=a){const d=u===0?1:Math.max(8,Math.ceil(2*Math.PI*u/l)),f=u===0?0:2*Math.PI/d;for(let p=0;p<d;p++){const m=p*f,v=Math.cos(m)*u,y=Math.sin(m)*u,I=e.position.x+v,T=e.position.y+y,A={x:(I%n+n)%n,y:(T%o+o)%o};if(N_(A,e.leaderId,t))return Ne.set(e.aiBlackboard,CI,A),!0}}return!1}function H_(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const o=t.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===$.StorageSpot&&l.isConstructed);if(o.length===0)return!1;let s=null,a=1/0;for(const l of o){const u=Q(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);u<a&&(a=u,s=l)}return s?(Ne.set(e.aiBlackboard,$p,s.id),!0):!1}function F_(e,t){var d;if(!e.aiBlackboard)return!1;const n=Ne.get(e.aiBlackboard,Zu),o=Ne.get(e.aiBlackboard,Wp);if(!n||!o)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=Ru(),l=Xt[Math.floor(Math.random()*Xt.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:l},e.tribeControl={diplomacy:{}},s&&((d=s.tribeControl)!=null&&d.diplomacy)&&(s.tribeControl.diplomacy[e.id]=Nt.Hostile);for(const f of o){if(f===e.id)continue;const p=t.entities.entities[f];!p||p.type!=="human"||(p.leaderId=e.id,p.tribeInfo={tribeBadge:a,tribeColor:l})}if(n==="concentration"){const f=Ne.get(e.aiBlackboard,$p);if(f){const p=t.entities.entities[f];p&&p.type==="building"&&(p.ownerId=e.id)}}return fl(t,{type:Sr.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:Au,targetEntityIds:[e.id],highlightedEntityIds:o}),Me({gameState:t},Ee.TribeSplit,e.position),b_(e.aiBlackboard,t.time),!0}function L_(e,t){Ne.set(e,Zu,t)}function RI(e,t){const n=_I(e,t);return{canSplit:n.canSplit,progress:n.progress}}function MI(e,t){if(!e.aiBlackboard)return;const n=_I(e,t);!n.canSplit||!n.strategy||(L_(e.aiBlackboard,n.strategy),O_(e,t)&&F_(e,t))}const x_=20,li=30,U_=.5,G_=.3,$_=2,W_=50;function kI(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>Ho&&n.push({type:_e.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const l=Je(t,e,"berryBush",et,f=>f.food.length>0),u=Je(t,e,"corpse",et,f=>f.food.length>0);let d=null;l&&u?d=Q(t.position,l.position,e.mapDimensions.width,e.mapDimensions.height)<=Q(t.position,u.position,e.mapDimensions.width,e.mapDimensions.height)?l:u:d=l||u,d&&n.push({type:_e.Gather,action:"gathering",key:"e",targetEntity:d})}const o=Je(t,e,"human",et,l=>Os(t,l,e));if(o&&n.push({type:_e.Procreate,action:"procreating",key:"r",targetEntity:o}),t.food.length>0&&t.isAdult){const l=Je(t,e,"human",et,u=>{const d=u;return!d.isAdult&&(d.motherId===t.id||d.fatherId===t.id)&&d.hunger>=Ho});l&&n.push({type:_e.FeedChild,action:"feeding",key:"h",targetEntity:l})}const s=Je(t,e,"human",En,l=>Pl(t,l,e))??Je(t,e,"predator",En)??Je(t,e,"prey",En);if(s&&n.push({type:_e.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(l=>l.type===ci.Berry).length>=vr&&n.push({type:_e.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const l=Je(t,e,"building",li,u=>{const d=u;return d.buildingType==="storageSpot"&&d.ownerId===t.leaderId&&d.isConstructed&&d.storedItems.length>0&&d.storageCapacity!==void 0&&d.storedItems.length<d.storageCapacity});l&&n.push({type:_e.Deposit,action:"idle",key:"x",targetEntity:l})}if(t.food.length<t.maxFood&&t.isAdult){const l=Je(t,e,"building",li,u=>{const d=u;return d.buildingType==="storageSpot"&&d.ownerId===t.leaderId&&d.isConstructed&&d.storedItems.length>0});l&&n.push({type:_e.Retrieve,action:"idle",key:"z",targetEntity:l})}if(((a=t.heldItem)==null?void 0:a.type)===$t.Wood){const l=Je(t,e,"building",li,u=>{const d=u;return d.buildingType===$.Bonfire&&d.isConstructed&&d.storedItems.length<(d.storageCapacity||0)});l&&n.push({type:_e.Deposit,action:"depositing",key:"x",targetEntity:l})}if(RI(t,e).canSplit&&n.push({type:_e.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const l=Je(t,e,"tree",Wu,u=>u.wood&&u.wood.length>0);l&&n.push({type:_e.Chop,action:"chopping",key:"c",targetEntity:l})}return n}const Y_={id:lu,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o,a=o.deltaTime*(Bt/Gt);if(n.age+=a,n.age>=n.lifespan)return{nextState:ul,data:{...e,enteredAt:s.time,previousState:lu}};const l=YS(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Ji(l,s,15)||bl(s.entities,l,s.time),{nextState:or,data:{...e,enteredAt:s.time,previousState:lu}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},j_={id:ul,update:e=>({nextState:ul,data:e}),onEnter:(e,t)=>(Pi(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},z_=[h_,p_,Y_,j_],ot="humanIdle",Ti="humanMoving",Ya="humanEating",Bs="humanGathering",nl="humanDepositing",il="humanRetrieving",sr="humanProcreating",xo="humanAttacking",uu="humanPlanting",Yp="humanChopping",bI="humanDismantling",X_={id:ot,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:xo,data:{...e,enteredAt:o.gameState.time,previousState:ot,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:(n.hunger>=FS?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:o.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:Ti,data:{...e,enteredAt:o.gameState.time,previousState:ot,target:n.target}}:n.activeAction==="gathering"?{nextState:Bs,data:{...e,enteredAt:o.gameState.time,previousState:ot,target:n.target}}:n.activeAction==="eating"?{nextState:Ya,data:{...e,enteredAt:o.gameState.time,previousState:ot}}:n.activeAction==="planting"&&n.target?{nextState:uu,data:{...e,enteredAt:o.gameState.time,previousState:ot,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:nl,data:{...e,enteredAt:o.gameState.time,previousState:ot}}:n.activeAction==="retrieving"?{nextState:il,data:{...e,enteredAt:o.gameState.time,previousState:ot}}:n.activeAction==="chopping"&&n.target?{nextState:Yp,data:{...e,enteredAt:o.gameState.time,previousState:ot,state:"chopping"}}:n.activeAction==="dismantling"?{nextState:bI,data:{...e,enteredAt:o.gameState.time,previousState:ot,state:"dismantling"}}:{nextState:ot,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function DI(e,t=1){let n=GE;return e.hunger>=FS&&(n*=$E),e.age>=YE&&(n*=jE),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const Ce=10,Cs=ht,OI=100,Kh=0,vh=1,Zy=2,Ky=new Map;function V_(e){let t=Ky.get(e);return t||(t={gScore:new Float32Array(e),fScore:new Float32Array(e),cameFrom:new Int32Array(e),heap:new Int32Array(e),nodeStatus:new Uint8Array(e),touchedNodes:new Int32Array(Math.min(e,1e4)),touchedCount:0},t.gScore.fill(1/0),t.fScore.fill(1/0),t.cameFrom.fill(-1),Ky.set(e,t)),t}function q_(e){if(e.touchedCount>=e.touchedNodes.length){e.gScore.fill(1/0),e.fScore.fill(1/0),e.cameFrom.fill(-1),e.nodeStatus.fill(Kh),e.touchedCount=0;return}for(let t=0;t<e.touchedCount;t++){const n=e.touchedNodes[t];e.gScore[n]=1/0,e.fScore[n]=1/0,e.cameFrom[n]=-1,e.nodeStatus[n]=Kh}e.touchedCount=0}function Qy(e,t){e.touchedCount<e.touchedNodes.length&&(e.touchedNodes[e.touchedCount++]=t)}function Z_(e,t,n){for(;n>0;){const o=n-1>>1;if(t[e[n]]>=t[e[o]])break;const s=e[n];e[n]=e[o],e[o]=s,n=o}}function K_(e,t,n,o){for(;o<t;){const s=(o<<1)+1,a=(o<<1)+2;let l=o;if(s<t&&n[e[s]]<n[e[l]]&&(l=s),a<t&&n[e[a]]<n[e[l]]&&(l=a),l===o)break;const u=e[o];e[o]=e[l],e[l]=u,o=l}}function Jy(e,t,n,o){return e[t]=o,Z_(e,n,t),t+1}function Q_(e,t,n){const o=e[0];return e[0]=e[t-1],K_(e,t-1,n,0),{nodeIdx:o,newSize:t-1}}function NI(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(o/Ce),l=Math.floor(s/Ce),u=Math.ceil(t/Ce);return l*u+a}function bu(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{x:Math.floor(o/Ce),y:Math.floor(s/Ce)}}function Ku(e,t){const n=Math.ceil(e/Ce),o=Math.ceil(t/Ce),s=n*o;return{obstacleCount:new Uint16Array(s),gateRefCount:{},paddingCount:new Uint16Array(s),gatePaddingRefCount:{}}}function ml(e,t,n,o=!0){var s,a,l;if(o){const u=e.obstacleCount[t]+e.paddingCount[t];if(u===0)return!0;if(n!==void 0){const d=(((s=e.gateRefCount[n])==null?void 0:s[t])||0)+(((a=e.gatePaddingRefCount[n])==null?void 0:a[t])||0);return u===d}return!1}else{const u=e.obstacleCount[t];if(u===0)return!0;if(n!==void 0){const d=((l=e.gateRefCount[n])==null?void 0:l[t])||0;return u===d}return!1}}function Ps(e,t,n,o,s=null,a=0){const{width:l,height:u}=e.mapDimensions,d=Math.ceil(l/Ce),f=Math.ceil(u/Ce),p=n+a,m=Math.ceil(p/Ce),v=bu(t,l,u),y=e.navigationGrid,I=y.obstacleCount.length;s!==null&&(y.gateRefCount[s]||(y.gateRefCount[s]=new Uint16Array(I)),y.gatePaddingRefCount[s]||(y.gatePaddingRefCount[s]=new Uint16Array(I)));for(let T=-m;T<=m;T++)for(let A=-m;A<=m;A++){const R=(v.x+A+d)%d,_=(v.y+T+f)%f,C=R*Ce+Ce/2,M=_*Ce+Ce/2,E=Q(t,{x:C,y:M},l,u);if(E<=p){const P=_*d+R,k=E<=n,B=a>0&&!k?Math.max(1,Math.floor(OI*(1-(E-n)/a))):1;o?k?(y.obstacleCount[P]++,s!==null&&y.gateRefCount[s][P]++):(y.paddingCount[P]+=B,s!==null&&(y.gatePaddingRefCount[s][P]+=B)):k?(y.obstacleCount[P]>0&&y.obstacleCount[P]--,s!==null&&y.gateRefCount[s]&&y.gateRefCount[s][P]>0&&y.gateRefCount[s][P]--):(y.paddingCount[P]>=B?y.paddingCount[P]-=B:y.paddingCount[P]=0,s!==null&&y.gatePaddingRefCount[s]&&y.gatePaddingRefCount[s][P]>=B?y.gatePaddingRefCount[s][P]-=B:s!==null&&y.gatePaddingRefCount[s]&&(y.gatePaddingRefCount[s][P]=0))}}}const Qh=1/Ce,J_=1e-6;let ev=0,tv=0,nv=0;function ba(e,t,n,o,s){let a=e%n,l=t%o;a<0&&(a+=n),l<0&&(l+=o);const u=a*Qh|0;return(l*Qh|0)*s+u}function Da(e,t,n){var s;const o=e.obstacleCount[t];if(o===0)return!0;if(n!==void 0){const a=((s=e.gateRefCount[n])==null?void 0:s[t])||0;return o===a}return!1}function Oa(e,t,n,o){const{width:s,height:a}=e.mapDimensions;(s!==tv||a!==nv)&&(tv=s,nv=a,ev=Math.ceil(s*Qh));const l=ev;let u=n.x-t.x,d=n.y-t.y;u>s*.5?u-=s:u<-s*.5&&(u+=s),d>a*.5?d-=a:d<-a*.5&&(d+=a);const f=u*u+d*d;if(f<J_)return!1;const p=Math.sqrt(f),m=Math.ceil(p/(Ce*.5)),v=u/m,y=d/m,I=1/p,T=u*I,R=-(d*I),_=T,C=o.radius*.6,M=C*.5,E=e.navigationGrid,P=o.leaderId;for(let k=0;k<=m;k++){const B=t.x+v*k,j=t.y+y*k;if(!Da(E,ba(B,j,s,a,l),P))return!0;const Z=R*C,X=_*C;if(!Da(E,ba(B+Z,j+X,s,a,l),P)||!Da(E,ba(B-Z,j-X,s,a,l),P))return!0;const ie=R*M,ee=_*M;if(!Da(E,ba(B+ie,j+ee,s,a,l),P)||!Da(E,ba(B-ie,j-ee,s,a,l),P))return!0}return!1}function eR(e,t,n,o,s,a=!0){const l=bu(t,n,o),u=Math.ceil(n/Ce),d=Math.ceil(o/Ce);for(let f=0;f<20;f++)for(let p=-f;p<=f;p++)for(let m=-f;m<=f;m++){if(f>0&&Math.abs(m)!==f&&Math.abs(p)!==f)continue;const v=(l.x+m+u)%u,y=(l.y+p+d)%d,I=y*u+v;if(ml(e,I,s,a))return{x:v*Ce+Ce/2,y:y*Ce+Ce/2}}return t}function BI(e,t,n,o){var ie;const{width:s,height:a}=e.mapDimensions,l=Math.ceil(s/Ce),u=Math.ceil(a/Ce),d=l*u,f=e.navigationGrid,p=NI(n,s,a);let m=n;ml(f,p,o.leaderId,!1)||(m=eR(f,n,s,a,o.leaderId,!1));const v=bu(t,s,a),y=bu(m,s,a);if(v.x===y.x&&v.y===y.y)return{path:[m],iterations:0,isBestEffort:!1};const I=V_(d),{gScore:T,fScore:A,cameFrom:R,heap:_,nodeStatus:C}=I;q_(I);const M=v.y*l+v.x;T[M]=0;const E=Sh(v,y,l,u);A[M]=E,Qy(I,M);let P=0;P=Jy(_,P,A,M),C[M]=vh;const k=5e3;let B=0,j=M,Z=E;for(;P>0&&B<k;){B++;const ee=Q_(_,P,A),te=ee.nodeIdx;P=ee.newSize;const K=te%l,ue=Math.floor(te/l),ce=Sh({x:K,y:ue},y,l,u);if(ce<Z&&(Z=ce,j=te),C[te]=Zy,K===y.x&&ue===y.y)return{path:iv(R,te,l,m),iterations:B,isBestEffort:!1};for(let Y=-1;Y<=1;Y++)for(let J=-1;J<=1;J++){if(J===0&&Y===0)continue;const V=(K+J+l)%l,D=(ue+Y+u)%u,L=D*l+V;if(C[L]===Zy||!ml(f,L,o.leaderId,!1))continue;let fe=J!==0&&Y!==0?1.414:1;const pe=f.paddingCount[L],re=o.leaderId!==void 0&&((ie=f.gatePaddingRefCount[o.leaderId])==null?void 0:ie[L])||0,oe=Math.max(0,pe-re);oe>0&&(fe+=10+oe*1.5);const me=T[te]+fe;me<T[L]&&(C[L]===Kh&&Qy(I,L),R[L]=te,T[L]=me,A[L]=me+Sh({x:V,y:D},y,l,u),C[L]!==vh&&(P=Jy(_,P,A,L),C[L]=vh))}}const X={x:j%l*Ce+Ce/2,y:Math.floor(j/l)*Ce+Ce/2};return{path:iv(R,j,l,X),iterations:B,isBestEffort:!0}}function Sh(e,t,n,o){let s=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);s>n/2&&(s=n-s),a>o/2&&(a=o-a);const l=1;return l*(s+a)+(1.414-2*l)*Math.min(s,a)}function iv(e,t,n,o){const s=[o];let a=t;const l=new Set;for(;e[a]!==-1&&!l.has(a);)l.add(a),a=e[a],s.unshift({x:a%n*Ce+Ce/2,y:Math.floor(a/n)*Ce+Ce/2});return s.length>1&&s.shift(),s}const Vc=10,tR=.2,ov=15;class nR{constructor(){xt(this,"id",Ti)}update(t,n){var T;const{entity:o,updateContext:s}=n;if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:xo,data:{...t,enteredAt:s.gameState.time,previousState:Ti,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:ot,data:{...t,enteredAt:s.gameState.time,previousState:Ti}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(T=n.updateContext.gameState.entities.entities[o.target])==null?void 0:T.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*Vc*2,y:o.position.y+o.direction.y*Vc*2}),!a)return{nextState:ot,data:{...t,enteredAt:s.gameState.time,previousState:Ti}};const{width:l,height:u}=s.gameState.mapDimensions;if(Q(o.position,a,l,u)<Vc)return{nextState:ot,data:{...t,enteredAt:s.gameState.time,previousState:Ti}};const f=Oa(s.gameState,o.position,a,o);if(o.path&&o.pathTarget&&Q(o.pathTarget,a,l,u)>40&&(o.path=void 0,o.pathTarget=void 0),f&&!o.path)return s.gameState.pathfindingQueue.includes(o.id)||s.gameState.pathfindingQueue.push(o.id),o.acceleration=0,{nextState:Ti,data:t};let p=a;if(o.path&&o.path.length>0){const A=s.gameState.time;if(A-(t.lastPruneTime??0)>tR)if(t.lastPruneTime=A,!Oa(s.gameState,o.position,a,o))o.path=[a];else{const _=Math.min(o.path.length-1,ov);for(let C=_;C>0;C--){const M=o.path[C];if(!Oa(s.gameState,o.position,M,o)){o.path.splice(0,C);break}}}if(o.path.length===0?p=a:p=o.path[0],Oa(s.gameState,o.position,p,o)){let _=!1;const C=Math.min(o.path.length-1,ov);for(let M=1;M<=C;M++)if(!Oa(s.gameState,o.position,o.path[M],o)){o.path.splice(0,M),p=o.path[0],_=!0;break}if(!_)return o.path=void 0,o.pathTarget=void 0,o.acceleration=0,{nextState:Ti,data:t}}Q(o.position,p,l,u)<Vc&&(o.path.shift(),o.path.length>0?p=o.path[0]:p=a)}const m=Ue(o.position,p,l,u),v=Q(o.position,p,l,u),y=Tt(m);if(v>Yh){const A=pu(y,-Ka),R=pu(y,Ka),_=[y,A,R],C=_.map((E,P)=>{const k=Qi(o.position,nt(E,Yh)),B={x:(k.x%l+l)%l,y:(k.y%u+u)%u},j=Yy(s.gameState.soilDepletion,B,l,u,Ty),X=Math.cos(P===0?0:Ka);return j*X});let M=0;for(let E=1;E<C.length;E++)C[E]>C[M]&&(M=E);o.direction=_[M]}else o.direction=y;const I=Yy(s.gameState.soilDepletion,o.position,l,u,Ty);return o.acceleration=DI(o,I),{nextState:Ti,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const iR=new nR,oR={id:Ya,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction!=="eating"?{nextState:ot,data:{...e,enteredAt:o.gameState.time,previousState:Ya}}:(n.food.length>0&&(!n.eatingCooldownTime||o.gameState.time>=n.eatingCooldownTime)&&n.hunger>Ho&&(n.hunger=Math.max(0,n.hunger-Ho),n.food.pop(),n.eatingCooldownTime=o.gameState.time+1,Me(o,Ee.Eat,n.position),(!n.lastEatingEffectTime||o.gameState.time-n.lastEatingEffectTime>2)&&(Le(o.gameState,Te.Eating,n.position,Ve,n.id),n.lastEatingEffectTime=o.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:ot,data:{...e,enteredAt:o.gameState.time,previousState:Ya}}:{nextState:Ya,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class rR{constructor(){xt(this,"id",Bs)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const sR=new rR,aR={id:nl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:ot,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:nl}}:{nextState:nl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},lR={id:il,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:ot,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:il}}:{nextState:il,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},cR=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),uR=(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(s.time<(e.procreationEndTime||0))return{nextState:sr,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<zn&&a.hunger<zn&&!n.procreationCooldown&&!a.procreationCooldown){const l=n.gender==="female"?n:a.gender==="female"?a:void 0,u=n.gender==="male"?n:a.gender==="male"?a:void 0;l&&u&&(l.isPregnant=!0,l.gestationTime=zE,l.pregnancyFatherId=u.id,n.procreationCooldown=Ay,a.procreationCooldown=Ay,Me(o,Ee.Procreate,l.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:ot,data:{...e,enteredAt:s.time,previousState:sr}}},dR={id:sr,onEnter:cR,update:uR},fR={id:xo,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:ot,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:ot,data:{...e}};const o=Q(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Ue(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=Tt(s),o<=Fo||o<=En&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=DI(t.entity),{nextState:xo,data:e}}},hR={id:uu,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(s.time-e.enteredAt>=_E){const l=n.food.filter(d=>d.type===ci.Berry).length,u=Er(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(l>=vr&&!u){for(let d=0;d<vr;d++){const f=n.food.findIndex(p=>p.type===ci.Berry);f>-1&&n.food.splice(f,1)}bl(s.entities,e.plantingSpot,s.time),c_(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:ot,data:{...e,enteredAt:s.time,previousState:uu}}}return{nextState:uu,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class pR{constructor(){xt(this,"id",Yp)}update(t,n){const{entity:o,updateContext:s}=n;return o.activeAction!=="chopping"||o.heldItem?{nextState:ot,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const gR=new pR;class mR{constructor(){xt(this,"id",bI)}update(t,n){const{entity:o,updateContext:s}=n;return o.activeAction!=="dismantling"?{nextState:ot,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}onEnter(t,n){return t.entity.acceleration=0,t.entity.velocity={x:0,y:0},{...n,enteredAt:t.updateContext.gameState.time}}}const yR=new mR,vR=[X_,iR,oR,sR,aR,lR,dR,fR,hR,gR,yR],ri="preyIdle",ko="preyMoving",ja="preyGrazing",za="preyProcreating",SR={id:ri,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:ko,data:{...e,enteredAt:o.gameState.time,previousState:ri,target:n.target}}:n.activeAction==="grazing"?{nextState:ja,data:{...e,enteredAt:o.gameState.time,previousState:ri}}:n.activeAction==="procreating"?{nextState:za,data:{...e,enteredAt:o.gameState.time,previousState:ri}}:{nextState:ri,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},HI=12,Qu=120,rv=50,IR=12,FI=30,TR=2,_s=50,AR=100,LI=2,wR=.9,ER=1,CR=50,PR=.5,xI=20,Ju=140,sv=40,_R=12,UI=40,RR=3,Rs=60,Rr=40,MR=50,GI=320,$I=25,kR=60,WI=2,bR=90,DR=.7,OR=1,YI=3,jp=80,jI=10,ed=80,zI=40,XI=2,Du=30,as=20,dr=40,ls=24,fr=48,cs=12,hr=40,us=20,pr=60,ds=.75,Do=2.5,fs=.25,Oo=2,VI=4;function NR(e){let t=IR;return e.isAdult||(t*=.7),e.hunger>=CR&&(t*=PR),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function BR(e,t){const n=e>>16&255,o=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,u=t&255;let d=Math.floor((n+a)/2),f=Math.floor((o+l)/2),p=Math.floor((s+u)/2);return Math.random()<.05&&(d=Math.max(0,Math.min(255,d+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),d<<16|f<<8|p}function yl(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const Ih=10;class HR{constructor(){xt(this,"id",ko)}update(t,n){var d;const{entity:o,updateContext:s}=n;if(o.activeAction!=="moving")return{nextState:ri,data:{...t,enteredAt:s.gameState.time,previousState:ko}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(d=n.updateContext.gameState.entities.entities[o.target])==null?void 0:d.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*Ih*2,y:o.position.y+o.direction.y*Ih*2}),!a)return{nextState:ri,data:{...t,enteredAt:s.gameState.time,previousState:ko}};const l=Ue(o.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return o.direction=Tt(l),o.acceleration=NR(o),Q(o.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Ih?{nextState:ri,data:{...t,enteredAt:s.gameState.time,previousState:ko}}:{nextState:ko,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const FR=new HR,LR={id:ja,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:ko,data:{...e,enteredAt:o.gameState.time,previousState:ja,target:n.target}}:n.activeAction!=="grazing"?{nextState:ri,data:{...e,enteredAt:o.gameState.time,previousState:ja}}:{nextState:ja,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},xR={id:za,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:ko,data:{...e,enteredAt:o.gameState.time,previousState:za,target:n.target}}:n.activeAction!=="procreating"?{nextState:ri,data:{...e,enteredAt:o.gameState.time,previousState:za}}:{nextState:za,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},UR=[SR,FR,LR,xR],pn="predatorIdle",_o="predatorMoving",$i="predatorAttacking",os="predatorProcreating",gr="predatorEating",GR={id:pn,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="eating"?{nextState:gr,data:{...e,enteredAt:o.gameState.time,previousState:pn,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:$i,data:{...e,enteredAt:o.gameState.time,previousState:pn,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:n.activeAction==="moving"?{nextState:_o,data:{...e,enteredAt:o.gameState.time,previousState:pn,target:n.target}}:n.activeAction==="procreating"?{nextState:os,data:{...e,enteredAt:o.gameState.time,previousState:pn}}:{nextState:pn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function qI(e){let t=_R;return e.hunger>=bR&&(t*=DR),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function $R(e,t){const n=e>>16&255,o=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,u=t&255;let d=Math.floor((n+a)/2),f=Math.floor((o+l)/2),p=Math.floor((s+u)/2);return Math.random()<.05&&(d=Math.max(0,Math.min(255,d+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),d<<16|f<<8|p}function vl(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const Th=12;class WR{constructor(){xt(this,"id",_o)}update(t,n){var d;const{entity:o,updateContext:s}=n;if(o.activeAction==="eating")return{nextState:gr,data:{...t,enteredAt:s.gameState.time,previousState:_o,preyId:o.attackTargetId,eatingStartTime:s.gameState.time}};if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:$i,data:{...t,enteredAt:s.gameState.time,previousState:_o,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:pn,data:{...t,enteredAt:s.gameState.time,previousState:_o}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(d=n.updateContext.gameState.entities.entities[o.target])==null?void 0:d.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*Th*2,y:o.position.y+o.direction.y*Th*2}),!a)return{nextState:pn,data:{...t,enteredAt:s.gameState.time,previousState:_o}};const l=Ue(o.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return o.direction=Tt(l),o.acceleration=qI(o),Q(o.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Th?{nextState:pn,data:{...t,enteredAt:s.gameState.time,previousState:_o}}:{nextState:_o,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const YR=new WR,jR={id:$i,update:(e,t)=>{const{entity:n,updateContext:o}=t;if(n.activeAction==="eating")return{nextState:gr,data:{...e,enteredAt:o.gameState.time,previousState:$i,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:pn,data:{...e,enteredAt:o.gameState.time,previousState:$i}};const s=o.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:pn,data:{...e,enteredAt:o.gameState.time,previousState:$i}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:pn,data:{...e,enteredAt:o.gameState.time,previousState:$i}};const l=Q(n.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height),u=Ue(n.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height);return n.direction=Tt(u),l>Rr?n.acceleration=qI(n):n.acceleration=0,{nextState:$i,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},zR={id:os,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="eating"?{nextState:gr,data:{...e,enteredAt:o.gameState.time,previousState:os,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:$i,data:{...e,enteredAt:o.gameState.time,previousState:os,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:n.activeAction!=="procreating"?{nextState:pn,data:{...e,enteredAt:o.gameState.time,previousState:os}}:{nextState:os,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},XR={id:gr,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction!=="eating"?{nextState:pn,data:{...e,enteredAt:o.gameState.time,previousState:gr}}:{nextState:gr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},VR=[GR,YR,jR,zR,XR],qR=24*30*10,Uo=24*5,ZR=48,KR=72,Cr=20,QR="#3b2016",JR="#5c3a21",eM="#376d31",tM="#76a331",nM="#a6c44a",iM="rgba(0, 0, 0, 0.25)",oM=60,rM=24*7,Zi=.01,Xa=.5,av=1,td=5,sM={id:Xn,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.age>=n.lifespan?{nextState:wr,data:{enteredAt:o.gameState.time,previousState:Xn}}:n.age>=Uo?{nextState:wn,data:{enteredAt:o.gameState.time,previousState:Xn}}:{nextState:Xn,data:e}}},aM={id:wn,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Bt/Gt);return n.age>=n.lifespan?{nextState:wr,data:{...e,enteredAt:o.gameState.time,previousState:wn}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=rM&&(n.timeSinceLastSpreadAttempt=0,Math.random()<o.gameState.ecosystem.treeSpreadChance)?{nextState:Vn,data:{...e,enteredAt:o.gameState.time,previousState:wn}}:{nextState:wn,data:e})}},lM={id:Vn,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(n.age>=n.lifespan)return{nextState:wr,data:{...e,enteredAt:s.time,previousState:Vn}};const a=YS(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Ji(a,s,25)||Ms(s.entities,a,s.time),{nextState:wn,data:{...e,enteredAt:s.time,previousState:Vn}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},cM={id:Vt,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=ZR?{nextState:Ci,data:{enteredAt:n.gameState.time,previousState:Vt}}:{nextState:Vt,data:e}}},uM={id:Ci,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=KR?{nextState:wr,data:{enteredAt:n.gameState.time,previousState:Ci}}:{nextState:Ci,data:e}}},dM={id:wr,update:e=>({nextState:wr,data:e}),onEnter:(e,t)=>(Pi(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},fM=[sM,aM,lM,cM,uM,dM],lv=[...z_,...vR,...UR,...VR,...fM];function hM(e,t,n){const o=yE(e,lv);if(!o)return SE(e),[e,t];const{nextState:s,data:a}=o.update(t,n);return vE(e,s)?[s,mE(o,s,a,n,lv)]:[s,a]}function zp(e,t){return`${e},${t}`}const cv=Bt*10;function ZI(e){return e%cv/cv}function KI(e){const t=ZI(e);return(Math.cos(t*2*Math.PI)+1)/2}function pM(e){const t=ZI(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function QI(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(o/Wi),gridY:Math.floor(s/Wi)}}function Sl(e,t,n,o,s){const{gridX:a,gridY:l}=QI(t,o,s),u=zp(a,l),d=e.sectors[u],f=d?d.currentTemperature:JS,m=(KI(n)*2-1)*YC;return f+m}function gM(e){const{sectors:t}=e.temperature,{width:n,height:o}=e.mapDimensions,s=Math.ceil(n/Wi),a=Math.ceil(o/Wi);for(const u in t){const d=t[u];d.currentTemperature=d.baseTemperature}const l=Math.ceil(Qa/Wi);Object.values(e.entities.entities).forEach(u=>{if(u.type==="building"){const d=u;if(d.buildingType==="bonfire"&&d.isConstructed&&d.fuelLevel>0){const f=QI(d.position,n,o);for(let p=-l;p<=l;p++)for(let m=-l;m<=l;m++){const v=(f.gridX+m+s)%s,y=(f.gridY+p+a)%a,I=zp(v,y),T=t[I];if(T){const A={x:(v+.5)*Wi,y:(y+.5)*Wi},R=Q(d.position,A,n,o);if(R<Qa){const _=xC*(1-R/Qa);T.currentTemperature+=_}}}}}})}function JI(e,t){const n={},o=Math.ceil(e/Wi),s=Math.ceil(t/Wi);for(let a=0;a<s;a++)for(let l=0;l<o;l++){const u=zp(l,a);let d=JS;const f=a/s*10-5;d+=f,d+=Math.random()*4-2,Math.random()<.05&&(d-=10),n[u]={baseTemperature:d,currentTemperature:d}}return{sectors:n}}function mM(e,t,n){var u;const{gameState:o}=t,s=n*(Bt/Gt);e.isAdult=e.age>=Ap;const a=Sl(o.temperature,e.position,o.time,o.mapDimensions.width,o.mapDimensions.height);if(a<ur){const d=(ur-a)*LC*s;e.hitpoints-=d}if(e.movementSlowdown&&o.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<rn){const d=1-e.hunger/rn*nC,f=tC*d*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+f)}if(e.hunger+=n*(Pa/(Bt/Gt)),e.hunger>=rn)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-Ho);else{const d=iC*s;e.hitpoints-=d}if(e.age+=n/$u,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((Pa*XE-Pa)/(Bt/Gt)),(!e.lastPregnantEffectTime||o.time-e.lastPregnantEffectTime>pl*3)&&(Le(o,Te.Pregnant,e.position,pl,void 0,e.id),e.lastPregnantEffectTime=o.time),e.gestationTime<=0&&(Rb(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===Ns&&(e.radius=ht):e.hunger+=n*((Pa*VE-Pa)/(Bt/Gt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const d=[];if(e.motherId){const f=o.entities.entities[e.motherId];f&&d.push(f)}if(e.fatherId){const f=o.entities.entities[e.fatherId];f&&d.push(f)}for(const f of d)if(f.age>=wp&&f.hunger>=ZE&&Q(e.position,f.position,o.mapDimensions.width,o.mapDimensions.height)<=KE){e.food.pop(),f.hunger=Math.max(0,f.hunger-Ho),e.feedParentCooldownTime=QE;break}}let l;if(e.hitpoints<=0?a<ur?l="hypothermia":e.hunger>=rn?l="hunger":l="killed":e.age>=e.maxAge&&(l="oldAge"),l){if(e.leaderId===e.id){const d=Es(eo(o,e));if(d){d.leaderId=d.id,d.tribeInfo=e.tribeInfo,d.tribeControl=e.tribeControl??{diplomacy:{}};const f=o;wu(o,e.id,d.id);const p=f.search.human.byProperty("leaderId",e.id);for(const y of p)y.leaderId=d.id,y.tribeInfo=d.tribeInfo;const m=f.search.building.byProperty("ownerId",e.id);for(const y of m)y.ownerId=d.id;for(const y of Mu(d,o))y.leaderId=d.id,y.tribeInfo=d.tribeInfo;const v=Vu(o).filter(y=>y.leaderId!==d.id&&y.leaderId!==e.id);for(const y of v){const I=o.entities.entities[y.leaderId];if((u=I==null?void 0:I.tribeControl)!=null&&u.diplomacy){const T=I.tribeControl.diplomacy[e.id];T!==void 0&&(I.tribeControl.diplomacy[d.id]=T,delete I.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const d=Es(eo(o,e));d?(d.isPlayer=!0,o.generationCount++):(o.gameOver=!0,o.causeOfGameOver=l,fl(o,{identifier:"no_heir",type:Sr.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}Cb(o.entities,e.position,e.gender,e.age,e.radius,e.id,o.time,e.food,e.hunger),Pi(o.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function yM(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/JE);const o=Math.floor(WS*(1-e.decayProgress));e.food.length>o&&e.food.splice(o),e.decayProgress>=1&&e.food.length<=0&&Pi(t.gameState.entities,e.id)}function vM(e,t,n){const o=n*(Bt/Gt);e.age+=n/$u,e.isAdult=e.age>=LI;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=Qu){const l=VI*o;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};l.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,l.x)),l.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,l.y));const u=Math.random()<.5?"male":"female",d=e,f=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let p;if(f)p=BR(d.geneCode,f.geneCode);else{p=d.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}ks(t.gameState.entities,l,u,0,FI*.5,p,e.id,e.fatherId,e.aiType),Le(t.gameState,Te.Procreation,e.position,pl,e.id),Me(t,Ee.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=o,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=HI&&(a=!0),a&&(Pb(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Pi(t.gameState.entities,e.id))}function SM(e,t,n){const o=n*(Bt/Gt);e.age+=n/$u,e.isAdult=e.age>=YI;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=Ju){const l=VI*o;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};l.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,l.x)),l.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,l.y));const u=Math.random()<.5?"male":"female",d=e,f=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let p;if(f)p=$R(d.geneCode,f.geneCode);else{p=d.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}bs(t.gameState.entities,l,u,0,UI*.6,p,e.id,e.pregnancyFatherId,e.aiType),Le(t.gameState,Te.Procreation,e.position,pl,e.id),Me(t,Ee.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=o,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=o,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=xI&&(a=!0),a&&(_b(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Pi(t.gameState.entities,e.id))}var to=(e=>(e[e.TaskBased=0]="TaskBased",e))(to||{}),z=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e[e.HumanDiplomacy=25]="HumanDiplomacy",e[e.HumanPlacePalisade=26]="HumanPlacePalisade",e[e.HumanPlaceGate=27]="HumanPlaceGate",e[e.HumanAttackBuilding=28]="HumanAttackBuilding",e[e.HumanDismantleBuilding=29]="HumanDismantleBuilding",e[e.AnimalFlee=30]="AnimalFlee",e[e.AnimalGraze=31]="AnimalGraze",e[e.AnimalHunt=32]="AnimalHunt",e[e.AnimalAttack=33]="AnimalAttack",e[e.AnimalProcreate=34]="AnimalProcreate",e[e.AnimalWander=35]="AnimalWander",e[e.AnimalFeedChild=36]="AnimalFeedChild",e[e.AnimalSeekFoodFromParent=37]="AnimalSeekFoodFromParent",e[e.AnimalHerd=38]="AnimalHerd",e[e.AnimalTerritorial=39]="AnimalTerritorial",e[e.AnimalPack=40]="AnimalPack",e))(z||{}),O=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(O||{});const bt=3,IM=250,eT=.8,TM=100,AM=5,Jh="currentAiTask",tT="lastTaskResult",nT="lastTaskMessage",ep="taskHistory";function Il({aiBlackboard:e}){return Ne.get(e,Jh)||null}function Ki({aiBlackboard:e},t){t?Ne.set(e,Jh,t):Ne.delete(e,Jh)}function wM(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function EM(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function iT(e,t,n,o){const s=t.type===z.Wait?CM:o[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=O.Failure;const[l,u,d]=EM(a);if(Ne.set(e.aiBlackboard,tT,l),Ne.set(e.aiBlackboard,nT,u),l!==O.Running){const f=Ne.get(e.aiBlackboard,ep)||[];if(f.unshift({type:t.type,result:l,completedAtTick:n.gameState.time,message:u}),f.length>5&&f.pop(),Ne.set(e.aiBlackboard,ep,f),delete n.gameState.tasks[t.id],Ki(e,null),l===O.Success){const p=d||t.nextTask;p&&(n.gameState.tasks[p.id]=p,p.claimedByEntityId=e.id,Ki(e,p.id))}}return l}function Qe(e){return 1/(1+e/IM)}function Ml(e,t,n){for(let o=0;o<n.length;o++){const s=n[o];if(!s.producer)continue;const a=s.producer(e,t);for(const l in a){const u=a[l],d=t.gameState.tasks[l];t.gameState.tasks[l]=u,d&&(t.gameState.tasks[l].claimedByEntityId=d.claimedByEntityId)}}}const qc=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:z.Wait,creatorEntityId:e.id,validUntilTime:t+bt}),CM={type:z.Wait,executor:(e,t,n)=>n.gameState.time>=e.validUntilTime-1?[O.Success,"Wait complete"]:[O.Running,"Waiting"]};function tt(e){const{type:t,requireAdult:n,autopilotBehavior:o,producer:s,scorer:a,executor:l}=e;return{type:t,producer:s,scorer:a?(f,p,m)=>n&&!f.isAdult||o&&f.isPlayer&&!m.gameState.autopilotControls.behaviors[o]?null:a(f,p,m):void 0,executor:l?(f,p,m)=>n&&!p.isAdult||o&&p.isPlayer&&!m.gameState.autopilotControls.behaviors[o]?O.Failure:m.gameState.autopilotControls.activeAutopilotAction&&f.type!==z.HumanPlayerCommand&&p.isPlayer?[O.Failure,"Autopilot action active",{id:`player-command-${p.id}`,type:z.HumanPlayerCommand,position:p.position,creatorEntityId:p.id,validUntilTime:m.gameState.time+bt}]:l(f,p,m):void 0}}const PM=tt({type:z.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>jh&&e.food.length>0){const o=`eat-task-${e.id}`;n[o]={id:o,type:z.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/rn,executor:(e,t)=>e.target!==t.id?O.Empty:t.hunger<jh?O.Success:t.food.length===0?O.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",O.Running)}),_M=tt({type:z.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="berryBush"||o.food.length===0||e.leaderId&&!_r(o.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qe(s),l=e.hunger/rn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];return!o||o.type!=="berryBush"||o.food.length===0||t.food.length>=t.maxFood?[O.Success,"Bush is empty"]:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>et?(t.target=o.position,t.activeAction="moving",[O.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[O.Running,"Gathering berries"])}}),RM=tt({type:z.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="corpse"||o.food.length===0||e.leaderId&&!_r(o.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qe(s),l=e.hunger/rn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return O.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.type!=="corpse"||o.food.length===0||t.food.length>=t.maxFood?O.Success:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>et?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",O.Running)}}),MM=tt({type:z.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=Tu&&e.age<=Tp&&e.hunger<zn&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:z.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<Tu||e.hunger>=zn||(e.procreationCooldown||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="female"||o.isPregnant||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(s)*eT},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="female"||t.hunger>=zn?O.Failure:o.isPregnant?O.Success:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>et?(t.target=o.position,t.activeAction="moving",t.direction=jt(t.position,o.position,n.gameState.mapDimensions),O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",O.Running)}}),kM=tt({type:z.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=Tu&&e.hunger<zn&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:z.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<Tu||e.age>Tp||e.hunger>=zn||(e.procreationCooldown||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="male"||o.hunger>=zn||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(s)*eT},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="male"||o.hunger>=zn?O.Failure:t.isPregnant?O.Success:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>et?(t.target=o.position,t.activeAction="moving",t.direction=jt(t.position,o.position,n.gameState.mapDimensions),O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",O.Running)}}),bM=tt({type:z.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=wy){const o=`feed-child-task-${e.id}`;n[o]={id:o,type:z.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.isAdult||!(o.motherId===e.id||o.fatherId===e.id))return null;const a=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Qe(a),u=o.hunger/rn;return(l+u)/2},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.isAdult||t.food.length===0?O.Failure:o.hunger<wy/2?O.Success:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>$S?(t.target=o.position,t.activeAction="moving",t.direction=jt(t.position,o.position,n.gameState.mapDimensions),O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="feeding",O.Running)}});function kl(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const o=Q(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(o)}function DM(e,t,n){if(e.leaderId!==t.creatorEntityId||!e.leaderId)return null;const o=t.target;if(!o)return null;const{width:s,height:a}=n.gameState.mapDimensions,l=Q(e.position,o,s,a),u=Qe(l)*.5,d=Ei(e.leaderId,n.gameState),f=Q(d,o,s,a),p=Math.max(0,1-f/800)*.25,m=Math.ceil(s/ge),v=Math.ceil(a/ge),y=DC(o);let I=0;for(let A=-1;A<=1;A++)for(let R=-1;R<=1;R++){if(R===0&&A===0)continue;const _=((y.x+R)%m+m)%m,C=((y.y+A)%v+v)%v;n.gameState.terrainOwnership[C*m+_]===e.leaderId&&I++}const T=I/8*.25;return u+p+T}function Hs(e,t,n,o,s){const a=e.target;return Q(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",O.Running):(bp(a,o,t.leaderId,n.gameState),O.Success)}const OM=tt({type:z.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:kl,executor:(e,t,n)=>Hs(e,t,n,$.StorageSpot,_l)}),NM=tt({type:z.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:kl,executor:(e,t,n)=>Hs(e,t,n,$.Bonfire,_l)}),BM=tt({type:z.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:kl,executor:(e,t,n)=>Hs(e,t,n,$.PlantingZone,_l)}),HM=tt({type:z.HumanPlaceBorderPost,scorer:DM,requireAdult:!0,autopilotBehavior:"build",executor:(e,t,n)=>Hs(e,t,n,$.BorderPost,PC)}),FM=tt({type:z.HumanPlacePalisade,requireAdult:!0,autopilotBehavior:"build",scorer:kl,executor:(e,t,n)=>Hs(e,t,n,$.Palisade,_l)}),LM=tt({type:z.HumanPlaceGate,requireAdult:!0,autopilotBehavior:"build",scorer:kl,executor:(e,t,n)=>Hs(e,t,n,$.Gate,_l)}),xM=tt({type:z.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(d=>d.type===ci.Berry).length<vr)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const l=t.target,u=Q(e.position,l,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(u)},executor:(e,t,n)=>{if(t.food.filter(u=>u.type===ci.Berry).length<vr)return t.activeAction="idle",O.Failure;const s=e.target;return Q(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>xS?(t.target=s,t.activeAction="moving",O.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(u=>u.type==="berryBush"&&Q(u.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<AM)?(t.activeAction="idle",O.Success):O.Running)}}),UM=tt({type:z.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var f;if(typeof t.target!="number")return null;const o=e.food.length>0,s=((f=e.heldItem)==null?void 0:f.type)===$t.Wood;if(!o&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==$.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const l=Q(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),u=Qe(l),d=s?.6:e.food.length/e.maxFood*.4;return(u+d)/2},executor:(e,t,n)=>{var u;if(typeof e.target!="number")return O.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==$.StorageSpot)return O.Failure;const s=t.food.length>0,a=((u=t.heldItem)==null?void 0:u.type)===$t.Wood;return!s&&!a?O.Success:o.storedItems.length>=o.storageCapacity?O.Failure:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>et?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",O.Running)}}),GM=tt({type:z.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var u;if(typeof t.target!="number"||!(((u=e.heldItem)==null?void 0:u.type)===$t.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==$.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||Xh;if(s.storedItems.length>=a)return null;const l=Q(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(l)},executor:(e,t,n)=>{var u;if(typeof e.target!="number")return O.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==$.Bonfire)return O.Failure;if(!(((u=t.heldItem)==null?void 0:u.type)===$t.Wood))return O.Success;const a=o.storageCapacity||Xh;return o.storedItems.length>=a?O.Failure:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>et?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",O.Running)}}),$M=tt({type:z.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=jh||e.food.length>0||typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="building"||o.buildingType!==$.StorageSpot||o.ownerId!==e.leaderId||!o.storedItems.some(d=>d.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qe(s),l=e.hunger/rn,u=1-e.food.length/e.maxFood;return(a+l+u)/3},executor:(e,t,n)=>{if(typeof e.target!="number")return O.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.type!=="building"||o.buildingType!==$.StorageSpot||!o.storedItems.some(a=>a.item.itemType==="food")?O.Failure:t.food.length>0?O.Success:t.food.length>=t.maxFood?O.Failure:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>et?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="retrieving",O.Running)}}),WM=2;function Xp(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}const YM=tt({type:z.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;if(e.trappedByObstacleId===t.target)return 1e3;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="tree")return null;const[s]=o.stateMachine??[];if(!(s===Xn||s===wn||s===Vn)||e.leaderId&&!_r(o.position,e.leaderId,n.gameState)||e.heldItem||e.food.length===0)return null;const l=Xp(e,n.gameState);if(!l)return null;const u=mI(l.id,n.gameState);if(u<=0)return null;const d=n_(l.id,n.gameState);if(d>=u)return null;const f=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),p=Qe(f),m=Math.min(1,(u-d)/10);return(p+m)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="tree")return[O.Failure,"Tree not found"];const[s]=o.stateMachine??[];if(s===Vt){const u={id:`gather-wood-${t.id}-${n.gameState.time}`,type:z.HumanGatherWood,position:o.position,creatorEntityId:t.id,target:o.id,validUntilTime:n.gameState.time+1};return[O.Success,"Tree fell!",u]}return s===Xn||s===wn||s===Vn?t.heldItem?[O.Failure,"Hands full"]:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>US?(t.target=o.position,t.activeAction="moving",[O.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="chopping",[O.Running,"Chopping tree"]):[O.Failure,"Tree is not standing"]}}),jM=tt({type:z.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="tree"||o.wood.length===0)return null;const[s]=o.stateMachine??[];if(s!==Vt||e.leaderId&&!_r(o.position,e.leaderId,n.gameState)||e.heldItem)return null;const a=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Qe(a),u=Xp(e,n.gameState),d=u?mI(u.id,n.gameState):0,f=Math.min(1,d/10);return(l+f)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[O.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[O.Success,"Already holding wood"];const o=n.gameState.entities.entities[e.target];return!o||o.type!=="tree"||o.wood.length===0||t.heldItem?[O.Failure,"Tree gone, empty, or human full"]:Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>et?(t.target=o.position,t.activeAction="moving",[O.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[O.Running,"Gathering wood"])}}),zM=tt({type:z.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="prey"||o.hitpoints<=0||e.leaderId&&!_r(o.position,e.leaderId,n.gameState))return null;const s=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const u=Ei(e.leaderId,n.gameState);if(Q(e.position,u,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>mC)return null}const a=Qe(s),l=e.hunger/rn;return(a+l)/2*.6},executor:(e,t,n)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[O.Success,"Prey is dead"];const s=Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>et?[O.Running,"Chasing prey"]:[O.Running,"Attacking prey"]}}),XM=tt({type:z.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="predator"||o.hitpoints<=0||e.leaderId&&!_r(o.position,e.leaderId,n.gameState))return null;const s=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(Qe(s)+.3)/1.3},executor:(e,t,n)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[O.Failure,"Too injured to continue"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[O.Success,"Predator eliminated"];const s=Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>et?[O.Running,"Chasing predator"]:[O.Running,"Fighting predator"]}});function VM(e,t,n,o){var d;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,O.Failure;const a=Q(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),u=(((d=t.attackCooldown)==null?void 0:d.ranged)??0)<=0?En:Fo;return a<=u?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,O.Success):(t.activeAction="moving",t.target=s.id,t.direction=jt(t.position,s.position,e.mapDimensions),O.Running)}const qM=tt({type:z.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const o=`player-command-${e.id}`;n[o]={id:o,type:z.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+bt}}return n},scorer:(e,t)=>t.type===z.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a;const{gameState:o}=n,s=o.autopilotControls.activeAutopilotAction;if(!s)return[O.Failure,"No active autopilot action"];switch(s.action){case _e.AutopilotMove:{if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,O.Failure;const l=s.position;return Q(t.position,l,o.mapDimensions.width,o.mapDimensions.height)<SC?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[O.Success,"Reached target position"]):(t.activeAction="moving",t.target=l,t.direction=jt(t.position,l,o.mapDimensions),[O.Running,"Moving to target"])}case _e.AutopilotGather:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];if(!l)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Target entity not found"];let u=!1;if(l.type==="berryBush")u=l.food.length===0;else if(l.type==="corpse")u=l.food.length===0;else if(l.type==="tree"){const f=l;u=f.stateMachine[0]!==Vt||f.wood.length===0}else return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target type"];return u?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Target is depleted"]):Q(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)>xS?(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[O.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=l.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"At target, gathering",qc(t,o.time)])}case _e.AutopilotChop:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target entity"];const[u]=l.stateMachine??[];return!(u===Xn||u===wn||u===Vn)||t.heldItem?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Tree is not standing or human is holding an item"]):Q(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)>US?(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[O.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=l.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"At tree, chopping",qc(t,o.time)])}case _e.AutopilotAttack:return"targetEntityId"in s?VM(o,t,s):(o.autopilotControls.activeAutopilotAction=void 0,O.Failure);case _e.AutopilotProcreate:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];if(!l||l.type!=="human"||!Os(t,l,o))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target for procreation"];const u=Q(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height);return l.isPregnant||t.isPregnant?t.gender==="male"&&l.pregnancyFatherId!==t.id?[O.Failure,"Target is pregnant by another"]:[O.Success,"Procreation conditions met"]:u<=sh?(t.activeAction="procreating",o.autopilotControls.activeAutopilotAction=void 0,[O.Running,"Procreating"]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[O.Running,"Moving to procreation target"])}case _e.AutopilotPlant:{if(t.activeAction==="planting")return[O.Running,"Planting"];if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No position specified"];const l=s.position;return Ji(l,o,Gu,t.id)?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Position is occupied"]):Q(t.position,l,o.mapDimensions.width,o.mapDimensions.height)<=sh?(t.activeAction="planting",t.target=l,o.autopilotControls.activeAutopilotAction=void 0,o.hasPlayerPlantedBush=!0,[O.Running,"Planting"]):(t.activeAction="moving",t.target=l,t.direction=jt(t.position,l,o.mapDimensions),[O.Running,"Moving to planting target"])}case _e.AutopilotFeedChild:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target for feeding child"]):Q(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=sh?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[O.Success,"Feeding child"]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[O.Running,"Moving to feeding target"])}case _e.AutopilotDeposit:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];if(!l||l.buildingType!==$.StorageSpot&&l.buildingType!==$.Bonfire||!l.isConstructed)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"];const u=l.storageCapacity??0;if(l.storedItems.length>=u)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Storage is full"];if(t.leaderId!==l.ownerId)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Human does not belong to the same tribe as the building"];const f=t.food.length>0,p=!!t.heldItem;if(l.buildingType===$.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==$t.Wood)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Bonfires only accept wood"]}else if(!f&&!p)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No items to deposit"];return Q(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=li?(t.activeAction="depositing",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Depositing items",qc(t,o.time)]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[O.Running,"Moving to deposit target"])}case _e.AutopilotRetrieve:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];return!l||l.buildingType!==$.StorageSpot||!l.isConstructed||l.storedItems.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"]):t.leaderId!==l.ownerId?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Storage is full"]):Q(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=li?(t.activeAction="retrieving",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Retrieving items",qc(t,o.time)]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[O.Running,"Moving to retrieve target"])}case _e.TakeOverBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Ir(t,l,o)?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Only leaders can take over buildings"]):Q(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=et?(t.activeAction="takingOverBuilding",t.target=l.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Taking over building"]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[O.Running,"Moving to takeover target"])}case _e.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Ir(t,l,o)?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Only leaders can remove enemy buildings"]):Q(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=et?(t.activeAction="destroyingBuilding",t.target=l.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[O.Running,"Moving to removal target"])}case _e.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return o.autopilotControls.activeAutopilotAction=void 0,O.Failure;const l=s.position,u=s.buildingType;if(!u)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No building type specified"];const d=Q(t.position,l,o.mapDimensions.width,o.mapDimensions.height),f=100;return d<=f?Ar(l,u,t.leaderId,o,t.position,f)?(bp(l,u,t.leaderId,o),o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[O.Success,"Building placed"]):(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=l,t.direction=jt(t.position,l,o.mapDimensions),[O.Running,"Moving to placement target"])}default:return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Unknown or unhandled action"]}}}),ZM=tt({type:z.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:n}=t,o={},s=ai(e.position.x,e.position.y,n),a=s!==null&&s!==e.leaderId&&ui(e.leaderId,s,n),l=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(a||l){const u=`attack-human-${e.id}`;o[u]={id:u,type:z.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:n.time+bt}}return o},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="human"||o.hitpoints<=0||o.id===e.id||o.leaderId===e.leaderId)return null;const{gameState:s}=n,a=Pl(e,o,s),l=ai(o.position.x,o.position.y,s)===e.leaderId,u=o.activeAction==="attacking"&&o.attackTargetId!==void 0;if(!a&&!u)return null;let d=.5;const f=Q(e.position,o.position,s.mapDimensions.width,s.mapDimensions.height),p=Qe(f);return l&&a&&(d+=.1),(p+d)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[O.Success,"Target eliminated"];const s=Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>et?[O.Running,"Chasing human target"]:[O.Running,"Fighting human target"]}}),KM=tt({type:z.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,n)=>{if(typeof t.target!="number"||KI(n.gameState.time)>.5)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.buildingType!==$.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0||e.leaderId!==o.ownerId)return null;const s=Sl(n.gameState.temperature,e.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=ur+5;if(s>=a)return null;const l=(a-s)/15,u=(1-e.hitpoints/e.maxHitpoints)*.8,d=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),f=Qe(d);let p=(l+u+f)/2;return e.hitpoints/e.maxHitpoints<.2&&s<ur&&(p=Math.max(p,1.2)),p},executor:(e,t,n)=>{if(typeof e.target!="number")return O.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.buildingType!==$.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0)return O.Failure;const s=Sl(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=ur+5;if(s>=a)return t.activeAction="idle",[O.Success,"Comfortable temperature reached"];const l=t.id*137%360*(Math.PI/180),u=Qa*.4,d=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,p={x:(o.position.x+Math.cos(l)*u+d)%d,y:(o.position.y+Math.sin(l)*u+f)%f},m=Q(t.position,p,d,f);return m>10?(t.activeAction="moving",t.target=p,t.direction=jt(t.position,p,n.gameState.mapDimensions),[O.Running,`Moving to warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[O.Running,"Staying warm at bonfire"])}}),QM=tt({type:z.HumanFlee,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hitpoints<e.maxHitpoints*Ry){const o=BC(e.id,t.gameState);if(o){const s=`flee-task-${e.id}`;n[s]={id:s,type:z.HumanFlee,position:e.position,creatorEntityId:e.id,target:o.id,validUntilTime:t.gameState.time+bt}}}return n},scorer:(e,t,n)=>typeof t.target!="number"||!n.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*Ry?.9:null,executor:(e,t,n)=>{if(typeof e.target!="number")return O.Failure;const o=n.gameState.entities.entities[e.target];if(!o)return t.activeAction="idle",t.attackTargetId=void 0,O.Success;if(Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>My)return t.activeAction="idle",t.target=void 0,O.Success;t.activeAction="moving",t.attackTargetId=void 0;const a=Ue(o.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Tt(a),u=Qi(t.position,nt(l,My));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=l,O.Running}}),JM=tt({type:z.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,o={};if(!e.leaderId||e.id===e.leaderId)return o;const s=Ei(e.leaderId,n),a=`stay-near-tribe-${e.id}`;return o[a]={id:a,type:z.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:n.time+bt},o},scorer:(e,t,n)=>{if(!e.leaderId||e.id===e.leaderId)return null;const o=Ei(e.leaderId,n.gameState),s=Q(e.position,o,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=ky)return null;const a=s-ky;return Math.min(.95,.5+a/1e3*_C)},executor:(e,t,n)=>{if(!t.leaderId)return O.Failure;const o=Ei(t.leaderId,n.gameState),s=Q(t.position,o,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<MC?(t.activeAction="idle",t.target=void 0,O.Success):(t.activeAction="moving",t.target=o,[O.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),ek=tt({type:z.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,o={};if(e.isAdult)return o;const s=$y(e,n);if(!s)return o;const a=`stay-near-parent-${e.id}`;return o[a]={id:a,type:z.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:n.time+bt},o},scorer:(e,t,n)=>{if(e.isAdult)return null;const o=$y(e,n.gameState);if(!o||o.id!==t.target||e.leaderId&&kp(e.leaderId,n.gameState)&&ai(o.position.x,o.position.y,n.gameState)!==e.leaderId)return null;const s=Q(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=by)return null;const a=s-by;return Math.min(.98,.6+a/500*RC)},executor:(e,t,n)=>{if(typeof e.target!="number")return t.activeAction="idle",O.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="human")return t.activeAction="idle",t.target=void 0,O.Failure;const s=Q(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<=kC?(t.activeAction="idle",t.target=void 0,O.Success):(t.activeAction="moving",t.target=o.id,t.direction=jt(t.position,o.position,n.gameState.mapDimensions),[O.Running,`Returning to parent (${Math.round(s)}px away)`])}}),tk=tt({type:z.HumanDiplomacy,requireAdult:!0,scorer:(e,t)=>e.id===e.leaderId&&t.creatorEntityId===e.id?1:null,executor:(e,t,n)=>{var u,d,f,p,m,v;const{gameState:o}=n,s=Lo(t.id,o),a=jy(s),l=Vu(o).filter(y=>y.leaderId!==t.id);for(const y of l){const I=Lo(y.leaderId,o),T=jy(I),A=((d=(u=t.tribeControl)==null?void 0:u.diplomacy)==null?void 0:d[y.leaderId])||Nt.Friendly,R=o.entities.entities[y.leaderId];((p=(f=R==null?void 0:R.tribeControl)==null?void 0:f.diplomacy)==null?void 0:p[t.id])===Nt.Hostile||a>T*vC?A!==Nt.Hostile&&((m=t.tribeControl)!=null&&m.diplomacy)&&(t.tribeControl.diplomacy[y.leaderId]=Nt.Hostile):A!==Nt.Friendly&&((v=t.tribeControl)!=null&&v.diplomacy)&&(t.tribeControl.diplomacy[y.leaderId]=Nt.Friendly)}return t.aiBlackboard&&Ne.set(t.aiBlackboard,"lastDiplomacyCheckTime",o.time),O.Success}}),nk={type:z.HumanAttackBuilding,scorer:(e,t,n)=>{if(e.trappedByObstacleId===t.target)return 1e3;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.ownerId===e.leaderId)return null;const a=Q(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(a)},executor:(e,t,n)=>{const{gameState:o}=n,s=e.target,a=o.entities.entities[s];return a?(t.activeAction="attacking",t.attackTargetId=s,t.trappedByObstacleId===s&&(a.isBeingDestroyed=!0),O.Running):O.Success}},ik=tt({type:z.HumanDismantleBuilding,requireAdult:!0,scorer:(e,t,n)=>{if(e.trappedByObstacleId===t.target)return 1e3;if(e.leaderId!==t.creatorEntityId)return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s)return null;const a=Q(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qe(a)},executor:(e,t,n)=>{const o=e.target,s=n.gameState.entities.entities[o];return s?Q(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>35?(t.target=s.position,t.activeAction="moving",O.Running):(t.activeAction="dismantling",t.target=s.id,s.isBeingDestroyed=!0,O.Running):(t.activeAction="idle",O.Success)}}),nd=[PM,_M,RM,MM,kM,bM,OM,NM,BM,HM,FM,LM,xM,UM,GM,$M,YM,jM,zM,XM,qM,ZM,KM,QM,JM,ek,tk,nk,ik].reduce((e,t)=>(e[t.type]=t,e),{}),ok=Object.values(nd);function rk(e,t){Ml(e,t,ok)}function sk(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const o=Il(e);if(o){const s=t.gameState.tasks[o];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),Ki(e,null)}return}let n=Il(e);if(n){const o=t.gameState.tasks[n];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(Ki(e,null),n=null)}if(!n){const o=ak(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];n=o,Ki(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const o=t.gameState.tasks[n];o?iT(e,o,t,nd):Ki(e,null)}}function ak(e,t){let n=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=nd[a.type];if(!l||!l.scorer)continue;const u=l.scorer(e,a,t);u!==null&&u>o&&(o=u,n=a.id)}return o>0?n:null}function lk(e,t){const n=performance.now();switch(e.aiType){case to.TaskBased:default:sk(e,t);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}const ck=(e,t)=>{const n={};for(let o=0;o<WM;o++){const s=`hunt-prey-${e.id}-${o}`;n[s]={id:s,type:z.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},uk=(e,t)=>{const n={};if(e.hitpoints<=0)return n;const o=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((o==null?void 0:o.type)==="human"))return n;for(let a=0;a<yC;a++){const l=`hunt-predator-${e.id}-${a}`;n[l]={id:l,type:z.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},Ou=AR*1.5,dk=(e,t)=>{const n={},o=t.gameState,s=[...o.search.human.byRadius(e.position,Ou),...o.search.predator.byRadius(e.position,Ou)].filter(d=>{if(d.id===e.id)return!1;if(e.type==="prey")return d.type==="human"||d.type==="predator";if(e.type==="predator"){if(d.type==="human")return!0;if(d.type==="predator")return d.geneCode!==e.geneCode}return!1});if(s.length===0)return n;let a=s[0],l=qn(e.position,a.position);for(let d=1;d<s.length;d++){const f=qn(e.position,s[d].position);f<l&&(l=f,a=s[d])}const u=`animal-flee-${e.id}-${a.id}`;return n[u]={id:u,type:z.AnimalFlee,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1},n},fk=(e,t,n)=>{const o=n.gameState.entities.entities[t.target];if(!o)return null;const s=qn(e.position,o.position);return s>Ou?null:Qe(s)*.95},hk=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];if(!o)return O.Failure;if(qn(t.position,o.position)>Ou*1.2)return O.Success;const a=Tt(Kv(t.position,o.position)),l=Qi(t.position,nt(a,100));return t.activeAction="moving",t.target=l,O.Running},pk={type:z.AnimalFlee,producer:dk,scorer:fk,executor:hk},oT=600,gk=(e,t)=>{if(e.type!=="prey")return{};const n={},s=t.gameState.search.berryBush.byRadius(e.position,oT).filter(a=>a.food.length>0);for(const a of s){const l=`animal-graze-${e.id}-${a.id}`;n[l]={id:l,type:z.AnimalGraze,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},mk=(e,t,n)=>{if(e.type!=="prey")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.food.length===0)return null;const s=qn(e.position,o.position);if(s>oT)return null;const a=Qe(s),l=Math.max(0,e.hunger/Qu);return e.hunger<20&&s>100?null:a*l*.65},yk=(e,t,n)=>{if(t.type!=="prey")return O.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.food.length===0||(t.activeAction="grazing",t.target=o.id,t.hunger<5)?O.Success:O.Running},vk={type:z.AnimalGraze,producer:gk,scorer:mk,executor:yk},rT=800,Sk=(e,t)=>{if(e.type!=="predator")return{};const n={},s=t.gameState.search.prey.byRadius(e.position,rT).filter(a=>a.type==="prey");for(const a of s){const l=`animal-hunt-${e.id}-${a.id}`;n[l]={id:l,type:z.AnimalHunt,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},Ik=(e,t,n)=>{if(e.type!=="predator")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.hitpoints<=0)return null;const s=qn(e.position,o.position);if(s>rT)return null;const a=Qe(s),l=Math.max(0,e.hunger/Ju);return e.hunger<30&&s>200?null:a*l*.8},Tk=(e,t,n)=>{if(t.type!=="predator")return O.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.hitpoints<=0||(t.activeAction="attacking",t.target=o.id,t.hunger<10)?O.Success:O.Running},Ak={type:z.AnimalHunt,producer:Sk,scorer:Ik,executor:Tk},sT=500,wk=(e,t)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,sT).filter(a=>{if(a.id===e.id||a.type!==e.type)return!1;const l=a;return l.isAdult&&l.gender!==e.gender&&(!l.procreationCooldown||l.procreationCooldown<=0)&&!l.isPregnant});for(const a of s){const l=`animal-procreate-${e.id}-${a.id}`;n[l]={id:l,type:z.AnimalProcreate,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},Ek=(e,t,n)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return null;const o=n.gameState.entities.entities[t.target];if(!o||!o.isAdult||o.gender===e.gender||o.procreationCooldown&&o.procreationCooldown>0||o.isPregnant)return null;const s=qn(e.position,o.position);return s>sT?null:Qe(s)*.6},Ck=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||o.isPregnant||o.procreationCooldown&&o.procreationCooldown>0?O.Failure:(t.activeAction="procreating",t.target=o.id,t.isPregnant||t.procreationCooldown&&t.procreationCooldown>0?O.Success:O.Running)},Pk={type:z.AnimalProcreate,producer:wk,scorer:Ek,executor:Ck},_k=200,Rk=(e,t)=>{const n=`animal-wander-${e.id}`,o=Math.random()*Math.PI*2,s=Math.random()*_k,a={x:e.position.x+Math.cos(o)*s,y:e.position.y+Math.sin(o)*s};a.x=Math.max(0,Math.min(t.gameState.mapDimensions.width,a.x)),a.y=Math.max(0,Math.min(t.gameState.mapDimensions.height,a.y));const l={};return l[n]={id:n,type:z.AnimalWander,position:a,creatorEntityId:e.id,validUntilTime:t.gameState.time+5},l},Mk=()=>.1,kk=(e,t)=>qn(t.position,e.position)<10?(t.activeAction="idle",O.Success):(t.activeAction="moving",t.target=e.position,O.Running),bk={type:z.AnimalWander,producer:Rk,scorer:Mk,executor:kk},Dk=(e,t)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,600).filter(a=>{if(a.type!==e.type)return!1;const l=a;return l.motherId===e.id&&l.hunger>=ed});for(const a of s){const l=`animal-feed-child-${e.id}-${a.id}`;n[l]={id:l,type:z.AnimalFeedChild,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},Ok=(e,t,n)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.motherId!==e.id)return null;const s=qn(e.position,o.position),a=Qe(s),l=e.type==="prey"?Qu:Ju,u=Math.max(0,o.hunger/l);return a*u*.9},Nk=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||o.hunger<ed/2?O.Success:qn(t.position,o.position)<30?(t.activeAction="feeding",O.Running):(t.activeAction="moving",t.target=o.id,O.Running)},Bk={type:z.AnimalFeedChild,producer:Dk,scorer:Ok,executor:Nk},Hk=(e,t)=>{if(e.isAdult||e.hunger<ed||!e.motherId)return{};const n=t.gameState.entities.entities[e.motherId];if(!n)return{};const o={},s=`animal-seek-food-${e.id}-${n.id}`;return o[s]={id:s,type:z.AnimalSeekFoodFromParent,position:n.position,creatorEntityId:e.id,target:n.id,validUntilTime:t.gameState.time+1},o},Fk=(e,t,n)=>{if(e.isAdult||!e.motherId)return null;const o=n.gameState.entities.entities[e.motherId];if(!o)return null;const s=qn(e.position,o.position),a=Qe(s),l=e.type==="prey"?Qu:Ju,u=Math.max(0,e.hunger/l);return a*u*.85},Lk=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||t.hunger<ed/2?O.Success:(qn(t.position,o.position)<30||(t.activeAction="moving",t.target=o.id),O.Running)},xk={type:z.AnimalSeekFoodFromParent,producer:Hk,scorer:Fk,executor:Lk},Uk=(e,t)=>{if(e.type!=="prey")return{};if(e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return{};const n={},o=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,l=o.search.prey.byRadius(e.position,_s*5),u=[];for(const d of l)d.id!==e.id&&d.hitpoints>0&&d.isAdult&&u.push(d);if(u.length>=2){let d=0,f=0;for(const v of u)d+=v.position.x,f+=v.position.y;d/=u.length,f/=u.length;const p={x:d,y:f};if(Q(e.position,p,s,a)>_s*2){const v=`animal-herd-${e.id}`;n[v]={id:v,type:z.AnimalHerd,position:p,creatorEntityId:e.id,target:p,validUntilTime:t.gameState.time+1}}}return n},Gk=(e,t,n)=>{if(e.type!=="prey"||e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return null;const o=t.target,{width:s,height:a}=n.gameState.mapDimensions,l=Q(e.position,o,s,a);return l<=_s*2?null:Qe(l)*.4},$k=(e,t,n)=>{if(t.type!=="prey")return O.Failure;const o=e.target,{width:s,height:a}=n.gameState.mapDimensions;if(Q(t.position,o,s,a)<=_s*2)return t.activeAction="idle",t.direction={x:0,y:0},O.Success;t.activeAction="moving",t.target=o;const u=Ue(t.position,o,s,a);return t.direction=Tt(u),O.Running},Wk={type:z.AnimalHerd,producer:Uk,scorer:Gk,executor:$k},Yk=(e,t)=>{if(e.type!=="predator")return{};const n=e.hunger>100,o=e.hitpoints<e.maxHitpoints*.5;if(!n&&!o)return{};if(e.attackCooldown&&e.attackCooldown>0)return{};const s={},l=t.gameState.search.human.byRadius(e.position,Rr*2);let u=null,d=1/0;for(const f of l)if(f.hitpoints>0){const p=Q(e.position,f.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);p<d&&(d=p,u=f)}if(u){const f=`animal-attack-human-${e.id}-${u.id}`;s[f]={id:f,type:z.AnimalAttack,position:u.position,creatorEntityId:e.id,target:u.id,validUntilTime:t.gameState.time+1}}return s},jk=(e,t,n)=>{if(e.type!=="predator")return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const a=Q(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>Rr*2.5?null:Qe(a)*.75},zk=(e,t,n)=>{if(t.type!=="predator")return O.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return O.Success;const{width:a,height:l}=n.gameState.mapDimensions;if(Q(t.position,s.position,a,l)<=Rr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},O.Running;{t.activeAction="moving",t.target=s.id;const d=Ue(t.position,s.position,a,l);return t.direction=Tt(d),O.Running}},Xk={type:z.AnimalAttack,producer:Yk,scorer:jk,executor:zk},Vk=(e,t)=>{if(e.type!=="predator")return{};if(!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120||e.attackCooldown&&e.attackCooldown>0)return{};const n={},s=t.gameState.search.predator.byRadius(e.position,GI);let a=null,l=1/0;for(const u of s)if(u.id!==e.id&&u.hitpoints>0&&u.isAdult&&e.fatherId!==u.fatherId&&e.gender===u.gender&&e.fatherId!==void 0&&u.fatherId!==void 0){const d=Q(e.position,u.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);d<l&&(l=d,a=u)}if(a){const u=`animal-territorial-${e.id}-${a.id}`;n[u]={id:u,type:z.AnimalTerritorial,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},qk=(e,t,n)=>{if(e.type!=="predator"||!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120)return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const a=Q(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>GI*1.2?null:Qe(a)*.7},Zk=(e,t,n)=>{if(t.type!=="predator")return O.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return O.Success;const{width:a,height:l}=n.gameState.mapDimensions;if(Q(t.position,s.position,a,l)<=Rr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},O.Running;{t.activeAction="moving",t.target=s.id;const d=Ue(t.position,s.position,a,l);return t.direction=Tt(d),O.Running}},Kk={type:z.AnimalTerritorial,producer:Vk,scorer:qk,executor:Zk},Qk=(e,t)=>{if(e.type!=="predator")return{};if(e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return{};if(e.fatherId===void 0)return{};const n={},o=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,l=o.search.predator.byRadius(e.position,Rs*4);let u=null;for(const d of l)d.id!==e.id&&d.hitpoints>0&&d.isAdult&&d.fatherId===e.fatherId&&(d.age>=e.age||d.hitpoints>e.hitpoints)&&(!u||d.age>u.age)&&(u=d);if(u&&Q(e.position,u.position,s,a)>Rs*2){const f=`animal-pack-follow-${e.id}-${u.id}`;n[f]={id:f,type:z.AnimalPack,position:u.position,creatorEntityId:e.id,target:u.id,validUntilTime:t.gameState.time+1}}return n},Jk=(e,t,n)=>{if(e.type!=="predator"||e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const{width:a,height:l}=n.gameState.mapDimensions,u=Q(e.position,s.position,a,l);return u<=Rs*2?null:Qe(u)*.35},eb=(e,t,n)=>{if(t.type!=="predator")return O.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return O.Success;const{width:a,height:l}=n.gameState.mapDimensions;if(Q(t.position,s.position,a,l)<=Rs*2)return t.activeAction="idle",t.direction={x:0,y:0},O.Success;t.activeAction="moving",t.target=s.id;const d=Ue(t.position,s.position,a,l);return t.direction=Tt(d),O.Running},tb={type:z.AnimalPack,producer:Qk,scorer:Jk,executor:eb},sn={};sn[z.HumanHuntPrey]={type:z.HumanHuntPrey,producer:ck};sn[z.HumanHuntPredator]={type:z.HumanHuntPredator,producer:uk};sn[z.AnimalFlee]=pk;sn[z.AnimalGraze]=vk;sn[z.AnimalHunt]=Ak;sn[z.AnimalAttack]=Xk;sn[z.AnimalProcreate]=Pk;sn[z.AnimalWander]=bk;sn[z.AnimalFeedChild]=Bk;sn[z.AnimalSeekFoodFromParent]=xk;sn[z.AnimalHerd]=Wk;sn[z.AnimalTerritorial]=Kk;sn[z.AnimalPack]=tb;function uv(e,t){Ml(e,t,Object.values(sn))}function aT(e,t){let n=Il(e);if(n){const o=t.gameState.tasks[n];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(Ki(e,null),n=null)}if(!n){const o=nb(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];n=o,Ki(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const o=t.gameState.tasks[n];o?iT(e,o,t,sn):Ki(e,null)}}function nb(e,t){let n=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,1e3);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=sn[a.type];if(!l||!l.scorer)continue;const u=l.scorer(e,a,t);u!==null&&u>o&&(o=u,n=a.id)}return o>0?n:null}function ib(e,t){aT(e,t)}function ob(e,t){aT(e,t)}const rb=(e,t)=>{if(e.buildingType!==$.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,o=yI(e);if(r_(e,n)>=o)return{};const a=n.search.tasks.byProperty("creatorEntityId",e.id).find(p=>p.type===z.HumanPlantBush);if(a)return{[a.id]:a};const l=n.mapDimensions.width,u=n.mapDimensions.height,d=n.soilDepletion,f=10;for(let p=0;p<f;p++){const m=e.position.x+(Math.random()-.5)*e.width,v=e.position.y+(Math.random()-.5)*e.height,y={x:(m%l+l)%l,y:(v%u+u)%u};if(!Er(d,y,l,u)&&!Ji(y,n,Gu)){const I=`plant-bush-${e.id}`,T={id:I,type:z.HumanPlantBush,position:y,creatorEntityId:e.id,target:y,validUntilTime:n.time+TM};return{[I]:T}}}return{}},sb=(e,t)=>{const n={};if(e.buildingType===$.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const o=`stockpile-${e.id}`;n[o]={id:o,type:z.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},ab=(e,t)=>{const n={};if(e.buildingType===$.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*GC){const o=`fuel-bonfire-${e.id}`;n[o]={id:o,type:z.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},lb=(e,t)=>{const n={};if(e.buildingType===$.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let o=0;o<jC;o++){const s=`seek-warmth-${e.id}-${o}`;n[s]={id:s,type:z.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},cb=(e,t)=>{const n={};if(e.buildingType===$.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(o=>o.item.itemType==="food")){const o=`retrieve-from-${e.id}`;n[o]={id:o,type:z.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},dv=(e,t)=>{const n={},a=t.gameState.search.human.byRadius(e.position,100).find(l=>l.trappedByObstacleId===e.id);if(a){const u=a.leaderId===e.ownerId?z.HumanDismantleBuilding:z.HumanAttackBuilding,d=`clear-obstacle-${e.id}`;n[d]={id:d,type:u,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n},ub={[z.HumanPlantBush]:{type:z.HumanPlantBush,producer:rb},[z.HumanStockpile]:{type:z.HumanStockpile,producer:sb},[z.HumanFuelBonfire]:{type:z.HumanFuelBonfire,producer:ab},[z.HumanSeekWarmth]:{type:z.HumanSeekWarmth,producer:lb},[z.HumanRetrieve]:{type:z.HumanRetrieve,producer:cb},[z.HumanDismantleBuilding]:{type:z.HumanDismantleBuilding,producer:dv},[z.HumanAttackBuilding]:{type:z.HumanAttackBuilding,producer:dv}};function lT(e,t){Ml(e,t,Object.values(ub))}function db(e,t){const{gameState:n,deltaTime:o}=t,s=o*(Bt/Gt);if(e.isBeingDestroyed){const a=cw(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){if(e.buildingType===$.Palisade||e.buildingType===$.Gate){const u=e.buildingType===$.Gate?e.ownerId??null:null;Ps(n,e.position,e.radius,!1,u,Cs),n.buildingVersion=(n.buildingVersion??0)+1}const l=e.buildingType===$.PlantingZone;Pi(n.entities,e.id),l&&al(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=lw(e.buildingType);if(a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1){if(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&ps(e.position,lr(e.buildingType),e.ownerId,n),e.buildingType===$.Palisade||e.buildingType===$.Gate){const l=e.buildingType===$.Gate?e.ownerId??null:null;Ps(n,e.position,e.radius,!0,l,Cs)}e.buildingType===$.PlantingZone&&al(n)}}if(e.buildingType===$.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0){e.firePhase===void 0&&(e.firePhase="off"),e.fireIntensity===void 0&&(e.fireIntensity=0);const a=2,l=1;if(e.fuelLevel>0&&(e.firePhase==="off"||e.firePhase==="stopping")&&(e.firePhase="lighting"),e.firePhase==="lighting"?(e.fireIntensity+=s*a,e.fireIntensity>=1&&(e.fireIntensity=1,e.firePhase="burning")):e.firePhase==="burning"?(e.fireIntensity=1,e.fuelLevel<=0&&(e.firePhase="stopping")):e.firePhase==="stopping"&&(e.fireIntensity-=s*l,e.fireIntensity<=0&&(e.fireIntensity=0,e.firePhase="off")),e.fuelLevel-=s*UC,e.fuelLevel<0&&(e.fuelLevel=0),e.fireIntensity>0&&(Math.random()<s*4&&Le(n,Te.Fire,e.position,.5,e.fireIntensity),Math.random()<s*2&&Le(n,Te.Smoke,e.position,2.5,e.fireIntensity)),e.fuelLevel<(e.maxFuelLevel||0)*WC){const u=e.storedItems.findIndex(d=>d.item.itemType==="item"&&d.item.type===$t.Wood);u!==-1&&(e.storedItems.splice(u,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+eI))}}lT(e,t)}function fb(e,t){const n=t.deltaTime*Bt/Gt;if(e.age+=n,!e.stateMachine)return;const[o]=e.stateMachine,s=e.stateMachine[1];(o===Vt||o===Ci)&&s.enteredAt>=t.gameState.time-n&&Ps(t.gameState,e.position,e.radius,!1,null,Cs),o!==Vt&&o!==Ci&&o!==wr&&(e.age>=Uo&&!e.woodGenerated&&(e.wood=Array.from({length:td},()=>({itemType:"item",type:$t.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=Cr*Math.min(1,Math.max(.4,e.age/Uo)))}const hb={type:z.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const o=`gather-berries-${e.id}`;n[o]={id:o,type:z.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n}},pb={type:z.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[o]=e.stateMachine??[];if(o===Xn||o===wn||o===Vn){const u=t.gameState.search.human.byRadius(e.position,100).find(d=>d.trappedByObstacleId===e.id);if(o===wn||o===Vn||u){const d=`chop-tree-${e.id}`;n[d]={id:d,type:z.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}}return n}},gb={type:z.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[o]=e.stateMachine??[];if(o===Vt&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:z.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n}},mb=[hb,pb,gb].reduce((e,t)=>(e[t.type]=t,e),{});function fv(e,t){Ml(e,t,Object.values(mb))}const yb={type:z.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const o=`gather-meat-${e.id}`;n[o]={id:o,type:z.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+bt}}return n}},vb=[yb].reduce((e,t)=>(e[t.type]=t,e),{});function Sb(e,t){Ml(e,t,Object.values(vb))}const Ib=1e-6,Tb=.01;var du=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(du||{});function Ah(e,t,n){switch(n){case 0:Ab(e,t);break;case 1:wb(e,t);break;case 2:Eb(e,t);break}}function Ab(e,t){ty(e.velocity,e.velocity,-.1);const n=e.direction.x*e.direction.x+e.direction.y*e.direction.y;if(n>0&&e.acceleration>0){const d=e.acceleration/Math.sqrt(n);e.velocity.x+=e.direction.x*d,e.velocity.y+=e.direction.y*d}for(let d=0;d<e.forces.length;d++)Q1(e.velocity,e.forces[d]);const o=t.gameState.time;let s=0;for(let d=0;d<e.debuffs.length;d++){const f=e.debuffs[d];o-f.startTime<f.duration&&(f.type==="slow"&&J1(e.velocity,.5),s!==d&&(e.debuffs[s]=f),s++)}e.debuffs.length=s;const a=e.velocity.x*e.velocity.x+e.velocity.y*e.velocity.y;a<Ib&&(e.velocity.x=0,e.velocity.y=0),ty(e.position,e.velocity,t.deltaTime);const{width:l,height:u}=t.gameState.mapDimensions;e.position.x=(e.position.x%l+l)%l,e.position.y=(e.position.y%u+u)%u,e.forces.length=0,e.type==="human"&&a>Tb&&l_(t.gameState.soilDepletion,e.position,e.id,o,l,u,t.gameState),e.type==="human"?mM(e,t,t.deltaTime):e.type==="corpse"?yM(e,t):e.type==="prey"?vM(e,t,t.deltaTime):e.type==="predator"?SM(e,t,t.deltaTime):e.type==="building"?db(e,t):e.type==="tree"?fb(e,t):e.type,e.stateMachine&&(e.stateMachine=hM(...e.stateMachine,{entity:e,updateContext:t}))}function wb(e,t){cT(e,t)&&(e.type==="human"?rk(e,t):e.type==="corpse"?Sb(e,t):e.type==="prey"||e.type==="predator"?uv(e,t):e.type==="building"?lT(e,t):(e.type==="tree"||e.type==="berryBush")&&fv(e,t))}function Eb(e,t){cT(e,t)&&(e.type==="human"?lk(e,t):e.type==="corpse"||(e.type==="prey"?ib(e,t):e.type==="predator"?ob(e,t):e.type==="building"||e.type==="tree"||e.type),Ne.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function cT(e,t){const n=Ne.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-n+(Math.random()-Math.random())*Py/10>Py}function uT(e){const t=e.gameState.entities.entities;for(const n in t)Ah(t[n],e,du.Physics);for(const n in t)Ah(t[n],e,du.PrepareAI);iw(e.gameState);for(const n in t)Ah(t[n],e,du.ExecuteAI)}function dT(){return{entities:{},nextEntityId:1}}function Mr(e,t,n){const o={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:Ne.create(),...n};return e.entities[o.id]=o,o}function bl(e,t,n){return Mr(e,"berryBush",{position:t,radius:Wh,food:Array.from({length:EE},()=>({itemType:"food",type:ci.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:wE,lifespan:PE,age:0,spreadRadius:Wh,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:Ne.create(),stateMachine:[Za,{enteredAt:n,previousState:void 0}]})}function Ms(e,t,n,o=0){const s=o>=Uo;return Mr(e,"tree",{position:t,radius:Cr,age:o,lifespan:qR,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:oM,stateMachine:[Xn,{enteredAt:n,previousState:void 0}],aiBlackboard:Ne.create(),wood:s?Array.from({length:td},()=>({itemType:"item",type:$t.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function ar(e,t,n,o,s=!1,a=WE,l=GS,u,d,f=[],p,m,v=to.TaskBased){const y=a>=Ap;return Mr(e,"human",{position:t,radius:y?ht:Ns,hunger:l,hitpoints:Ey,maxHitpoints:Ey,age:a,gender:o,isPlayer:s,food:[],maxFood:LS,maxAge:dl,isAdult:y,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:u,fatherId:d,ancestorIds:f,stateMachine:[ot,{enteredAt:n,previousState:void 0}],leaderId:p,tribeInfo:m,aiType:v,aiBlackboard:Ne.create()})}function Vp(e,t,n,o,s,a,l,u,d,f,p){let m,v;switch(l){case"human":m=WS,v=zn;break;case"prey":m=2,v=120;break;case"predator":m=4,v=140;break}return Mr(e,"corpse",{position:t,radius:s,gender:n,age:o,originalEntityId:a,originalEntityType:l,timeOfDeath:u,decayProgress:0,geneCode:p,food:[...Array.from({length:Math.max(m*Math.max(v-f,0)/v,0)},()=>({itemType:"food",type:ci.Meat})),...d].map(I=>({...I,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:Ne.create()})}function Cb(e,t,n,o,s,a,l,u,d){return Vp(e,t,n,o,s,a,"human",l,u,d)}function Pb(e,t,n,o,s,a,l,u){return Vp(e,t,n,o,s,a,"prey",l,[],0,u)}function _b(e,t,n,o,s,a,l,u){return Vp(e,t,n,o,s,a,"predator",l,[],0,u)}function Rb(e,t,n){const o=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=o?[...o.ancestorIds||[],o.id]:[],l=[...s,...a],u=[...new Set(l)],d=u.slice(Math.max(u.length-HS,0)),f=Math.random()<.5?"male":"female",p=Qi(e.position,{x:5,y:5}),m=ar(n.gameState.entities,p,n.gameState.time,f,!1,0,GS/2,e.id,t,d,(o==null?void 0:o.leaderId)??e.leaderId,(o==null?void 0:o.tribeInfo)??e.tribeInfo,e.aiType);return Me(n,Ee.Birth,e.position),m}function Pi(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function ks(e,t,n,o=TR,s=FI,a,l,u,d=to.TaskBased){const f=o>=LI,p=Date.now();return Mr(e,"prey",{position:t,radius:f?ht*.7:Ns*.7,hunger:s,hitpoints:rv,maxHitpoints:rv,age:o,maxAge:HI,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:u,stateMachine:[ri,{enteredAt:p,previousState:void 0}],aiType:d,aiBlackboard:Ne.create()})}function bs(e,t,n,o=RR,s=UI,a,l,u,d=to.TaskBased){const f=o>=YI,p=Date.now();return Mr(e,"predator",{position:t,radius:f?ht*.9:Ns*.9,hunger:s,hitpoints:sv,maxHitpoints:sv,age:o,maxAge:xI,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:u,stateMachine:[pn,{enteredAt:p,previousState:void 0}],aiType:d,aiBlackboard:Ne.create()})}function fT(e,t,n,o){const s=cp(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:o,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:x_,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===$.Bonfire?zh:void 0,maxFuelLevel:n===$.Bonfire?zh:void 0,aiBlackboard:Ne.create(),stateMachine:["",{enteredAt:0}]};return Mr(e,"building",a)}var hn=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(hn||{}),mr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(mr||{}),tn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(tn||{});const tp={},np={},Mb=[{key:hn.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:hn.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>UE,isCompleted:!1,minDisplayTime:Ly,highlightedUIElements:[mr.HUNGER_BAR]},{key:hn.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!Je(t,e,"berryBush",et*5,o=>o.food.length>0),getTargets:(e,t)=>{const n=[];for(const o of Object.values(e.entities.entities))o.type==="berryBush"&&o.food.length>0&&Q(t.position,o.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(o);return n.map(o=>o.id)},isCompleted:!1,minDisplayTime:Ly},{key:hn.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=Je(t,e,"berryBush",et,o=>o.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:hn.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[mr.FOOD_BAR]},{key:hn.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>eo(e,t).length>0,getTargets:(e,t)=>{const n=Je(t,e,"human",et,o=>Os(t,o,e));return n?[n.id]:[]},isCompleted:!1},{key:hn.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>kI(e,t).some(o=>o.type===_e.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:hn.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[mr.COMMAND_BUTTONS],isCompleted:!1},{key:hn.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:hn.AUTOPILOT},{key:hn.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=Je(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=Je(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:hn.ANIMALS_INTRODUCTION},{key:hn.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!Je(t,e,"predator",120),getTargets:(e,t)=>{const n=Je(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:hn.HUNT_PREY}].map(e=>({...e,condition:e.condition?Db(e.condition):void 0,getTargets:e.getTargets?Ob(e.getTargets):void 0}));function hT(){return{steps:Mb.map(e=>({...e,isCompleted:!1}))}}function pT(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:tn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function kb(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function bb(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=tn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const o=kt(e);if(!o){n.isActive=!1,n.transitionState=tn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=tn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/RP;switch(n.transitionState){case tn.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=tn.ACTIVE);break;case tn.ACTIVE:{const d=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),f=tp[s.condition];f&&d&&f(e,o)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=tn.FADING_OUT);break}case tn.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const u=kb(e);u!==null?(n.currentStepIndex=u,n.transitionState=tn.FADING_IN):(n.isActive=!1,n.transitionState=tn.INACTIVE)}break}if(n.transitionState!==tn.FADING_OUT&&n.transitionState!==tn.INACTIVE){const u=np[s.getTargets||""];u?n.highlightedEntityIds=[...u(e,o)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function Db(e){const t=`condition_${Object.keys(tp).length+1}`;return tp[t]=e,t}function Ob(e){const t=`getTargets_${Object.keys(np).length+1}`;return np[t]=e,t}function Nb(){const e=dT(),t=0;for(let v=0;v<RS;v++){const y={x:Math.random()*Ye,y:Math.random()*je};bl(e,y,t)}for(let v=0;v<_S;v++){const y={x:Math.random()*Ye,y:Math.random()*je};Ms(e,y,t)}const n=Ye/2,o=je/2;for(let v=0;v<5;v++){const y=v/5*Math.PI*2,I=100+Math.random()*100,T={x:n+Math.cos(y)*I,y:o+Math.sin(y)*I};Ms(e,T,t,Uo)}const s=ar(e,{x:n-25,y:o},t,"male",!0),a=ar(e,{x:n+25,y:o},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:Xt[0]},s.aiType=to.TaskBased,a.aiType=to.TaskBased;for(let v=0;v<5;v++){const y=v/5*Math.PI*2,I=Ye/2,T=je/2,A={x:n+Math.cos(y)*I,y:o+Math.sin(y)*T},R=ar(e,{x:A.x,y:A.y},t,"male",!1);R.leaderId=R.id,R.tribeInfo={tribeBadge:Eu[v%Eu.length],tribeColor:Xt[v%Xt.length]};const _=ar(e,{x:A.x+50,y:A.y},t,"female",!1);_.leaderId=R.id,_.tribeInfo=R.tribeInfo}for(let v=0;v<jI;v++){const y={x:n+Ye*(Math.random()-Math.random()),y:o+je*(Math.random()-Math.random())};ks(e,y,"male",void 0,void 0,yl()),ks(e,{x:y.x+20,y:y.y},"female",void 0,void 0,yl())}const l={x:n+Ye*(Math.random()-Math.random()),y:o+je*(Math.random()-Math.random())};bs(e,l,"male",void 0,void 0,vl()),bs(e,{x:l.x+20,y:l.y},"female",void 0,void 0,vl());const u=[{id:"muteButton",action:Oe.ToggleMute,currentWidth:Yi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:dt},{id:"pauseButton",action:Oe.TogglePause,currentWidth:Yi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:dt},{id:"returnToIntroButton",action:Oe.ReturnToIntro,currentWidth:Yi,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:dt}],d=hT(),f=pT(),p={time:t,entities:e,mapDimensions:{width:Ye,height:je},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,strategicMenuOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:wI,isMuted:!1,uiButtons:u,tutorial:d,tutorialState:f,debugPanel:Ze.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:Sr.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:dr,preyProcreationCooldown:fr,predatorGestationPeriod:hr,predatorProcreationCooldown:pr,preyHungerIncreasePerHour:Do,predatorHungerIncreasePerHour:Oo,berryBushSpreadChance:qi,treeSpreadChance:Zi},soilDepletion:Ip(),temperature:JI(Ye,je),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ye/ge)*Math.ceil(je/ge)).fill(null),navigationGrid:Ku(Ye,je),pathfindingQueue:[],tasks:{},buildingVersion:0};Object.values(p.entities.entities).forEach(v=>{v.type==="tree"&&Ps(p,v.position,v.radius,!0,null,Cs)});const m=wl(p);return console.log("Game world initialized:",m),m}function Bb(){const e=dT(),t=0;for(let d=0;d<RS;d++){const f={x:Math.random()*Ye,y:Math.random()*je};bl(e,f,t)}for(let d=0;d<_S;d++){const f={x:Math.random()*Ye,y:Math.random()*je};Ms(e,f,t)}const n=Ye/2,o=je/2;for(let d=0;d<5;d++){const f=d/5*Math.PI*2,p=100+Math.random()*100,m={x:n+Math.cos(f)*p,y:o+Math.sin(f)*p};Ms(e,m,t,Uo)}for(let d=0;d<IE;d++){const f={x:Math.random()*Ye,y:Math.random()*je},p=Math.random()<.5?"male":"female";ar(e,f,t,p,!1)}for(let d=0;d<jI;d++){const f={x:Math.random()*Ye,y:Math.random()*je};ks(e,f,"male",void 0,void 0,yl()),ks(e,{x:f.x+20,y:f.y},"female",void 0,void 0,yl())}const s={x:Math.random()*Ye,y:Math.random()*je};bs(e,s,"male",void 0,void 0,vl()),bs(e,{x:s.x+20,y:s.y},"female",void 0,void 0,vl());const a=hT(),l=pT(),u={time:t,entities:e,mapDimensions:{width:Ye,height:je},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Ye/2,y:je/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,strategicMenuOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:wI,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:l,debugPanel:Ze.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:dr,preyProcreationCooldown:fr,predatorGestationPeriod:hr,predatorProcreationCooldown:pr,preyHungerIncreasePerHour:Do,predatorHungerIncreasePerHour:Oo,berryBushSpreadChance:qi,treeSpreadChance:Zi},soilDepletion:Ip(),temperature:JI(Ye,je),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ye/ge)*Math.ceil(je/ge)).fill(null),navigationGrid:Ku(Ye,je),pathfindingQueue:[],tasks:{},buildingVersion:0};return Object.values(u.entities.entities).forEach(d=>{d.type==="tree"&&Ps(u,d.position,d.radius,!0,null,Cs)}),wl(u)}const Hb="humanProcreation",Fb="human",Lb="human",xb=et,Ub=(e,t,n)=>Os(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,Gb=(e,t,n)=>{const{gameState:o}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,l=e.gender==="female"?e:t,u=(a.partnerIds||[]).length===0;if(e.stateMachine[0]!==sr&&(e.stateMachine=[sr,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:n.gameState.time+1}]),t.stateMachine[0]!==sr&&(t.stateMachine=[sr,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),u&&a.leaderId&&a.leaderId!==a.id){const d=o.entities.entities[a.leaderId];if(d){const f=Zh(a,d),p=Zh(l,d);if(!f&&!p){const m=Ru();a.leaderId=a.id,a.tribeInfo={tribeBadge:m,tribeColor:Xt[Math.floor(Math.random()*Xt.length)]},a.tribeControl={diplomacy:{}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&l){const d=Ru();a.leaderId=a.id,a.tribeInfo={tribeBadge:d,tribeColor:Xt[Math.floor(Math.random()*Xt.length)]},a.tribeControl={diplomacy:{}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}e.activeAction=void 0,Le(o,Te.Procreation,s,pl),Le(o,Te.Partnered,e.position,Ve,e.id),Le(o,Te.Partnered,t.position,Ve,t.id),e.lastPartneredEffectTime=o.time,t.lastPartneredEffectTime=o.time,t.activeAction=void 0,Me(n,Ee.Procreate,s)},$b={id:Hb,sourceType:Fb,targetType:Lb,maxDistance:xb,checker:Ub,perform:Gb},Wb={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:$S,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Ho&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-Ho),e.feedChildCooldownTime=qE,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Le(n.gameState,Te.ChildFed,t.position,Ve,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,Ee.ChildFed,t.position)}},Yb={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:En,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==xo||e.attackTargetId!==t.id)return!1;const o=Q(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=Fo,a=!s&&o<=En;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const u=s?Yu:Pp,d=e.stateMachine[1];return n.gameState.time-d.attackStartTime>=u},perform:(e,t,n)=>{const{gameState:o}=n,s=Q(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>Fo,l=Ue(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),u=tw(Tt(l),t.direction);if(Math.abs(u)<aC*Math.PI/180&&Math.random()<lC)Le(o,Te.AttackDeflected,t.position,Ve,void 0,t.id);else{let p=a?Cp:Ep;if(e.gender==="male"&&(p*=oC),e.isAdult||(p*=rC),(!t.isAdult||t.age>=wp)&&e.isAdult&&(p*=sC),a){const v=s/_p;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+v,data:{attackerId:e.id,targetId:t.id,damage:p,pushbackForce:Mp,attackerPosition:{...e.position}}}),Le(o,Te.StoneProjectile,e.position,v,void 0,void 0,t.position,t.id),Me(n,Ee.Attack,e.position)}else{t.hitpoints-=p,t.movementSlowdown={modifier:ju,endTime:o.time+zu},Le(o,Te.Hit,t.position,Ve,void 0,t.id);const v=Ue(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),y=nt(v,eC);t.forces.push(y),t.hitpoints<=0?Me(n,Ee.HumanDeath,t.position):Me(n,Ee.Attack,e.position),Le(o,Te.Attack,e.position,Ve,void 0,e.id)}}e.attackCooldown={melee:Cl,ranged:Rp};const f=e.stateMachine[1];f.attackStartTime=o.time}},jb={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:ht*2,checker:(e,t,{gameState:n})=>Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const o=Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(o===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const s=(e.radius+t.radius)/3-o;if(s<=0)return;const a=s*.05,l=Tt(Ue(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),u=nt(l,a);e.forces.push(u),t.forces.push(nt(u,-1))}},zb={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:ht+Cr,checker:(e,t,{gameState:n})=>{const o=t.stateMachine[0];if(o==="fallen"||o==="stump")return!1;const s=t.radius*.25,a=e.radius*.5;return Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.5,a=Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+o-a;if(l<=0)return;const u=Tt(Ue(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),d=l*15;e.forces.push(nt(u,d));const{width:f,height:p}=n.mapDimensions,m=nt(u,l);e.position.x=(e.position.x+m.x+f)%f,e.position.y=(e.position.y+m.y+p)%p}},Xb={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:ht+Cr,checker:(e,t,{gameState:n})=>{const o=t.stateMachine[0];if(o==="fallen"||o==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+o-a;if(l<=0)return;const u=Tt(Ue(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),d=l*15;e.forces.push(nt(u,d));const{width:f,height:p}=n.mapDimensions,m=nt(u,l);e.position.x=(e.position.x+m.x+f)%f,e.position.y=(e.position.y+m.y+p)%p}},Vb={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:ht+Cr,checker:(e,t,{gameState:n})=>{const o=t.stateMachine[0];if(o==="fallen"||o==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+o-a;if(l<=0)return;const u=Tt(Ue(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),d=l*15;e.forces.push(nt(u,d));const{width:f,height:p}=n.mapDimensions,m=nt(u,l);e.position.x=(e.position.x+m.x+f)%f,e.position.y=(e.position.y+m.y+p)%p}},qb={id:"human-building-collision",sourceType:"human",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==$.Palisade&&t.buildingType!==$.Gate||!t.isConstructed||t.buildingType===$.Gate&&e.leaderId===t.ownerId)return!1;const o=e.radius*.5,s=t.radius;return Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.5,s=t.radius,a=Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=o+s-a;if(l<=0)return;const u=Tt(Ue(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),d=l*15;e.forces.push(nt(u,d));const{width:f,height:p}=n.mapDimensions,m=nt(u,l);e.position.x=(e.position.x+m.x+f)%f,e.position.y=(e.position.y+m.y+p)%p}},Zb={id:"prey-building-collision",sourceType:"prey",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==$.Palisade&&t.buildingType!==$.Gate||!t.isConstructed)return!1;const o=e.radius*.5,s=t.radius;return Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.5,s=t.radius,a=Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=o+s-a;if(l<=0)return;const u=Tt(Ue(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),d=l*15;e.forces.push(nt(u,d));const{width:f,height:p}=n.mapDimensions,m=nt(u,l);e.position.x=(e.position.x+m.x+f)%f,e.position.y=(e.position.y+m.y+p)%p}},Kb={id:"predator-building-collision",sourceType:"predator",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==$.Palisade&&t.buildingType!==$.Gate||!t.isConstructed)return!1;const o=e.radius*.5,s=t.radius;return Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.5,s=t.radius,a=Q(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=o+s-a;if(l<=0)return;const u=Tt(Ue(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),d=l*15;e.forces.push(nt(u,d));const{width:f,height:p}=n.mapDimensions,m=nt(u,l);e.position.x=(e.position.x+m.x+f)%f,e.position.y=(e.position.y+m.y+p)%p}},Qb={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:et,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Bs&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Le(n.gameState,Te.BushClaimed,t.position,Ve),Me(n,Ee.Gather,e.position)}},Jb={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:et,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Bs&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=n.gameState.time+1,Me(n,Ee.Gather,e.position)}},eD={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:et,checker:(e,t,n)=>e.isAdult&&t.stateMachine[0]===Vt&&t.wood.length>0&&e.stateMachine[0]===Bs&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.wood.pop();o&&(e.heldItem=o),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[Ci,{enteredAt:n.gameState.time,previousState:Vt}]),Me(n,Ee.Gather,e.position)}},tD=[Qb,Jb,eD],nD={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:_s,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=ER,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+wR,Le(n.gameState,Te.BushClaimed,t.position,Ve,e.id),Me(n,Ee.Gather,e.position))}},iD={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:MR,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=kR;const o=Ue(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=nt(o,8);t.forces.push(s),e.huntCooldown=OR,t.hitpoints<=0?(Me(n,Ee.HumanDeath,t.position),Le(n.gameState,Te.Hit,t.position,Ve,t.id)):(Le(n.gameState,Te.Hit,t.position,Ve,t.id),t.fleeCooldown=5,Me(n,Ee.Attack,e.position)),Le(n.gameState,Te.Attack,e.position,Ve,e.id)}},oD={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:En,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==xo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=Q(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=Fo,a=!s&&o<=En;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const u=s?Yu:Pp,d=e.stateMachine[1];return n.gameState.time-d.attackStartTime>=u},perform:(e,t,n)=>{const{gameState:o}=n,s=Q(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>Fo;let l=(a?Cp:Ep)*1.2;if(e.gender==="male"&&(l*=1.3),a){const d=s/_p;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+d,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Mp,attackerPosition:{...e.position}}}),Le(o,Te.StoneProjectile,e.position,d,void 0,void 0,t.position,t.id),Me(n,Ee.Attack,e.position)}else{t.hitpoints-=l;const d=Ue(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),f=nt(d,6);t.forces.push(f),t.hitpoints<=0?(Me(n,Ee.HumanDeath,t.position),Le(o,Te.Hit,t.position,Ve,void 0,t.id)):(Le(o,Te.Hit,t.position,Ve,void 0,t.id),t.fleeCooldown=8,Me(n,Ee.Attack,e.position)),Le(o,Te.Attack,e.position,Ve,void 0,e.id)}e.attackCooldown={melee:Cl,ranged:Rp};const u=e.stateMachine[1];u.attackStartTime=o.time}},rD={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:Rr,checker:(e,t,n)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=n.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,n)=>{let o=$I;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:ju,endTime:n.gameState.time+zu};const s=Ue(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=nt(s,7);t.forces.push(a),e.attackCooldown=WI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-jp),Me(n,Ee.HumanDeath,t.position),Le(n.gameState,Te.Hit,t.position,Ve,t.id)):(Le(n.gameState,Te.Hit,t.position,Ve,t.id),Me(n,Ee.Attack,e.position)),Le(n.gameState,Te.Attack,e.position,Ve,e.id)}},sD={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:En,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==xo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=Q(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=Fo,a=!s&&o<=En;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const u=s?Yu:Pp,d=e.stateMachine[1];return n.gameState.time-d.attackStartTime>=u},perform:(e,t,n)=>{const{gameState:o}=n,s=Q(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>Fo;let l=(a?Cp:Ep)*.8;e.gender==="male"&&(l*=1.2);const u=Object.values(o.entities.entities).filter(f=>f.type==="human"&&f.id!==e.id).filter(f=>{const p=f;return Math.sqrt(Math.pow(p.position.x-e.position.x,2)+Math.pow(p.position.y-e.position.y,2))<100&&p.activeAction==="attacking"&&p.attackTargetId===t.id}).length;if(u>0&&(l*=1+u*.2),a){const f=s/_p;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+f,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Mp,attackerPosition:{...e.position}}}),Le(o,Te.StoneProjectile,e.position,f,void 0,void 0,t.position,t.id),Me(n,Ee.Attack,e.position)}else{t.hitpoints-=l;const f=Ue(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),p=nt(f,8);t.forces.push(p),t.hitpoints<=0?(Me(n,Ee.HumanDeath,t.position),Le(o,Te.Hit,t.position,Ve,void 0,t.id)):(Le(o,Te.Hit,t.position,Ve,void 0,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),Me(n,Ee.Attack,e.position)),Le(o,Te.Attack,e.position,Ve,void 0,e.id)}e.attackCooldown={melee:Cl,ranged:Rp};const d=e.stateMachine[1];d.attackStartTime=o.time}},aD={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:_s,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Le(n.gameState,Te.Procreation,o.position,Ve,o.id),Me(n,Ee.Procreate,o.position)}},lD={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:Rs,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.pregnancyFatherId=e.gender==="male"?e.id:t.id,o.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Le(n.gameState,Te.Procreation,o.position,Ve,o.id),Me(n,Ee.Procreate,o.position)}},cD={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:zI,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Du&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-Du),e.feedChildCooldownTime=XI,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Le(n.gameState,Te.ChildFed,t.position,Ve,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,Ee.ChildFed,t.position)}},uD={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:zI,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Du&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-Du),e.feedChildCooldownTime=XI,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Le(n.gameState,Te.ChildFed,t.position,Ve,void 0,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,Ee.ChildFed,t.position)}},dD={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:Rs,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-jp),e.eatingCooldownTime=n.gameState.time+2,Le(n.gameState,Te.Eating,e.position,Ve,e.id),Me(n,Ee.Gather,e.position))}},fD={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:Rr,checker:(e,t,n)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=n.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,n)=>{let o=$I;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:ju,endTime:n.gameState.time+zu};const s=Ue(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=nt(s,7);t.forces.push(a),e.attackCooldown=WI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-jp),Me(n,Ee.HumanDeath,t.position),Le(n.gameState,Te.Hit,t.position,Ve,t.id)):(Le(n.gameState,Te.Hit,t.position,Ve,t.id),Me(n,Ee.Attack,e.position)),Le(n.gameState,Te.Attack,e.position,Ve,e.id)}},hD=25;function hv(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function gT(e){const t=e.storedItems.length,n=hv(t+e.id)*2*Math.PI,o=hv(t+e.id+1)*hD;return{x:Math.cos(n)*o,y:Math.sin(n)*o}}const pD={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:li,checker:(e,t,n)=>{var f;const o=t.buildingType===$.StorageSpot,s=t.buildingType===$.Bonfire;if(!o&&!s||e.stateMachine[0]!==nl||!t.isConstructed)return!1;const a=e.food.length>0,l=((f=e.heldItem)==null?void 0:f.type)===$t.Wood;if(s&&!l||!a&&!l)return!1;const u=t.storageCapacity??0;return!(t.storedItems.length>=u||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<U_)},perform:(e,t,n)=>{var s;let o=null;t.buildingType===$.Bonfire?((s=e.heldItem)==null?void 0:s.type)===$t.Wood&&(o=e.heldItem,e.heldItem=void 0):e.heldItem?(o=e.heldItem,e.heldItem=void 0):o=e.food.pop()??null,o&&t.storedItems.push({item:o,positionOffset:gT(t)}),t.lastDepositTime=n.gameState.time,Me(n,Ee.StorageDeposit,t.position)}},gD={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:li,checker:(e,t,n)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==il||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<G_),perform:(e,t,n)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&(e.food.push(o.item),gT(t)),t.lastRetrieveTime=n.gameState.time,Me(n,Ee.StorageRetrieve,t.position)}},mD={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:li,checker:(e,t,n)=>{var u;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Bs||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const o=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!o||!((u=o.tribeControl)!=null&&u.diplomacy)||(t.ownerId?o.tribeControl.diplomacy[t.ownerId]:void 0)!==Nt.Hostile||n.gameState.time-(t.lastStealTime??0)<$_)return!1;const l=pI({leaderId:t.ownerId},n.gameState);for(const d of l)if(Q(e.position,d.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=W_)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&e.food.push(o.item),t.lastStealTime=n.gameState.time,Me(n,Ee.StorageSteal,t.position),Le(n.gameState,Te.Attack,t.position,.5)}},yD={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!Ir(e,t,n.gameState)||!qS(t.position,hs,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,KS(t.position,hs,e.id,n.gameState,t.id),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Le(n.gameState,Te.BushClaimed,t.position,2,t.id)}},vD={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>e.activeAction==="dismantling"?!(e.leaderId!==t.ownerId||t.isBeingDestroyed):e.activeAction==="destroyingBuilding"?!(e.leaderId!==e.id||!Ir(e,t,n.gameState)||t.isBeingDestroyed):!1,perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Le(n.gameState,Te.Hit,t.position,1,t.id)}},SD={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:Wu,checker:(e,t,n)=>{const[o]=t.stateMachine??[],s=o===Xn||o===wn||o===Vn;return e.isAdult&&s&&e.stateMachine[0]===Yp&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const{gameState:o}=n;if(t.stateMachine=[Vt,{enteredAt:o.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/Uo),a=Math.floor(av+s*(td-av));t.wood=Array.from({length:a},()=>({itemType:"item",type:$t.Wood,id:o.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=o.time+1,Me(n,Ee.Gather,e.position)}},ID={id:"human-attack-building",sourceType:"human",targetType:"building",maxDistance:40,checker:(e,t,n)=>{const{gameState:o}=n;return!(t.buildingType!==$.Palisade&&t.buildingType!==$.Gate||!t.ownerId||t.ownerId===e.leaderId||e.attackCooldown&&e.attackCooldown.melee>o.time)},perform:(e,t,n)=>{const{gameState:o}=n;t.isBeingDestroyed=!0;const s=.1;t.destructionProgress=Math.min(1,t.destructionProgress+s),e.attackCooldown||(e.attackCooldown={melee:0,ranged:0}),e.attackCooldown.melee=o.time+Cl,Le(o,Te.Hit,t.position,.5,void 0,e.id,void 0,t.id)}},TD=[jb,zb,Xb,Vb,qb,Zb,Kb,...tD,$b,Wb,Yb,pD,gD,mD,yD,vD,SD,ID,nD,cD,uD,dD,iD,oD,sD,rD,fD,aD,lD],pv=Object.values(TD.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const o={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[n].interactions.push(o),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));let gv=0;function mT(e){const{gameState:t}=e,n=t,{width:o,height:s}=t.mapDimensions;gv++;const a=gv%2===0;for(let l=0;l<pv.length;l++){const u=pv[l],d=n.search[u.sourceType].all();for(let f=0;f<d.length;f++){const p=d[f],m=n.search[u.targetType].byRadius(p.position,u.maxDistance);for(let v=0;v<m.length;v++){const y=m[v];if(p.id===y.id)continue;const I=Pt(p.position,y.position,o,s);for(let T=0;T<u.interactions.length;T++){const A=u.interactions[T];!A.isCollision&&a||I<=A.maxDistanceSq&&A.checker(p,y,e)&&A.perform(p,y,e)}}}}}function qp(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function AD(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),o=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const d=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,p=50+Math.random()*100;a={x:Math.max(50,Math.min(Ye-50,d.position.x+Math.cos(f)*p)),y:Math.max(50,Math.min(je-50,d.position.y+Math.sin(f)*p))}}else a={x:50+Math.random()*(Ye-100),y:50+Math.random()*(je-100)};let l=!0;const u=100;for(const d of n)if(Math.sqrt((a.x-d.position.x)**2+(a.y-d.position.y)**2)<u){l=!1;break}if(l){for(const d of o)if(Math.sqrt((a.x-d.position.x)**2+(a.y-d.position.y)**2)<u){l=!1;break}}if(l)return a}return{x:Ye*.3+Math.random()*Ye*.4,y:je*.3+Math.random()*je*.4}}function wD(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const d=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,p=100+Math.random()*150;a={x:Math.max(50,Math.min(Ye-50,d.position.x+Math.cos(f)*p)),y:Math.max(50,Math.min(je-50,d.position.y+Math.sin(f)*p))}}else a={x:50+Math.random()*(Ye-100),y:50+Math.random()*(je-100)};let l=!0;const u=150;for(const d of n)if(Math.sqrt((a.x-d.position.x)**2+(a.y-d.position.y)**2)<u){l=!1;break}if(l)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Ye,y:50+Math.random()*100};case 1:return{x:Ye-150+Math.random()*100,y:Math.random()*je};case 2:return{x:Math.random()*Ye,y:je-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*je}}}function ED(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let o=0;o<20;o++){const s={x:50+Math.random()*(Ye-100),y:50+Math.random()*(je-100)};let a=!0;const l=80,u=60;for(const d of t)if(Math.sqrt((s.x-d.position.x)**2+(s.y-d.position.y)**2)<l){a=!1;break}if(a){for(const d of n)if(Math.sqrt((s.x-d.position.x)**2+(s.y-d.position.y)**2)<u){a=!1;break}}if(a)return s}return{x:Math.random()*Ye,y:Math.random()*je}}function yT(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let o=0;o<t;o++){const s=AD(n),a=o%2===0?"male":"female";ks(e.entities,s,a,void 0,void 0,yl())}}function vT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let o=0;o<t;o++){const s=wD(n),a=o%2===0?"male":"female";bs(e.entities,s,a,void 0,void 0,vl())}}function CD(e){const t=e,n=t.search.prey.count(),o=t.search.predator.count();let s=!1;return n===0&&(yT(e,6),s=!0),o===0&&(vT(e,3),s=!0),s}function PD(e){const t=e,n=t.search.prey.count(),o=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const l=Math.max(2,Math.floor(8-n));yT(e,l),a=!0}if(o>0&&o<2){const l=Math.max(1,Math.floor(3-o));vT(e,l),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let l=0;l<5;l++){const u=ED(t);bl(e.entities,u,e.time)}a=!0}return a}const _D=1,RD=.3,MD=.8,mv=.8,kD=.99,bD=.05;var ST=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.INCREASE_TREE_SPREAD=14]="INCREASE_TREE_SPREAD",e[e.DECREASE_TREE_SPREAD=15]="DECREASE_TREE_SPREAD",e[e.NO_ACTION=16]="NO_ACTION",e))(ST||{});const wh=Object.keys(ST).length/2;class DD{constructor(){xt(this,"qTable",new Map);xt(this,"epsilon",mv);xt(this,"lastState",null);xt(this,"lastAction",null)}discretizeState(t,n,o,s){const a=Math.min(4,Math.floor(t/25)),l=Math.min(4,Math.floor(n/5)),u=Math.min(4,Math.floor(o/15)),d=Math.min(4,Math.floor(s/50));return`${a}-${l}-${u}-${d}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,o){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,o)}getBestAction(t){let n=0,o=this.getQValue(t,0);for(let s=1;s<wh;s++){const a=this.getQValue(t,s);a>o&&(o=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*wh):this.getBestAction(t)}applyEmergencyCorrections(t,n,o,s,a){t<ji*.5&&(a.ecosystem.preyGestationPeriod=Math.max(as,a.ecosystem.preyGestationPeriod*.8),a.ecosystem.preyProcreationCooldown=Math.max(ls,a.ecosystem.preyProcreationCooldown*.8),a.ecosystem.preyHungerIncreasePerHour=Math.max(ds,a.ecosystem.preyHungerIncreasePerHour*.9)),n<zi*.6&&(a.ecosystem.predatorGestationPeriod=Math.max(cs,a.ecosystem.predatorGestationPeriod*.75),a.ecosystem.predatorProcreationCooldown=Math.max(us,a.ecosystem.predatorProcreationCooldown*.75),a.ecosystem.predatorHungerIncreasePerHour=Math.max(fs,a.ecosystem.predatorHungerIncreasePerHour*.85)),o<Xi*.5&&(a.ecosystem.berryBushSpreadChance=Math.min(Wa,a.ecosystem.berryBushSpreadChance*1.2)),s<Vi*.5&&(a.ecosystem.treeSpreadChance=Math.min(Xa,a.ecosystem.treeSpreadChance*1.2)),t>ji*1.4&&(a.ecosystem.preyHungerIncreasePerHour=Math.min(Do,a.ecosystem.preyHungerIncreasePerHour*1.05)),n>zi*1.4&&(a.ecosystem.predatorHungerIncreasePerHour=Math.min(Oo,a.ecosystem.predatorHungerIncreasePerHour*1.05)),o>Xi*1.4&&(a.ecosystem.berryBushSpreadChance=Math.max(qi,a.ecosystem.berryBushSpreadChance*.95)),s>Vi*1.4&&(a.ecosystem.treeSpreadChance=Math.max(Zi,a.ecosystem.treeSpreadChance*.95))}calculateReward(t,n,o,s){const a=Math.abs(t-ji),l=Math.abs(n-zi),u=Math.abs(o-Xi),d=Math.abs(s-Vi),f=a/ji,p=l/zi,m=u/Xi,v=d/Vi,y=f+p+m+v;return 100*Math.exp(-y*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(dr,n.ecosystem.preyGestationPeriod+.2*(dr-as));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(as,n.ecosystem.preyGestationPeriod-.2*(dr-as));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(fr,n.ecosystem.preyProcreationCooldown+.2*(fr-ls));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max(ls,n.ecosystem.preyProcreationCooldown-.2*(fr-ls));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(Do,n.ecosystem.preyHungerIncreasePerHour+.2*(Do-ds));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(ds,n.ecosystem.preyHungerIncreasePerHour-.2*(Do-ds));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(hr,n.ecosystem.predatorGestationPeriod+.2*(hr-cs));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max(cs,n.ecosystem.predatorGestationPeriod-.2*(hr-cs));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min(pr,n.ecosystem.predatorProcreationCooldown+.2*(pr-us));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(us,n.ecosystem.predatorProcreationCooldown-.2*(pr-us));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(Oo,n.ecosystem.predatorHungerIncreasePerHour+.2*(Oo-fs));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(fs,n.ecosystem.predatorHungerIncreasePerHour-.2*(Oo-fs));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(Wa,n.ecosystem.berryBushSpreadChance+.2*(Wa-qi));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(qi,n.ecosystem.berryBushSpreadChance-.2*(Wa-qi));break;case 14:n.ecosystem.treeSpreadChance=Math.min(Xa,n.ecosystem.treeSpreadChance+.2*(Xa-Zi));break;case 15:n.ecosystem.treeSpreadChance=Math.max(Zi,n.ecosystem.treeSpreadChance-.2*(Xa-Zi));break}}updateQTable(t,n,o,s){const a=this.getQValue(t,n),l=Math.max(...Array.from({length:wh},(d,f)=>this.getQValue(s,f))),u=a+RD*(o+MD*l-a);this.setQValue(t,n,u)}step(t){const n=t,o=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count(),l=n.search.tree.count();this.applyEmergencyCorrections(o,s,a,l,t);const u=this.discretizeState(o,s,a,l);if(this.lastState!==null&&this.lastAction!==null){const f=this.calculateReward(o,s,a,l);this.updateQTable(this.lastState,this.lastAction,f,u)}const d=this.chooseAction(u);this.applyAction(d,t),this.epsilon=Math.max(bD,this.epsilon*kD),this.lastState=u,this.lastAction=d}reset(){this.qTable.clear(),this.epsilon=mv,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let IT=new DD;function OD(e){CD(e),PD(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=as+(dr-as)*.3,e.ecosystem.preyProcreationCooldown=ls+(fr-ls)*.3,e.ecosystem.preyHungerIncreasePerHour=ds+(Do-ds)*.3,e.ecosystem.predatorGestationPeriod=cs+(hr-cs)*.3,e.ecosystem.predatorProcreationCooldown=us+(pr-us)*.3,e.ecosystem.predatorHungerIncreasePerHour=fs+(Oo-fs)*.3,e.ecosystem.berryBushSpreadChance=qi+(Wa-qi)*.7,e.ecosystem.treeSpreadChance=Zi+(Xa-Zi)*.2),IT.step(e)}function ND(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<_D)&&(e.ecosystem.lastUpdateTime=e.time,OD(e))}function BD(){return IT.getStats()}function HD(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function FD(e){const{gameState:t}=e,n=t.time,o=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of o)switch(a.type){case"ranged-impact":{const l=t.entities.entities[a.data.targetId];if(!l||l.hitpoints<=0)continue;l.hitpoints-=a.data.damage,l.movementSlowdown={modifier:ju,endTime:t.time+zu};const u=Ue(a.data.attackerPosition,l.position,t.mapDimensions.width,t.mapDimensions.height),d=nt(u,a.data.pushbackForce);l.forces.push(d),Le(t,Te.Hit,l.position,Ve,l.id),l.hitpoints<=0?Me(e,Ee.HumanDeath,l.position):Me(e,Ee.Attack,l.position);break}}}function id(e,t){const{width:n,height:o}=t.mapDimensions,s=Math.ceil(n/ge),a=Math.ceil(o/ge),l=new Set,u=t.terrainOwnership;for(let d=0;d<u.length;d++){if(u[d]!==e)continue;const f=d%s,p=Math.floor(d/s),m=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];let v=!1;for(const{dx:y,dy:I}of m){const T=(f+y+s)%s,R=(p+I+a)%a*s+T;if(u[R]!==e){v=!0;break}}v&&l.add(d)}return l}function TT(e,t,n){const o=[],s=new Set,a=l=>{const u=l%t,d=Math.floor(l/t),f=[{dx:1,dy:0},{dx:1,dy:1},{dx:0,dy:1},{dx:-1,dy:1},{dx:-1,dy:0},{dx:-1,dy:-1},{dx:0,dy:-1},{dx:1,dy:-1}];for(const{dx:p,dy:m}of f){const v=(u+p+t)%t,I=(d+m+n)%n*t+v;if(e.has(I)&&!s.has(I))return I}return null};for(const l of e){if(s.has(l))continue;const u=[l];s.add(l);let d=l,f;for(;(f=a(d))!==null;)u.push(f),s.add(f),d=f;o.push(u)}return o}function AT(e,t){const{width:n,height:o}=t.mapDimensions,s=Math.ceil(n/ge),a=Math.ceil(o/ge),l=id(e,t),d=TT(l,s,a).filter(v=>v.length>=3),f=[],p=Math.ceil(zS/ge),m=2;for(const v of d){let y=p;for(let I=0;I<v.length;I++){const T=v[I],A=Tr(T,n);y>=p?(f.push({position:A,type:$.Gate}),y=0,I+=m):(f.push({position:A,type:$.Palisade}),y++)}}return f}function wT(e,t,n){const o=id(e,t);if(o.size===0)return 1;const{width:s,height:a}=t.mapDimensions;let l=0;const u=(hl+10)**2;for(const d of o){const f=Tr(d,s);n.some(m=>Pt(f,m.position,s,a)<u)&&l++}return l/o.size}const ET="ownedIndices",yv="frontierScanIndex",ol="frontierCandidates";function LD(e){var f;const{gameState:t}=e,n=t,s=n.search.human.all().filter(p=>p.leaderId===p.id),{width:a,height:l}=t.mapDimensions,u=Math.ceil(a/ge),d=Math.ceil(l/ge);for(const p of s){if(!p.aiBlackboard||(f=p.tribeControl)!=null&&f.stopExpansion)continue;const m=Ne.get(p.aiBlackboard,ET)||[];if(m.length===0)continue;let v=Ne.get(p.aiBlackboard,yv)||0;const y=Ne.get(p.aiBlackboard,ol)||{},I=Ei(p.id,t),T=20;for(let R=0;R<T;R++){v>=m.length&&(v=0);const _=m[v];v=(v+1)%m.length;const C=_%u,M=Math.floor(_/u),E=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:P,dy:k}of E){const B=(C+P+u)%u,j=(M+k+d)%d,Z=j*u+B,X=t.terrainOwnership[Z],ie=X!==null&&ui(p.id,X,t);if(X===null||ie){let ee=0;for(const{dx:fe,dy:pe}of E){const re=(B+fe+u)%u,oe=(j+pe+d)%d;t.terrainOwnership[oe*u+re]===p.id&&ee++}const te=ee*20,K=Tr(Z,a),ue=n.search.berryBush.byRadius(K,100),ce=n.search.tree.byRadius(K,100),Y=ue.length*10+ce.length*5,J=ie?50:0,D=Q(K,I,a,l)/100*5,L=te+Y+J-D;y[Z.toString()]={score:L,fromIdx:_,lastSeenTime:t.time}}}}const A=Object.entries(y).sort((R,_)=>_[1].score-R[1].score);if(A.length>50){const R={};for(let _=0;_<50;_++){const[C,M]=A[_];R[C]=M}Ne.set(p.aiBlackboard,ol,R)}else Ne.set(p.aiBlackboard,ol,y);Ne.set(p.aiBlackboard,yv,v)}}function xD(e,t,n){var v;const{gameState:o}=n,s=o,{width:a,height:l}=o.mapDimensions,u=o.entities.entities[e];if(!u)return;const d=id(e,o);if(d.size<As){u.tribeControl&&(u.tribeControl.stopExpansion=!1);return}const f=t.filter(y=>y.buildingType===$.Palisade||y.buildingType===$.Gate);for(const y of f){const I=XS(y.position,a,l);if(!d.has(I)&&o.terrainOwnership[I]===e){const A=`Dismantle-${y.id}`;o.tasks[A]||(o.tasks[A]={id:A,type:z.HumanDismantleBuilding,position:y.position,creatorEntityId:e,target:y.id,validUntilTime:o.time+24})}}const p=wT(e,o,f);if(1-p>bC?(u.tribeControl||(u.tribeControl={diplomacy:{}}),u.tribeControl.stopExpansion=!0):p>=.9&&u.tribeControl&&(u.tribeControl.stopExpansion=!1),Object.keys(o.tasks).forEach(y=>{const I=o.tasks[y];I.creatorEntityId===e&&(I.type===z.HumanPlacePalisade||I.type===z.HumanPlaceGate)&&delete o.tasks[y]}),(v=u.tribeControl)!=null&&v.stopExpansion){const y=AT(e,o);for(const I of y){const T=I.position;if(s.search.building.at(T,20)||f.some(P=>Pt(T,P.position,a,l)<hl*hl))continue;const _=s.search.tree.byRadius(T,Ce*1.5);if(_.length>0){const P=_[0],k=`Chop-Gord-${P.id}`;o.tasks[k]||(o.tasks[k]={id:k,type:z.HumanChopTree,position:P.position,creatorEntityId:e,target:P.id,validUntilTime:o.time+12});continue}if(s.search.human.byRadius(T,20).length>0)continue;const M=I.type===$.Gate?z.HumanPlaceGate:z.HumanPlacePalisade,E=`${z[M]}-${e}-${Math.floor(T.x)}-${Math.floor(T.y)}`;o.tasks[E]||(o.tasks[E]={id:E,type:M,position:T,creatorEntityId:e,target:T,validUntilTime:o.time+24})}}}function UD(e){var m;const{gameState:t}=e,n=t,o=n.search.human.all(),s=new Map,a=new Set;for(let v=0;v<o.length;v++){const y=o[v];y.leaderId&&(s.has(y.leaderId)||s.set(y.leaderId,[]),s.get(y.leaderId).push(y),y.leaderId===y.id&&a.add(y.id))}const l=Object.values(t.tasks),u=new Map;for(let v=0;v<l.length;v++){const y=l[v];y.creatorEntityId&&(u.has(y.creatorEntityId)||u.set(y.creatorEntityId,[]),u.get(y.creatorEntityId).push(y))}const d=n.search.building.all(),f=new Map;for(let v=0;v<d.length;v++){const y=d[v];if(y.ownerId){const I=t.entities.entities[y.ownerId],T=I==null?void 0:I.leaderId;T&&(f.has(T)||f.set(T,[]),f.get(T).push(y))}}const p=new Map;for(const v of a)p.set(v,Ei(v,t));for(const v of a){const y=t.entities.entities[v];if(!y)continue;const I=[];for(let X=0;X<t.terrainOwnership.length;X++)t.terrainOwnership[X]===v&&I.push(X);Ne.set(y.aiBlackboard,ET,I);const T=s.get(v)||[];if(T.length<v_)continue;const A=T.filter(X=>X.isAdult);if(A.length===0)continue;const R=u.get(v)||[],_=X=>R.some(ie=>ie.type===X),C=f.get(v)||[];xD(v,C,e);const M=[];for(const[X,ie]of p.entries())X!==v&&M.push(ie);if(!_(z.HumanPlaceStorage)){const X=C.filter(ue=>ue.buildingType===$.StorageSpot);let ie=0,ee=0;for(let ue=0;ue<X.length;ue++){const ce=X[ue];ie+=((m=ce.storedItems)==null?void 0:m.length)||0,ee+=ce.storageCapacity||0}const te=ee>0?ie/ee:0;if(X.length===0||te>IC){const ue=X.length===0?wC:lh,ce=cu($.StorageSpot,v,t,ah,ue,y.position,M);ce&&Zc(v,z.HumanPlaceStorage,ce,t)}}if(!_(z.HumanPlaceBonfire)){const X=C.filter(Y=>Y.buildingType===$.Bonfire),ie=p.get(v),te=Sl(t.temperature,ie,t.time,t.mapDimensions.width,t.mapDimensions.height)<$C&&X.length===0,K=X.length>0&&X.length<Math.ceil(A.length/zC);let ue;const ce=T.filter(Y=>Sl(t.temperature,Y.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<ur+5?X.every(D=>Q(Y.position,D.position,t.mapDimensions.width,t.mapDimensions.height)>Qa*1.5):!1);if(ce.length>=3){const Y=ce.reduce((V,D)=>V+D.position.x,0)/ce.length,J=ce.reduce((V,D)=>V+D.position.y,0)/ce.length;ue={x:Y,y:J}}if(te||K||ue){const Y=cu($.Bonfire,v,t,ah,lh,ue||y.position,M);Y&&Zc(v,z.HumanPlaceBonfire,Y,t)}}if(!_(z.HumanPlacePlantingZone)){const ie=C.filter(te=>te.buildingType===$.PlantingZone&&o_(te,t)).reduce((te,K)=>te+yI(K),0),ee=Math.max(AC,A.length*TC);if(ie<ee){const te=cu($.PlantingZone,v,t,ah,lh,y.position,M);te&&Zc(v,z.HumanPlacePlantingZone,te,t)}}const E=Ne.get(y.aiBlackboard,ol)||{},{width:P,height:k}=t.mapDimensions,B=C.filter(X=>X.buildingType===$.BorderPost),j=R.filter(X=>X.type===z.HumanPlaceBorderPost);for(const X in E){const ie=parseInt(X,10),ee=t.terrainOwnership[ie],te=ee!==null&&ui(y.id,ee,t);if(ee===v||ee!==null&&!te){delete E[X];continue}const K=Tr(ie,P);(B.some(ce=>Pt(K,ce.position,P,k)<100*100)||j.some(ce=>Pt(K,ce.position,P,k)<100*100))&&delete E[X]}Ne.set(y.aiBlackboard,ol,E);const Z=3;if(j.length<Z){const X=Object.entries(E).map(([K,ue])=>({idx:parseInt(K,10),...ue})).sort((K,ue)=>ue.score-K.score),ie=[];for(const K of X){if(ie.length>=Z-j.length)break;const ue=Tr(K.idx,P);ie.every(Y=>Pt(ue,Y,P,k)>100*100)&&ie.push(ue)}const ee=new Set(j.map(K=>{const ue=K.id.split("-");return parseInt(ue[ue.length-1],10)}).filter(K=>!isNaN(K))),te=[];for(let K=0;K<Z;K++)ee.has(K)||te.push(K);for(let K=0;K<ie.length;K++)Zc(v,z.HumanPlaceBorderPost,ie[K],t,te[K])}}}function Zc(e,t,n,o,s=0){const a=`${z[t]}-${e}-${s}`;o.tasks[a]={id:a,position:n,type:t,creatorEntityId:e,target:n,validUntilTime:o.time+12}}function GD(e){const{gameState:t}=e,s=t.search.human.all().filter(a=>a.leaderId===a.id);for(const a of s){if(!a.aiBlackboard)continue;const l=`diplomacy-${a.id}`;if(t.tasks[l])continue;const u=Ne.get(a.aiBlackboard,"lastDiplomacyCheckTime")??-1/0;if(t.time-u<_y)continue;const d={id:l,type:z.HumanDiplomacy,position:a.position,creatorEntityId:a.id,validUntilTime:t.time+_y};t.tasks[l]=d}}function CT(e){var o;const n=e.pathfindingQueue.splice(0,10);for(const s of n){const a=e.entities.entities[s];if(a&&a.type==="human"&&a.target){let l;if(typeof a.target=="object"?l=a.target:l=(o=e.entities.entities[a.target])==null?void 0:o.position,l){const{path:u,isBestEffort:d}=BI(e,a.position,l,a);if(u&&!d)a.path=u,a.pathTarget={...l},a.trappedByObstacleId=void 0;else{u&&(a.path=u,a.pathTarget={...l});const{width:f,height:p}=e.mapDimensions,m=Ue(a.position,l,f,p),v=Math.sqrt(m.x*m.x+m.y*m.y);if(v<.001)continue;const y=Math.ceil(Math.min(v,100)/(Ce/2)),I=m.x/y,T=m.y/y,A=m.x/v,_=-(m.y/v),C=A,M=a.radius*.6;let E;for(let P=0;P<=Math.min(y,40);P++){const k={x:a.position.x+I*P,y:a.position.y+T*P},B=[k,{x:k.x+_*M,y:k.y+C*M},{x:k.x-_*M,y:k.y-C*M},{x:k.x+_*M*.5,y:k.y+C*M*.5},{x:k.x-_*M*.5,y:k.y-C*M*.5}];for(const j of B){const Z=NI(j,f,p);if(!ml(e.navigationGrid,Z,a.leaderId,!1)){const X=e.search.building.at(j,Ce*1.5);if(X){E=X.id;break}const ie=e.search.tree.at(j,Ce*1.5);if(ie){const[ee]=ie.stateMachine??[];if(ee===Xn||ee===wn||ee===Vn){E=ie.id;break}}}}if(E!==void 0)break}a.trappedByObstacleId=E}}}}}const $D=1/60;function WD(e,t){if(!e.cameraFollowingPlayer)return;const n=kt(e);n&&(e.viewportCenter=hu(e.viewportCenter,n.position,Su*t))}function od(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(dp(e),e.lastAutosaveTime=n)}for(;t>0;){const n=wl(e),o=Math.min(t,$D),s=o*(Bt/Gt);n.time+=s,WD(n,o),hC(n),wM(n),ND(n),d_(n),gM(n),pC(n),FD({gameState:n}),uT({gameState:n,deltaTime:o}),mT({gameState:n,deltaTime:o}),LD({gameState:n}),CT(n),Math.floor(n.time)>Math.floor(n.time-s)&&(t_(n),UD({gameState:n}),GD({gameState:n})),qp(n),bb(n,o),HD(n),e=n,t-=o}return e}var nn=(e=>(e.None="None",e.GreatHarvest="GreatHarvest",e.GreenThumb="GreenThumb",e.LumberjackFever="LumberjackFever",e.WinterPrep="WinterPrep",e.BabyBoom="BabyBoom",e.ManifestDestiny="ManifestDestiny",e.IronCurtain="IronCurtain",e.Warpath="Warpath",e.ActiveDefense="ActiveDefense",e.RaidingParty="RaidingParty",e))(nn||{});const Tl=[{name:"ECONOMIC",icon:"",objectives:[{objective:nn.GreatHarvest,icon:"",name:"GREAT HARVEST"},{objective:nn.GreenThumb,icon:"",name:"GREEN THUMB"},{objective:nn.LumberjackFever,icon:"",name:"LUMBERJACK"},{objective:nn.WinterPrep,icon:"",name:"WINTER PREP"}]},{name:"GROWTH",icon:"",objectives:[{objective:nn.BabyBoom,icon:"",name:"BABY BOOM"},{objective:nn.ManifestDestiny,icon:"",name:"MANIFEST"},{objective:nn.IronCurtain,icon:"",name:"IRON CURTAIN"}]},{name:"MILITARY",icon:"",objectives:[{objective:nn.Warpath,icon:"",name:"WARPATH"},{objective:nn.ActiveDefense,icon:"",name:"DEFENSE"},{objective:nn.RaidingParty,icon:"",name:"RAIDING"}]}];function PT(e){if(e===nn.None)return"NONE";for(const t of Tl){const n=t.objectives.find(o=>o.objective===e);if(n)return n.name}return"STRATEGY"}function _T(e){if(e===nn.None)return"";for(const t of Tl){const n=t.objectives.find(o=>o.objective===e);if(n)return n.icon}return""}function YD(e,t,n,o){var ie;const s=kt(t);if(!s||s.leaderId!==s.id)return;const a=t.entities.entities[s.leaderId];if(!a)return;const l=((ie=a.tribeControl)==null?void 0:ie.strategicObjective)||nn.None,d=Lo(s.leaderId,t).length,f=3,p=Math.round(qh*.85),m=OP,v=Math.round(It*1.2),y=Cu,I=Math.round(It*.7),T=Cu+Re,A=Re*.6;let R=v+y+m;R+=y+A;for(const ee of Tl){const te=Math.ceil(ee.objectives.length/f),K=te*p+(te-1)*m;R+=I+K+A}const _=f*p+(f-1)*m+Re*2,C=R+T+Re*2,E=o-qh-20-m,P=Math.max(Re,Math.floor((n-_)/2)),k=Math.max(Re,Math.floor(E-C));e.save(),e.fillStyle=gn,e.globalAlpha=.95,e.fillRect(P,k,_,C),e.globalAlpha=1,e.strokeStyle=jn,e.lineWidth=2,e.strokeRect(P,k,_,C);let B=k+Re;e.fillStyle=dt,e.font=`${Math.round(It*.7)}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("STRATEGIC COMMAND",P+_/2,B+v/2),B+=v;const j=`${_T(l)} ${PT(l)}`;e.fillStyle=jn,e.fillRect(P+Re,B,_-Re*2,y),e.strokeStyle=_u,e.lineWidth=1,e.strokeRect(P+Re,B,_-Re*2,y),e.fillStyle=dt,e.font=`${Math.round(It*.6)}px "Press Start 2P", Arial`,e.textAlign="center",e.fillText(j,P+_/2,B+y/2),B+=y+m;const Z=l===nn.None;e.fillStyle=Z?jn:gn,e.fillRect(P+Re,B,_-Re*2,y),e.strokeStyle=jn,e.lineWidth=1,e.strokeRect(P+Re,B,_-Re*2,y),e.fillStyle=dt,e.font=`${Math.round(It*.6)}px "Press Start 2P", Arial`,e.textAlign="center",e.fillText(" NONE",P+_/2,B+y/2),t.uiButtons.push({id:"strategic_objective_none",action:Oe.SelectStrategicObjective,rect:{x:P+Re,y:B,width:_-Re*2,height:y},text:"",backgroundColor:"transparent",textColor:dt,currentWidth:_-Re*2,objective:nn.None}),B+=y+A;for(const ee of Tl){e.fillStyle=Bp,e.font=`${Math.round(It*.55)}px "Press Start 2P", Arial`,e.textAlign="left",e.fillText(`${ee.icon} ${ee.name}`,P+Re,B+I/2),B+=I,ee.objectives.forEach((K,ue)=>{const ce=Math.floor(ue/f),Y=ue%f,J=P+Re+Y*(p+m),V=B+ce*(p+m),D=l===K.objective;e.fillStyle=D?jn:gn,e.fillRect(J,V,p,p),e.strokeStyle=D?_u:jn,e.lineWidth=1,e.strokeRect(J,V,p,p),e.fillStyle=dt,e.textAlign="center",e.textBaseline="middle",e.font=`${Math.round(p*.35)}px "Press Start 2P", Arial`,e.fillText(K.icon,J+p/2,V+p*.35),e.font=`${Math.round(It*.45)}px "Press Start 2P", Arial`,e.fillText(K.name,J+p/2,V+p*.72),t.uiButtons.push({id:`strategic_objective_${K.objective}`,action:Oe.SelectStrategicObjective,rect:{x:J,y:V,width:p,height:p},text:"",backgroundColor:"transparent",textColor:dt,currentWidth:p,objective:K.objective})});const te=Math.ceil(ee.objectives.length/f);B+=te*p+(te-1)*m+A}const X=k+C-T;e.fillStyle=jn,e.fillRect(P+Re,X,_-Re*2,T-Re/2),e.strokeStyle=jn,e.strokeRect(P+Re,X,_-Re*2,T-Re/2),e.fillStyle=dt,e.font=`${Math.round(It*.5)}px "Press Start 2P", Arial`,e.textAlign="left",e.fillText(`POP: ${d}`,P+Re+8,X+T/2-6),e.fillText("MORALE: 80%",P+Re+8,X+T/2+8),e.restore()}function vv(e,t,n){e.save();const{x:o,y:s,width:a,height:l}=t.rect,u=rI;if(e.beginPath(),e.moveTo(o+u,s),e.lineTo(o+a-u,s),e.quadraticCurveTo(o+a,s,o+a,s+u),e.lineTo(o+a,s+l-u),e.quadraticCurveTo(o+a,s+l,o+a-u,s+l),e.lineTo(o+u,s+l),e.quadraticCurveTo(o,s+l,o,s+l-u),e.lineTo(o,s+u),e.quadraticCurveTo(o,s,o+u,s),e.closePath(),e.fillStyle=t.isDisabled?sI:t.backgroundColor,e.fill(),t.activated){e.save();const d=(Math.sin(Date.now()/1e3*lI)+1)/2;e.strokeStyle=_u,e.lineWidth=2+d*2,e.globalAlpha=.7+d*.3,e.stroke(),e.restore()}if(t.lastActivated){const d=Date.now()-t.lastActivated;if(d<Pu){const f=1-d/Pu;e.fillStyle=aI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Np,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?Bp:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+a-4,s+l-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+a/2,s+l/2)),e.restore()}function jD(e,t,n,o){e.save(),e.font=`${Ny}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,l=Ny,u=a+By*2,d=l+By*2,f=o.x-u/2,p=e.canvas.height,m=t.y<p/2?t.y+t.height-Hy:t.y-d+Hy;e.fillStyle=vP,e.fillRect(f,m,u,d),e.fillStyle=SP,e.fillText(n,o.x,m+d/2+l/2),e.restore()}function zD(e,t,n){var d;e.save();const o=kt(t),s=[{id:"fastForwardButton",action:Oe.FastForward,text:"FFWD [T]",currentWidth:Yi*1.3,backgroundColor:gn,textColor:dt,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:Oe.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?jn:gn,currentWidth:t.isPaused?Yi*1.4:Yi*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:dt},{id:"muteButton",action:Oe.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?jn:gn,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:Yi,rect:{x:0,y:0,width:0,height:0},textColor:dt},{id:"returnToIntroButton",action:Oe.ReturnToIntro,text:"EXIT",backgroundColor:gn,tooltip:"Return to Main Menu [ESC]",currentWidth:Yi*.9,rect:{x:0,y:0,width:0,height:0},textColor:dt}];t.uiButtons.push(...s);let a=null;if(o){const f=o.leaderId?t.entities.entities[o.leaderId]:void 0,p=(d=f==null?void 0:f.tribeControl)==null?void 0:d.strategicObjective,m=Tl.some(M=>M.objectives.length>0),v=p?_T(p):m?"":"",y=p?PT(p):"STRATEGY",I=`${v} ${y}`,T=220,A=qh,R=Math.floor((n-T)/2),_=e.canvas.height-A-20,C={id:"commandButton_Strategy",action:Oe.ToggleStrategicMenu,rect:{x:R,y:_,width:T,height:A},text:I,backgroundColor:t.strategicMenuOpen?jn:gn,textColor:dt,currentWidth:T,tooltip:"Strategic command",activated:t.strategicMenuOpen};t.uiButtons.push(C),vv(e,C,t.hoveredButtonId===C.id),a={x:C.rect.x,y:C.rect.y,width:C.rect.width,height:C.rect.height}}let l=n-Re;s.forEach(f=>{const p=Re,m=l-f.currentWidth;f.rect={x:m,y:p,width:f.currentWidth,height:Cu},vv(e,f,t.hoveredButtonId===f.id),l-=f.currentWidth+yP});const u=t.hoveredButtonId?t.uiButtons.find(f=>f.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&jD(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:a}}function XD(e){e.save(),e.fillStyle=IP,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=TP,e.font=`${AP}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function ip(e,t,n,o){const s=t.x-n.width/2,a=t.y-n.height/2,l=s+e.x,u=a+e.y,d=(l%o.width+o.width)%o.width,f=(u%o.height+o.height)%o.height;return{x:d,y:f}}function Dl(e,t,n,o){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>o.width/2&&(s=s-Math.sign(s)*o.width),Math.abs(a)>o.height/2&&(a=a-Math.sign(a)*o.height),{x:s+n.width/2,y:a+n.height/2}}function rl(e,t,n,o){const s=Dl(e.position,t,n,o),l=("radius"in e?e.radius:20)+20;return s.x>=-l&&s.x<=n.width+l&&s.y>=-l&&s.y<=n.height+l}function $n(e,t,n,o,s,...a){const l={...s.position};for(let u=-n;u<=n;u+=n)for(let d=-t;d<=t;d+=t)s.position.x=l.x+d,s.position.y=l.y+u,o(e,s,...a);s.position=l}function RT(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const o=n.getContext("2d");if(!o)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:n,ctx:o}}function Nn(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function Pr(e,t){return Math.round(e*t)/t}function Zp(e,t=8){const o=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(o/(Math.PI*2)*t)%t}function Kp(e,t=8){const n=e/t*Math.PI*2;return[Math.cos(n),Math.sin(n)]}function Qp(e,t,n){var p,m;const{width:o,height:s}=n.mapDimensions;let a,l;const u=t;if(u.target&&(typeof u.target=="object"&&"x"in u.target&&"y"in u.target?a=u.target:typeof u.target=="number"&&(l=u.target,a=(p=n.entities.entities[u.target])==null?void 0:p.position)),!a){const v=Il(t),y=v?n.tasks[v]:null;y&&y.target&&(typeof y.target=="object"&&"x"in y.target&&"y"in y.target?a=y.target:typeof y.target=="number"&&(l=y.target,a=(m=n.entities.entities[y.target])==null?void 0:m.position))}if(!a)return;e.save();const d=Ue(t.position,a,o,s),f={x:t.position.x+d.x,y:t.position.y+d.y};if(e.setLineDash([5,5]),e.strokeStyle="rgba(255, 165, 0, 0.5)",e.lineWidth=2,e.beginPath(),e.moveTo(t.position.x,t.position.y),e.lineTo(f.x,f.y),e.stroke(),l){const v=n.entities.entities[l];if(v){const T=2+(Math.sin(n.time*5)+1)/2*2;e.setLineDash([]),e.beginPath(),e.arc(f.x,f.y,v.radius+5,0,Math.PI*2),e.strokeStyle="rgba(255, 165, 0, 0.8)",e.lineWidth=T,e.stroke()}}else{e.setLineDash([]),e.strokeStyle="rgba(255, 165, 0, 0.9)",e.lineWidth=2;const v=10;e.beginPath(),e.moveTo(f.x-v,f.y),e.lineTo(f.x+v,f.y),e.moveTo(f.x,f.y-v),e.lineTo(f.x,f.y+v),e.stroke(),e.beginPath(),e.arc(f.x,f.y,v*.7,0,Math.PI*2),e.stroke()}e.restore()}const VD=25,qD=0,Sv=28;function MT(e,t,n,o,s,a,l,u,d,f){e.save();const{x:p,y:m}=Dl(t,l,{width:u,height:d},f);e.strokeStyle=o,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(p,m,n+Xu,0,2*Math.PI),e.stroke(),e.restore()}function ZD(e,t,n,o,s,a,l){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&MT(e,m.targetEntity.position,m.targetEntity.radius,Dp,Op,2,o,s,a,l)}),e.font=`${ws}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:u,y:d}=Dl(n.position,o,{width:s,height:a},l);let f=0,p={};t.forEach(m=>{const v=xp[m.type];if(m.targetEntity){p[m.targetEntity.id]=(p[m.targetEntity.id]||0)+1;const y=m.targetEntity.position.x-o.x+s/2,I=m.targetEntity.position.y-o.y+a/2,T=`${v}${m.key.toUpperCase()}`,A=I-m.targetEntity.radius-Xu-ws/2-(p[m.targetEntity.id]-1)*Sv;e.fillText(T,y,A)}else{e.textAlign="left";const y=`${v}${m.key.toUpperCase()}`,I=u+VD,A=d+qD+f*Sv;e.fillText(y,I,A),f++,e.textAlign="center"}}),e.restore()}function KD(e,t,n,o,s,a,l){const f=fh+8+30,p={x:Gy,y:a-Gy-f,width:fh,height:fh};t.minimapRect=p,e.save(),e.fillStyle=VP,e.fillRect(p.x,p.y,p.width,p.height),e.strokeStyle=XP,e.lineWidth=2,e.strokeRect(p.x,p.y,p.width,p.height);const{width:m,height:v}=t.mapDimensions,y=Math.ceil(m/ge),I=Math.ceil(v/ge),T=new Map;o.forEach((oe,me)=>{const F=oe.isPlayerTribe?0:me%(Xt.length-1)+1;T.set(oe.leaderId,Xt[F])});const A=p.width/y,R=p.height/I,_=p.x+p.width/2,C=p.y+p.height/2,M=y>400?4:y>200?2:1;for(let oe=0;oe<I;oe+=M)for(let me=0;me<y;me+=M){const F=oe*y+me,ae=t.terrainOwnership[F];if(ae!==null){const ye=(me+.5)*ge,Se=(oe+.5)*ge,q=Ue(n,{x:ye,y:Se},m,v),$e=_+q.x/m*p.width,xe=C+q.y/v*p.height,He=t.hoveredMinimapTribeId===ae;if(e.fillStyle=T.get(ae)||"#888",He){const rt=(Math.sin(t.time*5)+1)/2;e.globalAlpha=.6+rt*.4}else e.globalAlpha=.8;e.fillRect($e-A*M/2,xe-R*M/2,A*M,R*M)}}e.globalAlpha=1,e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip();for(const oe of o){if(!oe.territoryCenter)continue;const me=Ue(n,oe.territoryCenter,m,v),F=_+me.x/m*p.width,ae=C+me.y/v*p.height;e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="white",e.fillText(oe.tribeBadge,F,ae),oe.isPlayerTribe&&(e.strokeStyle="gold",e.lineWidth=1,e.beginPath(),e.arc(F,ae,10,0,Math.PI*2),e.stroke())}e.restore();const E=s/l,P=a/l,k=E/m*p.width,B=P/v*p.height;e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.strokeRect(_-k/2,C-B/2,k,B),e.restore(),e.restore();const j=p.y+p.height+8,Z=p.x,X=j,ie="recenter_camera_btn",ee={id:ie,action:Oe.RecenterCamera,rect:{x:Z,y:X,width:30,height:30},text:"",currentWidth:30,backgroundColor:t.cameraFollowingPlayer?jn:gn,textColor:dt,tooltip:"Lock camera to player"};t.uiButtons.push(ee),e.fillStyle=t.hoveredButtonId===ie?"#4a5568":ee.backgroundColor,e.fillRect(Z,X,30,30),e.strokeStyle="#666",e.strokeRect(Z,X,30,30);const te=Z+30/2,K=X+30/2,ue=30*.35;e.strokeStyle=dt,e.lineWidth=2,e.beginPath(),e.arc(te,K,ue,0,Math.PI*2),e.stroke();const ce=ue*.6;e.beginPath(),e.moveTo(te-ce,K),e.lineTo(te+ce,K),e.moveTo(te,K-ce),e.lineTo(te,K+ce),e.stroke(),e.fillStyle=dt,e.beginPath(),e.arc(te,K,2,0,Math.PI*2),e.fill();const Y="open_tribe_modal_btn",J=`Tribes (${o.length})`;e.font='10px "Press Start 2P", Arial';const V=e.measureText(J),D=Math.max(30,V.width+16),L=30,fe=Z+30+8,pe=j,re={id:Y,action:Oe.OpenTribeModal,rect:{x:fe,y:pe,width:D,height:L},text:J,currentWidth:D,backgroundColor:gn,textColor:dt,tooltip:"View all tribes and diplomacy"};t.uiButtons.push(re),e.fillStyle=t.hoveredButtonId===Y?"#4a5568":gn,e.fillRect(fe,pe,D,L),e.strokeStyle="#666",e.strokeRect(fe,pe,D,L),e.fillStyle=dt,e.textAlign="center",e.textBaseline="middle",e.fillText(J,fe+D/2,pe+L/2)}const De=(e,t,n,o,s,a,l)=>{a==="transparent"||o<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*l),Math.floor(n*l),Math.ceil(o*l),Math.ceil(s*l)))},Iv=10,Tv=10,yi=6,xi=4,Kc=2,QD=5,Gn=4,JD=2,en=4,eO=2,gt=3,ts=2,Ro=0,sl=Ro+xi-1,cn=sl,Ct=sl+Gn-1,tO="rgba(0, 0, 0, 0.4)",nO=4,iO=1,Jp={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,o,s,a,l,u="male",d=20,f=[1,0],p=!1,m=0){const v=["dead","stunned"].includes(l),y=v?Tv+4:Iv,I=v?Iv+4:Tv+gt,T=.15,A=Math.min(o*(1-2*T)/y,s*(1-2*T)/I),R=y*A,_=I*A,C=t+(o-R)/2,M=n+(s-_)/2;e.save(),f[0]<0&&!v?(e.translate(C+R,M),e.scale(-1,1)):e.translate(C,M);const P="#D09A5A",k=d>50?"#BDBDBD":"#281808",B="#7F5C4A",j="#6B4F3A",Z="#E0D8C0",X="#A0522D",ie=1-Math.max(0,Math.min(100,m))/100*.2,ee=u==="male"?1.1:.9,te=.8+(Math.max(1,Math.min(d,60))-1)/59*.2;let K=QD*ie*ee*te,ue=JD*ie*ee*te,ce=eO*ie*te;p&&u==="female"&&(K*=1.5);const Y=Math.round((y-K)/2),J=Math.round((y-yi)/2),V=Y-ue,D=Y+K,L=1,fe=Y+(K/2-L/2)-ce,pe=Y+(K/2+L/2),re=f[1]<-.2&&Math.abs(f[0])<.7,oe=ae=>{e.fillStyle=tO,e.beginPath();const ye=y/2,Se=ae;e.ellipse(Math.floor(ye*A),Math.floor(Se*A),Math.max(1,Math.floor(nO*A)),Math.max(1,Math.floor(iO*A)),0,0,2*Math.PI),e.fill()},me=(ae,ye)=>{u==="male"?(De(e,Y,sl+ae,K,Gn-ts,ye,A),De(e,Y,sl+Gn-ts+ae,K,ts,B,A)):De(e,Y,sl+ae,K,Gn,j,A)},F=(ae,ye)=>{re?De(e,J,Ro+ae,yi,xi,k,A):(De(e,J,Ro+ae,yi,xi,ye,A),De(e,J,Ro+ae,yi,Kc,k,A),u==="female"?(De(e,J-1,Ro+Kc+ae,1,xi,k,A),De(e,J+yi,Ro+Kc+ae,1,xi,k,A)):De(e,J+1,Ro+2+ae,yi-2,xi-2,k,A))};switch(l){case"idle":{const ae=a*Math.PI*2,ye=Math.sin(ae)*.5,q=(Math.cos(ae*2)+1)*.25;oe(Ct+gt+1),De(e,fe+ye,Ct+q,ce,gt,P,A),De(e,pe-ye,Ct+q,ce,gt,P,A),me(q,P),De(e,V,cn+q,ue,en,P,A),De(e,D,cn+q,ue,en,P,A),F(q,P);break}case"walk":{const ae=a*Math.PI*2,ye=Math.sin(ae)*2,q=Math.abs(Math.cos(ae))*1;oe(Ct+gt+1),De(e,fe+ye,Ct+q,ce,gt,P,A),De(e,pe-ye,Ct+q,ce,gt,P,A),me(q,P),De(e,V-ye,cn+q,ue,en,P,A),De(e,D+ye,cn+q,ue,en,P,A),F(q,P);break}case"gathering":{const ae=a*Math.PI*2,ye=1,Se=(Math.sin(ae)+1)/2*2,q=ye+Math.abs(Math.cos(ae))*.5;oe(Ct+gt+1),De(e,fe,Ct+q,ce,gt-ye,P,A),De(e,pe,Ct+q,ce,gt-ye,P,A),me(q,P),De(e,V+1,cn+q-Se,ue,en,P,A),De(e,D-1,cn+q-Se,ue,en,P,A),F(q,P);break}case"eat":{oe(Ct+gt+1),De(e,fe,Ct+1,ce,gt-1,P,A),De(e,pe,Ct+1,ce,gt-1,P,A),me(1,P);const Se=(Math.sin(a*Math.PI*4)+1)/2,q=J+yi/2,$e=Ro+xi/2,xe=D+(q-D)*Se,He=cn+1+($e-(cn+1))*Se;De(e,V,cn+1,ue,en,P,A),De(e,xe,He,ue,en,P,A),De(e,xe,He-1,1,1,X,A),F(1,P);break}case"procreate":{const ae=(Math.sin(a*Math.PI*8)+1)/4,ye=(Math.sin(a*Math.PI*6)+1)*.5,Se=1.5,q=Se-ye;oe(Ct+gt+1),De(e,fe,Ct+q,ce,gt-Se,P,A),De(e,pe,Ct+q,ce,gt-Se,P,A),me(q,P),De(e,V,cn+q,ue,en,P,A),De(e,D,cn+q,ue,en,P,A),F(q,P),e.globalAlpha=ae,me(q,"white"),e.globalAlpha=1;break}case"attacking":{const ae=Math.sin(a*Math.PI)*1.5,ye=Math.abs(Math.sin(a*Math.PI));oe(Ct+gt+1),De(e,fe-ae,Ct+ye,ce,gt,P,A),De(e,pe+ae*.5,Ct+ye,ce,gt,P,A),me(ye,P),De(e,V,cn+ye-2,ue,en,P,A),De(e,D,cn+ye-2.5,ue,en,P,A),F(ye,P);break}case"defending":{oe(Ct+gt+1),De(e,fe,Ct+1,ce,gt-1,P,A),De(e,pe,Ct+1,ce,gt-1,P,A),me(1,P),De(e,V-1,cn+1-1,ue,en,P,A),De(e,D+1,cn+1-1,ue,en,P,A),F(1,P);break}case"stunned":case"dead":{const ae=l==="dead",ye=ae?Math.min(1,a):0,Se=ye>.5?Z:P,q=u==="male"?B:j,$e=ye>.8?"transparent":k,xe=y/2,He=I/2,rt=2;oe(I-1),De(e,xe-ce-rt,He,ce,gt,Se,A),De(e,xe+rt,He,ce,gt,Se,A),De(e,xe-ue-rt,He-Gn+1,ue,en,Se,A),De(e,xe+rt,He-Gn+1,ue,en,Se,A);const At=xe-K/2,_t=He-Gn/2;u==="male"?(ye<.7&&De(e,At,_t+Gn-ts,K,ts,q,A),De(e,At,_t,K,Gn-ts,Se,A)):ye<.7?De(e,At,_t,K,Gn,q,A):De(e,At,_t,K,Gn,Se,A);const st=xe-yi/2,qt=He-Gn/2-xi+1;if(De(e,st,qt,yi,xi,Se,A),$e!=="transparent"&&De(e,st,qt,yi,Kc,$e,A),ae&&ye>.6){const Cn="#B0A890";for(let no=0;no<3;no++)De(e,At+1,_t+no*1+1,K-2,.5,Cn,A)}break}default:De(e,0,0,y,I,"magenta",A);break}e.restore()}};function oO(e,t,n,o,s){const a=t.x,l=t.y-n-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-o/2,l,o,o/2),e.fill(),e.beginPath(),e.moveTo(a-o/2,l),e.lineTo(a-o/4,l-o/3),e.lineTo(a-o/6,l),e.moveTo(a-o/6,l),e.lineTo(a,l-o/2),e.lineTo(a+o/6,l),e.moveTo(a+o/6,l),e.lineTo(a+o/4,l-o/3),e.lineTo(a+o/2,l),e.stroke(),e.restore()}function Al(e,t,n,o,s,a=!1,l=!1,u=!1,d=!1){o<Ap&&(n=n*.75),Jp.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,o,[0,0],!1,0);let f,p;a?(f=cP,p=tI):l?(f=uP,p=oI):u?(f=dP,p=iI):d&&(f=fP,p=nI),f&&p&&oO(e,t,n/2,f,p)}function rO(e,t,n,o,s,a){if(e.save(),o.length===0){e.restore();return}const l=o.length*s,u=4;let d;const f=l+(o.length-1)*u;o.length>1&&f>a?d=(a-l)/(o.length-1):d=u,o.length<=1&&(d=0);for(let p=0;p<o.length;p++){const{member:m,isPlayer:v,isHeir:y,isPartner:I,isParent:T}=o[p],A=t+p*(s+d)+s/2,R=n+s/4;Al(e,{x:A,y:R},s,m.age,m.gender,v,y,I,T)}e.restore()}function sO(e,t,n,o,s){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,o,s);const a=500,l=Math.min(s*.8,n.length*(_a+Dy)+120),u=(o-a)/2,d=(s-l)/2;e.fillStyle="#2d3748",e.strokeStyle="#4a5568",e.lineWidth=4,e.fillRect(u,d,a,l),e.strokeRect(u,d,a,l),e.fillStyle="#fff",e.font='20px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="top",e.fillText("WORLD TRIBES",o/2,d+30);const f=d+80,p=a-Ra*4,m=u+Ra*2;for(let _=0;_<n.length;_++){const C=n[_],M=f+_*(_a+Dy);if(M+_a>d+l-60)break;const E=M+_a/2;C.isPlayerTribe&&(e.fillStyle="rgba(255, 215, 0, 0.2)",e.fillRect(m,M,p,_a));let P=m+Ra;if(e.font=`${tr}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillStyle="white",e.fillText(C.tribeBadge,P,E),P+=tr+Ra*2,C.isPlayerTribe)e.fillStyle="#aaa",e.font='10px "Press Start 2P", Arial',e.textAlign="left",e.fillText("(YOU)",P,E);else{const k=C.diplomacyStatus===Nt.Friendly?"":"",B=`modal_diplomacy_${C.leaderId}`,j={x:P,y:E-tr/2,width:tr*1.5,height:tr},Z={id:B,action:Oe.ToggleDiplomacy,rect:j,text:"",icon:k,backgroundColor:"transparent",textColor:"white",currentWidth:j.width,tooltip:`Set status to ${C.diplomacyStatus===Nt.Friendly?"Hostile":"Friendly"}`,targetTribeId:C.leaderId};t.uiButtons.push(Z),t.hoveredButtonId===B&&(e.fillStyle=Np,e.fillRect(j.x,j.y,j.width,j.height)),e.font=`${tr*.8}px Arial`,e.textAlign="center",e.fillText(k,j.x+j.width/2,E)}P+=tr*2+Ra,Al(e,{x:P+10,y:E},Gi*.6,25,"male"),e.fillStyle="white",e.font=`${hP}px "Press Start 2P"`,e.fillText(`${C.adultCount}`,P+30,E),P+=80,Al(e,{x:P+10,y:E},Gi*.6,5,"female"),e.fillText(`${C.childCount}`,P+30,E)}const v=120,y=40,I=o/2-v/2,T=d+l-60,A="close_tribe_modal_btn",R={id:A,action:Oe.CloseTribeModal,rect:{x:I,y:T,width:v,height:y},text:"CLOSE",currentWidth:v,backgroundColor:gn,textColor:dt};t.uiButtons.push(R),e.fillStyle=t.hoveredButtonId===A?"#4a5568":gn,e.fillRect(I,T,v,y),e.strokeStyle="#fff",e.strokeRect(I,T,v,y),e.fillStyle=dt,e.font='12px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="middle",e.fillText("CLOSE",o/2,T+y/2),e.restore()}function aO(e,t,n,o,s){const a=dI,l=fI,u=t+o-a-l,d=n+l;e.save(),e.lineWidth=2,e.strokeStyle=s?DP:bP,e.beginPath();const f=5;e.moveTo(u+f,d+f),e.lineTo(u+a-f,d+a-f),e.moveTo(u+a-f,d+f),e.lineTo(u+f,d+a-f),e.stroke(),e.restore()}function lO(e,t,n,o){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===tn.INACTIVE)return;const l=a.steps[s.currentStepIndex];if(!l)return;e.save(),e.globalAlpha=s.transitionAlpha;const u=wP,d=EP,f=CP,p=`${uh}px "Press Start 2P", Arial`,m=`${Fy}px "Press Start 2P", Arial`,v=_P,y=Fy*1.5;e.font=m;const I=l.text.split(" ");let T="";const A=[];for(let Z=0;Z<I.length;Z++){const X=T+I[Z]+" ";e.measureText(X).width>u-d*2&&Z>0?(A.push(T),T=I[Z]+" "):T=X}A.push(T);const R=d*2+uh+d/2+A.length*y,_=(n-u)/2,C=o-R-160;e.fillStyle=PP,e.beginPath(),e.moveTo(_+f,C),e.lineTo(_+u-f,C),e.quadraticCurveTo(_+u,C,_+u,C+f),e.lineTo(_+u,C+R-f),e.quadraticCurveTo(_+u,C+R,_+u-f,C+R),e.lineTo(_+f,C+R),e.quadraticCurveTo(_,C+R,_,C+R-f),e.lineTo(_,C+f),e.quadraticCurveTo(_,C,_+f,C),e.closePath(),e.fill(),e.fillStyle=v,e.textAlign="center",e.textBaseline="top",e.font=p,e.fillText(l.title,_+u/2,C+d),e.font=m;let M=C+d+uh+d/2;for(const Z of A)e.fillText(Z,_+u/2,M),M+=y;const E=t.hoveredButtonId==="tutorial-dismiss";aO(e,_,C,u,E),e.restore();const P=dI,k=fI,B=_+u-P-k,j=C+k;return{x:B,y:j,width:P,height:P}}function Eh(e,t,n){e.save();const o=kP,s={x:t.x-o,y:t.y-o,width:t.width+o*2,height:t.height+o*2};e.strokeStyle=cI,e.lineWidth=uI+Math.sin(n*Hp)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function cO(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const kT=10,uO=3,Av=kT*.7;function dO(e,t){const{position:n,food:o,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,kT,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),o.length>0){const a=Math.PI*2/Math.min(o.length,s);for(let l=0;l<o.length;l++){const u=l*a,d=n.x+Av*Math.cos(u),f=n.y+Av*Math.sin(u);e.beginPath(),e.arc(d,f,uO,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const wv=(e,t,n=70,o=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${o}%)`},fO=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[o,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${o}, ${s}%, ${Math.max(0,a-t)}%)`},Qc=(e,t,n,o,s,a,l,u=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=u?fO(l,15):l,e.beginPath(),e.roundRect(-o/2,0,o,s,o/2),e.fill(),e.restore()},Ch=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),o=75;if(!n)return`hsl(0, 0%, ${o}%)`;const[,s,a,l]=n.map(Number),u=a*(1-t),d=l+(o-l)*t;return`hsl(${s}, ${u}%, ${d}%)`},bT={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,o,s,a,l,u={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const d=o*.15,f=t+o/2,p=n+s/2,m=o-d*2,v=s-d*2,{gender:y,age:I,direction:T,isPregnant:A,hungryLevel:R,geneCode:_}=u,C=.8+Math.min(I,10)/10*.4,M=y==="male"?1.05:.95,E=1-R/100*.3,P=m*.5*E*C*M;let k=v*.3*C*M;const B=m*.15*C*M,j=P*.2,Z=v*.3,X=wv(_,0,30,50);let ie=wv(_,8,50,40);if(I>45){const oe=Math.min(1,(I-45)/15);ie=Ch(ie,oe)}e.translate(f,p),T[0]<0&&e.scale(-1,1);const ee=Math.sin(a*Math.PI*2),te=Math.cos(a*Math.PI*2),K=Z+k*.2;if(l==="dead"){const oe=Math.min(a,1);e.translate(0,v*.2),e.rotate(Math.PI/2);const me=Ch(ie,oe),F=Ch(X,oe);e.globalAlpha=.5+oe*.5,e.strokeStyle=me,e.lineWidth=j*.5,e.beginPath(),e.moveTo(-P*.4,0),e.lineTo(P*.4,0),e.stroke();for(let ae=-1;ae<=1;ae+=1)e.beginPath(),e.arc(0,0,k*.4,Math.PI*.4*ae-Math.PI*.2,Math.PI*.4*ae+Math.PI*.2),e.stroke();e.fillStyle=F,e.beginPath(),e.arc(P*.5,0,B,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(P*.55,0,B*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,K,P*.7,P*.25,0,0,2*Math.PI),e.fill();let ue=0,ce=0,Y=0,J=0,V=0,D=0;switch(l){case"idle":ce=ee*(v*.02),Y=ee*.05,J=-ee*.05,V=-ee*.05,D=ee*.05;break;case"walk":ce=Math.abs(te)*(v*-.04),Y=ee*.7,J=-ee*.7,V=-ee*.7,D=ee*.7;break;case"eat":ue=v*.1,ce=v*.05,ue+=ee*(v*.02);break;case"procreate":ce=v*.05;const oe=(1-te)*-m*.05;e.translate(oe,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}A&&y==="female"&&(k*=1.6);const L=ce,fe=L-k*.2;Qc(e,P*-.35,fe,j,Z,V,ie,!0),Qc(e,P*.35,fe,j,Z,D,ie,!0),e.fillStyle=ie,e.beginPath(),e.ellipse(0,L,P/2,k/2,0,0,2*Math.PI),e.fill();const pe=P*.45,re=fe+ue;e.fillStyle=X,e.beginPath(),e.arc(pe,re,B,0,Math.PI*2),e.fill(),T[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(pe+B*.3,re-B*.2,B*.15,0,Math.PI*2),e.fill()),Qc(e,P*-.35,fe,j,Z,Y,ie),Qc(e,P*.35,fe,j,Z,J,ie),e.restore()}};function hO(e,t){let[n,o,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),o=Math.max(0,o-t),s=Math.max(0,s-t),`rgb(${n}, ${o}, ${s})`}function pO(e){const t=(e&16711680)>>16,n=(e&65280)>>8,o=e&255,s=`rgb(${t}, ${n}, ${o})`,a=hO(s,40),l=(e&255)%100+50,u=(e>>8&255)%100,d=(e>>16&255)%100,f=`rgb(${l}, ${u}, ${d})`,p=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:f,eyeColor:p}}const DT={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,o,s,a,l,u={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:d,age:f,direction:p,isPregnant:m,hungryLevel:v,geneCode:y}=u;e.save();const I=o*.15,T=Math.max(1,Math.floor((o-I*2)/10)),A=p[0]<0;e.translate(t+o/2,n+s/2),A&&e.scale(-1,1);const R=pO(y),_=.8+Math.min(f,20)/20*.4,C=d==="male"?1.05:.95,M=1-v/100*.25,E=_*C*M,P=Math.max(0,Math.min(1,(f-15)/5));e.filter=`grayscale(${P})`;const k=R.furColor,B=R.darkerFurColor,j=R.eyeColor,Z="#FFFFFF",X="#c75c5c",ie="#E0E0E0",ee="#A0A0A0",te=s/2-2*T,K=Math.sin(a*Math.PI*2),ue=Math.abs(K);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,te,T*4,T,0,0,2*Math.PI),e.fill(),e.filter="none",l==="dead"){const xe=Math.min(1,a*2);e.save(),e.translate(0,te-T*3),e.rotate(-Math.PI/2);const He=(rt,At,_t,st,qt=!1)=>{e.fillStyle=qt?ee:ie,e.fillRect(rt*T,At*T,_t*T,st*T)};xe<1&&(e.globalAlpha=1-xe,e.fillStyle=k,e.beginPath(),e.ellipse(0,0,T*3,T*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),xe>0&&(e.globalAlpha=xe,He(-1,-4,2,2),He(1,-3.5,1,1,!0),He(-.5,-2,1,5,!0),He(-2.5,-1,5,.5),He(-2.5,0,5,.5),He(-2.5,1,5,.5),He(-3,-2,-1,2,!0),He(3,-2,1,2),He(-3,2,-1,2,!0),He(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=k;let ce=0,Y=0,J=0,V=[0,0,0,0];switch(l){case"idle":ce=K*T*.1;break;case"walk":const xe=Math.sin(a*Math.PI*4);ce=Math.abs(xe)*-T*.5,V=[xe*T,-xe*T,-xe*T,xe*T];break;case"attacking":const He=Math.sin(a*Math.PI*4);Y=T*2+He*T,J=T*2,ce=T;break;case"eat":J=T*3+ue*T,ce=T*1.5,e.fillStyle=X,e.fillRect(-T,te-T,T*2,T);break;case"procreate":ce=Math.sin(a*Math.PI*8)*T*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let At=0;At<5;At++){const _t=(Math.random()-.5)*T*8,st=te+(Math.random()-.5)*T*2;ue>.5&&e.fillRect(_t,st,T*.5,T*.5)}break}const D=T*3*E*(m?1.3:1),L=T*5*E,fe=-L/1.5,pe=te-D-T*2.5+ce;e.fillStyle=k,e.beginPath(),e.moveTo(fe-T*.5,pe+D*.5),e.quadraticCurveTo(fe-T*3,pe-T,fe-T*2+K*T,pe+D+T),e.fill();const re=T*1.2*E,oe=T*3*E,me=T*2.5*E,F=fe+L*.8,ae=fe+L*.2;e.fillStyle=B,e.fillRect(ae,te-me,re,me+V[2]),e.fillRect(F,te-oe,re,oe+V[0]),e.fillStyle=k,e.beginPath(),e.moveTo(fe,pe+D),e.lineTo(fe,pe+T),e.quadraticCurveTo(fe+L/2,pe,fe+L,pe+T),e.lineTo(fe+L,pe+D),e.fill(),e.fillStyle=k,e.fillRect(ae+T/2,te-me,re,me+V[3]),e.fillRect(F+T/2,te-oe,re,oe+V[1]);const ye=T*3.5*E,Se=fe+L-ye*.3+Y,q=pe-ye*.3+J;e.fillStyle=k,e.beginPath(),e.arc(Se,q,ye/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(Se+ye*.4,q+ye*.2,T*1.5,T,0,0,Math.PI*2),e.fill(),p[1]>=0&&(e.fillStyle=j,e.fillRect(Se+T*.5,q-T*.5,T*.5,T*.5),l==="attacking"&&(e.fillStyle=Z,e.fillRect(Se+ye*.5,q+ye*.4,T,T*.4))),e.fillStyle=B,e.beginPath(),e.moveTo(Se-ye*.4,q-ye*.3),e.lineTo(Se,q-ye*.7),e.lineTo(Se,q-ye*.2),e.fill(),e.restore()}};class Fs{constructor(t=200){xt(this,"cache",new Map);xt(this,"maxSize");this.maxSize=t}getOrRender(t,n,o,s){const a=this.cache.get(t);if(a)return this.cache.delete(t),this.cache.set(t,a),a;const{canvas:l,ctx:u}=RT(n,o);if(s(u),this.cache.size>=this.maxSize){const d=this.cache.keys().next().value;d!==void 0&&this.cache.delete(d)}return this.cache.set(t,l),l}clear(){this.cache.clear()}}const gO=9,mO=new Fs(200);function yO(e,t){const{position:n,gender:o,age:s,decayProgress:a,food:l,radius:u,originalEntityType:d,geneCode:f}=t,p=Pr(a,20),m=Math.floor(s),v=`${d}_${o}_${m}_${p}_${u}_${f||0}`,y=Math.ceil(u*2)+4,I=mO.getOrRender(v,y,y,T=>{T.translate(y/2,y/2),d==="human"?Jp.render(T,-y/2+2,-y/2+2,y-4,y-4,p,"dead",o,m,[0,0],!1,0):d==="prey"?bT.render(T,-y/2+2,-y/2+2,y-4,y-4,p,"dead",{gender:o,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}):d==="predator"&&DT.render(T,-y/2+2,-y/2+2,y-4,y-4,p,"dead",{gender:o,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024})});if(e.save(),e.globalAlpha=1-a,e.drawImage(I,n.x-I.width/2,n.y-I.height/2),e.restore(),l.length>0){e.save(),e.font=`${gO}px Arial`,e.textAlign="center",e.textBaseline="middle";const T=ht*.9,A=Math.PI/LS*3;l.forEach((R,_)=>{const C=_*A,M=n.x+T*Math.cos(C)*Math.atan2(_,_),E=n.y+T*Math.sin(C)*Math.atan2(_,_),P=Sp[R.type];e.fillText(P,M,E)}),e.restore()}}function No(e,t,n,o,s,a,l,u){e.save(),e.fillStyle=l,e.fillRect(t,n,o,s),e.fillStyle=u,e.fillRect(t,n,o*Math.max(0,a),s),e.restore()}function vO(e,t,n,o,s,a){if(e.save(),o.length===0){e.restore();return}const l=o.length*s;let u;l>a||l+(o.length-1)*4>a?u=(a-l)/(o.length-1):u=4,o.length===1&&(u=0);for(let d=0;d<o.length;d++){const f=Sp[o[d].type];e.fillText(f,t+d*(s+u),n)}e.restore()}function SO(e,t,n,o,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let l,u=ht/2;const d=xp[a.action],f=TI[a.action],p=`${d} ${f}`;if("targetEntityId"in a){const m=t.entities.entities[a.targetEntityId];m&&(l=m.position,u=m.radius)}else"position"in a&&(l=a.position);if(l){MT(e,l,u,Dp,Op,2,n,o,s,t.mapDimensions),e.save(),e.font=`${ws}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:v}=Dl(l,n,{width:o,height:s},t.mapDimensions),y=v-u-Xu-ws/2;e.fillText(p,m,y),e.restore()}}function IO(e,t,n,o,s){e.save();const a=(Math.sin(s*Hp)+1)/2,l=n+Xu+a*5;e.strokeStyle=Dp,e.lineWidth=2,e.setLineDash(Op),e.beginPath(),e.arc(t.x,t.y,l,0,Math.PI*2),e.stroke(),e.setLineDash([]);const u=xp[o],d=TI[o];if(u){e.font=`${ws*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const f=t.y-l-25;e.fillText(u,t.x,f),e.font=`${ws*.8}px "Press Start 2P", Arial`,e.fillText(d,t.x,f+25)}e.restore()}function TO(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(kt(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const l=t.entities.entities[n.targetEntityId];l&&(s=l.position,a=l.radius||(l.type==="building"?20:30))}if(s){const l=(u,d)=>{IO(u,d.position,a,n.action,t.time)};$n(e,t.mapDimensions.width,t.mapDimensions.height,l,{position:{...s}},s,a+30)}}}function Ev(e,t,n,o,s,a,l=!0){const u=t.split(" ");let d="";const f=[];for(let p=0;p<u.length;p++){const m=d+u[p]+" ";e.measureText(m).width>s&&p>0?(f.push(d),d=u[p]+" "):d=m}if(f.push(d),l)for(let p=0;p<f.length;p++)e.fillText(f[p],n,o+p*a);return f.length*a}function AO(e){return 1-Math.pow(1-e,3)}function wO(e,t,n,o){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(l=>!l.isDismissed);if(s.length===0)return;e.save();let a=o-$P;for(const l of s){const u=n-zc-nr;e.font=`${dh}px "Press Start 2P", Arial`;const d=u+nr,f=zc-nr*2,p=Ev(e,l.message,-9999,-9999,f,dh*1.2,!1),m=nr*2+p+mi,v=a-m,y=Date.now()-l.creationTime,I=Math.min(y/GP,1),T=AO(I),A=o,R=A+(v-A)*T;e.fillStyle=BP,e.beginPath(),e.roundRect(u,R,zc,m,NP),e.fill(),e.fillStyle=HP,e.textBaseline="top",Ev(e,l.message,d,R+nr,f,dh*1.2,!0);const _=R+m-mi-nr/2,C=u+zc-mi-nr/2,M={x:C,y:_,width:mi,height:mi};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[l.id]=M);const E=t.hoveredButtonId===`notification-dismiss-${l.id}`;if(e.fillStyle=E?Uy:FP,e.font=`${mi}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",M.x+M.width/2,M.y+M.height/2),l.targetEntityIds||l.targetPosition||l.targetArea||l.targetRadius){const B={x:C-mi-xy,y:_,width:mi,height:mi};t.notificationButtonRects&&(t.notificationButtonRects.view[l.id]=B);const j=t.hoveredButtonId===`notification-view-${l.id}`;e.fillStyle=j?Uy:LP,e.font=`${mi*(j?1.5:1.2)}px Arial`,e.fillText("",B.x+B.width/2,B.y+B.height/2)}a-=m+xy}e.restore()}function EO(e){return e.length===0?0:e.reduce((n,o)=>n+o,0)/e.length}function Ph(e,t,n,o,s,a,l,u){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(o,s,a,l),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(o,s,a,l);const d=EO(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${d.toFixed(2)}ms`,o+Re,s+Re+8);const f=Math.max(...n,1),p=n.map(m=>m/f*l);if(e.beginPath(),e.strokeStyle=u,e.lineWidth=2,p.length>1){e.moveTo(o,s+l-p[0]);for(let m=1;m<p.length;m++){const v=o+m/(p.length-1)*a,y=s+l-p[m];e.lineTo(v,y)}}else if(p.length===1){const m=s+l-p[0];e.moveTo(o,m),e.lineTo(o+a,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${f.toFixed(2)}ms`,o+a-Re,s+Re+8),e.restore()}function CO(e,t,n){const{performanceMetrics:o}=t;if(!o)return;const s=280,a=240,l=n-s-Re,u=Re+It*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(l,u,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(l,u,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let d=u+Re+5;const f=l+Re;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",f,d),d+=25,e.fillStyle="white",e.font="12px monospace";const p=PO(t);e.fillText(`FPS: ${p.toFixed(1)}`,f,d),d+=20;const m=s-Re*2,v=45,y=10;Ph(e,"Render",_h(t,"renderTime"),f,d,m,v,"#4CAF50"),d+=v+y,Ph(e,"World Update",_h(t,"worldUpdateTime"),f,d,m,v,"#2196F3"),d+=v+y,Ph(e,"AI Update",_h(t,"aiUpdateTime"),f,d,m,v,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",l+s/2,u+a-10),e.restore()}function PO(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(Bt/Gt);return t.history.filter(a=>n-a.bucketTime/(Bt/Gt)<1).length}function _O(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const l=Math.floor(a.bucketTime/(Bt/Gt));n.set(l,(n.get(l)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function _h(e,t){return _O(e.performanceMetrics.history,t)}const RO={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering",dismantling:"attacking"},MO=new Fs(1e4);function kO(e,t,n){if(!t.path||t.path.length===0)return;const{width:o,height:s}=n.mapDimensions;e.save(),e.setLineDash([5,5]),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=2;let a={...t.position};e.beginPath(),e.moveTo(a.x,a.y);for(const u of t.path){const d=Ue(a,u,o,s),f={x:a.x+d.x,y:a.y+d.y};e.lineTo(f.x,f.y),a=f}if(t.pathTarget){const u=Ue(a,t.pathTarget,o,s),d={x:a.x+u.x,y:a.y+u.y};e.lineTo(d.x,d.y),a=d}e.stroke(),e.setLineDash([]),e.fillStyle="rgba(255, 255, 255, 0.3)";let l={...t.position};for(const u of t.path){const d=Ue(l,u,o,s),f={x:l.x+d.x,y:l.y+d.y};e.beginPath(),e.arc(f.x,f.y,2,0,Math.PI*2),e.fill(),l=f}if(t.pathTarget){const u=Ue(l,t.pathTarget,o,s),d={x:l.x+u.x,y:l.y+u.y};e.fillStyle="rgba(255, 255, 0, 0.8)",e.beginPath(),e.arc(d.x,d.y,4,0,Math.PI*2),e.fill()}e.restore()}function bO(e,t,n){var d;const{radius:o,position:s,activeAction:a="idle"}=t,l=t.stateMachine[0]||"N/A",u=t.isAdult?ht+20:ht*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${a}`,s.x,s.y-u),e.fillText(`State: ${l}`,s.x,s.y-u+10),e.fillText(`Path: ${((d=t.path)==null?void 0:d.length)||0} waypoints`,s.x,s.y-u+50),e.fillText(`HP: ${t.hitpoints}`,s.x,s.y-u+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,s.x,s.y-u+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,s.x,s.y-u+40),e.restore(),e.beginPath(),e.arc(s.x,s.y,o,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",n.debugCharacterId===t.id&&kO(e,t,n),e.lineWidth=1,e.stroke(),e.closePath(),Qp(e,t,n)}function DO(e,t,n,o,s){e.save(),e.font=`${Ja}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(o?ht:Ns)-Ja-s),e.restore()}function OO(e,t,n,o,s){const a=t.x,l=t.y-n-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-o/2,l,o,o/2),e.fill(),e.beginPath(),e.moveTo(a-o/2,l),e.lineTo(a-o/4,l-o/3),e.lineTo(a-o/6,l),e.moveTo(a-o/6,l),e.lineTo(a,l-o/2),e.lineTo(a+o/6,l),e.moveTo(a+o/6,l),e.lineTo(a+o/4,l-o/3),e.lineTo(a+o/2,l),e.stroke(),e.restore()}function NO(e,t,n){var u;const{position:o,radius:s}=t,a=o.x-ch/2,l=o.y-s-pP;if(t.stateMachine[0]===xo){const d=t.stateMachine[1],f=n-d.attackStartTime,p=Math.min(f/Yu,1);No(e,a,l,ch,Oy,p,bo,gP)}else if((u=t.attackCooldown)!=null&&u.melee&&t.attackCooldown.melee>0){const d=1-t.attackCooldown.melee/Cl;No(e,a,l,ch,Oy,d,bo,mP)}}function BO(e,t,n=!1,o=!1,s=!1,a=!1,l=!1,u=!1,d=!1,f){var B,j;const{position:p,activeAction:m="idle"}=t,v=t.isAdult?ht:ht*.6,y=RO[m]||"idle",I=Pr(t.animationProgress||0,12),T=Zp(t.direction,8),A=Math.floor(t.age),R=Pr(t.hunger/100,5)*100,_=`${y}_${t.gender}_${A}_${T}_${I}_${t.isPregnant??!1}_${R}_${v}`,C=Math.ceil(v*2)+4,M=MO.getOrRender(_,C,C,Z=>{Z.translate(C/2,C/2);const X=Kp(T,8);Jp.render(Z,-C/2+2,-C/2+2,C-4,C-4,I,y,t.gender,A,X,t.isPregnant??!1,R)});e.drawImage(M,p.x-M.width/2,p.y-M.height/2),u&&(e.save(),e.strokeStyle=ZC,e.lineWidth=2,e.beginPath(),e.arc(p.x,p.y,v+3,0,2*Math.PI),e.stroke(),e.restore());let E,P;if(l?(E=QC,P=oI):n?(E=KC,P=tI):s?(E=JC,P=qC):o?(E=eP,P=nI):a&&(E=tP,P=iI),E&&P&&OO(e,p,v,E,P),(B=t.tribeInfo)!=null&&B.tribeBadge&&DO(e,p,t.tribeInfo.tribeBadge,t.isAdult??!1,E??0),t.heldItem){const Z=Fp[t.heldItem.type],X=(j=t.tribeInfo)!=null&&j.tribeBadge?Ja:0;e.save(),e.font=`${Ja}px Arial`,e.textAlign="center",e.textBaseline="middle";const ie=p.y-(t.isAdult?ht:Ns)-Ja-(E??0)-X;e.fillText(Z,p.x,ie),e.restore()}const k=d&&(f.debugCharacterId===void 0||t.id===f.debugCharacterId);NO(e,t,f.time),k&&bO(e,t,f)}const HO={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},FO=new Fs(200);function LO(e,t,n){const{radius:o,position:s,activeAction:a="idle"}=t,l=t.stateMachine[0]||"N/A",u=t.isAdult?ht+20:ht*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${a}`,s.x,s.y-u),e.fillText(`State: ${l}`,s.x,s.y-u+10),e.fillText(`HP: ${t.hitpoints}`,s.x,s.y-u+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,s.x,s.y-u+30),e.fillText(`Age: ${Math.round(t.age)}`,s.x,s.y-u+40),e.restore(),e.beginPath(),e.arc(s.x,s.y,o,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath(),Qp(e,t,n)}function xO(e,t,n=!1,o,s){const{position:a,activeAction:l="idle"}=t,u=t.isAdult?t.radius:t.radius*.6,d=HO[l]||"idle",f=Pr(t.animationProgress||0,12),p=Zp(t.direction||{x:1,y:0},8),m=Math.floor(t.age),v=Pr(t.hunger/100,5)*100,y=`${d}_${m}_${p}_${f}_${t.isPregnant??!1}_${v}_${t.geneCode}_${u}`,I=Math.ceil(u*2)+4,T=FO.getOrRender(y,I,I,R=>{R.translate(I/2,I/2);const _=Kp(p,8);bT.render(R,-I/2+2,-I/2+2,I-4,I-4,f,d,{gender:t.gender,age:m,direction:_,isPregnant:t.isPregnant??!1,hungryLevel:v,geneCode:t.geneCode})});if(e.drawImage(T,a.x-T.width/2,a.y-T.height/2),t.hitpoints<t.maxHitpoints){const R=u*1.5,_=3,C=a.x-R/2,M=a.y-u-8;e.fillStyle="#555",e.fillRect(C,M,R,_);const E=t.hitpoints/t.maxHitpoints;e.fillStyle=E>.5?"#4CAF50":E>.25?"#FFC107":"#F44336",e.fillRect(C,M,R*E,_)}n&&(s===void 0||t.id===s)&&LO(e,t,o)}const UO={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},GO=new Fs(200);function $O(e,t,n){const{radius:o,position:s,activeAction:a="idle"}=t,l=t.stateMachine[0]||"N/A",u=t.isAdult?ht+20:ht*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${a}`,s.x,s.y-u),e.fillText(`State: ${l}`,s.x,s.y-u+10),e.fillText(`HP: ${t.hitpoints}`,s.x,s.y-u+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,s.x,s.y-u+30),e.fillText(`Age: ${Math.round(t.age)}`,s.x,s.y-u+40),e.restore(),e.beginPath(),e.arc(s.x,s.y,o,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath(),Qp(e,t,n)}function WO(e,t,n=!1,o,s){const{position:a,activeAction:l="idle"}=t,u=t.isAdult?t.radius:t.radius*.6,d=UO[l]||"idle",f=Pr(t.animationProgress||0,12),p=Zp(t.direction||{x:1,y:0},8),m=Math.floor(t.age),v=Pr(t.hunger/100,5)*100,y=`${d}_${m}_${p}_${f}_${t.isPregnant??!1}_${v}_${t.geneCode}_${u}`,I=Math.ceil(u*2)+4,T=GO.getOrRender(y,I,I,R=>{R.translate(I/2,I/2);const _=Kp(p,8);DT.render(R,-I/2+2,-I/2+2,I-4,I-4,f,d,{gender:t.gender,age:m,direction:_,isPregnant:t.isPregnant??!1,hungryLevel:v,geneCode:t.geneCode})});if(e.drawImage(T,a.x-T.width/2,a.y-T.height/2),t.hitpoints<t.maxHitpoints){const R=u*1.5,_=3,C=a.x-R/2,M=a.y-u-8;e.fillStyle="#555",e.fillRect(C,M,R,_);const E=t.hitpoints/t.maxHitpoints;e.fillStyle=E>.5?"#4CAF50":E>.25?"#FFC107":"#F44336",e.fillRect(C,M,R*E,_)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(a.x,a.y,u+3,0,2*Math.PI),e.stroke()),n&&(s===void 0||t.id===s)&&$O(e,t,o)}const YO=new Fs(50);function Va(e,t){const n=`circle_${e}_${t}`;return YO.getOrRender(n,t,t,o=>{const s=t/2;o.clearRect(0,0,t,t),o.beginPath(),o.arc(s,s,s,0,Math.PI*2),o.fillStyle=e,o.fill()})}function op(e,t,n,o,s,a,l,u="center"){const d=o.width*s,f=o.height*a,p=t-d/2,m=u==="bottom"?n-f:n-f/2;e.save(),e.globalAlpha=l,e.drawImage(o,p,m,d,f),e.restore()}const OT=15;function jO(e,t,n,o,s=1.5){const a=n-t.startTime,l=Math.min(a/t.duration,1),u=1-l,f=1+Math.sin(l*Math.PI*2)*(s-1),p=OT*f;e.save(),e.globalAlpha=u,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,p),0,Math.PI*2),e.fillStyle=o,e.fill(),e.restore()}function Na(e,t,n,o,s=2){const a=n-t.startTime,l=Math.min(a/t.duration,1),u=1-l,d=OT*2*l;e.save(),e.globalAlpha=u,e.beginPath(),e.arc(t.position.x,t.position.y,d,0,Math.PI*2),e.strokeStyle=o,e.lineWidth=s,e.stroke(),e.restore()}function Fi(e,t,n,o){const s=n-t.startTime,a=Math.min(s/t.duration,1),l=1-a,u=-20*a;e.save(),e.globalAlpha=l,e.font="20px Arial",e.textAlign="center",e.fillText(o,t.position.x,t.position.y+u),e.restore()}function zO(e,t,n,o){const{width:s,height:a}=o.mapDimensions;let l=t.targetPosition;if(t.targetEntityId){const T=o.entities.entities[t.targetEntityId];T&&(l=T.position)}if(!l)return;const u=n-t.startTime,d=Math.min(u/t.duration,1);let f=l.x-t.position.x,p=l.y-t.position.y;f=f-Math.round(f/s)*s,p=p-Math.round(p/a)*a;const m={x:f,y:p},v=t.position.x+m.x*d,y=t.position.y+m.y*d,I=-Math.sin(d*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(v,y,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(v,y+I),e.rotate(d*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function XO(e,t,n){const o=n-t.startTime,s=Math.min(o/t.duration,1),a=t.intensity??1;let l=1;s<.2?l=s/.2:s>.7&&(l=(1-s)/.3);const u=l*a,d=.8+.4*Math.sin(n*2+t.id*2.3),f=.8+.4*Math.sin(n*2.5+t.id*1.7),p=.8+.4*Math.sin(n*1.5+t.id*3.1),m=Math.sin(n*.5+t.id)*2,v=64,y=Va("rgba(255, 80, 0, 0.6)",v),I=Va("rgba(255, 140, 0, 0.7)",v),T=Va("rgba(255, 220, 120, 0.8)",v),A=t.position.x+m,R=t.position.y,_=[{width:16,height:28*d,sprite:y,offsetX:-2},{width:16*a,height:28*d*a,sprite:y,offsetX:-2},{width:14*a,height:24*f*a,sprite:I,offsetX:0},{width:10*a,height:18*p*a,sprite:T,offsetX:1},{width:14,height:24*f,sprite:I,offsetX:0},{width:10,height:18*p,sprite:T,offsetX:1}];for(const E of _){const P=E.width/v,k=E.height/v;op(e,A+E.offsetX,R,E.sprite,P,k,u,"bottom")}const C=Va("rgba(255, 220, 100, 0.9)",v),M=3;for(let E=0;E<M;E++){const P=(n*1+E*.5+t.id)%1,k=A+Math.sin(n*2+E*2)*4,B=R-20-P*15,j=(1-P)*u*.8;op(e,k,B,C,.08,.08,j,"center")}}function VO(e,t,n){const o=n-t.startTime,s=t.intensity??1,a=Math.min(o/t.duration,1);let l=1;a<.15?l=a/.15:a>.8&&(l=(1-a)/.2);const u=64,d=Va("rgba(180, 180, 180, 0.7)",u),f=3;for(let p=0;p<f;p++){const m=Math.min(a+p*.2,1),v=Math.sin(n*.8+p*2+t.id)*3,y=m*50+p*5,I=(6+m*10+p*2)*s,T=l*s*.7,A=I*1.2/u,R=I*2.5/u;op(e,t.position.x+v,t.position.y-y,d,A,R,T,"center")}}function NT(e,t,n,o){switch(t.type){case Te.Procreation:Fi(e,t,n,"");break;case Te.Pregnant:jO(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Te.TargetAcquired:Na(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Te.Attack:Fi(e,t,n,"");break;case Te.Partnered:Fi(e,t,n,"");break;case Te.BushClaimed:Na(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Te.BushClaimLost:Na(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Te.Eating:Fi(e,t,n,"");break;case Te.ChildFed:Fi(e,t,n,"");break;case Te.AttackDeflected:Fi(e,t,n,"");break;case Te.AttackResisted:Fi(e,t,n,"");break;case Te.Hit:Fi(e,t,n,"");break;case Te.SeizeBuildup:Na(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Te.BorderClaim:Fi(e,t,n,"");break;case Te.Seize:Na(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Te.StoneProjectile:zO(e,t,n,o);break;case Te.Fire:XO(e,t,n);break;case Te.Smoke:VO(e,t,n);break}}function Cv(e,t,n,o,s,a,l){e.save();const{position:u}=t;e.strokeStyle=o,e.lineWidth=s+Math.sin(l*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(u.x,u.y,n,0,2*Math.PI),e.stroke(),e.restore()}const Mo={base:"#8B5A2B",highlight:"#A67C52",shadow:"#5C3A1E",outline:"#362010"},yr="#2A1A0E",qO=20;function vt(e,t,n,o,s,a=!0){e.save(),e.fillStyle=Mo.outline,e.fillRect(t,n,o,s),e.fillStyle=Mo.base,e.fillRect(t+1,n+1,o-2,s-2),a?(e.fillStyle=Mo.highlight,e.fillRect(t+1,n+1,1,s-2),e.fillStyle=Mo.shadow,e.fillRect(t+o-2,n+1,1,s-2)):(e.fillStyle=Mo.highlight,e.fillRect(t+1,n+1,o-2,1),e.fillStyle=Mo.shadow,e.fillRect(t+1,n+s-2,o-2,1)),e.restore()}function BT(e,t,n,o,s,a,l){const u=t/2+2,d=5;if(e.save(),l)if(a)e.save(),e.rotate(n),e.fillStyle=yr,e.fillRect(0,-8/2,u,8),vt(e,0,-8/2,u,3,!1),e.restore();else{const p=Math.ceil(u/4);for(let m=0;m<p;m++){const v=m/p*u,y=Math.cos(n)*v,I=Math.sin(n)*v,T=Math.min(4,u-v);e.save(),e.translate(y,I),e.rotate(n),vt(e,0,-8/2,T,8,!1),e.restore()}}else{const f=Math.sin(n)*.6;if(a)e.save(),e.rotate(n),e.fillStyle=yr,e.fillRect(0,-o/2+2,u,o-4),vt(e,0,-o/2+4,u,5,!1),vt(e,0,o/2-9,u,5,!1),e.restore();else for(let p=0;p<u;p+=d){const m=Math.cos(n)*p,v=Math.sin(n)*p,y=(Nn(s+p+n)-.5)*4,I=o+y,T=Math.min(d,u-p),A=-I/2+m*f;vt(e,m-T/2,v+A,T,I,!0)}}e.restore()}function ZO(e,t,n,o,s,a){const l=t/2,u=n/2,d=5;e.save();for(const v of a.connections)BT(e,v.distance,v.angle,n,o,a.isInner,a.isVertical);if(a.isVertical){const v=t*.4,y=n+4;a.isInner?(e.fillStyle=yr,e.fillRect(-v/2,-y/2,v,y),vt(e,-v/2,-y/2,3,y,!0)):vt(e,-v/2,-y/2,v,y,!0)}else{const v=Math.sin(a.wallAngle)*.6;if(a.isInner)e.fillStyle=yr,e.fillRect(-l+2,-u+2,t-4,n-4),vt(e,-l,-u+4,t,5,!1),vt(e,-l,u-5-4,t,5,!1);else{const y=-l,I=l;for(let T=y;T<I;T+=d){const A=(Nn(o+T)-.5)*4,R=n+A,_=-R/2+T*v;vt(e,T,_,Math.min(d,I-T),R,!0)}}}const f=t*.5,p=n+8;if(vt(e,-f/2,-p/2,f,p,!0),e.fillStyle=s,e.globalAlpha=.8,e.fillRect(-f/2+2,-n/6,f-4,n/3),e.globalAlpha=1,!a.connections.some(v=>{let y=v.angle*180/Math.PI;for(;y<=-180;)y+=360;for(;y>180;)y-=360;return y>-150&&y<-30})&&!a.hasGateNeighbor){const y=-p/2;e.fillStyle=Mo.outline,e.beginPath(),e.moveTo(-f/2,y),e.lineTo(0,y-10),e.lineTo(f/2,y),e.fill(),e.fillStyle=Mo.highlight,e.beginPath(),e.moveTo(-f/2+1,y),e.lineTo(0,y-10+1),e.lineTo(0,y),e.fill()}e.restore()}const KO={outline:"#1A1A1A"};function QO(e,t,n,o,s,a){for(const y of a.connections)BT(e,y.distance,y.angle,qO,o,a.isInner,a.isVertical);const l=t/2,u=10,d=12,f=44,p=34,m=8,v=6;if(e.save(),a.isVertical){const T=u-42;a.isInner?(e.fillStyle=yr,e.fillRect(-16/2,T,16,42),vt(e,-16/2,T+8,16,4,!1),vt(e,-16/2,T+42-12,16,4,!1),vt(e,-16/2,T,4,42,!0),vt(e,16/2-4,T,4,42,!0)):(vt(e,-16/2,T,16,42,!0),e.fillStyle=s,e.globalAlpha=.6,e.fillRect(-16/2+2,T+42/3,12,42/3),e.globalAlpha=1)}else{const y=Math.sin(a.wallAngle)*.6,I=A=>{const R=u+A*y-f;a.isInner?(e.fillStyle=yr,e.fillRect(A-d/2,R,d,f),vt(e,A-d/2,R,4,f,!0),vt(e,A+d/2-4,R,4,f,!0)):vt(e,A-d/2,R,d,f,!0)},T=()=>{const A=-l+d/2,R=l-d/2;for(let _=A;_<R;_+=v){const C=Math.min(v,R-_),M=(Nn(o+_)-.5)*4,E=p+M,P=u+_*y-E;a.isInner?(e.fillStyle=yr,e.fillRect(_,P,C,E),vt(e,_,P+4,C,4,!1),vt(e,_,P+E-10,C,4,!1)):(vt(e,_,P,C,E,!0),_>-12&&_<12&&(e.fillStyle=s,e.globalAlpha=.8,e.fillRect(_+1,P+E/4,C-2,E/2.5),e.globalAlpha=1))}for(let _=A-2;_<R+2;_+=4){const C=Math.min(4,R+2-_),M=u+_*y-p-m;vt(e,_,M,C,m,!1)}if(!a.isInner){e.fillStyle=KO.outline;for(const _ of[A,R-6]){const C=u+_*y-p+6,M=u+_*y-12;e.fillRect(_,C,6,3),e.fillRect(_,M,6,3)}}};y>0?(I(l),T(),I(-l)):(I(-l),T(),I(l))}e.restore()}const Pv=8,JO=1.5,e2=.5,_v=2,t2="#5a5a5a",n2="#7e7e7e",i2="#8B0000",o2="#FF4444",r2=6,s2="rgba(40, 40, 40, 0.7)",a2=new Fs(1e3),Rv=50,rd={connections:[],isInner:!1,isVertical:!1,wallAngle:0,hasGateNeighbor:!1};function l2(e,t,n=!1,o=!0,s=rd){if(n)return`ghost_${e.buildingType}_${o}`;const a=e,l=a.buildingType===$.Bonfire&&(a.fuelLevel??0)>0,u=s.connections.slice().sort((f,p)=>f.angle-p.angle).map(f=>{const p=Math.round(f.angle*180/Math.PI/5)*5,m=Math.round(f.distance/2)*2;return`${p}:${m}`}).join(",")+`_inner:${s.isInner}_vert:${s.isVertical}_ang:${Math.round(s.wallAngle*10)}`,d=a.ownerId??"neutral";return`${a.buildingType}_${a.width}_${a.height}_${t}_${a.isConstructed}_${l}_${d}_${u}`}function HT(e,t,n=!1,o=!0,s=rd){const a=l2(e,t,n,o,s),{width:l,height:u,id:d,buildingType:f}=e,p=l+Rv*2,m=u+Rv*2;return a2.getOrRender(a,p,m,v=>{const y=ft[f];if(v.translate(p/2,m/2),n){const I=o?"#4CAF50":"#F44336";f===$.Palisade||f===$.Gate?c2(v,l,u,I):Rh(v,l,u,9999,I),v.font=`${Math.min(l,u)*.5}px Arial`,v.textAlign="center",v.textBaseline="middle",v.fillStyle=I,v.fillText(y.icon,0,0)}else{const I=e;let T=y.icon,A="#FFFFFF";I.ownerId!==void 0&&I.ownerId!==null&&(A=Xt[I.ownerId%Xt.length]),f===$.Palisade?ZO(v,l,u,d,A,s):f===$.Gate?QO(v,l,u,d,A,s):(t?Rh(v,l,u,d,i2,o2):Rh(v,l,u,d),f!==$.Bonfire&&(v.globalAlpha=.5,v.font=`${Math.min(l,u,30)*.5}px Arial`,v.textAlign="center",v.textBaseline="middle",v.shadowColor="rgba(0,0,0,0.5)",v.shadowBlur=4,v.fillStyle="#FFFFFF",v.fillText(T,0,0)))}})}function c2(e,t,n,o){const s=t/2,a=n/2;e.fillStyle=o,e.globalAlpha=.3,e.fillRect(-s,-a,t,n),e.globalAlpha=.8,e.strokeStyle=o,e.lineWidth=2,e.strokeRect(-s,-a,t,n),e.globalAlpha=1}function u2(e,t,n,o,s){if(o<=0)return;e.save(),e.strokeStyle=s2,e.lineWidth=1,e.lineCap="round";const a=Math.floor(o*10)+1;for(let l=0;l<a;l++){const u=s+l*17;let d=(Nn(u)-.5)*t,f=(Nn(u+1)-.5)*n;e.beginPath(),e.moveTo(d,f);const p=5+Nn(u+2)*10,m=Nn(u+3)*Math.PI*2;for(let v=0;v<3;v++)d+=Math.cos(m)*(p/3),f+=Math.sin(m)*(p/3),e.lineTo(d,f);e.stroke()}e.restore()}function Rh(e,t,n,o,s,a){const l=(t+n)*2,u=Math.floor(l/Pv),d=-t/2,f=t/2,p=-n/2,m=n/2;for(let v=0;v<u;v++){const y=o+v*13,I=Nn(y),T=Nn(y+1);let A=v*Pv,R=0,_=0;A<t?(R=d+A,_=p):A<t+n?(R=f,_=p+(A-t)):A<t*2+n?(R=f-(A-(t+n)),_=m):(R=d,_=m-(A-(t*2+n)));const C=(T-.5)*_v,M=(Nn(y+2)-.5)*_v;e.beginPath();const E=JO+I*e2;s?e.fillStyle=s:e.fillStyle=I>.5?a||n2:s||t2,e.ellipse(R+C,_+M,E,E*.85,T*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function d2(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:o}=t;e.save(),e.font=`${r2}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,o.forEach(s=>{const a=s.item.type,l=(Sp[a]||Fp[a])??"?",u={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(l,u.x,u.y)}),e.restore()}function f2(e,t){const{buildingType:n,ownerId:o,position:s,id:a}=e;if(n!==$.Palisade&&n!==$.Gate)return rd;const l=t.buildingVersion??0;if(e.cachedConnections&&e.cachedConnections.computedAt===l)return e.cachedConnections;const{width:u,height:d}=t.mapDimensions,f={connections:[],isInner:!1,isVertical:!1,wallAngle:0,hasGateNeighbor:!1},p=t.search.building.byRadius(s,55);for(const m of p)if(m.id!==a&&(m.buildingType===$.Palisade||m.buildingType===$.Gate)&&m.ownerId===o){const v=Ue(s,m.position,u,d),y=Math.sqrt(v.x*v.x+v.y*v.y);y>=15&&y<=55&&(f.connections.push({angle:Math.atan2(v.y,v.x),distance:y}),m.buildingType===$.Gate&&(f.hasGateNeighbor=!0))}if(f.connections.length>0){let m=0,v=0;for(const y of f.connections)m+=Math.cos(y.angle*2),v+=Math.sin(y.angle*2);f.wallAngle=Math.atan2(v,m)/2}else f.wallAngle=0;if(f.isVertical=f.connections.length>0&&Math.abs(Math.sin(f.wallAngle))>.9,o!=null){const m=(A,R)=>{const _=(A%u+u)%u,C=(R%d+d)%d,M=Math.floor(_/ge),E=Math.floor(C/ge),P=Math.ceil(u/ge);return t.terrainOwnership[E*P+M]},v=f.wallAngle+Math.PI/2,y=s.x+Math.cos(v)*20,I=s.y+Math.sin(v)*20;m(y,I)===o&&(f.isInner=!0)}return e.cachedConnections={...f,computedAt:l},f}function eg(e,t,n){const{position:o,width:s,height:a,constructionProgress:l,destructionProgress:u,isConstructed:d,isBeingDestroyed:f}=t,p=kt(n),m=!!(p&&Ir(p,t,n)),v=f2(t,n),y=HT(t,m,!1,!0,v);e.save(),d||(e.globalAlpha=.3+l*.7),e.drawImage(y,o.x-y.width/2,o.y-y.height/2),f&&d&&(e.translate(o.x,o.y),u2(e,s,a,u,t.id)),e.restore();const I=s,T=o.x-I/2,A=o.y+a/2+aw;d?f&&No(e,T,A,I,iy,1-u,bo,sw):No(e,T,A,I,iy,l,bo,rw),(t.buildingType===$.StorageSpot||t.buildingType===$.Bonfire)&&d&&d2(e,t)}function tg(e,t,n,o,s){const a=ft[n],{width:l,height:u}=a.dimensions,d=HT({buildingType:n,width:l,height:u,id:9999,ownerId:null},!1,!0,o,rd),f=(m,v)=>{m.save(),m.globalAlpha=ow,m.drawImage(d,v.x-d.width/2,v.y-d.height/2),m.restore()},p={position:{...t},radius:Math.max(l,u)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Ne.create()};$n(e,s.width,s.height,(m,v)=>f(m,v.position),p)}const rs=1,h2=20,oi=4,Mv=8,p2="rgba(34, 85, 34, 0.25)",g2="rgba(139, 50, 50, 0.25)",gs=new Map,m2=50;function y2(e,t){return e.map(n=>n.id).sort((n,o)=>n-o).join(",")+`_${t}`}function v2(){if(gs.size>m2){const e=gs.keys().next().value;e&&gs.delete(e)}}function S2(e){const t=new Map;for(const n of e){const o=n.ownerId;o&&(t.has(o)||t.set(o,[]),t.get(o).push(n))}return t}function I2(e,t,n,o){let s=0;const a=Math.max(o.width,o.height)/2;for(const l of n){const u=e-l.position.x,d=t-l.position.y,f=u*u+d*d;f>0?s+=a*a/f:s+=100}return s}function T2(e,t,n){let o=1/0,s=1/0,a=-1/0,l=-1/0;for(const u of e)o=Math.min(o,u.position.x-t.width/2),s=Math.min(s,u.position.y-t.height/2),a=Math.max(a,u.position.x+t.width/2),l=Math.max(l,u.position.y+t.height/2);return{minX:o-n,minY:s-n,maxX:a+n,maxY:l+n}}function A2(e,t,n,o){const s=y2(e,o);if(gs.has(s))return gs.get(s);const a=n.maxX-n.minX,l=n.maxY-n.minY,u=Math.ceil(a/oi),d=Math.ceil(l/oi),f=[],p=[];for(let y=0;y<d;y++)f[y]=new Array(u);for(let y=0;y<d;y++)for(let I=0;I<u;I++){const T=n.minX+I*oi,A=n.minY+y*oi,R=I2(T,A,e,t);f[y][I]=R}for(let y=1;y<d-1;y++)for(let I=1;I<u-1;I++)if(f[y][I]>=rs&&(f[y-1][I]<rs||f[y+1][I]<rs||f[y][I-1]<rs||f[y][I+1]<rs)){const A=n.minX+I*oi,R=n.minY+y*oi;p.push({x:A,y:R})}const m=C2(p),v={fieldValues:f,edgePoints:p,regions:m,bounds:n};return gs.set(s,v),v2(),v}function w2(e,t,n,o,s,a){if(t.length===0)return;const{bounds:l}=a,u=10;if(!a.canvas){const d=l.maxX-l.minX+u*2,f=l.maxY-l.minY+u*2,{canvas:p,ctx:m}=RT(d,f);m.translate(-l.minX+u,-l.minY+u);const{fieldValues:v,regions:y}=a;E2(m,v,l,o);let I=s;for(const T of y){const A=P2(T);_2(m,A,o,I),I+=1e3}a.canvas=p}e.save(),e.globalAlpha=1,e.drawImage(a.canvas,l.minX-u,l.minY-u),e.restore()}function E2(e,t,n,o){const s=o?g2:p2;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++)if(t[a][l]>=rs){const u=n.minX+l*oi,d=n.minY+a*oi;e.rect(u,d,oi,oi)}e.fill(),e.restore()}function C2(e){if(e.length===0)return[];const t=oi*2,n=t,o=new Map;function s(f,p){const m=Math.floor(f/n),v=Math.floor(p/n);return`${m},${v}`}for(let f=0;f<e.length;f++){const p=s(e[f].x,e[f].y);o.has(p)||o.set(p,[]),o.get(p).push(f)}function a(f,p){const m=[],v=Math.floor(f/n),y=Math.floor(p/n);for(let I=-1;I<=1;I++)for(let T=-1;T<=1;T++){const A=`${v+I},${y+T}`,R=o.get(A);R&&m.push(...R)}return m}const l=new Set,u=[],d=t*t;for(let f=0;f<e.length;f++){if(l.has(f))continue;const p=[],m=[f];for(;m.length>0;){const v=m.shift();if(l.has(v))continue;l.add(v),p.push(e[v]);const y=a(e[v].x,e[v].y);for(const I of y){if(l.has(I))continue;const T=e[I].x-e[v].x,A=e[I].y-e[v].y;T*T+A*A<=d&&m.push(I)}}p.length>0&&u.push(p)}return u}function P2(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const o=t[t.length-1];let s=0,a=1/0;for(let l=0;l<n.length;l++){const u=n[l].x-o.x,d=n[l].y-o.y,f=u*u+d*d;f<a&&(a=f,s=l)}t.push(n.splice(s,1)[0])}return t}function _2(e,t,n,o){if(t.length===0)return;let s=0,a=0;for(let l=1;l<t.length;l++){const u=t[l-1],d=t[l],f=d.x-u.x,p=d.y-u.y,m=Math.sqrt(f*f+p*p);for(s+=m;s>=Mv;){s-=Mv;const v=1-s/m,y=u.x+f*v,I=u.y+p*v;R2(e,y,I,n,o+a*13),a++}}}function R2(e,t,n,o,s){const a=Nn(s),l=Nn(s+1),u=(l-.5)*2,d=(Nn(s+2)-.5)*2;e.beginPath();const f=1.5+a*.5;o?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+u,n+d,f,f*.85,l*Math.PI,0,Math.PI*2),e.fill(),o||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function FT(e,t,n,o){var m,v,y;const s=t;if(!((m=s.search)!=null&&m.building))return;const l=s.search.building.all().filter(I=>I.buildingType===$.PlantingZone&&I.isConstructed);if(l.length===0)return;const u=l.filter(I=>rl(I,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(u.length===0)return;const d=ft[$.PlantingZone].dimensions,f=S2(u),p=o?t.entities.entities[o]:void 0;for(const[I,T]of f){const A=((y=(v=p==null?void 0:p.tribeControl)==null?void 0:v.diplomacy)==null?void 0:y[I])==="Hostile",R=typeof I=="number"?I:0,_=T2(T,d,h2),C=A2(T,d,_,A);w2(e,T,d,A,R,C)}}const M2=.001,k2=.05,b2=12;function D2(e,t,n){const{position:o,age:s,swayOffset:a}=t,[l]=t.stateMachine??[],u=Math.min(1,Math.max(.4,s/Uo)),f=l!==Vt&&l!==Ci?Math.sin(n*M2+a)*k2:0;if(e.save(),e.translate(o.x,o.y),e.scale(u,u),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=iM,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),l===Ci?Mh(e,10,8):l===Vt?(e.rotate(Math.PI/2),Mh(e,10,30),e.translate(0,-25),kv(e,40,20,40,15)):(e.rotate(f),Mh(e,10,30),e.translate(0,-25),e.rotate(f*.5),kv(e,40,20,40,15)),e.restore(),(l===Vt||l===Ci)&&t.wood&&t.wood.length>0){e.save(),e.font=`${b2}px Arial`,e.textAlign="center",e.textBaseline="middle";const p=t.radius*1.1,m=Math.PI*2/(td-1);t.wood.forEach((v,y)=>{const I=y===0?0:p,T=y===0?0:(y-1)*m,A=o.x+I*Math.cos(T),R=o.y+I*Math.sin(T),_=Fp[v.type];e.fillText(_,A,R)}),e.restore()}}function Mh(e,t,n){e.fillStyle=QR,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=JR,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function kv(e,t,n,o,s){e.fillStyle=eM,bv(e,t+4,n+4,o+2,s+2),e.translate(0,-2),e.fillStyle=tM,bv(e,t,n,o,s),e.fillStyle=nM,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function bv(e,t,n,o,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-o),e.lineTo(0,-o-s),e.lineTo(n/2,-o),e.lineTo(t/2,0),e.closePath(),e.fill()}const Jc=200;let Eo=null;function O2(e,t,n,o,s){const a=pM(t.time);if(a<=0)return;Eo||(Eo=document.createElement("canvas")),(Eo.width!==o.width||Eo.height!==o.height)&&(Eo.width=o.width,Eo.height=o.height);const l=Eo.getContext("2d");if(l){l.clearRect(0,0,o.width,o.height),l.fillStyle=`rgba(0, 0, 40, ${a*.85})`,l.fillRect(0,0,o.width,o.height),l.globalCompositeOperation="destination-out";for(const u of s){const d=Dl(u.position,n,o,t.mapDimensions),f=l.createRadialGradient(d.x,d.y,0,d.x,d.y,u.radius);f.addColorStop(0,`rgba(255, 255, 255, ${u.intensity})`),f.addColorStop(1,"rgba(255, 255, 255, 0)"),l.fillStyle=f,l.beginPath(),l.arc(d.x,d.y,u.radius,0,Math.PI*2),l.fill()}l.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(Eo,0,0),e.restore()}}function Dv(e,t,n,o,s,a,l){for(let u=-s.height;u<=s.height;u+=s.height)for(let d=-s.width;d<=s.width;d+=s.width){const f={x:t.x+d,y:t.y+u};rl({position:f,radius:n},a,l,s)&&e.push({position:f,radius:n,intensity:o})}}function N2(e,t,n,o,s,a=[]){const l=kt(t),u=l?eo(t,l):[],d=Es(u),{width:f,height:p}=t.mapDimensions,m=[];a.forEach(R=>{m.push({position:R,radius:30,intensity:.3})}),FT(e,t,o,l==null?void 0:l.leaderId);const v=t,y={left:o.x-s.width/2-Jc,top:o.y-s.height/2-Jc,right:o.x+s.width/2+Jc,bottom:o.y+s.height/2+Jc};[...v.search.human.byRect(y),...v.search.building.byRect(y),...v.search.berryBush.byRect(y),...v.search.tree.byRect(y),...v.search.corpse.byRect(y),...v.search.prey.byRect(y),...v.search.predator.byRect(y)].sort((R,_)=>{if(n&&R.id===t.debugCharacterId&&R.id!==_.id)return-1;if(n&&_.id===t.debugCharacterId&&R.id!==_.id)return 1;const C=P=>{if(P.type==="building"){const k=P;return k.buildingType===$.StorageSpot||k.buildingType===$.PlantingZone?k.position.y-k.height/2:k.position.y+k.height/2}return P.position.y+P.radius},M=C(R),E=C(_);return M!==E?M-E:R.id-_.id}).forEach(R=>{var _,C;if(R.type==="building"){const M=R;if(M.isConstructed){const E=M.buildingType===$.Bonfire&&(M.fuelLevel??0)>0,P=E?180:60,k=E?.9:.4;Dv(m,M.position,P,k,t.mapDimensions,o,s)}if(M.buildingType===$.PlantingZone&&M.isConstructed)return;$n(e,f,p,eg,M,t,l,t.time)}else if(R.type==="berryBush")$n(e,f,p,dO,R,t,l,t.time);else if(R.type==="tree")$n(e,f,p,D2,R,t.time);else if(R.type==="human"){const M=R,E=M.id===(l==null?void 0:l.id),P=u.some(X=>X.id===M.id),k=M.id===(d==null?void 0:d.id),B=l&&(M.id===l.motherId||M.id===l.fatherId),j=l&&(((_=M.partnerIds)==null?void 0:_.includes(l.id))||((C=l.partnerIds)==null?void 0:C.includes(M.id))),Z=(l==null?void 0:l.attackTargetId)===M.id;Dv(m,M.position,40,.3,t.mapDimensions,o,s),$n(e,f,p,BO,M,E,B,P,j,k,Z,n,t)}else R.type==="corpse"?$n(e,f,p,yO,R):R.type==="prey"?$n(e,f,p,xO,R,n,t,t.debugCharacterId):R.type==="predator"&&$n(e,f,p,WO,R,n,t,t.debugCharacterId)}),t.visualEffects.filter(R=>rl(R,o,s,t.mapDimensions)).forEach(R=>{$n(e,f,p,NT,R,t.time,t)});const A=t.notifications.filter(R=>!R.isDismissed);for(const R of A)if(R.highlightedEntityIds&&R.renderHighlights)for(const _ of R.highlightedEntityIds){const C=t.entities.entities[_];C&&rl(C,o,s,t.mapDimensions)&&$n(e,f,p,Cv,C,WP,YP,zP,jP,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const R of t.tutorialState.highlightedEntityIds){const _=t.entities.entities[R];_&&rl(_,o,s,t.mapDimensions)&&$n(e,f,p,Cv,_,MP,cI,uI,Hp,t.time)}O2(e,t,o,s,m)}function B2(e,t,n,o,s,a){let l=null,u=null;e.textAlign="left";let d=Re+It;const p=t.time/(Bt/Gt)/$u%1,m=Ma[is.Time],v=25,y=Re+v;e.fillText(m,Re,d+kn/2+It/3),No(e,y,d,wo,kn,p,bo,lP),d+=kn+Hi;const I=d+Gi/2,T=d+(Gi-kn)/2,A=5;Al(e,{x:Re*2,y:I},Gi,5,n.gender,!1,!1,!1);const R=Re+Gi+A,_=wo+v-(Gi+A)*2;No(e,R,T,_,kn,Math.floor(n.age)/dl,bo,aP),Al(e,{x:R+_+A+Gi/2,y:I},Gi,dl,n.gender,!1,!1,!1),d+=kn+Hi*2;const C=[],M=new Set;if(C.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),M.add(n.id),o&&!M.has(o.id)&&(C.push({member:o,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),M.add(o.id)),s.forEach(te=>{M.has(te.id)||(C.push({member:te,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),M.add(te.id))}),a.forEach(te=>{M.has(te.id)||(C.push({member:te,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),M.add(te.id))}),n.motherId&&!M.has(n.motherId)){const te=t.entities.entities[n.motherId];te&&(C.push({member:te,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),M.add(te.id))}if(n.fatherId&&!M.has(n.fatherId)){const te=t.entities.entities[n.fatherId];te&&(C.push({member:te,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),M.add(te.id))}const E=Ma[is.Family],P=10,k=Re+It+P,B=wo+v-(It+P),j=d+jc/2;e.font=`${It}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(E,Re,j);const Z=d+jc/2;rO(e,k,Z,C,jc,B),d+=jc+Hi,e.textBaseline="alphabetic";const X=Ma[is.Hitpoints];e.fillText(X,Re,d+kn/2+It/3),No(e,y,d,wo,kn,n.hitpoints/n.maxHitpoints,bo,sP),d+=kn+Hi;const ie=Ma[is.Hunger];e.fillText(ie,Re,d+kn/2+It/3),No(e,y,d,wo,kn,(rn-n.hunger)/rn,bo,rP),l={x:Re,y:d-Hi/2,width:wo+v,height:kn+Hi},d+=kn+Hi,e.textBaseline="middle";const ee=Ma[is.Food];return e.fillText(ee,Re,d+Yc/2),vO(e,y,d+Yc/2,n.food,Yc,wo),u={x:Re,y:d-Hi/5,width:wo+v,height:Yc+Hi},e.textBaseline="alphabetic",{hungerBarRect:l,foodBarRect:u}}let Ba=[],Ov=0;const H2=36,F2=200;function L2(e,t,n,o){const s=t.search.prey.count(),a=t.search.predator.count(),l=t.search.berryBush.count(),u=t.search.tree.count();t.time-Ov>=H2&&(Ba.push({time:t.time,prey:s,predators:a,bushes:l,trees:u}),Ba.length>F2&&(Ba=Ba.slice(-200)),Ov=t.time);const d=Ye*je,f=s/d*1e6,p=a/d*1e6,m=l/d*1e6,v=u/d*1e6,y=BD(),I=Math.floor(t.time/(24*365)),T=Math.floor(t.time%(24*365)/24),A=Math.floor(t.time%24),R=400,_=Math.min(o*.8,600),C=n-R-10,M=Re+It*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(C,M,R,_),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(C,M,R,_),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let E=M+20;const P=14,k=C+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",k,E),E+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${I}, Day ${T}, Hour ${A}`,k,E),E+=P,e.fillText(`Map Size: ${Ye}  ${je} pixels`,k,E),E+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",k,E),E+=18,y&&(e.fillText(`Q-Table Size: ${y.qTableSize} entries`,k,E),E+=P,e.fillText(`Exploration Rate: ${(y.explorationRate*100).toFixed(1)}%`,k,E),E+=P);const B=Ba.slice(-20);B.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",k,E),E+=30,x2(e,k,E,B),E+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",k,E),E+=18,e.fillStyle="white",e.font="12px monospace";const j=(ji/d*1e6).toFixed(2),Z=(zi/d*1e6).toFixed(2),X=(Xi/d*1e6).toFixed(2),ie=(Vi/d*1e6).toFixed(2);e.fillText(`Prey: ${f.toFixed(2)} (target: ${j})`,k,E),E+=P,e.fillText(`Predators: ${p.toFixed(2)} (target: ${Z})`,k,E),E+=P,e.fillText(`Bushes: ${m.toFixed(2)} (target: ${X})`,k,E),E+=P,e.fillText(`Trees: ${v.toFixed(2)} (target: ${ie})`,k,E),E+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",k,E),E+=18,e.fillStyle="white",e.font="12px monospace";const ee=Math.round(s/ji*100),te=Math.round(a/zi*100),K=Math.round(l/Xi*100),ue=Math.round(u/Vi*100),ce=Y=>Y<50?"#ff4444":Y<80?"#ffaa44":Y>120?"#44aaff":"#44ff44";e.fillStyle=ce(ee),e.fillText(`Prey: ${s}/${ji} (${ee}%)`,k,E),E+=P,e.fillStyle=ce(te),e.fillText(`Predators: ${a}/${zi} (${te}%)`,k,E),E+=P,e.fillStyle=ce(ue),e.fillText(`Trees: ${u}/${Vi} (${ue}%)`,k,E),E+=P,e.fillStyle=ce(K),e.fillText(`Bushes: ${l}/${Xi} (${K}%)`,k,E),E+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",k,E),E+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",k,E),E+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,k,E),E+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,k,E),E+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,k,E),E+=13,e.fillText("Predators:",k,E),E+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,k,E),E+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,k,E),E+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,k,E),E+=13,e.fillText("Bushes:",k,E),E+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,k,E),E+=15,e.fillText("Trees:",k,E),E+=13,e.fillText(` Spread Chance: ${(t.ecosystem.treeSpreadChance*100).toFixed(1)}%`,k,E),E+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",C+R/2,M+_-10),e.restore()}function x2(e,t,n,o){if(o.length<2)return;const u={prey:Math.max(...o.map(f=>f.prey),ji),predators:Math.max(...o.map(f=>f.predators),zi),bushes:Math.max(...o.map(f=>f.bushes),Xi),trees:Math.max(...o.map(f=>f.trees),Vi)};[{data:o.map(f=>f.prey),color:"#44ff44",label:"Prey",target:ji,max:u.prey},{data:o.map(f=>f.predators),color:"#ff4444",label:"Predators",target:zi,max:u.predators},{data:o.map(f=>f.trees),color:"#76a331",label:"Trees",target:Vi,max:u.trees},{data:o.map(f=>f.bushes),color:"#ffaa44",label:"Bushes",target:Xi,max:u.bushes}].forEach((f,p)=>{const m=t+p%2*115,v=n+Math.floor(p/2)*55;e.fillStyle=f.color,e.font="10px monospace",e.textAlign="left",e.fillText(f.label,m,v-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,v,100,30),e.beginPath(),e.strokeStyle=f.color;for(let I=0;I<f.data.length;I++){const T=m+I/(f.data.length-1)*100,A=v+30-f.data[I]/f.max*30;I===0?e.moveTo(T,A):e.lineTo(T,A)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const y=v+30-f.target/f.max*30;e.moveTo(m,y),e.lineTo(m+100,y),e.stroke(),e.setLineDash([])})}function U2(e,t){const n=t.search.human.byProperty("leaderId",e),o={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||o.children++,s.gender==="male"?o.males++:s.gender==="female"&&o.females++,s.age>=wp&&o.old++;return o}function G2(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(f=>n.berryBush.byRadius(f.position,f.radius)).reduce((f,p)=>f+p.food.length,0),d=n.building.byProperty("ownerId",e).filter(f=>f.buildingType===$.StorageSpot).reduce((f,p)=>f+(p.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:d,consumptionRate:0}}function $2(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,l=new Map,u=new Map;for(const f of s){const p=ku(f.id,t,l);u.has(p)||u.set(p,[]),u.get(p).push(f)}const d=[];for(const[f,p]of u.entries()){const m=a[f];m&&d.push({patriarch:m,memberCount:p.length,members:p.map(v=>v.id)})}return d.sort((f,p)=>p.memberCount-f.memberCount),d.slice(0,n)}let Ha=[],vi=[],Nv=0;const W2=36,Bv=200;function Y2(e,t,n,o){var M;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(M=Xp(s,t))==null?void 0:M.id;if(!a)return;const l=U2(a,t),u=G2(a,t);if(t.time-Nv>=W2){Ha.push({time:t.time,total:l.total,children:l.children,males:l.males,females:l.females,old:l.old});const E=u.totalBushFood+u.totalStorageFood;vi.push({time:t.time,bushFood:u.totalBushFood,storageFood:u.totalStorageFood,totalFood:E}),Ha.length>Bv&&(Ha=Ha.slice(-200)),vi.length>Bv&&(vi=vi.slice(-200)),Nv=t.time}let d=0;if(vi.length>=2){const E=vi[vi.length-1],P=vi[vi.length-2],k=E.time-P.time;k>0&&(d=(P.totalFood-E.totalFood)/k)}const f=400,p=Math.min(o*.9,700),m=n-f-10,v=Re+It*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,v,f,p),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,v,f,p),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let y=v+20;const I=13,T=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",T,y),y+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",T,y),y+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${l.total}`,T,y),y+=I,e.fillStyle="#00ffff",e.fillText(`Children: ${l.children}`,T,y),y+=I,e.fillStyle="#4488ff",e.fillText(`Males: ${l.males}`,T,y),y+=I,e.fillStyle="#ff88ff",e.fillText(`Females: ${l.females}`,T,y),y+=I,e.fillStyle="#888888",e.fillText(`Old (${l.old})`,T,y),y+=20;const A=Ha.slice(-50);A.length>1&&(j2(e,T,y,A),y+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",T,y),y+=18;const R=u.totalBushFood+u.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${R}`,T,y),y+=I,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${u.totalBushFood}`,T,y),y+=I,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${u.totalStorageFood}`,T,y),y+=I,e.fillStyle="#ff4444",e.fillText(`Consumption: ${d.toFixed(2)}/hour`,T,y),y+=20;const _=vi.slice(-50);_.length>1&&(z2(e,T,y,_),y+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",T,y),y+=18;const C=$2(a,t,5);e.fillStyle="white",e.font="11px monospace",C.length===0?(e.fillText("No families found",T,y),y+=I):C.forEach((E,P)=>{const B=`${P+1}. ${E.patriarch.isPlayer?"Player":"#"+E.patriarch.id} (${E.memberCount} members, can split: ${RI(E.patriarch,t).canSplit})`;e.fillText(B,T,y),y+=I}),y+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+f/2,v+p-10),e.restore()}function j2(e,t,n,o){if(o.length<2)return;const l=Math.max(...o.map(d=>Math.max(d.total,d.children,d.males,d.females,d.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:o.map(d=>d.total),color:"#ffffff",label:"Total"},{data:o.map(d=>d.children),color:"#00ffff",label:"Children"},{data:o.map(d=>d.males),color:"#4488ff",label:"Males"},{data:o.map(d=>d.females),color:"#ff88ff",label:"Females"},{data:o.map(d=>d.old),color:"#888888",label:"Old"}].forEach(d=>{e.beginPath(),e.strokeStyle=d.color,e.lineWidth=2;for(let f=0;f<d.data.length;f++){const p=t+f/(d.data.length-1)*350,m=n+80-d.data[f]/l*80;f===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function z2(e,t,n,o){if(o.length<2)return;const l=Math.max(...o.map(d=>Math.max(d.totalFood,d.bushFood,d.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:o.map(d=>d.totalFood),color:"#ffff00",label:"Total"},{data:o.map(d=>d.bushFood),color:"#44ff44",label:"Bush"},{data:o.map(d=>d.storageFood),color:"#ffaa44",label:"Storage"}].forEach(d=>{e.beginPath(),e.strokeStyle=d.color,e.lineWidth=2;for(let f=0;f<d.data.length;f++){const p=t+f/(d.data.length-1)*350,m=n+80-d.data[f]/l*80;f===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function Hv(e,t,n){e.save();const{x:o,y:s,width:a,height:l}=t.rect,u=rI;if(e.beginPath(),e.moveTo(o+u,s),e.lineTo(o+a-u,s),e.quadraticCurveTo(o+a,s,o+a,s+u),e.lineTo(o+a,s+l-u),e.quadraticCurveTo(o+a,s+l,o+a-u,s+l),e.lineTo(o+u,s+l),e.quadraticCurveTo(o,s+l,o,s+l-u),e.lineTo(o,s+u),e.quadraticCurveTo(o,s,o+u,s),e.closePath(),e.fillStyle=t.isDisabled?sI:t.backgroundColor,e.fill(),t.activated){e.save();const d=(Math.sin(Date.now()/1e3*lI)+1)/2;e.strokeStyle=_u,e.lineWidth=2+d*2,e.globalAlpha=.7+d*.3,e.stroke(),e.restore()}if(t.lastActivated){const d=Date.now()-t.lastActivated;if(d<Pu){const f=1-d/Pu;e.fillStyle=aI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Np,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?Bp:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+a-4,s+l-2))):(e.font=`${It*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+a/2,s+l/2)),e.restore()}function X2(e,t,n,o){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,o);const s=500,a=150,l=(n-s)/2,u=(o-a)/2;e.fillStyle=dt,e.font=`${It*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,u+a/3-10),e.fillText("to the main menu?",n/2,u+a/3+10);const d=Yi*1.5,f=Cu,p=u+a-f-Re*2,m=20,v=d*2+m,y=l+(s-v)/2,I={id:"confirmExitYes",action:Oe.ConfirmExitYes,rect:{x:y,y:p,width:d,height:f},text:"Yes",backgroundColor:gn,textColor:dt,currentWidth:d},T=y+d+m,A={id:"confirmExitNo",action:Oe.ConfirmExitNo,rect:{x:T,y:p,width:d,height:f},text:"No",backgroundColor:gn,textColor:dt,currentWidth:d};t.uiButtons.push(I,A),Hv(e,I,t.hoveredButtonId===I.id),Hv(e,A,t.hoveredButtonId===A.id),e.restore()}let Fv="",Lv=null;function V2(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function q2(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function eu(e,t,n,o,s,a,l){const u=((t+o)%a+a)%a,d=((n+s)%l+l)%l;return e.has(`${u},${d}`)}function Z2(e,t,n,o){const s=f_(t.soilDepletion,NS);if(s.length===0)return;const{width:a,height:l}=t.mapDimensions,u=o.width/2,d=o.height/2,f=Math.ceil(a/zt),p=Math.ceil(l/zt),m=V2(s);m!==Fv&&(Fv=m,Lv=q2(s));const v=Lv,y=zt*2,I=n.x-u-y,T=n.x+u+y,A=n.y-d-y,R=n.y+d+y;e.save();const _=e.globalAlpha;for(const C of s){const M=C.gridX*zt,E=C.gridY*zt,P=K2(M,E,a,l,I,T,A,R);for(const k of P)Q2(e,k.x,k.y,C.health,C.gridX,C.gridY,v,f,p)}e.globalAlpha=_,e.restore()}function K2(e,t,n,o,s,a,l,u){const d=[],f=zt,p=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-o},{dx:0,dy:o},{dx:-n,dy:-o},{dx:n,dy:-o},{dx:-n,dy:o},{dx:n,dy:o}];for(const m of p){const v=e+m.dx,y=t+m.dy;v+f>=s&&v<=a&&y+f>=l&&y<=u&&d.push({x:v,y})}return d}function Q2(e,t,n,o,s,a,l,u,d){const f=Math.floor(t),p=Math.floor(n),m=zt,v=1-o/NS,I=o<LE?Iy:Iy*v,T=!eu(l,s,a,0,-1,u,d),A=!eu(l,s,a,0,1,u,d),R=!eu(l,s,a,-1,0,u,d),_=!eu(l,s,a,1,0,u,d);e.globalAlpha=I,e.fillStyle=HE,e.fillRect(f,p,m,m);const C=3;e.fillStyle=FE,e.globalAlpha=I*1.2,T&&e.fillRect(f,p,m,C),A&&e.fillRect(f,p+m-C,m,C),R&&e.fillRect(f,p,C,m),_&&e.fillRect(f+m-C,p,C,m),e.globalAlpha=I*.5;const M=C+1;T&&R&&e.fillRect(f,p,M,M),T&&_&&e.fillRect(f+m-M,p,M,M),A&&R&&e.fillRect(f,p+m-M,M,M),A&&_&&e.fillRect(f+m-M,p+m-M,M,M),e.globalAlpha=1}const Fa=8,La=12,un=24;function xv(e,t,n,o,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-La),e.stroke(),e.fillStyle=o,e.beginPath(),e.moveTo(t,n-La),e.lineTo(t+Fa,n-La+Fa/2),e.lineTo(t,n-La+Fa),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+Fa/2,n-La+Fa/2))}function ng(e,t,n,o,s){const a=Vu(t,s);let l=1;const u=new Map,d=new Map;for(const T of a){const R=T.leaderId===s?0:l++,_=Xt[R%Xt.length];u.set(T.leaderId,_),d.set(T.leaderId,T.tribeBadge||"")}const f=[],p=un*2,m=Math.floor((n.x-o.width/2-p)/un)*un,v=Math.floor((n.x+o.width/2+p)/un)*un,y=Math.floor((n.y-o.height/2-p)/un)*un,I=Math.floor((n.y+o.height/2+p)/un)*un;for(let T=y;T<=I;T+=un)for(let A=m;A<=v;A+=un){const R=ai(A,T,t),_=A+un,C=ai(_,T,t);if(R!==C){const P=R||C;if(P){const k=A+un/2,B=T;xv(e,k,B,u.get(P)||"#000",d.get(P)||""),f.push({x:k,y:B})}}const M=T+un,E=ai(A,M,t);if(R!==E){const P=R||E;if(P){const k=A,B=T+un/2;xv(e,k,B,u.get(P)||"#000",d.get(P)||""),f.push({x:k,y:B})}}}return f}const dn=12,ct=16,fn=15;function Uv(e){switch(e){case O.Success:return"#4CAF50";case O.Failure:return"#F44336";case O.Running:return"#FFC107";case O.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function kh(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function J2(e,t,n,o){var k,B;const{debugCharacterId:s}=t,a=500,l=Math.min(o*.9,800),u=n-a-10,d=Re+It*2;t.debugPanelRect={x:u,y:d,width:a,height:l},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(u,d,a,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(u,d,a,l),e.fillStyle="white",e.font=`${dn}px monospace`,e.textAlign="left",e.textBaseline="top";let f=d+20;const p=u+15;if(e.fillStyle="#66ccff",e.font=`bold ${dn+2}px monospace`,e.fillText(" Task AI Debugger",p,f),f+=25,!s){e.fillStyle="#888",e.font=`${dn}px monospace`,e.fillText("No character selected for debugging.",p,f),e.fillText("Click on a character to inspect their Task AI.",p,f+20),e.restore();return}const m=t.entities.entities[s];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${dn}px monospace`,e.fillText(`Character #${s} not found or not a character.`,p,f),e.restore();return}const v=m;e.fillStyle="white",e.font=`${dn}px monospace`,e.fillText(`Character: ${v.type} #${v.id} (${v.age.toFixed(1)}y)`,p,f),f+=ct*1.5,e.fillStyle="#66ccff",e.font=`bold ${dn}px monospace`,e.fillText(" Current Task",p,f),f+=ct*1.5;const y=Il(v),I=y?t.tasks[y]:null;if(e.font=`${dn}px monospace`,I){const j=Ne.get(v.aiBlackboard,tT),Z=Ne.get(v.aiBlackboard,nT),X=j!==void 0?O[j]:"N/A";e.fillStyle="white",e.fillText(`ID: ${I.id}`,p+fn,f),f+=ct,e.fillText(`Type: ${z[I.type]}`,p+fn,f),f+=ct,e.fillText(`Target: ${kh(I.target)}`,p+fn,f),f+=ct,e.fillStyle=Uv(j),e.fillText(`Status: ${X}`,p+fn,f),f+=ct,Z&&(e.fillStyle="#aaa",e.fillText(`Message: ${Z}`,p+fn,f),f+=ct)}else e.fillStyle="#888",e.fillText("No active task.",p+fn,f),f+=ct;if(f+=ct,v.type==="human"){const j=v;e.fillStyle="#66ccff",e.font=`bold ${dn}px monospace`,e.fillText(" Pathfinding",p,f),f+=ct*1.5,e.font=`${dn}px monospace`,e.fillStyle="white",e.fillText(`Waypoints: ${((k=j.path)==null?void 0:k.length)||0}`,p+fn,f),f+=ct,j.pathTarget&&(e.fillText(`Target: ${kh(j.pathTarget)}`,p+fn,f),f+=ct),j.path&&j.path.length>0&&(e.fillText(`Next: ${kh(j.path[0])}`,p+fn,f),f+=ct),f+=ct}e.fillStyle="#66ccff",e.font=`bold ${dn}px monospace`,e.fillText(" Recent Task History (Last 5)",p,f),f+=ct*1.5;const T=Ne.get(v.aiBlackboard,ep)||[];if(T.length===0)e.fillStyle="#888",e.font=`${dn}px monospace`,e.fillText("No task history yet.",p+fn,f),f+=ct;else for(const j of T){e.fillStyle="white",e.font=`${dn}px monospace`;const Z=z[j.type];e.fillText(` ${Z}`,p+fn,f);const X=O[j.result];e.fillStyle=Uv(j.result);const ie=e.measureText(` ${Z} `).width;e.fillText(`(${X})`,p+fn+ie,f),e.fillStyle="#666";const ee=e.measureText(`(${X}) `).width;e.fillText(`@ ${j.completedAtTick.toFixed(1)}h`,p+fn+ie+ee,f),f+=ct,j.message&&(e.fillStyle="#888",e.fillText(`   ${j.message}`,p+fn,f),f+=ct)}f+=ct,e.fillStyle="#66ccff",e.font=`bold ${dn}px monospace`,e.fillText(" Available Tasks",p,f),f+=ct*1.5;const A=f,R=d+l-A-30;e.save(),e.beginPath(),e.rect(u,A,a,R),e.clip();const _=((B=t.debugPanelScroll)==null?void 0:B.y)??0;e.translate(0,-_);const C=t.search.tasks.byRadius(m.position,800);let M=0;if(C.length===0)e.fillStyle="#888",e.font=`${dn}px monospace`,e.fillText("No tasks available in the world.",p+fn,f),f+=ct;else{const j=C.map(Z=>{const X=nd[Z.type];return{task:Z,score:X&&X.scorer&&v.type==="human"?X.scorer(v,Z,{gameState:t,deltaTime:0}):null}});j.sort((Z,X)=>{const ie=Z.score!==null?Z.score:-1/0;return(X.score!==null?X.score:-1/0)-ie});for(const{task:Z,score:X}of j){let ie="Unclaimed",ee="#888";Z.claimedByEntityId&&(Z.claimedByEntityId===v.id?(ie="Claimed by this character",ee="#4CAF50"):(ie=`Claimed by #${Z.claimedByEntityId}`,ee="#F44336")),e.font=`${dn}px monospace`,e.fillStyle=ee;const te=` Task ID: ${Z.id}`;e.fillText(te,p,f),f+=ct,e.fillStyle="white",e.fillText(`  Type: ${z[Z.type]}`,p,f),f+=ct;const K=X!==null?X.toFixed(3):"N/A";e.fillStyle=X!==null&&X>0?"#FFC107":"#888",e.fillText(`  Score: ${K}`,p,f),f+=ct,e.fillStyle=ee,e.fillText(`  Status: ${ie}`,p,f),f+=ct*1.5,M=Math.max(M,e.measureText(te).width+30)}}const E=f-A;t.debugPanelContentSize={width:M,height:E},e.restore();const P=d+l-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",u+a/2,P),e.restore()}function eN(e,t,n,o){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey"))switch(a.aiType){case to.TaskBased:default:J2(e,t,n,o);break}}function Nu(e,t,n,o,s,a=!1){var f;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),cO(e,t);return}const l=kt(t),u=ng(e,t,n,s,l==null?void 0:l.leaderId);if(Z2(e,t,n,s),N2(e,t,t.debugPanel===Ze.General,n,s,u),l&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const p=ip(t.mousePosition,n,s,t.mapDimensions),m=Ar(p,t.selectedBuildingType,l.leaderId,t);tg(e,p,t.selectedBuildingType,m,t.mapDimensions)}const d=t.notifications.filter(p=>!p.isDismissed);for(const p of d){const m=(Math.sin(t.time*UP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=xP,p.targetArea&&e.fillRect(p.targetArea.x,p.targetArea.y,p.targetArea.width,p.targetArea.height),p.targetRadius&&(e.beginPath(),e.arc(p.targetRadius.x,p.targetRadius.y,p.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,TO(e,t),e.restore(),!a){e.fillStyle=nP,e.font=`${It}px "Press Start 2P", Arial`,e.shadowColor=iP,e.shadowBlur=oP,t.uiButtons=[];let p=null,m=null;if(l){const I=eo(t,l),T=Es(I),A=((f=l.partnerIds)==null?void 0:f.map(_=>t.entities.entities[_]).filter(_=>_!==void 0))||[],R=B2(e,t,l,T,A,I);p=R.hungerBarRect,m=R.foodBarRect}const v=Vu(t,l==null?void 0:l.leaderId);KD(e,t,n,v,e.canvas.width,e.canvas.height,t.cameraZoom);const{commandButtonsRect:y}=zD(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,l&&(SO(e,t,n,e.canvas.width,e.canvas.height),o.length>0&&ZD(e,o,l,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:I}=t.tutorialState;I.includes(mr.HUNGER_BAR)&&p&&Eh(e,p,t.time),I.includes(mr.FOOD_BAR)&&m&&Eh(e,m,t.time),I.includes(mr.COMMAND_BUTTONS)&&y&&Eh(e,y,t.time)}if(t.tutorialState.isActive){const I=lO(e,t,e.canvas.width,e.canvas.height);I&&t.uiButtons.push({id:"tutorial-dismiss",action:Oe.DismissTutorial,rect:I,text:"",currentWidth:I.width,backgroundColor:"transparent",textColor:"transparent"})}switch(wO(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case Ze.Ecosystem:L2(e,t,e.canvas.width,e.canvas.height);break;case Ze.Tribe:Y2(e,t,e.canvas.width,e.canvas.height);break;case Ze.Performance:CO(e,t,s.width);break;case Ze.General:eN(e,t,e.canvas.width,e.canvas.height);break}t.tribeModalOpen&&sO(e,t,v,e.canvas.width,e.canvas.height),t.strategicMenuOpen&&YD(e,t,e.canvas.width,e.canvas.height),t.isPaused&&t.exitConfirmation!=="pending"&&XD(e),t.exitConfirmation==="pending"&&X2(e,t,e.canvas.width,e.canvas.height)}}const tN=Be.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,nN=Be.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,iN=Be.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,oN=Be.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Gv=Be.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,rN=Be.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,sN=Be.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,tu="intro-soundtrack",$v=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=_i(),o=ne.useRef(null),s=ne.useRef(null),a=ne.useRef(Bb()),l=ne.useRef(),u=ne.useRef(a.current.viewportCenter),d=ne.useRef(),f=ne.useCallback(()=>{yh(tu,2),n(),e("game")},[e,n]),p=ne.useCallback(()=>{t&&(yh(tu,2),e("game"))},[e,t]);ne.useEffect(()=>{const y=I=>{(I.key==="Enter"||I.key===" ")&&(t?p():f())};return window.addEventListener("keydown",y),()=>{window.removeEventListener("keydown",y)}},[f,p,t]),ne.useEffect(()=>(Gp(Ee.SoundTrack1,{loop:!0,trackId:tu}),()=>{yh(tu,2)}),[]),ne.useEffect(()=>{const y=o.current;if(!y)return;s.current=y.getContext("2d");const I=()=>{y&&s.current&&(y.width=window.innerWidth,y.height=window.innerHeight,Nu(s.current,a.current,u.current,[],{width:y.width,height:y.height},!0))};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]),ne.useEffect(()=>{const y=()=>{const T=QS(a.current);if(T.length>0){const A=Math.floor(Math.random()*T.length);d.current=T[A].id}};y();const I=setInterval(y,TE);return()=>clearInterval(I)},[]);const[m,v]=vp(y=>{var A,R;if(!s.current)return;if(l.current===void 0){l.current=y;return}const I=Math.min((y-l.current)/1e3,1);a.current=od(a.current,I);const T=d.current?a.current.entities.entities[d.current]:void 0;if(T){const{mapDimensions:_}=a.current,{width:C,height:M}=_;let E={...T.position};const P=E.x-u.current.x;Math.abs(P)>C/2&&(P>0?E.x-=C:E.x+=C);const k=E.y-u.current.y;Math.abs(k)>M/2&&(k>0?E.y-=M:E.y+=M);let B=hu(u.current,E,Su*I);B={x:(B.x%C+C)%C,y:(B.y%M+M)%M},u.current=B}Nu(s.current,a.current,u.current,[],{width:((A=o.current)==null?void 0:A.width)||800,height:((R=o.current)==null?void 0:R.height)||600},!0),l.current=y},!1);return ne.useEffect(()=>(v(),m),[v,m]),G.jsxs(tN,{children:[G.jsx(nN,{ref:o}),G.jsxs(iN,{children:[G.jsx(oN,{children:"Tribe2"}),G.jsxs(rN,{children:[G.jsx(Gv,{onClick:f,children:"New Game"}),t&&G.jsx(Gv,{onClick:p,children:"Load Game"})]}),G.jsxs(sN,{children:["by"," ",G.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function aN(){console.log("Tribe game initialized with detailed 2D world state.");const e=Nb();return e.ecosystem={preyGestationPeriod:dr,preyProcreationCooldown:fr,predatorGestationPeriod:hr,predatorProcreationCooldown:pr,preyHungerIncreasePerHour:Do,predatorHungerIncreasePerHour:Oo,berryBushSpreadChance:qi,treeSpreadChance:Zi},e.debugPanel=Ze.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const lN=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:o,playerActionHintsRef:s})=>(ne.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const l=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,Nu(t.current,n.current,o.current,s.current,{width:a.width,height:a.height},!1))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),G.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),cN=(e,t,n,o=!1)=>{var l,u;let s;const a=HC(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:_e.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:_e.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const d=a;t.isAdult&&Pl(t,d,n)?s={action:_e.AutopilotAttack,targetEntityId:d.id}:Os(t,d,n)?s={action:_e.AutopilotProcreate,targetEntityId:d.id}:t.food.length>0&&!d.isAdult&&(d.motherId===t.id||d.fatherId===t.id)&&(s={action:_e.AutopilotFeedChild,targetEntityId:d.id})}else if(a.type==="prey")s={action:_e.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:_e.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const d=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&Ir(t,d,n)&&d.isConstructed?s={action:_e.RemoveEnemyBuilding,targetEntityId:d.id}:s={action:_e.Removal,position:a.position};else if(t.leaderId===t.id&&Ir(t,d,n)&&d.isConstructed)qS(d.position,hs,t.id,n).valid?s={action:_e.TakeOverBuilding,targetEntityId:d.id}:s={action:_e.AutopilotMove,position:e};else if(d.buildingType==="storageSpot"){const f=d.ownerId===t.leaderId,p=d.storedItems.length>0,m=d.storageCapacity!==void 0&&d.storedItems.length<d.storageCapacity;if(o&&d.isConstructed&&p&&t.food.length<t.maxFood)if(f)s={action:_e.AutopilotRetrieve,targetEntityId:a.id};else{const v=t.leaderId?n.entities.entities[t.leaderId]:void 0;v&&((l=v.tribeControl)!=null&&l.diplomacy)?(d.ownerId&&v.tribeControl.diplomacy[d.ownerId])===Nt.Hostile?s={action:_e.AutopilotGather,targetEntityId:a.id}:s={action:_e.AutopilotMove,position:e}:s={action:_e.AutopilotMove,position:e}}else f&&d.isConstructed?(t.food.length>0||t.heldItem)&&m?s={action:_e.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&p?s={action:_e.AutopilotRetrieve,targetEntityId:a.id}:s={action:_e.AutopilotMove,position:e}:s={action:_e.AutopilotMove,position:e}}else d.buildingType==="plantingZone"&&t.food.filter(f=>f.type===ci.Berry).length>=vr&&!Ji(e,n,Gu)&&!Er(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:_e.AutopilotPlant,position:e}:d.buildingType===$.Bonfire&&((u=t.heldItem)==null?void 0:u.type)===$t.Wood&&d.isConstructed&&d.storedItems.length<(d.storageCapacity||0)?s={action:_e.AutopilotDeposit,targetEntityId:d.id}:s={action:_e.AutopilotMove,position:e}}else if(a.type==="tree"){const d=a,[f]=d.stateMachine??[],p=f===Xn||f===wn||f===Vn;t.isAdult&&!t.heldItem&&p?s={action:_e.AutopilotChop,targetEntityId:d.id}:t.isAdult&&!t.heldItem&&f===Vt&&d.wood.length>0?s={action:_e.AutopilotGather,targetEntityId:d.id}:s={action:_e.AutopilotMove,position:e}}}else t.food.filter(d=>d.type===ci.Berry).length>=vr&&(n.autopilotControls.isManuallyPlanting||Rl(e,n,t))&&!Er(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:_e.AutopilotPlant,position:e}:s={action:_e.AutopilotMove,position:e};return s},uN=(e,t)=>{if(e.isPaused)return;const n=kt(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=Q(n.position,t,e.mapDimensions.width,e.mapDimensions.height),l=100;a<=l?Ar(t,s,n.leaderId,e,n.position,l)&&(bp(t,s,n.leaderId,e),e.selectedBuildingType=null):Ar(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:_e.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=VC(t,e);s&&Vh(s.id,e);return}const o=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,o?(e.autopilotControls.activeAutopilotAction=o,(o.action===_e.AutopilotMove||o.action===_e.AutopilotGather||o.action===_e.AutopilotChop)&&(e.hasPlayerMovedEver=!0),o.action===_e.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:_e.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},dN=(e,t)=>{var l,u,d,f,p,m;const n=e.key.toLowerCase(),o=e.ctrlKey||e.metaKey;let s=!0,a=t;if(o){switch(n){case"s":dp(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:v}=t;v.activeAutopilotAction||v.isManuallyMoving||v.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(v.activeAutopilotAction=void 0,v.isManuallyMoving=!1,v.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"m":t.isMuted=!t.isMuted,el(t.masterVolume,t.isMuted);break;case"=":case"+":const y=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(y.toFixed(1)),el(t.masterVolume,t.isMuted);break;case"-":const I=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(I.toFixed(1)),el(t.masterVolume,t.isMuted);break;case"t":a=od(t,AI);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===Ze.General?(a.debugPanel=Ze.None,a.debugCharacterId=void 0):(a.debugPanel=Ze.General,a.debugCharacterId||(a.debugCharacterId=((l=kt(a))==null?void 0:l.id)??((u=Object.values(a.entities.entities).find(T=>T.type==="human"||T.type==="prey"||T.type==="predator"))==null?void 0:u.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===Ze.Ecosystem){a.debugPanel=Ze.None;break}a.debugPanel=Ze.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((d=kt(a))==null?void 0:d.id)??((f=Object.values(a.entities.entities).find(T=>T.type==="human"||T.type==="prey"||T.type==="predator"))==null?void 0:f.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===Ze.Tribe){a.debugPanel=Ze.None;break}a.debugPanel=Ze.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((p=kt(a))==null?void 0:p.id)??((m=a.search.human.all().find(T=>T.leaderId===T.id))==null?void 0:m.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===Ze.Performance){a.debugPanel=Ze.None;break}a.debugPanel=Ze.Performance}else s=!1;break;case"tab":if(a.debugPanel!==Ze.General&&a.debugPanel!==Ze.Tribe&&(a.debugPanel=Ze.General),a.debugPanel===Ze.General){const T=Object.values(a.entities.entities).filter(A=>A.type==="human"||A.type==="prey"||A.type==="predator");if(T.length>0){const A=T.sort((M,E)=>{if(M.type==="human"&&M.isPlayer)return-1;if(E.type==="human"&&E.isPlayer)return 1;if(M.type!==E.type){const P={human:0,prey:1,predator:2},k=P[M.type]??999,B=P[E.type]??999;return k-B}return M.id-E.id}),R=a.debugCharacterId,C=((R?A.findIndex(M=>M.id===R):-1)+1)%A.length;a.debugCharacterId=A[C].id}else a.debugCharacterId=void 0}else if(a.debugPanel===Ze.Tribe){const T=a.search.human.all().filter(R=>R.leaderId===R.id);let A=T.findIndex(R=>R.id===a.debugCharacterId)+1;(A===-1||A>T.length-1)&&(A=0),a.debugCharacterId=T[A].id}else a.debugPanel=Ze.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},fN=(e,t,n,o,s)=>{var l;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",Me(a,Ee.ButtonClick,o.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",Me(a,Ee.ButtonClick,o.position);return}else if(e==="3"){n.selectedBuildingType="palisade",Me(a,Ee.ButtonClick,o.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",Me(a,Ee.ButtonClick,o.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",Me(a,Ee.ButtonClick,o.position);return}else if(e==="6"){n.selectedBuildingType="removal",Me(a,Ee.ButtonClick,o.position);return}else if(e==="7"){n.selectedBuildingType="gate",Me(a,Ee.ButtonClick,o.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const u=Je(o,n,"berryBush",et,p=>p.food.length>0&&o.food.length<o.maxFood),d=Je(o,n,"corpse",et,p=>p.food.length>0&&o.food.length<o.maxFood);let f=null;u&&d?f=Q(o.position,u.position,n.mapDimensions.width,n.mapDimensions.height)<=Q(o.position,d.position,n.mapDimensions.width,n.mapDimensions.height)?u:d:f=u||d,f&&(o.activeAction="gathering",Me(a,Ee.Gather,o.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}Je(o,n,"human",et,d=>Os(o,d,n))&&(o.activeAction="procreating",Me(a,Ee.Procreate,o.position))}else if(e==="f")o.food.length>0&&(o.activeAction="eating",Me(a,Ee.Eat,o.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const u=s.find(d=>d.type===_e.FeedChild);u&&u.targetEntity&&(o.activeAction="feeding",o.target=u.targetEntity.id)}else if(e==="arrowup"||e==="w")o.direction.y=-1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")o.direction.y=1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")o.direction.x=-1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")o.direction.x=1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const u=Je(o,n,"human",En,d=>Pl(o,d,n))??Je(o,n,"predator",En)??Je(o,n,"prey",En);u&&(o.activeAction="attacking",o.attackTargetId=u.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(d=>d.type===_e.Plant)){const d=gC(o.position,n,50,Wh);d&&(o.activeAction="planting",o.target=d,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const u=Je(o,n,"building",li,f=>{const p=f;return p.buildingType===$.Bonfire&&p.isConstructed&&p.storedItems.length<(p.storageCapacity||0)});if(((l=o.heldItem)==null?void 0:l.type)===$t.Wood&&u){o.activeAction="depositing",o.target=u.id,Me(a,Ee.StorageDeposit,o.position);return}const d=Je(o,n,"building",li,f=>{const p=f;return p.buildingType===$.StorageSpot&&p.ownerId===o.leaderId&&p.isConstructed&&p.storageCapacity!==void 0&&p.storedItems.length<p.storageCapacity});d&&(o.activeAction="idle",o.target=d.id,Me(a,Ee.StorageDeposit,o.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const u=Je(o,n,"building",li,d=>{const f=d;return f.buildingType==="storageSpot"&&f.ownerId===o.leaderId&&f.isConstructed&&f.storedItems.length>0});u&&(o.activeAction="idle",o.target=u.id,Me(a,Ee.StorageRetrieve,o.position))}else if(e==="k")MI(o,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,Me(a,Ee.ButtonClick,o.position)}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const u=Je(o,n,"tree",Wu,d=>d.wood&&d.wood.length>0&&!o.heldItem);u&&(o.activeAction="chopping",o.target=u.id)}},hN=(e,t,n,o)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!o.current.has("arrowup")&&!o.current.has("arrowdown")&&!o.current.has("arrowleft")&&!o.current.has("arrowright")&&!o.current.has("w")&&!o.current.has("a")&&!o.current.has("s")&&!o.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!o.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!o.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!o.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!o.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!o.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},pN=(e,t,n)=>{const{mapDimensions:o}=e,{width:s,height:a}=o;if(!e.cameraFollowingPlayer){if(e.cameraTargetPosition){const d=Ue(t,e.cameraTargetPosition,s,a);if(ms(d)<1){const v=e.cameraTargetPosition;return e.cameraTargetPosition=void 0,v}const p=Qi(t,d);let m=hu(t,p,Su*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return t}let u=kt(e);if(e.debugCharacterId){const d=e.entities.entities[e.debugCharacterId];d&&"position"in d&&(u=d)}if(u){let d={...u.position};const f=d.x-t.x;Math.abs(f)>s/2&&(f>0?d.x-=s:d.x+=s);const p=d.y-t.y;Math.abs(p)>a/2&&(p>0?d.y-=a:d.y+=a);let m=hu(t,d,Su*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return e.viewportCenter};function gN(e,t){const{width:n,height:o}=e.mapDimensions;e.cameraTargetPosition=void 0,e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%o+o)%o}}const mN=(e,t,n,o)=>{var d,f;const s={gameState:n},a=kt(n);a&&Me(s,Ee.ButtonClick,a.position);const l=n.uiButtons.find(p=>p.id===e.id);l&&(l.lastActivated=Date.now()),t&&[Oe.CommandGather,Oe.CommandPlant,Oe.ToggleProcreationBehavior,Oe.CommandBuild].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:u}=n.autopilotControls;switch(e.action){case Oe.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case Oe.ConfirmExitYes:o(),n.exitConfirmation="inactive";break;case Oe.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case Oe.ToggleMute:n.isMuted=!n.isMuted,el(n.masterVolume,n.isMuted);break;case Oe.TogglePause:n.isPaused=!n.isPaused;break;case Oe.FastForward:return od(n,AI);case Oe.DismissTutorial:n.tutorialState.isActive=!1;break;case Oe.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case Oe.CommandGather:t?u.gathering=!u.gathering:a&&(a.activeAction="gathering");break;case Oe.CommandPlant:t?u.planting=!u.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case Oe.ToggleProcreationBehavior:u.procreation=!u.procreation;break;case Oe.ToggleAttackBehavior:u.attack=!u.attack;break;case Oe.ToggleFeedChildBehavior:u.feedChildren=!u.feedChildren;break;case Oe.CommandTribeSplit:a&&MI(a,n);break;case Oe.CommandBuild:t?u.build=!u.build:n.buildMenuOpen=!n.buildMenuOpen;break;case Oe.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case Oe.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case Oe.SelectRemovalTool:n.selectedBuildingType="removal";break;case Oe.SelectBorderPost:n.selectedBuildingType="borderPost";break;case Oe.SelectBonfire:n.selectedBuildingType="bonfire";break;case Oe.SelectPalisade:n.selectedBuildingType="palisade";break;case Oe.SelectGate:n.selectedBuildingType="gate";break;case Oe.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const p=a.leaderId,m=e.targetTribeId,v=n.entities.entities[m],y=(d=a.tribeControl)==null?void 0:d.diplomacy,I=(f=v==null?void 0:v.tribeControl)==null?void 0:f.diplomacy;if(y&&I){const A=(y[m]||Nt.Friendly)===Nt.Friendly?Nt.Hostile:Nt.Friendly;y[m]=A,I[p]=A}}break;case Oe.OpenTribeModal:n.tribeModalOpen=!0;break;case Oe.RecenterCamera:n.cameraFollowingPlayer=!0;break;case Oe.CloseTribeModal:n.tribeModalOpen=!1;break;case Oe.ToggleStrategicMenu:n.strategicMenuOpen=!n.strategicMenuOpen;break;case Oe.SelectStrategicObjective:if(a&&a.leaderId&&e.objective!==void 0){const p=n.entities.entities[a.leaderId];p&&(p.tribeControl||(p.tribeControl={diplomacy:{}}),p.tribeControl.strategicObjective=e.objective,n.strategicMenuOpen=!1)}break}return n};function yN(e,t,n){if(!e.notificationButtonRects)return!1;const o=kt(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return fC(e,s),o&&Me({gameState:e},Ee.ButtonClick,o.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const l=e.notifications.find(u=>u.id===s);if(l){let u=l.targetPosition;if(!u&&l.targetEntityIds&&l.targetEntityIds.length>0){const d=e.entities.entities[l.targetEntityIds[0]];d&&(u=d.position)}return u&&gN(e,u),o&&Me({gameState:e},Ee.ButtonClick,o.position),l.highlightedEntityIds&&(l.renderHighlights=!l.renderHighlights),!0}}return!1}function LT(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const vN=(e,t)=>{var n;if(t.debugPanel!==Ze.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(LT(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},SN=(e,t)=>t.debugPanel!==Ze.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:LT(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Wv=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},IN=(e,t)=>{var n,o;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const l=t.debugPanelRect.height-60,u=Math.max(0,(((o=t.debugPanelContentSize)==null?void 0:o.height)??0)-l);return t.debugPanelScroll.y>u&&(t.debugPanelScroll.y=u),{newState:t,handled:!0}}return{newState:t,handled:!1}};function TN(e,t,n){if(!n.minimapRect)return;const{x:o,y:s,width:a,height:l}=n.minimapRect;e>=o&&e<=o+a&&t>=s&&t<=s+l&&(n.isDraggingMinimap=!0,n.minimapDragDistance=0)}function AN(e,t,n,o){n.isDraggingMinimap&&(n.isDraggingMinimap=!1,n.minimapDragDistance<5&&EN(e,t,n,o,!1))}function wN(e,t,n,o,s){if(!n.minimapRect){n.hoveredMinimapTribeId=null;return}if(n.isDraggingMinimap){if(o){n.minimapDragDistance+=Math.sqrt(o.x*o.x+o.y*o.y),n.cameraFollowingPlayer=!1,n.cameraTargetPosition=void 0;const{width:l,height:u}=n.mapDimensions,{width:d,height:f}=n.minimapRect,p=o.x/d*l,m=o.y/f*u,v=n.viewportCenter.x-p,y=n.viewportCenter.y-m,I={x:(v%l+l)%l,y:(y%u+u)%u};n.viewportCenter=I,s&&(s.current=I)}return}const a=xT(e,t,n.minimapRect,n);a?n.hoveredMinimapTribeId=ai(a.x,a.y,n):n.hoveredMinimapTribeId=null}function EN(e,t,n,o,s=!1){if(!n.minimapRect)return;const a=xT(e,t,n.minimapRect,n);a&&(n.cameraFollowingPlayer=!1,s?(n.viewportCenter=a,n.cameraTargetPosition=void 0,o&&(o.current=a)):n.cameraTargetPosition=a)}function CN(e,t,n,o,s){if(!o.minimapRect)return!1;const{x:a,y:l,width:u,height:d}=o.minimapRect;if(t>=a&&t<=a+u&&n>=l&&n<=l+d){o.cameraFollowingPlayer=!1,o.cameraTargetPosition=void 0;const{width:f,height:p}=o.mapDimensions,m=e.deltaX/u*f,v=e.deltaY/d*p,y=o.viewportCenter.x+m,I=o.viewportCenter.y+v,T={x:(y%f+f)%f,y:(I%p+p)%p};return o.viewportCenter=T,s&&(s.current=T),!0}return!1}function xT(e,t,n,o){const s=e-n.x,a=t-n.y;if(s<0||s>n.width||a<0||a>n.height)return null;const{width:l,height:u}=o.mapDimensions,d=n.width/2,f=n.height/2,p=s-d,m=a-f,v=p/n.width*l,y=m/n.height*u,I=o.viewportCenter.x+v,T=o.viewportCenter.y+y;return{x:(I%l+l)%l,y:(T%u+u)%u}}function PN(e,t,n){t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,a=t.viewportCenter.x+e.deltaX,l=t.viewportCenter.y+e.deltaY,u={x:(a%o+o)%o,y:(l%s+s)%s};return t.viewportCenter=u,n.current=u,!0}function _N(e,t){(e.button===1||e.button===2)&&(t.isDraggingViewport=!0,t.viewportDragButton=e.button,t.viewportDragDistance=0)}function RN(e,t,n){if(t.isDraggingViewport){t.viewportDragDistance+=Math.sqrt(e.movementX*e.movementX+e.movementY*e.movementY),t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,a=t.viewportCenter.x-e.movementX,l=t.viewportCenter.y-e.movementY,u={x:(a%o+o)%o,y:(l%s+s)%s};t.viewportCenter=u,n.current=u}}function MN(e,t){t.isDraggingViewport&&e.button===t.viewportDragButton&&(t.isDraggingViewport=!1,t.viewportDragButton=null)}const kN=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:a,returnToIntro:l})=>(ne.useEffect(()=>{const u=d=>{if(!e()||t.current.gameOver||!n.current)return;const f=n.current.getBoundingClientRect(),p=d.clientX-f.left,m=d.clientY-f.top;if(CN(d,p,m,t.current,o)){d.preventDefault();return}const v=vN(d,t.current);t.current=v.newState,!v.handled&&PN(d,t.current,o)&&d.preventDefault()};return window.addEventListener("wheel",u,{passive:!1}),()=>{window.removeEventListener("wheel",u)}},[e,n,t,o]),ne.useEffect(()=>{const u=f=>{if(!e()||t.current.gameOver||!n.current||!f.target||f.target!==n.current)return;const p=n.current.getBoundingClientRect(),m=f.clientX-p.left,v=f.clientY-p.top;if(yN(t.current,m,v))return;const I=t.current.uiButtons.find(_=>m>=_.rect.x&&m<=_.rect.x+_.rect.width&&v>=_.rect.y&&v<=_.rect.y+_.rect.height);if(I){t.current=mN(I,f.shiftKey,t.current,l);return}const T=t.current.minimapRect;if(T&&m>=T.x&&m<=T.x+T.width&&v>=T.y&&v<=T.y+T.height){TN(m,v,t.current);return}const A=SN(f,t.current);if(t.current=A.newState,A.handled)return;_N(f,t.current);const R=ip({x:m,y:v},o.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);uN(t.current,R)},d=f=>{if(!e()||!n.current)return;const p=n.current.getBoundingClientRect(),m=f.clientX-p.left,v=f.clientY-p.top;AN(m,v,t.current,o),MN(f,t.current);const y=Wv(f,t.current);t.current=y.newState};return window.addEventListener("mousedown",u),window.addEventListener("mouseup",d),()=>{window.removeEventListener("mousedown",u),window.removeEventListener("mouseup",d)}},[e,n,t,o,l]),ne.useEffect(()=>{const u=d=>{if(!e()||!n.current)return;const f=IN(d,t.current);if(t.current=f.newState,f.handled)return;if(t.current.isDraggingDebugPanel&&(d.buttons&1)===0){const R=Wv(d,t.current);t.current=R.newState}const p=n.current.getBoundingClientRect(),m=d.clientX-p.left,v=d.clientY-p.top;RN(d,t.current,o),t.current.mousePosition={x:m,y:v};let y;if(t.current.notificationButtonRects){for(const[R,_]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=_.x&&m<=_.x+_.width&&v>=_.y&&v<=_.y+_.height){y=`notification-dismiss-${R}`;break}if(!y){for(const[R,_]of Object.entries(t.current.notificationButtonRects.view))if(m>=_.x&&m<=_.x+_.width&&v>=_.y&&v<=_.y+_.height){y=`notification-view-${R}`;break}}}if(!y)for(let R=t.current.uiButtons.length-1;R>=0;R--){const _=t.current.uiButtons[R];if(m>=_.rect.x&&m<=_.rect.x+_.rect.width&&v>=_.rect.y&&v<=_.rect.y+_.rect.height){y=_.id;break}}if(t.current.hoveredButtonId=y,y){t.current.autopilotControls.hoveredAutopilotAction=void 0,t.current.hoveredMinimapTribeId=null;return}const I=t.current.minimapRect,T=t.current.isDraggingMinimap;if(I&&m>=I.x&&m<=I.x+I.width&&v>=I.y&&v<=I.y+I.height||T){wN(m,v,t.current,{x:d.movementX,y:d.movementY},o),t.current.autopilotControls.hoveredAutopilotAction=void 0;return}else t.current.hoveredMinimapTribeId=null;const A=kt(t.current);if(A){const R=ip({x:m,y:v},o.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=cN(R,A,t.current,d.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}},[e,n,t,o]),ne.useEffect(()=>{const u=f=>{if(!e()||t.current.gameOver)return;const p=f.key.toLowerCase();(p===" "||p==="p"||p==="tab"||(f.ctrlKey||f.metaKey)&&(p==="s"||p==="a"))&&f.preventDefault();const m=dN(f,t.current);if(t.current=m.newState,m.handled)return;const v=kt(t.current);v&&(a.current.add(p),fN(p,f.shiftKey,t.current,v,s.current))},d=f=>{if(!e()||t.current.gameOver)return;const p=f.key.toLowerCase();a.current.delete(p);const m=kt(t.current);m&&hN(p,m,t.current,a)};return window.addEventListener("keydown",u),window.addEventListener("keyup",d),()=>{window.removeEventListener("keydown",u),window.removeEventListener("keyup",d)}},[e,t,s,a,l]),ne.useEffect(()=>{const u=n.current;if(!u)return;const d=f=>{e()&&f.preventDefault()};return u.addEventListener("contextmenu",d),()=>{u.removeEventListener("contextmenu",d)}},[n,e]),null),bN=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:a,canvasRef:l,setAppState:u,appState:d})=>{const f=ne.useRef(),{returnToIntro:p}=_i(),[m,v,y]=vp(I=>{var M,E;if(!t.current||!f.current){f.current=I;return}const T=Math.min(I-f.current,1e3)/1e3,{performanceMetrics:A}=e.current;A.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const R=performance.now();e.current=od(e.current,T),A.currentBucket.worldUpdateTime=performance.now()-R;const _=kt(e.current);_?s.current=kI(e.current,_):s.current=[],(e.current.viewportCenter.x!==o.current.x||e.current.viewportCenter.y!==o.current.y)&&(o.current=e.current.viewportCenter),o.current=pN(e.current,o.current,T),e.current.viewportCenter=o.current;const C=performance.now();Nu(t.current,e.current,o.current,s.current,{width:((M=l.current)==null?void 0:M.width)||800,height:((E=l.current)==null?void 0:E.height)||600},!1),A.currentBucket.renderTime=performance.now()-C,A.history.push({bucketTime:e.current.time,...A.currentBucket}),A.history.length>AE&&A.history.shift(),f.current=I,e.current.gameOver&&d!=="gameOver"&&(Gp(Ee.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),u("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))},!1);return ne.useEffect(()=>(v(),m),[v,m]),G.jsx(kN,{isActive:y,gameStateRef:e,canvasRef:l,viewportCenterRef:o,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:p})},Yv=()=>{const{savedGameState:e,contextReady:t}=_i(),[n,o]=ne.useState(null);return ne.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),o(e)):(console.log("Initializing new game state..."),o(aN())))},[t,e]),!t||!n?G.jsx("div",{children:"Loading..."}):G.jsx(DN,{initialState:n})},DN=({initialState:e})=>{const t=ne.useRef(null),n=ne.useRef(null),o=ne.useRef(e),s=ne.useRef(new Set),a=ne.useRef(e.debugPanel),l=ne.useRef(e.viewportCenter),u=ne.useRef([]),{appState:d,setAppState:f}=_i();return G.jsxs(G.Fragment,{children:[G.jsx(lN,{canvasRef:t,ctxRef:n,gameStateRef:o,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:u}),G.jsx(bN,{gameStateRef:o,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:u,keysPressed:s,canvasRef:t,setAppState:f,appState:d})]})},ON=Be.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,NN=Be.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,nu=Be.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,BN=Be.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,HN=()=>{const{setAppState:e,gameOverDetails:t}=_i(),n=()=>{e("intro")};return G.jsxs(ON,{children:[G.jsx(NN,{children:"Game Over"}),G.jsx(nu,{children:"Your tribe's lineage has ended."}),t&&G.jsxs(G.Fragment,{children:[G.jsxs(nu,{children:["Generations Survived: ",t.generations]}),G.jsxs(nu,{children:["Cause of Extinction: ",t.cause]})]}),!t&&G.jsx(nu,{children:"Game details are unavailable."}),G.jsx(BN,{onClick:n,children:"Return to Menu"})]})},FN=Be.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,LN=Be.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,xN=Be.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,UN=Be.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,GN=Be.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,UT=Be.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,$N=Be(UT)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,xa=800,Ua=600,WN=()=>{const{returnToIntro:e}=_i(),t=ne.useRef(null),n=ne.useRef(),o=ne.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:xa,height:Ua}}),s=l=>{const u={x:xa/2,y:Ua/2};let d;l===Te.StoneProjectile&&(d={x:u.x+200*(Math.random()-Math.random()),y:u.y+200*(Math.random()-Math.random())}),Le(o.current,l,u,1,void 0,void 0,d)};ne.useEffect(()=>{const l=()=>{o.current.time+=.016,qp(o.current);const d=t.current,f=d==null?void 0:d.getContext("2d");f&&(f.clearRect(0,0,xa,Ua),f.fillStyle="#2c5234",f.fillRect(0,0,xa,Ua),o.current.visualEffects.forEach(p=>{NT(f,p,o.current.time,o.current)})),n.current=requestAnimationFrame(l)};return n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(Te).filter(l=>isNaN(Number(l))).map(l=>({name:l,value:Te[l]}));return G.jsxs(FN,{children:[G.jsxs(LN,{children:[G.jsx(GN,{children:"Visual Effects"}),a.map(l=>G.jsx(UT,{onClick:()=>s(l.value),children:l.name},l.name)),G.jsx($N,{onClick:e,children:"Back to Intro"})]}),G.jsxs(xN,{children:[G.jsx(UN,{ref:t,width:xa,height:Ua}),G.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},YN=Be.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,jN=Be.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,zN=Be.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,XN=Be.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,VN=Be.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,jv=Be.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,rp=Be.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,qN=Be(rp)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,ZN=Be.label`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  cursor: pointer;

  input {
    margin-right: 8px;
  }
`,Wn=800,Yn=600,KN=(e,t)=>{const n=e.reduce((s,a)=>(s[a.id]=a,s),{});n[1]={id:1,type:"human",leaderId:1,isPlayer:!0,tribeInfo:{tribeBadge:"",tribeColor:"#4CAF50"},position:{x:0,y:0},radius:10,isAdult:!0,gender:"male",age:25},n[2]={id:2,type:"human",leaderId:2,isPlayer:!1,tribeInfo:{tribeBadge:"",tribeColor:"#F44336"},position:{x:0,y:0},radius:10,isAdult:!0,gender:"male",age:30,tribeControl:{diplomacy:{1:"Hostile"}}};const o={time:0,mapDimensions:{width:Wn,height:Yn},entities:{entities:n},terrainOwnership:t,notifications:[],visualEffects:[],tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[]},plantingZoneConnections:{}};return o.search={building:{all:()=>e,byRadius:(s,a)=>e.filter(l=>Q(s,l.position,Wn,Yn)<=a),byRect:()=>e,byProperty:(s,a)=>e.filter(l=>l[s]===a)},human:{all:()=>[n[1],n[2]],byProperty:(s,a)=>Object.values(n).filter(l=>l.type==="human"&&l[s]===a),byRadius:()=>[],byRect:()=>Object.values(n).filter(s=>s.type==="human")},berryBush:{byRect:()=>[],all:()=>[]},tree:{byRect:()=>[],all:()=>[]},corpse:{byRect:()=>[],all:()=>[]},prey:{byRect:()=>[],all:()=>[]},predator:{byRect:()=>[],all:()=>[]},tasks:{byRect:()=>[],all:()=>[]}},o},QN=(e,t,n,o)=>{const s=ft[t];return{id:e,type:"building",buildingType:t,position:n,ownerId:o,constructionProgress:1,destructionProgress:0,isConstructed:!0,isBeingDestroyed:!1,width:s.dimensions.width,height:s.dimensions.height,storedItems:[],storageCapacity:10,radius:Math.max(s.dimensions.width,s.dimensions.height)/2,direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Ne.create()}},JN=()=>{const{returnToIntro:e}=_i(),t=ne.useRef(null),n=ne.useRef(),[o,s]=ne.useState($.Palisade),[a,l]=ne.useState(!1),[u,d]=ne.useState([]),[f,p]=ne.useState(null),[m,v]=ne.useState(10),[y,I]=ne.useState(new Array(Math.ceil(Wn/ge)*Math.ceil(Yn/ge)).fill(null)),T=ne.useCallback((C,M)=>{const E=Ce;return{x:Math.round(C/E)*E,y:Math.round(M/E)*E}},[]),A=ne.useCallback(C=>{const M=t.current;if(!M)return;const E=M.getBoundingClientRect(),P=C.clientX-E.left,k=C.clientY-E.top,B=T(P,k);if(!u.some(Z=>Math.abs(Z.position.x-B.x)<5&&Math.abs(Z.position.y-B.y)<5)){const Z=a?2:1,X=QN(m,o,B,Z),ie=[...y],ee={mapDimensions:{width:Wn,height:Yn},terrainOwnership:ie},te=lr(o);ps(B,te,Z,ee),I(ie),o!==$.BorderPost&&d(K=>[...K,X]),v(K=>K+1)}},[o,a,m,T,u,y]),R=ne.useCallback(C=>{const M=t.current;if(!M)return;const E=M.getBoundingClientRect(),P=C.clientX-E.left,k=C.clientY-E.top;p(T(P,k))},[T]),_=ne.useCallback(()=>{d([]),v(10),I(new Array(Math.ceil(Wn/ge)*Math.ceil(Yn/ge)).fill(null))},[]);return ne.useEffect(()=>{const C=()=>{const M=t.current,E=M==null?void 0:M.getContext("2d");if(!E)return;const P={x:Wn/2,y:Yn/2},k=KN(u,y);E.fillStyle="#2c5234",E.fillRect(0,0,Wn,Yn),ng(E,k,P,{width:Wn,height:Yn},1),FT(E,k,P,1),E.strokeStyle="rgba(255,255,255,0.05)",E.lineWidth=1;for(let B=0;B<=Wn;B+=Ce)E.beginPath(),E.moveTo(B,0),E.lineTo(B,Yn),E.stroke();for(let B=0;B<=Yn;B+=Ce)E.beginPath(),E.moveTo(0,B),E.lineTo(Wn,B),E.stroke();for(const B of u)B.buildingType!==$.PlantingZone&&eg(E,B,k);f&&tg(E,f,o,!0,{width:Wn,height:Yn}),n.current=requestAnimationFrame(C)};return n.current=requestAnimationFrame(C),()=>{n.current&&cancelAnimationFrame(n.current)}},[u,f,o,y]),G.jsxs(YN,{children:[G.jsxs(jN,{children:[G.jsx(VN,{children:"Building Test"}),G.jsx(jv,{children:"Settings"}),G.jsxs(ZN,{children:[G.jsx("input",{type:"checkbox",checked:a,onChange:C=>l(C.target.checked)}),"Show as Hostile"]}),G.jsx(jv,{children:"Building Type"}),Object.values($).map(C=>G.jsxs(rp,{onClick:()=>s(C),style:{backgroundColor:o===C?"#666":"#444",borderLeft:o===C?"3px solid #4CAF50":"none"},children:[ft[C].icon," ",ft[C].name]},C)),G.jsx(rp,{onClick:_,style:{backgroundColor:"#a33",marginTop:"20px",textAlign:"center"},children:" Clear All"}),G.jsx(qN,{onClick:e,children:"Back to Intro"})]}),G.jsxs(zN,{children:[G.jsx(XN,{ref:t,width:Wn,height:Yn,onClick:A,onMouseMove:R,onMouseLeave:()=>p(null),style:{cursor:"crosshair"}}),G.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Click to place buildings. Test palisade connectivity by placing them adjacent to each other."})]})]})},eB=Be.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,tB=Be.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,nB=Be.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,iB=Be.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,oB=Be.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,Ga=Be.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,An=Be.button`
  background-color: ${e=>e.active?"#666":"#444"};
  color: white;
  border: ${e=>e.active?"2px solid #4CAF50":"none"};
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: center;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`,zv=Be.div`
  display: flex;
  flex-direction: column;
  margin-bottom: 15px;

  label {
    font-size: 0.8rem;
    color: #aaa;
    margin-bottom: 5px;
  }
`,rB=Be(An)`
  background-color: #833;
  margin-top: auto;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,Co=Be.p`
  font-size: 0.9rem;
  color: #888;
  margin: 5px 0;
`,Dn=800,On=600,sB=()=>{const e=Math.ceil(Dn/ge)*Math.ceil(On/ge);return{time:0,mapDimensions:{width:Dn,height:On},entities:{entities:{},nextEntityId:2},navigationGrid:Ku(Dn,On),soilDepletion:Ip(),temperature:{sectors:{}},pathfindingQueue:[],notifications:[],visualEffects:[],nextVisualEffectId:1,tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[],currentStepIndex:0,completedSteps:[],transitionAlpha:0,transitionState:tn.INACTIVE,stepStartTime:null},plantingZoneConnections:{},terrainOwnership:new Array(e).fill(null),performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!1,build:!1,chopping:!1},isManuallyMoving:!1},ecosystem:{lastUpdateTime:0,preyGestationPeriod:24,preyProcreationCooldown:48,predatorGestationPeriod:36,predatorProcreationCooldown:72,preyHungerIncreasePerHour:.1,predatorHungerIncreasePerHour:.1,berryBushSpreadChance:.01,treeSpreadChance:.005},tasks:{},scheduledEvents:[],nextScheduledEventId:1,generationCount:1,gameOver:!1,viewportCenter:{x:Dn/2,y:On/2},isPaused:!1,exitConfirmation:"inactive",buildMenuOpen:!1,tribeModalOpen:!1,strategicMenuOpen:!1,cameraFollowingPlayer:!1,cameraZoom:1,masterVolume:1,isMuted:!1,uiButtons:[],tutorial:{steps:[]},lastAutosaveTime:Date.now(),autosaveIntervalSeconds:0,debugPanel:Ze.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,buildingVersion:0}},aB=()=>{var pe;const{returnToIntro:e}=_i(),t=ne.useRef(null),[n]=ne.useState(sB()),[o,s]=ne.useState(null),[a,l]=ne.useState(null),[u,d]=ne.useState(null),[f,p]=ne.useState(0),[m,v]=ne.useState("tree"),[y,I]=ne.useState(null),[T,A]=ne.useState(1),[R,_]=ne.useState(1),[C,M]=ne.useState([]),[E,P]=ne.useState(null),[k,B]=ne.useState(null),[j,Z]=ne.useState(!1),[X,ie]=ne.useState(1),[ee,te]=ne.useState(Cs),K=ne.useRef(0),ue=ne.useCallback((re,oe)=>({x:Math.round(re/Ce)*Ce,y:Math.round(oe/Ce)*Ce}),[]);ne.useEffect(()=>{n.navigationGrid=Ku(Dn,On),n.entities.entities={},n.entities.nextEntityId=100;for(const re of C){let oe;if(re.type==="tree")oe=Cr;else{const ae=ft[re.type].dimensions;oe=Math.max(ae.width,ae.height)/2}const me=re.type===$.Gate?re.ownerId??null:null;if((re.type===$.Palisade||re.type===$.Gate||re.type==="tree")&&Ps(n,re.pos,oe,!0,me,ee),re.type==="tree")Ms(n.entities,re.pos,n.time,100);else{const ae=fT(n.entities,re.pos,re.type,re.ownerId||0);ae.isConstructed=!0}}if(o&&a){const re={leaderId:R},{path:oe,iterations:me}=BI(n,o,a,re);d(oe),p(me)}},[C,ee,o,a,R,n]);const ce=ne.useCallback(re=>{const oe=t.current;if(!oe)return;const me=oe.getBoundingClientRect(),F=re.clientX-me.left,ae=re.clientY-me.top,ye=ue(F,ae);if(m==="start")s(ye);else if(m==="end")l(ye);else if(m==="palisadeLine")if(!E)P(ye);else{const Se=Q(E,ye,Dn,On),q=Ue(E,ye,Dn,On),$e=Tt(q),xe=Math.ceil(Se/20),He=[];for(let rt=0;rt<=xe;rt++){const At=Qi(E,nt($e,rt*20)),_t=ue(At.x,At.y);!C.some(st=>st.pos.x===_t.x&&st.pos.y===_t.y)&&!He.some(st=>st.pos.x===_t.x&&st.pos.y===_t.y)&&He.push({pos:_t,type:$.Palisade,ownerId:null})}M(rt=>[...rt,...He]),P(null)}else{const Se=C.findIndex(q=>q.pos.x===ye.x&&q.pos.y===ye.y);if(Se!==-1){const q=C[Se];m!==q.type&&(m==="tree"||Object.values($).includes(m))?M($e=>{const xe=[...$e];return xe[Se]={pos:ye,type:m,ownerId:m===$.Gate?T:null},xe}):M($e=>$e.filter((xe,He)=>He!==Se))}else M(q=>[...q,{pos:ye,type:m,ownerId:m===$.Gate?T:null}])}},[m,ue,T,C,E]),Y=()=>{if(o&&a){k&&Pi(n.entities,k.id);const re=ar(n.entities,o,n.time,"male",!1,25,0,void 0,void 0,[],R,{tribeBadge:"",tribeColor:"#4A90E2"});re.target=a,re.activeAction="moving",re.stateMachine=[Ti,{enteredAt:n.time}],n.pathfindingQueue.includes(re.id)||n.pathfindingQueue.push(re.id),B(re),Z(!0)}},J=()=>{k&&Pi(n.entities,k.id),B(null),Z(!1)},[V,D]=vp(re=>{if(K.current===0){K.current=re;return}const oe=(re-K.current)/1e3;if(K.current=re,!j||!k)return;n.entities.entities[k.id]||(n.entities.entities[k.id]=k);let me=oe*X;const F=1/60;let ae=n;for(;me>0;){const Se=wl(ae),q=Math.min(me,F),$e=q*(Bt/Gt);Se.time+=$e,uT({gameState:Se,deltaTime:q}),mT({gameState:Se,deltaTime:q}),CT(Se),qp(Se),ae=Se,me-=q}ae!==n&&Object.assign(n,ae);const ye=n.entities.entities[k.id];ye&&B({...ye})});ne.useEffect(()=>(D(),()=>V()),[D,V]);const L=ne.useCallback(re=>{const oe=t.current;if(!oe)return;const me=oe.getBoundingClientRect(),F=re.clientX-me.left,ae=re.clientY-me.top;I(ue(F,ae))},[ue]),fe=ne.useCallback(()=>{s(null),l(null),d(null),p(0),k&&Pi(n.entities,k.id),B(null),Z(!1),M([]),P(null),n.pathfindingQueue=[]},[n,k]);return ne.useEffect(()=>{const oe=requestAnimationFrame(()=>{const me=t.current,F=me==null?void 0:me.getContext("2d");if(!F)return;F.fillStyle="#2c5234",F.fillRect(0,0,Dn,On),F.strokeStyle="rgba(255,255,255,0.05)",F.lineWidth=1;for(let q=0;q<=Dn;q+=Ce)F.beginPath(),F.moveTo(q,0),F.lineTo(q,On),F.stroke();for(let q=0;q<=On;q+=Ce)F.beginPath(),F.moveTo(0,q),F.lineTo(Dn,q),F.stroke();const ae=Math.ceil(Dn/Ce),ye=Math.ceil(On/Ce);for(let q=0;q<ye;q++)for(let $e=0;$e<ae;$e++){const xe=q*ae+$e,He=!ml(n.navigationGrid,xe,R,!1),rt=n.navigationGrid.paddingCount[xe];if(He)F.fillStyle="rgba(244, 67, 54, 0.5)",F.fillRect($e*Ce,q*Ce,Ce,Ce);else if(rt>0){const At=Math.min(.6,.15+rt/OI*.45);F.fillStyle=`rgba(255, 235, 59, ${At})`,F.fillRect($e*Ce,q*Ce,Ce,Ce)}else n.navigationGrid.obstacleCount[xe]>0&&(F.fillStyle="rgba(76, 175, 80, 0.3)",F.fillRect($e*Ce,q*Ce,Ce,Ce))}F.font="16px Arial",F.textAlign="center",F.textBaseline="middle";for(const q of C){let $e="";q.type==="tree"?$e="":$e=ft[q.type].icon,$e&&F.fillText($e,q.pos.x,q.pos.y)}const Se=(k==null?void 0:k.path)||u;if(Se&&Se.length>1){F.strokeStyle=k?"rgba(0, 255, 0, 0.3)":"#00FF00",F.setLineDash(k?[5,5]:[]),F.lineWidth=2,F.beginPath(),F.moveTo(Se[0].x,Se[0].y);for(let q=1;q<Se.length;q++)F.lineTo(Se[q].x,Se[q].y);F.stroke(),F.setLineDash([]),F.fillStyle="#00FF00";for(const q of Se)F.beginPath(),F.arc(q.x,q.y,2,0,Math.PI*2),F.fill()}if(o&&(F.fillStyle="#00FF00",F.beginPath(),F.arc(o.x,o.y,8,0,Math.PI*2),F.fill(),F.fillStyle="white",F.font="10px Arial",F.fillText("START",o.x,o.y-12)),a&&(F.fillStyle="#FF0000",F.beginPath(),F.arc(a.x,a.y,8,0,Math.PI*2),F.fill(),F.fillStyle="white",F.font="10px Arial",F.fillText("END",a.x,a.y-12)),k){const{position:q,direction:$e,path:xe}=k;F.strokeStyle="rgba(255, 255, 255, 0.2)",F.lineWidth=1,F.beginPath(),F.arc(q.x,q.y,ht,0,Math.PI*2),F.stroke(),F.fillStyle="#4A90E2",F.beginPath(),F.arc(q.x,q.y,ht/3,0,Math.PI*2),F.fill(),F.strokeStyle="white",F.stroke(),F.strokeStyle="white",F.lineWidth=2,F.beginPath(),F.moveTo(q.x,q.y),F.lineTo(q.x+$e.x*20,q.y+$e.y*20),F.stroke();const He=xe&&xe.length>0?xe[0]:null;if(He){F.strokeStyle="#FFEB3B",F.setLineDash([2,2]),F.beginPath(),F.moveTo(q.x,q.y),F.lineTo(He.x,He.y),F.stroke(),F.setLineDash([]),F.fillStyle="#FFEB3B",F.beginPath(),F.arc(He.x,He.y,4,0,Math.PI*2),F.fill();const st=Ue(q,He,Dn,On),qt=Math.sqrt(st.x*st.x+st.y*st.y);if(qt>.001){const Cn=st.x/qt,Ls=-(st.y/qt),xs=Cn,Us=ht*.5;F.strokeStyle="rgba(255, 255, 255, 0.2)",F.lineWidth=1,[Us,-15,Us*.5,-7.5].forEach(Go=>{F.beginPath(),F.moveTo(q.x+Ls*Go,q.y+xs*Go),F.lineTo(He.x+Ls*Go,He.y+xs*Go),F.stroke()})}}const rt=Tt($e),At=pu(rt,-Ka),_t=pu(rt,Ka);[rt,At,_t].forEach((st,qt)=>{const Cn=Qi(q,nt(st,Yh));F.strokeStyle=qt===0?"rgba(255,255,255,0.5)":"rgba(255,255,255,0.2)",F.beginPath(),F.moveTo(q.x,q.y),F.lineTo(Cn.x,Cn.y),F.stroke()})}if(E&&y&&(F.strokeStyle="rgba(255, 255, 255, 0.5)",F.setLineDash([5,5]),F.beginPath(),F.moveTo(E.x,E.y),F.lineTo(y.x,y.y),F.stroke(),F.setLineDash([])),y){let q="";m==="tree"?q="":m==="start"?q="":m==="end"?q="":m==="palisadeLine"?q=ft[$.Palisade].icon:Object.values($).includes(m)&&(q=ft[m].icon),q&&(F.globalAlpha=.5,F.fillText(q,y.x,y.y),F.globalAlpha=1)}});return()=>cancelAnimationFrame(oe)},[n,o,a,u,y,m,k,C,R,E]),G.jsxs(eB,{children:[G.jsxs(tB,{children:[G.jsx(oB,{children:"Navigation Debug"}),G.jsx(Ga,{children:"Placement Mode"}),G.jsx(An,{active:m==="start",onClick:()=>{v("start"),P(null)},children:" Start Point"}),G.jsx(An,{active:m==="end",onClick:()=>{v("end"),P(null)},children:" End Point"}),G.jsxs(An,{active:m==="tree",onClick:()=>{v("tree"),P(null)},children:[" Tree (Radius ",Cr,")"]}),Object.entries(ft).map(([re,oe])=>G.jsxs(An,{active:m===re,onClick:()=>{v(re),P(null)},children:[oe.icon," ",oe.name," (",oe.dimensions.width,"x",oe.dimensions.height,")"]},re)),G.jsx(An,{active:m==="palisadeLine",onClick:()=>{v("palisadeLine"),P(null)},children:" Palisade Line"}),G.jsx(Ga,{children:"Gate Ownership"}),G.jsx(An,{active:T===1,onClick:()=>A(1),children:" Player (ID: 1)"}),G.jsx(An,{active:T===2,onClick:()=>A(2),children:" Enemy (ID: 2)"}),G.jsx(Ga,{children:"Human Tribe"}),G.jsx(An,{active:R===1,onClick:()=>_(1),children:" Player (ID: 1)"}),G.jsx(An,{active:R===2,onClick:()=>_(2),children:" Enemy (ID: 2)"}),G.jsx(Ga,{children:"Simulation"}),G.jsx(An,{onClick:Y,disabled:!o||!a,children:" Spawn Human"}),G.jsx(An,{onClick:()=>Z(!j),active:j,children:j?" Pause":" Play"}),G.jsx(An,{onClick:J,style:{backgroundColor:"#555"},children:" Reset Human"}),G.jsxs(zv,{children:[G.jsxs("label",{children:["Sim Speed: ",X.toFixed(1),"x"]}),G.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.1",value:X,onChange:re=>ie(parseFloat(re.target.value))})]}),G.jsxs(zv,{children:[G.jsxs("label",{children:["Obstacle Padding: ",ee,"px"]}),G.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:ee,onChange:re=>te(parseInt(re.target.value))})]}),G.jsx(Ga,{children:"Info"}),G.jsxs(Co,{children:["Grid: ",Ce,"px"]}),G.jsxs(Co,{children:["Path Nodes: ",((pe=k==null?void 0:k.path)==null?void 0:pe.length)||(u==null?void 0:u.length)||0]}),G.jsxs(Co,{children:["A* Iterations: ",f]}),G.jsxs(Co,{children:["Action: ",(k==null?void 0:k.activeAction)||"idle"]}),G.jsxs(Co,{children:["Accel: ",(k==null?void 0:k.acceleration.toFixed(2))||"0.00"]}),G.jsxs(Co,{children:["Status:"," ",(k==null?void 0:k.activeAction)==="moving"&&k.acceleration===0?" STUCK":(k==null?void 0:k.activeAction)==="idle"||(k==null?void 0:k.stateMachine[0])===ot?" REACHED":k?" Moving":" Idle"]}),G.jsx(Co,{style:{fontSize:"0.75rem",color:"#666",marginTop:"10px"},children:"Note: Click any tool on an existing object to replace or remove it. Use Palisade Line for multi-segment walls."}),G.jsx(An,{onClick:fe,style:{backgroundColor:"#a33",marginTop:"20px"},children:" Clear All"}),G.jsx(rB,{onClick:e,children:"Back to Intro"})]}),G.jsxs(nB,{children:[G.jsx(iB,{ref:t,width:Dn,height:On,onClick:ce,onMouseMove:L,onMouseLeave:()=>I(null),style:{cursor:"crosshair"}}),G.jsx(Co,{style:{marginTop:"10px",textAlign:"center"},children:"Place Trees and Buildings to test pathfinding. Only Palisades and Gates physically block movement. Adjust padding to see how it affects real game navigation logic."})]})]})},fu=(e,t,n,o)=>{const s=e.reduce((d,f)=>(d[f.id]=f,d),{}),a={id:1,type:"human",leaderId:1,isPlayer:!0,tribeInfo:{tribeBadge:"",tribeColor:"#4CAF50"},position:{x:n/2,y:o/2},radius:10,isAdult:!0,gender:"male",age:25,stateMachine:["",{enteredAt:0}],aiBlackboard:Ne.create(),debuffs:[],forces:[],velocity:{x:0,y:0},acceleration:0,direction:{x:0,y:0},food:[],maxFood:10,ancestorIds:[],hitpoints:100,maxHitpoints:100,maxAge:100,hunger:0,aiType:to.TaskBased};s[1]=a;const l={time:0,mapDimensions:{width:n,height:o},entities:{entities:s},terrainOwnership:t,notifications:[],visualEffects:[],tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[]},plantingZoneConnections:{},navigationGrid:{obstacleCount:new Uint16Array(0),paddingCount:new Uint16Array(0),gateRefCount:{},gatePaddingRefCount:{}},tasks:{},soilDepletion:{}},u=l;return u.search={building:{all:()=>e,byRadius:(d,f)=>e.filter(p=>Q(d,p.position,n,o)<=f),byRect:()=>e,byProperty:(d,f)=>e.filter(p=>p[d]===f),at:(d,f)=>e.find(p=>Q(d,p.position,n,o)<=f)},human:{all:()=>[a],byProperty:()=>[],byRadius:()=>[],byRect:()=>[a]},berryBush:{byRect:()=>[],all:()=>[],byRadius:()=>[]},tree:{byRect:()=>[],all:()=>[],byRadius:()=>[]},corpse:{byRect:()=>[],all:()=>[]},prey:{byRect:()=>[],all:()=>[]},predator:{byRect:()=>[],all:()=>[]},tasks:{byRect:()=>[],all:()=>[]}},u.cache={distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:{}},l},bh=(e,t,n,o)=>{const s=ft[t];return{id:e,type:"building",buildingType:t,position:n,ownerId:o,constructionProgress:1,destructionProgress:0,isConstructed:!0,isBeingDestroyed:!1,width:s.dimensions.width,height:s.dimensions.height,storedItems:[],storageCapacity:10,radius:Math.max(s.dimensions.width,s.dimensions.height)/2,direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Ne.create()}};function lB(e,t,n){var m,v;const o=e.filter(y=>y.type===$.Gate).length,s=e.filter(y=>y.type===$.Palisade).length,a=e.length*ge,l=t*ge*ge,u=(m=ft[$.Palisade].cost)==null?void 0:m.wood,d=(v=ft[$.Gate].cost)==null?void 0:v.wood,f=s*u+o*d;let p="Fair";return t>=As*2?p="Excellent":t>=As&&(p="Good"),{perimeterLength:a,palisadeCount:s,gateCount:o,totalCells:t,enclosedArea:l,woodCost:f,protectedPercentage:n*100,qualityRating:p}}const cB=(e,t)=>{const[n,o]=ne.useState($.Bonfire),[s,a]=ne.useState([]),[l,u]=ne.useState(null),[d,f]=ne.useState(10),[p,m]=ne.useState(!0),[v,y]=ne.useState(!0),[I,T]=ne.useState(!0),[A,R]=ne.useState([]),[_,C]=ne.useState([]),[M,E]=ne.useState(0),[P,k]=ne.useState(0),[B,j]=ne.useState(new Array(Math.ceil(e/ge)*Math.ceil(t/ge)).fill(null)),Z=ne.useMemo(()=>_.length===0?null:lB(_,M,P),[_,M,P]),X=ne.useCallback((Y,J)=>{const V=Ce;return{x:Math.round(Y/V)*V,y:Math.round(J/V)*V}},[]),ie=ne.useCallback((Y,J)=>{const V=X(Y,J),D=fu(s,B,e,t);if(!Ar(V,n,1,D))return;const L=bh(d,n,V,1),fe=[...B],pe={mapDimensions:{width:e,height:t},terrainOwnership:fe},re=lr(n);ps(V,re,1,pe),j(fe),a(oe=>[...oe,L]),f(oe=>oe+1)},[n,d,X,s,B,e,t]),ee=ne.useCallback((Y,J)=>{u(X(Y,J))},[X]),te=ne.useCallback(()=>{a([]),R([]),C([]),E(0),k(0),f(10),j(new Array(B.length).fill(null))},[B.length]),K=ne.useCallback(()=>{const Y=fu(s,B,e,t),J=id(1,Y);if(J.size<As){R([]),C([]),E(0),k(0);return}const V=Math.ceil(e/ge),D=Math.ceil(t/ge),L=AT(1,Y);C(L);const pe=TT(J,V,D).filter(F=>F.length>=3),re=[];for(const F of pe)for(let ae=0;ae<F.length-1;ae++){const ye=F[ae],Se=F[ae+1],q=Tr(ye,e),$e=Tr(Se,e),xe=L.some(He=>He.type===$.Gate&&Pt(He.position,q,e,t)<ge*ge);re.push({from:q,to:$e,isGate:xe,isProtected:!1})}R(re);const oe=s.filter(F=>F.buildingType===$.Palisade||F.buildingType===$.Gate),me=wT(1,Y,oe);k(me),E(J.size)},[s,B,e,t]);ne.useEffect(()=>{K()},[K]);const ue=ne.useCallback(()=>{if(_.length===0)return;const Y=[];let J=d;const V=[...B],D={mapDimensions:{width:e,height:t},terrainOwnership:V},L=[...s.filter(fe=>fe.buildingType===$.Palisade||fe.buildingType===$.Gate)];for(const fe of _){const pe=fe.position;if(s.some(F=>Pt(pe,F.position,e,t)<20*20)||L.some(F=>Pt(pe,F.position,e,t)<hl*hl))continue;const me=bh(J++,fe.type,pe,1);Y.push(me),L.push(me),ps(pe,lr(fe.type),1,D)}j(V),a(fe=>[...fe,...Y]),f(J)},[_,d,B,e,t,s]),ce=ne.useCallback(()=>{const Y=fu(s,B,e,t),J={x:e/2,y:t/2},V=cu(n,1,Y,200,100,J);if(V){const D=bh(d,n,V,1),L=[...B],fe={mapDimensions:{width:e,height:t},terrainOwnership:L};ps(V,lr(n),1,fe),j(L),a(pe=>[...pe,D]),f(pe=>pe+1)}},[s,B,n,d,e,t]);return{selectedType:n,setSelectedType:o,placedBuildings:s,mousePos:l,setMousePos:u,nextBuildingId:d,showTerritoryGrid:p,setShowTerritoryGrid:m,showGordGrid:v,setShowGordGrid:y,showPlannedGord:I,setShowPlannedGord:T,plannedGordEdges:A,totalGordCells:M,terrainOwnership:B,gordStats:Z,handleCanvasClick:ie,handleMouseMove:ee,clearBuildings:te,planGord:K,executeGordPlan:ue,autoPlaceSingleBuilding:ce}},uB=Be.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
  cursor: crosshair;
`,dB=({canvasWidth:e,canvasHeight:t,placedBuildings:n,terrainOwnership:o,showTerritoryGrid:s,showGordGrid:a,showPlannedGord:l,plannedGordEdges:u,mousePos:d,selectedType:f,onClick:p,onMouseMove:m,onMouseLeave:v})=>{const y=ne.useRef(null),I=ne.useRef();ne.useEffect(()=>{const R=()=>{const _=y.current,C=_==null?void 0:_.getContext("2d");if(!C)return;const M={x:e/2,y:t/2},E=fu(n,o,e,t);if(C.fillStyle="#2c5234",C.fillRect(0,0,e,t),s&&ng(C,E,M,{width:e,height:t},1),a){C.strokeStyle="rgba(255,255,255,0.08)",C.lineWidth=1;for(let B=0;B<=e;B+=ge)C.beginPath(),C.moveTo(B,0),C.lineTo(B,t),C.stroke();for(let B=0;B<=t;B+=ge)C.beginPath(),C.moveTo(0,B),C.lineTo(e,B),C.stroke();const P=Math.ceil(e/ge),k=Math.ceil(t/ge);for(let B=0;B<k;B++)for(let j=0;j<P;j++){const Z=B*P+j;E.terrainOwnership[Z]===1&&(C.fillStyle="rgba(0, 255, 0, 0.1)",C.fillRect(j*ge,B*ge,ge,ge))}}for(const P of n)eg(C,P,E);if(l&&u.length>0){C.save();for(const P of u)C.strokeStyle=P.isGate?"#4080FF":"#8B4513",C.lineWidth=4,C.beginPath(),C.moveTo(P.from.x,P.from.y),C.lineTo(P.to.x,P.to.y),C.stroke(),P.isGate&&(C.fillStyle="rgba(100, 150, 255, 0.3)",C.fillRect(P.from.x<P.to.x?P.from.x:P.to.x,P.from.y<P.to.y?P.from.y:P.to.y,Math.abs(P.to.x-P.from.x)||10,Math.abs(P.to.y-P.from.y)||10));C.restore()}if(d){const P=Ar(d,f,1,E);tg(C,d,f,P,{width:e,height:t}),C.save(),C.font="12px Arial",C.fillStyle=P?"#00FF00":"#FF0000",C.fillText(P?" Valid placement":" Invalid placement",d.x+15,d.y-15),C.restore()}I.current=requestAnimationFrame(R)};return I.current=requestAnimationFrame(R),()=>{I.current&&cancelAnimationFrame(I.current)}},[e,t,n,o,s,a,l,u,d,f]);const T=R=>{const _=y.current;if(!_)return;const C=_.getBoundingClientRect(),M=R.clientX-C.left,E=R.clientY-C.top;p(M,E)},A=R=>{const _=y.current;if(!_)return;const C=_.getBoundingClientRect(),M=R.clientX-C.left,E=R.clientY-C.top;m(M,E)};return G.jsx(uB,{ref:y,width:e,height:t,onClick:T,onMouseMove:A,onMouseLeave:v})},fB=Be.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,hB=Be.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
  color: white;
`,ns=Be.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,Ii=Be.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }

  &:disabled {
    background-color: #333;
    color: #666;
    cursor: not-allowed;
  }
`,pB=Be(Ii)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,Dh=Be.label`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  cursor: pointer;
  color: #ddd;

  input {
    margin-right: 8px;
  }
`,Si=Be.p`
  font-size: 0.85rem;
  color: #888;
  margin: 5px 0;
`,gB=Be.span`
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-weight: bold;
  font-size: 0.75rem;
  background-color: ${e=>{switch(e.$rating){case"Excellent":return"#2a5";case"Good":return"#28a";case"Fair":return"#a82";case"Poor":return"#a33"}}};
  color: white;
`,mB=({selectedType:e,plannedGordEdges:t,gordStats:n,showPlannedGord:o,showTerritoryGrid:s,showGordGrid:a,onSelectType:l,onPlanGord:u,onExecutePlan:d,onAutoPlace:f,onClear:p,onToggleShowPlannedGord:m,onToggleShowTerritoryGrid:v,onToggleShowGordGrid:y,onBack:I})=>{const T=t.filter(A=>!A.isProtected).length;return G.jsxs(fB,{children:[G.jsx(hB,{children:"Gord Builder Test"}),G.jsx(ns,{children:"1. Place Hub Buildings"}),G.jsxs(Ii,{onClick:()=>l($.Bonfire),style:{backgroundColor:e===$.Bonfire?"#666":"#444",borderLeft:e===$.Bonfire?"3px solid #FF6600":"none"},children:[ft[$.Bonfire].icon," Bonfire (Hub)"]}),G.jsxs(Ii,{onClick:()=>l($.StorageSpot),style:{backgroundColor:e===$.StorageSpot?"#666":"#444",borderLeft:e===$.StorageSpot?"3px solid #FF6600":"none"},children:[ft[$.StorageSpot].icon," Storage (Hub)"]}),G.jsxs(Ii,{onClick:()=>l($.BorderPost),style:{backgroundColor:e===$.BorderPost?"#666":"#444",borderLeft:e===$.BorderPost?"3px solid #FF6600":"none"},children:[ft[$.BorderPost].icon," Border Post"]}),G.jsx(ns,{children:"2. Manual Placement"}),G.jsxs(Ii,{onClick:()=>l($.Palisade),style:{backgroundColor:e===$.Palisade?"#666":"#444",borderLeft:e===$.Palisade?"3px solid #4CAF50":"none"},children:[ft[$.Palisade].icon," Palisade"]}),G.jsxs(Ii,{onClick:()=>l($.Gate),style:{backgroundColor:e===$.Gate?"#666":"#444",borderLeft:e===$.Gate?"3px solid #4CAF50":"none"},children:[ft[$.Gate].icon," Gate"]}),G.jsx(ns,{children:"3. AI Gord Planning"}),G.jsxs(Si,{children:["Grid Resolution: ",ge,"px"]}),G.jsxs(Si,{children:["Min Cluster Size: ",As," cells"]}),G.jsxs(Si,{children:["Min Gate Dist: ",zS,"px"]}),G.jsx(Ii,{onClick:u,style:{backgroundColor:"#2a5",textAlign:"center"},children:" Plan Gord Walls"}),G.jsxs(Ii,{onClick:d,style:{backgroundColor:T>0?"#25a":"#555",textAlign:"center"},disabled:T===0,children:[" Execute Plan (",T," unprotected edges)"]}),G.jsx(ns,{children:"Gord Statistics"}),n?G.jsxs(G.Fragment,{children:[G.jsxs(Si,{children:[" Quality: ",G.jsx(gB,{$rating:n.qualityRating,children:n.qualityRating})]}),G.jsxs(Si,{children:[" Protection: ",n.protectedPercentage.toFixed(1),"%"]}),G.jsxs(Si,{children:[" Palis: ",n.palisadeCount," |  Gates: ",n.gateCount]}),G.jsxs(Si,{children:[" Territory: ",n.totalCells," cells"]}),G.jsxs(Si,{children:[" Perimeter: ",n.perimeterLength,"px |  Area: ~",n.enclosedArea,"px"]}),G.jsxs(Si,{children:[" Cost: ",n.woodCost]})]}):G.jsx(Si,{children:"No gord planned. Expand territory first."}),G.jsx(ns,{children:"Visualization"}),G.jsxs(Dh,{children:[G.jsx("input",{type:"checkbox",checked:o,onChange:A=>m(A.target.checked)})," ","Show Planned Gord"]}),G.jsxs(Dh,{children:[G.jsx("input",{type:"checkbox",checked:s,onChange:A=>v(A.target.checked)})," ","Show Territory"]}),G.jsxs(Dh,{children:[G.jsx("input",{type:"checkbox",checked:a,onChange:A=>y(A.target.checked)})," Show Gord Grid"]}),G.jsx(ns,{children:"Actions"}),G.jsx(Ii,{onClick:f,style:{backgroundColor:"#357",textAlign:"center"},children:" Auto-Place Single"}),G.jsx(Ii,{onClick:p,style:{backgroundColor:"#a33",textAlign:"center"},children:" Clear All"}),G.jsx(pB,{onClick:I,children:"Back to Intro"})]})},yB=Be.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,vB=Be.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,SB=Be.p`
  margin-top: 20px;
  color: #888;
  max-width: 600px;
  text-align: center;
  font-size: 0.9rem;
  line-height: 1.4;
`,Xv=1e3,Vv=1e3,IB=()=>{const{returnToIntro:e}=_i(),t=cB(Xv,Vv);return G.jsxs(yB,{children:[G.jsx(mB,{selectedType:t.selectedType,plannedGordEdges:t.plannedGordEdges,gordStats:t.gordStats,showPlannedGord:t.showPlannedGord,showTerritoryGrid:t.showTerritoryGrid,showGordGrid:t.showGordGrid,onSelectType:t.setSelectedType,onPlanGord:t.planGord,onExecutePlan:t.executeGordPlan,onAutoPlace:t.autoPlaceSingleBuilding,onClear:t.clearBuildings,onToggleShowPlannedGord:t.setShowPlannedGord,onToggleShowTerritoryGrid:t.setShowTerritoryGrid,onToggleShowGordGrid:t.setShowGordGrid,onBack:e}),G.jsxs(vB,{children:[G.jsx(dB,{canvasWidth:Xv,canvasHeight:Vv,placedBuildings:t.placedBuildings,terrainOwnership:t.terrainOwnership,showTerritoryGrid:t.showTerritoryGrid,showGordGrid:t.showGordGrid,showPlannedGord:t.showPlannedGord,plannedGordEdges:t.plannedGordEdges,mousePos:t.mousePos,selectedType:t.selectedType,onClick:t.handleCanvasClick,onMouseMove:t.handleMouseMove,onMouseLeave:()=>t.setMousePos(null)}),G.jsxs(SB,{children:[G.jsx("strong",{children:"Territory Perimeter Planning:"})," Walls are planned around the entire tribe territory border using 100px grid cells.",G.jsx("br",{}),"Existing walls are reused to save resources. Enclosure triggers when unprotected border exceeds a threshold. Minimum territory size: ",As," cells."]})]})]})},TB=gE`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function AB(e,t){ne.useEffect(()=>{const n=()=>{const o=document.location.hash;t(o==="#game"?"game":o==="#effects"?"effects":o==="#buildings"?"buildings":o==="#navigation"?"navigation":o==="#palisadePlacement"?"palisadePlacement":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),ne.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const wB=()=>{const{appState:e,setAppState:t}=_i();AB(e,t);const n=()=>{switch(e){case"intro":return G.jsx($v,{});case"game":return G.jsx(Yv,{});case"effects":return G.jsx(WN,{});case"buildings":return G.jsx(JN,{});case"navigation":return G.jsx(aB,{});case"palisadePlacement":return G.jsx(IB,{});case"gameOver":return G.jsxs(G.Fragment,{children:[G.jsx(Yv,{}),G.jsx(HN,{})]});default:return G.jsx($v,{})}};return G.jsxs(G.Fragment,{children:[G.jsx(TB,{}),n()]})},qv=document.getElementById("root");qv?M_().then(()=>{V1.createRoot(qv).render(G.jsx(wi.StrictMode,{children:G.jsx(pw,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":document.location.hash==="#navigation"?"navigation":document.location.hash==="#palisadePlacement"?"palisadePlacement":document.location.hash==="#buildings"?"buildings":"intro",children:G.jsx(wB,{})})}))}):console.error("Failed to find the root element");
