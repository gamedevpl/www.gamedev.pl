var $C=Object.defineProperty;var WC=(e,t,n)=>t in e?$C(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Ne=(e,t,n)=>WC(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function zv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Hh={exports:{}},nl={},Uh={exports:{}},ze={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xy;function xC(){if(xy)return ze;xy=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.iterator;function v(B){return B===null||typeof B!="object"?null:(B=m&&B[m]||B["@@iterator"],typeof B=="function"?B:null)}var S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,A={};function w(B,j,ce){this.props=B,this.context=j,this.refs=A,this.updater=ce||S}w.prototype.isReactComponent={},w.prototype.setState=function(B,j){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,j,"setState")},w.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function P(){}P.prototype=w.prototype;function R(B,j,ce){this.props=B,this.context=j,this.refs=A,this.updater=ce||S}var _=R.prototype=new P;_.constructor=R,I(_,w.prototype),_.isPureReactComponent=!0;var b=Array.isArray,M=Object.prototype.hasOwnProperty,D={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function k(B,j,ce){var pe,Me={},he=null,Ee=null;if(j!=null)for(pe in j.ref!==void 0&&(Ee=j.ref),j.key!==void 0&&(he=""+j.key),j)M.call(j,pe)&&!N.hasOwnProperty(pe)&&(Me[pe]=j[pe]);var Re=arguments.length-2;if(Re===1)Me.children=ce;else if(1<Re){for(var de=Array(Re),ve=0;ve<Re;ve++)de[ve]=arguments[ve+2];Me.children=de}if(B&&B.defaultProps)for(pe in Re=B.defaultProps,Re)Me[pe]===void 0&&(Me[pe]=Re[pe]);return{$$typeof:e,type:B,key:he,ref:Ee,props:Me,_owner:D.current}}function L(B,j){return{$$typeof:e,type:B.type,key:j,ref:B.ref,props:B.props,_owner:B._owner}}function z(B){return typeof B=="object"&&B!==null&&B.$$typeof===e}function V(B){var j={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(ce){return j[ce]})}var X=/\/+/g;function Q(B,j){return typeof B=="object"&&B!==null&&B.key!=null?V(""+B.key):j.toString(36)}function q(B,j,ce,pe,Me){var he=typeof B;(he==="undefined"||he==="boolean")&&(B=null);var Ee=!1;if(B===null)Ee=!0;else switch(he){case"string":case"number":Ee=!0;break;case"object":switch(B.$$typeof){case e:case t:Ee=!0}}if(Ee)return Ee=B,Me=Me(Ee),B=pe===""?"."+Q(Ee,0):pe,b(Me)?(ce="",B!=null&&(ce=B.replace(X,"$&/")+"/"),q(Me,j,ce,"",function(ve){return ve})):Me!=null&&(z(Me)&&(Me=L(Me,ce+(!Me.key||Ee&&Ee.key===Me.key?"":(""+Me.key).replace(X,"$&/")+"/")+B)),j.push(Me)),1;if(Ee=0,pe=pe===""?".":pe+":",b(B))for(var Re=0;Re<B.length;Re++){he=B[Re];var de=pe+Q(he,Re);Ee+=q(he,j,ce,de,Me)}else if(de=v(B),typeof de=="function")for(B=de.call(B),Re=0;!(he=B.next()).done;)he=he.value,de=pe+Q(he,Re++),Ee+=q(he,j,ce,de,Me);else if(he==="object")throw j=String(B),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.");return Ee}function ie(B,j,ce){if(B==null)return B;var pe=[],Me=0;return q(B,pe,"","",function(he){return j.call(ce,he,Me++)}),pe}function oe(B){if(B._status===-1){var j=B._result;j=j(),j.then(function(ce){(B._status===0||B._status===-1)&&(B._status=1,B._result=ce)},function(ce){(B._status===0||B._status===-1)&&(B._status=2,B._result=ce)}),B._status===-1&&(B._status=0,B._result=j)}if(B._status===1)return B._result.default;throw B._result}var ee={current:null},x={transition:null},K={ReactCurrentDispatcher:ee,ReactCurrentBatchConfig:x,ReactCurrentOwner:D};function Z(){throw Error("act(...) is not supported in production builds of React.")}return ze.Children={map:ie,forEach:function(B,j,ce){ie(B,function(){j.apply(this,arguments)},ce)},count:function(B){var j=0;return ie(B,function(){j++}),j},toArray:function(B){return ie(B,function(j){return j})||[]},only:function(B){if(!z(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},ze.Component=w,ze.Fragment=n,ze.Profiler=s,ze.PureComponent=R,ze.StrictMode=i,ze.Suspense=u,ze.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=K,ze.act=Z,ze.cloneElement=function(B,j,ce){if(B==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+B+".");var pe=I({},B.props),Me=B.key,he=B.ref,Ee=B._owner;if(j!=null){if(j.ref!==void 0&&(he=j.ref,Ee=D.current),j.key!==void 0&&(Me=""+j.key),B.type&&B.type.defaultProps)var Re=B.type.defaultProps;for(de in j)M.call(j,de)&&!N.hasOwnProperty(de)&&(pe[de]=j[de]===void 0&&Re!==void 0?Re[de]:j[de])}var de=arguments.length-2;if(de===1)pe.children=ce;else if(1<de){Re=Array(de);for(var ve=0;ve<de;ve++)Re[ve]=arguments[ve+2];pe.children=Re}return{$$typeof:e,type:B.type,key:Me,ref:he,props:pe,_owner:Ee}},ze.createContext=function(B){return B={$$typeof:l,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},B.Provider={$$typeof:a,_context:B},B.Consumer=B},ze.createElement=k,ze.createFactory=function(B){var j=k.bind(null,B);return j.type=B,j},ze.createRef=function(){return{current:null}},ze.forwardRef=function(B){return{$$typeof:c,render:B}},ze.isValidElement=z,ze.lazy=function(B){return{$$typeof:g,_payload:{_status:-1,_result:B},_init:oe}},ze.memo=function(B,j){return{$$typeof:f,type:B,compare:j===void 0?null:j}},ze.startTransition=function(B){var j=x.transition;x.transition={};try{B()}finally{x.transition=j}},ze.unstable_act=Z,ze.useCallback=function(B,j){return ee.current.useCallback(B,j)},ze.useContext=function(B){return ee.current.useContext(B)},ze.useDebugValue=function(){},ze.useDeferredValue=function(B){return ee.current.useDeferredValue(B)},ze.useEffect=function(B,j){return ee.current.useEffect(B,j)},ze.useId=function(){return ee.current.useId()},ze.useImperativeHandle=function(B,j,ce){return ee.current.useImperativeHandle(B,j,ce)},ze.useInsertionEffect=function(B,j){return ee.current.useInsertionEffect(B,j)},ze.useLayoutEffect=function(B,j){return ee.current.useLayoutEffect(B,j)},ze.useMemo=function(B,j){return ee.current.useMemo(B,j)},ze.useReducer=function(B,j,ce){return ee.current.useReducer(B,j,ce)},ze.useRef=function(B){return ee.current.useRef(B)},ze.useState=function(B){return ee.current.useState(B)},ze.useSyncExternalStore=function(B,j,ce){return ee.current.useSyncExternalStore(B,j,ce)},ze.useTransition=function(){return ee.current.useTransition()},ze.version="18.3.1",ze}var Yy;function ip(){return Yy||(Yy=1,Uh.exports=xC()),Uh.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var zy;function YC(){if(zy)return nl;zy=1;var e=ip(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(c,u,f){var g,m={},v=null,S=null;f!==void 0&&(v=""+f),u.key!==void 0&&(v=""+u.key),u.ref!==void 0&&(S=u.ref);for(g in u)i.call(u,g)&&!a.hasOwnProperty(g)&&(m[g]=u[g]);if(c&&c.defaultProps)for(g in u=c.defaultProps,u)m[g]===void 0&&(m[g]=u[g]);return{$$typeof:t,type:c,key:v,ref:S,props:m,_owner:s.current}}return nl.Fragment=n,nl.jsx=l,nl.jsxs=l,nl}var jy;function zC(){return jy||(jy=1,Hh.exports=YC()),Hh.exports}var He=zC(),Be=ip();const Bi=zv(Be);var yd={},Gh={exports:{}},Dn={},$h={exports:{}},Wh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Xy;function jC(){return Xy||(Xy=1,function(e){function t(x,K){var Z=x.length;x.push(K);e:for(;0<Z;){var B=Z-1>>>1,j=x[B];if(0<s(j,K))x[B]=K,x[Z]=j,Z=B;else break e}}function n(x){return x.length===0?null:x[0]}function i(x){if(x.length===0)return null;var K=x[0],Z=x.pop();if(Z!==K){x[0]=Z;e:for(var B=0,j=x.length,ce=j>>>1;B<ce;){var pe=2*(B+1)-1,Me=x[pe],he=pe+1,Ee=x[he];if(0>s(Me,Z))he<j&&0>s(Ee,Me)?(x[B]=Ee,x[he]=Z,B=he):(x[B]=Me,x[pe]=Z,B=pe);else if(he<j&&0>s(Ee,Z))x[B]=Ee,x[he]=Z,B=he;else break e}}return K}function s(x,K){var Z=x.sortIndex-K.sortIndex;return Z!==0?Z:x.id-K.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var u=[],f=[],g=1,m=null,v=3,S=!1,I=!1,A=!1,w=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(x){for(var K=n(f);K!==null;){if(K.callback===null)i(f);else if(K.startTime<=x)i(f),K.sortIndex=K.expirationTime,t(u,K);else break;K=n(f)}}function b(x){if(A=!1,_(x),!I)if(n(u)!==null)I=!0,oe(M);else{var K=n(f);K!==null&&ee(b,K.startTime-x)}}function M(x,K){I=!1,A&&(A=!1,P(k),k=-1),S=!0;var Z=v;try{for(_(K),m=n(u);m!==null&&(!(m.expirationTime>K)||x&&!V());){var B=m.callback;if(typeof B=="function"){m.callback=null,v=m.priorityLevel;var j=B(m.expirationTime<=K);K=e.unstable_now(),typeof j=="function"?m.callback=j:m===n(u)&&i(u),_(K)}else i(u);m=n(u)}if(m!==null)var ce=!0;else{var pe=n(f);pe!==null&&ee(b,pe.startTime-K),ce=!1}return ce}finally{m=null,v=Z,S=!1}}var D=!1,N=null,k=-1,L=5,z=-1;function V(){return!(e.unstable_now()-z<L)}function X(){if(N!==null){var x=e.unstable_now();z=x;var K=!0;try{K=N(!0,x)}finally{K?Q():(D=!1,N=null)}}else D=!1}var Q;if(typeof R=="function")Q=function(){R(X)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,ie=q.port2;q.port1.onmessage=X,Q=function(){ie.postMessage(null)}}else Q=function(){w(X,0)};function oe(x){N=x,D||(D=!0,Q())}function ee(x,K){k=w(function(){x(e.unstable_now())},K)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(x){x.callback=null},e.unstable_continueExecution=function(){I||S||(I=!0,oe(M))},e.unstable_forceFrameRate=function(x){0>x||125<x?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):L=0<x?Math.floor(1e3/x):5},e.unstable_getCurrentPriorityLevel=function(){return v},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(x){switch(v){case 1:case 2:case 3:var K=3;break;default:K=v}var Z=v;v=K;try{return x()}finally{v=Z}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(x,K){switch(x){case 1:case 2:case 3:case 4:case 5:break;default:x=3}var Z=v;v=x;try{return K()}finally{v=Z}},e.unstable_scheduleCallback=function(x,K,Z){var B=e.unstable_now();switch(typeof Z=="object"&&Z!==null?(Z=Z.delay,Z=typeof Z=="number"&&0<Z?B+Z:B):Z=B,x){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=Z+j,x={id:g++,callback:K,priorityLevel:x,startTime:Z,expirationTime:j,sortIndex:-1},Z>B?(x.sortIndex=Z,t(f,x),n(u)===null&&x===n(f)&&(A?(P(k),k=-1):A=!0,ee(b,Z-B))):(x.sortIndex=j,t(u,x),I||S||(I=!0,oe(M))),x},e.unstable_shouldYield=V,e.unstable_wrapCallback=function(x){var K=v;return function(){var Z=v;v=K;try{return x.apply(this,arguments)}finally{v=Z}}}}(Wh)),Wh}var Vy;function XC(){return Vy||(Vy=1,$h.exports=jC()),$h.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ky;function VC(){if(Ky)return Dn;Ky=1;var e=ip(),t=XC();function n(o){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+o,d=1;d<arguments.length;d++)r+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+o+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function a(o,r){l(o,r),l(o+"Capture",r)}function l(o,r){for(s[o]=r,o=0;o<r.length;o++)i.add(r[o])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},m={};function v(o){return u.call(m,o)?!0:u.call(g,o)?!1:f.test(o)?m[o]=!0:(g[o]=!0,!1)}function S(o,r,d,h){if(d!==null&&d.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return h?!1:d!==null?!d.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function I(o,r,d,h){if(r===null||typeof r>"u"||S(o,r,d,h))return!0;if(h)return!1;if(d!==null)switch(d.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function A(o,r,d,h,p,y,C){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=h,this.attributeNamespace=p,this.mustUseProperty=d,this.propertyName=o,this.type=r,this.sanitizeURL=y,this.removeEmptyString=C}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){w[o]=new A(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var r=o[0];w[r]=new A(r,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){w[o]=new A(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){w[o]=new A(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){w[o]=new A(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){w[o]=new A(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){w[o]=new A(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){w[o]=new A(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){w[o]=new A(o,5,!1,o.toLowerCase(),null,!1,!1)});var P=/[\-:]([a-z])/g;function R(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var r=o.replace(P,R);w[r]=new A(r,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var r=o.replace(P,R);w[r]=new A(r,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var r=o.replace(P,R);w[r]=new A(r,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){w[o]=new A(o,1,!1,o.toLowerCase(),null,!1,!1)}),w.xlinkHref=new A("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){w[o]=new A(o,1,!1,o.toLowerCase(),null,!0,!0)});function _(o,r,d,h){var p=w.hasOwnProperty(r)?w[r]:null;(p!==null?p.type!==0:h||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(I(r,d,p,h)&&(d=null),h||p===null?v(r)&&(d===null?o.removeAttribute(r):o.setAttribute(r,""+d)):p.mustUseProperty?o[p.propertyName]=d===null?p.type===3?!1:"":d:(r=p.attributeName,h=p.attributeNamespace,d===null?o.removeAttribute(r):(p=p.type,d=p===3||p===4&&d===!0?"":""+d,h?o.setAttributeNS(h,r,d):o.setAttribute(r,d))))}var b=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),D=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),V=Symbol.for("react.context"),X=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),ie=Symbol.for("react.memo"),oe=Symbol.for("react.lazy"),ee=Symbol.for("react.offscreen"),x=Symbol.iterator;function K(o){return o===null||typeof o!="object"?null:(o=x&&o[x]||o["@@iterator"],typeof o=="function"?o:null)}var Z=Object.assign,B;function j(o){if(B===void 0)try{throw Error()}catch(d){var r=d.stack.trim().match(/\n( *(at )?)/);B=r&&r[1]||""}return`
`+B+o}var ce=!1;function pe(o,r){if(!o||ce)return"";ce=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(Y){var h=Y}Reflect.construct(o,[],r)}else{try{r.call()}catch(Y){h=Y}o.call(r.prototype)}else{try{throw Error()}catch(Y){h=Y}o()}}catch(Y){if(Y&&h&&typeof Y.stack=="string"){for(var p=Y.stack.split(`
`),y=h.stack.split(`
`),C=p.length-1,O=y.length-1;1<=C&&0<=O&&p[C]!==y[O];)O--;for(;1<=C&&0<=O;C--,O--)if(p[C]!==y[O]){if(C!==1||O!==1)do if(C--,O--,0>O||p[C]!==y[O]){var F=`
`+p[C].replace(" at new "," at ");return o.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",o.displayName)),F}while(1<=C&&0<=O);break}}}finally{ce=!1,Error.prepareStackTrace=d}return(o=o?o.displayName||o.name:"")?j(o):""}function Me(o){switch(o.tag){case 5:return j(o.type);case 16:return j("Lazy");case 13:return j("Suspense");case 19:return j("SuspenseList");case 0:case 2:case 15:return o=pe(o.type,!1),o;case 11:return o=pe(o.type.render,!1),o;case 1:return o=pe(o.type,!0),o;default:return""}}function he(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case N:return"Fragment";case D:return"Portal";case L:return"Profiler";case k:return"StrictMode";case Q:return"Suspense";case q:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case V:return(o.displayName||"Context")+".Consumer";case z:return(o._context.displayName||"Context")+".Provider";case X:var r=o.render;return o=o.displayName,o||(o=r.displayName||r.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case ie:return r=o.displayName||null,r!==null?r:he(o.type)||"Memo";case oe:r=o._payload,o=o._init;try{return he(o(r))}catch{}}return null}function Ee(o){var r=o.type;switch(o.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=r.render,o=o.displayName||o.name||"",r.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return he(r);case 8:return r===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Re(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function de(o){var r=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function ve(o){var r=de(o)?"checked":"value",d=Object.getOwnPropertyDescriptor(o.constructor.prototype,r),h=""+o[r];if(!o.hasOwnProperty(r)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var p=d.get,y=d.set;return Object.defineProperty(o,r,{configurable:!0,get:function(){return p.call(this)},set:function(C){h=""+C,y.call(this,C)}}),Object.defineProperty(o,r,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(C){h=""+C},stopTracking:function(){o._valueTracker=null,delete o[r]}}}}function Ge(o){o._valueTracker||(o._valueTracker=ve(o))}function Ae(o){if(!o)return!1;var r=o._valueTracker;if(!r)return!0;var d=r.getValue(),h="";return o&&(h=de(o)?o.checked?"true":"false":o.value),o=h,o!==d?(r.setValue(o),!0):!1}function kn(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function Je(o,r){var d=r.checked;return Z({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??o._wrapperState.initialChecked})}function st(o,r){var d=r.defaultValue==null?"":r.defaultValue,h=r.checked!=null?r.checked:r.defaultChecked;d=Re(r.value!=null?r.value:d),o._wrapperState={initialChecked:h,initialValue:d,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function Zn(o,r){r=r.checked,r!=null&&_(o,"checked",r,!1)}function En(o,r){Zn(o,r);var d=Re(r.value),h=r.type;if(d!=null)h==="number"?(d===0&&o.value===""||o.value!=d)&&(o.value=""+d):o.value!==""+d&&(o.value=""+d);else if(h==="submit"||h==="reset"){o.removeAttribute("value");return}r.hasOwnProperty("value")?Ai(o,r.type,d):r.hasOwnProperty("defaultValue")&&Ai(o,r.type,Re(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(o.defaultChecked=!!r.defaultChecked)}function Qn(o,r,d){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var h=r.type;if(!(h!=="submit"&&h!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+o._wrapperState.initialValue,d||r===o.value||(o.value=r),o.defaultValue=r}d=o.name,d!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,d!==""&&(o.name=d)}function Ai(o,r,d){(r!=="number"||kn(o.ownerDocument)!==o)&&(d==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+d&&(o.defaultValue=""+d))}var Ti=Array.isArray;function go(o,r,d,h){if(o=o.options,r){r={};for(var p=0;p<d.length;p++)r["$"+d[p]]=!0;for(d=0;d<o.length;d++)p=r.hasOwnProperty("$"+o[d].value),o[d].selected!==p&&(o[d].selected=p),p&&h&&(o[d].defaultSelected=!0)}else{for(d=""+Re(d),r=null,p=0;p<o.length;p++){if(o[p].value===d){o[p].selected=!0,h&&(o[p].defaultSelected=!0);return}r!==null||o[p].disabled||(r=o[p])}r!==null&&(r.selected=!0)}}function or(o,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return Z({},r,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function Jp(o,r){var d=r.value;if(d==null){if(d=r.children,r=r.defaultValue,d!=null){if(r!=null)throw Error(n(92));if(Ti(d)){if(1<d.length)throw Error(n(93));d=d[0]}r=d}r==null&&(r=""),d=r}o._wrapperState={initialValue:Re(d)}}function em(o,r){var d=Re(r.value),h=Re(r.defaultValue);d!=null&&(d=""+d,d!==o.value&&(o.value=d),r.defaultValue==null&&o.defaultValue!==d&&(o.defaultValue=d)),h!=null&&(o.defaultValue=""+h)}function tm(o){var r=o.textContent;r===o._wrapperState.initialValue&&r!==""&&r!==null&&(o.value=r)}function nm(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Vu(o,r){return o==null||o==="http://www.w3.org/1999/xhtml"?nm(r):o==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var cc,im=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,d,h,p){MSApp.execUnsafeLocalFunction(function(){return o(r,d,h,p)})}:o}(function(o,r){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=r;else{for(cc=cc||document.createElement("div"),cc.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=cc.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;r.firstChild;)o.appendChild(r.firstChild)}});function Sa(o,r){if(r){var d=o.firstChild;if(d&&d===o.lastChild&&d.nodeType===3){d.nodeValue=r;return}}o.textContent=r}var va={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},zT=["Webkit","ms","Moz","O"];Object.keys(va).forEach(function(o){zT.forEach(function(r){r=r+o.charAt(0).toUpperCase()+o.substring(1),va[r]=va[o]})});function om(o,r,d){return r==null||typeof r=="boolean"||r===""?"":d||typeof r!="number"||r===0||va.hasOwnProperty(o)&&va[o]?(""+r).trim():r+"px"}function rm(o,r){o=o.style;for(var d in r)if(r.hasOwnProperty(d)){var h=d.indexOf("--")===0,p=om(d,r[d],h);d==="float"&&(d="cssFloat"),h?o.setProperty(d,p):o[d]=p}}var jT=Z({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ku(o,r){if(r){if(jT[o]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,o));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function qu(o,r){if(o.indexOf("-")===-1)return typeof r.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Zu=null;function Qu(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Ju=null,Qr=null,Jr=null;function sm(o){if(o=$a(o)){if(typeof Ju!="function")throw Error(n(280));var r=o.stateNode;r&&(r=Oc(r),Ju(o.stateNode,o.type,r))}}function am(o){Qr?Jr?Jr.push(o):Jr=[o]:Qr=o}function lm(){if(Qr){var o=Qr,r=Jr;if(Jr=Qr=null,sm(o),r)for(o=0;o<r.length;o++)sm(r[o])}}function cm(o,r){return o(r)}function dm(){}var ef=!1;function um(o,r,d){if(ef)return o(r,d);ef=!0;try{return cm(o,r,d)}finally{ef=!1,(Qr!==null||Jr!==null)&&(dm(),lm())}}function Ia(o,r){var d=o.stateNode;if(d===null)return null;var h=Oc(d);if(h===null)return null;d=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(o=o.type,h=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!h;break e;default:o=!1}if(o)return null;if(d&&typeof d!="function")throw Error(n(231,r,typeof d));return d}var tf=!1;if(c)try{var Aa={};Object.defineProperty(Aa,"passive",{get:function(){tf=!0}}),window.addEventListener("test",Aa,Aa),window.removeEventListener("test",Aa,Aa)}catch{tf=!1}function XT(o,r,d,h,p,y,C,O,F){var Y=Array.prototype.slice.call(arguments,3);try{r.apply(d,Y)}catch(te){this.onError(te)}}var Ta=!1,dc=null,uc=!1,nf=null,VT={onError:function(o){Ta=!0,dc=o}};function KT(o,r,d,h,p,y,C,O,F){Ta=!1,dc=null,XT.apply(VT,arguments)}function qT(o,r,d,h,p,y,C,O,F){if(KT.apply(this,arguments),Ta){if(Ta){var Y=dc;Ta=!1,dc=null}else throw Error(n(198));uc||(uc=!0,nf=Y)}}function rr(o){var r=o,d=o;if(o.alternate)for(;r.return;)r=r.return;else{o=r;do r=o,(r.flags&4098)!==0&&(d=r.return),o=r.return;while(o)}return r.tag===3?d:null}function fm(o){if(o.tag===13){var r=o.memoizedState;if(r===null&&(o=o.alternate,o!==null&&(r=o.memoizedState)),r!==null)return r.dehydrated}return null}function hm(o){if(rr(o)!==o)throw Error(n(188))}function ZT(o){var r=o.alternate;if(!r){if(r=rr(o),r===null)throw Error(n(188));return r!==o?null:o}for(var d=o,h=r;;){var p=d.return;if(p===null)break;var y=p.alternate;if(y===null){if(h=p.return,h!==null){d=h;continue}break}if(p.child===y.child){for(y=p.child;y;){if(y===d)return hm(p),o;if(y===h)return hm(p),r;y=y.sibling}throw Error(n(188))}if(d.return!==h.return)d=p,h=y;else{for(var C=!1,O=p.child;O;){if(O===d){C=!0,d=p,h=y;break}if(O===h){C=!0,h=p,d=y;break}O=O.sibling}if(!C){for(O=y.child;O;){if(O===d){C=!0,d=y,h=p;break}if(O===h){C=!0,h=y,d=p;break}O=O.sibling}if(!C)throw Error(n(189))}}if(d.alternate!==h)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?o:r}function gm(o){return o=ZT(o),o!==null?pm(o):null}function pm(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var r=pm(o);if(r!==null)return r;o=o.sibling}return null}var mm=t.unstable_scheduleCallback,ym=t.unstable_cancelCallback,QT=t.unstable_shouldYield,JT=t.unstable_requestPaint,Et=t.unstable_now,eE=t.unstable_getCurrentPriorityLevel,of=t.unstable_ImmediatePriority,Sm=t.unstable_UserBlockingPriority,fc=t.unstable_NormalPriority,tE=t.unstable_LowPriority,vm=t.unstable_IdlePriority,hc=null,Ei=null;function nE(o){if(Ei&&typeof Ei.onCommitFiberRoot=="function")try{Ei.onCommitFiberRoot(hc,o,void 0,(o.current.flags&128)===128)}catch{}}var di=Math.clz32?Math.clz32:rE,iE=Math.log,oE=Math.LN2;function rE(o){return o>>>=0,o===0?32:31-(iE(o)/oE|0)|0}var gc=64,pc=4194304;function Ea(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function mc(o,r){var d=o.pendingLanes;if(d===0)return 0;var h=0,p=o.suspendedLanes,y=o.pingedLanes,C=d&268435455;if(C!==0){var O=C&~p;O!==0?h=Ea(O):(y&=C,y!==0&&(h=Ea(y)))}else C=d&~p,C!==0?h=Ea(C):y!==0&&(h=Ea(y));if(h===0)return 0;if(r!==0&&r!==h&&(r&p)===0&&(p=h&-h,y=r&-r,p>=y||p===16&&(y&4194240)!==0))return r;if((h&4)!==0&&(h|=d&16),r=o.entangledLanes,r!==0)for(o=o.entanglements,r&=h;0<r;)d=31-di(r),p=1<<d,h|=o[d],r&=~p;return h}function sE(o,r){switch(o){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function aE(o,r){for(var d=o.suspendedLanes,h=o.pingedLanes,p=o.expirationTimes,y=o.pendingLanes;0<y;){var C=31-di(y),O=1<<C,F=p[C];F===-1?((O&d)===0||(O&h)!==0)&&(p[C]=sE(O,r)):F<=r&&(o.expiredLanes|=O),y&=~O}}function rf(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function Im(){var o=gc;return gc<<=1,(gc&4194240)===0&&(gc=64),o}function sf(o){for(var r=[],d=0;31>d;d++)r.push(o);return r}function Ca(o,r,d){o.pendingLanes|=r,r!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,r=31-di(r),o[r]=d}function lE(o,r){var d=o.pendingLanes&~r;o.pendingLanes=r,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=r,o.mutableReadLanes&=r,o.entangledLanes&=r,r=o.entanglements;var h=o.eventTimes;for(o=o.expirationTimes;0<d;){var p=31-di(d),y=1<<p;r[p]=0,h[p]=-1,o[p]=-1,d&=~y}}function af(o,r){var d=o.entangledLanes|=r;for(o=o.entanglements;d;){var h=31-di(d),p=1<<h;p&r|o[h]&r&&(o[h]|=r),d&=~p}}var nt=0;function Am(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var Tm,lf,Em,Cm,wm,cf=!1,yc=[],po=null,mo=null,yo=null,wa=new Map,_a=new Map,So=[],cE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function _m(o,r){switch(o){case"focusin":case"focusout":po=null;break;case"dragenter":case"dragleave":mo=null;break;case"mouseover":case"mouseout":yo=null;break;case"pointerover":case"pointerout":wa.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":_a.delete(r.pointerId)}}function Ra(o,r,d,h,p,y){return o===null||o.nativeEvent!==y?(o={blockedOn:r,domEventName:d,eventSystemFlags:h,nativeEvent:y,targetContainers:[p]},r!==null&&(r=$a(r),r!==null&&lf(r)),o):(o.eventSystemFlags|=h,r=o.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),o)}function dE(o,r,d,h,p){switch(r){case"focusin":return po=Ra(po,o,r,d,h,p),!0;case"dragenter":return mo=Ra(mo,o,r,d,h,p),!0;case"mouseover":return yo=Ra(yo,o,r,d,h,p),!0;case"pointerover":var y=p.pointerId;return wa.set(y,Ra(wa.get(y)||null,o,r,d,h,p)),!0;case"gotpointercapture":return y=p.pointerId,_a.set(y,Ra(_a.get(y)||null,o,r,d,h,p)),!0}return!1}function Rm(o){var r=sr(o.target);if(r!==null){var d=rr(r);if(d!==null){if(r=d.tag,r===13){if(r=fm(d),r!==null){o.blockedOn=r,wm(o.priority,function(){Em(d)});return}}else if(r===3&&d.stateNode.current.memoizedState.isDehydrated){o.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Sc(o){if(o.blockedOn!==null)return!1;for(var r=o.targetContainers;0<r.length;){var d=uf(o.domEventName,o.eventSystemFlags,r[0],o.nativeEvent);if(d===null){d=o.nativeEvent;var h=new d.constructor(d.type,d);Zu=h,d.target.dispatchEvent(h),Zu=null}else return r=$a(d),r!==null&&lf(r),o.blockedOn=d,!1;r.shift()}return!0}function Pm(o,r,d){Sc(o)&&d.delete(r)}function uE(){cf=!1,po!==null&&Sc(po)&&(po=null),mo!==null&&Sc(mo)&&(mo=null),yo!==null&&Sc(yo)&&(yo=null),wa.forEach(Pm),_a.forEach(Pm)}function Pa(o,r){o.blockedOn===r&&(o.blockedOn=null,cf||(cf=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,uE)))}function Da(o){function r(p){return Pa(p,o)}if(0<yc.length){Pa(yc[0],o);for(var d=1;d<yc.length;d++){var h=yc[d];h.blockedOn===o&&(h.blockedOn=null)}}for(po!==null&&Pa(po,o),mo!==null&&Pa(mo,o),yo!==null&&Pa(yo,o),wa.forEach(r),_a.forEach(r),d=0;d<So.length;d++)h=So[d],h.blockedOn===o&&(h.blockedOn=null);for(;0<So.length&&(d=So[0],d.blockedOn===null);)Rm(d),d.blockedOn===null&&So.shift()}var es=b.ReactCurrentBatchConfig,vc=!0;function fE(o,r,d,h){var p=nt,y=es.transition;es.transition=null;try{nt=1,df(o,r,d,h)}finally{nt=p,es.transition=y}}function hE(o,r,d,h){var p=nt,y=es.transition;es.transition=null;try{nt=4,df(o,r,d,h)}finally{nt=p,es.transition=y}}function df(o,r,d,h){if(vc){var p=uf(o,r,d,h);if(p===null)Pf(o,r,h,Ic,d),_m(o,h);else if(dE(p,o,r,d,h))h.stopPropagation();else if(_m(o,h),r&4&&-1<cE.indexOf(o)){for(;p!==null;){var y=$a(p);if(y!==null&&Tm(y),y=uf(o,r,d,h),y===null&&Pf(o,r,h,Ic,d),y===p)break;p=y}p!==null&&h.stopPropagation()}else Pf(o,r,h,null,d)}}var Ic=null;function uf(o,r,d,h){if(Ic=null,o=Qu(h),o=sr(o),o!==null)if(r=rr(o),r===null)o=null;else if(d=r.tag,d===13){if(o=fm(r),o!==null)return o;o=null}else if(d===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;o=null}else r!==o&&(o=null);return Ic=o,null}function Dm(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(eE()){case of:return 1;case Sm:return 4;case fc:case tE:return 16;case vm:return 536870912;default:return 16}default:return 16}}var vo=null,ff=null,Ac=null;function Mm(){if(Ac)return Ac;var o,r=ff,d=r.length,h,p="value"in vo?vo.value:vo.textContent,y=p.length;for(o=0;o<d&&r[o]===p[o];o++);var C=d-o;for(h=1;h<=C&&r[d-h]===p[y-h];h++);return Ac=p.slice(o,1<h?1-h:void 0)}function Tc(o){var r=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&r===13&&(o=13)):o=r,o===10&&(o=13),32<=o||o===13?o:0}function Ec(){return!0}function Nm(){return!1}function Bn(o){function r(d,h,p,y,C){this._reactName=d,this._targetInst=p,this.type=h,this.nativeEvent=y,this.target=C,this.currentTarget=null;for(var O in o)o.hasOwnProperty(O)&&(d=o[O],this[O]=d?d(y):y[O]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Ec:Nm,this.isPropagationStopped=Nm,this}return Z(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=Ec)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=Ec)},persist:function(){},isPersistent:Ec}),r}var ts={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},hf=Bn(ts),Ma=Z({},ts,{view:0,detail:0}),gE=Bn(Ma),gf,pf,Na,Cc=Z({},Ma,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:yf,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Na&&(Na&&o.type==="mousemove"?(gf=o.screenX-Na.screenX,pf=o.screenY-Na.screenY):pf=gf=0,Na=o),gf)},movementY:function(o){return"movementY"in o?o.movementY:pf}}),Om=Bn(Cc),pE=Z({},Cc,{dataTransfer:0}),mE=Bn(pE),yE=Z({},Ma,{relatedTarget:0}),mf=Bn(yE),SE=Z({},ts,{animationName:0,elapsedTime:0,pseudoElement:0}),vE=Bn(SE),IE=Z({},ts,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),AE=Bn(IE),TE=Z({},ts,{data:0}),bm=Bn(TE),EE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},CE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _E(o){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(o):(o=wE[o])?!!r[o]:!1}function yf(){return _E}var RE=Z({},Ma,{key:function(o){if(o.key){var r=EE[o.key]||o.key;if(r!=="Unidentified")return r}return o.type==="keypress"?(o=Tc(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?CE[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:yf,charCode:function(o){return o.type==="keypress"?Tc(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Tc(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),PE=Bn(RE),DE=Z({},Cc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),km=Bn(DE),ME=Z({},Ma,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:yf}),NE=Bn(ME),OE=Z({},ts,{propertyName:0,elapsedTime:0,pseudoElement:0}),bE=Bn(OE),kE=Z({},Cc,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),BE=Bn(kE),FE=[9,13,27,32],Sf=c&&"CompositionEvent"in window,Oa=null;c&&"documentMode"in document&&(Oa=document.documentMode);var LE=c&&"TextEvent"in window&&!Oa,Bm=c&&(!Sf||Oa&&8<Oa&&11>=Oa),Fm=" ",Lm=!1;function Hm(o,r){switch(o){case"keyup":return FE.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Um(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var ns=!1;function HE(o,r){switch(o){case"compositionend":return Um(r);case"keypress":return r.which!==32?null:(Lm=!0,Fm);case"textInput":return o=r.data,o===Fm&&Lm?null:o;default:return null}}function UE(o,r){if(ns)return o==="compositionend"||!Sf&&Hm(o,r)?(o=Mm(),Ac=ff=vo=null,ns=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Bm&&r.locale!=="ko"?null:r.data;default:return null}}var GE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gm(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r==="input"?!!GE[o.type]:r==="textarea"}function $m(o,r,d,h){am(h),r=Dc(r,"onChange"),0<r.length&&(d=new hf("onChange","change",null,d,h),o.push({event:d,listeners:r}))}var ba=null,ka=null;function $E(o){r0(o,0)}function wc(o){var r=as(o);if(Ae(r))return o}function WE(o,r){if(o==="change")return r}var Wm=!1;if(c){var vf;if(c){var If="oninput"in document;if(!If){var xm=document.createElement("div");xm.setAttribute("oninput","return;"),If=typeof xm.oninput=="function"}vf=If}else vf=!1;Wm=vf&&(!document.documentMode||9<document.documentMode)}function Ym(){ba&&(ba.detachEvent("onpropertychange",zm),ka=ba=null)}function zm(o){if(o.propertyName==="value"&&wc(ka)){var r=[];$m(r,ka,o,Qu(o)),um($E,r)}}function xE(o,r,d){o==="focusin"?(Ym(),ba=r,ka=d,ba.attachEvent("onpropertychange",zm)):o==="focusout"&&Ym()}function YE(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return wc(ka)}function zE(o,r){if(o==="click")return wc(r)}function jE(o,r){if(o==="input"||o==="change")return wc(r)}function XE(o,r){return o===r&&(o!==0||1/o===1/r)||o!==o&&r!==r}var ui=typeof Object.is=="function"?Object.is:XE;function Ba(o,r){if(ui(o,r))return!0;if(typeof o!="object"||o===null||typeof r!="object"||r===null)return!1;var d=Object.keys(o),h=Object.keys(r);if(d.length!==h.length)return!1;for(h=0;h<d.length;h++){var p=d[h];if(!u.call(r,p)||!ui(o[p],r[p]))return!1}return!0}function jm(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Xm(o,r){var d=jm(o);o=0;for(var h;d;){if(d.nodeType===3){if(h=o+d.textContent.length,o<=r&&h>=r)return{node:d,offset:r-o};o=h}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=jm(d)}}function Vm(o,r){return o&&r?o===r?!0:o&&o.nodeType===3?!1:r&&r.nodeType===3?Vm(o,r.parentNode):"contains"in o?o.contains(r):o.compareDocumentPosition?!!(o.compareDocumentPosition(r)&16):!1:!1}function Km(){for(var o=window,r=kn();r instanceof o.HTMLIFrameElement;){try{var d=typeof r.contentWindow.location.href=="string"}catch{d=!1}if(d)o=r.contentWindow;else break;r=kn(o.document)}return r}function Af(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r&&(r==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||r==="textarea"||o.contentEditable==="true")}function VE(o){var r=Km(),d=o.focusedElem,h=o.selectionRange;if(r!==d&&d&&d.ownerDocument&&Vm(d.ownerDocument.documentElement,d)){if(h!==null&&Af(d)){if(r=h.start,o=h.end,o===void 0&&(o=r),"selectionStart"in d)d.selectionStart=r,d.selectionEnd=Math.min(o,d.value.length);else if(o=(r=d.ownerDocument||document)&&r.defaultView||window,o.getSelection){o=o.getSelection();var p=d.textContent.length,y=Math.min(h.start,p);h=h.end===void 0?y:Math.min(h.end,p),!o.extend&&y>h&&(p=h,h=y,y=p),p=Xm(d,y);var C=Xm(d,h);p&&C&&(o.rangeCount!==1||o.anchorNode!==p.node||o.anchorOffset!==p.offset||o.focusNode!==C.node||o.focusOffset!==C.offset)&&(r=r.createRange(),r.setStart(p.node,p.offset),o.removeAllRanges(),y>h?(o.addRange(r),o.extend(C.node,C.offset)):(r.setEnd(C.node,C.offset),o.addRange(r)))}}for(r=[],o=d;o=o.parentNode;)o.nodeType===1&&r.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<r.length;d++)o=r[d],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var KE=c&&"documentMode"in document&&11>=document.documentMode,is=null,Tf=null,Fa=null,Ef=!1;function qm(o,r,d){var h=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Ef||is==null||is!==kn(h)||(h=is,"selectionStart"in h&&Af(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Fa&&Ba(Fa,h)||(Fa=h,h=Dc(Tf,"onSelect"),0<h.length&&(r=new hf("onSelect","select",null,r,d),o.push({event:r,listeners:h}),r.target=is)))}function _c(o,r){var d={};return d[o.toLowerCase()]=r.toLowerCase(),d["Webkit"+o]="webkit"+r,d["Moz"+o]="moz"+r,d}var os={animationend:_c("Animation","AnimationEnd"),animationiteration:_c("Animation","AnimationIteration"),animationstart:_c("Animation","AnimationStart"),transitionend:_c("Transition","TransitionEnd")},Cf={},Zm={};c&&(Zm=document.createElement("div").style,"AnimationEvent"in window||(delete os.animationend.animation,delete os.animationiteration.animation,delete os.animationstart.animation),"TransitionEvent"in window||delete os.transitionend.transition);function Rc(o){if(Cf[o])return Cf[o];if(!os[o])return o;var r=os[o],d;for(d in r)if(r.hasOwnProperty(d)&&d in Zm)return Cf[o]=r[d];return o}var Qm=Rc("animationend"),Jm=Rc("animationiteration"),e0=Rc("animationstart"),t0=Rc("transitionend"),n0=new Map,i0="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Io(o,r){n0.set(o,r),a(r,[o])}for(var wf=0;wf<i0.length;wf++){var _f=i0[wf],qE=_f.toLowerCase(),ZE=_f[0].toUpperCase()+_f.slice(1);Io(qE,"on"+ZE)}Io(Qm,"onAnimationEnd"),Io(Jm,"onAnimationIteration"),Io(e0,"onAnimationStart"),Io("dblclick","onDoubleClick"),Io("focusin","onFocus"),Io("focusout","onBlur"),Io(t0,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var La="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QE=new Set("cancel close invalid load scroll toggle".split(" ").concat(La));function o0(o,r,d){var h=o.type||"unknown-event";o.currentTarget=d,qT(h,r,void 0,o),o.currentTarget=null}function r0(o,r){r=(r&4)!==0;for(var d=0;d<o.length;d++){var h=o[d],p=h.event;h=h.listeners;e:{var y=void 0;if(r)for(var C=h.length-1;0<=C;C--){var O=h[C],F=O.instance,Y=O.currentTarget;if(O=O.listener,F!==y&&p.isPropagationStopped())break e;o0(p,O,Y),y=F}else for(C=0;C<h.length;C++){if(O=h[C],F=O.instance,Y=O.currentTarget,O=O.listener,F!==y&&p.isPropagationStopped())break e;o0(p,O,Y),y=F}}}if(uc)throw o=nf,uc=!1,nf=null,o}function lt(o,r){var d=r[kf];d===void 0&&(d=r[kf]=new Set);var h=o+"__bubble";d.has(h)||(s0(r,o,2,!1),d.add(h))}function Rf(o,r,d){var h=0;r&&(h|=4),s0(d,o,h,r)}var Pc="_reactListening"+Math.random().toString(36).slice(2);function Ha(o){if(!o[Pc]){o[Pc]=!0,i.forEach(function(d){d!=="selectionchange"&&(QE.has(d)||Rf(d,!1,o),Rf(d,!0,o))});var r=o.nodeType===9?o:o.ownerDocument;r===null||r[Pc]||(r[Pc]=!0,Rf("selectionchange",!1,r))}}function s0(o,r,d,h){switch(Dm(r)){case 1:var p=fE;break;case 4:p=hE;break;default:p=df}d=p.bind(null,r,d,o),p=void 0,!tf||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),h?p!==void 0?o.addEventListener(r,d,{capture:!0,passive:p}):o.addEventListener(r,d,!0):p!==void 0?o.addEventListener(r,d,{passive:p}):o.addEventListener(r,d,!1)}function Pf(o,r,d,h,p){var y=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var C=h.tag;if(C===3||C===4){var O=h.stateNode.containerInfo;if(O===p||O.nodeType===8&&O.parentNode===p)break;if(C===4)for(C=h.return;C!==null;){var F=C.tag;if((F===3||F===4)&&(F=C.stateNode.containerInfo,F===p||F.nodeType===8&&F.parentNode===p))return;C=C.return}for(;O!==null;){if(C=sr(O),C===null)return;if(F=C.tag,F===5||F===6){h=y=C;continue e}O=O.parentNode}}h=h.return}um(function(){var Y=y,te=Qu(d),ne=[];e:{var J=n0.get(o);if(J!==void 0){var ye=hf,Te=o;switch(o){case"keypress":if(Tc(d)===0)break e;case"keydown":case"keyup":ye=PE;break;case"focusin":Te="focus",ye=mf;break;case"focusout":Te="blur",ye=mf;break;case"beforeblur":case"afterblur":ye=mf;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ye=Om;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ye=mE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ye=NE;break;case Qm:case Jm:case e0:ye=vE;break;case t0:ye=bE;break;case"scroll":ye=gE;break;case"wheel":ye=BE;break;case"copy":case"cut":case"paste":ye=AE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ye=km}var we=(r&4)!==0,Ct=!we&&o==="scroll",$=we?J!==null?J+"Capture":null:J;we=[];for(var H=Y,W;H!==null;){W=H;var re=W.stateNode;if(W.tag===5&&re!==null&&(W=re,$!==null&&(re=Ia(H,$),re!=null&&we.push(Ua(H,re,W)))),Ct)break;H=H.return}0<we.length&&(J=new ye(J,Te,null,d,te),ne.push({event:J,listeners:we}))}}if((r&7)===0){e:{if(J=o==="mouseover"||o==="pointerover",ye=o==="mouseout"||o==="pointerout",J&&d!==Zu&&(Te=d.relatedTarget||d.fromElement)&&(sr(Te)||Te[Gi]))break e;if((ye||J)&&(J=te.window===te?te:(J=te.ownerDocument)?J.defaultView||J.parentWindow:window,ye?(Te=d.relatedTarget||d.toElement,ye=Y,Te=Te?sr(Te):null,Te!==null&&(Ct=rr(Te),Te!==Ct||Te.tag!==5&&Te.tag!==6)&&(Te=null)):(ye=null,Te=Y),ye!==Te)){if(we=Om,re="onMouseLeave",$="onMouseEnter",H="mouse",(o==="pointerout"||o==="pointerover")&&(we=km,re="onPointerLeave",$="onPointerEnter",H="pointer"),Ct=ye==null?J:as(ye),W=Te==null?J:as(Te),J=new we(re,H+"leave",ye,d,te),J.target=Ct,J.relatedTarget=W,re=null,sr(te)===Y&&(we=new we($,H+"enter",Te,d,te),we.target=W,we.relatedTarget=Ct,re=we),Ct=re,ye&&Te)t:{for(we=ye,$=Te,H=0,W=we;W;W=rs(W))H++;for(W=0,re=$;re;re=rs(re))W++;for(;0<H-W;)we=rs(we),H--;for(;0<W-H;)$=rs($),W--;for(;H--;){if(we===$||$!==null&&we===$.alternate)break t;we=rs(we),$=rs($)}we=null}else we=null;ye!==null&&a0(ne,J,ye,we,!1),Te!==null&&Ct!==null&&a0(ne,Ct,Te,we,!0)}}e:{if(J=Y?as(Y):window,ye=J.nodeName&&J.nodeName.toLowerCase(),ye==="select"||ye==="input"&&J.type==="file")var De=WE;else if(Gm(J))if(Wm)De=jE;else{De=YE;var be=xE}else(ye=J.nodeName)&&ye.toLowerCase()==="input"&&(J.type==="checkbox"||J.type==="radio")&&(De=zE);if(De&&(De=De(o,Y))){$m(ne,De,d,te);break e}be&&be(o,J,Y),o==="focusout"&&(be=J._wrapperState)&&be.controlled&&J.type==="number"&&Ai(J,"number",J.value)}switch(be=Y?as(Y):window,o){case"focusin":(Gm(be)||be.contentEditable==="true")&&(is=be,Tf=Y,Fa=null);break;case"focusout":Fa=Tf=is=null;break;case"mousedown":Ef=!0;break;case"contextmenu":case"mouseup":case"dragend":Ef=!1,qm(ne,d,te);break;case"selectionchange":if(KE)break;case"keydown":case"keyup":qm(ne,d,te)}var ke;if(Sf)e:{switch(o){case"compositionstart":var Ue="onCompositionStart";break e;case"compositionend":Ue="onCompositionEnd";break e;case"compositionupdate":Ue="onCompositionUpdate";break e}Ue=void 0}else ns?Hm(o,d)&&(Ue="onCompositionEnd"):o==="keydown"&&d.keyCode===229&&(Ue="onCompositionStart");Ue&&(Bm&&d.locale!=="ko"&&(ns||Ue!=="onCompositionStart"?Ue==="onCompositionEnd"&&ns&&(ke=Mm()):(vo=te,ff="value"in vo?vo.value:vo.textContent,ns=!0)),be=Dc(Y,Ue),0<be.length&&(Ue=new bm(Ue,o,null,d,te),ne.push({event:Ue,listeners:be}),ke?Ue.data=ke:(ke=Um(d),ke!==null&&(Ue.data=ke)))),(ke=LE?HE(o,d):UE(o,d))&&(Y=Dc(Y,"onBeforeInput"),0<Y.length&&(te=new bm("onBeforeInput","beforeinput",null,d,te),ne.push({event:te,listeners:Y}),te.data=ke))}r0(ne,r)})}function Ua(o,r,d){return{instance:o,listener:r,currentTarget:d}}function Dc(o,r){for(var d=r+"Capture",h=[];o!==null;){var p=o,y=p.stateNode;p.tag===5&&y!==null&&(p=y,y=Ia(o,d),y!=null&&h.unshift(Ua(o,y,p)),y=Ia(o,r),y!=null&&h.push(Ua(o,y,p))),o=o.return}return h}function rs(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function a0(o,r,d,h,p){for(var y=r._reactName,C=[];d!==null&&d!==h;){var O=d,F=O.alternate,Y=O.stateNode;if(F!==null&&F===h)break;O.tag===5&&Y!==null&&(O=Y,p?(F=Ia(d,y),F!=null&&C.unshift(Ua(d,F,O))):p||(F=Ia(d,y),F!=null&&C.push(Ua(d,F,O)))),d=d.return}C.length!==0&&o.push({event:r,listeners:C})}var JE=/\r\n?/g,eC=/\u0000|\uFFFD/g;function l0(o){return(typeof o=="string"?o:""+o).replace(JE,`
`).replace(eC,"")}function Mc(o,r,d){if(r=l0(r),l0(o)!==r&&d)throw Error(n(425))}function Nc(){}var Df=null,Mf=null;function Nf(o,r){return o==="textarea"||o==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Of=typeof setTimeout=="function"?setTimeout:void 0,tC=typeof clearTimeout=="function"?clearTimeout:void 0,c0=typeof Promise=="function"?Promise:void 0,nC=typeof queueMicrotask=="function"?queueMicrotask:typeof c0<"u"?function(o){return c0.resolve(null).then(o).catch(iC)}:Of;function iC(o){setTimeout(function(){throw o})}function bf(o,r){var d=r,h=0;do{var p=d.nextSibling;if(o.removeChild(d),p&&p.nodeType===8)if(d=p.data,d==="/$"){if(h===0){o.removeChild(p),Da(r);return}h--}else d!=="$"&&d!=="$?"&&d!=="$!"||h++;d=p}while(d);Da(r)}function Ao(o){for(;o!=null;o=o.nextSibling){var r=o.nodeType;if(r===1||r===3)break;if(r===8){if(r=o.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return o}function d0(o){o=o.previousSibling;for(var r=0;o;){if(o.nodeType===8){var d=o.data;if(d==="$"||d==="$!"||d==="$?"){if(r===0)return o;r--}else d==="/$"&&r++}o=o.previousSibling}return null}var ss=Math.random().toString(36).slice(2),Ci="__reactFiber$"+ss,Ga="__reactProps$"+ss,Gi="__reactContainer$"+ss,kf="__reactEvents$"+ss,oC="__reactListeners$"+ss,rC="__reactHandles$"+ss;function sr(o){var r=o[Ci];if(r)return r;for(var d=o.parentNode;d;){if(r=d[Gi]||d[Ci]){if(d=r.alternate,r.child!==null||d!==null&&d.child!==null)for(o=d0(o);o!==null;){if(d=o[Ci])return d;o=d0(o)}return r}o=d,d=o.parentNode}return null}function $a(o){return o=o[Ci]||o[Gi],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function as(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(n(33))}function Oc(o){return o[Ga]||null}var Bf=[],ls=-1;function To(o){return{current:o}}function ct(o){0>ls||(o.current=Bf[ls],Bf[ls]=null,ls--)}function at(o,r){ls++,Bf[ls]=o.current,o.current=r}var Eo={},Jt=To(Eo),Cn=To(!1),ar=Eo;function cs(o,r){var d=o.type.contextTypes;if(!d)return Eo;var h=o.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===r)return h.__reactInternalMemoizedMaskedChildContext;var p={},y;for(y in d)p[y]=r[y];return h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=r,o.__reactInternalMemoizedMaskedChildContext=p),p}function wn(o){return o=o.childContextTypes,o!=null}function bc(){ct(Cn),ct(Jt)}function u0(o,r,d){if(Jt.current!==Eo)throw Error(n(168));at(Jt,r),at(Cn,d)}function f0(o,r,d){var h=o.stateNode;if(r=r.childContextTypes,typeof h.getChildContext!="function")return d;h=h.getChildContext();for(var p in h)if(!(p in r))throw Error(n(108,Ee(o)||"Unknown",p));return Z({},d,h)}function kc(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||Eo,ar=Jt.current,at(Jt,o),at(Cn,Cn.current),!0}function h0(o,r,d){var h=o.stateNode;if(!h)throw Error(n(169));d?(o=f0(o,r,ar),h.__reactInternalMemoizedMergedChildContext=o,ct(Cn),ct(Jt),at(Jt,o)):ct(Cn),at(Cn,d)}var $i=null,Bc=!1,Ff=!1;function g0(o){$i===null?$i=[o]:$i.push(o)}function sC(o){Bc=!0,g0(o)}function Co(){if(!Ff&&$i!==null){Ff=!0;var o=0,r=nt;try{var d=$i;for(nt=1;o<d.length;o++){var h=d[o];do h=h(!0);while(h!==null)}$i=null,Bc=!1}catch(p){throw $i!==null&&($i=$i.slice(o+1)),mm(of,Co),p}finally{nt=r,Ff=!1}}return null}var ds=[],us=0,Fc=null,Lc=0,Jn=[],ei=0,lr=null,Wi=1,xi="";function cr(o,r){ds[us++]=Lc,ds[us++]=Fc,Fc=o,Lc=r}function p0(o,r,d){Jn[ei++]=Wi,Jn[ei++]=xi,Jn[ei++]=lr,lr=o;var h=Wi;o=xi;var p=32-di(h)-1;h&=~(1<<p),d+=1;var y=32-di(r)+p;if(30<y){var C=p-p%5;y=(h&(1<<C)-1).toString(32),h>>=C,p-=C,Wi=1<<32-di(r)+p|d<<p|h,xi=y+o}else Wi=1<<y|d<<p|h,xi=o}function Lf(o){o.return!==null&&(cr(o,1),p0(o,1,0))}function Hf(o){for(;o===Fc;)Fc=ds[--us],ds[us]=null,Lc=ds[--us],ds[us]=null;for(;o===lr;)lr=Jn[--ei],Jn[ei]=null,xi=Jn[--ei],Jn[ei]=null,Wi=Jn[--ei],Jn[ei]=null}var Fn=null,Ln=null,gt=!1,fi=null;function m0(o,r){var d=oi(5,null,null,0);d.elementType="DELETED",d.stateNode=r,d.return=o,r=o.deletions,r===null?(o.deletions=[d],o.flags|=16):r.push(d)}function y0(o,r){switch(o.tag){case 5:var d=o.type;return r=r.nodeType!==1||d.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(o.stateNode=r,Fn=o,Ln=Ao(r.firstChild),!0):!1;case 6:return r=o.pendingProps===""||r.nodeType!==3?null:r,r!==null?(o.stateNode=r,Fn=o,Ln=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(d=lr!==null?{id:Wi,overflow:xi}:null,o.memoizedState={dehydrated:r,treeContext:d,retryLane:1073741824},d=oi(18,null,null,0),d.stateNode=r,d.return=o,o.child=d,Fn=o,Ln=null,!0):!1;default:return!1}}function Uf(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Gf(o){if(gt){var r=Ln;if(r){var d=r;if(!y0(o,r)){if(Uf(o))throw Error(n(418));r=Ao(d.nextSibling);var h=Fn;r&&y0(o,r)?m0(h,d):(o.flags=o.flags&-4097|2,gt=!1,Fn=o)}}else{if(Uf(o))throw Error(n(418));o.flags=o.flags&-4097|2,gt=!1,Fn=o}}}function S0(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;Fn=o}function Hc(o){if(o!==Fn)return!1;if(!gt)return S0(o),gt=!0,!1;var r;if((r=o.tag!==3)&&!(r=o.tag!==5)&&(r=o.type,r=r!=="head"&&r!=="body"&&!Nf(o.type,o.memoizedProps)),r&&(r=Ln)){if(Uf(o))throw v0(),Error(n(418));for(;r;)m0(o,r),r=Ao(r.nextSibling)}if(S0(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,r=0;o;){if(o.nodeType===8){var d=o.data;if(d==="/$"){if(r===0){Ln=Ao(o.nextSibling);break e}r--}else d!=="$"&&d!=="$!"&&d!=="$?"||r++}o=o.nextSibling}Ln=null}}else Ln=Fn?Ao(o.stateNode.nextSibling):null;return!0}function v0(){for(var o=Ln;o;)o=Ao(o.nextSibling)}function fs(){Ln=Fn=null,gt=!1}function $f(o){fi===null?fi=[o]:fi.push(o)}var aC=b.ReactCurrentBatchConfig;function Wa(o,r,d){if(o=d.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(n(309));var h=d.stateNode}if(!h)throw Error(n(147,o));var p=h,y=""+o;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===y?r.ref:(r=function(C){var O=p.refs;C===null?delete O[y]:O[y]=C},r._stringRef=y,r)}if(typeof o!="string")throw Error(n(284));if(!d._owner)throw Error(n(290,o))}return o}function Uc(o,r){throw o=Object.prototype.toString.call(r),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o))}function I0(o){var r=o._init;return r(o._payload)}function A0(o){function r($,H){if(o){var W=$.deletions;W===null?($.deletions=[H],$.flags|=16):W.push(H)}}function d($,H){if(!o)return null;for(;H!==null;)r($,H),H=H.sibling;return null}function h($,H){for($=new Map;H!==null;)H.key!==null?$.set(H.key,H):$.set(H.index,H),H=H.sibling;return $}function p($,H){return $=Oo($,H),$.index=0,$.sibling=null,$}function y($,H,W){return $.index=W,o?(W=$.alternate,W!==null?(W=W.index,W<H?($.flags|=2,H):W):($.flags|=2,H)):($.flags|=1048576,H)}function C($){return o&&$.alternate===null&&($.flags|=2),$}function O($,H,W,re){return H===null||H.tag!==6?(H=Oh(W,$.mode,re),H.return=$,H):(H=p(H,W),H.return=$,H)}function F($,H,W,re){var De=W.type;return De===N?te($,H,W.props.children,re,W.key):H!==null&&(H.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===oe&&I0(De)===H.type)?(re=p(H,W.props),re.ref=Wa($,H,W),re.return=$,re):(re=cd(W.type,W.key,W.props,null,$.mode,re),re.ref=Wa($,H,W),re.return=$,re)}function Y($,H,W,re){return H===null||H.tag!==4||H.stateNode.containerInfo!==W.containerInfo||H.stateNode.implementation!==W.implementation?(H=bh(W,$.mode,re),H.return=$,H):(H=p(H,W.children||[]),H.return=$,H)}function te($,H,W,re,De){return H===null||H.tag!==7?(H=yr(W,$.mode,re,De),H.return=$,H):(H=p(H,W),H.return=$,H)}function ne($,H,W){if(typeof H=="string"&&H!==""||typeof H=="number")return H=Oh(""+H,$.mode,W),H.return=$,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case M:return W=cd(H.type,H.key,H.props,null,$.mode,W),W.ref=Wa($,null,H),W.return=$,W;case D:return H=bh(H,$.mode,W),H.return=$,H;case oe:var re=H._init;return ne($,re(H._payload),W)}if(Ti(H)||K(H))return H=yr(H,$.mode,W,null),H.return=$,H;Uc($,H)}return null}function J($,H,W,re){var De=H!==null?H.key:null;if(typeof W=="string"&&W!==""||typeof W=="number")return De!==null?null:O($,H,""+W,re);if(typeof W=="object"&&W!==null){switch(W.$$typeof){case M:return W.key===De?F($,H,W,re):null;case D:return W.key===De?Y($,H,W,re):null;case oe:return De=W._init,J($,H,De(W._payload),re)}if(Ti(W)||K(W))return De!==null?null:te($,H,W,re,null);Uc($,W)}return null}function ye($,H,W,re,De){if(typeof re=="string"&&re!==""||typeof re=="number")return $=$.get(W)||null,O(H,$,""+re,De);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case M:return $=$.get(re.key===null?W:re.key)||null,F(H,$,re,De);case D:return $=$.get(re.key===null?W:re.key)||null,Y(H,$,re,De);case oe:var be=re._init;return ye($,H,W,be(re._payload),De)}if(Ti(re)||K(re))return $=$.get(W)||null,te(H,$,re,De,null);Uc(H,re)}return null}function Te($,H,W,re){for(var De=null,be=null,ke=H,Ue=H=0,Ht=null;ke!==null&&Ue<W.length;Ue++){ke.index>Ue?(Ht=ke,ke=null):Ht=ke.sibling;var qe=J($,ke,W[Ue],re);if(qe===null){ke===null&&(ke=Ht);break}o&&ke&&qe.alternate===null&&r($,ke),H=y(qe,H,Ue),be===null?De=qe:be.sibling=qe,be=qe,ke=Ht}if(Ue===W.length)return d($,ke),gt&&cr($,Ue),De;if(ke===null){for(;Ue<W.length;Ue++)ke=ne($,W[Ue],re),ke!==null&&(H=y(ke,H,Ue),be===null?De=ke:be.sibling=ke,be=ke);return gt&&cr($,Ue),De}for(ke=h($,ke);Ue<W.length;Ue++)Ht=ye(ke,$,Ue,W[Ue],re),Ht!==null&&(o&&Ht.alternate!==null&&ke.delete(Ht.key===null?Ue:Ht.key),H=y(Ht,H,Ue),be===null?De=Ht:be.sibling=Ht,be=Ht);return o&&ke.forEach(function(bo){return r($,bo)}),gt&&cr($,Ue),De}function we($,H,W,re){var De=K(W);if(typeof De!="function")throw Error(n(150));if(W=De.call(W),W==null)throw Error(n(151));for(var be=De=null,ke=H,Ue=H=0,Ht=null,qe=W.next();ke!==null&&!qe.done;Ue++,qe=W.next()){ke.index>Ue?(Ht=ke,ke=null):Ht=ke.sibling;var bo=J($,ke,qe.value,re);if(bo===null){ke===null&&(ke=Ht);break}o&&ke&&bo.alternate===null&&r($,ke),H=y(bo,H,Ue),be===null?De=bo:be.sibling=bo,be=bo,ke=Ht}if(qe.done)return d($,ke),gt&&cr($,Ue),De;if(ke===null){for(;!qe.done;Ue++,qe=W.next())qe=ne($,qe.value,re),qe!==null&&(H=y(qe,H,Ue),be===null?De=qe:be.sibling=qe,be=qe);return gt&&cr($,Ue),De}for(ke=h($,ke);!qe.done;Ue++,qe=W.next())qe=ye(ke,$,Ue,qe.value,re),qe!==null&&(o&&qe.alternate!==null&&ke.delete(qe.key===null?Ue:qe.key),H=y(qe,H,Ue),be===null?De=qe:be.sibling=qe,be=qe);return o&&ke.forEach(function(GC){return r($,GC)}),gt&&cr($,Ue),De}function Ct($,H,W,re){if(typeof W=="object"&&W!==null&&W.type===N&&W.key===null&&(W=W.props.children),typeof W=="object"&&W!==null){switch(W.$$typeof){case M:e:{for(var De=W.key,be=H;be!==null;){if(be.key===De){if(De=W.type,De===N){if(be.tag===7){d($,be.sibling),H=p(be,W.props.children),H.return=$,$=H;break e}}else if(be.elementType===De||typeof De=="object"&&De!==null&&De.$$typeof===oe&&I0(De)===be.type){d($,be.sibling),H=p(be,W.props),H.ref=Wa($,be,W),H.return=$,$=H;break e}d($,be);break}else r($,be);be=be.sibling}W.type===N?(H=yr(W.props.children,$.mode,re,W.key),H.return=$,$=H):(re=cd(W.type,W.key,W.props,null,$.mode,re),re.ref=Wa($,H,W),re.return=$,$=re)}return C($);case D:e:{for(be=W.key;H!==null;){if(H.key===be)if(H.tag===4&&H.stateNode.containerInfo===W.containerInfo&&H.stateNode.implementation===W.implementation){d($,H.sibling),H=p(H,W.children||[]),H.return=$,$=H;break e}else{d($,H);break}else r($,H);H=H.sibling}H=bh(W,$.mode,re),H.return=$,$=H}return C($);case oe:return be=W._init,Ct($,H,be(W._payload),re)}if(Ti(W))return Te($,H,W,re);if(K(W))return we($,H,W,re);Uc($,W)}return typeof W=="string"&&W!==""||typeof W=="number"?(W=""+W,H!==null&&H.tag===6?(d($,H.sibling),H=p(H,W),H.return=$,$=H):(d($,H),H=Oh(W,$.mode,re),H.return=$,$=H),C($)):d($,H)}return Ct}var hs=A0(!0),T0=A0(!1),Gc=To(null),$c=null,gs=null,Wf=null;function xf(){Wf=gs=$c=null}function Yf(o){var r=Gc.current;ct(Gc),o._currentValue=r}function zf(o,r,d){for(;o!==null;){var h=o.alternate;if((o.childLanes&r)!==r?(o.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),o===d)break;o=o.return}}function ps(o,r){$c=o,Wf=gs=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&r)!==0&&(_n=!0),o.firstContext=null)}function ti(o){var r=o._currentValue;if(Wf!==o)if(o={context:o,memoizedValue:r,next:null},gs===null){if($c===null)throw Error(n(308));gs=o,$c.dependencies={lanes:0,firstContext:o}}else gs=gs.next=o;return r}var dr=null;function jf(o){dr===null?dr=[o]:dr.push(o)}function E0(o,r,d,h){var p=r.interleaved;return p===null?(d.next=d,jf(r)):(d.next=p.next,p.next=d),r.interleaved=d,Yi(o,h)}function Yi(o,r){o.lanes|=r;var d=o.alternate;for(d!==null&&(d.lanes|=r),d=o,o=o.return;o!==null;)o.childLanes|=r,d=o.alternate,d!==null&&(d.childLanes|=r),d=o,o=o.return;return d.tag===3?d.stateNode:null}var wo=!1;function Xf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function C0(o,r){o=o.updateQueue,r.updateQueue===o&&(r.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function zi(o,r){return{eventTime:o,lane:r,tag:0,payload:null,callback:null,next:null}}function _o(o,r,d){var h=o.updateQueue;if(h===null)return null;if(h=h.shared,(Ve&2)!==0){var p=h.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),h.pending=r,Yi(o,d)}return p=h.interleaved,p===null?(r.next=r,jf(h)):(r.next=p.next,p.next=r),h.interleaved=r,Yi(o,d)}function Wc(o,r,d){if(r=r.updateQueue,r!==null&&(r=r.shared,(d&4194240)!==0)){var h=r.lanes;h&=o.pendingLanes,d|=h,r.lanes=d,af(o,d)}}function w0(o,r){var d=o.updateQueue,h=o.alternate;if(h!==null&&(h=h.updateQueue,d===h)){var p=null,y=null;if(d=d.firstBaseUpdate,d!==null){do{var C={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};y===null?p=y=C:y=y.next=C,d=d.next}while(d!==null);y===null?p=y=r:y=y.next=r}else p=y=r;d={baseState:h.baseState,firstBaseUpdate:p,lastBaseUpdate:y,shared:h.shared,effects:h.effects},o.updateQueue=d;return}o=d.lastBaseUpdate,o===null?d.firstBaseUpdate=r:o.next=r,d.lastBaseUpdate=r}function xc(o,r,d,h){var p=o.updateQueue;wo=!1;var y=p.firstBaseUpdate,C=p.lastBaseUpdate,O=p.shared.pending;if(O!==null){p.shared.pending=null;var F=O,Y=F.next;F.next=null,C===null?y=Y:C.next=Y,C=F;var te=o.alternate;te!==null&&(te=te.updateQueue,O=te.lastBaseUpdate,O!==C&&(O===null?te.firstBaseUpdate=Y:O.next=Y,te.lastBaseUpdate=F))}if(y!==null){var ne=p.baseState;C=0,te=Y=F=null,O=y;do{var J=O.lane,ye=O.eventTime;if((h&J)===J){te!==null&&(te=te.next={eventTime:ye,lane:0,tag:O.tag,payload:O.payload,callback:O.callback,next:null});e:{var Te=o,we=O;switch(J=r,ye=d,we.tag){case 1:if(Te=we.payload,typeof Te=="function"){ne=Te.call(ye,ne,J);break e}ne=Te;break e;case 3:Te.flags=Te.flags&-65537|128;case 0:if(Te=we.payload,J=typeof Te=="function"?Te.call(ye,ne,J):Te,J==null)break e;ne=Z({},ne,J);break e;case 2:wo=!0}}O.callback!==null&&O.lane!==0&&(o.flags|=64,J=p.effects,J===null?p.effects=[O]:J.push(O))}else ye={eventTime:ye,lane:J,tag:O.tag,payload:O.payload,callback:O.callback,next:null},te===null?(Y=te=ye,F=ne):te=te.next=ye,C|=J;if(O=O.next,O===null){if(O=p.shared.pending,O===null)break;J=O,O=J.next,J.next=null,p.lastBaseUpdate=J,p.shared.pending=null}}while(!0);if(te===null&&(F=ne),p.baseState=F,p.firstBaseUpdate=Y,p.lastBaseUpdate=te,r=p.shared.interleaved,r!==null){p=r;do C|=p.lane,p=p.next;while(p!==r)}else y===null&&(p.shared.lanes=0);hr|=C,o.lanes=C,o.memoizedState=ne}}function _0(o,r,d){if(o=r.effects,r.effects=null,o!==null)for(r=0;r<o.length;r++){var h=o[r],p=h.callback;if(p!==null){if(h.callback=null,h=d,typeof p!="function")throw Error(n(191,p));p.call(h)}}}var xa={},wi=To(xa),Ya=To(xa),za=To(xa);function ur(o){if(o===xa)throw Error(n(174));return o}function Vf(o,r){switch(at(za,r),at(Ya,o),at(wi,xa),o=r.nodeType,o){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Vu(null,"");break;default:o=o===8?r.parentNode:r,r=o.namespaceURI||null,o=o.tagName,r=Vu(r,o)}ct(wi),at(wi,r)}function ms(){ct(wi),ct(Ya),ct(za)}function R0(o){ur(za.current);var r=ur(wi.current),d=Vu(r,o.type);r!==d&&(at(Ya,o),at(wi,d))}function Kf(o){Ya.current===o&&(ct(wi),ct(Ya))}var mt=To(0);function Yc(o){for(var r=o;r!==null;){if(r.tag===13){var d=r.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var qf=[];function Zf(){for(var o=0;o<qf.length;o++)qf[o]._workInProgressVersionPrimary=null;qf.length=0}var zc=b.ReactCurrentDispatcher,Qf=b.ReactCurrentBatchConfig,fr=0,yt=null,Ot=null,Ft=null,jc=!1,ja=!1,Xa=0,lC=0;function en(){throw Error(n(321))}function Jf(o,r){if(r===null)return!1;for(var d=0;d<r.length&&d<o.length;d++)if(!ui(o[d],r[d]))return!1;return!0}function eh(o,r,d,h,p,y){if(fr=y,yt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,zc.current=o===null||o.memoizedState===null?fC:hC,o=d(h,p),ja){y=0;do{if(ja=!1,Xa=0,25<=y)throw Error(n(301));y+=1,Ft=Ot=null,r.updateQueue=null,zc.current=gC,o=d(h,p)}while(ja)}if(zc.current=Kc,r=Ot!==null&&Ot.next!==null,fr=0,Ft=Ot=yt=null,jc=!1,r)throw Error(n(300));return o}function th(){var o=Xa!==0;return Xa=0,o}function _i(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?yt.memoizedState=Ft=o:Ft=Ft.next=o,Ft}function ni(){if(Ot===null){var o=yt.alternate;o=o!==null?o.memoizedState:null}else o=Ot.next;var r=Ft===null?yt.memoizedState:Ft.next;if(r!==null)Ft=r,Ot=o;else{if(o===null)throw Error(n(310));Ot=o,o={memoizedState:Ot.memoizedState,baseState:Ot.baseState,baseQueue:Ot.baseQueue,queue:Ot.queue,next:null},Ft===null?yt.memoizedState=Ft=o:Ft=Ft.next=o}return Ft}function Va(o,r){return typeof r=="function"?r(o):r}function nh(o){var r=ni(),d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var h=Ot,p=h.baseQueue,y=d.pending;if(y!==null){if(p!==null){var C=p.next;p.next=y.next,y.next=C}h.baseQueue=p=y,d.pending=null}if(p!==null){y=p.next,h=h.baseState;var O=C=null,F=null,Y=y;do{var te=Y.lane;if((fr&te)===te)F!==null&&(F=F.next={lane:0,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),h=Y.hasEagerState?Y.eagerState:o(h,Y.action);else{var ne={lane:te,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null};F===null?(O=F=ne,C=h):F=F.next=ne,yt.lanes|=te,hr|=te}Y=Y.next}while(Y!==null&&Y!==y);F===null?C=h:F.next=O,ui(h,r.memoizedState)||(_n=!0),r.memoizedState=h,r.baseState=C,r.baseQueue=F,d.lastRenderedState=h}if(o=d.interleaved,o!==null){p=o;do y=p.lane,yt.lanes|=y,hr|=y,p=p.next;while(p!==o)}else p===null&&(d.lanes=0);return[r.memoizedState,d.dispatch]}function ih(o){var r=ni(),d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var h=d.dispatch,p=d.pending,y=r.memoizedState;if(p!==null){d.pending=null;var C=p=p.next;do y=o(y,C.action),C=C.next;while(C!==p);ui(y,r.memoizedState)||(_n=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),d.lastRenderedState=y}return[y,h]}function P0(){}function D0(o,r){var d=yt,h=ni(),p=r(),y=!ui(h.memoizedState,p);if(y&&(h.memoizedState=p,_n=!0),h=h.queue,oh(O0.bind(null,d,h,o),[o]),h.getSnapshot!==r||y||Ft!==null&&Ft.memoizedState.tag&1){if(d.flags|=2048,Ka(9,N0.bind(null,d,h,p,r),void 0,null),Lt===null)throw Error(n(349));(fr&30)!==0||M0(d,r,p)}return p}function M0(o,r,d){o.flags|=16384,o={getSnapshot:r,value:d},r=yt.updateQueue,r===null?(r={lastEffect:null,stores:null},yt.updateQueue=r,r.stores=[o]):(d=r.stores,d===null?r.stores=[o]:d.push(o))}function N0(o,r,d,h){r.value=d,r.getSnapshot=h,b0(r)&&k0(o)}function O0(o,r,d){return d(function(){b0(r)&&k0(o)})}function b0(o){var r=o.getSnapshot;o=o.value;try{var d=r();return!ui(o,d)}catch{return!0}}function k0(o){var r=Yi(o,1);r!==null&&mi(r,o,1,-1)}function B0(o){var r=_i();return typeof o=="function"&&(o=o()),r.memoizedState=r.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Va,lastRenderedState:o},r.queue=o,o=o.dispatch=uC.bind(null,yt,o),[r.memoizedState,o]}function Ka(o,r,d,h){return o={tag:o,create:r,destroy:d,deps:h,next:null},r=yt.updateQueue,r===null?(r={lastEffect:null,stores:null},yt.updateQueue=r,r.lastEffect=o.next=o):(d=r.lastEffect,d===null?r.lastEffect=o.next=o:(h=d.next,d.next=o,o.next=h,r.lastEffect=o)),o}function F0(){return ni().memoizedState}function Xc(o,r,d,h){var p=_i();yt.flags|=o,p.memoizedState=Ka(1|r,d,void 0,h===void 0?null:h)}function Vc(o,r,d,h){var p=ni();h=h===void 0?null:h;var y=void 0;if(Ot!==null){var C=Ot.memoizedState;if(y=C.destroy,h!==null&&Jf(h,C.deps)){p.memoizedState=Ka(r,d,y,h);return}}yt.flags|=o,p.memoizedState=Ka(1|r,d,y,h)}function L0(o,r){return Xc(8390656,8,o,r)}function oh(o,r){return Vc(2048,8,o,r)}function H0(o,r){return Vc(4,2,o,r)}function U0(o,r){return Vc(4,4,o,r)}function G0(o,r){if(typeof r=="function")return o=o(),r(o),function(){r(null)};if(r!=null)return o=o(),r.current=o,function(){r.current=null}}function $0(o,r,d){return d=d!=null?d.concat([o]):null,Vc(4,4,G0.bind(null,r,o),d)}function rh(){}function W0(o,r){var d=ni();r=r===void 0?null:r;var h=d.memoizedState;return h!==null&&r!==null&&Jf(r,h[1])?h[0]:(d.memoizedState=[o,r],o)}function x0(o,r){var d=ni();r=r===void 0?null:r;var h=d.memoizedState;return h!==null&&r!==null&&Jf(r,h[1])?h[0]:(o=o(),d.memoizedState=[o,r],o)}function Y0(o,r,d){return(fr&21)===0?(o.baseState&&(o.baseState=!1,_n=!0),o.memoizedState=d):(ui(d,r)||(d=Im(),yt.lanes|=d,hr|=d,o.baseState=!0),r)}function cC(o,r){var d=nt;nt=d!==0&&4>d?d:4,o(!0);var h=Qf.transition;Qf.transition={};try{o(!1),r()}finally{nt=d,Qf.transition=h}}function z0(){return ni().memoizedState}function dC(o,r,d){var h=Mo(o);if(d={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null},j0(o))X0(r,d);else if(d=E0(o,r,d,h),d!==null){var p=un();mi(d,o,h,p),V0(d,r,h)}}function uC(o,r,d){var h=Mo(o),p={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null};if(j0(o))X0(r,p);else{var y=o.alternate;if(o.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var C=r.lastRenderedState,O=y(C,d);if(p.hasEagerState=!0,p.eagerState=O,ui(O,C)){var F=r.interleaved;F===null?(p.next=p,jf(r)):(p.next=F.next,F.next=p),r.interleaved=p;return}}catch{}finally{}d=E0(o,r,p,h),d!==null&&(p=un(),mi(d,o,h,p),V0(d,r,h))}}function j0(o){var r=o.alternate;return o===yt||r!==null&&r===yt}function X0(o,r){ja=jc=!0;var d=o.pending;d===null?r.next=r:(r.next=d.next,d.next=r),o.pending=r}function V0(o,r,d){if((d&4194240)!==0){var h=r.lanes;h&=o.pendingLanes,d|=h,r.lanes=d,af(o,d)}}var Kc={readContext:ti,useCallback:en,useContext:en,useEffect:en,useImperativeHandle:en,useInsertionEffect:en,useLayoutEffect:en,useMemo:en,useReducer:en,useRef:en,useState:en,useDebugValue:en,useDeferredValue:en,useTransition:en,useMutableSource:en,useSyncExternalStore:en,useId:en,unstable_isNewReconciler:!1},fC={readContext:ti,useCallback:function(o,r){return _i().memoizedState=[o,r===void 0?null:r],o},useContext:ti,useEffect:L0,useImperativeHandle:function(o,r,d){return d=d!=null?d.concat([o]):null,Xc(4194308,4,G0.bind(null,r,o),d)},useLayoutEffect:function(o,r){return Xc(4194308,4,o,r)},useInsertionEffect:function(o,r){return Xc(4,2,o,r)},useMemo:function(o,r){var d=_i();return r=r===void 0?null:r,o=o(),d.memoizedState=[o,r],o},useReducer:function(o,r,d){var h=_i();return r=d!==void 0?d(r):r,h.memoizedState=h.baseState=r,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:r},h.queue=o,o=o.dispatch=dC.bind(null,yt,o),[h.memoizedState,o]},useRef:function(o){var r=_i();return o={current:o},r.memoizedState=o},useState:B0,useDebugValue:rh,useDeferredValue:function(o){return _i().memoizedState=o},useTransition:function(){var o=B0(!1),r=o[0];return o=cC.bind(null,o[1]),_i().memoizedState=o,[r,o]},useMutableSource:function(){},useSyncExternalStore:function(o,r,d){var h=yt,p=_i();if(gt){if(d===void 0)throw Error(n(407));d=d()}else{if(d=r(),Lt===null)throw Error(n(349));(fr&30)!==0||M0(h,r,d)}p.memoizedState=d;var y={value:d,getSnapshot:r};return p.queue=y,L0(O0.bind(null,h,y,o),[o]),h.flags|=2048,Ka(9,N0.bind(null,h,y,d,r),void 0,null),d},useId:function(){var o=_i(),r=Lt.identifierPrefix;if(gt){var d=xi,h=Wi;d=(h&~(1<<32-di(h)-1)).toString(32)+d,r=":"+r+"R"+d,d=Xa++,0<d&&(r+="H"+d.toString(32)),r+=":"}else d=lC++,r=":"+r+"r"+d.toString(32)+":";return o.memoizedState=r},unstable_isNewReconciler:!1},hC={readContext:ti,useCallback:W0,useContext:ti,useEffect:oh,useImperativeHandle:$0,useInsertionEffect:H0,useLayoutEffect:U0,useMemo:x0,useReducer:nh,useRef:F0,useState:function(){return nh(Va)},useDebugValue:rh,useDeferredValue:function(o){var r=ni();return Y0(r,Ot.memoizedState,o)},useTransition:function(){var o=nh(Va)[0],r=ni().memoizedState;return[o,r]},useMutableSource:P0,useSyncExternalStore:D0,useId:z0,unstable_isNewReconciler:!1},gC={readContext:ti,useCallback:W0,useContext:ti,useEffect:oh,useImperativeHandle:$0,useInsertionEffect:H0,useLayoutEffect:U0,useMemo:x0,useReducer:ih,useRef:F0,useState:function(){return ih(Va)},useDebugValue:rh,useDeferredValue:function(o){var r=ni();return Ot===null?r.memoizedState=o:Y0(r,Ot.memoizedState,o)},useTransition:function(){var o=ih(Va)[0],r=ni().memoizedState;return[o,r]},useMutableSource:P0,useSyncExternalStore:D0,useId:z0,unstable_isNewReconciler:!1};function hi(o,r){if(o&&o.defaultProps){r=Z({},r),o=o.defaultProps;for(var d in o)r[d]===void 0&&(r[d]=o[d]);return r}return r}function sh(o,r,d,h){r=o.memoizedState,d=d(h,r),d=d==null?r:Z({},r,d),o.memoizedState=d,o.lanes===0&&(o.updateQueue.baseState=d)}var qc={isMounted:function(o){return(o=o._reactInternals)?rr(o)===o:!1},enqueueSetState:function(o,r,d){o=o._reactInternals;var h=un(),p=Mo(o),y=zi(h,p);y.payload=r,d!=null&&(y.callback=d),r=_o(o,y,p),r!==null&&(mi(r,o,p,h),Wc(r,o,p))},enqueueReplaceState:function(o,r,d){o=o._reactInternals;var h=un(),p=Mo(o),y=zi(h,p);y.tag=1,y.payload=r,d!=null&&(y.callback=d),r=_o(o,y,p),r!==null&&(mi(r,o,p,h),Wc(r,o,p))},enqueueForceUpdate:function(o,r){o=o._reactInternals;var d=un(),h=Mo(o),p=zi(d,h);p.tag=2,r!=null&&(p.callback=r),r=_o(o,p,h),r!==null&&(mi(r,o,h,d),Wc(r,o,h))}};function K0(o,r,d,h,p,y,C){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(h,y,C):r.prototype&&r.prototype.isPureReactComponent?!Ba(d,h)||!Ba(p,y):!0}function q0(o,r,d){var h=!1,p=Eo,y=r.contextType;return typeof y=="object"&&y!==null?y=ti(y):(p=wn(r)?ar:Jt.current,h=r.contextTypes,y=(h=h!=null)?cs(o,p):Eo),r=new r(d,y),o.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=qc,o.stateNode=r,r._reactInternals=o,h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=p,o.__reactInternalMemoizedMaskedChildContext=y),r}function Z0(o,r,d,h){o=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(d,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(d,h),r.state!==o&&qc.enqueueReplaceState(r,r.state,null)}function ah(o,r,d,h){var p=o.stateNode;p.props=d,p.state=o.memoizedState,p.refs={},Xf(o);var y=r.contextType;typeof y=="object"&&y!==null?p.context=ti(y):(y=wn(r)?ar:Jt.current,p.context=cs(o,y)),p.state=o.memoizedState,y=r.getDerivedStateFromProps,typeof y=="function"&&(sh(o,r,y,d),p.state=o.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(r=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),r!==p.state&&qc.enqueueReplaceState(p,p.state,null),xc(o,d,p,h),p.state=o.memoizedState),typeof p.componentDidMount=="function"&&(o.flags|=4194308)}function ys(o,r){try{var d="",h=r;do d+=Me(h),h=h.return;while(h);var p=d}catch(y){p=`
Error generating stack: `+y.message+`
`+y.stack}return{value:o,source:r,stack:p,digest:null}}function lh(o,r,d){return{value:o,source:null,stack:d??null,digest:r??null}}function ch(o,r){try{console.error(r.value)}catch(d){setTimeout(function(){throw d})}}var pC=typeof WeakMap=="function"?WeakMap:Map;function Q0(o,r,d){d=zi(-1,d),d.tag=3,d.payload={element:null};var h=r.value;return d.callback=function(){id||(id=!0,Ch=h),ch(o,r)},d}function J0(o,r,d){d=zi(-1,d),d.tag=3;var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var p=r.value;d.payload=function(){return h(p)},d.callback=function(){ch(o,r)}}var y=o.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(d.callback=function(){ch(o,r),typeof h!="function"&&(Po===null?Po=new Set([this]):Po.add(this));var C=r.stack;this.componentDidCatch(r.value,{componentStack:C!==null?C:""})}),d}function ey(o,r,d){var h=o.pingCache;if(h===null){h=o.pingCache=new pC;var p=new Set;h.set(r,p)}else p=h.get(r),p===void 0&&(p=new Set,h.set(r,p));p.has(d)||(p.add(d),o=DC.bind(null,o,r,d),r.then(o,o))}function ty(o){do{var r;if((r=o.tag===13)&&(r=o.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return o;o=o.return}while(o!==null);return null}function ny(o,r,d,h,p){return(o.mode&1)===0?(o===r?o.flags|=65536:(o.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(r=zi(-1,1),r.tag=2,_o(d,r,1))),d.lanes|=1),o):(o.flags|=65536,o.lanes=p,o)}var mC=b.ReactCurrentOwner,_n=!1;function dn(o,r,d,h){r.child=o===null?T0(r,null,d,h):hs(r,o.child,d,h)}function iy(o,r,d,h,p){d=d.render;var y=r.ref;return ps(r,p),h=eh(o,r,d,h,y,p),d=th(),o!==null&&!_n?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,ji(o,r,p)):(gt&&d&&Lf(r),r.flags|=1,dn(o,r,h,p),r.child)}function oy(o,r,d,h,p){if(o===null){var y=d.type;return typeof y=="function"&&!Nh(y)&&y.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(r.tag=15,r.type=y,ry(o,r,y,h,p)):(o=cd(d.type,null,h,r,r.mode,p),o.ref=r.ref,o.return=r,r.child=o)}if(y=o.child,(o.lanes&p)===0){var C=y.memoizedProps;if(d=d.compare,d=d!==null?d:Ba,d(C,h)&&o.ref===r.ref)return ji(o,r,p)}return r.flags|=1,o=Oo(y,h),o.ref=r.ref,o.return=r,r.child=o}function ry(o,r,d,h,p){if(o!==null){var y=o.memoizedProps;if(Ba(y,h)&&o.ref===r.ref)if(_n=!1,r.pendingProps=h=y,(o.lanes&p)!==0)(o.flags&131072)!==0&&(_n=!0);else return r.lanes=o.lanes,ji(o,r,p)}return dh(o,r,d,h,p)}function sy(o,r,d){var h=r.pendingProps,p=h.children,y=o!==null?o.memoizedState:null;if(h.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},at(vs,Hn),Hn|=d;else{if((d&1073741824)===0)return o=y!==null?y.baseLanes|d:d,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:o,cachePool:null,transitions:null},r.updateQueue=null,at(vs,Hn),Hn|=o,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=y!==null?y.baseLanes:d,at(vs,Hn),Hn|=h}else y!==null?(h=y.baseLanes|d,r.memoizedState=null):h=d,at(vs,Hn),Hn|=h;return dn(o,r,p,d),r.child}function ay(o,r){var d=r.ref;(o===null&&d!==null||o!==null&&o.ref!==d)&&(r.flags|=512,r.flags|=2097152)}function dh(o,r,d,h,p){var y=wn(d)?ar:Jt.current;return y=cs(r,y),ps(r,p),d=eh(o,r,d,h,y,p),h=th(),o!==null&&!_n?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,ji(o,r,p)):(gt&&h&&Lf(r),r.flags|=1,dn(o,r,d,p),r.child)}function ly(o,r,d,h,p){if(wn(d)){var y=!0;kc(r)}else y=!1;if(ps(r,p),r.stateNode===null)Qc(o,r),q0(r,d,h),ah(r,d,h,p),h=!0;else if(o===null){var C=r.stateNode,O=r.memoizedProps;C.props=O;var F=C.context,Y=d.contextType;typeof Y=="object"&&Y!==null?Y=ti(Y):(Y=wn(d)?ar:Jt.current,Y=cs(r,Y));var te=d.getDerivedStateFromProps,ne=typeof te=="function"||typeof C.getSnapshotBeforeUpdate=="function";ne||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(O!==h||F!==Y)&&Z0(r,C,h,Y),wo=!1;var J=r.memoizedState;C.state=J,xc(r,h,C,p),F=r.memoizedState,O!==h||J!==F||Cn.current||wo?(typeof te=="function"&&(sh(r,d,te,h),F=r.memoizedState),(O=wo||K0(r,d,O,h,J,F,Y))?(ne||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(r.flags|=4194308)):(typeof C.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=F),C.props=h,C.state=F,C.context=Y,h=O):(typeof C.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{C=r.stateNode,C0(o,r),O=r.memoizedProps,Y=r.type===r.elementType?O:hi(r.type,O),C.props=Y,ne=r.pendingProps,J=C.context,F=d.contextType,typeof F=="object"&&F!==null?F=ti(F):(F=wn(d)?ar:Jt.current,F=cs(r,F));var ye=d.getDerivedStateFromProps;(te=typeof ye=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(O!==ne||J!==F)&&Z0(r,C,h,F),wo=!1,J=r.memoizedState,C.state=J,xc(r,h,C,p);var Te=r.memoizedState;O!==ne||J!==Te||Cn.current||wo?(typeof ye=="function"&&(sh(r,d,ye,h),Te=r.memoizedState),(Y=wo||K0(r,d,Y,h,J,Te,F)||!1)?(te||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(h,Te,F),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(h,Te,F)),typeof C.componentDidUpdate=="function"&&(r.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof C.componentDidUpdate!="function"||O===o.memoizedProps&&J===o.memoizedState||(r.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||O===o.memoizedProps&&J===o.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=Te),C.props=h,C.state=Te,C.context=F,h=Y):(typeof C.componentDidUpdate!="function"||O===o.memoizedProps&&J===o.memoizedState||(r.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||O===o.memoizedProps&&J===o.memoizedState||(r.flags|=1024),h=!1)}return uh(o,r,d,h,y,p)}function uh(o,r,d,h,p,y){ay(o,r);var C=(r.flags&128)!==0;if(!h&&!C)return p&&h0(r,d,!1),ji(o,r,y);h=r.stateNode,mC.current=r;var O=C&&typeof d.getDerivedStateFromError!="function"?null:h.render();return r.flags|=1,o!==null&&C?(r.child=hs(r,o.child,null,y),r.child=hs(r,null,O,y)):dn(o,r,O,y),r.memoizedState=h.state,p&&h0(r,d,!0),r.child}function cy(o){var r=o.stateNode;r.pendingContext?u0(o,r.pendingContext,r.pendingContext!==r.context):r.context&&u0(o,r.context,!1),Vf(o,r.containerInfo)}function dy(o,r,d,h,p){return fs(),$f(p),r.flags|=256,dn(o,r,d,h),r.child}var fh={dehydrated:null,treeContext:null,retryLane:0};function hh(o){return{baseLanes:o,cachePool:null,transitions:null}}function uy(o,r,d){var h=r.pendingProps,p=mt.current,y=!1,C=(r.flags&128)!==0,O;if((O=C)||(O=o!==null&&o.memoizedState===null?!1:(p&2)!==0),O?(y=!0,r.flags&=-129):(o===null||o.memoizedState!==null)&&(p|=1),at(mt,p&1),o===null)return Gf(r),o=r.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((r.mode&1)===0?r.lanes=1:o.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(C=h.children,o=h.fallback,y?(h=r.mode,y=r.child,C={mode:"hidden",children:C},(h&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=C):y=dd(C,h,0,null),o=yr(o,h,d,null),y.return=r,o.return=r,y.sibling=o,r.child=y,r.child.memoizedState=hh(d),r.memoizedState=fh,o):gh(r,C));if(p=o.memoizedState,p!==null&&(O=p.dehydrated,O!==null))return yC(o,r,C,h,O,p,d);if(y){y=h.fallback,C=r.mode,p=o.child,O=p.sibling;var F={mode:"hidden",children:h.children};return(C&1)===0&&r.child!==p?(h=r.child,h.childLanes=0,h.pendingProps=F,r.deletions=null):(h=Oo(p,F),h.subtreeFlags=p.subtreeFlags&14680064),O!==null?y=Oo(O,y):(y=yr(y,C,d,null),y.flags|=2),y.return=r,h.return=r,h.sibling=y,r.child=h,h=y,y=r.child,C=o.child.memoizedState,C=C===null?hh(d):{baseLanes:C.baseLanes|d,cachePool:null,transitions:C.transitions},y.memoizedState=C,y.childLanes=o.childLanes&~d,r.memoizedState=fh,h}return y=o.child,o=y.sibling,h=Oo(y,{mode:"visible",children:h.children}),(r.mode&1)===0&&(h.lanes=d),h.return=r,h.sibling=null,o!==null&&(d=r.deletions,d===null?(r.deletions=[o],r.flags|=16):d.push(o)),r.child=h,r.memoizedState=null,h}function gh(o,r){return r=dd({mode:"visible",children:r},o.mode,0,null),r.return=o,o.child=r}function Zc(o,r,d,h){return h!==null&&$f(h),hs(r,o.child,null,d),o=gh(r,r.pendingProps.children),o.flags|=2,r.memoizedState=null,o}function yC(o,r,d,h,p,y,C){if(d)return r.flags&256?(r.flags&=-257,h=lh(Error(n(422))),Zc(o,r,C,h)):r.memoizedState!==null?(r.child=o.child,r.flags|=128,null):(y=h.fallback,p=r.mode,h=dd({mode:"visible",children:h.children},p,0,null),y=yr(y,p,C,null),y.flags|=2,h.return=r,y.return=r,h.sibling=y,r.child=h,(r.mode&1)!==0&&hs(r,o.child,null,C),r.child.memoizedState=hh(C),r.memoizedState=fh,y);if((r.mode&1)===0)return Zc(o,r,C,null);if(p.data==="$!"){if(h=p.nextSibling&&p.nextSibling.dataset,h)var O=h.dgst;return h=O,y=Error(n(419)),h=lh(y,h,void 0),Zc(o,r,C,h)}if(O=(C&o.childLanes)!==0,_n||O){if(h=Lt,h!==null){switch(C&-C){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=(p&(h.suspendedLanes|C))!==0?0:p,p!==0&&p!==y.retryLane&&(y.retryLane=p,Yi(o,p),mi(h,o,p,-1))}return Mh(),h=lh(Error(n(421))),Zc(o,r,C,h)}return p.data==="$?"?(r.flags|=128,r.child=o.child,r=MC.bind(null,o),p._reactRetry=r,null):(o=y.treeContext,Ln=Ao(p.nextSibling),Fn=r,gt=!0,fi=null,o!==null&&(Jn[ei++]=Wi,Jn[ei++]=xi,Jn[ei++]=lr,Wi=o.id,xi=o.overflow,lr=r),r=gh(r,h.children),r.flags|=4096,r)}function fy(o,r,d){o.lanes|=r;var h=o.alternate;h!==null&&(h.lanes|=r),zf(o.return,r,d)}function ph(o,r,d,h,p){var y=o.memoizedState;y===null?o.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:d,tailMode:p}:(y.isBackwards=r,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=d,y.tailMode=p)}function hy(o,r,d){var h=r.pendingProps,p=h.revealOrder,y=h.tail;if(dn(o,r,h.children,d),h=mt.current,(h&2)!==0)h=h&1|2,r.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=r.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&fy(o,d,r);else if(o.tag===19)fy(o,d,r);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}h&=1}if(at(mt,h),(r.mode&1)===0)r.memoizedState=null;else switch(p){case"forwards":for(d=r.child,p=null;d!==null;)o=d.alternate,o!==null&&Yc(o)===null&&(p=d),d=d.sibling;d=p,d===null?(p=r.child,r.child=null):(p=d.sibling,d.sibling=null),ph(r,!1,p,d,y);break;case"backwards":for(d=null,p=r.child,r.child=null;p!==null;){if(o=p.alternate,o!==null&&Yc(o)===null){r.child=p;break}o=p.sibling,p.sibling=d,d=p,p=o}ph(r,!0,d,null,y);break;case"together":ph(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Qc(o,r){(r.mode&1)===0&&o!==null&&(o.alternate=null,r.alternate=null,r.flags|=2)}function ji(o,r,d){if(o!==null&&(r.dependencies=o.dependencies),hr|=r.lanes,(d&r.childLanes)===0)return null;if(o!==null&&r.child!==o.child)throw Error(n(153));if(r.child!==null){for(o=r.child,d=Oo(o,o.pendingProps),r.child=d,d.return=r;o.sibling!==null;)o=o.sibling,d=d.sibling=Oo(o,o.pendingProps),d.return=r;d.sibling=null}return r.child}function SC(o,r,d){switch(r.tag){case 3:cy(r),fs();break;case 5:R0(r);break;case 1:wn(r.type)&&kc(r);break;case 4:Vf(r,r.stateNode.containerInfo);break;case 10:var h=r.type._context,p=r.memoizedProps.value;at(Gc,h._currentValue),h._currentValue=p;break;case 13:if(h=r.memoizedState,h!==null)return h.dehydrated!==null?(at(mt,mt.current&1),r.flags|=128,null):(d&r.child.childLanes)!==0?uy(o,r,d):(at(mt,mt.current&1),o=ji(o,r,d),o!==null?o.sibling:null);at(mt,mt.current&1);break;case 19:if(h=(d&r.childLanes)!==0,(o.flags&128)!==0){if(h)return hy(o,r,d);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),at(mt,mt.current),h)break;return null;case 22:case 23:return r.lanes=0,sy(o,r,d)}return ji(o,r,d)}var gy,mh,py,my;gy=function(o,r){for(var d=r.child;d!==null;){if(d.tag===5||d.tag===6)o.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break;for(;d.sibling===null;){if(d.return===null||d.return===r)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},mh=function(){},py=function(o,r,d,h){var p=o.memoizedProps;if(p!==h){o=r.stateNode,ur(wi.current);var y=null;switch(d){case"input":p=Je(o,p),h=Je(o,h),y=[];break;case"select":p=Z({},p,{value:void 0}),h=Z({},h,{value:void 0}),y=[];break;case"textarea":p=or(o,p),h=or(o,h),y=[];break;default:typeof p.onClick!="function"&&typeof h.onClick=="function"&&(o.onclick=Nc)}Ku(d,h);var C;d=null;for(Y in p)if(!h.hasOwnProperty(Y)&&p.hasOwnProperty(Y)&&p[Y]!=null)if(Y==="style"){var O=p[Y];for(C in O)O.hasOwnProperty(C)&&(d||(d={}),d[C]="")}else Y!=="dangerouslySetInnerHTML"&&Y!=="children"&&Y!=="suppressContentEditableWarning"&&Y!=="suppressHydrationWarning"&&Y!=="autoFocus"&&(s.hasOwnProperty(Y)?y||(y=[]):(y=y||[]).push(Y,null));for(Y in h){var F=h[Y];if(O=p!=null?p[Y]:void 0,h.hasOwnProperty(Y)&&F!==O&&(F!=null||O!=null))if(Y==="style")if(O){for(C in O)!O.hasOwnProperty(C)||F&&F.hasOwnProperty(C)||(d||(d={}),d[C]="");for(C in F)F.hasOwnProperty(C)&&O[C]!==F[C]&&(d||(d={}),d[C]=F[C])}else d||(y||(y=[]),y.push(Y,d)),d=F;else Y==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,O=O?O.__html:void 0,F!=null&&O!==F&&(y=y||[]).push(Y,F)):Y==="children"?typeof F!="string"&&typeof F!="number"||(y=y||[]).push(Y,""+F):Y!=="suppressContentEditableWarning"&&Y!=="suppressHydrationWarning"&&(s.hasOwnProperty(Y)?(F!=null&&Y==="onScroll"&&lt("scroll",o),y||O===F||(y=[])):(y=y||[]).push(Y,F))}d&&(y=y||[]).push("style",d);var Y=y;(r.updateQueue=Y)&&(r.flags|=4)}},my=function(o,r,d,h){d!==h&&(r.flags|=4)};function qa(o,r){if(!gt)switch(o.tailMode){case"hidden":r=o.tail;for(var d=null;r!==null;)r.alternate!==null&&(d=r),r=r.sibling;d===null?o.tail=null:d.sibling=null;break;case"collapsed":d=o.tail;for(var h=null;d!==null;)d.alternate!==null&&(h=d),d=d.sibling;h===null?r||o.tail===null?o.tail=null:o.tail.sibling=null:h.sibling=null}}function tn(o){var r=o.alternate!==null&&o.alternate.child===o.child,d=0,h=0;if(r)for(var p=o.child;p!==null;)d|=p.lanes|p.childLanes,h|=p.subtreeFlags&14680064,h|=p.flags&14680064,p.return=o,p=p.sibling;else for(p=o.child;p!==null;)d|=p.lanes|p.childLanes,h|=p.subtreeFlags,h|=p.flags,p.return=o,p=p.sibling;return o.subtreeFlags|=h,o.childLanes=d,r}function vC(o,r,d){var h=r.pendingProps;switch(Hf(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return tn(r),null;case 1:return wn(r.type)&&bc(),tn(r),null;case 3:return h=r.stateNode,ms(),ct(Cn),ct(Jt),Zf(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(Hc(r)?r.flags|=4:o===null||o.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,fi!==null&&(Rh(fi),fi=null))),mh(o,r),tn(r),null;case 5:Kf(r);var p=ur(za.current);if(d=r.type,o!==null&&r.stateNode!=null)py(o,r,d,h,p),o.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!h){if(r.stateNode===null)throw Error(n(166));return tn(r),null}if(o=ur(wi.current),Hc(r)){h=r.stateNode,d=r.type;var y=r.memoizedProps;switch(h[Ci]=r,h[Ga]=y,o=(r.mode&1)!==0,d){case"dialog":lt("cancel",h),lt("close",h);break;case"iframe":case"object":case"embed":lt("load",h);break;case"video":case"audio":for(p=0;p<La.length;p++)lt(La[p],h);break;case"source":lt("error",h);break;case"img":case"image":case"link":lt("error",h),lt("load",h);break;case"details":lt("toggle",h);break;case"input":st(h,y),lt("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!y.multiple},lt("invalid",h);break;case"textarea":Jp(h,y),lt("invalid",h)}Ku(d,y),p=null;for(var C in y)if(y.hasOwnProperty(C)){var O=y[C];C==="children"?typeof O=="string"?h.textContent!==O&&(y.suppressHydrationWarning!==!0&&Mc(h.textContent,O,o),p=["children",O]):typeof O=="number"&&h.textContent!==""+O&&(y.suppressHydrationWarning!==!0&&Mc(h.textContent,O,o),p=["children",""+O]):s.hasOwnProperty(C)&&O!=null&&C==="onScroll"&&lt("scroll",h)}switch(d){case"input":Ge(h),Qn(h,y,!0);break;case"textarea":Ge(h),tm(h);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(h.onclick=Nc)}h=p,r.updateQueue=h,h!==null&&(r.flags|=4)}else{C=p.nodeType===9?p:p.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=nm(d)),o==="http://www.w3.org/1999/xhtml"?d==="script"?(o=C.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof h.is=="string"?o=C.createElement(d,{is:h.is}):(o=C.createElement(d),d==="select"&&(C=o,h.multiple?C.multiple=!0:h.size&&(C.size=h.size))):o=C.createElementNS(o,d),o[Ci]=r,o[Ga]=h,gy(o,r,!1,!1),r.stateNode=o;e:{switch(C=qu(d,h),d){case"dialog":lt("cancel",o),lt("close",o),p=h;break;case"iframe":case"object":case"embed":lt("load",o),p=h;break;case"video":case"audio":for(p=0;p<La.length;p++)lt(La[p],o);p=h;break;case"source":lt("error",o),p=h;break;case"img":case"image":case"link":lt("error",o),lt("load",o),p=h;break;case"details":lt("toggle",o),p=h;break;case"input":st(o,h),p=Je(o,h),lt("invalid",o);break;case"option":p=h;break;case"select":o._wrapperState={wasMultiple:!!h.multiple},p=Z({},h,{value:void 0}),lt("invalid",o);break;case"textarea":Jp(o,h),p=or(o,h),lt("invalid",o);break;default:p=h}Ku(d,p),O=p;for(y in O)if(O.hasOwnProperty(y)){var F=O[y];y==="style"?rm(o,F):y==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,F!=null&&im(o,F)):y==="children"?typeof F=="string"?(d!=="textarea"||F!=="")&&Sa(o,F):typeof F=="number"&&Sa(o,""+F):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?F!=null&&y==="onScroll"&&lt("scroll",o):F!=null&&_(o,y,F,C))}switch(d){case"input":Ge(o),Qn(o,h,!1);break;case"textarea":Ge(o),tm(o);break;case"option":h.value!=null&&o.setAttribute("value",""+Re(h.value));break;case"select":o.multiple=!!h.multiple,y=h.value,y!=null?go(o,!!h.multiple,y,!1):h.defaultValue!=null&&go(o,!!h.multiple,h.defaultValue,!0);break;default:typeof p.onClick=="function"&&(o.onclick=Nc)}switch(d){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return tn(r),null;case 6:if(o&&r.stateNode!=null)my(o,r,o.memoizedProps,h);else{if(typeof h!="string"&&r.stateNode===null)throw Error(n(166));if(d=ur(za.current),ur(wi.current),Hc(r)){if(h=r.stateNode,d=r.memoizedProps,h[Ci]=r,(y=h.nodeValue!==d)&&(o=Fn,o!==null))switch(o.tag){case 3:Mc(h.nodeValue,d,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&Mc(h.nodeValue,d,(o.mode&1)!==0)}y&&(r.flags|=4)}else h=(d.nodeType===9?d:d.ownerDocument).createTextNode(h),h[Ci]=r,r.stateNode=h}return tn(r),null;case 13:if(ct(mt),h=r.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(gt&&Ln!==null&&(r.mode&1)!==0&&(r.flags&128)===0)v0(),fs(),r.flags|=98560,y=!1;else if(y=Hc(r),h!==null&&h.dehydrated!==null){if(o===null){if(!y)throw Error(n(318));if(y=r.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[Ci]=r}else fs(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;tn(r),y=!1}else fi!==null&&(Rh(fi),fi=null),y=!0;if(!y)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=d,r):(h=h!==null,h!==(o!==null&&o.memoizedState!==null)&&h&&(r.child.flags|=8192,(r.mode&1)!==0&&(o===null||(mt.current&1)!==0?bt===0&&(bt=3):Mh())),r.updateQueue!==null&&(r.flags|=4),tn(r),null);case 4:return ms(),mh(o,r),o===null&&Ha(r.stateNode.containerInfo),tn(r),null;case 10:return Yf(r.type._context),tn(r),null;case 17:return wn(r.type)&&bc(),tn(r),null;case 19:if(ct(mt),y=r.memoizedState,y===null)return tn(r),null;if(h=(r.flags&128)!==0,C=y.rendering,C===null)if(h)qa(y,!1);else{if(bt!==0||o!==null&&(o.flags&128)!==0)for(o=r.child;o!==null;){if(C=Yc(o),C!==null){for(r.flags|=128,qa(y,!1),h=C.updateQueue,h!==null&&(r.updateQueue=h,r.flags|=4),r.subtreeFlags=0,h=d,d=r.child;d!==null;)y=d,o=h,y.flags&=14680066,C=y.alternate,C===null?(y.childLanes=0,y.lanes=o,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=C.childLanes,y.lanes=C.lanes,y.child=C.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=C.memoizedProps,y.memoizedState=C.memoizedState,y.updateQueue=C.updateQueue,y.type=C.type,o=C.dependencies,y.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),d=d.sibling;return at(mt,mt.current&1|2),r.child}o=o.sibling}y.tail!==null&&Et()>Is&&(r.flags|=128,h=!0,qa(y,!1),r.lanes=4194304)}else{if(!h)if(o=Yc(C),o!==null){if(r.flags|=128,h=!0,d=o.updateQueue,d!==null&&(r.updateQueue=d,r.flags|=4),qa(y,!0),y.tail===null&&y.tailMode==="hidden"&&!C.alternate&&!gt)return tn(r),null}else 2*Et()-y.renderingStartTime>Is&&d!==1073741824&&(r.flags|=128,h=!0,qa(y,!1),r.lanes=4194304);y.isBackwards?(C.sibling=r.child,r.child=C):(d=y.last,d!==null?d.sibling=C:r.child=C,y.last=C)}return y.tail!==null?(r=y.tail,y.rendering=r,y.tail=r.sibling,y.renderingStartTime=Et(),r.sibling=null,d=mt.current,at(mt,h?d&1|2:d&1),r):(tn(r),null);case 22:case 23:return Dh(),h=r.memoizedState!==null,o!==null&&o.memoizedState!==null!==h&&(r.flags|=8192),h&&(r.mode&1)!==0?(Hn&1073741824)!==0&&(tn(r),r.subtreeFlags&6&&(r.flags|=8192)):tn(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function IC(o,r){switch(Hf(r),r.tag){case 1:return wn(r.type)&&bc(),o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 3:return ms(),ct(Cn),ct(Jt),Zf(),o=r.flags,(o&65536)!==0&&(o&128)===0?(r.flags=o&-65537|128,r):null;case 5:return Kf(r),null;case 13:if(ct(mt),o=r.memoizedState,o!==null&&o.dehydrated!==null){if(r.alternate===null)throw Error(n(340));fs()}return o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 19:return ct(mt),null;case 4:return ms(),null;case 10:return Yf(r.type._context),null;case 22:case 23:return Dh(),null;case 24:return null;default:return null}}var Jc=!1,nn=!1,AC=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function Ss(o,r){var d=o.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(h){It(o,r,h)}else d.current=null}function yh(o,r,d){try{d()}catch(h){It(o,r,h)}}var yy=!1;function TC(o,r){if(Df=vc,o=Km(),Af(o)){if("selectionStart"in o)var d={start:o.selectionStart,end:o.selectionEnd};else e:{d=(d=o.ownerDocument)&&d.defaultView||window;var h=d.getSelection&&d.getSelection();if(h&&h.rangeCount!==0){d=h.anchorNode;var p=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{d.nodeType,y.nodeType}catch{d=null;break e}var C=0,O=-1,F=-1,Y=0,te=0,ne=o,J=null;t:for(;;){for(var ye;ne!==d||p!==0&&ne.nodeType!==3||(O=C+p),ne!==y||h!==0&&ne.nodeType!==3||(F=C+h),ne.nodeType===3&&(C+=ne.nodeValue.length),(ye=ne.firstChild)!==null;)J=ne,ne=ye;for(;;){if(ne===o)break t;if(J===d&&++Y===p&&(O=C),J===y&&++te===h&&(F=C),(ye=ne.nextSibling)!==null)break;ne=J,J=ne.parentNode}ne=ye}d=O===-1||F===-1?null:{start:O,end:F}}else d=null}d=d||{start:0,end:0}}else d=null;for(Mf={focusedElem:o,selectionRange:d},vc=!1,Ie=r;Ie!==null;)if(r=Ie,o=r.child,(r.subtreeFlags&1028)!==0&&o!==null)o.return=r,Ie=o;else for(;Ie!==null;){r=Ie;try{var Te=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(Te!==null){var we=Te.memoizedProps,Ct=Te.memoizedState,$=r.stateNode,H=$.getSnapshotBeforeUpdate(r.elementType===r.type?we:hi(r.type,we),Ct);$.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var W=r.stateNode.containerInfo;W.nodeType===1?W.textContent="":W.nodeType===9&&W.documentElement&&W.removeChild(W.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(re){It(r,r.return,re)}if(o=r.sibling,o!==null){o.return=r.return,Ie=o;break}Ie=r.return}return Te=yy,yy=!1,Te}function Za(o,r,d){var h=r.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var p=h=h.next;do{if((p.tag&o)===o){var y=p.destroy;p.destroy=void 0,y!==void 0&&yh(r,d,y)}p=p.next}while(p!==h)}}function ed(o,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var d=r=r.next;do{if((d.tag&o)===o){var h=d.create;d.destroy=h()}d=d.next}while(d!==r)}}function Sh(o){var r=o.ref;if(r!==null){var d=o.stateNode;switch(o.tag){case 5:o=d;break;default:o=d}typeof r=="function"?r(o):r.current=o}}function Sy(o){var r=o.alternate;r!==null&&(o.alternate=null,Sy(r)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(r=o.stateNode,r!==null&&(delete r[Ci],delete r[Ga],delete r[kf],delete r[oC],delete r[rC])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function vy(o){return o.tag===5||o.tag===3||o.tag===4}function Iy(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||vy(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function vh(o,r,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?d.nodeType===8?d.parentNode.insertBefore(o,r):d.insertBefore(o,r):(d.nodeType===8?(r=d.parentNode,r.insertBefore(o,d)):(r=d,r.appendChild(o)),d=d._reactRootContainer,d!=null||r.onclick!==null||(r.onclick=Nc));else if(h!==4&&(o=o.child,o!==null))for(vh(o,r,d),o=o.sibling;o!==null;)vh(o,r,d),o=o.sibling}function Ih(o,r,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?d.insertBefore(o,r):d.appendChild(o);else if(h!==4&&(o=o.child,o!==null))for(Ih(o,r,d),o=o.sibling;o!==null;)Ih(o,r,d),o=o.sibling}var xt=null,gi=!1;function Ro(o,r,d){for(d=d.child;d!==null;)Ay(o,r,d),d=d.sibling}function Ay(o,r,d){if(Ei&&typeof Ei.onCommitFiberUnmount=="function")try{Ei.onCommitFiberUnmount(hc,d)}catch{}switch(d.tag){case 5:nn||Ss(d,r);case 6:var h=xt,p=gi;xt=null,Ro(o,r,d),xt=h,gi=p,xt!==null&&(gi?(o=xt,d=d.stateNode,o.nodeType===8?o.parentNode.removeChild(d):o.removeChild(d)):xt.removeChild(d.stateNode));break;case 18:xt!==null&&(gi?(o=xt,d=d.stateNode,o.nodeType===8?bf(o.parentNode,d):o.nodeType===1&&bf(o,d),Da(o)):bf(xt,d.stateNode));break;case 4:h=xt,p=gi,xt=d.stateNode.containerInfo,gi=!0,Ro(o,r,d),xt=h,gi=p;break;case 0:case 11:case 14:case 15:if(!nn&&(h=d.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){p=h=h.next;do{var y=p,C=y.destroy;y=y.tag,C!==void 0&&((y&2)!==0||(y&4)!==0)&&yh(d,r,C),p=p.next}while(p!==h)}Ro(o,r,d);break;case 1:if(!nn&&(Ss(d,r),h=d.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=d.memoizedProps,h.state=d.memoizedState,h.componentWillUnmount()}catch(O){It(d,r,O)}Ro(o,r,d);break;case 21:Ro(o,r,d);break;case 22:d.mode&1?(nn=(h=nn)||d.memoizedState!==null,Ro(o,r,d),nn=h):Ro(o,r,d);break;default:Ro(o,r,d)}}function Ty(o){var r=o.updateQueue;if(r!==null){o.updateQueue=null;var d=o.stateNode;d===null&&(d=o.stateNode=new AC),r.forEach(function(h){var p=NC.bind(null,o,h);d.has(h)||(d.add(h),h.then(p,p))})}}function pi(o,r){var d=r.deletions;if(d!==null)for(var h=0;h<d.length;h++){var p=d[h];try{var y=o,C=r,O=C;e:for(;O!==null;){switch(O.tag){case 5:xt=O.stateNode,gi=!1;break e;case 3:xt=O.stateNode.containerInfo,gi=!0;break e;case 4:xt=O.stateNode.containerInfo,gi=!0;break e}O=O.return}if(xt===null)throw Error(n(160));Ay(y,C,p),xt=null,gi=!1;var F=p.alternate;F!==null&&(F.return=null),p.return=null}catch(Y){It(p,r,Y)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)Ey(r,o),r=r.sibling}function Ey(o,r){var d=o.alternate,h=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(pi(r,o),Ri(o),h&4){try{Za(3,o,o.return),ed(3,o)}catch(we){It(o,o.return,we)}try{Za(5,o,o.return)}catch(we){It(o,o.return,we)}}break;case 1:pi(r,o),Ri(o),h&512&&d!==null&&Ss(d,d.return);break;case 5:if(pi(r,o),Ri(o),h&512&&d!==null&&Ss(d,d.return),o.flags&32){var p=o.stateNode;try{Sa(p,"")}catch(we){It(o,o.return,we)}}if(h&4&&(p=o.stateNode,p!=null)){var y=o.memoizedProps,C=d!==null?d.memoizedProps:y,O=o.type,F=o.updateQueue;if(o.updateQueue=null,F!==null)try{O==="input"&&y.type==="radio"&&y.name!=null&&Zn(p,y),qu(O,C);var Y=qu(O,y);for(C=0;C<F.length;C+=2){var te=F[C],ne=F[C+1];te==="style"?rm(p,ne):te==="dangerouslySetInnerHTML"?im(p,ne):te==="children"?Sa(p,ne):_(p,te,ne,Y)}switch(O){case"input":En(p,y);break;case"textarea":em(p,y);break;case"select":var J=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!y.multiple;var ye=y.value;ye!=null?go(p,!!y.multiple,ye,!1):J!==!!y.multiple&&(y.defaultValue!=null?go(p,!!y.multiple,y.defaultValue,!0):go(p,!!y.multiple,y.multiple?[]:"",!1))}p[Ga]=y}catch(we){It(o,o.return,we)}}break;case 6:if(pi(r,o),Ri(o),h&4){if(o.stateNode===null)throw Error(n(162));p=o.stateNode,y=o.memoizedProps;try{p.nodeValue=y}catch(we){It(o,o.return,we)}}break;case 3:if(pi(r,o),Ri(o),h&4&&d!==null&&d.memoizedState.isDehydrated)try{Da(r.containerInfo)}catch(we){It(o,o.return,we)}break;case 4:pi(r,o),Ri(o);break;case 13:pi(r,o),Ri(o),p=o.child,p.flags&8192&&(y=p.memoizedState!==null,p.stateNode.isHidden=y,!y||p.alternate!==null&&p.alternate.memoizedState!==null||(Eh=Et())),h&4&&Ty(o);break;case 22:if(te=d!==null&&d.memoizedState!==null,o.mode&1?(nn=(Y=nn)||te,pi(r,o),nn=Y):pi(r,o),Ri(o),h&8192){if(Y=o.memoizedState!==null,(o.stateNode.isHidden=Y)&&!te&&(o.mode&1)!==0)for(Ie=o,te=o.child;te!==null;){for(ne=Ie=te;Ie!==null;){switch(J=Ie,ye=J.child,J.tag){case 0:case 11:case 14:case 15:Za(4,J,J.return);break;case 1:Ss(J,J.return);var Te=J.stateNode;if(typeof Te.componentWillUnmount=="function"){h=J,d=J.return;try{r=h,Te.props=r.memoizedProps,Te.state=r.memoizedState,Te.componentWillUnmount()}catch(we){It(h,d,we)}}break;case 5:Ss(J,J.return);break;case 22:if(J.memoizedState!==null){_y(ne);continue}}ye!==null?(ye.return=J,Ie=ye):_y(ne)}te=te.sibling}e:for(te=null,ne=o;;){if(ne.tag===5){if(te===null){te=ne;try{p=ne.stateNode,Y?(y=p.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(O=ne.stateNode,F=ne.memoizedProps.style,C=F!=null&&F.hasOwnProperty("display")?F.display:null,O.style.display=om("display",C))}catch(we){It(o,o.return,we)}}}else if(ne.tag===6){if(te===null)try{ne.stateNode.nodeValue=Y?"":ne.memoizedProps}catch(we){It(o,o.return,we)}}else if((ne.tag!==22&&ne.tag!==23||ne.memoizedState===null||ne===o)&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===o)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===o)break e;te===ne&&(te=null),ne=ne.return}te===ne&&(te=null),ne.sibling.return=ne.return,ne=ne.sibling}}break;case 19:pi(r,o),Ri(o),h&4&&Ty(o);break;case 21:break;default:pi(r,o),Ri(o)}}function Ri(o){var r=o.flags;if(r&2){try{e:{for(var d=o.return;d!==null;){if(vy(d)){var h=d;break e}d=d.return}throw Error(n(160))}switch(h.tag){case 5:var p=h.stateNode;h.flags&32&&(Sa(p,""),h.flags&=-33);var y=Iy(o);Ih(o,y,p);break;case 3:case 4:var C=h.stateNode.containerInfo,O=Iy(o);vh(o,O,C);break;default:throw Error(n(161))}}catch(F){It(o,o.return,F)}o.flags&=-3}r&4096&&(o.flags&=-4097)}function EC(o,r,d){Ie=o,Cy(o)}function Cy(o,r,d){for(var h=(o.mode&1)!==0;Ie!==null;){var p=Ie,y=p.child;if(p.tag===22&&h){var C=p.memoizedState!==null||Jc;if(!C){var O=p.alternate,F=O!==null&&O.memoizedState!==null||nn;O=Jc;var Y=nn;if(Jc=C,(nn=F)&&!Y)for(Ie=p;Ie!==null;)C=Ie,F=C.child,C.tag===22&&C.memoizedState!==null?Ry(p):F!==null?(F.return=C,Ie=F):Ry(p);for(;y!==null;)Ie=y,Cy(y),y=y.sibling;Ie=p,Jc=O,nn=Y}wy(o)}else(p.subtreeFlags&8772)!==0&&y!==null?(y.return=p,Ie=y):wy(o)}}function wy(o){for(;Ie!==null;){var r=Ie;if((r.flags&8772)!==0){var d=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:nn||ed(5,r);break;case 1:var h=r.stateNode;if(r.flags&4&&!nn)if(d===null)h.componentDidMount();else{var p=r.elementType===r.type?d.memoizedProps:hi(r.type,d.memoizedProps);h.componentDidUpdate(p,d.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var y=r.updateQueue;y!==null&&_0(r,y,h);break;case 3:var C=r.updateQueue;if(C!==null){if(d=null,r.child!==null)switch(r.child.tag){case 5:d=r.child.stateNode;break;case 1:d=r.child.stateNode}_0(r,C,d)}break;case 5:var O=r.stateNode;if(d===null&&r.flags&4){d=O;var F=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":F.autoFocus&&d.focus();break;case"img":F.src&&(d.src=F.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var Y=r.alternate;if(Y!==null){var te=Y.memoizedState;if(te!==null){var ne=te.dehydrated;ne!==null&&Da(ne)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}nn||r.flags&512&&Sh(r)}catch(J){It(r,r.return,J)}}if(r===o){Ie=null;break}if(d=r.sibling,d!==null){d.return=r.return,Ie=d;break}Ie=r.return}}function _y(o){for(;Ie!==null;){var r=Ie;if(r===o){Ie=null;break}var d=r.sibling;if(d!==null){d.return=r.return,Ie=d;break}Ie=r.return}}function Ry(o){for(;Ie!==null;){var r=Ie;try{switch(r.tag){case 0:case 11:case 15:var d=r.return;try{ed(4,r)}catch(F){It(r,d,F)}break;case 1:var h=r.stateNode;if(typeof h.componentDidMount=="function"){var p=r.return;try{h.componentDidMount()}catch(F){It(r,p,F)}}var y=r.return;try{Sh(r)}catch(F){It(r,y,F)}break;case 5:var C=r.return;try{Sh(r)}catch(F){It(r,C,F)}}}catch(F){It(r,r.return,F)}if(r===o){Ie=null;break}var O=r.sibling;if(O!==null){O.return=r.return,Ie=O;break}Ie=r.return}}var CC=Math.ceil,td=b.ReactCurrentDispatcher,Ah=b.ReactCurrentOwner,ii=b.ReactCurrentBatchConfig,Ve=0,Lt=null,Pt=null,Yt=0,Hn=0,vs=To(0),bt=0,Qa=null,hr=0,nd=0,Th=0,Ja=null,Rn=null,Eh=0,Is=1/0,Xi=null,id=!1,Ch=null,Po=null,od=!1,Do=null,rd=0,el=0,wh=null,sd=-1,ad=0;function un(){return(Ve&6)!==0?Et():sd!==-1?sd:sd=Et()}function Mo(o){return(o.mode&1)===0?1:(Ve&2)!==0&&Yt!==0?Yt&-Yt:aC.transition!==null?(ad===0&&(ad=Im()),ad):(o=nt,o!==0||(o=window.event,o=o===void 0?16:Dm(o.type)),o)}function mi(o,r,d,h){if(50<el)throw el=0,wh=null,Error(n(185));Ca(o,d,h),((Ve&2)===0||o!==Lt)&&(o===Lt&&((Ve&2)===0&&(nd|=d),bt===4&&No(o,Yt)),Pn(o,h),d===1&&Ve===0&&(r.mode&1)===0&&(Is=Et()+500,Bc&&Co()))}function Pn(o,r){var d=o.callbackNode;aE(o,r);var h=mc(o,o===Lt?Yt:0);if(h===0)d!==null&&ym(d),o.callbackNode=null,o.callbackPriority=0;else if(r=h&-h,o.callbackPriority!==r){if(d!=null&&ym(d),r===1)o.tag===0?sC(Dy.bind(null,o)):g0(Dy.bind(null,o)),nC(function(){(Ve&6)===0&&Co()}),d=null;else{switch(Am(h)){case 1:d=of;break;case 4:d=Sm;break;case 16:d=fc;break;case 536870912:d=vm;break;default:d=fc}d=Ly(d,Py.bind(null,o))}o.callbackPriority=r,o.callbackNode=d}}function Py(o,r){if(sd=-1,ad=0,(Ve&6)!==0)throw Error(n(327));var d=o.callbackNode;if(As()&&o.callbackNode!==d)return null;var h=mc(o,o===Lt?Yt:0);if(h===0)return null;if((h&30)!==0||(h&o.expiredLanes)!==0||r)r=ld(o,h);else{r=h;var p=Ve;Ve|=2;var y=Ny();(Lt!==o||Yt!==r)&&(Xi=null,Is=Et()+500,pr(o,r));do try{RC();break}catch(O){My(o,O)}while(!0);xf(),td.current=y,Ve=p,Pt!==null?r=0:(Lt=null,Yt=0,r=bt)}if(r!==0){if(r===2&&(p=rf(o),p!==0&&(h=p,r=_h(o,p))),r===1)throw d=Qa,pr(o,0),No(o,h),Pn(o,Et()),d;if(r===6)No(o,h);else{if(p=o.current.alternate,(h&30)===0&&!wC(p)&&(r=ld(o,h),r===2&&(y=rf(o),y!==0&&(h=y,r=_h(o,y))),r===1))throw d=Qa,pr(o,0),No(o,h),Pn(o,Et()),d;switch(o.finishedWork=p,o.finishedLanes=h,r){case 0:case 1:throw Error(n(345));case 2:mr(o,Rn,Xi);break;case 3:if(No(o,h),(h&130023424)===h&&(r=Eh+500-Et(),10<r)){if(mc(o,0)!==0)break;if(p=o.suspendedLanes,(p&h)!==h){un(),o.pingedLanes|=o.suspendedLanes&p;break}o.timeoutHandle=Of(mr.bind(null,o,Rn,Xi),r);break}mr(o,Rn,Xi);break;case 4:if(No(o,h),(h&4194240)===h)break;for(r=o.eventTimes,p=-1;0<h;){var C=31-di(h);y=1<<C,C=r[C],C>p&&(p=C),h&=~y}if(h=p,h=Et()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*CC(h/1960))-h,10<h){o.timeoutHandle=Of(mr.bind(null,o,Rn,Xi),h);break}mr(o,Rn,Xi);break;case 5:mr(o,Rn,Xi);break;default:throw Error(n(329))}}}return Pn(o,Et()),o.callbackNode===d?Py.bind(null,o):null}function _h(o,r){var d=Ja;return o.current.memoizedState.isDehydrated&&(pr(o,r).flags|=256),o=ld(o,r),o!==2&&(r=Rn,Rn=d,r!==null&&Rh(r)),o}function Rh(o){Rn===null?Rn=o:Rn.push.apply(Rn,o)}function wC(o){for(var r=o;;){if(r.flags&16384){var d=r.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var h=0;h<d.length;h++){var p=d[h],y=p.getSnapshot;p=p.value;try{if(!ui(y(),p))return!1}catch{return!1}}}if(d=r.child,r.subtreeFlags&16384&&d!==null)d.return=r,r=d;else{if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function No(o,r){for(r&=~Th,r&=~nd,o.suspendedLanes|=r,o.pingedLanes&=~r,o=o.expirationTimes;0<r;){var d=31-di(r),h=1<<d;o[d]=-1,r&=~h}}function Dy(o){if((Ve&6)!==0)throw Error(n(327));As();var r=mc(o,0);if((r&1)===0)return Pn(o,Et()),null;var d=ld(o,r);if(o.tag!==0&&d===2){var h=rf(o);h!==0&&(r=h,d=_h(o,h))}if(d===1)throw d=Qa,pr(o,0),No(o,r),Pn(o,Et()),d;if(d===6)throw Error(n(345));return o.finishedWork=o.current.alternate,o.finishedLanes=r,mr(o,Rn,Xi),Pn(o,Et()),null}function Ph(o,r){var d=Ve;Ve|=1;try{return o(r)}finally{Ve=d,Ve===0&&(Is=Et()+500,Bc&&Co())}}function gr(o){Do!==null&&Do.tag===0&&(Ve&6)===0&&As();var r=Ve;Ve|=1;var d=ii.transition,h=nt;try{if(ii.transition=null,nt=1,o)return o()}finally{nt=h,ii.transition=d,Ve=r,(Ve&6)===0&&Co()}}function Dh(){Hn=vs.current,ct(vs)}function pr(o,r){o.finishedWork=null,o.finishedLanes=0;var d=o.timeoutHandle;if(d!==-1&&(o.timeoutHandle=-1,tC(d)),Pt!==null)for(d=Pt.return;d!==null;){var h=d;switch(Hf(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&bc();break;case 3:ms(),ct(Cn),ct(Jt),Zf();break;case 5:Kf(h);break;case 4:ms();break;case 13:ct(mt);break;case 19:ct(mt);break;case 10:Yf(h.type._context);break;case 22:case 23:Dh()}d=d.return}if(Lt=o,Pt=o=Oo(o.current,null),Yt=Hn=r,bt=0,Qa=null,Th=nd=hr=0,Rn=Ja=null,dr!==null){for(r=0;r<dr.length;r++)if(d=dr[r],h=d.interleaved,h!==null){d.interleaved=null;var p=h.next,y=d.pending;if(y!==null){var C=y.next;y.next=p,h.next=C}d.pending=h}dr=null}return o}function My(o,r){do{var d=Pt;try{if(xf(),zc.current=Kc,jc){for(var h=yt.memoizedState;h!==null;){var p=h.queue;p!==null&&(p.pending=null),h=h.next}jc=!1}if(fr=0,Ft=Ot=yt=null,ja=!1,Xa=0,Ah.current=null,d===null||d.return===null){bt=1,Qa=r,Pt=null;break}e:{var y=o,C=d.return,O=d,F=r;if(r=Yt,O.flags|=32768,F!==null&&typeof F=="object"&&typeof F.then=="function"){var Y=F,te=O,ne=te.tag;if((te.mode&1)===0&&(ne===0||ne===11||ne===15)){var J=te.alternate;J?(te.updateQueue=J.updateQueue,te.memoizedState=J.memoizedState,te.lanes=J.lanes):(te.updateQueue=null,te.memoizedState=null)}var ye=ty(C);if(ye!==null){ye.flags&=-257,ny(ye,C,O,y,r),ye.mode&1&&ey(y,Y,r),r=ye,F=Y;var Te=r.updateQueue;if(Te===null){var we=new Set;we.add(F),r.updateQueue=we}else Te.add(F);break e}else{if((r&1)===0){ey(y,Y,r),Mh();break e}F=Error(n(426))}}else if(gt&&O.mode&1){var Ct=ty(C);if(Ct!==null){(Ct.flags&65536)===0&&(Ct.flags|=256),ny(Ct,C,O,y,r),$f(ys(F,O));break e}}y=F=ys(F,O),bt!==4&&(bt=2),Ja===null?Ja=[y]:Ja.push(y),y=C;do{switch(y.tag){case 3:y.flags|=65536,r&=-r,y.lanes|=r;var $=Q0(y,F,r);w0(y,$);break e;case 1:O=F;var H=y.type,W=y.stateNode;if((y.flags&128)===0&&(typeof H.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Po===null||!Po.has(W)))){y.flags|=65536,r&=-r,y.lanes|=r;var re=J0(y,O,r);w0(y,re);break e}}y=y.return}while(y!==null)}by(d)}catch(De){r=De,Pt===d&&d!==null&&(Pt=d=d.return);continue}break}while(!0)}function Ny(){var o=td.current;return td.current=Kc,o===null?Kc:o}function Mh(){(bt===0||bt===3||bt===2)&&(bt=4),Lt===null||(hr&268435455)===0&&(nd&268435455)===0||No(Lt,Yt)}function ld(o,r){var d=Ve;Ve|=2;var h=Ny();(Lt!==o||Yt!==r)&&(Xi=null,pr(o,r));do try{_C();break}catch(p){My(o,p)}while(!0);if(xf(),Ve=d,td.current=h,Pt!==null)throw Error(n(261));return Lt=null,Yt=0,bt}function _C(){for(;Pt!==null;)Oy(Pt)}function RC(){for(;Pt!==null&&!QT();)Oy(Pt)}function Oy(o){var r=Fy(o.alternate,o,Hn);o.memoizedProps=o.pendingProps,r===null?by(o):Pt=r,Ah.current=null}function by(o){var r=o;do{var d=r.alternate;if(o=r.return,(r.flags&32768)===0){if(d=vC(d,r,Hn),d!==null){Pt=d;return}}else{if(d=IC(d,r),d!==null){d.flags&=32767,Pt=d;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{bt=6,Pt=null;return}}if(r=r.sibling,r!==null){Pt=r;return}Pt=r=o}while(r!==null);bt===0&&(bt=5)}function mr(o,r,d){var h=nt,p=ii.transition;try{ii.transition=null,nt=1,PC(o,r,d,h)}finally{ii.transition=p,nt=h}return null}function PC(o,r,d,h){do As();while(Do!==null);if((Ve&6)!==0)throw Error(n(327));d=o.finishedWork;var p=o.finishedLanes;if(d===null)return null;if(o.finishedWork=null,o.finishedLanes=0,d===o.current)throw Error(n(177));o.callbackNode=null,o.callbackPriority=0;var y=d.lanes|d.childLanes;if(lE(o,y),o===Lt&&(Pt=Lt=null,Yt=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||od||(od=!0,Ly(fc,function(){return As(),null})),y=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||y){y=ii.transition,ii.transition=null;var C=nt;nt=1;var O=Ve;Ve|=4,Ah.current=null,TC(o,d),Ey(d,o),VE(Mf),vc=!!Df,Mf=Df=null,o.current=d,EC(d),JT(),Ve=O,nt=C,ii.transition=y}else o.current=d;if(od&&(od=!1,Do=o,rd=p),y=o.pendingLanes,y===0&&(Po=null),nE(d.stateNode),Pn(o,Et()),r!==null)for(h=o.onRecoverableError,d=0;d<r.length;d++)p=r[d],h(p.value,{componentStack:p.stack,digest:p.digest});if(id)throw id=!1,o=Ch,Ch=null,o;return(rd&1)!==0&&o.tag!==0&&As(),y=o.pendingLanes,(y&1)!==0?o===wh?el++:(el=0,wh=o):el=0,Co(),null}function As(){if(Do!==null){var o=Am(rd),r=ii.transition,d=nt;try{if(ii.transition=null,nt=16>o?16:o,Do===null)var h=!1;else{if(o=Do,Do=null,rd=0,(Ve&6)!==0)throw Error(n(331));var p=Ve;for(Ve|=4,Ie=o.current;Ie!==null;){var y=Ie,C=y.child;if((Ie.flags&16)!==0){var O=y.deletions;if(O!==null){for(var F=0;F<O.length;F++){var Y=O[F];for(Ie=Y;Ie!==null;){var te=Ie;switch(te.tag){case 0:case 11:case 15:Za(8,te,y)}var ne=te.child;if(ne!==null)ne.return=te,Ie=ne;else for(;Ie!==null;){te=Ie;var J=te.sibling,ye=te.return;if(Sy(te),te===Y){Ie=null;break}if(J!==null){J.return=ye,Ie=J;break}Ie=ye}}}var Te=y.alternate;if(Te!==null){var we=Te.child;if(we!==null){Te.child=null;do{var Ct=we.sibling;we.sibling=null,we=Ct}while(we!==null)}}Ie=y}}if((y.subtreeFlags&2064)!==0&&C!==null)C.return=y,Ie=C;else e:for(;Ie!==null;){if(y=Ie,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:Za(9,y,y.return)}var $=y.sibling;if($!==null){$.return=y.return,Ie=$;break e}Ie=y.return}}var H=o.current;for(Ie=H;Ie!==null;){C=Ie;var W=C.child;if((C.subtreeFlags&2064)!==0&&W!==null)W.return=C,Ie=W;else e:for(C=H;Ie!==null;){if(O=Ie,(O.flags&2048)!==0)try{switch(O.tag){case 0:case 11:case 15:ed(9,O)}}catch(De){It(O,O.return,De)}if(O===C){Ie=null;break e}var re=O.sibling;if(re!==null){re.return=O.return,Ie=re;break e}Ie=O.return}}if(Ve=p,Co(),Ei&&typeof Ei.onPostCommitFiberRoot=="function")try{Ei.onPostCommitFiberRoot(hc,o)}catch{}h=!0}return h}finally{nt=d,ii.transition=r}}return!1}function ky(o,r,d){r=ys(d,r),r=Q0(o,r,1),o=_o(o,r,1),r=un(),o!==null&&(Ca(o,1,r),Pn(o,r))}function It(o,r,d){if(o.tag===3)ky(o,o,d);else for(;r!==null;){if(r.tag===3){ky(r,o,d);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Po===null||!Po.has(h))){o=ys(d,o),o=J0(r,o,1),r=_o(r,o,1),o=un(),r!==null&&(Ca(r,1,o),Pn(r,o));break}}r=r.return}}function DC(o,r,d){var h=o.pingCache;h!==null&&h.delete(r),r=un(),o.pingedLanes|=o.suspendedLanes&d,Lt===o&&(Yt&d)===d&&(bt===4||bt===3&&(Yt&130023424)===Yt&&500>Et()-Eh?pr(o,0):Th|=d),Pn(o,r)}function By(o,r){r===0&&((o.mode&1)===0?r=1:(r=pc,pc<<=1,(pc&130023424)===0&&(pc=4194304)));var d=un();o=Yi(o,r),o!==null&&(Ca(o,r,d),Pn(o,d))}function MC(o){var r=o.memoizedState,d=0;r!==null&&(d=r.retryLane),By(o,d)}function NC(o,r){var d=0;switch(o.tag){case 13:var h=o.stateNode,p=o.memoizedState;p!==null&&(d=p.retryLane);break;case 19:h=o.stateNode;break;default:throw Error(n(314))}h!==null&&h.delete(r),By(o,d)}var Fy;Fy=function(o,r,d){if(o!==null)if(o.memoizedProps!==r.pendingProps||Cn.current)_n=!0;else{if((o.lanes&d)===0&&(r.flags&128)===0)return _n=!1,SC(o,r,d);_n=(o.flags&131072)!==0}else _n=!1,gt&&(r.flags&1048576)!==0&&p0(r,Lc,r.index);switch(r.lanes=0,r.tag){case 2:var h=r.type;Qc(o,r),o=r.pendingProps;var p=cs(r,Jt.current);ps(r,d),p=eh(null,r,h,o,p,d);var y=th();return r.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,wn(h)?(y=!0,kc(r)):y=!1,r.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,Xf(r),p.updater=qc,r.stateNode=p,p._reactInternals=r,ah(r,h,o,d),r=uh(null,r,h,!0,y,d)):(r.tag=0,gt&&y&&Lf(r),dn(null,r,p,d),r=r.child),r;case 16:h=r.elementType;e:{switch(Qc(o,r),o=r.pendingProps,p=h._init,h=p(h._payload),r.type=h,p=r.tag=bC(h),o=hi(h,o),p){case 0:r=dh(null,r,h,o,d);break e;case 1:r=ly(null,r,h,o,d);break e;case 11:r=iy(null,r,h,o,d);break e;case 14:r=oy(null,r,h,hi(h.type,o),d);break e}throw Error(n(306,h,""))}return r;case 0:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:hi(h,p),dh(o,r,h,p,d);case 1:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:hi(h,p),ly(o,r,h,p,d);case 3:e:{if(cy(r),o===null)throw Error(n(387));h=r.pendingProps,y=r.memoizedState,p=y.element,C0(o,r),xc(r,h,null,d);var C=r.memoizedState;if(h=C.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){p=ys(Error(n(423)),r),r=dy(o,r,h,d,p);break e}else if(h!==p){p=ys(Error(n(424)),r),r=dy(o,r,h,d,p);break e}else for(Ln=Ao(r.stateNode.containerInfo.firstChild),Fn=r,gt=!0,fi=null,d=T0(r,null,h,d),r.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(fs(),h===p){r=ji(o,r,d);break e}dn(o,r,h,d)}r=r.child}return r;case 5:return R0(r),o===null&&Gf(r),h=r.type,p=r.pendingProps,y=o!==null?o.memoizedProps:null,C=p.children,Nf(h,p)?C=null:y!==null&&Nf(h,y)&&(r.flags|=32),ay(o,r),dn(o,r,C,d),r.child;case 6:return o===null&&Gf(r),null;case 13:return uy(o,r,d);case 4:return Vf(r,r.stateNode.containerInfo),h=r.pendingProps,o===null?r.child=hs(r,null,h,d):dn(o,r,h,d),r.child;case 11:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:hi(h,p),iy(o,r,h,p,d);case 7:return dn(o,r,r.pendingProps,d),r.child;case 8:return dn(o,r,r.pendingProps.children,d),r.child;case 12:return dn(o,r,r.pendingProps.children,d),r.child;case 10:e:{if(h=r.type._context,p=r.pendingProps,y=r.memoizedProps,C=p.value,at(Gc,h._currentValue),h._currentValue=C,y!==null)if(ui(y.value,C)){if(y.children===p.children&&!Cn.current){r=ji(o,r,d);break e}}else for(y=r.child,y!==null&&(y.return=r);y!==null;){var O=y.dependencies;if(O!==null){C=y.child;for(var F=O.firstContext;F!==null;){if(F.context===h){if(y.tag===1){F=zi(-1,d&-d),F.tag=2;var Y=y.updateQueue;if(Y!==null){Y=Y.shared;var te=Y.pending;te===null?F.next=F:(F.next=te.next,te.next=F),Y.pending=F}}y.lanes|=d,F=y.alternate,F!==null&&(F.lanes|=d),zf(y.return,d,r),O.lanes|=d;break}F=F.next}}else if(y.tag===10)C=y.type===r.type?null:y.child;else if(y.tag===18){if(C=y.return,C===null)throw Error(n(341));C.lanes|=d,O=C.alternate,O!==null&&(O.lanes|=d),zf(C,d,r),C=y.sibling}else C=y.child;if(C!==null)C.return=y;else for(C=y;C!==null;){if(C===r){C=null;break}if(y=C.sibling,y!==null){y.return=C.return,C=y;break}C=C.return}y=C}dn(o,r,p.children,d),r=r.child}return r;case 9:return p=r.type,h=r.pendingProps.children,ps(r,d),p=ti(p),h=h(p),r.flags|=1,dn(o,r,h,d),r.child;case 14:return h=r.type,p=hi(h,r.pendingProps),p=hi(h.type,p),oy(o,r,h,p,d);case 15:return ry(o,r,r.type,r.pendingProps,d);case 17:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:hi(h,p),Qc(o,r),r.tag=1,wn(h)?(o=!0,kc(r)):o=!1,ps(r,d),q0(r,h,p),ah(r,h,p,d),uh(null,r,h,!0,o,d);case 19:return hy(o,r,d);case 22:return sy(o,r,d)}throw Error(n(156,r.tag))};function Ly(o,r){return mm(o,r)}function OC(o,r,d,h){this.tag=o,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function oi(o,r,d,h){return new OC(o,r,d,h)}function Nh(o){return o=o.prototype,!(!o||!o.isReactComponent)}function bC(o){if(typeof o=="function")return Nh(o)?1:0;if(o!=null){if(o=o.$$typeof,o===X)return 11;if(o===ie)return 14}return 2}function Oo(o,r){var d=o.alternate;return d===null?(d=oi(o.tag,r,o.key,o.mode),d.elementType=o.elementType,d.type=o.type,d.stateNode=o.stateNode,d.alternate=o,o.alternate=d):(d.pendingProps=r,d.type=o.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=o.flags&14680064,d.childLanes=o.childLanes,d.lanes=o.lanes,d.child=o.child,d.memoizedProps=o.memoizedProps,d.memoizedState=o.memoizedState,d.updateQueue=o.updateQueue,r=o.dependencies,d.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},d.sibling=o.sibling,d.index=o.index,d.ref=o.ref,d}function cd(o,r,d,h,p,y){var C=2;if(h=o,typeof o=="function")Nh(o)&&(C=1);else if(typeof o=="string")C=5;else e:switch(o){case N:return yr(d.children,p,y,r);case k:C=8,p|=8;break;case L:return o=oi(12,d,r,p|2),o.elementType=L,o.lanes=y,o;case Q:return o=oi(13,d,r,p),o.elementType=Q,o.lanes=y,o;case q:return o=oi(19,d,r,p),o.elementType=q,o.lanes=y,o;case ee:return dd(d,p,y,r);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case z:C=10;break e;case V:C=9;break e;case X:C=11;break e;case ie:C=14;break e;case oe:C=16,h=null;break e}throw Error(n(130,o==null?o:typeof o,""))}return r=oi(C,d,r,p),r.elementType=o,r.type=h,r.lanes=y,r}function yr(o,r,d,h){return o=oi(7,o,h,r),o.lanes=d,o}function dd(o,r,d,h){return o=oi(22,o,h,r),o.elementType=ee,o.lanes=d,o.stateNode={isHidden:!1},o}function Oh(o,r,d){return o=oi(6,o,null,r),o.lanes=d,o}function bh(o,r,d){return r=oi(4,o.children!==null?o.children:[],o.key,r),r.lanes=d,r.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},r}function kC(o,r,d,h,p){this.tag=r,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=sf(0),this.expirationTimes=sf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=sf(0),this.identifierPrefix=h,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function kh(o,r,d,h,p,y,C,O,F){return o=new kC(o,r,d,O,F),r===1?(r=1,y===!0&&(r|=8)):r=0,y=oi(3,null,null,r),o.current=y,y.stateNode=o,y.memoizedState={element:h,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Xf(y),o}function BC(o,r,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:h==null?null:""+h,children:o,containerInfo:r,implementation:d}}function Hy(o){if(!o)return Eo;o=o._reactInternals;e:{if(rr(o)!==o||o.tag!==1)throw Error(n(170));var r=o;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(wn(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(o.tag===1){var d=o.type;if(wn(d))return f0(o,d,r)}return r}function Uy(o,r,d,h,p,y,C,O,F){return o=kh(d,h,!0,o,p,y,C,O,F),o.context=Hy(null),d=o.current,h=un(),p=Mo(d),y=zi(h,p),y.callback=r??null,_o(d,y,p),o.current.lanes=p,Ca(o,p,h),Pn(o,h),o}function ud(o,r,d,h){var p=r.current,y=un(),C=Mo(p);return d=Hy(d),r.context===null?r.context=d:r.pendingContext=d,r=zi(y,C),r.payload={element:o},h=h===void 0?null:h,h!==null&&(r.callback=h),o=_o(p,r,C),o!==null&&(mi(o,p,C,y),Wc(o,p,C)),C}function fd(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function Gy(o,r){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var d=o.retryLane;o.retryLane=d!==0&&d<r?d:r}}function Bh(o,r){Gy(o,r),(o=o.alternate)&&Gy(o,r)}function FC(){return null}var $y=typeof reportError=="function"?reportError:function(o){console.error(o)};function Fh(o){this._internalRoot=o}hd.prototype.render=Fh.prototype.render=function(o){var r=this._internalRoot;if(r===null)throw Error(n(409));ud(o,r,null,null)},hd.prototype.unmount=Fh.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var r=o.containerInfo;gr(function(){ud(null,o,null,null)}),r[Gi]=null}};function hd(o){this._internalRoot=o}hd.prototype.unstable_scheduleHydration=function(o){if(o){var r=Cm();o={blockedOn:null,target:o,priority:r};for(var d=0;d<So.length&&r!==0&&r<So[d].priority;d++);So.splice(d,0,o),d===0&&Rm(o)}};function Lh(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function gd(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function Wy(){}function LC(o,r,d,h,p){if(p){if(typeof h=="function"){var y=h;h=function(){var Y=fd(C);y.call(Y)}}var C=Uy(r,h,o,0,null,!1,!1,"",Wy);return o._reactRootContainer=C,o[Gi]=C.current,Ha(o.nodeType===8?o.parentNode:o),gr(),C}for(;p=o.lastChild;)o.removeChild(p);if(typeof h=="function"){var O=h;h=function(){var Y=fd(F);O.call(Y)}}var F=kh(o,0,!1,null,null,!1,!1,"",Wy);return o._reactRootContainer=F,o[Gi]=F.current,Ha(o.nodeType===8?o.parentNode:o),gr(function(){ud(r,F,d,h)}),F}function pd(o,r,d,h,p){var y=d._reactRootContainer;if(y){var C=y;if(typeof p=="function"){var O=p;p=function(){var F=fd(C);O.call(F)}}ud(r,C,o,p)}else C=LC(d,r,o,p,h);return fd(C)}Tm=function(o){switch(o.tag){case 3:var r=o.stateNode;if(r.current.memoizedState.isDehydrated){var d=Ea(r.pendingLanes);d!==0&&(af(r,d|1),Pn(r,Et()),(Ve&6)===0&&(Is=Et()+500,Co()))}break;case 13:gr(function(){var h=Yi(o,1);if(h!==null){var p=un();mi(h,o,1,p)}}),Bh(o,1)}},lf=function(o){if(o.tag===13){var r=Yi(o,134217728);if(r!==null){var d=un();mi(r,o,134217728,d)}Bh(o,134217728)}},Em=function(o){if(o.tag===13){var r=Mo(o),d=Yi(o,r);if(d!==null){var h=un();mi(d,o,r,h)}Bh(o,r)}},Cm=function(){return nt},wm=function(o,r){var d=nt;try{return nt=o,r()}finally{nt=d}},Ju=function(o,r,d){switch(r){case"input":if(En(o,d),r=d.name,d.type==="radio"&&r!=null){for(d=o;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<d.length;r++){var h=d[r];if(h!==o&&h.form===o.form){var p=Oc(h);if(!p)throw Error(n(90));Ae(h),En(h,p)}}}break;case"textarea":em(o,d);break;case"select":r=d.value,r!=null&&go(o,!!d.multiple,r,!1)}},cm=Ph,dm=gr;var HC={usingClientEntryPoint:!1,Events:[$a,as,Oc,am,lm,Ph]},tl={findFiberByHostInstance:sr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},UC={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=gm(o),o===null?null:o.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||FC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var md=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!md.isDisabled&&md.supportsFiber)try{hc=md.inject(UC),Ei=md}catch{}}return Dn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HC,Dn.createPortal=function(o,r){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Lh(r))throw Error(n(200));return BC(o,r,null,d)},Dn.createRoot=function(o,r){if(!Lh(o))throw Error(n(299));var d=!1,h="",p=$y;return r!=null&&(r.unstable_strictMode===!0&&(d=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),r=kh(o,1,!1,null,null,d,!1,h,p),o[Gi]=r.current,Ha(o.nodeType===8?o.parentNode:o),new Fh(r)},Dn.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var r=o._reactInternals;if(r===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=gm(r),o=o===null?null:o.stateNode,o},Dn.flushSync=function(o){return gr(o)},Dn.hydrate=function(o,r,d){if(!gd(r))throw Error(n(200));return pd(null,o,r,!0,d)},Dn.hydrateRoot=function(o,r,d){if(!Lh(o))throw Error(n(405));var h=d!=null&&d.hydratedSources||null,p=!1,y="",C=$y;if(d!=null&&(d.unstable_strictMode===!0&&(p=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onRecoverableError!==void 0&&(C=d.onRecoverableError)),r=Uy(r,null,o,1,d??null,p,!1,y,C),o[Gi]=r.current,Ha(o),h)for(o=0;o<h.length;o++)d=h[o],p=d._getVersion,p=p(d._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[d,p]:r.mutableSourceEagerHydrationData.push(d,p);return new hd(r)},Dn.render=function(o,r,d){if(!gd(r))throw Error(n(200));return pd(null,o,r,!1,d)},Dn.unmountComponentAtNode=function(o){if(!gd(o))throw Error(n(40));return o._reactRootContainer?(gr(function(){pd(null,null,o,!1,function(){o._reactRootContainer=null,o[Gi]=null})}),!0):!1},Dn.unstable_batchedUpdates=Ph,Dn.unstable_renderSubtreeIntoContainer=function(o,r,d,h){if(!gd(d))throw Error(n(200));if(o==null||o._reactInternals===void 0)throw Error(n(38));return pd(o,r,d,!1,h)},Dn.version="18.3.1-next-f1338f8080-20240426",Dn}var qy;function KC(){if(qy)return Gh.exports;qy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Gh.exports=VC(),Gh.exports}var Zy;function qC(){if(Zy)return yd;Zy=1;var e=KC();return yd.createRoot=e.createRoot,yd.hydrateRoot=e.hydrateRoot,yd}var ZC=qC();const QC=zv(ZC);class JC{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let i=this.length++;for(;i>0;){const s=i-1>>1,a=this.values[s];if(n>=a)break;this.ids[i]=this.ids[s],this.values[i]=a,i=s}this.ids[i]=t,this.values[i]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let l=(a<<1)+1;const c=l+1;let u=this.ids[l],f=this.values[l];const g=this.values[c];if(c<this.length&&g<f&&(l=c,u=this.ids[c],f=g),f>=i)break;this.ids[a]=u,this.values[a]=f,a=l}this.ids[a]=n,this.values[a]=i}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Qy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],xh=3;class op{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[i,s]=new Uint8Array(t,n+0,2);if(i!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==xh)throw new Error(`Got v${a} data when expected v${xh}.`);const l=Qy[s&15];if(!l)throw new Error("Unrecognized array type.");const[c]=new Uint16Array(t,n+2,1),[u]=new Uint32Array(t,n+4,1);return new op(u,c,l,void 0,t,n)}constructor(t,n=16,i=Float64Array,s=ArrayBuffer,a,l=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=l;let c=t,u=c;this._levelBounds=[c*4];do c=Math.ceil(c/this.nodeSize),u+=c,this._levelBounds.push(u*4);while(c!==1);this.ArrayType=i,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const f=Qy.indexOf(this.ArrayType),g=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(f<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,l+8,u*4),this._indices=new this.IndexArrayType(this.data,l+8+g,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+g+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+g,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(xh<<4)+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new JC}add(t,n,i=t,s=n){const a=this._pos>>2,l=this._boxes;return this._indices[a]=a,l[this._pos++]=t,l[this._pos++]=n,l[this._pos++]=i,l[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),i>this.maxX&&(this.maxX=i),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,i=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let l=0,c=0;l<this.numItems;l++){const u=t[c++],f=t[c++],g=t[c++],m=t[c++],v=Math.floor(a*((u+g)/2-this.minX)/n),S=Math.floor(a*((f+m)/2-this.minY)/i);s[l]=tw(v,S)}Cg(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let l=0,c=0;l<this._levelBounds.length-1;l++){const u=this._levelBounds[l];for(;c<u;){const f=c;let g=t[c++],m=t[c++],v=t[c++],S=t[c++];for(let I=1;I<this.nodeSize&&c<u;I++)g=Math.min(g,t[c++]),m=Math.min(m,t[c++]),v=Math.max(v,t[c++]),S=Math.max(S,t[c++]);this._indices[this._pos>>2]=f,t[this._pos++]=g,t[this._pos++]=m,t[this._pos++]=v,t[this._pos++]=S}}}search(t,n,i,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const c=[],u=[];for(;l!==void 0;){const f=Math.min(l+this.nodeSize*4,eS(l,this._levelBounds));for(let g=l;g<f;g+=4){if(i<this._boxes[g]||s<this._boxes[g+1]||t>this._boxes[g+2]||n>this._boxes[g+3])continue;const m=this._indices[g>>2]|0;l>=this.numItems*4?c.push(m):(a===void 0||a(m))&&u.push(m)}l=c.pop()}return u}neighbors(t,n,i=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const c=this._queue,u=[],f=s*s;e:for(;l!==void 0;){const g=Math.min(l+this.nodeSize*4,eS(l,this._levelBounds));for(let m=l;m<g;m+=4){const v=this._indices[m>>2]|0,S=Jy(t,this._boxes[m],this._boxes[m+2]),I=Jy(n,this._boxes[m+1],this._boxes[m+3]),A=S*S+I*I;A>f||(l>=this.numItems*4?c.push(v<<1,A):(a===void 0||a(v))&&c.push((v<<1)+1,A))}for(;c.length&&c.peek()&1;)if(c.peekValue()>f||(u.push(c.pop()>>1),u.length===i))break e;l=c.length?c.pop()>>1:void 0}return c.clear(),u}}function Jy(e,t,n){return e<t?t-e:e<=n?0:e-n}function eS(e,t){let n=0,i=t.length-1;for(;n<i;){const s=n+i>>1;t[s]>e?i=s:n=s+1}return t[n]}function Cg(e,t,n,i,s,a){if(Math.floor(i/a)>=Math.floor(s/a))return;const l=e[i+s>>1];let c=i-1,u=s+1;for(;;){do c++;while(e[c]<l);do u--;while(e[u]>l);if(c>=u)break;ew(e,t,n,c,u)}Cg(e,t,n,i,u,a),Cg(e,t,n,u+1,s,a)}function ew(e,t,n,i,s){const a=e[i];e[i]=e[s],e[s]=a;const l=4*i,c=4*s,u=t[l],f=t[l+1],g=t[l+2],m=t[l+3];t[l]=t[c],t[l+1]=t[c+1],t[l+2]=t[c+2],t[l+3]=t[c+3],t[c]=u,t[c+1]=f,t[c+2]=g,t[c+3]=m;const v=n[i];n[i]=n[s],n[s]=v}function tw(e,t){let n=e^t,i=65535^n,s=65535^(e|t),a=e&(t^65535),l=n|i>>1,c=n>>1^n,u=s>>1^i&a>>1^s,f=n&s>>1^a>>1^a;n=l,i=c,s=u,a=f,l=n&n>>2^i&i>>2,c=n&i>>2^i&(n^i)>>2,u^=n&s>>2^i&a>>2,f^=i&s>>2^(n^i)&a>>2,n=l,i=c,s=u,a=f,l=n&n>>4^i&i>>4,c=n&i>>4^i&(n^i)>>4,u^=n&s>>4^i&a>>4,f^=i&s>>4^(n^i)&a>>4,n=l,i=c,s=u,a=f,u^=n&s>>8^i&a>>8,f^=i&s>>8^(n^i)&a>>8,n=u^u>>1,i=f^f>>1;let g=e^t,m=i|65535^(g|n);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|g)>>>0}function zn(e,t){return{x:e.x+t.x,y:e.y+t.y}}function nw(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Tt(e,t){return{x:e.x*t,y:e.y*t}}function Wr(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function ot(e){const t=Wr(e);return t===0?{x:0,y:0}:Tt(e,1/t)}function Zd(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function Qd(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,i)=>({x:n.x+i.x,y:n.y+i.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Ye(e,t,n,i){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>i/2&&(a=a-Math.sign(a)*i),{x:s,y:a}}function We(e,t,n){const i=Ye(e,t,n.width,n.height);return ot(i)}function U(e,t,n,i){const s=Ye(e,t,n,i);return Wr(s)}function Nn(e,t,n,i){const s=Ye(e,t,n,i);return s.x*s.x+s.y*s.y}function jv(e,t){return e.x*t.x+e.y*t.y}function iw(e,t){const n=jv(e,t),i=Wr(e),s=Wr(t);if(i===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(i*s)));return Math.acos(a)}function wg(e,t){const n=Math.cos(t),i=Math.sin(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function ow(e,t,n){const i=Math.max(0,Math.min(1,n)),s={r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16)},a={r:parseInt(t.substring(1,3),16),g:parseInt(t.substring(3,5),16),b:parseInt(t.substring(5,7),16)},l=Math.round(s.r+(a.r-s.r)*i),c=Math.round(s.g+(a.g-s.g)*i),u=Math.round(s.b+(a.b-s.b)*i),f=g=>("00"+g.toString(16)).slice(-2);return`#${f(l)}${f(c)}${f(u)}`}function rw(e,t){return t.split(".").reduce((n,i)=>{if(n&&typeof n=="object"&&i in n)return n[i]},e)}function qi(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new op(e.length),i=new Map,s=new Map;let a=0;const l=new Uint32Array(e.length);for(let u=0;u<e.length;u++){const f=e[u];f.width!==void 0&&f.height!==void 0?n.add(f.position.x,f.position.y,f.position.x+f.width,f.position.y+f.height):n.add(f.position.x,f.position.y,f.position.x,f.position.y)}return n.finish(),{all(){return e},byRect(u){const{width:f,height:g}=t,m=[];a++;const v=[];u.left<0?(v.push({left:u.left+f,right:f}),v.push({left:0,right:u.right})):u.right>f?(v.push({left:u.left,right:f}),v.push({left:0,right:u.right-f})):v.push({left:u.left,right:u.right});const S=[];u.top<0?(S.push({top:u.top+g,bottom:g}),S.push({top:0,bottom:u.bottom})):u.bottom>g?(S.push({top:u.top,bottom:g}),S.push({top:0,bottom:u.bottom-g})):S.push({top:u.top,bottom:u.bottom});for(let I=0;I<v.length;I++){const A=v[I];for(let w=0;w<S.length;w++){const P=S[w],R=n.search(A.left,P.top,A.right,P.bottom);for(let _=0;_<R.length;_++){const b=R[_];l[b]!==a&&(l[b]=a,m.push(e[b]))}}}return m},byRadius(u,f){const{width:g,height:m}=t,v=[];a++;const S=f*f,I=u.x-f,A=u.x+f,w=u.y-f,P=u.y+f,R=[];I<0?(R.push({left:I+g,right:g}),R.push({left:0,right:A})):A>g?(R.push({left:I,right:g}),R.push({left:0,right:A-g})):R.push({left:I,right:A});const _=[];w<0?(_.push({top:w+m,bottom:m}),_.push({top:0,bottom:P})):P>m?(_.push({top:w,bottom:m}),_.push({top:0,bottom:P-m})):_.push({top:w,bottom:P});for(let b=0;b<R.length;b++){const M=R[b];for(let D=0;D<_.length;D++){const N=_[D],k=n.search(M.left,N.top,M.right,N.bottom);for(let L=0;L<k.length;L++){const z=k[L];if(l[z]!==a){l[z]=a;const V=e[z];Nn(u,V.position,g,m)<=S&&v.push(V)}}}}return v},byProperty(u,f){var g;if(!i.has(u)){const m=new Map;for(let v=0;v<e.length;v++){const S=e[v],I=S[u];m.has(I)||m.set(I,[]),m.get(I).push(S)}i.set(u,m)}return((g=i.get(u))==null?void 0:g.get(f))||[]},byPropertyPath(u,f){var g;if(!s.has(u)){const m=new Map;for(let v=0;v<e.length;v++){const S=e[v],I=rw(S,u);m.has(I)||m.set(I,[]),m.get(I).push(S)}s.set(u,m)}return((g=s.get(u))==null?void 0:g.get(f))||[]},resetPropertyCache(){i.clear(),s.clear()},count(){return e.length}}}function Iu(e){var m,v;const t=e.entities.entities,n=[],i=[],s=[],a=[],l=[],c=[],u=[];for(const S in t){const I=t[S];switch(I.type){case"human":n.push(I);break;case"berryBush":i.push(I);break;case"corpse":s.push(I);break;case"prey":a.push(I);break;case"predator":l.push(I);break;case"building":c.push(I);break;case"tree":u.push(I);break}}const f=e.mapDimensions;return{...e,search:{human:qi(n,f),berryBush:qi(i,f),corpse:qi(s,f),prey:qi(a,f),predator:qi(l,f),building:qi(c,f),tree:qi(u,f),tasks:((m=e.search)==null?void 0:m.tasks)??qi([],f)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((v=e.cache)==null?void 0:v.tribeCenters)??{}}}}function sw(e){const t=[];for(const n in e.tasks)t.push(e.tasks[n]);e.search.tasks=qi(t,e.mapDimensions)}const fe={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire"},tr={[fe.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[fe.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[fe.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[fe.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}}},aw=.5,lw="#FFA500",cw="#FF4500",tS=4,dw=10,rp=60;function sp(e){return tr[e].dimensions}function uw(e){return tr[e].constructionTimeHours}function fw(e){return tr[e].destructionTimeHours}const Xv=5;function hw(){return tr[fe.PlantingZone].dimensions}function nS(e,t,n){const i=e.position.x+n.width/2,a=t.position.x-n.width/2-i,l=e.position.y-n.height/2,c=e.position.y+n.height/2,u=t.position.y-n.height/2,f=t.position.y+n.height/2,g=Math.min(c,f)-Math.max(l,u);return a>=-5&&a<=Xv&&g>n.height*.5}function iS(e,t,n){const i=e.position.y+n.height/2,a=t.position.y-n.height/2-i,l=e.position.x-n.width/2,c=e.position.x+n.width/2,u=t.position.x-n.width/2,f=t.position.x+n.width/2,g=Math.min(c,f)-Math.max(l,u);return a>=-5&&a<=Xv&&g>n.width*.5}function gw(e){var l;const t={},n=hw(),i=e;if(!((l=i.search)!=null&&l.building))return t;const a=i.search.building.all().filter(c=>c.buildingType===fe.PlantingZone&&c.isConstructed);for(const c of a)t[c.id]={top:!1,bottom:!1,left:!1,right:!1};for(let c=0;c<a.length;c++){const u=a[c];for(let f=c+1;f<a.length;f++){const g=a[f];u.ownerId===g.ownerId&&(nS(u,g,n)&&(t[u.id].right=!0,t[g.id].left=!0),nS(g,u,n)&&(t[g.id].right=!0,t[u.id].left=!0),iS(u,g,n)&&(t[u.id].bottom=!0,t[g.id].top=!0),iS(g,u,n)&&(t[g.id].bottom=!0,t[u.id].top=!0))}}return t}function Ll(e){e.plantingZoneConnections=gw(e)}var Rr=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(Rr||{});class pw{constructor(){Ne(this,"worker",null);Ne(this,"pendingRequests",new Map);Ne(this,"requestQueue",[]);Ne(this,"isProcessing",!1);Ne(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case Rr.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case Rr.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case Rr.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,i)=>{if(!this.worker){i(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:i});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),i(s)}})}queueOperation(t){return new Promise((n,i)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){i(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),i=t,s={type:Rr.SAVE_REQUEST,id:n,gameState:i};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Rr.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Rr.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const ap=new pw;async function lp(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,roleManagerOpen:e.roleManagerOpen,armyControlOpen:e.armyControlOpen,tribeModalOpen:e.tribeModalOpen,cameraFollowingPlayer:e.cameraFollowingPlayer,cameraZoom:e.cameraZoom,isDraggingMinimap:e.isDraggingMinimap,minimapDragDistance:e.minimapDragDistance,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks,isDraggingViewport:e.isDraggingViewport,viewportDragButton:e.viewportDragButton,viewportDragDistance:e.viewportDragDistance};await ap.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function mw(){try{const e=await ap.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=Iu(t);return Ll(n),n}catch(e){return console.error("Failed to load game:",e),await Vv(),null}}async function Vv(){try{await ap.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const Kv=Be.createContext(void 0),yw=({initialAppState:e,children:t})=>{const[n,i]=Be.useState(e),[s,a]=Be.useState(void 0),[l,c]=Be.useState(null),[u,f]=Be.useState(!1);Be.useEffect(()=>{mw().then(I=>{I&&c(I),f(!0)})},[]);const g=(I,A)=>{i(I),I==="gameOver"&&A?a(A):I!=="gameOver"&&a(void 0)},m=()=>{i("intro"),a(void 0),S()},v=I=>{lp(I),c(I)},S=()=>{Vv(),c(null)};return He.jsx(Kv.Provider,{value:{appState:n,setAppState:g,returnToIntro:m,gameOverDetails:s,contextReady:u,savedGameState:l,setSavedGameState:c,saveCurrentGame:v,clearCurrentSave:S},children:t})},Vr=()=>{const e=Be.useContext(Kv);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var rn=function(){return rn=Object.assign||function(t){for(var n,i=1,s=arguments.length;i<s;i++){n=arguments[i];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},rn.apply(this,arguments)};function Hl(e,t,n){if(n||arguments.length===2)for(var i=0,s=t.length,a;i<s;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return e.concat(a||Array.prototype.slice.call(t))}var dt="-ms-",wl="-moz-",et="-webkit-",qv="comm",Au="rule",cp="decl",Sw="@import",Zv="@keyframes",vw="@layer",Qv=Math.abs,dp=String.fromCharCode,_g=Object.assign;function Iw(e,t){return Ut(e,0)^45?(((t<<2^Ut(e,0))<<2^Ut(e,1))<<2^Ut(e,2))<<2^Ut(e,3):0}function Jv(e){return e.trim()}function Qi(e,t){return(e=t.exec(e))?e[0]:e}function xe(e,t,n){return e.replace(t,n)}function Gd(e,t,n){return e.indexOf(t,n)}function Ut(e,t){return e.charCodeAt(t)|0}function Qs(e,t,n){return e.slice(t,n)}function ki(e){return e.length}function eI(e){return e.length}function Sl(e,t){return t.push(e),e}function Aw(e,t){return e.map(t).join("")}function oS(e,t){return e.filter(function(n){return!Qi(n,t)})}var Tu=1,Js=1,tI=0,li=0,Mt=0,fa="";function Eu(e,t,n,i,s,a,l,c){return{value:e,root:t,parent:n,type:i,props:s,children:a,line:Tu,column:Js,length:l,return:"",siblings:c}}function Uo(e,t){return _g(Eu("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Ts(e){for(;e.root;)e=Uo(e.root,{children:[e]});Sl(e,e.siblings)}function Tw(){return Mt}function Ew(){return Mt=li>0?Ut(fa,--li):0,Js--,Mt===10&&(Js=1,Tu--),Mt}function Ii(){return Mt=li<tI?Ut(fa,li++):0,Js++,Mt===10&&(Js=1,Tu++),Mt}function br(){return Ut(fa,li)}function $d(){return li}function Cu(e,t){return Qs(fa,e,t)}function Rg(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Cw(e){return Tu=Js=1,tI=ki(fa=e),li=0,[]}function ww(e){return fa="",e}function Yh(e){return Jv(Cu(li-1,Pg(e===91?e+2:e===40?e+1:e)))}function _w(e){for(;(Mt=br())&&Mt<33;)Ii();return Rg(e)>2||Rg(Mt)>3?"":" "}function Rw(e,t){for(;--t&&Ii()&&!(Mt<48||Mt>102||Mt>57&&Mt<65||Mt>70&&Mt<97););return Cu(e,$d()+(t<6&&br()==32&&Ii()==32))}function Pg(e){for(;Ii();)switch(Mt){case e:return li;case 34:case 39:e!==34&&e!==39&&Pg(Mt);break;case 40:e===41&&Pg(e);break;case 92:Ii();break}return li}function Pw(e,t){for(;Ii()&&e+Mt!==57;)if(e+Mt===84&&br()===47)break;return"/*"+Cu(t,li-1)+"*"+dp(e===47?e:Ii())}function Dw(e){for(;!Rg(br());)Ii();return Cu(e,li)}function Mw(e){return ww(Wd("",null,null,null,[""],e=Cw(e),0,[0],e))}function Wd(e,t,n,i,s,a,l,c,u){for(var f=0,g=0,m=l,v=0,S=0,I=0,A=1,w=1,P=1,R=0,_="",b=s,M=a,D=i,N=_;w;)switch(I=R,R=Ii()){case 40:if(I!=108&&Ut(N,m-1)==58){Gd(N+=xe(Yh(R),"&","&\f"),"&\f",Qv(f?c[f-1]:0))!=-1&&(P=-1);break}case 34:case 39:case 91:N+=Yh(R);break;case 9:case 10:case 13:case 32:N+=_w(I);break;case 92:N+=Rw($d()-1,7);continue;case 47:switch(br()){case 42:case 47:Sl(Nw(Pw(Ii(),$d()),t,n,u),u);break;default:N+="/"}break;case 123*A:c[f++]=ki(N)*P;case 125*A:case 59:case 0:switch(R){case 0:case 125:w=0;case 59+g:P==-1&&(N=xe(N,/\f/g,"")),S>0&&ki(N)-m&&Sl(S>32?sS(N+";",i,n,m-1,u):sS(xe(N," ","")+";",i,n,m-2,u),u);break;case 59:N+=";";default:if(Sl(D=rS(N,t,n,f,g,s,c,_,b=[],M=[],m,a),a),R===123)if(g===0)Wd(N,t,D,D,b,a,m,c,M);else switch(v===99&&Ut(N,3)===110?100:v){case 100:case 108:case 109:case 115:Wd(e,D,D,i&&Sl(rS(e,D,D,0,0,s,c,_,s,b=[],m,M),M),s,M,m,c,i?b:M);break;default:Wd(N,D,D,D,[""],M,0,c,M)}}f=g=S=0,A=P=1,_=N="",m=l;break;case 58:m=1+ki(N),S=I;default:if(A<1){if(R==123)--A;else if(R==125&&A++==0&&Ew()==125)continue}switch(N+=dp(R),R*A){case 38:P=g>0?1:(N+="\f",-1);break;case 44:c[f++]=(ki(N)-1)*P,P=1;break;case 64:br()===45&&(N+=Yh(Ii())),v=br(),g=m=ki(_=N+=Dw($d())),R++;break;case 45:I===45&&ki(N)==2&&(A=0)}}return a}function rS(e,t,n,i,s,a,l,c,u,f,g,m){for(var v=s-1,S=s===0?a:[""],I=eI(S),A=0,w=0,P=0;A<i;++A)for(var R=0,_=Qs(e,v+1,v=Qv(w=l[A])),b=e;R<I;++R)(b=Jv(w>0?S[R]+" "+_:xe(_,/&\f/g,S[R])))&&(u[P++]=b);return Eu(e,t,n,s===0?Au:c,u,f,g,m)}function Nw(e,t,n,i){return Eu(e,t,n,qv,dp(Tw()),Qs(e,2,-2),0,i)}function sS(e,t,n,i,s){return Eu(e,t,n,cp,Qs(e,0,i),Qs(e,i+1,-1),i,s)}function nI(e,t,n){switch(Iw(e,t)){case 5103:return et+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return et+e+e;case 4789:return wl+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return et+e+wl+e+dt+e+e;case 5936:switch(Ut(e,t+11)){case 114:return et+e+dt+xe(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return et+e+dt+xe(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return et+e+dt+xe(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return et+e+dt+e+e;case 6165:return et+e+dt+"flex-"+e+e;case 5187:return et+e+xe(e,/(\w+).+(:[^]+)/,et+"box-$1$2"+dt+"flex-$1$2")+e;case 5443:return et+e+dt+"flex-item-"+xe(e,/flex-|-self/g,"")+(Qi(e,/flex-|baseline/)?"":dt+"grid-row-"+xe(e,/flex-|-self/g,""))+e;case 4675:return et+e+dt+"flex-line-pack"+xe(e,/align-content|flex-|-self/g,"")+e;case 5548:return et+e+dt+xe(e,"shrink","negative")+e;case 5292:return et+e+dt+xe(e,"basis","preferred-size")+e;case 6060:return et+"box-"+xe(e,"-grow","")+et+e+dt+xe(e,"grow","positive")+e;case 4554:return et+xe(e,/([^-])(transform)/g,"$1"+et+"$2")+e;case 6187:return xe(xe(xe(e,/(zoom-|grab)/,et+"$1"),/(image-set)/,et+"$1"),e,"")+e;case 5495:case 3959:return xe(e,/(image-set\([^]*)/,et+"$1$`$1");case 4968:return xe(xe(e,/(.+:)(flex-)?(.*)/,et+"box-pack:$3"+dt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+et+e+e;case 4200:if(!Qi(e,/flex-|baseline/))return dt+"grid-column-align"+Qs(e,t)+e;break;case 2592:case 3360:return dt+xe(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(i,s){return t=s,Qi(i.props,/grid-\w+-end/)})?~Gd(e+(n=n[t].value),"span",0)?e:dt+xe(e,"-start","")+e+dt+"grid-row-span:"+(~Gd(n,"span",0)?Qi(n,/\d+/):+Qi(n,/\d+/)-+Qi(e,/\d+/))+";":dt+xe(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(i){return Qi(i.props,/grid-\w+-start/)})?e:dt+xe(xe(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return xe(e,/(.+)-inline(.+)/,et+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(ki(e)-1-t>6)switch(Ut(e,t+1)){case 109:if(Ut(e,t+4)!==45)break;case 102:return xe(e,/(.+:)(.+)-([^]+)/,"$1"+et+"$2-$3$1"+wl+(Ut(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Gd(e,"stretch",0)?nI(xe(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return xe(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,s,a,l,c,u,f){return dt+s+":"+a+f+(l?dt+s+"-span:"+(c?u:+u-+a)+f:"")+e});case 4949:if(Ut(e,t+6)===121)return xe(e,":",":"+et)+e;break;case 6444:switch(Ut(e,Ut(e,14)===45?18:11)){case 120:return xe(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+et+(Ut(e,14)===45?"inline-":"")+"box$3$1"+et+"$2$3$1"+dt+"$2box$3")+e;case 100:return xe(e,":",":"+dt)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return xe(e,"scroll-","scroll-snap-")+e}return e}function Jd(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function Ow(e,t,n,i){switch(e.type){case vw:if(e.children.length)break;case Sw:case cp:return e.return=e.return||e.value;case qv:return"";case Zv:return e.return=e.value+"{"+Jd(e.children,i)+"}";case Au:if(!ki(e.value=e.props.join(",")))return""}return ki(n=Jd(e.children,i))?e.return=e.value+"{"+n+"}":""}function bw(e){var t=eI(e);return function(n,i,s,a){for(var l="",c=0;c<t;c++)l+=e[c](n,i,s,a)||"";return l}}function kw(e){return function(t){t.root||(t=t.return)&&e(t)}}function Bw(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case cp:e.return=nI(e.value,e.length,n);return;case Zv:return Jd([Uo(e,{value:xe(e.value,"@","@"+et)})],i);case Au:if(e.length)return Aw(n=e.props,function(s){switch(Qi(s,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Ts(Uo(e,{props:[xe(s,/:(read-\w+)/,":"+wl+"$1")]})),Ts(Uo(e,{props:[s]})),_g(e,{props:oS(n,i)});break;case"::placeholder":Ts(Uo(e,{props:[xe(s,/:(plac\w+)/,":"+et+"input-$1")]})),Ts(Uo(e,{props:[xe(s,/:(plac\w+)/,":"+wl+"$1")]})),Ts(Uo(e,{props:[xe(s,/:(plac\w+)/,dt+"input-$1")]})),Ts(Uo(e,{props:[s]})),_g(e,{props:oS(n,i)});break}return""})}}var Fw={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Wn={},ea=typeof process<"u"&&Wn!==void 0&&(Wn.REACT_APP_SC_ATTR||Wn.SC_ATTR)||"data-styled",iI="active",oI="data-styled-version",wu="6.1.13",up=`/*!sc*/
`,eu=typeof window<"u"&&"HTMLElement"in window,Lw=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Wn!==void 0&&Wn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Wn.REACT_APP_SC_DISABLE_SPEEDY!==""?Wn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Wn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Wn!==void 0&&Wn.SC_DISABLE_SPEEDY!==void 0&&Wn.SC_DISABLE_SPEEDY!==""&&Wn.SC_DISABLE_SPEEDY!=="false"&&Wn.SC_DISABLE_SPEEDY),Hw={},_u=Object.freeze([]),ta=Object.freeze({});function rI(e,t,n){return n===void 0&&(n=ta),e.theme!==n.theme&&e.theme||t||n.theme}var sI=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),Uw=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Gw=/(^-|-$)/g;function aS(e){return e.replace(Uw,"-").replace(Gw,"")}var $w=/(a)(d)/gi,Sd=52,lS=function(e){return String.fromCharCode(e+(e>25?39:97))};function Dg(e){var t,n="";for(t=Math.abs(e);t>Sd;t=t/Sd|0)n=lS(t%Sd)+n;return(lS(t%Sd)+n).replace($w,"$1-$2")}var zh,aI=5381,Fs=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},lI=function(e){return Fs(aI,e)};function cI(e){return Dg(lI(e)>>>0)}function Ww(e){return e.displayName||e.name||"Component"}function jh(e){return typeof e=="string"&&!0}var dI=typeof Symbol=="function"&&Symbol.for,uI=dI?Symbol.for("react.memo"):60115,xw=dI?Symbol.for("react.forward_ref"):60112,Yw={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},zw={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},fI={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},jw=((zh={})[xw]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},zh[uI]=fI,zh);function cS(e){return("type"in(t=e)&&t.type.$$typeof)===uI?fI:"$$typeof"in e?jw[e.$$typeof]:Yw;var t}var Xw=Object.defineProperty,Vw=Object.getOwnPropertyNames,dS=Object.getOwnPropertySymbols,Kw=Object.getOwnPropertyDescriptor,qw=Object.getPrototypeOf,uS=Object.prototype;function hI(e,t,n){if(typeof t!="string"){if(uS){var i=qw(t);i&&i!==uS&&hI(e,i,n)}var s=Vw(t);dS&&(s=s.concat(dS(t)));for(var a=cS(e),l=cS(t),c=0;c<s.length;++c){var u=s[c];if(!(u in zw||n&&n[u]||l&&u in l||a&&u in a)){var f=Kw(t,u);try{Xw(e,u,f)}catch{}}}}return e}function na(e){return typeof e=="function"}function fp(e){return typeof e=="object"&&"styledComponentId"in e}function Nr(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function Mg(e,t){if(e.length===0)return"";for(var n=e[0],i=1;i<e.length;i++)n+=e[i];return n}function Ul(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function Ng(e,t,n){if(n===void 0&&(n=!1),!n&&!Ul(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)e[i]=Ng(e[i],t[i]);else if(Ul(t))for(var i in t)e[i]=Ng(e[i],t[i]);return e}function hp(e,t){Object.defineProperty(e,"toString",{value:t})}function Ql(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var Zw=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,i=0;i<t;i++)n+=this.groupSizes[i];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var i=this.groupSizes,s=i.length,a=s;t>=a;)if((a<<=1)<0)throw Ql(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(i),this.length=a;for(var l=s;l<a;l++)this.groupSizes[l]=0}for(var c=this.indexOfGroup(t+1),u=(l=0,n.length);l<u;l++)this.tag.insertRule(c,n[l])&&(this.groupSizes[t]++,c++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],i=this.indexOfGroup(t),s=i+n;this.groupSizes[t]=0;for(var a=i;a<s;a++)this.tag.deleteRule(i)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var i=this.groupSizes[t],s=this.indexOfGroup(t),a=s+i,l=s;l<a;l++)n+="".concat(this.tag.getRule(l)).concat(up);return n},e}(),xd=new Map,tu=new Map,Yd=1,vd=function(e){if(xd.has(e))return xd.get(e);for(;tu.has(Yd);)Yd++;var t=Yd++;return xd.set(e,t),tu.set(t,e),t},Qw=function(e,t){Yd=t+1,xd.set(e,t),tu.set(t,e)},Jw="style[".concat(ea,"][").concat(oI,'="').concat(wu,'"]'),e_=new RegExp("^".concat(ea,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),t_=function(e,t,n){for(var i,s=n.split(","),a=0,l=s.length;a<l;a++)(i=s[a])&&e.registerName(t,i)},n_=function(e,t){for(var n,i=((n=t.textContent)!==null&&n!==void 0?n:"").split(up),s=[],a=0,l=i.length;a<l;a++){var c=i[a].trim();if(c){var u=c.match(e_);if(u){var f=0|parseInt(u[1],10),g=u[2];f!==0&&(Qw(g,f),t_(e,g,u[3]),e.getTag().insertRules(f,s)),s.length=0}else s.push(c)}}},fS=function(e){for(var t=document.querySelectorAll(Jw),n=0,i=t.length;n<i;n++){var s=t[n];s&&s.getAttribute(ea)!==iI&&(n_(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function i_(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var gI=function(e){var t=document.head,n=e||t,i=document.createElement("style"),s=function(c){var u=Array.from(c.querySelectorAll("style[".concat(ea,"]")));return u[u.length-1]}(n),a=s!==void 0?s.nextSibling:null;i.setAttribute(ea,iI),i.setAttribute(oI,wu);var l=i_();return l&&i.setAttribute("nonce",l),n.insertBefore(i,a),i},o_=function(){function e(t){this.element=gI(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,s=0,a=i.length;s<a;s++){var l=i[s];if(l.ownerNode===n)return l}throw Ql(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),r_=function(){function e(t){this.element=gI(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),s_=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),hS=eu,a_={isServer:!eu,useCSSOMInjection:!Lw},nu=function(){function e(t,n,i){t===void 0&&(t=ta),n===void 0&&(n={});var s=this;this.options=rn(rn({},a_),t),this.gs=n,this.names=new Map(i),this.server=!!t.isServer,!this.server&&eu&&hS&&(hS=!1,fS(this)),hp(this,function(){return function(a){for(var l=a.getTag(),c=l.length,u="",f=function(m){var v=function(P){return tu.get(P)}(m);if(v===void 0)return"continue";var S=a.names.get(v),I=l.getGroup(m);if(S===void 0||!S.size||I.length===0)return"continue";var A="".concat(ea,".g").concat(m,'[id="').concat(v,'"]'),w="";S!==void 0&&S.forEach(function(P){P.length>0&&(w+="".concat(P,","))}),u+="".concat(I).concat(A,'{content:"').concat(w,'"}').concat(up)},g=0;g<c;g++)f(g);return u}(s)})}return e.registerId=function(t){return vd(t)},e.prototype.rehydrate=function(){!this.server&&eu&&fS(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(rn(rn({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var i=n.useCSSOMInjection,s=n.target;return n.isServer?new s_(s):i?new o_(s):new r_(s)}(this.options),new Zw(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(vd(t),this.names.has(t))this.names.get(t).add(n);else{var i=new Set;i.add(n),this.names.set(t,i)}},e.prototype.insertRules=function(t,n,i){this.registerName(t,n),this.getTag().insertRules(vd(t),i)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(vd(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),l_=/&/g,c_=/^\s*\/\/.*$/gm;function pI(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(i){return"".concat(t," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=pI(n.children,t)),n})}function d_(e){var t,n,i,s=ta,a=s.options,l=a===void 0?ta:a,c=s.plugins,u=c===void 0?_u:c,f=function(v,S,I){return I.startsWith(n)&&I.endsWith(n)&&I.replaceAll(n,"").length>0?".".concat(t):v},g=u.slice();g.push(function(v){v.type===Au&&v.value.includes("&")&&(v.props[0]=v.props[0].replace(l_,n).replace(i,f))}),l.prefix&&g.push(Bw),g.push(Ow);var m=function(v,S,I,A){S===void 0&&(S=""),I===void 0&&(I=""),A===void 0&&(A="&"),t=A,n=S,i=new RegExp("\\".concat(n,"\\b"),"g");var w=v.replace(c_,""),P=Mw(I||S?"".concat(I," ").concat(S," { ").concat(w," }"):w);l.namespace&&(P=pI(P,l.namespace));var R=[];return Jd(P,bw(g.concat(kw(function(_){return R.push(_)})))),R};return m.hash=u.length?u.reduce(function(v,S){return S.name||Ql(15),Fs(v,S.name)},aI).toString():"",m}var u_=new nu,Og=d_(),mI=Bi.createContext({shouldForwardProp:void 0,styleSheet:u_,stylis:Og});mI.Consumer;Bi.createContext(void 0);function bg(){return Be.useContext(mI)}var f_=function(){function e(t,n){var i=this;this.inject=function(s,a){a===void 0&&(a=Og);var l=i.name+a.hash;s.hasNameForId(i.id,l)||s.insertRules(i.id,l,a(i.rules,l,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,hp(this,function(){throw Ql(12,String(i.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Og),this.name+t.hash},e}(),h_=function(e){return e>="A"&&e<="Z"};function gS(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(n===1&&i==="-"&&e[0]==="-")return e;h_(i)?t+="-"+i.toLowerCase():t+=i}return t.startsWith("ms-")?"-"+t:t}var yI=function(e){return e==null||e===!1||e===""},SI=function(e){var t,n,i=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!yI(a)&&(Array.isArray(a)&&a.isCss||na(a)?i.push("".concat(gS(s),":"),a,";"):Ul(a)?i.push.apply(i,Hl(Hl(["".concat(s," {")],SI(a),!1),["}"],!1)):i.push("".concat(gS(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in Fw||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function Xo(e,t,n,i){if(yI(e))return[];if(fp(e))return[".".concat(e.styledComponentId)];if(na(e)){if(!na(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return Xo(s,t,n,i)}var a;return e instanceof f_?n?(e.inject(n,i),[e.getName(i)]):[e]:Ul(e)?SI(e):Array.isArray(e)?Array.prototype.concat.apply(_u,e.map(function(l){return Xo(l,t,n,i)})):[e.toString()]}function vI(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(na(n)&&!fp(n))return!1}return!0}var g_=lI(wu),p_=function(){function e(t,n,i){this.rules=t,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&vI(t),this.componentId=n,this.baseHash=Fs(g_,n),this.baseStyle=i,nu.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,i){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=Nr(s,this.staticRulesId);else{var a=Mg(Xo(this.rules,t,n,i)),l=Dg(Fs(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,l)){var c=i(a,".".concat(l),void 0,this.componentId);n.insertRules(this.componentId,l,c)}s=Nr(s,l),this.staticRulesId=l}else{for(var u=Fs(this.baseHash,i.hash),f="",g=0;g<this.rules.length;g++){var m=this.rules[g];if(typeof m=="string")f+=m;else if(m){var v=Mg(Xo(m,t,n,i));u=Fs(u,v+g),f+=v}}if(f){var S=Dg(u>>>0);n.hasNameForId(this.componentId,S)||n.insertRules(this.componentId,S,i(f,".".concat(S),void 0,this.componentId)),s=Nr(s,S)}}return s},e}(),gp=Bi.createContext(void 0);gp.Consumer;var Xh={};function m_(e,t,n){var i=fp(e),s=e,a=!jh(e),l=t.attrs,c=l===void 0?_u:l,u=t.componentId,f=u===void 0?function(b,M){var D=typeof b!="string"?"sc":aS(b);Xh[D]=(Xh[D]||0)+1;var N="".concat(D,"-").concat(cI(wu+D+Xh[D]));return M?"".concat(M,"-").concat(N):N}(t.displayName,t.parentComponentId):u,g=t.displayName,m=g===void 0?function(b){return jh(b)?"styled.".concat(b):"Styled(".concat(Ww(b),")")}(e):g,v=t.displayName&&t.componentId?"".concat(aS(t.displayName),"-").concat(t.componentId):t.componentId||f,S=i&&s.attrs?s.attrs.concat(c).filter(Boolean):c,I=t.shouldForwardProp;if(i&&s.shouldForwardProp){var A=s.shouldForwardProp;if(t.shouldForwardProp){var w=t.shouldForwardProp;I=function(b,M){return A(b,M)&&w(b,M)}}else I=A}var P=new p_(n,v,i?s.componentStyle:void 0);function R(b,M){return function(D,N,k){var L=D.attrs,z=D.componentStyle,V=D.defaultProps,X=D.foldedComponentIds,Q=D.styledComponentId,q=D.target,ie=Bi.useContext(gp),oe=bg(),ee=D.shouldForwardProp||oe.shouldForwardProp,x=rI(N,ie,V)||ta,K=function(Me,he,Ee){for(var Re,de=rn(rn({},he),{className:void 0,theme:Ee}),ve=0;ve<Me.length;ve+=1){var Ge=na(Re=Me[ve])?Re(de):Re;for(var Ae in Ge)de[Ae]=Ae==="className"?Nr(de[Ae],Ge[Ae]):Ae==="style"?rn(rn({},de[Ae]),Ge[Ae]):Ge[Ae]}return he.className&&(de.className=Nr(de.className,he.className)),de}(L,N,x),Z=K.as||q,B={};for(var j in K)K[j]===void 0||j[0]==="$"||j==="as"||j==="theme"&&K.theme===x||(j==="forwardedAs"?B.as=K.forwardedAs:ee&&!ee(j,Z)||(B[j]=K[j]));var ce=function(Me,he){var Ee=bg(),Re=Me.generateAndInjectStyles(he,Ee.styleSheet,Ee.stylis);return Re}(z,K),pe=Nr(X,Q);return ce&&(pe+=" "+ce),K.className&&(pe+=" "+K.className),B[jh(Z)&&!sI.has(Z)?"class":"className"]=pe,B.ref=k,Be.createElement(Z,B)}(_,b,M)}R.displayName=m;var _=Bi.forwardRef(R);return _.attrs=S,_.componentStyle=P,_.displayName=m,_.shouldForwardProp=I,_.foldedComponentIds=i?Nr(s.foldedComponentIds,s.styledComponentId):"",_.styledComponentId=v,_.target=i?s.target:e,Object.defineProperty(_,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(b){this._foldedDefaultProps=i?function(M){for(var D=[],N=1;N<arguments.length;N++)D[N-1]=arguments[N];for(var k=0,L=D;k<L.length;k++)Ng(M,L[k],!0);return M}({},s.defaultProps,b):b}}),hp(_,function(){return".".concat(_.styledComponentId)}),a&&hI(_,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),_}function pS(e,t){for(var n=[e[0]],i=0,s=t.length;i<s;i+=1)n.push(t[i],e[i+1]);return n}var mS=function(e){return Object.assign(e,{isCss:!0})};function II(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(na(e)||Ul(e))return mS(Xo(pS(_u,Hl([e],t,!0))));var i=e;return t.length===0&&i.length===1&&typeof i[0]=="string"?Xo(i):mS(Xo(pS(i,t)))}function kg(e,t,n){if(n===void 0&&(n=ta),!t)throw Ql(1,t);var i=function(s){for(var a=[],l=1;l<arguments.length;l++)a[l-1]=arguments[l];return e(t,n,II.apply(void 0,Hl([s],a,!1)))};return i.attrs=function(s){return kg(e,t,rn(rn({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},i.withConfig=function(s){return kg(e,t,rn(rn({},n),s))},i}var AI=function(e){return kg(m_,e)},kt=AI;sI.forEach(function(e){kt[e]=AI(e)});var y_=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=vI(t),nu.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,i,s){var a=s(Mg(Xo(this.rules,n,i,s)),""),l=this.componentId+t;i.insertRules(l,l,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,i,s){t>2&&nu.registerId(this.componentId+t),this.removeStyles(t,i),this.createStyles(t,n,i,s)},e}();function S_(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=II.apply(void 0,Hl([e],t,!1)),s="sc-global-".concat(cI(JSON.stringify(i))),a=new y_(i,s),l=function(u){var f=bg(),g=Bi.useContext(gp),m=Bi.useRef(f.styleSheet.allocateGSInstance(s)).current;return f.styleSheet.server&&c(m,u,f.styleSheet,g,f.stylis),Bi.useLayoutEffect(function(){if(!f.styleSheet.server)return c(m,u,f.styleSheet,g,f.stylis),function(){return a.removeStyles(m,f.styleSheet)}},[m,u,f.styleSheet,g,f.stylis]),null};function c(u,f,g,m,v){if(a.isStatic)a.renderStyles(u,Hw,g,v);else{var S=rn(rn({},f),{theme:rI(f,m,l.defaultProps)});a.renderStyles(u,S,g,v)}}return Bi.memo(l)}function TI(e,t){var n=Be.useRef(null),i=Be.useRef(!1),s=Be.useRef(e);s.current=e;var a=Be.useCallback(function(c){i.current&&(s.current(c),n.current=requestAnimationFrame(a))},[]),l=Be.useMemo(function(){return[function(){i.current&&(i.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){i.current||(i.current=!0,n.current=requestAnimationFrame(a))},function(){return i.current}]},[]);return Be.useEffect(function(){return l[0]},[]),l}function v_(e,t,n,i,s){var l;(l=e.onExit)==null||l.call(e,i,t);const a=s.find(({id:c})=>c===t);return a!=null&&a.onEnter?a.onEnter(i,n):{...n,enteredAt:i.updateContext.gameState.time}}function I_(e,t){return t.find(({id:n})=>n===e)}function A_(e,t){return e!==t}function T_(e){e&&console.warn(`No handler found for state: ${e}`)}const _l="bushGrowing",Dr="bushFull",zd="bushSpreading",Gl="bushDying",_t=24,Nt=10,Ze=4e3,Qe=4e3,iu=5,E_=15,C_=5e3,ro=100,so=20,ao=60,EI=200,w_=1e3,__=5,R_=3,P_=12,D_=940,Bg=20,yS=90,CI=100,fo=5,M_=.5,qo=30,lo=.1,vl=.9,N_=2,O_=2;var Tn=(e=>(e.Berry="berry",e.Meat="meat",e))(Tn||{});const pp={berry:"",meat:""};function wI(e,t){return e+t*65536}function _I(e){return{gridX:e%65536,gridY:Math.floor(e/65536)}}function b_(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function RI(){return{lastUpdateTime:0,sectors:{}}}const Xt=20,ou=100,PI=20,DI=0,k_=20,B_=1,MI=.15,F_=.5,L_=.01,H_=24,U_="#6B5344",G_="#4A3728",SS=.85,NI=35,$_=30,vS=1.25,IS=40,Vh=Math.PI/6,OI=.5,W_=1,Ru=10,$l=80,bI=3,il=5,sn=150,mp=sn*.8,x_=sn*.2,an=sn*.8,Zo=30,kI=10,Y_=10,z_=.5,je=30,xr=je*.75,Pu=30,Jl=Pu*.75,BI=50,j_=20,X_=$l*.8,V_=.7,Wl=16,Du=40,K_=24,yp=16,q_=72/3,AS=24,Z_=1.25,Q_=1.5,ia=sn*.6,Mu=50,J_=1,eR=350,Sp=$l*.65,tR=80,nR=50,iR=1,oR=128,FI=10,TS=100,vp=35,ho=30,Nu=.5,Ou=2.5,Ip=20,vn=250,Ap=.4,Tp=150,Ep=6,rR=5,Cp=2,bu=.5,ku=1.5,sR=1,aR=.5,lR=.5,cR=1.5,dR=.25,uR=2.5,fR=45,hR=.05,gR=200;var ut=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(ut||{}),Xe=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e[e.SupplyChain=5]="SupplyChain",e))(Xe||{}),Yr=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(Yr||{});const ru=24,pR=24;let mR=0;function yR(){return`notification-${Date.now()}-${mR++}`}function xl(e,t){if(t.identifier){const i=e.notifications.find(s=>s.identifier===t.identifier);if(i){if(i.dismissedUntil&&e.time<i.dismissedUntil)return;i.message=t.message,i.timestamp=e.time,i.creationTime=Date.now(),i.duration=t.duration,i.targetEntityIds=t.targetEntityIds,i.highlightedEntityIds=t.highlightedEntityIds,i.targetPosition=t.targetPosition,i.targetArea=t.targetArea,i.targetRadius=t.targetRadius,i.isDismissed=!1,i.dismissedUntil=void 0;return}}const n={...t,id:yR(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function SR(e,t){const n=e.notifications.find(i=>i.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+pR))}function vR(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function IR(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const i of n.highlightedEntityIds){const s=e.entities.entities[i];s&&(s.isHighlighted=!0)}}function wp(e,t,n,i){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,l={x:Math.cos(s)*a,y:Math.sin(s)*a},c=zn(e,l);return{x:(c.x%n+n)%n,y:(c.y%i+i)%i}}function Kn(e,t,n,i){const s=t,{width:a,height:l}=t.mapDimensions,c={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},u=f=>{for(let g=0;g<f.length;g++){const m=f[g];if(i!==void 0&&m.id===i)continue;const v=Nn(e,m.position,a,l),S=n+m.radius;if(v<S*S)return!0}return!1};return u(s.search.human.byRect(c))||u(s.search.berryBush.byRect(c))||u(s.search.corpse.byRect(c))}function AR(e,t,n,i,s){const a=t.mapDimensions.width,l=t.mapDimensions.height;if(!Kn(e,t,i,s)&&!Li(t.soilDepletion,e,a,l))return e;const c=i;for(let u=c;u<=n;u+=c){const f=Math.ceil(2*Math.PI*u/c);for(let g=0;g<f;g++){const m=g/f*2*Math.PI,v={x:Math.cos(m)*u,y:Math.sin(m)*u},S=zn(e,v),I={x:(S.x%a+a)%a,y:(S.y%l+l)%l};if(!Kn(I,t,i,s)&&!Li(t.soilDepletion,I,a,l))return I}}return null}function In(e,t){var l,c;const n=t;if((c=(l=n.cache)==null?void 0:l.tribeCenters)!=null&&c[e])return n.cache.tribeCenters[e];const i=t.search.building.byProperty("ownerId",e);if(i.length>0){const u=i.map(f=>f.position);return n.cache.tribeCenters[e]=Qd(u)}const s=ci(e,t);if(s.length===0){const u=t.entities.entities[e];return n.cache.tribeCenters[e]=u?u.position:{x:0,y:0}}const a=s.map(u=>u.position);return n.cache.tribeCenters[e]=Qd(a)}function ES(e,t){const i=[...zl(e,t),e].map(s=>s.position);return Qd(i)}function Fg(e,t,n){const i=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,l=e.y-t.position.y;return Math.abs(a)>i/2&&(a-=Math.sign(a)*i),Math.abs(l)>s/2&&(l-=Math.sign(l)*s),Math.abs(a)<=t.width/2&&Math.abs(l)<=t.height/2}const oa=80,yn=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],Se=20,Ui=(e,t,n)=>{var c,u,f,g;if(!e||!t||e===t)return!1;const i=n.entities.entities[e],s=n.entities.entities[t],a=(u=(c=i==null?void 0:i.tribeControl)==null?void 0:c.diplomacy)==null?void 0:u[t],l=(g=(f=s==null?void 0:s.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[e];return a===ut.Hostile||l===ut.Hostile},Kr=(e,t,n)=>e.id===t.id?!1:Ui(e.leaderId,t.leaderId,n),Vt=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:Ui(e.leaderId,t.ownerId,n),nr=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=an||t.hunger>=an||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||Kr(e,t,n))return!1;const i=e.gender==="female"?e:t;return!(i.isPregnant||i.age>Du)},ra=1,sa=150*.6,CS=150*.25,TR=150*.7,ER=150*.8,CR=400,LI=800,wR=150,_R=300,RR=2,wS=800,PR=500,DR=150*.85,MR=150,HI=3,NR=24,UI=600,OR=1,bR=1,kR=.5,BR=1,FR=.5,LR=2,Ns=24,Ls=12,Lg=24,GI=1.5,HR=150,UR=200,GR=100,$R=.7,WR=300,xR=400,Kh=600,YR=600,su=.15,Hg=200,Xs=30*.75*1.2,$I=20,WI=.3,xI=.6,YI=.8,zR=1,jR=3,XR=5,VR=6,_S=.5,KR=.4,qR=.6,ZR=.8,QR=2,eo=800,RS=2,Ug=.7,Gg=.5,Hs=10,JR=.5,Vs=400,zI=800,e1=8,t1=16,jI=5,XI=600,to=100,n1=100,VI=150,PS=600,DS=250,i1=.5,o1=.7,r1=300,s1=150;function KI(e){const t=Math.floor(e.x/Se),n=Math.floor(e.y/Se);return{x:t,y:n}}function $g(e,t){const n=Math.ceil(t/Se),i=e%n*Se+Se/2,s=Math.floor(e/n)*Se+Se/2;return{x:i,y:s}}function a1(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(i/Se),l=Math.floor(s/Se),c=Math.ceil(t/Se);return l*c+a}function jn(e,t,n){const i=a1({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[i]||null}function _p(e,t){return t.terrainOwnership.includes(e)}function qI(e,t,n,i){var l;const s=n;return(l=s.search)!=null&&l.human?s.search.human.byRadius(e,i).some(c=>Ui(t,c.leaderId,n)):!1}function l1(e,t,n,i,s=!1,a){if(s&&a&&qI(e,a,i,VI))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:l,height:c}=i.mapDimensions,u=Math.ceil(l/Se),f=Math.ceil(c/Se),g=Math.ceil(t/Se),m=t*t,v=Math.floor(e.x/Se),S=Math.floor(e.y/Se);let I=!1,A=!1;for(let w=-g;w<=g;w++)for(let P=-g;P<=g;P++){const R=((v+P)%u+u)%u,_=((S+w)%f+f)%f,b=R*Se+Se/2,M=_*Se+Se/2;if(Nn(e,{x:b,y:M},l,c)<=m){const N=_*u+R,k=i.terrainOwnership[N];if(k===n)I=!0;else if(k!==null){if(s&&a&&Ui(a,k,i))continue;A=!0}}}return A?{valid:!1,reason:"Position overlaps with another tribe's territory"}:I?{valid:!0}:_p(n,i)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function ZI(e,t,n,i){if(!_p(n,i))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(qI(e,n,i,VI))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=i.mapDimensions,l=Math.ceil(s/Se),c=Math.ceil(a/Se),u=Math.ceil(t/Se),f=t*t,g=Math.floor(e.x/Se),m=Math.floor(e.y/Se);let v=!1;for(let S=-u;S<=u;S++){for(let I=-u;I<=u;I++){const A=((g+I)%l+l)%l,w=((m+S)%c+c)%c,P=A*Se+Se/2,R=w*Se+Se/2;if(Nn(e,{x:P,y:R},s,a)<=f){const b=w*l+A;if(i.terrainOwnership[b]===n){v=!0;break}}}if(v)break}return v?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function QI(e,t,n,i=0,s=!1,a){if(i>0){const c=l1(e,i,t,n,s,a);return c.valid?{canPlace:!0}:{canPlace:!1,reason:c.reason}}const l=jn(e.x,e.y,n);return l===null||l===t?{canPlace:!0}:s&&a&&Ui(a,l,n)?{canPlace:!0}:l!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function Wg(e,t,n){const i=jn(e.x,e.y,n);return i===null||i===t}function Xn(e,t,n){const i=jn(e.x,e.y,n);return i===null||i===t||!Ui(t,i,n)}function c1(e,t,n,i){if(Wg(t,n,i))return t;const{width:s,height:a}=i.mapDimensions,l=Ye(e,t,s,a),c=Math.sqrt(l.x**2+l.y**2);if(c===0)return e;let u=e;const f=U(e,t,s,a),g=f/10;for(let m=g;m<=f;m+=g){const v={x:((e.x+l.x*m/c)%s+s)%s,y:((e.y+l.y*m/c)%a+a)%a};if(Wg(v,n,i))u=v;else break}return u}function JI(e,t,n,i,{allowOverwrite:s}){const{width:a,height:l}=i.mapDimensions,c=Math.ceil(a/Se),u=Math.ceil(l/Se),f=Math.ceil(t/Se),g=Math.floor(e.x/Se),m=Math.floor(e.y/Se);for(let R=-f;R<=f;R++)for(let _=-f;_<=f;_++){const b=((g+_)%c+c)%c,M=((m+R)%u+u)%u,D=b*Se+Se/2,N=M*Se+Se/2;if(U(e,{x:D,y:N},a,l)<=t){const L=M*c+b,z=i.terrainOwnership[L];(s||z===null||z===n)&&(i.terrainOwnership[L]=n)}}const v=3,S=f+v+2,I=[];for(let R=-S;R<=S;R++)for(let _=-S;_<=S;_++){const b=((g+_)%c+c)%c,M=((m+R)%u+u)%u,D=M*c+b;if(i.terrainOwnership[D]===null){let N=!1;const k=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const L of k){let z=!1,V=!1;for(let X=1;X<=v;X++){const Q=((b+L.x*X)%c+c)%c,ie=((M+L.y*X)%u+u)%u*c+Q;if(i.terrainOwnership[ie]===n){z=!0;break}}if(z)for(let X=1;X<=v;X++){const Q=((b-L.x*X)%c+c)%c,ie=((M-L.y*X)%u+u)%u*c+Q;if(i.terrainOwnership[ie]===n){V=!0;break}}if(z&&V){N=!0;break}}N&&I.push(D)}}for(const R of I)i.terrainOwnership[R]=n;const A=250,w=new Set;for(let R=-S;R<=S;R++)for(let _=-S;_<=S;_++){const b=((g+_)%c+c)%c,D=((m+R)%u+u)%u*c+b;if(i.terrainOwnership[D]===null&&!w.has(D)){const N=[],k=[D];w.add(D),N.push(D);let L=!0,z=0;for(;z<k.length;){const V=k[z++];if(N.length>A){L=!1;break}const X=V%c,Q=Math.floor(V/c),q=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:ie,ny:oe}of q){const ee=((X+ie)%c+c)%c,K=((Q+oe)%u+u)%u*c+ee;i.terrainOwnership[K]===null&&!w.has(K)&&(w.add(K),L&&(N.push(K),k.push(K)))}}if(L&&N.length<=A)for(const V of N)i.terrainOwnership[V]=n}}const P=[];for(let R=-S;R<=S;R++)for(let _=-S;_<=S;_++){const b=((g+_)%c+c)%c,M=((m+R)%u+u)%u,D=M*c+b;if(i.terrainOwnership[D]===null){let N=0;for(let k=-1;k<=1;k++)for(let L=-1;L<=1;L++){if(L===0&&k===0)continue;const z=((b+L)%c+c)%c,X=((M+k)%u+u)%u*c+z;i.terrainOwnership[X]===n&&N++}N>=5&&P.push(D)}}for(const R of P)i.terrainOwnership[R]=n}function eA(e,t,n,i){JI(e,t,n,i,{allowOverwrite:!1})}function tA(e,t,n,i){JI(e,t,n,i,{allowOverwrite:!0})}function d1(e,t,n){const{width:i,height:s}=n.mapDimensions,a=Math.ceil(i/Se),l=Math.ceil(s/Se),c=Math.floor(e.x/Se),u=Math.floor(e.y/Se),f=50;for(let g=0;g<=f;g++){const m=-g,v=g,S=-g,I=g;for(let A=S;A<=I;A++)for(let w=m;w<=v;w++){if(g>0&&w>m&&w<v&&A>S&&A<I)continue;const P=((c+w)%a+a)%a,R=((u+A)%l+l)%l,_=R*a+P;if(n.terrainOwnership[_]===t){let b=!1;const M=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:D,ny:N}of M){const k=((P+D)%a+a)%a,z=((R+N)%l+l)%l*a+k;if(n.terrainOwnership[z]!==t){b=!0;break}}if(b)return{x:P*Se+Se/2,y:R*Se+Se/2}}}}return null}function au(e,t,n){const i=e.terrainOwnership;for(let s=0;s<i.length;s++)i[s]===t&&(i[s]=n)}function Fe(e,t,n,i,s){const a=t,l=i,c="position"in e&&e.id?e:null,u=c?c.position:e,f=a.search[n].byRadius(u,l);let g=null,m=l;for(const v of f){if(v.id===(c==null?void 0:c.id)||s&&!s(v))continue;const S=U(u,v.position,t.mapDimensions.width,t.mapDimensions.height);S<m&&(m=S,g=v)}return g}function u1(e,t,n,i){return t.search[n].byRadius(e,i)}function MS(e,t,n,i){return u1(e,t,n,i).length}function At(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function nA(e,t){var l;const i=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const c of i){if(c.attackTargetId!==e)continue;const u=U(c.position,((l=t.entities.entities[e])==null?void 0:l.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<a&&(s=c,a=u)}return s}function iA(e){return e.search.human.all()}function f1(e,t,n){const{width:i,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const l of a){const c=U(e,l.position,i,s),u=l.type==="tree"?l.radius*2:l.radius;if(c<u)return l}}function h1(e,t,n,i,s){const{width:a,height:l}=i.mapDimensions,c=n*n;if(s){for(let v=0;v<s.length;v++)if(Nn(e,s[v],a,l)<c)return!0;return!1}const u=iA(i),f=new Set;for(let v=0;v<u.length;v++){const S=u[v];S.leaderId&&S.leaderId!==t&&f.add(S.leaderId)}const g=f.values();let m=g.next();for(;!m.done;){const v=m.value,S=In(v,i);if(Nn(e,S,a,l)<c)return!0;m=g.next()}return!1}var _e=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(_e||{});function $e(e,t,n,i,s,a,l){const c={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:i,entityId:s,targetPosition:a,targetEntityId:l};return e.visualEffects.push(c),e.nextVisualEffectId++,c.id}const Ke=1,Yl=3,io=100,oA=20,co=10,g1=.5,kr=150,p1=25,m1=.5,Br=100,rA=25,Rp=.5,sA=15,lu=4,y1=.75,S1=15,xg=8,aA=20,v1=.5;function aa(e,t,n,i,s,a){if(n===void 0)return!1;const{width:l,height:c}=i.mapDimensions;if(s&&a!==void 0&&Nn(s,e,l,c)>a*a)return!1;const u=sp(t),f=Math.sqrt(u.width*u.width+u.height*u.height)/2;if(Kn(e,i,f*.8))return!1;if(t===fe.PlantingZone){const{depletedSectors:A}=BA(i.soilDepletion,e,u.width,u.height,l,c);if(A.length>0)return!1}const m=i.search.building.byRadius(e,f*2);for(const A of m){const w=Nn(e,A.position,l,c),P=(Math.max(u.width,u.height)+Math.max(A.width,A.height))/2;if(w<P*P*.81)return!1}const v=t===fe.BorderPost;return!!QI(e,n,i,v?rp:oa,v,n).canPlace}function I1(e){const t=[],n=2*Math.PI/e;for(let i=0;i<e;i++){const s=i*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function Ks(e,t,n,i,s,a,l){const c=performance.now(),u=n,f=sp(e),g=n.mapDimensions.width,m=n.mapDimensions.height,v=u.search.building.byProperty("ownerId",t),S=[];if(v.length>0){a&&S.unshift(a);const R=In(t,n),_=[...v].sort((b,M)=>{const D=Nn(b.position,R,g,m),N=Nn(M.position,R,g,m);return D-N});S.push(..._.map(b=>b.position))}else S.push(In(t,n));const I=Math.min(S.length,e1),A=Math.max(f.width,f.height),w=A+20,P=A/2;for(let R=0;R<I;R++){const _=S[R];for(let b=w;b<=i;b+=P){const M=Math.max(8,Math.min(t1,Math.ceil(2*Math.PI*b/A))),D=I1(M);for(let N=0;N<M;N++){const k=D[N].cos*b,L=D[N].sin*b,z=_.x+k,V=_.y+L,X=(z%g+g)%g,Q=(V%m+m)%m;if(!h1({x:X,y:Q},t,s,n,l)&&aa({x:X,y:Q},e,t,n))return performance.now()-c,{x:X,y:Q}}}}performance.now()-c}function Vo(e,t,n,i){if(t===fe.BorderPost)return tA(e,rp,n,i),$e(i,_e.BorderClaim,e,Ke,n),null;const s=Vb(i.entities,e,t,n);return t===fe.Bonfire&&(s.storageCapacity=lu,s.storedItems=[]),eA(e,oa,n,i),t===fe.PlantingZone&&Ll(i),s}function Yg(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===fe.PlantingZone&&Ll(t))}function A1(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let l=e.x-a.position.x,c=e.y-a.position.y;const u=t.mapDimensions.width,f=t.mapDimensions.height;if(Math.abs(l)>u/2&&(l-=Math.sign(l)*u),Math.abs(c)>f/2&&(c-=Math.sign(c)*f),Math.abs(l)<=a.width/2&&Math.abs(c)<=a.height/2)return a}}var se=(e=>(e.Leader="leader",e.Gatherer="gatherer",e.Planter="planter",e.Hunter="hunter",e.Mover="mover",e.Warrior="warrior",e))(se||{});const Rt=30,ha=Rt*.6,lA="#4CAF50",cA="#FF5722",dA="#9C27B0",T1="#2196F3",uA="#FFC107",E1="#DC143C",Pp="#FFFFFF",Dp=[5,5],Bu=5,la=15,C1=20,w1=16,_1=10,R1=16,P1=16,cu=["","","","","","","","","",""],Rl=8,D1="#FFFFFF",it=18,tt=15,M1="rgba(0, 0, 0, 0.7)",N1=4,ko=150,Un=15,Vi=10,xo="#555",O1="#f44336",b1="#4CAF50",k1="#2196F3",B1="#FFC107",Id=16,Ji=32,Ad=28,F1=10,L1=8,H1=8,U1=8,Sr=28,ol=40,rl=10,NS=8,G1=11,qh=40,OS=5,$1=10,W1="#FFA500",x1="#808080",oo=120,fA=30,Y1=20,xn="#2d3748",ft="#ffffff",Il="#4a5568",hA=5,Mp="#bdc9f792",gA="#272c36ff",pA="#a0aec0",du=300,mA="rgba(255, 255, 255, 0.5)",z1="rgba(0, 0, 0, 0.8)",j1="#FFFFFF",bS=14,kS=8,BS=-15,yA="#FFD700",SA=5,X1=10,Zh=12,V1=10,K1="#4CAF50",q1="#F44336",Z1="#FFC107",Q1="rgba(255, 255, 255, 0.2)",FS="#FFFFFF",J1="#FF6B6B",eP=5,vA=30,sl=50,Td=8,LS=10,tP="rgba(0, 0, 0, 0.5)",nP="#FFFFFF",iP=33,oP=400,rP=20,sP=10,aP="rgba(0, 0, 0, 0.7)",lP="#FFFFFF",Qh=20,HS=16,cP=.5,US=5,IA="#FFD700",dP=40,Np=4,AA=3,uP=5,TA=20,EA=5,fP="#FFFFFF",hP="#FF6B6B",Gn=80,vr=10,Ed=300,Ir=15,gP=8,pP="rgba(0, 0, 0, 0.8)",mP="#FFFFFF",Jh=14,GS=10,Pi=20,yP="#FF6B6B",SP="#4CAF50",$S="#FFD700",vP="rgba(255, 255, 0, 0.3)",IP=2,AP=500,TP=120,EP=45,CP="#FFD700",wP=3,_P=4,eg=225,WS=20,RP="#666",PP="#1a2a3a";let tg=0;function uu(){const e=cu[tg];return tg=(tg+1)%cu.length,e}function xS(e,t,n){return t.search.human.byRadius(e.position,n).filter(a=>{var c;return!(a.id===e.id||a.gender===e.gender||!a.isAdult||a.hunger>=an||(a.procreationCooldown||0)>0||a.gender==="female"&&a.isPregnant||(e.motherId===a.id||e.fatherId===a.id)&&((c=a.partnerIds)!=null&&c.length))}).sort((a,l)=>{const c=a.id===e.motherId||a.id===e.fatherId,u=e.id===a.motherId||e.id===a.fatherId,f=l.id===e.motherId||l.id===e.fatherId,g=e.id===l.motherId||e.id===l.fatherId;return c||u?1:f||g?-1:a.age-l.age})}function zr(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),i=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(i),t.length>0)return t[0];if(n.sort(i),n.length>0)return n[0]}function On(e,t){const n=e,i=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...i,...s]}function DP(e,t,n){var s;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||e.motherId&&e.motherId===t.motherId||e.fatherId&&e.fatherId===t.fatherId||(s=e.partnerIds)!=null&&s.includes(t.id))return!0;if(e.motherId){const a=n.entities.entities[e.motherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(e.fatherId){const a=n.entities.entities[e.fatherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(t.motherId){const a=n.entities.entities[t.motherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}if(t.fatherId){const a=n.entities.entities[t.fatherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}return!1}function zg(e,t){var a,l,c,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(l=t.partnerIds)!=null&&l.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,i=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((c=e.ancestorIds)==null?void 0:c.some(f=>t.ancestorIds.includes(f)))||((u=t.ancestorIds)==null?void 0:u.some(f=>e.ancestorIds.includes(f)));return n||i||s}function MP(e,t){const n=[];if(e.motherId){const i=t.entities.entities[e.motherId];i&&n.push(i)}if(e.fatherId){const i=t.entities.entities[e.fatherId];i&&n.push(i)}return n}function CA(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const i=t.entities.entities[n];if(i&&i.gender==="male")return i}return null}function jg(e,t){var n;if(!e.isAdult){if(e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human")return i}if(e.motherId){const i=t.entities.entities[e.motherId];if(i&&i.type==="human")return i}}if(e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human"&&((n=zr(On(t,i)))==null?void 0:n.id)===e.id)return i}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?CA(e,t):null}function fu(e,t){let n=e;const i=new Set;i.add(n.id);for(let s=0;s<bI;s++){let a=null;if(n.gender==="female"&&(a=CA(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||i.has(a.id))break;n=a,i.add(n.id)}return n}function zl(e,t){var i;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(i=e.partnerIds)==null||i.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),On(t,e).forEach(s=>n.add(s)),Array.from(n)}function hu(e,t){const n=new Map;function i(s){const a=On(t,s);for(const l of a)n.has(l.id)||(n.set(l.id,l),i(l))}return i(e),Array.from(n.values())}function ci(e,t){return t.search.human.byProperty("leaderId",e)}function gu(e,t,n=new Map,i=new Set){var a;if(n.has(e))return n.get(e);if(i.has(e))return e;i.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const l=s.partnerIds.find(c=>{const u=t.entities.entities[c];return u&&u.gender==="male"});if(l){const c=gu(l,t,n,i);return n.set(e,c),c}}if(s.fatherId&&t.entities.entities[s.fatherId]){const l=gu(s.fatherId,t,n,i);return n.set(e,l),l}return n.set(e,e),e}function NP(e,t){e.leaderId=e.id,e.tribeRole=se.Leader,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{roleWeights:{[se.Leader]:0,[se.Gatherer]:2,[se.Planter]:2,[se.Hunter]:2,[se.Mover]:2,[se.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}}),e.tribeInfo||(e.tribeInfo={tribeBadge:uu(),tribeColor:yn[Math.floor(Math.random()*yn.length)]}),e.tribeControl||(e.tribeControl={roleWeights:{[se.Leader]:0,[se.Gatherer]:2,[se.Planter]:2,[se.Hunter]:2,[se.Mover]:2,[se.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}})}function OP(e,t){if(e.length===0)return null;const n=new Map,i=new Map;for(const l of e){const c=gu(l.id,t,n);i.has(c)||i.set(c,[]),i.get(c).push(l)}let s=null,a=0;for(const[l,c]of i.entries())c.length>a&&(a=c.length,s=l);return s&&t.entities.entities[s]||null}function ec(e,t){var g,m,v;const n=new Map;for(let S=0;S<e.terrainOwnership.length;S++){const I=e.terrainOwnership[S];I!==null&&(n.has(I)||n.set(I,[]),n.get(I).push(S))}const{width:i,height:s}=e.mapDimensions,a=Math.ceil(i/Se),l=new Map,c=Object.values(e.entities.entities).filter(S=>S.type==="human");for(const S of c)S.leaderId&&(l.has(S.leaderId)||l.set(S.leaderId,{leaderId:S.leaderId,tribeInfo:S.tribeInfo,members:[]}),(g=l.get(S.leaderId))==null||g.members.push(S));const u=t?(v=(m=e.entities.entities[t])==null?void 0:m.tribeControl)==null?void 0:v.diplomacy:void 0,f=Array.from(l.values()).map(S=>{var _,b;const I=e.entities.entities[S.leaderId],A=S.members.filter(M=>M.isAdult).length,w=S.members.length-A,P=n.get(S.leaderId)||[];let R=I==null?void 0:I.position;if(P.length>0){const M=P[0],D=M%a*Se,N=Math.floor(M/a)*Se,k={x:D,y:N};let L=0,z=0;for(const Q of P){const q=Q%a*Se,ie=Math.floor(Q/a)*Se,oe=Ye(k,{x:q,y:ie},i,s);L+=oe.x,z+=oe.y}const V=L/P.length,X=z/P.length;R={x:((k.x+V)%i+i)%i,y:((k.y+X)%s+s)%s}}return{leaderId:S.leaderId,tribeBadge:((_=S==null?void 0:S.tribeInfo)==null?void 0:_.tribeBadge)||"",tribeColor:((b=S==null?void 0:S.tribeInfo)==null?void 0:b.tribeColor)||"",adultCount:A,childCount:w,isPlayerTribe:S.leaderId===t,leaderAge:(I==null?void 0:I.age)??0,leaderGender:(I==null?void 0:I.gender)??"male",diplomacyStatus:(u==null?void 0:u[S.leaderId??-1])??ut.Friendly,territoryCenter:R}});return f.sort((S,I)=>S.isPlayerTribe?-1:I.isPlayerTribe?1:I.adultCount+I.childCount-(S.adultCount+S.childCount)),f}function qn(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function wA(e){var a;const t=new Set,i=e.search.human.all(),s=new Map;for(const l of i)l.leaderId&&(s.has(l.leaderId)||s.set(l.leaderId,[]),(a=s.get(l.leaderId))==null||a.push(l));for(const[l,c]of s){if(c.length===0)continue;const u=e.entities.entities[l],f=!u,g=u&&u.leaderId!==l;(f||g)&&t.add(l)}for(let l=0;l<e.terrainOwnership.length;l++){const c=e.terrainOwnership[l];c!==null&&!s.has(c)&&t.add(c)}return Array.from(t)}function bP(e,t){const n=new Map,s=t.search.human.all(),a=zl(e,t);for(const c of a)n.set(c,3);for(const c of s)c.id===e.id||n.has(c)||zg(e,c)&&n.set(c,2);const l=Array.from(n.keys());for(const c of l)if(c.partnerIds)for(const u of c.partnerIds){const f=t.entities.entities[u];f&&!n.has(f)&&f.id!==e.id&&n.set(f,1)}return n}function kP(e,t){const n=ci(e,t);if(n.length===0)return null;const i=t.entities.entities[e];if(i&&i.leaderId&&i.leaderId!==i.id)return i.leaderId;const s=new Map;for(const c of n){const u=bP(c,t);for(const[f,g]of u)if(f.leaderId&&f.leaderId!==e){const m=f.leaderId,v=t.entities.entities[m];if(v&&v.leaderId===v.id){const S=s.get(m)||0;s.set(m,S+g)}}}let a=null,l=0;for(const[c,u]of s)u>l&&(l=u,a=c);return a}function YS(e,t,n){var g,m;const i=ci(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=i.length>0?(g=i[0].tribeInfo)==null?void 0:g.tribeBadge:"?",l=s.leaderId===e||!s.leaderId;if(l){const v=n.entities.entities[e];NP(s,v)}const c=((m=s.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const v of i)v.id!==t&&(v.leaderId=t,v.tribeInfo=s.tribeInfo,v.tribeRole=void 0);const f=n.search.building.byProperty("ownerId",e);for(const v of f)v.ownerId=t;au(n,e,t),xl(n,{identifier:`tribe-merge-${e}`,type:Yr.TribeMerged,message:l?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${c}!`,duration:ru,targetEntityIds:[t],highlightedEntityIds:[t,...i.map(v=>v.id)]})}function BP(e){var n;const t=wA(e);for(const i of t){const s=ci(i,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",i);for(const f of u)Yg(f.id,e);au(e,i,null),xl(e,{identifier:`tribe-dissolved-${i}`,type:Yr.TribeMerged,message:"An extinct tribe has been dissolved.",duration:ru});continue}const a=OP(s,e);if(a){YS(i,a.id,e);continue}const l=kP(i,e);if(l)YS(i,l,e);else{const c=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const g of s)g.leaderId=void 0,g.tribeInfo=void 0,g.tribeRole=void 0;const f=e.search.building.byProperty("ownerId",i);for(const g of f)Yg(g.id,e);au(e,i,null),xl(e,{identifier:`tribe-dissolved-${i}`,type:Yr.TribeMerged,message:`Tribe ${c} has been dissolved due to lack of leadership.`,duration:ru})}}}var vt=(e=>(e.Wood="wood",e))(vt||{});const Op={wood:""},ln="treeGrowing",Kt="treeFull",An="treeSpreading",Gt="treeFallen",uo="treeStump",jr="treeDying",FP=500;function LP(e,t){if(!e.leaderId)return 0;const n=HP(e.leaderId,t),i=UP(e.leaderId,t);return i===0?0:Math.min(1,n/i)}function HP(e,t){const n=qn({leaderId:e},t),i=ga(e,t),s=n.reduce((l,c)=>l+c.food.length,0),a=i.reduce((l,c)=>{var f;const u=(f=c.storedItems)==null?void 0:f.filter(g=>g.item.type===Tn.Berry||g.item.type===Tn.Meat);return l+((u==null?void 0:u.length)||0)},0);return s+a}function UP(e,t){const n=qn({leaderId:e},t),i=ga(e,t),s=n.reduce((l,c)=>l+c.maxFood,0),a=i.reduce((l,c)=>l+(c.storageCapacity||0),0);return s+a}function _A(e,t,n=!1){const i=ga(e,t,n);if(i.length===0)return 0;const s=i.reduce((l,c)=>{var u;return l+(((u=c.storedItems)==null?void 0:u.length)||0)},0),a=i.reduce((l,c)=>l+(c.storageCapacity||0),0);return a===0?0:Math.min(1,s/a)}function jl(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const n=qn({leaderId:e},t),i=0,l=t.search.building.byProperty("ownerId",e).reduce((I,A)=>{if(A.isConstructed)return I;const w=tr[A.buildingType].cost.wood||0;return I+w},0),u=ca(e,t).reduce((I,A)=>{const P=(A.maxFuelLevel||Br)-(A.fuelLevel||0);if(P<=0)return I;const R=Math.ceil(P/rA),_=A.storedItems.filter(M=>M.item.type===vt.Wood).length,b=Math.max(0,R-_);return I+b},0),g=ga(e,t).reduce((I,A)=>{var P;const w=(P=A.storedItems)==null?void 0:P.filter(R=>R.item.type===vt.Wood);return I+((w==null?void 0:w.length)||0)},0),m=n.reduce((I,A)=>{var w;return I+(((w=A.heldItem)==null?void 0:w.type)===vt.Wood?1:0)},0),v=g+m,S=l+u+i;return t.cache.tribeWoodNeeds[e]=Math.max(0,S-v),t.cache.tribeWoodNeeds[e]}function RA(e,t){const n=t;if(e&&n.cache.tribeAvailableWoodOnGround[e]!==void 0)return n.cache.tribeAvailableWoodOnGround[e];const i=n.search.tree.all().filter(s=>!(s.stateMachine[0]===Gt)||s.wood.length===0?!1:Xn(s.position,e,t));return n.cache.tribeAvailableWoodOnGround[e]=i.reduce((s,a)=>s+a.wood.length,0),n.cache.tribeAvailableWoodOnGround[e]}function PA(e,t){const n=qn({leaderId:e},t);if(n.length===0)return{count:0,ratio:0};const i=GP(e,t);return{count:i,ratio:i/n.length}}function GP(e,t){return t.search.berryBush.all().filter(a=>jn(a.position.x,a.position.y,t)===e).filter(a=>{const l=a.stateMachine&&a.stateMachine[0]==="bushDying",c=a.food.length>0,u=Li(t.soilDepletion,a.position,t.mapDimensions.width,t.mapDimensions.height);return!l&&c&&!u}).length}function Fu(e,t,n=!1){const i=typeof e=="object"?e.leaderId:e;return i?t.search.building.byProperty("buildingType",fe.PlantingZone).filter(a=>{if(!n&&!a.isConstructed)return!1;if(a.ownerId){const l=t.entities.entities[a.ownerId];return l&&l.leaderId===i}return!1}):[]}function DA(e,t){const{width:n,height:i,position:s}=e,{width:a,height:l}=t.mapDimensions,{depletedSectors:c,totalSectorsCount:u}=BA(t.soilDepletion,s,n,i,a,l);return u===0?!0:c.length/u<.25}function bp(e){const t=qo*2,n=Math.floor(e.width/t),i=Math.floor(e.height/t);return n*i}function MA(e,t){const n=t,i=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,i).filter(l=>{const c=Math.abs(l.position.x-e.position.x),u=Math.abs(l.position.y-e.position.y);return c<=e.width/2&&u<=e.height/2}).length}function $P(e,t){if(!e.leaderId)return[];const n=ga(e.leaderId,t),i=qn(e,t);return n.map(s=>{var f;const a=s.storageCapacity||0,l=((f=s.storedItems)==null?void 0:f.length)||0,c=i.filter(g=>{if(g.activeAction!=="depositing")return!1;if(typeof g.target=="object"&&"x"in g.target){const m=g.target;return U(m,s.position,t.mapDimensions.width,t.mapDimensions.height)<=50}return!1}).length,u=U(e.position,s.position,t.mapDimensions.width,t.mapDimensions.height);return{storage:s,capacity:a,currentItems:l,assignedDepositors:c,distance:u}})}function NA(e,t){const n=$P(e,t);if(n.length===0)return null;const i=n.filter(s=>{const a=s.currentItems<s.capacity,l=s.distance<=FP;return a&&l});return i.length===0?null:(i.sort((s,a)=>{const l=s.currentItems/s.capacity,c=a.currentItems/a.capacity;return Math.abs(l-c)>.1?l-c:s.assignedDepositors!==a.assignedDepositors?s.assignedDepositors-a.assignedDepositors:s.distance-a.distance}),i[0].storage)}function WP(e,t){if(!e.leaderId)return null;const i=ca(e.leaderId,t).filter(s=>{const a=s.storageCapacity||lu;return s.storedItems.length<a});if(i.length>0){const s=i.filter(a=>{const l=a.fuelLevel??0,c=a.maxFuelLevel??Br;return l<c*Rp});return s.length>0?(s.sort((a,l)=>{const c=a.fuelLevel??0,u=l.fuelLevel??0,f=a.maxFuelLevel??Br,g=l.maxFuelLevel??Br,m=c/f,v=u/g,S=m<.25,I=v<.25;return S!==I?S?-1:1:c-u}),s[0]):(i.sort((a,l)=>{const c=U(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height),u=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);return c-u}),i[0])}return NA(e,t)}function OA(e,t,n){return qn({leaderId:e},t).filter(s=>s.activeAction===n).length}function ga(e,t,n=!1){return t.search.building.byProperty("buildingType",fe.StorageSpot).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function ca(e,t,n=!1){return t.search.building.byProperty("buildingType",fe.Bonfire).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function xP(e,t){const n=Fu(e,t);if(n.length===0)return null;const i=t.mapDimensions.width,s=t.mapDimensions.height,a=t.soilDepletion;for(const l of n){const c=bp(l);if(MA(l,t)>=c)continue;const f=20;for(let g=0;g<f;g++){const m=l.position.x+(Math.random()-.5)*l.width,v=l.position.y+(Math.random()-.5)*l.height,S={x:(m%i+i)%i,y:(v%s+s)%s};if(!Li(a,S,i,s)&&!Kn(S,t,qo))return{position:S,zoneId:l.id}}}return null}function tc(e,t,n=void 0){return n?Fu(n,t).some(l=>Fg(e,l,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===fe.PlantingZone&&Fg(e,a,t))}function Lu(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/Xt),gridY:Math.floor(s/Xt)}}function bA(e,t,n){const i=wI(t,n);return e.sectors[i]||(e.sectors[i]=b_()),e.sectors[i]}function kp(e,t,n){const i=wI(t,n),s=e.sectors[i];return s?s.health:ou}function Li(e,t,n,i){const{gridX:s,gridY:a}=Lu(t,n,i);return kp(e,s,a)<PI}function kA(e,t,n){return kp(e,t,n)>=PI}function YP(e,t,n,i,s,a,l){const{gridX:c,gridY:u}=Lu(t,s,a),f=bA(e,c,u),g=f.lastAffectedBy[n]||0;if(i-g<MI)return;const m=tc(t,l)?OI:1,v=B_*m;f.health=Math.max(DI,f.health-v),f.lastWalkTime=i,f.lastAffectedBy[n]=i}function zP(e,t,n,i,s,a){const{gridX:l,gridY:c}=Lu(t,i,s),u=bA(e,l,c),f=tc(t,a)?OI:1,g=k_*f;u.health=Math.max(DI,u.health-g),u.lastPlantTime=n}function jP(e,t,n,i,s){let a=0;for(let l=-1;l<=1;l++)for(let c=-1;c<=1;c++){if(l===0&&c===0)continue;const u=((t+l)%i+i)%i,f=((n+c)%s+s)%s;kA(e,u,f)&&a++}return a}function XP({soilDepletion:e,time:t,mapDimensions:{width:n,height:i}}){if(t-e.lastUpdateTime<W_)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/Xt),l=Math.ceil(i/Xt),c=[];for(const u of Object.keys(e.sectors)){const f=Number(u),g=e.sectors[f],m=Math.max(g.lastWalkTime,g.lastPlantTime);if(t-m<H_)continue;const{gridX:v,gridY:S}=_I(f),I=jP(e,v,S,a,l),A=I>0?L_*(I/8):0,w=F_+A;g.health=Math.min(ou,g.health+w*s),g.health>=ou&&c.push(f);const P=t-MI*10;for(const R of Object.keys(g.lastAffectedBy)){const _=Number(R);g.lastAffectedBy[_]<P&&delete g.lastAffectedBy[_]}}for(const u of c)delete e.sectors[u]}function VP(e,t){const n=[];for(const i of Object.keys(e.sectors)){const s=Number(i),a=e.sectors[s];if(a.health<t){const{gridX:l,gridY:c}=_I(s);n.push({gridX:l,gridY:c,health:a.health})}}return n}function BA(e,t,n,i,s,a){const l=[],c=n/2,u=i/2,f=t.x-c,g=t.x+c,m=t.y-u,v=t.y+u,S=Math.floor(f/Xt),I=Math.floor((g-.001)/Xt),A=Math.floor(m/Xt),w=Math.floor((v-.001)/Xt),P=Math.ceil(s/Xt),R=Math.ceil(a/Xt);let _=0;for(let b=S;b<=I;b++)for(let M=A;M<=w;M++){_++;const D=(b%P+P)%P,N=(M%R+R)%R;kA(e,D,N)||l.push({gridX:D,gridY:N})}return{depletedSectors:l,totalSectorsCount:_}}function zS(e,t,n,i,s){const{gridX:a,gridY:l}=Lu(t,n,i),c=kp(e,a,l);return 1+(s-1)*Math.sqrt(1-c/ou)}const KP={id:_l,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(_t/Nt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Gl,data:{...e,enteredAt:i.gameState.time}};if(!Li(i.gameState.soilDepletion,n.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)){const l=tc(n.position,i.gameState)?O_:1;n.timeSinceLastBerryRegen+=s*l,n.timeSinceLastBerryRegen>=P_&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:Tn.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:Dr,data:{...e,enteredAt:i.gameState.time,previousState:_l}}:{nextState:_l,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},qP={id:Dr,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(_t/Nt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Gl,data:{...e,enteredAt:i.gameState.time,previousState:Dr}};if(n.food.length<n.maxFood)return{nextState:_l,data:{...e,enteredAt:i.gameState.time,previousState:Dr}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=yS){n.timeSinceLastSpreadAttempt=0;const l=i.gameState.time-n.timeSinceLastHarvest>=yS,c=tc(n.position,i.gameState)?N_:1,u=i.gameState.ecosystem.berryBushSpreadChance*c;if(l&&Math.random()<u)return{nextState:zd,data:{...e,enteredAt:i.gameState.time,previousState:Dr}}}return{nextState:Dr,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function ZP(e,t,n){const i=zl(e,t),s=t;for(const a of i){if(U(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height)>n)continue;const c=s.search.human.byProperty("attackTargetId",a.id);for(const u of c)if(u.leaderId!==e.leaderId&&U(e.position,u.position,t.mapDimensions.width,t.mapDimensions.height)<=n)return{familyMember:a,aggressor:u}}}function QP(e,t){const i=t.search.human.byRadius(e.position,WR);let s,a=1/0;for(const l of i){if(l.id===e.id||l.hitpoints<=0||l.hitpoints/l.maxHitpoints>$R||DP(e,l,t)||e.leaderId===l.leaderId&&e.leaderId)continue;const c=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);c<a&&(a=c,s=l)}return s}function JP(e,t,n){return t.search.human.byRadius(e.position,n).filter(s=>Kr(e,s,t))}function eD(e,t,n){const i=n.search.human.byProperty("leaderId",e);let s=0;for(const a of i)a.attackTargetId===t&&s++;return s}function pu(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let i=n.hitpoints;return i+=(n.maxAge-n.age)*.5,i+=n.food.length*2,t+i},0)}var ue=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(ue||{});const Hu={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},FA={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var Os=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(Os||{});const al={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var le=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenTribeModal="OpenTribeModal",e.RecenterCamera="RecenterCamera",e.CloseTribeModal="CloseTribeModal",e.OpenRoleManager="OpenRoleManager",e.CloseRoleManager="CloseRoleManager",e.IncreaseRoleWeight="IncreaseRoleWeight",e.DecreaseRoleWeight="DecreaseRoleWeight",e.OpenArmyControl="OpenArmyControl",e.CloseArmyControl="CloseArmyControl",e.IncreaseArmyObjective="IncreaseArmyObjective",e.DecreaseArmyObjective="DecreaseArmyObjective",e.SwitchAIType="SwitchAIType",e))(le||{});const ng=30,tD=.4,nD=24,LA=50,iD=100,oD=160,rD=72,HA=10,Bp=2,sD=10,aD=15,Xg=5,Vg=5,Kg=5,jS=600,lD=1.5,UA=.1,ig=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,og=""+new URL("gather-CU75596W.mp3",import.meta.url).href,cD=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,XS=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,dD=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,uD=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,fD=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,hD=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,gD=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,pD=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Pe=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Pe||{});const mD=new Map([[0,ig],[1,og],[2,cD],[3,XS],[4,dD],[5,uD],[6,fD],[12,hD],[13,gD],[7,ig],[8,XS],[9,og],[10,og],[11,ig],[14,pD]]);let ll,Xl;function yD(){if(!(typeof window>"u"))return Xl}function Fp(){if(!(typeof window>"u"))return!ll&&typeof window.AudioContext=="function"&&(ll=new window.AudioContext,Xl=ll.createGain(),Xl.connect(ll.destination),Pl(.1,!1)),ll}function Pl(e,t){Xl&&(Xl.gain.value=t?0:e/10)}const GA=new Map;let Cd=!1,VS=!1;async function SD(){if(VS||Cd)return;const e=Fp();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),Cd=!0,console.log("Starting sound loading...");const t=[];mD.forEach((n,i)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{GA.set(i,a)}).catch(a=>{console.error(`Error loading sound ${Pe[i]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),VS=!0,Cd=!1,console.log("All sounds loaded successfully.")}catch(n){Cd=!1,console.error("An error occurred while loading sounds:",n)}}const Dl=new Map;function Lp(e,t){const n=Fp(),i=yD();if(!n||!i||i.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=GA.get(e);if(!s){console.warn(`Sound buffer not found for type: ${Pe[e]}`);return}if(t!=null&&t.trackId&&Dl.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const l=n.createGain(),c=n.createStereoPanner();let u=l;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const f=Ye(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),g=U(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(g>jS)return;const m=1-Math.pow(g/jS,lD);l.gain.value=Math.max(0,m);const v=Math.sin(f.x/g*(Math.PI/2));c.pan.value=isNaN(v)?0:v,l.connect(c),u=c}else{const f=e===Pe.GameOver?.4:e===Pe.SoundTrack1?1:.2;l.gain.value=f}a.connect(u),u.connect(i),a.start(0),t!=null&&t.trackId&&(Dl.set(t.trackId,{sourceNode:a,gainNode:l}),a.onended=()=>{Dl.delete(t.trackId)})}function rg(e,t=1){const n=Dl.get(e),i=Fp();if(n&&i){const{sourceNode:s,gainNode:a}=n,l=i.currentTime;a.gain.setValueAtTime(a.gain.value,l),a.gain.linearRampToValueAtTime(0,l+t),s.stop(l+t),s.onended=null,Dl.delete(e)}}function Oe(e,t,n){const i=At(e.gameState);i&&Lp(t,{position:n,listenerPosition:i.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}var E=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.FAILURE=1]="FAILURE",e[e.RUNNING=2]="RUNNING",e[e.NOT_EVALUATED=3]="NOT_EVALUATED",e))(E||{});class bn{constructor(){Ne(this,"name");Ne(this,"depth");Ne(this,"children");Ne(this,"child")}getLastStatus(t){return T.get(t.aiBlackboard,`${this.name}_lastStatus`)??3}setLastStatus(t,n){T.set(t.aiBlackboard,`${this.name}_lastStatus`,n)}getRunningChildIndex(t){return T.get(t.aiBlackboard,`${this.name}_runningChildIndex`)}setRunningChildIndex(t,n){T.set(t.aiBlackboard,`${this.name}_runningChildIndex`,n)}}const T={create(){return{data:{},nodeExecutionData:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e},recordNodeExecution({nodeExecutionData:e},t,n,i,s,a){const l=e[t]||{lastExecuted:0,status:E.FAILURE,depth:0,debugInfo:"",executionHistory:[]},c=l.executionHistory[l.executionHistory.length-1];c&&i-(c==null?void 0:c.time)>ra&&l.executionHistory.push({time:c.time+ra,status:E.NOT_EVALUATED}),l.executionHistory.push({time:i,status:n});const u=vA/Nt*_t,f=i-u;l.executionHistory=l.executionHistory.filter(m=>m.time>=f);const g={...l,lastExecuted:i,status:n,depth:s,debugInfo:a};e[t]=g},getNodeExecutionData({nodeExecutionData:e}){return e},cleanupOldEntries({nodeExecutionData:e},t){const n=NR,i=[];for(const[s,a]of Object.entries(e))t-a.lastExecuted>n&&i.push(s);for(const s of i)delete e[s]}},Hp="tribeSplit_phase",nc="tribeSplit_strategy",Up="tribeSplit_targetPosition",Uu="tribeSplit_targetBuildingId",Gu="tribeSplit_familyIds",$A="tribeSplit_phaseStartTime",WA="tribeSplit_lastFailureTime";function xA(e,t){T.set(e,Hp,"idle"),T.delete(e,nc),T.delete(e,Up),T.delete(e,Uu),T.delete(e,Gu),T.set(e,WA,t)}function vD(e,t){const n=T.get(e,WA);return n?t-n>=rD:!0}function ID(e,t){const n=T.get(e,$A);return n?t-n>=oD:!1}function Gp(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(wA(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!vD(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const i=t.entities.entities[e.leaderId];if(!i||i.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=zr(On(t,i));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(fu(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const l=ci(e.leaderId,t).filter(S=>S.isAdult);if(l.length<ng)return{canSplit:!1,reason:"Tribe too small"};const u=hu(e,t).length+1,g=hu(i,t).length+1;if(u>=g&&u>ng)return{canSplit:!0,progress:1,strategy:KS(e,t)};const m=Math.max(l.length*tD,ng),v=u/m;if(u>=m){const S=KS(e,t);return{canSplit:!0,progress:v,strategy:S}}return{canSplit:!1,progress:v,reason:`Family too small: ${u} < ${m}`}}function KS(e,t){if(!e.leaderId)return"migration";const n=t;if(!(jn(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===fe.StorageSpot&&a.isConstructed);return s.length>0&&s.find(l=>U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height)<=iD)?"concentration":"migration"}function YA(e,t){if(!e.aiBlackboard)return!1;const n=T.get(e.aiBlackboard,nc);if(!n)return!1;const i=hu(e,t),s=[e.id,...i.map(a=>a.id)];return T.set(e.aiBlackboard,Gu,s),n==="migration"?TD(e,t):n==="concentration"?ED(e,t):!1}function AD(e,t,n){if(Kn(e,n,30))return!1;const s=jn(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function TD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,i=t.mapDimensions.height,s=Math.min(n,i)/2,a=50,l=50;for(let c=0;c<=s;c+=a){const u=c===0?1:Math.max(8,Math.ceil(2*Math.PI*c/l)),f=c===0?0:2*Math.PI/u;for(let g=0;g<u;g++){const m=g*f,v=Math.cos(m)*c,S=Math.sin(m)*c,I=e.position.x+v,A=e.position.y+S,w={x:(I%n+n)%n,y:(A%i+i)%i};if(AD(w,e.leaderId,t))return T.set(e.aiBlackboard,Up,w),!0}}return!1}function ED(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const i=t.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===fe.StorageSpot&&l.isConstructed);if(i.length===0)return!1;let s=null,a=1/0;for(const l of i){const c=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);c<a&&(a=c,s=l)}return s?(T.set(e.aiBlackboard,Uu,s.id),!0):!1}function CD(e,t){var c;if(!e.aiBlackboard)return[!1,0];const n=T.get(e.aiBlackboard,nc),i=(c=T.get(e.aiBlackboard,Gu))==null?void 0:c.filter(u=>!!t.entities.entities[u]);if(!n||!i)return[!1,0];let s;if(n==="migration"){const u=T.get(e.aiBlackboard,Up);if(!u)return[!1,0];s=u}else if(n==="concentration"){const u=T.get(e.aiBlackboard,Uu);if(!u)return[!1,0];const f=t.entities.entities[u];if(!f)return[!1,0];s=f.position}else return[!1,0];let a=0;for(const u of i){const f=t.entities.entities[u];if(!f||f.type!=="human")continue;U(f.position,s,t.mapDimensions.width,t.mapDimensions.height)<=LA&&a++}const l=Math.ceil(i.length*.5);return[a>=l,a/l]}function zA(e,t){var u;if(!e.aiBlackboard)return!1;const n=T.get(e.aiBlackboard,nc),i=T.get(e.aiBlackboard,Gu);if(!n||!i)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=uu(),l=yn[Math.floor(Math.random()*yn.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:l},e.tribeRole=se.Leader,e.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=ut.Hostile);for(const f of i){if(f===e.id)continue;const g=t.entities.entities[f];!g||g.type!=="human"||(g.leaderId=e.id,g.tribeInfo={tribeBadge:a,tribeColor:l})}if(n==="concentration"){const f=T.get(e.aiBlackboard,Uu);if(f){const g=t.entities.entities[f];g&&g.type==="building"&&(g.ownerId=e.id)}}return xl(t,{type:Yr.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:ru,targetEntityIds:[e.id],highlightedEntityIds:i}),Oe({gameState:t},Pe.TribeSplit,e.position),xA(e.aiBlackboard,t.time),!0}function Al(e){return e?T.get(e,Hp)??"idle":"idle"}function Es(e,t,n){T.set(e,Hp,t),T.set(e,$A,n)}function jA(e,t){T.set(e,nc,t)}function wD(e,t){xA(e,t)}function _D(e,t){return ID(e,t)?(wD(e,t),!0):!1}function XA(e,t){const n=Gp(e,t);return{canSplit:n.canSplit,progress:n.progress}}function VA(e,t){if(!e.aiBlackboard)return;const n=Gp(e,t);!n.canSplit||!n.strategy||(jA(e.aiBlackboard,n.strategy),YA(e,t)&&zA(e,t))}const RD=20,qt=30,PD=.5,DD=.3,MD=2,ND=50;function $p(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>Zo&&n.push({type:ue.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const l=Fe(t,e,"berryBush",je,f=>f.food.length>0),c=Fe(t,e,"corpse",je,f=>f.food.length>0);let u=null;l&&c?u=U(t.position,l.position,e.mapDimensions.width,e.mapDimensions.height)<=U(t.position,c.position,e.mapDimensions.width,e.mapDimensions.height)?l:c:u=l||c,u&&n.push({type:ue.Gather,action:"gathering",key:"e",targetEntity:u})}const i=Fe(t,e,"human",je,l=>nr(t,l,e));if(i&&n.push({type:ue.Procreate,action:"procreating",key:"r",targetEntity:i}),t.food.length>0&&t.isAdult){const l=Fe(t,e,"human",je,c=>{const u=c;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=Zo});l&&n.push({type:ue.FeedChild,action:"feeding",key:"h",targetEntity:l})}const s=Fe(t,e,"human",vn,l=>Kr(t,l,e))??Fe(t,e,"predator",vn)??Fe(t,e,"prey",vn);if(s&&n.push({type:ue.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(l=>l.type===Tn.Berry).length>=fo&&n.push({type:ue.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const l=Fe(t,e,"building",qt,c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});l&&n.push({type:ue.Deposit,action:"idle",key:"x",targetEntity:l})}if(t.food.length<t.maxFood&&t.isAdult){const l=Fe(t,e,"building",qt,c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});l&&n.push({type:ue.Retrieve,action:"idle",key:"z",targetEntity:l})}if(((a=t.heldItem)==null?void 0:a.type)===vt.Wood){const l=Fe(t,e,"building",qt,c=>{const u=c;return u.buildingType===fe.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});l&&n.push({type:ue.Deposit,action:"depositing",key:"x",targetEntity:l})}if(XA(t,e).canSplit&&n.push({type:ue.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const l=Fe(t,e,"tree",Pu,c=>c.wood&&c.wood.length>0);l&&n.push({type:ue.Chop,action:"chopping",key:"c",targetEntity:l})}return n}const OD={id:zd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i,a=i.deltaTime*(_t/Nt);if(n.age+=a,n.age>=n.lifespan)return{nextState:Gl,data:{...e,enteredAt:s.time,previousState:zd}};const l=wp(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Kn(l,s,15)||sc(s.entities,l,s.time),{nextState:Dr,data:{...e,enteredAt:s.time,previousState:zd}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},bD={id:Gl,update:e=>({nextState:Gl,data:e}),onEnter:(e,t)=>(Zr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},kD=[KP,qP,OD,bD],St="humanIdle",Pr="humanMoving",Tl="humanEating",pa="humanGathering",Ml="humanDepositing",Nl="humanRetrieving",Or="humanProcreating",Qo="humanAttacking",jd="humanPlanting",Wp="humanChopping",BD={id:St,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:Qo,data:{...e,enteredAt:i.gameState.time,previousState:St,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:(n.hunger>=mp?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:i.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:Pr,data:{...e,enteredAt:i.gameState.time,previousState:St,target:n.target}}:n.activeAction==="gathering"?{nextState:pa,data:{...e,enteredAt:i.gameState.time,previousState:St,target:n.target}}:n.activeAction==="eating"?{nextState:Tl,data:{...e,enteredAt:i.gameState.time,previousState:St}}:n.activeAction==="planting"&&n.target?{nextState:jd,data:{...e,enteredAt:i.gameState.time,previousState:St,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:Ml,data:{...e,enteredAt:i.gameState.time,previousState:St}}:n.activeAction==="retrieving"?{nextState:Nl,data:{...e,enteredAt:i.gameState.time,previousState:St}}:n.activeAction==="chopping"&&n.target?{nextState:Wp,data:{...e,enteredAt:i.gameState.time,previousState:St,state:"chopping"}}:{nextState:St,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function KA(e,t=1){let n=Y_;return e.hunger>=mp&&(n*=z_),e.age>=X_&&(n*=V_),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const sg=7.5;class FD{constructor(){Ne(this,"id",Pr)}update(t,n){var v;const{entity:i,updateContext:s}=n;if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:Qo,data:{...t,enteredAt:s.gameState.time,previousState:Pr,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:St,data:{...t,enteredAt:s.gameState.time,previousState:Pr}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(v=n.updateContext.gameState.entities.entities[i.target])==null?void 0:v.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*sg*2,y:i.position.y+i.direction.y*sg*2}),!a)return{nextState:St,data:{...t,enteredAt:s.gameState.time,previousState:Pr}};const{width:l,height:c}=s.gameState.mapDimensions,u=U(i.position,a,l,c);if(u<sg)return{nextState:St,data:{...t,enteredAt:s.gameState.time,previousState:Pr}};const f=Ye(i.position,a,l,c),g=ot(f);if(u>IS){const S=wg(g,-Vh),I=wg(g,Vh),A=[g,S,I],w=A.map((R,_)=>{const b=zn(i.position,Tt(R,IS)),M={x:(b.x%l+l)%l,y:(b.y%c+c)%c},D=zS(s.gameState.soilDepletion,M,l,c,vS),k=Math.cos(_===0?0:Vh);return D*k});let P=0;for(let R=1;R<w.length;R++)w[R]>w[P]&&(P=R);i.direction=A[P]}else i.direction=g;const m=zS(s.gameState.soilDepletion,i.position,l,c,vS);return i.acceleration=KA(i,m),{nextState:Pr,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const LD=new FD,HD={id:Tl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:St,data:{...e,enteredAt:i.gameState.time,previousState:Tl}}:(n.food.length>0&&(!n.eatingCooldownTime||i.gameState.time>=n.eatingCooldownTime)&&n.hunger>Zo&&(n.hunger=Math.max(0,n.hunger-Zo),n.food.pop(),n.eatingCooldownTime=i.gameState.time+1,Oe(i,Pe.Eat,n.position),(!n.lastEatingEffectTime||i.gameState.time-n.lastEatingEffectTime>2)&&($e(i.gameState,_e.Eating,n.position,Ke,n.id),n.lastEatingEffectTime=i.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:St,data:{...e,enteredAt:i.gameState.time,previousState:Tl}}:{nextState:Tl,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class UD{constructor(){Ne(this,"id",pa)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const GD=new UD,$D={id:Ml,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:St,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Ml}}:{nextState:Ml,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},WD={id:Nl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:St,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Nl}}:{nextState:Nl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},xD=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),YD=(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time<(e.procreationEndTime||0))return{nextState:Or,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<an&&a.hunger<an&&!n.procreationCooldown&&!a.procreationCooldown){const l=n.gender==="female"?n:a.gender==="female"?a:void 0,c=n.gender==="male"?n:a.gender==="male"?a:void 0;l&&c&&(l.isPregnant=!0,l.gestationTime=q_,l.pregnancyFatherId=c.id,n.procreationCooldown=AS,a.procreationCooldown=AS,Oe(i,Pe.Procreate,l.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:St,data:{...e,enteredAt:s.time,previousState:Or}}},zD={id:Or,onEnter:xD,update:YD},jD={id:Qo,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:St,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:St,data:{...e}};const i=U(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Ye(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=ot(s),i<=ho||i<=vn&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=KA(t.entity),{nextState:Qo,data:e}}},XD={id:jd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time-e.enteredAt>=M_){const l=n.food.filter(u=>u.type===Tn.Berry).length,c=Li(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(l>=fo&&!c){for(let u=0;u<fo;u++){const f=n.food.findIndex(g=>g.type===Tn.Berry);f>-1&&n.food.splice(f,1)}sc(s.entities,e.plantingSpot,s.time),zP(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:St,data:{...e,enteredAt:s.time,previousState:jd}}}return{nextState:jd,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class VD{constructor(){Ne(this,"id",Wp)}update(t,n){const{entity:i,updateContext:s}=n;return i.activeAction!=="chopping"||i.heldItem?{nextState:St,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const KD=new VD,qD=[BD,LD,HD,GD,$D,WD,zD,jD,XD,KD],Si="preyIdle",Wo="preyMoving",El="preyGrazing",Cl="preyProcreating",ZD={id:Si,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Wo,data:{...e,enteredAt:i.gameState.time,previousState:Si,target:n.target}}:n.activeAction==="grazing"?{nextState:El,data:{...e,enteredAt:i.gameState.time,previousState:Si}}:n.activeAction==="procreating"?{nextState:Cl,data:{...e,enteredAt:i.gameState.time,previousState:Si}}:{nextState:Si,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},qA=12,QD=120,qS=50,JD=12,ZA=30,eM=2,Sn=50,tM=100,Ol=2,ag=3,nM=.9,iM=1,oM=50,rM=.5,QA=20,sM=140,ZS=40,aM=12,JA=40,lM=3,Ko=60,vi=40,bs=50,QS=320,eT=25,cM=60,tT=2,dM=90,uM=.7,fM=1,bl=3,lg=15,xp=80,nT=10,$u=80,ma=40,iT=2,mu=30,Us=20,Fr=40,Gs=24,Lr=48,$s=12,Hr=40,Ws=20,Ur=60,xs=.75,Yo=2.5,Ys=.25,zo=2,oT=4;function hM(e){let t=JD;return e.isAdult||(t*=.7),e.hunger>=oM&&(t*=rM),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function gM(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,c=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),g=Math.floor((s+c)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function Vl(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const cg=10;class pM{constructor(){Ne(this,"id",Wo)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction!=="moving")return{nextState:Si,data:{...t,enteredAt:s.gameState.time,previousState:Wo}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*cg*2,y:i.position.y+i.direction.y*cg*2}),!a)return{nextState:Si,data:{...t,enteredAt:s.gameState.time,previousState:Wo}};const l=Ye(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=ot(l),i.acceleration=hM(i),U(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<cg?{nextState:Si,data:{...t,enteredAt:s.gameState.time,previousState:Wo}}:{nextState:Wo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const mM=new pM,yM={id:El,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Wo,data:{...e,enteredAt:i.gameState.time,previousState:El,target:n.target}}:n.activeAction!=="grazing"?{nextState:Si,data:{...e,enteredAt:i.gameState.time,previousState:El}}:{nextState:El,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},SM={id:Cl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Wo,data:{...e,enteredAt:i.gameState.time,previousState:Cl,target:n.target}}:n.activeAction!=="procreating"?{nextState:Si,data:{...e,enteredAt:i.gameState.time,previousState:Cl}}:{nextState:Cl,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},vM=[ZD,mM,yM,SM],mn="predatorIdle",Go="predatorMoving",no="predatorAttacking",ks="predatorProcreating",Gr="predatorEating",IM={id:mn,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:Gr,data:{...e,enteredAt:i.gameState.time,previousState:mn,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:no,data:{...e,enteredAt:i.gameState.time,previousState:mn,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction==="moving"?{nextState:Go,data:{...e,enteredAt:i.gameState.time,previousState:mn,target:n.target}}:n.activeAction==="procreating"?{nextState:ks,data:{...e,enteredAt:i.gameState.time,previousState:mn}}:{nextState:mn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function rT(e){let t=aM;return e.hunger>=dM&&(t*=uM),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function AM(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,c=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),g=Math.floor((s+c)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function Kl(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const dg=12;class TM{constructor(){Ne(this,"id",Go)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction==="eating")return{nextState:Gr,data:{...t,enteredAt:s.gameState.time,previousState:Go,preyId:i.attackTargetId,eatingStartTime:s.gameState.time}};if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:no,data:{...t,enteredAt:s.gameState.time,previousState:Go,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:Go}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*dg*2,y:i.position.y+i.direction.y*dg*2}),!a)return{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:Go}};const l=Ye(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=ot(l),i.acceleration=rT(i),U(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<dg?{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:Go}}:{nextState:Go,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const EM=new TM,CM={id:no,update:(e,t)=>{const{entity:n,updateContext:i}=t;if(n.activeAction==="eating")return{nextState:Gr,data:{...e,enteredAt:i.gameState.time,previousState:no,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:no}};const s=i.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:no}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:no}};const l=U(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=Ye(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return n.direction=ot(c),l>vi?n.acceleration=rT(n):n.acceleration=0,{nextState:no,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},wM={id:ks,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:Gr,data:{...e,enteredAt:i.gameState.time,previousState:ks,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:no,data:{...e,enteredAt:i.gameState.time,previousState:ks,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction!=="procreating"?{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:ks}}:{nextState:ks,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},_M={id:Gr,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:Gr}}:{nextState:Gr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},RM=[IM,EM,CM,wM,_M],PM=24*30*10,Jo=24*5,DM=48,MM=72,ic=20,NM="#3b2016",OM="#5c3a21",bM="#376d31",kM="#76a331",BM="#a6c44a",FM="rgba(0, 0, 0, 0.25)",LM=60,HM=24*7,UM=.1,JS=1,Wu=5,GM={id:ln,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.age>=n.lifespan?{nextState:jr,data:{enteredAt:i.gameState.time,previousState:ln}}:n.age>=Jo?{nextState:Kt,data:{enteredAt:i.gameState.time,previousState:ln}}:{nextState:ln,data:e}}},$M={id:Kt,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(_t/Nt);return n.age>=n.lifespan?{nextState:jr,data:{...e,enteredAt:i.gameState.time,previousState:Kt}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=HM&&(n.timeSinceLastSpreadAttempt=0,Math.random()<UM)?{nextState:An,data:{...e,enteredAt:i.gameState.time,previousState:Kt}}:{nextState:Kt,data:e})}},WM={id:An,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(n.age>=n.lifespan)return{nextState:jr,data:{...e,enteredAt:s.time,previousState:An}};const a=wp(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Kn(a,s,25)||ql(s.entities,a,s.time),{nextState:Kt,data:{...e,enteredAt:s.time,previousState:An}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},xM={id:Gt,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=DM?{nextState:uo,data:{enteredAt:n.gameState.time,previousState:Gt}}:{nextState:Gt,data:e}}},YM={id:uo,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=MM?{nextState:jr,data:{enteredAt:n.gameState.time,previousState:uo}}:{nextState:uo,data:e}}},zM={id:jr,update:e=>({nextState:jr,data:e}),onEnter:(e,t)=>(Zr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},jM=[GM,$M,WM,xM,YM,zM],ev=[...kD,...qD,...vM,...RM,...jM];function XM(e,t,n){const i=I_(e,ev);if(!i)return T_(e),[e,t];const{nextState:s,data:a}=i.update(t,n);return A_(e,s)?[s,v_(i,s,a,n,ev)]:[s,a]}function Yp(e,t){return`${e},${t}`}const tv=_t*10;function sT(e){return e%tv/tv}function aT(e){const t=sT(e);return(Math.cos(t*2*Math.PI)+1)/2}function VM(e){const t=sT(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function lT(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/io),gridY:Math.floor(s/io)}}function er(e,t,n,i,s){const{gridX:a,gridY:l}=lT(t,i,s),c=Yp(a,l),u=e.sectors[c],f=u?u.currentTemperature:oA,m=(aT(n)*2-1)*S1;return f+m}function KM(e){const{sectors:t}=e.temperature,{width:n,height:i}=e.mapDimensions,s=Math.ceil(n/io),a=Math.ceil(i/io);for(const c in t){const u=t[c];u.currentTemperature=u.baseTemperature}const l=Math.ceil(kr/io);Object.values(e.entities.entities).forEach(c=>{if(c.type==="building"){const u=c;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const f=lT(u.position,n,i);for(let g=-l;g<=l;g++)for(let m=-l;m<=l;m++){const v=(f.gridX+m+s)%s,S=(f.gridY+g+a)%a,I=Yp(v,S),A=t[I];if(A){const w={x:(v+.5)*io,y:(S+.5)*io},P=U(u.position,w,n,i);if(P<kr){const R=p1*(1-P/kr);A.currentTemperature+=R}}}}}})}function cT(e,t){const n={},i=Math.ceil(e/io),s=Math.ceil(t/io);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const c=Yp(l,a);let u=oA;const f=a/s*10-5;u+=f,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),n[c]={baseTemperature:u,currentTemperature:u}}return{sectors:n}}function qM(e,t,n){var c;const{gameState:i}=t,s=n*(_t/Nt);e.isAdult=e.age>=yp;const a=er(i.temperature,e.position,i.time,i.mapDimensions.width,i.mapDimensions.height);if(a<co){const u=(co-a)*g1*s;e.hitpoints-=u}if(e.movementSlowdown&&i.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<sn){const u=1-e.hunger/sn*aR,f=sR*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+f)}if(e.hunger+=n*(il/(_t/Nt)),e.hunger>=sn)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-Zo);else{const u=lR*s;e.hitpoints-=u}if(e.age+=n/Ru,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((il*Z_-il)/(_t/Nt)),(!e.lastPregnantEffectTime||i.time-e.lastPregnantEffectTime>Yl*3)&&($e(i,_e.Pregnant,e.position,Yl,e.id),e.lastPregnantEffectTime=i.time),e.gestationTime<=0&&(Xb(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===ha&&(e.radius=Rt):e.hunger+=n*((il*Q_-il)/(_t/Nt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const f=i.entities.entities[e.motherId];f&&u.push(f)}if(e.fatherId){const f=i.entities.entities[e.fatherId];f&&u.push(f)}for(const f of u)if(f.age>=Sp&&f.hunger>=tR&&U(e.position,f.position,i.mapDimensions.width,i.mapDimensions.height)<=nR){e.food.pop(),f.hunger=Math.max(0,f.hunger-Zo),e.feedParentCooldownTime=iR;break}}let l;if(e.hitpoints<=0?a<co?l="hypothermia":e.hunger>=sn?l="hunger":l="killed":e.age>=e.maxAge&&(l="oldAge"),l){if(e.leaderId===e.id){const u=zr(On(i,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeRole=se.Leader,u.tribeControl=e.tribeControl??{roleWeights:{[se.Leader]:0,[se.Gatherer]:2,[se.Planter]:2,[se.Hunter]:2,[se.Mover]:2,[se.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}};const f=i;au(i,e.id,u.id);const g=f.search.human.byProperty("leaderId",e.id);for(const S of g)S.leaderId=u.id,S.tribeInfo=u.tribeInfo;const m=f.search.building.byProperty("ownerId",e.id);for(const S of m)S.ownerId=u.id;for(const S of hu(u,i))S.leaderId=u.id,S.tribeInfo=u.tribeInfo;const v=ec(i).filter(S=>S.leaderId!==u.id&&S.leaderId!==e.id);for(const S of v){const I=i.entities.entities[S.leaderId];if((c=I==null?void 0:I.tribeControl)!=null&&c.diplomacy){const A=I.tribeControl.diplomacy[e.id];A!==void 0&&(I.tribeControl.diplomacy[u.id]=A,delete I.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=zr(On(i,e));u?(u.isPlayer=!0,i.generationCount++):(i.gameOver=!0,i.causeOfGameOver=l,xl(i,{identifier:"no_heir",type:Yr.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}Yb(i.entities,e.position,e.gender,e.age,e.radius,e.id,i.time,e.food,e.hunger),Zr(i.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function ZM(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/oR);const i=Math.floor(FI*(1-e.decayProgress));e.food.length>i&&e.food.splice(i),e.decayProgress>=1&&e.food.length<=0&&Zr(t.gameState.entities,e.id)}function QM(e,t,n){const i=n*(_t/Nt);e.age+=n/Ru,e.isAdult=e.age>=Ol;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=QD){const l=oT*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};l.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,l.x)),l.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,l.y));const c=Math.random()<.5?"male":"female",u=e,f=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let g;if(f)g=gM(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}da(t.gameState.entities,l,c,0,ZA*.5,g,e.id,e.fatherId,e.aiType),$e(t.gameState,_e.Procreation,e.position,Yl,e.id),Oe(t,Pe.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=i,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=qA&&(a=!0),a&&(zb(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Zr(t.gameState.entities,e.id))}function JM(e,t,n){const i=n*(_t/Nt);e.age+=n/Ru,e.isAdult=e.age>=bl;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=sM){const l=oT*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};l.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,l.x)),l.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,l.y));const c=Math.random()<.5?"male":"female",u=e,f=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let g;if(f)g=AM(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}ua(t.gameState.entities,l,c,0,JA*.6,g,e.id,e.pregnancyFatherId,e.aiType),$e(t.gameState,_e.Procreation,e.position,Yl,e.id),Oe(t,Pe.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=i,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=i,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=QA&&(a=!0),a&&(jb(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Zr(t.gameState.entities,e.id))}var $t=(e=>(e[e.BehaviorTreeBased=0]="BehaviorTreeBased",e[e.TaskBased=1]="TaskBased",e))($t||{});const Fi=24,xu=2,zp=3;function Wt(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}function eN(e,t){if(!e.aiBlackboard)return;const n=e.aiBlackboard.data,i=[];for(const s in n)if(s.startsWith("tribal_")){const a=n[s];a&&typeof a=="object"&&"startTime"in a&&t-a.startTime>Fi&&i.push(s)}for(const s of i)T.delete(e.aiBlackboard,s)}const oc="tribe_logistics_demands",tN=8;function ir(e){return T.get(e,oc)||[]}function dT(e,t,n,i){const s=ir(e),a=s.find(l=>l.requesterId===t&&l.resourceType===n);if(a)a.updatedAt=i;else{const l={requesterId:t,resourceType:n,updatedAt:i};s.push(l)}T.set(e,oc,s)}function nN(e,t,n,i,s){const a=ir(e),l=a.find(c=>c.requesterId===t&&c.resourceType===n);return l&&!l.claimedBy?(l.updatedAt=s,l.claimedBy=i,T.set(e,oc,a),!0):!1}function iN(e){return ir(e).filter(n=>!n.claimedBy).sort((n,i)=>n.updatedAt-i.updatedAt)}function uT(e,t,n){let i=ir(e);i=i.filter(s=>!(s.requesterId===t&&s.resourceType===n)),T.set(e,oc,i)}function fT(e,t,n){return ir(e).find(s=>s.requesterId===t&&s.resourceType===n)}function oN(e,t){let n=ir(e);n=n.filter(i=>t-i.updatedAt<=tN),T.set(e,oc,n)}function jp(e,t,n){const i=Wt(e,t.gameState);i&&i.id===e.id&&i.aiBlackboard&&(eN(i,t.gameState.time),oN(i.aiBlackboard,t.gameState.time)),n.execute(e,t,e.aiBlackboard)}const nv="Human Behavior",rN=1;class sN{constructor(){Ne(this,"nodeData",new Map);Ne(this,"pathStack",[]);Ne(this,"startTimeStack",[])}nodeStart(t){this.pathStack.push(t),this.startTimeStack.push(performance.now())}nodeEnd(){if(this.startTimeStack.length===0||this.pathStack.length===0){console.error("BTProfiler: nodeEnd() called without a matching nodeStart().");return}const t=performance.now(),n=this.startTimeStack.pop(),i=t-n,s=this.pathStack.join(" > "),a=this.nodeData.get(s)??{path:s,totalTime:0,callCount:0,minTime:1/0,maxTime:-1/0};a.totalTime+=i,a.callCount++,a.minTime=Math.min(a.minTime,i),a.maxTime=Math.max(a.maxTime,i),this.nodeData.set(s,a),this.pathStack.pop()}report(t={}){const{showAll:n=!1}=t,i=Array.from(this.nodeData.values());if(i.length===0){console.log("--- Behavior Tree Profiler: No data collected. ---");return}let s=i,a="--- Behavior Tree Full Report ---";if(!n){const c=this.nodeData.get(nv);if(c){const u=c.totalTime*rN/100;s=i.filter(f=>f.totalTime>u&&f.path!==nv),a="--- Behavior Tree Problem Report ---"}else console.log('BTProfiler: Root node "Human Behavior" not found. Showing full report.'),a="--- Behavior Tree Full Report (Root Not Found) ---"}const l=s.sort((c,u)=>u.totalTime-c.totalTime);console.log(a),l.length>0?console.table(l.map(c=>({Path:c.path,"Total Time (ms)":c.totalTime.toFixed(3),Calls:c.callCount,"Avg Time (ms)":(c.totalTime/c.callCount).toFixed(3),"Min Time (ms)":c.minTime.toFixed(3),"Max Time (ms)":c.maxTime.toFixed(3)}))):console.log("No significant performance problems detected."),console.log("------------------------------------")}reset(){this.nodeData.clear(),this.pathStack=[],this.startTimeStack=[]}getNodeData(t){return this.nodeData.get(t)}}const rt=new sN;function Zt(e){return Array.isArray(e)?e:[e,""]}class Ce extends bn{constructor(n,i,s=0){super();Ne(this,"name");Ne(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{for(const a of this.children){const[l,c]=Zt(a.execute(n,i,s));if(l!==E.SUCCESS)return this.setLastStatus(n,l),this.name&&T.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,c),l}return this.setLastStatus(n,E.SUCCESS),this.name&&T.recordNodeExecution(s,this.name,E.SUCCESS,i.gameState.time,this.depth,""),E.SUCCESS}finally{this.name&&rt.nodeEnd()}}}class cn extends bn{constructor(n,i,s=0){super();Ne(this,"name");Ne(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const a=this.getRunningChildIndex(n)??0;for(let l=a;l<this.children.length;l++){const c=this.children[l],[u,f]=Zt(c.execute(n,i,s));if(u!==E.FAILURE){if(u===E.SUCCESS)return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,E.SUCCESS),this.name&&T.recordNodeExecution(s,this.name,E.SUCCESS,i.gameState.time,this.depth,f),E.SUCCESS;if(u===E.RUNNING)return this.setRunningChildIndex(n,l),this.setLastStatus(n,E.RUNNING),this.name&&T.recordNodeExecution(s,this.name,E.RUNNING,i.gameState.time,this.depth,f),E.RUNNING}}return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,E.FAILURE),this.name&&T.recordNodeExecution(s,this.name,E.FAILURE,i.gameState.time,this.depth,""),E.FAILURE}finally{this.name&&rt.nodeEnd()}}}class iv extends bn{constructor(n,i,s=0){super();Ne(this,"name");Ne(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{let a=!0;for(const c of this.children){const[u,f]=Zt(c.execute(n,i,s));u===E.FAILURE&&(a=!1),this.name&&T.recordNodeExecution(s,this.name,u,i.gameState.time,this.depth,f)}const l=a?E.SUCCESS:E.FAILURE;return this.setLastStatus(n,l),l}finally{this.name&&rt.nodeEnd()}}}class ge extends bn{constructor(n,i,s=0){super();Ne(this,"name");Ne(this,"depth");this.action=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=Zt(this.action(n,i,s));return this.setLastStatus(n,a),this.name&&T.recordNodeExecution(s,this.name,a,i.gameState.time,this.depth,l),a}finally{this.name&&rt.nodeEnd()}}}class me extends bn{constructor(n,i,s=0){super();Ne(this,"name");Ne(this,"depth");this.condition=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=Zt(this.condition(n,i,s)),c=a?E.SUCCESS:E.FAILURE;return this.setLastStatus(n,c),this.name&&T.recordNodeExecution(s,this.name,c,i.gameState.time,this.depth,l),c}finally{this.name&&rt.nodeEnd()}}}class aN extends bn{constructor(n,i,s=0){super();Ne(this,"name");Ne(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=Zt(this.child.execute(n,i,s));let c;switch(a){case E.SUCCESS:c=E.FAILURE;break;case E.FAILURE:c=E.SUCCESS;break;case E.RUNNING:default:c=a;break}return this.setLastStatus(n,c),this.name&&T.recordNodeExecution(s,this.name,c,i.gameState.time,this.depth,l),c}finally{this.name&&rt.nodeEnd()}}}class lN extends bn{constructor(n,i,s=0){super();Ne(this,"name");Ne(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[,a]=Zt(this.child.execute(n,i,s)),l=E.SUCCESS;return this.setLastStatus(n,l),this.name&&T.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,a),l}finally{this.name&&rt.nodeEnd()}}}class Mr extends bn{constructor(n,i,s,a=0){super();Ne(this,"name");Ne(this,"depth");Ne(this,"startTimeKey");this.child=n,this.timeoutDurationHours=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.startTimeKey=`timeout_${this.name}_startTime`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time;let l=T.get(s,this.startTimeKey);const[c,u]=Zt(this.child.execute(n,i,s));if(c===E.RUNNING){l===void 0&&(T.set(s,this.startTimeKey,a),l=a);const f=a-l;if(f>this.timeoutDurationHours){T.delete(s,this.startTimeKey),this.setLastStatus(n,E.FAILURE);const m=`Timed out after ${f.toFixed(2)}h.`;return T.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m),this.getLastStatus(n)}this.setLastStatus(n,E.RUNNING);const g=`Running for ${f.toFixed(2)}h. ${u}`;return T.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}return l!==void 0&&T.delete(s,this.startTimeKey),this.setLastStatus(n,c),T.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class Yn extends bn{constructor(n,i,s,a=0,l){super();Ne(this,"name");Ne(this,"depth");Ne(this,"statusKey");Ne(this,"timestampKey");this.child=n,this.cacheDurationHours=i,this.validityCheck=l,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.statusKey=`caching_${this.name}_status`,this.timestampKey=`caching_${this.name}_timestamp`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time,l=T.get(s,this.statusKey),c=T.get(s,this.timestampKey);if(l!==void 0&&c!==void 0){const m=a-c>this.cacheDurationHours,v=this.validityCheck?this.validityCheck(n,i,s):!0;if(!m&&v){const S=(c+this.cacheDurationHours-a).toFixed(2),I=`Cache hit. Status: ${E[l]}. ${S}h left.`;return this.setLastStatus(n,l),T.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,I),this.getLastStatus(n)}}const[u,f]=Zt(this.child.execute(n,i,s));(u===E.SUCCESS||u===E.FAILURE)&&(T.set(s,this.statusKey,u),T.set(s,this.timestampKey,a)),this.setLastStatus(n,u);const g=`Cache miss. Child returned ${E[u]}. ${f}`;return T.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class ya extends bn{constructor(n,i,s,a=0){super();Ne(this,"name");Ne(this,"depth");Ne(this,"cooldownKey");this.cooldownDurationHours=n,this.child=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.cooldownKey=`cooldown_${this.name}`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time,l=T.get(s,this.cooldownKey);if(this.child.getLastStatus(n)===E.RUNNING){const[f,g]=Zt(this.child.execute(n,i,s));if(this.setLastStatus(n,f),this.name){const m=`Continuing running child. ${g}`;T.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m)}return this.getLastStatus(n)}if(l!==void 0&&a<l){const g=`Cooldown active, ${(l-a).toFixed(2)}h left`;return this.setLastStatus(n,E.FAILURE),this.name&&T.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}const[c,u]=Zt(this.child.execute(n,i,s));return c===E.SUCCESS&&T.set(s,this.cooldownKey,a+this.cooldownDurationHours),this.setLastStatus(n,c),this.name&&T.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class Mn extends bn{constructor(n,i,s,a=0){super();Ne(this,"name");Ne(this,"depth");this.child=n,this.behaviorKey=i,this.name=s,this.depth=a;const l=(c,u)=>{c.depth=u,c.children?c.children.forEach(f=>l(f,u+1)):c.child&&l(c.child,u+1)};l(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer&&!i.gameState.autopilotControls.behaviors[this.behaviorKey]){const u=`Player autopilot for '${this.behaviorKey}' is disabled.`;return this.setLastStatus(n,E.FAILURE),this.name&&T.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,u),this.getLastStatus(n)}const[l,c]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,l),this.name&&T.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,c),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class cN extends bn{constructor(n,i,s=0){super();Ne(this,"name");Ne(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,c)=>{l.depth=c,l.children?l.children.forEach(u=>a(u,c+1)):l.child&&a(l.child,c+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer&&i.gameState.autopilotControls.isManuallyMoving)return this.setLastStatus(n,E.FAILURE),this.name&&T.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Manual movement active, AI blocked."),this.getLastStatus(n);const[a,l]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&T.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class Cs extends bn{constructor(n,i,s=0){super();Ne(this,"name");Ne(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,c)=>{l.depth=c,l.children?l.children.forEach(u=>a(u,c+1)):l.child&&a(l.child,c+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer)return this.setLastStatus(n,E.FAILURE),this.name&&T.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Player controlled, AI blocked."),this.getLastStatus(n);const[a,l]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&T.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class Hi extends bn{constructor(n,i,s,a=0){super();Ne(this,"name");Ne(this,"depth");Ne(this,"registeredKey");this.child=n,this.config=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.registeredKey=`${this.name}_registered`}execute(n,i,s){rt.nodeStart(this.name);try{const a=Wt(n,i.gameState);if(!a||!a.aiBlackboard){const[I,A]=Zt(this.child.execute(n,i,s));return this.setLastStatus(n,I),T.recordNodeExecution(s,this.name,I,i.gameState.time,this.depth,`No coordination: ${A}`),I}const l=i.gameState.time,c=T.get(s,this.registeredKey)??!1,u=this.getTaskTarget(n,i,s);if(!u)return this.setLastStatus(n,E.FAILURE),T.recordNodeExecution(s,this.name,E.FAILURE,l,this.depth,"No task target found"),E.FAILURE;const f=this.getTaskKey(u);if(c){const[I,A]=Zt(this.child.execute(n,i,s));return I===E.RUNNING?(this.refreshTaskTimestamp(a.aiBlackboard,f,n.id,l),this.setLastStatus(n,I),T.recordNodeExecution(s,this.name,I,l,this.depth,`Continuing: ${A}`),I):(this.removeFromTask(a.aiBlackboard,f,n.id),T.delete(s,this.registeredKey),this.setLastStatus(n,I),T.recordNodeExecution(s,this.name,I,l,this.depth,`Completed: ${A}`),I)}if(!this.canJoinTask(a.aiBlackboard,f,n.id,l)){this.setLastStatus(n,E.FAILURE);const I=T.get(a.aiBlackboard,f),A=(I==null?void 0:I.memberIds.length)??0,w=this.config.maxCapacity??1;return T.recordNodeExecution(s,this.name,E.FAILURE,l,this.depth,`Task full: ${A}/${w}`),E.FAILURE}if(!this.registerTask(a.aiBlackboard,f,n.id,l))return this.setLastStatus(n,E.FAILURE),T.recordNodeExecution(s,this.name,E.FAILURE,l,this.depth,"Failed to register task"),E.FAILURE;T.set(s,this.registeredKey,!0);const[v,S]=Zt(this.child.execute(n,i,s));if(v===E.RUNNING){this.setLastStatus(n,v);const I=T.get(a.aiBlackboard,f),A=(I==null?void 0:I.memberIds.length)??0,w=this.config.maxCapacity??1;return T.recordNodeExecution(s,this.name,v,l,this.depth,`Started (${A}/${w}): ${S}`),v}else return this.removeFromTask(a.aiBlackboard,f,n.id),T.delete(s,this.registeredKey),this.setLastStatus(n,v),T.recordNodeExecution(s,this.name,v,l,this.depth,`Immediate result: ${S}`),v}finally{rt.nodeEnd()}}getTaskTarget(n,i,s){var l,c,u,f;if(this.config.taskType==="procreation")return((c=(l=this.config).getTargetId)==null?void 0:c.call(l,n,i,s))??null;const a=(f=(u=this.config).getTargetId)==null?void 0:f.call(u,n,i,s);return a??null}getTaskKey(n){return this.config.generateTaskKey?this.config.generateTaskKey(this.config.taskType,n):`tribal_${this.config.taskType}_${n}`}canJoinTask(n,i,s,a){const l=T.get(n,i);if(!l||a-l.startTime>Fi||l.memberIds.includes(s))return!0;const c=this.config.maxCapacity??1;return l.memberIds.length<c}registerTask(n,i,s,a){let l=T.get(n,i);return l?a-l.startTime>Fi?(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},T.set(n,i,l),!0):l.memberIds.length>=(this.config.maxCapacity??1)?!!l.memberIds.includes(s):(l.memberIds.includes(s)||(l.memberIds.push(s),T.set(n,i,l)),!0):(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},T.set(n,i,l),!0)}refreshTaskTimestamp(n,i,s,a){const l=T.get(n,i);l&&l.memberIds.includes(s)&&(l.startTime=a,T.set(n,i,l))}removeFromTask(n,i,s){const a=T.get(n,i);a&&(a.memberIds=a.memberIds.filter(l=>l!==s),a.memberIds.length===0?T.delete(n,i):T.set(n,i,a))}}function dN(e){return new Ce([new me((t,n)=>{const i=t.hunger>=sa,s=t.food.length>0,a=!t.eatingCooldownTime||n.gameState.time>=t.eatingCooldownTime;return[!!(i&&s&&a),`${Math.floor(t.hunger-sa)}, ${t.food.length}, ${t.eatingCooldownTime?Math.floor(t.eatingCooldownTime-n.gameState.time):""}`]},"Can Eat",e+1),new ge(t=>(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",E.RUNNING),"Eat",e+1)],"Eating",e)}function Vn(e,t,n){return Yu(e,n)?e.tribeRole===t:!0}function Yu(e,t){if(!e.leaderId)return!1;const n=t.entities.entities[e.leaderId];return!n||!n.tribeControl?!1:t.search.human.byProperty("leaderId",n.id).filter(s=>s.isAdult).length>=sD}function uN(e){return new Ce([new me((n,i)=>{if(!!!n.leaderId||!Yu(n,i.gameState))return!1;const a=n.id===n.leaderId,l=Vn(n,se.Warrior,i.gameState)||Vn(n,se.Hunter,i.gameState),c=!n.isAdult&&(!n.fatherId||!i.gameState.entities.entities[n.fatherId])&&(!n.motherId||!i.gameState.entities.entities[n.motherId]);return a||l||c},"Demand eligible?",e+1),new ge((n,i)=>{const s=Wt(n,i.gameState);if(!s||!s.aiBlackboard)return[E.NOT_EVALUATED,"No leader for coordination"];if(n.food.length<n.maxFood*.5){dT(s.aiBlackboard,n.id,"food",i.gameState.time);const a=fT(s.aiBlackboard,n.id,"food");if(a&&a.claimedBy){const l=i.gameState.entities.entities[a.claimedBy];if(!l||l.type!=="human")return[E.NOT_EVALUATED,"Supplier not found or invalid"];const c=U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return c>gR?[E.NOT_EVALUATED,`Supplier too far (${c.toFixed(1)}px), waiting`]:c<=je?(n.activeAction="retrieving",n.target=l.id,[E.RUNNING,`Retrieving from supplier ${l.id}`]):(n.target=l.id,n.activeAction="moving",[E.RUNNING,`Moving to supplier ${l.id}, distance: ${c.toFixed(1)}`])}return[E.NOT_EVALUATED,"Waiting for supplier"]}return[E.NOT_EVALUATED,"No demand needed"]},"Create Demand",e+1)],"Demand",e)}const Xp=400,fN=25;function ov(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function hN(e,t,n=Xp){return t.search.building.byRadius(e.position,n).some(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed&&l.storageCapacity&&l.storedItems.length<l.storageCapacity})}function gN(e,t,n=Xp,i,s){return t.search.building.byRadius(e.position,n).filter(c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===e.leaderId&&u.isConstructed&&u.storedItems.filter(f=>f.item.itemType==="food").length>0}).filter(c=>{if(i){const u=`tribal_storage_${c.id}`,f=T.get(i,u);if(f&&f.memberIds.length>=zp&&(!s||!f.memberIds.includes(s)))return!1}return!0})}function pN(e,t,n=Xp){return t.search.building.byRadius(e.position,n).filter(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed})}function hT(e,t,n){if(t.length===0)return null;let i=null,s=1/0;for(const a of t){const l=U(e.position,a.position,n.mapDimensions.width,n.mapDimensions.height);l<s&&(s=l,i=a)}return i?{storage:i,distance:s}:null}function gT(e){const t=e.storedItems.length,n=ov(t+e.id)*2*Math.PI,i=ov(t+e.id+1)*fN;return{x:Math.cos(n)*i,y:Math.sin(n)*i}}const rv="FINDING_DEMAND",sv="RETRIEVING_FROM_STORAGE",av="DELIVERING_TO_DEMANDER",Xd="supply_phase",qg="supply_targetDemanderId",pT="supply_targetStorageId",Vd="supply_targetResourceType";function Di(e){e.aiBlackboard&&(T.delete(e.aiBlackboard,Xd),T.delete(e.aiBlackboard,qg),T.delete(e.aiBlackboard,pT),T.delete(e.aiBlackboard,Vd))}function mN(e){return new ge((t,n)=>{var a;if(!Yu(t,n.gameState))return Di(t),[E.FAILURE,"Tribe roles not effective"];if(!Vn(t,se.Mover,n.gameState))return Di(t),[E.FAILURE,"Not a Mover"];const i=Wt(t,n.gameState);if(!i||!i.aiBlackboard)return Di(t),[E.FAILURE,"No leader or blackboard"];if(!t.aiBlackboard)return[E.FAILURE,"No AI blackboard"];const s=T.get(t.aiBlackboard,Xd)||rv;if(s===rv){const l=iN(i.aiBlackboard).filter(f=>f.requesterId!==t.id);if(l.length===0)return[E.FAILURE,"No unclaimed demands"];const c=l[0];return nN(i.aiBlackboard,c.requesterId,c.resourceType,t.id,n.gameState.time)?(T.set(t.aiBlackboard,qg,c.requesterId),T.set(t.aiBlackboard,Vd,c.resourceType),T.set(t.aiBlackboard,Xd,sv),[E.RUNNING,`Claimed ${c.resourceType} demand for ${c.requesterId}, moving to retrieval phase`]):(Di(t),[E.FAILURE,"Failed to claim demand"])}if(s===sv){const l=T.get(t.aiBlackboard,Vd),c=l==="food"&&t.food.length>0,u=l==="wood"&&((a=t.heldItem)==null?void 0:a.type)===vt.Wood;if(c||u)return T.set(t.aiBlackboard,Xd,av),[E.RUNNING,`${l} retrieved, moving to delivery phase`];const f=pN(t,n.gameState,400).filter(S=>l==="food"?S.storedItems.some(I=>I.item.itemType==="food"):l==="wood"?S.storedItems.some(I=>I.item.type===vt.Wood):!1);if(f.length===0)return[E.FAILURE,`No storage with ${l} found nearby`];const g=hT(t,f,n.gameState);if(!g)return Di(t),[E.FAILURE,"Could not find closest storage"];const{storage:m,distance:v}=g;return T.set(t.aiBlackboard,pT,m.id),v<=qt?(t.activeAction="retrieving",t.target=m.id,[E.RUNNING,`Retrieving from storage ${m.id}`]):(t.target=m.id,t.activeAction="moving",[E.RUNNING,`Moving to storage ${m.id}, distance: ${v.toFixed(1)}`])}if(s===av){const l=T.get(t.aiBlackboard,Vd)||"food",c=T.get(t.aiBlackboard,qg);if(!c)return Di(t),[E.FAILURE,"Demander ID not found in blackboard"];const u=fT(i.aiBlackboard,c,l);if(!u||u.claimedBy!==t.id)return Di(t),[E.FAILURE,"Demand not found"];const f=n.gameState.entities.entities[c];if(!f)return Di(t),[E.FAILURE,"Demander not found"];if(l==="food"?t.food.length===0:!t.heldItem)return Di(t),[E.SUCCESS,`Successfully delivered ${l} to ${c}`];const m=U(t.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),v=f.type==="building"&&f.buildingType===fe.Bonfire?qt:je;return m<=v?(t.activeAction="depositing",l==="food"&&(t.activeActionPayload={amount:Math.min(f.maxFood/2||1,t.food.length||1)}),t.target=f.id,[E.RUNNING,`Delivering to demander ${f.id}`]):(t.target=f.id,t.activeAction="moving",[E.RUNNING,`Moving to demander ${f.id}, distance: ${m.toFixed(1)}`])}return Di(t),[E.FAILURE,"Unknown supply phase"]},"Supply",e)}function yN(e){return new Ce([new me((t,n,i)=>{if(t.isAdult&&t.hitpoints>t.maxHitpoints*su||!(t.hitpoints<t.maxHitpoints*.1)&&t.isAdult&&t.hunger>DR)return!1;const a=nA(t.id,n.gameState);return a?(T.set(i,"fleeThreat",a.id),!0):!1},"Should Flee",e+1),new ge((t,n,i)=>{const s=T.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;t.activeAction="moving";const l=Ye(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=ot(l),u=zn(t.position,Tt(c,Hg));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,E.RUNNING},"Execute Flee",e+1)],"Flee",e)}const Ar="resourceSource";function SN(e){const t=new ge((i,s,a)=>{const l=Wt(i,s.gameState),c=l?jl(l.id,s.gameState):0,u=i.hunger>CS,f=On(s.gameState,i).filter(A=>A.hunger>ia),g=u||f.length>0,m=Vn(i,se.Gatherer,s.gameState),v=()=>{const A=Fe(i,s.gameState,"berryBush",Kh,P=>{if(P.food.length===0||i.leaderId&&!Xn(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${P.id}`,_=T.get(l.aiBlackboard,R);if(_&&s.gameState.time-_.startTime<=Fi&&!_.memberIds.includes(i.id))return!1}return!0}),w=Fe(i,s.gameState,"corpse",Kh,P=>{if(P.food.length===0||i.leaderId&&!Xn(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${P.id}`,_=T.get(l.aiBlackboard,R);if(_&&s.gameState.time-_.startTime<=Fi&&!_.memberIds.includes(i.id))return!1}return!0});if(A&&w){const P=U(i.position,A.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height),R=U(i.position,w.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);return P<=R?A:w}return A||w},S=()=>Fe(i,s.gameState,"tree",Kh,A=>{if(A.stateMachine[0]!==Gt||A.wood.length===0||i.leaderId&&!Xn(A.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const w=`tribal_gather_${A.id}`,P=T.get(l.aiBlackboard,w);if(P&&s.gameState.time-P.startTime<=Fi&&!P.memberIds.includes(i.id))return!1}return!0});let I=null;return g&&i.food.length<i.maxFood?I=v():c>0&&!i.heldItem?I=S():m&&(i.heldItem||(I=S()),!I&&i.food.length<i.maxFood&&(I=v())),I?(T.set(a,Ar,I.id),[E.SUCCESS,`Found ${I.type}: ${I.id} at ${I.position.x.toFixed(0)},${I.position.y.toFixed(0)}`]):[E.FAILURE,"No resource found"]},"Find Closest Resource Source",e+4),n=new Hi(new ge((i,s,a)=>{const l=T.get(a,Ar);if(!l)return[E.FAILURE,"No target in blackboard"];const c=s.gameState.entities.entities[l];return c?(c.type==="tree"&&"wood"in c?c.wood.length===0:c.food.length===0)?(T.delete(a,Ar),[E.FAILURE,"Resource source is depleted"]):U(i.position,c.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<xr?(i.activeAction="gathering",i.direction={x:0,y:0},i.target=c.id,T.delete(a,Ar),[E.SUCCESS,`Gathering from ${c.type}`]):(i.activeAction="moving",i.target=c.id,i.direction=We(i.position,c.position,s.gameState.mapDimensions),[E.RUNNING,`Moving to ${c.type}`]):(T.delete(a,Ar),[E.FAILURE,"Resource source is invalid"])},"Move To Resource and Gather",e+3),{taskType:"gather",maxCapacity:2,getTargetId:(i,s,a)=>T.get(a,Ar)??null},"Tribal Gather Task",e+3);return new Ce([new me((i,s)=>{const a=Wt(i,s.gameState),l=a?jl(a.id,s.gameState):0,c=i.food.length<i.maxFood,u=!i.heldItem,f=i.hunger>CS,g=On(s.gameState,i).filter(A=>A.hunger>ia),m=Vn(i,se.Gatherer,s.gameState),v=hN(i,s.gameState),S=c&&(f||g.length>0||m&&v),I=u&&(l>0||m&&v);return[(i.isAdult&&(S||I))??!1,`${f?"Hungry ":""}${g.length>0?"Children("+g.length+") ":""}${l>0?"WoodNeed("+l+") ":""}${I&&l<=0?"Wood ":""}${v?"Storage":""}`]},"Should Gather Resources",e+1),new cn([new Ce([new me((i,s,a)=>T.has(a,Ar),"Has Resource Source?",e+2),n],"Continue Gathering Action",e+2),new Ce([new Yn(t,kR,"Cache Resource Source Search",e+3),n],"Find New Resource Source and Gather",e+2)],"Perform or Start Gathering",e+1)],"Gather Resources",e)}const vN=.5;function IN(e){return new ge((t,n,i)=>{const{gameState:s}=n,{width:a,height:l}=s.mapDimensions;let c=T.get(i,"wanderTarget");const u=T.get(i,"lastWanderTime")??0,f=s.time;if(!c||f-u>vN||U(t.position,c,a,l)<20){const m=wp(t.position,wR,a,l);t.leaderId?Wg(m,t.leaderId,s)?c=m:c=c1(t.position,m,t.leaderId,s):c=m,T.set(i,"wanderTarget",c),T.set(i,"lastWanderTime",f)}if(c&&U(t.position,c,a,l)>10){t.activeAction="moving",t.target=c;let v=c.x-t.position.x,S=c.y-t.position.y;return Math.abs(v)>a/2&&(v=v>0?v-a:v+a),Math.abs(S)>l/2&&(S=S>0?S-l:S+l),t.direction=ot({x:v,y:S}),E.RUNNING}return t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,E.SUCCESS},"Idle/Wander",e)}const wd="procreationWanderStartTime",lv=(e,t,n)=>t.find(i=>nr(e,i,n)),cv={taskType:"procreation",maxCapacity:2,getTargetId:(e,t,n)=>T.get(n,"procreationPartner")??null};function AN(e){const t=new me((a,l,c)=>{const u=xS(a,l.gameState,xr),f=lv(a,u,l.gameState);return f?(T.set(c,"procreationPartner",f.id),!0):[!1,"No immediate partner found"]},"Find Immediate Partner"),n=new Hi(new ge((a,l,c)=>{var g;const u=T.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=void 0,T.delete(c,"procreationPartner"),T.delete(c,wd),(g=a.partnerIds)!=null&&g.includes(f.id)||(a.partnerIds=a.partnerIds?[...a.partnerIds,f.id]:[f.id]),E.SUCCESS):E.FAILURE},"Start Procreating"),cv,"Tribal Start Procreating",e+2),i=new me((a,l,c)=>{const u=xS(a,l.gameState,PR),f=lv(a,u,l.gameState);return f?(T.set(c,"procreationPartner",f.id),!0):[!1,"No distant partner found"]},"Locate Distant Partner"),s=new Hi(new ge((a,l,c)=>{const u=T.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return[E.FAILURE,"No partner found"];if(f.isPregnant)return[E.FAILURE,"Partner is pregnant"];if(a.hunger>an)return[E.FAILURE,"Too hungry to procreate"];const g=U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);if(g<xr)return[E.SUCCESS,"Reached partner"];if(a.leaderId&&!Xn(f.position,a.leaderId,l.gameState))return[E.FAILURE,"Partner out of operating range"];a.activeAction="moving",a.target=f.id;const m=Ye(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),[E.RUNNING,`${g.toFixed(1)} units away`]},"Move Towards Partner"),cv,"Tribal Move To Partner",e+3);return new Ce([new me(a=>!a.isAdult||a.gender==="female"&&a.isPregnant?[!1,"Not adult or pregnant"]:a.age<Wl||a.gender==="female"&&a.age>Du?[!1,"Not fertile due to age or pregnancy status"]:a.hunger>=an?[!1,"Too hungry"]:!0,"Is Fertile (age, not pregnant)",e+1),new me(a=>a.hunger<an,"Is Healthy (hunger)",e+1),new me(a=>(a.procreationCooldown||0)<=0,"Is Ready (cooldown)",e+1),new cn([new Ce([new me((a,l)=>{const c=MS(a.position,l.gameState,"berryBush",wS);return[c>=RR,`Found ${c} bushes`]},"Is Environment Viable (food)",e+3),new ge((a,l,c)=>(T.delete(c,wd),E.SUCCESS),"Clear Wander Timer",e+3)],"Sufficient Food Path",e+2),new Ce([new me((a,l)=>{const c=On(l.gameState,a);return zr(c)?[!1,"Has an heir"]:!0},"Is Male Without Heir",e+3),new ge((a,l,c)=>{const u=T.get(c,wd);if(u===void 0)return T.set(c,wd,l.gameState.time),[E.FAILURE,"Starting heirless wander timer"];const f=l.gameState.time-u;return f>=K_?MS(a.position,l.gameState,"berryBush",wS)>=1?[E.SUCCESS,`Wandered for ${f.toFixed(1)}h, minimum food found`]:[E.FAILURE,"Desperate but no food sources nearby"]:[E.FAILURE,`Wandering for heir, ${f.toFixed(1)}h elapsed`]},"Check Wander Timer",e+3)],"Heirless Desperation Path",e+2)],"Check Environment Or Desperation",e+1),new me((a,l,c)=>{var f;const u=T.get(c,"procreationPartner");return u&&((f=u.partnerIds)!=null&&f.length)&&!u.partnerIds.includes(a.id)&&a.leaderId!==a.id&&a.leaderId&&u.partnerIds.map(g=>l.gameState.entities.entities[g]).filter(g=>!!g).some(g=>U(a.position,g.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<xR)?[!1,"Partner's primary partner is too close"]:!0},"Is Partner's Primary Partner Nearby",e+1),new cn([new Ce([t,n],"Procreate With Immediate Partner",e+2),new ya(OR,new Ce([i,s,n],"Seek Distant Partner Action",e+3),"Seek Distant Partner Cooldown",e+2)],"Find Partner And Procreate",e+1)],"Procreate",e)}const ws="attackTarget",Tr="homeCenter",ug=150;function TN(e){return new Ce([new me((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.hitpoints>0&&U(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=ug){if(T.set(i,ws,l.id),!T.get(i,Tr)){const c=t.leaderId?In(t.leaderId,s):zl(t,s).length>0?ES(t,s):t.position;T.set(i,Tr,c)}return!0}}if(!Vn(t,se.Warrior,s))return[!1,"Not a Warrior"];const a=Fe(t,s,"human",ug,l=>l.hitpoints>0&&Kr(t,l,s));if(a){T.set(i,ws,a.id);const l=t.leaderId?In(t.leaderId,s):zl(t,s).length>0?ES(t,s):t.position;return T.set(i,Tr,l),!0}return T.set(i,ws,void 0),T.set(i,Tr,void 0),!1},"Find Attack Target",e+1),new ge((t,n,i)=>{const s=T.get(i,ws),a=s&&n.gameState.entities.entities[s],l=T.get(i,Tr);if(!a||!l)return E.FAILURE;const{gameState:c}=n;return U(t.position,l,c.mapDimensions.width,c.mapDimensions.height)>UI?(t.activeAction="idle",t.attackTargetId=void 0,T.set(i,ws,void 0),T.set(i,Tr,void 0),E.FAILURE):a.hitpoints<=0||U(t.position,a.position,c.mapDimensions.width,c.mapDimensions.height)>ug?(t.activeAction==="attacking"&&(t.activeAction="idle",t.attackTargetId=void 0),T.set(i,ws,void 0),T.set(i,Tr,void 0),E.SUCCESS):(t.activeAction==="attacking"&&t.attackTargetId===a.id||(t.activeAction="attacking",t.attackTargetId=a.id),E.RUNNING)},"Execute Attack",e+1)],"Attack",e)}const EN=(e,t,n)=>{const i=On(t.gameState,e).filter(l=>!l.isAdult);if(i.length===0)return E.FAILURE;let s=null,a=ia;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(T.set(n,"targetChild",s.id),E.SUCCESS):E.FAILURE},CN=(e,t,n)=>{const i=T.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>Mu?(e.activeAction="moving",e.target=s.id,e.direction=We(e.position,s.position,t.gameState.mapDimensions),E.RUNNING):(e.activeAction="feeding",e.target=void 0,T.set(n,"targetChild",void 0),E.SUCCESS):E.FAILURE};function wN(e){return new Ce([new me(t=>(t.isAdult&&t.food.length>0&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child",e+1),new ge(EN,"Find Hungriest Child",e+1),new ge(CN,"Move To Child and Feed",e+1)],"Feed Child",e)}function _N(e){return new Ce([new me(t=>!t.isAdult&&t.hunger>=ia,"Is Hungry Child",e+1),new ge((t,n,i)=>{const s=MP(t,n.gameState);if(s.length===0)return E.FAILURE;const a=Fe(t,n.gameState,"human",eR,l=>s.some(c=>c.id===l.id)&&l.food.length>0);return a?(T.set(i,"targetParent",a.id),E.SUCCESS):E.FAILURE},"Find Parent With Food",e+1),new ge((t,n,i)=>{const s=T.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=Mu?(t.target=void 0,E.SUCCESS):(t.target=a.id,t.activeAction="moving",E.RUNNING)},"Move To Parent",e+1)],"Seek Food From Parent",e)}const Er="plantingSpot",_s="plantingZoneId",RN=50;function PN(e,t,n,i){const s=Ye(e,t,n,i);return zn(e,s)}function DN(e){const t=new ge((s,a,l)=>{const c=T.get(l,Er);if(!c)return T.delete(l,Er),T.delete(l,_s),[E.FAILURE,"Planting spot is missing"];if(Li(a.gameState.soilDepletion,c,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height))return T.delete(l,Er),T.delete(l,_s),[E.FAILURE,"Soil is depleted at planting spot"];if(Kn(c,a.gameState,qo,s.id))return T.delete(l,Er),T.delete(l,_s),[E.FAILURE,"Planting spot is occupied"];const u=PN(s.position,c,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height),f=U(s.position,u,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height);return f>xr?(s.activeAction="moving",s.target=u,s.direction=We(s.position,u,a.gameState.mapDimensions),[E.RUNNING,"Moving to planting spot: "+f.toFixed(2)+" units away"]):Kn(c,a.gameState,qo,s.id)?(T.delete(l,Er),T.delete(l,_s),[E.FAILURE,"Planting spot is now occupied"]):(s.activeAction="planting",s.target=c,[E.RUNNING,"Planting state initiated"])},"Move To Spot and Plant",e+4),n=new Hi(t,{taskType:"plant",maxCapacity:2,proximityRadius:RN,getTargetId:(s,a,l)=>T.get(l,_s)??null},"Coordinated Planting",e+3),i=new ge((s,a,l)=>{const c=xP(s,a.gameState);return c?(T.set(l,Er,c.position),T.set(l,_s,c.zoneId),[E.SUCCESS,`Found new spot at ${c.position.x.toFixed(0)}, ${c.position.y.toFixed(0)} (Zone ${c.zoneId})`]):[E.FAILURE,"No suitable planting spot found"]},"Find Optimal Planting Spot",e+3);return new Ce([new me((s,a)=>{if(!Vn(s,se.Planter,a.gameState))return[!1,"Not a Planter"];const l=s.food.filter(f=>f.type===Tn.Berry).length>=fo,c=s.hunger<TR,u=(s.isAdult&&l&&c)??!1;return[u,u?"Can plant":`Cannot plant: adult=${s.isAdult}, berries=${s.food.filter(f=>f.type===Tn.Berry).length}/${fo}, hunger=${s.hunger.toFixed(0)}`]},"Can Plant",e+1),new me((s,a)=>{if(!s.leaderId)return[!1,"No tribe"];const l=LP(s,a.gameState),{count:c,ratio:u}=PA(s.leaderId,a.gameState);let f;return l<WI?f=zR:l<xI?f=jR:l<YI?f=XR:f=VR,[u<f||c<=Hs,`Food security: ${(l*100).toFixed(0)}%, Bush density: ${u.toFixed(1)}/${f}`]},"Needs More Bushes (Adaptive)",e+1),new me((s,a)=>{if(!s.leaderId)return[!0,"No tribe coordination needed"];const l=qn(s,a.gameState),c=OA(s.leaderId,a.gameState,"planting"),u=Math.max(1,Math.ceil(l.length*.3));return[c<u,`Active planters: ${c}/${u}`]},"Not Too Many Planters",e+1),new cn([new Ce([new me((s,a,l)=>T.has(l,Er),"Has Planting Spot?",e+2),n],"Continue Planting Action",e+2),new ya(bR,i,"Find Planting Spot Cooldown",e+2)],"Perform or Start Planting",e+1)],"Plant Bush",e)}const dv="lastDepositTime",Rs="assignedStorageSpot";function MN(e){return new cn([new Ce([new me((t,n,i)=>{var c;const s=((c=t.heldItem)==null?void 0:c.type)===vt.Wood;if(!t.isAdult)return[!1,"Not an adult"];if(!t.leaderId)return[!1,"No tribe"];let a=null,l="";if(s)a=WP(t,n.gameState),l=`Holding wood${a?` (Target: ${a.id})`:""}`;else{if(!Vn(t,se.Gatherer,n.gameState)&&!Vn(t,se.Mover,n.gameState)&&!Vn(t,se.Hunter,n.gameState))return[!1,"Not a Gatherer/Mover/Hunter and not holding wood"];const u=T.get(i,dv)||0,f=n.gameState.time-u;if(f<_S)return[!1,`Cooldown: ${(_S-f).toFixed(1)}h remaining`];const g=_A(t.leaderId,n.gameState);let m;g<.3?m=KR:g<.7?m=qR:m=ZR;const v=t.food.length/t.maxFood;if(v<=m)return[!1,`Food ${(v*100).toFixed(0)}% < threshold ${(m*100).toFixed(0)}%`];a=NA(t,n.gameState),l=`Storage util: ${(g*100).toFixed(0)}%, Personal: ${(v*100).toFixed(0)}%`}return a?(T.set(i,Rs,a.id),[!0,l]):[!1,"No available tribe storage nearby"]},"Check for Excess Food and Storage",e+1),new me((t,n)=>{if(!t.leaderId)return[!0,"No tribe coordination needed"];const i=OA(t.leaderId,n.gameState,"depositing"),s=qn(t,n.gameState),a=ca(t.leaderId,n.gameState).length,l=Math.max(2,Math.ceil(s.length*.4)+a);return[i<l,`Active depositors: ${i}/${l}`]},"Not Too Many Depositors",e+1),new Hi(new ge((t,n,i)=>{var c,u;const s=T.get(i,Rs);if(!s)return[E.FAILURE,"No storage assigned"];const a=n.gameState.entities.entities[s];if(!a)return T.delete(i,Rs),[E.FAILURE,"Storage entity missing"];if((((c=a.storedItems)==null?void 0:c.length)??0)>=(a.storageCapacity??0))return T.delete(i,Rs),[E.FAILURE,"Storage full"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l<=qt){t.activeAction="depositing",t.target=void 0,T.set(i,dv,n.gameState.time),T.delete(i,Rs);const f=((u=t.heldItem)==null?void 0:u.type)===vt.Wood;return[E.SUCCESS,f?"Depositing wood":"Depositing food"]}return t.activeAction="moving",t.target=a.position,[E.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`]},"Navigate to Storage and Deposit",e+2),{taskType:"storage",maxCapacity:zp,storageAction:"deposit",getTargetId:(t,n,i)=>T.get(i,Rs)??null},"Tribal Storage Deposit Task",e+1)],"Deposit Sequence",e)],"Storage Deposit Behavior",e)}const _d="retrievalStorageId";function NN(e){return new cn([new Ce([new me((t,n,i)=>{if(t.hunger<=sa)return[!1,"Not hungry enough"];if(t.food.length>=t.maxFood)return[!1,"Inventory full"];const s=Wt(t,n.gameState),a=gN(t,n.gameState,void 0,s==null?void 0:s.aiBlackboard,t.id),l=hT(t,a,n.gameState),c=l==null?void 0:l.storage;return c?(T.set(i,_d,c.id),[!0,`Storage with food found at distance ${l.distance.toFixed(1)}`]):[!1,"No tribe storage with food nearby"]},"Check for Hunger and Storage Food",e+1),new Hi(new ge((t,n,i)=>{const s=T.get(i,_d);if(!s)return[E.FAILURE,"No storage target"];const a=n.gameState.entities.entities[s];if(!a)return T.delete(i,_d),[E.FAILURE,"Storage not found"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=qt?(t.activeAction="retrieving",t.target=void 0,[E.SUCCESS,"Retrieving food"]):(t.activeAction="moving",t.target=a.position,[E.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`])},"Navigate to Storage and Retrieve",e+2),{taskType:"storage",maxCapacity:zp,storageAction:"retrieve",getTargetId:(t,n,i)=>T.get(i,_d)??null},"Coordinated Storage Retrieve",e+1)],"Retrieve Sequence",e)],"Storage Retrieve Behavior",e)}const fg="combatTarget",hg="homeCenter";function ON(e){const t=new me(a=>a.isAdult&&a.leaderId?a.id!==a.leaderId:!1,"Is Tribe Follower?",e+1),n=new me(a=>a.hunger<ER&&a.hitpoints>=a.maxHitpoints*su,"Is Fit for Combat?",e+1),i=new ge((a,l,c)=>{const{gameState:u}=l,f=u.entities.entities[a.leaderId];if(!f)return E.FAILURE;const g=JP(f,u,MR);if(g.length===0)return E.FAILURE;g.sort((m,v)=>{const S=U(a.position,m.position,u.mapDimensions.width,u.mapDimensions.height),I=U(a.position,v.position,u.mapDimensions.width,u.mapDimensions.height);return S-I});for(const m of g)if(eD(f.id,m.id,u)<HI){T.set(c,fg,m.id);const S=In(f.id,u);return T.set(c,hg,S),E.SUCCESS}return E.FAILURE},"Find Best Target",e+1),s=new ge((a,l,c)=>{const u=T.get(c,fg),f=u&&l.gameState.entities.entities[u],g=T.get(c,hg);if(!f||!g)return E.FAILURE;const{gameState:m}=l;return U(a.position,g,m.mapDimensions.width,m.mapDimensions.height)>UI?(a.activeAction==="attacking"&&a.attackTargetId===f.id&&(a.activeAction="idle",a.attackTargetId=void 0),T.set(c,fg,void 0),T.set(c,hg,void 0),E.FAILURE):((!a.lastTargetAcquiredEffectTime||l.gameState.time-a.lastTargetAcquiredEffectTime>Ke*5)&&($e(l.gameState,_e.TargetAcquired,a.position,Ke,a.id),a.lastTargetAcquiredEffectTime=l.gameState.time),a.activeAction="attacking",a.attackTargetId=f.id,a.target=void 0,E.RUNNING)},"Attack Target",e+1);return new Ce([t,n,i,s],"Tribe Member Combat",e)}function bN(e){const t=new me((M,D)=>!M.leaderId||M.leaderId!==M.id?[!1,"Not a tribe leader"]:On(D.gameState,M).length<Bp?[!1,"Leader has no children"]:[!0,"Is tribe leader"],"Is Leader",e+1),n=new ge((M,D,N)=>{const k=qn(M,D.gameState),L=k.filter(x=>x.isAdult),z=ga(M.leaderId,D.gameState,!0),V=Fu(M,D.gameState,!0).filter(x=>DA(x,D.gameState)),X=_A(M.leaderId,D.gameState),{count:Q,ratio:q}=PA(M.leaderId,D.gameState),ie=V.length/Math.max(1,k.length),oe=Math.ceil(L.length*(1+JR)),ee=ca(M.leaderId,D.gameState,!0);return T.set(N,"tribeAnalysis_adultCount",L.length),T.set(N,"tribeAnalysis_existingStorageSpots",z.length),T.set(N,"tribeAnalysis_existingPlantingZones",V.length),T.set(N,"tribeAnalysis_existingBonfires",ee.length),T.set(N,"tribeAnalysis_storageUtilization",X),T.set(N,"tribeAnalysis_bushCount",Q),T.set(N,"tribeAnalysis_bushDensity",q),T.set(N,"tribeAnalysis_zoneDensity",ie),T.set(N,"tribeAnalysis_projectedAdultCount",oe),[E.SUCCESS,`Analyzed tribe: ${L.length} adults, ${z.length} storage, ${V.length} viable planting zones, ${ee.length} bonfires`]},"Analyze Tribe",e+1),i=new Yn(n,1,"Cached Tribe Analysis",e+1),s=new me((M,D,N)=>{const k=T.get(N,"tribeAnalysis_adultCount");return k===void 0?[!1,"No tribe analysis available"]:k<RS?[!1,`Tribe too small: ${k}/${RS} adults`]:[!0,`Tribe size sufficient: ${k} adults`]},"Has Minimum Tribe Size",e+1),a=new me((M,D,N)=>{if(T.has(N,"buildingPlacement_storageTarget"))return[!0,"Placement already in progress"];const k=T.get(N,"tribeAnalysis_adultCount"),L=T.get(N,"tribeAnalysis_existingStorageSpots"),z=T.get(N,"tribeAnalysis_storageUtilization"),V=T.get(N,"tribeAnalysis_projectedAdultCount");if(k===void 0||L===void 0||z===void 0||V===void 0)return[!1,"No tribe analysis available"];const X=L===0,Q=z*(V/Math.max(1,k));return X||z>Ug||Q>Ug?[!0,X?"Bootstrap: First storage spot":`Utilization: ${(z*100).toFixed(0)}% (projected: ${(Q*100).toFixed(0)}%)`]:[!1,`Storage adequate: ${L}, util: ${(z*100).toFixed(0)}%`]},"Needs Storage",e+2),l=new ge((M,D,N)=>{if(T.has(N,"buildingPlacement_storageTarget"))return[E.SUCCESS,"Using existing storage placement target"];const k=T.get(N,"tribeAnalysis_existingStorageSpots");if(k===void 0)return[E.FAILURE,"No tribe analysis available"];const z=k===0?zI:Vs,V=Ks(fe.StorageSpot,M.id,D.gameState,eo,z,M.position);return V?(T.set(N,"buildingPlacement_storageTarget",V),[E.SUCCESS,`Found storage location at (${V.x.toFixed(0)}, ${V.y.toFixed(0)})`]):[E.FAILURE,`No valid location found for storage within ${eo}px`]},"Find Storage Location",e+2),c=new ge((M,D,N)=>{const k=T.get(N,"buildingPlacement_storageTarget");if(!k)return[E.FAILURE,"No target location in blackboard"];const L=U(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return L<=to?[E.SUCCESS,`Reached storage location (${L.toFixed(0)}px away)`]:(M.activeAction="moving",M.target=k,M.direction=We(M.position,k,D.gameState.mapDimensions),[E.RUNNING,`Moving to storage location (${L.toFixed(0)}px away)`])},"Move To Storage Location",e+2),u=new ge((M,D,N)=>{const k=T.get(N,"buildingPlacement_storageTarget");if(!k)return[E.FAILURE,"No target location in blackboard"];const L=U(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return L>to?[E.FAILURE,`Too far from placement location: ${L.toFixed(0)}px`]:(Vo(k,fe.StorageSpot,M.id,D.gameState),T.delete(N,"buildingPlacement_storageTarget"),T.delete(N,"caching_Cached Tribe Analysis_status"),T.delete(N,"caching_Cached Tribe Analysis_timestamp"),delete N.nodeExecutionData["Cached Tribe Analysis"],[E.SUCCESS,`Placed storage at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`])},"Place Storage",e+2),f=new Ce([a,l,c,u],"Storage Sequence",e+1),g=new me((M,D,N)=>{if(!M.leaderId)return[!1,"No tribe"];if(T.has(N,"buildingPlacement_bonfireTarget"))return[!0,"Placement already in progress"];const k=T.get(N,"tribeAnalysis_existingBonfires")||0,L=T.get(N,"tribeAnalysis_adultCount")||0,z=In(M.leaderId,D.gameState),V=er(D.gameState.temperature,z,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height),X=V<sA&&k===0,Q=k>0&&k<Math.ceil(L/aA),q=qn(M,D.gameState),ie=ca(M.leaderId,D.gameState,!0),oe=q.filter(x=>er(D.gameState.temperature,x.position,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)<co+5?ie.every(j=>U(x.position,j.position,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)>kr*1.5):!1),ee=oe.length>=3;if(X||Q||ee){if(ee){const K=oe.reduce((Z,B)=>({x:Z.x+B.position.x,y:Z.y+B.position.y}),{x:0,y:0});K.x/=oe.length,K.y/=oe.length,T.set(N,"buildingPlacement_coldClusterPos",K)}else T.delete(N,"buildingPlacement_coldClusterPos");let x="";return X?x=`Cold at center: ${V.toFixed(1)}C`:Q?x=`Tribe size: ${L}/${k} fires`:x=`Cold cluster: ${oe.length} members`,[!0,x]}return[!1,`Adequate heating: ${k} fires for ${L} adults`]},"Needs Bonfire",e+2),m=new ge((M,D,N)=>{if(T.has(N,"buildingPlacement_bonfireTarget"))return[E.SUCCESS,"Using existing bonfire placement target"];const k=T.get(N,"buildingPlacement_coldClusterPos"),L=Ks(fe.Bonfire,M.id,D.gameState,eo,Vs,k||M.position);return L?(T.set(N,"buildingPlacement_bonfireTarget",L),[E.SUCCESS,`Found bonfire location at (${L.x.toFixed(0)}, ${L.y.toFixed(0)})`]):[E.FAILURE,`No valid location found for bonfire within ${eo}px`]},"Find Bonfire Location",e+2),v=new ge((M,D,N)=>{const k=T.get(N,"buildingPlacement_bonfireTarget");if(!k)return[E.FAILURE,"No target location in blackboard"];const L=U(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return L<=to?[E.SUCCESS,`Reached bonfire location (${L.toFixed(0)}px away)`]:(M.activeAction="moving",M.target=k,M.direction=We(M.position,k,D.gameState.mapDimensions),[E.RUNNING,`Moving to bonfire location (${L.toFixed(0)}px away)`])},"Move To Bonfire Location",e+2),S=new ge((M,D,N)=>{const k=T.get(N,"buildingPlacement_bonfireTarget");if(!k)return[E.FAILURE,"No target location in blackboard"];const L=U(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return L>to?[E.FAILURE,`Too far from placement location: ${L.toFixed(0)}px`]:(Vo(k,fe.Bonfire,M.id,D.gameState),T.delete(N,"buildingPlacement_bonfireTarget"),T.delete(N,"caching_Cached Tribe Analysis_status"),T.delete(N,"caching_Cached Tribe Analysis_timestamp"),delete N.nodeExecutionData["Cached Tribe Analysis"],[E.SUCCESS,`Placed bonfire at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`])},"Place Bonfire",e+2),I=new Ce([g,m,v,S],"Bonfire Sequence",e+1),A=new me((M,D,N)=>{if(T.has(N,"buildingPlacement_plantingTarget"))return[!0,"Placement already in progress"];const k=T.get(N,"tribeAnalysis_adultCount"),L=T.get(N,"tribeAnalysis_existingPlantingZones"),z=T.get(N,"tribeAnalysis_bushDensity"),V=T.get(N,"tribeAnalysis_bushCount"),X=T.get(N,"tribeAnalysis_zoneDensity"),Q=T.get(N,"tribeAnalysis_projectedAdultCount");if(k===void 0||L===void 0||z===void 0||V===void 0||X===void 0||Q===void 0)return[!1,"No tribe analysis available"];const q=z*(k/Math.max(1,Q)),oe=L===0||z<Gg||q<Gg||V<=Hs&&L<=Hs;return oe&&X>q&&(V>Hs||L>Hs)?[!1,`Planting zone density (${X.toFixed(2)}) exceeds projected density (${q.toFixed(2)})`]:oe?[!0,`Low bush density: ${z.toFixed(1)}, count: ${V}/${L} (projected: ${q.toFixed(1)})`]:[!1,`Planting zones adequate: ${L}, density: ${z.toFixed(1)}`]},"Needs Planting Zone",e+2),w=new ge((M,D,N)=>{if(T.has(N,"buildingPlacement_plantingTarget"))return[E.SUCCESS,"Using existing planting zone placement target"];const k=Ks(fe.PlantingZone,M.id,D.gameState,eo,Vs,M.position);return k?(T.set(N,"buildingPlacement_plantingTarget",k),[E.SUCCESS,`Found planting zone location at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`]):[E.FAILURE,`No valid location found for planting zone within ${eo}px`]},"Find Planting Zone Location",e+2),P=new ge((M,D,N)=>{const k=T.get(N,"buildingPlacement_plantingTarget");if(!k)return[E.FAILURE,"No target location in blackboard"];const L=U(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return L<=to?[E.SUCCESS,`Reached planting zone location (${L.toFixed(0)}px away)`]:(M.activeAction="moving",M.target=k,M.direction=We(M.position,k,D.gameState.mapDimensions),[E.RUNNING,`Moving to planting zone location (${L.toFixed(0)}px away)`])},"Move To Planting Zone Location",e+2),R=new ge((M,D,N)=>{const k=T.get(N,"buildingPlacement_plantingTarget");if(!k)return[E.FAILURE,"No target location in blackboard"];const L=U(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return L>to?[E.FAILURE,`Too far from placement location: ${L.toFixed(0)}px`]:(Vo(k,fe.PlantingZone,M.id,D.gameState),T.delete(N,"buildingPlacement_plantingTarget"),T.delete(N,"caching_Cached Tribe Analysis_status"),T.delete(N,"caching_Cached Tribe Analysis_timestamp"),delete N.nodeExecutionData["Cached Tribe Analysis"],[E.SUCCESS,`Placed planting zone at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`])},"Place Planting Zone",e+2),_=new Ce([A,w,P,R],"Planting Zone Sequence",e+1),b=new cn([f,I,_],"Building Type Selector",e+1);return new Ce([t,i,s,b],"Leader Building Placement",e)}const Bo="takeOverBuildingTarget";function kN(e){const t=new Ce([new me((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=T.get(s,Bo);if(a){const c=i.gameState.entities.entities[a];if(c&&c.type==="building"&&Vt(n,c,i.gameState))return[!0,`Continuing to target building ${a}`];T.delete(s,Bo)}const l=Fe(n,i.gameState,"building",XI,c=>Vt(n,c,i.gameState)&&c.isConstructed);return l?(T.set(s,Bo,l.id),[!0,`Found enemy building at distance ${U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Take Over",e+2),new ge((n,i,s)=>{const a=T.get(s,Bo);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(T.delete(s,Bo),n.activeAction="idle",n.target=void 0,E.FAILURE):U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<je?(n.activeAction="idle",n.target=void 0,E.SUCCESS):(n.activeAction="moving",n.target=l.id,E.RUNNING)},"Move to Enemy Building",e+2),new ge((n,i,s)=>{const a=T.get(s,Bo);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(T.delete(s,Bo),E.FAILURE):(n.activeAction="takingOverBuilding",n.target=l.id,T.delete(s,Bo),E.SUCCESS)},"Initiate Building Takeover",e+2)],"Take Over Building Action",e+1);return new ya(jI,t,"Take Over Building Cooldown",e)}const uv=2,BN=40,fv=3;function FN(e){const t=new me(a=>{if(!a.isAdult)return[!1,"Not an adult"];if(a.hunger>mp)return[!1,`Too hungry (${a.hunger.toFixed(1)})`];const l=a.leaderId===a.id,c=a.tribeRole===se.Warrior;return!l&&!c?[!1,`Not a Warrior or Leader (role: ${a.tribeRole||"none"})`]:[!0,l?"Is Leader":"Is Warrior"]},"Is Warrior or Leader",e+1),n=new me(a=>{var c,u;if(a.leaderId!==a.id)return[!0,"Warrior follows leader strategy"];const l=((u=(c=a.tribeControl)==null?void 0:c.armyControl)==null?void 0:u.expandBorders)??0;return l<uv?[!1,`Expand borders weight too low: ${l}/${uv}`]:[!0,`Expand borders weight: ${l}`]},"Has Expand Borders Weight",e+1),i=new me((a,l)=>{if(!a.leaderId)return[!1,"No tribe leader"];const u=l.gameState.search.building.byProperty("ownerId",a.leaderId);return u.length===0?[!1,"No territory to expand"]:[!0,`Tribe has ${u.length} buildings`]},"Has Territory",e+1),s=new ge((a,l,c)=>{if(!a.leaderId)return[E.FAILURE,"No leader"];const u=l.gameState,f=u.mapDimensions.width,g=u.mapDimensions.height,m=d1(a.position,a.leaderId,u);if(!m)return[E.FAILURE,"Could not find territory edge"];const v=U(a.position,m,f,g);if(v>BN)return a.activeAction="moving",a.target=m,[E.RUNNING,`Approaching territory edge (${v.toFixed(0)}px)`];const I=u.search.building.byProperty("ownerId",a.leaderId),A=Qd(I.map(k=>k.position));T.get(c,"pioneerOrbitDirection")===void 0&&T.set(c,"pioneerOrbitDirection",1);const w=Math.ceil(f/Se),P=Math.ceil(g/Se),R=KI(a.position),_=[];for(let k=-3;k<=fv;k++)for(let L=-3;L<=fv;L++){if(L===0&&k===0)continue;const z=((R.x+L)%w+w)%w,V=((R.y+k)%P+P)%P,X=V*w+z,Q=u.terrainOwnership[X],q=Q!==null&&Ui(a.leaderId,Q,u);if(Q!==null&&!q)continue;const ie={x:z*Se+Se/2,y:V*Se+Se/2};QI(ie,a.leaderId,u,rp,!0,a.leaderId).canPlace&&_.push({pos:ie,gx:z,gy:V})}if(_.length===0)return T.set(c,"pioneerOrbitDirection",-T.get(c,"pioneerOrbitDirection")),[E.RUNNING,"Blocked, reversing orbit direction"];const b=ot(Ye(A,a.position,f,g)),M=wg(b,T.get(c,"pioneerOrbitDirection")*(Math.PI/2));let D=_[0],N=-1/0;for(const k of _){let L=0;for(let oe=-1;oe<=1;oe++)for(let ee=-1;ee<=1;ee++){if(ee===0&&oe===0)continue;const x=((k.gx+ee)%w+w)%w,K=((k.gy+oe)%P+P)%P;u.terrainOwnership[K*w+x]===a.leaderId&&L++}const z=ot(Ye(a.position,k.pos,f,g)),V=jv(z,M),X=U(A,k.pos,f,g),Q=U(A,a.position,f,g),q=X>Q?1:0,ie=L*2+V*1.5+q*.5;ie>N&&(N=ie,D=k)}return Vo(a.position,fe.BorderPost,a.leaderId,u),a.target=D.pos,a.activeAction="moving",[E.RUNNING,"Expanding territory (cell-based)"]},"Pioneer Expansion",e+1);return new Ce([t,n,i,s],"Border Expansion",e)}const Fo="removeEnemyBuildingTarget";function LN(e){const t=new Ce([new me((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=T.get(s,Fo);if(a){const c=i.gameState.entities.entities[a];if(c&&c.type==="building"&&Vt(n,c,i.gameState))return[!0,`Continuing to target building ${a}`];T.delete(s,Fo)}const l=Fe(n,i.gameState,"building",XI,c=>Vt(n,c,i.gameState)&&c.isConstructed);return l?(T.set(s,Fo,l.id),[!0,`Found enemy building at distance ${U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Destroy",e+2),new ge((n,i,s)=>{const a=T.get(s,Fo);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(T.delete(s,Fo),n.activeAction="idle",n.target=void 0,E.FAILURE):U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<je?(n.activeAction="idle",n.target=void 0,E.SUCCESS):(n.activeAction="moving",n.target=l.id,E.RUNNING)},"Move to Enemy Building",e+2),new ge((n,i,s)=>{const a=T.get(s,Fo);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(T.delete(s,Fo),E.FAILURE):(n.activeAction="destroyingBuilding",n.target=l.id,T.delete(s,Fo),E.SUCCESS)},"Initiate Building Destruction",e+2)],"Remove Enemy Building Action",e+1);return new ya(jI,t,"Remove Enemy Building Cooldown",e)}function HN(e){return new Ce([new ge((t,n,i)=>{const s=jg(t,n.gameState);return s?(T.set(i,"patriarchTarget",s.id),[E.SUCCESS,`Found patriarch: ${s.id}`]):(T.delete(i,"patriarchTarget"),[E.FAILURE,"No patriarch found"])},"Find Patriarch",e+1),new ge((t,n,i)=>{const s=T.get(i,"patriarchTarget"),a=s&&n.gameState.entities.entities[s];if(!a)return[E.FAILURE,"Patriarch target missing from blackboard"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l>_R){t.activeAction="moving",t.target=a.id;const c=Ye(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(c),[E.RUNNING,`Moving to patriarch at ${l.toFixed(0)}`]}return t.activeAction="idle",t.target=void 0,t.direction={x:0,y:0},[E.SUCCESS,`Arrived at patriarch at ${l.toFixed(0)}`]},"Move Towards Patriarch",e+1)],"Follow Patriarch",e)}function UN(e){const t=new cn([new Ce([new me((n,i)=>{if(!n.aiBlackboard)return[!1,"No blackboard"];if(!n.leaderId||n.leaderId===n.id)return[!1,"No tribe or the leader"];if(fu(n,i.gameState).id!==n.id)return[!1,"Not patriarch"];const a=Al(n.aiBlackboard);return a!=="idle"&&_D(n.aiBlackboard,i.gameState.time)?(Es(n.aiBlackboard,"idle",i.gameState.time),[!1,"Phase timed out, reset to idle"]):[a==="idle",`Phase: ${a}`]},"Is Idle?",e+2),new ge((n,i)=>{if(!n.aiBlackboard)return E.FAILURE;const s=Gp(n,i.gameState);return s.canSplit&&s.strategy?(Es(n.aiBlackboard,"planning",i.gameState.time),jA(n.aiBlackboard,s.strategy),E.SUCCESS):[E.FAILURE,s.reason||"Cannot split"]},"Check Split Conditions",e+2)],"Check Phase",e+1),new Ce([new me(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Al(n.aiBlackboard);return[i==="planning",`Phase: ${i}`]},"Is Planning?",e+2),new ge((n,i)=>n.aiBlackboard?YA(n,i.gameState)?(Es(n.aiBlackboard,"gathering",i.gameState.time),E.SUCCESS):(Es(n.aiBlackboard,"idle",i.gameState.time),E.FAILURE):E.FAILURE,"Plan Split Strategy",e+2)],"Planning Phase",e+1),new Ce([new me(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Al(n.aiBlackboard);return[i==="gathering",`Phase: ${i}`]},"Is Gathering?",e+2),new ge((n,i)=>{if(!n.aiBlackboard)return E.FAILURE;const[s,a]=CD(n,i.gameState);return s?(Es(n.aiBlackboard,"executing",i.gameState.time),E.SUCCESS):[E.RUNNING,`Progress: ${a.toFixed(2)}`]},"Wait for Family to Gather",e+2)],"Gathering Phase",e+1),new Ce([new me(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Al(n.aiBlackboard);return[i==="executing",`Phase: ${i}`]},"Is Executing?",e+2),new ge((n,i)=>n.aiBlackboard?zA(n,i.gameState)?E.SUCCESS:(Es(n.aiBlackboard,"idle",i.gameState.time),E.FAILURE):E.FAILURE,"Execute Tribe Split",e+2)],"Execution Phase",e+1)],"Tribe Split State Machine",e+1);return new ya(nD,t,"Tribe Split Cooldown",e)}const Rd="jealousyAttackTarget";function GN(e){return new Ce([new me((t,n,i)=>{var l,c;if(!t.isAdult)return[!1,"Not an adult"];if(t.gender!=="male")return[!1,"Not male"];const s=((c=(l=t.partnerIds)==null?void 0:l.map(u=>{var f;return(f=n.gameState.entities.entities[u])==null?void 0:f.pregnancyFatherId}))==null?void 0:c.filter(u=>!!u&&u!==t.id))??[],a=n.gameState.search.human.byRadius(t.position,HR).find(u=>s.includes(u.id));return a?t.leaderId&&a.id===t.leaderId?[!1,"Stranger is the tribe leader - no attack"]:(T.set(i,Rd,a.id),[!0,`Partner cheating with ${a.id}`]):(T.delete(i,Rd),!1)},"Check for Infidelity",e+1),new ge((t,n,i)=>{const s=T.get(i,Rd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(T.delete(i,Rd),[E.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?E.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[E.RUNNING,`Attacking ${a.id}`])},"Execute Jealousy Attack",e+1)],"Jealousy Attack",e)}const Pd="defendAggressor";function $N(e){return new Ce([new me((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const s=ZP(t,n.gameState,UR);return s?(T.set(i,Pd,s.aggressor.id),[!0,`Family member ${s.familyMember.id} attacked by ${s.aggressor.id}`]):(T.delete(i,Pd),!1)},"Check Family Under Attack",e+1),new ge((t,n,i)=>{const s=T.get(i,Pd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(T.delete(i,Pd),[E.FAILURE,"Target invalid/dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?E.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[E.RUNNING,`Attacking aggressor ${a.id}`])},"Execute Family Defense Attack",e+1)],"Defend Family",e)}const Dd="desperateAttackTarget";function WN(e){return new Ce([new me(t=>t.hunger>GR,"Is Starving",e+1),new me((t,n)=>{if(!t.isAdult)return[!1,"Not an adult"];const i=Fe(t,n.gameState,"berryBush",je,a=>a.food.length>0),s=Fe(t,n.gameState,"corpse",je,a=>a.food.length>0);return!i&&!s},"No Other Food Available",e+1),new me((t,n,i)=>{const s=QP(t,n.gameState);return s?(T.set(i,Dd,s.id),[!0,`Found weak target ${s.id}`]):(T.delete(i,Dd),!1)},"Find Weak Target",e+1),new ge((t,n,i)=>{const s=T.get(i,Dd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(T.delete(i,Dd),[E.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?E.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[E.RUNNING,`Desperately attacking ${a.id}`])},"Execute Desperate Attack",e+1)],"Desperate Attack",e)}function xN(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const a=U(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),c=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?vn:ho;return a<=c?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=s.id,t.direction=We(t.position,s.position,e.mapDimensions),E.RUNNING)}function YN(e){return new Ce([new me((t,n)=>t.isPlayer===!0&&!!n.gameState.autopilotControls.activeAutopilotAction,"Has Player Command",e+1),new ge((t,n)=>{var a;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return E.FAILURE;switch(s.action){case ue.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=s.position;return U(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<$I?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),E.SUCCESS):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),E.RUNNING)}case ue.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;let c=!1;if(l.type==="berryBush")c=l.food.length===0;else if(l.type==="corpse")c=l.food.length===0;else if(l.type==="tree"){const f=l;c=f.stateMachine[0]!==Gt||f.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;return c?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>xr?(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),E.RUNNING):(t.activeAction="gathering",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS)}case ue.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const[c]=l.stateMachine??[];return!(c===ln||c===Kt||c===An)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Jl?(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),E.RUNNING):(t.activeAction="chopping",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS)}case ue.AutopilotAttack:return"targetEntityId"in s?xN(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE);case ue.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||!nr(t,l,n.gameState)?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Xs?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),E.RUNNING)}case ue.AutopilotPlant:{if(t.activeAction==="planting")return E.RUNNING;if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=s.position;return Kn(l,i,qo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<=Xs?(t.activeAction="planting",t.target=l,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,E.RUNNING):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),E.RUNNING)}case ue.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Xs?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),E.RUNNING)}case ue.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l||l.buildingType!==fe.StorageSpot&&l.buildingType!==fe.Bonfire||!l.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const c=l.storageCapacity??0;if(l.storedItems.length>=c||t.leaderId!==l.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const f=t.food.length>0,g=!!t.heldItem;if(l.buildingType===fe.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==vt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE}else if(!f&&!g)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;return U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),E.RUNNING)}case ue.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.buildingType!==fe.StorageSpot||!l.isConstructed||l.storedItems.length===0||t.leaderId!==l.ownerId||t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),E.RUNNING)}case ue.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=je?(t.activeAction="takingOverBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),E.RUNNING)}case ue.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=je?(t.activeAction="destroyingBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,E.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),E.RUNNING)}case ue.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const l=s.position,c=s.buildingType;if(!c)return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE;const u=U(t.position,l,i.mapDimensions.width,i.mapDimensions.height),f=100;return u<=f?aa(l,c,t.leaderId,i,t.position,f)?(Vo(l,c,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",E.SUCCESS):(i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),E.RUNNING)}default:return i.autopilotControls.activeAutopilotAction=void 0,E.FAILURE}},"Execute Player Command",e+1)],"Player Command Handler",e)}function zN(e){const t=new me(i=>i.id===i.leaderId,"Is Leader?",e+1),n=new ge((i,s)=>{var f,g,m,v,S,I;const{gameState:a}=s,l=ci(i.id,a),c=pu(l),u=ec(a).filter(A=>A.leaderId!==i.id);for(const A of u){const w=ci(A.leaderId,a),P=pu(w),R=((g=(f=i.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[A.leaderId])||ut.Friendly,_=a.entities.entities[A.leaderId];((v=(m=_==null?void 0:_.tribeControl)==null?void 0:m.diplomacy)==null?void 0:v[i.id])===ut.Hostile||c>P*GI?R!==ut.Hostile&&((S=i.tribeControl)!=null&&S.diplomacy)&&(i.tribeControl.diplomacy[A.leaderId]=ut.Hostile):R!==ut.Friendly&&((I=i.tribeControl)!=null&&I.diplomacy)&&(i.tribeControl.diplomacy[A.leaderId]=ut.Friendly)}return E.SUCCESS},"Evaluate Diplomacy",e+2);return new Ce([t,new ya(Lg,n,"Diplomacy Cooldown",e+1)],"Manage Diplomacy",e)}const cl="huntTarget";function jN(e){return new Ce([new Yn(new me((n,i,s)=>{if(!n.isAdult)return[!1,"Not an adult"];if(!n.leaderId)return[!1,"Not in a tribe"];if(!Vn(n,se.Hunter,i.gameState))return[!1,"Not a Hunter"];const a=Fe(n.position,i.gameState,"prey",CR,l=>!(n.leaderId&&!Xn(l.position,n.leaderId,i.gameState)));return a?(T.set(s,cl,a.id),[!0,"Found prey"]):[!1,"No suitable prey found"]},"Find Prey Target",e+2),LR,"Cache Find Prey",e+1),new Hi(new Mr(new ge((n,i,s)=>{if(!n.leaderId)return E.FAILURE;const a=T.get(s,cl);if(!a)return E.FAILURE;const l=i.gameState.entities.entities[a];if(!l||l.hitpoints<=0)return T.delete(s,cl),n.activeAction="idle",n.attackTargetId=void 0,E.SUCCESS;const{gameState:c}=i,u=In(n.leaderId,c);return U(n.position,u,c.mapDimensions.width,c.mapDimensions.height)>LI?(T.delete(s,cl),n.activeAction="idle",n.attackTargetId=void 0,E.FAILURE):(n.activeAction="attacking",n.attackTargetId=l.id,E.RUNNING)},"Hunt Prey Action",e+3),Ns,"Hunt Prey Timeout",e+2),{taskType:"hunt",maxCapacity:xu,getTargetId:(n,i,s)=>T.get(s,cl)??null},"Tribal Hunt Task",e+1)],"Human Hunt Prey Sequence",e)}const Md="defendTarget",gg=150;function XN(e){return new Ce([new me((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult - children flee instead"];if(t.hitpoints<=t.maxHitpoints*.3)return[!1,"Too injured to defend"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.type==="predator"&&l.hitpoints>0&&U(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=gg)return T.set(i,Md,l.id),[!0,"Continuing defense"]}const a=Fe(t,s,"predator",gg,l=>l.hitpoints>0&&(l.isAdult||!1));if(a){const l=U(t.position,a.position,s.mapDimensions.width,s.mapDimensions.height),c=a.attackTargetId===t.id,u=l<80;if(c||u)return T.set(i,Md,a.id),[!0,"Predator threat detected"]}return T.set(i,Md,void 0),[!1,"No predator threat"]},"Detect Predator Threat",e+1),new ge((t,n,i)=>{const s=T.get(i,Md),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;const{gameState:l}=n,c=U(t.position,a.position,l.mapDimensions.width,l.mapDimensions.height);return t.hitpoints<t.maxHitpoints*.3?E.FAILURE:a.hitpoints<=0||c>gg*1.5?(t.activeAction="idle",t.attackTargetId=void 0,E.SUCCESS):(t.activeAction="attacking",t.attackTargetId=a.id,E.RUNNING)},"Defend Against Predator",e+1)],"Human Defend Against Predator",e)}function VN(e){const t=new ge((n,i)=>{if(!n.leaderId||!n.isAdult)return E.FAILURE;const s=i.gameState.entities.entities[n.leaderId];if(!s||!s.tribeControl)return E.FAILURE;if(n.id===s.id)return n.tribeRole!==se.Leader&&(n.tribeRole=se.Leader),E.SUCCESS;const l=qn(s,i.gameState).filter(A=>A.id!==s.id),c=l.length;if(c===0)return E.SUCCESS;const u=s.tribeControl.roleWeights;let f=0;const g=[];for(const A of Object.values(se))A!==se.Leader&&(f+=u[A]||0,g.push(A));if(f===0)return n.tribeRole||(n.tribeRole=se.Gatherer),E.SUCCESS;const m={},v={},S={};for(const A of g)m[A]=0,v[A]=u[A]/f*c;for(const A of l)A.tribeRole&&A.tribeRole!==se.Leader&&(m[A.tribeRole]=(m[A.tribeRole]||0)+1);for(const A of g)S[A]=v[A]-m[A];let I=!1;if((!n.tribeRole||n.tribeRole===se.Leader||S[n.tribeRole]<-.5&&g.some(P=>S[P]>.5))&&(I=!0),I){let A=null,w=-1/0;const P=[...g].sort(()=>Math.random()-.5);for(const R of P){const _=S[R];_>w&&(w=_,A=R)}if(A)n.tribeRole=A;else{const R=Math.random()*f;let _=0;for(const b of g)if(_+=u[b],R<=_){n.tribeRole=b;break}}}return E.SUCCESS},"Assign Tribe Role",e+1);return new Yn(t,Ls,"Cache Tribe Role Assignment",e)}const KN=5,qN=0,ZN=10;function QN(e){return e<WI?{[se.Leader]:0,[se.Gatherer]:7,[se.Planter]:2,[se.Hunter]:1,[se.Mover]:1,[se.Warrior]:0}:e<xI?{[se.Leader]:0,[se.Gatherer]:5,[se.Planter]:4,[se.Hunter]:2,[se.Mover]:2,[se.Warrior]:1}:e<YI?{[se.Leader]:0,[se.Gatherer]:4,[se.Planter]:3,[se.Hunter]:3,[se.Mover]:3,[se.Warrior]:2}:{[se.Leader]:0,[se.Gatherer]:3,[se.Planter]:3,[se.Hunter]:4,[se.Mover]:3,[se.Warrior]:3}}function JN(e){if(e.length===0)return 0;let t=0,n=0;for(const i of e)t+=i.food.length,n+=i.maxFood;return n===0?0:t/n}function eO(e,t){return e<t?Math.min(e+1,ZN):e>t?Math.max(e-1,qN):e}function tO(e){const t=new ge((n,i)=>{if(!n.leaderId||n.id!==n.leaderId||!n.tribeControl)return E.FAILURE;const s=qn(n,i.gameState);if(s.filter(m=>m.isAdult).length<KN)return E.FAILURE;const l=JN(s),c=QN(l),u=n.tribeControl.roleWeights;let f=!1;const g=[se.Gatherer,se.Planter,se.Hunter,se.Mover,se.Warrior];for(const m of g){const v=u[m]||0,S=c[m],I=eO(v,S);I!==v&&(u[m]=I,f=!0)}if(f){const m=`Adjusted weights for food security: ${(l*100).toFixed(1)}%`;return[E.SUCCESS,m]}return E.FAILURE},"Manage Tribe Role Weights",e+1);return new Yn(t,Ls,"Cache Role Management",e)}const Cr="treeTarget";function nO(e){const t=new ge((i,s,a)=>{const l=Wt(i,s.gameState),c=Fe(i,s.gameState,"tree",YR,u=>{const[f]=u.stateMachine??[];if(!(f===ln||f===Kt||f===An)||i.leaderId&&!Xn(u.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const m=`tribal_chop_${u.id}`,v=T.get(l.aiBlackboard,m);if(v&&s.gameState.time-v.startTime<=Fi&&!v.memberIds.includes(i.id))return!1}return!0});return c?(T.set(a,Cr,c.id),[E.SUCCESS,`Found tree: ${c.id} at ${c.position.x.toFixed(0)},${c.position.y.toFixed(0)}`]):[E.FAILURE,"No tree found"]},"Find Closest Tree",e+4),n=new Hi(new ge((i,s,a)=>{const l=T.get(a,Cr);if(!l)return[E.FAILURE,"No target in blackboard"];const c=s.gameState.entities.entities[l];if(!c)return T.delete(a,Cr),[E.FAILURE,"Tree no longer exists"];const[u]=c.stateMachine??[];return u===ln||u===Kt||u===An?U(i.position,c.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Jl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=c.id,T.delete(a,Cr),[E.SUCCESS,`Chopping tree ${c.id}`]):(i.activeAction="moving",i.target=c.id,i.direction=We(i.position,c.position,s.gameState.mapDimensions),[E.RUNNING,`Moving to tree ${c.id}`]):(T.delete(a,Cr),[E.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop",e+3),{taskType:"chop",maxCapacity:1,getTargetId:(i,s,a)=>T.get(a,Cr)??null},"Tribal Chop Task",e+3);return new Ce([new me((i,s)=>{const a=Wt(i,s.gameState);if(!a)return[!1,"No leader for coordination"];const l=jl(a.id,s.gameState);if(l<=0)return[!1,"No wood need"];const c=RA(a.id,s.gameState);return[l>c,`Wood need: ${l}, Available on ground: ${c}`]},"Need Wood?",e+1),new me(i=>{const s=!i.heldItem;return[(i.isAdult&&s)??!1,`${s?"Can chop":"Holding item"}`]},"Should Chop Tree",e+1),new cn([new Ce([new me((i,s,a)=>T.has(a,Cr),"Has Tree Target?",e+2),n],"Continue Chopping Action",e+2),new Ce([new Yn(t,BR,"Cache Tree Search",e+3),n],"Find New Tree and Chop",e+2)],"Perform or Start Chopping",e+1)],"Chop Tree",e)}const wr="cleanupTreeTarget";function iO(e){const t=new ge((i,s,a)=>{const l=Wt(i,s.gameState),c=Fu(i,s.gameState);if(c.length===0)return[E.FAILURE,"No planting zones found"];const u=s.gameState;let f=null,g=1/0;for(const m of c){const v=Math.sqrt(m.width*m.width+m.height*m.height)/2,S=u.search.tree.byRadius(m.position,v);for(const I of S){const[A]=I.stateMachine??[];if(!(A===ln||A===Kt||A===An)||!Fg(I.position,m,s.gameState))continue;if(l&&l.aiBlackboard){const R=`tribal_cleanup_tree_${I.id}`,_=T.get(l.aiBlackboard,R);if(_&&s.gameState.time-_.startTime<=Fi&&!_.memberIds.includes(i.id))continue}const P=U(i.position,I.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);P<g&&(g=P,f=I)}}return f?(T.set(a,wr,f.id),[E.SUCCESS,`Found nuisance tree: ${f.id} at ${f.position.x.toFixed(0)},${f.position.y.toFixed(0)}`]):[E.FAILURE,"No nuisance trees found in planting zones"]},"Find Nuisance Tree",e+4),n=new Hi(new ge((i,s,a)=>{const l=T.get(a,wr);if(!l)return[E.FAILURE,"No target in blackboard"];const c=s.gameState.entities.entities[l];if(!c)return T.delete(a,wr),[E.FAILURE,"Tree no longer exists"];const[u]=c.stateMachine??[];return u===ln||u===Kt||u===An?U(i.position,c.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Jl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=c.id,T.delete(a,wr),[E.SUCCESS,`Chopping nuisance tree ${c.id}`]):(i.activeAction="moving",i.target=c.id,i.direction=We(i.position,c.position,s.gameState.mapDimensions),[E.RUNNING,`Moving to nuisance tree ${c.id}`]):(T.delete(a,wr),[E.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop (Cleanup)",e+3),{taskType:"cleanup_tree",maxCapacity:1,getTargetId:(i,s,a)=>T.get(a,wr)??null},"Tribal Cleanup Tree Task",e+3);return new Ce([new me((i,s)=>{const a=Vn(i,se.Planter,s.gameState),l=Vn(i,se.Gatherer,s.gameState),c=!i.heldItem;return[!!(i.isAdult&&(a||l)&&c),`${c?"Planter/Gatherer role eligible":"Holding item"}`]},"Should Cleanup Zone?",e+1),new cn([new Ce([new me((i,s,a)=>T.has(a,wr),"Has Cleanup Target?",e+2),n],"Continue Cleanup Action",e+2),new Ce([new Yn(t,FR,"Cache Cleanup Search",e+3),n],"Find New Nuisance Tree and Chop",e+2)],"Perform or Start Cleanup",e+1)],"Cleanup Planting Zones",e)}const dl="bonfireTargetId",oO=800;function rO(e){return new Ce([new me((t,n)=>{const i=er(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<co+8;return[s,`Temp: ${i.toFixed(1)}C`+(s?" (Cold)":"")]},"Is Cold?",e+1),new ge((t,n,i)=>{const s=Wt(t,n.gameState),a=Fe(t,n.gameState,"building",oO,l=>{if(!(l.buildingType===fe.Bonfire&&l.isConstructed&&!l.isBeingDestroyed&&(l.fuelLevel??0)>0)||l.ownerId!==t.leaderId)return!1;if(s&&s.aiBlackboard){const u=`tribal_warmth_${l.id}`,f=T.get(s.aiBlackboard,u);if(f&&n.gameState.time-f.startTime<=Fi&&f.memberIds.length>=xg&&!f.memberIds.includes(t.id))return!1}return!0});return a?(T.set(i,dl,a.id),[E.SUCCESS,`Found bonfire ${a.id}`]):(T.delete(i,dl),[E.FAILURE,"No available fueled bonfires found"])},"Find Bonfire",e+1),new Hi(new ge((t,n,i)=>{const s=T.get(i,dl),a=s&&n.gameState.entities.entities[s];if(!a||(a.fuelLevel??0)<=0||!a.isConstructed)return T.delete(i,dl),E.FAILURE;const l=t.id*137%360*(Math.PI/180),c=kr*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,g={x:(a.position.x+Math.cos(l)*c+u)%u,y:(a.position.y+Math.sin(l)*c+f)%f},m=U(t.position,g,u,f);return m>10?(t.activeAction="moving",t.target=g,t.direction=We(t.position,g,n.gameState.mapDimensions),[E.RUNNING,`Moving to personal warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[E.RUNNING,"Staying warm at personal spot"])},"Move to Warmth Spot",e+2),{taskType:"warmth",maxCapacity:xg,getTargetId:(t,n,i)=>T.get(i,dl)??null},"Tribal Warmth Task",e+1)],"Gather at Bonfire Sequence",e)}function sO(e){const t=new ge((n,i,s)=>{if(!n.leaderId||n.id!==n.leaderId)return[E.FAILURE,"Not a tribe leader"];const a=ca(n.id,i.gameState);let l=0;for(const c of a)if(c.isConstructed&&c.fuelLevel!==void 0){const u=c.maxFuelLevel??Br;c.fuelLevel<u*Rp&&(dT(s,c.id,"wood",i.gameState.time),l++)}return[E.SUCCESS,`Tribe logistics: ${l} wood demands registered for bonfires`]},"Manage Tribe Logistics",e+1);return new Yn(t,v1,"Cached Tribe Logistics",e)}function aO(e){return new Ce([new me((t,n,i)=>{const s=Fe(t,n.gameState,"predator",Sn*2,()=>!0),a=Fe(t,n.gameState,"human",Sn*2,()=>!0);let l=null,c=1/0;if(s){const u=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<c&&(c=u,l=s)}if(a){const u=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<c&&(c=u,l=a)}return l&&c<Sn*1.5?(T.set(i,"fleeThreat",l.id),T.set(i,"fleeDistance",c),!0):!1},"Detect Threat",e+1),new ge((t,n,i)=>{const s=T.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;t.activeAction="moving";const l=Ye(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=ot(l),u=zn(t.position,Tt(c,tM));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,t.fleeCooldown=n.gameState.time+2,E.RUNNING},"Execute Flee",e+1)],"Prey Flee",e)}function lO(e){return new Ce([new me((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=30||t.eatingCooldownTime&&t.eatingCooldownTime>n.gameState.time)return!1;const s=Fe(t,n.gameState,"berryBush",Sn*10,a=>a.food.length>0);return s?U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=Sn?(T.set(i,"grazingTarget",s.id),!0):(T.set(i,"grazingTarget",s.id),T.set(i,"needToMoveToTarget",!0),!0):!1},"Find Berry Bush",e+1),new ge((t,n,i)=>{const s=T.get(i,"grazingTarget"),a=s&&n.gameState.entities.entities[s],l=T.get(i,"needToMoveToTarget");if(!a)return E.FAILURE;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=Sn)return t.activeAction="grazing",t.target=a.id,t.direction={x:0,y:0},T.delete(i,"needToMoveToTarget"),E.RUNNING;if(l||c>Sn){t.activeAction="moving",t.target=a.id;const u=We(t.position,a.position,n.gameState.mapDimensions);return t.direction=u,E.RUNNING}return E.FAILURE},"Move to Bush or Graze",e+1)],"Prey Graze",e)}function cO(e){const t=new me((a,l,c)=>{const u=Fe(a,l.gameState,"prey",Sn,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Ol&&f.age<=ag&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(T.set(c,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new ge((a,l,c)=>{const u=T.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},T.delete(c,"procreationPartner"),E.SUCCESS):E.FAILURE},"Start Procreating",e+2),i=new me((a,l,c)=>{const u=Fe(a,l.gameState,"prey",Sn*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Ol&&f.age<=ag&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(T.set(c,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new ge((a,l,c)=>{const u=T.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return E.FAILURE;if(U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=Sn)return E.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Ye(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),E.RUNNING},"Move Towards Partner",e+2);return new Ce([new me(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=Ol&&a.age<=ag&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new cn([new Ce([t,n],"Procreate With Immediate Partner",e+2),new Ce([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Prey Procreate",e)}const dO=(e,t,n)=>{const i=t.gameState.search.prey.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="prey");if(i.length===0)return E.FAILURE;let s=null,a=$u;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(T.set(n,"targetChild",s.id),E.SUCCESS):E.FAILURE},uO=(e,t,n)=>{const i=T.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>ma?(e.activeAction="moving",e.target=s.id,e.direction=We(e.position,s.position,t.gameState.mapDimensions),E.RUNNING):(e.activeAction="feeding",e.target=void 0,T.set(n,"targetChild",void 0),E.SUCCESS):E.FAILURE};function fO(e){return new Ce([new me(t=>(t.isAdult&&t.gender==="female"&&t.hunger<80&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new ge(dO,"Find Hungriest Prey Child",e+1),new ge(uO,"Move To Child and Feed",e+1)],"Feed Prey Child",e)}function hO(e){return new Ce([new me(t=>!t.isAdult&&t.hunger>=$u,"Is Hungry Prey Child",e+1),new ge((t,n,i)=>{if(!t.motherId)return E.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(T.set(i,"targetParent",s.id),E.SUCCESS):E.FAILURE},"Find Female Parent",e+1),new ge((t,n,i)=>{const s=T.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=ma?(t.target=void 0,E.SUCCESS):(t.target=a.id,t.activeAction="moving",E.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}const Nd="huntTarget";function gO(e,t,n){if(!(e!=null&&e.aiBlackboard))return!0;const i=`tribal_hunt_${t}`,s=T.get(e.aiBlackboard,i);return!s||n-s.startTime>Fi?!0:s.memberIds.length<(s.maxCapacity||xu)}function pO(e,t,n,i){if(!(e!=null&&e.aiBlackboard))return;const s=`tribal_hunt_${n}`;let a=T.get(e.aiBlackboard,s);a||(a={memberIds:[],startTime:i,maxCapacity:xu},T.set(e.aiBlackboard,s,a)),a.memberIds.includes(t.id)||a.memberIds.push(t.id)}function mO(e,t){if(!(e!=null&&e.aiBlackboard))return 0;const n=`tribal_hunt_${t}`,i=T.get(e.aiBlackboard,n);return(i==null?void 0:i.memberIds.length)??0}function Kd(e,t,n=new Set){if(n.has(e.id))return e;n.add(e.id);for(const i of[e.fatherId,e.pregnancyFatherId,e.motherId]){if(!i||i===e.id)continue;const s=t.entities.entities[i];if(s)return Kd(s,t,n)}return e}function yO(e){return new Ce([new me((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=50||t.huntCooldown&&t.huntCooldown>0)return!1;const s=Fe(t,n.gameState,"prey",bs*10,a=>{if(a.hitpoints<=0)return!1;const l=Kd(t,n.gameState);return!(l&&!gO(l,a.id,n.gameState.time))});if(s){const a=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Kd(t,n.gameState),c=l?mO(l,s.id):0;if(a<=bs)return T.set(i,Nd,s.id),[!0,`Prey in range (${c} hunters)`];if(a<=bs*10)return T.set(i,Nd,s.id),T.set(i,"needToApproach",!0),[!0,`Approaching prey (${c} hunters)`]}return!1},"Find Prey Target",e+1),new Mr(new ge((t,n,i)=>{const s=T.get(i,Nd),a=s&&n.gameState.entities.entities[s],l=T.get(i,"needToApproach");if(!a||a.hitpoints<=0)return T.delete(i,Nd),T.delete(i,"needToApproach"),E.SUCCESS;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=bs)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},T.delete(i,"needToApproach"),E.RUNNING;if(l||c>bs){t.activeAction="moving",t.target=a.id;const u=Ye(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),pO(Kd(t,n.gameState),t,a.id,n.gameState.time),E.RUNNING}return E.FAILURE},"Hunt or Approach Prey",e+3),10,"Hunt Timeout (10 hour)",e+2)],"Predator Hunt",e)}function SO(e){return new Ce([new me((t,n,i)=>{const s=t.hunger>100,a=t.hitpoints<t.maxHitpoints*.5;if(!s&&!a||t.attackCooldown&&t.attackCooldown>0)return!1;const l=Fe(t,n.gameState,"human",vi*2,c=>c.hitpoints>0);if(l){const c=U(t.position,l.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=vi)return T.set(i,"attackTarget",l.id),!0;if(s&&c<=vi*2)return T.set(i,"attackTarget",l.id),T.set(i,"needToApproach",!0),!0}return!1},"Find Human Target",e+1),new ge((t,n,i)=>{const s=T.get(i,"attackTarget"),a=s&&n.gameState.entities.entities[s],l=T.get(i,"needToApproach");if(!a||a.hitpoints<=0)return E.FAILURE;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=vi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},T.delete(i,"needToApproach"),E.RUNNING;if(l||c>vi){t.activeAction="moving",t.target=a.id;const u=Ye(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),E.RUNNING}return E.FAILURE},"Attack or Approach Human",e+1)],"Predator Attack Human",e)}function vO(e){const t=new me((a,l,c)=>{const u=Fe(a,l.gameState,"predator",Ko,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=bl&&f.age<=lg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(T.set(c,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new ge((a,l,c)=>{const u=T.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},T.delete(c,"procreationPartner"),E.SUCCESS):E.FAILURE},"Start Procreating",e+2),i=new me((a,l,c)=>{const u=Fe(a,l.gameState,"predator",Ko*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=bl&&f.age<=lg&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(T.set(c,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new ge((a,l,c)=>{const u=T.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return E.FAILURE;if(U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=Ko)return E.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Ye(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),E.RUNNING},"Move Towards Partner",e+2);return new Ce([new me(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=bl&&a.age<=lg&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new cn([new Ce([t,n],"Procreate With Immediate Partner",e+2),new Ce([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Predator Procreate",e)}const IO=(e,t,n)=>{const i=t.gameState.search.predator.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="predator");if(i.length===0)return E.FAILURE;let s=null,a=$u;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(T.set(n,"targetChild",s.id),E.SUCCESS):E.FAILURE},AO=(e,t,n)=>{const i=T.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>ma?(e.activeAction="moving",e.target=s.id,e.direction=We(e.position,s.position,t.gameState.mapDimensions),E.RUNNING):(e.activeAction="feeding",e.target=void 0,T.set(n,"targetChild",void 0),E.SUCCESS):E.FAILURE};function TO(e){return new Ce([new me(t=>(t.isAdult&&t.gender==="female"&&t.hunger<90&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new ge(IO,"Find Hungriest Predator Child",e+1),new ge(AO,"Move To Child and Feed",e+1)],"Feed Predator Child",e)}function EO(e){return new Ce([new me(t=>!t.isAdult&&t.hunger>=$u,"Is Hungry Predator Child",e+1),new ge((t,n,i)=>{if(!t.motherId)return E.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(T.set(i,"targetParent",s.id),E.SUCCESS):E.FAILURE},"Find Female Parent",e+1),new ge((t,n,i)=>{const s=T.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return E.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=ma?(t.target=void 0,E.SUCCESS):(t.target=a.id,t.activeAction="moving",E.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}function mT(e){return new ge((t,n,i)=>{t.activeAction="idle";let s=T.get(i,"wanderTarget"),a=T.get(i,"wanderStartTime");const l=n.gameState.time;if(!s||!a||l-a>2){const c=Math.random()*2*Math.PI,u=50+Math.random()*100,f={x:Math.cos(c),y:Math.sin(c)},g=zn(t.position,Tt(f,u));s={x:(g.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(g.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},T.set(i,"wanderTarget",s),T.set(i,"wanderStartTime",l)}if(s){t.target=s;let c=s.x-t.position.x,u=s.y-t.position.y;const f=n.gameState.mapDimensions.width,g=n.gameState.mapDimensions.height;Math.abs(c)>f/2&&(c=c>0?c-f:c+f),Math.abs(u)>g/2&&(u=u>0?u-g:u+g);const m=ot({x:c,y:u});t.direction=m}return E.SUCCESS},"Animal Wander",e)}function CO(e){return new Ce([new me((t,n,i)=>{if(t.hunger>90||t.hitpoints<t.maxHitpoints*.3||t.activeAction==="grazing"||t.activeAction==="procreating")return!1;const s=Object.values(n.gameState.entities.entities),a=[];for(const l of s)if(l.type==="prey"&&l.id!==t.id){const c=l;c.hitpoints>0&&c.isAdult&&U(t.position,c.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=Sn*5&&a.push(c)}if(a.length>=2){let l=0,c=0;for(const g of a)l+=g.position.x,c+=g.position.y;l/=a.length,c/=a.length;const u={x:l,y:c};if(U(t.position,u,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Sn*2)return T.set(i,"herdCenter",u),T.set(i,"herdSize",a.length),!0}return!1},"Find Herd",e+1),new ge((t,n,i)=>{const s=T.get(i,"herdCenter");if(!s)return E.FAILURE;if(U(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Sn*2){t.activeAction="moving",t.target=s;const l=Ye(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(l),E.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},E.SUCCESS},"Join Herd",e+1)],"Prey Herd Behavior",e)}function wO(e){return new Ce([new me((t,n,i)=>{if(t.hunger>100||t.hitpoints<t.maxHitpoints*.4||t.activeAction==="attacking"||t.activeAction==="procreating")return!1;const s=Fe(t,n.gameState,"predator",Ko*4,a=>a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==void 0&&a.fatherId===t.fatherId&&a.age>=t.age||a.hitpoints>t.hitpoints);return s&&U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ko*2?(T.set(i,"packLeader",s.id),!0):!1},"Find Pack Leader",e+1),new ge((t,n,i)=>{const s=T.get(i,"packLeader"),a=s&&n.gameState.entities.entities[s];if(!a||a.hitpoints<=0)return E.FAILURE;if(U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ko*2){t.activeAction="moving",t.target=a.id;const c=Ye(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(c),E.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},E.SUCCESS},"Follow Pack Leader",e+1)],"Predator Pack Behavior",e)}function _O(e){return new Ce([new me((t,n,i)=>{if(!t.isAdult||t.hitpoints<t.maxHitpoints*.6||t.hunger>120||t.attackCooldown&&t.attackCooldown>0)return!1;const s=Fe(t,n.gameState,"predator",QS,a=>!!(a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==a.fatherId&&t.gender===a.gender&&t.fatherId!==void 0&&a.fatherId!==void 0));if(s){const a=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(a<=vi)return T.set(i,"territorialTarget",s.id),!0;if(a<=QS)return T.set(i,"territorialTarget",s.id),T.set(i,"needToApproach",!0),!0}return!1},"Find Territorial Rival",e+1),new ge((t,n,i)=>{const s=T.get(i,"territorialTarget"),a=s&&n.gameState.entities.entities[s],l=T.get(i,"needToApproach");if(!a||a.hitpoints<=0)return E.FAILURE;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=vi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},T.delete(i,"needToApproach"),E.RUNNING;if(l||c>vi){t.activeAction="moving",t.target=a.id;const u=Ye(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),E.RUNNING}return E.FAILURE},"Territorial Fight or Approach",e+1)],"Predator Territorial Defense",e)}const RO="tribeSplit_strategy",PO="tribeSplit_targetPosition",DO="tribeSplit_targetBuildingId",MO="tribeSplit_familyIds";function NO(e){return new Ce([new me((t,n)=>{const i=fu(t,n.gameState);if(!i.aiBlackboard)return[!1,"Patriarch has no blackboard"];const s=Al(i.aiBlackboard);if(s!=="gathering")return[!1,`Patriarch phase: ${s}`];const a=T.get(i.aiBlackboard,MO);return!a||!a.includes(t.id)?[!1,"Not in split family"]:[!0,"Gathering for split"]},"Should Gather for Split?",e+1),new ge((t,n)=>{const i=fu(t,n.gameState),s=T.get(i.aiBlackboard,RO);let a;if(s==="migration")a=T.get(i.aiBlackboard,PO);else if(s==="concentration"){const c=T.get(i.aiBlackboard,DO);if(c){const u=n.gameState.entities.entities[c];u&&(a=u.position)}}if(!a)return E.FAILURE;const l=U(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=LA?(t.activeAction="idle",t.target=void 0,E.SUCCESS):(t.activeAction="moving",t.target=a,[E.RUNNING,`Distance: ${l.toFixed(2)}`])},"Move to Split Gathering Point",e+1)],"Tribe Split Gather Behavior",e)}function OO(){const e=new cn([yN(2),$N(2),new Mn(XN(2),"attack","Gated Defend Against Predator",2),new Mn(GN(2),"attack","Gated Jealousy Attack",2),new Mn(WN(2),"attack","Gated Desperate Attack",2),YN(2),new Cs(new cn([new Yn(kN(5),Ls,"Cache Take Over Building",4),new Yn(LN(5),Ls,"Cache Remove Enemy Building",4)],"Building Interaction Selector",3),"Gated Leader Building Interactions",2),ON(2),new Mn(TN(3),"attack","Gated Attacking",2),rO(2),dN(2),uN(2),NN(2),new Mn(new Yn(bN(4),QR,"Cache Building Placement",3),"build","Gated Leader Building Placement",2),new Cs(new Yn(FN(4),Ls,"Cache Border Post Placement",3),"Gated Border Post Placement",2),UN(2),NO(2),mN(2),new Mn(AN(3),"procreation","Gated Procreation",2),new Mr(new Mn(iO(4),"chopping","Gated Cleanup Trees",3),Ns,"Timeout Cleanup Trees",2),new Mr(new Mn(DN(4),"planting","Gated Planting",3),Ns,"Timeout Planting",2),new Mn(MN(3),"gathering","Gated Storage Deposit",2),new Mn(wN(3),"feedChildren","Gated Feed Child",2),new Mr(new Mn(SN(4),"gathering","Gated Gathering",3),Ns,"Timeout Gathering",2),new Mr(new Mn(nO(4),"chopping","Gated Chopping",3),Ns,"Timeout Chopping",2),_N(2),new Mn(jN(3),"attack","Gated Hunt Prey",2),new Cs(HN(2),"Gated Follow Patriarch",2),new Mr(new Cs(IN(2),"Gated Idle Wander",3),Ns,"Timeout Idle Wander",2)],"AI Root Selector",1),t=new iv([new aN(new lN(VN(4),"Role Assignment Success",3),"Role Assignment Gate",2),new Mn(new Yn(tO(4),Ls,"Cache Role Management",3),"roleManagement","Gated Role Management",2),new Cs(zN(3),"Gated Diplomacy",2),new Cs(sO(2),"Gated Logistics Management",2)],"Non blocking",1),n=new iv([e,t],"AI Root Sequence",1);return new cN(n,"Manual Control Gate",0)}var ae=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e[e.HumanDiplomacy=25]="HumanDiplomacy",e))(ae||{}),G=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(G||{});const Bt=3,bO=250,yT=.8,kO=100,BO=5,Zg="currentAiTask",ST="lastTaskResult",vT="lastTaskMessage",Qg="taskHistory";function Jg({aiBlackboard:e}){return T.get(e,Zg)||null}function zs({aiBlackboard:e},t){t?T.set(e,Zg,t):T.delete(e,Zg)}function FO(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function LO(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function HO(e,t,n,i){const s=t.type===ae.Wait?UO:i[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=G.Failure;const[l,c,u]=LO(a);if(T.set(e.aiBlackboard,ST,l),T.set(e.aiBlackboard,vT,c),l!==G.Running){const f=T.get(e.aiBlackboard,Qg)||[];if(f.unshift({type:t.type,result:l,completedAtTick:n.gameState.time,message:c}),f.length>5&&f.pop(),T.set(e.aiBlackboard,Qg,f),delete n.gameState.tasks[t.id],zs(e,null),l===G.Success){const g=u||t.nextTask;g&&(n.gameState.tasks[g.id]=g,g.claimedByEntityId=e.id,zs(e,g.id))}}return l}function Qt(e){return 1/(1+e/bO)}function rc(e,t,n){for(let i=0;i<n.length;i++){const s=n[i];if(!s.producer)continue;const a=s.producer(e,t);for(const l in a){const c=a[l],u=t.gameState.tasks[l];t.gameState.tasks[l]=c,u&&(t.gameState.tasks[l].claimedByEntityId=u.claimedByEntityId)}}}const Od=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:ae.Wait,creatorEntityId:e.id,validUntilTime:t+Bt}),UO={type:ae.Wait,executor:(e,t,n)=>n.gameState.time>=e.validUntilTime-1?[G.Success,"Wait complete"]:[G.Running,"Waiting"]};function ht(e){const{type:t,requireAdult:n,autopilotBehavior:i,producer:s,scorer:a,executor:l}=e;return{type:t,producer:s,scorer:a?(f,g,m)=>n&&!f.isAdult||i&&f.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?null:a(f,g,m):void 0,executor:l?(f,g,m)=>n&&!g.isAdult||i&&g.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?G.Failure:m.gameState.autopilotControls.activeAutopilotAction&&f.type!==ae.HumanPlayerCommand&&g.isPlayer?[G.Failure,"Autopilot action active",{id:`player-command-${g.id}`,type:ae.HumanPlayerCommand,position:g.position,creatorEntityId:g.id,validUntilTime:m.gameState.time+Bt}]:l(f,g,m):void 0}}const GO=ht({type:ae.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>sa&&e.food.length>0){const i=`eat-task-${e.id}`;n[i]={id:i,type:ae.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/sn,executor:(e,t)=>e.target!==t.id?G.Empty:t.hunger<sa?G.Success:t.food.length===0?G.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",G.Running)}),$O=ht({type:ae.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="berryBush"||i.food.length===0||e.leaderId&&!Xn(i.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qt(s),l=e.hunger/sn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="berryBush"||i.food.length===0||t.food.length>=t.maxFood?[G.Success,"Bush is empty"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",[G.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[G.Running,"Gathering berries"])}}),WO=ht({type:ae.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="corpse"||i.food.length===0||e.leaderId&&!Xn(i.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qt(s),l=e.hunger/sn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="corpse"||i.food.length===0||t.food.length>=t.maxFood?G.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",G.Running)}}),xO=ht({type:ae.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=Wl&&e.age<=Du&&e.hunger<an&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:ae.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<Wl||e.hunger>=an||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="female"||i.isPregnant||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(s)*yT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="female"||t.hunger>=an?G.Failure:i.isPregnant?G.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",t.direction=We(t.position,i.position,n.gameState.mapDimensions),G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",G.Running)}}),YO=ht({type:ae.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=Wl&&e.hunger<an&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:ae.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<Wl||e.age>Du||e.hunger>=an||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="male"||i.hunger>=an||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(s)*yT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="male"||i.hunger>=an?G.Failure:t.isPregnant?G.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",t.direction=We(t.position,i.position,n.gameState.mapDimensions),G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",G.Running)}}),zO=ht({type:ae.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=ia){const i=`feed-child-task-${e.id}`;n[i]={id:i,type:ae.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.isAdult||!(i.motherId===e.id||i.fatherId===e.id))return null;const a=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Qt(a),c=i.hunger/sn;return(l+c)/2},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.isAdult||t.food.length===0?G.Failure:i.hunger<ia/2?G.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Mu?(t.target=i.position,t.activeAction="moving",t.direction=We(t.position,i.position,n.gameState.mapDimensions),G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="feeding",G.Running)}});function Vp(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const i=U(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(i)}function jO(e,t,n){if(e.leaderId!==t.creatorEntityId||!e.leaderId)return null;const i=t.target;if(!i)return null;const{width:s,height:a}=n.gameState.mapDimensions,l=U(e.position,i,s,a),c=Qt(l)*.5,u=In(e.leaderId,n.gameState),f=U(u,i,s,a),g=Math.max(0,1-f/800)*.25,m=Math.ceil(s/Se),v=Math.ceil(a/Se),S=KI(i);let I=0;for(let w=-1;w<=1;w++)for(let P=-1;P<=1;P++){if(P===0&&w===0)continue;const R=((S.x+P)%m+m)%m,_=((S.y+w)%v+v)%v;n.gameState.terrainOwnership[_*m+R]===e.leaderId&&I++}const A=I/8*.25;return c+g+A}function zu(e,t,n,i,s){const a=e.target;return U(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",G.Running):(Vo(a,i,t.leaderId,n.gameState),G.Success)}const XO=ht({type:ae.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:Vp,executor:(e,t,n)=>zu(e,t,n,fe.StorageSpot,to)}),VO=ht({type:ae.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:Vp,executor:(e,t,n)=>zu(e,t,n,fe.Bonfire,to)}),KO=ht({type:ae.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:Vp,executor:(e,t,n)=>zu(e,t,n,fe.PlantingZone,to)}),qO=ht({type:ae.HumanPlaceBorderPost,scorer:jO,requireAdult:!0,autopilotBehavior:"build",executor:(e,t,n)=>zu(e,t,n,fe.BorderPost,n1)}),ZO=ht({type:ae.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(u=>u.type===Tn.Berry).length<fo)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const l=t.target,c=U(e.position,l,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(c)},executor:(e,t,n)=>{if(t.food.filter(c=>c.type===Tn.Berry).length<fo)return t.activeAction="idle",G.Failure;const s=e.target;return U(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>xr?(t.target=s,t.activeAction="moving",G.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(c=>c.type==="berryBush"&&U(c.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<BO)?(t.activeAction="idle",G.Success):G.Running)}}),QO=ht({type:ae.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var f;if(typeof t.target!="number")return null;const i=e.food.length>0,s=((f=e.heldItem)==null?void 0:f.type)===vt.Wood;if(!i&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==fe.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const l=U(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=Qt(l),u=s?.6:e.food.length/e.maxFood*.4;return(c+u)/2},executor:(e,t,n)=>{var c;if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==fe.StorageSpot)return G.Failure;const s=t.food.length>0,a=((c=t.heldItem)==null?void 0:c.type)===vt.Wood;return!s&&!a?G.Success:i.storedItems.length>=i.storageCapacity?G.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",G.Running)}}),JO=ht({type:ae.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var c;if(typeof t.target!="number"||!(((c=e.heldItem)==null?void 0:c.type)===vt.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==fe.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||lu;if(s.storedItems.length>=a)return null;const l=U(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Qt(l)},executor:(e,t,n)=>{var c;if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==fe.Bonfire)return G.Failure;if(!(((c=t.heldItem)==null?void 0:c.type)===vt.Wood))return G.Success;const a=i.storageCapacity||lu;return i.storedItems.length>=a?G.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",G.Running)}}),eb=ht({type:ae.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=sa||e.food.length>0||typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="building"||i.buildingType!==fe.StorageSpot||i.ownerId!==e.leaderId||!i.storedItems.some(u=>u.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Qt(s),l=e.hunger/sn,c=1-e.food.length/e.maxFood;return(a+l+c)/3},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="building"||i.buildingType!==fe.StorageSpot||!i.storedItems.some(a=>a.item.itemType==="food")?G.Failure:t.food.length>0?G.Success:t.food.length>=t.maxFood?G.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",G.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="retrieving",G.Running)}}),tb=ht({type:ae.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree")return null;const[s]=i.stateMachine??[];if(!(s===ln||s===Kt||s===An)||e.leaderId&&!Xn(i.position,e.leaderId,n.gameState)||e.heldItem||e.food.length===0)return null;const l=Wt(e,n.gameState);if(!l)return null;const c=jl(l.id,n.gameState);if(c<=0)return null;const u=RA(l.id,n.gameState);if(u>=c)return null;const f=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),g=Qt(f),m=Math.min(1,(c-u)/10);return(g+m)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="tree")return[G.Failure,"Tree not found"];const[s]=i.stateMachine??[];if(s===Gt){const c={id:`gather-wood-${t.id}-${n.gameState.time}`,type:ae.HumanGatherWood,position:i.position,creatorEntityId:t.id,target:i.id,validUntilTime:n.gameState.time+1};return[G.Success,"Tree fell!",c]}return s===ln||s===Kt||s===An?t.heldItem?[G.Failure,"Hands full"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Jl?(t.target=i.position,t.activeAction="moving",[G.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="chopping",[G.Running,"Chopping tree"]):[G.Failure,"Tree is not standing"]}}),nb=ht({type:ae.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree"||i.wood.length===0)return null;const[s]=i.stateMachine??[];if(s!==Gt||e.leaderId&&!Xn(i.position,e.leaderId,n.gameState)||e.heldItem)return null;const a=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Qt(a),c=Wt(e,n.gameState),u=c?jl(c.id,n.gameState):0,f=Math.min(1,u/10);return(l+f)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[G.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[G.Success,"Already holding wood"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="tree"||i.wood.length===0||t.heldItem?[G.Failure,"Tree gone, empty, or human full"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",[G.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[G.Running,"Gathering wood"])}}),ib=ht({type:ae.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="prey"||i.hitpoints<=0||e.leaderId&&!Xn(i.position,e.leaderId,n.gameState))return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const c=In(e.leaderId,n.gameState);if(U(e.position,c,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>LI)return null}const a=Qt(s),l=e.hunger/sn;return(a+l)/2*.6},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[G.Success,"Prey is dead"];const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>je?[G.Running,"Chasing prey"]:[G.Running,"Attacking prey"]}}),ob=ht({type:ae.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="predator"||i.hitpoints<=0||e.leaderId&&!Xn(i.position,e.leaderId,n.gameState))return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(Qt(s)+.3)/1.3},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[G.Failure,"Too injured to continue"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[G.Success,"Predator eliminated"];const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>je?[G.Running,"Chasing predator"]:[G.Running,"Fighting predator"]}});function rb(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,G.Failure;const a=U(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),c=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?vn:ho;return a<=c?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,G.Success):(t.activeAction="moving",t.target=s.id,t.direction=We(t.position,s.position,e.mapDimensions),G.Running)}const sb=ht({type:ae.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const i=`player-command-${e.id}`;n[i]={id:i,type:ae.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t)=>t.type===ae.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return[G.Failure,"No active autopilot action"];switch(s.action){case ue.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,G.Failure;const l=s.position;return U(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<$I?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[G.Success,"Reached target position"]):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),[G.Running,"Moving to target"])}case ue.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Target entity not found"];let c=!1;if(l.type==="berryBush")c=l.food.length===0;else if(l.type==="corpse")c=l.food.length===0;else if(l.type==="tree"){const f=l;c=f.stateMachine[0]!==Gt||f.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target type"];return c?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Target is depleted"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>xr?(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[G.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"At target, gathering",Od(t,i.time)])}case ue.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target entity"];const[c]=l.stateMachine??[];return!(c===ln||c===Kt||c===An)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Tree is not standing or human is holding an item"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Jl?(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[G.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"At tree, chopping",Od(t,i.time)])}case ue.AutopilotAttack:return"targetEntityId"in s?rb(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,G.Failure);case ue.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="human"||!nr(t,l,i))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target for procreation"];const c=U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height);return l.isPregnant||t.isPregnant?t.gender==="male"&&l.pregnancyFatherId!==t.id?[G.Failure,"Target is pregnant by another"]:[G.Success,"Procreation conditions met"]:c<=Xs?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,[G.Running,"Procreating"]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[G.Running,"Moving to procreation target"])}case ue.AutopilotPlant:{if(t.activeAction==="planting")return[G.Running,"Planting"];if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No position specified"];const l=s.position;return Kn(l,i,qo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Position is occupied"]):U(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<=Xs?(t.activeAction="planting",t.target=l,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,[G.Running,"Planting"]):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),[G.Running,"Moving to planting target"])}case ue.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target for feeding child"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Xs?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[G.Success,"Feeding child"]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[G.Running,"Moving to feeding target"])}case ue.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.buildingType!==fe.StorageSpot&&l.buildingType!==fe.Bonfire||!l.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"];const c=l.storageCapacity??0;if(l.storedItems.length>=c)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Storage is full"];if(t.leaderId!==l.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Human does not belong to the same tribe as the building"];const f=t.food.length>0,g=!!t.heldItem;if(l.buildingType===fe.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==vt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Bonfires only accept wood"]}else if(!f&&!g)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No items to deposit"];return U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Depositing items",Od(t,i.time)]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[G.Running,"Moving to deposit target"])}case ue.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.buildingType!==fe.StorageSpot||!l.isConstructed||l.storedItems.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"]):t.leaderId!==l.ownerId?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Storage is full"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Retrieving items",Od(t,i.time)]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[G.Running,"Moving to retrieve target"])}case ue.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Only leaders can take over buildings"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=je?(t.activeAction="takingOverBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Taking over building"]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[G.Running,"Moving to takeover target"])}case ue.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Vt(t,l,i)?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Only leaders can remove enemy buildings"]):U(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=je?(t.activeAction="destroyingBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[G.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[G.Running,"Moving to removal target"])}case ue.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,G.Failure;const l=s.position,c=s.buildingType;if(!c)return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"No building type specified"];const u=U(t.position,l,i.mapDimensions.width,i.mapDimensions.height),f=100;return u<=f?aa(l,c,t.leaderId,i,t.position,f)?(Vo(l,c,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[G.Success,"Building placed"]):(i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),[G.Running,"Moving to placement target"])}default:return i.autopilotControls.activeAutopilotAction=void 0,[G.Failure,"Unknown or unhandled action"]}}}),ab=ht({type:ae.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:n}=t,i={},s=jn(e.position.x,e.position.y,n),a=s!==null&&s!==e.leaderId&&Ui(e.leaderId,s,n),l=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(a||l){const c=`attack-human-${e.id}`;i[c]={id:c,type:ae.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:n.time+Bt}}return i},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="human"||i.hitpoints<=0||i.id===e.id||i.leaderId===e.leaderId)return null;const{gameState:s}=n,a=Kr(e,i,s),l=jn(i.position.x,i.position.y,s)===e.leaderId,c=i.activeAction==="attacking"&&i.attackTargetId!==void 0;if(!a&&!c)return null;let u=.5;const f=U(e.position,i.position,s.mapDimensions.width,s.mapDimensions.height),g=Qt(f);return l&&a&&(u+=.1),(g+u)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[G.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[G.Success,"Target eliminated"];const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>je?[G.Running,"Chasing human target"]:[G.Running,"Fighting human target"]}}),lb=ht({type:ae.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,n)=>{if(typeof t.target!="number"||aT(n.gameState.time)>.5)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.buildingType!==fe.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0||e.leaderId!==i.ownerId)return null;const s=er(n.gameState.temperature,e.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=co+5;if(s>=a)return null;const l=(a-s)/15,c=(1-e.hitpoints/e.maxHitpoints)*.8,u=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),f=Qt(u);let g=(l+c+f)/2;return e.hitpoints/e.maxHitpoints<.2&&s<co&&(g=Math.max(g,1.2)),g},executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.buildingType!==fe.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0)return G.Failure;const s=er(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=co+5;if(s>=a)return t.activeAction="idle",[G.Success,"Comfortable temperature reached"];const l=t.id*137%360*(Math.PI/180),c=kr*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,g={x:(i.position.x+Math.cos(l)*c+u)%u,y:(i.position.y+Math.sin(l)*c+f)%f},m=U(t.position,g,u,f);return m>10?(t.activeAction="moving",t.target=g,t.direction=We(t.position,g,n.gameState.mapDimensions),[G.Running,`Moving to warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[G.Running,"Staying warm at bonfire"])}}),cb=ht({type:ae.HumanFlee,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hitpoints<e.maxHitpoints*su){const i=nA(e.id,t.gameState);if(i){const s=`flee-task-${e.id}`;n[s]={id:s,type:ae.HumanFlee,position:e.position,creatorEntityId:e.id,target:i.id,validUntilTime:t.gameState.time+Bt}}}return n},scorer:(e,t,n)=>typeof t.target!="number"||!n.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*su?.9:null,executor:(e,t,n)=>{if(typeof e.target!="number")return G.Failure;const i=n.gameState.entities.entities[e.target];if(!i)return t.activeAction="idle",t.attackTargetId=void 0,G.Success;if(U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Hg)return t.activeAction="idle",t.target=void 0,G.Success;t.activeAction="moving",t.attackTargetId=void 0;const a=Ye(i.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=ot(a),c=zn(t.position,Tt(l,Hg));return t.target={x:(c.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(c.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=l,G.Running}}),db=ht({type:ae.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(!e.leaderId||e.id===e.leaderId)return i;const s=In(e.leaderId,n),a=`stay-near-tribe-${e.id}`;return i[a]={id:a,type:ae.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:n.time+Bt},i},scorer:(e,t,n)=>{if(!e.leaderId||e.id===e.leaderId)return null;const i=In(e.leaderId,n.gameState),s=U(e.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=PS)return null;const a=s-PS;return Math.min(.95,.5+a/1e3*i1)},executor:(e,t,n)=>{if(!t.leaderId)return G.Failure;const i=In(t.leaderId,n.gameState),s=U(t.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<r1?(t.activeAction="idle",t.target=void 0,G.Success):(t.activeAction="moving",t.target=i,t.direction=We(t.position,i,n.gameState.mapDimensions),[G.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),ub=ht({type:ae.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(e.isAdult)return i;const s=jg(e,n);if(!s)return i;const a=`stay-near-parent-${e.id}`;return i[a]={id:a,type:ae.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:n.time+Bt},i},scorer:(e,t,n)=>{if(e.isAdult)return null;const i=jg(e,n.gameState);if(!i||i.id!==t.target||e.leaderId&&_p(e.leaderId,n.gameState)&&jn(i.position.x,i.position.y,n.gameState)!==e.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=DS)return null;const a=s-DS;return Math.min(.98,.6+a/500*o1)},executor:(e,t,n)=>{if(typeof e.target!="number")return t.activeAction="idle",G.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="human")return t.activeAction="idle",t.target=void 0,G.Failure;const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<=s1?(t.activeAction="idle",t.target=void 0,G.Success):(t.activeAction="moving",t.target=i.id,t.direction=We(t.position,i.position,n.gameState.mapDimensions),[G.Running,`Returning to parent (${Math.round(s)}px away)`])}}),fb=ht({type:ae.HumanDiplomacy,requireAdult:!0,scorer:(e,t)=>e.id===e.leaderId&&t.creatorEntityId===e.id?1:null,executor:(e,t,n)=>{var c,u,f,g,m,v;const{gameState:i}=n,s=ci(t.id,i),a=pu(s),l=ec(i).filter(S=>S.leaderId!==t.id);for(const S of l){const I=ci(S.leaderId,i),A=pu(I),w=((u=(c=t.tribeControl)==null?void 0:c.diplomacy)==null?void 0:u[S.leaderId])||ut.Friendly,P=i.entities.entities[S.leaderId];((g=(f=P==null?void 0:P.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[t.id])===ut.Hostile||a>A*GI?w!==ut.Hostile&&((m=t.tribeControl)!=null&&m.diplomacy)&&(t.tribeControl.diplomacy[S.leaderId]=ut.Hostile):w!==ut.Friendly&&((v=t.tribeControl)!=null&&v.diplomacy)&&(t.tribeControl.diplomacy[S.leaderId]=ut.Friendly)}return t.aiBlackboard&&T.set(t.aiBlackboard,"lastDiplomacyCheckTime",i.time),G.Success}}),ju=[GO,$O,WO,xO,YO,zO,XO,VO,KO,qO,ZO,QO,JO,eb,tb,nb,ib,ob,sb,ab,lb,cb,db,ub,fb].reduce((e,t)=>(e[t.type]=t,e),{}),hb=Object.values(ju);function gb(e,t){rc(e,t,hb)}function pb(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const i=Jg(e);if(i){const s=t.gameState.tasks[i];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),zs(e,null)}return}let n=Jg(e);if(n){const i=t.gameState.tasks[n];(!i||i.claimedByEntityId&&i.claimedByEntityId!==e.id)&&(zs(e,null),n=null)}if(!n){const i=mb(e,t);if(i&&t.gameState.tasks[i]){const s=t.gameState.tasks[i];n=i,zs(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const i=t.gameState.tasks[n];i?HO(e,i,t,ju):zs(e,null)}}function mb(e,t){let n=null,i=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=ju[a.type];if(!l||!l.scorer)continue;const c=l.scorer(e,a,t);c!==null&&c>i&&(i=c,n=a.id)}return i>0?n:null}const IT=OO();function yb(e,t){const n=performance.now();switch(e.aiType){case $t.TaskBased:pb(e,t);break;case $t.BehaviorTreeBased:default:jp(e,t,IT);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}function Sb(){return new cn([aO(1),fO(1),hO(1),lO(1),cO(1),CO(1),mT(1)],"Prey Behavior Root",0)}function vb(){return new cn([yO(1),SO(1),TO(1),EO(1),_O(1),vO(1),wO(1),mT(1)],"Predator Behavior Root",0)}const Ib=(e,t)=>{const n={};for(let i=0;i<xu;i++){const s=`hunt-prey-${e.id}-${i}`;n[s]={id:s,type:ae.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},Ab=(e,t)=>{const n={};if(e.hitpoints<=0)return n;const i=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((i==null?void 0:i.type)==="human"))return n;for(let a=0;a<HI;a++){const l=`hunt-predator-${e.id}-${a}`;n[l]={id:l,type:ae.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},Tb={[ae.HumanHuntPrey]:{type:ae.HumanHuntPrey,producer:Ib},[ae.HumanHuntPredator]:{type:ae.HumanHuntPredator,producer:Ab}};function yu(e,t){rc(e,t,Object.values(Tb))}const AT=Sb();function Eb(e,t){switch(e.aiType){case $t.TaskBased:yu(e,t);break;case $t.BehaviorTreeBased:default:jp(e,t,AT);break}}const TT=vb();function Cb(e,t){switch(e.aiType){case $t.TaskBased:yu(e,t);break;case $t.BehaviorTreeBased:default:jp(e,t,TT);break}}const wb=(e,t)=>{if(e.buildingType!==fe.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,i=bp(e);if(MA(e,n)>=i)return{};const a=n.search.tasks.byProperty("creatorEntityId",e.id).find(g=>g.type===ae.HumanPlantBush);if(a)return{[a.id]:a};const l=n.mapDimensions.width,c=n.mapDimensions.height,u=n.soilDepletion,f=10;for(let g=0;g<f;g++){const m=e.position.x+(Math.random()-.5)*e.width,v=e.position.y+(Math.random()-.5)*e.height,S={x:(m%l+l)%l,y:(v%c+c)%c};if(!Li(u,S,l,c)&&!Kn(S,n,qo)){const I=`plant-bush-${e.id}`,A={id:I,type:ae.HumanPlantBush,position:S,creatorEntityId:e.id,target:S,validUntilTime:n.time+kO};return{[I]:A}}}return{}},_b=(e,t)=>{const n={};if(e.buildingType===fe.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const i=`stockpile-${e.id}`;n[i]={id:i,type:ae.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},Rb=(e,t)=>{const n={};if(e.buildingType===fe.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*Rp){const i=`fuel-bonfire-${e.id}`;n[i]={id:i,type:ae.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},Pb=(e,t)=>{const n={};if(e.buildingType===fe.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let i=0;i<xg;i++){const s=`seek-warmth-${e.id}-${i}`;n[s]={id:s,type:ae.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},Db=(e,t)=>{const n={};if(e.buildingType===fe.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(i=>i.item.itemType==="food")){const i=`retrieve-from-${e.id}`;n[i]={id:i,type:ae.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},Mb={[ae.HumanPlantBush]:{type:ae.HumanPlantBush,producer:wb},[ae.HumanStockpile]:{type:ae.HumanStockpile,producer:_b},[ae.HumanFuelBonfire]:{type:ae.HumanFuelBonfire,producer:Rb},[ae.HumanSeekWarmth]:{type:ae.HumanSeekWarmth,producer:Pb},[ae.HumanRetrieve]:{type:ae.HumanRetrieve,producer:Db}};function ET(e,t){rc(e,t,Object.values(Mb))}function Nb(e,t){const{gameState:n,deltaTime:i}=t,s=i*(_t/Nt);if(e.isBeingDestroyed){const a=fw(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){const l=e.buildingType===fe.PlantingZone;Zr(n.entities,e.id),l&&Ll(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=uw(e.buildingType);a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&eA(e.position,oa,e.ownerId,n),e.buildingType===fe.PlantingZone&&Ll(n))}if(e.buildingType===fe.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*m1,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*y1)){const a=e.storedItems.findIndex(l=>l.item.itemType==="item"&&l.item.type===vt.Wood);a!==-1&&(e.storedItems.splice(a,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+rA))}ET(e,t)}function Ob(e,t){const n=t.deltaTime*_t/Nt;if(e.age+=n,!e.stateMachine)return;const[i]=e.stateMachine;i!==Gt&&i!==uo&&i!==jr&&(e.age>=Jo&&!e.woodGenerated&&(e.wood=Array.from({length:Wu},()=>({itemType:"item",type:vt.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=ic*Math.min(1,Math.max(.4,e.age/Jo)))}const bb={type:ae.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const i=`gather-berries-${e.id}`;n[i]={id:i,type:ae.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},kb={type:ae.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===ln||i===Kt||i===An){const a=`chop-tree-${e.id}`;n[a]={id:a,type:ae.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},Bb={type:ae.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===Gt&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:ae.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},Fb=[bb,kb,Bb].reduce((e,t)=>(e[t.type]=t,e),{});function hv(e,t){rc(e,t,Object.values(Fb))}const Lb={type:ae.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const i=`gather-meat-${e.id}`;n[i]={id:i,type:ae.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},Hb=[Lb].reduce((e,t)=>(e[t.type]=t,e),{});function Ub(e,t){rc(e,t,Object.values(Hb))}var qd=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(qd||{});function pg(e,t,n){switch(n){case 0:Gb(e,t);break;case 1:$b(e,t);break;case 2:Wb(e,t);break}}function Gb(e,t){e.forces.push(Tt(e.velocity,-.1));const n=Tt(ot(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(i=>{t.gameState.time-i.startTime<i.duration&&i.type==="slow"&&(e.velocity=Tt(e.velocity,.5))}),e.debuffs=e.debuffs.filter(i=>t.gameState.time-i.startTime<i.duration),e.velocity=zn(e.velocity,e.forces.reduce(zn,{x:0,y:0})),Wr(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=zn(e.position,Tt(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&Wr(e.velocity)>.1&&YP(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?qM(e,t,t.deltaTime):e.type==="corpse"?ZM(e,t):e.type==="prey"?QM(e,t,t.deltaTime):e.type==="predator"?JM(e,t,t.deltaTime):e.type==="building"?Nb(e,t):e.type==="tree"?Ob(e,t):e.type,e.stateMachine&&(e.stateMachine=XM(...e.stateMachine,{entity:e,updateContext:t}))}function $b(e,t){CT(e,t)&&(e.type==="human"?gb(e,t):e.type==="corpse"?Ub(e,t):e.type==="prey"||e.type==="predator"?yu(e,t):e.type==="building"?ET(e,t):(e.type==="tree"||e.type==="berryBush")&&hv(e,t))}function Wb(e,t){CT(e,t)&&(T.cleanupOldEntries(e.aiBlackboard,t.gameState.time),e.type==="human"?yb(e,t):e.type==="corpse"||(e.type==="prey"?Eb(e,t):e.type==="predator"?Cb(e,t):e.type==="building"||e.type==="tree"||e.type),T.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function CT(e,t){const n=T.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-n+(Math.random()-Math.random())*ra/10>ra}function xb(e){const t=e.gameState.entities.entities;for(const n in t)pg(t[n],e,qd.Physics);for(const n in t)pg(t[n],e,qd.PrepareAI);sw(e.gameState);for(const n in t)pg(t[n],e,qd.ExecuteAI)}function wT(){return{entities:{},nextEntityId:1}}function qr(e,t,n){const i={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:T.create(),...n};return e.entities[i.id]=i,i}function sc(e,t,n){return qr(e,"berryBush",{position:t,radius:Bg,food:Array.from({length:R_},()=>({itemType:"food",type:Tn.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:__,lifespan:D_,age:0,spreadRadius:Bg,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:T.create(),stateMachine:[_l,{enteredAt:n,previousState:void 0}]})}function ql(e,t,n,i=0){const s=i>=Jo;return qr(e,"tree",{position:t,radius:ic,age:i,lifespan:PM,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:LM,stateMachine:[ln,{enteredAt:n,previousState:void 0}],aiBlackboard:T.create(),wood:s?Array.from({length:Wu},()=>({itemType:"item",type:vt.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function js(e,t,n,i,s=!1,a=j_,l=BI,c,u,f=[],g,m,v=$t.TaskBased){const S=a>=yp;return qr(e,"human",{position:t,radius:S?Rt:ha,hunger:l,hitpoints:TS,maxHitpoints:TS,age:a,gender:i,isPlayer:s,food:[],maxFood:kI,maxAge:$l,isAdult:S,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:c,fatherId:u,ancestorIds:f,stateMachine:[St,{enteredAt:n,previousState:void 0}],leaderId:g,tribeInfo:m,aiType:v,aiBlackboard:T.create()})}function Kp(e,t,n,i,s,a,l,c,u,f,g){let m,v;switch(l){case"human":m=FI,v=an;break;case"prey":m=2,v=120;break;case"predator":m=4,v=140;break}return qr(e,"corpse",{position:t,radius:s,gender:n,age:i,originalEntityId:a,originalEntityType:l,timeOfDeath:c,decayProgress:0,geneCode:g,food:[...Array.from({length:Math.max(m*Math.max(v-f,0)/v,0)},()=>({itemType:"food",type:Tn.Meat})),...u].map(I=>({...I,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:T.create()})}function Yb(e,t,n,i,s,a,l,c,u){return Kp(e,t,n,i,s,a,"human",l,c,u)}function zb(e,t,n,i,s,a,l,c){return Kp(e,t,n,i,s,a,"prey",l,[],0,c)}function jb(e,t,n,i,s,a,l,c){return Kp(e,t,n,i,s,a,"predator",l,[],0,c)}function Xb(e,t,n){const i=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=i?[...i.ancestorIds||[],i.id]:[],l=[...s,...a],c=[...new Set(l)],u=c.slice(Math.max(c.length-bI,0)),f=Math.random()<.5?"male":"female",g=zn(e.position,{x:5,y:5}),m=js(n.gameState.entities,g,n.gameState.time,f,!1,0,BI/2,e.id,t,u,(i==null?void 0:i.leaderId)??e.leaderId,(i==null?void 0:i.tribeInfo)??e.tribeInfo,e.aiType);return Oe(n,Pe.Birth,e.position),m}function Zr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function da(e,t,n,i=eM,s=ZA,a,l,c,u=$t.BehaviorTreeBased){const f=i>=Ol,g=Date.now();return qr(e,"prey",{position:t,radius:f?Rt*.7:ha*.7,hunger:s,hitpoints:qS,maxHitpoints:qS,age:i,maxAge:qA,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:c,stateMachine:[Si,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:T.create()})}function ua(e,t,n,i=lM,s=JA,a,l,c,u=$t.BehaviorTreeBased){const f=i>=bl,g=Date.now();return qr(e,"predator",{position:t,radius:f?Rt*.9:ha*.9,hunger:s,hitpoints:ZS,maxHitpoints:ZS,age:i,maxAge:QA,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:c,stateMachine:[mn,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:T.create()})}function Vb(e,t,n,i){const s=sp(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:i,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:RD,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===fe.Bonfire?Br:void 0,maxFuelLevel:n===fe.Bonfire?Br:void 0,aiBlackboard:T.create(),stateMachine:["",{enteredAt:0}]};return qr(e,"building",a)}var gn=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(gn||{}),$r=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))($r||{}),pn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(pn||{});const ep={},tp={},Kb=[{key:gn.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:gn.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>x_,isCompleted:!1,minDisplayTime:US,highlightedUIElements:[$r.HUNGER_BAR]},{key:gn.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!Fe(t,e,"berryBush",je*5,i=>i.food.length>0),getTargets:(e,t)=>{const n=[];for(const i of Object.values(e.entities.entities))i.type==="berryBush"&&i.food.length>0&&U(t.position,i.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(i);return n.map(i=>i.id)},isCompleted:!1,minDisplayTime:US},{key:gn.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=Fe(t,e,"berryBush",je,i=>i.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:gn.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[$r.FOOD_BAR]},{key:gn.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>On(e,t).length>0,getTargets:(e,t)=>{const n=Fe(t,e,"human",je,i=>nr(t,i,e));return n?[n.id]:[]},isCompleted:!1},{key:gn.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>$p(e,t).some(i=>i.type===ue.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:gn.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[$r.COMMAND_BUTTONS],isCompleted:!1},{key:gn.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:gn.AUTOPILOT},{key:gn.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=Fe(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=Fe(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:gn.ANIMALS_INTRODUCTION},{key:gn.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!Fe(t,e,"predator",120),getTargets:(e,t)=>{const n=Fe(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:gn.HUNT_PREY}].map(e=>({...e,condition:e.condition?Qb(e.condition):void 0,getTargets:e.getTargets?Jb(e.getTargets):void 0}));function _T(){return{steps:Kb.map(e=>({...e,isCompleted:!1}))}}function RT(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:pn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function qb(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function Zb(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const i=At(e);if(!i){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/cP;switch(n.transitionState){case pn.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=pn.ACTIVE);break;case pn.ACTIVE:{const u=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),f=ep[s.condition];f&&u&&f(e,i)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=pn.FADING_OUT);break}case pn.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const c=qb(e);c!==null?(n.currentStepIndex=c,n.transitionState=pn.FADING_IN):(n.isActive=!1,n.transitionState=pn.INACTIVE)}break}if(n.transitionState!==pn.FADING_OUT&&n.transitionState!==pn.INACTIVE){const c=tp[s.getTargets||""];c?n.highlightedEntityIds=[...c(e,i)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function Qb(e){const t=`condition_${Object.keys(ep).length+1}`;return ep[t]=e,t}function Jb(e){const t=`getTargets_${Object.keys(tp).length+1}`;return tp[t]=e,t}function ek(){const e=wT(),t=0;for(let v=0;v<CI;v++){const S={x:Math.random()*Ze,y:Math.random()*Qe};sc(e,S,t)}for(let v=0;v<EI;v++){const S={x:Math.random()*Ze,y:Math.random()*Qe};ql(e,S,t)}const n=Ze/2,i=Qe/2;for(let v=0;v<5;v++){const S=v/5*Math.PI*2,I=100+Math.random()*100,A={x:n+Math.cos(S)*I,y:i+Math.sin(S)*I};ql(e,A,t,Jo)}const s=js(e,{x:n-25,y:i},t,"male",!0),a=js(e,{x:n+25,y:i},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:yn[0]},s.aiType=$t.TaskBased,a.aiType=$t.TaskBased;for(let v=0;v<5;v++){const S=v/5*Math.PI*2,I=Ze/2,A=Qe/2,w={x:n+Math.cos(S)*I,y:i+Math.sin(S)*A},P=js(e,{x:w.x,y:w.y},t,"male",!1);P.leaderId=P.id,P.tribeInfo={tribeBadge:cu[v%cu.length],tribeColor:yn[v%yn.length]};const R=js(e,{x:w.x+50,y:w.y},t,"female",!1);R.leaderId=P.id,R.tribeInfo=P.tribeInfo}for(let v=0;v<nT;v++){const S={x:n+Ze*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};da(e,S,"male",void 0,void 0,Vl()),da(e,{x:S.x+20,y:S.y},"female",void 0,void 0,Vl())}const l={x:n+Ze*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};ua(e,l,"male",void 0,void 0,Kl()),ua(e,{x:l.x+20,y:l.y},"female",void 0,void 0,Kl());const c=[{id:"muteButton",action:le.ToggleMute,currentWidth:oo,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:ft},{id:"pauseButton",action:le.TogglePause,currentWidth:oo,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:ft},{id:"returnToIntroButton",action:le.ReturnToIntro,currentWidth:oo,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:ft}],u=_T(),f=RT(),g={time:t,entities:e,mapDimensions:{width:Ze,height:Qe},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:UA,isMuted:!1,uiButtons:c,tutorial:u,tutorialState:f,debugPanel:Xe.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:Yr.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:Fr,preyProcreationCooldown:Lr,predatorGestationPeriod:Hr,predatorProcreationCooldown:Ur,preyHungerIncreasePerHour:Yo,predatorHungerIncreasePerHour:zo,berryBushSpreadChance:lo},soilDepletion:RI(),temperature:cT(Ze,Qe),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ze/Se)*Math.ceil(Qe/Se)).fill(null),tasks:{}},m=Iu(g);return console.log("Game world initialized:",m),m}function tk(){const e=wT(),t=0;for(let u=0;u<CI;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};sc(e,f,t)}for(let u=0;u<EI;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};ql(e,f,t)}const n=Ze/2,i=Qe/2;for(let u=0;u<5;u++){const f=u/5*Math.PI*2,g=100+Math.random()*100,m={x:n+Math.cos(f)*g,y:i+Math.sin(f)*g};ql(e,m,t,Jo)}for(let u=0;u<E_;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe},g=Math.random()<.5?"male":"female";js(e,f,t,g,!1)}for(let u=0;u<nT;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};da(e,f,"male",void 0,void 0,Vl()),da(e,{x:f.x+20,y:f.y},"female",void 0,void 0,Vl())}const s={x:Math.random()*Ze,y:Math.random()*Qe};ua(e,s,"male",void 0,void 0,Kl()),ua(e,{x:s.x+20,y:s.y},"female",void 0,void 0,Kl());const a=_T(),l=RT(),c={time:t,entities:e,mapDimensions:{width:Ze,height:Qe},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Ze/2,y:Qe/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:UA,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:l,debugPanel:Xe.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:Fr,preyProcreationCooldown:Lr,predatorGestationPeriod:Hr,predatorProcreationCooldown:Ur,preyHungerIncreasePerHour:Yo,predatorHungerIncreasePerHour:zo,berryBushSpreadChance:lo},soilDepletion:RI(),temperature:cT(Ze,Qe),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ze/Se)*Math.ceil(Qe/Se)).fill(null),tasks:{}};return Iu(c)}const nk="humanProcreation",ik="human",ok="human",rk=je,sk=(e,t,n)=>nr(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,ak=(e,t,n)=>{const{gameState:i}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,l=e.gender==="female"?e:t,c=(a.partnerIds||[]).length===0;if(e.stateMachine[0]!==Or&&(e.stateMachine=[Or,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:n.gameState.time+1}]),t.stateMachine[0]!==Or&&(t.stateMachine=[Or,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),c&&a.leaderId&&a.leaderId!==a.id){const u=i.entities.entities[a.leaderId];if(u){const f=zg(a,u),g=zg(l,u);if(!f&&!g){const m=uu();a.leaderId=a.id,a.tribeInfo={tribeBadge:m,tribeColor:yn[Math.floor(Math.random()*yn.length)]},a.tribeRole=se.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&l){const u=uu();a.leaderId=a.id,a.tribeInfo={tribeBadge:u,tribeColor:yn[Math.floor(Math.random()*yn.length)]},a.tribeRole=se.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}e.activeAction=void 0,$e(i,_e.Procreation,s,Yl),$e(i,_e.Partnered,e.position,Ke,e.id),$e(i,_e.Partnered,t.position,Ke,t.id),e.lastPartneredEffectTime=i.time,t.lastPartneredEffectTime=i.time,t.activeAction=void 0,Oe(n,Pe.Procreate,s)},lk={id:nk,sourceType:ik,targetType:ok,maxDistance:rk,checker:sk,perform:ak},ck={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:Mu,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Zo&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-Zo),e.feedChildCooldownTime=J_,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&($e(n.gameState,_e.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Oe(n,Pe.ChildFed,t.position)}},dk={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:vn,checker:(e,t,n)=>{var g,m;if(e.stateMachine[0]!==Qo||e.attackTargetId!==t.id)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=ho,a=!s&&i<=vn;if(!s&&!a||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const c=s?Nu:Ap,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>ho,l=Ye(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),c=iw(ot(l),t.direction);if(Math.abs(c)<fR*Math.PI/180&&Math.random()<hR)$e(i,_e.AttackDeflected,t.position,Ke,t.id);else{let g=a?Ip:vp;if(e.gender==="male"&&(g*=cR),e.isAdult||(g*=dR),(!t.isAdult||t.age>=Sp)&&e.isAdult&&(g*=uR),a){const v=s/Tp;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+v,data:{attackerId:e.id,targetId:t.id,damage:g,pushbackForce:Cp,attackerPosition:{...e.position}}}),$e(i,_e.StoneProjectile,e.position,v,void 0,t.position,t.id),Oe(n,Pe.Attack,e.position)}else{t.hitpoints-=g,t.movementSlowdown={modifier:bu,endTime:i.time+ku},$e(i,_e.Hit,t.position,Ke,t.id);const v=Ye(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),S=Tt(v,rR);t.forces.push(S),t.hitpoints<=0?Oe(n,Pe.HumanDeath,t.position):Oe(n,Pe.Attack,e.position),$e(i,_e.Attack,e.position,Ke,e.id)}}e.attackCooldown={melee:Ou,ranged:Ep};const f=e.stateMachine[1];f.attackStartTime=i.time}},uk={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:Rt*2,checker:(e,t,{gameState:n})=>U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const i=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(i===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const a=(e.radius+t.radius-i)*.05,l=ot(nw(e.position,t.position)),c=Tt(l,a);e.forces.push(c),t.forces.push(Tt(c,-1))}},fk={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:Rt*.6+ic*.4,checker:(e,t,{gameState:n})=>{const i=t.stateMachine[0];if(i==="fallen"||i==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const c=l*2.5,u=ot(Ye(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=Tt(u,c);e.forces.push(f)}},hk={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:Rt*.6+ic*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const c=l*2.5,u=ot(Ye(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=Tt(u,c);e.forces.push(f)}},gk={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:Rt*.6+ic*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const c=l*2.5,u=ot(Ye(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=Tt(u,c);e.forces.push(f)}},pk={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:je,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===pa&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,$e(n.gameState,_e.BushClaimed,t.position,Ke),Oe(n,Pe.Gather,e.position)}},mk={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:je,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===pa&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,Oe(n,Pe.Gather,e.position)}},yk={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:je,checker:(e,t,n)=>e.isAdult&&t.stateMachine[0]===Gt&&t.wood.length>0&&e.stateMachine[0]===pa&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.wood.pop();i&&(e.heldItem=i),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[uo,{enteredAt:n.gameState.time,previousState:Gt}]),Oe(n,Pe.Gather,e.position)}},Sk=[pk,mk,yk],vk={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:Sn,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=iM,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+nM,$e(n.gameState,_e.BushClaimed,t.position,Ke,e.id),Oe(n,Pe.Gather,e.position))}},Ik={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:bs,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=cM;const i=Ye(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=Tt(i,8);t.forces.push(s),e.huntCooldown=fM,t.hitpoints<=0?(Oe(n,Pe.HumanDeath,t.position),$e(n.gameState,_e.Hit,t.position,Ke,t.id)):($e(n.gameState,_e.Hit,t.position,Ke,t.id),t.fleeCooldown=5,Oe(n,Pe.Attack,e.position)),$e(n.gameState,_e.Attack,e.position,Ke,e.id)}},Ak={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:vn,checker:(e,t,n)=>{var g,m;if(e.stateMachine[0]!==Qo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=ho,a=!s&&i<=vn;if(!s&&!a||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const c=s?Nu:Ap,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>ho;let l=(a?Ip:vp)*1.2;if(e.gender==="male"&&(l*=1.3),a){const u=s/Tp;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+u,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Cp,attackerPosition:{...e.position}}}),$e(i,_e.StoneProjectile,e.position,u,void 0,t.position,t.id),Oe(n,Pe.Attack,e.position)}else{t.hitpoints-=l;const u=Ye(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),f=Tt(u,6);t.forces.push(f),t.hitpoints<=0?(Oe(n,Pe.HumanDeath,t.position),$e(i,_e.Hit,t.position,Ke,t.id)):($e(i,_e.Hit,t.position,Ke,t.id),t.fleeCooldown=8,Oe(n,Pe.Attack,e.position)),$e(i,_e.Attack,e.position,Ke,e.id)}e.attackCooldown={melee:Ou,ranged:Ep};const c=e.stateMachine[1];c.attackStartTime=i.time}},Tk={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:vi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=eT;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:bu,endTime:n.gameState.time+ku};const s=Ye(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Tt(s,7);t.forces.push(a),e.attackCooldown=tT,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-xp),Oe(n,Pe.HumanDeath,t.position),$e(n.gameState,_e.Hit,t.position,Ke,t.id)):($e(n.gameState,_e.Hit,t.position,Ke,t.id),Oe(n,Pe.Attack,e.position)),$e(n.gameState,_e.Attack,e.position,Ke,e.id)}},Ek={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:vn,checker:(e,t,n)=>{var g,m;if(e.stateMachine[0]!==Qo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=ho,a=!s&&i<=vn;if(!s&&!a||(s?((g=e.attackCooldown)==null?void 0:g.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const c=s?Nu:Ap,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>ho;let l=(a?Ip:vp)*.8;e.gender==="male"&&(l*=1.2);const c=Object.values(i.entities.entities).filter(f=>f.type==="human"&&f.id!==e.id).filter(f=>{const g=f;return Math.sqrt(Math.pow(g.position.x-e.position.x,2)+Math.pow(g.position.y-e.position.y,2))<100&&g.activeAction==="attacking"&&g.attackTargetId===t.id}).length;if(c>0&&(l*=1+c*.2),a){const f=s/Tp;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+f,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Cp,attackerPosition:{...e.position}}}),$e(i,_e.StoneProjectile,e.position,f,void 0,t.position,t.id),Oe(n,Pe.Attack,e.position)}else{t.hitpoints-=l;const f=Ye(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),g=Tt(f,8);t.forces.push(g),t.hitpoints<=0?(Oe(n,Pe.HumanDeath,t.position),$e(i,_e.Hit,t.position,Ke,t.id)):($e(i,_e.Hit,t.position,Ke,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),Oe(n,Pe.Attack,e.position)),$e(i,_e.Attack,e.position,Ke,e.id)}e.attackCooldown={melee:Ou,ranged:Ep};const u=e.stateMachine[1];u.attackStartTime=i.time}},Ck={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:Sn,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,$e(n.gameState,_e.Procreation,i.position,Ke,i.id),Oe(n,Pe.Procreate,i.position)}},wk={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:Ko,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.pregnancyFatherId=e.gender==="male"?e.id:t.id,i.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,$e(n.gameState,_e.Procreation,i.position,Ke,i.id),Oe(n,Pe.Procreate,i.position)}},_k={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:ma,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=mu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-mu),e.feedChildCooldownTime=iT,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&($e(n.gameState,_e.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Oe(n,Pe.ChildFed,t.position)}},Rk={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:ma,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=mu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-mu),e.feedChildCooldownTime=iT,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&($e(n.gameState,_e.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Oe(n,Pe.ChildFed,t.position)}},Pk={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:Ko,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-xp),e.eatingCooldownTime=n.gameState.time+2,$e(n.gameState,_e.Eating,e.position,Ke,e.id),Oe(n,Pe.Gather,e.position))}},Dk={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:vi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=eT;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:bu,endTime:n.gameState.time+ku};const s=Ye(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Tt(s,7);t.forces.push(a),e.attackCooldown=tT,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-xp),Oe(n,Pe.HumanDeath,t.position),$e(n.gameState,_e.Hit,t.position,Ke,t.id)):($e(n.gameState,_e.Hit,t.position,Ke,t.id),Oe(n,Pe.Attack,e.position)),$e(n.gameState,_e.Attack,e.position,Ke,e.id)}},Mk={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>{var f;const i=t.buildingType===fe.StorageSpot,s=t.buildingType===fe.Bonfire;if(!i&&!s||e.stateMachine[0]!==Ml||!t.isConstructed)return!1;const a=e.food.length>0,l=((f=e.heldItem)==null?void 0:f.type)===vt.Wood;if(s&&!l||!a&&!l)return!1;const c=t.storageCapacity??0;return!(t.storedItems.length>=c||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<PD)},perform:(e,t,n)=>{var s;let i=null;if(t.buildingType===fe.Bonfire?((s=e.heldItem)==null?void 0:s.type)===vt.Wood&&(i=e.heldItem,e.heldItem=void 0):e.heldItem?(i=e.heldItem,e.heldItem=void 0):i=e.food.pop()??null,i&&(t.storedItems.push({item:i,positionOffset:gT(t)}),t.buildingType===fe.Bonfire)){const a=Wt(e,n.gameState);a&&a.aiBlackboard&&uT(a.aiBlackboard,t.id,"wood")}t.lastDepositTime=n.gameState.time,Oe(n,Pe.StorageDeposit,t.position)}},Nk={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Nl||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<DD),perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&(e.food.push(i.item),gT(t)),t.lastRetrieveTime=n.gameState.time,Oe(n,Pe.StorageRetrieve,t.position)}},Ok={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>{var c;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==pa||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const i=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!i||!((c=i.tribeControl)!=null&&c.diplomacy)||(t.ownerId?i.tribeControl.diplomacy[t.ownerId]:void 0)!==ut.Hostile||n.gameState.time-(t.lastStealTime??0)<MD)return!1;const l=qn({leaderId:t.ownerId},n.gameState);for(const u of l)if(U(e.position,u.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=ND)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&e.food.push(i.item),t.lastStealTime=n.gameState.time,Oe(n,Pe.StorageSteal,t.position),$e(n.gameState,_e.Attack,t.position,.5)}},bk={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!Vt(e,t,n.gameState)||!ZI(t.position,oa,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,tA(t.position,oa,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",$e(n.gameState,_e.BushClaimed,t.position,2,t.id)}},kk={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!Vt(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",$e(n.gameState,_e.Hit,t.position,1,t.id)}},Bk={id:"supplyTransfer",sourceType:"human",targetType:"human",maxDistance:je,checker:(e,t)=>!(e.activeAction!=="depositing"||t.activeAction!=="retrieving"||e.leaderId!==t.leaderId||e.food.length===0||t.food.length>=t.maxFood),perform:(e,t,n)=>{var l;const i=Math.min(((l=e.activeActionPayload)==null?void 0:l.amount)||1,e.food.length,t.maxFood-t.food.length),s=e.food.splice(0,i);t.food.push(...s);const a=Wt(t,n.gameState);a&&a.aiBlackboard&&uT(a.aiBlackboard,t.id,"food"),e.activeAction="idle",e.target=void 0,e.activeActionPayload=void 0,t.activeAction="idle",t.target=void 0,Oe(n,Pe.StorageDeposit,t.position)}},Fk={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:Pu,checker:(e,t,n)=>{const[i]=t.stateMachine??[],s=i===ln||i===Kt||i===An;return e.isAdult&&s&&e.stateMachine[0]===Wp&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const{gameState:i}=n;if(t.stateMachine=[Gt,{enteredAt:i.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/Jo),a=Math.floor(JS+s*(Wu-JS));t.wood=Array.from({length:a},()=>({itemType:"item",type:vt.Wood,id:i.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=i.time+1,Oe(n,Pe.Gather,e.position)}},Lk=[uk,fk,hk,gk,...Sk,lk,ck,dk,Mk,Nk,Ok,bk,kk,Bk,Fk,vk,_k,Rk,Pk,Ik,Ak,Ek,Tk,Dk,Ck,wk],gv=Object.values(Lk.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const i={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[n].interactions.push(i),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));let pv=0;function Hk(e){const{gameState:t}=e,n=t,{width:i,height:s}=t.mapDimensions;pv++;const a=pv%2===0;for(let l=0;l<gv.length;l++){const c=gv[l],u=n.search[c.sourceType].all();for(let f=0;f<u.length;f++){const g=u[f],m=n.search[c.targetType].byRadius(g.position,c.maxDistance);for(let v=0;v<m.length;v++){const S=m[v];if(g.id===S.id)continue;const I=Nn(g.position,S.position,i,s);for(let A=0;A<c.interactions.length;A++){const w=c.interactions[A];!w.isCollision&&a||I<=w.maxDistanceSq&&w.checker(g,S,e)&&w.perform(g,S,e)}}}}}function PT(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function Uk(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),i=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=50+Math.random()*100;a={x:Math.max(50,Math.min(Ze-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*g))}}else a={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let l=!0;const c=100;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){l=!1;break}if(l){for(const u of i)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){l=!1;break}}if(l)return a}return{x:Ze*.3+Math.random()*Ze*.4,y:Qe*.3+Math.random()*Qe*.4}}function Gk(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=100+Math.random()*150;a={x:Math.max(50,Math.min(Ze-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*g))}}else a={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let l=!0;const c=150;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){l=!1;break}if(l)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Ze,y:50+Math.random()*100};case 1:return{x:Ze-150+Math.random()*100,y:Math.random()*Qe};case 2:return{x:Math.random()*Ze,y:Qe-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Qe}}}function $k(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let i=0;i<20;i++){const s={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let a=!0;const l=80,c=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<l){a=!1;break}if(a){for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){a=!1;break}}if(a)return s}return{x:Math.random()*Ze,y:Math.random()*Qe}}function DT(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=Uk(n),a=i%2===0?"male":"female";da(e.entities,s,a,void 0,void 0,Vl())}}function MT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=Gk(n),a=i%2===0?"male":"female";ua(e.entities,s,a,void 0,void 0,Kl())}}function Wk(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count();let s=!1;return n===0&&(DT(e,6),s=!0),i===0&&(MT(e,3),s=!0),s}function xk(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const l=Math.max(2,Math.floor(8-n));DT(e,l),a=!0}if(i>0&&i<2){const l=Math.max(1,Math.floor(3-i));MT(e,l),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let l=0;l<5;l++){const c=$k(t);sc(e.entities,c,e.time)}a=!0}return a}const Yk=1,zk=.3,jk=.8,mv=.8,Xk=.99,Vk=.05;var NT=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.NO_ACTION=14]="NO_ACTION",e))(NT||{});const mg=Object.keys(NT).length/2;class Kk{constructor(){Ne(this,"qTable",new Map);Ne(this,"epsilon",mv);Ne(this,"lastState",null);Ne(this,"lastAction",null)}discretizeState(t,n,i){const s=Math.min(4,Math.floor(t/25)),a=Math.min(4,Math.floor(n/5)),l=Math.min(4,Math.floor(i/15));return`${s}-${a}-${l}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,i){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,i)}getBestAction(t){let n=0,i=this.getQValue(t,0);for(let s=1;s<mg;s++){const a=this.getQValue(t,s);a>i&&(i=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*mg):this.getBestAction(t)}applyEmergencyCorrections(t,n,i,s){t<ro*.5&&(s.ecosystem.preyGestationPeriod=Math.max(Us,s.ecosystem.preyGestationPeriod*.8),s.ecosystem.preyProcreationCooldown=Math.max(Gs,s.ecosystem.preyProcreationCooldown*.8),s.ecosystem.preyHungerIncreasePerHour=Math.max(xs,s.ecosystem.preyHungerIncreasePerHour*.9)),n<so*.6&&(s.ecosystem.predatorGestationPeriod=Math.max($s,s.ecosystem.predatorGestationPeriod*.75),s.ecosystem.predatorProcreationCooldown=Math.max(Ws,s.ecosystem.predatorProcreationCooldown*.75),s.ecosystem.predatorHungerIncreasePerHour=Math.max(Ys,s.ecosystem.predatorHungerIncreasePerHour*.85)),i<ao*.5&&(s.ecosystem.berryBushSpreadChance=Math.min(vl,s.ecosystem.berryBushSpreadChance*1.2)),t>ro*1.4&&(s.ecosystem.preyHungerIncreasePerHour=Math.min(Yo,s.ecosystem.preyHungerIncreasePerHour*1.05)),n>so*1.4&&(s.ecosystem.predatorHungerIncreasePerHour=Math.min(zo,s.ecosystem.predatorHungerIncreasePerHour*1.05)),i>ao*1.4&&(s.ecosystem.berryBushSpreadChance=Math.max(lo,s.ecosystem.berryBushSpreadChance*.95))}calculateReward(t,n,i){const s=Math.abs(t-ro),a=Math.abs(n-so),l=Math.abs(i-ao),c=s/ro,u=a/so,f=l/ao,g=c+u+f;return 100*Math.exp(-g*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(Fr,n.ecosystem.preyGestationPeriod+.2*(Fr-Us));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(Us,n.ecosystem.preyGestationPeriod-.2*(Fr-Us));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(Lr,n.ecosystem.preyProcreationCooldown+.2*(Lr-Gs));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max(Gs,n.ecosystem.preyProcreationCooldown-.2*(Lr-Gs));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(Yo,n.ecosystem.preyHungerIncreasePerHour+.2*(Yo-xs));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(xs,n.ecosystem.preyHungerIncreasePerHour-.2*(Yo-xs));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(Hr,n.ecosystem.predatorGestationPeriod+.2*(Hr-$s));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max($s,n.ecosystem.predatorGestationPeriod-.2*(Hr-$s));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min(Ur,n.ecosystem.predatorProcreationCooldown+.2*(Ur-Ws));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(Ws,n.ecosystem.predatorProcreationCooldown-.2*(Ur-Ws));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(zo,n.ecosystem.predatorHungerIncreasePerHour+.2*(zo-Ys));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(Ys,n.ecosystem.predatorHungerIncreasePerHour-.2*(zo-Ys));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(vl,n.ecosystem.berryBushSpreadChance+.2*(vl-lo));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(lo,n.ecosystem.berryBushSpreadChance-.2*(vl-lo));break}}updateQTable(t,n,i,s){const a=this.getQValue(t,n),l=Math.max(...Array.from({length:mg},(u,f)=>this.getQValue(s,f))),c=a+zk*(i+jk*l-a);this.setQValue(t,n,c)}step(t){const n=t,i=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count();this.applyEmergencyCorrections(i,s,a,t);const l=this.discretizeState(i,s,a);if(this.lastState!==null&&this.lastAction!==null){const u=this.calculateReward(i,s,a);this.updateQTable(this.lastState,this.lastAction,u,l)}const c=this.chooseAction(l);this.applyAction(c,t),this.epsilon=Math.max(Vk,this.epsilon*Xk),this.lastState=l,this.lastAction=c}reset(){this.qTable.clear(),this.epsilon=mv,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let OT=new Kk;function qk(e){Wk(e),xk(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=Us+(Fr-Us)*.3,e.ecosystem.preyProcreationCooldown=Gs+(Lr-Gs)*.3,e.ecosystem.preyHungerIncreasePerHour=xs+(Yo-xs)*.3,e.ecosystem.predatorGestationPeriod=$s+(Hr-$s)*.3,e.ecosystem.predatorProcreationCooldown=Ws+(Ur-Ws)*.3,e.ecosystem.predatorHungerIncreasePerHour=Ys+(zo-Ys)*.3,e.ecosystem.berryBushSpreadChance=lo+(vl-lo)*.7),OT.step(e)}function Zk(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<Yk)&&(e.ecosystem.lastUpdateTime=e.time,qk(e))}function Qk(){return OT.getStats()}function Jk(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function eB(e){const{gameState:t}=e,n=t.time,i=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of i)switch(a.type){case"ranged-impact":{const l=t.entities.entities[a.data.targetId];if(!l||l.hitpoints<=0)continue;l.hitpoints-=a.data.damage,l.movementSlowdown={modifier:bu,endTime:t.time+ku};const c=Ye(a.data.attackerPosition,l.position,t.mapDimensions.width,t.mapDimensions.height),u=Tt(c,a.data.pushbackForce);l.forces.push(u),$e(t,_e.Hit,l.position,Ke,l.id),l.hitpoints<=0?Oe(e,Pe.HumanDeath,l.position):Oe(e,Pe.Attack,l.position);break}}}const bT="ownedIndices",yv="frontierScanIndex",kl="frontierCandidates";function tB(e){const{gameState:t}=e,n=t,s=n.search.human.all().filter(f=>f.leaderId===f.id),{width:a,height:l}=t.mapDimensions,c=Math.ceil(a/Se),u=Math.ceil(l/Se);for(const f of s){if(!f.aiBlackboard)continue;const g=T.get(f.aiBlackboard,bT)||[];if(g.length===0)continue;let m=T.get(f.aiBlackboard,yv)||0;const v=T.get(f.aiBlackboard,kl)||{},S=In(f.id,t),I=20;for(let w=0;w<I;w++){m>=g.length&&(m=0);const P=g[m];m=(m+1)%g.length;const R=P%c,_=Math.floor(P/c),b=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:M,dy:D}of b){const N=(R+M+c)%c,k=(_+D+u)%u,L=k*c+N,z=t.terrainOwnership[L],V=z!==null&&Ui(f.id,z,t);if(z===null||V){let X=0;for(const{dx:j,dy:ce}of b){const pe=(N+j+c)%c,Me=(k+ce+u)%u;t.terrainOwnership[Me*c+pe]===f.id&&X++}const Q=X*20,q=$g(L,a),ie=n.search.berryBush.byRadius(q,100),oe=n.search.tree.byRadius(q,100),ee=ie.length*10+oe.length*5,x=V?50:0,Z=U(q,S,a,l)/100*5,B=Q+ee+x-Z;v[L.toString()]={score:B,fromIdx:P,lastSeenTime:t.time}}}}const A=Object.entries(v).sort((w,P)=>P[1].score-w[1].score);if(A.length>50){const w={};for(let P=0;P<50;P++){const[R,_]=A[P];w[R]=_}T.set(f.aiBlackboard,kl,w)}else T.set(f.aiBlackboard,kl,v);T.set(f.aiBlackboard,yv,m)}}function nB(e){var m,v,S;const{gameState:t}=e,n=t,i=n.search.human.all(),s=new Map,a=new Set;for(let I=0;I<i.length;I++){const A=i[I];A.leaderId&&(s.has(A.leaderId)||s.set(A.leaderId,[]),s.get(A.leaderId).push(A),A.leaderId===A.id&&a.add(A.id))}const l=Object.values(t.tasks),c=new Map;for(let I=0;I<l.length;I++){const A=l[I];A.creatorEntityId&&(c.has(A.creatorEntityId)||c.set(A.creatorEntityId,[]),c.get(A.creatorEntityId).push(A))}const u=n.search.building.all(),f=new Map;for(let I=0;I<u.length;I++){const A=u[I];if(A.ownerId){const w=t.entities.entities[A.ownerId],P=w==null?void 0:w.leaderId;P&&(f.has(P)||f.set(P,[]),f.get(P).push(A))}}const g=new Map;for(const I of a)g.set(I,In(I,t));for(const I of a){const A=t.entities.entities[I];if(!A)continue;const w=[];for(let k=0;k<t.terrainOwnership.length;k++)t.terrainOwnership[k]===I&&w.push(k);T.set(A.aiBlackboard,bT,w);const P=s.get(I)||[];if(P.length<Bp)continue;const R=P.filter(k=>k.isAdult);if(R.length===0)continue;const _=c.get(I)||[],b=k=>_.some(L=>L.type===k),M=f.get(I)||[],D=[];for(const[k,L]of g.entries())k!==I&&D.push(L);if(!b(ae.HumanPlaceStorage)){const k=M.filter(Q=>Q.buildingType===fe.StorageSpot);let L=0,z=0;for(let Q=0;Q<k.length;Q++){const q=k[Q];L+=((m=q.storedItems)==null?void 0:m.length)||0,z+=q.storageCapacity||0}const V=z>0?L/z:0;if(k.length===0||V>Ug){const Q=k.length===0?zI:Vs,q=Ks(fe.StorageSpot,I,t,eo,Q,A.position,D);q&&bd(I,ae.HumanPlaceStorage,q,t)}}if(!b(ae.HumanPlaceBonfire)){const k=M.filter(ie=>ie.buildingType===fe.Bonfire),L=g.get(I),V=er(t.temperature,L,t.time,t.mapDimensions.width,t.mapDimensions.height)<sA&&k.length===0,X=k.length>0&&k.length<Math.ceil(R.length/aA);let Q;const q=P.filter(ie=>er(t.temperature,ie.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<co+5?k.every(x=>U(ie.position,x.position,t.mapDimensions.width,t.mapDimensions.height)>kr*1.5):!1);if(q.length>=3){const ie=q.reduce((ee,x)=>ee+x.position.x,0)/q.length,oe=q.reduce((ee,x)=>ee+x.position.y,0)/q.length;Q={x:ie,y:oe}}if(V||X||Q){const ie=Ks(fe.Bonfire,I,t,eo,Vs,Q||A.position,D);ie&&bd(I,ae.HumanPlaceBonfire,ie,t)}}if(!b(ae.HumanPlacePlantingZone)){const L=M.filter(V=>V.buildingType===fe.PlantingZone&&DA(V,t)).reduce((V,X)=>V+bp(X),0),z=Math.max(Hs,R.length*Gg);if(L<z){const V=Ks(fe.PlantingZone,I,t,eo,Vs,A.position,D);V&&bd(I,ae.HumanPlacePlantingZone,V,t)}}if((((S=(v=A.tribeControl)==null?void 0:v.armyControl)==null?void 0:S.expandBorders)??0)>=2){const k=T.get(A.aiBlackboard,kl)||{},{width:L,height:z}=t.mapDimensions,V=M.filter(q=>q.buildingType===fe.BorderPost),X=_.filter(q=>q.type===ae.HumanPlaceBorderPost);for(const q in k){const ie=parseInt(q,10),oe=t.terrainOwnership[ie],ee=oe!==null&&Ui(A.id,oe,t);if(oe===I||oe!==null&&!ee){delete k[q];continue}const x=$g(ie,L);(V.some(Z=>Nn(x,Z.position,L,z)<100*100)||X.some(Z=>Nn(x,Z.position,L,z)<100*100))&&delete k[q]}T.set(A.aiBlackboard,kl,k);const Q=3;if(X.length<Q){const q=Object.entries(k).map(([x,K])=>({idx:parseInt(x,10),...K})).sort((x,K)=>K.score-x.score),ie=[];for(const x of q){if(ie.length>=Q-X.length)break;const K=$g(x.idx,L);ie.every(B=>Nn(K,B,L,z)>100*100)&&ie.push(K)}const oe=new Set(X.map(x=>{const K=x.id.split("-");return parseInt(K[K.length-1],10)}).filter(x=>!isNaN(x))),ee=[];for(let x=0;x<Q;x++)oe.has(x)||ee.push(x);for(let x=0;x<ie.length;x++)bd(I,ae.HumanPlaceBorderPost,ie[x],t,ee[x])}}}}function bd(e,t,n,i,s=0){const a=`${ae[t]}-${e}-${s}`;i.tasks[a]={id:a,position:n,type:t,creatorEntityId:e,target:n,validUntilTime:i.time+12}}function iB(e){const{gameState:t}=e,s=t.search.human.all().filter(a=>a.leaderId===a.id);for(const a of s){if(!a.aiBlackboard)continue;const l=`diplomacy-${a.id}`;if(t.tasks[l])continue;const c=T.get(a.aiBlackboard,"lastDiplomacyCheckTime")??-1/0;if(t.time-c<Lg)continue;const u={id:l,type:ae.HumanDiplomacy,position:a.position,creatorEntityId:a.id,validUntilTime:t.time+Lg};t.tasks[l]=u}}const oB=1/60;function rB(e,t){if(!e.cameraFollowingPlayer)return;const n=At(e);n&&(e.viewportCenter=Zd(e.viewportCenter,n.position,iu*t))}function Xu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(lp(e),e.lastAutosaveTime=n)}for(;t>0;){const n=Iu(e),i=Math.min(t,oB),s=i*(_t/Nt);n.time+=s,rB(n,i),vR(n),FO(n),Zk(n),XP(n),KM(n),IR(n),eB({gameState:n}),xb({gameState:n,deltaTime:i}),Hk({gameState:n,deltaTime:i}),tB({gameState:n}),Math.floor(n.time)>Math.floor(n.time-s)&&(BP(n),nB({gameState:n}),iB({gameState:n})),PT(n),Zb(n,i),Jk(n),e=n,t-=i}return e}function yg(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,c=hA;if(e.beginPath(),e.moveTo(i+c,s),e.lineTo(i+a-c,s),e.quadraticCurveTo(i+a,s,i+a,s+c),e.lineTo(i+a,s+l-c),e.quadraticCurveTo(i+a,s+l,i+a-c,s+l),e.lineTo(i+c,s+l),e.quadraticCurveTo(i,s+l,i,s+l-c),e.lineTo(i,s+c),e.quadraticCurveTo(i,s,i+c,s),e.closePath(),e.fillStyle=t.isDisabled?gA:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*SA)+1)/2;e.strokeStyle=yA,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<du){const f=1-u/du;e.fillStyle=mA,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Mp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?pA:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function sB(e,t,n,i){e.save(),e.font=`${bS}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,l=bS,c=a+kS*2,u=l+kS*2,f=i.x-c/2,g=e.canvas.height,m=t.y<g/2?t.y+t.height-BS:t.y-u+BS;e.fillStyle=z1,e.fillRect(f,m,c,u),e.fillStyle=j1,e.fillText(n,i.x,m+u/2+l/2),e.restore()}function aB(e,t,n){e.save();const i=At(t),s=[{id:"fastForwardButton",action:le.FastForward,text:"FFWD [T]",currentWidth:oo*1.3,backgroundColor:xn,textColor:ft,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:le.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?Il:xn,currentWidth:t.isPaused?oo*1.4:oo*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:ft},{id:"muteButton",action:le.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?Il:xn,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:oo,rect:{x:0,y:0,width:0,height:0},textColor:ft},{id:"returnToIntroButton",action:le.ReturnToIntro,text:"EXIT",backgroundColor:xn,tooltip:"Return to Main Menu [ESC]",currentWidth:oo*.9,rect:{x:0,y:0,width:0,height:0},textColor:ft}];if(t.uiButtons.push(...s),i){const f=$p(t,i),g=new Set(f.map(R=>R.type));let m=[{playerAction:ue.Gather,buttonAction:le.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>i.isAdult===!0},{playerAction:ue.Eat,buttonAction:le.CommandEat,shortcut:"F",name:"Eat"},{playerAction:ue.Plant,buttonAction:le.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>i.isAdult===!0},{playerAction:ue.Procreate,buttonAction:le.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>i.isAdult===!0},{playerAction:ue.FeedChild,buttonAction:le.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>i.isAdult===!0},{playerAction:ue.Attack,buttonAction:le.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>i.isAdult===!0&&i.leaderId===i.id},{playerAction:ue.ArmyControl,buttonAction:le.OpenArmyControl,shortcut:"V",name:"Army Control",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&ci(i.id,t).length>aD},{playerAction:ue.TribeSplit,buttonAction:le.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>i.leaderId!==void 0&&i.leaderId!==i.id&&i.isAdult===!0},{playerAction:ue.Build,buttonAction:le.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&ci(i.id,t).length>Bp},{playerAction:ue.Build,buttonAction:le.OpenRoleManager,shortcut:"U",name:"Roles",toggleKey:"roleManagement",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Yu(i,t)}];m=m.filter(R=>R.condition?R.condition():!0);const v=1,S=m.length,I=S*Gn+(S-1)*vr,A=v*Gn+(v-1)*vr,w=(n-I)/2,P=e.canvas.height-A-20;if(m.forEach((R,_)=>{const b=_%S,M=Math.floor(_/S),D=w+b*(Gn+vr),N=P+M*(Gn+vr),k=!!R.toggleKey,L=k&&t.autopilotControls.behaviors[R.toggleKey],z=!g.has(R.playerAction),X=R.playerAction===ue.Build&&t.buildMenuOpen,Q=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",q=k?`${R.name}${Q}`:R.name,ie=L||X||R.buttonAction===le.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)?Il:xn,oe={id:`commandButton_${R.name}`,action:R.buttonAction,rect:{x:D,y:N,width:Gn,height:Gn},icon:R.buttonAction===le.OpenRoleManager?"":Hu[R.playerAction],text:R.shortcut,backgroundColor:ie,textColor:ft,currentWidth:Gn,tooltip:q,isDisabled:z,activated:L||R.buttonAction===le.CommandBuild&&X||R.buttonAction===le.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)};t.uiButtons.push(oe)}),t.buildMenuOpen){const R=[{id:"buildMenu_storageSpot",action:le.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:le.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_bonfire",action:le.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:le.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:le.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"}],_=R.length,b=_*Gn+(_-1)*vr,M=(n-b)/2,D=P-Gn-vr;R.forEach((N,k)=>{const L=M+k*(Gn+vr),z=D,V=N.action===le.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||N.action===le.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||N.action===le.SelectBorderPost&&t.selectedBuildingType==="borderPost"||N.action===le.SelectBonfire&&t.selectedBuildingType==="bonfire"||N.action===le.SelectRemovalTool&&t.selectedBuildingType==="removal",X={id:N.id,action:N.action,rect:{x:L,y:z,width:Gn,height:Gn},icon:N.icon,text:N.shortcut,backgroundColor:V?Il:xn,textColor:ft,currentWidth:Gn,tooltip:N.name,activated:V};t.uiButtons.push(X),yg(e,X,t.hoveredButtonId===X.id)})}}let a=n-tt;s.forEach(f=>{const g=tt,m=a-f.currentWidth;f.rect={x:m,y:g,width:f.currentWidth,height:fA},yg(e,f,t.hoveredButtonId===f.id),a-=f.currentWidth+Y1});let l=null;t.uiButtons.filter(f=>f.id.startsWith("commandButton_")||f.id.startsWith("buildMenu_")).forEach(f=>{l||(l={x:f.rect.x,y:f.rect.y,width:f.rect.width,height:f.rect.height}),l.x=Math.min(l.x,f.rect.x),l.y=Math.min(l.y,f.rect.y),l.width=Math.max(l.width,f.rect.x+f.rect.width-l.x),l.height=Math.max(l.height,f.rect.y+f.rect.height-l.y),f.id.startsWith("commandButton_")&&yg(e,f,t.hoveredButtonId===f.id)});const u=t.hoveredButtonId?t.uiButtons.find(f=>f.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&sB(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:l}}function lB(e){e.save(),e.fillStyle=tP,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=nP,e.font=`${iP}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function np(e,t,n,i){const s=t.x-n.width/2,a=t.y-n.height/2,l=s+e.x,c=a+e.y,u=(l%i.width+i.width)%i.width,f=(c%i.height+i.height)%i.height;return{x:u,y:f}}function ac(e,t,n,i){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>i.width/2&&(s=s-Math.sign(s)*i.width),Math.abs(a)>i.height/2&&(a=a-Math.sign(a)*i.height),{x:s+n.width/2,y:a+n.height/2}}function Bl(e,t,n,i){const s=ac(e.position,t,n,i),l=("radius"in e?e.radius:20)+20;return s.x>=-l&&s.x<=n.width+l&&s.y>=-l&&s.y<=n.height+l}function ai(e,t,n,i,s,...a){const l={...s.position};for(let c=-n;c<=n;c+=n)for(let u=-t;u<=t;u+=t)s.position.x=l.x+u,s.position.y=l.y+c,i(e,s,...a);s.position=l}function kT(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const i=n.getContext("2d");if(!i)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:n,ctx:i}}function qs(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function Xr(e,t){return Math.round(e*t)/t}function qp(e,t=8){const i=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(i/(Math.PI*2)*t)%t}function Zp(e,t=8){const n=e/t*Math.PI*2;return[Math.cos(n),Math.sin(n)]}const cB=25,dB=0,Sv=28;function BT(e,t,n,i,s,a,l,c,u,f){e.save();const{x:g,y:m}=ac(t,l,{width:c,height:u},f);e.strokeStyle=i,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(g,m,n+Bu,0,2*Math.PI),e.stroke(),e.restore()}function uB(e,t,n,i,s,a,l){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&BT(e,m.targetEntity.position,m.targetEntity.radius,Pp,Dp,2,i,s,a,l)}),e.font=`${la}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:c,y:u}=ac(n.position,i,{width:s,height:a},l);let f=0,g={};t.forEach(m=>{const v=Hu[m.type];if(m.targetEntity){g[m.targetEntity.id]=(g[m.targetEntity.id]||0)+1;const S=m.targetEntity.position.x-i.x+s/2,I=m.targetEntity.position.y-i.y+a/2,A=`${v}${m.key.toUpperCase()}`,w=I-m.targetEntity.radius-Bu-la/2-(g[m.targetEntity.id]-1)*Sv;e.fillText(A,S,w)}else{e.textAlign="left";const S=`${v}${m.key.toUpperCase()}`,I=c+cB,w=u+dB+f*Sv;e.fillText(S,I,w),f++,e.textAlign="center"}}),e.restore()}function fB(e,t,n,i,s,a,l){const f=eg+8+30,g={x:WS,y:a-WS-f,width:eg,height:eg};t.minimapRect=g,e.save(),e.fillStyle=PP,e.fillRect(g.x,g.y,g.width,g.height),e.strokeStyle=RP,e.lineWidth=2,e.strokeRect(g.x,g.y,g.width,g.height);const{width:m,height:v}=t.mapDimensions,S=Math.ceil(m/Se),I=Math.ceil(v/Se),A=new Map;i.forEach((he,Ee)=>{const Re=he.isPlayerTribe?0:Ee%(yn.length-1)+1;A.set(he.leaderId,yn[Re])});const w=g.width/S,P=g.height/I,R=g.x+g.width/2,_=g.y+g.height/2,b=S>400?4:S>200?2:1;for(let he=0;he<I;he+=b)for(let Ee=0;Ee<S;Ee+=b){const Re=he*S+Ee,de=t.terrainOwnership[Re];if(de!==null){const ve=(Ee+.5)*Se,Ge=(he+.5)*Se,Ae=Ye(n,{x:ve,y:Ge},m,v),kn=R+Ae.x/m*g.width,Je=_+Ae.y/v*g.height,st=t.hoveredMinimapTribeId===de;if(e.fillStyle=A.get(de)||"#888",st){const Zn=(Math.sin(t.time*5)+1)/2;e.globalAlpha=.6+Zn*.4}else e.globalAlpha=.8;e.fillRect(kn-w*b/2,Je-P*b/2,w*b,P*b)}}e.globalAlpha=1,e.save(),e.beginPath(),e.rect(g.x,g.y,g.width,g.height),e.clip();for(const he of i){if(!he.territoryCenter)continue;const Ee=Ye(n,he.territoryCenter,m,v),Re=R+Ee.x/m*g.width,de=_+Ee.y/v*g.height;e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="white",e.fillText(he.tribeBadge,Re,de),he.isPlayerTribe&&(e.strokeStyle="gold",e.lineWidth=1,e.beginPath(),e.arc(Re,de,10,0,Math.PI*2),e.stroke())}e.restore();const M=s/l,D=a/l,N=M/m*g.width,k=D/v*g.height;e.save(),e.beginPath(),e.rect(g.x,g.y,g.width,g.height),e.clip(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.strokeRect(R-N/2,_-k/2,N,k),e.restore(),e.restore();const L=g.y+g.height+8,z=g.x,V=L,X="recenter_camera_btn",Q={id:X,action:le.RecenterCamera,rect:{x:z,y:V,width:30,height:30},text:"",currentWidth:30,backgroundColor:t.cameraFollowingPlayer?Il:xn,textColor:ft,tooltip:"Lock camera to player"};t.uiButtons.push(Q),e.fillStyle=t.hoveredButtonId===X?"#4a5568":Q.backgroundColor,e.fillRect(z,V,30,30),e.strokeStyle="#666",e.strokeRect(z,V,30,30);const q=z+30/2,ie=V+30/2,oe=30*.35;e.strokeStyle=ft,e.lineWidth=2,e.beginPath(),e.arc(q,ie,oe,0,Math.PI*2),e.stroke();const ee=oe*.6;e.beginPath(),e.moveTo(q-ee,ie),e.lineTo(q+ee,ie),e.moveTo(q,ie-ee),e.lineTo(q,ie+ee),e.stroke(),e.fillStyle=ft,e.beginPath(),e.arc(q,ie,2,0,Math.PI*2),e.fill();const x="open_tribe_modal_btn",K=`Tribes (${i.length})`;e.font='10px "Press Start 2P", Arial';const Z=e.measureText(K),B=Math.max(30,Z.width+16),j=30,ce=z+30+8,pe=L,Me={id:x,action:le.OpenTribeModal,rect:{x:ce,y:pe,width:B,height:j},text:K,currentWidth:B,backgroundColor:xn,textColor:ft,tooltip:"View all tribes and diplomacy"};t.uiButtons.push(Me),e.fillStyle=t.hoveredButtonId===x?"#4a5568":xn,e.fillRect(ce,pe,B,j),e.strokeStyle="#666",e.strokeRect(ce,pe,B,j),e.fillStyle=ft,e.textAlign="center",e.textBaseline="middle",e.fillText(K,ce+B/2,pe+j/2)}const Le=(e,t,n,i,s,a,l)=>{a==="transparent"||i<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*l),Math.floor(n*l),Math.ceil(i*l),Math.ceil(s*l)))},vv=10,Iv=10,Mi=6,Zi=4,kd=2,hB=5,si=4,gB=2,on=4,pB=2,pt=3,Ps=2,$o=0,Fl=$o+Zi-1,fn=Fl,wt=Fl+si-1,mB="rgba(0, 0, 0, 0.4)",yB=4,SB=1,Qp={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,i,s,a,l,c="male",u=20,f=[1,0],g=!1,m=0){const v=["dead","stunned"].includes(l),S=v?Iv+4:vv,I=v?vv+4:Iv+pt,A=.15,w=Math.min(i*(1-2*A)/S,s*(1-2*A)/I),P=S*w,R=I*w,_=t+(i-P)/2,b=n+(s-R)/2;e.save(),f[0]<0&&!v?(e.translate(_+P,b),e.scale(-1,1)):e.translate(_,b);const D="#D09A5A",N=u>50?"#BDBDBD":"#281808",k="#7F5C4A",L="#6B4F3A",z="#E0D8C0",V="#A0522D",X=1-Math.max(0,Math.min(100,m))/100*.2,Q=c==="male"?1.1:.9,q=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let ie=hB*X*Q*q,oe=gB*X*Q*q,ee=pB*X*q;g&&c==="female"&&(ie*=1.5);const x=Math.round((S-ie)/2),K=Math.round((S-Mi)/2),Z=x-oe,B=x+ie,j=1,ce=x+(ie/2-j/2)-ee,pe=x+(ie/2+j/2),Me=f[1]<-.2&&Math.abs(f[0])<.7,he=de=>{e.fillStyle=mB,e.beginPath();const ve=S/2,Ge=de;e.ellipse(Math.floor(ve*w),Math.floor(Ge*w),Math.max(1,Math.floor(yB*w)),Math.max(1,Math.floor(SB*w)),0,0,2*Math.PI),e.fill()},Ee=(de,ve)=>{c==="male"?(Le(e,x,Fl+de,ie,si-Ps,ve,w),Le(e,x,Fl+si-Ps+de,ie,Ps,k,w)):Le(e,x,Fl+de,ie,si,L,w)},Re=(de,ve)=>{Me?Le(e,K,$o+de,Mi,Zi,N,w):(Le(e,K,$o+de,Mi,Zi,ve,w),Le(e,K,$o+de,Mi,kd,N,w),c==="female"?(Le(e,K-1,$o+kd+de,1,Zi,N,w),Le(e,K+Mi,$o+kd+de,1,Zi,N,w)):Le(e,K+1,$o+2+de,Mi-2,Zi-2,N,w))};switch(l){case"idle":{const de=a*Math.PI*2,ve=Math.sin(de)*.5,Ae=(Math.cos(de*2)+1)*.25;he(wt+pt+1),Le(e,ce+ve,wt+Ae,ee,pt,D,w),Le(e,pe-ve,wt+Ae,ee,pt,D,w),Ee(Ae,D),Le(e,Z,fn+Ae,oe,on,D,w),Le(e,B,fn+Ae,oe,on,D,w),Re(Ae,D);break}case"walk":{const de=a*Math.PI*2,ve=Math.sin(de)*2,Ae=Math.abs(Math.cos(de))*1;he(wt+pt+1),Le(e,ce+ve,wt+Ae,ee,pt,D,w),Le(e,pe-ve,wt+Ae,ee,pt,D,w),Ee(Ae,D),Le(e,Z-ve,fn+Ae,oe,on,D,w),Le(e,B+ve,fn+Ae,oe,on,D,w),Re(Ae,D);break}case"gathering":{const de=a*Math.PI*2,ve=1,Ge=(Math.sin(de)+1)/2*2,Ae=ve+Math.abs(Math.cos(de))*.5;he(wt+pt+1),Le(e,ce,wt+Ae,ee,pt-ve,D,w),Le(e,pe,wt+Ae,ee,pt-ve,D,w),Ee(Ae,D),Le(e,Z+1,fn+Ae-Ge,oe,on,D,w),Le(e,B-1,fn+Ae-Ge,oe,on,D,w),Re(Ae,D);break}case"eat":{he(wt+pt+1),Le(e,ce,wt+1,ee,pt-1,D,w),Le(e,pe,wt+1,ee,pt-1,D,w),Ee(1,D);const Ge=(Math.sin(a*Math.PI*4)+1)/2,Ae=K+Mi/2,kn=$o+Zi/2,Je=B+(Ae-B)*Ge,st=fn+1+(kn-(fn+1))*Ge;Le(e,Z,fn+1,oe,on,D,w),Le(e,Je,st,oe,on,D,w),Le(e,Je,st-1,1,1,V,w),Re(1,D);break}case"procreate":{const de=(Math.sin(a*Math.PI*8)+1)/4,ve=(Math.sin(a*Math.PI*6)+1)*.5,Ge=1.5,Ae=Ge-ve;he(wt+pt+1),Le(e,ce,wt+Ae,ee,pt-Ge,D,w),Le(e,pe,wt+Ae,ee,pt-Ge,D,w),Ee(Ae,D),Le(e,Z,fn+Ae,oe,on,D,w),Le(e,B,fn+Ae,oe,on,D,w),Re(Ae,D),e.globalAlpha=de,Ee(Ae,"white"),e.globalAlpha=1;break}case"attacking":{const de=Math.sin(a*Math.PI)*1.5,ve=Math.abs(Math.sin(a*Math.PI));he(wt+pt+1),Le(e,ce-de,wt+ve,ee,pt,D,w),Le(e,pe+de*.5,wt+ve,ee,pt,D,w),Ee(ve,D),Le(e,Z,fn+ve-2,oe,on,D,w),Le(e,B,fn+ve-2.5,oe,on,D,w),Re(ve,D);break}case"defending":{he(wt+pt+1),Le(e,ce,wt+1,ee,pt-1,D,w),Le(e,pe,wt+1,ee,pt-1,D,w),Ee(1,D),Le(e,Z-1,fn+1-1,oe,on,D,w),Le(e,B+1,fn+1-1,oe,on,D,w),Re(1,D);break}case"stunned":case"dead":{const de=l==="dead",ve=de?Math.min(1,a):0,Ge=ve>.5?z:D,Ae=c==="male"?k:L,kn=ve>.8?"transparent":N,Je=S/2,st=I/2,Zn=2;he(I-1),Le(e,Je-ee-Zn,st,ee,pt,Ge,w),Le(e,Je+Zn,st,ee,pt,Ge,w),Le(e,Je-oe-Zn,st-si+1,oe,on,Ge,w),Le(e,Je+Zn,st-si+1,oe,on,Ge,w);const En=Je-ie/2,Qn=st-si/2;c==="male"?(ve<.7&&Le(e,En,Qn+si-Ps,ie,Ps,Ae,w),Le(e,En,Qn,ie,si-Ps,Ge,w)):ve<.7?Le(e,En,Qn,ie,si,Ae,w):Le(e,En,Qn,ie,si,Ge,w);const Ai=Je-Mi/2,Ti=st-si/2-Zi+1;if(Le(e,Ai,Ti,Mi,Zi,Ge,w),kn!=="transparent"&&Le(e,Ai,Ti,Mi,kd,kn,w),de&&ve>.6){const go="#B0A890";for(let or=0;or<3;or++)Le(e,En+1,Qn+or*1+1,ie-2,.5,go,w)}break}default:Le(e,0,0,S,I,"magenta",w);break}e.restore()}};function vB(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function Zl(e,t,n,i,s,a=!1,l=!1,c=!1,u=!1){i<yp&&(n=n*.75),Qp.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,i,[0,0],!1,0);let f,g;a?(f=F1,g=lA):l?(f=L1,g=uA):c?(f=H1,g=dA):u&&(f=U1,g=cA),f&&g&&vB(e,t,n/2,f,g)}function IB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s,c=4;let u;const f=l+(i.length-1)*c;i.length>1&&f>a?u=(a-l)/(i.length-1):u=c,i.length<=1&&(u=0);for(let g=0;g<i.length;g++){const{member:m,isPlayer:v,isHeir:S,isPartner:I,isParent:A}=i[g],w=t+g*(s+u)+s/2,P=n+s/4;Zl(e,{x:w,y:P},s,m.age,m.gender,v,S,I,A)}e.restore()}function AB(e,t,n,i,s){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,i,s);const a=500,l=Math.min(s*.8,n.length*(ol+NS)+120),c=(i-a)/2,u=(s-l)/2;e.fillStyle="#2d3748",e.strokeStyle="#4a5568",e.lineWidth=4,e.fillRect(c,u,a,l),e.strokeRect(c,u,a,l),e.fillStyle="#fff",e.font='20px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="top",e.fillText("WORLD TRIBES",i/2,u+30);const f=u+80,g=a-rl*4,m=c+rl*2;for(let R=0;R<n.length;R++){const _=n[R],b=f+R*(ol+NS);if(b+ol>u+l-60)break;const M=b+ol/2;_.isPlayerTribe&&(e.fillStyle="rgba(255, 215, 0, 0.2)",e.fillRect(m,b,g,ol));let D=m+rl;if(e.font=`${Sr}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillStyle="white",e.fillText(_.tribeBadge,D,M),D+=Sr+rl*2,_.isPlayerTribe)e.fillStyle="#aaa",e.font='10px "Press Start 2P", Arial',e.textAlign="left",e.fillText("(YOU)",D,M);else{const N=_.diplomacyStatus===ut.Friendly?"":"",k=`modal_diplomacy_${_.leaderId}`,L={x:D,y:M-Sr/2,width:Sr*1.5,height:Sr},z={id:k,action:le.ToggleDiplomacy,rect:L,text:"",icon:N,backgroundColor:"transparent",textColor:"white",currentWidth:L.width,tooltip:`Set status to ${_.diplomacyStatus===ut.Friendly?"Hostile":"Friendly"}`,targetTribeId:_.leaderId};t.uiButtons.push(z),t.hoveredButtonId===k&&(e.fillStyle=Mp,e.fillRect(L.x,L.y,L.width,L.height)),e.font=`${Sr*.8}px Arial`,e.textAlign="center",e.fillText(N,L.x+L.width/2,M)}D+=Sr*2+rl,Zl(e,{x:D+10,y:M},Ji*.6,25,"male"),e.fillStyle="white",e.font=`${G1}px "Press Start 2P"`,e.fillText(`${_.adultCount}`,D+30,M),D+=80,Zl(e,{x:D+10,y:M},Ji*.6,5,"female"),e.fillText(`${_.childCount}`,D+30,M)}const v=120,S=40,I=i/2-v/2,A=u+l-60,w="close_tribe_modal_btn",P={id:w,action:le.CloseTribeModal,rect:{x:I,y:A,width:v,height:S},text:"CLOSE",currentWidth:v,backgroundColor:xn,textColor:ft};t.uiButtons.push(P),e.fillStyle=t.hoveredButtonId===w?"#4a5568":xn,e.fillRect(I,A,v,S),e.strokeStyle="#fff",e.strokeRect(I,A,v,S),e.fillStyle=ft,e.font='12px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="middle",e.fillText("CLOSE",i/2,A+S/2),e.restore()}function TB(e,t,n,i,s){const a=TA,l=EA,c=t+i-a-l,u=n+l;e.save(),e.lineWidth=2,e.strokeStyle=s?hP:fP,e.beginPath();const f=5;e.moveTo(c+f,u+f),e.lineTo(c+a-f,u+a-f),e.moveTo(c+a-f,u+f),e.lineTo(c+f,u+a-f),e.stroke(),e.restore()}function EB(e,t,n,i){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===pn.INACTIVE)return;const l=a.steps[s.currentStepIndex];if(!l)return;e.save(),e.globalAlpha=s.transitionAlpha;const c=oP,u=rP,f=sP,g=`${Qh}px "Press Start 2P", Arial`,m=`${HS}px "Press Start 2P", Arial`,v=lP,S=HS*1.5;e.font=m;const I=l.text.split(" ");let A="";const w=[];for(let z=0;z<I.length;z++){const V=A+I[z]+" ";e.measureText(V).width>c-u*2&&z>0?(w.push(A),A=I[z]+" "):A=V}w.push(A);const P=u*2+Qh+u/2+w.length*S,R=(n-c)/2,_=i-P-160;e.fillStyle=aP,e.beginPath(),e.moveTo(R+f,_),e.lineTo(R+c-f,_),e.quadraticCurveTo(R+c,_,R+c,_+f),e.lineTo(R+c,_+P-f),e.quadraticCurveTo(R+c,_+P,R+c-f,_+P),e.lineTo(R+f,_+P),e.quadraticCurveTo(R,_+P,R,_+P-f),e.lineTo(R,_+f),e.quadraticCurveTo(R,_,R+f,_),e.closePath(),e.fill(),e.fillStyle=v,e.textAlign="center",e.textBaseline="top",e.font=g,e.fillText(l.title,R+c/2,_+u),e.font=m;let b=_+u+Qh+u/2;for(const z of w)e.fillText(z,R+c/2,b),b+=S;const M=t.hoveredButtonId==="tutorial-dismiss";TB(e,R,_,c,M),e.restore();const D=TA,N=EA,k=R+c-D-N,L=_+N;return{x:k,y:L,width:D,height:D}}function Sg(e,t,n){e.save();const i=uP,s={x:t.x-i,y:t.y-i,width:t.width+i*2,height:t.height+i*2};e.strokeStyle=IA,e.lineWidth=AA+Math.sin(n*Np)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function CB(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const FT=10,wB=3,Av=FT*.7;function _B(e,t){const{position:n,food:i,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,FT,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),i.length>0){const a=Math.PI*2/Math.min(i.length,s);for(let l=0;l<i.length;l++){const c=l*a,u=n.x+Av*Math.cos(c),f=n.y+Av*Math.sin(c);e.beginPath(),e.arc(u,f,wB,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const Tv=(e,t,n=70,i=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${i}%)`},RB=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[i,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${i}, ${s}%, ${Math.max(0,a-t)}%)`},Bd=(e,t,n,i,s,a,l,c=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=c?RB(l,15):l,e.beginPath(),e.roundRect(-i/2,0,i,s,i/2),e.fill(),e.restore()},vg=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),i=75;if(!n)return`hsl(0, 0%, ${i}%)`;const[,s,a,l]=n.map(Number),c=a*(1-t),u=l+(i-l)*t;return`hsl(${s}, ${c}%, ${u}%)`},LT={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,i,s,a,l,c={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=i*.15,f=t+i/2,g=n+s/2,m=i-u*2,v=s-u*2,{gender:S,age:I,direction:A,isPregnant:w,hungryLevel:P,geneCode:R}=c,_=.8+Math.min(I,10)/10*.4,b=S==="male"?1.05:.95,M=1-P/100*.3,D=m*.5*M*_*b;let N=v*.3*_*b;const k=m*.15*_*b,L=D*.2,z=v*.3,V=Tv(R,0,30,50);let X=Tv(R,8,50,40);if(I>45){const he=Math.min(1,(I-45)/15);X=vg(X,he)}e.translate(f,g),A[0]<0&&e.scale(-1,1);const Q=Math.sin(a*Math.PI*2),q=Math.cos(a*Math.PI*2),ie=z+N*.2;if(l==="dead"){const he=Math.min(a,1);e.translate(0,v*.2),e.rotate(Math.PI/2);const Ee=vg(X,he),Re=vg(V,he);e.globalAlpha=.5+he*.5,e.strokeStyle=Ee,e.lineWidth=L*.5,e.beginPath(),e.moveTo(-D*.4,0),e.lineTo(D*.4,0),e.stroke();for(let de=-1;de<=1;de+=1)e.beginPath(),e.arc(0,0,N*.4,Math.PI*.4*de-Math.PI*.2,Math.PI*.4*de+Math.PI*.2),e.stroke();e.fillStyle=Re,e.beginPath(),e.arc(D*.5,0,k,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(D*.55,0,k*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,ie,D*.7,D*.25,0,0,2*Math.PI),e.fill();let oe=0,ee=0,x=0,K=0,Z=0,B=0;switch(l){case"idle":ee=Q*(v*.02),x=Q*.05,K=-Q*.05,Z=-Q*.05,B=Q*.05;break;case"walk":ee=Math.abs(q)*(v*-.04),x=Q*.7,K=-Q*.7,Z=-Q*.7,B=Q*.7;break;case"eat":oe=v*.1,ee=v*.05,oe+=Q*(v*.02);break;case"procreate":ee=v*.05;const he=(1-q)*-m*.05;e.translate(he,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}w&&S==="female"&&(N*=1.6);const j=ee,ce=j-N*.2;Bd(e,D*-.35,ce,L,z,Z,X,!0),Bd(e,D*.35,ce,L,z,B,X,!0),e.fillStyle=X,e.beginPath(),e.ellipse(0,j,D/2,N/2,0,0,2*Math.PI),e.fill();const pe=D*.45,Me=ce+oe;e.fillStyle=V,e.beginPath(),e.arc(pe,Me,k,0,Math.PI*2),e.fill(),A[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(pe+k*.3,Me-k*.2,k*.15,0,Math.PI*2),e.fill()),Bd(e,D*-.35,ce,L,z,x,X),Bd(e,D*.35,ce,L,z,K,X),e.restore()}};function PB(e,t){let[n,i,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),i=Math.max(0,i-t),s=Math.max(0,s-t),`rgb(${n}, ${i}, ${s})`}function DB(e){const t=(e&16711680)>>16,n=(e&65280)>>8,i=e&255,s=`rgb(${t}, ${n}, ${i})`,a=PB(s,40),l=(e&255)%100+50,c=(e>>8&255)%100,u=(e>>16&255)%100,f=`rgb(${l}, ${c}, ${u})`,g=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:f,eyeColor:g}}const HT={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,i,s,a,l,c={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:f,direction:g,isPregnant:m,hungryLevel:v,geneCode:S}=c;e.save();const I=i*.15,A=Math.max(1,Math.floor((i-I*2)/10)),w=g[0]<0;e.translate(t+i/2,n+s/2),w&&e.scale(-1,1);const P=DB(S),R=.8+Math.min(f,20)/20*.4,_=u==="male"?1.05:.95,b=1-v/100*.25,M=R*_*b,D=Math.max(0,Math.min(1,(f-15)/5));e.filter=`grayscale(${D})`;const N=P.furColor,k=P.darkerFurColor,L=P.eyeColor,z="#FFFFFF",V="#c75c5c",X="#E0E0E0",Q="#A0A0A0",q=s/2-2*A,ie=Math.sin(a*Math.PI*2),oe=Math.abs(ie);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,q,A*4,A,0,0,2*Math.PI),e.fill(),e.filter="none",l==="dead"){const Je=Math.min(1,a*2);e.save(),e.translate(0,q-A*3),e.rotate(-Math.PI/2);const st=(Zn,En,Qn,Ai,Ti=!1)=>{e.fillStyle=Ti?Q:X,e.fillRect(Zn*A,En*A,Qn*A,Ai*A)};Je<1&&(e.globalAlpha=1-Je,e.fillStyle=N,e.beginPath(),e.ellipse(0,0,A*3,A*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),Je>0&&(e.globalAlpha=Je,st(-1,-4,2,2),st(1,-3.5,1,1,!0),st(-.5,-2,1,5,!0),st(-2.5,-1,5,.5),st(-2.5,0,5,.5),st(-2.5,1,5,.5),st(-3,-2,-1,2,!0),st(3,-2,1,2),st(-3,2,-1,2,!0),st(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=N;let ee=0,x=0,K=0,Z=[0,0,0,0];switch(l){case"idle":ee=ie*A*.1;break;case"walk":const Je=Math.sin(a*Math.PI*4);ee=Math.abs(Je)*-A*.5,Z=[Je*A,-Je*A,-Je*A,Je*A];break;case"attacking":const st=Math.sin(a*Math.PI*4);x=A*2+st*A,K=A*2,ee=A;break;case"eat":K=A*3+oe*A,ee=A*1.5,e.fillStyle=V,e.fillRect(-A,q-A,A*2,A);break;case"procreate":ee=Math.sin(a*Math.PI*8)*A*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let En=0;En<5;En++){const Qn=(Math.random()-.5)*A*8,Ai=q+(Math.random()-.5)*A*2;oe>.5&&e.fillRect(Qn,Ai,A*.5,A*.5)}break}const B=A*3*M*(m?1.3:1),j=A*5*M,ce=-j/1.5,pe=q-B-A*2.5+ee;e.fillStyle=N,e.beginPath(),e.moveTo(ce-A*.5,pe+B*.5),e.quadraticCurveTo(ce-A*3,pe-A,ce-A*2+ie*A,pe+B+A),e.fill();const Me=A*1.2*M,he=A*3*M,Ee=A*2.5*M,Re=ce+j*.8,de=ce+j*.2;e.fillStyle=k,e.fillRect(de,q-Ee,Me,Ee+Z[2]),e.fillRect(Re,q-he,Me,he+Z[0]),e.fillStyle=N,e.beginPath(),e.moveTo(ce,pe+B),e.lineTo(ce,pe+A),e.quadraticCurveTo(ce+j/2,pe,ce+j,pe+A),e.lineTo(ce+j,pe+B),e.fill(),e.fillStyle=N,e.fillRect(de+A/2,q-Ee,Me,Ee+Z[3]),e.fillRect(Re+A/2,q-he,Me,he+Z[1]);const ve=A*3.5*M,Ge=ce+j-ve*.3+x,Ae=pe-ve*.3+K;e.fillStyle=N,e.beginPath(),e.arc(Ge,Ae,ve/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(Ge+ve*.4,Ae+ve*.2,A*1.5,A,0,0,Math.PI*2),e.fill(),g[1]>=0&&(e.fillStyle=L,e.fillRect(Ge+A*.5,Ae-A*.5,A*.5,A*.5),l==="attacking"&&(e.fillStyle=z,e.fillRect(Ge+ve*.5,Ae+ve*.4,A,A*.4))),e.fillStyle=k,e.beginPath(),e.moveTo(Ge-ve*.4,Ae-ve*.3),e.lineTo(Ge,Ae-ve*.7),e.lineTo(Ge,Ae-ve*.2),e.fill(),e.restore()}};class lc{constructor(t=200){Ne(this,"cache",new Map);Ne(this,"maxSize");this.maxSize=t}getOrRender(t,n,i,s){const a=this.cache.get(t);if(a)return this.cache.delete(t),this.cache.set(t,a),a;const{canvas:l,ctx:c}=kT(n,i);if(s(c),this.cache.size>=this.maxSize){const u=this.cache.keys().next().value;u!==void 0&&this.cache.delete(u)}return this.cache.set(t,l),l}clear(){this.cache.clear()}}const MB=9,NB=new lc(200);function OB(e,t){const{position:n,gender:i,age:s,decayProgress:a,food:l,radius:c,originalEntityType:u,geneCode:f}=t,g=Xr(a,20),m=Math.floor(s),v=`${u}_${i}_${m}_${g}_${c}_${f||0}`,S=Math.ceil(c*2)+4,I=NB.getOrRender(v,S,S,A=>{A.translate(S/2,S/2),u==="human"?Qp.render(A,-S/2+2,-S/2+2,S-4,S-4,g,"dead",i,m,[0,0],!1,0):u==="prey"?LT.render(A,-S/2+2,-S/2+2,S-4,S-4,g,"dead",{gender:i,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}):u==="predator"&&HT.render(A,-S/2+2,-S/2+2,S-4,S-4,g,"dead",{gender:i,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024})});if(e.save(),e.globalAlpha=1-a,e.drawImage(I,n.x-I.width/2,n.y-I.height/2),e.restore(),l.length>0){e.save(),e.font=`${MB}px Arial`,e.textAlign="center",e.textBaseline="middle";const A=Rt*.9,w=Math.PI/kI*3;l.forEach((P,R)=>{const _=R*w,b=n.x+A*Math.cos(_)*Math.atan2(R,R),M=n.y+A*Math.sin(_)*Math.atan2(R,R),D=pp[P.type];e.fillText(D,b,M)}),e.restore()}}function jo(e,t,n,i,s,a,l,c){e.save(),e.fillStyle=l,e.fillRect(t,n,i,s),e.fillStyle=c,e.fillRect(t,n,i*Math.max(0,a),s),e.restore()}function bB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s;let c;l>a||l+(i.length-1)*4>a?c=(a-l)/(i.length-1):c=4,i.length===1&&(c=0);for(let u=0;u<i.length;u++){const f=pp[i[u].type];e.fillText(f,t+u*(s+c),n)}e.restore()}function kB(e,t,n,i,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let l,c=Rt/2;const u=Hu[a.action],f=FA[a.action],g=`${u} ${f}`;if("targetEntityId"in a){const m=t.entities.entities[a.targetEntityId];m&&(l=m.position,c=m.radius)}else"position"in a&&(l=a.position);if(l){BT(e,l,c,Pp,Dp,2,n,i,s,t.mapDimensions),e.save(),e.font=`${la}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:v}=ac(l,n,{width:i,height:s},t.mapDimensions),S=v-c-Bu-la/2;e.fillText(g,m,S),e.restore()}}function BB(e,t,n,i,s){e.save();const a=(Math.sin(s*Np)+1)/2,l=n+Bu+a*5;e.strokeStyle=Pp,e.lineWidth=2,e.setLineDash(Dp),e.beginPath(),e.arc(t.x,t.y,l,0,Math.PI*2),e.stroke(),e.setLineDash([]);const c=Hu[i],u=FA[i];if(c){e.font=`${la*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const f=t.y-l-25;e.fillText(c,t.x,f),e.font=`${la*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,f+25)}e.restore()}function FB(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(At(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const l=t.entities.entities[n.targetEntityId];l&&(s=l.position,a=l.radius||(l.type==="building"?20:30))}if(s){const l=(c,u)=>{BB(c,u.position,a,n.action,t.time)};ai(e,t.mapDimensions.width,t.mapDimensions.height,l,{position:{...s}},s,a+30)}}}function Ev(e,t,n,i,s,a,l=!0){const c=t.split(" ");let u="";const f=[];for(let g=0;g<c.length;g++){const m=u+c[g]+" ";e.measureText(m).width>s&&g>0?(f.push(u),u=c[g]+" "):u=m}if(f.push(u),l)for(let g=0;g<f.length;g++)e.fillText(f[g],n,i+g*a);return f.length*a}function LB(e){return 1-Math.pow(1-e,3)}function HB(e,t,n,i){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(l=>!l.isDismissed);if(s.length===0)return;e.save();let a=i-TP;for(const l of s){const c=n-Ed-Ir;e.font=`${Jh}px "Press Start 2P", Arial`;const u=c+Ir,f=Ed-Ir*2,g=Ev(e,l.message,-9999,-9999,f,Jh*1.2,!1),m=Ir*2+g+Pi,v=a-m,S=Date.now()-l.creationTime,I=Math.min(S/AP,1),A=LB(I),w=i,P=w+(v-w)*A;e.fillStyle=pP,e.beginPath(),e.roundRect(c,P,Ed,m,gP),e.fill(),e.fillStyle=mP,e.textBaseline="top",Ev(e,l.message,u,P+Ir,f,Jh*1.2,!0);const R=P+m-Pi-Ir/2,_=c+Ed-Pi-Ir/2,b={x:_,y:R,width:Pi,height:Pi};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[l.id]=b);const M=t.hoveredButtonId===`notification-dismiss-${l.id}`;if(e.fillStyle=M?$S:yP,e.font=`${Pi}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",b.x+b.width/2,b.y+b.height/2),l.targetEntityIds||l.targetPosition||l.targetArea||l.targetRadius){const k={x:_-Pi-GS,y:R,width:Pi,height:Pi};t.notificationButtonRects&&(t.notificationButtonRects.view[l.id]=k);const L=t.hoveredButtonId===`notification-view-${l.id}`;e.fillStyle=L?$S:SP,e.font=`${Pi*(L?1.5:1.2)}px Arial`,e.fillText("",k.x+k.width/2,k.y+k.height/2)}a-=m+GS}e.restore()}function UB(e){return e.length===0?0:e.reduce((n,i)=>n+i,0)/e.length}function Ig(e,t,n,i,s,a,l,c){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(i,s,a,l),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(i,s,a,l);const u=UB(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,i+tt,s+tt+8);const f=Math.max(...n,1),g=n.map(m=>m/f*l);if(e.beginPath(),e.strokeStyle=c,e.lineWidth=2,g.length>1){e.moveTo(i,s+l-g[0]);for(let m=1;m<g.length;m++){const v=i+m/(g.length-1)*a,S=s+l-g[m];e.lineTo(v,S)}}else if(g.length===1){const m=s+l-g[0];e.moveTo(i,m),e.lineTo(i+a,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${f.toFixed(2)}ms`,i+a-tt,s+tt+8),e.restore()}function GB(e,t,n){const{performanceMetrics:i}=t;if(!i)return;const s=280,a=240,l=n-s-tt,c=tt+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(l,c,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(l,c,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=c+tt+5;const f=l+tt;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",f,u),u+=25,e.fillStyle="white",e.font="12px monospace";const g=$B(t);e.fillText(`FPS: ${g.toFixed(1)}`,f,u),u+=20;const m=s-tt*2,v=45,S=10;Ig(e,"Render",Ag(t,"renderTime"),f,u,m,v,"#4CAF50"),u+=v+S,Ig(e,"World Update",Ag(t,"worldUpdateTime"),f,u,m,v,"#2196F3"),u+=v+S,Ig(e,"AI Update",Ag(t,"aiUpdateTime"),f,u,m,v,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",l+s/2,c+a-10),e.restore()}function $B(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(_t/Nt);return t.history.filter(a=>n-a.bucketTime/(_t/Nt)<1).length}function WB(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const l=Math.floor(a.bucketTime/(_t/Nt));n.set(l,(n.get(l)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function Ag(e,t){return WB(e.performanceMetrics.history,t)}function xB(e,t,n,i){const{debugCharacterId:s,time:a}=t,l=500,c=Math.min(i*.9,800),u=n-l-10,f=tt+it*2;t.debugPanelRect={x:u,y:f,width:l,height:c},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(u,f,l,c),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(u,f,l,c),e.fillStyle="white",e.font="12px monospace",e.textAlign="left",e.textBaseline="top";let g=f+20;const m=u+15;if(e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Behavior Tree Debugger",m,g),g+=25,!s){e.fillStyle="#888",e.font="12px monospace",e.fillText("No character selected for debugging.",m,g),e.fillText("Click on a character to inspect behavior.",m,g+20),e.restore();return}const v=t.entities.entities[s];if(!v){e.fillStyle="#ff4444",e.font="12px monospace",e.fillText(`Character #${s} not found (might be dead).`,m,g),e.restore();return}if(!v.aiBlackboard){e.fillStyle="#ffaa44",e.font="12px monospace",e.fillText(`Character #${s} has no AI Blackboard.`,m,g),e.restore();return}e.fillStyle="white",e.font="12px monospace",e.fillText(`Character: ${v.type} #${v.id} (${v.age.toFixed(1)}y)`,m,g),g+=20,YB(e,v,a,m,g,l-30,c-(g-f)-10,t),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '~' to toggle this debugger",u+l/2,f+c-10),e.restore()}function YB(e,t,n,i,s,a,l,c){var P,R;const u=t.aiBlackboard.nodeExecutionData,f=t.type==="human"?IT:t.type==="predator"?TT:t.type==="prey"?AT:null;if(!f)return;const g=((P=c.debugPanelScroll)==null?void 0:P.x)??0,m=((R=c.debugPanelScroll)==null?void 0:R.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-g,-m),e.font=`${X1}px Arial`,e.textAlign="left",e.textBaseline="top";const v=_=>{switch(_){case E.SUCCESS:return K1;case E.FAILURE:return q1;case E.RUNNING:return Z1;case E.NOT_EVALUATED:case null:default:return Q1}};let S=0;const I=(_,b)=>{if(!_.name||!u[_.name])return b;let M=b;const D=M+Zh>s+m&&M<s+l+m,N=u[_.name],k=i+(_.depth??0)*V1;let L=E.NOT_EVALUATED,z=FS,V="";if(N){L=N.status,V=N.debugInfo;const ee=eP/Nt*_t,x=n-N.lastExecuted,K=Math.max(0,1-x/ee);z=ow(FS,J1,K),x>ra&&(L=E.NOT_EVALUATED)}const X=v(L),Q=` ${_.name}`+(V?`: ${V}`:""),q=e.measureText(Q).width,ie=sl+LS,oe=k-i+8+q+ie;if(oe>S&&(S=oe),D&&(e.fillStyle=X,e.fillText("",k,M),e.fillStyle=z,e.fillText(Q,k+8,M),N&&N.executionHistory.length>0)){const{executionHistory:ee}=N,x=vA/Nt*_t,K=n,Z=K-x,B=i+a-sl-LS;let j=B;const ce=M+(Zh-Td)/2,pe=ee.filter(Ae=>Ae.time<Z);let Me=pe.length>0?pe[pe.length-1].status:null,he=Z;const Ee=ee.filter(Ae=>Ae.time>=Z&&Ae.time<=K),Re=sl/x;e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(B,ce,sl,Td);for(const Ae of Ee){const Je=(Ae.time-he)*Re;Je>0&&(e.fillStyle=v(Me),e.fillRect(j,ce,Je,Td),j+=Je),Me=Ae.status,he=Ae.time}n-he>ra&&(Me=E.NOT_EVALUATED);const ve=(K-he)*Re;e.fillStyle=v(Me);const Ge=B+sl-j;e.fillRect(j,ce,Math.min(ve,Ge),Td)}if(M+=Zh,_.children)for(const ee of _.children)M=I(ee,M);else _.child&&(M=I(_.child,M));return M},w=I(f,s)-s;c.debugPanelContentSize={width:S,height:w},e.restore()}function Su(e,t,n,i,s,a,l){e.save();const{position:c}=t;e.strokeStyle=i,e.lineWidth=s+Math.sin(l*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(c.x,c.y,n,0,2*Math.PI),e.stroke(),e.restore()}function zB(e,t,n,i){if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;const a=Wt(s,t);if(!a||!a.aiBlackboard)return;const l=ir(a.aiBlackboard),c=500,u=Math.min(i*.9,700),f=n-c-10,g=tt+it*2;t.debugPanelRect={x:f,y:g,width:c,height:u},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(f,g,c,u),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(f,g,c,u),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";const m=14,v=f+15;let S=g+20;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Supply Chain Debugger",v,S),S+=25,e.fillStyle="#aaaaaa",e.font="11px monospace",e.fillText(`Tribe Leader: ${a.isPlayer?"Player":"#"+a.id}`,v,S),S+=m,e.fillText(`Current Time: ${t.time.toFixed(1)}h`,v,S),S+=20;const I=S,A=u-(I-g)-30;jB(e,t,l,v,I,c-30,A,m),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+4' to toggle this debugger",f+c/2,g+u-10),e.restore()}function jB(e,t,n,i,s,a,l,c){var I,A;const u=((I=t.debugPanelScroll)==null?void 0:I.x)??0,f=((A=t.debugPanelScroll)==null?void 0:A.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-u,-f);let g=s;e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(` Active Demands (${n.length})`,i,g),g+=18,n.length===0?(e.fillStyle="#888888",e.font="11px monospace",e.fillText("No active demands",i,g),g+=c):[...n].sort((P,R)=>R.updatedAt-P.updatedAt).forEach((P,R)=>{const _=t.entities.entities[P.requesterId];let b=_?_.isPlayer?"Player":`Human #${_.id}`:`Unknown #${P.requesterId}`;_&&(b+=` (Food: ${_.food.length}), Active action: ${_.activeAction||"idle"}`);let M="None";if(P.claimedBy){const L=t.entities.entities[P.claimedBy];M=L?L.isPlayer?"Player":`Human #${L.id}`:`Unknown #${P.claimedBy}`,L&&(M+=" (Food: "+L.food.length+"), Active action: "+(L.activeAction||"idle")+")")}const D=t.time-P.updatedAt,N=g,k=c*5+10;e.fillStyle=P.claimedBy?"rgba(50, 100, 50, 0.3)":"rgba(50, 50, 50, 0.3)",e.fillRect(i-5,N-2,a,k),e.strokeStyle=P.claimedBy?"#44ff44":"#666666",e.lineWidth=1,e.strokeRect(i-5,N-2,a,k),e.fillStyle="#ffaa00",e.font="bold 12px monospace",e.fillText(`#${R+1}`,i,g),g+=c,e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Requester: ${b}`,i+10,g),g+=c,e.fillStyle="#ffff88",e.fillText(`Resource: ${P.resourceType}`,i+10,g),g+=c,e.fillStyle=P.claimedBy?"#44ff44":"#ff8844",e.fillText(`Status: ${P.claimedBy?"Claimed":"Pending"}`,i+10,g),g+=c,P.claimedBy?(e.fillStyle="#aaffaa",e.fillText(`Mover: ${M}`,i+10,g)):(e.fillStyle="#888888",e.fillText(`Mover: ${M}`,i+10,g)),g+=c,e.fillStyle="#aaaaaa",e.font="10px monospace",e.fillText(`Updated: ${D.toFixed(1)}h ago`,i+10,g),g+=c+5}),g+=10,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Statistics",i,g),g+=18;const m=n.filter(w=>!w.claimedBy).length,v=n.filter(w=>w.claimedBy).length;e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Total Demands: ${n.length}`,i,g),g+=c,e.fillStyle="#ff8844",e.fillText(`Pending: ${m}`,i,g),g+=c,e.fillStyle="#44ff44",e.fillText(`Claimed: ${v}`,i,g),g+=c;const S=g-s;t.debugPanelContentSize={width:a,height:S},e.restore()}function XB(e,t,n){if(!n.debugCharacterId)return;const i=n.search.human.byProperty("id",n.debugCharacterId)[0];if(!i)return;const s=Wt(i,n);if(!s||!s.aiBlackboard||s.id!==t.leaderId)return;ir(s.aiBlackboard).some(l=>l.requesterId===t.id)&&Su(e,t,t.radius+15,"#ff6644",3,2,n.time),t.tribeRole===se.Mover&&Su(e,t,t.radius+15,"#44ff44",3,2,n.time)}const VB={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"},KB=new lc(1e4);function qB(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?Rt+20:Rt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,i.x,i.y-l+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function ZB(e,t,n,i,s){e.save(),e.font=`${Rl}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(i?Rt:ha)-Rl-s),e.restore()}function QB(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function JB(e,t,n){var c;const{position:i,radius:s}=t,a=i.x-qh/2,l=i.y-s-$1;if(t.stateMachine[0]===Qo){const u=t.stateMachine[1],f=n-u.attackStartTime,g=Math.min(f/Nu,1);jo(e,a,l,qh,OS,g,xo,W1)}else if((c=t.attackCooldown)!=null&&c.melee&&t.attackCooldown.melee>0){const u=1-t.attackCooldown.melee/Ou;jo(e,a,l,qh,OS,u,xo,x1)}}function eF(e,t,n=!1,i=!1,s=!1,a=!1,l=!1,c=!1,u=!1,f){var k,L;const{position:g,activeAction:m="idle"}=t,v=t.isAdult?Rt:Rt*.6,S=VB[m]||"idle",I=Xr(t.animationProgress||0,12),A=qp(t.direction,8),w=Math.floor(t.age),P=Xr(t.hunger/100,5)*100,R=`${S}_${t.gender}_${w}_${A}_${I}_${t.isPregnant??!1}_${P}_${v}`,_=Math.ceil(v*2)+4,b=KB.getOrRender(R,_,_,z=>{z.translate(_/2,_/2);const V=Zp(A,8);Qp.render(z,-_/2+2,-_/2+2,_-4,_-4,I,S,t.gender,w,V,t.isPregnant??!1,P)});e.drawImage(b,g.x-b.width/2,g.y-b.height/2),c&&(e.save(),e.strokeStyle=E1,e.lineWidth=2,e.beginPath(),e.arc(g.x,g.y,v+3,0,2*Math.PI),e.stroke(),e.restore());let M,D;if(l?(M=w1,D=uA):n?(M=C1,D=lA):s?(M=_1,D=T1):i?(M=R1,D=cA):a&&(M=P1,D=dA),M&&D&&QB(e,g,v,M,D),(k=t.tribeInfo)!=null&&k.tribeBadge&&ZB(e,g,t.tribeInfo.tribeBadge,t.isAdult??!1,M??0),t.heldItem){const z=Op[t.heldItem.type],V=(L=t.tribeInfo)!=null&&L.tribeBadge?Rl:0;e.save(),e.font=`${Rl}px Arial`,e.textAlign="center",e.textBaseline="middle";const X=g.y-(t.isAdult?Rt:ha)-Rl-(M??0)-V;e.fillText(z,g.x,X),e.restore()}const N=u&&(f.debugCharacterId===void 0||t.id===f.debugCharacterId);JB(e,t,f.time),N&&qB(e,t),f.debugPanel===Xe.SupplyChain&&XB(e,t,f)}const tF={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},nF=new lc(200);function iF(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?Rt+20:Rt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function oF(e,t,n=!1,i){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,c=tF[a]||"idle",u=Xr(t.animationProgress||0,12),f=qp(t.direction||{x:1,y:0},8),g=Math.floor(t.age),m=Xr(t.hunger/100,5)*100,v=`${c}_${g}_${f}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,S=Math.ceil(l*2)+4,I=nF.getOrRender(v,S,S,w=>{w.translate(S/2,S/2);const P=Zp(f,8);LT.render(w,-S/2+2,-S/2+2,S-4,S-4,u,c,{gender:t.gender,age:g,direction:P,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(I,s.x-I.width/2,s.y-I.height/2),t.hitpoints<t.maxHitpoints){const w=l*1.5,P=3,R=s.x-w/2,_=s.y-l-8;e.fillStyle="#555",e.fillRect(R,_,w,P);const b=t.hitpoints/t.maxHitpoints;e.fillStyle=b>.5?"#4CAF50":b>.25?"#FFC107":"#F44336",e.fillRect(R,_,w*b,P)}n&&(i===void 0||t.id===i)&&iF(e,t)}const rF={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},sF=new lc(200);function aF(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?Rt+20:Rt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function lF(e,t,n=!1,i){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,c=rF[a]||"idle",u=Xr(t.animationProgress||0,12),f=qp(t.direction||{x:1,y:0},8),g=Math.floor(t.age),m=Xr(t.hunger/100,5)*100,v=`${c}_${g}_${f}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,S=Math.ceil(l*2)+4,I=sF.getOrRender(v,S,S,w=>{w.translate(S/2,S/2);const P=Zp(f,8);HT.render(w,-S/2+2,-S/2+2,S-4,S-4,u,c,{gender:t.gender,age:g,direction:P,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(I,s.x-I.width/2,s.y-I.height/2),t.hitpoints<t.maxHitpoints){const w=l*1.5,P=3,R=s.x-w/2,_=s.y-l-8;e.fillStyle="#555",e.fillRect(R,_,w,P);const b=t.hitpoints/t.maxHitpoints;e.fillStyle=b>.5?"#4CAF50":b>.25?"#FFC107":"#F44336",e.fillRect(R,_,w*b,P)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,l+3,0,2*Math.PI),e.stroke()),n&&(i===void 0||t.id===i)&&aF(e,t)}const UT=15;function cF(e,t,n,i,s=1.5){const a=n-t.startTime,l=Math.min(a/t.duration,1),c=1-l,f=1+Math.sin(l*Math.PI*2)*(s-1),g=UT*f;e.save(),e.globalAlpha=c,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,g),0,Math.PI*2),e.fillStyle=i,e.fill(),e.restore()}function ul(e,t,n,i,s=2){const a=n-t.startTime,l=Math.min(a/t.duration,1),c=1-l,u=UT*2*l;e.save(),e.globalAlpha=c,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=i,e.lineWidth=s,e.stroke(),e.restore()}function Ki(e,t,n,i){const s=n-t.startTime,a=Math.min(s/t.duration,1),l=1-a,c=-20*a;e.save(),e.globalAlpha=l,e.font="20px Arial",e.textAlign="center",e.fillText(i,t.position.x,t.position.y+c),e.restore()}function dF(e,t,n,i){const{width:s,height:a}=i.mapDimensions;let l=t.targetPosition;if(t.targetEntityId){const A=i.entities.entities[t.targetEntityId];A&&(l=A.position)}if(!l)return;const c=n-t.startTime,u=Math.min(c/t.duration,1);let f=l.x-t.position.x,g=l.y-t.position.y;f=f-Math.round(f/s)*s,g=g-Math.round(g/a)*a;const m={x:f,y:g},v=t.position.x+m.x*u,S=t.position.y+m.y*u,I=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(v,S,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(v,S+I),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function GT(e,t,n,i){switch(t.type){case _e.Procreation:Ki(e,t,n,"");break;case _e.Pregnant:cF(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case _e.TargetAcquired:ul(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case _e.Attack:Ki(e,t,n,"");break;case _e.Partnered:Ki(e,t,n,"");break;case _e.BushClaimed:ul(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case _e.BushClaimLost:ul(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case _e.Eating:Ki(e,t,n,"");break;case _e.ChildFed:Ki(e,t,n,"");break;case _e.AttackDeflected:Ki(e,t,n,"");break;case _e.AttackResisted:Ki(e,t,n,"");break;case _e.Hit:Ki(e,t,n,"");break;case _e.SeizeBuildup:ul(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case _e.BorderClaim:Ki(e,t,n,"");break;case _e.Seize:ul(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case _e.StoneProjectile:dF(e,t,n,i);break}}const Cv=8,uF=1.5,fF=.5,wv=2,hF="#5a5a5a",gF="#7e7e7e",pF="#8B0000",mF="#FF4444",yF=6,SF=new lc(1e3),_v=20;function vF(e,t,n=!1,i=!0){if(n)return`ghost_${e.buildingType}_${i}`;const s=e,a=s.buildingType===fe.Bonfire&&(s.fuelLevel??0)>0;return`${s.id}_${s.buildingType}_${s.width}_${s.height}_${t}_${s.isConstructed}_${a}`}function $T(e,t,n=!1,i=!0){const s=vF(e,t,n,i),{width:a,height:l,id:c,buildingType:u}=e,f=a+_v*2,g=l+_v*2;return SF.getOrRender(s,f,g,m=>{const v=tr[u],S="isConstructed"in e?e.isConstructed:!0;if(m.translate(f/2,g/2),n){const I=i?"#4CAF50":"#F44336";Tg(m,a,l,9999,I),m.font=`${Math.min(a,l)*.5}px Arial`,m.textAlign="center",m.textBaseline="middle",m.fillStyle=I,m.fillText(v.icon,0,0)}else{const I=e;let A=v.icon;I.buildingType===fe.Bonfire&&S&&(A=(I.fuelLevel??0)>0?"":""),t?Tg(m,a,l,c,pF,mF):Tg(m,a,l,c),m.globalAlpha=.5,m.font=`${Math.min(a,l,30)*.5}px Arial`,m.textAlign="center",m.textBaseline="middle",m.shadowColor="rgba(0,0,0,0.5)",m.shadowBlur=4,m.fillStyle="#FFFFFF",m.fillText(A,0,0)}})}function Tg(e,t,n,i,s,a){const l=(t+n)*2,c=Math.floor(l/Cv),u=-t/2,f=t/2,g=-n/2,m=n/2;for(let v=0;v<c;v++){const S=i+v*13,I=qs(S),A=qs(S+1);let w=v*Cv,P=0,R=0;w<t?(P=u+w,R=g):w<t+n?(P=f,R=g+(w-t)):w<t*2+n?(P=f-(w-(t+n)),R=m):(P=u,R=m-(w-(t*2+n)));const _=(A-.5)*wv,b=(qs(S+2)-.5)*wv;e.beginPath();const M=uF+I*fF;s?e.fillStyle=s:e.fillStyle=I>.5?a||gF:s||hF,e.ellipse(P+_,R+b,M,M*.85,A*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function IF(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:i}=t;e.save(),e.font=`${yF}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,i.forEach(s=>{const a=s.item.type,l=(pp[a]||Op[a])??"?",c={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(l,c.x,c.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function AF(e,t,n){const{position:i,width:s,height:a,constructionProgress:l,destructionProgress:c,isConstructed:u,isBeingDestroyed:f}=t,g=At(n),m=!!(g&&Vt(g,t,n)),v=$T(t,m);e.save(),u||(e.globalAlpha=.3+l*.7),e.drawImage(v,i.x-v.width/2,i.y-v.height/2),e.restore();const S=s,I=i.x-S/2,A=i.y+a/2+dw;u?f&&jo(e,I,A,S,tS,1-c,xo,cw):jo(e,I,A,S,tS,l,xo,lw),(t.buildingType===fe.StorageSpot||t.buildingType===fe.Bonfire)&&u&&IF(e,t)}function TF(e,t,n,i,s){const a=tr[n],{width:l,height:c}=a.dimensions,u=$T({buildingType:n,width:l,height:c,id:9999},!1,!0,i),f=(m,v)=>{m.save(),m.globalAlpha=aw,m.drawImage(u,v.x-u.width/2,v.y-u.height/2),m.restore()},g={position:{...t},radius:Math.max(l,c)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:T.create()};ai(e,s.width,s.height,(m,v)=>f(m,v.position),g)}const Bs=1,EF=20,yi=4,Rv=8,CF="rgba(34, 85, 34, 0.25)",wF="rgba(139, 50, 50, 0.25)",Zs=new Map,_F=50;function RF(e,t){return e.map(n=>n.id).sort((n,i)=>n-i).join(",")+`_${t}`}function PF(){if(Zs.size>_F){const e=Zs.keys().next().value;e&&Zs.delete(e)}}function DF(e){const t=new Map;for(const n of e){const i=n.ownerId;i&&(t.has(i)||t.set(i,[]),t.get(i).push(n))}return t}function MF(e,t,n,i){let s=0;const a=Math.max(i.width,i.height)/2;for(const l of n){const c=e-l.position.x,u=t-l.position.y,f=c*c+u*u;f>0?s+=a*a/f:s+=100}return s}function NF(e,t,n){let i=1/0,s=1/0,a=-1/0,l=-1/0;for(const c of e)i=Math.min(i,c.position.x-t.width/2),s=Math.min(s,c.position.y-t.height/2),a=Math.max(a,c.position.x+t.width/2),l=Math.max(l,c.position.y+t.height/2);return{minX:i-n,minY:s-n,maxX:a+n,maxY:l+n}}function OF(e,t,n,i){const s=RF(e,i);if(Zs.has(s))return Zs.get(s);const a=n.maxX-n.minX,l=n.maxY-n.minY,c=Math.ceil(a/yi),u=Math.ceil(l/yi),f=[],g=[];for(let S=0;S<u;S++)f[S]=new Array(c);for(let S=0;S<u;S++)for(let I=0;I<c;I++){const A=n.minX+I*yi,w=n.minY+S*yi,P=MF(A,w,e,t);f[S][I]=P}for(let S=1;S<u-1;S++)for(let I=1;I<c-1;I++)if(f[S][I]>=Bs&&(f[S-1][I]<Bs||f[S+1][I]<Bs||f[S][I-1]<Bs||f[S][I+1]<Bs)){const w=n.minX+I*yi,P=n.minY+S*yi;g.push({x:w,y:P})}const m=BF(g),v={fieldValues:f,edgePoints:g,regions:m,bounds:n};return Zs.set(s,v),PF(),v}function bF(e,t,n,i,s,a){if(t.length===0)return;const{bounds:l}=a,c=10;if(!a.canvas){const u=l.maxX-l.minX+c*2,f=l.maxY-l.minY+c*2,{canvas:g,ctx:m}=kT(u,f);m.translate(-l.minX+c,-l.minY+c);const{fieldValues:v,regions:S}=a;kF(m,v,l,i);let I=s;for(const A of S){const w=FF(A);LF(m,w,i,I),I+=1e3}a.canvas=g}e.save(),e.globalAlpha=1,e.drawImage(a.canvas,l.minX-c,l.minY-c),e.restore()}function kF(e,t,n,i){const s=i?wF:CF;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++)if(t[a][l]>=Bs){const c=n.minX+l*yi,u=n.minY+a*yi;e.rect(c,u,yi,yi)}e.fill(),e.restore()}function BF(e){if(e.length===0)return[];const t=yi*2,n=t,i=new Map;function s(f,g){const m=Math.floor(f/n),v=Math.floor(g/n);return`${m},${v}`}for(let f=0;f<e.length;f++){const g=s(e[f].x,e[f].y);i.has(g)||i.set(g,[]),i.get(g).push(f)}function a(f,g){const m=[],v=Math.floor(f/n),S=Math.floor(g/n);for(let I=-1;I<=1;I++)for(let A=-1;A<=1;A++){const w=`${v+I},${S+A}`,P=i.get(w);P&&m.push(...P)}return m}const l=new Set,c=[],u=t*t;for(let f=0;f<e.length;f++){if(l.has(f))continue;const g=[],m=[f];for(;m.length>0;){const v=m.shift();if(l.has(v))continue;l.add(v),g.push(e[v]);const S=a(e[v].x,e[v].y);for(const I of S){if(l.has(I))continue;const A=e[I].x-e[v].x,w=e[I].y-e[v].y;A*A+w*w<=u&&m.push(I)}}g.length>0&&c.push(g)}return c}function FF(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const i=t[t.length-1];let s=0,a=1/0;for(let l=0;l<n.length;l++){const c=n[l].x-i.x,u=n[l].y-i.y,f=c*c+u*u;f<a&&(a=f,s=l)}t.push(n.splice(s,1)[0])}return t}function LF(e,t,n,i){if(t.length===0)return;let s=0,a=0;for(let l=1;l<t.length;l++){const c=t[l-1],u=t[l],f=u.x-c.x,g=u.y-c.y,m=Math.sqrt(f*f+g*g);for(s+=m;s>=Rv;){s-=Rv;const v=1-s/m,S=c.x+f*v,I=c.y+g*v;HF(e,S,I,n,i+a*13),a++}}}function HF(e,t,n,i,s){const a=qs(s),l=qs(s+1),c=(l-.5)*2,u=(qs(s+2)-.5)*2;e.beginPath();const f=1.5+a*.5;i?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+c,n+u,f,f*.85,l*Math.PI,0,Math.PI*2),e.fill(),i||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function UF(e,t,n,i){var m,v,S;const s=t;if(!((m=s.search)!=null&&m.building))return;const l=s.search.building.all().filter(I=>I.buildingType===fe.PlantingZone&&I.isConstructed);if(l.length===0)return;const c=l.filter(I=>Bl(I,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(c.length===0)return;const u=tr[fe.PlantingZone].dimensions,f=DF(c),g=i?t.entities.entities[i]:void 0;for(const[I,A]of f){const w=((S=(v=g==null?void 0:g.tribeControl)==null?void 0:v.diplomacy)==null?void 0:S[I])==="Hostile",P=typeof I=="number"?I:0,R=NF(A,u,EF),_=OF(A,u,R,w);bF(e,A,u,w,P,_)}}const GF=.001,$F=.05,WF=12;function xF(e,t,n){const{position:i,age:s,swayOffset:a}=t,[l]=t.stateMachine??[],c=Math.min(1,Math.max(.4,s/Jo)),f=l!==Gt&&l!==uo?Math.sin(n*GF+a)*$F:0;if(e.save(),e.translate(i.x,i.y),e.scale(c,c),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=FM,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),l===uo?Eg(e,10,8):l===Gt?(e.rotate(Math.PI/2),Eg(e,10,30),e.translate(0,-25),Pv(e,40,20,40,15)):(e.rotate(f),Eg(e,10,30),e.translate(0,-25),e.rotate(f*.5),Pv(e,40,20,40,15)),e.restore(),(l===Gt||l===uo)&&t.wood&&t.wood.length>0){e.save(),e.font=`${WF}px Arial`,e.textAlign="center",e.textBaseline="middle";const g=t.radius*1.1,m=Math.PI*2/(Wu-1);t.wood.forEach((v,S)=>{const I=S===0?0:g,A=S===0?0:(S-1)*m,w=i.x+I*Math.cos(A),P=i.y+I*Math.sin(A),R=Op[v.type];e.fillText(R,w,P)}),e.restore()}}function Eg(e,t,n){e.fillStyle=NM,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=OM,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function Pv(e,t,n,i,s){e.fillStyle=bM,Dv(e,t+4,n+4,i+2,s+2),e.translate(0,-2),e.fillStyle=kM,Dv(e,t,n,i,s),e.fillStyle=BM,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function Dv(e,t,n,i,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-i),e.lineTo(0,-i-s),e.lineTo(n/2,-i),e.lineTo(t/2,0),e.closePath(),e.fill()}const Fd=200;let Lo=null;function YF(e,t,n,i,s){const a=VM(t.time);if(a<=0)return;Lo||(Lo=document.createElement("canvas")),(Lo.width!==i.width||Lo.height!==i.height)&&(Lo.width=i.width,Lo.height=i.height);const l=Lo.getContext("2d");if(l){l.clearRect(0,0,i.width,i.height),l.fillStyle=`rgba(0, 0, 40, ${a*.85})`,l.fillRect(0,0,i.width,i.height),l.globalCompositeOperation="destination-out";for(const c of s){const u=ac(c.position,n,i,t.mapDimensions),f=l.createRadialGradient(u.x,u.y,0,u.x,u.y,c.radius);f.addColorStop(0,`rgba(255, 255, 255, ${c.intensity})`),f.addColorStop(1,"rgba(255, 255, 255, 0)"),l.fillStyle=f,l.beginPath(),l.arc(u.x,u.y,c.radius,0,Math.PI*2),l.fill()}l.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(Lo,0,0),e.restore()}}function Mv(e,t,n,i,s,a,l){for(let c=-s.height;c<=s.height;c+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const f={x:t.x+u,y:t.y+c};Bl({position:f,radius:n},a,l,s)&&e.push({position:f,radius:n,intensity:i})}}function zF(e,t,n,i,s,a=[]){const l=At(t),c=l?On(t,l):[],u=zr(c),{width:f,height:g}=t.mapDimensions,m=[];a.forEach(P=>{m.push({position:P,radius:30,intensity:.3})}),UF(e,t,i,l==null?void 0:l.leaderId);const v=t,S={left:i.x-s.width/2-Fd,top:i.y-s.height/2-Fd,right:i.x+s.width/2+Fd,bottom:i.y+s.height/2+Fd};[...v.search.human.byRect(S),...v.search.building.byRect(S),...v.search.berryBush.byRect(S),...v.search.tree.byRect(S),...v.search.corpse.byRect(S),...v.search.prey.byRect(S),...v.search.predator.byRect(S)].sort((P,R)=>n&&P.id===t.debugCharacterId&&P.id!==R.id||P.type==="building"&&R.type!=="building"||P.position.y<R.position.y?-1:P.position.y>R.position.y?1:P.id-R.id).forEach(P=>{var R,_;if(P.type==="building"){const b=P;if(b.isConstructed){const M=b.buildingType===fe.Bonfire&&(b.fuelLevel??0)>0,D=M?180:60,N=M?.9:.4;Mv(m,b.position,D,N,t.mapDimensions,i,s)}if(b.buildingType===fe.PlantingZone&&b.isConstructed)return;ai(e,f,g,AF,b,t,l,t.time)}else if(P.type==="berryBush")ai(e,f,g,_B,P,t,l,t.time);else if(P.type==="tree")ai(e,f,g,xF,P,t.time);else if(P.type==="human"){const b=P,M=b.id===(l==null?void 0:l.id),D=c.some(V=>V.id===b.id),N=b.id===(u==null?void 0:u.id),k=l&&(b.id===l.motherId||b.id===l.fatherId),L=l&&(((R=b.partnerIds)==null?void 0:R.includes(l.id))||((_=l.partnerIds)==null?void 0:_.includes(b.id))),z=(l==null?void 0:l.attackTargetId)===b.id;Mv(m,b.position,40,.3,t.mapDimensions,i,s),ai(e,f,g,eF,b,M,k,D,L,N,z,n,t)}else P.type==="corpse"?ai(e,f,g,OB,P):P.type==="prey"?ai(e,f,g,oF,P,n,t.time,t.debugCharacterId):P.type==="predator"&&ai(e,f,g,lF,P,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(P=>Bl(P,i,s,t.mapDimensions)).forEach(P=>{ai(e,f,g,GT,P,t.time,t)});const w=t.notifications.filter(P=>!P.isDismissed);for(const P of w)if(P.highlightedEntityIds&&P.renderHighlights)for(const R of P.highlightedEntityIds){const _=t.entities.entities[R];_&&Bl(_,i,s,t.mapDimensions)&&ai(e,f,g,Su,_,EP,CP,_P,wP,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const P of t.tutorialState.highlightedEntityIds){const R=t.entities.entities[P];R&&Bl(R,i,s,t.mapDimensions)&&ai(e,f,g,Su,R,dP,IA,AA,Np,t.time)}YF(e,t,i,s,m)}function jF(e,t,n,i,s,a){let l=null,c=null;e.textAlign="left";let u=tt+it;const g=t.time/(_t/Nt)/Ru%1,m=al[Os.Time],v=25,S=tt+v;e.fillText(m,tt,u+Un/2+it/3),jo(e,S,u,ko,Un,g,xo,B1),u+=Un+Vi;const I=u+Ji/2,A=u+(Ji-Un)/2,w=5;Zl(e,{x:tt*2,y:I},Ji,5,n.gender,!1,!1,!1);const P=tt+Ji+w,R=ko+v-(Ji+w)*2;jo(e,P,A,R,Un,Math.floor(n.age)/$l,xo,k1),Zl(e,{x:P+R+w+Ji/2,y:I},Ji,$l,n.gender,!1,!1,!1),u+=Un+Vi*2;const _=[],b=new Set;if(_.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),b.add(n.id),i&&!b.has(i.id)&&(_.push({member:i,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),b.add(i.id)),s.forEach(q=>{b.has(q.id)||(_.push({member:q,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),b.add(q.id))}),a.forEach(q=>{b.has(q.id)||(_.push({member:q,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),b.add(q.id))}),n.motherId&&!b.has(n.motherId)){const q=t.entities.entities[n.motherId];q&&(_.push({member:q,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),b.add(q.id))}if(n.fatherId&&!b.has(n.fatherId)){const q=t.entities.entities[n.fatherId];q&&(_.push({member:q,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),b.add(q.id))}const M=al[Os.Family],D=10,N=tt+it+D,k=ko+v-(it+D),L=u+Ad/2;e.font=`${it}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(M,tt,L);const z=u+Ad/2;IB(e,N,z,_,Ad,k),u+=Ad+Vi,e.textBaseline="alphabetic";const V=al[Os.Hitpoints];e.fillText(V,tt,u+Un/2+it/3),jo(e,S,u,ko,Un,n.hitpoints/n.maxHitpoints,xo,b1),u+=Un+Vi;const X=al[Os.Hunger];e.fillText(X,tt,u+Un/2+it/3),jo(e,S,u,ko,Un,(sn-n.hunger)/sn,xo,O1),l={x:tt,y:u-Vi/2,width:ko+v,height:Un+Vi},u+=Un+Vi,e.textBaseline="middle";const Q=al[Os.Food];return e.fillText(Q,tt,u+Id/2),bB(e,S,u+Id/2,n.food,Id,ko),c={x:tt,y:u-Vi/5,width:ko+v,height:Id+Vi},e.textBaseline="alphabetic",{hungerBarRect:l,foodBarRect:c}}let fl=[],Nv=0;const XF=36,VF=200;function KF(e,t,n,i){const s=t.search.prey.count(),a=t.search.predator.count(),l=t.search.berryBush.count();t.time-Nv>=XF&&(fl.push({time:t.time,prey:s,predators:a,bushes:l}),fl.length>VF&&(fl=fl.slice(-200)),Nv=t.time);const c=Ze*Qe,u=s/c*1e6,f=a/c*1e6,g=l/c*1e6,m=Qk(),v=Math.floor(t.time/(24*365)),S=Math.floor(t.time%(24*365)/24),I=Math.floor(t.time%24),A=400,w=Math.min(i*.8,600),P=n-A-10,R=tt+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(P,R,A,w),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(P,R,A,w),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let _=R+20;const b=14,M=P+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",M,_),_+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${v}, Day ${S}, Hour ${I}`,M,_),_+=b,e.fillText(`Map Size: ${Ze}  ${Qe} pixels`,M,_),_+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",M,_),_+=18,m&&(e.fillText(`Q-Table Size: ${m.qTableSize} entries`,M,_),_+=b,e.fillText(`Exploration Rate: ${(m.explorationRate*100).toFixed(1)}%`,M,_),_+=b);const D=fl.slice(-20);D.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",M,_),_+=30,qF(e,M,_,D),_+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",M,_),_+=18,e.fillStyle="white",e.font="12px monospace";const N=(ro/c*1e6).toFixed(2),k=(so/c*1e6).toFixed(2),L=(ao/c*1e6).toFixed(2);e.fillText(`Prey: ${u.toFixed(2)} (target: ${N})`,M,_),_+=b,e.fillText(`Predators: ${f.toFixed(2)} (target: ${k})`,M,_),_+=b,e.fillText(`Bushes: ${g.toFixed(2)} (target: ${L})`,M,_),_+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",M,_),_+=18,e.fillStyle="white",e.font="12px monospace";const z=Math.round(s/ro*100),V=Math.round(a/so*100),X=Math.round(l/ao*100),Q=q=>q<50?"#ff4444":q<80?"#ffaa44":q>120?"#44aaff":"#44ff44";e.fillStyle=Q(z),e.fillText(`Prey: ${s}/${ro} (${z}%)`,M,_),_+=b,e.fillStyle=Q(V),e.fillText(`Predators: ${a}/${so} (${V}%)`,M,_),_+=b,e.fillStyle=Q(X),e.fillText(`Bushes: ${l}/${ao} (${X}%)`,M,_),_+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",M,_),_+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",M,_),_+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,M,_),_+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,M,_),_+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,M,_),_+=13,e.fillText("Predators:",M,_),_+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,M,_),_+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,M,_),_+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,M,_),_+=13,e.fillText("Bushes:",M,_),_+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,M,_),_+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",P+A/2,R+w-10),e.restore()}function qF(e,t,n,i){if(i.length<2)return;const c={prey:Math.max(...i.map(f=>f.prey),ro),predators:Math.max(...i.map(f=>f.predators),so),bushes:Math.max(...i.map(f=>f.bushes),ao)};[{data:i.map(f=>f.prey),color:"#44ff44",label:"Prey",target:ro,max:c.prey},{data:i.map(f=>f.predators),color:"#ff4444",label:"Predators",target:so,max:c.predators},{data:i.map(f=>f.bushes),color:"#ffaa44",label:"Bushes",target:ao,max:c.bushes}].forEach((f,g)=>{const m=t+g*115,v=n;e.fillStyle=f.color,e.font="10px monospace",e.fillText(f.label,m,v-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,v,100,30),e.beginPath(),e.strokeStyle=f.color;for(let I=0;I<f.data.length;I++){const A=m+I/(f.data.length-1)*100,w=v+30-f.data[I]/f.max*30;I===0?e.moveTo(A,w):e.lineTo(A,w)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const S=v+30-f.target/f.max*30;e.moveTo(m,S),e.lineTo(m+100,S),e.stroke(),e.setLineDash([])})}function ZF(e,t){const n=t.search.human.byProperty("leaderId",e),i={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||i.children++,s.gender==="male"?i.males++:s.gender==="female"&&i.females++,s.age>=Sp&&i.old++;return i}function QF(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(f=>n.berryBush.byRadius(f.position,f.radius)).reduce((f,g)=>f+g.food.length,0),u=n.building.byProperty("ownerId",e).filter(f=>f.buildingType===fe.StorageSpot).reduce((f,g)=>f+(g.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:u,consumptionRate:0}}function JF(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,l=new Map,c=new Map;for(const f of s){const g=gu(f.id,t,l);c.has(g)||c.set(g,[]),c.get(g).push(f)}const u=[];for(const[f,g]of c.entries()){const m=a[f];m&&u.push({patriarch:m,memberCount:g.length,members:g.map(v=>v.id)})}return u.sort((f,g)=>g.memberCount-f.memberCount),u.slice(0,n)}let hl=[],Ni=[],Ov=0;const eL=36,bv=200;function tL(e,t,n,i){var b;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(b=Wt(s,t))==null?void 0:b.id;if(!a)return;const l=ZF(a,t),c=QF(a,t);if(t.time-Ov>=eL){hl.push({time:t.time,total:l.total,children:l.children,males:l.males,females:l.females,old:l.old});const M=c.totalBushFood+c.totalStorageFood;Ni.push({time:t.time,bushFood:c.totalBushFood,storageFood:c.totalStorageFood,totalFood:M}),hl.length>bv&&(hl=hl.slice(-200)),Ni.length>bv&&(Ni=Ni.slice(-200)),Ov=t.time}let u=0;if(Ni.length>=2){const M=Ni[Ni.length-1],D=Ni[Ni.length-2],N=M.time-D.time;N>0&&(u=(D.totalFood-M.totalFood)/N)}const f=400,g=Math.min(i*.9,700),m=n-f-10,v=tt+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,v,f,g),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,v,f,g),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let S=v+20;const I=13,A=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",A,S),S+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",A,S),S+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${l.total}`,A,S),S+=I,e.fillStyle="#00ffff",e.fillText(`Children: ${l.children}`,A,S),S+=I,e.fillStyle="#4488ff",e.fillText(`Males: ${l.males}`,A,S),S+=I,e.fillStyle="#ff88ff",e.fillText(`Females: ${l.females}`,A,S),S+=I,e.fillStyle="#888888",e.fillText(`Old (${l.old})`,A,S),S+=20;const w=hl.slice(-50);w.length>1&&(nL(e,A,S,w),S+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",A,S),S+=18;const P=c.totalBushFood+c.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${P}`,A,S),S+=I,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${c.totalBushFood}`,A,S),S+=I,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${c.totalStorageFood}`,A,S),S+=I,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,A,S),S+=20;const R=Ni.slice(-50);R.length>1&&(iL(e,A,S,R),S+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",A,S),S+=18;const _=JF(a,t,5);e.fillStyle="white",e.font="11px monospace",_.length===0?(e.fillText("No families found",A,S),S+=I):_.forEach((M,D)=>{const k=`${D+1}. ${M.patriarch.isPlayer?"Player":"#"+M.patriarch.id} (${M.memberCount} members, can split: ${XA(M.patriarch,t).canSplit})`;e.fillText(k,A,S),S+=I}),S+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+f/2,v+g-10),e.restore()}function nL(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.total),color:"#ffffff",label:"Total"},{data:i.map(u=>u.children),color:"#00ffff",label:"Children"},{data:i.map(u=>u.males),color:"#4488ff",label:"Males"},{data:i.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:i.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function iL(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:i.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:i.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function kv(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,c=hA;if(e.beginPath(),e.moveTo(i+c,s),e.lineTo(i+a-c,s),e.quadraticCurveTo(i+a,s,i+a,s+c),e.lineTo(i+a,s+l-c),e.quadraticCurveTo(i+a,s+l,i+a-c,s+l),e.lineTo(i+c,s+l),e.quadraticCurveTo(i,s+l,i,s+l-c),e.lineTo(i,s+c),e.quadraticCurveTo(i,s,i+c,s),e.closePath(),e.fillStyle=t.isDisabled?gA:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*SA)+1)/2;e.strokeStyle=yA,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<du){const f=1-u/du;e.fillStyle=mA,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Mp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?pA:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.font=`${it*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function oL(e,t,n,i){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,i);const s=500,a=150,l=(n-s)/2,c=(i-a)/2;e.fillStyle=ft,e.font=`${it*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,c+a/3-10),e.fillText("to the main menu?",n/2,c+a/3+10);const u=oo*1.5,f=fA,g=c+a-f-tt*2,m=20,v=u*2+m,S=l+(s-v)/2,I={id:"confirmExitYes",action:le.ConfirmExitYes,rect:{x:S,y:g,width:u,height:f},text:"Yes",backgroundColor:xn,textColor:ft,currentWidth:u},A=S+u+m,w={id:"confirmExitNo",action:le.ConfirmExitNo,rect:{x:A,y:g,width:u,height:f},text:"No",backgroundColor:xn,textColor:ft,currentWidth:u};t.uiButtons.push(I,w),kv(e,I,t.hoveredButtonId===I.id),kv(e,w,t.hoveredButtonId===w.id),e.restore()}const Ho=600,Ds=30,Oi=60,zt=30,rL="";function sL(e,t,n){const i=[];if(!n.tribeControl||!n.leaderId)return i;const{width:s,height:a}=e.canvas,l=(s-Ho)/2,c=480,u=(a-c)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(l,u,Ho,c,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=ft,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Tribe Roles",l+Ho/2,u+Ds);const f=30,g=l+Ho-Ds-f,m=u+Ds,v=t.hoveredButtonId==="roleManager_close";e.fillStyle=v?"#ff7777":"#ff5555",e.fillRect(g,m,f,f),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",g+f/2,m+f/2),i.push({id:"roleManager_close",action:le.CloseRoleManager,rect:{x:g,y:m,width:f,height:f},text:"X",currentWidth:f,backgroundColor:"#ff5555",textColor:"#ffffff"});const I=ci(n.leaderId,t).filter(X=>X.isAdult),A={[se.Leader]:0,[se.Gatherer]:0,[se.Planter]:0,[se.Hunter]:0,[se.Mover]:0,[se.Warrior]:0};I.forEach(X=>{X.tribeRole&&A[X.tribeRole]++});const w=n.tribeControl.roleWeights,P=[{role:se.Gatherer,emoji:"",name:"Gatherer"},{role:se.Planter,emoji:"",name:"Planter"},{role:se.Hunter,emoji:"",name:"Hunter"},{role:se.Mover,emoji:"",name:"Mover"},{role:se.Warrior,emoji:"",name:"Warrior"}];let R=0;P.forEach(X=>{R+=w[X.role]||0});let _=u+Ds+70;const b=l+Ds,M=l+Ho-Ds;P.forEach(X=>{const Q=w[X.role]||0,q=R>0?Math.round(Q/R*100):0,ie=A[X.role]||0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=ft,e.fillText(`${X.emoji} ${ie} ${X.name}`,b,_+Oi/2);const oe=l+220,ee=oe+zt+15,K=ee+200+15,Z=`role_minus_${X.role}`,B=t.hoveredButtonId===Z,j=Q<=0,ce=j?"#555":B?"#dd6666":"#cc4444";e.fillStyle=ce,e.fillRect(oe,_+(Oi-zt)/2,zt,zt),e.fillStyle=j?"#888":"#fff",e.textAlign="center",e.fillText("-",oe+zt/2,_+Oi/2+2),i.push({id:Z,action:le.DecreaseRoleWeight,targetRole:X.role,rect:{x:oe,y:_+(Oi-zt)/2,width:zt,height:zt},text:"-",currentWidth:zt,backgroundColor:ce,textColor:"#fff",isDisabled:j}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#fff";let pe=ee;for(let de=0;de<Q;de++)e.fillText(rL,pe,_+Oi/2+2),pe+=18;const Me=`role_plus_${X.role}`,he=t.hoveredButtonId===Me,Ee=Q>=10,Re=Ee?"#555":he?"#66dd66":"#44cc44";e.fillStyle=Re,e.fillRect(K,_+(Oi-zt)/2,zt,zt),e.fillStyle=Ee?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",K+zt/2,_+Oi/2+4),i.push({id:Me,action:le.IncreaseRoleWeight,targetRole:X.role,rect:{x:K,y:_+(Oi-zt)/2,width:zt,height:zt},text:"+",currentWidth:zt,backgroundColor:Re,textColor:"#fff",isDisabled:Ee}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=ft,e.fillText(`${q}%`,M,_+Oi/2),_+=Oi});const D=A[se.Leader],N=Object.values(A).reduce((X,Q)=>X+Q,0),k=I.length-N;e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`Adults: ${I.length} | Leader: ${D} | Assigned: ${N} | Unassigned: ${k}`,l+Ho/2,_+10),e.fillText("(Adjust weights to control role distribution)",l+Ho/2,_+30);const L=t.autopilotControls.behaviors.roleManagement,z=L?" Auto-adjust: ON":" Auto-adjust: OFF",V=L?"#4CAF50":"#888";return e.fillStyle=V,e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`${z} (Shift+U to toggle)`,l+Ho/2,_+50),e.restore(),i}const _r=600,Ms=30,bi=60,jt=30,Bv=[{key:"protectHomeland",emoji:"",name:"Protect Homeland",description:"Stay inside territory and protect from enemies"},{key:"expandBorders",emoji:"",name:"Expand Borders",description:"Expand territory by placing border posts (Coming Soon)"},{key:"invadeEnemies",emoji:"",name:"Invade Enemies",description:"Attack enemies outside of our border"}];function aL(e,t,n){const i=[];if(!n.tribeControl||n.leaderId!==n.id)return i;const s=n.tribeControl.armyControl??{protectHomeland:Xg,expandBorders:Vg,invadeEnemies:Kg},{width:a,height:l}=e.canvas,c=(a-_r)/2,u=350,f=(l-u)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(c,f,_r,u,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=ft,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Army Control",c+_r/2,f+Ms);const g=30,m=c+_r-Ms-g,v=f+Ms,S=t.hoveredButtonId==="armyControl_close";e.fillStyle=S?"#ff7777":"#ff5555",e.fillRect(m,v,g,g),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",m+g/2,v+g/2),i.push({id:"armyControl_close",action:le.CloseArmyControl,rect:{x:m,y:v,width:g,height:g},text:"X",currentWidth:g,backgroundColor:"#ff5555",textColor:"#ffffff"});let I=0;Bv.forEach(R=>{I+=s[R.key]||0});let A=f+Ms+70;const w=c+Ms,P=c+_r-Ms;return Bv.forEach(R=>{const _=s[R.key]||0,b=I>0?Math.round(_/I*100):0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=ft,e.fillText(`${R.emoji} ${R.name}`,w,A+bi/2);const M=c+320,D=M+jt+15,N=120,k=D+N+15,L=`army_minus_${R.key}`,z=t.hoveredButtonId===L,V=_<=0,X=V?"#555":z?"#dd6666":"#cc4444";e.fillStyle=X,e.fillRect(M,A+(bi-jt)/2,jt,jt),e.fillStyle=V?"#888":"#fff",e.textAlign="center",e.fillText("-",M+jt/2,A+bi/2+2),i.push({id:L,action:le.DecreaseArmyObjective,targetArmyObjective:R.key,rect:{x:M,y:A+(bi-jt)/2,width:jt,height:jt},text:"-",currentWidth:jt,backgroundColor:X,textColor:"#fff",isDisabled:V}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#4CAF50";const Q=N-10,q=12,ie=A+bi/2-q/2;e.fillStyle="#333",e.fillRect(D,ie,Q,q);const oe=_/10*Q;e.fillStyle="#4CAF50",e.fillRect(D,ie,oe,q);const ee=`army_plus_${R.key}`,x=t.hoveredButtonId===ee,K=_>=10,Z=K?"#555":x?"#66dd66":"#44cc44";e.fillStyle=Z,e.fillRect(k,A+(bi-jt)/2,jt,jt),e.fillStyle=K?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",k+jt/2,A+bi/2+4),i.push({id:ee,action:le.IncreaseArmyObjective,targetArmyObjective:R.key,rect:{x:k,y:A+(bi-jt)/2,width:jt,height:jt},text:"+",currentWidth:jt,backgroundColor:Z,textColor:"#fff",isDisabled:K}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=ft,e.fillText(`${b}%`,P,A+bi/2),A+=bi}),e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText("Adjust priorities for warrior objectives",c+_r/2,A+10),e.fillText("Higher values = higher priority",c+_r/2,A+30),e.restore(),i}let Fv="",Lv=null;function lL(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function cL(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function Ld(e,t,n,i,s,a,l){const c=((t+i)%a+a)%a,u=((n+s)%l+l)%l;return e.has(`${c},${u}`)}function dL(e,t,n,i){const s=VP(t.soilDepletion,NI);if(s.length===0)return;const{width:a,height:l}=t.mapDimensions,c=i.width/2,u=i.height/2,f=Math.ceil(a/Xt),g=Math.ceil(l/Xt),m=lL(s);m!==Fv&&(Fv=m,Lv=cL(s));const v=Lv,S=Xt*2,I=n.x-c-S,A=n.x+c+S,w=n.y-u-S,P=n.y+u+S;e.save();const R=e.globalAlpha;for(const _ of s){const b=_.gridX*Xt,M=_.gridY*Xt,D=uL(b,M,a,l,I,A,w,P);for(const N of D)fL(e,N.x,N.y,_.health,_.gridX,_.gridY,v,f,g)}e.globalAlpha=R,e.restore()}function uL(e,t,n,i,s,a,l,c){const u=[],f=Xt,g=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-i},{dx:0,dy:i},{dx:-n,dy:-i},{dx:n,dy:-i},{dx:-n,dy:i},{dx:n,dy:i}];for(const m of g){const v=e+m.dx,S=t+m.dy;v+f>=s&&v<=a&&S+f>=l&&S<=c&&u.push({x:v,y:S})}return u}function fL(e,t,n,i,s,a,l,c,u){const f=Math.floor(t),g=Math.floor(n),m=Xt,v=1-i/NI,I=i<$_?SS:SS*v,A=!Ld(l,s,a,0,-1,c,u),w=!Ld(l,s,a,0,1,c,u),P=!Ld(l,s,a,-1,0,c,u),R=!Ld(l,s,a,1,0,c,u);e.globalAlpha=I,e.fillStyle=U_,e.fillRect(f,g,m,m);const _=3;e.fillStyle=G_,e.globalAlpha=I*1.2,A&&e.fillRect(f,g,m,_),w&&e.fillRect(f,g+m-_,m,_),P&&e.fillRect(f,g,_,m),R&&e.fillRect(f+m-_,g,_,m),e.globalAlpha=I*.5;const b=_+1;A&&P&&e.fillRect(f,g,b,b),A&&R&&e.fillRect(f+m-b,g,b,b),w&&P&&e.fillRect(f,g+m-b,b,b),w&&R&&e.fillRect(f+m-b,g+m-b,b,b),e.globalAlpha=1}const gl=8,pl=12,hn=24;function Hv(e,t,n,i,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-pl),e.stroke(),e.fillStyle=i,e.beginPath(),e.moveTo(t,n-pl),e.lineTo(t+gl,n-pl+gl/2),e.lineTo(t,n-pl+gl),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+gl/2,n-pl+gl/2))}function hL(e,t,n,i,s){const a=ec(t,s);let l=1;const c=new Map,u=new Map;for(const A of a){const P=A.leaderId===s?0:l++,R=yn[P%yn.length];c.set(A.leaderId,R),u.set(A.leaderId,A.tribeBadge||"")}const f=[],g=hn*2,m=Math.floor((n.x-i.width/2-g)/hn)*hn,v=Math.floor((n.x+i.width/2+g)/hn)*hn,S=Math.floor((n.y-i.height/2-g)/hn)*hn,I=Math.floor((n.y+i.height/2+g)/hn)*hn;for(let A=S;A<=I;A+=hn)for(let w=m;w<=v;w+=hn){const P=jn(w,A,t),R=w+hn,_=jn(R,A,t);if(P!==_){const D=P||_;if(D){const N=w+hn/2,k=A;Hv(e,N,k,c.get(D)||"#000",u.get(D)||""),f.push({x:N,y:k})}}const b=A+hn,M=jn(w,b,t);if(P!==M){const D=P||M;if(D){const N=w,k=A+hn/2;Hv(e,N,k,c.get(D)||"#000",u.get(D)||""),f.push({x:N,y:k})}}}return f}const $n=12,Dt=16,ri=15;function Uv(e){switch(e){case G.Success:return"#4CAF50";case G.Failure:return"#F44336";case G.Running:return"#FFC107";case G.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function gL(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function pL(e,t,n,i){var N;const{debugCharacterId:s}=t,a=500,l=Math.min(i*.9,800),c=n-a-10,u=tt+it*2;t.debugPanelRect={x:c,y:u,width:a,height:l},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(c,u,a,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(c,u,a,l),e.fillStyle="white",e.font=`${$n}px monospace`,e.textAlign="left",e.textBaseline="top";let f=u+20;const g=c+15;if(e.fillStyle="#66ccff",e.font=`bold ${$n+2}px monospace`,e.fillText(" Task AI Debugger",g,f),f+=25,!s){e.fillStyle="#888",e.font=`${$n}px monospace`,e.fillText("No character selected for debugging.",g,f),e.fillText("Click on a character to inspect their Task AI.",g,f+20),e.restore();return}const m=t.entities.entities[s];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${$n}px monospace`,e.fillText(`Character #${s} not found or not a character.`,g,f),e.restore();return}const v=m;e.fillStyle="white",e.font=`${$n}px monospace`,e.fillText(`Character: ${v.type} #${v.id} (${v.age.toFixed(1)}y)`,g,f),f+=Dt*1.5,e.fillStyle="#66ccff",e.font=`bold ${$n}px monospace`,e.fillText(" Current Task",g,f),f+=Dt*1.5;const S=Jg(v),I=S?t.tasks[S]:null;if(e.font=`${$n}px monospace`,I){const k=T.get(v.aiBlackboard,ST),L=T.get(v.aiBlackboard,vT),z=k!==void 0?G[k]:"N/A";e.fillStyle="white",e.fillText(`ID: ${I.id}`,g+ri,f),f+=Dt,e.fillText(`Type: ${ae[I.type]}`,g+ri,f),f+=Dt,e.fillText(`Target: ${gL(I.target)}`,g+ri,f),f+=Dt,e.fillStyle=Uv(k),e.fillText(`Status: ${z}`,g+ri,f),f+=Dt,L&&(e.fillStyle="#aaa",e.fillText(`Message: ${L}`,g+ri,f),f+=Dt)}else e.fillStyle="#888",e.fillText("No active task.",g+ri,f),f+=Dt;f+=Dt,e.fillStyle="#66ccff",e.font=`bold ${$n}px monospace`,e.fillText(" Recent Task History (Last 5)",g,f),f+=Dt*1.5;const A=T.get(v.aiBlackboard,Qg)||[];if(A.length===0)e.fillStyle="#888",e.font=`${$n}px monospace`,e.fillText("No task history yet.",g+ri,f),f+=Dt;else for(const k of A){e.fillStyle="white",e.font=`${$n}px monospace`;const L=ae[k.type];e.fillText(` ${L}`,g+ri,f);const z=G[k.result];e.fillStyle=Uv(k.result);const V=e.measureText(` ${L} `).width;e.fillText(`(${z})`,g+ri+V,f),e.fillStyle="#666";const X=e.measureText(`(${z}) `).width;e.fillText(`@ ${k.completedAtTick.toFixed(1)}h`,g+ri+V+X,f),f+=Dt,k.message&&(e.fillStyle="#888",e.fillText(`   ${k.message}`,g+ri,f),f+=Dt)}f+=Dt,e.fillStyle="#66ccff",e.font=`bold ${$n}px monospace`,e.fillText(" Available Tasks",g,f),f+=Dt*1.5;const w=f,P=u+l-w-30;e.save(),e.beginPath(),e.rect(c,w,a,P),e.clip();const R=((N=t.debugPanelScroll)==null?void 0:N.y)??0;e.translate(0,-R);const _=t.search.tasks.byRadius(m.position,800);let b=0;if(_.length===0)e.fillStyle="#888",e.font=`${$n}px monospace`,e.fillText("No tasks available in the world.",g+ri,f),f+=Dt;else{const k=_.map(L=>{const z=ju[L.type];return{task:L,score:z&&z.scorer&&v.type==="human"?z.scorer(v,L,{gameState:t,deltaTime:0}):null}});k.sort((L,z)=>{const V=L.score!==null?L.score:-1/0;return(z.score!==null?z.score:-1/0)-V});for(const{task:L,score:z}of k){let V="Unclaimed",X="#888";L.claimedByEntityId&&(L.claimedByEntityId===v.id?(V="Claimed by this character",X="#4CAF50"):(V=`Claimed by #${L.claimedByEntityId}`,X="#F44336")),e.font=`${$n}px monospace`,e.fillStyle=X;const Q=` Task ID: ${L.id}`;e.fillText(Q,g,f),f+=Dt,e.fillStyle="white",e.fillText(`  Type: ${ae[L.type]}`,g,f),f+=Dt;const q=z!==null?z.toFixed(3):"N/A";e.fillStyle=z!==null&&z>0?"#FFC107":"#888",e.fillText(`  Score: ${q}`,g,f),f+=Dt,e.fillStyle=X,e.fillText(`  Status: ${V}`,g,f),f+=Dt*1.5,b=Math.max(b,e.measureText(Q).width+30)}}const M=f-w;t.debugPanelContentSize={width:b,height:M},e.restore();const D=u+l-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",c+a/2,D),e.restore()}function mL(e,t,n,i){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey")return;switch(a.aiType){case $t.TaskBased:pL(e,t,n,i);break;case $t.BehaviorTreeBased:xB(e,t,n,i);break}const l=500,c=n-l-10,u=tt+it*2,f=150,g=25,m=c+l-f-15,v=u+15,S={x:m,y:v,width:f,height:g};t.uiButtons.push({id:"switch-ai-type-button",action:le.SwitchAIType,rect:S,text:"",currentWidth:f,backgroundColor:"rgba(100, 100, 100, 0.5)",textColor:"white"}),e.save(),e.fillStyle="rgba(100, 100, 100, 0.8)",e.fillRect(m,v,f,g),e.strokeStyle="#fff",e.lineWidth=1,e.strokeRect(m,v,f,g),e.fillStyle="white",e.font="10px monospace",e.textAlign="center",e.textBaseline="middle";const I=a.aiType===$t.BehaviorTreeBased?"BT":"Task";e.fillText(`AI: ${I} (Switch)`,m+f/2,v+g/2),e.restore()}function vu(e,t,n,i,s,a=!1){var f;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),CB(e,t);return}const l=At(t),c=hL(e,t,n,s,l==null?void 0:l.leaderId);if(dL(e,t,n,s),zF(e,t,t.debugPanel===Xe.General,n,s,c),l&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const g=np(t.mousePosition,n,s,t.mapDimensions),m=aa(g,t.selectedBuildingType,l.leaderId,t);TF(e,g,t.selectedBuildingType,m,t.mapDimensions)}const u=t.notifications.filter(g=>!g.isDismissed);for(const g of u){const m=(Math.sin(t.time*IP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=vP,g.targetArea&&e.fillRect(g.targetArea.x,g.targetArea.y,g.targetArea.width,g.targetArea.height),g.targetRadius&&(e.beginPath(),e.arc(g.targetRadius.x,g.targetRadius.y,g.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,FB(e,t),e.restore(),!a){e.fillStyle=D1,e.font=`${it}px "Press Start 2P", Arial`,e.shadowColor=M1,e.shadowBlur=N1,t.uiButtons=[];let g=null,m=null;if(l){const I=On(t,l),A=zr(I),w=((f=l.partnerIds)==null?void 0:f.map(R=>t.entities.entities[R]).filter(R=>R!==void 0))||[],P=jF(e,t,l,A,w,I);g=P.hungerBarRect,m=P.foodBarRect}const v=ec(t,l==null?void 0:l.leaderId);fB(e,t,n,v,e.canvas.width,e.canvas.height,t.cameraZoom);const{commandButtonsRect:S}=aB(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,l&&(kB(e,t,n,e.canvas.width,e.canvas.height),i.length>0&&uB(e,i,l,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:I}=t.tutorialState;I.includes($r.HUNGER_BAR)&&g&&Sg(e,g,t.time),I.includes($r.FOOD_BAR)&&m&&Sg(e,m,t.time),I.includes($r.COMMAND_BUTTONS)&&S&&Sg(e,S,t.time)}if(t.tutorialState.isActive){const I=EB(e,t,e.canvas.width,e.canvas.height);I&&t.uiButtons.push({id:"tutorial-dismiss",action:le.DismissTutorial,rect:I,text:"",currentWidth:I.width,backgroundColor:"transparent",textColor:"transparent"})}switch(HB(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case Xe.Ecosystem:KF(e,t,e.canvas.width,e.canvas.height);break;case Xe.Tribe:tL(e,t,e.canvas.width,e.canvas.height);break;case Xe.SupplyChain:zB(e,t,e.canvas.width,e.canvas.height);break;case Xe.Performance:GB(e,t,s.width);break;case Xe.General:mL(e,t,e.canvas.width,e.canvas.height);break}if(t.roleManagerOpen&&l&&l.leaderId===l.id){const I=sL(e,t,l);t.uiButtons.push(...I)}if(t.armyControlOpen&&l&&l.leaderId===l.id){const I=aL(e,t,l);t.uiButtons.push(...I)}t.tribeModalOpen&&AB(e,t,v,e.canvas.width,e.canvas.height),t.isPaused&&t.exitConfirmation!=="pending"&&lB(e),t.exitConfirmation==="pending"&&oL(e,t,e.canvas.width,e.canvas.height)}}const yL=kt.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,SL=kt.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,vL=kt.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,IL=kt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Gv=kt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,AL=kt.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,TL=kt.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,Hd="intro-soundtrack",$v=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=Vr(),i=Be.useRef(null),s=Be.useRef(null),a=Be.useRef(tk()),l=Be.useRef(),c=Be.useRef(a.current.viewportCenter),u=Be.useRef(),f=Be.useCallback(()=>{rg(Hd,2),n(),e("game")},[e,n]),g=Be.useCallback(()=>{t&&(rg(Hd,2),e("game"))},[e,t]);Be.useEffect(()=>{const S=I=>{(I.key==="Enter"||I.key===" ")&&(t?g():f())};return window.addEventListener("keydown",S),()=>{window.removeEventListener("keydown",S)}},[f,g,t]),Be.useEffect(()=>(Lp(Pe.SoundTrack1,{loop:!0,trackId:Hd}),()=>{rg(Hd,2)}),[]),Be.useEffect(()=>{const S=i.current;if(!S)return;s.current=S.getContext("2d");const I=()=>{S&&s.current&&(S.width=window.innerWidth,S.height=window.innerHeight,vu(s.current,a.current,c.current,[],{width:S.width,height:S.height},!0))};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]),Be.useEffect(()=>{const S=()=>{const A=iA(a.current);if(A.length>0){const w=Math.floor(Math.random()*A.length);u.current=A[w].id}};S();const I=setInterval(S,C_);return()=>clearInterval(I)},[]);const[m,v]=TI(S=>{var w,P;if(!s.current)return;if(l.current===void 0){l.current=S;return}const I=Math.min((S-l.current)/1e3,1);a.current=Xu(a.current,I);const A=u.current?a.current.entities.entities[u.current]:void 0;if(A){const{mapDimensions:R}=a.current,{width:_,height:b}=R;let M={...A.position};const D=M.x-c.current.x;Math.abs(D)>_/2&&(D>0?M.x-=_:M.x+=_);const N=M.y-c.current.y;Math.abs(N)>b/2&&(N>0?M.y-=b:M.y+=b);let k=Zd(c.current,M,iu*I);k={x:(k.x%_+_)%_,y:(k.y%b+b)%b},c.current=k}vu(s.current,a.current,c.current,[],{width:((w=i.current)==null?void 0:w.width)||800,height:((P=i.current)==null?void 0:P.height)||600},!0),l.current=S});return Be.useEffect(()=>(v(),m),[v,m]),He.jsxs(yL,{children:[He.jsx(SL,{ref:i}),He.jsxs(vL,{children:[He.jsx(IL,{children:"Tribe2"}),He.jsxs(AL,{children:[He.jsx(Gv,{onClick:f,children:"New Game"}),t&&He.jsx(Gv,{onClick:g,children:"Load Game"})]}),He.jsxs(TL,{children:["by"," ",He.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function EL(){console.log("Tribe game initialized with detailed 2D world state.");const e=ek();return e.ecosystem={preyGestationPeriod:Fr,preyProcreationCooldown:Lr,predatorGestationPeriod:Hr,predatorProcreationCooldown:Ur,preyHungerIncreasePerHour:Yo,predatorHungerIncreasePerHour:zo,berryBushSpreadChance:lo},e.debugPanel=Xe.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const CL=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:i,playerActionHintsRef:s})=>(Be.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const l=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,vu(t.current,n.current,i.current,s.current,{width:a.width,height:a.height},!1))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),He.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),wL=(e,t,n,i=!1)=>{var l,c;let s;const a=f1(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:ue.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:ue.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const u=a;t.isAdult&&Kr(t,u,n)?s={action:ue.AutopilotAttack,targetEntityId:u.id}:nr(t,u,n)?s={action:ue.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:ue.AutopilotFeedChild,targetEntityId:u.id})}else if(a.type==="prey")s={action:ue.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:ue.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const u=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&Vt(t,u,n)&&u.isConstructed?s={action:ue.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:ue.Removal,position:a.position};else if(t.leaderId===t.id&&Vt(t,u,n)&&u.isConstructed)ZI(u.position,oa,t.id,n).valid?s={action:ue.TakeOverBuilding,targetEntityId:u.id}:s={action:ue.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const f=u.ownerId===t.leaderId,g=u.storedItems.length>0,m=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(i&&u.isConstructed&&g&&t.food.length<t.maxFood)if(f)s={action:ue.AutopilotRetrieve,targetEntityId:a.id};else{const v=t.leaderId?n.entities.entities[t.leaderId]:void 0;v&&((l=v.tribeControl)!=null&&l.diplomacy)?(u.ownerId&&v.tribeControl.diplomacy[u.ownerId])===ut.Hostile?s={action:ue.AutopilotGather,targetEntityId:a.id}:s={action:ue.AutopilotMove,position:e}:s={action:ue.AutopilotMove,position:e}}else f&&u.isConstructed?(t.food.length>0||t.heldItem)&&m?s={action:ue.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&g?s={action:ue.AutopilotRetrieve,targetEntityId:a.id}:s={action:ue.AutopilotMove,position:e}:s={action:ue.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(f=>f.type===Tn.Berry).length>=fo&&!Kn(e,n,qo)&&!Li(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:ue.AutopilotPlant,position:e}:u.buildingType===fe.Bonfire&&((c=t.heldItem)==null?void 0:c.type)===vt.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:ue.AutopilotDeposit,targetEntityId:u.id}:s={action:ue.AutopilotMove,position:e}}else if(a.type==="tree"){const u=a,[f]=u.stateMachine??[],g=f===ln||f===Kt||f===An;t.isAdult&&!t.heldItem&&g?s={action:ue.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&f===Gt&&u.wood.length>0?s={action:ue.AutopilotGather,targetEntityId:u.id}:s={action:ue.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===Tn.Berry).length>=fo&&(n.autopilotControls.isManuallyPlanting||tc(e,n,t))&&!Li(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:ue.AutopilotPlant,position:e}:s={action:ue.AutopilotMove,position:e};return s},_L=(e,t)=>{if(e.isPaused)return;const n=At(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=U(n.position,t,e.mapDimensions.width,e.mapDimensions.height),l=100;a<=l?aa(t,s,n.leaderId,e,n.position,l)&&(Vo(t,s,n.leaderId,e),e.selectedBuildingType=null):aa(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:ue.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=A1(t,e);s&&Yg(s.id,e);return}const i=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,i?(e.autopilotControls.activeAutopilotAction=i,(i.action===ue.AutopilotMove||i.action===ue.AutopilotGather||i.action===ue.AutopilotChop)&&(e.hasPlayerMovedEver=!0),i.action===ue.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:ue.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},RL=(e,t)=>{var l,c,u,f,g,m,v,S;const n=e.key.toLowerCase(),i=e.ctrlKey||e.metaKey;let s=!0,a=t;if(i){switch(n){case"s":lp(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:I}=t;I.activeAutopilotAction||I.isManuallyMoving||I.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(I.activeAutopilotAction=void 0,I.isManuallyMoving=!1,I.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"u":const A=At(t);A&&A.isAdult&&A.leaderId===A.id&&(e.shiftKey?t.autopilotControls.behaviors.roleManagement=!t.autopilotControls.behaviors.roleManagement:t.roleManagerOpen=!t.roleManagerOpen);break;case"v":{const R=At(t);R&&R.isAdult&&R.leaderId===R.id&&(t.armyControlOpen=!t.armyControlOpen);break}case"m":t.isMuted=!t.isMuted,Pl(t.masterVolume,t.isMuted);break;case"=":case"+":const w=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(w.toFixed(1)),Pl(t.masterVolume,t.isMuted);break;case"-":const P=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(P.toFixed(1)),Pl(t.masterVolume,t.isMuted);break;case"t":a=Xu(t,HA);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===Xe.General?(a.debugPanel=Xe.None,a.debugCharacterId=void 0):(a.debugPanel=Xe.General,a.debugCharacterId||(a.debugCharacterId=((l=At(a))==null?void 0:l.id)??((c=Object.values(a.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:c.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===Xe.Ecosystem){a.debugPanel=Xe.None;break}a.debugPanel=Xe.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((u=At(a))==null?void 0:u.id)??((f=Object.values(a.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:f.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===Xe.Tribe){a.debugPanel=Xe.None;break}a.debugPanel=Xe.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((g=At(a))==null?void 0:g.id)??((m=a.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:m.id))}else s=!1;break;case"$":if(e.shiftKey){if(a.debugPanel===Xe.SupplyChain){a.debugPanel=Xe.None;break}a.debugPanel=Xe.SupplyChain,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((v=At(a))==null?void 0:v.id)??((S=a.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:S.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===Xe.Performance){a.debugPanel=Xe.None;break}a.debugPanel=Xe.Performance}else s=!1;break;case"tab":if(a.debugPanel!==Xe.General&&a.debugPanel!==Xe.Tribe&&a.debugPanel!==Xe.SupplyChain&&(a.debugPanel=Xe.General),a.debugPanel===Xe.General){const R=Object.values(a.entities.entities).filter(_=>_.type==="human"||_.type==="prey"||_.type==="predator");if(R.length>0){const _=R.sort((N,k)=>{if(N.type==="human"&&N.isPlayer)return-1;if(k.type==="human"&&k.isPlayer)return 1;if(N.type!==k.type){const L={human:0,prey:1,predator:2},z=L[N.type]??999,V=L[k.type]??999;return z-V}return N.id-k.id}),b=a.debugCharacterId,D=((b?_.findIndex(N=>N.id===b):-1)+1)%_.length;a.debugCharacterId=_[D].id}else a.debugCharacterId=void 0}else if(a.debugPanel===Xe.Tribe||a.debugPanel===Xe.SupplyChain){const R=a.search.human.all().filter(b=>b.leaderId===b.id);let _=R.findIndex(b=>b.id===a.debugCharacterId)+1;(_===-1||_>R.length-1)&&(_=0),a.debugCharacterId=R[_].id}else a.debugPanel=Xe.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},PL=(e,t,n,i,s)=>{var l;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",Oe(a,Pe.ButtonClick,i.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",Oe(a,Pe.ButtonClick,i.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",Oe(a,Pe.ButtonClick,i.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",Oe(a,Pe.ButtonClick,i.position);return}else if(e==="6"){n.selectedBuildingType="removal",Oe(a,Pe.ButtonClick,i.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const c=Fe(i,n,"berryBush",je,g=>g.food.length>0&&i.food.length<i.maxFood),u=Fe(i,n,"corpse",je,g=>g.food.length>0&&i.food.length<i.maxFood);let f=null;c&&u?f=U(i.position,c.position,n.mapDimensions.width,n.mapDimensions.height)<=U(i.position,u.position,n.mapDimensions.width,n.mapDimensions.height)?c:u:f=c||u,f&&(i.activeAction="gathering",Oe(a,Pe.Gather,i.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}Fe(i,n,"human",je,u=>nr(i,u,n))&&(i.activeAction="procreating",Oe(a,Pe.Procreate,i.position))}else if(e==="f")i.food.length>0&&(i.activeAction="eating",Oe(a,Pe.Eat,i.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const c=s.find(u=>u.type===ue.FeedChild);c&&c.targetEntity&&(i.activeAction="feeding",i.target=c.targetEntity.id)}else if(e==="arrowup"||e==="w")i.direction.y=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")i.direction.y=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")i.direction.x=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")i.direction.x=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const c=Fe(i,n,"human",vn,u=>Kr(i,u,n))??Fe(i,n,"predator",vn)??Fe(i,n,"prey",vn);c&&(i.activeAction="attacking",i.attackTargetId=c.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===ue.Plant)){const u=AR(i.position,n,50,Bg);u&&(i.activeAction="planting",i.target=u,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const c=Fe(i,n,"building",qt,f=>{const g=f;return g.buildingType===fe.Bonfire&&g.isConstructed&&g.storedItems.length<(g.storageCapacity||0)});if(((l=i.heldItem)==null?void 0:l.type)===vt.Wood&&c){i.activeAction="depositing",i.target=c.id,Oe(a,Pe.StorageDeposit,i.position);return}const u=Fe(i,n,"building",qt,f=>{const g=f;return g.buildingType===fe.StorageSpot&&g.ownerId===i.leaderId&&g.isConstructed&&g.storageCapacity!==void 0&&g.storedItems.length<g.storageCapacity});u&&(i.activeAction="idle",i.target=u.id,Oe(a,Pe.StorageDeposit,i.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const c=Fe(i,n,"building",qt,u=>{const f=u;return f.buildingType==="storageSpot"&&f.ownerId===i.leaderId&&f.isConstructed&&f.storedItems.length>0});c&&(i.activeAction="idle",i.target=c.id,Oe(a,Pe.StorageRetrieve,i.position))}else if(e==="k")VA(i,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,Oe(a,Pe.ButtonClick,i.position)}else if(e==="u"){if(t){n.autopilotControls.behaviors.roleManagement=!n.autopilotControls.behaviors.roleManagement;return}}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const c=Fe(i,n,"tree",Pu,u=>u.wood&&u.wood.length>0&&!i.heldItem);c&&(i.activeAction="chopping",i.target=c.id)}},DL=(e,t,n,i)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!i.current.has("arrowup")&&!i.current.has("arrowdown")&&!i.current.has("arrowleft")&&!i.current.has("arrowright")&&!i.current.has("w")&&!i.current.has("a")&&!i.current.has("s")&&!i.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!i.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!i.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!i.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!i.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!i.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},ML=(e,t,n)=>{const{mapDimensions:i}=e,{width:s,height:a}=i;if(!e.cameraFollowingPlayer){if(e.cameraTargetPosition){const u=Ye(t,e.cameraTargetPosition,s,a);if(Wr(u)<1){const v=e.cameraTargetPosition;return e.cameraTargetPosition=void 0,v}const g=zn(t,u);let m=Zd(t,g,iu*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return t}let c=At(e);if(e.debugCharacterId){const u=e.entities.entities[e.debugCharacterId];u&&"position"in u&&(c=u)}if(c){let u={...c.position};const f=u.x-t.x;Math.abs(f)>s/2&&(f>0?u.x-=s:u.x+=s);const g=u.y-t.y;Math.abs(g)>a/2&&(g>0?u.y-=a:u.y+=a);let m=Zd(t,u,iu*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return e.viewportCenter};function NL(e,t){const{width:n,height:i}=e.mapDimensions;e.cameraTargetPosition=void 0,e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%i+i)%i}}const OL=(e,t,n,i)=>{var u,f;const s={gameState:n},a=At(n);a&&Oe(s,Pe.ButtonClick,a.position);const l=n.uiButtons.find(g=>g.id===e.id);l&&(l.lastActivated=Date.now()),t&&[le.CommandGather,le.CommandPlant,le.ToggleProcreationBehavior,le.CommandBuild,le.OpenRoleManager].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:c}=n.autopilotControls;switch(e.action){case le.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case le.ConfirmExitYes:i(),n.exitConfirmation="inactive";break;case le.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case le.ToggleMute:n.isMuted=!n.isMuted,Pl(n.masterVolume,n.isMuted);break;case le.TogglePause:n.isPaused=!n.isPaused;break;case le.FastForward:return Xu(n,HA);case le.DismissTutorial:n.tutorialState.isActive=!1;break;case le.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case le.CommandGather:t?c.gathering=!c.gathering:a&&(a.activeAction="gathering");break;case le.CommandPlant:t?c.planting=!c.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case le.ToggleProcreationBehavior:c.procreation=!c.procreation;break;case le.ToggleAttackBehavior:c.attack=!c.attack;break;case le.ToggleFeedChildBehavior:c.feedChildren=!c.feedChildren;break;case le.CommandTribeSplit:a&&VA(a,n);break;case le.CommandBuild:t?c.build=!c.build:n.buildMenuOpen=!n.buildMenuOpen;break;case le.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case le.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case le.SelectRemovalTool:n.selectedBuildingType="removal";break;case le.SelectBorderPost:n.selectedBuildingType="borderPost";break;case le.SelectBonfire:n.selectedBuildingType="bonfire";break;case le.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const g=a.leaderId,m=e.targetTribeId,v=n.entities.entities[m],S=(u=a.tribeControl)==null?void 0:u.diplomacy,I=(f=v==null?void 0:v.tribeControl)==null?void 0:f.diplomacy;if(S&&I){const w=(S[m]||ut.Friendly)===ut.Friendly?ut.Hostile:ut.Friendly;S[m]=w,I[g]=w}}break;case le.OpenTribeModal:n.tribeModalOpen=!0;break;case le.RecenterCamera:n.cameraFollowingPlayer=!0;break;case le.CloseTribeModal:n.tribeModalOpen=!1;break;case le.OpenRoleManager:t?c.roleManagement=!c.roleManagement:n.roleManagerOpen=!0;break;case le.CloseRoleManager:n.roleManagerOpen=!1;break;case le.IncreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const g=a.tribeControl.roleWeights[e.targetRole]||0;g<10&&(a.tribeControl.roleWeights[e.targetRole]=g+1)}break;case le.DecreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const g=a.tribeControl.roleWeights[e.targetRole]||0;g>0&&(a.tribeControl.roleWeights[e.targetRole]=g-1)}break;case le.OpenArmyControl:n.armyControlOpen=!0;break;case le.CloseArmyControl:n.armyControlOpen=!1;break;case le.IncreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Xg,expandBorders:Vg,invadeEnemies:Kg});const g=a.tribeControl.armyControl[e.targetArmyObjective]||0;g<10&&(a.tribeControl.armyControl[e.targetArmyObjective]=g+1)}break;case le.DecreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Xg,expandBorders:Vg,invadeEnemies:Kg});const g=a.tribeControl.armyControl[e.targetArmyObjective]||0;g>0&&(a.tribeControl.armyControl[e.targetArmyObjective]=g-1)}break;case le.SwitchAIType:if(n.debugCharacterId){const g=n.entities.entities[n.debugCharacterId];g&&(g.aiType=g.aiType===$t.BehaviorTreeBased?$t.TaskBased:$t.BehaviorTreeBased)}break}return n};function bL(e,t,n){if(!e.notificationButtonRects)return!1;const i=At(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return SR(e,s),i&&Oe({gameState:e},Pe.ButtonClick,i.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const l=e.notifications.find(c=>c.id===s);if(l){let c=l.targetPosition;if(!c&&l.targetEntityIds&&l.targetEntityIds.length>0){const u=e.entities.entities[l.targetEntityIds[0]];u&&(c=u.position)}return c&&NL(e,c),i&&Oe({gameState:e},Pe.ButtonClick,i.position),l.highlightedEntityIds&&(l.renderHighlights=!l.renderHighlights),!0}}return!1}function WT(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const kL=(e,t)=>{var n;if(t.debugPanel!==Xe.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(WT(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},BL=(e,t)=>t.debugPanel!==Xe.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:WT(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Wv=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},FL=(e,t)=>{var n,i;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const l=t.debugPanelRect.height-60,c=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.height)??0)-l);return t.debugPanelScroll.y>c&&(t.debugPanelScroll.y=c),{newState:t,handled:!0}}return{newState:t,handled:!1}};function LL(e,t,n){if(!n.minimapRect)return;const{x:i,y:s,width:a,height:l}=n.minimapRect;e>=i&&e<=i+a&&t>=s&&t<=s+l&&(n.isDraggingMinimap=!0,n.minimapDragDistance=0)}function HL(e,t,n,i){n.isDraggingMinimap&&(n.isDraggingMinimap=!1,n.minimapDragDistance<5&&GL(e,t,n,i,!1))}function UL(e,t,n,i,s){if(!n.minimapRect){n.hoveredMinimapTribeId=null;return}if(n.isDraggingMinimap){if(i){n.minimapDragDistance+=Math.sqrt(i.x*i.x+i.y*i.y),n.cameraFollowingPlayer=!1,n.cameraTargetPosition=void 0;const{width:l,height:c}=n.mapDimensions,{width:u,height:f}=n.minimapRect,g=i.x/u*l,m=i.y/f*c,v=n.viewportCenter.x-g,S=n.viewportCenter.y-m,I={x:(v%l+l)%l,y:(S%c+c)%c};n.viewportCenter=I,s&&(s.current=I)}return}const a=xT(e,t,n.minimapRect,n);a?n.hoveredMinimapTribeId=jn(a.x,a.y,n):n.hoveredMinimapTribeId=null}function GL(e,t,n,i,s=!1){if(!n.minimapRect)return;const a=xT(e,t,n.minimapRect,n);a&&(n.cameraFollowingPlayer=!1,s?(n.viewportCenter=a,n.cameraTargetPosition=void 0,i&&(i.current=a)):n.cameraTargetPosition=a)}function $L(e,t,n,i,s){if(!i.minimapRect)return!1;const{x:a,y:l,width:c,height:u}=i.minimapRect;if(t>=a&&t<=a+c&&n>=l&&n<=l+u){i.cameraFollowingPlayer=!1,i.cameraTargetPosition=void 0;const{width:f,height:g}=i.mapDimensions,m=e.deltaX/c*f,v=e.deltaY/u*g,S=i.viewportCenter.x+m,I=i.viewportCenter.y+v,A={x:(S%f+f)%f,y:(I%g+g)%g};return i.viewportCenter=A,s&&(s.current=A),!0}return!1}function xT(e,t,n,i){const s=e-n.x,a=t-n.y;if(s<0||s>n.width||a<0||a>n.height)return null;const{width:l,height:c}=i.mapDimensions,u=n.width/2,f=n.height/2,g=s-u,m=a-f,v=g/n.width*l,S=m/n.height*c,I=i.viewportCenter.x+v,A=i.viewportCenter.y+S;return{x:(I%l+l)%l,y:(A%c+c)%c}}function WL(e,t,n){t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:i,height:s}=t.mapDimensions,a=t.viewportCenter.x+e.deltaX,l=t.viewportCenter.y+e.deltaY,c={x:(a%i+i)%i,y:(l%s+s)%s};return t.viewportCenter=c,n.current=c,!0}function xL(e,t){(e.button===1||e.button===2)&&(t.isDraggingViewport=!0,t.viewportDragButton=e.button,t.viewportDragDistance=0)}function YL(e,t,n){if(t.isDraggingViewport){t.viewportDragDistance+=Math.sqrt(e.movementX*e.movementX+e.movementY*e.movementY),t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:i,height:s}=t.mapDimensions,a=t.viewportCenter.x-e.movementX,l=t.viewportCenter.y-e.movementY,c={x:(a%i+i)%i,y:(l%s+s)%s};t.viewportCenter=c,n.current=c}}function zL(e,t){t.isDraggingViewport&&e.button===t.viewportDragButton&&(t.isDraggingViewport=!1,t.viewportDragButton=null)}const jL=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,returnToIntro:l})=>(Be.useEffect(()=>{const c=u=>{if(!e()||t.current.gameOver||!n.current)return;const f=n.current.getBoundingClientRect(),g=u.clientX-f.left,m=u.clientY-f.top;if($L(u,g,m,t.current,i)){u.preventDefault();return}const v=kL(u,t.current);t.current=v.newState,!v.handled&&WL(u,t.current,i)&&u.preventDefault()};return window.addEventListener("wheel",c,{passive:!1}),()=>{window.removeEventListener("wheel",c)}},[e,n,t,i]),Be.useEffect(()=>{const c=f=>{if(!e()||t.current.gameOver||!n.current||!f.target||f.target!==n.current)return;const g=n.current.getBoundingClientRect(),m=f.clientX-g.left,v=f.clientY-g.top;if(bL(t.current,m,v))return;const I=t.current.uiButtons.find(R=>m>=R.rect.x&&m<=R.rect.x+R.rect.width&&v>=R.rect.y&&v<=R.rect.y+R.rect.height);if(I){t.current=OL(I,f.shiftKey,t.current,l);return}const A=t.current.minimapRect;if(A&&m>=A.x&&m<=A.x+A.width&&v>=A.y&&v<=A.y+A.height){LL(m,v,t.current);return}const w=BL(f,t.current);if(t.current=w.newState,w.handled)return;xL(f,t.current);const P=np({x:m,y:v},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);_L(t.current,P)},u=f=>{if(!e()||!n.current)return;const g=n.current.getBoundingClientRect(),m=f.clientX-g.left,v=f.clientY-g.top;HL(m,v,t.current,i),zL(f,t.current);const S=Wv(f,t.current);t.current=S.newState};return window.addEventListener("mousedown",c),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",c),window.removeEventListener("mouseup",u)}},[e,n,t,i,l]),Be.useEffect(()=>{const c=u=>{if(!e()||!n.current)return;const f=FL(u,t.current);if(t.current=f.newState,f.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const P=Wv(u,t.current);t.current=P.newState}const g=n.current.getBoundingClientRect(),m=u.clientX-g.left,v=u.clientY-g.top;YL(u,t.current,i),t.current.mousePosition={x:m,y:v};let S;if(t.current.notificationButtonRects){for(const[P,R]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=R.x&&m<=R.x+R.width&&v>=R.y&&v<=R.y+R.height){S=`notification-dismiss-${P}`;break}if(!S){for(const[P,R]of Object.entries(t.current.notificationButtonRects.view))if(m>=R.x&&m<=R.x+R.width&&v>=R.y&&v<=R.y+R.height){S=`notification-view-${P}`;break}}}if(!S)for(let P=t.current.uiButtons.length-1;P>=0;P--){const R=t.current.uiButtons[P];if(m>=R.rect.x&&m<=R.rect.x+R.rect.width&&v>=R.rect.y&&v<=R.rect.y+R.rect.height){S=R.id;break}}if(t.current.hoveredButtonId=S,S){t.current.autopilotControls.hoveredAutopilotAction=void 0,t.current.hoveredMinimapTribeId=null;return}const I=t.current.minimapRect,A=t.current.isDraggingMinimap;if(I&&m>=I.x&&m<=I.x+I.width&&v>=I.y&&v<=I.y+I.height||A){UL(m,v,t.current,{x:u.movementX,y:u.movementY},i),t.current.autopilotControls.hoveredAutopilotAction=void 0;return}else t.current.hoveredMinimapTribeId=null;const w=At(t.current);if(w){const P=np({x:m,y:v},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=wL(P,w,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",c),()=>{window.removeEventListener("mousemove",c)}},[e,n,t,i]),Be.useEffect(()=>{const c=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();(g===" "||g==="p"||g==="tab"||(f.ctrlKey||f.metaKey)&&(g==="s"||g==="a"))&&f.preventDefault();const m=RL(f,t.current);if(t.current=m.newState,m.handled)return;const v=At(t.current);v&&(a.current.add(g),PL(g,f.shiftKey,t.current,v,s.current))},u=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();a.current.delete(g);const m=At(t.current);m&&DL(g,m,t.current,a)};return window.addEventListener("keydown",c),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",c),window.removeEventListener("keyup",u)}},[e,t,s,a,l]),Be.useEffect(()=>{const c=n.current;if(!c)return;const u=f=>{e()&&f.preventDefault()};return c.addEventListener("contextmenu",u),()=>{c.removeEventListener("contextmenu",u)}},[n,e]),null),XL=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,canvasRef:l,setAppState:c,appState:u})=>{const f=Be.useRef(),{returnToIntro:g}=Vr(),[m,v,S]=TI(I=>{var b,M;if(!t.current||!f.current){f.current=I;return}const A=Math.min(I-f.current,1e3)/1e3,{performanceMetrics:w}=e.current;w.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const P=performance.now();e.current=Xu(e.current,A),w.currentBucket.worldUpdateTime=performance.now()-P;const R=At(e.current);R?s.current=$p(e.current,R):s.current=[],(e.current.viewportCenter.x!==i.current.x||e.current.viewportCenter.y!==i.current.y)&&(i.current=e.current.viewportCenter),i.current=ML(e.current,i.current,A),e.current.viewportCenter=i.current;const _=performance.now();vu(t.current,e.current,i.current,s.current,{width:((b=l.current)==null?void 0:b.width)||800,height:((M=l.current)==null?void 0:M.height)||600},!1),w.currentBucket.renderTime=performance.now()-_,w.history.push({bucketTime:e.current.time,...w.currentBucket}),w.history.length>w_&&w.history.shift(),f.current=I,e.current.gameOver&&u!=="gameOver"&&(Lp(Pe.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),c("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return Be.useEffect(()=>(v(),m),[v,m]),He.jsx(jL,{isActive:S,gameStateRef:e,canvasRef:l,viewportCenterRef:i,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:g})},xv=()=>{const{savedGameState:e,contextReady:t}=Vr(),[n,i]=Be.useState(null);return Be.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),i(e)):(console.log("Initializing new game state..."),i(EL())))},[t,e]),!t||!n?He.jsx("div",{children:"Loading..."}):He.jsx(VL,{initialState:n})},VL=({initialState:e})=>{const t=Be.useRef(null),n=Be.useRef(null),i=Be.useRef(e),s=Be.useRef(new Set),a=Be.useRef(e.debugPanel),l=Be.useRef(e.viewportCenter),c=Be.useRef([]),{appState:u,setAppState:f}=Vr();return He.jsxs(He.Fragment,{children:[He.jsx(CL,{canvasRef:t,ctxRef:n,gameStateRef:i,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:c}),He.jsx(XL,{gameStateRef:i,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:c,keysPressed:s,canvasRef:t,setAppState:f,appState:u})]})},KL=kt.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,qL=kt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Ud=kt.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,ZL=kt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,QL=()=>{const{setAppState:e,gameOverDetails:t}=Vr(),n=()=>{e("intro")};return He.jsxs(KL,{children:[He.jsx(qL,{children:"Game Over"}),He.jsx(Ud,{children:"Your tribe's lineage has ended."}),t&&He.jsxs(He.Fragment,{children:[He.jsxs(Ud,{children:["Generations Survived: ",t.generations]}),He.jsxs(Ud,{children:["Cause of Extinction: ",t.cause]})]}),!t&&He.jsx(Ud,{children:"Game details are unavailable."}),He.jsx(ZL,{onClick:n,children:"Return to Menu"})]})},JL=kt.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,e2=kt.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,t2=kt.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,n2=kt.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,i2=kt.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,YT=kt.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,o2=kt(YT)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,ml=800,yl=600,r2=()=>{const{returnToIntro:e}=Vr(),t=Be.useRef(null),n=Be.useRef(),i=Be.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:ml,height:yl}}),s=l=>{const c={x:ml/2,y:yl/2};let u;l===_e.StoneProjectile&&(u={x:c.x+200*(Math.random()-Math.random()),y:c.y+200*(Math.random()-Math.random())}),$e(i.current,l,c,1,void 0,u)};Be.useEffect(()=>{const l=()=>{i.current.time+=.016,PT(i.current);const u=t.current,f=u==null?void 0:u.getContext("2d");f&&(f.clearRect(0,0,ml,yl),f.fillStyle="#2c5234",f.fillRect(0,0,ml,yl),i.current.visualEffects.forEach(g=>{GT(f,g,i.current.time,i.current)})),n.current=requestAnimationFrame(l)};return n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(_e).filter(l=>isNaN(Number(l))).map(l=>({name:l,value:_e[l]}));return He.jsxs(JL,{children:[He.jsxs(e2,{children:[He.jsx(i2,{children:"Visual Effects"}),a.map(l=>He.jsx(YT,{onClick:()=>s(l.value),children:l.name},l.name)),He.jsx(o2,{onClick:e,children:"Back to Intro"})]}),He.jsxs(t2,{children:[He.jsx(n2,{ref:t,width:ml,height:yl}),He.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},s2=S_`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function a2(e,t){Be.useEffect(()=>{const n=()=>{const i=document.location.hash;t(i==="#game"?"game":i==="#effects"?"effects":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),Be.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const l2=()=>{const{appState:e,setAppState:t}=Vr();a2(e,t);const n=()=>{switch(e){case"intro":return He.jsx($v,{});case"game":return He.jsx(xv,{});case"effects":return He.jsx(r2,{});case"gameOver":return He.jsxs(He.Fragment,{children:[He.jsx(xv,{}),He.jsx(QL,{})]});default:return He.jsx($v,{})}};return He.jsxs(He.Fragment,{children:[He.jsx(s2,{}),n()]})},Yv=document.getElementById("root");Yv?SD().then(()=>{QC.createRoot(Yv).render(He.jsx(Bi.StrictMode,{children:He.jsx(yw,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:He.jsx(l2,{})})}))}):console.error("Failed to find the root element");
