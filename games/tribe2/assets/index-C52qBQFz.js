var kT=Object.defineProperty;var DT=(e,t,i)=>t in e?kT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i;var Ht=(e,t,i)=>DT(e,typeof t!="symbol"?t+"":t,i);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function i(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=i(s);fetch(s.href,l)}})();function Ky(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var mf={exports:{}},ra={},yf={exports:{}},He={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o0;function OT(){if(o0)return He;o0=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),l=Symbol.for("react.provider"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.iterator;function A(D){return D===null||typeof D!="object"?null:(D=y&&D[y]||D["@@iterator"],typeof D=="function"?D:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,S={};function E(D,x,re){this.props=D,this.context=x,this.refs=S,this.updater=re||v}E.prototype.isReactComponent={},E.prototype.setState=function(D,x){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,x,"setState")},E.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function _(){}_.prototype=E.prototype;function w(D,x,re){this.props=D,this.context=x,this.refs=S,this.updater=re||v}var C=w.prototype=new _;C.constructor=w,I(C,E.prototype),C.isPureReactComponent=!0;var R=Array.isArray,b=Object.prototype.hasOwnProperty,M={current:null},B={key:!0,ref:!0,__self:!0,__source:!0};function F(D,x,re){var le,Ee={},ae=null,ye=null;if(x!=null)for(le in x.ref!==void 0&&(ye=x.ref),x.key!==void 0&&(ae=""+x.key),x)b.call(x,le)&&!B.hasOwnProperty(le)&&(Ee[le]=x[le]);var Se=arguments.length-2;if(Se===1)Ee.children=re;else if(1<Se){for(var ie=Array(Se),pe=0;pe<Se;pe++)ie[pe]=arguments[pe+2];Ee.children=ie}if(D&&D.defaultProps)for(le in Se=D.defaultProps,Se)Ee[le]===void 0&&(Ee[le]=Se[le]);return{$$typeof:e,type:D,key:ae,ref:ye,props:Ee,_owner:M.current}}function G(D,x){return{$$typeof:e,type:D.type,key:x,ref:D.ref,props:D.props,_owner:D._owner}}function Y(D){return typeof D=="object"&&D!==null&&D.$$typeof===e}function J(D){var x={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(re){return x[re]})}var z=/\/+/g;function te(D,x){return typeof D=="object"&&D!==null&&D.key!=null?J(""+D.key):x.toString(36)}function K(D,x,re,le,Ee){var ae=typeof D;(ae==="undefined"||ae==="boolean")&&(D=null);var ye=!1;if(D===null)ye=!0;else switch(ae){case"string":case"number":ye=!0;break;case"object":switch(D.$$typeof){case e:case t:ye=!0}}if(ye)return ye=D,Ee=Ee(ye),D=le===""?"."+te(ye,0):le,R(Ee)?(re="",D!=null&&(re=D.replace(z,"$&/")+"/"),K(Ee,x,re,"",function(pe){return pe})):Ee!=null&&(Y(Ee)&&(Ee=G(Ee,re+(!Ee.key||ye&&ye.key===Ee.key?"":(""+Ee.key).replace(z,"$&/")+"/")+D)),x.push(Ee)),1;if(ye=0,le=le===""?".":le+":",R(D))for(var Se=0;Se<D.length;Se++){ae=D[Se];var ie=le+te(ae,Se);ye+=K(ae,x,re,ie,Ee)}else if(ie=A(D),typeof ie=="function")for(D=ie.call(D),Se=0;!(ae=D.next()).done;)ae=ae.value,ie=le+te(ae,Se++),ye+=K(ae,x,re,ie,Ee);else if(ae==="object")throw x=String(D),Error("Objects are not valid as a React child (found: "+(x==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":x)+"). If you meant to render a collection of children, use an array instead.");return ye}function se(D,x,re){if(D==null)return D;var le=[],Ee=0;return K(D,le,"","",function(ae){return x.call(re,ae,Ee++)}),le}function ce(D){if(D._status===-1){var x=D._result;x=x(),x.then(function(re){(D._status===0||D._status===-1)&&(D._status=1,D._result=re)},function(re){(D._status===0||D._status===-1)&&(D._status=2,D._result=re)}),D._status===-1&&(D._status=0,D._result=x)}if(D._status===1)return D._result.default;throw D._result}var ne={current:null},$={transition:null},j={ReactCurrentDispatcher:ne,ReactCurrentBatchConfig:$,ReactCurrentOwner:M};function X(){throw Error("act(...) is not supported in production builds of React.")}return He.Children={map:se,forEach:function(D,x,re){se(D,function(){x.apply(this,arguments)},re)},count:function(D){var x=0;return se(D,function(){x++}),x},toArray:function(D){return se(D,function(x){return x})||[]},only:function(D){if(!Y(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},He.Component=E,He.Fragment=i,He.Profiler=s,He.PureComponent=w,He.StrictMode=o,He.Suspense=u,He.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=j,He.act=X,He.cloneElement=function(D,x,re){if(D==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+D+".");var le=I({},D.props),Ee=D.key,ae=D.ref,ye=D._owner;if(x!=null){if(x.ref!==void 0&&(ae=x.ref,ye=M.current),x.key!==void 0&&(Ee=""+x.key),D.type&&D.type.defaultProps)var Se=D.type.defaultProps;for(ie in x)b.call(x,ie)&&!B.hasOwnProperty(ie)&&(le[ie]=x[ie]===void 0&&Se!==void 0?Se[ie]:x[ie])}var ie=arguments.length-2;if(ie===1)le.children=re;else if(1<ie){Se=Array(ie);for(var pe=0;pe<ie;pe++)Se[pe]=arguments[pe+2];le.children=Se}return{$$typeof:e,type:D.type,key:Ee,ref:ae,props:le,_owner:ye}},He.createContext=function(D){return D={$$typeof:c,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},D.Provider={$$typeof:l,_context:D},D.Consumer=D},He.createElement=F,He.createFactory=function(D){var x=F.bind(null,D);return x.type=D,x},He.createRef=function(){return{current:null}},He.forwardRef=function(D){return{$$typeof:d,render:D}},He.isValidElement=Y,He.lazy=function(D){return{$$typeof:p,_payload:{_status:-1,_result:D},_init:ce}},He.memo=function(D,x){return{$$typeof:h,type:D,compare:x===void 0?null:x}},He.startTransition=function(D){var x=$.transition;$.transition={};try{D()}finally{$.transition=x}},He.unstable_act=X,He.useCallback=function(D,x){return ne.current.useCallback(D,x)},He.useContext=function(D){return ne.current.useContext(D)},He.useDebugValue=function(){},He.useDeferredValue=function(D){return ne.current.useDeferredValue(D)},He.useEffect=function(D,x){return ne.current.useEffect(D,x)},He.useId=function(){return ne.current.useId()},He.useImperativeHandle=function(D,x,re){return ne.current.useImperativeHandle(D,x,re)},He.useInsertionEffect=function(D,x){return ne.current.useInsertionEffect(D,x)},He.useLayoutEffect=function(D,x){return ne.current.useLayoutEffect(D,x)},He.useMemo=function(D,x){return ne.current.useMemo(D,x)},He.useReducer=function(D,x,re){return ne.current.useReducer(D,x,re)},He.useRef=function(D){return ne.current.useRef(D)},He.useState=function(D){return ne.current.useState(D)},He.useSyncExternalStore=function(D,x,re){return ne.current.useSyncExternalStore(D,x,re)},He.useTransition=function(){return ne.current.useTransition()},He.version="18.3.1",He}var r0;function Eh(){return r0||(r0=1,yf.exports=OT()),yf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var s0;function bT(){if(s0)return ra;s0=1;var e=Eh(),t=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(d,u,h){var p,y={},A=null,v=null;h!==void 0&&(A=""+h),u.key!==void 0&&(A=""+u.key),u.ref!==void 0&&(v=u.ref);for(p in u)o.call(u,p)&&!l.hasOwnProperty(p)&&(y[p]=u[p]);if(d&&d.defaultProps)for(p in u=d.defaultProps,u)y[p]===void 0&&(y[p]=u[p]);return{$$typeof:t,type:d,key:A,ref:v,props:y,_owner:s.current}}return ra.Fragment=i,ra.jsx=c,ra.jsxs=c,ra}var a0;function NT(){return a0||(a0=1,mf.exports=bT()),mf.exports}var ke=NT(),Re=Eh();const fi=Ky(Re);var dc={},vf={exports:{}},dn={},Af={exports:{}},If={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l0;function BT(){return l0||(l0=1,function(e){function t($,j){var X=$.length;$.push(j);e:for(;0<X;){var D=X-1>>>1,x=$[D];if(0<s(x,j))$[D]=j,$[X]=x,X=D;else break e}}function i($){return $.length===0?null:$[0]}function o($){if($.length===0)return null;var j=$[0],X=$.pop();if(X!==j){$[0]=X;e:for(var D=0,x=$.length,re=x>>>1;D<re;){var le=2*(D+1)-1,Ee=$[le],ae=le+1,ye=$[ae];if(0>s(Ee,X))ae<x&&0>s(ye,Ee)?($[D]=ye,$[ae]=X,D=ae):($[D]=Ee,$[le]=X,D=le);else if(ae<x&&0>s(ye,X))$[D]=ye,$[ae]=X,D=ae;else break e}}return j}function s($,j){var X=$.sortIndex-j.sortIndex;return X!==0?X:$.id-j.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;e.unstable_now=function(){return l.now()}}else{var c=Date,d=c.now();e.unstable_now=function(){return c.now()-d}}var u=[],h=[],p=1,y=null,A=3,v=!1,I=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,_=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function C($){for(var j=i(h);j!==null;){if(j.callback===null)o(h);else if(j.startTime<=$)o(h),j.sortIndex=j.expirationTime,t(u,j);else break;j=i(h)}}function R($){if(S=!1,C($),!I)if(i(u)!==null)I=!0,ce(b);else{var j=i(h);j!==null&&ne(R,j.startTime-$)}}function b($,j){I=!1,S&&(S=!1,_(F),F=-1),v=!0;var X=A;try{for(C(j),y=i(u);y!==null&&(!(y.expirationTime>j)||$&&!J());){var D=y.callback;if(typeof D=="function"){y.callback=null,A=y.priorityLevel;var x=D(y.expirationTime<=j);j=e.unstable_now(),typeof x=="function"?y.callback=x:y===i(u)&&o(u),C(j)}else o(u);y=i(u)}if(y!==null)var re=!0;else{var le=i(h);le!==null&&ne(R,le.startTime-j),re=!1}return re}finally{y=null,A=X,v=!1}}var M=!1,B=null,F=-1,G=5,Y=-1;function J(){return!(e.unstable_now()-Y<G)}function z(){if(B!==null){var $=e.unstable_now();Y=$;var j=!0;try{j=B(!0,$)}finally{j?te():(M=!1,B=null)}}else M=!1}var te;if(typeof w=="function")te=function(){w(z)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,se=K.port2;K.port1.onmessage=z,te=function(){se.postMessage(null)}}else te=function(){E(z,0)};function ce($){B=$,M||(M=!0,te())}function ne($,j){F=E(function(){$(e.unstable_now())},j)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function($){$.callback=null},e.unstable_continueExecution=function(){I||v||(I=!0,ce(b))},e.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<$?Math.floor(1e3/$):5},e.unstable_getCurrentPriorityLevel=function(){return A},e.unstable_getFirstCallbackNode=function(){return i(u)},e.unstable_next=function($){switch(A){case 1:case 2:case 3:var j=3;break;default:j=A}var X=A;A=j;try{return $()}finally{A=X}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function($,j){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var X=A;A=$;try{return j()}finally{A=X}},e.unstable_scheduleCallback=function($,j,X){var D=e.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?D+X:D):X=D,$){case 1:var x=-1;break;case 2:x=250;break;case 5:x=1073741823;break;case 4:x=1e4;break;default:x=5e3}return x=X+x,$={id:p++,callback:j,priorityLevel:$,startTime:X,expirationTime:x,sortIndex:-1},X>D?($.sortIndex=X,t(h,$),i(u)===null&&$===i(h)&&(S?(_(F),F=-1):S=!0,ne(R,X-D))):($.sortIndex=x,t(u,$),I||v||(I=!0,ce(b))),$},e.unstable_shouldYield=J,e.unstable_wrapCallback=function($){var j=A;return function(){var X=A;A=j;try{return $.apply(this,arguments)}finally{A=X}}}}(If)),If}var c0;function HT(){return c0||(c0=1,Af.exports=BT()),Af.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u0;function FT(){if(u0)return dn;u0=1;var e=Eh(),t=HT();function i(n){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+n,a=1;a<arguments.length;a++)r+="&args[]="+encodeURIComponent(arguments[a]);return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function l(n,r){c(n,r),c(n+"Capture",r)}function c(n,r){for(s[n]=r,n=0;n<r.length;n++)o.add(r[n])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},y={};function A(n){return u.call(y,n)?!0:u.call(p,n)?!1:h.test(n)?y[n]=!0:(p[n]=!0,!1)}function v(n,r,a,f){if(a!==null&&a.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return f?!1:a!==null?!a.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function I(n,r,a,f){if(r===null||typeof r>"u"||v(n,r,a,f))return!0;if(f)return!1;if(a!==null)switch(a.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function S(n,r,a,f,g,m,T){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=f,this.attributeNamespace=g,this.mustUseProperty=a,this.propertyName=n,this.type=r,this.sanitizeURL=m,this.removeEmptyString=T}var E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){E[n]=new S(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var r=n[0];E[r]=new S(r,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){E[n]=new S(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){E[n]=new S(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){E[n]=new S(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){E[n]=new S(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){E[n]=new S(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){E[n]=new S(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){E[n]=new S(n,5,!1,n.toLowerCase(),null,!1,!1)});var _=/[\-:]([a-z])/g;function w(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var r=n.replace(_,w);E[r]=new S(r,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var r=n.replace(_,w);E[r]=new S(r,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var r=n.replace(_,w);E[r]=new S(r,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){E[n]=new S(n,1,!1,n.toLowerCase(),null,!1,!1)}),E.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){E[n]=new S(n,1,!1,n.toLowerCase(),null,!0,!0)});function C(n,r,a,f){var g=E.hasOwnProperty(r)?E[r]:null;(g!==null?g.type!==0:f||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(I(r,a,g,f)&&(a=null),f||g===null?A(r)&&(a===null?n.removeAttribute(r):n.setAttribute(r,""+a)):g.mustUseProperty?n[g.propertyName]=a===null?g.type===3?!1:"":a:(r=g.attributeName,f=g.attributeNamespace,a===null?n.removeAttribute(r):(g=g.type,a=g===3||g===4&&a===!0?"":""+a,f?n.setAttributeNS(f,r,a):n.setAttribute(r,a))))}var R=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,b=Symbol.for("react.element"),M=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),Y=Symbol.for("react.provider"),J=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),te=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),se=Symbol.for("react.memo"),ce=Symbol.for("react.lazy"),ne=Symbol.for("react.offscreen"),$=Symbol.iterator;function j(n){return n===null||typeof n!="object"?null:(n=$&&n[$]||n["@@iterator"],typeof n=="function"?n:null)}var X=Object.assign,D;function x(n){if(D===void 0)try{throw Error()}catch(a){var r=a.stack.trim().match(/\n( *(at )?)/);D=r&&r[1]||""}return`
`+D+n}var re=!1;function le(n,r){if(!n||re)return"";re=!0;var a=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(U){var f=U}Reflect.construct(n,[],r)}else{try{r.call()}catch(U){f=U}n.call(r.prototype)}else{try{throw Error()}catch(U){f=U}n()}}catch(U){if(U&&f&&typeof U.stack=="string"){for(var g=U.stack.split(`
`),m=f.stack.split(`
`),T=g.length-1,P=m.length-1;1<=T&&0<=P&&g[T]!==m[P];)P--;for(;1<=T&&0<=P;T--,P--)if(g[T]!==m[P]){if(T!==1||P!==1)do if(T--,P--,0>P||g[T]!==m[P]){var k=`
`+g[T].replace(" at new "," at ");return n.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",n.displayName)),k}while(1<=T&&0<=P);break}}}finally{re=!1,Error.prepareStackTrace=a}return(n=n?n.displayName||n.name:"")?x(n):""}function Ee(n){switch(n.tag){case 5:return x(n.type);case 16:return x("Lazy");case 13:return x("Suspense");case 19:return x("SuspenseList");case 0:case 2:case 15:return n=le(n.type,!1),n;case 11:return n=le(n.type.render,!1),n;case 1:return n=le(n.type,!0),n;default:return""}}function ae(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case B:return"Fragment";case M:return"Portal";case G:return"Profiler";case F:return"StrictMode";case te:return"Suspense";case K:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case J:return(n.displayName||"Context")+".Consumer";case Y:return(n._context.displayName||"Context")+".Provider";case z:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case se:return r=n.displayName||null,r!==null?r:ae(n.type)||"Memo";case ce:r=n._payload,n=n._init;try{return ae(n(r))}catch{}}return null}function ye(n){var r=n.type;switch(n.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=r.render,n=n.displayName||n.name||"",r.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ae(r);case 8:return r===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Se(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function ie(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function pe(n){var r=ie(n)?"checked":"value",a=Object.getOwnPropertyDescriptor(n.constructor.prototype,r),f=""+n[r];if(!n.hasOwnProperty(r)&&typeof a<"u"&&typeof a.get=="function"&&typeof a.set=="function"){var g=a.get,m=a.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return g.call(this)},set:function(T){f=""+T,m.call(this,T)}}),Object.defineProperty(n,r,{enumerable:a.enumerable}),{getValue:function(){return f},setValue:function(T){f=""+T},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function Ne(n){n._valueTracker||(n._valueTracker=pe(n))}function Te(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var a=r.getValue(),f="";return n&&(f=ie(n)?n.checked?"true":"false":n.value),n=f,n!==a?(r.setValue(n),!0):!1}function En(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Qe(n,r){var a=r.checked;return X({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:a??n._wrapperState.initialChecked})}function Ze(n,r){var a=r.defaultValue==null?"":r.defaultValue,f=r.checked!=null?r.checked:r.defaultChecked;a=Se(r.value!=null?r.value:a),n._wrapperState={initialChecked:f,initialValue:a,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function wn(n,r){r=r.checked,r!=null&&C(n,"checked",r,!1)}function rn(n,r){wn(n,r);var a=Se(r.value),f=r.type;if(a!=null)f==="number"?(a===0&&n.value===""||n.value!=a)&&(n.value=""+a):n.value!==""+a&&(n.value=""+a);else if(f==="submit"||f==="reset"){n.removeAttribute("value");return}r.hasOwnProperty("value")?Jn(n,r.type,a):r.hasOwnProperty("defaultValue")&&Jn(n,r.type,Se(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(n.defaultChecked=!!r.defaultChecked)}function Cn(n,r,a){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var f=r.type;if(!(f!=="submit"&&f!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+n._wrapperState.initialValue,a||r===n.value||(n.value=r),n.defaultValue=r}a=n.name,a!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,a!==""&&(n.name=a)}function Jn(n,r,a){(r!=="number"||En(n.ownerDocument)!==n)&&(a==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+a&&(n.defaultValue=""+a))}var ei=Array.isArray;function Wi(n,r,a,f){if(n=n.options,r){r={};for(var g=0;g<a.length;g++)r["$"+a[g]]=!0;for(a=0;a<n.length;a++)g=r.hasOwnProperty("$"+n[a].value),n[a].selected!==g&&(n[a].selected=g),g&&f&&(n[a].defaultSelected=!0)}else{for(a=""+Se(a),r=null,g=0;g<n.length;g++){if(n[g].value===a){n[g].selected=!0,f&&(n[g].defaultSelected=!0);return}r!==null||n[g].disabled||(r=n[g])}r!==null&&(r.selected=!0)}}function Mo(n,r){if(r.dangerouslySetInnerHTML!=null)throw Error(i(91));return X({},r,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function pp(n,r){var a=r.value;if(a==null){if(a=r.children,r=r.defaultValue,a!=null){if(r!=null)throw Error(i(92));if(ei(a)){if(1<a.length)throw Error(i(93));a=a[0]}r=a}r==null&&(r=""),a=r}n._wrapperState={initialValue:Se(a)}}function gp(n,r){var a=Se(r.value),f=Se(r.defaultValue);a!=null&&(a=""+a,a!==n.value&&(n.value=a),r.defaultValue==null&&n.defaultValue!==a&&(n.defaultValue=a)),f!=null&&(n.defaultValue=""+f)}function mp(n){var r=n.textContent;r===n._wrapperState.initialValue&&r!==""&&r!==null&&(n.value=r)}function yp(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _u(n,r){return n==null||n==="http://www.w3.org/1999/xhtml"?yp(r):n==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var il,vp=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,a,f,g){MSApp.execUnsafeLocalFunction(function(){return n(r,a,f,g)})}:n}(function(n,r){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=r;else{for(il=il||document.createElement("div"),il.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=il.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;r.firstChild;)n.appendChild(r.firstChild)}});function Ss(n,r){if(r){var a=n.firstChild;if(a&&a===n.lastChild&&a.nodeType===3){a.nodeValue=r;return}}n.textContent=r}var Ts={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},NI=["Webkit","ms","Moz","O"];Object.keys(Ts).forEach(function(n){NI.forEach(function(r){r=r+n.charAt(0).toUpperCase()+n.substring(1),Ts[r]=Ts[n]})});function Ap(n,r,a){return r==null||typeof r=="boolean"||r===""?"":a||typeof r!="number"||r===0||Ts.hasOwnProperty(n)&&Ts[n]?(""+r).trim():r+"px"}function Ip(n,r){n=n.style;for(var a in r)if(r.hasOwnProperty(a)){var f=a.indexOf("--")===0,g=Ap(a,r[a],f);a==="float"&&(a="cssFloat"),f?n.setProperty(a,g):n[a]=g}}var BI=X({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Pu(n,r){if(r){if(BI[n]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(i(137,n));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(i(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(i(61))}if(r.style!=null&&typeof r.style!="object")throw Error(i(62))}}function Ru(n,r){if(n.indexOf("-")===-1)return typeof r.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Mu=null;function ku(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Du=null,vr=null,Ar=null;function Sp(n){if(n=Ys(n)){if(typeof Du!="function")throw Error(i(280));var r=n.stateNode;r&&(r=_l(r),Du(n.stateNode,n.type,r))}}function Tp(n){vr?Ar?Ar.push(n):Ar=[n]:vr=n}function Ep(){if(vr){var n=vr,r=Ar;if(Ar=vr=null,Sp(n),r)for(n=0;n<r.length;n++)Sp(r[n])}}function wp(n,r){return n(r)}function Cp(){}var Ou=!1;function _p(n,r,a){if(Ou)return n(r,a);Ou=!0;try{return wp(n,r,a)}finally{Ou=!1,(vr!==null||Ar!==null)&&(Cp(),Ep())}}function Es(n,r){var a=n.stateNode;if(a===null)return null;var f=_l(a);if(f===null)return null;a=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(n=n.type,f=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!f;break e;default:n=!1}if(n)return null;if(a&&typeof a!="function")throw Error(i(231,r,typeof a));return a}var bu=!1;if(d)try{var ws={};Object.defineProperty(ws,"passive",{get:function(){bu=!0}}),window.addEventListener("test",ws,ws),window.removeEventListener("test",ws,ws)}catch{bu=!1}function HI(n,r,a,f,g,m,T,P,k){var U=Array.prototype.slice.call(arguments,3);try{r.apply(a,U)}catch(Z){this.onError(Z)}}var Cs=!1,ol=null,rl=!1,Nu=null,FI={onError:function(n){Cs=!0,ol=n}};function LI(n,r,a,f,g,m,T,P,k){Cs=!1,ol=null,HI.apply(FI,arguments)}function UI(n,r,a,f,g,m,T,P,k){if(LI.apply(this,arguments),Cs){if(Cs){var U=ol;Cs=!1,ol=null}else throw Error(i(198));rl||(rl=!0,Nu=U)}}function ko(n){var r=n,a=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,(r.flags&4098)!==0&&(a=r.return),n=r.return;while(n)}return r.tag===3?a:null}function Pp(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function Rp(n){if(ko(n)!==n)throw Error(i(188))}function GI(n){var r=n.alternate;if(!r){if(r=ko(n),r===null)throw Error(i(188));return r!==n?null:n}for(var a=n,f=r;;){var g=a.return;if(g===null)break;var m=g.alternate;if(m===null){if(f=g.return,f!==null){a=f;continue}break}if(g.child===m.child){for(m=g.child;m;){if(m===a)return Rp(g),n;if(m===f)return Rp(g),r;m=m.sibling}throw Error(i(188))}if(a.return!==f.return)a=g,f=m;else{for(var T=!1,P=g.child;P;){if(P===a){T=!0,a=g,f=m;break}if(P===f){T=!0,f=g,a=m;break}P=P.sibling}if(!T){for(P=m.child;P;){if(P===a){T=!0,a=m,f=g;break}if(P===f){T=!0,f=m,a=g;break}P=P.sibling}if(!T)throw Error(i(189))}}if(a.alternate!==f)throw Error(i(190))}if(a.tag!==3)throw Error(i(188));return a.stateNode.current===a?n:r}function Mp(n){return n=GI(n),n!==null?kp(n):null}function kp(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var r=kp(n);if(r!==null)return r;n=n.sibling}return null}var Dp=t.unstable_scheduleCallback,Op=t.unstable_cancelCallback,xI=t.unstable_shouldYield,$I=t.unstable_requestPaint,ht=t.unstable_now,WI=t.unstable_getCurrentPriorityLevel,Bu=t.unstable_ImmediatePriority,bp=t.unstable_UserBlockingPriority,sl=t.unstable_NormalPriority,YI=t.unstable_LowPriority,Np=t.unstable_IdlePriority,al=null,ti=null;function zI(n){if(ti&&typeof ti.onCommitFiberRoot=="function")try{ti.onCommitFiberRoot(al,n,void 0,(n.current.flags&128)===128)}catch{}}var Un=Math.clz32?Math.clz32:VI,jI=Math.log,XI=Math.LN2;function VI(n){return n>>>=0,n===0?32:31-(jI(n)/XI|0)|0}var ll=64,cl=4194304;function _s(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ul(n,r){var a=n.pendingLanes;if(a===0)return 0;var f=0,g=n.suspendedLanes,m=n.pingedLanes,T=a&268435455;if(T!==0){var P=T&~g;P!==0?f=_s(P):(m&=T,m!==0&&(f=_s(m)))}else T=a&~g,T!==0?f=_s(T):m!==0&&(f=_s(m));if(f===0)return 0;if(r!==0&&r!==f&&(r&g)===0&&(g=f&-f,m=r&-r,g>=m||g===16&&(m&4194240)!==0))return r;if((f&4)!==0&&(f|=a&16),r=n.entangledLanes,r!==0)for(n=n.entanglements,r&=f;0<r;)a=31-Un(r),g=1<<a,f|=n[a],r&=~g;return f}function qI(n,r){switch(n){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ZI(n,r){for(var a=n.suspendedLanes,f=n.pingedLanes,g=n.expirationTimes,m=n.pendingLanes;0<m;){var T=31-Un(m),P=1<<T,k=g[T];k===-1?((P&a)===0||(P&f)!==0)&&(g[T]=qI(P,r)):k<=r&&(n.expiredLanes|=P),m&=~P}}function Hu(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Bp(){var n=ll;return ll<<=1,(ll&4194240)===0&&(ll=64),n}function Fu(n){for(var r=[],a=0;31>a;a++)r.push(n);return r}function Ps(n,r,a){n.pendingLanes|=r,r!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,r=31-Un(r),n[r]=a}function KI(n,r){var a=n.pendingLanes&~r;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=r,n.mutableReadLanes&=r,n.entangledLanes&=r,r=n.entanglements;var f=n.eventTimes;for(n=n.expirationTimes;0<a;){var g=31-Un(a),m=1<<g;r[g]=0,f[g]=-1,n[g]=-1,a&=~m}}function Lu(n,r){var a=n.entangledLanes|=r;for(n=n.entanglements;a;){var f=31-Un(a),g=1<<f;g&r|n[f]&r&&(n[f]|=r),a&=~g}}var ze=0;function Hp(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var Fp,Uu,Lp,Up,Gp,Gu=!1,dl=[],Yi=null,zi=null,ji=null,Rs=new Map,Ms=new Map,Xi=[],QI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function xp(n,r){switch(n){case"focusin":case"focusout":Yi=null;break;case"dragenter":case"dragleave":zi=null;break;case"mouseover":case"mouseout":ji=null;break;case"pointerover":case"pointerout":Rs.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ms.delete(r.pointerId)}}function ks(n,r,a,f,g,m){return n===null||n.nativeEvent!==m?(n={blockedOn:r,domEventName:a,eventSystemFlags:f,nativeEvent:m,targetContainers:[g]},r!==null&&(r=Ys(r),r!==null&&Uu(r)),n):(n.eventSystemFlags|=f,r=n.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),n)}function JI(n,r,a,f,g){switch(r){case"focusin":return Yi=ks(Yi,n,r,a,f,g),!0;case"dragenter":return zi=ks(zi,n,r,a,f,g),!0;case"mouseover":return ji=ks(ji,n,r,a,f,g),!0;case"pointerover":var m=g.pointerId;return Rs.set(m,ks(Rs.get(m)||null,n,r,a,f,g)),!0;case"gotpointercapture":return m=g.pointerId,Ms.set(m,ks(Ms.get(m)||null,n,r,a,f,g)),!0}return!1}function $p(n){var r=Do(n.target);if(r!==null){var a=ko(r);if(a!==null){if(r=a.tag,r===13){if(r=Pp(a),r!==null){n.blockedOn=r,Gp(n.priority,function(){Lp(a)});return}}else if(r===3&&a.stateNode.current.memoizedState.isDehydrated){n.blockedOn=a.tag===3?a.stateNode.containerInfo:null;return}}}n.blockedOn=null}function fl(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var a=$u(n.domEventName,n.eventSystemFlags,r[0],n.nativeEvent);if(a===null){a=n.nativeEvent;var f=new a.constructor(a.type,a);Mu=f,a.target.dispatchEvent(f),Mu=null}else return r=Ys(a),r!==null&&Uu(r),n.blockedOn=a,!1;r.shift()}return!0}function Wp(n,r,a){fl(n)&&a.delete(r)}function eS(){Gu=!1,Yi!==null&&fl(Yi)&&(Yi=null),zi!==null&&fl(zi)&&(zi=null),ji!==null&&fl(ji)&&(ji=null),Rs.forEach(Wp),Ms.forEach(Wp)}function Ds(n,r){n.blockedOn===r&&(n.blockedOn=null,Gu||(Gu=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,eS)))}function Os(n){function r(g){return Ds(g,n)}if(0<dl.length){Ds(dl[0],n);for(var a=1;a<dl.length;a++){var f=dl[a];f.blockedOn===n&&(f.blockedOn=null)}}for(Yi!==null&&Ds(Yi,n),zi!==null&&Ds(zi,n),ji!==null&&Ds(ji,n),Rs.forEach(r),Ms.forEach(r),a=0;a<Xi.length;a++)f=Xi[a],f.blockedOn===n&&(f.blockedOn=null);for(;0<Xi.length&&(a=Xi[0],a.blockedOn===null);)$p(a),a.blockedOn===null&&Xi.shift()}var Ir=R.ReactCurrentBatchConfig,hl=!0;function tS(n,r,a,f){var g=ze,m=Ir.transition;Ir.transition=null;try{ze=1,xu(n,r,a,f)}finally{ze=g,Ir.transition=m}}function nS(n,r,a,f){var g=ze,m=Ir.transition;Ir.transition=null;try{ze=4,xu(n,r,a,f)}finally{ze=g,Ir.transition=m}}function xu(n,r,a,f){if(hl){var g=$u(n,r,a,f);if(g===null)rd(n,r,f,pl,a),xp(n,f);else if(JI(g,n,r,a,f))f.stopPropagation();else if(xp(n,f),r&4&&-1<QI.indexOf(n)){for(;g!==null;){var m=Ys(g);if(m!==null&&Fp(m),m=$u(n,r,a,f),m===null&&rd(n,r,f,pl,a),m===g)break;g=m}g!==null&&f.stopPropagation()}else rd(n,r,f,null,a)}}var pl=null;function $u(n,r,a,f){if(pl=null,n=ku(f),n=Do(n),n!==null)if(r=ko(n),r===null)n=null;else if(a=r.tag,a===13){if(n=Pp(r),n!==null)return n;n=null}else if(a===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null);return pl=n,null}function Yp(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(WI()){case Bu:return 1;case bp:return 4;case sl:case YI:return 16;case Np:return 536870912;default:return 16}default:return 16}}var Vi=null,Wu=null,gl=null;function zp(){if(gl)return gl;var n,r=Wu,a=r.length,f,g="value"in Vi?Vi.value:Vi.textContent,m=g.length;for(n=0;n<a&&r[n]===g[n];n++);var T=a-n;for(f=1;f<=T&&r[a-f]===g[m-f];f++);return gl=g.slice(n,1<f?1-f:void 0)}function ml(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function yl(){return!0}function jp(){return!1}function pn(n){function r(a,f,g,m,T){this._reactName=a,this._targetInst=g,this.type=f,this.nativeEvent=m,this.target=T,this.currentTarget=null;for(var P in n)n.hasOwnProperty(P)&&(a=n[P],this[P]=a?a(m):m[P]);return this.isDefaultPrevented=(m.defaultPrevented!=null?m.defaultPrevented:m.returnValue===!1)?yl:jp,this.isPropagationStopped=jp,this}return X(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():typeof a.returnValue!="unknown"&&(a.returnValue=!1),this.isDefaultPrevented=yl)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():typeof a.cancelBubble!="unknown"&&(a.cancelBubble=!0),this.isPropagationStopped=yl)},persist:function(){},isPersistent:yl}),r}var Sr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Yu=pn(Sr),bs=X({},Sr,{view:0,detail:0}),iS=pn(bs),zu,ju,Ns,vl=X({},bs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Vu,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Ns&&(Ns&&n.type==="mousemove"?(zu=n.screenX-Ns.screenX,ju=n.screenY-Ns.screenY):ju=zu=0,Ns=n),zu)},movementY:function(n){return"movementY"in n?n.movementY:ju}}),Xp=pn(vl),oS=X({},vl,{dataTransfer:0}),rS=pn(oS),sS=X({},bs,{relatedTarget:0}),Xu=pn(sS),aS=X({},Sr,{animationName:0,elapsedTime:0,pseudoElement:0}),lS=pn(aS),cS=X({},Sr,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),uS=pn(cS),dS=X({},Sr,{data:0}),Vp=pn(dS),fS={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hS={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},pS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gS(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=pS[n])?!!r[n]:!1}function Vu(){return gS}var mS=X({},bs,{key:function(n){if(n.key){var r=fS[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=ml(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?hS[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Vu,charCode:function(n){return n.type==="keypress"?ml(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ml(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),yS=pn(mS),vS=X({},vl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qp=pn(vS),AS=X({},bs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Vu}),IS=pn(AS),SS=X({},Sr,{propertyName:0,elapsedTime:0,pseudoElement:0}),TS=pn(SS),ES=X({},vl,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),wS=pn(ES),CS=[9,13,27,32],qu=d&&"CompositionEvent"in window,Bs=null;d&&"documentMode"in document&&(Bs=document.documentMode);var _S=d&&"TextEvent"in window&&!Bs,Zp=d&&(!qu||Bs&&8<Bs&&11>=Bs),Kp=" ",Qp=!1;function Jp(n,r){switch(n){case"keyup":return CS.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function eg(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Tr=!1;function PS(n,r){switch(n){case"compositionend":return eg(r);case"keypress":return r.which!==32?null:(Qp=!0,Kp);case"textInput":return n=r.data,n===Kp&&Qp?null:n;default:return null}}function RS(n,r){if(Tr)return n==="compositionend"||!qu&&Jp(n,r)?(n=zp(),gl=Wu=Vi=null,Tr=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Zp&&r.locale!=="ko"?null:r.data;default:return null}}var MS={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function tg(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!MS[n.type]:r==="textarea"}function ng(n,r,a,f){Tp(f),r=El(r,"onChange"),0<r.length&&(a=new Yu("onChange","change",null,a,f),n.push({event:a,listeners:r}))}var Hs=null,Fs=null;function kS(n){Ig(n,0)}function Al(n){var r=Pr(n);if(Te(r))return n}function DS(n,r){if(n==="change")return r}var ig=!1;if(d){var Zu;if(d){var Ku="oninput"in document;if(!Ku){var og=document.createElement("div");og.setAttribute("oninput","return;"),Ku=typeof og.oninput=="function"}Zu=Ku}else Zu=!1;ig=Zu&&(!document.documentMode||9<document.documentMode)}function rg(){Hs&&(Hs.detachEvent("onpropertychange",sg),Fs=Hs=null)}function sg(n){if(n.propertyName==="value"&&Al(Fs)){var r=[];ng(r,Fs,n,ku(n)),_p(kS,r)}}function OS(n,r,a){n==="focusin"?(rg(),Hs=r,Fs=a,Hs.attachEvent("onpropertychange",sg)):n==="focusout"&&rg()}function bS(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Al(Fs)}function NS(n,r){if(n==="click")return Al(r)}function BS(n,r){if(n==="input"||n==="change")return Al(r)}function HS(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var Gn=typeof Object.is=="function"?Object.is:HS;function Ls(n,r){if(Gn(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var a=Object.keys(n),f=Object.keys(r);if(a.length!==f.length)return!1;for(f=0;f<a.length;f++){var g=a[f];if(!u.call(r,g)||!Gn(n[g],r[g]))return!1}return!0}function ag(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function lg(n,r){var a=ag(n);n=0;for(var f;a;){if(a.nodeType===3){if(f=n+a.textContent.length,n<=r&&f>=r)return{node:a,offset:r-n};n=f}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=ag(a)}}function cg(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?cg(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function ug(){for(var n=window,r=En();r instanceof n.HTMLIFrameElement;){try{var a=typeof r.contentWindow.location.href=="string"}catch{a=!1}if(a)n=r.contentWindow;else break;r=En(n.document)}return r}function Qu(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}function FS(n){var r=ug(),a=n.focusedElem,f=n.selectionRange;if(r!==a&&a&&a.ownerDocument&&cg(a.ownerDocument.documentElement,a)){if(f!==null&&Qu(a)){if(r=f.start,n=f.end,n===void 0&&(n=r),"selectionStart"in a)a.selectionStart=r,a.selectionEnd=Math.min(n,a.value.length);else if(n=(r=a.ownerDocument||document)&&r.defaultView||window,n.getSelection){n=n.getSelection();var g=a.textContent.length,m=Math.min(f.start,g);f=f.end===void 0?m:Math.min(f.end,g),!n.extend&&m>f&&(g=f,f=m,m=g),g=lg(a,m);var T=lg(a,f);g&&T&&(n.rangeCount!==1||n.anchorNode!==g.node||n.anchorOffset!==g.offset||n.focusNode!==T.node||n.focusOffset!==T.offset)&&(r=r.createRange(),r.setStart(g.node,g.offset),n.removeAllRanges(),m>f?(n.addRange(r),n.extend(T.node,T.offset)):(r.setEnd(T.node,T.offset),n.addRange(r)))}}for(r=[],n=a;n=n.parentNode;)n.nodeType===1&&r.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof a.focus=="function"&&a.focus(),a=0;a<r.length;a++)n=r[a],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var LS=d&&"documentMode"in document&&11>=document.documentMode,Er=null,Ju=null,Us=null,ed=!1;function dg(n,r,a){var f=a.window===a?a.document:a.nodeType===9?a:a.ownerDocument;ed||Er==null||Er!==En(f)||(f=Er,"selectionStart"in f&&Qu(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Us&&Ls(Us,f)||(Us=f,f=El(Ju,"onSelect"),0<f.length&&(r=new Yu("onSelect","select",null,r,a),n.push({event:r,listeners:f}),r.target=Er)))}function Il(n,r){var a={};return a[n.toLowerCase()]=r.toLowerCase(),a["Webkit"+n]="webkit"+r,a["Moz"+n]="moz"+r,a}var wr={animationend:Il("Animation","AnimationEnd"),animationiteration:Il("Animation","AnimationIteration"),animationstart:Il("Animation","AnimationStart"),transitionend:Il("Transition","TransitionEnd")},td={},fg={};d&&(fg=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);function Sl(n){if(td[n])return td[n];if(!wr[n])return n;var r=wr[n],a;for(a in r)if(r.hasOwnProperty(a)&&a in fg)return td[n]=r[a];return n}var hg=Sl("animationend"),pg=Sl("animationiteration"),gg=Sl("animationstart"),mg=Sl("transitionend"),yg=new Map,vg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function qi(n,r){yg.set(n,r),l(r,[n])}for(var nd=0;nd<vg.length;nd++){var id=vg[nd],US=id.toLowerCase(),GS=id[0].toUpperCase()+id.slice(1);qi(US,"on"+GS)}qi(hg,"onAnimationEnd"),qi(pg,"onAnimationIteration"),qi(gg,"onAnimationStart"),qi("dblclick","onDoubleClick"),qi("focusin","onFocus"),qi("focusout","onBlur"),qi(mg,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Gs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xS=new Set("cancel close invalid load scroll toggle".split(" ").concat(Gs));function Ag(n,r,a){var f=n.type||"unknown-event";n.currentTarget=a,UI(f,r,void 0,n),n.currentTarget=null}function Ig(n,r){r=(r&4)!==0;for(var a=0;a<n.length;a++){var f=n[a],g=f.event;f=f.listeners;e:{var m=void 0;if(r)for(var T=f.length-1;0<=T;T--){var P=f[T],k=P.instance,U=P.currentTarget;if(P=P.listener,k!==m&&g.isPropagationStopped())break e;Ag(g,P,U),m=k}else for(T=0;T<f.length;T++){if(P=f[T],k=P.instance,U=P.currentTarget,P=P.listener,k!==m&&g.isPropagationStopped())break e;Ag(g,P,U),m=k}}}if(rl)throw n=Nu,rl=!1,Nu=null,n}function tt(n,r){var a=r[dd];a===void 0&&(a=r[dd]=new Set);var f=n+"__bubble";a.has(f)||(Sg(r,n,2,!1),a.add(f))}function od(n,r,a){var f=0;r&&(f|=4),Sg(a,n,f,r)}var Tl="_reactListening"+Math.random().toString(36).slice(2);function xs(n){if(!n[Tl]){n[Tl]=!0,o.forEach(function(a){a!=="selectionchange"&&(xS.has(a)||od(a,!1,n),od(a,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[Tl]||(r[Tl]=!0,od("selectionchange",!1,r))}}function Sg(n,r,a,f){switch(Yp(r)){case 1:var g=tS;break;case 4:g=nS;break;default:g=xu}a=g.bind(null,r,a,n),g=void 0,!bu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),f?g!==void 0?n.addEventListener(r,a,{capture:!0,passive:g}):n.addEventListener(r,a,!0):g!==void 0?n.addEventListener(r,a,{passive:g}):n.addEventListener(r,a,!1)}function rd(n,r,a,f,g){var m=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var T=f.tag;if(T===3||T===4){var P=f.stateNode.containerInfo;if(P===g||P.nodeType===8&&P.parentNode===g)break;if(T===4)for(T=f.return;T!==null;){var k=T.tag;if((k===3||k===4)&&(k=T.stateNode.containerInfo,k===g||k.nodeType===8&&k.parentNode===g))return;T=T.return}for(;P!==null;){if(T=Do(P),T===null)return;if(k=T.tag,k===5||k===6){f=m=T;continue e}P=P.parentNode}}f=f.return}_p(function(){var U=m,Z=ku(a),Q=[];e:{var V=yg.get(n);if(V!==void 0){var de=Yu,ge=n;switch(n){case"keypress":if(ml(a)===0)break e;case"keydown":case"keyup":de=yS;break;case"focusin":ge="focus",de=Xu;break;case"focusout":ge="blur",de=Xu;break;case"beforeblur":case"afterblur":de=Xu;break;case"click":if(a.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":de=Xp;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":de=rS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":de=IS;break;case hg:case pg:case gg:de=lS;break;case mg:de=TS;break;case"scroll":de=iS;break;case"wheel":de=wS;break;case"copy":case"cut":case"paste":de=uS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":de=qp}var me=(r&4)!==0,pt=!me&&n==="scroll",H=me?V!==null?V+"Capture":null:V;me=[];for(var N=U,L;N!==null;){L=N;var ee=L.stateNode;if(L.tag===5&&ee!==null&&(L=ee,H!==null&&(ee=Es(N,H),ee!=null&&me.push($s(N,ee,L)))),pt)break;N=N.return}0<me.length&&(V=new de(V,ge,null,a,Z),Q.push({event:V,listeners:me}))}}if((r&7)===0){e:{if(V=n==="mouseover"||n==="pointerover",de=n==="mouseout"||n==="pointerout",V&&a!==Mu&&(ge=a.relatedTarget||a.fromElement)&&(Do(ge)||ge[yi]))break e;if((de||V)&&(V=Z.window===Z?Z:(V=Z.ownerDocument)?V.defaultView||V.parentWindow:window,de?(ge=a.relatedTarget||a.toElement,de=U,ge=ge?Do(ge):null,ge!==null&&(pt=ko(ge),ge!==pt||ge.tag!==5&&ge.tag!==6)&&(ge=null)):(de=null,ge=U),de!==ge)){if(me=Xp,ee="onMouseLeave",H="onMouseEnter",N="mouse",(n==="pointerout"||n==="pointerover")&&(me=qp,ee="onPointerLeave",H="onPointerEnter",N="pointer"),pt=de==null?V:Pr(de),L=ge==null?V:Pr(ge),V=new me(ee,N+"leave",de,a,Z),V.target=pt,V.relatedTarget=L,ee=null,Do(Z)===U&&(me=new me(H,N+"enter",ge,a,Z),me.target=L,me.relatedTarget=pt,ee=me),pt=ee,de&&ge)t:{for(me=de,H=ge,N=0,L=me;L;L=Cr(L))N++;for(L=0,ee=H;ee;ee=Cr(ee))L++;for(;0<N-L;)me=Cr(me),N--;for(;0<L-N;)H=Cr(H),L--;for(;N--;){if(me===H||H!==null&&me===H.alternate)break t;me=Cr(me),H=Cr(H)}me=null}else me=null;de!==null&&Tg(Q,V,de,me,!1),ge!==null&&pt!==null&&Tg(Q,pt,ge,me,!0)}}e:{if(V=U?Pr(U):window,de=V.nodeName&&V.nodeName.toLowerCase(),de==="select"||de==="input"&&V.type==="file")var Ie=DS;else if(tg(V))if(ig)Ie=BS;else{Ie=bS;var _e=OS}else(de=V.nodeName)&&de.toLowerCase()==="input"&&(V.type==="checkbox"||V.type==="radio")&&(Ie=NS);if(Ie&&(Ie=Ie(n,U))){ng(Q,Ie,a,Z);break e}_e&&_e(n,V,U),n==="focusout"&&(_e=V._wrapperState)&&_e.controlled&&V.type==="number"&&Jn(V,"number",V.value)}switch(_e=U?Pr(U):window,n){case"focusin":(tg(_e)||_e.contentEditable==="true")&&(Er=_e,Ju=U,Us=null);break;case"focusout":Us=Ju=Er=null;break;case"mousedown":ed=!0;break;case"contextmenu":case"mouseup":case"dragend":ed=!1,dg(Q,a,Z);break;case"selectionchange":if(LS)break;case"keydown":case"keyup":dg(Q,a,Z)}var Pe;if(qu)e:{switch(n){case"compositionstart":var Oe="onCompositionStart";break e;case"compositionend":Oe="onCompositionEnd";break e;case"compositionupdate":Oe="onCompositionUpdate";break e}Oe=void 0}else Tr?Jp(n,a)&&(Oe="onCompositionEnd"):n==="keydown"&&a.keyCode===229&&(Oe="onCompositionStart");Oe&&(Zp&&a.locale!=="ko"&&(Tr||Oe!=="onCompositionStart"?Oe==="onCompositionEnd"&&Tr&&(Pe=zp()):(Vi=Z,Wu="value"in Vi?Vi.value:Vi.textContent,Tr=!0)),_e=El(U,Oe),0<_e.length&&(Oe=new Vp(Oe,n,null,a,Z),Q.push({event:Oe,listeners:_e}),Pe?Oe.data=Pe:(Pe=eg(a),Pe!==null&&(Oe.data=Pe)))),(Pe=_S?PS(n,a):RS(n,a))&&(U=El(U,"onBeforeInput"),0<U.length&&(Z=new Vp("onBeforeInput","beforeinput",null,a,Z),Q.push({event:Z,listeners:U}),Z.data=Pe))}Ig(Q,r)})}function $s(n,r,a){return{instance:n,listener:r,currentTarget:a}}function El(n,r){for(var a=r+"Capture",f=[];n!==null;){var g=n,m=g.stateNode;g.tag===5&&m!==null&&(g=m,m=Es(n,a),m!=null&&f.unshift($s(n,m,g)),m=Es(n,r),m!=null&&f.push($s(n,m,g))),n=n.return}return f}function Cr(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Tg(n,r,a,f,g){for(var m=r._reactName,T=[];a!==null&&a!==f;){var P=a,k=P.alternate,U=P.stateNode;if(k!==null&&k===f)break;P.tag===5&&U!==null&&(P=U,g?(k=Es(a,m),k!=null&&T.unshift($s(a,k,P))):g||(k=Es(a,m),k!=null&&T.push($s(a,k,P)))),a=a.return}T.length!==0&&n.push({event:r,listeners:T})}var $S=/\r\n?/g,WS=/\u0000|\uFFFD/g;function Eg(n){return(typeof n=="string"?n:""+n).replace($S,`
`).replace(WS,"")}function wl(n,r,a){if(r=Eg(r),Eg(n)!==r&&a)throw Error(i(425))}function Cl(){}var sd=null,ad=null;function ld(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var cd=typeof setTimeout=="function"?setTimeout:void 0,YS=typeof clearTimeout=="function"?clearTimeout:void 0,wg=typeof Promise=="function"?Promise:void 0,zS=typeof queueMicrotask=="function"?queueMicrotask:typeof wg<"u"?function(n){return wg.resolve(null).then(n).catch(jS)}:cd;function jS(n){setTimeout(function(){throw n})}function ud(n,r){var a=r,f=0;do{var g=a.nextSibling;if(n.removeChild(a),g&&g.nodeType===8)if(a=g.data,a==="/$"){if(f===0){n.removeChild(g),Os(r);return}f--}else a!=="$"&&a!=="$?"&&a!=="$!"||f++;a=g}while(a);Os(r)}function Zi(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return n}function Cg(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var a=n.data;if(a==="$"||a==="$!"||a==="$?"){if(r===0)return n;r--}else a==="/$"&&r++}n=n.previousSibling}return null}var _r=Math.random().toString(36).slice(2),ni="__reactFiber$"+_r,Ws="__reactProps$"+_r,yi="__reactContainer$"+_r,dd="__reactEvents$"+_r,XS="__reactListeners$"+_r,VS="__reactHandles$"+_r;function Do(n){var r=n[ni];if(r)return r;for(var a=n.parentNode;a;){if(r=a[yi]||a[ni]){if(a=r.alternate,r.child!==null||a!==null&&a.child!==null)for(n=Cg(n);n!==null;){if(a=n[ni])return a;n=Cg(n)}return r}n=a,a=n.parentNode}return null}function Ys(n){return n=n[ni]||n[yi],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Pr(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(i(33))}function _l(n){return n[Ws]||null}var fd=[],Rr=-1;function Ki(n){return{current:n}}function nt(n){0>Rr||(n.current=fd[Rr],fd[Rr]=null,Rr--)}function Je(n,r){Rr++,fd[Rr]=n.current,n.current=r}var Qi={},xt=Ki(Qi),sn=Ki(!1),Oo=Qi;function Mr(n,r){var a=n.type.contextTypes;if(!a)return Qi;var f=n.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===r)return f.__reactInternalMemoizedMaskedChildContext;var g={},m;for(m in a)g[m]=r[m];return f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=g),g}function an(n){return n=n.childContextTypes,n!=null}function Pl(){nt(sn),nt(xt)}function _g(n,r,a){if(xt.current!==Qi)throw Error(i(168));Je(xt,r),Je(sn,a)}function Pg(n,r,a){var f=n.stateNode;if(r=r.childContextTypes,typeof f.getChildContext!="function")return a;f=f.getChildContext();for(var g in f)if(!(g in r))throw Error(i(108,ye(n)||"Unknown",g));return X({},a,f)}function Rl(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Qi,Oo=xt.current,Je(xt,n),Je(sn,sn.current),!0}function Rg(n,r,a){var f=n.stateNode;if(!f)throw Error(i(169));a?(n=Pg(n,r,Oo),f.__reactInternalMemoizedMergedChildContext=n,nt(sn),nt(xt),Je(xt,n)):nt(sn),Je(sn,a)}var vi=null,Ml=!1,hd=!1;function Mg(n){vi===null?vi=[n]:vi.push(n)}function qS(n){Ml=!0,Mg(n)}function Ji(){if(!hd&&vi!==null){hd=!0;var n=0,r=ze;try{var a=vi;for(ze=1;n<a.length;n++){var f=a[n];do f=f(!0);while(f!==null)}vi=null,Ml=!1}catch(g){throw vi!==null&&(vi=vi.slice(n+1)),Dp(Bu,Ji),g}finally{ze=r,hd=!1}}return null}var kr=[],Dr=0,kl=null,Dl=0,_n=[],Pn=0,bo=null,Ai=1,Ii="";function No(n,r){kr[Dr++]=Dl,kr[Dr++]=kl,kl=n,Dl=r}function kg(n,r,a){_n[Pn++]=Ai,_n[Pn++]=Ii,_n[Pn++]=bo,bo=n;var f=Ai;n=Ii;var g=32-Un(f)-1;f&=~(1<<g),a+=1;var m=32-Un(r)+g;if(30<m){var T=g-g%5;m=(f&(1<<T)-1).toString(32),f>>=T,g-=T,Ai=1<<32-Un(r)+g|a<<g|f,Ii=m+n}else Ai=1<<m|a<<g|f,Ii=n}function pd(n){n.return!==null&&(No(n,1),kg(n,1,0))}function gd(n){for(;n===kl;)kl=kr[--Dr],kr[Dr]=null,Dl=kr[--Dr],kr[Dr]=null;for(;n===bo;)bo=_n[--Pn],_n[Pn]=null,Ii=_n[--Pn],_n[Pn]=null,Ai=_n[--Pn],_n[Pn]=null}var gn=null,mn=null,st=!1,xn=null;function Dg(n,r){var a=Dn(5,null,null,0);a.elementType="DELETED",a.stateNode=r,a.return=n,r=n.deletions,r===null?(n.deletions=[a],n.flags|=16):r.push(a)}function Og(n,r){switch(n.tag){case 5:var a=n.type;return r=r.nodeType!==1||a.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(n.stateNode=r,gn=n,mn=Zi(r.firstChild),!0):!1;case 6:return r=n.pendingProps===""||r.nodeType!==3?null:r,r!==null?(n.stateNode=r,gn=n,mn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(a=bo!==null?{id:Ai,overflow:Ii}:null,n.memoizedState={dehydrated:r,treeContext:a,retryLane:1073741824},a=Dn(18,null,null,0),a.stateNode=r,a.return=n,n.child=a,gn=n,mn=null,!0):!1;default:return!1}}function md(n){return(n.mode&1)!==0&&(n.flags&128)===0}function yd(n){if(st){var r=mn;if(r){var a=r;if(!Og(n,r)){if(md(n))throw Error(i(418));r=Zi(a.nextSibling);var f=gn;r&&Og(n,r)?Dg(f,a):(n.flags=n.flags&-4097|2,st=!1,gn=n)}}else{if(md(n))throw Error(i(418));n.flags=n.flags&-4097|2,st=!1,gn=n}}}function bg(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;gn=n}function Ol(n){if(n!==gn)return!1;if(!st)return bg(n),st=!0,!1;var r;if((r=n.tag!==3)&&!(r=n.tag!==5)&&(r=n.type,r=r!=="head"&&r!=="body"&&!ld(n.type,n.memoizedProps)),r&&(r=mn)){if(md(n))throw Ng(),Error(i(418));for(;r;)Dg(n,r),r=Zi(r.nextSibling)}if(bg(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(i(317));e:{for(n=n.nextSibling,r=0;n;){if(n.nodeType===8){var a=n.data;if(a==="/$"){if(r===0){mn=Zi(n.nextSibling);break e}r--}else a!=="$"&&a!=="$!"&&a!=="$?"||r++}n=n.nextSibling}mn=null}}else mn=gn?Zi(n.stateNode.nextSibling):null;return!0}function Ng(){for(var n=mn;n;)n=Zi(n.nextSibling)}function Or(){mn=gn=null,st=!1}function vd(n){xn===null?xn=[n]:xn.push(n)}var ZS=R.ReactCurrentBatchConfig;function zs(n,r,a){if(n=a.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(a._owner){if(a=a._owner,a){if(a.tag!==1)throw Error(i(309));var f=a.stateNode}if(!f)throw Error(i(147,n));var g=f,m=""+n;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===m?r.ref:(r=function(T){var P=g.refs;T===null?delete P[m]:P[m]=T},r._stringRef=m,r)}if(typeof n!="string")throw Error(i(284));if(!a._owner)throw Error(i(290,n))}return n}function bl(n,r){throw n=Object.prototype.toString.call(r),Error(i(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n))}function Bg(n){var r=n._init;return r(n._payload)}function Hg(n){function r(H,N){if(n){var L=H.deletions;L===null?(H.deletions=[N],H.flags|=16):L.push(N)}}function a(H,N){if(!n)return null;for(;N!==null;)r(H,N),N=N.sibling;return null}function f(H,N){for(H=new Map;N!==null;)N.key!==null?H.set(N.key,N):H.set(N.index,N),N=N.sibling;return H}function g(H,N){return H=ao(H,N),H.index=0,H.sibling=null,H}function m(H,N,L){return H.index=L,n?(L=H.alternate,L!==null?(L=L.index,L<N?(H.flags|=2,N):L):(H.flags|=2,N)):(H.flags|=1048576,N)}function T(H){return n&&H.alternate===null&&(H.flags|=2),H}function P(H,N,L,ee){return N===null||N.tag!==6?(N=uf(L,H.mode,ee),N.return=H,N):(N=g(N,L),N.return=H,N)}function k(H,N,L,ee){var Ie=L.type;return Ie===B?Z(H,N,L.props.children,ee,L.key):N!==null&&(N.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===ce&&Bg(Ie)===N.type)?(ee=g(N,L.props),ee.ref=zs(H,N,L),ee.return=H,ee):(ee=ic(L.type,L.key,L.props,null,H.mode,ee),ee.ref=zs(H,N,L),ee.return=H,ee)}function U(H,N,L,ee){return N===null||N.tag!==4||N.stateNode.containerInfo!==L.containerInfo||N.stateNode.implementation!==L.implementation?(N=df(L,H.mode,ee),N.return=H,N):(N=g(N,L.children||[]),N.return=H,N)}function Z(H,N,L,ee,Ie){return N===null||N.tag!==7?(N=$o(L,H.mode,ee,Ie),N.return=H,N):(N=g(N,L),N.return=H,N)}function Q(H,N,L){if(typeof N=="string"&&N!==""||typeof N=="number")return N=uf(""+N,H.mode,L),N.return=H,N;if(typeof N=="object"&&N!==null){switch(N.$$typeof){case b:return L=ic(N.type,N.key,N.props,null,H.mode,L),L.ref=zs(H,null,N),L.return=H,L;case M:return N=df(N,H.mode,L),N.return=H,N;case ce:var ee=N._init;return Q(H,ee(N._payload),L)}if(ei(N)||j(N))return N=$o(N,H.mode,L,null),N.return=H,N;bl(H,N)}return null}function V(H,N,L,ee){var Ie=N!==null?N.key:null;if(typeof L=="string"&&L!==""||typeof L=="number")return Ie!==null?null:P(H,N,""+L,ee);if(typeof L=="object"&&L!==null){switch(L.$$typeof){case b:return L.key===Ie?k(H,N,L,ee):null;case M:return L.key===Ie?U(H,N,L,ee):null;case ce:return Ie=L._init,V(H,N,Ie(L._payload),ee)}if(ei(L)||j(L))return Ie!==null?null:Z(H,N,L,ee,null);bl(H,L)}return null}function de(H,N,L,ee,Ie){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return H=H.get(L)||null,P(N,H,""+ee,Ie);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case b:return H=H.get(ee.key===null?L:ee.key)||null,k(N,H,ee,Ie);case M:return H=H.get(ee.key===null?L:ee.key)||null,U(N,H,ee,Ie);case ce:var _e=ee._init;return de(H,N,L,_e(ee._payload),Ie)}if(ei(ee)||j(ee))return H=H.get(L)||null,Z(N,H,ee,Ie,null);bl(N,ee)}return null}function ge(H,N,L,ee){for(var Ie=null,_e=null,Pe=N,Oe=N=0,Rt=null;Pe!==null&&Oe<L.length;Oe++){Pe.index>Oe?(Rt=Pe,Pe=null):Rt=Pe.sibling;var Ge=V(H,Pe,L[Oe],ee);if(Ge===null){Pe===null&&(Pe=Rt);break}n&&Pe&&Ge.alternate===null&&r(H,Pe),N=m(Ge,N,Oe),_e===null?Ie=Ge:_e.sibling=Ge,_e=Ge,Pe=Rt}if(Oe===L.length)return a(H,Pe),st&&No(H,Oe),Ie;if(Pe===null){for(;Oe<L.length;Oe++)Pe=Q(H,L[Oe],ee),Pe!==null&&(N=m(Pe,N,Oe),_e===null?Ie=Pe:_e.sibling=Pe,_e=Pe);return st&&No(H,Oe),Ie}for(Pe=f(H,Pe);Oe<L.length;Oe++)Rt=de(Pe,H,Oe,L[Oe],ee),Rt!==null&&(n&&Rt.alternate!==null&&Pe.delete(Rt.key===null?Oe:Rt.key),N=m(Rt,N,Oe),_e===null?Ie=Rt:_e.sibling=Rt,_e=Rt);return n&&Pe.forEach(function(lo){return r(H,lo)}),st&&No(H,Oe),Ie}function me(H,N,L,ee){var Ie=j(L);if(typeof Ie!="function")throw Error(i(150));if(L=Ie.call(L),L==null)throw Error(i(151));for(var _e=Ie=null,Pe=N,Oe=N=0,Rt=null,Ge=L.next();Pe!==null&&!Ge.done;Oe++,Ge=L.next()){Pe.index>Oe?(Rt=Pe,Pe=null):Rt=Pe.sibling;var lo=V(H,Pe,Ge.value,ee);if(lo===null){Pe===null&&(Pe=Rt);break}n&&Pe&&lo.alternate===null&&r(H,Pe),N=m(lo,N,Oe),_e===null?Ie=lo:_e.sibling=lo,_e=lo,Pe=Rt}if(Ge.done)return a(H,Pe),st&&No(H,Oe),Ie;if(Pe===null){for(;!Ge.done;Oe++,Ge=L.next())Ge=Q(H,Ge.value,ee),Ge!==null&&(N=m(Ge,N,Oe),_e===null?Ie=Ge:_e.sibling=Ge,_e=Ge);return st&&No(H,Oe),Ie}for(Pe=f(H,Pe);!Ge.done;Oe++,Ge=L.next())Ge=de(Pe,H,Oe,Ge.value,ee),Ge!==null&&(n&&Ge.alternate!==null&&Pe.delete(Ge.key===null?Oe:Ge.key),N=m(Ge,N,Oe),_e===null?Ie=Ge:_e.sibling=Ge,_e=Ge);return n&&Pe.forEach(function(MT){return r(H,MT)}),st&&No(H,Oe),Ie}function pt(H,N,L,ee){if(typeof L=="object"&&L!==null&&L.type===B&&L.key===null&&(L=L.props.children),typeof L=="object"&&L!==null){switch(L.$$typeof){case b:e:{for(var Ie=L.key,_e=N;_e!==null;){if(_e.key===Ie){if(Ie=L.type,Ie===B){if(_e.tag===7){a(H,_e.sibling),N=g(_e,L.props.children),N.return=H,H=N;break e}}else if(_e.elementType===Ie||typeof Ie=="object"&&Ie!==null&&Ie.$$typeof===ce&&Bg(Ie)===_e.type){a(H,_e.sibling),N=g(_e,L.props),N.ref=zs(H,_e,L),N.return=H,H=N;break e}a(H,_e);break}else r(H,_e);_e=_e.sibling}L.type===B?(N=$o(L.props.children,H.mode,ee,L.key),N.return=H,H=N):(ee=ic(L.type,L.key,L.props,null,H.mode,ee),ee.ref=zs(H,N,L),ee.return=H,H=ee)}return T(H);case M:e:{for(_e=L.key;N!==null;){if(N.key===_e)if(N.tag===4&&N.stateNode.containerInfo===L.containerInfo&&N.stateNode.implementation===L.implementation){a(H,N.sibling),N=g(N,L.children||[]),N.return=H,H=N;break e}else{a(H,N);break}else r(H,N);N=N.sibling}N=df(L,H.mode,ee),N.return=H,H=N}return T(H);case ce:return _e=L._init,pt(H,N,_e(L._payload),ee)}if(ei(L))return ge(H,N,L,ee);if(j(L))return me(H,N,L,ee);bl(H,L)}return typeof L=="string"&&L!==""||typeof L=="number"?(L=""+L,N!==null&&N.tag===6?(a(H,N.sibling),N=g(N,L),N.return=H,H=N):(a(H,N),N=uf(L,H.mode,ee),N.return=H,H=N),T(H)):a(H,N)}return pt}var br=Hg(!0),Fg=Hg(!1),Nl=Ki(null),Bl=null,Nr=null,Ad=null;function Id(){Ad=Nr=Bl=null}function Sd(n){var r=Nl.current;nt(Nl),n._currentValue=r}function Td(n,r,a){for(;n!==null;){var f=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),n===a)break;n=n.return}}function Br(n,r){Bl=n,Ad=Nr=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&r)!==0&&(ln=!0),n.firstContext=null)}function Rn(n){var r=n._currentValue;if(Ad!==n)if(n={context:n,memoizedValue:r,next:null},Nr===null){if(Bl===null)throw Error(i(308));Nr=n,Bl.dependencies={lanes:0,firstContext:n}}else Nr=Nr.next=n;return r}var Bo=null;function Ed(n){Bo===null?Bo=[n]:Bo.push(n)}function Lg(n,r,a,f){var g=r.interleaved;return g===null?(a.next=a,Ed(r)):(a.next=g.next,g.next=a),r.interleaved=a,Si(n,f)}function Si(n,r){n.lanes|=r;var a=n.alternate;for(a!==null&&(a.lanes|=r),a=n,n=n.return;n!==null;)n.childLanes|=r,a=n.alternate,a!==null&&(a.childLanes|=r),a=n,n=n.return;return a.tag===3?a.stateNode:null}var eo=!1;function wd(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ug(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Ti(n,r){return{eventTime:n,lane:r,tag:0,payload:null,callback:null,next:null}}function to(n,r,a){var f=n.updateQueue;if(f===null)return null;if(f=f.shared,(Ue&2)!==0){var g=f.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),f.pending=r,Si(n,a)}return g=f.interleaved,g===null?(r.next=r,Ed(f)):(r.next=g.next,g.next=r),f.interleaved=r,Si(n,a)}function Hl(n,r,a){if(r=r.updateQueue,r!==null&&(r=r.shared,(a&4194240)!==0)){var f=r.lanes;f&=n.pendingLanes,a|=f,r.lanes=a,Lu(n,a)}}function Gg(n,r){var a=n.updateQueue,f=n.alternate;if(f!==null&&(f=f.updateQueue,a===f)){var g=null,m=null;if(a=a.firstBaseUpdate,a!==null){do{var T={eventTime:a.eventTime,lane:a.lane,tag:a.tag,payload:a.payload,callback:a.callback,next:null};m===null?g=m=T:m=m.next=T,a=a.next}while(a!==null);m===null?g=m=r:m=m.next=r}else g=m=r;a={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:m,shared:f.shared,effects:f.effects},n.updateQueue=a;return}n=a.lastBaseUpdate,n===null?a.firstBaseUpdate=r:n.next=r,a.lastBaseUpdate=r}function Fl(n,r,a,f){var g=n.updateQueue;eo=!1;var m=g.firstBaseUpdate,T=g.lastBaseUpdate,P=g.shared.pending;if(P!==null){g.shared.pending=null;var k=P,U=k.next;k.next=null,T===null?m=U:T.next=U,T=k;var Z=n.alternate;Z!==null&&(Z=Z.updateQueue,P=Z.lastBaseUpdate,P!==T&&(P===null?Z.firstBaseUpdate=U:P.next=U,Z.lastBaseUpdate=k))}if(m!==null){var Q=g.baseState;T=0,Z=U=k=null,P=m;do{var V=P.lane,de=P.eventTime;if((f&V)===V){Z!==null&&(Z=Z.next={eventTime:de,lane:0,tag:P.tag,payload:P.payload,callback:P.callback,next:null});e:{var ge=n,me=P;switch(V=r,de=a,me.tag){case 1:if(ge=me.payload,typeof ge=="function"){Q=ge.call(de,Q,V);break e}Q=ge;break e;case 3:ge.flags=ge.flags&-65537|128;case 0:if(ge=me.payload,V=typeof ge=="function"?ge.call(de,Q,V):ge,V==null)break e;Q=X({},Q,V);break e;case 2:eo=!0}}P.callback!==null&&P.lane!==0&&(n.flags|=64,V=g.effects,V===null?g.effects=[P]:V.push(P))}else de={eventTime:de,lane:V,tag:P.tag,payload:P.payload,callback:P.callback,next:null},Z===null?(U=Z=de,k=Q):Z=Z.next=de,T|=V;if(P=P.next,P===null){if(P=g.shared.pending,P===null)break;V=P,P=V.next,V.next=null,g.lastBaseUpdate=V,g.shared.pending=null}}while(!0);if(Z===null&&(k=Q),g.baseState=k,g.firstBaseUpdate=U,g.lastBaseUpdate=Z,r=g.shared.interleaved,r!==null){g=r;do T|=g.lane,g=g.next;while(g!==r)}else m===null&&(g.shared.lanes=0);Lo|=T,n.lanes=T,n.memoizedState=Q}}function xg(n,r,a){if(n=r.effects,r.effects=null,n!==null)for(r=0;r<n.length;r++){var f=n[r],g=f.callback;if(g!==null){if(f.callback=null,f=a,typeof g!="function")throw Error(i(191,g));g.call(f)}}}var js={},ii=Ki(js),Xs=Ki(js),Vs=Ki(js);function Ho(n){if(n===js)throw Error(i(174));return n}function Cd(n,r){switch(Je(Vs,r),Je(Xs,n),Je(ii,js),n=r.nodeType,n){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:_u(null,"");break;default:n=n===8?r.parentNode:r,r=n.namespaceURI||null,n=n.tagName,r=_u(r,n)}nt(ii),Je(ii,r)}function Hr(){nt(ii),nt(Xs),nt(Vs)}function $g(n){Ho(Vs.current);var r=Ho(ii.current),a=_u(r,n.type);r!==a&&(Je(Xs,n),Je(ii,a))}function _d(n){Xs.current===n&&(nt(ii),nt(Xs))}var lt=Ki(0);function Ll(n){for(var r=n;r!==null;){if(r.tag===13){var a=r.memoizedState;if(a!==null&&(a=a.dehydrated,a===null||a.data==="$?"||a.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Pd=[];function Rd(){for(var n=0;n<Pd.length;n++)Pd[n]._workInProgressVersionPrimary=null;Pd.length=0}var Ul=R.ReactCurrentDispatcher,Md=R.ReactCurrentBatchConfig,Fo=0,ct=null,St=null,_t=null,Gl=!1,qs=!1,Zs=0,KS=0;function $t(){throw Error(i(321))}function kd(n,r){if(r===null)return!1;for(var a=0;a<r.length&&a<n.length;a++)if(!Gn(n[a],r[a]))return!1;return!0}function Dd(n,r,a,f,g,m){if(Fo=m,ct=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Ul.current=n===null||n.memoizedState===null?tT:nT,n=a(f,g),qs){m=0;do{if(qs=!1,Zs=0,25<=m)throw Error(i(301));m+=1,_t=St=null,r.updateQueue=null,Ul.current=iT,n=a(f,g)}while(qs)}if(Ul.current=Wl,r=St!==null&&St.next!==null,Fo=0,_t=St=ct=null,Gl=!1,r)throw Error(i(300));return n}function Od(){var n=Zs!==0;return Zs=0,n}function oi(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return _t===null?ct.memoizedState=_t=n:_t=_t.next=n,_t}function Mn(){if(St===null){var n=ct.alternate;n=n!==null?n.memoizedState:null}else n=St.next;var r=_t===null?ct.memoizedState:_t.next;if(r!==null)_t=r,St=n;else{if(n===null)throw Error(i(310));St=n,n={memoizedState:St.memoizedState,baseState:St.baseState,baseQueue:St.baseQueue,queue:St.queue,next:null},_t===null?ct.memoizedState=_t=n:_t=_t.next=n}return _t}function Ks(n,r){return typeof r=="function"?r(n):r}function bd(n){var r=Mn(),a=r.queue;if(a===null)throw Error(i(311));a.lastRenderedReducer=n;var f=St,g=f.baseQueue,m=a.pending;if(m!==null){if(g!==null){var T=g.next;g.next=m.next,m.next=T}f.baseQueue=g=m,a.pending=null}if(g!==null){m=g.next,f=f.baseState;var P=T=null,k=null,U=m;do{var Z=U.lane;if((Fo&Z)===Z)k!==null&&(k=k.next={lane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),f=U.hasEagerState?U.eagerState:n(f,U.action);else{var Q={lane:Z,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null};k===null?(P=k=Q,T=f):k=k.next=Q,ct.lanes|=Z,Lo|=Z}U=U.next}while(U!==null&&U!==m);k===null?T=f:k.next=P,Gn(f,r.memoizedState)||(ln=!0),r.memoizedState=f,r.baseState=T,r.baseQueue=k,a.lastRenderedState=f}if(n=a.interleaved,n!==null){g=n;do m=g.lane,ct.lanes|=m,Lo|=m,g=g.next;while(g!==n)}else g===null&&(a.lanes=0);return[r.memoizedState,a.dispatch]}function Nd(n){var r=Mn(),a=r.queue;if(a===null)throw Error(i(311));a.lastRenderedReducer=n;var f=a.dispatch,g=a.pending,m=r.memoizedState;if(g!==null){a.pending=null;var T=g=g.next;do m=n(m,T.action),T=T.next;while(T!==g);Gn(m,r.memoizedState)||(ln=!0),r.memoizedState=m,r.baseQueue===null&&(r.baseState=m),a.lastRenderedState=m}return[m,f]}function Wg(){}function Yg(n,r){var a=ct,f=Mn(),g=r(),m=!Gn(f.memoizedState,g);if(m&&(f.memoizedState=g,ln=!0),f=f.queue,Bd(Xg.bind(null,a,f,n),[n]),f.getSnapshot!==r||m||_t!==null&&_t.memoizedState.tag&1){if(a.flags|=2048,Qs(9,jg.bind(null,a,f,g,r),void 0,null),Pt===null)throw Error(i(349));(Fo&30)!==0||zg(a,r,g)}return g}function zg(n,r,a){n.flags|=16384,n={getSnapshot:r,value:a},r=ct.updateQueue,r===null?(r={lastEffect:null,stores:null},ct.updateQueue=r,r.stores=[n]):(a=r.stores,a===null?r.stores=[n]:a.push(n))}function jg(n,r,a,f){r.value=a,r.getSnapshot=f,Vg(r)&&qg(n)}function Xg(n,r,a){return a(function(){Vg(r)&&qg(n)})}function Vg(n){var r=n.getSnapshot;n=n.value;try{var a=r();return!Gn(n,a)}catch{return!0}}function qg(n){var r=Si(n,1);r!==null&&zn(r,n,1,-1)}function Zg(n){var r=oi();return typeof n=="function"&&(n=n()),r.memoizedState=r.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ks,lastRenderedState:n},r.queue=n,n=n.dispatch=eT.bind(null,ct,n),[r.memoizedState,n]}function Qs(n,r,a,f){return n={tag:n,create:r,destroy:a,deps:f,next:null},r=ct.updateQueue,r===null?(r={lastEffect:null,stores:null},ct.updateQueue=r,r.lastEffect=n.next=n):(a=r.lastEffect,a===null?r.lastEffect=n.next=n:(f=a.next,a.next=n,n.next=f,r.lastEffect=n)),n}function Kg(){return Mn().memoizedState}function xl(n,r,a,f){var g=oi();ct.flags|=n,g.memoizedState=Qs(1|r,a,void 0,f===void 0?null:f)}function $l(n,r,a,f){var g=Mn();f=f===void 0?null:f;var m=void 0;if(St!==null){var T=St.memoizedState;if(m=T.destroy,f!==null&&kd(f,T.deps)){g.memoizedState=Qs(r,a,m,f);return}}ct.flags|=n,g.memoizedState=Qs(1|r,a,m,f)}function Qg(n,r){return xl(8390656,8,n,r)}function Bd(n,r){return $l(2048,8,n,r)}function Jg(n,r){return $l(4,2,n,r)}function em(n,r){return $l(4,4,n,r)}function tm(n,r){if(typeof r=="function")return n=n(),r(n),function(){r(null)};if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function nm(n,r,a){return a=a!=null?a.concat([n]):null,$l(4,4,tm.bind(null,r,n),a)}function Hd(){}function im(n,r){var a=Mn();r=r===void 0?null:r;var f=a.memoizedState;return f!==null&&r!==null&&kd(r,f[1])?f[0]:(a.memoizedState=[n,r],n)}function om(n,r){var a=Mn();r=r===void 0?null:r;var f=a.memoizedState;return f!==null&&r!==null&&kd(r,f[1])?f[0]:(n=n(),a.memoizedState=[n,r],n)}function rm(n,r,a){return(Fo&21)===0?(n.baseState&&(n.baseState=!1,ln=!0),n.memoizedState=a):(Gn(a,r)||(a=Bp(),ct.lanes|=a,Lo|=a,n.baseState=!0),r)}function QS(n,r){var a=ze;ze=a!==0&&4>a?a:4,n(!0);var f=Md.transition;Md.transition={};try{n(!1),r()}finally{ze=a,Md.transition=f}}function sm(){return Mn().memoizedState}function JS(n,r,a){var f=ro(n);if(a={lane:f,action:a,hasEagerState:!1,eagerState:null,next:null},am(n))lm(r,a);else if(a=Lg(n,r,a,f),a!==null){var g=Kt();zn(a,n,f,g),cm(a,r,f)}}function eT(n,r,a){var f=ro(n),g={lane:f,action:a,hasEagerState:!1,eagerState:null,next:null};if(am(n))lm(r,g);else{var m=n.alternate;if(n.lanes===0&&(m===null||m.lanes===0)&&(m=r.lastRenderedReducer,m!==null))try{var T=r.lastRenderedState,P=m(T,a);if(g.hasEagerState=!0,g.eagerState=P,Gn(P,T)){var k=r.interleaved;k===null?(g.next=g,Ed(r)):(g.next=k.next,k.next=g),r.interleaved=g;return}}catch{}finally{}a=Lg(n,r,g,f),a!==null&&(g=Kt(),zn(a,n,f,g),cm(a,r,f))}}function am(n){var r=n.alternate;return n===ct||r!==null&&r===ct}function lm(n,r){qs=Gl=!0;var a=n.pending;a===null?r.next=r:(r.next=a.next,a.next=r),n.pending=r}function cm(n,r,a){if((a&4194240)!==0){var f=r.lanes;f&=n.pendingLanes,a|=f,r.lanes=a,Lu(n,a)}}var Wl={readContext:Rn,useCallback:$t,useContext:$t,useEffect:$t,useImperativeHandle:$t,useInsertionEffect:$t,useLayoutEffect:$t,useMemo:$t,useReducer:$t,useRef:$t,useState:$t,useDebugValue:$t,useDeferredValue:$t,useTransition:$t,useMutableSource:$t,useSyncExternalStore:$t,useId:$t,unstable_isNewReconciler:!1},tT={readContext:Rn,useCallback:function(n,r){return oi().memoizedState=[n,r===void 0?null:r],n},useContext:Rn,useEffect:Qg,useImperativeHandle:function(n,r,a){return a=a!=null?a.concat([n]):null,xl(4194308,4,tm.bind(null,r,n),a)},useLayoutEffect:function(n,r){return xl(4194308,4,n,r)},useInsertionEffect:function(n,r){return xl(4,2,n,r)},useMemo:function(n,r){var a=oi();return r=r===void 0?null:r,n=n(),a.memoizedState=[n,r],n},useReducer:function(n,r,a){var f=oi();return r=a!==void 0?a(r):r,f.memoizedState=f.baseState=r,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:r},f.queue=n,n=n.dispatch=JS.bind(null,ct,n),[f.memoizedState,n]},useRef:function(n){var r=oi();return n={current:n},r.memoizedState=n},useState:Zg,useDebugValue:Hd,useDeferredValue:function(n){return oi().memoizedState=n},useTransition:function(){var n=Zg(!1),r=n[0];return n=QS.bind(null,n[1]),oi().memoizedState=n,[r,n]},useMutableSource:function(){},useSyncExternalStore:function(n,r,a){var f=ct,g=oi();if(st){if(a===void 0)throw Error(i(407));a=a()}else{if(a=r(),Pt===null)throw Error(i(349));(Fo&30)!==0||zg(f,r,a)}g.memoizedState=a;var m={value:a,getSnapshot:r};return g.queue=m,Qg(Xg.bind(null,f,m,n),[n]),f.flags|=2048,Qs(9,jg.bind(null,f,m,a,r),void 0,null),a},useId:function(){var n=oi(),r=Pt.identifierPrefix;if(st){var a=Ii,f=Ai;a=(f&~(1<<32-Un(f)-1)).toString(32)+a,r=":"+r+"R"+a,a=Zs++,0<a&&(r+="H"+a.toString(32)),r+=":"}else a=KS++,r=":"+r+"r"+a.toString(32)+":";return n.memoizedState=r},unstable_isNewReconciler:!1},nT={readContext:Rn,useCallback:im,useContext:Rn,useEffect:Bd,useImperativeHandle:nm,useInsertionEffect:Jg,useLayoutEffect:em,useMemo:om,useReducer:bd,useRef:Kg,useState:function(){return bd(Ks)},useDebugValue:Hd,useDeferredValue:function(n){var r=Mn();return rm(r,St.memoizedState,n)},useTransition:function(){var n=bd(Ks)[0],r=Mn().memoizedState;return[n,r]},useMutableSource:Wg,useSyncExternalStore:Yg,useId:sm,unstable_isNewReconciler:!1},iT={readContext:Rn,useCallback:im,useContext:Rn,useEffect:Bd,useImperativeHandle:nm,useInsertionEffect:Jg,useLayoutEffect:em,useMemo:om,useReducer:Nd,useRef:Kg,useState:function(){return Nd(Ks)},useDebugValue:Hd,useDeferredValue:function(n){var r=Mn();return St===null?r.memoizedState=n:rm(r,St.memoizedState,n)},useTransition:function(){var n=Nd(Ks)[0],r=Mn().memoizedState;return[n,r]},useMutableSource:Wg,useSyncExternalStore:Yg,useId:sm,unstable_isNewReconciler:!1};function $n(n,r){if(n&&n.defaultProps){r=X({},r),n=n.defaultProps;for(var a in n)r[a]===void 0&&(r[a]=n[a]);return r}return r}function Fd(n,r,a,f){r=n.memoizedState,a=a(f,r),a=a==null?r:X({},r,a),n.memoizedState=a,n.lanes===0&&(n.updateQueue.baseState=a)}var Yl={isMounted:function(n){return(n=n._reactInternals)?ko(n)===n:!1},enqueueSetState:function(n,r,a){n=n._reactInternals;var f=Kt(),g=ro(n),m=Ti(f,g);m.payload=r,a!=null&&(m.callback=a),r=to(n,m,g),r!==null&&(zn(r,n,g,f),Hl(r,n,g))},enqueueReplaceState:function(n,r,a){n=n._reactInternals;var f=Kt(),g=ro(n),m=Ti(f,g);m.tag=1,m.payload=r,a!=null&&(m.callback=a),r=to(n,m,g),r!==null&&(zn(r,n,g,f),Hl(r,n,g))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var a=Kt(),f=ro(n),g=Ti(a,f);g.tag=2,r!=null&&(g.callback=r),r=to(n,g,f),r!==null&&(zn(r,n,f,a),Hl(r,n,f))}};function um(n,r,a,f,g,m,T){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(f,m,T):r.prototype&&r.prototype.isPureReactComponent?!Ls(a,f)||!Ls(g,m):!0}function dm(n,r,a){var f=!1,g=Qi,m=r.contextType;return typeof m=="object"&&m!==null?m=Rn(m):(g=an(r)?Oo:xt.current,f=r.contextTypes,m=(f=f!=null)?Mr(n,g):Qi),r=new r(a,m),n.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Yl,n.stateNode=r,r._reactInternals=n,f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=g,n.__reactInternalMemoizedMaskedChildContext=m),r}function fm(n,r,a,f){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(a,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(a,f),r.state!==n&&Yl.enqueueReplaceState(r,r.state,null)}function Ld(n,r,a,f){var g=n.stateNode;g.props=a,g.state=n.memoizedState,g.refs={},wd(n);var m=r.contextType;typeof m=="object"&&m!==null?g.context=Rn(m):(m=an(r)?Oo:xt.current,g.context=Mr(n,m)),g.state=n.memoizedState,m=r.getDerivedStateFromProps,typeof m=="function"&&(Fd(n,r,m,a),g.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(r=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),r!==g.state&&Yl.enqueueReplaceState(g,g.state,null),Fl(n,a,g,f),g.state=n.memoizedState),typeof g.componentDidMount=="function"&&(n.flags|=4194308)}function Fr(n,r){try{var a="",f=r;do a+=Ee(f),f=f.return;while(f);var g=a}catch(m){g=`
Error generating stack: `+m.message+`
`+m.stack}return{value:n,source:r,stack:g,digest:null}}function Ud(n,r,a){return{value:n,source:null,stack:a??null,digest:r??null}}function Gd(n,r){try{console.error(r.value)}catch(a){setTimeout(function(){throw a})}}var oT=typeof WeakMap=="function"?WeakMap:Map;function hm(n,r,a){a=Ti(-1,a),a.tag=3,a.payload={element:null};var f=r.value;return a.callback=function(){Kl||(Kl=!0,tf=f),Gd(n,r)},a}function pm(n,r,a){a=Ti(-1,a),a.tag=3;var f=n.type.getDerivedStateFromError;if(typeof f=="function"){var g=r.value;a.payload=function(){return f(g)},a.callback=function(){Gd(n,r)}}var m=n.stateNode;return m!==null&&typeof m.componentDidCatch=="function"&&(a.callback=function(){Gd(n,r),typeof f!="function"&&(io===null?io=new Set([this]):io.add(this));var T=r.stack;this.componentDidCatch(r.value,{componentStack:T!==null?T:""})}),a}function gm(n,r,a){var f=n.pingCache;if(f===null){f=n.pingCache=new oT;var g=new Set;f.set(r,g)}else g=f.get(r),g===void 0&&(g=new Set,f.set(r,g));g.has(a)||(g.add(a),n=vT.bind(null,n,r,a),r.then(n,n))}function mm(n){do{var r;if((r=n.tag===13)&&(r=n.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return n;n=n.return}while(n!==null);return null}function ym(n,r,a,f,g){return(n.mode&1)===0?(n===r?n.flags|=65536:(n.flags|=128,a.flags|=131072,a.flags&=-52805,a.tag===1&&(a.alternate===null?a.tag=17:(r=Ti(-1,1),r.tag=2,to(a,r,1))),a.lanes|=1),n):(n.flags|=65536,n.lanes=g,n)}var rT=R.ReactCurrentOwner,ln=!1;function Zt(n,r,a,f){r.child=n===null?Fg(r,null,a,f):br(r,n.child,a,f)}function vm(n,r,a,f,g){a=a.render;var m=r.ref;return Br(r,g),f=Dd(n,r,a,f,m,g),a=Od(),n!==null&&!ln?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~g,Ei(n,r,g)):(st&&a&&pd(r),r.flags|=1,Zt(n,r,f,g),r.child)}function Am(n,r,a,f,g){if(n===null){var m=a.type;return typeof m=="function"&&!cf(m)&&m.defaultProps===void 0&&a.compare===null&&a.defaultProps===void 0?(r.tag=15,r.type=m,Im(n,r,m,f,g)):(n=ic(a.type,null,f,r,r.mode,g),n.ref=r.ref,n.return=r,r.child=n)}if(m=n.child,(n.lanes&g)===0){var T=m.memoizedProps;if(a=a.compare,a=a!==null?a:Ls,a(T,f)&&n.ref===r.ref)return Ei(n,r,g)}return r.flags|=1,n=ao(m,f),n.ref=r.ref,n.return=r,r.child=n}function Im(n,r,a,f,g){if(n!==null){var m=n.memoizedProps;if(Ls(m,f)&&n.ref===r.ref)if(ln=!1,r.pendingProps=f=m,(n.lanes&g)!==0)(n.flags&131072)!==0&&(ln=!0);else return r.lanes=n.lanes,Ei(n,r,g)}return xd(n,r,a,f,g)}function Sm(n,r,a){var f=r.pendingProps,g=f.children,m=n!==null?n.memoizedState:null;if(f.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},Je(Ur,yn),yn|=a;else{if((a&1073741824)===0)return n=m!==null?m.baseLanes|a:a,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:n,cachePool:null,transitions:null},r.updateQueue=null,Je(Ur,yn),yn|=n,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=m!==null?m.baseLanes:a,Je(Ur,yn),yn|=f}else m!==null?(f=m.baseLanes|a,r.memoizedState=null):f=a,Je(Ur,yn),yn|=f;return Zt(n,r,g,a),r.child}function Tm(n,r){var a=r.ref;(n===null&&a!==null||n!==null&&n.ref!==a)&&(r.flags|=512,r.flags|=2097152)}function xd(n,r,a,f,g){var m=an(a)?Oo:xt.current;return m=Mr(r,m),Br(r,g),a=Dd(n,r,a,f,m,g),f=Od(),n!==null&&!ln?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~g,Ei(n,r,g)):(st&&f&&pd(r),r.flags|=1,Zt(n,r,a,g),r.child)}function Em(n,r,a,f,g){if(an(a)){var m=!0;Rl(r)}else m=!1;if(Br(r,g),r.stateNode===null)jl(n,r),dm(r,a,f),Ld(r,a,f,g),f=!0;else if(n===null){var T=r.stateNode,P=r.memoizedProps;T.props=P;var k=T.context,U=a.contextType;typeof U=="object"&&U!==null?U=Rn(U):(U=an(a)?Oo:xt.current,U=Mr(r,U));var Z=a.getDerivedStateFromProps,Q=typeof Z=="function"||typeof T.getSnapshotBeforeUpdate=="function";Q||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(P!==f||k!==U)&&fm(r,T,f,U),eo=!1;var V=r.memoizedState;T.state=V,Fl(r,f,T,g),k=r.memoizedState,P!==f||V!==k||sn.current||eo?(typeof Z=="function"&&(Fd(r,a,Z,f),k=r.memoizedState),(P=eo||um(r,a,P,f,V,k,U))?(Q||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(r.flags|=4194308)):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=k),T.props=f,T.state=k,T.context=U,f=P):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{T=r.stateNode,Ug(n,r),P=r.memoizedProps,U=r.type===r.elementType?P:$n(r.type,P),T.props=U,Q=r.pendingProps,V=T.context,k=a.contextType,typeof k=="object"&&k!==null?k=Rn(k):(k=an(a)?Oo:xt.current,k=Mr(r,k));var de=a.getDerivedStateFromProps;(Z=typeof de=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(P!==Q||V!==k)&&fm(r,T,f,k),eo=!1,V=r.memoizedState,T.state=V,Fl(r,f,T,g);var ge=r.memoizedState;P!==Q||V!==ge||sn.current||eo?(typeof de=="function"&&(Fd(r,a,de,f),ge=r.memoizedState),(U=eo||um(r,a,U,f,V,ge,k)||!1)?(Z||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(f,ge,k),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(f,ge,k)),typeof T.componentDidUpdate=="function"&&(r.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof T.componentDidUpdate!="function"||P===n.memoizedProps&&V===n.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||P===n.memoizedProps&&V===n.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=ge),T.props=f,T.state=ge,T.context=k,f=U):(typeof T.componentDidUpdate!="function"||P===n.memoizedProps&&V===n.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||P===n.memoizedProps&&V===n.memoizedState||(r.flags|=1024),f=!1)}return $d(n,r,a,f,m,g)}function $d(n,r,a,f,g,m){Tm(n,r);var T=(r.flags&128)!==0;if(!f&&!T)return g&&Rg(r,a,!1),Ei(n,r,m);f=r.stateNode,rT.current=r;var P=T&&typeof a.getDerivedStateFromError!="function"?null:f.render();return r.flags|=1,n!==null&&T?(r.child=br(r,n.child,null,m),r.child=br(r,null,P,m)):Zt(n,r,P,m),r.memoizedState=f.state,g&&Rg(r,a,!0),r.child}function wm(n){var r=n.stateNode;r.pendingContext?_g(n,r.pendingContext,r.pendingContext!==r.context):r.context&&_g(n,r.context,!1),Cd(n,r.containerInfo)}function Cm(n,r,a,f,g){return Or(),vd(g),r.flags|=256,Zt(n,r,a,f),r.child}var Wd={dehydrated:null,treeContext:null,retryLane:0};function Yd(n){return{baseLanes:n,cachePool:null,transitions:null}}function _m(n,r,a){var f=r.pendingProps,g=lt.current,m=!1,T=(r.flags&128)!==0,P;if((P=T)||(P=n!==null&&n.memoizedState===null?!1:(g&2)!==0),P?(m=!0,r.flags&=-129):(n===null||n.memoizedState!==null)&&(g|=1),Je(lt,g&1),n===null)return yd(r),n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((r.mode&1)===0?r.lanes=1:n.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(T=f.children,n=f.fallback,m?(f=r.mode,m=r.child,T={mode:"hidden",children:T},(f&1)===0&&m!==null?(m.childLanes=0,m.pendingProps=T):m=oc(T,f,0,null),n=$o(n,f,a,null),m.return=r,n.return=r,m.sibling=n,r.child=m,r.child.memoizedState=Yd(a),r.memoizedState=Wd,n):zd(r,T));if(g=n.memoizedState,g!==null&&(P=g.dehydrated,P!==null))return sT(n,r,T,f,P,g,a);if(m){m=f.fallback,T=r.mode,g=n.child,P=g.sibling;var k={mode:"hidden",children:f.children};return(T&1)===0&&r.child!==g?(f=r.child,f.childLanes=0,f.pendingProps=k,r.deletions=null):(f=ao(g,k),f.subtreeFlags=g.subtreeFlags&14680064),P!==null?m=ao(P,m):(m=$o(m,T,a,null),m.flags|=2),m.return=r,f.return=r,f.sibling=m,r.child=f,f=m,m=r.child,T=n.child.memoizedState,T=T===null?Yd(a):{baseLanes:T.baseLanes|a,cachePool:null,transitions:T.transitions},m.memoizedState=T,m.childLanes=n.childLanes&~a,r.memoizedState=Wd,f}return m=n.child,n=m.sibling,f=ao(m,{mode:"visible",children:f.children}),(r.mode&1)===0&&(f.lanes=a),f.return=r,f.sibling=null,n!==null&&(a=r.deletions,a===null?(r.deletions=[n],r.flags|=16):a.push(n)),r.child=f,r.memoizedState=null,f}function zd(n,r){return r=oc({mode:"visible",children:r},n.mode,0,null),r.return=n,n.child=r}function zl(n,r,a,f){return f!==null&&vd(f),br(r,n.child,null,a),n=zd(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function sT(n,r,a,f,g,m,T){if(a)return r.flags&256?(r.flags&=-257,f=Ud(Error(i(422))),zl(n,r,T,f)):r.memoizedState!==null?(r.child=n.child,r.flags|=128,null):(m=f.fallback,g=r.mode,f=oc({mode:"visible",children:f.children},g,0,null),m=$o(m,g,T,null),m.flags|=2,f.return=r,m.return=r,f.sibling=m,r.child=f,(r.mode&1)!==0&&br(r,n.child,null,T),r.child.memoizedState=Yd(T),r.memoizedState=Wd,m);if((r.mode&1)===0)return zl(n,r,T,null);if(g.data==="$!"){if(f=g.nextSibling&&g.nextSibling.dataset,f)var P=f.dgst;return f=P,m=Error(i(419)),f=Ud(m,f,void 0),zl(n,r,T,f)}if(P=(T&n.childLanes)!==0,ln||P){if(f=Pt,f!==null){switch(T&-T){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=(g&(f.suspendedLanes|T))!==0?0:g,g!==0&&g!==m.retryLane&&(m.retryLane=g,Si(n,g),zn(f,n,g,-1))}return lf(),f=Ud(Error(i(421))),zl(n,r,T,f)}return g.data==="$?"?(r.flags|=128,r.child=n.child,r=AT.bind(null,n),g._reactRetry=r,null):(n=m.treeContext,mn=Zi(g.nextSibling),gn=r,st=!0,xn=null,n!==null&&(_n[Pn++]=Ai,_n[Pn++]=Ii,_n[Pn++]=bo,Ai=n.id,Ii=n.overflow,bo=r),r=zd(r,f.children),r.flags|=4096,r)}function Pm(n,r,a){n.lanes|=r;var f=n.alternate;f!==null&&(f.lanes|=r),Td(n.return,r,a)}function jd(n,r,a,f,g){var m=n.memoizedState;m===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:a,tailMode:g}:(m.isBackwards=r,m.rendering=null,m.renderingStartTime=0,m.last=f,m.tail=a,m.tailMode=g)}function Rm(n,r,a){var f=r.pendingProps,g=f.revealOrder,m=f.tail;if(Zt(n,r,f.children,a),f=lt.current,(f&2)!==0)f=f&1|2,r.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Pm(n,a,r);else if(n.tag===19)Pm(n,a,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}f&=1}if(Je(lt,f),(r.mode&1)===0)r.memoizedState=null;else switch(g){case"forwards":for(a=r.child,g=null;a!==null;)n=a.alternate,n!==null&&Ll(n)===null&&(g=a),a=a.sibling;a=g,a===null?(g=r.child,r.child=null):(g=a.sibling,a.sibling=null),jd(r,!1,g,a,m);break;case"backwards":for(a=null,g=r.child,r.child=null;g!==null;){if(n=g.alternate,n!==null&&Ll(n)===null){r.child=g;break}n=g.sibling,g.sibling=a,a=g,g=n}jd(r,!0,a,null,m);break;case"together":jd(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function jl(n,r){(r.mode&1)===0&&n!==null&&(n.alternate=null,r.alternate=null,r.flags|=2)}function Ei(n,r,a){if(n!==null&&(r.dependencies=n.dependencies),Lo|=r.lanes,(a&r.childLanes)===0)return null;if(n!==null&&r.child!==n.child)throw Error(i(153));if(r.child!==null){for(n=r.child,a=ao(n,n.pendingProps),r.child=a,a.return=r;n.sibling!==null;)n=n.sibling,a=a.sibling=ao(n,n.pendingProps),a.return=r;a.sibling=null}return r.child}function aT(n,r,a){switch(r.tag){case 3:wm(r),Or();break;case 5:$g(r);break;case 1:an(r.type)&&Rl(r);break;case 4:Cd(r,r.stateNode.containerInfo);break;case 10:var f=r.type._context,g=r.memoizedProps.value;Je(Nl,f._currentValue),f._currentValue=g;break;case 13:if(f=r.memoizedState,f!==null)return f.dehydrated!==null?(Je(lt,lt.current&1),r.flags|=128,null):(a&r.child.childLanes)!==0?_m(n,r,a):(Je(lt,lt.current&1),n=Ei(n,r,a),n!==null?n.sibling:null);Je(lt,lt.current&1);break;case 19:if(f=(a&r.childLanes)!==0,(n.flags&128)!==0){if(f)return Rm(n,r,a);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),Je(lt,lt.current),f)break;return null;case 22:case 23:return r.lanes=0,Sm(n,r,a)}return Ei(n,r,a)}var Mm,Xd,km,Dm;Mm=function(n,r){for(var a=r.child;a!==null;){if(a.tag===5||a.tag===6)n.appendChild(a.stateNode);else if(a.tag!==4&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return;a=a.return}a.sibling.return=a.return,a=a.sibling}},Xd=function(){},km=function(n,r,a,f){var g=n.memoizedProps;if(g!==f){n=r.stateNode,Ho(ii.current);var m=null;switch(a){case"input":g=Qe(n,g),f=Qe(n,f),m=[];break;case"select":g=X({},g,{value:void 0}),f=X({},f,{value:void 0}),m=[];break;case"textarea":g=Mo(n,g),f=Mo(n,f),m=[];break;default:typeof g.onClick!="function"&&typeof f.onClick=="function"&&(n.onclick=Cl)}Pu(a,f);var T;a=null;for(U in g)if(!f.hasOwnProperty(U)&&g.hasOwnProperty(U)&&g[U]!=null)if(U==="style"){var P=g[U];for(T in P)P.hasOwnProperty(T)&&(a||(a={}),a[T]="")}else U!=="dangerouslySetInnerHTML"&&U!=="children"&&U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&U!=="autoFocus"&&(s.hasOwnProperty(U)?m||(m=[]):(m=m||[]).push(U,null));for(U in f){var k=f[U];if(P=g!=null?g[U]:void 0,f.hasOwnProperty(U)&&k!==P&&(k!=null||P!=null))if(U==="style")if(P){for(T in P)!P.hasOwnProperty(T)||k&&k.hasOwnProperty(T)||(a||(a={}),a[T]="");for(T in k)k.hasOwnProperty(T)&&P[T]!==k[T]&&(a||(a={}),a[T]=k[T])}else a||(m||(m=[]),m.push(U,a)),a=k;else U==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,P=P?P.__html:void 0,k!=null&&P!==k&&(m=m||[]).push(U,k)):U==="children"?typeof k!="string"&&typeof k!="number"||(m=m||[]).push(U,""+k):U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&(s.hasOwnProperty(U)?(k!=null&&U==="onScroll"&&tt("scroll",n),m||P===k||(m=[])):(m=m||[]).push(U,k))}a&&(m=m||[]).push("style",a);var U=m;(r.updateQueue=U)&&(r.flags|=4)}},Dm=function(n,r,a,f){a!==f&&(r.flags|=4)};function Js(n,r){if(!st)switch(n.tailMode){case"hidden":r=n.tail;for(var a=null;r!==null;)r.alternate!==null&&(a=r),r=r.sibling;a===null?n.tail=null:a.sibling=null;break;case"collapsed":a=n.tail;for(var f=null;a!==null;)a.alternate!==null&&(f=a),a=a.sibling;f===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:f.sibling=null}}function Wt(n){var r=n.alternate!==null&&n.alternate.child===n.child,a=0,f=0;if(r)for(var g=n.child;g!==null;)a|=g.lanes|g.childLanes,f|=g.subtreeFlags&14680064,f|=g.flags&14680064,g.return=n,g=g.sibling;else for(g=n.child;g!==null;)a|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=n,g=g.sibling;return n.subtreeFlags|=f,n.childLanes=a,r}function lT(n,r,a){var f=r.pendingProps;switch(gd(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(r),null;case 1:return an(r.type)&&Pl(),Wt(r),null;case 3:return f=r.stateNode,Hr(),nt(sn),nt(xt),Rd(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(n===null||n.child===null)&&(Ol(r)?r.flags|=4:n===null||n.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,xn!==null&&(rf(xn),xn=null))),Xd(n,r),Wt(r),null;case 5:_d(r);var g=Ho(Vs.current);if(a=r.type,n!==null&&r.stateNode!=null)km(n,r,a,f,g),n.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!f){if(r.stateNode===null)throw Error(i(166));return Wt(r),null}if(n=Ho(ii.current),Ol(r)){f=r.stateNode,a=r.type;var m=r.memoizedProps;switch(f[ni]=r,f[Ws]=m,n=(r.mode&1)!==0,a){case"dialog":tt("cancel",f),tt("close",f);break;case"iframe":case"object":case"embed":tt("load",f);break;case"video":case"audio":for(g=0;g<Gs.length;g++)tt(Gs[g],f);break;case"source":tt("error",f);break;case"img":case"image":case"link":tt("error",f),tt("load",f);break;case"details":tt("toggle",f);break;case"input":Ze(f,m),tt("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!m.multiple},tt("invalid",f);break;case"textarea":pp(f,m),tt("invalid",f)}Pu(a,m),g=null;for(var T in m)if(m.hasOwnProperty(T)){var P=m[T];T==="children"?typeof P=="string"?f.textContent!==P&&(m.suppressHydrationWarning!==!0&&wl(f.textContent,P,n),g=["children",P]):typeof P=="number"&&f.textContent!==""+P&&(m.suppressHydrationWarning!==!0&&wl(f.textContent,P,n),g=["children",""+P]):s.hasOwnProperty(T)&&P!=null&&T==="onScroll"&&tt("scroll",f)}switch(a){case"input":Ne(f),Cn(f,m,!0);break;case"textarea":Ne(f),mp(f);break;case"select":case"option":break;default:typeof m.onClick=="function"&&(f.onclick=Cl)}f=g,r.updateQueue=f,f!==null&&(r.flags|=4)}else{T=g.nodeType===9?g:g.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=yp(a)),n==="http://www.w3.org/1999/xhtml"?a==="script"?(n=T.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof f.is=="string"?n=T.createElement(a,{is:f.is}):(n=T.createElement(a),a==="select"&&(T=n,f.multiple?T.multiple=!0:f.size&&(T.size=f.size))):n=T.createElementNS(n,a),n[ni]=r,n[Ws]=f,Mm(n,r,!1,!1),r.stateNode=n;e:{switch(T=Ru(a,f),a){case"dialog":tt("cancel",n),tt("close",n),g=f;break;case"iframe":case"object":case"embed":tt("load",n),g=f;break;case"video":case"audio":for(g=0;g<Gs.length;g++)tt(Gs[g],n);g=f;break;case"source":tt("error",n),g=f;break;case"img":case"image":case"link":tt("error",n),tt("load",n),g=f;break;case"details":tt("toggle",n),g=f;break;case"input":Ze(n,f),g=Qe(n,f),tt("invalid",n);break;case"option":g=f;break;case"select":n._wrapperState={wasMultiple:!!f.multiple},g=X({},f,{value:void 0}),tt("invalid",n);break;case"textarea":pp(n,f),g=Mo(n,f),tt("invalid",n);break;default:g=f}Pu(a,g),P=g;for(m in P)if(P.hasOwnProperty(m)){var k=P[m];m==="style"?Ip(n,k):m==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,k!=null&&vp(n,k)):m==="children"?typeof k=="string"?(a!=="textarea"||k!=="")&&Ss(n,k):typeof k=="number"&&Ss(n,""+k):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(s.hasOwnProperty(m)?k!=null&&m==="onScroll"&&tt("scroll",n):k!=null&&C(n,m,k,T))}switch(a){case"input":Ne(n),Cn(n,f,!1);break;case"textarea":Ne(n),mp(n);break;case"option":f.value!=null&&n.setAttribute("value",""+Se(f.value));break;case"select":n.multiple=!!f.multiple,m=f.value,m!=null?Wi(n,!!f.multiple,m,!1):f.defaultValue!=null&&Wi(n,!!f.multiple,f.defaultValue,!0);break;default:typeof g.onClick=="function"&&(n.onclick=Cl)}switch(a){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Wt(r),null;case 6:if(n&&r.stateNode!=null)Dm(n,r,n.memoizedProps,f);else{if(typeof f!="string"&&r.stateNode===null)throw Error(i(166));if(a=Ho(Vs.current),Ho(ii.current),Ol(r)){if(f=r.stateNode,a=r.memoizedProps,f[ni]=r,(m=f.nodeValue!==a)&&(n=gn,n!==null))switch(n.tag){case 3:wl(f.nodeValue,a,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&wl(f.nodeValue,a,(n.mode&1)!==0)}m&&(r.flags|=4)}else f=(a.nodeType===9?a:a.ownerDocument).createTextNode(f),f[ni]=r,r.stateNode=f}return Wt(r),null;case 13:if(nt(lt),f=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(st&&mn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)Ng(),Or(),r.flags|=98560,m=!1;else if(m=Ol(r),f!==null&&f.dehydrated!==null){if(n===null){if(!m)throw Error(i(318));if(m=r.memoizedState,m=m!==null?m.dehydrated:null,!m)throw Error(i(317));m[ni]=r}else Or(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Wt(r),m=!1}else xn!==null&&(rf(xn),xn=null),m=!0;if(!m)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=a,r):(f=f!==null,f!==(n!==null&&n.memoizedState!==null)&&f&&(r.child.flags|=8192,(r.mode&1)!==0&&(n===null||(lt.current&1)!==0?Tt===0&&(Tt=3):lf())),r.updateQueue!==null&&(r.flags|=4),Wt(r),null);case 4:return Hr(),Xd(n,r),n===null&&xs(r.stateNode.containerInfo),Wt(r),null;case 10:return Sd(r.type._context),Wt(r),null;case 17:return an(r.type)&&Pl(),Wt(r),null;case 19:if(nt(lt),m=r.memoizedState,m===null)return Wt(r),null;if(f=(r.flags&128)!==0,T=m.rendering,T===null)if(f)Js(m,!1);else{if(Tt!==0||n!==null&&(n.flags&128)!==0)for(n=r.child;n!==null;){if(T=Ll(n),T!==null){for(r.flags|=128,Js(m,!1),f=T.updateQueue,f!==null&&(r.updateQueue=f,r.flags|=4),r.subtreeFlags=0,f=a,a=r.child;a!==null;)m=a,n=f,m.flags&=14680066,T=m.alternate,T===null?(m.childLanes=0,m.lanes=n,m.child=null,m.subtreeFlags=0,m.memoizedProps=null,m.memoizedState=null,m.updateQueue=null,m.dependencies=null,m.stateNode=null):(m.childLanes=T.childLanes,m.lanes=T.lanes,m.child=T.child,m.subtreeFlags=0,m.deletions=null,m.memoizedProps=T.memoizedProps,m.memoizedState=T.memoizedState,m.updateQueue=T.updateQueue,m.type=T.type,n=T.dependencies,m.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),a=a.sibling;return Je(lt,lt.current&1|2),r.child}n=n.sibling}m.tail!==null&&ht()>Gr&&(r.flags|=128,f=!0,Js(m,!1),r.lanes=4194304)}else{if(!f)if(n=Ll(T),n!==null){if(r.flags|=128,f=!0,a=n.updateQueue,a!==null&&(r.updateQueue=a,r.flags|=4),Js(m,!0),m.tail===null&&m.tailMode==="hidden"&&!T.alternate&&!st)return Wt(r),null}else 2*ht()-m.renderingStartTime>Gr&&a!==1073741824&&(r.flags|=128,f=!0,Js(m,!1),r.lanes=4194304);m.isBackwards?(T.sibling=r.child,r.child=T):(a=m.last,a!==null?a.sibling=T:r.child=T,m.last=T)}return m.tail!==null?(r=m.tail,m.rendering=r,m.tail=r.sibling,m.renderingStartTime=ht(),r.sibling=null,a=lt.current,Je(lt,f?a&1|2:a&1),r):(Wt(r),null);case 22:case 23:return af(),f=r.memoizedState!==null,n!==null&&n.memoizedState!==null!==f&&(r.flags|=8192),f&&(r.mode&1)!==0?(yn&1073741824)!==0&&(Wt(r),r.subtreeFlags&6&&(r.flags|=8192)):Wt(r),null;case 24:return null;case 25:return null}throw Error(i(156,r.tag))}function cT(n,r){switch(gd(r),r.tag){case 1:return an(r.type)&&Pl(),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return Hr(),nt(sn),nt(xt),Rd(),n=r.flags,(n&65536)!==0&&(n&128)===0?(r.flags=n&-65537|128,r):null;case 5:return _d(r),null;case 13:if(nt(lt),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error(i(340));Or()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return nt(lt),null;case 4:return Hr(),null;case 10:return Sd(r.type._context),null;case 22:case 23:return af(),null;case 24:return null;default:return null}}var Xl=!1,Yt=!1,uT=typeof WeakSet=="function"?WeakSet:Set,he=null;function Lr(n,r){var a=n.ref;if(a!==null)if(typeof a=="function")try{a(null)}catch(f){dt(n,r,f)}else a.current=null}function Vd(n,r,a){try{a()}catch(f){dt(n,r,f)}}var Om=!1;function dT(n,r){if(sd=hl,n=ug(),Qu(n)){if("selectionStart"in n)var a={start:n.selectionStart,end:n.selectionEnd};else e:{a=(a=n.ownerDocument)&&a.defaultView||window;var f=a.getSelection&&a.getSelection();if(f&&f.rangeCount!==0){a=f.anchorNode;var g=f.anchorOffset,m=f.focusNode;f=f.focusOffset;try{a.nodeType,m.nodeType}catch{a=null;break e}var T=0,P=-1,k=-1,U=0,Z=0,Q=n,V=null;t:for(;;){for(var de;Q!==a||g!==0&&Q.nodeType!==3||(P=T+g),Q!==m||f!==0&&Q.nodeType!==3||(k=T+f),Q.nodeType===3&&(T+=Q.nodeValue.length),(de=Q.firstChild)!==null;)V=Q,Q=de;for(;;){if(Q===n)break t;if(V===a&&++U===g&&(P=T),V===m&&++Z===f&&(k=T),(de=Q.nextSibling)!==null)break;Q=V,V=Q.parentNode}Q=de}a=P===-1||k===-1?null:{start:P,end:k}}else a=null}a=a||{start:0,end:0}}else a=null;for(ad={focusedElem:n,selectionRange:a},hl=!1,he=r;he!==null;)if(r=he,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,he=n;else for(;he!==null;){r=he;try{var ge=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(ge!==null){var me=ge.memoizedProps,pt=ge.memoizedState,H=r.stateNode,N=H.getSnapshotBeforeUpdate(r.elementType===r.type?me:$n(r.type,me),pt);H.__reactInternalSnapshotBeforeUpdate=N}break;case 3:var L=r.stateNode.containerInfo;L.nodeType===1?L.textContent="":L.nodeType===9&&L.documentElement&&L.removeChild(L.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(i(163))}}catch(ee){dt(r,r.return,ee)}if(n=r.sibling,n!==null){n.return=r.return,he=n;break}he=r.return}return ge=Om,Om=!1,ge}function ea(n,r,a){var f=r.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var g=f=f.next;do{if((g.tag&n)===n){var m=g.destroy;g.destroy=void 0,m!==void 0&&Vd(r,a,m)}g=g.next}while(g!==f)}}function Vl(n,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var a=r=r.next;do{if((a.tag&n)===n){var f=a.create;a.destroy=f()}a=a.next}while(a!==r)}}function qd(n){var r=n.ref;if(r!==null){var a=n.stateNode;switch(n.tag){case 5:n=a;break;default:n=a}typeof r=="function"?r(n):r.current=n}}function bm(n){var r=n.alternate;r!==null&&(n.alternate=null,bm(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&(delete r[ni],delete r[Ws],delete r[dd],delete r[XS],delete r[VS])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Nm(n){return n.tag===5||n.tag===3||n.tag===4}function Bm(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Nm(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function Zd(n,r,a){var f=n.tag;if(f===5||f===6)n=n.stateNode,r?a.nodeType===8?a.parentNode.insertBefore(n,r):a.insertBefore(n,r):(a.nodeType===8?(r=a.parentNode,r.insertBefore(n,a)):(r=a,r.appendChild(n)),a=a._reactRootContainer,a!=null||r.onclick!==null||(r.onclick=Cl));else if(f!==4&&(n=n.child,n!==null))for(Zd(n,r,a),n=n.sibling;n!==null;)Zd(n,r,a),n=n.sibling}function Kd(n,r,a){var f=n.tag;if(f===5||f===6)n=n.stateNode,r?a.insertBefore(n,r):a.appendChild(n);else if(f!==4&&(n=n.child,n!==null))for(Kd(n,r,a),n=n.sibling;n!==null;)Kd(n,r,a),n=n.sibling}var Nt=null,Wn=!1;function no(n,r,a){for(a=a.child;a!==null;)Hm(n,r,a),a=a.sibling}function Hm(n,r,a){if(ti&&typeof ti.onCommitFiberUnmount=="function")try{ti.onCommitFiberUnmount(al,a)}catch{}switch(a.tag){case 5:Yt||Lr(a,r);case 6:var f=Nt,g=Wn;Nt=null,no(n,r,a),Nt=f,Wn=g,Nt!==null&&(Wn?(n=Nt,a=a.stateNode,n.nodeType===8?n.parentNode.removeChild(a):n.removeChild(a)):Nt.removeChild(a.stateNode));break;case 18:Nt!==null&&(Wn?(n=Nt,a=a.stateNode,n.nodeType===8?ud(n.parentNode,a):n.nodeType===1&&ud(n,a),Os(n)):ud(Nt,a.stateNode));break;case 4:f=Nt,g=Wn,Nt=a.stateNode.containerInfo,Wn=!0,no(n,r,a),Nt=f,Wn=g;break;case 0:case 11:case 14:case 15:if(!Yt&&(f=a.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){g=f=f.next;do{var m=g,T=m.destroy;m=m.tag,T!==void 0&&((m&2)!==0||(m&4)!==0)&&Vd(a,r,T),g=g.next}while(g!==f)}no(n,r,a);break;case 1:if(!Yt&&(Lr(a,r),f=a.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=a.memoizedProps,f.state=a.memoizedState,f.componentWillUnmount()}catch(P){dt(a,r,P)}no(n,r,a);break;case 21:no(n,r,a);break;case 22:a.mode&1?(Yt=(f=Yt)||a.memoizedState!==null,no(n,r,a),Yt=f):no(n,r,a);break;default:no(n,r,a)}}function Fm(n){var r=n.updateQueue;if(r!==null){n.updateQueue=null;var a=n.stateNode;a===null&&(a=n.stateNode=new uT),r.forEach(function(f){var g=IT.bind(null,n,f);a.has(f)||(a.add(f),f.then(g,g))})}}function Yn(n,r){var a=r.deletions;if(a!==null)for(var f=0;f<a.length;f++){var g=a[f];try{var m=n,T=r,P=T;e:for(;P!==null;){switch(P.tag){case 5:Nt=P.stateNode,Wn=!1;break e;case 3:Nt=P.stateNode.containerInfo,Wn=!0;break e;case 4:Nt=P.stateNode.containerInfo,Wn=!0;break e}P=P.return}if(Nt===null)throw Error(i(160));Hm(m,T,g),Nt=null,Wn=!1;var k=g.alternate;k!==null&&(k.return=null),g.return=null}catch(U){dt(g,r,U)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)Lm(r,n),r=r.sibling}function Lm(n,r){var a=n.alternate,f=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Yn(r,n),ri(n),f&4){try{ea(3,n,n.return),Vl(3,n)}catch(me){dt(n,n.return,me)}try{ea(5,n,n.return)}catch(me){dt(n,n.return,me)}}break;case 1:Yn(r,n),ri(n),f&512&&a!==null&&Lr(a,a.return);break;case 5:if(Yn(r,n),ri(n),f&512&&a!==null&&Lr(a,a.return),n.flags&32){var g=n.stateNode;try{Ss(g,"")}catch(me){dt(n,n.return,me)}}if(f&4&&(g=n.stateNode,g!=null)){var m=n.memoizedProps,T=a!==null?a.memoizedProps:m,P=n.type,k=n.updateQueue;if(n.updateQueue=null,k!==null)try{P==="input"&&m.type==="radio"&&m.name!=null&&wn(g,m),Ru(P,T);var U=Ru(P,m);for(T=0;T<k.length;T+=2){var Z=k[T],Q=k[T+1];Z==="style"?Ip(g,Q):Z==="dangerouslySetInnerHTML"?vp(g,Q):Z==="children"?Ss(g,Q):C(g,Z,Q,U)}switch(P){case"input":rn(g,m);break;case"textarea":gp(g,m);break;case"select":var V=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!m.multiple;var de=m.value;de!=null?Wi(g,!!m.multiple,de,!1):V!==!!m.multiple&&(m.defaultValue!=null?Wi(g,!!m.multiple,m.defaultValue,!0):Wi(g,!!m.multiple,m.multiple?[]:"",!1))}g[Ws]=m}catch(me){dt(n,n.return,me)}}break;case 6:if(Yn(r,n),ri(n),f&4){if(n.stateNode===null)throw Error(i(162));g=n.stateNode,m=n.memoizedProps;try{g.nodeValue=m}catch(me){dt(n,n.return,me)}}break;case 3:if(Yn(r,n),ri(n),f&4&&a!==null&&a.memoizedState.isDehydrated)try{Os(r.containerInfo)}catch(me){dt(n,n.return,me)}break;case 4:Yn(r,n),ri(n);break;case 13:Yn(r,n),ri(n),g=n.child,g.flags&8192&&(m=g.memoizedState!==null,g.stateNode.isHidden=m,!m||g.alternate!==null&&g.alternate.memoizedState!==null||(ef=ht())),f&4&&Fm(n);break;case 22:if(Z=a!==null&&a.memoizedState!==null,n.mode&1?(Yt=(U=Yt)||Z,Yn(r,n),Yt=U):Yn(r,n),ri(n),f&8192){if(U=n.memoizedState!==null,(n.stateNode.isHidden=U)&&!Z&&(n.mode&1)!==0)for(he=n,Z=n.child;Z!==null;){for(Q=he=Z;he!==null;){switch(V=he,de=V.child,V.tag){case 0:case 11:case 14:case 15:ea(4,V,V.return);break;case 1:Lr(V,V.return);var ge=V.stateNode;if(typeof ge.componentWillUnmount=="function"){f=V,a=V.return;try{r=f,ge.props=r.memoizedProps,ge.state=r.memoizedState,ge.componentWillUnmount()}catch(me){dt(f,a,me)}}break;case 5:Lr(V,V.return);break;case 22:if(V.memoizedState!==null){xm(Q);continue}}de!==null?(de.return=V,he=de):xm(Q)}Z=Z.sibling}e:for(Z=null,Q=n;;){if(Q.tag===5){if(Z===null){Z=Q;try{g=Q.stateNode,U?(m=g.style,typeof m.setProperty=="function"?m.setProperty("display","none","important"):m.display="none"):(P=Q.stateNode,k=Q.memoizedProps.style,T=k!=null&&k.hasOwnProperty("display")?k.display:null,P.style.display=Ap("display",T))}catch(me){dt(n,n.return,me)}}}else if(Q.tag===6){if(Z===null)try{Q.stateNode.nodeValue=U?"":Q.memoizedProps}catch(me){dt(n,n.return,me)}}else if((Q.tag!==22&&Q.tag!==23||Q.memoizedState===null||Q===n)&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===n)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===n)break e;Z===Q&&(Z=null),Q=Q.return}Z===Q&&(Z=null),Q.sibling.return=Q.return,Q=Q.sibling}}break;case 19:Yn(r,n),ri(n),f&4&&Fm(n);break;case 21:break;default:Yn(r,n),ri(n)}}function ri(n){var r=n.flags;if(r&2){try{e:{for(var a=n.return;a!==null;){if(Nm(a)){var f=a;break e}a=a.return}throw Error(i(160))}switch(f.tag){case 5:var g=f.stateNode;f.flags&32&&(Ss(g,""),f.flags&=-33);var m=Bm(n);Kd(n,m,g);break;case 3:case 4:var T=f.stateNode.containerInfo,P=Bm(n);Zd(n,P,T);break;default:throw Error(i(161))}}catch(k){dt(n,n.return,k)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function fT(n,r,a){he=n,Um(n)}function Um(n,r,a){for(var f=(n.mode&1)!==0;he!==null;){var g=he,m=g.child;if(g.tag===22&&f){var T=g.memoizedState!==null||Xl;if(!T){var P=g.alternate,k=P!==null&&P.memoizedState!==null||Yt;P=Xl;var U=Yt;if(Xl=T,(Yt=k)&&!U)for(he=g;he!==null;)T=he,k=T.child,T.tag===22&&T.memoizedState!==null?$m(g):k!==null?(k.return=T,he=k):$m(g);for(;m!==null;)he=m,Um(m),m=m.sibling;he=g,Xl=P,Yt=U}Gm(n)}else(g.subtreeFlags&8772)!==0&&m!==null?(m.return=g,he=m):Gm(n)}}function Gm(n){for(;he!==null;){var r=he;if((r.flags&8772)!==0){var a=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:Yt||Vl(5,r);break;case 1:var f=r.stateNode;if(r.flags&4&&!Yt)if(a===null)f.componentDidMount();else{var g=r.elementType===r.type?a.memoizedProps:$n(r.type,a.memoizedProps);f.componentDidUpdate(g,a.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var m=r.updateQueue;m!==null&&xg(r,m,f);break;case 3:var T=r.updateQueue;if(T!==null){if(a=null,r.child!==null)switch(r.child.tag){case 5:a=r.child.stateNode;break;case 1:a=r.child.stateNode}xg(r,T,a)}break;case 5:var P=r.stateNode;if(a===null&&r.flags&4){a=P;var k=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":k.autoFocus&&a.focus();break;case"img":k.src&&(a.src=k.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var U=r.alternate;if(U!==null){var Z=U.memoizedState;if(Z!==null){var Q=Z.dehydrated;Q!==null&&Os(Q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(i(163))}Yt||r.flags&512&&qd(r)}catch(V){dt(r,r.return,V)}}if(r===n){he=null;break}if(a=r.sibling,a!==null){a.return=r.return,he=a;break}he=r.return}}function xm(n){for(;he!==null;){var r=he;if(r===n){he=null;break}var a=r.sibling;if(a!==null){a.return=r.return,he=a;break}he=r.return}}function $m(n){for(;he!==null;){var r=he;try{switch(r.tag){case 0:case 11:case 15:var a=r.return;try{Vl(4,r)}catch(k){dt(r,a,k)}break;case 1:var f=r.stateNode;if(typeof f.componentDidMount=="function"){var g=r.return;try{f.componentDidMount()}catch(k){dt(r,g,k)}}var m=r.return;try{qd(r)}catch(k){dt(r,m,k)}break;case 5:var T=r.return;try{qd(r)}catch(k){dt(r,T,k)}}}catch(k){dt(r,r.return,k)}if(r===n){he=null;break}var P=r.sibling;if(P!==null){P.return=r.return,he=P;break}he=r.return}}var hT=Math.ceil,ql=R.ReactCurrentDispatcher,Qd=R.ReactCurrentOwner,kn=R.ReactCurrentBatchConfig,Ue=0,Pt=null,yt=null,Bt=0,yn=0,Ur=Ki(0),Tt=0,ta=null,Lo=0,Zl=0,Jd=0,na=null,cn=null,ef=0,Gr=1/0,wi=null,Kl=!1,tf=null,io=null,Ql=!1,oo=null,Jl=0,ia=0,nf=null,ec=-1,tc=0;function Kt(){return(Ue&6)!==0?ht():ec!==-1?ec:ec=ht()}function ro(n){return(n.mode&1)===0?1:(Ue&2)!==0&&Bt!==0?Bt&-Bt:ZS.transition!==null?(tc===0&&(tc=Bp()),tc):(n=ze,n!==0||(n=window.event,n=n===void 0?16:Yp(n.type)),n)}function zn(n,r,a,f){if(50<ia)throw ia=0,nf=null,Error(i(185));Ps(n,a,f),((Ue&2)===0||n!==Pt)&&(n===Pt&&((Ue&2)===0&&(Zl|=a),Tt===4&&so(n,Bt)),un(n,f),a===1&&Ue===0&&(r.mode&1)===0&&(Gr=ht()+500,Ml&&Ji()))}function un(n,r){var a=n.callbackNode;ZI(n,r);var f=ul(n,n===Pt?Bt:0);if(f===0)a!==null&&Op(a),n.callbackNode=null,n.callbackPriority=0;else if(r=f&-f,n.callbackPriority!==r){if(a!=null&&Op(a),r===1)n.tag===0?qS(Ym.bind(null,n)):Mg(Ym.bind(null,n)),zS(function(){(Ue&6)===0&&Ji()}),a=null;else{switch(Hp(f)){case 1:a=Bu;break;case 4:a=bp;break;case 16:a=sl;break;case 536870912:a=Np;break;default:a=sl}a=Qm(a,Wm.bind(null,n))}n.callbackPriority=r,n.callbackNode=a}}function Wm(n,r){if(ec=-1,tc=0,(Ue&6)!==0)throw Error(i(327));var a=n.callbackNode;if(xr()&&n.callbackNode!==a)return null;var f=ul(n,n===Pt?Bt:0);if(f===0)return null;if((f&30)!==0||(f&n.expiredLanes)!==0||r)r=nc(n,f);else{r=f;var g=Ue;Ue|=2;var m=jm();(Pt!==n||Bt!==r)&&(wi=null,Gr=ht()+500,Go(n,r));do try{mT();break}catch(P){zm(n,P)}while(!0);Id(),ql.current=m,Ue=g,yt!==null?r=0:(Pt=null,Bt=0,r=Tt)}if(r!==0){if(r===2&&(g=Hu(n),g!==0&&(f=g,r=of(n,g))),r===1)throw a=ta,Go(n,0),so(n,f),un(n,ht()),a;if(r===6)so(n,f);else{if(g=n.current.alternate,(f&30)===0&&!pT(g)&&(r=nc(n,f),r===2&&(m=Hu(n),m!==0&&(f=m,r=of(n,m))),r===1))throw a=ta,Go(n,0),so(n,f),un(n,ht()),a;switch(n.finishedWork=g,n.finishedLanes=f,r){case 0:case 1:throw Error(i(345));case 2:xo(n,cn,wi);break;case 3:if(so(n,f),(f&130023424)===f&&(r=ef+500-ht(),10<r)){if(ul(n,0)!==0)break;if(g=n.suspendedLanes,(g&f)!==f){Kt(),n.pingedLanes|=n.suspendedLanes&g;break}n.timeoutHandle=cd(xo.bind(null,n,cn,wi),r);break}xo(n,cn,wi);break;case 4:if(so(n,f),(f&4194240)===f)break;for(r=n.eventTimes,g=-1;0<f;){var T=31-Un(f);m=1<<T,T=r[T],T>g&&(g=T),f&=~m}if(f=g,f=ht()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*hT(f/1960))-f,10<f){n.timeoutHandle=cd(xo.bind(null,n,cn,wi),f);break}xo(n,cn,wi);break;case 5:xo(n,cn,wi);break;default:throw Error(i(329))}}}return un(n,ht()),n.callbackNode===a?Wm.bind(null,n):null}function of(n,r){var a=na;return n.current.memoizedState.isDehydrated&&(Go(n,r).flags|=256),n=nc(n,r),n!==2&&(r=cn,cn=a,r!==null&&rf(r)),n}function rf(n){cn===null?cn=n:cn.push.apply(cn,n)}function pT(n){for(var r=n;;){if(r.flags&16384){var a=r.updateQueue;if(a!==null&&(a=a.stores,a!==null))for(var f=0;f<a.length;f++){var g=a[f],m=g.getSnapshot;g=g.value;try{if(!Gn(m(),g))return!1}catch{return!1}}}if(a=r.child,r.subtreeFlags&16384&&a!==null)a.return=r,r=a;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function so(n,r){for(r&=~Jd,r&=~Zl,n.suspendedLanes|=r,n.pingedLanes&=~r,n=n.expirationTimes;0<r;){var a=31-Un(r),f=1<<a;n[a]=-1,r&=~f}}function Ym(n){if((Ue&6)!==0)throw Error(i(327));xr();var r=ul(n,0);if((r&1)===0)return un(n,ht()),null;var a=nc(n,r);if(n.tag!==0&&a===2){var f=Hu(n);f!==0&&(r=f,a=of(n,f))}if(a===1)throw a=ta,Go(n,0),so(n,r),un(n,ht()),a;if(a===6)throw Error(i(345));return n.finishedWork=n.current.alternate,n.finishedLanes=r,xo(n,cn,wi),un(n,ht()),null}function sf(n,r){var a=Ue;Ue|=1;try{return n(r)}finally{Ue=a,Ue===0&&(Gr=ht()+500,Ml&&Ji())}}function Uo(n){oo!==null&&oo.tag===0&&(Ue&6)===0&&xr();var r=Ue;Ue|=1;var a=kn.transition,f=ze;try{if(kn.transition=null,ze=1,n)return n()}finally{ze=f,kn.transition=a,Ue=r,(Ue&6)===0&&Ji()}}function af(){yn=Ur.current,nt(Ur)}function Go(n,r){n.finishedWork=null,n.finishedLanes=0;var a=n.timeoutHandle;if(a!==-1&&(n.timeoutHandle=-1,YS(a)),yt!==null)for(a=yt.return;a!==null;){var f=a;switch(gd(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&Pl();break;case 3:Hr(),nt(sn),nt(xt),Rd();break;case 5:_d(f);break;case 4:Hr();break;case 13:nt(lt);break;case 19:nt(lt);break;case 10:Sd(f.type._context);break;case 22:case 23:af()}a=a.return}if(Pt=n,yt=n=ao(n.current,null),Bt=yn=r,Tt=0,ta=null,Jd=Zl=Lo=0,cn=na=null,Bo!==null){for(r=0;r<Bo.length;r++)if(a=Bo[r],f=a.interleaved,f!==null){a.interleaved=null;var g=f.next,m=a.pending;if(m!==null){var T=m.next;m.next=g,f.next=T}a.pending=f}Bo=null}return n}function zm(n,r){do{var a=yt;try{if(Id(),Ul.current=Wl,Gl){for(var f=ct.memoizedState;f!==null;){var g=f.queue;g!==null&&(g.pending=null),f=f.next}Gl=!1}if(Fo=0,_t=St=ct=null,qs=!1,Zs=0,Qd.current=null,a===null||a.return===null){Tt=1,ta=r,yt=null;break}e:{var m=n,T=a.return,P=a,k=r;if(r=Bt,P.flags|=32768,k!==null&&typeof k=="object"&&typeof k.then=="function"){var U=k,Z=P,Q=Z.tag;if((Z.mode&1)===0&&(Q===0||Q===11||Q===15)){var V=Z.alternate;V?(Z.updateQueue=V.updateQueue,Z.memoizedState=V.memoizedState,Z.lanes=V.lanes):(Z.updateQueue=null,Z.memoizedState=null)}var de=mm(T);if(de!==null){de.flags&=-257,ym(de,T,P,m,r),de.mode&1&&gm(m,U,r),r=de,k=U;var ge=r.updateQueue;if(ge===null){var me=new Set;me.add(k),r.updateQueue=me}else ge.add(k);break e}else{if((r&1)===0){gm(m,U,r),lf();break e}k=Error(i(426))}}else if(st&&P.mode&1){var pt=mm(T);if(pt!==null){(pt.flags&65536)===0&&(pt.flags|=256),ym(pt,T,P,m,r),vd(Fr(k,P));break e}}m=k=Fr(k,P),Tt!==4&&(Tt=2),na===null?na=[m]:na.push(m),m=T;do{switch(m.tag){case 3:m.flags|=65536,r&=-r,m.lanes|=r;var H=hm(m,k,r);Gg(m,H);break e;case 1:P=k;var N=m.type,L=m.stateNode;if((m.flags&128)===0&&(typeof N.getDerivedStateFromError=="function"||L!==null&&typeof L.componentDidCatch=="function"&&(io===null||!io.has(L)))){m.flags|=65536,r&=-r,m.lanes|=r;var ee=pm(m,P,r);Gg(m,ee);break e}}m=m.return}while(m!==null)}Vm(a)}catch(Ie){r=Ie,yt===a&&a!==null&&(yt=a=a.return);continue}break}while(!0)}function jm(){var n=ql.current;return ql.current=Wl,n===null?Wl:n}function lf(){(Tt===0||Tt===3||Tt===2)&&(Tt=4),Pt===null||(Lo&268435455)===0&&(Zl&268435455)===0||so(Pt,Bt)}function nc(n,r){var a=Ue;Ue|=2;var f=jm();(Pt!==n||Bt!==r)&&(wi=null,Go(n,r));do try{gT();break}catch(g){zm(n,g)}while(!0);if(Id(),Ue=a,ql.current=f,yt!==null)throw Error(i(261));return Pt=null,Bt=0,Tt}function gT(){for(;yt!==null;)Xm(yt)}function mT(){for(;yt!==null&&!xI();)Xm(yt)}function Xm(n){var r=Km(n.alternate,n,yn);n.memoizedProps=n.pendingProps,r===null?Vm(n):yt=r,Qd.current=null}function Vm(n){var r=n;do{var a=r.alternate;if(n=r.return,(r.flags&32768)===0){if(a=lT(a,r,yn),a!==null){yt=a;return}}else{if(a=cT(a,r),a!==null){a.flags&=32767,yt=a;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Tt=6,yt=null;return}}if(r=r.sibling,r!==null){yt=r;return}yt=r=n}while(r!==null);Tt===0&&(Tt=5)}function xo(n,r,a){var f=ze,g=kn.transition;try{kn.transition=null,ze=1,yT(n,r,a,f)}finally{kn.transition=g,ze=f}return null}function yT(n,r,a,f){do xr();while(oo!==null);if((Ue&6)!==0)throw Error(i(327));a=n.finishedWork;var g=n.finishedLanes;if(a===null)return null;if(n.finishedWork=null,n.finishedLanes=0,a===n.current)throw Error(i(177));n.callbackNode=null,n.callbackPriority=0;var m=a.lanes|a.childLanes;if(KI(n,m),n===Pt&&(yt=Pt=null,Bt=0),(a.subtreeFlags&2064)===0&&(a.flags&2064)===0||Ql||(Ql=!0,Qm(sl,function(){return xr(),null})),m=(a.flags&15990)!==0,(a.subtreeFlags&15990)!==0||m){m=kn.transition,kn.transition=null;var T=ze;ze=1;var P=Ue;Ue|=4,Qd.current=null,dT(n,a),Lm(a,n),FS(ad),hl=!!sd,ad=sd=null,n.current=a,fT(a),$I(),Ue=P,ze=T,kn.transition=m}else n.current=a;if(Ql&&(Ql=!1,oo=n,Jl=g),m=n.pendingLanes,m===0&&(io=null),zI(a.stateNode),un(n,ht()),r!==null)for(f=n.onRecoverableError,a=0;a<r.length;a++)g=r[a],f(g.value,{componentStack:g.stack,digest:g.digest});if(Kl)throw Kl=!1,n=tf,tf=null,n;return(Jl&1)!==0&&n.tag!==0&&xr(),m=n.pendingLanes,(m&1)!==0?n===nf?ia++:(ia=0,nf=n):ia=0,Ji(),null}function xr(){if(oo!==null){var n=Hp(Jl),r=kn.transition,a=ze;try{if(kn.transition=null,ze=16>n?16:n,oo===null)var f=!1;else{if(n=oo,oo=null,Jl=0,(Ue&6)!==0)throw Error(i(331));var g=Ue;for(Ue|=4,he=n.current;he!==null;){var m=he,T=m.child;if((he.flags&16)!==0){var P=m.deletions;if(P!==null){for(var k=0;k<P.length;k++){var U=P[k];for(he=U;he!==null;){var Z=he;switch(Z.tag){case 0:case 11:case 15:ea(8,Z,m)}var Q=Z.child;if(Q!==null)Q.return=Z,he=Q;else for(;he!==null;){Z=he;var V=Z.sibling,de=Z.return;if(bm(Z),Z===U){he=null;break}if(V!==null){V.return=de,he=V;break}he=de}}}var ge=m.alternate;if(ge!==null){var me=ge.child;if(me!==null){ge.child=null;do{var pt=me.sibling;me.sibling=null,me=pt}while(me!==null)}}he=m}}if((m.subtreeFlags&2064)!==0&&T!==null)T.return=m,he=T;else e:for(;he!==null;){if(m=he,(m.flags&2048)!==0)switch(m.tag){case 0:case 11:case 15:ea(9,m,m.return)}var H=m.sibling;if(H!==null){H.return=m.return,he=H;break e}he=m.return}}var N=n.current;for(he=N;he!==null;){T=he;var L=T.child;if((T.subtreeFlags&2064)!==0&&L!==null)L.return=T,he=L;else e:for(T=N;he!==null;){if(P=he,(P.flags&2048)!==0)try{switch(P.tag){case 0:case 11:case 15:Vl(9,P)}}catch(Ie){dt(P,P.return,Ie)}if(P===T){he=null;break e}var ee=P.sibling;if(ee!==null){ee.return=P.return,he=ee;break e}he=P.return}}if(Ue=g,Ji(),ti&&typeof ti.onPostCommitFiberRoot=="function")try{ti.onPostCommitFiberRoot(al,n)}catch{}f=!0}return f}finally{ze=a,kn.transition=r}}return!1}function qm(n,r,a){r=Fr(a,r),r=hm(n,r,1),n=to(n,r,1),r=Kt(),n!==null&&(Ps(n,1,r),un(n,r))}function dt(n,r,a){if(n.tag===3)qm(n,n,a);else for(;r!==null;){if(r.tag===3){qm(r,n,a);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(io===null||!io.has(f))){n=Fr(a,n),n=pm(r,n,1),r=to(r,n,1),n=Kt(),r!==null&&(Ps(r,1,n),un(r,n));break}}r=r.return}}function vT(n,r,a){var f=n.pingCache;f!==null&&f.delete(r),r=Kt(),n.pingedLanes|=n.suspendedLanes&a,Pt===n&&(Bt&a)===a&&(Tt===4||Tt===3&&(Bt&130023424)===Bt&&500>ht()-ef?Go(n,0):Jd|=a),un(n,r)}function Zm(n,r){r===0&&((n.mode&1)===0?r=1:(r=cl,cl<<=1,(cl&130023424)===0&&(cl=4194304)));var a=Kt();n=Si(n,r),n!==null&&(Ps(n,r,a),un(n,a))}function AT(n){var r=n.memoizedState,a=0;r!==null&&(a=r.retryLane),Zm(n,a)}function IT(n,r){var a=0;switch(n.tag){case 13:var f=n.stateNode,g=n.memoizedState;g!==null&&(a=g.retryLane);break;case 19:f=n.stateNode;break;default:throw Error(i(314))}f!==null&&f.delete(r),Zm(n,a)}var Km;Km=function(n,r,a){if(n!==null)if(n.memoizedProps!==r.pendingProps||sn.current)ln=!0;else{if((n.lanes&a)===0&&(r.flags&128)===0)return ln=!1,aT(n,r,a);ln=(n.flags&131072)!==0}else ln=!1,st&&(r.flags&1048576)!==0&&kg(r,Dl,r.index);switch(r.lanes=0,r.tag){case 2:var f=r.type;jl(n,r),n=r.pendingProps;var g=Mr(r,xt.current);Br(r,a),g=Dd(null,r,f,n,g,a);var m=Od();return r.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,an(f)?(m=!0,Rl(r)):m=!1,r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,wd(r),g.updater=Yl,r.stateNode=g,g._reactInternals=r,Ld(r,f,n,a),r=$d(null,r,f,!0,m,a)):(r.tag=0,st&&m&&pd(r),Zt(null,r,g,a),r=r.child),r;case 16:f=r.elementType;e:{switch(jl(n,r),n=r.pendingProps,g=f._init,f=g(f._payload),r.type=f,g=r.tag=TT(f),n=$n(f,n),g){case 0:r=xd(null,r,f,n,a);break e;case 1:r=Em(null,r,f,n,a);break e;case 11:r=vm(null,r,f,n,a);break e;case 14:r=Am(null,r,f,$n(f.type,n),a);break e}throw Error(i(306,f,""))}return r;case 0:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:$n(f,g),xd(n,r,f,g,a);case 1:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:$n(f,g),Em(n,r,f,g,a);case 3:e:{if(wm(r),n===null)throw Error(i(387));f=r.pendingProps,m=r.memoizedState,g=m.element,Ug(n,r),Fl(r,f,null,a);var T=r.memoizedState;if(f=T.element,m.isDehydrated)if(m={element:f,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},r.updateQueue.baseState=m,r.memoizedState=m,r.flags&256){g=Fr(Error(i(423)),r),r=Cm(n,r,f,a,g);break e}else if(f!==g){g=Fr(Error(i(424)),r),r=Cm(n,r,f,a,g);break e}else for(mn=Zi(r.stateNode.containerInfo.firstChild),gn=r,st=!0,xn=null,a=Fg(r,null,f,a),r.child=a;a;)a.flags=a.flags&-3|4096,a=a.sibling;else{if(Or(),f===g){r=Ei(n,r,a);break e}Zt(n,r,f,a)}r=r.child}return r;case 5:return $g(r),n===null&&yd(r),f=r.type,g=r.pendingProps,m=n!==null?n.memoizedProps:null,T=g.children,ld(f,g)?T=null:m!==null&&ld(f,m)&&(r.flags|=32),Tm(n,r),Zt(n,r,T,a),r.child;case 6:return n===null&&yd(r),null;case 13:return _m(n,r,a);case 4:return Cd(r,r.stateNode.containerInfo),f=r.pendingProps,n===null?r.child=br(r,null,f,a):Zt(n,r,f,a),r.child;case 11:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:$n(f,g),vm(n,r,f,g,a);case 7:return Zt(n,r,r.pendingProps,a),r.child;case 8:return Zt(n,r,r.pendingProps.children,a),r.child;case 12:return Zt(n,r,r.pendingProps.children,a),r.child;case 10:e:{if(f=r.type._context,g=r.pendingProps,m=r.memoizedProps,T=g.value,Je(Nl,f._currentValue),f._currentValue=T,m!==null)if(Gn(m.value,T)){if(m.children===g.children&&!sn.current){r=Ei(n,r,a);break e}}else for(m=r.child,m!==null&&(m.return=r);m!==null;){var P=m.dependencies;if(P!==null){T=m.child;for(var k=P.firstContext;k!==null;){if(k.context===f){if(m.tag===1){k=Ti(-1,a&-a),k.tag=2;var U=m.updateQueue;if(U!==null){U=U.shared;var Z=U.pending;Z===null?k.next=k:(k.next=Z.next,Z.next=k),U.pending=k}}m.lanes|=a,k=m.alternate,k!==null&&(k.lanes|=a),Td(m.return,a,r),P.lanes|=a;break}k=k.next}}else if(m.tag===10)T=m.type===r.type?null:m.child;else if(m.tag===18){if(T=m.return,T===null)throw Error(i(341));T.lanes|=a,P=T.alternate,P!==null&&(P.lanes|=a),Td(T,a,r),T=m.sibling}else T=m.child;if(T!==null)T.return=m;else for(T=m;T!==null;){if(T===r){T=null;break}if(m=T.sibling,m!==null){m.return=T.return,T=m;break}T=T.return}m=T}Zt(n,r,g.children,a),r=r.child}return r;case 9:return g=r.type,f=r.pendingProps.children,Br(r,a),g=Rn(g),f=f(g),r.flags|=1,Zt(n,r,f,a),r.child;case 14:return f=r.type,g=$n(f,r.pendingProps),g=$n(f.type,g),Am(n,r,f,g,a);case 15:return Im(n,r,r.type,r.pendingProps,a);case 17:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:$n(f,g),jl(n,r),r.tag=1,an(f)?(n=!0,Rl(r)):n=!1,Br(r,a),dm(r,f,g),Ld(r,f,g,a),$d(null,r,f,!0,n,a);case 19:return Rm(n,r,a);case 22:return Sm(n,r,a)}throw Error(i(156,r.tag))};function Qm(n,r){return Dp(n,r)}function ST(n,r,a,f){this.tag=n,this.key=a,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Dn(n,r,a,f){return new ST(n,r,a,f)}function cf(n){return n=n.prototype,!(!n||!n.isReactComponent)}function TT(n){if(typeof n=="function")return cf(n)?1:0;if(n!=null){if(n=n.$$typeof,n===z)return 11;if(n===se)return 14}return 2}function ao(n,r){var a=n.alternate;return a===null?(a=Dn(n.tag,r,n.key,n.mode),a.elementType=n.elementType,a.type=n.type,a.stateNode=n.stateNode,a.alternate=n,n.alternate=a):(a.pendingProps=r,a.type=n.type,a.flags=0,a.subtreeFlags=0,a.deletions=null),a.flags=n.flags&14680064,a.childLanes=n.childLanes,a.lanes=n.lanes,a.child=n.child,a.memoizedProps=n.memoizedProps,a.memoizedState=n.memoizedState,a.updateQueue=n.updateQueue,r=n.dependencies,a.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},a.sibling=n.sibling,a.index=n.index,a.ref=n.ref,a}function ic(n,r,a,f,g,m){var T=2;if(f=n,typeof n=="function")cf(n)&&(T=1);else if(typeof n=="string")T=5;else e:switch(n){case B:return $o(a.children,g,m,r);case F:T=8,g|=8;break;case G:return n=Dn(12,a,r,g|2),n.elementType=G,n.lanes=m,n;case te:return n=Dn(13,a,r,g),n.elementType=te,n.lanes=m,n;case K:return n=Dn(19,a,r,g),n.elementType=K,n.lanes=m,n;case ne:return oc(a,g,m,r);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Y:T=10;break e;case J:T=9;break e;case z:T=11;break e;case se:T=14;break e;case ce:T=16,f=null;break e}throw Error(i(130,n==null?n:typeof n,""))}return r=Dn(T,a,r,g),r.elementType=n,r.type=f,r.lanes=m,r}function $o(n,r,a,f){return n=Dn(7,n,f,r),n.lanes=a,n}function oc(n,r,a,f){return n=Dn(22,n,f,r),n.elementType=ne,n.lanes=a,n.stateNode={isHidden:!1},n}function uf(n,r,a){return n=Dn(6,n,null,r),n.lanes=a,n}function df(n,r,a){return r=Dn(4,n.children!==null?n.children:[],n.key,r),r.lanes=a,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}function ET(n,r,a,f,g){this.tag=r,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Fu(0),this.expirationTimes=Fu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Fu(0),this.identifierPrefix=f,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function ff(n,r,a,f,g,m,T,P,k){return n=new ET(n,r,a,P,k),r===1?(r=1,m===!0&&(r|=8)):r=0,m=Dn(3,null,null,r),n.current=m,m.stateNode=n,m.memoizedState={element:f,isDehydrated:a,cache:null,transitions:null,pendingSuspenseBoundaries:null},wd(m),n}function wT(n,r,a){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:M,key:f==null?null:""+f,children:n,containerInfo:r,implementation:a}}function Jm(n){if(!n)return Qi;n=n._reactInternals;e:{if(ko(n)!==n||n.tag!==1)throw Error(i(170));var r=n;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(an(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(i(171))}if(n.tag===1){var a=n.type;if(an(a))return Pg(n,a,r)}return r}function e0(n,r,a,f,g,m,T,P,k){return n=ff(a,f,!0,n,g,m,T,P,k),n.context=Jm(null),a=n.current,f=Kt(),g=ro(a),m=Ti(f,g),m.callback=r??null,to(a,m,g),n.current.lanes=g,Ps(n,g,f),un(n,f),n}function rc(n,r,a,f){var g=r.current,m=Kt(),T=ro(g);return a=Jm(a),r.context===null?r.context=a:r.pendingContext=a,r=Ti(m,T),r.payload={element:n},f=f===void 0?null:f,f!==null&&(r.callback=f),n=to(g,r,T),n!==null&&(zn(n,g,T,m),Hl(n,g,T)),T}function sc(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function t0(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var a=n.retryLane;n.retryLane=a!==0&&a<r?a:r}}function hf(n,r){t0(n,r),(n=n.alternate)&&t0(n,r)}function CT(){return null}var n0=typeof reportError=="function"?reportError:function(n){console.error(n)};function pf(n){this._internalRoot=n}ac.prototype.render=pf.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error(i(409));rc(n,r,null,null)},ac.prototype.unmount=pf.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;Uo(function(){rc(null,n,null,null)}),r[yi]=null}};function ac(n){this._internalRoot=n}ac.prototype.unstable_scheduleHydration=function(n){if(n){var r=Up();n={blockedOn:null,target:n,priority:r};for(var a=0;a<Xi.length&&r!==0&&r<Xi[a].priority;a++);Xi.splice(a,0,n),a===0&&$p(n)}};function gf(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function lc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function i0(){}function _T(n,r,a,f,g){if(g){if(typeof f=="function"){var m=f;f=function(){var U=sc(T);m.call(U)}}var T=e0(r,f,n,0,null,!1,!1,"",i0);return n._reactRootContainer=T,n[yi]=T.current,xs(n.nodeType===8?n.parentNode:n),Uo(),T}for(;g=n.lastChild;)n.removeChild(g);if(typeof f=="function"){var P=f;f=function(){var U=sc(k);P.call(U)}}var k=ff(n,0,!1,null,null,!1,!1,"",i0);return n._reactRootContainer=k,n[yi]=k.current,xs(n.nodeType===8?n.parentNode:n),Uo(function(){rc(r,k,a,f)}),k}function cc(n,r,a,f,g){var m=a._reactRootContainer;if(m){var T=m;if(typeof g=="function"){var P=g;g=function(){var k=sc(T);P.call(k)}}rc(r,T,n,g)}else T=_T(a,r,n,g,f);return sc(T)}Fp=function(n){switch(n.tag){case 3:var r=n.stateNode;if(r.current.memoizedState.isDehydrated){var a=_s(r.pendingLanes);a!==0&&(Lu(r,a|1),un(r,ht()),(Ue&6)===0&&(Gr=ht()+500,Ji()))}break;case 13:Uo(function(){var f=Si(n,1);if(f!==null){var g=Kt();zn(f,n,1,g)}}),hf(n,1)}},Uu=function(n){if(n.tag===13){var r=Si(n,134217728);if(r!==null){var a=Kt();zn(r,n,134217728,a)}hf(n,134217728)}},Lp=function(n){if(n.tag===13){var r=ro(n),a=Si(n,r);if(a!==null){var f=Kt();zn(a,n,r,f)}hf(n,r)}},Up=function(){return ze},Gp=function(n,r){var a=ze;try{return ze=n,r()}finally{ze=a}},Du=function(n,r,a){switch(r){case"input":if(rn(n,a),r=a.name,a.type==="radio"&&r!=null){for(a=n;a.parentNode;)a=a.parentNode;for(a=a.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<a.length;r++){var f=a[r];if(f!==n&&f.form===n.form){var g=_l(f);if(!g)throw Error(i(90));Te(f),rn(f,g)}}}break;case"textarea":gp(n,a);break;case"select":r=a.value,r!=null&&Wi(n,!!a.multiple,r,!1)}},wp=sf,Cp=Uo;var PT={usingClientEntryPoint:!1,Events:[Ys,Pr,_l,Tp,Ep,sf]},oa={findFiberByHostInstance:Do,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},RT={bundleType:oa.bundleType,version:oa.version,rendererPackageName:oa.rendererPackageName,rendererConfig:oa.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:R.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Mp(n),n===null?null:n.stateNode},findFiberByHostInstance:oa.findFiberByHostInstance||CT,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var uc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!uc.isDisabled&&uc.supportsFiber)try{al=uc.inject(RT),ti=uc}catch{}}return dn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=PT,dn.createPortal=function(n,r){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gf(r))throw Error(i(200));return wT(n,r,null,a)},dn.createRoot=function(n,r){if(!gf(n))throw Error(i(299));var a=!1,f="",g=n0;return r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(g=r.onRecoverableError)),r=ff(n,1,!1,null,null,a,!1,f,g),n[yi]=r.current,xs(n.nodeType===8?n.parentNode:n),new pf(r)},dn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error(i(188)):(n=Object.keys(n).join(","),Error(i(268,n)));return n=Mp(r),n=n===null?null:n.stateNode,n},dn.flushSync=function(n){return Uo(n)},dn.hydrate=function(n,r,a){if(!lc(r))throw Error(i(200));return cc(null,n,r,!0,a)},dn.hydrateRoot=function(n,r,a){if(!gf(n))throw Error(i(405));var f=a!=null&&a.hydratedSources||null,g=!1,m="",T=n0;if(a!=null&&(a.unstable_strictMode===!0&&(g=!0),a.identifierPrefix!==void 0&&(m=a.identifierPrefix),a.onRecoverableError!==void 0&&(T=a.onRecoverableError)),r=e0(r,null,n,1,a??null,g,!1,m,T),n[yi]=r.current,xs(n),f)for(n=0;n<f.length;n++)a=f[n],g=a._getVersion,g=g(a._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[a,g]:r.mutableSourceEagerHydrationData.push(a,g);return new ac(r)},dn.render=function(n,r,a){if(!lc(r))throw Error(i(200));return cc(null,n,r,!1,a)},dn.unmountComponentAtNode=function(n){if(!lc(n))throw Error(i(40));return n._reactRootContainer?(Uo(function(){cc(null,null,n,!1,function(){n._reactRootContainer=null,n[yi]=null})}),!0):!1},dn.unstable_batchedUpdates=sf,dn.unstable_renderSubtreeIntoContainer=function(n,r,a,f){if(!lc(a))throw Error(i(200));if(n==null||n._reactInternals===void 0)throw Error(i(38));return cc(n,r,a,!1,f)},dn.version="18.3.1-next-f1338f8080-20240426",dn}var d0;function LT(){if(d0)return vf.exports;d0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),vf.exports=FT(),vf.exports}var f0;function UT(){if(f0)return dc;f0=1;var e=LT();return dc.createRoot=e.createRoot,dc.hydrateRoot=e.hydrateRoot,dc}var GT=UT();const xT=Ky(GT);class $T{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,i){let o=this.length++;for(;o>0;){const s=o-1>>1,l=this.values[s];if(i>=l)break;this.ids[o]=this.ids[s],this.values[o]=l,o=s}this.ids[o]=t,this.values[o]=i}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const i=this.ids[0]=this.ids[this.length],o=this.values[0]=this.values[this.length],s=this.length>>1;let l=0;for(;l<s;){let c=(l<<1)+1;const d=c+1;let u=this.ids[c],h=this.values[c];const p=this.values[d];if(d<this.length&&p<h&&(c=d,u=this.ids[d],h=p),h>=o)break;this.ids[l]=u,this.values[l]=h,l=c}this.ids[l]=i,this.values[l]=o}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const h0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Sf=3;class wh{static from(t,i=0){if(i%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[o,s]=new Uint8Array(t,i+0,2);if(o!==251)throw new Error("Data does not appear to be in a Flatbush format.");const l=s>>4;if(l!==Sf)throw new Error(`Got v${l} data when expected v${Sf}.`);const c=h0[s&15];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,i+2,1),[u]=new Uint32Array(t,i+4,1);return new wh(u,d,c,void 0,t,i)}constructor(t,i=16,o=Float64Array,s=ArrayBuffer,l,c=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.byteOffset=c;let d=t,u=d;this._levelBounds=[d*4];do d=Math.ceil(d/this.nodeSize),u+=d,this._levelBounds.push(u*4);while(d!==1);this.ArrayType=o,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const h=h0.indexOf(this.ArrayType),p=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);l&&l.byteLength!==void 0&&!l.buffer?(this.data=l,this._boxes=new this.ArrayType(this.data,c+8,u*4),this._indices=new this.IndexArrayType(this.data,c+8+p,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+p+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+p,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Sf<<4)+h]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t),this._queue=new $T}add(t,i,o=t,s=i){const l=this._pos>>2,c=this._boxes;return this._indices[l]=l,c[this._pos++]=t,c[this._pos++]=i,c[this._pos++]=o,c[this._pos++]=s,t<this.minX&&(this.minX=t),i<this.minY&&(this.minY=i),o>this.maxX&&(this.maxX=o),s>this.maxY&&(this.maxY=s),l}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const i=this.maxX-this.minX||1,o=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),l=65535;for(let c=0,d=0;c<this.numItems;c++){const u=t[d++],h=t[d++],p=t[d++],y=t[d++],A=Math.floor(l*((u+p)/2-this.minX)/i),v=Math.floor(l*((h+y)/2-this.minY)/o);s[c]=YT(A,v)}Qf(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let c=0,d=0;c<this._levelBounds.length-1;c++){const u=this._levelBounds[c];for(;d<u;){const h=d;let p=t[d++],y=t[d++],A=t[d++],v=t[d++];for(let I=1;I<this.nodeSize&&d<u;I++)p=Math.min(p,t[d++]),y=Math.min(y,t[d++]),A=Math.max(A,t[d++]),v=Math.max(v,t[d++]);this._indices[this._pos>>2]=h,t[this._pos++]=p,t[this._pos++]=y,t[this._pos++]=A,t[this._pos++]=v}}}search(t,i,o,s,l){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let c=this._boxes.length-4;const d=[],u=[];for(;c!==void 0;){const h=Math.min(c+this.nodeSize*4,g0(c,this._levelBounds));for(let p=c;p<h;p+=4){if(o<this._boxes[p]||s<this._boxes[p+1]||t>this._boxes[p+2]||i>this._boxes[p+3])continue;const y=this._indices[p>>2]|0;c>=this.numItems*4?d.push(y):(l===void 0||l(y))&&u.push(y)}c=d.pop()}return u}neighbors(t,i,o=1/0,s=1/0,l){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let c=this._boxes.length-4;const d=this._queue,u=[],h=s*s;e:for(;c!==void 0;){const p=Math.min(c+this.nodeSize*4,g0(c,this._levelBounds));for(let y=c;y<p;y+=4){const A=this._indices[y>>2]|0,v=p0(t,this._boxes[y],this._boxes[y+2]),I=p0(i,this._boxes[y+1],this._boxes[y+3]),S=v*v+I*I;S>h||(c>=this.numItems*4?d.push(A<<1,S):(l===void 0||l(A))&&d.push((A<<1)+1,S))}for(;d.length&&d.peek()&1;)if(d.peekValue()>h||(u.push(d.pop()>>1),u.length===o))break e;c=d.length?d.pop()>>1:void 0}return d.clear(),u}}function p0(e,t,i){return e<t?t-e:e<=i?0:e-i}function g0(e,t){let i=0,o=t.length-1;for(;i<o;){const s=i+o>>1;t[s]>e?o=s:i=s+1}return t[i]}function Qf(e,t,i,o,s,l){if(Math.floor(o/l)>=Math.floor(s/l))return;const c=e[o+s>>1];let d=o-1,u=s+1;for(;;){do d++;while(e[d]<c);do u--;while(e[u]>c);if(d>=u)break;WT(e,t,i,d,u)}Qf(e,t,i,o,u,l),Qf(e,t,i,u+1,s,l)}function WT(e,t,i,o,s){const l=e[o];e[o]=e[s],e[s]=l;const c=4*o,d=4*s,u=t[c],h=t[c+1],p=t[c+2],y=t[c+3];t[c]=t[d],t[c+1]=t[d+1],t[c+2]=t[d+2],t[c+3]=t[d+3],t[d]=u,t[d+1]=h,t[d+2]=p,t[d+3]=y;const A=i[o];i[o]=i[s],i[s]=A}function YT(e,t){let i=e^t,o=65535^i,s=65535^(e|t),l=e&(t^65535),c=i|o>>1,d=i>>1^i,u=s>>1^o&l>>1^s,h=i&s>>1^l>>1^l;i=c,o=d,s=u,l=h,c=i&i>>2^o&o>>2,d=i&o>>2^o&(i^o)>>2,u^=i&s>>2^o&l>>2,h^=o&s>>2^(i^o)&l>>2,i=c,o=d,s=u,l=h,c=i&i>>4^o&o>>4,d=i&o>>4^o&(i^o)>>4,u^=i&s>>4^o&l>>4,h^=o&s>>4^(i^o)&l>>4,i=c,o=d,s=u,l=h,u^=i&s>>8^o&l>>8,h^=o&s>>8^(i^o)&l>>8,i=u^u>>1,o=h^h>>1;let p=e^t,y=o|65535^(p|i);return p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,y=(y|y<<8)&16711935,y=(y|y<<4)&252645135,y=(y|y<<2)&858993459,y=(y|y<<1)&1431655765,(y<<1|p)>>>0}function hi(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Ch(e,t){return{x:e.x-t.x,y:e.y-t.y}}function It(e,t){return{x:e.x*t,y:e.y*t}}function To(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function bt(e){const t=To(e);return t===0?{x:0,y:0}:It(e,1/t)}function Fn(e,t){return To(Ch(e,t))}function Nc(e,t,i){return{x:e.x+(t.x-e.x)*i,y:e.y+(t.y-e.y)*i}}function m0(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((i,o)=>({x:i.x+o.x,y:i.y+o.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Xe(e,t,i,o){let s=t.x-e.x,l=t.y-e.y;return Math.abs(s)>i/2&&(s=s-Math.sign(s)*i),Math.abs(l)>o/2&&(l=l-Math.sign(l)*o),{x:s,y:l}}function Mt(e,t,i){const o=Xe(e,t,i.width,i.height);return bt(o)}function q(e,t,i,o){const s=Xe(e,t,i,o);return To(s)}function fn(e,t,i,o){const s=Xe(e,t,i,o);return s.x*s.x+s.y*s.y}function zT(e,t){return e.x*t.x+e.y*t.y}function jT(e,t){const i=zT(e,t),o=To(e),s=To(t);if(o===0||s===0)return 0;const l=Math.max(-1,Math.min(1,i/(o*s)));return Math.acos(l)}function y0(e,t){const i=Math.cos(t),o=Math.sin(t);return{x:e.x*i-e.y*o,y:e.x*o+e.y*i}}function XT(e,t){return t.split(".").reduce((i,o)=>{if(i&&typeof i=="object"&&o in i)return i[o]},e)}function Pi(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const i=new wh(e.length),o=new Map,s=new Map;let l=0;const c=new Uint32Array(e.length);for(let u=0;u<e.length;u++){const h=e[u];h.width!==void 0&&h.height!==void 0?i.add(h.position.x,h.position.y,h.position.x+h.width,h.position.y+h.height):i.add(h.position.x,h.position.y,h.position.x,h.position.y)}return i.finish(),{all(){return e},byRect(u){const{width:h,height:p}=t,y=[];l++;const A=[];u.left<0?(A.push({left:u.left+h,right:h}),A.push({left:0,right:u.right})):u.right>h?(A.push({left:u.left,right:h}),A.push({left:0,right:u.right-h})):A.push({left:u.left,right:u.right});const v=[];u.top<0?(v.push({top:u.top+p,bottom:p}),v.push({top:0,bottom:u.bottom})):u.bottom>p?(v.push({top:u.top,bottom:p}),v.push({top:0,bottom:u.bottom-p})):v.push({top:u.top,bottom:u.bottom});for(let I=0;I<A.length;I++){const S=A[I];for(let E=0;E<v.length;E++){const _=v[E],w=i.search(S.left,_.top,S.right,_.bottom);for(let C=0;C<w.length;C++){const R=w[C];c[R]!==l&&(c[R]=l,y.push(e[R]))}}}return y},byRadius(u,h){const{width:p,height:y}=t,A=[];l++;const v=h*h,I=u.x-h,S=u.x+h,E=u.y-h,_=u.y+h,w=[];I<0?(w.push({left:I+p,right:p}),w.push({left:0,right:S})):S>p?(w.push({left:I,right:p}),w.push({left:0,right:S-p})):w.push({left:I,right:S});const C=[];E<0?(C.push({top:E+y,bottom:y}),C.push({top:0,bottom:_})):_>y?(C.push({top:E,bottom:y}),C.push({top:0,bottom:_-y})):C.push({top:E,bottom:_});for(let R=0;R<w.length;R++){const b=w[R];for(let M=0;M<C.length;M++){const B=C[M],F=i.search(b.left,B.top,b.right,B.bottom);for(let G=0;G<F.length;G++){const Y=F[G];if(c[Y]!==l){c[Y]=l;const J=e[Y];fn(u,J.position,p,y)<=v&&A.push(J)}}}}return A},byProperty(u,h){var p;if(!o.has(u)){const y=new Map;for(let A=0;A<e.length;A++){const v=e[A],I=v[u];y.has(I)||y.set(I,[]),y.get(I).push(v)}o.set(u,y)}return((p=o.get(u))==null?void 0:p.get(h))||[]},byPropertyPath(u,h){var p;if(!s.has(u)){const y=new Map;for(let A=0;A<e.length;A++){const v=e[A],I=XT(v,u);y.has(I)||y.set(I,[]),y.get(I).push(v)}s.set(u,y)}return((p=s.get(u))==null?void 0:p.get(h))||[]},resetPropertyCache(){o.clear(),s.clear()},count(){return e.length}}}function eu(e){var y,A;const t=e.entities.entities,i=[],o=[],s=[],l=[],c=[],d=[],u=[];for(const v in t){const I=t[v];switch(I.type){case"human":i.push(I);break;case"berryBush":o.push(I);break;case"corpse":s.push(I);break;case"prey":l.push(I);break;case"predator":c.push(I);break;case"building":d.push(I);break;case"tree":u.push(I);break}}const h=e.mapDimensions;return{...e,search:{human:Pi(i,h),berryBush:Pi(o,h),corpse:Pi(s,h),prey:Pi(l,h),predator:Pi(c,h),building:Pi(d,h),tree:Pi(u,h),tasks:((y=e.search)==null?void 0:y.tasks)??Pi([],h)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((A=e.cache)==null?void 0:A.tribeCenters)??{}}}}function VT(e){const t=[];for(const i in e.tasks)t.push(e.tasks[i]);e.search.tasks=Pi(t,e.mapDimensions)}const fe={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire"},Ro={[fe.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[fe.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[fe.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[fe.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}}},qT=.5,ZT="#FFA500",KT="#FF4500",v0=4,QT=10,Qy=60;function _h(e){return Ro[e].dimensions}function JT(e){return Ro[e].constructionTimeHours}function eE(e){return Ro[e].destructionTimeHours}const Jy=5;function tE(){return Ro[fe.PlantingZone].dimensions}function A0(e,t,i){const o=e.position.x+i.width/2,l=t.position.x-i.width/2-o,c=e.position.y-i.height/2,d=e.position.y+i.height/2,u=t.position.y-i.height/2,h=t.position.y+i.height/2,p=Math.min(d,h)-Math.max(c,u);return l>=-5&&l<=Jy&&p>i.height*.5}function I0(e,t,i){const o=e.position.y+i.height/2,l=t.position.y-i.height/2-o,c=e.position.x-i.width/2,d=e.position.x+i.width/2,u=t.position.x-i.width/2,h=t.position.x+i.width/2,p=Math.min(d,h)-Math.max(c,u);return l>=-5&&l<=Jy&&p>i.width*.5}function nE(e){var c;const t={},i=tE(),o=e;if(!((c=o.search)!=null&&c.building))return t;const l=o.search.building.all().filter(d=>d.buildingType===fe.PlantingZone&&d.isConstructed);for(const d of l)t[d.id]={top:!1,bottom:!1,left:!1,right:!1};for(let d=0;d<l.length;d++){const u=l[d];for(let h=d+1;h<l.length;h++){const p=l[h];u.ownerId===p.ownerId&&(A0(u,p,i)&&(t[u.id].right=!0,t[p.id].left=!0),A0(p,u,i)&&(t[p.id].right=!0,t[u.id].left=!0),I0(u,p,i)&&(t[u.id].bottom=!0,t[p.id].top=!0),I0(p,u,i)&&(t[p.id].bottom=!0,t[u.id].top=!0))}}return t}function Ba(e){e.plantingZoneConnections=nE(e)}var Xo=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(Xo||{});class iE{constructor(){Ht(this,"worker",null);Ht(this,"pendingRequests",new Map);Ht(this,"requestQueue",[]);Ht(this,"isProcessing",!1);Ht(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:i})=>{i(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const i=this.pendingRequests.get(t.id);if(!i){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case Xo.SAVE_RESPONSE:this.handleSaveResponse(t,i);break;case Xo.LOAD_RESPONSE:this.handleLoadResponse(t,i);break;case Xo.CLEAR_RESPONSE:this.handleClearResponse(t,i);break;default:console.error("[WorkerManager] Unknown response type:",t),i.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,i){t.success?i.resolve():i.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,i){t.success?i.resolve(t.gameState):i.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,i){t.success?i.resolve():i.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((i,o)=>{if(!this.worker){o(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:i,reject:o});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),o(s)}})}queueOperation(t){return new Promise((i,o)=>{this.requestQueue.push(async()=>{try{const s=await t();i(s)}catch(s){o(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(i){console.error("[WorkerManager] Error processing queued operation:",i)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const i=this.generateRequestId(),o=t,s={type:Xo.SAVE_REQUEST,id:i,gameState:o};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),i={type:Xo.LOAD_REQUEST,id:t};return await this.sendMessage(i)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),i={type:Xo.CLEAR_REQUEST,id:t};await this.sendMessage(i)})}}const Ph=new iE;async function Rh(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,roleManagerOpen:e.roleManagerOpen,armyControlOpen:e.armyControlOpen,tribeModalOpen:e.tribeModalOpen,cameraFollowingPlayer:e.cameraFollowingPlayer,cameraZoom:e.cameraZoom,isDraggingMinimap:e.isDraggingMinimap,minimapDragDistance:e.minimapDragDistance,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks,isDraggingViewport:e.isDraggingViewport,viewportDragButton:e.viewportDragButton,viewportDragDistance:e.viewportDragDistance};await Ph.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function oE(){try{const e=await Ph.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const i=eu(t);return Ba(i),i}catch(e){return console.error("Failed to load game:",e),await ev(),null}}async function ev(){try{await Ph.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const tv=Re.createContext(void 0),rE=({initialAppState:e,children:t})=>{const[i,o]=Re.useState(e),[s,l]=Re.useState(void 0),[c,d]=Re.useState(null),[u,h]=Re.useState(!1);Re.useEffect(()=>{oE().then(I=>{I&&d(I),h(!0)})},[]);const p=(I,S)=>{o(I),I==="gameOver"&&S?l(S):I!=="gameOver"&&l(void 0)},y=()=>{o("intro"),l(void 0),v()},A=I=>{Rh(I),d(I)},v=()=>{ev(),d(null)};return ke.jsx(tv.Provider,{value:{appState:i,setAppState:p,returnToIntro:y,gameOverDetails:s,contextReady:u,savedGameState:c,setSavedGameState:d,saveCurrentGame:A,clearCurrentSave:v},children:t})},fr=()=>{const e=Re.useContext(tv);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var jt=function(){return jt=Object.assign||function(t){for(var i,o=1,s=arguments.length;o<s;o++){i=arguments[o];for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(t[l]=i[l])}return t},jt.apply(this,arguments)};function Ha(e,t,i){if(i||arguments.length===2)for(var o=0,s=t.length,l;o<s;o++)(l||!(o in t))&&(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))}var it="-ms-",wa="-moz-",Ye="-webkit-",nv="comm",tu="rule",Mh="decl",sE="@import",iv="@keyframes",aE="@layer",ov=Math.abs,kh=String.fromCharCode,Jf=Object.assign;function lE(e,t){return kt(e,0)^45?(((t<<2^kt(e,0))<<2^kt(e,1))<<2^kt(e,2))<<2^kt(e,3):0}function rv(e){return e.trim()}function Mi(e,t){return(e=t.exec(e))?e[0]:e}function Be(e,t,i){return e.replace(t,i)}function _c(e,t,i){return e.indexOf(t,i)}function kt(e,t){return e.charCodeAt(t)|0}function rs(e,t,i){return e.slice(t,i)}function di(e){return e.length}function sv(e){return e.length}function va(e,t){return t.push(e),e}function cE(e,t){return e.map(t).join("")}function S0(e,t){return e.filter(function(i){return!Mi(i,t)})}var nu=1,ss=1,av=0,Ln=0,At=0,ys="";function iu(e,t,i,o,s,l,c,d){return{value:e,root:t,parent:i,type:o,props:s,children:l,line:nu,column:ss,length:c,return:"",siblings:d}}function ho(e,t){return Jf(iu("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function $r(e){for(;e.root;)e=ho(e.root,{children:[e]});va(e,e.siblings)}function uE(){return At}function dE(){return At=Ln>0?kt(ys,--Ln):0,ss--,At===10&&(ss=1,nu--),At}function qn(){return At=Ln<av?kt(ys,Ln++):0,ss++,At===10&&(ss=1,nu++),At}function Qo(){return kt(ys,Ln)}function Pc(){return Ln}function ou(e,t){return rs(ys,e,t)}function eh(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function fE(e){return nu=ss=1,av=di(ys=e),Ln=0,[]}function hE(e){return ys="",e}function Tf(e){return rv(ou(Ln-1,th(e===91?e+2:e===40?e+1:e)))}function pE(e){for(;(At=Qo())&&At<33;)qn();return eh(e)>2||eh(At)>3?"":" "}function gE(e,t){for(;--t&&qn()&&!(At<48||At>102||At>57&&At<65||At>70&&At<97););return ou(e,Pc()+(t<6&&Qo()==32&&qn()==32))}function th(e){for(;qn();)switch(At){case e:return Ln;case 34:case 39:e!==34&&e!==39&&th(At);break;case 40:e===41&&th(e);break;case 92:qn();break}return Ln}function mE(e,t){for(;qn()&&e+At!==57;)if(e+At===84&&Qo()===47)break;return"/*"+ou(t,Ln-1)+"*"+kh(e===47?e:qn())}function yE(e){for(;!eh(Qo());)qn();return ou(e,Ln)}function vE(e){return hE(Rc("",null,null,null,[""],e=fE(e),0,[0],e))}function Rc(e,t,i,o,s,l,c,d,u){for(var h=0,p=0,y=c,A=0,v=0,I=0,S=1,E=1,_=1,w=0,C="",R=s,b=l,M=o,B=C;E;)switch(I=w,w=qn()){case 40:if(I!=108&&kt(B,y-1)==58){_c(B+=Be(Tf(w),"&","&\f"),"&\f",ov(h?d[h-1]:0))!=-1&&(_=-1);break}case 34:case 39:case 91:B+=Tf(w);break;case 9:case 10:case 13:case 32:B+=pE(I);break;case 92:B+=gE(Pc()-1,7);continue;case 47:switch(Qo()){case 42:case 47:va(AE(mE(qn(),Pc()),t,i,u),u);break;default:B+="/"}break;case 123*S:d[h++]=di(B)*_;case 125*S:case 59:case 0:switch(w){case 0:case 125:E=0;case 59+p:_==-1&&(B=Be(B,/\f/g,"")),v>0&&di(B)-y&&va(v>32?E0(B+";",o,i,y-1,u):E0(Be(B," ","")+";",o,i,y-2,u),u);break;case 59:B+=";";default:if(va(M=T0(B,t,i,h,p,s,d,C,R=[],b=[],y,l),l),w===123)if(p===0)Rc(B,t,M,M,R,l,y,d,b);else switch(A===99&&kt(B,3)===110?100:A){case 100:case 108:case 109:case 115:Rc(e,M,M,o&&va(T0(e,M,M,0,0,s,d,C,s,R=[],y,b),b),s,b,y,d,o?R:b);break;default:Rc(B,M,M,M,[""],b,0,d,b)}}h=p=v=0,S=_=1,C=B="",y=c;break;case 58:y=1+di(B),v=I;default:if(S<1){if(w==123)--S;else if(w==125&&S++==0&&dE()==125)continue}switch(B+=kh(w),w*S){case 38:_=p>0?1:(B+="\f",-1);break;case 44:d[h++]=(di(B)-1)*_,_=1;break;case 64:Qo()===45&&(B+=Tf(qn())),A=Qo(),p=y=di(C=B+=yE(Pc())),w++;break;case 45:I===45&&di(B)==2&&(S=0)}}return l}function T0(e,t,i,o,s,l,c,d,u,h,p,y){for(var A=s-1,v=s===0?l:[""],I=sv(v),S=0,E=0,_=0;S<o;++S)for(var w=0,C=rs(e,A+1,A=ov(E=c[S])),R=e;w<I;++w)(R=rv(E>0?v[w]+" "+C:Be(C,/&\f/g,v[w])))&&(u[_++]=R);return iu(e,t,i,s===0?tu:d,u,h,p,y)}function AE(e,t,i,o){return iu(e,t,i,nv,kh(uE()),rs(e,2,-2),0,o)}function E0(e,t,i,o,s){return iu(e,t,i,Mh,rs(e,0,o),rs(e,o+1,-1),o,s)}function lv(e,t,i){switch(lE(e,t)){case 5103:return Ye+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ye+e+e;case 4789:return wa+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Ye+e+wa+e+it+e+e;case 5936:switch(kt(e,t+11)){case 114:return Ye+e+it+Be(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Ye+e+it+Be(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Ye+e+it+Be(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Ye+e+it+e+e;case 6165:return Ye+e+it+"flex-"+e+e;case 5187:return Ye+e+Be(e,/(\w+).+(:[^]+)/,Ye+"box-$1$2"+it+"flex-$1$2")+e;case 5443:return Ye+e+it+"flex-item-"+Be(e,/flex-|-self/g,"")+(Mi(e,/flex-|baseline/)?"":it+"grid-row-"+Be(e,/flex-|-self/g,""))+e;case 4675:return Ye+e+it+"flex-line-pack"+Be(e,/align-content|flex-|-self/g,"")+e;case 5548:return Ye+e+it+Be(e,"shrink","negative")+e;case 5292:return Ye+e+it+Be(e,"basis","preferred-size")+e;case 6060:return Ye+"box-"+Be(e,"-grow","")+Ye+e+it+Be(e,"grow","positive")+e;case 4554:return Ye+Be(e,/([^-])(transform)/g,"$1"+Ye+"$2")+e;case 6187:return Be(Be(Be(e,/(zoom-|grab)/,Ye+"$1"),/(image-set)/,Ye+"$1"),e,"")+e;case 5495:case 3959:return Be(e,/(image-set\([^]*)/,Ye+"$1$`$1");case 4968:return Be(Be(e,/(.+:)(flex-)?(.*)/,Ye+"box-pack:$3"+it+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ye+e+e;case 4200:if(!Mi(e,/flex-|baseline/))return it+"grid-column-align"+rs(e,t)+e;break;case 2592:case 3360:return it+Be(e,"template-","")+e;case 4384:case 3616:return i&&i.some(function(o,s){return t=s,Mi(o.props,/grid-\w+-end/)})?~_c(e+(i=i[t].value),"span",0)?e:it+Be(e,"-start","")+e+it+"grid-row-span:"+(~_c(i,"span",0)?Mi(i,/\d+/):+Mi(i,/\d+/)-+Mi(e,/\d+/))+";":it+Be(e,"-start","")+e;case 4896:case 4128:return i&&i.some(function(o){return Mi(o.props,/grid-\w+-start/)})?e:it+Be(Be(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return Be(e,/(.+)-inline(.+)/,Ye+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(di(e)-1-t>6)switch(kt(e,t+1)){case 109:if(kt(e,t+4)!==45)break;case 102:return Be(e,/(.+:)(.+)-([^]+)/,"$1"+Ye+"$2-$3$1"+wa+(kt(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~_c(e,"stretch",0)?lv(Be(e,"stretch","fill-available"),t,i)+e:e}break;case 5152:case 5920:return Be(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(o,s,l,c,d,u,h){return it+s+":"+l+h+(c?it+s+"-span:"+(d?u:+u-+l)+h:"")+e});case 4949:if(kt(e,t+6)===121)return Be(e,":",":"+Ye)+e;break;case 6444:switch(kt(e,kt(e,14)===45?18:11)){case 120:return Be(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Ye+(kt(e,14)===45?"inline-":"")+"box$3$1"+Ye+"$2$3$1"+it+"$2box$3")+e;case 100:return Be(e,":",":"+it)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Be(e,"scroll-","scroll-snap-")+e}return e}function Bc(e,t){for(var i="",o=0;o<e.length;o++)i+=t(e[o],o,e,t)||"";return i}function IE(e,t,i,o){switch(e.type){case aE:if(e.children.length)break;case sE:case Mh:return e.return=e.return||e.value;case nv:return"";case iv:return e.return=e.value+"{"+Bc(e.children,o)+"}";case tu:if(!di(e.value=e.props.join(",")))return""}return di(i=Bc(e.children,o))?e.return=e.value+"{"+i+"}":""}function SE(e){var t=sv(e);return function(i,o,s,l){for(var c="",d=0;d<t;d++)c+=e[d](i,o,s,l)||"";return c}}function TE(e){return function(t){t.root||(t=t.return)&&e(t)}}function EE(e,t,i,o){if(e.length>-1&&!e.return)switch(e.type){case Mh:e.return=lv(e.value,e.length,i);return;case iv:return Bc([ho(e,{value:Be(e.value,"@","@"+Ye)})],o);case tu:if(e.length)return cE(i=e.props,function(s){switch(Mi(s,o=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":$r(ho(e,{props:[Be(s,/:(read-\w+)/,":"+wa+"$1")]})),$r(ho(e,{props:[s]})),Jf(e,{props:S0(i,o)});break;case"::placeholder":$r(ho(e,{props:[Be(s,/:(plac\w+)/,":"+Ye+"input-$1")]})),$r(ho(e,{props:[Be(s,/:(plac\w+)/,":"+wa+"$1")]})),$r(ho(e,{props:[Be(s,/:(plac\w+)/,it+"input-$1")]})),$r(ho(e,{props:[s]})),Jf(e,{props:S0(i,o)});break}return""})}}var wE={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Sn={},as=typeof process<"u"&&Sn!==void 0&&(Sn.REACT_APP_SC_ATTR||Sn.SC_ATTR)||"data-styled",cv="active",uv="data-styled-version",ru="6.1.13",Dh=`/*!sc*/
`,Hc=typeof window<"u"&&"HTMLElement"in window,CE=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Sn!==void 0&&Sn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Sn.REACT_APP_SC_DISABLE_SPEEDY!==""?Sn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Sn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Sn!==void 0&&Sn.SC_DISABLE_SPEEDY!==void 0&&Sn.SC_DISABLE_SPEEDY!==""&&Sn.SC_DISABLE_SPEEDY!=="false"&&Sn.SC_DISABLE_SPEEDY),_E={},su=Object.freeze([]),ls=Object.freeze({});function dv(e,t,i){return i===void 0&&(i=ls),e.theme!==i.theme&&e.theme||t||i.theme}var fv=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),PE=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,RE=/(^-|-$)/g;function w0(e){return e.replace(PE,"-").replace(RE,"")}var ME=/(a)(d)/gi,fc=52,C0=function(e){return String.fromCharCode(e+(e>25?39:97))};function nh(e){var t,i="";for(t=Math.abs(e);t>fc;t=t/fc|0)i=C0(t%fc)+i;return(C0(t%fc)+i).replace(ME,"$1-$2")}var Ef,hv=5381,qr=function(e,t){for(var i=t.length;i;)e=33*e^t.charCodeAt(--i);return e},pv=function(e){return qr(hv,e)};function gv(e){return nh(pv(e)>>>0)}function kE(e){return e.displayName||e.name||"Component"}function wf(e){return typeof e=="string"&&!0}var mv=typeof Symbol=="function"&&Symbol.for,yv=mv?Symbol.for("react.memo"):60115,DE=mv?Symbol.for("react.forward_ref"):60112,OE={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},bE={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},vv={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},NE=((Ef={})[DE]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Ef[yv]=vv,Ef);function _0(e){return("type"in(t=e)&&t.type.$$typeof)===yv?vv:"$$typeof"in e?NE[e.$$typeof]:OE;var t}var BE=Object.defineProperty,HE=Object.getOwnPropertyNames,P0=Object.getOwnPropertySymbols,FE=Object.getOwnPropertyDescriptor,LE=Object.getPrototypeOf,R0=Object.prototype;function Av(e,t,i){if(typeof t!="string"){if(R0){var o=LE(t);o&&o!==R0&&Av(e,o,i)}var s=HE(t);P0&&(s=s.concat(P0(t)));for(var l=_0(e),c=_0(t),d=0;d<s.length;++d){var u=s[d];if(!(u in bE||i&&i[u]||c&&u in c||l&&u in l)){var h=FE(t,u);try{BE(e,u,h)}catch{}}}}return e}function cs(e){return typeof e=="function"}function Oh(e){return typeof e=="object"&&"styledComponentId"in e}function Zo(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function ih(e,t){if(e.length===0)return"";for(var i=e[0],o=1;o<e.length;o++)i+=e[o];return i}function Fa(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function oh(e,t,i){if(i===void 0&&(i=!1),!i&&!Fa(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var o=0;o<t.length;o++)e[o]=oh(e[o],t[o]);else if(Fa(t))for(var o in t)e[o]=oh(e[o],t[o]);return e}function bh(e,t){Object.defineProperty(e,"toString",{value:t})}function qa(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var UE=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var i=0,o=0;o<t;o++)i+=this.groupSizes[o];return i},e.prototype.insertRules=function(t,i){if(t>=this.groupSizes.length){for(var o=this.groupSizes,s=o.length,l=s;t>=l;)if((l<<=1)<0)throw qa(16,"".concat(t));this.groupSizes=new Uint32Array(l),this.groupSizes.set(o),this.length=l;for(var c=s;c<l;c++)this.groupSizes[c]=0}for(var d=this.indexOfGroup(t+1),u=(c=0,i.length);c<u;c++)this.tag.insertRule(d,i[c])&&(this.groupSizes[t]++,d++)},e.prototype.clearGroup=function(t){if(t<this.length){var i=this.groupSizes[t],o=this.indexOfGroup(t),s=o+i;this.groupSizes[t]=0;for(var l=o;l<s;l++)this.tag.deleteRule(o)}},e.prototype.getGroup=function(t){var i="";if(t>=this.length||this.groupSizes[t]===0)return i;for(var o=this.groupSizes[t],s=this.indexOfGroup(t),l=s+o,c=s;c<l;c++)i+="".concat(this.tag.getRule(c)).concat(Dh);return i},e}(),Mc=new Map,Fc=new Map,kc=1,hc=function(e){if(Mc.has(e))return Mc.get(e);for(;Fc.has(kc);)kc++;var t=kc++;return Mc.set(e,t),Fc.set(t,e),t},GE=function(e,t){kc=t+1,Mc.set(e,t),Fc.set(t,e)},xE="style[".concat(as,"][").concat(uv,'="').concat(ru,'"]'),$E=new RegExp("^".concat(as,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),WE=function(e,t,i){for(var o,s=i.split(","),l=0,c=s.length;l<c;l++)(o=s[l])&&e.registerName(t,o)},YE=function(e,t){for(var i,o=((i=t.textContent)!==null&&i!==void 0?i:"").split(Dh),s=[],l=0,c=o.length;l<c;l++){var d=o[l].trim();if(d){var u=d.match($E);if(u){var h=0|parseInt(u[1],10),p=u[2];h!==0&&(GE(p,h),WE(e,p,u[3]),e.getTag().insertRules(h,s)),s.length=0}else s.push(d)}}},M0=function(e){for(var t=document.querySelectorAll(xE),i=0,o=t.length;i<o;i++){var s=t[i];s&&s.getAttribute(as)!==cv&&(YE(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function zE(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var Iv=function(e){var t=document.head,i=e||t,o=document.createElement("style"),s=function(d){var u=Array.from(d.querySelectorAll("style[".concat(as,"]")));return u[u.length-1]}(i),l=s!==void 0?s.nextSibling:null;o.setAttribute(as,cv),o.setAttribute(uv,ru);var c=zE();return c&&o.setAttribute("nonce",c),i.insertBefore(o,l),o},jE=function(){function e(t){this.element=Iv(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(i){if(i.sheet)return i.sheet;for(var o=document.styleSheets,s=0,l=o.length;s<l;s++){var c=o[s];if(c.ownerNode===i)return c}throw qa(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,i){try{return this.sheet.insertRule(i,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var i=this.sheet.cssRules[t];return i&&i.cssText?i.cssText:""},e}(),XE=function(){function e(t){this.element=Iv(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,i){if(t<=this.length&&t>=0){var o=document.createTextNode(i);return this.element.insertBefore(o,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),VE=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,i){return t<=this.length&&(this.rules.splice(t,0,i),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),k0=Hc,qE={isServer:!Hc,useCSSOMInjection:!CE},Lc=function(){function e(t,i,o){t===void 0&&(t=ls),i===void 0&&(i={});var s=this;this.options=jt(jt({},qE),t),this.gs=i,this.names=new Map(o),this.server=!!t.isServer,!this.server&&Hc&&k0&&(k0=!1,M0(this)),bh(this,function(){return function(l){for(var c=l.getTag(),d=c.length,u="",h=function(y){var A=function(_){return Fc.get(_)}(y);if(A===void 0)return"continue";var v=l.names.get(A),I=c.getGroup(y);if(v===void 0||!v.size||I.length===0)return"continue";var S="".concat(as,".g").concat(y,'[id="').concat(A,'"]'),E="";v!==void 0&&v.forEach(function(_){_.length>0&&(E+="".concat(_,","))}),u+="".concat(I).concat(S,'{content:"').concat(E,'"}').concat(Dh)},p=0;p<d;p++)h(p);return u}(s)})}return e.registerId=function(t){return hc(t)},e.prototype.rehydrate=function(){!this.server&&Hc&&M0(this)},e.prototype.reconstructWithOptions=function(t,i){return i===void 0&&(i=!0),new e(jt(jt({},this.options),t),this.gs,i&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(i){var o=i.useCSSOMInjection,s=i.target;return i.isServer?new VE(s):o?new jE(s):new XE(s)}(this.options),new UE(t)));var t},e.prototype.hasNameForId=function(t,i){return this.names.has(t)&&this.names.get(t).has(i)},e.prototype.registerName=function(t,i){if(hc(t),this.names.has(t))this.names.get(t).add(i);else{var o=new Set;o.add(i),this.names.set(t,o)}},e.prototype.insertRules=function(t,i,o){this.registerName(t,i),this.getTag().insertRules(hc(t),o)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(hc(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),ZE=/&/g,KE=/^\s*\/\/.*$/gm;function Sv(e,t){return e.map(function(i){return i.type==="rule"&&(i.value="".concat(t," ").concat(i.value),i.value=i.value.replaceAll(",",",".concat(t," ")),i.props=i.props.map(function(o){return"".concat(t," ").concat(o)})),Array.isArray(i.children)&&i.type!=="@keyframes"&&(i.children=Sv(i.children,t)),i})}function QE(e){var t,i,o,s=ls,l=s.options,c=l===void 0?ls:l,d=s.plugins,u=d===void 0?su:d,h=function(A,v,I){return I.startsWith(i)&&I.endsWith(i)&&I.replaceAll(i,"").length>0?".".concat(t):A},p=u.slice();p.push(function(A){A.type===tu&&A.value.includes("&")&&(A.props[0]=A.props[0].replace(ZE,i).replace(o,h))}),c.prefix&&p.push(EE),p.push(IE);var y=function(A,v,I,S){v===void 0&&(v=""),I===void 0&&(I=""),S===void 0&&(S="&"),t=S,i=v,o=new RegExp("\\".concat(i,"\\b"),"g");var E=A.replace(KE,""),_=vE(I||v?"".concat(I," ").concat(v," { ").concat(E," }"):E);c.namespace&&(_=Sv(_,c.namespace));var w=[];return Bc(_,SE(p.concat(TE(function(C){return w.push(C)})))),w};return y.hash=u.length?u.reduce(function(A,v){return v.name||qa(15),qr(A,v.name)},hv).toString():"",y}var JE=new Lc,rh=QE(),Tv=fi.createContext({shouldForwardProp:void 0,styleSheet:JE,stylis:rh});Tv.Consumer;fi.createContext(void 0);function sh(){return Re.useContext(Tv)}var ew=function(){function e(t,i){var o=this;this.inject=function(s,l){l===void 0&&(l=rh);var c=o.name+l.hash;s.hasNameForId(o.id,c)||s.insertRules(o.id,c,l(o.rules,c,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=i,bh(this,function(){throw qa(12,String(o.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=rh),this.name+t.hash},e}(),tw=function(e){return e>="A"&&e<="Z"};function D0(e){for(var t="",i=0;i<e.length;i++){var o=e[i];if(i===1&&o==="-"&&e[0]==="-")return e;tw(o)?t+="-"+o.toLowerCase():t+=o}return t.startsWith("ms-")?"-"+t:t}var Ev=function(e){return e==null||e===!1||e===""},wv=function(e){var t,i,o=[];for(var s in e){var l=e[s];e.hasOwnProperty(s)&&!Ev(l)&&(Array.isArray(l)&&l.isCss||cs(l)?o.push("".concat(D0(s),":"),l,";"):Fa(l)?o.push.apply(o,Ha(Ha(["".concat(s," {")],wv(l),!1),["}"],!1)):o.push("".concat(D0(s),": ").concat((t=s,(i=l)==null||typeof i=="boolean"||i===""?"":typeof i!="number"||i===0||t in wE||t.startsWith("--")?String(i).trim():"".concat(i,"px")),";")))}return o};function So(e,t,i,o){if(Ev(e))return[];if(Oh(e))return[".".concat(e.styledComponentId)];if(cs(e)){if(!cs(l=e)||l.prototype&&l.prototype.isReactComponent||!t)return[e];var s=e(t);return So(s,t,i,o)}var l;return e instanceof ew?i?(e.inject(i,o),[e.getName(o)]):[e]:Fa(e)?wv(e):Array.isArray(e)?Array.prototype.concat.apply(su,e.map(function(c){return So(c,t,i,o)})):[e.toString()]}function Cv(e){for(var t=0;t<e.length;t+=1){var i=e[t];if(cs(i)&&!Oh(i))return!1}return!0}var nw=pv(ru),iw=function(){function e(t,i,o){this.rules=t,this.staticRulesId="",this.isStatic=(o===void 0||o.isStatic)&&Cv(t),this.componentId=i,this.baseHash=qr(nw,i),this.baseStyle=o,Lc.registerId(i)}return e.prototype.generateAndInjectStyles=function(t,i,o){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,i,o):"";if(this.isStatic&&!o.hash)if(this.staticRulesId&&i.hasNameForId(this.componentId,this.staticRulesId))s=Zo(s,this.staticRulesId);else{var l=ih(So(this.rules,t,i,o)),c=nh(qr(this.baseHash,l)>>>0);if(!i.hasNameForId(this.componentId,c)){var d=o(l,".".concat(c),void 0,this.componentId);i.insertRules(this.componentId,c,d)}s=Zo(s,c),this.staticRulesId=c}else{for(var u=qr(this.baseHash,o.hash),h="",p=0;p<this.rules.length;p++){var y=this.rules[p];if(typeof y=="string")h+=y;else if(y){var A=ih(So(y,t,i,o));u=qr(u,A+p),h+=A}}if(h){var v=nh(u>>>0);i.hasNameForId(this.componentId,v)||i.insertRules(this.componentId,v,o(h,".".concat(v),void 0,this.componentId)),s=Zo(s,v)}}return s},e}(),Nh=fi.createContext(void 0);Nh.Consumer;var Cf={};function ow(e,t,i){var o=Oh(e),s=e,l=!wf(e),c=t.attrs,d=c===void 0?su:c,u=t.componentId,h=u===void 0?function(R,b){var M=typeof R!="string"?"sc":w0(R);Cf[M]=(Cf[M]||0)+1;var B="".concat(M,"-").concat(gv(ru+M+Cf[M]));return b?"".concat(b,"-").concat(B):B}(t.displayName,t.parentComponentId):u,p=t.displayName,y=p===void 0?function(R){return wf(R)?"styled.".concat(R):"Styled(".concat(kE(R),")")}(e):p,A=t.displayName&&t.componentId?"".concat(w0(t.displayName),"-").concat(t.componentId):t.componentId||h,v=o&&s.attrs?s.attrs.concat(d).filter(Boolean):d,I=t.shouldForwardProp;if(o&&s.shouldForwardProp){var S=s.shouldForwardProp;if(t.shouldForwardProp){var E=t.shouldForwardProp;I=function(R,b){return S(R,b)&&E(R,b)}}else I=S}var _=new iw(i,A,o?s.componentStyle:void 0);function w(R,b){return function(M,B,F){var G=M.attrs,Y=M.componentStyle,J=M.defaultProps,z=M.foldedComponentIds,te=M.styledComponentId,K=M.target,se=fi.useContext(Nh),ce=sh(),ne=M.shouldForwardProp||ce.shouldForwardProp,$=dv(B,se,J)||ls,j=function(Ee,ae,ye){for(var Se,ie=jt(jt({},ae),{className:void 0,theme:ye}),pe=0;pe<Ee.length;pe+=1){var Ne=cs(Se=Ee[pe])?Se(ie):Se;for(var Te in Ne)ie[Te]=Te==="className"?Zo(ie[Te],Ne[Te]):Te==="style"?jt(jt({},ie[Te]),Ne[Te]):Ne[Te]}return ae.className&&(ie.className=Zo(ie.className,ae.className)),ie}(G,B,$),X=j.as||K,D={};for(var x in j)j[x]===void 0||x[0]==="$"||x==="as"||x==="theme"&&j.theme===$||(x==="forwardedAs"?D.as=j.forwardedAs:ne&&!ne(x,X)||(D[x]=j[x]));var re=function(Ee,ae){var ye=sh(),Se=Ee.generateAndInjectStyles(ae,ye.styleSheet,ye.stylis);return Se}(Y,j),le=Zo(z,te);return re&&(le+=" "+re),j.className&&(le+=" "+j.className),D[wf(X)&&!fv.has(X)?"class":"className"]=le,D.ref=F,Re.createElement(X,D)}(C,R,b)}w.displayName=y;var C=fi.forwardRef(w);return C.attrs=v,C.componentStyle=_,C.displayName=y,C.shouldForwardProp=I,C.foldedComponentIds=o?Zo(s.foldedComponentIds,s.styledComponentId):"",C.styledComponentId=A,C.target=o?s.target:e,Object.defineProperty(C,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(R){this._foldedDefaultProps=o?function(b){for(var M=[],B=1;B<arguments.length;B++)M[B-1]=arguments[B];for(var F=0,G=M;F<G.length;F++)oh(b,G[F],!0);return b}({},s.defaultProps,R):R}}),bh(C,function(){return".".concat(C.styledComponentId)}),l&&Av(C,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),C}function O0(e,t){for(var i=[e[0]],o=0,s=t.length;o<s;o+=1)i.push(t[o],e[o+1]);return i}var b0=function(e){return Object.assign(e,{isCss:!0})};function _v(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(cs(e)||Fa(e))return b0(So(O0(su,Ha([e],t,!0))));var o=e;return t.length===0&&o.length===1&&typeof o[0]=="string"?So(o):b0(So(O0(o,t)))}function ah(e,t,i){if(i===void 0&&(i=ls),!t)throw qa(1,t);var o=function(s){for(var l=[],c=1;c<arguments.length;c++)l[c-1]=arguments[c];return e(t,i,_v.apply(void 0,Ha([s],l,!1)))};return o.attrs=function(s){return ah(e,t,jt(jt({},i),{attrs:Array.prototype.concat(i.attrs,s).filter(Boolean)}))},o.withConfig=function(s){return ah(e,t,jt(jt({},i),s))},o}var Pv=function(e){return ah(ow,e)},wt=Pv;fv.forEach(function(e){wt[e]=Pv(e)});var rw=function(){function e(t,i){this.rules=t,this.componentId=i,this.isStatic=Cv(t),Lc.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,i,o,s){var l=s(ih(So(this.rules,i,o,s)),""),c=this.componentId+t;o.insertRules(c,c,l)},e.prototype.removeStyles=function(t,i){i.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,i,o,s){t>2&&Lc.registerId(this.componentId+t),this.removeStyles(t,o),this.createStyles(t,i,o,s)},e}();function sw(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];var o=_v.apply(void 0,Ha([e],t,!1)),s="sc-global-".concat(gv(JSON.stringify(o))),l=new rw(o,s),c=function(u){var h=sh(),p=fi.useContext(Nh),y=fi.useRef(h.styleSheet.allocateGSInstance(s)).current;return h.styleSheet.server&&d(y,u,h.styleSheet,p,h.stylis),fi.useLayoutEffect(function(){if(!h.styleSheet.server)return d(y,u,h.styleSheet,p,h.stylis),function(){return l.removeStyles(y,h.styleSheet)}},[y,u,h.styleSheet,p,h.stylis]),null};function d(u,h,p,y,A){if(l.isStatic)l.renderStyles(u,_E,p,A);else{var v=jt(jt({},h),{theme:dv(h,y,c.defaultProps)});l.renderStyles(u,v,p,A)}}return fi.memo(c)}function Rv(e,t){var i=Re.useRef(null),o=Re.useRef(!1),s=Re.useRef(e);s.current=e;var l=Re.useCallback(function(d){o.current&&(s.current(d),i.current=requestAnimationFrame(l))},[]),c=Re.useMemo(function(){return[function(){o.current&&(o.current=!1,i.current&&cancelAnimationFrame(i.current))},function(){o.current||(o.current=!0,i.current=requestAnimationFrame(l))},function(){return o.current}]},[]);return Re.useEffect(function(){return c[0]},[]),c}function aw(e,t,i,o,s){var c;(c=e.onExit)==null||c.call(e,o,t);const l=s.find(({id:d})=>d===t);return l!=null&&l.onEnter?l.onEnter(o,i):{...i,enteredAt:o.updateContext.gameState.time}}function lw(e,t){return t.find(({id:i})=>i===e)}function cw(e,t){return e!==t}function uw(e){e&&console.warn(`No handler found for state: ${e}`)}const Ca="bushGrowing",qo="bushFull",Dc="bushSpreading",La="bushDying",Dt=24,Gt=10,xe=4e3,$e=4e3,Uc=5,dw=15,fw=5e3,Ni=100,Bi=20,Hi=60,Mv=200,hw=1e3,pw=5,gw=3,mw=12,yw=940,lh=20,N0=90,kv=100,sr=5,vw=.5,au=30,Fi=.1,Aa=.9,Aw=2,Iw=2;var Qn=(e=>(e.Berry="berry",e.Meat="meat",e))(Qn||{});const Bh={berry:"",meat:""};function Dv(e,t){return e+t*65536}function Ov(e){return{gridX:e%65536,gridY:Math.floor(e/65536)}}function Sw(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function bv(){return{lastUpdateTime:0,sectors:{}}}const Ut=20,Gc=100,Nv=20,Bv=0,Tw=20,Ew=1,Hv=.15,ww=.5,Cw=.01,_w=24,Pw="#6B5344",Rw="#4A3728",B0=.85,Fv=35,Mw=30,H0=1.25,F0=40,_f=Math.PI/6,Lv=.5,kw=1,lu=10,Ua=80,Uv=3,sa=5,Xt=150,Gv=Xt*.8,Dw=Xt*.2,Bn=Xt*.8,Eo=30,xv=10,Ow=10,bw=.5,je=30,$v=je*.75,cu=30,Wv=cu*.75,Yv=50,Nw=20,Bw=Ua*.8,Hw=.7,xc=16,Hh=40,Fh=16,Fw=72/3,L0=24,Lw=1.25,Uw=1.5,U0=Xt*.6,zv=50,Gw=1,Lh=Ua*.65,xw=80,$w=50,Ww=1,Yw=128,jv=10,G0=100,Uh=35,wo=30,uu=.5,du=2.5,Gh=20,hn=250,xh=.4,$h=150,Wh=6,zw=5,Yh=2,fu=.5,hu=1.5,jw=1,Xw=.5,Vw=.5,qw=1.5,Zw=.25,Kw=2.5,Qw=45,Jw=.05;var Et=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(Et||{}),Le=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e[e.SupplyChain=5]="SupplyChain",e))(Le||{}),ar=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(ar||{});const $c=24,eC=24;let tC=0;function nC(){return`notification-${Date.now()}-${tC++}`}function Ga(e,t){if(t.identifier){const o=e.notifications.find(s=>s.identifier===t.identifier);if(o){if(o.dismissedUntil&&e.time<o.dismissedUntil)return;o.message=t.message,o.timestamp=e.time,o.creationTime=Date.now(),o.duration=t.duration,o.targetEntityIds=t.targetEntityIds,o.highlightedEntityIds=t.highlightedEntityIds,o.targetPosition=t.targetPosition,o.targetArea=t.targetArea,o.targetRadius=t.targetRadius,o.isDismissed=!1,o.dismissedUntil=void 0;return}}const i={...t,id:nC(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(i)}function iC(e,t){const i=e.notifications.find(o=>o.id===t);i&&(i.isDismissed=!0,i.identifier&&(i.dismissedUntil=e.time+eC))}function oC(e){const t=e.time;e.notifications=e.notifications.filter(i=>i.duration===0?!0:!(t-i.timestamp>i.duration))}function rC(e){for(const i of Object.values(e.entities.entities))i.isHighlighted=!1;const t=e.notifications.filter(i=>!i.isDismissed);for(const i of t)if(i.highlightedEntityIds)for(const o of i.highlightedEntityIds){const s=e.entities.entities[o];s&&(s.isHighlighted=!0)}}function Xv(e,t,i,o){const s=Math.random()*Math.PI*2,l=Math.sqrt(Math.random())*t,c={x:Math.cos(s)*l,y:Math.sin(s)*l},d=hi(e,c);return{x:(d.x%i+i)%i,y:(d.y%o+o)%o}}function Gi(e,t,i,o){const s=t,{width:l,height:c}=t.mapDimensions,d={left:e.x-i,top:e.y-i,right:e.x+i,bottom:e.y+i},u=h=>{for(let p=0;p<h.length;p++){const y=h[p];if(o!==void 0&&y.id===o)continue;const A=fn(e,y.position,l,c),v=i+y.radius;if(A<v*v)return!0}return!1};return u(s.search.human.byRect(d))||u(s.search.berryBush.byRect(d))||u(s.search.corpse.byRect(d))}function sC(e,t,i,o,s){const l=t.mapDimensions.width,c=t.mapDimensions.height;if(!Gi(e,t,o,s)&&!ur(t.soilDepletion,e,l,c))return e;const d=o;for(let u=d;u<=i;u+=d){const h=Math.ceil(2*Math.PI*u/d);for(let p=0;p<h;p++){const y=p/h*2*Math.PI,A={x:Math.cos(y)*u,y:Math.sin(y)*u},v=hi(e,A),I={x:(v.x%l+l)%l,y:(v.y%c+c)%c};if(!Gi(I,t,o,s)&&!ur(t.soilDepletion,I,l,c))return I}}return null}function pi(e,t){var c,d;const i=t;if((d=(c=i.cache)==null?void 0:c.tribeCenters)!=null&&d[e])return i.cache.tribeCenters[e];const o=t.search.building.byProperty("ownerId",e);if(o.length>0){const u=o.map(h=>h.position);return i.cache.tribeCenters[e]=m0(u)}const s=mi(e,t);if(s.length===0){const u=t.entities.entities[e];return i.cache.tribeCenters[e]=u?u.position:{x:0,y:0}}const l=s.map(u=>u.position);return i.cache.tribeCenters[e]=m0(l)}function x0(e,t,i){const o=i.mapDimensions.width,s=i.mapDimensions.height;let l=e.x-t.position.x,c=e.y-t.position.y;return Math.abs(l)>o/2&&(l-=Math.sign(l)*o),Math.abs(c)>s/2&&(c-=Math.sign(c)*s),Math.abs(l)<=t.width/2&&Math.abs(c)<=t.height/2}const us=80,on=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],Ce=20,$i=(e,t,i)=>{var d,u,h,p;if(!e||!t||e===t)return!1;const o=i.entities.entities[e],s=i.entities.entities[t],l=(u=(d=o==null?void 0:o.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[t],c=(p=(h=s==null?void 0:s.tribeControl)==null?void 0:h.diplomacy)==null?void 0:p[e];return l===Et.Hostile||c===Et.Hostile},Za=(e,t,i)=>e.id===t.id?!1:$i(e.leaderId,t.leaderId,i),lr=(e,t,i)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:$i(e.leaderId,t.ownerId,i),vs=(e,t,i)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=Bn||t.hunger>=Bn||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||Za(e,t,i))return!1;const o=e.gender==="female"?e:t;return!(o.isPregnant||o.age>Hh)},$0=1,ch=150*.6,aC=800,lC=3,W0=24,cC=1.5,Y0=.15,z0=200,Pf=30*.75*1.2,uC=20,Rf=800,dC=.7,fC=.5,hC=10,Mf=400,pC=800,gC=8,mC=16,zh=100,yC=100,Vv=150,j0=600,X0=250,vC=.5,AC=.7,IC=300,SC=150;function TC(e){const t=Math.floor(e.x/Ce),i=Math.floor(e.y/Ce);return{x:t,y:i}}function uh(e,t){const i=Math.ceil(t/Ce),o=e%i*Ce+Ce/2,s=Math.floor(e/i)*Ce+Ce/2;return{x:o,y:s}}function EC(e,t,i){const o=(e.x%t+t)%t,s=(e.y%i+i)%i,l=Math.floor(o/Ce),c=Math.floor(s/Ce),d=Math.ceil(t/Ce);return c*d+l}function Zn(e,t,i){const o=EC({x:e,y:t},i.mapDimensions.width,i.mapDimensions.height);return i.terrainOwnership[o]||null}function jh(e,t){return t.terrainOwnership.includes(e)}function qv(e,t,i,o){var c;const s=i;return(c=s.search)!=null&&c.human?s.search.human.byRadius(e,o).some(d=>$i(t,d.leaderId,i)):!1}function wC(e,t,i,o,s=!1,l){if(s&&l&&qv(e,l,o,Vv))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:c,height:d}=o.mapDimensions,u=Math.ceil(c/Ce),h=Math.ceil(d/Ce),p=Math.ceil(t/Ce),y=t*t,A=Math.floor(e.x/Ce),v=Math.floor(e.y/Ce);let I=!1,S=!1;for(let E=-p;E<=p;E++)for(let _=-p;_<=p;_++){const w=((A+_)%u+u)%u,C=((v+E)%h+h)%h,R=w*Ce+Ce/2,b=C*Ce+Ce/2;if(fn(e,{x:R,y:b},c,d)<=y){const B=C*u+w,F=o.terrainOwnership[B];if(F===i)I=!0;else if(F!==null){if(s&&l&&$i(l,F,o))continue;S=!0}}}return S?{valid:!1,reason:"Position overlaps with another tribe's territory"}:I?{valid:!0}:jh(i,o)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function Zv(e,t,i,o){if(!jh(i,o))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(qv(e,i,o,Vv))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:l}=o.mapDimensions,c=Math.ceil(s/Ce),d=Math.ceil(l/Ce),u=Math.ceil(t/Ce),h=t*t,p=Math.floor(e.x/Ce),y=Math.floor(e.y/Ce);let A=!1;for(let v=-u;v<=u;v++){for(let I=-u;I<=u;I++){const S=((p+I)%c+c)%c,E=((y+v)%d+d)%d,_=S*Ce+Ce/2,w=E*Ce+Ce/2;if(fn(e,{x:_,y:w},s,l)<=h){const R=E*c+S;if(o.terrainOwnership[R]===i){A=!0;break}}}if(A)break}return A?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function CC(e,t,i,o=0,s=!1,l){if(o>0){const d=wC(e,o,t,i,s,l);return d.valid?{canPlace:!0}:{canPlace:!1,reason:d.reason}}const c=Zn(e.x,e.y,i);return c===null||c===t?{canPlace:!0}:s&&l&&$i(l,c,i)?{canPlace:!0}:c!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function hr(e,t,i){const o=Zn(e.x,e.y,i);return o===null||o===t||!$i(t,o,i)}function Kv(e,t,i,o,{allowOverwrite:s}){const{width:l,height:c}=o.mapDimensions,d=Math.ceil(l/Ce),u=Math.ceil(c/Ce),h=Math.ceil(t/Ce),p=Math.floor(e.x/Ce),y=Math.floor(e.y/Ce);for(let w=-h;w<=h;w++)for(let C=-h;C<=h;C++){const R=((p+C)%d+d)%d,b=((y+w)%u+u)%u,M=R*Ce+Ce/2,B=b*Ce+Ce/2;if(q(e,{x:M,y:B},l,c)<=t){const G=b*d+R,Y=o.terrainOwnership[G];(s||Y===null||Y===i)&&(o.terrainOwnership[G]=i)}}const A=3,v=h+A+2,I=[];for(let w=-v;w<=v;w++)for(let C=-v;C<=v;C++){const R=((p+C)%d+d)%d,b=((y+w)%u+u)%u,M=b*d+R;if(o.terrainOwnership[M]===null){let B=!1;const F=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const G of F){let Y=!1,J=!1;for(let z=1;z<=A;z++){const te=((R+G.x*z)%d+d)%d,se=((b+G.y*z)%u+u)%u*d+te;if(o.terrainOwnership[se]===i){Y=!0;break}}if(Y)for(let z=1;z<=A;z++){const te=((R-G.x*z)%d+d)%d,se=((b-G.y*z)%u+u)%u*d+te;if(o.terrainOwnership[se]===i){J=!0;break}}if(Y&&J){B=!0;break}}B&&I.push(M)}}for(const w of I)o.terrainOwnership[w]=i;const S=250,E=new Set;for(let w=-v;w<=v;w++)for(let C=-v;C<=v;C++){const R=((p+C)%d+d)%d,M=((y+w)%u+u)%u*d+R;if(o.terrainOwnership[M]===null&&!E.has(M)){const B=[],F=[M];E.add(M),B.push(M);let G=!0,Y=0;for(;Y<F.length;){const J=F[Y++];if(B.length>S){G=!1;break}const z=J%d,te=Math.floor(J/d),K=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:se,ny:ce}of K){const ne=((z+se)%d+d)%d,j=((te+ce)%u+u)%u*d+ne;o.terrainOwnership[j]===null&&!E.has(j)&&(E.add(j),G&&(B.push(j),F.push(j)))}}if(G&&B.length<=S)for(const J of B)o.terrainOwnership[J]=i}}const _=[];for(let w=-v;w<=v;w++)for(let C=-v;C<=v;C++){const R=((p+C)%d+d)%d,b=((y+w)%u+u)%u,M=b*d+R;if(o.terrainOwnership[M]===null){let B=0;for(let F=-1;F<=1;F++)for(let G=-1;G<=1;G++){if(G===0&&F===0)continue;const Y=((R+G)%d+d)%d,z=((b+F)%u+u)%u*d+Y;o.terrainOwnership[z]===i&&B++}B>=5&&_.push(M)}}for(const w of _)o.terrainOwnership[w]=i}function Qv(e,t,i,o){Kv(e,t,i,o,{allowOverwrite:!1})}function Jv(e,t,i,o){Kv(e,t,i,o,{allowOverwrite:!0})}function Wc(e,t,i){const o=e.terrainOwnership;for(let s=0;s<o.length;s++)o[s]===t&&(o[s]=i)}function qe(e,t,i,o,s){const l=t,c=o,d="position"in e&&e.id?e:null,u=d?d.position:e,h=l.search[i].byRadius(u,c);let p=null,y=c;for(const A of h){if(A.id===(d==null?void 0:d.id)||s&&!s(A))continue;const v=q(u,A.position,t.mapDimensions.width,t.mapDimensions.height);v<y&&(y=v,p=A)}return p}function ft(e){const i=e.search.human.byProperty("isPlayer",!0);return i.length>0?i[0]:void 0}function _C(e,t){var c;const o=t.search.human.byProperty("activeAction","attacking");let s=null,l=1/0;for(const d of o){if(d.attackTargetId!==e)continue;const u=q(d.position,((c=t.entities.entities[e])==null?void 0:c.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<l&&(s=d,l=u)}return s}function eA(e){return e.search.human.all()}function PC(e,t,i){const{width:o,height:s}=t.mapDimensions,l=Object.values(t.entities.entities).reverse();for(const c of l){const d=q(e,c.position,o,s),u=c.type==="tree"?c.radius*2:c.radius;if(d<u)return c}}function RC(e,t,i,o,s){const{width:l,height:c}=o.mapDimensions,d=i*i;if(s){for(let A=0;A<s.length;A++)if(fn(e,s[A],l,c)<d)return!0;return!1}const u=eA(o),h=new Set;for(let A=0;A<u.length;A++){const v=u[A];v.leaderId&&v.leaderId!==t&&h.add(v.leaderId)}const p=h.values();let y=p.next();for(;!y.done;){const A=y.value,v=pi(A,o);if(fn(e,v,l,c)<d)return!0;y=p.next()}return!1}var ve=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(ve||{});function be(e,t,i,o,s,l,c){const d={id:e.nextVisualEffectId,type:t,position:i,startTime:e.time,duration:o,entityId:s,targetPosition:l,targetEntityId:c};return e.visualEffects.push(d),e.nextVisualEffectId++,d.id}const We=1,xa=3,Oi=100,tA=20,Jo=10,MC=.5,_a=150,kC=25,DC=.5,dh=100,nA=25,OC=.5,bC=15,fh=4,NC=.75,BC=15,HC=8,FC=20;function $a(e,t,i,o,s,l){if(i===void 0)return!1;const{width:c,height:d}=o.mapDimensions;if(s&&l!==void 0&&fn(s,e,c,d)>l*l)return!1;const u=_h(t),h=Math.sqrt(u.width*u.width+u.height*u.height)/2;if(Gi(e,o,h*.8))return!1;if(t===fe.PlantingZone){const{depletedSectors:S}=CA(o.soilDepletion,e,u.width,u.height,c,d);if(S.length>0)return!1}const y=o.search.building.byRadius(e,h*2);for(const S of y){const E=fn(e,S.position,c,d),_=(Math.max(u.width,u.height)+Math.max(S.width,S.height))/2;if(E<_*_*.81)return!1}const A=t===fe.BorderPost;return!!CC(e,i,o,A?Qy:us,A,i).canPlace}function LC(e){const t=[],i=2*Math.PI/e;for(let o=0;o<e;o++){const s=o*i;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function kf(e,t,i,o,s,l,c){const d=performance.now(),u=i,h=_h(e),p=i.mapDimensions.width,y=i.mapDimensions.height,A=u.search.building.byProperty("ownerId",t),v=[];if(A.length>0){l&&v.unshift(l);const w=pi(t,i),C=[...A].sort((R,b)=>{const M=fn(R.position,w,p,y),B=fn(b.position,w,p,y);return M-B});v.push(...C.map(R=>R.position))}else v.push(pi(t,i));const I=Math.min(v.length,gC),S=Math.max(h.width,h.height),E=S+20,_=S/2;for(let w=0;w<I;w++){const C=v[w];for(let R=E;R<=o;R+=_){const b=Math.max(8,Math.min(mC,Math.ceil(2*Math.PI*R/S))),M=LC(b);for(let B=0;B<b;B++){const F=M[B].cos*R,G=M[B].sin*R,Y=C.x+F,J=C.y+G,z=(Y%p+p)%p,te=(J%y+y)%y;if(!RC({x:z,y:te},t,s,i,c)&&$a({x:z,y:te},e,t,i))return performance.now()-d,{x:z,y:te}}}}performance.now()-d}function Xh(e,t,i,o){if(t===fe.BorderPost)return Jv(e,Qy,i,o),be(o,ve.BorderClaim,e,We,i),null;const s=sk(o.entities,e,t,i);return t===fe.Bonfire&&(s.storageCapacity=fh,s.storedItems=[]),Qv(e,us,i,o),t===fe.PlantingZone&&Ba(o),s}function hh(e,t){const i=t.entities.entities[e];i&&i.type==="building"&&!i.isBeingDestroyed&&(i.isBeingDestroyed=!0,i.destructionProgress=0,i.buildingType===fe.PlantingZone&&Ba(t))}function UC(e,t){const s=t.search.building.byRadius(e,100);for(const l of s){let c=e.x-l.position.x,d=e.y-l.position.y;const u=t.mapDimensions.width,h=t.mapDimensions.height;if(Math.abs(c)>u/2&&(c-=Math.sign(c)*u),Math.abs(d)>h/2&&(d-=Math.sign(d)*h),Math.abs(c)<=l.width/2&&Math.abs(d)<=l.height/2)return l}}var Fe=(e=>(e.Leader="leader",e.Gatherer="gatherer",e.Planter="planter",e.Hunter="hunter",e.Mover="mover",e.Warrior="warrior",e))(Fe||{});const mt=30,As=mt*.6,iA="#4CAF50",oA="#FF5722",rA="#9C27B0",GC="#2196F3",sA="#FFC107",xC="#DC143C",Vh="#FFFFFF",qh=[5,5],pu=5,ds=15,$C=20,WC=16,YC=10,zC=16,jC=16,Yc=["","","","","","","","","",""],Pa=8,XC="#FFFFFF",et=18,Ve=15,VC="rgba(0, 0, 0, 0.7)",qC=4,co=150,vn=15,Ci=10,yo="#555",ZC="#f44336",KC="#4CAF50",QC="#2196F3",JC="#FFC107",pc=16,ki=32,gc=28,e1=10,t1=8,n1=8,i1=8,Wo=28,aa=40,la=10,V0=8,o1=11,Df=40,q0=5,r1=10,s1="#FFA500",a1="#808080",bi=120,aA=30,l1=20,Tn="#2d3748",ot="#ffffff",Ia="#4a5568",lA=5,Zh="#bdc9f792",cA="#272c36ff",uA="#a0aec0",zc=300,dA="rgba(255, 255, 255, 0.5)",c1="rgba(0, 0, 0, 0.8)",u1="#FFFFFF",Z0=14,K0=8,Q0=-15,fA="#FFD700",hA=5,d1="rgba(0, 0, 0, 0.5)",f1="#FFFFFF",h1=33,p1=400,g1=20,m1=10,y1="rgba(0, 0, 0, 0.7)",v1="#FFFFFF",Of=20,J0=16,A1=.5,ey=5,pA="#FFD700",I1=40,Kh=4,gA=3,S1=5,mA=20,yA=5,T1="#FFFFFF",E1="#FF6B6B",An=80,Yo=10,mc=300,zo=15,w1=8,C1="rgba(0, 0, 0, 0.8)",_1="#FFFFFF",bf=14,ty=10,si=20,P1="#FF6B6B",R1="#4CAF50",ny="#FFD700",M1="rgba(255, 255, 0, 0.3)",k1=2,D1=500,O1=120,b1=45,N1="#FFD700",B1=3,H1=4,Nf=225,iy=20,F1="#666",L1="#1a2a3a";let Bf=0;function jc(){const e=Yc[Bf];return Bf=(Bf+1)%Yc.length,e}function fs(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),i=e.filter(s=>s.gender==="female"),o=(s,l)=>s.age!==l.age?l.age-s.age:s.id-l.id;if(t.sort(o),t.length>0)return t[0];if(i.sort(o),i.length>0)return i[0]}function xi(e,t){const i=e,o=i.search.human.byProperty("motherId",t.id),s=i.search.human.byProperty("fatherId",t.id);return[...o,...s]}function ph(e,t){var l,c,d,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(l=e.partnerIds)!=null&&l.includes(t.id)||(c=t.partnerIds)!=null&&c.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const i=e.motherId===t.motherId||e.fatherId===t.fatherId,o=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((d=e.ancestorIds)==null?void 0:d.some(h=>t.ancestorIds.includes(h)))||((u=t.ancestorIds)==null?void 0:u.some(h=>e.ancestorIds.includes(h)));return i||o||s}function vA(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const i of e.partnerIds){const o=t.entities.entities[i];if(o&&o.gender==="male")return o}return null}function oy(e,t){var i;if(!e.isAdult){if(e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human")return o}if(e.motherId){const o=t.entities.entities[e.motherId];if(o&&o.type==="human")return o}}if(e.isAdult&&e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human"&&((i=fs(xi(t,o)))==null?void 0:i.id)===e.id)return o}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?vA(e,t):null}function U1(e,t){let i=e;const o=new Set;o.add(i.id);for(let s=0;s<Uv;s++){let l=null;if(i.gender==="female"&&(l=vA(i,t)),!l&&i.fatherId&&(l=t.entities.entities[i.fatherId]||null),!l||o.has(l.id))break;i=l,o.add(i.id)}return i}function G1(e,t){var o;const i=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&i.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&i.add(s)}return(o=e.partnerIds)==null||o.forEach(s=>{const l=t.entities.entities[s];l&&i.add(l)}),xi(t,e).forEach(s=>i.add(s)),Array.from(i)}function Xc(e,t){const i=new Map;function o(s){const l=xi(t,s);for(const c of l)i.has(c.id)||(i.set(c.id,c),o(c))}return o(e),Array.from(i.values())}function mi(e,t){return t.search.human.byProperty("leaderId",e)}function Vc(e,t,i=new Map,o=new Set){var l;if(i.has(e))return i.get(e);if(o.has(e))return e;o.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((l=s.partnerIds)!=null&&l.length)){const c=s.partnerIds.find(d=>{const u=t.entities.entities[d];return u&&u.gender==="male"});if(c){const d=Vc(c,t,i,o);return i.set(e,d),d}}if(s.fatherId&&t.entities.entities[s.fatherId]){const c=Vc(s.fatherId,t,i,o);return i.set(e,c),c}return i.set(e,e),e}function x1(e,t){e.leaderId=e.id,e.tribeRole=Fe.Leader,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{roleWeights:{[Fe.Leader]:0,[Fe.Gatherer]:2,[Fe.Planter]:2,[Fe.Hunter]:2,[Fe.Mover]:2,[Fe.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}}),e.tribeInfo||(e.tribeInfo={tribeBadge:jc(),tribeColor:on[Math.floor(Math.random()*on.length)]}),e.tribeControl||(e.tribeControl={roleWeights:{[Fe.Leader]:0,[Fe.Gatherer]:2,[Fe.Planter]:2,[Fe.Hunter]:2,[Fe.Mover]:2,[Fe.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}})}function $1(e,t){if(e.length===0)return null;const i=new Map,o=new Map;for(const c of e){const d=Vc(c.id,t,i);o.has(d)||o.set(d,[]),o.get(d).push(c)}let s=null,l=0;for(const[c,d]of o.entries())d.length>l&&(l=d.length,s=c);return s&&t.entities.entities[s]||null}function gu(e,t){var p,y,A;const i=new Map;for(let v=0;v<e.terrainOwnership.length;v++){const I=e.terrainOwnership[v];I!==null&&(i.has(I)||i.set(I,[]),i.get(I).push(v))}const{width:o,height:s}=e.mapDimensions,l=Math.ceil(o/Ce),c=new Map,d=Object.values(e.entities.entities).filter(v=>v.type==="human");for(const v of d)v.leaderId&&(c.has(v.leaderId)||c.set(v.leaderId,{leaderId:v.leaderId,tribeInfo:v.tribeInfo,members:[]}),(p=c.get(v.leaderId))==null||p.members.push(v));const u=t?(A=(y=e.entities.entities[t])==null?void 0:y.tribeControl)==null?void 0:A.diplomacy:void 0,h=Array.from(c.values()).map(v=>{var C,R;const I=e.entities.entities[v.leaderId],S=v.members.filter(b=>b.isAdult).length,E=v.members.length-S,_=i.get(v.leaderId)||[];let w=I==null?void 0:I.position;if(_.length>0){const b=_[0],M=b%l*Ce,B=Math.floor(b/l)*Ce,F={x:M,y:B};let G=0,Y=0;for(const te of _){const K=te%l*Ce,se=Math.floor(te/l)*Ce,ce=Xe(F,{x:K,y:se},o,s);G+=ce.x,Y+=ce.y}const J=G/_.length,z=Y/_.length;w={x:((F.x+J)%o+o)%o,y:((F.y+z)%s+s)%s}}return{leaderId:v.leaderId,tribeBadge:((C=v==null?void 0:v.tribeInfo)==null?void 0:C.tribeBadge)||"",tribeColor:((R=v==null?void 0:v.tribeInfo)==null?void 0:R.tribeColor)||"",adultCount:S,childCount:E,isPlayerTribe:v.leaderId===t,leaderAge:(I==null?void 0:I.age)??0,leaderGender:(I==null?void 0:I.gender)??"male",diplomacyStatus:(u==null?void 0:u[v.leaderId??-1])??Et.Friendly,territoryCenter:w}});return h.sort((v,I)=>v.isPlayerTribe?-1:I.isPlayerTribe?1:I.adultCount+I.childCount-(v.adultCount+v.childCount)),h}function AA(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function IA(e){var l;const t=new Set,o=e.search.human.all(),s=new Map;for(const c of o)c.leaderId&&(s.has(c.leaderId)||s.set(c.leaderId,[]),(l=s.get(c.leaderId))==null||l.push(c));for(const[c,d]of s){if(d.length===0)continue;const u=e.entities.entities[c],h=!u,p=u&&u.leaderId!==c;(h||p)&&t.add(c)}for(let c=0;c<e.terrainOwnership.length;c++){const d=e.terrainOwnership[c];d!==null&&!s.has(d)&&t.add(d)}return Array.from(t)}function W1(e,t){const i=new Map,s=t.search.human.all(),l=G1(e,t);for(const d of l)i.set(d,3);for(const d of s)d.id===e.id||i.has(d)||ph(e,d)&&i.set(d,2);const c=Array.from(i.keys());for(const d of c)if(d.partnerIds)for(const u of d.partnerIds){const h=t.entities.entities[u];h&&!i.has(h)&&h.id!==e.id&&i.set(h,1)}return i}function Y1(e,t){const i=mi(e,t);if(i.length===0)return null;const o=t.entities.entities[e];if(o&&o.leaderId&&o.leaderId!==o.id)return o.leaderId;const s=new Map;for(const d of i){const u=W1(d,t);for(const[h,p]of u)if(h.leaderId&&h.leaderId!==e){const y=h.leaderId,A=t.entities.entities[y];if(A&&A.leaderId===A.id){const v=s.get(y)||0;s.set(y,v+p)}}}let l=null,c=0;for(const[d,u]of s)u>c&&(c=u,l=d);return l}function ry(e,t,i){var p,y;const o=mi(e,i);let s=i.entities.entities[t];if(!s||(s.leaderId&&i.entities.entities[s.leaderId]&&(t=s.leaderId,s=i.entities.entities[t]),!s))return;const l=o.length>0?(p=o[0].tribeInfo)==null?void 0:p.tribeBadge:"?",c=s.leaderId===e||!s.leaderId;if(c){const A=i.entities.entities[e];x1(s,A)}const d=((y=s.tribeInfo)==null?void 0:y.tribeBadge)??"?";for(const A of o)A.id!==t&&(A.leaderId=t,A.tribeInfo=s.tribeInfo,A.tribeRole=void 0);const h=i.search.building.byProperty("ownerId",e);for(const A of h)A.ownerId=t;Wc(i,e,t),Ga(i,{identifier:`tribe-merge-${e}`,type:ar.TribeMerged,message:c?`Tribe ${l} has a new leader!`:`Tribe ${l} has merged into Tribe ${d}!`,duration:$c,targetEntityIds:[t],highlightedEntityIds:[t,...o.map(A=>A.id)]})}function z1(e){var i;const t=IA(e);for(const o of t){const s=mi(o,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",o);for(const h of u)hh(h.id,e);Wc(e,o,null),Ga(e,{identifier:`tribe-dissolved-${o}`,type:ar.TribeMerged,message:"An extinct tribe has been dissolved.",duration:$c});continue}const l=$1(s,e);if(l){ry(o,l.id,e);continue}const c=Y1(o,e);if(c)ry(o,c,e);else{const d=s.length>0?(i=s[0].tribeInfo)==null?void 0:i.tribeBadge:"?";for(const p of s)p.leaderId=void 0,p.tribeInfo=void 0,p.tribeRole=void 0;const h=e.search.building.byProperty("ownerId",o);for(const p of h)hh(p.id,e);Wc(e,o,null),Ga(e,{identifier:`tribe-dissolved-${o}`,type:ar.TribeMerged,message:`Tribe ${d} has been dissolved due to lack of leadership.`,duration:$c})}}}var Ot=(e=>(e.Wood="wood",e))(Ot||{});const Qh={wood:""},Vn="treeGrowing",Hn="treeFull",gi="treeSpreading",Vt="treeFallen",Ui="treeStump",cr="treeDying";function SA(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const i=AA({leaderId:e},t),o=0,c=t.search.building.byProperty("ownerId",e).reduce((I,S)=>{if(S.isConstructed)return I;const E=Ro[S.buildingType].cost.wood||0;return I+E},0),u=K1(e,t).reduce((I,S)=>{const _=(S.maxFuelLevel||dh)-(S.fuelLevel||0);if(_<=0)return I;const w=Math.ceil(_/nA),C=S.storedItems.filter(b=>b.item.type===Ot.Wood).length,R=Math.max(0,w-C);return I+R},0),p=Z1(e,t).reduce((I,S)=>{var _;const E=(_=S.storedItems)==null?void 0:_.filter(w=>w.item.type===Ot.Wood);return I+((E==null?void 0:E.length)||0)},0),y=i.reduce((I,S)=>{var E;return I+(((E=S.heldItem)==null?void 0:E.type)===Ot.Wood?1:0)},0),A=p+y,v=c+u+o;return t.cache.tribeWoodNeeds[e]=Math.max(0,v-A),t.cache.tribeWoodNeeds[e]}function j1(e,t){const i=t;if(e&&i.cache.tribeAvailableWoodOnGround[e]!==void 0)return i.cache.tribeAvailableWoodOnGround[e];const o=i.search.tree.all().filter(s=>!(s.stateMachine[0]===Vt)||s.wood.length===0?!1:hr(s.position,e,t));return i.cache.tribeAvailableWoodOnGround[e]=o.reduce((s,l)=>s+l.wood.length,0),i.cache.tribeAvailableWoodOnGround[e]}function X1(e,t,i=!1){const o=typeof e=="object"?e.leaderId:e;return o?t.search.building.byProperty("buildingType",fe.PlantingZone).filter(l=>{if(!i&&!l.isConstructed)return!1;if(l.ownerId){const c=t.entities.entities[l.ownerId];return c&&c.leaderId===o}return!1}):[]}function V1(e,t){const{width:i,height:o,position:s}=e,{width:l,height:c}=t.mapDimensions,{depletedSectors:d,totalSectorsCount:u}=CA(t.soilDepletion,s,i,o,l,c);return u===0?!0:d.length/u<.25}function TA(e){const t=au*2,i=Math.floor(e.width/t),o=Math.floor(e.height/t);return i*o}function q1(e,t){const i=t,o=Math.max(e.width,e.height);return i.search.berryBush.byRadius(e.position,o).filter(c=>{const d=Math.abs(c.position.x-e.position.x),u=Math.abs(c.position.y-e.position.y);return d<=e.width/2&&u<=e.height/2}).length}function Z1(e,t,i=!1){return t.search.building.byProperty("buildingType",fe.StorageSpot).filter(s=>{if(!i&&!s.isConstructed)return!1;if(s.ownerId){const l=t.entities.entities[s.ownerId];return l&&l.leaderId===e}return!1})}function K1(e,t,i=!1){return t.search.building.byProperty("buildingType",fe.Bonfire).filter(s=>{if(!i&&!s.isConstructed)return!1;if(s.ownerId){const l=t.entities.entities[s.ownerId];return l&&l.leaderId===e}return!1})}function Ka(e,t,i=void 0){return i?X1(i,t).some(c=>x0(e,c,t)):t.search.building.byRadius(e,60).some(l=>l.buildingType===fe.PlantingZone&&x0(e,l,t))}function mu(e,t,i){const o=(e.x%t+t)%t,s=(e.y%i+i)%i;return{gridX:Math.floor(o/Ut),gridY:Math.floor(s/Ut)}}function EA(e,t,i){const o=Dv(t,i);return e.sectors[o]||(e.sectors[o]=Sw()),e.sectors[o]}function Jh(e,t,i){const o=Dv(t,i),s=e.sectors[o];return s?s.health:Gc}function ur(e,t,i,o){const{gridX:s,gridY:l}=mu(t,i,o);return Jh(e,s,l)<Nv}function wA(e,t,i){return Jh(e,t,i)>=Nv}function Q1(e,t,i,o,s,l,c){const{gridX:d,gridY:u}=mu(t,s,l),h=EA(e,d,u),p=h.lastAffectedBy[i]||0;if(o-p<Hv)return;const y=Ka(t,c)?Lv:1,A=Ew*y;h.health=Math.max(Bv,h.health-A),h.lastWalkTime=o,h.lastAffectedBy[i]=o}function J1(e,t,i,o,s,l){const{gridX:c,gridY:d}=mu(t,o,s),u=EA(e,c,d),h=Ka(t,l)?Lv:1,p=Tw*h;u.health=Math.max(Bv,u.health-p),u.lastPlantTime=i}function e_(e,t,i,o,s){let l=0;for(let c=-1;c<=1;c++)for(let d=-1;d<=1;d++){if(c===0&&d===0)continue;const u=((t+c)%o+o)%o,h=((i+d)%s+s)%s;wA(e,u,h)&&l++}return l}function t_({soilDepletion:e,time:t,mapDimensions:{width:i,height:o}}){if(t-e.lastUpdateTime<kw)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const l=Math.ceil(i/Ut),c=Math.ceil(o/Ut),d=[];for(const u of Object.keys(e.sectors)){const h=Number(u),p=e.sectors[h],y=Math.max(p.lastWalkTime,p.lastPlantTime);if(t-y<_w)continue;const{gridX:A,gridY:v}=Ov(h),I=e_(e,A,v,l,c),S=I>0?Cw*(I/8):0,E=ww+S;p.health=Math.min(Gc,p.health+E*s),p.health>=Gc&&d.push(h);const _=t-Hv*10;for(const w of Object.keys(p.lastAffectedBy)){const C=Number(w);p.lastAffectedBy[C]<_&&delete p.lastAffectedBy[C]}}for(const u of d)delete e.sectors[u]}function n_(e,t){const i=[];for(const o of Object.keys(e.sectors)){const s=Number(o),l=e.sectors[s];if(l.health<t){const{gridX:c,gridY:d}=Ov(s);i.push({gridX:c,gridY:d,health:l.health})}}return i}function CA(e,t,i,o,s,l){const c=[],d=i/2,u=o/2,h=t.x-d,p=t.x+d,y=t.y-u,A=t.y+u,v=Math.floor(h/Ut),I=Math.floor((p-.001)/Ut),S=Math.floor(y/Ut),E=Math.floor((A-.001)/Ut),_=Math.ceil(s/Ut),w=Math.ceil(l/Ut);let C=0;for(let R=v;R<=I;R++)for(let b=S;b<=E;b++){C++;const M=(R%_+_)%_,B=(b%w+w)%w;wA(e,M,B)||c.push({gridX:M,gridY:B})}return{depletedSectors:c,totalSectorsCount:C}}function sy(e,t,i,o,s){const{gridX:l,gridY:c}=mu(t,i,o),d=Jh(e,l,c);return 1+(s-1)*Math.sqrt(1-d/Gc)}const i_={id:Ca,update:(e,t)=>{const{entity:i,updateContext:o}=t,s=o.deltaTime*(Dt/Gt);if(i.age+=s,i.age>=i.lifespan)return{nextState:La,data:{...e,enteredAt:o.gameState.time}};if(!ur(o.gameState.soilDepletion,i.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height)){const c=Ka(i.position,o.gameState)?Iw:1;i.timeSinceLastBerryRegen+=s*c,i.timeSinceLastBerryRegen>=mw&&i.food.length<i.maxFood&&(i.food.push({itemType:"food",type:Qn.Berry}),i.timeSinceLastBerryRegen=0)}return i.food.length>=i.maxFood?{nextState:qo,data:{...e,enteredAt:o.gameState.time,previousState:Ca}}:{nextState:Ca,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},o_={id:qo,update:(e,t)=>{const{entity:i,updateContext:o}=t,s=o.deltaTime*(Dt/Gt);if(i.age+=s,i.age>=i.lifespan)return{nextState:La,data:{...e,enteredAt:o.gameState.time,previousState:qo}};if(i.food.length<i.maxFood)return{nextState:Ca,data:{...e,enteredAt:o.gameState.time,previousState:qo}};if(i.timeSinceLastSpreadAttempt+=s,i.timeSinceLastSpreadAttempt>=N0){i.timeSinceLastSpreadAttempt=0;const c=o.gameState.time-i.timeSinceLastHarvest>=N0,d=Ka(i.position,o.gameState)?Aw:1,u=o.gameState.ecosystem.berryBushSpreadChance*d;if(c&&Math.random()<u)return{nextState:Dc,data:{...e,enteredAt:o.gameState.time,previousState:qo}}}return{nextState:qo,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function ay(e){return e.filter(t=>t.isAdult).reduce((t,i)=>{let o=i.hitpoints;return o+=(i.maxAge-i.age)*.5,o+=i.food.length*2,t+o},0)}var ue=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(ue||{});const yu={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},_A={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var jr=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(jr||{});const ca={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var oe=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenTribeModal="OpenTribeModal",e.RecenterCamera="RecenterCamera",e.CloseTribeModal="CloseTribeModal",e.OpenRoleManager="OpenRoleManager",e.CloseRoleManager="CloseRoleManager",e.IncreaseRoleWeight="IncreaseRoleWeight",e.DecreaseRoleWeight="DecreaseRoleWeight",e.OpenArmyControl="OpenArmyControl",e.CloseArmyControl="CloseArmyControl",e.IncreaseArmyObjective="IncreaseArmyObjective",e.DecreaseArmyObjective="DecreaseArmyObjective",e))(oe||{});const Hf=30,r_=.4,s_=100,a_=72,PA=10,RA=2,l_=10,c_=15,gh=5,mh=5,yh=5,ly=600,u_=1.5,MA=.1,Ff=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,Lf=""+new URL("gather-CU75596W.mp3",import.meta.url).href,d_=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,cy=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,f_=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,h_=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,p_=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,g_=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,m_=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,y_=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Ae=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Ae||{});const v_=new Map([[0,Ff],[1,Lf],[2,d_],[3,cy],[4,f_],[5,h_],[6,p_],[12,g_],[13,m_],[7,Ff],[8,cy],[9,Lf],[10,Lf],[11,Ff],[14,y_]]);let ua,Wa;function A_(){if(!(typeof window>"u"))return Wa}function ep(){if(!(typeof window>"u"))return!ua&&typeof window.AudioContext=="function"&&(ua=new window.AudioContext,Wa=ua.createGain(),Wa.connect(ua.destination),Ra(.1,!1)),ua}function Ra(e,t){Wa&&(Wa.gain.value=t?0:e/10)}const kA=new Map;let yc=!1,uy=!1;async function I_(){if(uy||yc)return;const e=ep();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),yc=!0,console.log("Starting sound loading...");const t=[];v_.forEach((i,o)=>{const s=fetch(i).then(l=>{if(!l.ok)throw new Error(`Failed to fetch sound: ${i}`);return l.arrayBuffer()}).then(l=>e.decodeAudioData(l)).then(l=>{kA.set(o,l)}).catch(l=>{console.error(`Error loading sound ${Ae[o]} from ${i}:`,l)});t.push(s)});try{await Promise.all(t),uy=!0,yc=!1,console.log("All sounds loaded successfully.")}catch(i){yc=!1,console.error("An error occurred while loading sounds:",i)}}const Ma=new Map;function tp(e,t){const i=ep(),o=A_();if(!i||!o||o.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;i.state==="suspended"&&i.resume();const s=kA.get(e);if(!s){console.warn(`Sound buffer not found for type: ${Ae[e]}`);return}if(t!=null&&t.trackId&&Ma.has(t.trackId))return;const l=i.createBufferSource();l.buffer=s,l.loop=(t==null?void 0:t.loop)??!1;const c=i.createGain(),d=i.createStereoPanner();let u=c;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const h=Xe(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),p=q(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(p>ly)return;const y=1-Math.pow(p/ly,u_);c.gain.value=Math.max(0,y);const A=Math.sin(h.x/p*(Math.PI/2));d.pan.value=isNaN(A)?0:A,c.connect(d),u=d}else{const h=e===Ae.GameOver?.4:e===Ae.SoundTrack1?1:.2;c.gain.value=h}l.connect(u),u.connect(o),l.start(0),t!=null&&t.trackId&&(Ma.set(t.trackId,{sourceNode:l,gainNode:c}),l.onended=()=>{Ma.delete(t.trackId)})}function Uf(e,t=1){const i=Ma.get(e),o=ep();if(i&&o){const{sourceNode:s,gainNode:l}=i,c=o.currentTime;l.gain.setValueAtTime(l.gain.value,c),l.gain.linearRampToValueAtTime(0,c+t),s.stop(c+t),s.onended=null,Ma.delete(e)}}function we(e,t,i){const o=ft(e.gameState);o&&tp(t,{position:i,listenerPosition:o.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}const De={create(){return{data:{}}},set({data:e},t,i){e[t]=i},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e}},S_="tribeSplit_phase",vu="tribeSplit_strategy",DA="tribeSplit_targetPosition",np="tribeSplit_targetBuildingId",ip="tribeSplit_familyIds",OA="tribeSplit_lastFailureTime";function T_(e,t){De.set(e,S_,"idle"),De.delete(e,vu),De.delete(e,DA),De.delete(e,np),De.delete(e,ip),De.set(e,OA,t)}function E_(e,t){const i=De.get(e,OA);return i?t-i>=a_:!0}function bA(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(IA(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!E_(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const o=t.entities.entities[e.leaderId];if(!o||o.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=fs(xi(t,o));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(U1(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const c=mi(e.leaderId,t).filter(v=>v.isAdult);if(c.length<Hf)return{canSplit:!1,reason:"Tribe too small"};const u=Xc(e,t).length+1,p=Xc(o,t).length+1;if(u>=p&&u>Hf)return{canSplit:!0,progress:1,strategy:dy(e,t)};const y=Math.max(c.length*r_,Hf),A=u/y;if(u>=y){const v=dy(e,t);return{canSplit:!0,progress:A,strategy:v}}return{canSplit:!1,progress:A,reason:`Family too small: ${u} < ${y}`}}function dy(e,t){if(!e.leaderId)return"migration";const i=t;if(!(Zn(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=i.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===fe.StorageSpot&&l.isConstructed);return s.length>0&&s.find(c=>q(e.position,c.position,t.mapDimensions.width,t.mapDimensions.height)<=s_)?"concentration":"migration"}function w_(e,t){if(!e.aiBlackboard)return!1;const i=De.get(e.aiBlackboard,vu);if(!i)return!1;const o=Xc(e,t),s=[e.id,...o.map(l=>l.id)];return De.set(e.aiBlackboard,ip,s),i==="migration"?__(e,t):i==="concentration"?P_(e,t):!1}function C_(e,t,i){if(Gi(e,i,30))return!1;const s=Zn(e.x,e.y,i);return!(s===t||s!==null&&s!==t)}function __(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const i=t.mapDimensions.width,o=t.mapDimensions.height,s=Math.min(i,o)/2,l=50,c=50;for(let d=0;d<=s;d+=l){const u=d===0?1:Math.max(8,Math.ceil(2*Math.PI*d/c)),h=d===0?0:2*Math.PI/u;for(let p=0;p<u;p++){const y=p*h,A=Math.cos(y)*d,v=Math.sin(y)*d,I=e.position.x+A,S=e.position.y+v,E={x:(I%i+i)%i,y:(S%o+o)%o};if(C_(E,e.leaderId,t))return De.set(e.aiBlackboard,DA,E),!0}}return!1}function P_(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const o=t.search.building.byProperty("ownerId",e.leaderId).filter(c=>c.buildingType===fe.StorageSpot&&c.isConstructed);if(o.length===0)return!1;let s=null,l=1/0;for(const c of o){const d=q(e.position,c.position,t.mapDimensions.width,t.mapDimensions.height);d<l&&(l=d,s=c)}return s?(De.set(e.aiBlackboard,np,s.id),!0):!1}function R_(e,t){var u;if(!e.aiBlackboard)return!1;const i=De.get(e.aiBlackboard,vu),o=De.get(e.aiBlackboard,ip);if(!i||!o)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,l=jc(),c=on[Math.floor(Math.random()*on.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:l,tribeColor:c},e.tribeRole=Fe.Leader,e.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=Et.Hostile);for(const h of o){if(h===e.id)continue;const p=t.entities.entities[h];!p||p.type!=="human"||(p.leaderId=e.id,p.tribeInfo={tribeBadge:l,tribeColor:c})}if(i==="concentration"){const h=De.get(e.aiBlackboard,np);if(h){const p=t.entities.entities[h];p&&p.type==="building"&&(p.ownerId=e.id)}}return Ga(t,{type:ar.NewTribeFormed,message:`A new tribe has formed via ${i}! ${l}`,duration:$c,targetEntityIds:[e.id],highlightedEntityIds:o}),we({gameState:t},Ae.TribeSplit,e.position),T_(e.aiBlackboard,t.time),!0}function M_(e,t){De.set(e,vu,t)}function NA(e,t){const i=bA(e,t);return{canSplit:i.canSplit,progress:i.progress}}function BA(e,t){if(!e.aiBlackboard)return;const i=bA(e,t);!i.canSplit||!i.strategy||(M_(e.aiBlackboard,i.strategy),w_(e,t)&&R_(e,t))}const k_=20,Kn=30,D_=.5,O_=.3,b_=2,N_=50;function op(e,t){var l;const i=[];if(t.food.length>0&&t.hunger>Eo&&i.push({type:ue.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const c=qe(t,e,"berryBush",je,h=>h.food.length>0),d=qe(t,e,"corpse",je,h=>h.food.length>0);let u=null;c&&d?u=q(t.position,c.position,e.mapDimensions.width,e.mapDimensions.height)<=q(t.position,d.position,e.mapDimensions.width,e.mapDimensions.height)?c:d:u=c||d,u&&i.push({type:ue.Gather,action:"gathering",key:"e",targetEntity:u})}const o=qe(t,e,"human",je,c=>vs(t,c,e));if(o&&i.push({type:ue.Procreate,action:"procreating",key:"r",targetEntity:o}),t.food.length>0&&t.isAdult){const c=qe(t,e,"human",je,d=>{const u=d;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=Eo});c&&i.push({type:ue.FeedChild,action:"feeding",key:"h",targetEntity:c})}const s=qe(t,e,"human",hn,c=>Za(t,c,e))??qe(t,e,"predator",hn)??qe(t,e,"prey",hn);if(s&&i.push({type:ue.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(c=>c.type===Qn.Berry).length>=sr&&i.push({type:ue.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const c=qe(t,e,"building",Kn,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});c&&i.push({type:ue.Deposit,action:"idle",key:"x",targetEntity:c})}if(t.food.length<t.maxFood&&t.isAdult){const c=qe(t,e,"building",Kn,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});c&&i.push({type:ue.Retrieve,action:"idle",key:"z",targetEntity:c})}if(((l=t.heldItem)==null?void 0:l.type)===Ot.Wood){const c=qe(t,e,"building",Kn,d=>{const u=d;return u.buildingType===fe.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});c&&i.push({type:ue.Deposit,action:"depositing",key:"x",targetEntity:c})}if(NA(t,e).canSplit&&i.push({type:ue.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const c=qe(t,e,"tree",cu,d=>d.wood&&d.wood.length>0);c&&i.push({type:ue.Chop,action:"chopping",key:"c",targetEntity:c})}return i}const B_={id:Dc,update:(e,t)=>{const{entity:i,updateContext:o}=t,{gameState:s}=o,l=o.deltaTime*(Dt/Gt);if(i.age+=l,i.age>=i.lifespan)return{nextState:La,data:{...e,enteredAt:s.time,previousState:Dc}};const c=Xv(i.position,i.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Gi(c,s,15)||el(s.entities,c,s.time),{nextState:qo,data:{...e,enteredAt:s.time,previousState:Dc}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},H_={id:La,update:e=>({nextState:La,data:e}),onEnter:(e,t)=>(yr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},F_=[i_,o_,B_,H_],ut="humanIdle",Vo="humanMoving",Sa="humanEating",Is="humanGathering",ka="humanDepositing",Da="humanRetrieving",Ko="humanProcreating",Co="humanAttacking",Oc="humanPlanting",rp="humanChopping",L_={id:ut,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="attacking"&&i.attackTargetId?{nextState:Co,data:{...e,enteredAt:o.gameState.time,previousState:ut,attackTargetId:i.attackTargetId,attackStartTime:o.gameState.time}}:(i.hunger>=Gv?(i.debuffs=i.debuffs.filter(s=>s.type!=="slow"),i.debuffs.push({type:"slow",startTime:o.gameState.time,duration:.1})):i.debuffs=i.debuffs.filter(s=>s.type!=="slow"),i.activeAction==="moving"?{nextState:Vo,data:{...e,enteredAt:o.gameState.time,previousState:ut,target:i.target}}:i.activeAction==="gathering"?{nextState:Is,data:{...e,enteredAt:o.gameState.time,previousState:ut,target:i.target}}:i.activeAction==="eating"?{nextState:Sa,data:{...e,enteredAt:o.gameState.time,previousState:ut}}:i.activeAction==="planting"&&i.target?{nextState:Oc,data:{...e,enteredAt:o.gameState.time,previousState:ut,plantingSpot:i.target}}:i.activeAction==="depositing"?{nextState:ka,data:{...e,enteredAt:o.gameState.time,previousState:ut}}:i.activeAction==="retrieving"?{nextState:Da,data:{...e,enteredAt:o.gameState.time,previousState:ut}}:i.activeAction==="chopping"&&i.target?{nextState:rp,data:{...e,enteredAt:o.gameState.time,previousState:ut,state:"chopping"}}:{nextState:ut,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function HA(e,t=1){let i=Ow;return e.hunger>=Gv&&(i*=bw),e.age>=Bw&&(i*=Hw),e.movementSlowdown&&(i*=e.movementSlowdown.modifier),i*=t,i}const Gf=7.5;class U_{constructor(){Ht(this,"id",Vo)}update(t,i){var A;const{entity:o,updateContext:s}=i;if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:Co,data:{...t,enteredAt:s.gameState.time,previousState:Vo,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:ut,data:{...t,enteredAt:s.gameState.time,previousState:Vo}};let l;if(typeof o.target=="object"?l=o.target:typeof o.target=="number"&&(l=(A=i.updateContext.gameState.entities.entities[o.target])==null?void 0:A.position),!l&&(o.direction.x!==0||o.direction.y!==0)&&(l={x:o.position.x+o.direction.x*Gf*2,y:o.position.y+o.direction.y*Gf*2}),!l)return{nextState:ut,data:{...t,enteredAt:s.gameState.time,previousState:Vo}};const{width:c,height:d}=s.gameState.mapDimensions,u=q(o.position,l,c,d);if(u<Gf)return{nextState:ut,data:{...t,enteredAt:s.gameState.time,previousState:Vo}};const h=Xe(o.position,l,c,d),p=bt(h);if(u>F0){const v=y0(p,-_f),I=y0(p,_f),S=[p,v,I],E=S.map((w,C)=>{const R=hi(o.position,It(w,F0)),b={x:(R.x%c+c)%c,y:(R.y%d+d)%d},M=sy(s.gameState.soilDepletion,b,c,d,H0),F=Math.cos(C===0?0:_f);return M*F});let _=0;for(let w=1;w<E.length;w++)E[w]>E[_]&&(_=w);o.direction=S[_]}else o.direction=p;const y=sy(s.gameState.soilDepletion,o.position,c,d,H0);return o.acceleration=HA(o,y),{nextState:Vo,data:t}}onExit(t){const{entity:i}=t;i.acceleration=0}}const G_=new U_,x_={id:Sa,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction!=="eating"?{nextState:ut,data:{...e,enteredAt:o.gameState.time,previousState:Sa}}:(i.food.length>0&&(!i.eatingCooldownTime||o.gameState.time>=i.eatingCooldownTime)&&i.hunger>Eo&&(i.hunger=Math.max(0,i.hunger-Eo),i.food.pop(),i.eatingCooldownTime=o.gameState.time+1,we(o,Ae.Eat,i.position),(!i.lastEatingEffectTime||o.gameState.time-i.lastEatingEffectTime>2)&&(be(o.gameState,ve.Eating,i.position,We,i.id),i.lastEatingEffectTime=o.gameState.time)),i.hunger<=0||i.food.length<=0?{nextState:ut,data:{...e,enteredAt:o.gameState.time,previousState:Sa}}:{nextState:Sa,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class $_{constructor(){Ht(this,"id",Is)}update(t,i){return i.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:i.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const W_=new $_,Y_={id:ka,update:(e,t)=>{const{entity:i}=t;return i.activeAction!=="depositing"?{nextState:ut,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:ka}}:{nextState:ka,data:e}},onEnter:(e,t)=>{const{entity:i}=e;return i.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},z_={id:Da,update:(e,t)=>{const{entity:i}=t;return i.activeAction!=="retrieving"?{nextState:ut,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Da}}:{nextState:Da,data:e}},onEnter:(e,t)=>{const{entity:i}=e;return i.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},j_=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),X_=(e,t)=>{const{entity:i,updateContext:o}=t,{gameState:s}=o;if(s.time<(e.procreationEndTime||0))return{nextState:Ko,data:e};const l=s.entities.entities[e.partnerId];if(l&&l.type==="human"&&!l.isPregnant&&i.hunger<Bn&&l.hunger<Bn&&!i.procreationCooldown&&!l.procreationCooldown){const c=i.gender==="female"?i:l.gender==="female"?l:void 0,d=i.gender==="male"?i:l.gender==="male"?l:void 0;c&&d&&(c.isPregnant=!0,c.gestationTime=Fw,c.pregnancyFatherId=d.id,i.procreationCooldown=L0,l.procreationCooldown=L0,we(o,Ae.Procreate,c.position))}return i.activeAction="idle",l&&(l.activeAction="idle"),{nextState:ut,data:{...e,enteredAt:s.time,previousState:Ko}}},V_={id:Ko,onEnter:j_,update:X_},q_={id:Co,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var l;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:ut,data:{...e}};const i=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!i)return t.entity.activeAction="idle",{nextState:ut,data:{...e}};const o=q(t.entity.position,i.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Xe(t.entity.position,i.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=bt(s),o<=wo||o<=hn&&(((l=t.entity.attackCooldown)==null?void 0:l.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=HA(t.entity),{nextState:Co,data:e}}},Z_={id:Oc,update:(e,t)=>{const{entity:i,updateContext:o}=t,{gameState:s}=o;if(s.time-e.enteredAt>=vw){const c=i.food.filter(u=>u.type===Qn.Berry).length,d=ur(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(c>=sr&&!d){for(let u=0;u<sr;u++){const h=i.food.findIndex(p=>p.type===Qn.Berry);h>-1&&i.food.splice(h,1)}el(s.entities,e.plantingSpot,s.time),J1(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return i.activeAction="idle",{nextState:ut,data:{...e,enteredAt:s.time,previousState:Oc}}}return{nextState:Oc,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class K_{constructor(){Ht(this,"id",rp)}update(t,i){const{entity:o,updateContext:s}=i;return o.activeAction!=="chopping"||o.heldItem?{nextState:ut,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const Q_=new K_,J_=[L_,G_,x_,W_,Y_,z_,V_,q_,Z_,Q_],Xn="preyIdle",mo="preyMoving",Ta="preyGrazing",Ea="preyProcreating",eP={id:Xn,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="moving"?{nextState:mo,data:{...e,enteredAt:o.gameState.time,previousState:Xn,target:i.target}}:i.activeAction==="grazing"?{nextState:Ta,data:{...e,enteredAt:o.gameState.time,previousState:Xn}}:i.activeAction==="procreating"?{nextState:Ea,data:{...e,enteredAt:o.gameState.time,previousState:Xn}}:{nextState:Xn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},FA=12,Au=120,fy=50,tP=12,LA=30,nP=2,hs=50,iP=100,UA=2,oP=.9,rP=1,sP=50,aP=.5,GA=20,Iu=140,hy=40,lP=12,xA=40,cP=3,ps=60,pr=40,uP=50,$A=320,WA=25,dP=60,YA=2,fP=90,hP=.7,pP=1,zA=3,sp=80,jA=10,Su=80,XA=40,VA=2,qc=30,Zr=20,er=40,Kr=24,tr=48,Qr=12,nr=40,Jr=20,ir=60,es=.75,vo=2.5,ts=.25,Ao=2,qA=4;function gP(e){let t=tP;return e.isAdult||(t*=.7),e.hunger>=sP&&(t*=aP),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function mP(e,t){const i=e>>16&255,o=e>>8&255,s=e&255,l=t>>16&255,c=t>>8&255,d=t&255;let u=Math.floor((i+l)/2),h=Math.floor((o+c)/2),p=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|h<<8|p}function Ya(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,i=Math.floor(Math.random()*60)+20;return e<<16|t<<8|i}const xf=10;class yP{constructor(){Ht(this,"id",mo)}update(t,i){var u;const{entity:o,updateContext:s}=i;if(o.activeAction!=="moving")return{nextState:Xn,data:{...t,enteredAt:s.gameState.time,previousState:mo}};let l;if(typeof o.target=="object"?l=o.target:typeof o.target=="number"&&(l=(u=i.updateContext.gameState.entities.entities[o.target])==null?void 0:u.position),!l&&(o.direction.x!==0||o.direction.y!==0)&&(l={x:o.position.x+o.direction.x*xf*2,y:o.position.y+o.direction.y*xf*2}),!l)return{nextState:Xn,data:{...t,enteredAt:s.gameState.time,previousState:mo}};const c=Xe(o.position,l,i.updateContext.gameState.mapDimensions.width,i.updateContext.gameState.mapDimensions.height);return o.direction=bt(c),o.acceleration=gP(o),q(o.position,l,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<xf?{nextState:Xn,data:{...t,enteredAt:s.gameState.time,previousState:mo}}:{nextState:mo,data:t}}onExit(t){const{entity:i}=t;i.acceleration=0}onEnter(t,i){return{...i,enteredAt:t.updateContext.gameState.time}}}const vP=new yP,AP={id:Ta,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="moving"?{nextState:mo,data:{...e,enteredAt:o.gameState.time,previousState:Ta,target:i.target}}:i.activeAction!=="grazing"?{nextState:Xn,data:{...e,enteredAt:o.gameState.time,previousState:Ta}}:{nextState:Ta,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},IP={id:Ea,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="moving"?{nextState:mo,data:{...e,enteredAt:o.gameState.time,previousState:Ea,target:i.target}}:i.activeAction!=="procreating"?{nextState:Xn,data:{...e,enteredAt:o.gameState.time,previousState:Ea}}:{nextState:Ea,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},SP=[eP,vP,AP,IP],nn="predatorIdle",po="predatorMoving",Di="predatorAttacking",Xr="predatorProcreating",or="predatorEating",TP={id:nn,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="eating"?{nextState:or,data:{...e,enteredAt:o.gameState.time,previousState:nn,preyId:i.attackTargetId,eatingStartTime:o.gameState.time}}:i.activeAction==="attacking"&&i.attackTargetId?{nextState:Di,data:{...e,enteredAt:o.gameState.time,previousState:nn,attackTargetId:i.attackTargetId,attackStartTime:o.gameState.time}}:i.activeAction==="moving"?{nextState:po,data:{...e,enteredAt:o.gameState.time,previousState:nn,target:i.target}}:i.activeAction==="procreating"?{nextState:Xr,data:{...e,enteredAt:o.gameState.time,previousState:nn}}:{nextState:nn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function ZA(e){let t=lP;return e.hunger>=fP&&(t*=hP),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function EP(e,t){const i=e>>16&255,o=e>>8&255,s=e&255,l=t>>16&255,c=t>>8&255,d=t&255;let u=Math.floor((i+l)/2),h=Math.floor((o+c)/2),p=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|h<<8|p}function za(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,i=Math.floor(Math.random()*40)+20;return e<<16|t<<8|i}const $f=12;class wP{constructor(){Ht(this,"id",po)}update(t,i){var u;const{entity:o,updateContext:s}=i;if(o.activeAction==="eating")return{nextState:or,data:{...t,enteredAt:s.gameState.time,previousState:po,preyId:o.attackTargetId,eatingStartTime:s.gameState.time}};if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:Di,data:{...t,enteredAt:s.gameState.time,previousState:po,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:nn,data:{...t,enteredAt:s.gameState.time,previousState:po}};let l;if(typeof o.target=="object"?l=o.target:typeof o.target=="number"&&(l=(u=i.updateContext.gameState.entities.entities[o.target])==null?void 0:u.position),!l&&(o.direction.x!==0||o.direction.y!==0)&&(l={x:o.position.x+o.direction.x*$f*2,y:o.position.y+o.direction.y*$f*2}),!l)return{nextState:nn,data:{...t,enteredAt:s.gameState.time,previousState:po}};const c=Xe(o.position,l,i.updateContext.gameState.mapDimensions.width,i.updateContext.gameState.mapDimensions.height);return o.direction=bt(c),o.acceleration=ZA(o),q(o.position,l,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<$f?{nextState:nn,data:{...t,enteredAt:s.gameState.time,previousState:po}}:{nextState:po,data:t}}onExit(t){const{entity:i}=t;i.acceleration=0}onEnter(t,i){return{...i,enteredAt:t.updateContext.gameState.time}}}const CP=new wP,_P={id:Di,update:(e,t)=>{const{entity:i,updateContext:o}=t;if(i.activeAction==="eating")return{nextState:or,data:{...e,enteredAt:o.gameState.time,previousState:Di,preyId:i.attackTargetId,eatingStartTime:o.gameState.time}};if(i.activeAction!=="attacking"||!i.attackTargetId)return i.activeAction="idle",{nextState:nn,data:{...e,enteredAt:o.gameState.time,previousState:Di}};const s=o.gameState.entities.entities[i.attackTargetId];if(!s)return i.activeAction="idle",{nextState:nn,data:{...e,enteredAt:o.gameState.time,previousState:Di}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return i.activeAction="idle",{nextState:nn,data:{...e,enteredAt:o.gameState.time,previousState:Di}};const c=q(i.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height),d=Xe(i.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height);return i.direction=bt(d),c>pr?i.acceleration=ZA(i):i.acceleration=0,{nextState:Di,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},PP={id:Xr,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction==="eating"?{nextState:or,data:{...e,enteredAt:o.gameState.time,previousState:Xr,preyId:i.attackTargetId,eatingStartTime:o.gameState.time}}:i.activeAction==="attacking"&&i.attackTargetId?{nextState:Di,data:{...e,enteredAt:o.gameState.time,previousState:Xr,attackTargetId:i.attackTargetId,attackStartTime:o.gameState.time}}:i.activeAction!=="procreating"?{nextState:nn,data:{...e,enteredAt:o.gameState.time,previousState:Xr}}:{nextState:Xr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},RP={id:or,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.activeAction!=="eating"?{nextState:nn,data:{...e,enteredAt:o.gameState.time,previousState:or}}:{nextState:or,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},MP=[TP,CP,_P,PP,RP],kP=24*30*10,_o=24*5,DP=48,OP=72,Qa=20,bP="#3b2016",NP="#5c3a21",BP="#376d31",HP="#76a331",FP="#a6c44a",LP="rgba(0, 0, 0, 0.25)",UP=60,GP=24*7,xP=.1,py=1,Tu=5,$P={id:Vn,update:(e,t)=>{const{entity:i,updateContext:o}=t;return i.age>=i.lifespan?{nextState:cr,data:{enteredAt:o.gameState.time,previousState:Vn}}:i.age>=_o?{nextState:Hn,data:{enteredAt:o.gameState.time,previousState:Vn}}:{nextState:Vn,data:e}}},WP={id:Hn,update:(e,t)=>{const{entity:i,updateContext:o}=t,s=o.deltaTime*(Dt/Gt);return i.age>=i.lifespan?{nextState:cr,data:{...e,enteredAt:o.gameState.time,previousState:Hn}}:(i.timeSinceLastSpreadAttempt+=s,i.timeSinceLastSpreadAttempt>=GP&&(i.timeSinceLastSpreadAttempt=0,Math.random()<xP)?{nextState:gi,data:{...e,enteredAt:o.gameState.time,previousState:Hn}}:{nextState:Hn,data:e})}},YP={id:gi,update:(e,t)=>{const{entity:i,updateContext:o}=t,{gameState:s}=o;if(i.age>=i.lifespan)return{nextState:cr,data:{...e,enteredAt:s.time,previousState:gi}};const l=Xv(i.position,i.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Gi(l,s,25)||Xa(s.entities,l,s.time),{nextState:Hn,data:{...e,enteredAt:s.time,previousState:gi}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},zP={id:Vt,update:(e,t)=>{const{updateContext:i}=t;return i.gameState.time-e.enteredAt>=DP?{nextState:Ui,data:{enteredAt:i.gameState.time,previousState:Vt}}:{nextState:Vt,data:e}}},jP={id:Ui,update:(e,t)=>{const{updateContext:i}=t;return i.gameState.time-e.enteredAt>=OP?{nextState:cr,data:{enteredAt:i.gameState.time,previousState:Ui}}:{nextState:Ui,data:e}}},XP={id:cr,update:e=>({nextState:cr,data:e}),onEnter:(e,t)=>(yr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},VP=[$P,WP,YP,zP,jP,XP],gy=[...F_,...J_,...SP,...MP,...VP];function qP(e,t,i){const o=lw(e,gy);if(!o)return uw(e),[e,t];const{nextState:s,data:l}=o.update(t,i);return cw(e,s)?[s,aw(o,s,l,i,gy)]:[s,l]}function ap(e,t){return`${e},${t}`}const my=Dt*10;function KA(e){return e%my/my}function QA(e){const t=KA(e);return(Math.cos(t*2*Math.PI)+1)/2}function ZP(e){const t=KA(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function JA(e,t,i){const o=(e.x%t+t)%t,s=(e.y%i+i)%i;return{gridX:Math.floor(o/Oi),gridY:Math.floor(s/Oi)}}function ja(e,t,i,o,s){const{gridX:l,gridY:c}=JA(t,o,s),d=ap(l,c),u=e.sectors[d],h=u?u.currentTemperature:tA,y=(QA(i)*2-1)*BC;return h+y}function KP(e){const{sectors:t}=e.temperature,{width:i,height:o}=e.mapDimensions,s=Math.ceil(i/Oi),l=Math.ceil(o/Oi);for(const d in t){const u=t[d];u.currentTemperature=u.baseTemperature}const c=Math.ceil(_a/Oi);Object.values(e.entities.entities).forEach(d=>{if(d.type==="building"){const u=d;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const h=JA(u.position,i,o);for(let p=-c;p<=c;p++)for(let y=-c;y<=c;y++){const A=(h.gridX+y+s)%s,v=(h.gridY+p+l)%l,I=ap(A,v),S=t[I];if(S){const E={x:(A+.5)*Oi,y:(v+.5)*Oi},_=q(u.position,E,i,o);if(_<_a){const w=kC*(1-_/_a);S.currentTemperature+=w}}}}}})}function eI(e,t){const i={},o=Math.ceil(e/Oi),s=Math.ceil(t/Oi);for(let l=0;l<s;l++)for(let c=0;c<o;c++){const d=ap(c,l);let u=tA;const h=l/s*10-5;u+=h,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),i[d]={baseTemperature:u,currentTemperature:u}}return{sectors:i}}function QP(e,t,i){var d;const{gameState:o}=t,s=i*(Dt/Gt);e.isAdult=e.age>=Fh;const l=ja(o.temperature,e.position,o.time,o.mapDimensions.width,o.mapDimensions.height);if(l<Jo){const u=(Jo-l)*MC*s;e.hitpoints-=u}if(e.movementSlowdown&&o.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<Xt){const u=1-e.hunger/Xt*Xw,h=jw*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+h)}if(e.hunger+=i*(sa/(Dt/Gt)),e.hunger>=Xt)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-Eo);else{const u=Vw*s;e.hitpoints-=u}if(e.age+=i/lu,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=i*((sa*Lw-sa)/(Dt/Gt)),(!e.lastPregnantEffectTime||o.time-e.lastPregnantEffectTime>xa*3)&&(be(o,ve.Pregnant,e.position,xa,e.id),e.lastPregnantEffectTime=o.time),e.gestationTime<=0&&(rk(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===As&&(e.radius=mt):e.hunger+=i*((sa*Uw-sa)/(Dt/Gt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const h=o.entities.entities[e.motherId];h&&u.push(h)}if(e.fatherId){const h=o.entities.entities[e.fatherId];h&&u.push(h)}for(const h of u)if(h.age>=Lh&&h.hunger>=xw&&q(e.position,h.position,o.mapDimensions.width,o.mapDimensions.height)<=$w){e.food.pop(),h.hunger=Math.max(0,h.hunger-Eo),e.feedParentCooldownTime=Ww;break}}let c;if(e.hitpoints<=0?l<Jo?c="hypothermia":e.hunger>=Xt?c="hunger":c="killed":e.age>=e.maxAge&&(c="oldAge"),c){if(e.leaderId===e.id){const u=fs(xi(o,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeRole=Fe.Leader,u.tribeControl=e.tribeControl??{roleWeights:{[Fe.Leader]:0,[Fe.Gatherer]:2,[Fe.Planter]:2,[Fe.Hunter]:2,[Fe.Mover]:2,[Fe.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}};const h=o;Wc(o,e.id,u.id);const p=h.search.human.byProperty("leaderId",e.id);for(const v of p)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const y=h.search.building.byProperty("ownerId",e.id);for(const v of y)v.ownerId=u.id;for(const v of Xc(u,o))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const A=gu(o).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of A){const I=o.entities.entities[v.leaderId];if((d=I==null?void 0:I.tribeControl)!=null&&d.diplomacy){const S=I.tribeControl.diplomacy[e.id];S!==void 0&&(I.tribeControl.diplomacy[u.id]=S,delete I.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=fs(xi(o,e));u?(u.isPlayer=!0,o.generationCount++):(o.gameOver=!0,o.causeOfGameOver=c,Ga(o,{identifier:"no_heir",type:ar.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}nk(o.entities,e.position,e.gender,e.age,e.radius,e.id,o.time,e.food,e.hunger),yr(o.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=i*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function JP(e,t){const i=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,i/Yw);const o=Math.floor(jv*(1-e.decayProgress));e.food.length>o&&e.food.splice(o),e.decayProgress>=1&&e.food.length<=0&&yr(t.gameState.entities,e.id)}function eR(e,t,i){const o=i*(Dt/Gt);e.age+=i/lu,e.isAdult=e.age>=UA;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=Au){const c=qA*o;e.hitpoints-=c}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const c={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};c.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,c.x)),c.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,c.y));const d=Math.random()<.5?"male":"female",u=e,h=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let p;if(h)p=mP(u.geneCode,h.geneCode);else{p=u.geneCode;const y=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+y))}gs(t.gameState.entities,c,d,0,LA*.5,p,e.id,e.fatherId,e.aiType),be(t.gameState,ve.Procreation,e.position,xa,e.id),we(t,Ae.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=o,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let l=!1;e.hitpoints<=0&&(l=!0),e.age>=FA&&(l=!0),l&&(ik(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),yr(t.gameState.entities,e.id))}function tR(e,t,i){const o=i*(Dt/Gt);e.age+=i/lu,e.isAdult=e.age>=zA;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=Iu){const c=qA*o;e.hitpoints-=c}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const c={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};c.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,c.x)),c.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,c.y));const d=Math.random()<.5?"male":"female",u=e,h=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let p;if(h)p=EP(u.geneCode,h.geneCode);else{p=u.geneCode;const y=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+y))}ms(t.gameState.entities,c,d,0,xA*.6,p,e.id,e.pregnancyFatherId,e.aiType),be(t.gameState,ve.Procreation,e.position,xa,e.id),we(t,Ae.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=o,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=o,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let l=!1;e.hitpoints<=0&&(l=!0),e.age>=GA&&(l=!0),l&&(ok(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),yr(t.gameState.entities,e.id))}var Po=(e=>(e[e.TaskBased=0]="TaskBased",e))(Po||{}),W=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e[e.HumanDiplomacy=25]="HumanDiplomacy",e[e.AnimalFlee=26]="AnimalFlee",e[e.AnimalGraze=27]="AnimalGraze",e[e.AnimalHunt=28]="AnimalHunt",e[e.AnimalAttack=29]="AnimalAttack",e[e.AnimalProcreate=30]="AnimalProcreate",e[e.AnimalWander=31]="AnimalWander",e[e.AnimalFeedChild=32]="AnimalFeedChild",e[e.AnimalSeekFoodFromParent=33]="AnimalSeekFoodFromParent",e[e.AnimalHerd=34]="AnimalHerd",e[e.AnimalTerritorial=35]="AnimalTerritorial",e[e.AnimalPack=36]="AnimalPack",e))(W||{}),O=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(O||{});const Ct=3,nR=250,tI=.8,iR=100,oR=5,vh="currentAiTask",nI="lastTaskResult",iI="lastTaskMessage",Ah="taskHistory";function Zc({aiBlackboard:e}){return De.get(e,vh)||null}function Li({aiBlackboard:e},t){t?De.set(e,vh,t):De.delete(e,vh)}function rR(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function sR(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function oI(e,t,i,o){const s=t.type===W.Wait?aR:o[t.type];let l;s&&s.executor?l=s.executor(t,e,i):l=O.Failure;const[c,d,u]=sR(l);if(De.set(e.aiBlackboard,nI,c),De.set(e.aiBlackboard,iI,d),c!==O.Running){const h=De.get(e.aiBlackboard,Ah)||[];if(h.unshift({type:t.type,result:c,completedAtTick:i.gameState.time,message:d}),h.length>5&&h.pop(),De.set(e.aiBlackboard,Ah,h),delete i.gameState.tasks[t.id],Li(e,null),c===O.Success){const p=u||t.nextTask;p&&(i.gameState.tasks[p.id]=p,p.claimedByEntityId=e.id,Li(e,p.id))}}return c}function Ke(e){return 1/(1+e/nR)}function Ja(e,t,i){for(let o=0;o<i.length;o++){const s=i[o];if(!s.producer)continue;const l=s.producer(e,t);for(const c in l){const d=l[c],u=t.gameState.tasks[c];t.gameState.tasks[c]=d,u&&(t.gameState.tasks[c].claimedByEntityId=u.claimedByEntityId)}}}const vc=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:W.Wait,creatorEntityId:e.id,validUntilTime:t+Ct}),aR={type:W.Wait,executor:(e,t,i)=>i.gameState.time>=e.validUntilTime-1?[O.Success,"Wait complete"]:[O.Running,"Waiting"]};function rt(e){const{type:t,requireAdult:i,autopilotBehavior:o,producer:s,scorer:l,executor:c}=e;return{type:t,producer:s,scorer:l?(h,p,y)=>i&&!h.isAdult||o&&h.isPlayer&&!y.gameState.autopilotControls.behaviors[o]?null:l(h,p,y):void 0,executor:c?(h,p,y)=>i&&!p.isAdult||o&&p.isPlayer&&!y.gameState.autopilotControls.behaviors[o]?O.Failure:y.gameState.autopilotControls.activeAutopilotAction&&h.type!==W.HumanPlayerCommand&&p.isPlayer?[O.Failure,"Autopilot action active",{id:`player-command-${p.id}`,type:W.HumanPlayerCommand,position:p.position,creatorEntityId:p.id,validUntilTime:y.gameState.time+Ct}]:c(h,p,y):void 0}}const lR=rt({type:W.HumanEat,requireAdult:!1,producer:(e,t)=>{const i={};if(e.hunger>ch&&e.food.length>0){const o=`eat-task-${e.id}`;i[o]={id:o,type:W.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/Xt,executor:(e,t)=>e.target!==t.id?O.Empty:t.hunger<ch?O.Success:t.food.length===0?O.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",O.Running)}),cR=rt({type:W.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="berryBush"||o.food.length===0||e.leaderId&&!hr(o.position,e.leaderId,i.gameState)||e.food.length>=e.maxFood)return null;const s=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=Ke(s),c=e.hunger/Xt;return(l+c)/2},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=i.gameState.entities.entities[e.target];return!o||o.type!=="berryBush"||o.food.length===0||t.food.length>=t.maxFood?[O.Success,"Bush is empty"]:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>je?(t.target=o.position,t.activeAction="moving",[O.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[O.Running,"Gathering berries"])}}),uR=rt({type:W.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="corpse"||o.food.length===0||e.leaderId&&!hr(o.position,e.leaderId,i.gameState)||e.food.length>=e.maxFood)return null;const s=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=Ke(s),c=e.hunger/Xt;return(l+c)/2},executor:(e,t,i)=>{if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];return!o||o.type!=="corpse"||o.food.length===0||t.food.length>=t.maxFood?O.Success:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>je?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",O.Running)}}),dR=rt({type:W.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const i={};if(e.gender==="female"&&!e.isPregnant&&e.age>=xc&&e.age<=Hh&&e.hunger<Bn&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;i[s]={id:s,type:W.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i},scorer:(e,t,i)=>{if(e.gender!=="male"||e.age<xc||e.hunger>=Bn||(e.procreationCooldown||0)>0)return null;const o=i.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="female"||o.isPregnant||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ke(s)*tI},executor:(e,t,i)=>{const o=i.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="female"||t.hunger>=Bn?O.Failure:o.isPregnant?O.Success:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>je?(t.target=o.position,t.activeAction="moving",t.direction=Mt(t.position,o.position,i.gameState.mapDimensions),O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",O.Running)}}),fR=rt({type:W.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const i={};if(e.gender==="male"&&e.age>=xc&&e.hunger<Bn&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;i[s]={id:s,type:W.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i},scorer:(e,t,i)=>{if(e.gender!=="female"||e.isPregnant||e.age<xc||e.age>Hh||e.hunger>=Bn||(e.procreationCooldown||0)>0)return null;const o=i.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="male"||o.hunger>=Bn||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ke(s)*tI},executor:(e,t,i)=>{const o=i.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="male"||o.hunger>=Bn?O.Failure:t.isPregnant?O.Success:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>je?(t.target=o.position,t.activeAction="moving",t.direction=Mt(t.position,o.position,i.gameState.mapDimensions),O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",O.Running)}}),hR=rt({type:W.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const i={};if(!e.isAdult&&e.hunger>=U0){const o=`feed-child-task-${e.id}`;i[o]={id:o,type:W.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i},scorer:(e,t,i)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const o=i.gameState.entities.entities[t.creatorEntityId];if(!o||o.isAdult||!(o.motherId===e.id||o.fatherId===e.id))return null;const l=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=Ke(l),d=o.hunger/Xt;return(c+d)/2},executor:(e,t,i)=>{const o=i.gameState.entities.entities[e.creatorEntityId];return!o||o.isAdult||t.food.length===0?O.Failure:o.hunger<U0/2?O.Success:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>zv?(t.target=o.position,t.activeAction="moving",t.direction=Mt(t.position,o.position,i.gameState.mapDimensions),O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="feeding",O.Running)}});function lp(e,t,i){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const o=q(e.position,t.target,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ke(o)}function pR(e,t,i){if(e.leaderId!==t.creatorEntityId||!e.leaderId)return null;const o=t.target;if(!o)return null;const{width:s,height:l}=i.gameState.mapDimensions,c=q(e.position,o,s,l),d=Ke(c)*.5,u=pi(e.leaderId,i.gameState),h=q(u,o,s,l),p=Math.max(0,1-h/800)*.25,y=Math.ceil(s/Ce),A=Math.ceil(l/Ce),v=TC(o);let I=0;for(let E=-1;E<=1;E++)for(let _=-1;_<=1;_++){if(_===0&&E===0)continue;const w=((v.x+_)%y+y)%y,C=((v.y+E)%A+A)%A;i.gameState.terrainOwnership[C*y+w]===e.leaderId&&I++}const S=I/8*.25;return d+p+S}function Eu(e,t,i,o,s){const l=e.target;return q(t.position,l,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>s?(t.target=l,t.activeAction="moving",O.Running):(Xh(l,o,t.leaderId,i.gameState),O.Success)}const gR=rt({type:W.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:lp,executor:(e,t,i)=>Eu(e,t,i,fe.StorageSpot,zh)}),mR=rt({type:W.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:lp,executor:(e,t,i)=>Eu(e,t,i,fe.Bonfire,zh)}),yR=rt({type:W.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:lp,executor:(e,t,i)=>Eu(e,t,i,fe.PlantingZone,zh)}),vR=rt({type:W.HumanPlaceBorderPost,scorer:pR,requireAdult:!0,autopilotBehavior:"build",executor:(e,t,i)=>Eu(e,t,i,fe.BorderPost,yC)}),AR=rt({type:W.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,i)=>{if(e.food.filter(u=>u.type===Qn.Berry).length<sr)return null;const s=i.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const l=i.gameState.entities.entities[s.ownerId];if(!l||l.leaderId!==e.leaderId)return null;const c=t.target,d=q(e.position,c,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ke(d)},executor:(e,t,i)=>{if(t.food.filter(d=>d.type===Qn.Berry).length<sr)return t.activeAction="idle",O.Failure;const s=e.target;return q(t.position,s,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>$v?(t.target=s,t.activeAction="moving",O.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(i.gameState.entities.entities).find(d=>d.type==="berryBush"&&q(d.position,s,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<oR)?(t.activeAction="idle",O.Success):O.Running)}}),IR=rt({type:W.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{var h;if(typeof t.target!="number")return null;const o=e.food.length>0,s=((h=e.heldItem)==null?void 0:h.type)===Ot.Wood;if(!o&&!s)return null;const l=i.gameState.entities.entities[t.target];if(!l||l.type!=="building"||l.buildingType!==fe.StorageSpot||e.leaderId!==l.ownerId||l.storedItems.length>=l.storageCapacity)return null;const c=q(e.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),d=Ke(c),u=s?.6:e.food.length/e.maxFood*.4;return(d+u)/2},executor:(e,t,i)=>{var d;if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==fe.StorageSpot)return O.Failure;const s=t.food.length>0,l=((d=t.heldItem)==null?void 0:d.type)===Ot.Wood;return!s&&!l?O.Success:o.storedItems.length>=o.storageCapacity?O.Failure:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>je?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",O.Running)}}),SR=rt({type:W.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{var d;if(typeof t.target!="number"||!(((d=e.heldItem)==null?void 0:d.type)===Ot.Wood))return null;const s=i.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==fe.Bonfire||e.leaderId!==s.ownerId)return null;const l=s.storageCapacity||fh;if(s.storedItems.length>=l)return null;const c=q(e.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return Ke(c)},executor:(e,t,i)=>{var d;if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==fe.Bonfire)return O.Failure;if(!(((d=t.heldItem)==null?void 0:d.type)===Ot.Wood))return O.Success;const l=o.storageCapacity||fh;return o.storedItems.length>=l?O.Failure:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>je?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",O.Running)}}),TR=rt({type:W.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,i)=>{if(e.hunger<=ch||e.food.length>0||typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="building"||o.buildingType!==fe.StorageSpot||o.ownerId!==e.leaderId||!o.storedItems.some(u=>u.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=Ke(s),c=e.hunger/Xt,d=1-e.food.length/e.maxFood;return(l+c+d)/3},executor:(e,t,i)=>{if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];return!o||o.type!=="building"||o.buildingType!==fe.StorageSpot||!o.storedItems.some(l=>l.item.itemType==="food")?O.Failure:t.food.length>0?O.Success:t.food.length>=t.maxFood?O.Failure:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>je?(t.target=o.position,t.activeAction="moving",O.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="retrieving",O.Running)}}),ER=2;function gr(e,t){if(e.leaderId){const i=t.entities.entities[e.leaderId];if(i&&i.aiBlackboard)return i}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.aiBlackboard)return i}return null}const wR=rt({type:W.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="tree")return null;const[s]=o.stateMachine??[];if(!(s===Vn||s===Hn||s===gi)||e.leaderId&&!hr(o.position,e.leaderId,i.gameState)||e.heldItem||e.food.length===0)return null;const c=gr(e,i.gameState);if(!c)return null;const d=SA(c.id,i.gameState);if(d<=0)return null;const u=j1(c.id,i.gameState);if(u>=d)return null;const h=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),p=Ke(h),y=Math.min(1,(d-u)/10);return(p+y)/2},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=i.gameState.entities.entities[e.target];if(!o||o.type!=="tree")return[O.Failure,"Tree not found"];const[s]=o.stateMachine??[];if(s===Vt){const d={id:`gather-wood-${t.id}-${i.gameState.time}`,type:W.HumanGatherWood,position:o.position,creatorEntityId:t.id,target:o.id,validUntilTime:i.gameState.time+1};return[O.Success,"Tree fell!",d]}return s===Vn||s===Hn||s===gi?t.heldItem?[O.Failure,"Hands full"]:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>Wv?(t.target=o.position,t.activeAction="moving",[O.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="chopping",[O.Running,"Chopping tree"]):[O.Failure,"Tree is not standing"]}}),CR=rt({type:W.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="tree"||o.wood.length===0)return null;const[s]=o.stateMachine??[];if(s!==Vt||e.leaderId&&!hr(o.position,e.leaderId,i.gameState)||e.heldItem)return null;const l=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=Ke(l),d=gr(e,i.gameState),u=d?SA(d.id,i.gameState):0,h=Math.min(1,u/10);return(c+h)/2},executor:(e,t,i)=>{var l;if(typeof e.target!="number")return[O.Failure,"Invalid target"];if(((l=t.heldItem)==null?void 0:l.type)==="wood")return[O.Success,"Already holding wood"];const o=i.gameState.entities.entities[e.target];return!o||o.type!=="tree"||o.wood.length===0||t.heldItem?[O.Failure,"Tree gone, empty, or human full"]:q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>je?(t.target=o.position,t.activeAction="moving",[O.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[O.Running,"Gathering wood"])}}),_R=rt({type:W.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="prey"||o.hitpoints<=0||e.leaderId&&!hr(o.position,e.leaderId,i.gameState))return null;const s=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);if(e.leaderId){const d=pi(e.leaderId,i.gameState);if(q(e.position,d,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>aC)return null}const l=Ke(s),c=e.hunger/Xt;return(l+c)/2*.6},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=i.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[O.Success,"Prey is dead"];const s=q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>je?[O.Running,"Chasing prey"]:[O.Running,"Attacking prey"]}}),PR=rt({type:W.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,i)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="predator"||o.hitpoints<=0||e.leaderId&&!hr(o.position,e.leaderId,i.gameState))return null;const s=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return(Ke(s)+.3)/1.3},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[O.Failure,"Too injured to continue"];const o=i.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[O.Success,"Predator eliminated"];const s=q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>je?[O.Running,"Chasing predator"]:[O.Running,"Fighting predator"]}});function RR(e,t,i,o){var u;const s=e.entities.entities[i.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,O.Failure;const l=q(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?hn:wo;return l<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,O.Success):(t.activeAction="moving",t.target=s.id,t.direction=Mt(t.position,s.position,e.mapDimensions),O.Running)}const MR=rt({type:W.HumanPlayerCommand,producer:(e,t)=>{const i={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const o=`player-command-${e.id}`;i[o]={id:o,type:W.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+Ct}}return i},scorer:(e,t)=>t.type===W.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,i)=>{var l;const{gameState:o}=i,s=o.autopilotControls.activeAutopilotAction;if(!s)return[O.Failure,"No active autopilot action"];switch(s.action){case ue.AutopilotMove:{if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,O.Failure;const c=s.position;return q(t.position,c,o.mapDimensions.width,o.mapDimensions.height)<uC?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[O.Success,"Reached target position"]):(t.activeAction="moving",t.target=c,t.direction=Mt(t.position,c,o.mapDimensions),[O.Running,"Moving to target"])}case ue.AutopilotGather:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Target entity not found"];let d=!1;if(c.type==="berryBush")d=c.food.length===0;else if(c.type==="corpse")d=c.food.length===0;else if(c.type==="tree"){const h=c;d=h.stateMachine[0]!==Vt||h.wood.length===0}else return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target type"];return d?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Target is depleted"]):q(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)>$v?(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"At target, gathering",vc(t,o.time)])}case ue.AutopilotChop:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.type!=="tree")return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target entity"];const[d]=c.stateMachine??[];return!(d===Vn||d===Hn||d===gi)||t.heldItem?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Tree is not standing or human is holding an item"]):q(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)>Wv?(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"At tree, chopping",vc(t,o.time)])}case ue.AutopilotAttack:return"targetEntityId"in s?RR(o,t,s):(o.autopilotControls.activeAutopilotAction=void 0,O.Failure);case ue.AutopilotProcreate:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.type!=="human"||!vs(t,c,o))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target for procreation"];const d=q(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height);return c.isPregnant||t.isPregnant?t.gender==="male"&&c.pregnancyFatherId!==t.id?[O.Failure,"Target is pregnant by another"]:[O.Success,"Procreation conditions met"]:d<=Pf?(t.activeAction="procreating",o.autopilotControls.activeAutopilotAction=void 0,[O.Running,"Procreating"]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to procreation target"])}case ue.AutopilotPlant:{if(t.activeAction==="planting")return[O.Running,"Planting"];if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No position specified"];const c=s.position;return Gi(c,o,au,t.id)?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Position is occupied"]):q(t.position,c,o.mapDimensions.width,o.mapDimensions.height)<=Pf?(t.activeAction="planting",t.target=c,o.autopilotControls.activeAutopilotAction=void 0,o.hasPlayerPlantedBush=!0,[O.Running,"Planting"]):(t.activeAction="moving",t.target=c,t.direction=Mt(t.position,c,o.mapDimensions),[O.Running,"Moving to planting target"])}case ue.AutopilotFeedChild:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="human"||c.isAdult||t.food.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target for feeding child"]):q(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Pf?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[O.Success,"Feeding child"]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to feeding target"])}case ue.AutopilotDeposit:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.buildingType!==fe.StorageSpot&&c.buildingType!==fe.Bonfire||!c.isConstructed)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"];const d=c.storageCapacity??0;if(c.storedItems.length>=d)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Storage is full"];if(t.leaderId!==c.ownerId)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Human does not belong to the same tribe as the building"];const h=t.food.length>0,p=!!t.heldItem;if(c.buildingType===fe.Bonfire){if(((l=t.heldItem)==null?void 0:l.type)!==Ot.Wood)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Bonfires only accept wood"]}else if(!h&&!p)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No items to deposit"];return q(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Kn?(t.activeAction="depositing",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Depositing items",vc(t,o.time)]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to deposit target"])}case ue.AutopilotRetrieve:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.buildingType!==fe.StorageSpot||!c.isConstructed||c.storedItems.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"]):t.leaderId!==c.ownerId?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Storage is full"]):q(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Kn?(t.activeAction="retrieving",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Retrieving items",vc(t,o.time)]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to retrieve target"])}case ue.TakeOverBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!lr(t,c,o)?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Only leaders can take over buildings"]):q(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=je?(t.activeAction="takingOverBuilding",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Taking over building"]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to takeover target"])}case ue.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!lr(t,c,o)?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Only leaders can remove enemy buildings"]):q(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=je?(t.activeAction="destroyingBuilding",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[O.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=c.id,t.direction=Mt(t.position,c.position,o.mapDimensions),[O.Running,"Moving to removal target"])}case ue.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return o.autopilotControls.activeAutopilotAction=void 0,O.Failure;const c=s.position,d=s.buildingType;if(!d)return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"No building type specified"];const u=q(t.position,c,o.mapDimensions.width,o.mapDimensions.height),h=100;return u<=h?$a(c,d,t.leaderId,o,t.position,h)?(Xh(c,d,t.leaderId,o),o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[O.Success,"Building placed"]):(o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=c,t.direction=Mt(t.position,c,o.mapDimensions),[O.Running,"Moving to placement target"])}default:return o.autopilotControls.activeAutopilotAction=void 0,[O.Failure,"Unknown or unhandled action"]}}}),kR=rt({type:W.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:i}=t,o={},s=Zn(e.position.x,e.position.y,i),l=s!==null&&s!==e.leaderId&&$i(e.leaderId,s,i),c=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(l||c){const d=`attack-human-${e.id}`;o[d]={id:d,type:W.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:i.time+Ct}}return o},scorer:(e,t,i)=>{if(typeof t.target!="number")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.type!=="human"||o.hitpoints<=0||o.id===e.id||o.leaderId===e.leaderId)return null;const{gameState:s}=i,l=Za(e,o,s),c=Zn(o.position.x,o.position.y,s)===e.leaderId,d=o.activeAction==="attacking"&&o.attackTargetId!==void 0;if(!l&&!d)return null;let u=.5;const h=q(e.position,o.position,s.mapDimensions.width,s.mapDimensions.height),p=Ke(h);return c&&l&&(u+=.1),(p+u)/2},executor:(e,t,i)=>{if(typeof e.target!="number")return[O.Failure,"Invalid target"];const o=i.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[O.Success,"Target eliminated"];const s=q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>je?[O.Running,"Chasing human target"]:[O.Running,"Fighting human target"]}}),DR=rt({type:W.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,i)=>{if(typeof t.target!="number"||QA(i.gameState.time)>.5)return null;const o=i.gameState.entities.entities[t.target];if(!o||o.buildingType!==fe.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0||e.leaderId!==o.ownerId)return null;const s=ja(i.gameState.temperature,e.position,i.gameState.time,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=Jo+5;if(s>=l)return null;const c=(l-s)/15,d=(1-e.hitpoints/e.maxHitpoints)*.8,u=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),h=Ke(u);let p=(c+d+h)/2;return e.hitpoints/e.maxHitpoints<.2&&s<Jo&&(p=Math.max(p,1.2)),p},executor:(e,t,i)=>{if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];if(!o||o.buildingType!==fe.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0)return O.Failure;const s=ja(i.gameState.temperature,t.position,i.gameState.time,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=Jo+5;if(s>=l)return t.activeAction="idle",[O.Success,"Comfortable temperature reached"];const c=t.id*137%360*(Math.PI/180),d=_a*.4,u=i.gameState.mapDimensions.width,h=i.gameState.mapDimensions.height,p={x:(o.position.x+Math.cos(c)*d+u)%u,y:(o.position.y+Math.sin(c)*d+h)%h},y=q(t.position,p,u,h);return y>10?(t.activeAction="moving",t.target=p,t.direction=Mt(t.position,p,i.gameState.mapDimensions),[O.Running,`Moving to warmth spot (${y.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[O.Running,"Staying warm at bonfire"])}}),OR=rt({type:W.HumanFlee,requireAdult:!1,producer:(e,t)=>{const i={};if(e.hitpoints<e.maxHitpoints*Y0){const o=_C(e.id,t.gameState);if(o){const s=`flee-task-${e.id}`;i[s]={id:s,type:W.HumanFlee,position:e.position,creatorEntityId:e.id,target:o.id,validUntilTime:t.gameState.time+Ct}}}return i},scorer:(e,t,i)=>typeof t.target!="number"||!i.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*Y0?.9:null,executor:(e,t,i)=>{if(typeof e.target!="number")return O.Failure;const o=i.gameState.entities.entities[e.target];if(!o)return t.activeAction="idle",t.attackTargetId=void 0,O.Success;if(q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)>z0)return t.activeAction="idle",t.target=void 0,O.Success;t.activeAction="moving",t.attackTargetId=void 0;const l=Xe(o.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=bt(l),d=hi(t.position,It(c,z0));return t.target={x:(d.x%i.gameState.mapDimensions.width+i.gameState.mapDimensions.width)%i.gameState.mapDimensions.width,y:(d.y%i.gameState.mapDimensions.height+i.gameState.mapDimensions.height)%i.gameState.mapDimensions.height},t.direction=c,O.Running}}),bR=rt({type:W.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:i}=t,o={};if(!e.leaderId||e.id===e.leaderId)return o;const s=pi(e.leaderId,i),l=`stay-near-tribe-${e.id}`;return o[l]={id:l,type:W.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:i.time+Ct},o},scorer:(e,t,i)=>{if(!e.leaderId||e.id===e.leaderId)return null;const o=pi(e.leaderId,i.gameState),s=q(e.position,o,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);if(s<=j0)return null;const l=s-j0;return Math.min(.95,.5+l/1e3*vC)},executor:(e,t,i)=>{if(!t.leaderId)return O.Failure;const o=pi(t.leaderId,i.gameState),s=q(t.position,o,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return s<IC?(t.activeAction="idle",t.target=void 0,O.Success):(t.activeAction="moving",t.target=o,t.direction=Mt(t.position,o,i.gameState.mapDimensions),[O.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),NR=rt({type:W.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:i}=t,o={};if(e.isAdult)return o;const s=oy(e,i);if(!s)return o;const l=`stay-near-parent-${e.id}`;return o[l]={id:l,type:W.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:i.time+Ct},o},scorer:(e,t,i)=>{if(e.isAdult)return null;const o=oy(e,i.gameState);if(!o||o.id!==t.target||e.leaderId&&jh(e.leaderId,i.gameState)&&Zn(o.position.x,o.position.y,i.gameState)!==e.leaderId)return null;const s=q(e.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);if(s<=X0)return null;const l=s-X0;return Math.min(.98,.6+l/500*AC)},executor:(e,t,i)=>{if(typeof e.target!="number")return t.activeAction="idle",O.Failure;const o=i.gameState.entities.entities[e.target];if(!o||o.type!=="human")return t.activeAction="idle",t.target=void 0,O.Failure;const s=q(t.position,o.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return s<=SC?(t.activeAction="idle",t.target=void 0,O.Success):(t.activeAction="moving",t.target=o.id,t.direction=Mt(t.position,o.position,i.gameState.mapDimensions),[O.Running,`Returning to parent (${Math.round(s)}px away)`])}}),BR=rt({type:W.HumanDiplomacy,requireAdult:!0,scorer:(e,t)=>e.id===e.leaderId&&t.creatorEntityId===e.id?1:null,executor:(e,t,i)=>{var d,u,h,p,y,A;const{gameState:o}=i,s=mi(t.id,o),l=ay(s),c=gu(o).filter(v=>v.leaderId!==t.id);for(const v of c){const I=mi(v.leaderId,o),S=ay(I),E=((u=(d=t.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[v.leaderId])||Et.Friendly,_=o.entities.entities[v.leaderId];((p=(h=_==null?void 0:_.tribeControl)==null?void 0:h.diplomacy)==null?void 0:p[t.id])===Et.Hostile||l>S*cC?E!==Et.Hostile&&((y=t.tribeControl)!=null&&y.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=Et.Hostile):E!==Et.Friendly&&((A=t.tribeControl)!=null&&A.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=Et.Friendly)}return t.aiBlackboard&&De.set(t.aiBlackboard,"lastDiplomacyCheckTime",o.time),O.Success}}),wu=[lR,cR,uR,dR,fR,hR,gR,mR,yR,vR,AR,IR,SR,TR,wR,CR,_R,PR,MR,kR,DR,OR,bR,NR,BR].reduce((e,t)=>(e[t.type]=t,e),{}),HR=Object.values(wu);function FR(e,t){Ja(e,t,HR)}function LR(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const o=Zc(e);if(o){const s=t.gameState.tasks[o];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),Li(e,null)}return}let i=Zc(e);if(i){const o=t.gameState.tasks[i];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(Li(e,null),i=null)}if(!i){const o=UR(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];i=o,Li(e,i),s&&(s.claimedByEntityId=e.id)}}if(i){const o=t.gameState.tasks[i];o?oI(e,o,t,wu):Li(e,null)}}function UR(e,t){let i=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let l of s){if(!l||l.claimedByEntityId&&l.claimedByEntityId!==e.id)continue;const c=wu[l.type];if(!c||!c.scorer)continue;const d=c.scorer(e,l,t);d!==null&&d>o&&(o=d,i=l.id)}return o>0?i:null}function GR(e,t){const i=performance.now();switch(e.aiType){case Po.TaskBased:default:LR(e,t);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-i}const xR=(e,t)=>{const i={};for(let o=0;o<ER;o++){const s=`hunt-prey-${e.id}-${o}`;i[s]={id:s,type:W.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return i},$R=(e,t)=>{const i={};if(e.hitpoints<=0)return i;const o=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((o==null?void 0:o.type)==="human"))return i;for(let l=0;l<lC;l++){const c=`hunt-predator-${e.id}-${l}`;i[c]={id:c,type:W.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return i},Kc=iP*1.5,WR=(e,t)=>{const i={},o=t.gameState,s=[...o.search.human.byRadius(e.position,Kc),...o.search.predator.byRadius(e.position,Kc)].filter(u=>{if(u.id===e.id)return!1;if(e.type==="prey")return u.type==="human"||u.type==="predator";if(e.type==="predator"){if(u.type==="human")return!0;if(u.type==="predator")return u.geneCode!==e.geneCode}return!1});if(s.length===0)return i;let l=s[0],c=Fn(e.position,l.position);for(let u=1;u<s.length;u++){const h=Fn(e.position,s[u].position);h<c&&(c=h,l=s[u])}const d=`animal-flee-${e.id}-${l.id}`;return i[d]={id:d,type:W.AnimalFlee,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1},i},YR=(e,t,i)=>{const o=i.gameState.entities.entities[t.target];if(!o)return null;const s=Fn(e.position,o.position);return s>Kc?null:Ke(s)*.95},zR=(e,t,i)=>{const o=i.gameState.entities.entities[e.target];if(!o)return O.Failure;if(Fn(t.position,o.position)>Kc*1.2)return O.Success;const l=bt(Ch(t.position,o.position)),c=hi(t.position,It(l,100));return t.activeAction="moving",t.target=c,O.Running},jR={type:W.AnimalFlee,producer:WR,scorer:YR,executor:zR},rI=600,XR=(e,t)=>{if(e.type!=="prey")return{};const i={},s=t.gameState.search.berryBush.byRadius(e.position,rI).filter(l=>l.food.length>0);for(const l of s){const c=`animal-graze-${e.id}-${l.id}`;i[c]={id:c,type:W.AnimalGraze,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},VR=(e,t,i)=>{if(e.type!=="prey")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.food.length===0)return null;const s=Fn(e.position,o.position);if(s>rI)return null;const l=Ke(s),c=Math.max(0,e.hunger/Au);return e.hunger<20&&s>100?null:l*c*.65},qR=(e,t,i)=>{if(t.type!=="prey")return O.Failure;const o=i.gameState.entities.entities[e.target];return!o||o.food.length===0||(t.activeAction="grazing",t.target=o.id,t.hunger<5)?O.Success:O.Running},ZR={type:W.AnimalGraze,producer:XR,scorer:VR,executor:qR},sI=800,KR=(e,t)=>{if(e.type!=="predator")return{};const i={},s=t.gameState.search.prey.byRadius(e.position,sI).filter(l=>l.type==="prey");for(const l of s){const c=`animal-hunt-${e.id}-${l.id}`;i[c]={id:c,type:W.AnimalHunt,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},QR=(e,t,i)=>{if(e.type!=="predator")return null;const o=i.gameState.entities.entities[t.target];if(!o||o.hitpoints<=0)return null;const s=Fn(e.position,o.position);if(s>sI)return null;const l=Ke(s),c=Math.max(0,e.hunger/Iu);return e.hunger<30&&s>200?null:l*c*.8},JR=(e,t,i)=>{if(t.type!=="predator")return O.Failure;const o=i.gameState.entities.entities[e.target];return!o||o.hitpoints<=0||(t.activeAction="attacking",t.target=o.id,t.hunger<10)?O.Success:O.Running},eM={type:W.AnimalHunt,producer:KR,scorer:QR,executor:JR},aI=500,tM=(e,t)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return{};const i={},s=t.gameState.search[e.type].byRadius(e.position,aI).filter(l=>{if(l.id===e.id||l.type!==e.type)return!1;const c=l;return c.isAdult&&c.gender!==e.gender&&(!c.procreationCooldown||c.procreationCooldown<=0)&&!c.isPregnant});for(const l of s){const c=`animal-procreate-${e.id}-${l.id}`;i[c]={id:c,type:W.AnimalProcreate,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},nM=(e,t,i)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return null;const o=i.gameState.entities.entities[t.target];if(!o||!o.isAdult||o.gender===e.gender||o.procreationCooldown&&o.procreationCooldown>0||o.isPregnant)return null;const s=Fn(e.position,o.position);return s>aI?null:Ke(s)*.6},iM=(e,t,i)=>{const o=i.gameState.entities.entities[e.target];return!o||o.isPregnant||o.procreationCooldown&&o.procreationCooldown>0?O.Failure:(t.activeAction="procreating",t.target=o.id,t.isPregnant||t.procreationCooldown&&t.procreationCooldown>0?O.Success:O.Running)},oM={type:W.AnimalProcreate,producer:tM,scorer:nM,executor:iM},rM=200,sM=(e,t)=>{const i=`animal-wander-${e.id}`,o=Math.random()*Math.PI*2,s=Math.random()*rM,l={x:e.position.x+Math.cos(o)*s,y:e.position.y+Math.sin(o)*s};l.x=Math.max(0,Math.min(t.gameState.mapDimensions.width,l.x)),l.y=Math.max(0,Math.min(t.gameState.mapDimensions.height,l.y));const c={};return c[i]={id:i,type:W.AnimalWander,position:l,creatorEntityId:e.id,validUntilTime:t.gameState.time+5},c},aM=()=>.1,lM=(e,t)=>Fn(t.position,e.position)<10?(t.activeAction="idle",O.Success):(t.activeAction="moving",t.target=e.position,O.Running),cM={type:W.AnimalWander,producer:sM,scorer:aM,executor:lM},uM=(e,t)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return{};const i={},s=t.gameState.search[e.type].byRadius(e.position,600).filter(l=>{if(l.type!==e.type)return!1;const c=l;return c.motherId===e.id&&c.hunger>=Su});for(const l of s){const c=`animal-feed-child-${e.id}-${l.id}`;i[c]={id:c,type:W.AnimalFeedChild,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},dM=(e,t,i)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return null;const o=i.gameState.entities.entities[t.target];if(!o||o.motherId!==e.id)return null;const s=Fn(e.position,o.position),l=Ke(s),c=e.type==="prey"?Au:Iu,d=Math.max(0,o.hunger/c);return l*d*.9},fM=(e,t,i)=>{const o=i.gameState.entities.entities[e.target];return!o||o.hunger<Su/2?O.Success:Fn(t.position,o.position)<30?(t.activeAction="feeding",O.Running):(t.activeAction="moving",t.target=o.id,O.Running)},hM={type:W.AnimalFeedChild,producer:uM,scorer:dM,executor:fM},pM=(e,t)=>{if(e.isAdult||e.hunger<Su||!e.motherId)return{};const i=t.gameState.entities.entities[e.motherId];if(!i)return{};const o={},s=`animal-seek-food-${e.id}-${i.id}`;return o[s]={id:s,type:W.AnimalSeekFoodFromParent,position:i.position,creatorEntityId:e.id,target:i.id,validUntilTime:t.gameState.time+1},o},gM=(e,t,i)=>{if(e.isAdult||!e.motherId)return null;const o=i.gameState.entities.entities[e.motherId];if(!o)return null;const s=Fn(e.position,o.position),l=Ke(s),c=e.type==="prey"?Au:Iu,d=Math.max(0,e.hunger/c);return l*d*.85},mM=(e,t,i)=>{const o=i.gameState.entities.entities[e.target];return!o||t.hunger<Su/2?O.Success:(Fn(t.position,o.position)<30||(t.activeAction="moving",t.target=o.id),O.Running)},yM={type:W.AnimalSeekFoodFromParent,producer:pM,scorer:gM,executor:mM},vM=(e,t)=>{if(e.type!=="prey")return{};if(e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return{};const i={},o=t.gameState,{width:s,height:l}=t.gameState.mapDimensions,c=o.search.prey.byRadius(e.position,hs*5),d=[];for(const u of c)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&d.push(u);if(d.length>=2){let u=0,h=0;for(const A of d)u+=A.position.x,h+=A.position.y;u/=d.length,h/=d.length;const p={x:u,y:h};if(q(e.position,p,s,l)>hs*2){const A=`animal-herd-${e.id}`;i[A]={id:A,type:W.AnimalHerd,position:p,creatorEntityId:e.id,target:p,validUntilTime:t.gameState.time+1}}}return i},AM=(e,t,i)=>{if(e.type!=="prey"||e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return null;const o=t.target,{width:s,height:l}=i.gameState.mapDimensions,c=q(e.position,o,s,l);return c<=hs*2?null:Ke(c)*.4},IM=(e,t,i)=>{if(t.type!=="prey")return O.Failure;const o=e.target,{width:s,height:l}=i.gameState.mapDimensions;if(q(t.position,o,s,l)<=hs*2)return t.activeAction="idle",t.direction={x:0,y:0},O.Success;t.activeAction="moving",t.target=o;const d=Xe(t.position,o,s,l);return t.direction=bt(d),O.Running},SM={type:W.AnimalHerd,producer:vM,scorer:AM,executor:IM},TM=(e,t)=>{if(e.type!=="predator")return{};const i=e.hunger>100,o=e.hitpoints<e.maxHitpoints*.5;if(!i&&!o)return{};if(e.attackCooldown&&e.attackCooldown>0)return{};const s={},c=t.gameState.search.human.byRadius(e.position,pr*2);let d=null,u=1/0;for(const h of c)if(h.hitpoints>0){const p=q(e.position,h.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);p<u&&(u=p,d=h)}if(d){const h=`animal-attack-human-${e.id}-${d.id}`;s[h]={id:h,type:W.AnimalAttack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return s},EM=(e,t,i)=>{if(e.type!=="predator")return null;const o=t.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const l=q(e.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return l>pr*2.5?null:Ke(l)*.75},wM=(e,t,i)=>{if(t.type!=="predator")return O.Failure;const o=e.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return O.Success;const{width:l,height:c}=i.gameState.mapDimensions;if(q(t.position,s.position,l,c)<=pr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},O.Running;{t.activeAction="moving",t.target=s.id;const u=Xe(t.position,s.position,l,c);return t.direction=bt(u),O.Running}},CM={type:W.AnimalAttack,producer:TM,scorer:EM,executor:wM},_M=(e,t)=>{if(e.type!=="predator")return{};if(!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120||e.attackCooldown&&e.attackCooldown>0)return{};const i={},s=t.gameState.search.predator.byRadius(e.position,$A);let l=null,c=1/0;for(const d of s)if(d.id!==e.id&&d.hitpoints>0&&d.isAdult&&e.fatherId!==d.fatherId&&e.gender===d.gender&&e.fatherId!==void 0&&d.fatherId!==void 0){const u=q(e.position,d.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);u<c&&(c=u,l=d)}if(l){const d=`animal-territorial-${e.id}-${l.id}`;i[d]={id:d,type:W.AnimalTerritorial,position:l.position,creatorEntityId:e.id,target:l.id,validUntilTime:t.gameState.time+1}}return i},PM=(e,t,i)=>{if(e.type!=="predator"||!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120)return null;const o=t.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const l=q(e.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return l>$A*1.2?null:Ke(l)*.7},RM=(e,t,i)=>{if(t.type!=="predator")return O.Failure;const o=e.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return O.Success;const{width:l,height:c}=i.gameState.mapDimensions;if(q(t.position,s.position,l,c)<=pr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},O.Running;{t.activeAction="moving",t.target=s.id;const u=Xe(t.position,s.position,l,c);return t.direction=bt(u),O.Running}},MM={type:W.AnimalTerritorial,producer:_M,scorer:PM,executor:RM},kM=(e,t)=>{if(e.type!=="predator")return{};if(e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return{};if(e.fatherId===void 0)return{};const i={},o=t.gameState,{width:s,height:l}=t.gameState.mapDimensions,c=o.search.predator.byRadius(e.position,ps*4);let d=null;for(const u of c)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&u.fatherId===e.fatherId&&(u.age>=e.age||u.hitpoints>e.hitpoints)&&(!d||u.age>d.age)&&(d=u);if(d&&q(e.position,d.position,s,l)>ps*2){const h=`animal-pack-follow-${e.id}-${d.id}`;i[h]={id:h,type:W.AnimalPack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return i},DM=(e,t,i)=>{if(e.type!=="predator"||e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return null;const o=t.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const{width:l,height:c}=i.gameState.mapDimensions,d=q(e.position,s.position,l,c);return d<=ps*2?null:Ke(d)*.35},OM=(e,t,i)=>{if(t.type!=="predator")return O.Failure;const o=e.target,s=i.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return O.Success;const{width:l,height:c}=i.gameState.mapDimensions;if(q(t.position,s.position,l,c)<=ps*2)return t.activeAction="idle",t.direction={x:0,y:0},O.Success;t.activeAction="moving",t.target=s.id;const u=Xe(t.position,s.position,l,c);return t.direction=bt(u),O.Running},bM={type:W.AnimalPack,producer:kM,scorer:DM,executor:OM},qt={};qt[W.HumanHuntPrey]={type:W.HumanHuntPrey,producer:xR};qt[W.HumanHuntPredator]={type:W.HumanHuntPredator,producer:$R};qt[W.AnimalFlee]=jR;qt[W.AnimalGraze]=ZR;qt[W.AnimalHunt]=eM;qt[W.AnimalAttack]=CM;qt[W.AnimalProcreate]=oM;qt[W.AnimalWander]=cM;qt[W.AnimalFeedChild]=hM;qt[W.AnimalSeekFoodFromParent]=yM;qt[W.AnimalHerd]=SM;qt[W.AnimalTerritorial]=MM;qt[W.AnimalPack]=bM;function yy(e,t){Ja(e,t,Object.values(qt))}function lI(e,t){let i=Zc(e);if(i){const o=t.gameState.tasks[i];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(Li(e,null),i=null)}if(!i){const o=NM(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];i=o,Li(e,i),s&&(s.claimedByEntityId=e.id)}}if(i){const o=t.gameState.tasks[i];o?oI(e,o,t,qt):Li(e,null)}}function NM(e,t){let i=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,1e3);for(let l of s){if(!l||l.claimedByEntityId&&l.claimedByEntityId!==e.id)continue;const c=qt[l.type];if(!c||!c.scorer)continue;const d=c.scorer(e,l,t);d!==null&&d>o&&(o=d,i=l.id)}return o>0?i:null}function BM(e,t){lI(e,t)}function HM(e,t){lI(e,t)}const FM=(e,t)=>{if(e.buildingType!==fe.PlantingZone||!e.isConstructed)return{};const{gameState:i}=t,o=TA(e);if(q1(e,i)>=o)return{};const l=i.search.tasks.byProperty("creatorEntityId",e.id).find(p=>p.type===W.HumanPlantBush);if(l)return{[l.id]:l};const c=i.mapDimensions.width,d=i.mapDimensions.height,u=i.soilDepletion,h=10;for(let p=0;p<h;p++){const y=e.position.x+(Math.random()-.5)*e.width,A=e.position.y+(Math.random()-.5)*e.height,v={x:(y%c+c)%c,y:(A%d+d)%d};if(!ur(u,v,c,d)&&!Gi(v,i,au)){const I=`plant-bush-${e.id}`,S={id:I,type:W.HumanPlantBush,position:v,creatorEntityId:e.id,target:v,validUntilTime:i.time+iR};return{[I]:S}}}return{}},LM=(e,t)=>{const i={};if(e.buildingType===fe.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const o=`stockpile-${e.id}`;i[o]={id:o,type:W.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i},UM=(e,t)=>{const i={};if(e.buildingType===fe.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*OC){const o=`fuel-bonfire-${e.id}`;i[o]={id:o,type:W.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i},GM=(e,t)=>{const i={};if(e.buildingType===fe.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let o=0;o<HC;o++){const s=`seek-warmth-${e.id}-${o}`;i[s]={id:s,type:W.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i},xM=(e,t)=>{const i={};if(e.buildingType===fe.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(o=>o.item.itemType==="food")){const o=`retrieve-from-${e.id}`;i[o]={id:o,type:W.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i},$M={[W.HumanPlantBush]:{type:W.HumanPlantBush,producer:FM},[W.HumanStockpile]:{type:W.HumanStockpile,producer:LM},[W.HumanFuelBonfire]:{type:W.HumanFuelBonfire,producer:UM},[W.HumanSeekWarmth]:{type:W.HumanSeekWarmth,producer:GM},[W.HumanRetrieve]:{type:W.HumanRetrieve,producer:xM}};function cI(e,t){Ja(e,t,Object.values($M))}function WM(e,t){const{gameState:i,deltaTime:o}=t,s=o*(Dt/Gt);if(e.isBeingDestroyed){const l=eE(e.buildingType);if(l>0?e.destructionProgress+=s/l:e.destructionProgress=1,e.destructionProgress>=1){const c=e.buildingType===fe.PlantingZone;yr(i.entities,e.id),c&&Ba(i);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const l=JT(e.buildingType);l>0?e.constructionProgress+=s/l:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&Qv(e.position,us,e.ownerId,i),e.buildingType===fe.PlantingZone&&Ba(i))}if(e.buildingType===fe.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*DC,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*NC)){const l=e.storedItems.findIndex(c=>c.item.itemType==="item"&&c.item.type===Ot.Wood);l!==-1&&(e.storedItems.splice(l,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+nA))}cI(e,t)}function YM(e,t){const i=t.deltaTime*Dt/Gt;if(e.age+=i,!e.stateMachine)return;const[o]=e.stateMachine;o!==Vt&&o!==Ui&&o!==cr&&(e.age>=_o&&!e.woodGenerated&&(e.wood=Array.from({length:Tu},()=>({itemType:"item",type:Ot.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=Qa*Math.min(1,Math.max(.4,e.age/_o)))}const zM={type:W.HumanGatherBerries,producer:(e,t)=>{const i={};if(e.type!=="berryBush")return i;if(e.food.length>0){const o=`gather-berries-${e.id}`;i[o]={id:o,type:W.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i}},jM={type:W.HumanChopTree,producer:(e,t)=>{const i={};if(e.type!=="tree")return i;const[o]=e.stateMachine??[];if(o===Vn||o===Hn||o===gi){const l=`chop-tree-${e.id}`;i[l]={id:l,type:W.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i}},XM={type:W.HumanGatherWood,producer:(e,t)=>{const i={};if(e.type!=="tree")return i;const[o]=e.stateMachine??[];if(o===Vt&&e.wood.length>0){const l=`gather-wood-${e.id}`;i[l]={id:l,type:W.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i}},VM=[zM,jM,XM].reduce((e,t)=>(e[t.type]=t,e),{});function vy(e,t){Ja(e,t,Object.values(VM))}const qM={type:W.HumanGatherMeat,producer:(e,t)=>{const i={};if(e.food.length>0){const o=`gather-meat-${e.id}`;i[o]={id:o,type:W.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ct}}return i}},ZM=[qM].reduce((e,t)=>(e[t.type]=t,e),{});function KM(e,t){Ja(e,t,Object.values(ZM))}var bc=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(bc||{});function Wf(e,t,i){switch(i){case 0:QM(e,t);break;case 1:JM(e,t);break;case 2:ek(e,t);break}}function QM(e,t){e.forces.push(It(e.velocity,-.1));const i=It(bt(e.direction),e.acceleration);e.forces.push(i),e.debuffs.forEach(o=>{t.gameState.time-o.startTime<o.duration&&o.type==="slow"&&(e.velocity=It(e.velocity,.5))}),e.debuffs=e.debuffs.filter(o=>t.gameState.time-o.startTime<o.duration),e.velocity=hi(e.velocity,e.forces.reduce(hi,{x:0,y:0})),To(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=hi(e.position,It(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&To(e.velocity)>.1&&Q1(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?QP(e,t,t.deltaTime):e.type==="corpse"?JP(e,t):e.type==="prey"?eR(e,t,t.deltaTime):e.type==="predator"?tR(e,t,t.deltaTime):e.type==="building"?WM(e,t):e.type==="tree"?YM(e,t):e.type,e.stateMachine&&(e.stateMachine=qP(...e.stateMachine,{entity:e,updateContext:t}))}function JM(e,t){uI(e,t)&&(e.type==="human"?FR(e,t):e.type==="corpse"?KM(e,t):e.type==="prey"||e.type==="predator"?yy(e,t):e.type==="building"?cI(e,t):(e.type==="tree"||e.type==="berryBush")&&vy(e,t))}function ek(e,t){uI(e,t)&&(e.type==="human"?GR(e,t):e.type==="corpse"||(e.type==="prey"?BM(e,t):e.type==="predator"?HM(e,t):e.type==="building"||e.type==="tree"||e.type),De.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function uI(e,t){const i=De.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-i+(Math.random()-Math.random())*$0/10>$0}function tk(e){const t=e.gameState.entities.entities;for(const i in t)Wf(t[i],e,bc.Physics);for(const i in t)Wf(t[i],e,bc.PrepareAI);VT(e.gameState);for(const i in t)Wf(t[i],e,bc.ExecuteAI)}function dI(){return{entities:{},nextEntityId:1}}function mr(e,t,i){const o={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:De.create(),...i};return e.entities[o.id]=o,o}function el(e,t,i){return mr(e,"berryBush",{position:t,radius:lh,food:Array.from({length:gw},()=>({itemType:"food",type:Qn.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:pw,lifespan:yw,age:0,spreadRadius:lh,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:De.create(),stateMachine:[Ca,{enteredAt:i,previousState:void 0}]})}function Xa(e,t,i,o=0){const s=o>=_o;return mr(e,"tree",{position:t,radius:Qa,age:o,lifespan:kP,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:UP,stateMachine:[Vn,{enteredAt:i,previousState:void 0}],aiBlackboard:De.create(),wood:s?Array.from({length:Tu},()=>({itemType:"item",type:Ot.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function ns(e,t,i,o,s=!1,l=Nw,c=Yv,d,u,h=[],p,y,A=Po.TaskBased){const v=l>=Fh;return mr(e,"human",{position:t,radius:v?mt:As,hunger:c,hitpoints:G0,maxHitpoints:G0,age:l,gender:o,isPlayer:s,food:[],maxFood:xv,maxAge:Ua,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:d,fatherId:u,ancestorIds:h,stateMachine:[ut,{enteredAt:i,previousState:void 0}],leaderId:p,tribeInfo:y,aiType:A,aiBlackboard:De.create()})}function cp(e,t,i,o,s,l,c,d,u,h,p){let y,A;switch(c){case"human":y=jv,A=Bn;break;case"prey":y=2,A=120;break;case"predator":y=4,A=140;break}return mr(e,"corpse",{position:t,radius:s,gender:i,age:o,originalEntityId:l,originalEntityType:c,timeOfDeath:d,decayProgress:0,geneCode:p,food:[...Array.from({length:Math.max(y*Math.max(A-h,0)/A,0)},()=>({itemType:"food",type:Qn.Meat})),...u].map(I=>({...I,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:De.create()})}function nk(e,t,i,o,s,l,c,d,u){return cp(e,t,i,o,s,l,"human",c,d,u)}function ik(e,t,i,o,s,l,c,d){return cp(e,t,i,o,s,l,"prey",c,[],0,d)}function ok(e,t,i,o,s,l,c,d){return cp(e,t,i,o,s,l,"predator",c,[],0,d)}function rk(e,t,i){const o=t?i.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],l=o?[...o.ancestorIds||[],o.id]:[],c=[...s,...l],d=[...new Set(c)],u=d.slice(Math.max(d.length-Uv,0)),h=Math.random()<.5?"male":"female",p=hi(e.position,{x:5,y:5}),y=ns(i.gameState.entities,p,i.gameState.time,h,!1,0,Yv/2,e.id,t,u,(o==null?void 0:o.leaderId)??e.leaderId,(o==null?void 0:o.tribeInfo)??e.tribeInfo,e.aiType);return we(i,Ae.Birth,e.position),y}function yr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function gs(e,t,i,o=nP,s=LA,l,c,d,u=Po.TaskBased){const h=o>=UA,p=Date.now();return mr(e,"prey",{position:t,radius:h?mt*.7:As*.7,hunger:s,hitpoints:fy,maxHitpoints:fy,age:o,maxAge:FA,gender:i,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:l,motherId:c,fatherId:d,stateMachine:[Xn,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:De.create()})}function ms(e,t,i,o=cP,s=xA,l,c,d,u=Po.TaskBased){const h=o>=zA,p=Date.now();return mr(e,"predator",{position:t,radius:h?mt*.9:As*.9,hunger:s,hitpoints:hy,maxHitpoints:hy,age:o,maxAge:GA,gender:i,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:l,motherId:c,fatherId:d,stateMachine:[nn,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:De.create()})}function sk(e,t,i,o){const s=_h(i),l={position:t,radius:Math.max(s.width,s.height)/2,buildingType:i,ownerId:o,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:k_,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:i===fe.Bonfire?dh:void 0,maxFuelLevel:i===fe.Bonfire?dh:void 0,aiBlackboard:De.create(),stateMachine:["",{enteredAt:0}]};return mr(e,"building",l)}var en=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(en||{}),rr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(rr||{}),tn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(tn||{});const Ih={},Sh={},ak=[{key:en.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:en.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>Dw,isCompleted:!1,minDisplayTime:ey,highlightedUIElements:[rr.HUNGER_BAR]},{key:en.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!qe(t,e,"berryBush",je*5,o=>o.food.length>0),getTargets:(e,t)=>{const i=[];for(const o of Object.values(e.entities.entities))o.type==="berryBush"&&o.food.length>0&&q(t.position,o.position,e.mapDimensions.width,e.mapDimensions.height)<500&&i.push(o);return i.map(o=>o.id)},isCompleted:!1,minDisplayTime:ey},{key:en.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const i=qe(t,e,"berryBush",je,o=>o.food.length>0);return i?[i.id]:[]},isCompleted:!1},{key:en.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[rr.FOOD_BAR]},{key:en.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>xi(e,t).length>0,getTargets:(e,t)=>{const i=qe(t,e,"human",je,o=>vs(t,o,e));return i?[i.id]:[]},isCompleted:!1},{key:en.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>op(e,t).some(o=>o.type===ue.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:en.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[rr.COMMAND_BUTTONS],isCompleted:!1},{key:en.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(i=>i.type==="prey"||i.type==="predator"),isCompleted:!1,dependsOn:en.AUTOPILOT},{key:en.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const i=qe(t,e,"prey",150);return t.hunger>40&&!!i},getTargets:(e,t)=>{const i=qe(t,e,"prey",150);return i?[i.id]:[]},isCompleted:!1,dependsOn:en.ANIMALS_INTRODUCTION},{key:en.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!qe(t,e,"predator",120),getTargets:(e,t)=>{const i=qe(t,e,"predator",120);return i?[i.id]:[]},isCompleted:!1,dependsOn:en.HUNT_PREY}].map(e=>({...e,condition:e.condition?uk(e.condition):void 0,getTargets:e.getTargets?dk(e.getTargets):void 0}));function fI(){return{steps:ak.map(e=>({...e,isCompleted:!1}))}}function hI(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:tn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function lk(e){for(let t=0;t<e.tutorial.steps.length;t++){const i=e.tutorial.steps[t];if(!i.isCompleted)if(i.dependsOn){if(e.tutorialState.completedSteps.includes(i.dependsOn))return t}else return t}return null}function ck(e,t){const i=e.tutorialState;if(!i.isActive){i.transitionState=tn.INACTIVE,i.highlightedEntityIds=[],i.activeUIHighlights=[];return}const o=ft(e);if(!o){i.isActive=!1,i.transitionState=tn.INACTIVE,i.highlightedEntityIds=[],i.activeUIHighlights=[];return}const s=e.tutorial.steps[i.currentStepIndex];if(!s){i.isActive=!1,i.transitionState=tn.INACTIVE,i.highlightedEntityIds=[],i.activeUIHighlights=[];return}const l=1/A1;switch(i.transitionState){case tn.FADING_IN:i.stepStartTime===null&&(i.stepStartTime=e.time),i.transitionAlpha+=l*t,i.transitionAlpha>=1&&(i.transitionAlpha=1,i.transitionState=tn.ACTIVE);break;case tn.ACTIVE:{const u=e.time-(i.stepStartTime||e.time)>=(s.minDisplayTime||0),h=Ih[s.condition];h&&u&&h(e,o)&&(s.isCompleted=!0,i.completedSteps.includes(s.key)||i.completedSteps.push(s.key),i.transitionState=tn.FADING_OUT);break}case tn.FADING_OUT:if(i.transitionAlpha-=l*t,i.transitionAlpha<=0){i.transitionAlpha=0,i.stepStartTime=null;const d=lk(e);d!==null?(i.currentStepIndex=d,i.transitionState=tn.FADING_IN):(i.isActive=!1,i.transitionState=tn.INACTIVE)}break}if(i.transitionState!==tn.FADING_OUT&&i.transitionState!==tn.INACTIVE){const d=Sh[s.getTargets||""];d?i.highlightedEntityIds=[...d(e,o)]:i.highlightedEntityIds=[],s.highlightedUIElements?i.activeUIHighlights=[...s.highlightedUIElements]:i.activeUIHighlights=[]}else i.highlightedEntityIds=[],i.activeUIHighlights=[]}function uk(e){const t=`condition_${Object.keys(Ih).length+1}`;return Ih[t]=e,t}function dk(e){const t=`getTargets_${Object.keys(Sh).length+1}`;return Sh[t]=e,t}function fk(){const e=dI(),t=0;for(let A=0;A<kv;A++){const v={x:Math.random()*xe,y:Math.random()*$e};el(e,v,t)}for(let A=0;A<Mv;A++){const v={x:Math.random()*xe,y:Math.random()*$e};Xa(e,v,t)}const i=xe/2,o=$e/2;for(let A=0;A<5;A++){const v=A/5*Math.PI*2,I=100+Math.random()*100,S={x:i+Math.cos(v)*I,y:o+Math.sin(v)*I};Xa(e,S,t,_o)}const s=ns(e,{x:i-25,y:o},t,"male",!0),l=ns(e,{x:i+25,y:o},t,"female",!1);l.leaderId=s.id,l.tribeInfo={tribeBadge:"",tribeColor:on[0]},s.aiType=Po.TaskBased,l.aiType=Po.TaskBased;for(let A=0;A<5;A++){const v=A/5*Math.PI*2,I=xe/2,S=$e/2,E={x:i+Math.cos(v)*I,y:o+Math.sin(v)*S},_=ns(e,{x:E.x,y:E.y},t,"male",!1);_.leaderId=_.id,_.tribeInfo={tribeBadge:Yc[A%Yc.length],tribeColor:on[A%on.length]};const w=ns(e,{x:E.x+50,y:E.y},t,"female",!1);w.leaderId=_.id,w.tribeInfo=_.tribeInfo}for(let A=0;A<jA;A++){const v={x:i+xe*(Math.random()-Math.random()),y:o+$e*(Math.random()-Math.random())};gs(e,v,"male",void 0,void 0,Ya()),gs(e,{x:v.x+20,y:v.y},"female",void 0,void 0,Ya())}const c={x:i+xe*(Math.random()-Math.random()),y:o+$e*(Math.random()-Math.random())};ms(e,c,"male",void 0,void 0,za()),ms(e,{x:c.x+20,y:c.y},"female",void 0,void 0,za());const d=[{id:"muteButton",action:oe.ToggleMute,currentWidth:bi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:ot},{id:"pauseButton",action:oe.TogglePause,currentWidth:bi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:ot},{id:"returnToIntroButton",action:oe.ReturnToIntro,currentWidth:bi,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:ot}],u=fI(),h=hI(),p={time:t,entities:e,mapDimensions:{width:xe,height:$e},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:MA,isMuted:!1,uiButtons:d,tutorial:u,tutorialState:h,debugPanel:Le.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:ar.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:er,preyProcreationCooldown:tr,predatorGestationPeriod:nr,predatorProcreationCooldown:ir,preyHungerIncreasePerHour:vo,predatorHungerIncreasePerHour:Ao,berryBushSpreadChance:Fi},soilDepletion:bv(),temperature:eI(xe,$e),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(xe/Ce)*Math.ceil($e/Ce)).fill(null),tasks:{}},y=eu(p);return console.log("Game world initialized:",y),y}function hk(){const e=dI(),t=0;for(let u=0;u<kv;u++){const h={x:Math.random()*xe,y:Math.random()*$e};el(e,h,t)}for(let u=0;u<Mv;u++){const h={x:Math.random()*xe,y:Math.random()*$e};Xa(e,h,t)}const i=xe/2,o=$e/2;for(let u=0;u<5;u++){const h=u/5*Math.PI*2,p=100+Math.random()*100,y={x:i+Math.cos(h)*p,y:o+Math.sin(h)*p};Xa(e,y,t,_o)}for(let u=0;u<dw;u++){const h={x:Math.random()*xe,y:Math.random()*$e},p=Math.random()<.5?"male":"female";ns(e,h,t,p,!1)}for(let u=0;u<jA;u++){const h={x:Math.random()*xe,y:Math.random()*$e};gs(e,h,"male",void 0,void 0,Ya()),gs(e,{x:h.x+20,y:h.y},"female",void 0,void 0,Ya())}const s={x:Math.random()*xe,y:Math.random()*$e};ms(e,s,"male",void 0,void 0,za()),ms(e,{x:s.x+20,y:s.y},"female",void 0,void 0,za());const l=fI(),c=hI(),d={time:t,entities:e,mapDimensions:{width:xe,height:$e},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:xe/2,y:$e/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:MA,isMuted:!0,uiButtons:[],tutorial:l,tutorialState:c,debugPanel:Le.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:er,preyProcreationCooldown:tr,predatorGestationPeriod:nr,predatorProcreationCooldown:ir,preyHungerIncreasePerHour:vo,predatorHungerIncreasePerHour:Ao,berryBushSpreadChance:Fi},soilDepletion:bv(),temperature:eI(xe,$e),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(xe/Ce)*Math.ceil($e/Ce)).fill(null),tasks:{}};return eu(d)}const pk="humanProcreation",gk="human",mk="human",yk=je,vk=(e,t,i)=>vs(e,t,i.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,Ak=(e,t,i)=>{const{gameState:o}=i,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},l=e.gender==="male"?e:t,c=e.gender==="female"?e:t,d=(l.partnerIds||[]).length===0;if(e.stateMachine[0]!==Ko&&(e.stateMachine=[Ko,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:i.gameState.time+1}]),t.stateMachine[0]!==Ko&&(t.stateMachine=[Ko,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:i.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),d&&l.leaderId&&l.leaderId!==l.id){const u=o.entities.entities[l.leaderId];if(u){const h=ph(l,u),p=ph(c,u);if(!h&&!p){const y=jc();l.leaderId=l.id,l.tribeInfo={tribeBadge:y,tribeColor:on[Math.floor(Math.random()*on.length)]},l.tribeRole=Fe.Leader,l.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},c.leaderId=l.id,c.tribeInfo=l.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&l&&c){const u=jc();l.leaderId=l.id,l.tribeInfo={tribeBadge:u,tribeColor:on[Math.floor(Math.random()*on.length)]},l.tribeRole=Fe.Leader,l.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},c.leaderId=l.id,c.tribeInfo=l.tribeInfo}e.activeAction=void 0,be(o,ve.Procreation,s,xa),be(o,ve.Partnered,e.position,We,e.id),be(o,ve.Partnered,t.position,We,t.id),e.lastPartneredEffectTime=o.time,t.lastPartneredEffectTime=o.time,t.activeAction=void 0,we(i,Ae.Procreate,s)},Ik={id:pk,sourceType:gk,targetType:mk,maxDistance:yk,checker:vk,perform:Ak},Sk={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:zv,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Eo&&e.activeAction==="feeding",perform:(e,t,i)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-Eo),e.feedChildCooldownTime=Gw,(!t.lastChildFedEffectTime||i.gameState.time-t.lastChildFedEffectTime>2)&&(be(i.gameState,ve.ChildFed,t.position,We,t.id),t.lastChildFedEffectTime=i.gameState.time),we(i,Ae.ChildFed,t.position)}},Tk={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:hn,checker:(e,t,i)=>{var p,y;if(e.stateMachine[0]!==Co||e.attackTargetId!==t.id)return!1;const o=q(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),s=o<=wo,l=!s&&o<=hn;if(!s&&!l||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((y=e.attackCooldown)==null?void 0:y.ranged)||0)>0)return!1;const d=s?uu:xh,u=e.stateMachine[1];return i.gameState.time-u.attackStartTime>=d},perform:(e,t,i)=>{const{gameState:o}=i,s=q(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),l=s>wo,c=Xe(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),d=jT(bt(c),t.direction);if(Math.abs(d)<Qw*Math.PI/180&&Math.random()<Jw)be(o,ve.AttackDeflected,t.position,We,t.id);else{let p=l?Gh:Uh;if(e.gender==="male"&&(p*=qw),e.isAdult||(p*=Zw),(!t.isAdult||t.age>=Lh)&&e.isAdult&&(p*=Kw),l){const A=s/$h;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+A,data:{attackerId:e.id,targetId:t.id,damage:p,pushbackForce:Yh,attackerPosition:{...e.position}}}),be(o,ve.StoneProjectile,e.position,A,void 0,t.position,t.id),we(i,Ae.Attack,e.position)}else{t.hitpoints-=p,t.movementSlowdown={modifier:fu,endTime:o.time+hu},be(o,ve.Hit,t.position,We,t.id);const A=Xe(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),v=It(A,zw);t.forces.push(v),t.hitpoints<=0?we(i,Ae.HumanDeath,t.position):we(i,Ae.Attack,e.position),be(o,ve.Attack,e.position,We,e.id)}}e.attackCooldown={melee:du,ranged:Wh};const h=e.stateMachine[1];h.attackStartTime=o.time}},Ek={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:mt*2,checker:(e,t,{gameState:i})=>q(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:i})=>{const o=q(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height);if(o===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const l=(e.radius+t.radius-o)*.05,c=bt(Ch(e.position,t.position)),d=It(c,l);e.forces.push(d),t.forces.push(It(d,-1))}},wk={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:mt*.6+Qa*.4,checker:(e,t,{gameState:i})=>{const o=t.stateMachine[0];if(o==="fallen"||o==="stump")return!1;const s=t.radius*.25,l=e.radius*.4;return q(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height)<l+s},perform:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4,l=q(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height);if(l===0){e.forces.push({x:1,y:0});return}const c=s+o-l;if(c<=0)return;const d=c*2.5,u=bt(Xe(t.position,e.position,i.mapDimensions.width,i.mapDimensions.height)),h=It(u,d);e.forces.push(h)}},Ck={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:mt*.6+Qa*.4,checker:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4;return q(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height)<s+o},perform:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4,l=q(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height);if(l===0){e.forces.push({x:1,y:0});return}const c=s+o-l;if(c<=0)return;const d=c*2.5,u=bt(Xe(t.position,e.position,i.mapDimensions.width,i.mapDimensions.height)),h=It(u,d);e.forces.push(h)}},_k={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:mt*.6+Qa*.4,checker:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4;return q(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height)<s+o},perform:(e,t,{gameState:i})=>{const o=t.radius*.25,s=e.radius*.4,l=q(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height);if(l===0){e.forces.push({x:1,y:0});return}const c=s+o-l;if(c<=0)return;const d=c*2.5,u=bt(Xe(t.position,e.position,i.mapDimensions.width,i.mapDimensions.height)),h=It(u,d);e.forces.push(h)}},Pk={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:je,checker:(e,t,i)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Is&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<i.gameState.time)||!1,perform:(e,t,i)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=i.gameState.time+1,t.timeSinceLastHarvest=i.gameState.time,be(i.gameState,ve.BushClaimed,t.position,We),we(i,Ae.Gather,e.position)}},Rk={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:je,checker:(e,t,i)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Is&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<i.gameState.time)||!1,perform:(e,t,i)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=i.gameState.time+1,we(i,Ae.Gather,e.position)}},Mk={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:je,checker:(e,t,i)=>e.isAdult&&t.stateMachine[0]===Vt&&t.wood.length>0&&e.stateMachine[0]===Is&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<i.gameState.time)||!1,perform:(e,t,i)=>{const o=t.wood.pop();o&&(e.heldItem=o),e.gatheringCooldownTime=i.gameState.time+1,t.wood.length===0&&(t.stateMachine=[Ui,{enteredAt:i.gameState.time,previousState:Vt}]),we(i,Ae.Gather,e.position)}},kk=[Pk,Rk,Mk],Dk={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:hs,checker:(e,t,i)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<i.gameState.time)),perform:(e,t,i)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=rP,t.timeSinceLastHarvest=i.gameState.time,e.eatingCooldownTime=i.gameState.time+oP,be(i.gameState,ve.BushClaimed,t.position,We,e.id),we(i,Ae.Gather,e.position))}},Ok={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:uP,checker:(e,t,i)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,i)=>{t.hitpoints-=dP;const o=Xe(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),s=It(o,8);t.forces.push(s),e.huntCooldown=pP,t.hitpoints<=0?(we(i,Ae.HumanDeath,t.position),be(i.gameState,ve.Hit,t.position,We,t.id)):(be(i.gameState,ve.Hit,t.position,We,t.id),t.fleeCooldown=5,we(i,Ae.Attack,e.position)),be(i.gameState,ve.Attack,e.position,We,e.id)}},bk={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:hn,checker:(e,t,i)=>{var p,y;if(e.stateMachine[0]!==Co||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=q(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),s=o<=wo,l=!s&&o<=hn;if(!s&&!l||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((y=e.attackCooldown)==null?void 0:y.ranged)||0)>0)return!1;const d=s?uu:xh,u=e.stateMachine[1];return i.gameState.time-u.attackStartTime>=d},perform:(e,t,i)=>{const{gameState:o}=i,s=q(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),l=s>wo;let c=(l?Gh:Uh)*1.2;if(e.gender==="male"&&(c*=1.3),l){const u=s/$h;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+u,data:{attackerId:e.id,targetId:t.id,damage:c,pushbackForce:Yh,attackerPosition:{...e.position}}}),be(o,ve.StoneProjectile,e.position,u,void 0,t.position,t.id),we(i,Ae.Attack,e.position)}else{t.hitpoints-=c;const u=Xe(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),h=It(u,6);t.forces.push(h),t.hitpoints<=0?(we(i,Ae.HumanDeath,t.position),be(o,ve.Hit,t.position,We,t.id)):(be(o,ve.Hit,t.position,We,t.id),t.fleeCooldown=8,we(i,Ae.Attack,e.position)),be(o,ve.Attack,e.position,We,e.id)}e.attackCooldown={melee:du,ranged:Wh};const d=e.stateMachine[1];d.attackStartTime=o.time}},Nk={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:pr,checker:(e,t,i)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=i.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,i)=>{let o=WA;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:fu,endTime:i.gameState.time+hu};const s=Xe(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=It(s,7);t.forces.push(l),e.attackCooldown=YA,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-sp),we(i,Ae.HumanDeath,t.position),be(i.gameState,ve.Hit,t.position,We,t.id)):(be(i.gameState,ve.Hit,t.position,We,t.id),we(i,Ae.Attack,e.position)),be(i.gameState,ve.Attack,e.position,We,e.id)}},Bk={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:hn,checker:(e,t,i)=>{var p,y;if(e.stateMachine[0]!==Co||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=q(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),s=o<=wo,l=!s&&o<=hn;if(!s&&!l||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((y=e.attackCooldown)==null?void 0:y.ranged)||0)>0)return!1;const d=s?uu:xh,u=e.stateMachine[1];return i.gameState.time-u.attackStartTime>=d},perform:(e,t,i)=>{const{gameState:o}=i,s=q(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),l=s>wo;let c=(l?Gh:Uh)*.8;e.gender==="male"&&(c*=1.2);const d=Object.values(o.entities.entities).filter(h=>h.type==="human"&&h.id!==e.id).filter(h=>{const p=h;return Math.sqrt(Math.pow(p.position.x-e.position.x,2)+Math.pow(p.position.y-e.position.y,2))<100&&p.activeAction==="attacking"&&p.attackTargetId===t.id}).length;if(d>0&&(c*=1+d*.2),l){const h=s/$h;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+h,data:{attackerId:e.id,targetId:t.id,damage:c,pushbackForce:Yh,attackerPosition:{...e.position}}}),be(o,ve.StoneProjectile,e.position,h,void 0,t.position,t.id),we(i,Ae.Attack,e.position)}else{t.hitpoints-=c;const h=Xe(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),p=It(h,8);t.forces.push(p),t.hitpoints<=0?(we(i,Ae.HumanDeath,t.position),be(o,ve.Hit,t.position,We,t.id)):(be(o,ve.Hit,t.position,We,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),we(i,Ae.Attack,e.position)),be(o,ve.Attack,e.position,We,e.id)}e.attackCooldown={melee:du,ranged:Wh};const u=e.stateMachine[1];u.attackStartTime=o.time}},Hk={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:hs,checker:(e,t,i)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,i)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.gestationTime=i.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=i.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=i.gameState.ecosystem.preyProcreationCooldown,be(i.gameState,ve.Procreation,o.position,We,o.id),we(i,Ae.Procreate,o.position)}},Fk={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:ps,checker:(e,t,i)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,i)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.pregnancyFatherId=e.gender==="male"?e.id:t.id,o.gestationTime=i.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=i.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=i.gameState.ecosystem.predatorProcreationCooldown,be(i.gameState,ve.Procreation,o.position,We,o.id),we(i,Ae.Procreate,o.position)}},Lk={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:XA,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=qc&&e.activeAction==="feeding",perform:(e,t,i)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-qc),e.feedChildCooldownTime=VA,(!t.lastChildFedEffectTime||i.gameState.time-t.lastChildFedEffectTime>2)&&(be(i.gameState,ve.ChildFed,t.position,We,t.id),t.lastChildFedEffectTime=i.gameState.time),we(i,Ae.ChildFed,t.position)}},Uk={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:XA,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=qc&&e.activeAction==="feeding",perform:(e,t,i)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-qc),e.feedChildCooldownTime=VA,(!t.lastChildFedEffectTime||i.gameState.time-t.lastChildFedEffectTime>2)&&(be(i.gameState,ve.ChildFed,t.position,We,t.id),t.lastChildFedEffectTime=i.gameState.time),we(i,Ae.ChildFed,t.position)}},Gk={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:ps,checker:(e,t,i)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=i.gameState.time)),perform:(e,t,i)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-sp),e.eatingCooldownTime=i.gameState.time+2,be(i.gameState,ve.Eating,e.position,We,e.id),we(i,Ae.Gather,e.position))}},xk={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:pr,checker:(e,t,i)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=i.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,i)=>{let o=WA;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:fu,endTime:i.gameState.time+hu};const s=Xe(e.position,t.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),l=It(s,7);t.forces.push(l),e.attackCooldown=YA,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-sp),we(i,Ae.HumanDeath,t.position),be(i.gameState,ve.Hit,t.position,We,t.id)):(be(i.gameState,ve.Hit,t.position,We,t.id),we(i,Ae.Attack,e.position)),be(i.gameState,ve.Attack,e.position,We,e.id)}},$k=25;function Ay(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function pI(e){const t=e.storedItems.length,i=Ay(t+e.id)*2*Math.PI,o=Ay(t+e.id+1)*$k;return{x:Math.cos(i)*o,y:Math.sin(i)*o}}const gI="tribe_logistics_demands";function up(e){return De.get(e,gI)||[]}function mI(e,t,i){let o=up(e);o=o.filter(s=>!(s.requesterId===t&&s.resourceType===i)),De.set(e,gI,o)}const Wk={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:Kn,checker:(e,t,i)=>{var h;const o=t.buildingType===fe.StorageSpot,s=t.buildingType===fe.Bonfire;if(!o&&!s||e.stateMachine[0]!==ka||!t.isConstructed)return!1;const l=e.food.length>0,c=((h=e.heldItem)==null?void 0:h.type)===Ot.Wood;if(s&&!c||!l&&!c)return!1;const d=t.storageCapacity??0;return!(t.storedItems.length>=d||e.leaderId!==t.ownerId||i.gameState.time-(t.lastDepositTime??0)<D_)},perform:(e,t,i)=>{var s;let o=null;if(t.buildingType===fe.Bonfire?((s=e.heldItem)==null?void 0:s.type)===Ot.Wood&&(o=e.heldItem,e.heldItem=void 0):e.heldItem?(o=e.heldItem,e.heldItem=void 0):o=e.food.pop()??null,o&&(t.storedItems.push({item:o,positionOffset:pI(t)}),t.buildingType===fe.Bonfire)){const l=gr(e,i.gameState);l&&l.aiBlackboard&&mI(l.aiBlackboard,t.id,"wood")}t.lastDepositTime=i.gameState.time,we(i,Ae.StorageDeposit,t.position)}},Yk={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:Kn,checker:(e,t,i)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Da||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||i.gameState.time-(t.lastRetrieveTime??0)<O_),perform:(e,t,i)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&(e.food.push(o.item),pI(t)),t.lastRetrieveTime=i.gameState.time,we(i,Ae.StorageRetrieve,t.position)}},zk={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:Kn,checker:(e,t,i)=>{var d;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Is||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const o=e.leaderId?i.gameState.entities.entities[e.leaderId]:void 0;if(!o||!((d=o.tribeControl)!=null&&d.diplomacy)||(t.ownerId?o.tribeControl.diplomacy[t.ownerId]:void 0)!==Et.Hostile||i.gameState.time-(t.lastStealTime??0)<b_)return!1;const c=AA({leaderId:t.ownerId},i.gameState);for(const u of c)if(q(e.position,u.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<=N_)return!1;return!0},perform:(e,t,i)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&e.food.push(o.item),t.lastStealTime=i.gameState.time,we(i,Ae.StorageSteal,t.position),be(i.gameState,ve.Attack,t.position,.5)}},jk={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,i)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!lr(e,t,i.gameState)||!Zv(t.position,us,e.id,i.gameState).valid),perform:(e,t,i)=>{t.ownerId=e.id,Jv(t.position,us,e.id,i.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",be(i.gameState,ve.BushClaimed,t.position,2,t.id)}},Xk={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,i)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!lr(e,t,i.gameState)||t.isBeingDestroyed),perform:(e,t,i)=>{t.isBeingDestroyed=!0,e.activeAction="idle",be(i.gameState,ve.Hit,t.position,1,t.id)}},Vk={id:"supplyTransfer",sourceType:"human",targetType:"human",maxDistance:je,checker:(e,t)=>!(e.activeAction!=="depositing"||t.activeAction!=="retrieving"||e.leaderId!==t.leaderId||e.food.length===0||t.food.length>=t.maxFood),perform:(e,t,i)=>{var c;const o=Math.min(((c=e.activeActionPayload)==null?void 0:c.amount)||1,e.food.length,t.maxFood-t.food.length),s=e.food.splice(0,o);t.food.push(...s);const l=gr(t,i.gameState);l&&l.aiBlackboard&&mI(l.aiBlackboard,t.id,"food"),e.activeAction="idle",e.target=void 0,e.activeActionPayload=void 0,t.activeAction="idle",t.target=void 0,we(i,Ae.StorageDeposit,t.position)}},qk={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:cu,checker:(e,t,i)=>{const[o]=t.stateMachine??[],s=o===Vn||o===Hn||o===gi;return e.isAdult&&s&&e.stateMachine[0]===rp&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<i.gameState.time)||!1},perform:(e,t,i)=>{const{gameState:o}=i;if(t.stateMachine=[Vt,{enteredAt:o.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/_o),l=Math.floor(py+s*(Tu-py));t.wood=Array.from({length:l},()=>({itemType:"item",type:Ot.Wood,id:o.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=o.time+1,we(i,Ae.Gather,e.position)}},Zk=[Ek,wk,Ck,_k,...kk,Ik,Sk,Tk,Wk,Yk,zk,jk,Xk,Vk,qk,Dk,Lk,Uk,Gk,Ok,bk,Bk,Nk,xk,Hk,Fk],Iy=Object.values(Zk.reduce((e,t)=>{const i=`${t.sourceType}-${t.targetType}`;e[i]||(e[i]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const o={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[i].interactions.push(o),e[i].maxDistance=Math.max(e[i].maxDistance,t.maxDistance),e},{}));let Sy=0;function Kk(e){const{gameState:t}=e,i=t,{width:o,height:s}=t.mapDimensions;Sy++;const l=Sy%2===0;for(let c=0;c<Iy.length;c++){const d=Iy[c],u=i.search[d.sourceType].all();for(let h=0;h<u.length;h++){const p=u[h],y=i.search[d.targetType].byRadius(p.position,d.maxDistance);for(let A=0;A<y.length;A++){const v=y[A];if(p.id===v.id)continue;const I=fn(p.position,v.position,o,s);for(let S=0;S<d.interactions.length;S++){const E=d.interactions[S];!E.isCollision&&l||I<=E.maxDistanceSq&&E.checker(p,v,e)&&E.perform(p,v,e)}}}}}function yI(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function Qk(e){const t=e.search.berryBush.byProperty("type","berryBush"),i=e.search.predator.byProperty("type","predator"),o=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let l;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,p=50+Math.random()*100;l={x:Math.max(50,Math.min(xe-50,u.position.x+Math.cos(h)*p)),y:Math.max(50,Math.min($e-50,u.position.y+Math.sin(h)*p))}}else l={x:50+Math.random()*(xe-100),y:50+Math.random()*($e-100)};let c=!0;const d=100;for(const u of i)if(Math.sqrt((l.x-u.position.x)**2+(l.y-u.position.y)**2)<d){c=!1;break}if(c){for(const u of o)if(Math.sqrt((l.x-u.position.x)**2+(l.y-u.position.y)**2)<d){c=!1;break}}if(c)return l}return{x:xe*.3+Math.random()*xe*.4,y:$e*.3+Math.random()*$e*.4}}function Jk(e){const t=e.search.prey.byProperty("type","prey"),i=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let l;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,p=100+Math.random()*150;l={x:Math.max(50,Math.min(xe-50,u.position.x+Math.cos(h)*p)),y:Math.max(50,Math.min($e-50,u.position.y+Math.sin(h)*p))}}else l={x:50+Math.random()*(xe-100),y:50+Math.random()*($e-100)};let c=!0;const d=150;for(const u of i)if(Math.sqrt((l.x-u.position.x)**2+(l.y-u.position.y)**2)<d){c=!1;break}if(c)return l}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*xe,y:50+Math.random()*100};case 1:return{x:xe-150+Math.random()*100,y:Math.random()*$e};case 2:return{x:Math.random()*xe,y:$e-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*$e}}}function eD(e){const t=e.search.human.byProperty("type","human"),i=e.search.berryBush.byProperty("type","berryBush");for(let o=0;o<20;o++){const s={x:50+Math.random()*(xe-100),y:50+Math.random()*($e-100)};let l=!0;const c=80,d=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){l=!1;break}if(l){for(const u of i)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<d){l=!1;break}}if(l)return s}return{x:Math.random()*xe,y:Math.random()*$e}}function vI(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const i=e;for(let o=0;o<t;o++){const s=Qk(i),l=o%2===0?"male":"female";gs(e.entities,s,l,void 0,void 0,Ya())}}function AI(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const i=e;for(let o=0;o<t;o++){const s=Jk(i),l=o%2===0?"male":"female";ms(e.entities,s,l,void 0,void 0,za())}}function tD(e){const t=e,i=t.search.prey.count(),o=t.search.predator.count();let s=!1;return i===0&&(vI(e,6),s=!0),o===0&&(AI(e,3),s=!0),s}function nD(e){const t=e,i=t.search.prey.count(),o=t.search.predator.count(),s=t.search.berryBush.count();let l=!1;if(i>0&&i<5){const c=Math.max(2,Math.floor(8-i));vI(e,c),l=!0}if(o>0&&o<2){const c=Math.max(1,Math.floor(3-o));AI(e,c),l=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let c=0;c<5;c++){const d=eD(t);el(e.entities,d,e.time)}l=!0}return l}const iD=1,oD=.3,rD=.8,Ty=.8,sD=.99,aD=.05;var II=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.NO_ACTION=14]="NO_ACTION",e))(II||{});const Yf=Object.keys(II).length/2;class lD{constructor(){Ht(this,"qTable",new Map);Ht(this,"epsilon",Ty);Ht(this,"lastState",null);Ht(this,"lastAction",null)}discretizeState(t,i,o){const s=Math.min(4,Math.floor(t/25)),l=Math.min(4,Math.floor(i/5)),c=Math.min(4,Math.floor(o/15));return`${s}-${l}-${c}`}getQValue(t,i){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(i)||0}setQValue(t,i,o){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(i,o)}getBestAction(t){let i=0,o=this.getQValue(t,0);for(let s=1;s<Yf;s++){const l=this.getQValue(t,s);l>o&&(o=l,i=s)}return i}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*Yf):this.getBestAction(t)}applyEmergencyCorrections(t,i,o,s){t<Ni*.5&&(s.ecosystem.preyGestationPeriod=Math.max(Zr,s.ecosystem.preyGestationPeriod*.8),s.ecosystem.preyProcreationCooldown=Math.max(Kr,s.ecosystem.preyProcreationCooldown*.8),s.ecosystem.preyHungerIncreasePerHour=Math.max(es,s.ecosystem.preyHungerIncreasePerHour*.9)),i<Bi*.6&&(s.ecosystem.predatorGestationPeriod=Math.max(Qr,s.ecosystem.predatorGestationPeriod*.75),s.ecosystem.predatorProcreationCooldown=Math.max(Jr,s.ecosystem.predatorProcreationCooldown*.75),s.ecosystem.predatorHungerIncreasePerHour=Math.max(ts,s.ecosystem.predatorHungerIncreasePerHour*.85)),o<Hi*.5&&(s.ecosystem.berryBushSpreadChance=Math.min(Aa,s.ecosystem.berryBushSpreadChance*1.2)),t>Ni*1.4&&(s.ecosystem.preyHungerIncreasePerHour=Math.min(vo,s.ecosystem.preyHungerIncreasePerHour*1.05)),i>Bi*1.4&&(s.ecosystem.predatorHungerIncreasePerHour=Math.min(Ao,s.ecosystem.predatorHungerIncreasePerHour*1.05)),o>Hi*1.4&&(s.ecosystem.berryBushSpreadChance=Math.max(Fi,s.ecosystem.berryBushSpreadChance*.95))}calculateReward(t,i,o){const s=Math.abs(t-Ni),l=Math.abs(i-Bi),c=Math.abs(o-Hi),d=s/Ni,u=l/Bi,h=c/Hi,p=d+u+h;return 100*Math.exp(-p*2)-50}applyAction(t,i){switch(t){case 0:i.ecosystem.preyGestationPeriod=Math.min(er,i.ecosystem.preyGestationPeriod+.2*(er-Zr));break;case 1:i.ecosystem.preyGestationPeriod=Math.max(Zr,i.ecosystem.preyGestationPeriod-.2*(er-Zr));break;case 2:i.ecosystem.preyProcreationCooldown=Math.min(tr,i.ecosystem.preyProcreationCooldown+.2*(tr-Kr));break;case 3:i.ecosystem.preyProcreationCooldown=Math.max(Kr,i.ecosystem.preyProcreationCooldown-.2*(tr-Kr));break;case 4:i.ecosystem.preyHungerIncreasePerHour=Math.min(vo,i.ecosystem.preyHungerIncreasePerHour+.2*(vo-es));break;case 5:i.ecosystem.preyHungerIncreasePerHour=Math.max(es,i.ecosystem.preyHungerIncreasePerHour-.2*(vo-es));break;case 6:i.ecosystem.predatorGestationPeriod=Math.min(nr,i.ecosystem.predatorGestationPeriod+.2*(nr-Qr));break;case 7:i.ecosystem.predatorGestationPeriod=Math.max(Qr,i.ecosystem.predatorGestationPeriod-.2*(nr-Qr));break;case 8:i.ecosystem.predatorProcreationCooldown=Math.min(ir,i.ecosystem.predatorProcreationCooldown+.2*(ir-Jr));break;case 9:i.ecosystem.predatorProcreationCooldown=Math.max(Jr,i.ecosystem.predatorProcreationCooldown-.2*(ir-Jr));break;case 10:i.ecosystem.predatorHungerIncreasePerHour=Math.min(Ao,i.ecosystem.predatorHungerIncreasePerHour+.2*(Ao-ts));break;case 11:i.ecosystem.predatorHungerIncreasePerHour=Math.max(ts,i.ecosystem.predatorHungerIncreasePerHour-.2*(Ao-ts));break;case 12:i.ecosystem.berryBushSpreadChance=Math.min(Aa,i.ecosystem.berryBushSpreadChance+.2*(Aa-Fi));break;case 13:i.ecosystem.berryBushSpreadChance=Math.max(Fi,i.ecosystem.berryBushSpreadChance-.2*(Aa-Fi));break}}updateQTable(t,i,o,s){const l=this.getQValue(t,i),c=Math.max(...Array.from({length:Yf},(u,h)=>this.getQValue(s,h))),d=l+oD*(o+rD*c-l);this.setQValue(t,i,d)}step(t){const i=t,o=i.search.prey.count(),s=i.search.predator.count(),l=i.search.berryBush.count();this.applyEmergencyCorrections(o,s,l,t);const c=this.discretizeState(o,s,l);if(this.lastState!==null&&this.lastAction!==null){const u=this.calculateReward(o,s,l);this.updateQTable(this.lastState,this.lastAction,u,c)}const d=this.chooseAction(c);this.applyAction(d,t),this.epsilon=Math.max(aD,this.epsilon*sD),this.lastState=c,this.lastAction=d}reset(){this.qTable.clear(),this.epsilon=Ty,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let SI=new lD;function cD(e){tD(e),nD(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=Zr+(er-Zr)*.3,e.ecosystem.preyProcreationCooldown=Kr+(tr-Kr)*.3,e.ecosystem.preyHungerIncreasePerHour=es+(vo-es)*.3,e.ecosystem.predatorGestationPeriod=Qr+(nr-Qr)*.3,e.ecosystem.predatorProcreationCooldown=Jr+(ir-Jr)*.3,e.ecosystem.predatorHungerIncreasePerHour=ts+(Ao-ts)*.3,e.ecosystem.berryBushSpreadChance=Fi+(Aa-Fi)*.7),SI.step(e)}function uD(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<iD)&&(e.ecosystem.lastUpdateTime=e.time,cD(e))}function dD(){return SI.getStats()}function fD(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function hD(e){const{gameState:t}=e,i=t.time,o=t.scheduledEvents.filter(l=>l.scheduledTime<=i),s=t.scheduledEvents.filter(l=>l.scheduledTime>i);t.scheduledEvents=s;for(const l of o)switch(l.type){case"ranged-impact":{const c=t.entities.entities[l.data.targetId];if(!c||c.hitpoints<=0)continue;c.hitpoints-=l.data.damage,c.movementSlowdown={modifier:fu,endTime:t.time+hu};const d=Xe(l.data.attackerPosition,c.position,t.mapDimensions.width,t.mapDimensions.height),u=It(d,l.data.pushbackForce);c.forces.push(u),be(t,ve.Hit,c.position,We,c.id),c.hitpoints<=0?we(e,Ae.HumanDeath,c.position):we(e,Ae.Attack,c.position);break}}}const TI="ownedIndices",Ey="frontierScanIndex",Oa="frontierCandidates";function pD(e){const{gameState:t}=e,i=t,s=i.search.human.all().filter(h=>h.leaderId===h.id),{width:l,height:c}=t.mapDimensions,d=Math.ceil(l/Ce),u=Math.ceil(c/Ce);for(const h of s){if(!h.aiBlackboard)continue;const p=De.get(h.aiBlackboard,TI)||[];if(p.length===0)continue;let y=De.get(h.aiBlackboard,Ey)||0;const A=De.get(h.aiBlackboard,Oa)||{},v=pi(h.id,t),I=20;for(let E=0;E<I;E++){y>=p.length&&(y=0);const _=p[y];y=(y+1)%p.length;const w=_%d,C=Math.floor(_/d),R=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:b,dy:M}of R){const B=(w+b+d)%d,F=(C+M+u)%u,G=F*d+B,Y=t.terrainOwnership[G],J=Y!==null&&$i(h.id,Y,t);if(Y===null||J){let z=0;for(const{dx:x,dy:re}of R){const le=(B+x+d)%d,Ee=(F+re+u)%u;t.terrainOwnership[Ee*d+le]===h.id&&z++}const te=z*20,K=uh(G,l),se=i.search.berryBush.byRadius(K,100),ce=i.search.tree.byRadius(K,100),ne=se.length*10+ce.length*5,$=J?50:0,X=q(K,v,l,c)/100*5,D=te+ne+$-X;A[G.toString()]={score:D,fromIdx:_,lastSeenTime:t.time}}}}const S=Object.entries(A).sort((E,_)=>_[1].score-E[1].score);if(S.length>50){const E={};for(let _=0;_<50;_++){const[w,C]=S[_];E[w]=C}De.set(h.aiBlackboard,Oa,E)}else De.set(h.aiBlackboard,Oa,A);De.set(h.aiBlackboard,Ey,y)}}function gD(e){var y,A,v;const{gameState:t}=e,i=t,o=i.search.human.all(),s=new Map,l=new Set;for(let I=0;I<o.length;I++){const S=o[I];S.leaderId&&(s.has(S.leaderId)||s.set(S.leaderId,[]),s.get(S.leaderId).push(S),S.leaderId===S.id&&l.add(S.id))}const c=Object.values(t.tasks),d=new Map;for(let I=0;I<c.length;I++){const S=c[I];S.creatorEntityId&&(d.has(S.creatorEntityId)||d.set(S.creatorEntityId,[]),d.get(S.creatorEntityId).push(S))}const u=i.search.building.all(),h=new Map;for(let I=0;I<u.length;I++){const S=u[I];if(S.ownerId){const E=t.entities.entities[S.ownerId],_=E==null?void 0:E.leaderId;_&&(h.has(_)||h.set(_,[]),h.get(_).push(S))}}const p=new Map;for(const I of l)p.set(I,pi(I,t));for(const I of l){const S=t.entities.entities[I];if(!S)continue;const E=[];for(let F=0;F<t.terrainOwnership.length;F++)t.terrainOwnership[F]===I&&E.push(F);De.set(S.aiBlackboard,TI,E);const _=s.get(I)||[];if(_.length<RA)continue;const w=_.filter(F=>F.isAdult);if(w.length===0)continue;const C=d.get(I)||[],R=F=>C.some(G=>G.type===F),b=h.get(I)||[],M=[];for(const[F,G]of p.entries())F!==I&&M.push(G);if(!R(W.HumanPlaceStorage)){const F=b.filter(te=>te.buildingType===fe.StorageSpot);let G=0,Y=0;for(let te=0;te<F.length;te++){const K=F[te];G+=((y=K.storedItems)==null?void 0:y.length)||0,Y+=K.storageCapacity||0}const J=Y>0?G/Y:0;if(F.length===0||J>dC){const te=F.length===0?pC:Mf,K=kf(fe.StorageSpot,I,t,Rf,te,S.position,M);K&&Ac(I,W.HumanPlaceStorage,K,t)}}if(!R(W.HumanPlaceBonfire)){const F=b.filter(se=>se.buildingType===fe.Bonfire),G=p.get(I),J=ja(t.temperature,G,t.time,t.mapDimensions.width,t.mapDimensions.height)<bC&&F.length===0,z=F.length>0&&F.length<Math.ceil(w.length/FC);let te;const K=_.filter(se=>ja(t.temperature,se.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<Jo+5?F.every($=>q(se.position,$.position,t.mapDimensions.width,t.mapDimensions.height)>_a*1.5):!1);if(K.length>=3){const se=K.reduce((ne,$)=>ne+$.position.x,0)/K.length,ce=K.reduce((ne,$)=>ne+$.position.y,0)/K.length;te={x:se,y:ce}}if(J||z||te){const se=kf(fe.Bonfire,I,t,Rf,Mf,te||S.position,M);se&&Ac(I,W.HumanPlaceBonfire,se,t)}}if(!R(W.HumanPlacePlantingZone)){const G=b.filter(J=>J.buildingType===fe.PlantingZone&&V1(J,t)).reduce((J,z)=>J+TA(z),0),Y=Math.max(hC,w.length*fC);if(G<Y){const J=kf(fe.PlantingZone,I,t,Rf,Mf,S.position,M);J&&Ac(I,W.HumanPlacePlantingZone,J,t)}}if((((v=(A=S.tribeControl)==null?void 0:A.armyControl)==null?void 0:v.expandBorders)??0)>=2){const F=De.get(S.aiBlackboard,Oa)||{},{width:G,height:Y}=t.mapDimensions,J=b.filter(K=>K.buildingType===fe.BorderPost),z=C.filter(K=>K.type===W.HumanPlaceBorderPost);for(const K in F){const se=parseInt(K,10),ce=t.terrainOwnership[se],ne=ce!==null&&$i(S.id,ce,t);if(ce===I||ce!==null&&!ne){delete F[K];continue}const $=uh(se,G);(J.some(X=>fn($,X.position,G,Y)<100*100)||z.some(X=>fn($,X.position,G,Y)<100*100))&&delete F[K]}De.set(S.aiBlackboard,Oa,F);const te=3;if(z.length<te){const K=Object.entries(F).map(([$,j])=>({idx:parseInt($,10),...j})).sort(($,j)=>j.score-$.score),se=[];for(const $ of K){if(se.length>=te-z.length)break;const j=uh($.idx,G);se.every(D=>fn(j,D,G,Y)>100*100)&&se.push(j)}const ce=new Set(z.map($=>{const j=$.id.split("-");return parseInt(j[j.length-1],10)}).filter($=>!isNaN($))),ne=[];for(let $=0;$<te;$++)ce.has($)||ne.push($);for(let $=0;$<se.length;$++)Ac(I,W.HumanPlaceBorderPost,se[$],t,ne[$])}}}}function Ac(e,t,i,o,s=0){const l=`${W[t]}-${e}-${s}`;o.tasks[l]={id:l,position:i,type:t,creatorEntityId:e,target:i,validUntilTime:o.time+12}}function mD(e){const{gameState:t}=e,s=t.search.human.all().filter(l=>l.leaderId===l.id);for(const l of s){if(!l.aiBlackboard)continue;const c=`diplomacy-${l.id}`;if(t.tasks[c])continue;const d=De.get(l.aiBlackboard,"lastDiplomacyCheckTime")??-1/0;if(t.time-d<W0)continue;const u={id:c,type:W.HumanDiplomacy,position:l.position,creatorEntityId:l.id,validUntilTime:t.time+W0};t.tasks[c]=u}}const yD=1/60;function vD(e,t){if(!e.cameraFollowingPlayer)return;const i=ft(e);i&&(e.viewportCenter=Nc(e.viewportCenter,i.position,Uc*t))}function Cu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const i=Date.now();i-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(Rh(e),e.lastAutosaveTime=i)}for(;t>0;){const i=eu(e),o=Math.min(t,yD),s=o*(Dt/Gt);i.time+=s,vD(i,o),oC(i),rR(i),uD(i),t_(i),KP(i),rC(i),hD({gameState:i}),tk({gameState:i,deltaTime:o}),Kk({gameState:i,deltaTime:o}),pD({gameState:i}),Math.floor(i.time)>Math.floor(i.time-s)&&(z1(i),gD({gameState:i}),mD({gameState:i})),yI(i),ck(i,o),fD(i),e=i,t-=o}return e}function AD(e,t){if(!e.leaderId)return!1;const i=t.entities.entities[e.leaderId];return!i||!i.tribeControl?!1:t.search.human.byProperty("leaderId",i.id).filter(s=>s.isAdult).length>=l_}function zf(e,t,i){e.save();const{x:o,y:s,width:l,height:c}=t.rect,d=lA;if(e.beginPath(),e.moveTo(o+d,s),e.lineTo(o+l-d,s),e.quadraticCurveTo(o+l,s,o+l,s+d),e.lineTo(o+l,s+c-d),e.quadraticCurveTo(o+l,s+c,o+l-d,s+c),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),e.lineTo(o,s+d),e.quadraticCurveTo(o,s,o+d,s),e.closePath(),e.fillStyle=t.isDisabled?cA:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*hA)+1)/2;e.strokeStyle=fA,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<zc){const h=1-u/zc;e.fillStyle=dA,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}i&&!t.isDisabled&&(e.fillStyle=Zh,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?uA:t.textColor,t.icon?(e.font=`${c*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+l/2,s+c/2),t.text&&(e.font=`${c*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+l-4,s+c-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+l/2,s+c/2)),e.restore()}function ID(e,t,i,o){e.save(),e.font=`${Z0}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const l=e.measureText(i).width,c=Z0,d=l+K0*2,u=c+K0*2,h=o.x-d/2,p=e.canvas.height,y=t.y<p/2?t.y+t.height-Q0:t.y-u+Q0;e.fillStyle=c1,e.fillRect(h,y,d,u),e.fillStyle=u1,e.fillText(i,o.x,y+u/2+c/2),e.restore()}function SD(e,t,i){e.save();const o=ft(t),s=[{id:"fastForwardButton",action:oe.FastForward,text:"FFWD [T]",currentWidth:bi*1.3,backgroundColor:Tn,textColor:ot,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:oe.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?Ia:Tn,currentWidth:t.isPaused?bi*1.4:bi*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:ot},{id:"muteButton",action:oe.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?Ia:Tn,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:bi,rect:{x:0,y:0,width:0,height:0},textColor:ot},{id:"returnToIntroButton",action:oe.ReturnToIntro,text:"EXIT",backgroundColor:Tn,tooltip:"Return to Main Menu [ESC]",currentWidth:bi*.9,rect:{x:0,y:0,width:0,height:0},textColor:ot}];if(t.uiButtons.push(...s),o){const h=op(t,o),p=new Set(h.map(w=>w.type));let y=[{playerAction:ue.Gather,buttonAction:oe.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>o.isAdult===!0},{playerAction:ue.Eat,buttonAction:oe.CommandEat,shortcut:"F",name:"Eat"},{playerAction:ue.Plant,buttonAction:oe.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>o.isAdult===!0},{playerAction:ue.Procreate,buttonAction:oe.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>o.isAdult===!0},{playerAction:ue.FeedChild,buttonAction:oe.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>o.isAdult===!0},{playerAction:ue.Attack,buttonAction:oe.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>o.isAdult===!0&&o.leaderId===o.id},{playerAction:ue.ArmyControl,buttonAction:oe.OpenArmyControl,shortcut:"V",name:"Army Control",condition:()=>o.isAdult===!0&&o.leaderId===o.id&&mi(o.id,t).length>c_},{playerAction:ue.TribeSplit,buttonAction:oe.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>o.leaderId!==void 0&&o.leaderId!==o.id&&o.isAdult===!0},{playerAction:ue.Build,buttonAction:oe.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>o.isAdult===!0&&o.leaderId===o.id&&mi(o.id,t).length>RA},{playerAction:ue.Build,buttonAction:oe.OpenRoleManager,shortcut:"U",name:"Roles",toggleKey:"roleManagement",condition:()=>o.isAdult===!0&&o.leaderId===o.id&&AD(o,t)}];y=y.filter(w=>w.condition?w.condition():!0);const A=1,v=y.length,I=v*An+(v-1)*Yo,S=A*An+(A-1)*Yo,E=(i-I)/2,_=e.canvas.height-S-20;if(y.forEach((w,C)=>{const R=C%v,b=Math.floor(C/v),M=E+R*(An+Yo),B=_+b*(An+Yo),F=!!w.toggleKey,G=F&&t.autopilotControls.behaviors[w.toggleKey],Y=!p.has(w.playerAction),z=w.playerAction===ue.Build&&t.buildMenuOpen,te=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",K=F?`${w.name}${te}`:w.name,se=G||z||w.buttonAction===oe.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)?Ia:Tn,ce={id:`commandButton_${w.name}`,action:w.buttonAction,rect:{x:M,y:B,width:An,height:An},icon:w.buttonAction===oe.OpenRoleManager?"":yu[w.playerAction],text:w.shortcut,backgroundColor:se,textColor:ot,currentWidth:An,tooltip:K,isDisabled:Y,activated:G||w.buttonAction===oe.CommandBuild&&z||w.buttonAction===oe.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)};t.uiButtons.push(ce)}),t.buildMenuOpen){const w=[{id:"buildMenu_storageSpot",action:oe.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:oe.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_bonfire",action:oe.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:oe.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:oe.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"}],C=w.length,R=C*An+(C-1)*Yo,b=(i-R)/2,M=_-An-Yo;w.forEach((B,F)=>{const G=b+F*(An+Yo),Y=M,J=B.action===oe.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||B.action===oe.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||B.action===oe.SelectBorderPost&&t.selectedBuildingType==="borderPost"||B.action===oe.SelectBonfire&&t.selectedBuildingType==="bonfire"||B.action===oe.SelectRemovalTool&&t.selectedBuildingType==="removal",z={id:B.id,action:B.action,rect:{x:G,y:Y,width:An,height:An},icon:B.icon,text:B.shortcut,backgroundColor:J?Ia:Tn,textColor:ot,currentWidth:An,tooltip:B.name,activated:J};t.uiButtons.push(z),zf(e,z,t.hoveredButtonId===z.id)})}}let l=i-Ve;s.forEach(h=>{const p=Ve,y=l-h.currentWidth;h.rect={x:y,y:p,width:h.currentWidth,height:aA},zf(e,h,t.hoveredButtonId===h.id),l-=h.currentWidth+l1});let c=null;t.uiButtons.filter(h=>h.id.startsWith("commandButton_")||h.id.startsWith("buildMenu_")).forEach(h=>{c||(c={x:h.rect.x,y:h.rect.y,width:h.rect.width,height:h.rect.height}),c.x=Math.min(c.x,h.rect.x),c.y=Math.min(c.y,h.rect.y),c.width=Math.max(c.width,h.rect.x+h.rect.width-c.x),c.height=Math.max(c.height,h.rect.y+h.rect.height-c.y),h.id.startsWith("commandButton_")&&zf(e,h,t.hoveredButtonId===h.id)});const u=t.hoveredButtonId?t.uiButtons.find(h=>h.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&ID(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:c}}function TD(e){e.save(),e.fillStyle=d1,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=f1,e.font=`${h1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function Th(e,t,i,o){const s=t.x-i.width/2,l=t.y-i.height/2,c=s+e.x,d=l+e.y,u=(c%o.width+o.width)%o.width,h=(d%o.height+o.height)%o.height;return{x:u,y:h}}function tl(e,t,i,o){let s=e.x-t.x,l=e.y-t.y;return Math.abs(s)>o.width/2&&(s=s-Math.sign(s)*o.width),Math.abs(l)>o.height/2&&(l=l-Math.sign(l)*o.height),{x:s+i.width/2,y:l+i.height/2}}function ba(e,t,i,o){const s=tl(e.position,t,i,o),c=("radius"in e?e.radius:20)+20;return s.x>=-c&&s.x<=i.width+c&&s.y>=-c&&s.y<=i.height+c}function Nn(e,t,i,o,s,...l){const c={...s.position};for(let d=-i;d<=i;d+=i)for(let u=-t;u<=t;u+=t)s.position.x=c.x+u,s.position.y=c.y+d,o(e,s,...l);s.position=c}function EI(e,t){const i=document.createElement("canvas");i.width=e,i.height=t;const o=i.getContext("2d");if(!o)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:i,ctx:o}}function is(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function dr(e,t){return Math.round(e*t)/t}function dp(e,t=8){const o=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(o/(Math.PI*2)*t)%t}function fp(e,t=8){const i=e/t*Math.PI*2;return[Math.cos(i),Math.sin(i)]}const ED=25,wD=0,wy=28;function wI(e,t,i,o,s,l,c,d,u,h){e.save();const{x:p,y}=tl(t,c,{width:d,height:u},h);e.strokeStyle=o,e.lineWidth=l,e.setLineDash(s),e.beginPath(),e.arc(p,y,i+pu,0,2*Math.PI),e.stroke(),e.restore()}function CD(e,t,i,o,s,l,c){if(t.length===0)return;e.save(),t.forEach(y=>{y.targetEntity&&wI(e,y.targetEntity.position,y.targetEntity.radius,Vh,qh,2,o,s,l,c)}),e.font=`${ds}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:d,y:u}=tl(i.position,o,{width:s,height:l},c);let h=0,p={};t.forEach(y=>{const A=yu[y.type];if(y.targetEntity){p[y.targetEntity.id]=(p[y.targetEntity.id]||0)+1;const v=y.targetEntity.position.x-o.x+s/2,I=y.targetEntity.position.y-o.y+l/2,S=`${A}${y.key.toUpperCase()}`,E=I-y.targetEntity.radius-pu-ds/2-(p[y.targetEntity.id]-1)*wy;e.fillText(S,v,E)}else{e.textAlign="left";const v=`${A}${y.key.toUpperCase()}`,I=d+ED,E=u+wD+h*wy;e.fillText(v,I,E),h++,e.textAlign="center"}}),e.restore()}function _D(e,t,i,o,s,l,c){const h=Nf+8+30,p={x:iy,y:l-iy-h,width:Nf,height:Nf};t.minimapRect=p,e.save(),e.fillStyle=L1,e.fillRect(p.x,p.y,p.width,p.height),e.strokeStyle=F1,e.lineWidth=2,e.strokeRect(p.x,p.y,p.width,p.height);const{width:y,height:A}=t.mapDimensions,v=Math.ceil(y/Ce),I=Math.ceil(A/Ce),S=new Map;o.forEach((ae,ye)=>{const Se=ae.isPlayerTribe?0:ye%(on.length-1)+1;S.set(ae.leaderId,on[Se])});const E=p.width/v,_=p.height/I,w=p.x+p.width/2,C=p.y+p.height/2,R=v>400?4:v>200?2:1;for(let ae=0;ae<I;ae+=R)for(let ye=0;ye<v;ye+=R){const Se=ae*v+ye,ie=t.terrainOwnership[Se];if(ie!==null){const pe=(ye+.5)*Ce,Ne=(ae+.5)*Ce,Te=Xe(i,{x:pe,y:Ne},y,A),En=w+Te.x/y*p.width,Qe=C+Te.y/A*p.height,Ze=t.hoveredMinimapTribeId===ie;if(e.fillStyle=S.get(ie)||"#888",Ze){const wn=(Math.sin(t.time*5)+1)/2;e.globalAlpha=.6+wn*.4}else e.globalAlpha=.8;e.fillRect(En-E*R/2,Qe-_*R/2,E*R,_*R)}}e.globalAlpha=1,e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip();for(const ae of o){if(!ae.territoryCenter)continue;const ye=Xe(i,ae.territoryCenter,y,A),Se=w+ye.x/y*p.width,ie=C+ye.y/A*p.height;e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="white",e.fillText(ae.tribeBadge,Se,ie),ae.isPlayerTribe&&(e.strokeStyle="gold",e.lineWidth=1,e.beginPath(),e.arc(Se,ie,10,0,Math.PI*2),e.stroke())}e.restore();const b=s/c,M=l/c,B=b/y*p.width,F=M/A*p.height;e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.strokeRect(w-B/2,C-F/2,B,F),e.restore(),e.restore();const G=p.y+p.height+8,Y=p.x,J=G,z="recenter_camera_btn",te={id:z,action:oe.RecenterCamera,rect:{x:Y,y:J,width:30,height:30},text:"",currentWidth:30,backgroundColor:t.cameraFollowingPlayer?Ia:Tn,textColor:ot,tooltip:"Lock camera to player"};t.uiButtons.push(te),e.fillStyle=t.hoveredButtonId===z?"#4a5568":te.backgroundColor,e.fillRect(Y,J,30,30),e.strokeStyle="#666",e.strokeRect(Y,J,30,30);const K=Y+30/2,se=J+30/2,ce=30*.35;e.strokeStyle=ot,e.lineWidth=2,e.beginPath(),e.arc(K,se,ce,0,Math.PI*2),e.stroke();const ne=ce*.6;e.beginPath(),e.moveTo(K-ne,se),e.lineTo(K+ne,se),e.moveTo(K,se-ne),e.lineTo(K,se+ne),e.stroke(),e.fillStyle=ot,e.beginPath(),e.arc(K,se,2,0,Math.PI*2),e.fill();const $="open_tribe_modal_btn",j=`Tribes (${o.length})`;e.font='10px "Press Start 2P", Arial';const X=e.measureText(j),D=Math.max(30,X.width+16),x=30,re=Y+30+8,le=G,Ee={id:$,action:oe.OpenTribeModal,rect:{x:re,y:le,width:D,height:x},text:j,currentWidth:D,backgroundColor:Tn,textColor:ot,tooltip:"View all tribes and diplomacy"};t.uiButtons.push(Ee),e.fillStyle=t.hoveredButtonId===$?"#4a5568":Tn,e.fillRect(re,le,D,x),e.strokeStyle="#666",e.strokeRect(re,le,D,x),e.fillStyle=ot,e.textAlign="center",e.textBaseline="middle",e.fillText(j,re+D/2,le+x/2)}const Me=(e,t,i,o,s,l,c)=>{l==="transparent"||o<=0||s<=0||(e.fillStyle=l,e.fillRect(Math.floor(t*c),Math.floor(i*c),Math.ceil(o*c),Math.ceil(s*c)))},Cy=10,_y=10,ai=6,Ri=4,Ic=2,PD=5,bn=4,RD=2,zt=4,MD=2,at=3,Wr=2,go=0,Na=go+Ri-1,Qt=Na,gt=Na+bn-1,kD="rgba(0, 0, 0, 0.4)",DD=4,OD=1,hp={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,i,o,s,l,c,d="male",u=20,h=[1,0],p=!1,y=0){const A=["dead","stunned"].includes(c),v=A?_y+4:Cy,I=A?Cy+4:_y+at,S=.15,E=Math.min(o*(1-2*S)/v,s*(1-2*S)/I),_=v*E,w=I*E,C=t+(o-_)/2,R=i+(s-w)/2;e.save(),h[0]<0&&!A?(e.translate(C+_,R),e.scale(-1,1)):e.translate(C,R);const M="#D09A5A",B=u>50?"#BDBDBD":"#281808",F="#7F5C4A",G="#6B4F3A",Y="#E0D8C0",J="#A0522D",z=1-Math.max(0,Math.min(100,y))/100*.2,te=d==="male"?1.1:.9,K=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let se=PD*z*te*K,ce=RD*z*te*K,ne=MD*z*K;p&&d==="female"&&(se*=1.5);const $=Math.round((v-se)/2),j=Math.round((v-ai)/2),X=$-ce,D=$+se,x=1,re=$+(se/2-x/2)-ne,le=$+(se/2+x/2),Ee=h[1]<-.2&&Math.abs(h[0])<.7,ae=ie=>{e.fillStyle=kD,e.beginPath();const pe=v/2,Ne=ie;e.ellipse(Math.floor(pe*E),Math.floor(Ne*E),Math.max(1,Math.floor(DD*E)),Math.max(1,Math.floor(OD*E)),0,0,2*Math.PI),e.fill()},ye=(ie,pe)=>{d==="male"?(Me(e,$,Na+ie,se,bn-Wr,pe,E),Me(e,$,Na+bn-Wr+ie,se,Wr,F,E)):Me(e,$,Na+ie,se,bn,G,E)},Se=(ie,pe)=>{Ee?Me(e,j,go+ie,ai,Ri,B,E):(Me(e,j,go+ie,ai,Ri,pe,E),Me(e,j,go+ie,ai,Ic,B,E),d==="female"?(Me(e,j-1,go+Ic+ie,1,Ri,B,E),Me(e,j+ai,go+Ic+ie,1,Ri,B,E)):Me(e,j+1,go+2+ie,ai-2,Ri-2,B,E))};switch(c){case"idle":{const ie=l*Math.PI*2,pe=Math.sin(ie)*.5,Te=(Math.cos(ie*2)+1)*.25;ae(gt+at+1),Me(e,re+pe,gt+Te,ne,at,M,E),Me(e,le-pe,gt+Te,ne,at,M,E),ye(Te,M),Me(e,X,Qt+Te,ce,zt,M,E),Me(e,D,Qt+Te,ce,zt,M,E),Se(Te,M);break}case"walk":{const ie=l*Math.PI*2,pe=Math.sin(ie)*2,Te=Math.abs(Math.cos(ie))*1;ae(gt+at+1),Me(e,re+pe,gt+Te,ne,at,M,E),Me(e,le-pe,gt+Te,ne,at,M,E),ye(Te,M),Me(e,X-pe,Qt+Te,ce,zt,M,E),Me(e,D+pe,Qt+Te,ce,zt,M,E),Se(Te,M);break}case"gathering":{const ie=l*Math.PI*2,pe=1,Ne=(Math.sin(ie)+1)/2*2,Te=pe+Math.abs(Math.cos(ie))*.5;ae(gt+at+1),Me(e,re,gt+Te,ne,at-pe,M,E),Me(e,le,gt+Te,ne,at-pe,M,E),ye(Te,M),Me(e,X+1,Qt+Te-Ne,ce,zt,M,E),Me(e,D-1,Qt+Te-Ne,ce,zt,M,E),Se(Te,M);break}case"eat":{ae(gt+at+1),Me(e,re,gt+1,ne,at-1,M,E),Me(e,le,gt+1,ne,at-1,M,E),ye(1,M);const Ne=(Math.sin(l*Math.PI*4)+1)/2,Te=j+ai/2,En=go+Ri/2,Qe=D+(Te-D)*Ne,Ze=Qt+1+(En-(Qt+1))*Ne;Me(e,X,Qt+1,ce,zt,M,E),Me(e,Qe,Ze,ce,zt,M,E),Me(e,Qe,Ze-1,1,1,J,E),Se(1,M);break}case"procreate":{const ie=(Math.sin(l*Math.PI*8)+1)/4,pe=(Math.sin(l*Math.PI*6)+1)*.5,Ne=1.5,Te=Ne-pe;ae(gt+at+1),Me(e,re,gt+Te,ne,at-Ne,M,E),Me(e,le,gt+Te,ne,at-Ne,M,E),ye(Te,M),Me(e,X,Qt+Te,ce,zt,M,E),Me(e,D,Qt+Te,ce,zt,M,E),Se(Te,M),e.globalAlpha=ie,ye(Te,"white"),e.globalAlpha=1;break}case"attacking":{const ie=Math.sin(l*Math.PI)*1.5,pe=Math.abs(Math.sin(l*Math.PI));ae(gt+at+1),Me(e,re-ie,gt+pe,ne,at,M,E),Me(e,le+ie*.5,gt+pe,ne,at,M,E),ye(pe,M),Me(e,X,Qt+pe-2,ce,zt,M,E),Me(e,D,Qt+pe-2.5,ce,zt,M,E),Se(pe,M);break}case"defending":{ae(gt+at+1),Me(e,re,gt+1,ne,at-1,M,E),Me(e,le,gt+1,ne,at-1,M,E),ye(1,M),Me(e,X-1,Qt+1-1,ce,zt,M,E),Me(e,D+1,Qt+1-1,ce,zt,M,E),Se(1,M);break}case"stunned":case"dead":{const ie=c==="dead",pe=ie?Math.min(1,l):0,Ne=pe>.5?Y:M,Te=d==="male"?F:G,En=pe>.8?"transparent":B,Qe=v/2,Ze=I/2,wn=2;ae(I-1),Me(e,Qe-ne-wn,Ze,ne,at,Ne,E),Me(e,Qe+wn,Ze,ne,at,Ne,E),Me(e,Qe-ce-wn,Ze-bn+1,ce,zt,Ne,E),Me(e,Qe+wn,Ze-bn+1,ce,zt,Ne,E);const rn=Qe-se/2,Cn=Ze-bn/2;d==="male"?(pe<.7&&Me(e,rn,Cn+bn-Wr,se,Wr,Te,E),Me(e,rn,Cn,se,bn-Wr,Ne,E)):pe<.7?Me(e,rn,Cn,se,bn,Te,E):Me(e,rn,Cn,se,bn,Ne,E);const Jn=Qe-ai/2,ei=Ze-bn/2-Ri+1;if(Me(e,Jn,ei,ai,Ri,Ne,E),En!=="transparent"&&Me(e,Jn,ei,ai,Ic,En,E),ie&&pe>.6){const Wi="#B0A890";for(let Mo=0;Mo<3;Mo++)Me(e,rn+1,Cn+Mo*1+1,se-2,.5,Wi,E)}break}default:Me(e,0,0,v,I,"magenta",E);break}e.restore()}};function bD(e,t,i,o,s){const l=t.x,c=t.y-i-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(l-o/2,c,o,o/2),e.fill(),e.beginPath(),e.moveTo(l-o/2,c),e.lineTo(l-o/4,c-o/3),e.lineTo(l-o/6,c),e.moveTo(l-o/6,c),e.lineTo(l,c-o/2),e.lineTo(l+o/6,c),e.moveTo(l+o/6,c),e.lineTo(l+o/4,c-o/3),e.lineTo(l+o/2,c),e.stroke(),e.restore()}function Va(e,t,i,o,s,l=!1,c=!1,d=!1,u=!1){o<Fh&&(i=i*.75),hp.render(e,t.x-i/2,t.y-i/2,i,i,0,"idle",s,o,[0,0],!1,0);let h,p;l?(h=e1,p=iA):c?(h=t1,p=sA):d?(h=n1,p=rA):u&&(h=i1,p=oA),h&&p&&bD(e,t,i/2,h,p)}function ND(e,t,i,o,s,l){if(e.save(),o.length===0){e.restore();return}const c=o.length*s,d=4;let u;const h=c+(o.length-1)*d;o.length>1&&h>l?u=(l-c)/(o.length-1):u=d,o.length<=1&&(u=0);for(let p=0;p<o.length;p++){const{member:y,isPlayer:A,isHeir:v,isPartner:I,isParent:S}=o[p],E=t+p*(s+u)+s/2,_=i+s/4;Va(e,{x:E,y:_},s,y.age,y.gender,A,v,I,S)}e.restore()}function BD(e,t,i,o,s){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,o,s);const l=500,c=Math.min(s*.8,i.length*(aa+V0)+120),d=(o-l)/2,u=(s-c)/2;e.fillStyle="#2d3748",e.strokeStyle="#4a5568",e.lineWidth=4,e.fillRect(d,u,l,c),e.strokeRect(d,u,l,c),e.fillStyle="#fff",e.font='20px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="top",e.fillText("WORLD TRIBES",o/2,u+30);const h=u+80,p=l-la*4,y=d+la*2;for(let w=0;w<i.length;w++){const C=i[w],R=h+w*(aa+V0);if(R+aa>u+c-60)break;const b=R+aa/2;C.isPlayerTribe&&(e.fillStyle="rgba(255, 215, 0, 0.2)",e.fillRect(y,R,p,aa));let M=y+la;if(e.font=`${Wo}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillStyle="white",e.fillText(C.tribeBadge,M,b),M+=Wo+la*2,C.isPlayerTribe)e.fillStyle="#aaa",e.font='10px "Press Start 2P", Arial',e.textAlign="left",e.fillText("(YOU)",M,b);else{const B=C.diplomacyStatus===Et.Friendly?"":"",F=`modal_diplomacy_${C.leaderId}`,G={x:M,y:b-Wo/2,width:Wo*1.5,height:Wo},Y={id:F,action:oe.ToggleDiplomacy,rect:G,text:"",icon:B,backgroundColor:"transparent",textColor:"white",currentWidth:G.width,tooltip:`Set status to ${C.diplomacyStatus===Et.Friendly?"Hostile":"Friendly"}`,targetTribeId:C.leaderId};t.uiButtons.push(Y),t.hoveredButtonId===F&&(e.fillStyle=Zh,e.fillRect(G.x,G.y,G.width,G.height)),e.font=`${Wo*.8}px Arial`,e.textAlign="center",e.fillText(B,G.x+G.width/2,b)}M+=Wo*2+la,Va(e,{x:M+10,y:b},ki*.6,25,"male"),e.fillStyle="white",e.font=`${o1}px "Press Start 2P"`,e.fillText(`${C.adultCount}`,M+30,b),M+=80,Va(e,{x:M+10,y:b},ki*.6,5,"female"),e.fillText(`${C.childCount}`,M+30,b)}const A=120,v=40,I=o/2-A/2,S=u+c-60,E="close_tribe_modal_btn",_={id:E,action:oe.CloseTribeModal,rect:{x:I,y:S,width:A,height:v},text:"CLOSE",currentWidth:A,backgroundColor:Tn,textColor:ot};t.uiButtons.push(_),e.fillStyle=t.hoveredButtonId===E?"#4a5568":Tn,e.fillRect(I,S,A,v),e.strokeStyle="#fff",e.strokeRect(I,S,A,v),e.fillStyle=ot,e.font='12px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="middle",e.fillText("CLOSE",o/2,S+v/2),e.restore()}function HD(e,t,i,o,s){const l=mA,c=yA,d=t+o-l-c,u=i+c;e.save(),e.lineWidth=2,e.strokeStyle=s?E1:T1,e.beginPath();const h=5;e.moveTo(d+h,u+h),e.lineTo(d+l-h,u+l-h),e.moveTo(d+l-h,u+h),e.lineTo(d+h,u+l-h),e.stroke(),e.restore()}function FD(e,t,i,o){const{tutorialState:s,tutorial:l}=t;if(s.transitionState===tn.INACTIVE)return;const c=l.steps[s.currentStepIndex];if(!c)return;e.save(),e.globalAlpha=s.transitionAlpha;const d=p1,u=g1,h=m1,p=`${Of}px "Press Start 2P", Arial`,y=`${J0}px "Press Start 2P", Arial`,A=v1,v=J0*1.5;e.font=y;const I=c.text.split(" ");let S="";const E=[];for(let Y=0;Y<I.length;Y++){const J=S+I[Y]+" ";e.measureText(J).width>d-u*2&&Y>0?(E.push(S),S=I[Y]+" "):S=J}E.push(S);const _=u*2+Of+u/2+E.length*v,w=(i-d)/2,C=o-_-160;e.fillStyle=y1,e.beginPath(),e.moveTo(w+h,C),e.lineTo(w+d-h,C),e.quadraticCurveTo(w+d,C,w+d,C+h),e.lineTo(w+d,C+_-h),e.quadraticCurveTo(w+d,C+_,w+d-h,C+_),e.lineTo(w+h,C+_),e.quadraticCurveTo(w,C+_,w,C+_-h),e.lineTo(w,C+h),e.quadraticCurveTo(w,C,w+h,C),e.closePath(),e.fill(),e.fillStyle=A,e.textAlign="center",e.textBaseline="top",e.font=p,e.fillText(c.title,w+d/2,C+u),e.font=y;let R=C+u+Of+u/2;for(const Y of E)e.fillText(Y,w+d/2,R),R+=v;const b=t.hoveredButtonId==="tutorial-dismiss";HD(e,w,C,d,b),e.restore();const M=mA,B=yA,F=w+d-M-B,G=C+B;return{x:F,y:G,width:M,height:M}}function jf(e,t,i){e.save();const o=S1,s={x:t.x-o,y:t.y-o,width:t.width+o*2,height:t.height+o*2};e.strokeStyle=pA,e.lineWidth=gA+Math.sin(i*Kh)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function LD(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const CI=10,UD=3,Py=CI*.7;function GD(e,t){const{position:i,food:o,maxFood:s}=t;if(e.beginPath(),e.arc(i.x,i.y,CI,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),o.length>0){const l=Math.PI*2/Math.min(o.length,s);for(let c=0;c<o.length;c++){const d=c*l,u=i.x+Py*Math.cos(d),h=i.y+Py*Math.sin(d);e.beginPath(),e.arc(u,h,UD,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const Ry=(e,t,i=70,o=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${i}%, ${o}%)`},xD=(e,t)=>{const i=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!i)return e;const[o,s,l]=[parseInt(i[1]),parseInt(i[2]),parseInt(i[3])];return`hsl(${o}, ${s}%, ${Math.max(0,l-t)}%)`},Sc=(e,t,i,o,s,l,c,d=!1)=>{e.save(),e.translate(t,i),e.rotate(l),e.fillStyle=d?xD(c,15):c,e.beginPath(),e.roundRect(-o/2,0,o,s,o/2),e.fill(),e.restore()},Xf=(e,t)=>{const i=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),o=75;if(!i)return`hsl(0, 0%, ${o}%)`;const[,s,l,c]=i.map(Number),d=l*(1-t),u=c+(o-c)*t;return`hsl(${s}, ${d}%, ${u}%)`},_I={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,i,o,s,l,c,d={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=o*.15,h=t+o/2,p=i+s/2,y=o-u*2,A=s-u*2,{gender:v,age:I,direction:S,isPregnant:E,hungryLevel:_,geneCode:w}=d,C=.8+Math.min(I,10)/10*.4,R=v==="male"?1.05:.95,b=1-_/100*.3,M=y*.5*b*C*R;let B=A*.3*C*R;const F=y*.15*C*R,G=M*.2,Y=A*.3,J=Ry(w,0,30,50);let z=Ry(w,8,50,40);if(I>45){const ae=Math.min(1,(I-45)/15);z=Xf(z,ae)}e.translate(h,p),S[0]<0&&e.scale(-1,1);const te=Math.sin(l*Math.PI*2),K=Math.cos(l*Math.PI*2),se=Y+B*.2;if(c==="dead"){const ae=Math.min(l,1);e.translate(0,A*.2),e.rotate(Math.PI/2);const ye=Xf(z,ae),Se=Xf(J,ae);e.globalAlpha=.5+ae*.5,e.strokeStyle=ye,e.lineWidth=G*.5,e.beginPath(),e.moveTo(-M*.4,0),e.lineTo(M*.4,0),e.stroke();for(let ie=-1;ie<=1;ie+=1)e.beginPath(),e.arc(0,0,B*.4,Math.PI*.4*ie-Math.PI*.2,Math.PI*.4*ie+Math.PI*.2),e.stroke();e.fillStyle=Se,e.beginPath(),e.arc(M*.5,0,F,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(M*.55,0,F*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,se,M*.7,M*.25,0,0,2*Math.PI),e.fill();let ce=0,ne=0,$=0,j=0,X=0,D=0;switch(c){case"idle":ne=te*(A*.02),$=te*.05,j=-te*.05,X=-te*.05,D=te*.05;break;case"walk":ne=Math.abs(K)*(A*-.04),$=te*.7,j=-te*.7,X=-te*.7,D=te*.7;break;case"eat":ce=A*.1,ne=A*.05,ce+=te*(A*.02);break;case"procreate":ne=A*.05;const ae=(1-K)*-y*.05;e.translate(ae,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}E&&v==="female"&&(B*=1.6);const x=ne,re=x-B*.2;Sc(e,M*-.35,re,G,Y,X,z,!0),Sc(e,M*.35,re,G,Y,D,z,!0),e.fillStyle=z,e.beginPath(),e.ellipse(0,x,M/2,B/2,0,0,2*Math.PI),e.fill();const le=M*.45,Ee=re+ce;e.fillStyle=J,e.beginPath(),e.arc(le,Ee,F,0,Math.PI*2),e.fill(),S[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(le+F*.3,Ee-F*.2,F*.15,0,Math.PI*2),e.fill()),Sc(e,M*-.35,re,G,Y,$,z),Sc(e,M*.35,re,G,Y,j,z),e.restore()}};function $D(e,t){let[i,o,s]=e.match(/\d+/g).map(Number);return i=Math.max(0,i-t),o=Math.max(0,o-t),s=Math.max(0,s-t),`rgb(${i}, ${o}, ${s})`}function WD(e){const t=(e&16711680)>>16,i=(e&65280)>>8,o=e&255,s=`rgb(${t}, ${i}, ${o})`,l=$D(s,40),c=(e&255)%100+50,d=(e>>8&255)%100,u=(e>>16&255)%100,h=`rgb(${c}, ${d}, ${u})`,p=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:l,skinColor:h,eyeColor:p}}const PI={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,i,o,s,l,c,d={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:h,direction:p,isPregnant:y,hungryLevel:A,geneCode:v}=d;e.save();const I=o*.15,S=Math.max(1,Math.floor((o-I*2)/10)),E=p[0]<0;e.translate(t+o/2,i+s/2),E&&e.scale(-1,1);const _=WD(v),w=.8+Math.min(h,20)/20*.4,C=u==="male"?1.05:.95,R=1-A/100*.25,b=w*C*R,M=Math.max(0,Math.min(1,(h-15)/5));e.filter=`grayscale(${M})`;const B=_.furColor,F=_.darkerFurColor,G=_.eyeColor,Y="#FFFFFF",J="#c75c5c",z="#E0E0E0",te="#A0A0A0",K=s/2-2*S,se=Math.sin(l*Math.PI*2),ce=Math.abs(se);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,K,S*4,S,0,0,2*Math.PI),e.fill(),e.filter="none",c==="dead"){const Qe=Math.min(1,l*2);e.save(),e.translate(0,K-S*3),e.rotate(-Math.PI/2);const Ze=(wn,rn,Cn,Jn,ei=!1)=>{e.fillStyle=ei?te:z,e.fillRect(wn*S,rn*S,Cn*S,Jn*S)};Qe<1&&(e.globalAlpha=1-Qe,e.fillStyle=B,e.beginPath(),e.ellipse(0,0,S*3,S*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),Qe>0&&(e.globalAlpha=Qe,Ze(-1,-4,2,2),Ze(1,-3.5,1,1,!0),Ze(-.5,-2,1,5,!0),Ze(-2.5,-1,5,.5),Ze(-2.5,0,5,.5),Ze(-2.5,1,5,.5),Ze(-3,-2,-1,2,!0),Ze(3,-2,1,2),Ze(-3,2,-1,2,!0),Ze(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=B;let ne=0,$=0,j=0,X=[0,0,0,0];switch(c){case"idle":ne=se*S*.1;break;case"walk":const Qe=Math.sin(l*Math.PI*4);ne=Math.abs(Qe)*-S*.5,X=[Qe*S,-Qe*S,-Qe*S,Qe*S];break;case"attacking":const Ze=Math.sin(l*Math.PI*4);$=S*2+Ze*S,j=S*2,ne=S;break;case"eat":j=S*3+ce*S,ne=S*1.5,e.fillStyle=J,e.fillRect(-S,K-S,S*2,S);break;case"procreate":ne=Math.sin(l*Math.PI*8)*S*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let rn=0;rn<5;rn++){const Cn=(Math.random()-.5)*S*8,Jn=K+(Math.random()-.5)*S*2;ce>.5&&e.fillRect(Cn,Jn,S*.5,S*.5)}break}const D=S*3*b*(y?1.3:1),x=S*5*b,re=-x/1.5,le=K-D-S*2.5+ne;e.fillStyle=B,e.beginPath(),e.moveTo(re-S*.5,le+D*.5),e.quadraticCurveTo(re-S*3,le-S,re-S*2+se*S,le+D+S),e.fill();const Ee=S*1.2*b,ae=S*3*b,ye=S*2.5*b,Se=re+x*.8,ie=re+x*.2;e.fillStyle=F,e.fillRect(ie,K-ye,Ee,ye+X[2]),e.fillRect(Se,K-ae,Ee,ae+X[0]),e.fillStyle=B,e.beginPath(),e.moveTo(re,le+D),e.lineTo(re,le+S),e.quadraticCurveTo(re+x/2,le,re+x,le+S),e.lineTo(re+x,le+D),e.fill(),e.fillStyle=B,e.fillRect(ie+S/2,K-ye,Ee,ye+X[3]),e.fillRect(Se+S/2,K-ae,Ee,ae+X[1]);const pe=S*3.5*b,Ne=re+x-pe*.3+$,Te=le-pe*.3+j;e.fillStyle=B,e.beginPath(),e.arc(Ne,Te,pe/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(Ne+pe*.4,Te+pe*.2,S*1.5,S,0,0,Math.PI*2),e.fill(),p[1]>=0&&(e.fillStyle=G,e.fillRect(Ne+S*.5,Te-S*.5,S*.5,S*.5),c==="attacking"&&(e.fillStyle=Y,e.fillRect(Ne+pe*.5,Te+pe*.4,S,S*.4))),e.fillStyle=F,e.beginPath(),e.moveTo(Ne-pe*.4,Te-pe*.3),e.lineTo(Ne,Te-pe*.7),e.lineTo(Ne,Te-pe*.2),e.fill(),e.restore()}};class nl{constructor(t=200){Ht(this,"cache",new Map);Ht(this,"maxSize");this.maxSize=t}getOrRender(t,i,o,s){const l=this.cache.get(t);if(l)return this.cache.delete(t),this.cache.set(t,l),l;const{canvas:c,ctx:d}=EI(i,o);if(s(d),this.cache.size>=this.maxSize){const u=this.cache.keys().next().value;u!==void 0&&this.cache.delete(u)}return this.cache.set(t,c),c}clear(){this.cache.clear()}}const YD=9,zD=new nl(200);function jD(e,t){const{position:i,gender:o,age:s,decayProgress:l,food:c,radius:d,originalEntityType:u,geneCode:h}=t,p=dr(l,20),y=Math.floor(s),A=`${u}_${o}_${y}_${p}_${d}_${h||0}`,v=Math.ceil(d*2)+4,I=zD.getOrRender(A,v,v,S=>{S.translate(v/2,v/2),u==="human"?hp.render(S,-v/2+2,-v/2+2,v-4,v-4,p,"dead",o,y,[0,0],!1,0):u==="prey"?_I.render(S,-v/2+2,-v/2+2,v-4,v-4,p,"dead",{gender:o,age:y,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024}):u==="predator"&&PI.render(S,-v/2+2,-v/2+2,v-4,v-4,p,"dead",{gender:o,age:y,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024})});if(e.save(),e.globalAlpha=1-l,e.drawImage(I,i.x-I.width/2,i.y-I.height/2),e.restore(),c.length>0){e.save(),e.font=`${YD}px Arial`,e.textAlign="center",e.textBaseline="middle";const S=mt*.9,E=Math.PI/xv*3;c.forEach((_,w)=>{const C=w*E,R=i.x+S*Math.cos(C)*Math.atan2(w,w),b=i.y+S*Math.sin(C)*Math.atan2(w,w),M=Bh[_.type];e.fillText(M,R,b)}),e.restore()}}function Io(e,t,i,o,s,l,c,d){e.save(),e.fillStyle=c,e.fillRect(t,i,o,s),e.fillStyle=d,e.fillRect(t,i,o*Math.max(0,l),s),e.restore()}function XD(e,t,i,o,s,l){if(e.save(),o.length===0){e.restore();return}const c=o.length*s;let d;c>l||c+(o.length-1)*4>l?d=(l-c)/(o.length-1):d=4,o.length===1&&(d=0);for(let u=0;u<o.length;u++){const h=Bh[o[u].type];e.fillText(h,t+u*(s+d),i)}e.restore()}function VD(e,t,i,o,s){const l=t.autopilotControls.hoveredAutopilotAction;if(!l)return;let c,d=mt/2;const u=yu[l.action],h=_A[l.action],p=`${u} ${h}`;if("targetEntityId"in l){const y=t.entities.entities[l.targetEntityId];y&&(c=y.position,d=y.radius)}else"position"in l&&(c=l.position);if(c){wI(e,c,d,Vh,qh,2,i,o,s,t.mapDimensions),e.save(),e.font=`${ds}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:y,y:A}=tl(c,i,{width:o,height:s},t.mapDimensions),v=A-d-pu-ds/2;e.fillText(p,y,v),e.restore()}}function qD(e,t,i,o,s){e.save();const l=(Math.sin(s*Kh)+1)/2,c=i+pu+l*5;e.strokeStyle=Vh,e.lineWidth=2,e.setLineDash(qh),e.beginPath(),e.arc(t.x,t.y,c,0,Math.PI*2),e.stroke(),e.setLineDash([]);const d=yu[o],u=_A[o];if(d){e.font=`${ds*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const h=t.y-c-25;e.fillText(d,t.x,h),e.font=`${ds*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,h+25)}e.restore()}function ZD(e,t){const{activeAutopilotAction:i}=t.autopilotControls;if(ft(t)&&i){let s,l=15;if("position"in i)s=i.position;else if("targetEntityId"in i){const c=t.entities.entities[i.targetEntityId];c&&(s=c.position,l=c.radius||(c.type==="building"?20:30))}if(s){const c=(d,u)=>{qD(d,u.position,l,i.action,t.time)};Nn(e,t.mapDimensions.width,t.mapDimensions.height,c,{position:{...s}},s,l+30)}}}function My(e,t,i,o,s,l,c=!0){const d=t.split(" ");let u="";const h=[];for(let p=0;p<d.length;p++){const y=u+d[p]+" ";e.measureText(y).width>s&&p>0?(h.push(u),u=d[p]+" "):u=y}if(h.push(u),c)for(let p=0;p<h.length;p++)e.fillText(h[p],i,o+p*l);return h.length*l}function KD(e){return 1-Math.pow(1-e,3)}function QD(e,t,i,o){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(c=>!c.isDismissed);if(s.length===0)return;e.save();let l=o-O1;for(const c of s){const d=i-mc-zo;e.font=`${bf}px "Press Start 2P", Arial`;const u=d+zo,h=mc-zo*2,p=My(e,c.message,-9999,-9999,h,bf*1.2,!1),y=zo*2+p+si,A=l-y,v=Date.now()-c.creationTime,I=Math.min(v/D1,1),S=KD(I),E=o,_=E+(A-E)*S;e.fillStyle=C1,e.beginPath(),e.roundRect(d,_,mc,y,w1),e.fill(),e.fillStyle=_1,e.textBaseline="top",My(e,c.message,u,_+zo,h,bf*1.2,!0);const w=_+y-si-zo/2,C=d+mc-si-zo/2,R={x:C,y:w,width:si,height:si};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[c.id]=R);const b=t.hoveredButtonId===`notification-dismiss-${c.id}`;if(e.fillStyle=b?ny:P1,e.font=`${si}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",R.x+R.width/2,R.y+R.height/2),c.targetEntityIds||c.targetPosition||c.targetArea||c.targetRadius){const F={x:C-si-ty,y:w,width:si,height:si};t.notificationButtonRects&&(t.notificationButtonRects.view[c.id]=F);const G=t.hoveredButtonId===`notification-view-${c.id}`;e.fillStyle=G?ny:R1,e.font=`${si*(G?1.5:1.2)}px Arial`,e.fillText("",F.x+F.width/2,F.y+F.height/2)}l-=y+ty}e.restore()}function JD(e){return e.length===0?0:e.reduce((i,o)=>i+o,0)/e.length}function Vf(e,t,i,o,s,l,c,d){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(o,s,l,c),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(o,s,l,c);const u=JD(i);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,o+Ve,s+Ve+8);const h=Math.max(...i,1),p=i.map(y=>y/h*c);if(e.beginPath(),e.strokeStyle=d,e.lineWidth=2,p.length>1){e.moveTo(o,s+c-p[0]);for(let y=1;y<p.length;y++){const A=o+y/(p.length-1)*l,v=s+c-p[y];e.lineTo(A,v)}}else if(p.length===1){const y=s+c-p[0];e.moveTo(o,y),e.lineTo(o+l,y)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${h.toFixed(2)}ms`,o+l-Ve,s+Ve+8),e.restore()}function eO(e,t,i){const{performanceMetrics:o}=t;if(!o)return;const s=280,l=240,c=i-s-Ve,d=Ve+et*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(c,d,s,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(c,d,s,l),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=d+Ve+5;const h=c+Ve;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",h,u),u+=25,e.fillStyle="white",e.font="12px monospace";const p=tO(t);e.fillText(`FPS: ${p.toFixed(1)}`,h,u),u+=20;const y=s-Ve*2,A=45,v=10;Vf(e,"Render",qf(t,"renderTime"),h,u,y,A,"#4CAF50"),u+=A+v,Vf(e,"World Update",qf(t,"worldUpdateTime"),h,u,y,A,"#2196F3"),u+=A+v,Vf(e,"AI Update",qf(t,"aiUpdateTime"),h,u,y,A,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",c+s/2,d+l-10),e.restore()}function tO(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const i=t.history[t.history.length-1].bucketTime/(Dt/Gt);return t.history.filter(l=>i-l.bucketTime/(Dt/Gt)<1).length}function nO(e,t){if(e.length===0)return[];const i=new Map;for(const l of e){const c=Math.floor(l.bucketTime/(Dt/Gt));i.set(c,(i.get(c)||0)+l[t])}return Array.from(i.keys()).sort().map(l=>i.get(l)).slice(0,-1).slice(1).reverse()}function qf(e,t){return nO(e.performanceMetrics.history,t)}function Qc(e,t,i,o,s,l,c){e.save();const{position:d}=t;e.strokeStyle=o,e.lineWidth=s+Math.sin(c*l)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(d.x,d.y,i,0,2*Math.PI),e.stroke(),e.restore()}function iO(e,t,i,o){if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;const l=gr(s,t);if(!l||!l.aiBlackboard)return;const c=up(l.aiBlackboard),d=500,u=Math.min(o*.9,700),h=i-d-10,p=Ve+et*2;t.debugPanelRect={x:h,y:p,width:d,height:u},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(h,p,d,u),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(h,p,d,u),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";const y=14,A=h+15;let v=p+20;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Supply Chain Debugger",A,v),v+=25,e.fillStyle="#aaaaaa",e.font="11px monospace",e.fillText(`Tribe Leader: ${l.isPlayer?"Player":"#"+l.id}`,A,v),v+=y,e.fillText(`Current Time: ${t.time.toFixed(1)}h`,A,v),v+=20;const I=v,S=u-(I-p)-30;oO(e,t,c,A,I,d-30,S,y),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+4' to toggle this debugger",h+d/2,p+u-10),e.restore()}function oO(e,t,i,o,s,l,c,d){var I,S;const u=((I=t.debugPanelScroll)==null?void 0:I.x)??0,h=((S=t.debugPanelScroll)==null?void 0:S.y)??0;e.save(),e.beginPath(),e.rect(o-5,s,l+10,c),e.clip(),e.translate(-u,-h);let p=s;e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(` Active Demands (${i.length})`,o,p),p+=18,i.length===0?(e.fillStyle="#888888",e.font="11px monospace",e.fillText("No active demands",o,p),p+=d):[...i].sort((_,w)=>w.updatedAt-_.updatedAt).forEach((_,w)=>{const C=t.entities.entities[_.requesterId];let R=C?C.isPlayer?"Player":`Human #${C.id}`:`Unknown #${_.requesterId}`;C&&(R+=` (Food: ${C.food.length}), Active action: ${C.activeAction||"idle"}`);let b="None";if(_.claimedBy){const G=t.entities.entities[_.claimedBy];b=G?G.isPlayer?"Player":`Human #${G.id}`:`Unknown #${_.claimedBy}`,G&&(b+=" (Food: "+G.food.length+"), Active action: "+(G.activeAction||"idle")+")")}const M=t.time-_.updatedAt,B=p,F=d*5+10;e.fillStyle=_.claimedBy?"rgba(50, 100, 50, 0.3)":"rgba(50, 50, 50, 0.3)",e.fillRect(o-5,B-2,l,F),e.strokeStyle=_.claimedBy?"#44ff44":"#666666",e.lineWidth=1,e.strokeRect(o-5,B-2,l,F),e.fillStyle="#ffaa00",e.font="bold 12px monospace",e.fillText(`#${w+1}`,o,p),p+=d,e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Requester: ${R}`,o+10,p),p+=d,e.fillStyle="#ffff88",e.fillText(`Resource: ${_.resourceType}`,o+10,p),p+=d,e.fillStyle=_.claimedBy?"#44ff44":"#ff8844",e.fillText(`Status: ${_.claimedBy?"Claimed":"Pending"}`,o+10,p),p+=d,_.claimedBy?(e.fillStyle="#aaffaa",e.fillText(`Mover: ${b}`,o+10,p)):(e.fillStyle="#888888",e.fillText(`Mover: ${b}`,o+10,p)),p+=d,e.fillStyle="#aaaaaa",e.font="10px monospace",e.fillText(`Updated: ${M.toFixed(1)}h ago`,o+10,p),p+=d+5}),p+=10,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Statistics",o,p),p+=18;const y=i.filter(E=>!E.claimedBy).length,A=i.filter(E=>E.claimedBy).length;e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Total Demands: ${i.length}`,o,p),p+=d,e.fillStyle="#ff8844",e.fillText(`Pending: ${y}`,o,p),p+=d,e.fillStyle="#44ff44",e.fillText(`Claimed: ${A}`,o,p),p+=d;const v=p-s;t.debugPanelContentSize={width:l,height:v},e.restore()}function rO(e,t,i){if(!i.debugCharacterId)return;const o=i.search.human.byProperty("id",i.debugCharacterId)[0];if(!o)return;const s=gr(o,i);if(!s||!s.aiBlackboard||s.id!==t.leaderId)return;up(s.aiBlackboard).some(c=>c.requesterId===t.id)&&Qc(e,t,t.radius+15,"#ff6644",3,2,i.time),t.tribeRole===Fe.Mover&&Qc(e,t,t.radius+15,"#44ff44",3,2,i.time)}const sO={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"},aO=new nl(1e4);function lO(e,t){const{radius:i,position:o,activeAction:s="idle"}=t,l=t.stateMachine[0]||"N/A",c=t.isAdult?mt+20:mt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${l}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,o.x,o.y-c+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,i,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function cO(e,t,i,o,s){e.save(),e.font=`${Pa}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(i,t.x,t.y-(o?mt:As)-Pa-s),e.restore()}function uO(e,t,i,o,s){const l=t.x,c=t.y-i-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(l-o/2,c,o,o/2),e.fill(),e.beginPath(),e.moveTo(l-o/2,c),e.lineTo(l-o/4,c-o/3),e.lineTo(l-o/6,c),e.moveTo(l-o/6,c),e.lineTo(l,c-o/2),e.lineTo(l+o/6,c),e.moveTo(l+o/6,c),e.lineTo(l+o/4,c-o/3),e.lineTo(l+o/2,c),e.stroke(),e.restore()}function dO(e,t,i){var d;const{position:o,radius:s}=t,l=o.x-Df/2,c=o.y-s-r1;if(t.stateMachine[0]===Co){const u=t.stateMachine[1],h=i-u.attackStartTime,p=Math.min(h/uu,1);Io(e,l,c,Df,q0,p,yo,s1)}else if((d=t.attackCooldown)!=null&&d.melee&&t.attackCooldown.melee>0){const u=1-t.attackCooldown.melee/du;Io(e,l,c,Df,q0,u,yo,a1)}}function fO(e,t,i=!1,o=!1,s=!1,l=!1,c=!1,d=!1,u=!1,h){var F,G;const{position:p,activeAction:y="idle"}=t,A=t.isAdult?mt:mt*.6,v=sO[y]||"idle",I=dr(t.animationProgress||0,12),S=dp(t.direction,8),E=Math.floor(t.age),_=dr(t.hunger/100,5)*100,w=`${v}_${t.gender}_${E}_${S}_${I}_${t.isPregnant??!1}_${_}_${A}`,C=Math.ceil(A*2)+4,R=aO.getOrRender(w,C,C,Y=>{Y.translate(C/2,C/2);const J=fp(S,8);hp.render(Y,-C/2+2,-C/2+2,C-4,C-4,I,v,t.gender,E,J,t.isPregnant??!1,_)});e.drawImage(R,p.x-R.width/2,p.y-R.height/2),d&&(e.save(),e.strokeStyle=xC,e.lineWidth=2,e.beginPath(),e.arc(p.x,p.y,A+3,0,2*Math.PI),e.stroke(),e.restore());let b,M;if(c?(b=WC,M=sA):i?(b=$C,M=iA):s?(b=YC,M=GC):o?(b=zC,M=oA):l&&(b=jC,M=rA),b&&M&&uO(e,p,A,b,M),(F=t.tribeInfo)!=null&&F.tribeBadge&&cO(e,p,t.tribeInfo.tribeBadge,t.isAdult??!1,b??0),t.heldItem){const Y=Qh[t.heldItem.type],J=(G=t.tribeInfo)!=null&&G.tribeBadge?Pa:0;e.save(),e.font=`${Pa}px Arial`,e.textAlign="center",e.textBaseline="middle";const z=p.y-(t.isAdult?mt:As)-Pa-(b??0)-J;e.fillText(Y,p.x,z),e.restore()}const B=u&&(h.debugCharacterId===void 0||t.id===h.debugCharacterId);dO(e,t,h.time),B&&lO(e,t),h.debugPanel===Le.SupplyChain&&rO(e,t,h)}const hO={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},pO=new nl(200);function gO(e,t){const{radius:i,position:o,activeAction:s="idle"}=t,l=t.stateMachine[0]||"N/A",c=t.isAdult?mt+20:mt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${l}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-c+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,i,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function mO(e,t,i=!1,o){const{position:s,activeAction:l="idle"}=t,c=t.isAdult?t.radius:t.radius*.6,d=hO[l]||"idle",u=dr(t.animationProgress||0,12),h=dp(t.direction||{x:1,y:0},8),p=Math.floor(t.age),y=dr(t.hunger/100,5)*100,A=`${d}_${p}_${h}_${u}_${t.isPregnant??!1}_${y}_${t.geneCode}_${c}`,v=Math.ceil(c*2)+4,I=pO.getOrRender(A,v,v,E=>{E.translate(v/2,v/2);const _=fp(h,8);_I.render(E,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:p,direction:_,isPregnant:t.isPregnant??!1,hungryLevel:y,geneCode:t.geneCode})});if(e.drawImage(I,s.x-I.width/2,s.y-I.height/2),t.hitpoints<t.maxHitpoints){const E=c*1.5,_=3,w=s.x-E/2,C=s.y-c-8;e.fillStyle="#555",e.fillRect(w,C,E,_);const R=t.hitpoints/t.maxHitpoints;e.fillStyle=R>.5?"#4CAF50":R>.25?"#FFC107":"#F44336",e.fillRect(w,C,E*R,_)}i&&(o===void 0||t.id===o)&&gO(e,t)}const yO={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},vO=new nl(200);function AO(e,t){const{radius:i,position:o,activeAction:s="idle"}=t,l=t.stateMachine[0]||"N/A",c=t.isAdult?mt+20:mt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${l}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-c+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,i,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function IO(e,t,i=!1,o){const{position:s,activeAction:l="idle"}=t,c=t.isAdult?t.radius:t.radius*.6,d=yO[l]||"idle",u=dr(t.animationProgress||0,12),h=dp(t.direction||{x:1,y:0},8),p=Math.floor(t.age),y=dr(t.hunger/100,5)*100,A=`${d}_${p}_${h}_${u}_${t.isPregnant??!1}_${y}_${t.geneCode}_${c}`,v=Math.ceil(c*2)+4,I=vO.getOrRender(A,v,v,E=>{E.translate(v/2,v/2);const _=fp(h,8);PI.render(E,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:p,direction:_,isPregnant:t.isPregnant??!1,hungryLevel:y,geneCode:t.geneCode})});if(e.drawImage(I,s.x-I.width/2,s.y-I.height/2),t.hitpoints<t.maxHitpoints){const E=c*1.5,_=3,w=s.x-E/2,C=s.y-c-8;e.fillStyle="#555",e.fillRect(w,C,E,_);const R=t.hitpoints/t.maxHitpoints;e.fillStyle=R>.5?"#4CAF50":R>.25?"#FFC107":"#F44336",e.fillRect(w,C,E*R,_)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,c+3,0,2*Math.PI),e.stroke()),i&&(o===void 0||t.id===o)&&AO(e,t)}const RI=15;function SO(e,t,i,o,s=1.5){const l=i-t.startTime,c=Math.min(l/t.duration,1),d=1-c,h=1+Math.sin(c*Math.PI*2)*(s-1),p=RI*h;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,p),0,Math.PI*2),e.fillStyle=o,e.fill(),e.restore()}function da(e,t,i,o,s=2){const l=i-t.startTime,c=Math.min(l/t.duration,1),d=1-c,u=RI*2*c;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=o,e.lineWidth=s,e.stroke(),e.restore()}function _i(e,t,i,o){const s=i-t.startTime,l=Math.min(s/t.duration,1),c=1-l,d=-20*l;e.save(),e.globalAlpha=c,e.font="20px Arial",e.textAlign="center",e.fillText(o,t.position.x,t.position.y+d),e.restore()}function TO(e,t,i,o){const{width:s,height:l}=o.mapDimensions;let c=t.targetPosition;if(t.targetEntityId){const S=o.entities.entities[t.targetEntityId];S&&(c=S.position)}if(!c)return;const d=i-t.startTime,u=Math.min(d/t.duration,1);let h=c.x-t.position.x,p=c.y-t.position.y;h=h-Math.round(h/s)*s,p=p-Math.round(p/l)*l;const y={x:h,y:p},A=t.position.x+y.x*u,v=t.position.y+y.y*u,I=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(A,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(A,v+I),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function MI(e,t,i,o){switch(t.type){case ve.Procreation:_i(e,t,i,"");break;case ve.Pregnant:SO(e,t,i,"rgba(255, 105, 180, 0.7)",1.2);break;case ve.TargetAcquired:da(e,t,i,"rgba(255, 0, 0, 0.8)",3);break;case ve.Attack:_i(e,t,i,"");break;case ve.Partnered:_i(e,t,i,"");break;case ve.BushClaimed:da(e,t,i,"rgba(0, 255, 0, 0.7)",2);break;case ve.BushClaimLost:da(e,t,i,"rgba(128, 128, 128, 0.7)",2);break;case ve.Eating:_i(e,t,i,"");break;case ve.ChildFed:_i(e,t,i,"");break;case ve.AttackDeflected:_i(e,t,i,"");break;case ve.AttackResisted:_i(e,t,i,"");break;case ve.Hit:_i(e,t,i,"");break;case ve.SeizeBuildup:da(e,t,i,"rgba(255, 215, 0, 0.8)",4);break;case ve.BorderClaim:_i(e,t,i,"");break;case ve.Seize:da(e,t,i,"rgba(148, 0, 211, 0.8)",4);break;case ve.StoneProjectile:TO(e,t,i,o);break}}const ky=8,EO=1.5,wO=.5,Dy=2,CO="#5a5a5a",_O="#7e7e7e",PO="#8B0000",RO="#FF4444",MO=6,kO=new nl(1e3),Oy=20;function DO(e,t,i=!1,o=!0){if(i)return`ghost_${e.buildingType}_${o}`;const s=e,l=s.buildingType===fe.Bonfire&&(s.fuelLevel??0)>0;return`${s.id}_${s.buildingType}_${s.width}_${s.height}_${t}_${s.isConstructed}_${l}`}function kI(e,t,i=!1,o=!0){const s=DO(e,t,i,o),{width:l,height:c,id:d,buildingType:u}=e,h=l+Oy*2,p=c+Oy*2;return kO.getOrRender(s,h,p,y=>{const A=Ro[u],v="isConstructed"in e?e.isConstructed:!0;if(y.translate(h/2,p/2),i){const I=o?"#4CAF50":"#F44336";Zf(y,l,c,9999,I),y.font=`${Math.min(l,c)*.5}px Arial`,y.textAlign="center",y.textBaseline="middle",y.fillStyle=I,y.fillText(A.icon,0,0)}else{const I=e;let S=A.icon;I.buildingType===fe.Bonfire&&v&&(S=(I.fuelLevel??0)>0?"":""),t?Zf(y,l,c,d,PO,RO):Zf(y,l,c,d),y.globalAlpha=.5,y.font=`${Math.min(l,c,30)*.5}px Arial`,y.textAlign="center",y.textBaseline="middle",y.shadowColor="rgba(0,0,0,0.5)",y.shadowBlur=4,y.fillStyle="#FFFFFF",y.fillText(S,0,0)}})}function Zf(e,t,i,o,s,l){const c=(t+i)*2,d=Math.floor(c/ky),u=-t/2,h=t/2,p=-i/2,y=i/2;for(let A=0;A<d;A++){const v=o+A*13,I=is(v),S=is(v+1);let E=A*ky,_=0,w=0;E<t?(_=u+E,w=p):E<t+i?(_=h,w=p+(E-t)):E<t*2+i?(_=h-(E-(t+i)),w=y):(_=u,w=y-(E-(t*2+i)));const C=(S-.5)*Dy,R=(is(v+2)-.5)*Dy;e.beginPath();const b=EO+I*wO;s?e.fillStyle=s:e.fillStyle=I>.5?l||_O:s||CO,e.ellipse(_+C,w+R,b,b*.85,S*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function OO(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:i,storedItems:o}=t;e.save(),e.font=`${MO}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,o.forEach(s=>{const l=s.item.type,c=(Bh[l]||Qh[l])??"?",d={x:i.x+s.positionOffset.x,y:i.y+s.positionOffset.y};e.fillText(c,d.x,d.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function bO(e,t,i){const{position:o,width:s,height:l,constructionProgress:c,destructionProgress:d,isConstructed:u,isBeingDestroyed:h}=t,p=ft(i),y=!!(p&&lr(p,t,i)),A=kI(t,y);e.save(),u||(e.globalAlpha=.3+c*.7),e.drawImage(A,o.x-A.width/2,o.y-A.height/2),e.restore();const v=s,I=o.x-v/2,S=o.y+l/2+QT;u?h&&Io(e,I,S,v,v0,1-d,yo,KT):Io(e,I,S,v,v0,c,yo,ZT),(t.buildingType===fe.StorageSpot||t.buildingType===fe.Bonfire)&&u&&OO(e,t)}function NO(e,t,i,o,s){const l=Ro[i],{width:c,height:d}=l.dimensions,u=kI({buildingType:i,width:c,height:d,id:9999},!1,!0,o),h=(y,A)=>{y.save(),y.globalAlpha=qT,y.drawImage(u,A.x-u.width/2,A.y-u.height/2),y.restore()},p={position:{...t},radius:Math.max(c,d)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:De.create()};Nn(e,s.width,s.height,(y,A)=>h(y,A.position),p)}const Vr=1,BO=20,jn=4,by=8,HO="rgba(34, 85, 34, 0.25)",FO="rgba(139, 50, 50, 0.25)",os=new Map,LO=50;function UO(e,t){return e.map(i=>i.id).sort((i,o)=>i-o).join(",")+`_${t}`}function GO(){if(os.size>LO){const e=os.keys().next().value;e&&os.delete(e)}}function xO(e){const t=new Map;for(const i of e){const o=i.ownerId;o&&(t.has(o)||t.set(o,[]),t.get(o).push(i))}return t}function $O(e,t,i,o){let s=0;const l=Math.max(o.width,o.height)/2;for(const c of i){const d=e-c.position.x,u=t-c.position.y,h=d*d+u*u;h>0?s+=l*l/h:s+=100}return s}function WO(e,t,i){let o=1/0,s=1/0,l=-1/0,c=-1/0;for(const d of e)o=Math.min(o,d.position.x-t.width/2),s=Math.min(s,d.position.y-t.height/2),l=Math.max(l,d.position.x+t.width/2),c=Math.max(c,d.position.y+t.height/2);return{minX:o-i,minY:s-i,maxX:l+i,maxY:c+i}}function YO(e,t,i,o){const s=UO(e,o);if(os.has(s))return os.get(s);const l=i.maxX-i.minX,c=i.maxY-i.minY,d=Math.ceil(l/jn),u=Math.ceil(c/jn),h=[],p=[];for(let v=0;v<u;v++)h[v]=new Array(d);for(let v=0;v<u;v++)for(let I=0;I<d;I++){const S=i.minX+I*jn,E=i.minY+v*jn,_=$O(S,E,e,t);h[v][I]=_}for(let v=1;v<u-1;v++)for(let I=1;I<d-1;I++)if(h[v][I]>=Vr&&(h[v-1][I]<Vr||h[v+1][I]<Vr||h[v][I-1]<Vr||h[v][I+1]<Vr)){const E=i.minX+I*jn,_=i.minY+v*jn;p.push({x:E,y:_})}const y=XO(p),A={fieldValues:h,edgePoints:p,regions:y,bounds:i};return os.set(s,A),GO(),A}function zO(e,t,i,o,s,l){if(t.length===0)return;const{bounds:c}=l,d=10;if(!l.canvas){const u=c.maxX-c.minX+d*2,h=c.maxY-c.minY+d*2,{canvas:p,ctx:y}=EI(u,h);y.translate(-c.minX+d,-c.minY+d);const{fieldValues:A,regions:v}=l;jO(y,A,c,o);let I=s;for(const S of v){const E=VO(S);qO(y,E,o,I),I+=1e3}l.canvas=p}e.save(),e.globalAlpha=1,e.drawImage(l.canvas,c.minX-d,c.minY-d),e.restore()}function jO(e,t,i,o){const s=o?FO:HO;e.save(),e.fillStyle=s,e.beginPath();for(let l=0;l<t.length;l++)for(let c=0;c<t[l].length;c++)if(t[l][c]>=Vr){const d=i.minX+c*jn,u=i.minY+l*jn;e.rect(d,u,jn,jn)}e.fill(),e.restore()}function XO(e){if(e.length===0)return[];const t=jn*2,i=t,o=new Map;function s(h,p){const y=Math.floor(h/i),A=Math.floor(p/i);return`${y},${A}`}for(let h=0;h<e.length;h++){const p=s(e[h].x,e[h].y);o.has(p)||o.set(p,[]),o.get(p).push(h)}function l(h,p){const y=[],A=Math.floor(h/i),v=Math.floor(p/i);for(let I=-1;I<=1;I++)for(let S=-1;S<=1;S++){const E=`${A+I},${v+S}`,_=o.get(E);_&&y.push(..._)}return y}const c=new Set,d=[],u=t*t;for(let h=0;h<e.length;h++){if(c.has(h))continue;const p=[],y=[h];for(;y.length>0;){const A=y.shift();if(c.has(A))continue;c.add(A),p.push(e[A]);const v=l(e[A].x,e[A].y);for(const I of v){if(c.has(I))continue;const S=e[I].x-e[A].x,E=e[I].y-e[A].y;S*S+E*E<=u&&y.push(I)}}p.length>0&&d.push(p)}return d}function VO(e){if(e.length<=1)return e;const t=[],i=[...e];for(t.push(i.shift());i.length>0;){const o=t[t.length-1];let s=0,l=1/0;for(let c=0;c<i.length;c++){const d=i[c].x-o.x,u=i[c].y-o.y,h=d*d+u*u;h<l&&(l=h,s=c)}t.push(i.splice(s,1)[0])}return t}function qO(e,t,i,o){if(t.length===0)return;let s=0,l=0;for(let c=1;c<t.length;c++){const d=t[c-1],u=t[c],h=u.x-d.x,p=u.y-d.y,y=Math.sqrt(h*h+p*p);for(s+=y;s>=by;){s-=by;const A=1-s/y,v=d.x+h*A,I=d.y+p*A;ZO(e,v,I,i,o+l*13),l++}}}function ZO(e,t,i,o,s){const l=is(s),c=is(s+1),d=(c-.5)*2,u=(is(s+2)-.5)*2;e.beginPath();const h=1.5+l*.5;o?e.fillStyle=l>.5?"#FF4444":"#8B0000":e.fillStyle=l>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+d,i+u,h,h*.85,c*Math.PI,0,Math.PI*2),e.fill(),o||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function KO(e,t,i,o){var y,A,v;const s=t;if(!((y=s.search)!=null&&y.building))return;const c=s.search.building.all().filter(I=>I.buildingType===fe.PlantingZone&&I.isConstructed);if(c.length===0)return;const d=c.filter(I=>ba(I,i,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(d.length===0)return;const u=Ro[fe.PlantingZone].dimensions,h=xO(d),p=o?t.entities.entities[o]:void 0;for(const[I,S]of h){const E=((v=(A=p==null?void 0:p.tribeControl)==null?void 0:A.diplomacy)==null?void 0:v[I])==="Hostile",_=typeof I=="number"?I:0,w=WO(S,u,BO),C=YO(S,u,w,E);zO(e,S,u,E,_,C)}}const QO=.001,JO=.05,eb=12;function tb(e,t,i){const{position:o,age:s,swayOffset:l}=t,[c]=t.stateMachine??[],d=Math.min(1,Math.max(.4,s/_o)),h=c!==Vt&&c!==Ui?Math.sin(i*QO+l)*JO:0;if(e.save(),e.translate(o.x,o.y),e.scale(d,d),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=LP,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),c===Ui?Kf(e,10,8):c===Vt?(e.rotate(Math.PI/2),Kf(e,10,30),e.translate(0,-25),Ny(e,40,20,40,15)):(e.rotate(h),Kf(e,10,30),e.translate(0,-25),e.rotate(h*.5),Ny(e,40,20,40,15)),e.restore(),(c===Vt||c===Ui)&&t.wood&&t.wood.length>0){e.save(),e.font=`${eb}px Arial`,e.textAlign="center",e.textBaseline="middle";const p=t.radius*1.1,y=Math.PI*2/(Tu-1);t.wood.forEach((A,v)=>{const I=v===0?0:p,S=v===0?0:(v-1)*y,E=o.x+I*Math.cos(S),_=o.y+I*Math.sin(S),w=Qh[A.type];e.fillText(w,E,_)}),e.restore()}}function Kf(e,t,i){e.fillStyle=bP,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-i),e.lineTo(-10/2,-i+5),e.closePath(),e.fill(),e.fillStyle=NP,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-i+5),e.lineTo(0,-i),e.closePath(),e.fill()}function Ny(e,t,i,o,s){e.fillStyle=BP,By(e,t+4,i+4,o+2,s+2),e.translate(0,-2),e.fillStyle=HP,By(e,t,i,o,s),e.fillStyle=FP,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function By(e,t,i,o,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-i/2,-o),e.lineTo(0,-o-s),e.lineTo(i/2,-o),e.lineTo(t/2,0),e.closePath(),e.fill()}const Tc=200;let uo=null;function nb(e,t,i,o,s){const l=ZP(t.time);if(l<=0)return;uo||(uo=document.createElement("canvas")),(uo.width!==o.width||uo.height!==o.height)&&(uo.width=o.width,uo.height=o.height);const c=uo.getContext("2d");if(c){c.clearRect(0,0,o.width,o.height),c.fillStyle=`rgba(0, 0, 40, ${l*.85})`,c.fillRect(0,0,o.width,o.height),c.globalCompositeOperation="destination-out";for(const d of s){const u=tl(d.position,i,o,t.mapDimensions),h=c.createRadialGradient(u.x,u.y,0,u.x,u.y,d.radius);h.addColorStop(0,`rgba(255, 255, 255, ${d.intensity})`),h.addColorStop(1,"rgba(255, 255, 255, 0)"),c.fillStyle=h,c.beginPath(),c.arc(u.x,u.y,d.radius,0,Math.PI*2),c.fill()}c.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(uo,0,0),e.restore()}}function Hy(e,t,i,o,s,l,c){for(let d=-s.height;d<=s.height;d+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const h={x:t.x+u,y:t.y+d};ba({position:h,radius:i},l,c,s)&&e.push({position:h,radius:i,intensity:o})}}function ib(e,t,i,o,s,l=[]){const c=ft(t),d=c?xi(t,c):[],u=fs(d),{width:h,height:p}=t.mapDimensions,y=[];l.forEach(_=>{y.push({position:_,radius:30,intensity:.3})}),KO(e,t,o,c==null?void 0:c.leaderId);const A=t,v={left:o.x-s.width/2-Tc,top:o.y-s.height/2-Tc,right:o.x+s.width/2+Tc,bottom:o.y+s.height/2+Tc};[...A.search.human.byRect(v),...A.search.building.byRect(v),...A.search.berryBush.byRect(v),...A.search.tree.byRect(v),...A.search.corpse.byRect(v),...A.search.prey.byRect(v),...A.search.predator.byRect(v)].sort((_,w)=>i&&_.id===t.debugCharacterId&&_.id!==w.id||_.type==="building"&&w.type!=="building"||_.position.y<w.position.y?-1:_.position.y>w.position.y?1:_.id-w.id).forEach(_=>{var w,C;if(_.type==="building"){const R=_;if(R.isConstructed){const b=R.buildingType===fe.Bonfire&&(R.fuelLevel??0)>0,M=b?180:60,B=b?.9:.4;Hy(y,R.position,M,B,t.mapDimensions,o,s)}if(R.buildingType===fe.PlantingZone&&R.isConstructed)return;Nn(e,h,p,bO,R,t,c,t.time)}else if(_.type==="berryBush")Nn(e,h,p,GD,_,t,c,t.time);else if(_.type==="tree")Nn(e,h,p,tb,_,t.time);else if(_.type==="human"){const R=_,b=R.id===(c==null?void 0:c.id),M=d.some(J=>J.id===R.id),B=R.id===(u==null?void 0:u.id),F=c&&(R.id===c.motherId||R.id===c.fatherId),G=c&&(((w=R.partnerIds)==null?void 0:w.includes(c.id))||((C=c.partnerIds)==null?void 0:C.includes(R.id))),Y=(c==null?void 0:c.attackTargetId)===R.id;Hy(y,R.position,40,.3,t.mapDimensions,o,s),Nn(e,h,p,fO,R,b,F,M,G,B,Y,i,t)}else _.type==="corpse"?Nn(e,h,p,jD,_):_.type==="prey"?Nn(e,h,p,mO,_,i,t.time,t.debugCharacterId):_.type==="predator"&&Nn(e,h,p,IO,_,i,t.time,t.debugCharacterId)}),t.visualEffects.filter(_=>ba(_,o,s,t.mapDimensions)).forEach(_=>{Nn(e,h,p,MI,_,t.time,t)});const E=t.notifications.filter(_=>!_.isDismissed);for(const _ of E)if(_.highlightedEntityIds&&_.renderHighlights)for(const w of _.highlightedEntityIds){const C=t.entities.entities[w];C&&ba(C,o,s,t.mapDimensions)&&Nn(e,h,p,Qc,C,b1,N1,H1,B1,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const _ of t.tutorialState.highlightedEntityIds){const w=t.entities.entities[_];w&&ba(w,o,s,t.mapDimensions)&&Nn(e,h,p,Qc,w,I1,pA,gA,Kh,t.time)}nb(e,t,o,s,y)}function ob(e,t,i,o,s,l){let c=null,d=null;e.textAlign="left";let u=Ve+et;const p=t.time/(Dt/Gt)/lu%1,y=ca[jr.Time],A=25,v=Ve+A;e.fillText(y,Ve,u+vn/2+et/3),Io(e,v,u,co,vn,p,yo,JC),u+=vn+Ci;const I=u+ki/2,S=u+(ki-vn)/2,E=5;Va(e,{x:Ve*2,y:I},ki,5,i.gender,!1,!1,!1);const _=Ve+ki+E,w=co+A-(ki+E)*2;Io(e,_,S,w,vn,Math.floor(i.age)/Ua,yo,QC),Va(e,{x:_+w+E+ki/2,y:I},ki,Ua,i.gender,!1,!1,!1),u+=vn+Ci*2;const C=[],R=new Set;if(C.push({member:i,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),R.add(i.id),o&&!R.has(o.id)&&(C.push({member:o,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),R.add(o.id)),s.forEach(K=>{R.has(K.id)||(C.push({member:K,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),R.add(K.id))}),l.forEach(K=>{R.has(K.id)||(C.push({member:K,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),R.add(K.id))}),i.motherId&&!R.has(i.motherId)){const K=t.entities.entities[i.motherId];K&&(C.push({member:K,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),R.add(K.id))}if(i.fatherId&&!R.has(i.fatherId)){const K=t.entities.entities[i.fatherId];K&&(C.push({member:K,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),R.add(K.id))}const b=ca[jr.Family],M=10,B=Ve+et+M,F=co+A-(et+M),G=u+gc/2;e.font=`${et}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(b,Ve,G);const Y=u+gc/2;ND(e,B,Y,C,gc,F),u+=gc+Ci,e.textBaseline="alphabetic";const J=ca[jr.Hitpoints];e.fillText(J,Ve,u+vn/2+et/3),Io(e,v,u,co,vn,i.hitpoints/i.maxHitpoints,yo,KC),u+=vn+Ci;const z=ca[jr.Hunger];e.fillText(z,Ve,u+vn/2+et/3),Io(e,v,u,co,vn,(Xt-i.hunger)/Xt,yo,ZC),c={x:Ve,y:u-Ci/2,width:co+A,height:vn+Ci},u+=vn+Ci,e.textBaseline="middle";const te=ca[jr.Food];return e.fillText(te,Ve,u+pc/2),XD(e,v,u+pc/2,i.food,pc,co),d={x:Ve,y:u-Ci/5,width:co+A,height:pc+Ci},e.textBaseline="alphabetic",{hungerBarRect:c,foodBarRect:d}}let fa=[],Fy=0;const rb=36,sb=200;function ab(e,t,i,o){const s=t.search.prey.count(),l=t.search.predator.count(),c=t.search.berryBush.count();t.time-Fy>=rb&&(fa.push({time:t.time,prey:s,predators:l,bushes:c}),fa.length>sb&&(fa=fa.slice(-200)),Fy=t.time);const d=xe*$e,u=s/d*1e6,h=l/d*1e6,p=c/d*1e6,y=dD(),A=Math.floor(t.time/(24*365)),v=Math.floor(t.time%(24*365)/24),I=Math.floor(t.time%24),S=400,E=Math.min(o*.8,600),_=i-S-10,w=Ve+et*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(_,w,S,E),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(_,w,S,E),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let C=w+20;const R=14,b=_+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",b,C),C+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${A}, Day ${v}, Hour ${I}`,b,C),C+=R,e.fillText(`Map Size: ${xe}  ${$e} pixels`,b,C),C+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",b,C),C+=18,y&&(e.fillText(`Q-Table Size: ${y.qTableSize} entries`,b,C),C+=R,e.fillText(`Exploration Rate: ${(y.explorationRate*100).toFixed(1)}%`,b,C),C+=R);const M=fa.slice(-20);M.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",b,C),C+=30,lb(e,b,C,M),C+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",b,C),C+=18,e.fillStyle="white",e.font="12px monospace";const B=(Ni/d*1e6).toFixed(2),F=(Bi/d*1e6).toFixed(2),G=(Hi/d*1e6).toFixed(2);e.fillText(`Prey: ${u.toFixed(2)} (target: ${B})`,b,C),C+=R,e.fillText(`Predators: ${h.toFixed(2)} (target: ${F})`,b,C),C+=R,e.fillText(`Bushes: ${p.toFixed(2)} (target: ${G})`,b,C),C+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",b,C),C+=18,e.fillStyle="white",e.font="12px monospace";const Y=Math.round(s/Ni*100),J=Math.round(l/Bi*100),z=Math.round(c/Hi*100),te=K=>K<50?"#ff4444":K<80?"#ffaa44":K>120?"#44aaff":"#44ff44";e.fillStyle=te(Y),e.fillText(`Prey: ${s}/${Ni} (${Y}%)`,b,C),C+=R,e.fillStyle=te(J),e.fillText(`Predators: ${l}/${Bi} (${J}%)`,b,C),C+=R,e.fillStyle=te(z),e.fillText(`Bushes: ${c}/${Hi} (${z}%)`,b,C),C+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",b,C),C+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",b,C),C+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,b,C),C+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,b,C),C+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,b,C),C+=13,e.fillText("Predators:",b,C),C+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,b,C),C+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,b,C),C+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,b,C),C+=13,e.fillText("Bushes:",b,C),C+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,b,C),C+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",_+S/2,w+E-10),e.restore()}function lb(e,t,i,o){if(o.length<2)return;const d={prey:Math.max(...o.map(h=>h.prey),Ni),predators:Math.max(...o.map(h=>h.predators),Bi),bushes:Math.max(...o.map(h=>h.bushes),Hi)};[{data:o.map(h=>h.prey),color:"#44ff44",label:"Prey",target:Ni,max:d.prey},{data:o.map(h=>h.predators),color:"#ff4444",label:"Predators",target:Bi,max:d.predators},{data:o.map(h=>h.bushes),color:"#ffaa44",label:"Bushes",target:Hi,max:d.bushes}].forEach((h,p)=>{const y=t+p*115,A=i;e.fillStyle=h.color,e.font="10px monospace",e.fillText(h.label,y,A-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(y,A,100,30),e.beginPath(),e.strokeStyle=h.color;for(let I=0;I<h.data.length;I++){const S=y+I/(h.data.length-1)*100,E=A+30-h.data[I]/h.max*30;I===0?e.moveTo(S,E):e.lineTo(S,E)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=A+30-h.target/h.max*30;e.moveTo(y,v),e.lineTo(y+100,v),e.stroke(),e.setLineDash([])})}function cb(e,t){const i=t.search.human.byProperty("leaderId",e),o={total:i.length,children:0,males:0,females:0,old:0};for(const s of i)s.isAdult||o.children++,s.gender==="male"?o.males++:s.gender==="female"&&o.females++,s.age>=Lh&&o.old++;return o}function ub(e,t){const i=t.search,l=i.building.byProperty("ownerId",e).flatMap(h=>i.berryBush.byRadius(h.position,h.radius)).reduce((h,p)=>h+p.food.length,0),u=i.building.byProperty("ownerId",e).filter(h=>h.buildingType===fe.StorageSpot).reduce((h,p)=>h+(p.storedItems.filter(y=>y.item.itemType==="food").length||0),0);return{totalBushFood:l,totalStorageFood:u,consumptionRate:0}}function db(e,t,i){const s=t.search.human.byProperty("leaderId",e),l=t.entities.entities,c=new Map,d=new Map;for(const h of s){const p=Vc(h.id,t,c);d.has(p)||d.set(p,[]),d.get(p).push(h)}const u=[];for(const[h,p]of d.entries()){const y=l[h];y&&u.push({patriarch:y,memberCount:p.length,members:p.map(A=>A.id)})}return u.sort((h,p)=>p.memberCount-h.memberCount),u.slice(0,i)}let ha=[],li=[],Ly=0;const fb=36,Uy=200;function hb(e,t,i,o){var R;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let l=(R=gr(s,t))==null?void 0:R.id;if(!l)return;const c=cb(l,t),d=ub(l,t);if(t.time-Ly>=fb){ha.push({time:t.time,total:c.total,children:c.children,males:c.males,females:c.females,old:c.old});const b=d.totalBushFood+d.totalStorageFood;li.push({time:t.time,bushFood:d.totalBushFood,storageFood:d.totalStorageFood,totalFood:b}),ha.length>Uy&&(ha=ha.slice(-200)),li.length>Uy&&(li=li.slice(-200)),Ly=t.time}let u=0;if(li.length>=2){const b=li[li.length-1],M=li[li.length-2],B=b.time-M.time;B>0&&(u=(M.totalFood-b.totalFood)/B)}const h=400,p=Math.min(o*.9,700),y=i-h-10,A=Ve+et*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(y,A,h,p),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(y,A,h,p),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=A+20;const I=13,S=y+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",S,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",S,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${c.total}`,S,v),v+=I,e.fillStyle="#00ffff",e.fillText(`Children: ${c.children}`,S,v),v+=I,e.fillStyle="#4488ff",e.fillText(`Males: ${c.males}`,S,v),v+=I,e.fillStyle="#ff88ff",e.fillText(`Females: ${c.females}`,S,v),v+=I,e.fillStyle="#888888",e.fillText(`Old (${c.old})`,S,v),v+=20;const E=ha.slice(-50);E.length>1&&(pb(e,S,v,E),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",S,v),v+=18;const _=d.totalBushFood+d.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${_}`,S,v),v+=I,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${d.totalBushFood}`,S,v),v+=I,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${d.totalStorageFood}`,S,v),v+=I,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,S,v),v+=20;const w=li.slice(-50);w.length>1&&(gb(e,S,v,w),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",S,v),v+=18;const C=db(l,t,5);e.fillStyle="white",e.font="11px monospace",C.length===0?(e.fillText("No families found",S,v),v+=I):C.forEach((b,M)=>{const F=`${M+1}. ${b.patriarch.isPlayer?"Player":"#"+b.patriarch.id} (${b.memberCount} members, can split: ${NA(b.patriarch,t).canSplit})`;e.fillText(F,S,v),v+=I}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",y+h/2,A+p-10),e.restore()}function pb(e,t,i,o){if(o.length<2)return;const c=Math.max(...o.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,i,350,80),[{data:o.map(u=>u.total),color:"#ffffff",label:"Total"},{data:o.map(u=>u.children),color:"#00ffff",label:"Children"},{data:o.map(u=>u.males),color:"#4488ff",label:"Males"},{data:o.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:o.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let h=0;h<u.data.length;h++){const p=t+h/(u.data.length-1)*350,y=i+80-u.data[h]/c*80;h===0?e.moveTo(p,y):e.lineTo(p,y)}e.stroke()})}function gb(e,t,i,o){if(o.length<2)return;const c=Math.max(...o.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,i,350,80),[{data:o.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:o.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:o.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let h=0;h<u.data.length;h++){const p=t+h/(u.data.length-1)*350,y=i+80-u.data[h]/c*80;h===0?e.moveTo(p,y):e.lineTo(p,y)}e.stroke()})}function Gy(e,t,i){e.save();const{x:o,y:s,width:l,height:c}=t.rect,d=lA;if(e.beginPath(),e.moveTo(o+d,s),e.lineTo(o+l-d,s),e.quadraticCurveTo(o+l,s,o+l,s+d),e.lineTo(o+l,s+c-d),e.quadraticCurveTo(o+l,s+c,o+l-d,s+c),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),e.lineTo(o,s+d),e.quadraticCurveTo(o,s,o+d,s),e.closePath(),e.fillStyle=t.isDisabled?cA:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*hA)+1)/2;e.strokeStyle=fA,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<zc){const h=1-u/zc;e.fillStyle=dA,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}i&&!t.isDisabled&&(e.fillStyle=Zh,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?uA:t.textColor,t.icon?(e.font=`${c*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+l/2,s+c/2),t.text&&(e.font=`${c*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+l-4,s+c-2))):(e.font=`${et*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+l/2,s+c/2)),e.restore()}function mb(e,t,i,o){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,i,o);const s=500,l=150,c=(i-s)/2,d=(o-l)/2;e.fillStyle=ot,e.font=`${et*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",i/2,d+l/3-10),e.fillText("to the main menu?",i/2,d+l/3+10);const u=bi*1.5,h=aA,p=d+l-h-Ve*2,y=20,A=u*2+y,v=c+(s-A)/2,I={id:"confirmExitYes",action:oe.ConfirmExitYes,rect:{x:v,y:p,width:u,height:h},text:"Yes",backgroundColor:Tn,textColor:ot,currentWidth:u},S=v+u+y,E={id:"confirmExitNo",action:oe.ConfirmExitNo,rect:{x:S,y:p,width:u,height:h},text:"No",backgroundColor:Tn,textColor:ot,currentWidth:u};t.uiButtons.push(I,E),Gy(e,I,t.hoveredButtonId===I.id),Gy(e,E,t.hoveredButtonId===E.id),e.restore()}const fo=600,Yr=30,ci=60,Ft=30,yb="";function vb(e,t,i){const o=[];if(!i.tribeControl||!i.leaderId)return o;const{width:s,height:l}=e.canvas,c=(s-fo)/2,d=480,u=(l-d)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(c,u,fo,d,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=ot,e.font=`${et*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Tribe Roles",c+fo/2,u+Yr);const h=30,p=c+fo-Yr-h,y=u+Yr,A=t.hoveredButtonId==="roleManager_close";e.fillStyle=A?"#ff7777":"#ff5555",e.fillRect(p,y,h,h),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",p+h/2,y+h/2),o.push({id:"roleManager_close",action:oe.CloseRoleManager,rect:{x:p,y,width:h,height:h},text:"X",currentWidth:h,backgroundColor:"#ff5555",textColor:"#ffffff"});const I=mi(i.leaderId,t).filter(z=>z.isAdult),S={[Fe.Leader]:0,[Fe.Gatherer]:0,[Fe.Planter]:0,[Fe.Hunter]:0,[Fe.Mover]:0,[Fe.Warrior]:0};I.forEach(z=>{z.tribeRole&&S[z.tribeRole]++});const E=i.tribeControl.roleWeights,_=[{role:Fe.Gatherer,emoji:"",name:"Gatherer"},{role:Fe.Planter,emoji:"",name:"Planter"},{role:Fe.Hunter,emoji:"",name:"Hunter"},{role:Fe.Mover,emoji:"",name:"Mover"},{role:Fe.Warrior,emoji:"",name:"Warrior"}];let w=0;_.forEach(z=>{w+=E[z.role]||0});let C=u+Yr+70;const R=c+Yr,b=c+fo-Yr;_.forEach(z=>{const te=E[z.role]||0,K=w>0?Math.round(te/w*100):0,se=S[z.role]||0;e.textAlign="left",e.textBaseline="middle",e.font=`${et*.8}px "Press Start 2P", Arial`,e.fillStyle=ot,e.fillText(`${z.emoji} ${se} ${z.name}`,R,C+ci/2);const ce=c+220,ne=ce+Ft+15,j=ne+200+15,X=`role_minus_${z.role}`,D=t.hoveredButtonId===X,x=te<=0,re=x?"#555":D?"#dd6666":"#cc4444";e.fillStyle=re,e.fillRect(ce,C+(ci-Ft)/2,Ft,Ft),e.fillStyle=x?"#888":"#fff",e.textAlign="center",e.fillText("-",ce+Ft/2,C+ci/2+2),o.push({id:X,action:oe.DecreaseRoleWeight,targetRole:z.role,rect:{x:ce,y:C+(ci-Ft)/2,width:Ft,height:Ft},text:"-",currentWidth:Ft,backgroundColor:re,textColor:"#fff",isDisabled:x}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#fff";let le=ne;for(let ie=0;ie<te;ie++)e.fillText(yb,le,C+ci/2+2),le+=18;const Ee=`role_plus_${z.role}`,ae=t.hoveredButtonId===Ee,ye=te>=10,Se=ye?"#555":ae?"#66dd66":"#44cc44";e.fillStyle=Se,e.fillRect(j,C+(ci-Ft)/2,Ft,Ft),e.fillStyle=ye?"#888":"#fff",e.textAlign="center",e.font=`${et*.8}px "Press Start 2P", Arial`,e.fillText("+",j+Ft/2,C+ci/2+4),o.push({id:Ee,action:oe.IncreaseRoleWeight,targetRole:z.role,rect:{x:j,y:C+(ci-Ft)/2,width:Ft,height:Ft},text:"+",currentWidth:Ft,backgroundColor:Se,textColor:"#fff",isDisabled:ye}),e.textAlign="right",e.font=`${et*.8}px "Press Start 2P", Arial`,e.fillStyle=ot,e.fillText(`${K}%`,b,C+ci/2),C+=ci});const M=S[Fe.Leader],B=Object.values(S).reduce((z,te)=>z+te,0),F=I.length-B;e.textAlign="center",e.fillStyle="#aaa",e.font=`${et*.6}px "Press Start 2P", Arial`,e.fillText(`Adults: ${I.length} | Leader: ${M} | Assigned: ${B} | Unassigned: ${F}`,c+fo/2,C+10),e.fillText("(Adjust weights to control role distribution)",c+fo/2,C+30);const G=t.autopilotControls.behaviors.roleManagement,Y=G?" Auto-adjust: ON":" Auto-adjust: OFF",J=G?"#4CAF50":"#888";return e.fillStyle=J,e.font=`${et*.6}px "Press Start 2P", Arial`,e.fillText(`${Y} (Shift+U to toggle)`,c+fo/2,C+50),e.restore(),o}const jo=600,zr=30,ui=60,Lt=30,xy=[{key:"protectHomeland",emoji:"",name:"Protect Homeland",description:"Stay inside territory and protect from enemies"},{key:"expandBorders",emoji:"",name:"Expand Borders",description:"Expand territory by placing border posts (Coming Soon)"},{key:"invadeEnemies",emoji:"",name:"Invade Enemies",description:"Attack enemies outside of our border"}];function Ab(e,t,i){const o=[];if(!i.tribeControl||i.leaderId!==i.id)return o;const s=i.tribeControl.armyControl??{protectHomeland:gh,expandBorders:mh,invadeEnemies:yh},{width:l,height:c}=e.canvas,d=(l-jo)/2,u=350,h=(c-u)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(d,h,jo,u,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=ot,e.font=`${et*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Army Control",d+jo/2,h+zr);const p=30,y=d+jo-zr-p,A=h+zr,v=t.hoveredButtonId==="armyControl_close";e.fillStyle=v?"#ff7777":"#ff5555",e.fillRect(y,A,p,p),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",y+p/2,A+p/2),o.push({id:"armyControl_close",action:oe.CloseArmyControl,rect:{x:y,y:A,width:p,height:p},text:"X",currentWidth:p,backgroundColor:"#ff5555",textColor:"#ffffff"});let I=0;xy.forEach(w=>{I+=s[w.key]||0});let S=h+zr+70;const E=d+zr,_=d+jo-zr;return xy.forEach(w=>{const C=s[w.key]||0,R=I>0?Math.round(C/I*100):0;e.textAlign="left",e.textBaseline="middle",e.font=`${et*.8}px "Press Start 2P", Arial`,e.fillStyle=ot,e.fillText(`${w.emoji} ${w.name}`,E,S+ui/2);const b=d+320,M=b+Lt+15,B=120,F=M+B+15,G=`army_minus_${w.key}`,Y=t.hoveredButtonId===G,J=C<=0,z=J?"#555":Y?"#dd6666":"#cc4444";e.fillStyle=z,e.fillRect(b,S+(ui-Lt)/2,Lt,Lt),e.fillStyle=J?"#888":"#fff",e.textAlign="center",e.fillText("-",b+Lt/2,S+ui/2+2),o.push({id:G,action:oe.DecreaseArmyObjective,targetArmyObjective:w.key,rect:{x:b,y:S+(ui-Lt)/2,width:Lt,height:Lt},text:"-",currentWidth:Lt,backgroundColor:z,textColor:"#fff",isDisabled:J}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#4CAF50";const te=B-10,K=12,se=S+ui/2-K/2;e.fillStyle="#333",e.fillRect(M,se,te,K);const ce=C/10*te;e.fillStyle="#4CAF50",e.fillRect(M,se,ce,K);const ne=`army_plus_${w.key}`,$=t.hoveredButtonId===ne,j=C>=10,X=j?"#555":$?"#66dd66":"#44cc44";e.fillStyle=X,e.fillRect(F,S+(ui-Lt)/2,Lt,Lt),e.fillStyle=j?"#888":"#fff",e.textAlign="center",e.font=`${et*.8}px "Press Start 2P", Arial`,e.fillText("+",F+Lt/2,S+ui/2+4),o.push({id:ne,action:oe.IncreaseArmyObjective,targetArmyObjective:w.key,rect:{x:F,y:S+(ui-Lt)/2,width:Lt,height:Lt},text:"+",currentWidth:Lt,backgroundColor:X,textColor:"#fff",isDisabled:j}),e.textAlign="right",e.font=`${et*.8}px "Press Start 2P", Arial`,e.fillStyle=ot,e.fillText(`${R}%`,_,S+ui/2),S+=ui}),e.textAlign="center",e.fillStyle="#aaa",e.font=`${et*.6}px "Press Start 2P", Arial`,e.fillText("Adjust priorities for warrior objectives",d+jo/2,S+10),e.fillText("Higher values = higher priority",d+jo/2,S+30),e.restore(),o}let $y="",Wy=null;function Ib(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function Sb(e){const t=new Set;for(const i of e)t.add(`${i.gridX},${i.gridY}`);return t}function Ec(e,t,i,o,s,l,c){const d=((t+o)%l+l)%l,u=((i+s)%c+c)%c;return e.has(`${d},${u}`)}function Tb(e,t,i,o){const s=n_(t.soilDepletion,Fv);if(s.length===0)return;const{width:l,height:c}=t.mapDimensions,d=o.width/2,u=o.height/2,h=Math.ceil(l/Ut),p=Math.ceil(c/Ut),y=Ib(s);y!==$y&&($y=y,Wy=Sb(s));const A=Wy,v=Ut*2,I=i.x-d-v,S=i.x+d+v,E=i.y-u-v,_=i.y+u+v;e.save();const w=e.globalAlpha;for(const C of s){const R=C.gridX*Ut,b=C.gridY*Ut,M=Eb(R,b,l,c,I,S,E,_);for(const B of M)wb(e,B.x,B.y,C.health,C.gridX,C.gridY,A,h,p)}e.globalAlpha=w,e.restore()}function Eb(e,t,i,o,s,l,c,d){const u=[],h=Ut,p=[{dx:0,dy:0},{dx:-i,dy:0},{dx:i,dy:0},{dx:0,dy:-o},{dx:0,dy:o},{dx:-i,dy:-o},{dx:i,dy:-o},{dx:-i,dy:o},{dx:i,dy:o}];for(const y of p){const A=e+y.dx,v=t+y.dy;A+h>=s&&A<=l&&v+h>=c&&v<=d&&u.push({x:A,y:v})}return u}function wb(e,t,i,o,s,l,c,d,u){const h=Math.floor(t),p=Math.floor(i),y=Ut,A=1-o/Fv,I=o<Mw?B0:B0*A,S=!Ec(c,s,l,0,-1,d,u),E=!Ec(c,s,l,0,1,d,u),_=!Ec(c,s,l,-1,0,d,u),w=!Ec(c,s,l,1,0,d,u);e.globalAlpha=I,e.fillStyle=Pw,e.fillRect(h,p,y,y);const C=3;e.fillStyle=Rw,e.globalAlpha=I*1.2,S&&e.fillRect(h,p,y,C),E&&e.fillRect(h,p+y-C,y,C),_&&e.fillRect(h,p,C,y),w&&e.fillRect(h+y-C,p,C,y),e.globalAlpha=I*.5;const R=C+1;S&&_&&e.fillRect(h,p,R,R),S&&w&&e.fillRect(h+y-R,p,R,R),E&&_&&e.fillRect(h,p+y-R,R,R),E&&w&&e.fillRect(h+y-R,p+y-R,R,R),e.globalAlpha=1}const pa=8,ga=12,Jt=24;function Yy(e,t,i,o,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,i),e.lineTo(t,i-ga),e.stroke(),e.fillStyle=o,e.beginPath(),e.moveTo(t,i-ga),e.lineTo(t+pa,i-ga+pa/2),e.lineTo(t,i-ga+pa),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+pa/2,i-ga+pa/2))}function Cb(e,t,i,o,s){const l=gu(t,s);let c=1;const d=new Map,u=new Map;for(const S of l){const _=S.leaderId===s?0:c++,w=on[_%on.length];d.set(S.leaderId,w),u.set(S.leaderId,S.tribeBadge||"")}const h=[],p=Jt*2,y=Math.floor((i.x-o.width/2-p)/Jt)*Jt,A=Math.floor((i.x+o.width/2+p)/Jt)*Jt,v=Math.floor((i.y-o.height/2-p)/Jt)*Jt,I=Math.floor((i.y+o.height/2+p)/Jt)*Jt;for(let S=v;S<=I;S+=Jt)for(let E=y;E<=A;E+=Jt){const _=Zn(E,S,t),w=E+Jt,C=Zn(w,S,t);if(_!==C){const M=_||C;if(M){const B=E+Jt/2,F=S;Yy(e,B,F,d.get(M)||"#000",u.get(M)||""),h.push({x:B,y:F})}}const R=S+Jt,b=Zn(E,R,t);if(_!==b){const M=_||b;if(M){const B=E,F=S+Jt/2;Yy(e,B,F,d.get(M)||"#000",u.get(M)||""),h.push({x:B,y:F})}}}return h}const In=12,vt=16,On=15;function zy(e){switch(e){case O.Success:return"#4CAF50";case O.Failure:return"#F44336";case O.Running:return"#FFC107";case O.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function _b(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function Pb(e,t,i,o){var B;const{debugCharacterId:s}=t,l=500,c=Math.min(o*.9,800),d=i-l-10,u=Ve+et*2;t.debugPanelRect={x:d,y:u,width:l,height:c},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(d,u,l,c),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(d,u,l,c),e.fillStyle="white",e.font=`${In}px monospace`,e.textAlign="left",e.textBaseline="top";let h=u+20;const p=d+15;if(e.fillStyle="#66ccff",e.font=`bold ${In+2}px monospace`,e.fillText(" Task AI Debugger",p,h),h+=25,!s){e.fillStyle="#888",e.font=`${In}px monospace`,e.fillText("No character selected for debugging.",p,h),e.fillText("Click on a character to inspect their Task AI.",p,h+20),e.restore();return}const y=t.entities.entities[s];if(!y||y.type!=="human"&&y.type!=="predator"&&y.type!=="prey"){e.fillStyle="#ff4444",e.font=`${In}px monospace`,e.fillText(`Character #${s} not found or not a character.`,p,h),e.restore();return}const A=y;e.fillStyle="white",e.font=`${In}px monospace`,e.fillText(`Character: ${A.type} #${A.id} (${A.age.toFixed(1)}y)`,p,h),h+=vt*1.5,e.fillStyle="#66ccff",e.font=`bold ${In}px monospace`,e.fillText(" Current Task",p,h),h+=vt*1.5;const v=Zc(A),I=v?t.tasks[v]:null;if(e.font=`${In}px monospace`,I){const F=De.get(A.aiBlackboard,nI),G=De.get(A.aiBlackboard,iI),Y=F!==void 0?O[F]:"N/A";e.fillStyle="white",e.fillText(`ID: ${I.id}`,p+On,h),h+=vt,e.fillText(`Type: ${W[I.type]}`,p+On,h),h+=vt,e.fillText(`Target: ${_b(I.target)}`,p+On,h),h+=vt,e.fillStyle=zy(F),e.fillText(`Status: ${Y}`,p+On,h),h+=vt,G&&(e.fillStyle="#aaa",e.fillText(`Message: ${G}`,p+On,h),h+=vt)}else e.fillStyle="#888",e.fillText("No active task.",p+On,h),h+=vt;h+=vt,e.fillStyle="#66ccff",e.font=`bold ${In}px monospace`,e.fillText(" Recent Task History (Last 5)",p,h),h+=vt*1.5;const S=De.get(A.aiBlackboard,Ah)||[];if(S.length===0)e.fillStyle="#888",e.font=`${In}px monospace`,e.fillText("No task history yet.",p+On,h),h+=vt;else for(const F of S){e.fillStyle="white",e.font=`${In}px monospace`;const G=W[F.type];e.fillText(` ${G}`,p+On,h);const Y=O[F.result];e.fillStyle=zy(F.result);const J=e.measureText(` ${G} `).width;e.fillText(`(${Y})`,p+On+J,h),e.fillStyle="#666";const z=e.measureText(`(${Y}) `).width;e.fillText(`@ ${F.completedAtTick.toFixed(1)}h`,p+On+J+z,h),h+=vt,F.message&&(e.fillStyle="#888",e.fillText(`   ${F.message}`,p+On,h),h+=vt)}h+=vt,e.fillStyle="#66ccff",e.font=`bold ${In}px monospace`,e.fillText(" Available Tasks",p,h),h+=vt*1.5;const E=h,_=u+c-E-30;e.save(),e.beginPath(),e.rect(d,E,l,_),e.clip();const w=((B=t.debugPanelScroll)==null?void 0:B.y)??0;e.translate(0,-w);const C=t.search.tasks.byRadius(y.position,800);let R=0;if(C.length===0)e.fillStyle="#888",e.font=`${In}px monospace`,e.fillText("No tasks available in the world.",p+On,h),h+=vt;else{const F=C.map(G=>{const Y=wu[G.type];return{task:G,score:Y&&Y.scorer&&A.type==="human"?Y.scorer(A,G,{gameState:t,deltaTime:0}):null}});F.sort((G,Y)=>{const J=G.score!==null?G.score:-1/0;return(Y.score!==null?Y.score:-1/0)-J});for(const{task:G,score:Y}of F){let J="Unclaimed",z="#888";G.claimedByEntityId&&(G.claimedByEntityId===A.id?(J="Claimed by this character",z="#4CAF50"):(J=`Claimed by #${G.claimedByEntityId}`,z="#F44336")),e.font=`${In}px monospace`,e.fillStyle=z;const te=` Task ID: ${G.id}`;e.fillText(te,p,h),h+=vt,e.fillStyle="white",e.fillText(`  Type: ${W[G.type]}`,p,h),h+=vt;const K=Y!==null?Y.toFixed(3):"N/A";e.fillStyle=Y!==null&&Y>0?"#FFC107":"#888",e.fillText(`  Score: ${K}`,p,h),h+=vt,e.fillStyle=z,e.fillText(`  Status: ${J}`,p,h),h+=vt*1.5,R=Math.max(R,e.measureText(te).width+30)}}const b=h-E;t.debugPanelContentSize={width:R,height:b},e.restore();const M=u+c-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",d+l/2,M),e.restore()}function Rb(e,t,i,o){const{debugCharacterId:s}=t;if(!s)return;const l=t.entities.entities[s];if(!(!l||l.type!=="human"&&l.type!=="predator"&&l.type!=="prey"))switch(l.aiType){case Po.TaskBased:default:Pb(e,t,i,o);break}}function Jc(e,t,i,o,s,l=!1){var h;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-i.x,e.canvas.height/2-i.y),!l&&t.gameOver){e.restore(),LD(e,t);return}const c=ft(t),d=Cb(e,t,i,s,c==null?void 0:c.leaderId);if(Tb(e,t,i,s),ib(e,t,t.debugPanel===Le.General,i,s,d),c&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const p=Th(t.mousePosition,i,s,t.mapDimensions),y=$a(p,t.selectedBuildingType,c.leaderId,t);NO(e,p,t.selectedBuildingType,y,t.mapDimensions)}const u=t.notifications.filter(p=>!p.isDismissed);for(const p of u){const y=(Math.sin(t.time*k1)+1)/2;e.globalAlpha=y*.5+.25,e.fillStyle=M1,p.targetArea&&e.fillRect(p.targetArea.x,p.targetArea.y,p.targetArea.width,p.targetArea.height),p.targetRadius&&(e.beginPath(),e.arc(p.targetRadius.x,p.targetRadius.y,p.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,ZD(e,t),e.restore(),!l){e.fillStyle=XC,e.font=`${et}px "Press Start 2P", Arial`,e.shadowColor=VC,e.shadowBlur=qC,t.uiButtons=[];let p=null,y=null;if(c){const I=xi(t,c),S=fs(I),E=((h=c.partnerIds)==null?void 0:h.map(w=>t.entities.entities[w]).filter(w=>w!==void 0))||[],_=ob(e,t,c,S,E,I);p=_.hungerBarRect,y=_.foodBarRect}const A=gu(t,c==null?void 0:c.leaderId);_D(e,t,i,A,e.canvas.width,e.canvas.height,t.cameraZoom);const{commandButtonsRect:v}=SD(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,c&&(VD(e,t,i,e.canvas.width,e.canvas.height),o.length>0&&CD(e,o,c,i,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:I}=t.tutorialState;I.includes(rr.HUNGER_BAR)&&p&&jf(e,p,t.time),I.includes(rr.FOOD_BAR)&&y&&jf(e,y,t.time),I.includes(rr.COMMAND_BUTTONS)&&v&&jf(e,v,t.time)}if(t.tutorialState.isActive){const I=FD(e,t,e.canvas.width,e.canvas.height);I&&t.uiButtons.push({id:"tutorial-dismiss",action:oe.DismissTutorial,rect:I,text:"",currentWidth:I.width,backgroundColor:"transparent",textColor:"transparent"})}switch(QD(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case Le.Ecosystem:ab(e,t,e.canvas.width,e.canvas.height);break;case Le.Tribe:hb(e,t,e.canvas.width,e.canvas.height);break;case Le.SupplyChain:iO(e,t,e.canvas.width,e.canvas.height);break;case Le.Performance:eO(e,t,s.width);break;case Le.General:Rb(e,t,e.canvas.width,e.canvas.height);break}if(t.roleManagerOpen&&c&&c.leaderId===c.id){const I=vb(e,t,c);t.uiButtons.push(...I)}if(t.armyControlOpen&&c&&c.leaderId===c.id){const I=Ab(e,t,c);t.uiButtons.push(...I)}t.tribeModalOpen&&BD(e,t,A,e.canvas.width,e.canvas.height),t.isPaused&&t.exitConfirmation!=="pending"&&TD(e),t.exitConfirmation==="pending"&&mb(e,t,e.canvas.width,e.canvas.height)}}const Mb=wt.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,kb=wt.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,Db=wt.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,Ob=wt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,jy=wt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,bb=wt.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,Nb=wt.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,wc="intro-soundtrack",Xy=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:i}=fr(),o=Re.useRef(null),s=Re.useRef(null),l=Re.useRef(hk()),c=Re.useRef(),d=Re.useRef(l.current.viewportCenter),u=Re.useRef(),h=Re.useCallback(()=>{Uf(wc,2),i(),e("game")},[e,i]),p=Re.useCallback(()=>{t&&(Uf(wc,2),e("game"))},[e,t]);Re.useEffect(()=>{const v=I=>{(I.key==="Enter"||I.key===" ")&&(t?p():h())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[h,p,t]),Re.useEffect(()=>(tp(Ae.SoundTrack1,{loop:!0,trackId:wc}),()=>{Uf(wc,2)}),[]),Re.useEffect(()=>{const v=o.current;if(!v)return;s.current=v.getContext("2d");const I=()=>{v&&s.current&&(v.width=window.innerWidth,v.height=window.innerHeight,Jc(s.current,l.current,d.current,[],{width:v.width,height:v.height},!0))};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]),Re.useEffect(()=>{const v=()=>{const S=eA(l.current);if(S.length>0){const E=Math.floor(Math.random()*S.length);u.current=S[E].id}};v();const I=setInterval(v,fw);return()=>clearInterval(I)},[]);const[y,A]=Rv(v=>{var E,_;if(!s.current)return;if(c.current===void 0){c.current=v;return}const I=Math.min((v-c.current)/1e3,1);l.current=Cu(l.current,I);const S=u.current?l.current.entities.entities[u.current]:void 0;if(S){const{mapDimensions:w}=l.current,{width:C,height:R}=w;let b={...S.position};const M=b.x-d.current.x;Math.abs(M)>C/2&&(M>0?b.x-=C:b.x+=C);const B=b.y-d.current.y;Math.abs(B)>R/2&&(B>0?b.y-=R:b.y+=R);let F=Nc(d.current,b,Uc*I);F={x:(F.x%C+C)%C,y:(F.y%R+R)%R},d.current=F}Jc(s.current,l.current,d.current,[],{width:((E=o.current)==null?void 0:E.width)||800,height:((_=o.current)==null?void 0:_.height)||600},!0),c.current=v});return Re.useEffect(()=>(A(),y),[A,y]),ke.jsxs(Mb,{children:[ke.jsx(kb,{ref:o}),ke.jsxs(Db,{children:[ke.jsx(Ob,{children:"Tribe2"}),ke.jsxs(bb,{children:[ke.jsx(jy,{onClick:h,children:"New Game"}),t&&ke.jsx(jy,{onClick:p,children:"Load Game"})]}),ke.jsxs(Nb,{children:["by"," ",ke.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function Bb(){console.log("Tribe game initialized with detailed 2D world state.");const e=fk();return e.ecosystem={preyGestationPeriod:er,preyProcreationCooldown:tr,predatorGestationPeriod:nr,predatorProcreationCooldown:ir,preyHungerIncreasePerHour:vo,predatorHungerIncreasePerHour:Ao,berryBushSpreadChance:Fi},e.debugPanel=Le.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const Hb=({canvasRef:e,ctxRef:t,gameStateRef:i,viewportCenterRef:o,playerActionHintsRef:s})=>(Re.useEffect(()=>{const l=e.current;if(!l)return;t.current=l.getContext("2d");const c=()=>{l&&t.current&&i.current&&(l.width=window.innerWidth,l.height=window.innerHeight,Jc(t.current,i.current,o.current,s.current,{width:l.width,height:l.height},!1))};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),ke.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),Fb=(e,t,i,o=!1)=>{var c,d;let s;const l=PC(e,i);if(l){if(t.isAdult&&l.type==="berryBush"&&l.food.length>0)s={action:ue.AutopilotGather,targetEntityId:l.id};else if(t.isAdult&&l.type==="corpse"&&l.food.length>0)s={action:ue.AutopilotGather,targetEntityId:l.id};else if(l.type==="human"){const u=l;t.isAdult&&Za(t,u,i)?s={action:ue.AutopilotAttack,targetEntityId:u.id}:vs(t,u,i)?s={action:ue.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:ue.AutopilotFeedChild,targetEntityId:u.id})}else if(l.type==="prey")s={action:ue.AutopilotAttack,targetEntityId:l.id};else if(l.type==="predator")s={action:ue.AutopilotAttack,targetEntityId:l.id};else if(l.type==="building"){const u=l;if(i.selectedBuildingType==="removal")t.leaderId===t.id&&lr(t,u,i)&&u.isConstructed?s={action:ue.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:ue.Removal,position:l.position};else if(t.leaderId===t.id&&lr(t,u,i)&&u.isConstructed)Zv(u.position,us,t.id,i).valid?s={action:ue.TakeOverBuilding,targetEntityId:u.id}:s={action:ue.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const h=u.ownerId===t.leaderId,p=u.storedItems.length>0,y=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(o&&u.isConstructed&&p&&t.food.length<t.maxFood)if(h)s={action:ue.AutopilotRetrieve,targetEntityId:l.id};else{const A=t.leaderId?i.entities.entities[t.leaderId]:void 0;A&&((c=A.tribeControl)!=null&&c.diplomacy)?(u.ownerId&&A.tribeControl.diplomacy[u.ownerId])===Et.Hostile?s={action:ue.AutopilotGather,targetEntityId:l.id}:s={action:ue.AutopilotMove,position:e}:s={action:ue.AutopilotMove,position:e}}else h&&u.isConstructed?(t.food.length>0||t.heldItem)&&y?s={action:ue.AutopilotDeposit,targetEntityId:l.id}:t.food.length<t.maxFood&&p?s={action:ue.AutopilotRetrieve,targetEntityId:l.id}:s={action:ue.AutopilotMove,position:e}:s={action:ue.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(h=>h.type===Qn.Berry).length>=sr&&!Gi(e,i,au)&&!ur(i.soilDepletion,e,i.mapDimensions.width,i.mapDimensions.height)?s={action:ue.AutopilotPlant,position:e}:u.buildingType===fe.Bonfire&&((d=t.heldItem)==null?void 0:d.type)===Ot.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:ue.AutopilotDeposit,targetEntityId:u.id}:s={action:ue.AutopilotMove,position:e}}else if(l.type==="tree"){const u=l,[h]=u.stateMachine??[],p=h===Vn||h===Hn||h===gi;t.isAdult&&!t.heldItem&&p?s={action:ue.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&h===Vt&&u.wood.length>0?s={action:ue.AutopilotGather,targetEntityId:u.id}:s={action:ue.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===Qn.Berry).length>=sr&&(i.autopilotControls.isManuallyPlanting||Ka(e,i,t))&&!ur(i.soilDepletion,e,i.mapDimensions.width,i.mapDimensions.height)?s={action:ue.AutopilotPlant,position:e}:s={action:ue.AutopilotMove,position:e};return s},Lb=(e,t)=>{if(e.isPaused)return;const i=ft(e);if(!i)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,l=q(i.position,t,e.mapDimensions.width,e.mapDimensions.height),c=100;l<=c?$a(t,s,i.leaderId,e,i.position,c)&&(Xh(t,s,i.leaderId,e),e.selectedBuildingType=null):$a(t,s,i.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:ue.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=UC(t,e);s&&hh(s.id,e);return}const o=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,o?(e.autopilotControls.activeAutopilotAction=o,(o.action===ue.AutopilotMove||o.action===ue.AutopilotGather||o.action===ue.AutopilotChop)&&(e.hasPlayerMovedEver=!0),o.action===ue.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:ue.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},Ub=(e,t)=>{var c,d,u,h,p,y,A,v;const i=e.key.toLowerCase(),o=e.ctrlKey||e.metaKey;let s=!0,l=t;if(o){switch(i){case"s":Rh(t);break;default:s=!1;break}return{newState:l,handled:s}}switch(i){case"escape":const{autopilotControls:I}=t;I.activeAutopilotAction||I.isManuallyMoving||I.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(I.activeAutopilotAction=void 0,I.isManuallyMoving=!1,I.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):l.exitConfirmation==="pending"?(l.exitConfirmation="inactive",l.isPaused=!1):(l.exitConfirmation="pending",l.isPaused=!0);break;case"u":const S=ft(t);S&&S.isAdult&&S.leaderId===S.id&&(e.shiftKey?t.autopilotControls.behaviors.roleManagement=!t.autopilotControls.behaviors.roleManagement:t.roleManagerOpen=!t.roleManagerOpen);break;case"v":{const w=ft(t);w&&w.isAdult&&w.leaderId===w.id&&(t.armyControlOpen=!t.armyControlOpen);break}case"m":t.isMuted=!t.isMuted,Ra(t.masterVolume,t.isMuted);break;case"=":case"+":const E=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(E.toFixed(1)),Ra(t.masterVolume,t.isMuted);break;case"-":const _=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(_.toFixed(1)),Ra(t.masterVolume,t.isMuted);break;case"t":l=Cu(t,PA);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":l.debugPanel===Le.General?(l.debugPanel=Le.None,l.debugCharacterId=void 0):(l.debugPanel=Le.General,l.debugCharacterId||(l.debugCharacterId=((c=ft(l))==null?void 0:c.id)??((d=Object.values(l.entities.entities).find(w=>w.type==="human"||w.type==="prey"||w.type==="predator"))==null?void 0:d.id)));break;case"!":if(e.shiftKey){if(l.debugPanel===Le.Ecosystem){l.debugPanel=Le.None;break}l.debugPanel=Le.Ecosystem,l.debugCharacterId||(l.debugCharacterId=((u=ft(l))==null?void 0:u.id)??((h=Object.values(l.entities.entities).find(w=>w.type==="human"||w.type==="prey"||w.type==="predator"))==null?void 0:h.id))}else s=!1;break;case"#":if(e.shiftKey){if(l.debugPanel===Le.Tribe){l.debugPanel=Le.None;break}l.debugPanel=Le.Tribe,(!l.debugCharacterId||!l.entities.entities[l.debugCharacterId])&&(l.debugCharacterId=((p=ft(l))==null?void 0:p.id)??((y=l.search.human.all().find(w=>w.leaderId===w.id))==null?void 0:y.id))}else s=!1;break;case"$":if(e.shiftKey){if(l.debugPanel===Le.SupplyChain){l.debugPanel=Le.None;break}l.debugPanel=Le.SupplyChain,(!l.debugCharacterId||!l.entities.entities[l.debugCharacterId])&&(l.debugCharacterId=((A=ft(l))==null?void 0:A.id)??((v=l.search.human.all().find(w=>w.leaderId===w.id))==null?void 0:v.id))}else s=!1;break;case"@":if(e.shiftKey){if(l.debugPanel===Le.Performance){l.debugPanel=Le.None;break}l.debugPanel=Le.Performance}else s=!1;break;case"tab":if(l.debugPanel!==Le.General&&l.debugPanel!==Le.Tribe&&l.debugPanel!==Le.SupplyChain&&(l.debugPanel=Le.General),l.debugPanel===Le.General){const w=Object.values(l.entities.entities).filter(C=>C.type==="human"||C.type==="prey"||C.type==="predator");if(w.length>0){const C=w.sort((B,F)=>{if(B.type==="human"&&B.isPlayer)return-1;if(F.type==="human"&&F.isPlayer)return 1;if(B.type!==F.type){const G={human:0,prey:1,predator:2},Y=G[B.type]??999,J=G[F.type]??999;return Y-J}return B.id-F.id}),R=l.debugCharacterId,M=((R?C.findIndex(B=>B.id===R):-1)+1)%C.length;l.debugCharacterId=C[M].id}else l.debugCharacterId=void 0}else if(l.debugPanel===Le.Tribe||l.debugPanel===Le.SupplyChain){const w=l.search.human.all().filter(R=>R.leaderId===R.id);let C=w.findIndex(R=>R.id===l.debugCharacterId)+1;(C===-1||C>w.length-1)&&(C=0),l.debugCharacterId=w[C].id}else l.debugPanel=Le.None,l.debugCharacterId=void 0;break;default:s=!1;break}return{newState:l,handled:s}},Gb=(e,t,i,o,s)=>{var c;const l={gameState:i};if(t&&["e","b","r","h","c"].includes(e)&&i.hasPlayerEnabledAutopilot++,i.buildMenuOpen){if(e==="1"){i.selectedBuildingType="storageSpot",we(l,Ae.ButtonClick,o.position);return}else if(e==="2"){i.selectedBuildingType="plantingZone",we(l,Ae.ButtonClick,o.position);return}else if(e==="4"){i.selectedBuildingType="bonfire",we(l,Ae.ButtonClick,o.position);return}else if(e==="5"){i.selectedBuildingType="borderPost",we(l,Ae.ButtonClick,o.position);return}else if(e==="6"){i.selectedBuildingType="removal",we(l,Ae.ButtonClick,o.position);return}}if(e==="escape"&&i.selectedBuildingType){i.selectedBuildingType=null;return}if(e==="e"){if(t){i.autopilotControls.behaviors.gathering=!i.autopilotControls.behaviors.gathering;return}const d=qe(o,i,"berryBush",je,p=>p.food.length>0&&o.food.length<o.maxFood),u=qe(o,i,"corpse",je,p=>p.food.length>0&&o.food.length<o.maxFood);let h=null;d&&u?h=q(o.position,d.position,i.mapDimensions.width,i.mapDimensions.height)<=q(o.position,u.position,i.mapDimensions.width,i.mapDimensions.height)?d:u:h=d||u,h&&(o.activeAction="gathering",we(l,Ae.Gather,o.position))}else if(e==="r"){if(t){i.autopilotControls.behaviors.procreation=!i.autopilotControls.behaviors.procreation;return}qe(o,i,"human",je,u=>vs(o,u,i))&&(o.activeAction="procreating",we(l,Ae.Procreate,o.position))}else if(e==="f")o.food.length>0&&(o.activeAction="eating",we(l,Ae.Eat,o.position));else if(e==="h"){if(t){i.autopilotControls.behaviors.feedChildren=!i.autopilotControls.behaviors.feedChildren;return}const d=s.find(u=>u.type===ue.FeedChild);d&&d.targetEntity&&(o.activeAction="feeding",o.target=d.targetEntity.id)}else if(e==="arrowup"||e==="w")o.direction.y=-1,o.activeAction="moving",o.target=void 0,i.hasPlayerMovedEver=!0,i.autopilotControls.isManuallyMoving=!0,i.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")o.direction.y=1,o.activeAction="moving",o.target=void 0,i.hasPlayerMovedEver=!0,i.autopilotControls.isManuallyMoving=!0,i.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")o.direction.x=-1,o.activeAction="moving",o.target=void 0,i.hasPlayerMovedEver=!0,i.autopilotControls.isManuallyMoving=!0,i.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")o.direction.x=1,o.activeAction="moving",o.target=void 0,i.hasPlayerMovedEver=!0,i.autopilotControls.isManuallyMoving=!0,i.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){i.autopilotControls.behaviors.attack=!i.autopilotControls.behaviors.attack;return}const d=qe(o,i,"human",hn,u=>Za(o,u,i))??qe(o,i,"predator",hn)??qe(o,i,"prey",hn);d&&(o.activeAction="attacking",o.attackTargetId=d.id)}else if(e==="b"){if(t){i.autopilotControls.behaviors.planting=!i.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===ue.Plant)){const u=sC(o.position,i,50,lh);u&&(o.activeAction="planting",o.target=u,i.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){i.autopilotControls.behaviors.gathering=!i.autopilotControls.behaviors.gathering;return}const d=qe(o,i,"building",Kn,h=>{const p=h;return p.buildingType===fe.Bonfire&&p.isConstructed&&p.storedItems.length<(p.storageCapacity||0)});if(((c=o.heldItem)==null?void 0:c.type)===Ot.Wood&&d){o.activeAction="depositing",o.target=d.id,we(l,Ae.StorageDeposit,o.position);return}const u=qe(o,i,"building",Kn,h=>{const p=h;return p.buildingType===fe.StorageSpot&&p.ownerId===o.leaderId&&p.isConstructed&&p.storageCapacity!==void 0&&p.storedItems.length<p.storageCapacity});u&&(o.activeAction="idle",o.target=u.id,we(l,Ae.StorageDeposit,o.position))}else if(e==="z"){if(t){i.autopilotControls.behaviors.feedChildren=!i.autopilotControls.behaviors.feedChildren;return}const d=qe(o,i,"building",Kn,u=>{const h=u;return h.buildingType==="storageSpot"&&h.ownerId===o.leaderId&&h.isConstructed&&h.storedItems.length>0});d&&(o.activeAction="idle",o.target=d.id,we(l,Ae.StorageRetrieve,o.position))}else if(e==="k")BA(o,i);else if(e==="l"){if(t){i.autopilotControls.behaviors.build=!i.autopilotControls.behaviors.build;return}i.buildMenuOpen=!i.buildMenuOpen,we(l,Ae.ButtonClick,o.position)}else if(e==="u"){if(t){i.autopilotControls.behaviors.roleManagement=!i.autopilotControls.behaviors.roleManagement;return}}else if(e==="c"){if(t){i.autopilotControls.behaviors.chopping=!i.autopilotControls.behaviors.chopping;return}const d=qe(o,i,"tree",cu,u=>u.wood&&u.wood.length>0&&!o.heldItem);d&&(o.activeAction="chopping",o.target=d.id)}},xb=(e,t,i,o)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!o.current.has("arrowup")&&!o.current.has("arrowdown")&&!o.current.has("arrowleft")&&!o.current.has("arrowright")&&!o.current.has("w")&&!o.current.has("a")&&!o.current.has("s")&&!o.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),i.autopilotControls.isManuallyMoving=!1),!o.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!o.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!o.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!o.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!o.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},$b=(e,t,i)=>{const{mapDimensions:o}=e,{width:s,height:l}=o;if(!e.cameraFollowingPlayer){if(e.cameraTargetPosition){const u=Xe(t,e.cameraTargetPosition,s,l);if(To(u)<1){const A=e.cameraTargetPosition;return e.cameraTargetPosition=void 0,A}const p=hi(t,u);let y=Nc(t,p,Uc*i);return y={x:(y.x%s+s)%s,y:(y.y%l+l)%l},y}return t}let d=ft(e);if(e.debugCharacterId){const u=e.entities.entities[e.debugCharacterId];u&&"position"in u&&(d=u)}if(d){let u={...d.position};const h=u.x-t.x;Math.abs(h)>s/2&&(h>0?u.x-=s:u.x+=s);const p=u.y-t.y;Math.abs(p)>l/2&&(p>0?u.y-=l:u.y+=l);let y=Nc(t,u,Uc*i);return y={x:(y.x%s+s)%s,y:(y.y%l+l)%l},y}return e.viewportCenter};function Wb(e,t){const{width:i,height:o}=e.mapDimensions;e.cameraTargetPosition=void 0,e.viewportCenter={x:(t.x%i+i)%i,y:(t.y%o+o)%o}}const Yb=(e,t,i,o)=>{var u,h;const s={gameState:i},l=ft(i);l&&we(s,Ae.ButtonClick,l.position);const c=i.uiButtons.find(p=>p.id===e.id);c&&(c.lastActivated=Date.now()),t&&[oe.CommandGather,oe.CommandPlant,oe.ToggleProcreationBehavior,oe.CommandBuild,oe.OpenRoleManager].includes(e.action)&&i.hasPlayerEnabledAutopilot++;const{behaviors:d}=i.autopilotControls;switch(e.action){case oe.ReturnToIntro:i.exitConfirmation="pending",i.isPaused=!0;break;case oe.ConfirmExitYes:o(),i.exitConfirmation="inactive";break;case oe.ConfirmExitNo:i.exitConfirmation="inactive",i.isPaused=!1;break;case oe.ToggleMute:i.isMuted=!i.isMuted,Ra(i.masterVolume,i.isMuted);break;case oe.TogglePause:i.isPaused=!i.isPaused;break;case oe.FastForward:return Cu(i,PA);case oe.DismissTutorial:i.tutorialState.isActive=!1;break;case oe.CommandEat:l&&l.food.length>0&&(l.activeAction="eating");break;case oe.CommandGather:t?d.gathering=!d.gathering:l&&(l.activeAction="gathering");break;case oe.CommandPlant:t?d.planting=!d.planting:l&&(i.autopilotControls.isManuallyPlanting=!0);break;case oe.ToggleProcreationBehavior:d.procreation=!d.procreation;break;case oe.ToggleAttackBehavior:d.attack=!d.attack;break;case oe.ToggleFeedChildBehavior:d.feedChildren=!d.feedChildren;break;case oe.CommandTribeSplit:l&&BA(l,i);break;case oe.CommandBuild:t?d.build=!d.build:i.buildMenuOpen=!i.buildMenuOpen;break;case oe.SelectStorageSpot:i.selectedBuildingType="storageSpot";break;case oe.SelectPlantingZone:i.selectedBuildingType="plantingZone";break;case oe.SelectRemovalTool:i.selectedBuildingType="removal";break;case oe.SelectBorderPost:i.selectedBuildingType="borderPost";break;case oe.SelectBonfire:i.selectedBuildingType="bonfire";break;case oe.ToggleDiplomacy:if(l&&l.leaderId&&e.targetTribeId){const p=l.leaderId,y=e.targetTribeId,A=i.entities.entities[y],v=(u=l.tribeControl)==null?void 0:u.diplomacy,I=(h=A==null?void 0:A.tribeControl)==null?void 0:h.diplomacy;if(v&&I){const E=(v[y]||Et.Friendly)===Et.Friendly?Et.Hostile:Et.Friendly;v[y]=E,I[p]=E}}break;case oe.OpenTribeModal:i.tribeModalOpen=!0;break;case oe.RecenterCamera:i.cameraFollowingPlayer=!0;break;case oe.CloseTribeModal:i.tribeModalOpen=!1;break;case oe.OpenRoleManager:t?d.roleManagement=!d.roleManagement:i.roleManagerOpen=!0;break;case oe.CloseRoleManager:i.roleManagerOpen=!1;break;case oe.IncreaseRoleWeight:if(l&&l.tribeControl&&e.targetRole){const p=l.tribeControl.roleWeights[e.targetRole]||0;p<10&&(l.tribeControl.roleWeights[e.targetRole]=p+1)}break;case oe.DecreaseRoleWeight:if(l&&l.tribeControl&&e.targetRole){const p=l.tribeControl.roleWeights[e.targetRole]||0;p>0&&(l.tribeControl.roleWeights[e.targetRole]=p-1)}break;case oe.OpenArmyControl:i.armyControlOpen=!0;break;case oe.CloseArmyControl:i.armyControlOpen=!1;break;case oe.IncreaseArmyObjective:if(l&&l.tribeControl&&e.targetArmyObjective){l.tribeControl.armyControl||(l.tribeControl.armyControl={protectHomeland:gh,expandBorders:mh,invadeEnemies:yh});const p=l.tribeControl.armyControl[e.targetArmyObjective]||0;p<10&&(l.tribeControl.armyControl[e.targetArmyObjective]=p+1)}break;case oe.DecreaseArmyObjective:if(l&&l.tribeControl&&e.targetArmyObjective){l.tribeControl.armyControl||(l.tribeControl.armyControl={protectHomeland:gh,expandBorders:mh,invadeEnemies:yh});const p=l.tribeControl.armyControl[e.targetArmyObjective]||0;p>0&&(l.tribeControl.armyControl[e.targetArmyObjective]=p-1)}break}return i};function zb(e,t,i){if(!e.notificationButtonRects)return!1;const o=ft(e);for(const[s,l]of Object.entries(e.notificationButtonRects.dismiss))if(t>=l.x&&t<=l.x+l.width&&i>=l.y&&i<=l.y+l.height)return iC(e,s),o&&we({gameState:e},Ae.ButtonClick,o.position),!0;for(const[s,l]of Object.entries(e.notificationButtonRects.view))if(t>=l.x&&t<=l.x+l.width&&i>=l.y&&i<=l.y+l.height){const c=e.notifications.find(d=>d.id===s);if(c){let d=c.targetPosition;if(!d&&c.targetEntityIds&&c.targetEntityIds.length>0){const u=e.entities.entities[c.targetEntityIds[0]];u&&(d=u.position)}return d&&Wb(e,d),o&&we({gameState:e},Ae.ButtonClick,o.position),c.highlightedEntityIds&&(c.renderHighlights=!c.renderHighlights),!0}}return!1}function DI(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const jb=(e,t)=>{var i;if(t.debugPanel!==Le.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(DI(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,l=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.height)??0)-s);return t.debugPanelScroll.y>l&&(t.debugPanelScroll.y=l),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},Xb=(e,t)=>t.debugPanel!==Le.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:DI(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Vy=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},Vb=(e,t)=>{var i,o;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,l=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.width)??0)-s);t.debugPanelScroll.x>l&&(t.debugPanelScroll.x=l);const c=t.debugPanelRect.height-60,d=Math.max(0,(((o=t.debugPanelContentSize)==null?void 0:o.height)??0)-c);return t.debugPanelScroll.y>d&&(t.debugPanelScroll.y=d),{newState:t,handled:!0}}return{newState:t,handled:!1}};function qb(e,t,i){if(!i.minimapRect)return;const{x:o,y:s,width:l,height:c}=i.minimapRect;e>=o&&e<=o+l&&t>=s&&t<=s+c&&(i.isDraggingMinimap=!0,i.minimapDragDistance=0)}function Zb(e,t,i,o){i.isDraggingMinimap&&(i.isDraggingMinimap=!1,i.minimapDragDistance<5&&Qb(e,t,i,o,!1))}function Kb(e,t,i,o,s){if(!i.minimapRect){i.hoveredMinimapTribeId=null;return}if(i.isDraggingMinimap){if(o){i.minimapDragDistance+=Math.sqrt(o.x*o.x+o.y*o.y),i.cameraFollowingPlayer=!1,i.cameraTargetPosition=void 0;const{width:c,height:d}=i.mapDimensions,{width:u,height:h}=i.minimapRect,p=o.x/u*c,y=o.y/h*d,A=i.viewportCenter.x-p,v=i.viewportCenter.y-y,I={x:(A%c+c)%c,y:(v%d+d)%d};i.viewportCenter=I,s&&(s.current=I)}return}const l=OI(e,t,i.minimapRect,i);l?i.hoveredMinimapTribeId=Zn(l.x,l.y,i):i.hoveredMinimapTribeId=null}function Qb(e,t,i,o,s=!1){if(!i.minimapRect)return;const l=OI(e,t,i.minimapRect,i);l&&(i.cameraFollowingPlayer=!1,s?(i.viewportCenter=l,i.cameraTargetPosition=void 0,o&&(o.current=l)):i.cameraTargetPosition=l)}function Jb(e,t,i,o,s){if(!o.minimapRect)return!1;const{x:l,y:c,width:d,height:u}=o.minimapRect;if(t>=l&&t<=l+d&&i>=c&&i<=c+u){o.cameraFollowingPlayer=!1,o.cameraTargetPosition=void 0;const{width:h,height:p}=o.mapDimensions,y=e.deltaX/d*h,A=e.deltaY/u*p,v=o.viewportCenter.x+y,I=o.viewportCenter.y+A,S={x:(v%h+h)%h,y:(I%p+p)%p};return o.viewportCenter=S,s&&(s.current=S),!0}return!1}function OI(e,t,i,o){const s=e-i.x,l=t-i.y;if(s<0||s>i.width||l<0||l>i.height)return null;const{width:c,height:d}=o.mapDimensions,u=i.width/2,h=i.height/2,p=s-u,y=l-h,A=p/i.width*c,v=y/i.height*d,I=o.viewportCenter.x+A,S=o.viewportCenter.y+v;return{x:(I%c+c)%c,y:(S%d+d)%d}}function eN(e,t,i){t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,l=t.viewportCenter.x+e.deltaX,c=t.viewportCenter.y+e.deltaY,d={x:(l%o+o)%o,y:(c%s+s)%s};return t.viewportCenter=d,i.current=d,!0}function tN(e,t){(e.button===1||e.button===2)&&(t.isDraggingViewport=!0,t.viewportDragButton=e.button,t.viewportDragDistance=0)}function nN(e,t,i){if(t.isDraggingViewport){t.viewportDragDistance+=Math.sqrt(e.movementX*e.movementX+e.movementY*e.movementY),t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,l=t.viewportCenter.x-e.movementX,c=t.viewportCenter.y-e.movementY,d={x:(l%o+o)%o,y:(c%s+s)%s};t.viewportCenter=d,i.current=d}}function iN(e,t){t.isDraggingViewport&&e.button===t.viewportDragButton&&(t.isDraggingViewport=!1,t.viewportDragButton=null)}const oN=({isActive:e,gameStateRef:t,canvasRef:i,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:l,returnToIntro:c})=>(Re.useEffect(()=>{const d=u=>{if(!e()||t.current.gameOver||!i.current)return;const h=i.current.getBoundingClientRect(),p=u.clientX-h.left,y=u.clientY-h.top;if(Jb(u,p,y,t.current,o)){u.preventDefault();return}const A=jb(u,t.current);t.current=A.newState,!A.handled&&eN(u,t.current,o)&&u.preventDefault()};return window.addEventListener("wheel",d,{passive:!1}),()=>{window.removeEventListener("wheel",d)}},[e,i,t,o]),Re.useEffect(()=>{const d=h=>{if(!e()||t.current.gameOver||!i.current||!h.target||h.target!==i.current)return;const p=i.current.getBoundingClientRect(),y=h.clientX-p.left,A=h.clientY-p.top;if(zb(t.current,y,A))return;const I=t.current.uiButtons.find(w=>y>=w.rect.x&&y<=w.rect.x+w.rect.width&&A>=w.rect.y&&A<=w.rect.y+w.rect.height);if(I){t.current=Yb(I,h.shiftKey,t.current,c);return}const S=t.current.minimapRect;if(S&&y>=S.x&&y<=S.x+S.width&&A>=S.y&&A<=S.y+S.height){qb(y,A,t.current);return}const E=Xb(h,t.current);if(t.current=E.newState,E.handled)return;tN(h,t.current);const _=Th({x:y,y:A},o.current,{width:i.current.width,height:i.current.height},t.current.mapDimensions);Lb(t.current,_)},u=h=>{if(!e()||!i.current)return;const p=i.current.getBoundingClientRect(),y=h.clientX-p.left,A=h.clientY-p.top;Zb(y,A,t.current,o),iN(h,t.current);const v=Vy(h,t.current);t.current=v.newState};return window.addEventListener("mousedown",d),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("mouseup",u)}},[e,i,t,o,c]),Re.useEffect(()=>{const d=u=>{if(!e()||!i.current)return;const h=Vb(u,t.current);if(t.current=h.newState,h.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const _=Vy(u,t.current);t.current=_.newState}const p=i.current.getBoundingClientRect(),y=u.clientX-p.left,A=u.clientY-p.top;nN(u,t.current,o),t.current.mousePosition={x:y,y:A};let v;if(t.current.notificationButtonRects){for(const[_,w]of Object.entries(t.current.notificationButtonRects.dismiss))if(y>=w.x&&y<=w.x+w.width&&A>=w.y&&A<=w.y+w.height){v=`notification-dismiss-${_}`;break}if(!v){for(const[_,w]of Object.entries(t.current.notificationButtonRects.view))if(y>=w.x&&y<=w.x+w.width&&A>=w.y&&A<=w.y+w.height){v=`notification-view-${_}`;break}}}if(!v)for(let _=t.current.uiButtons.length-1;_>=0;_--){const w=t.current.uiButtons[_];if(y>=w.rect.x&&y<=w.rect.x+w.rect.width&&A>=w.rect.y&&A<=w.rect.y+w.rect.height){v=w.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0,t.current.hoveredMinimapTribeId=null;return}const I=t.current.minimapRect,S=t.current.isDraggingMinimap;if(I&&y>=I.x&&y<=I.x+I.width&&A>=I.y&&A<=I.y+I.height||S){Kb(y,A,t.current,{x:u.movementX,y:u.movementY},o),t.current.autopilotControls.hoveredAutopilotAction=void 0;return}else t.current.hoveredMinimapTribeId=null;const E=ft(t.current);if(E){const _=Th({x:y,y:A},o.current,{width:i.current.width,height:i.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=Fb(_,E,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}},[e,i,t,o]),Re.useEffect(()=>{const d=h=>{if(!e()||t.current.gameOver)return;const p=h.key.toLowerCase();(p===" "||p==="p"||p==="tab"||(h.ctrlKey||h.metaKey)&&(p==="s"||p==="a"))&&h.preventDefault();const y=Ub(h,t.current);if(t.current=y.newState,y.handled)return;const A=ft(t.current);A&&(l.current.add(p),Gb(p,h.shiftKey,t.current,A,s.current))},u=h=>{if(!e()||t.current.gameOver)return;const p=h.key.toLowerCase();l.current.delete(p);const y=ft(t.current);y&&xb(p,y,t.current,l)};return window.addEventListener("keydown",d),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}},[e,t,s,l,c]),Re.useEffect(()=>{const d=i.current;if(!d)return;const u=h=>{e()&&h.preventDefault()};return d.addEventListener("contextmenu",u),()=>{d.removeEventListener("contextmenu",u)}},[i,e]),null),rN=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:i,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:l,canvasRef:c,setAppState:d,appState:u})=>{const h=Re.useRef(),{returnToIntro:p}=fr(),[y,A,v]=Rv(I=>{var R,b;if(!t.current||!h.current){h.current=I;return}const S=Math.min(I-h.current,1e3)/1e3,{performanceMetrics:E}=e.current;E.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const _=performance.now();e.current=Cu(e.current,S),E.currentBucket.worldUpdateTime=performance.now()-_;const w=ft(e.current);w?s.current=op(e.current,w):s.current=[],(e.current.viewportCenter.x!==o.current.x||e.current.viewportCenter.y!==o.current.y)&&(o.current=e.current.viewportCenter),o.current=$b(e.current,o.current,S),e.current.viewportCenter=o.current;const C=performance.now();Jc(t.current,e.current,o.current,s.current,{width:((R=c.current)==null?void 0:R.width)||800,height:((b=c.current)==null?void 0:b.height)||600},!1),E.currentBucket.renderTime=performance.now()-C,E.history.push({bucketTime:e.current.time,...E.currentBucket}),E.history.length>hw&&E.history.shift(),h.current=I,e.current.gameOver&&u!=="gameOver"&&(tp(Ae.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),d("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return Re.useEffect(()=>(A(),y),[A,y]),ke.jsx(oN,{isActive:v,gameStateRef:e,canvasRef:c,viewportCenterRef:o,playerActionHintsRef:s,debugPanelTypeRef:i,keysPressed:l,returnToIntro:p})},qy=()=>{const{savedGameState:e,contextReady:t}=fr(),[i,o]=Re.useState(null);return Re.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),o(e)):(console.log("Initializing new game state..."),o(Bb())))},[t,e]),!t||!i?ke.jsx("div",{children:"Loading..."}):ke.jsx(sN,{initialState:i})},sN=({initialState:e})=>{const t=Re.useRef(null),i=Re.useRef(null),o=Re.useRef(e),s=Re.useRef(new Set),l=Re.useRef(e.debugPanel),c=Re.useRef(e.viewportCenter),d=Re.useRef([]),{appState:u,setAppState:h}=fr();return ke.jsxs(ke.Fragment,{children:[ke.jsx(Hb,{canvasRef:t,ctxRef:i,gameStateRef:o,debugPanelTypeRef:l,viewportCenterRef:c,playerActionHintsRef:d}),ke.jsx(rN,{gameStateRef:o,ctxRef:i,debugPanelTypeRef:l,viewportCenterRef:c,playerActionHintsRef:d,keysPressed:s,canvasRef:t,setAppState:h,appState:u})]})},aN=wt.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,lN=wt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Cc=wt.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,cN=wt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,uN=()=>{const{setAppState:e,gameOverDetails:t}=fr(),i=()=>{e("intro")};return ke.jsxs(aN,{children:[ke.jsx(lN,{children:"Game Over"}),ke.jsx(Cc,{children:"Your tribe's lineage has ended."}),t&&ke.jsxs(ke.Fragment,{children:[ke.jsxs(Cc,{children:["Generations Survived: ",t.generations]}),ke.jsxs(Cc,{children:["Cause of Extinction: ",t.cause]})]}),!t&&ke.jsx(Cc,{children:"Game details are unavailable."}),ke.jsx(cN,{onClick:i,children:"Return to Menu"})]})},dN=wt.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,fN=wt.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,hN=wt.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,pN=wt.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,gN=wt.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,bI=wt.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,mN=wt(bI)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,ma=800,ya=600,yN=()=>{const{returnToIntro:e}=fr(),t=Re.useRef(null),i=Re.useRef(),o=Re.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:ma,height:ya}}),s=c=>{const d={x:ma/2,y:ya/2};let u;c===ve.StoneProjectile&&(u={x:d.x+200*(Math.random()-Math.random()),y:d.y+200*(Math.random()-Math.random())}),be(o.current,c,d,1,void 0,u)};Re.useEffect(()=>{const c=()=>{o.current.time+=.016,yI(o.current);const u=t.current,h=u==null?void 0:u.getContext("2d");h&&(h.clearRect(0,0,ma,ya),h.fillStyle="#2c5234",h.fillRect(0,0,ma,ya),o.current.visualEffects.forEach(p=>{MI(h,p,o.current.time,o.current)})),i.current=requestAnimationFrame(c)};return i.current=requestAnimationFrame(c),()=>{i.current&&cancelAnimationFrame(i.current)}},[]);const l=Object.keys(ve).filter(c=>isNaN(Number(c))).map(c=>({name:c,value:ve[c]}));return ke.jsxs(dN,{children:[ke.jsxs(fN,{children:[ke.jsx(gN,{children:"Visual Effects"}),l.map(c=>ke.jsx(bI,{onClick:()=>s(c.value),children:c.name},c.name)),ke.jsx(mN,{onClick:e,children:"Back to Intro"})]}),ke.jsxs(hN,{children:[ke.jsx(pN,{ref:t,width:ma,height:ya}),ke.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},vN=sw`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function AN(e,t){Re.useEffect(()=>{const i=()=>{const o=document.location.hash;t(o==="#game"?"game":o==="#effects"?"effects":"intro")};return window.addEventListener("hashchange",i),i(),()=>{window.removeEventListener("hashchange",i)}},[]),Re.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const IN=()=>{const{appState:e,setAppState:t}=fr();AN(e,t);const i=()=>{switch(e){case"intro":return ke.jsx(Xy,{});case"game":return ke.jsx(qy,{});case"effects":return ke.jsx(yN,{});case"gameOver":return ke.jsxs(ke.Fragment,{children:[ke.jsx(qy,{}),ke.jsx(uN,{})]});default:return ke.jsx(Xy,{})}};return ke.jsxs(ke.Fragment,{children:[ke.jsx(vN,{}),i()]})},Zy=document.getElementById("root");Zy?I_().then(()=>{xT.createRoot(Zy).render(ke.jsx(fi.StrictMode,{children:ke.jsx(rE,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:ke.jsx(IN,{})})}))}):console.error("Failed to find the root element");
