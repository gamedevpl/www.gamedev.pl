var FC=Object.defineProperty;var LC=(e,t,n)=>t in e?FC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Re=(e,t,n)=>LC(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function BS(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kh={exports:{}},tl={},Bh={exports:{}},Ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var By;function HC(){if(By)return Ye;By=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.iterator;function S(B){return B===null||typeof B!="object"?null:(B=m&&B[m]||B["@@iterator"],typeof B=="function"?B:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,I={};function E(B,j,fe){this.props=B,this.context=j,this.refs=I,this.updater=fe||v}E.prototype.isReactComponent={},E.prototype.setState=function(B,j){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,j,"setState")},E.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function P(){}P.prototype=E.prototype;function C(B,j,fe){this.props=B,this.context=j,this.refs=I,this.updater=fe||v}var w=C.prototype=new P;w.constructor=C,A(w,E.prototype),w.isPureReactComponent=!0;var O=Array.isArray,M=Object.prototype.hasOwnProperty,D={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function k(B,j,fe){var pe,Me={},he=null,Te=null;if(j!=null)for(pe in j.ref!==void 0&&(Te=j.ref),j.key!==void 0&&(he=""+j.key),j)M.call(j,pe)&&!N.hasOwnProperty(pe)&&(Me[pe]=j[pe]);var _e=arguments.length-2;if(_e===1)Me.children=fe;else if(1<_e){for(var ce=Array(_e),ve=0;ve<_e;ve++)ce[ve]=arguments[ve+2];Me.children=ce}if(B&&B.defaultProps)for(pe in _e=B.defaultProps,_e)Me[pe]===void 0&&(Me[pe]=_e[pe]);return{$$typeof:e,type:B,key:he,ref:Te,props:Me,_owner:D.current}}function U(B,j){return{$$typeof:e,type:B.type,key:j,ref:B.ref,props:B.props,_owner:B._owner}}function z(B){return typeof B=="object"&&B!==null&&B.$$typeof===e}function K(B){var j={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(fe){return j[fe]})}var X=/\/+/g;function J(B,j){return typeof B=="object"&&B!==null&&B.key!=null?K(""+B.key):j.toString(36)}function q(B,j,fe,pe,Me){var he=typeof B;(he==="undefined"||he==="boolean")&&(B=null);var Te=!1;if(B===null)Te=!0;else switch(he){case"string":case"number":Te=!0;break;case"object":switch(B.$$typeof){case e:case t:Te=!0}}if(Te)return Te=B,Me=Me(Te),B=pe===""?"."+J(Te,0):pe,O(Me)?(fe="",B!=null&&(fe=B.replace(X,"$&/")+"/"),q(Me,j,fe,"",function(ve){return ve})):Me!=null&&(z(Me)&&(Me=U(Me,fe+(!Me.key||Te&&Te.key===Me.key?"":(""+Me.key).replace(X,"$&/")+"/")+B)),j.push(Me)),1;if(Te=0,pe=pe===""?".":pe+":",O(B))for(var _e=0;_e<B.length;_e++){he=B[_e];var ce=pe+J(he,_e);Te+=q(he,j,fe,ce,Me)}else if(ce=S(B),typeof ce=="function")for(B=ce.call(B),_e=0;!(he=B.next()).done;)he=he.value,ce=pe+J(he,_e++),Te+=q(he,j,fe,ce,Me);else if(he==="object")throw j=String(B),Error("Objects are not valid as a React child (found: "+(j==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":j)+"). If you meant to render a collection of children, use an array instead.");return Te}function re(B,j,fe){if(B==null)return B;var pe=[],Me=0;return q(B,pe,"","",function(he){return j.call(fe,he,Me++)}),pe}function se(B){if(B._status===-1){var j=B._result;j=j(),j.then(function(fe){(B._status===0||B._status===-1)&&(B._status=1,B._result=fe)},function(fe){(B._status===0||B._status===-1)&&(B._status=2,B._result=fe)}),B._status===-1&&(B._status=0,B._result=j)}if(B._status===1)return B._result.default;throw B._result}var ie={current:null},Y={transition:null},Z={ReactCurrentDispatcher:ie,ReactCurrentBatchConfig:Y,ReactCurrentOwner:D};function Q(){throw Error("act(...) is not supported in production builds of React.")}return Ye.Children={map:re,forEach:function(B,j,fe){re(B,function(){j.apply(this,arguments)},fe)},count:function(B){var j=0;return re(B,function(){j++}),j},toArray:function(B){return re(B,function(j){return j})||[]},only:function(B){if(!z(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},Ye.Component=E,Ye.Fragment=n,Ye.Profiler=s,Ye.PureComponent=C,Ye.StrictMode=i,Ye.Suspense=u,Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z,Ye.act=Q,Ye.cloneElement=function(B,j,fe){if(B==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+B+".");var pe=A({},B.props),Me=B.key,he=B.ref,Te=B._owner;if(j!=null){if(j.ref!==void 0&&(he=j.ref,Te=D.current),j.key!==void 0&&(Me=""+j.key),B.type&&B.type.defaultProps)var _e=B.type.defaultProps;for(ce in j)M.call(j,ce)&&!N.hasOwnProperty(ce)&&(pe[ce]=j[ce]===void 0&&_e!==void 0?_e[ce]:j[ce])}var ce=arguments.length-2;if(ce===1)pe.children=fe;else if(1<ce){_e=Array(ce);for(var ve=0;ve<ce;ve++)_e[ve]=arguments[ve+2];pe.children=_e}return{$$typeof:e,type:B.type,key:Me,ref:he,props:pe,_owner:Te}},Ye.createContext=function(B){return B={$$typeof:l,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},B.Provider={$$typeof:a,_context:B},B.Consumer=B},Ye.createElement=k,Ye.createFactory=function(B){var j=k.bind(null,B);return j.type=B,j},Ye.createRef=function(){return{current:null}},Ye.forwardRef=function(B){return{$$typeof:d,render:B}},Ye.isValidElement=z,Ye.lazy=function(B){return{$$typeof:p,_payload:{_status:-1,_result:B},_init:se}},Ye.memo=function(B,j){return{$$typeof:f,type:B,compare:j===void 0?null:j}},Ye.startTransition=function(B){var j=Y.transition;Y.transition={};try{B()}finally{Y.transition=j}},Ye.unstable_act=Q,Ye.useCallback=function(B,j){return ie.current.useCallback(B,j)},Ye.useContext=function(B){return ie.current.useContext(B)},Ye.useDebugValue=function(){},Ye.useDeferredValue=function(B){return ie.current.useDeferredValue(B)},Ye.useEffect=function(B,j){return ie.current.useEffect(B,j)},Ye.useId=function(){return ie.current.useId()},Ye.useImperativeHandle=function(B,j,fe){return ie.current.useImperativeHandle(B,j,fe)},Ye.useInsertionEffect=function(B,j){return ie.current.useInsertionEffect(B,j)},Ye.useLayoutEffect=function(B,j){return ie.current.useLayoutEffect(B,j)},Ye.useMemo=function(B,j){return ie.current.useMemo(B,j)},Ye.useReducer=function(B,j,fe){return ie.current.useReducer(B,j,fe)},Ye.useRef=function(B){return ie.current.useRef(B)},Ye.useState=function(B){return ie.current.useState(B)},Ye.useSyncExternalStore=function(B,j,fe){return ie.current.useSyncExternalStore(B,j,fe)},Ye.useTransition=function(){return ie.current.useTransition()},Ye.version="18.3.1",Ye}var Fy;function Kp(){return Fy||(Fy=1,Bh.exports=HC()),Bh.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ly;function UC(){if(Ly)return tl;Ly=1;var e=Kp(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(d,u,f){var p,m={},S=null,v=null;f!==void 0&&(S=""+f),u.key!==void 0&&(S=""+u.key),u.ref!==void 0&&(v=u.ref);for(p in u)i.call(u,p)&&!a.hasOwnProperty(p)&&(m[p]=u[p]);if(d&&d.defaultProps)for(p in u=d.defaultProps,u)m[p]===void 0&&(m[p]=u[p]);return{$$typeof:t,type:d,key:S,ref:v,props:m,_owner:s.current}}return tl.Fragment=n,tl.jsx=l,tl.jsxs=l,tl}var Hy;function GC(){return Hy||(Hy=1,kh.exports=UC()),kh.exports}var Fe=GC(),ke=Kp();const ki=BS(ke);var fd={},Fh={exports:{}},Rn={},Lh={exports:{}},Hh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Uy;function xC(){return Uy||(Uy=1,function(e){function t(Y,Z){var Q=Y.length;Y.push(Z);e:for(;0<Q;){var B=Q-1>>>1,j=Y[B];if(0<s(j,Z))Y[B]=Z,Y[Q]=j,Q=B;else break e}}function n(Y){return Y.length===0?null:Y[0]}function i(Y){if(Y.length===0)return null;var Z=Y[0],Q=Y.pop();if(Q!==Z){Y[0]=Q;e:for(var B=0,j=Y.length,fe=j>>>1;B<fe;){var pe=2*(B+1)-1,Me=Y[pe],he=pe+1,Te=Y[he];if(0>s(Me,Q))he<j&&0>s(Te,Me)?(Y[B]=Te,Y[he]=Q,B=he):(Y[B]=Me,Y[pe]=Q,B=pe);else if(he<j&&0>s(Te,Q))Y[B]=Te,Y[he]=Q,B=he;else break e}}return Z}function s(Y,Z){var Q=Y.sortIndex-Z.sortIndex;return Q!==0?Q:Y.id-Z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var l=Date,d=l.now();e.unstable_now=function(){return l.now()-d}}var u=[],f=[],p=1,m=null,S=3,v=!1,A=!1,I=!1,E=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(Y){for(var Z=n(f);Z!==null;){if(Z.callback===null)i(f);else if(Z.startTime<=Y)i(f),Z.sortIndex=Z.expirationTime,t(u,Z);else break;Z=n(f)}}function O(Y){if(I=!1,w(Y),!A)if(n(u)!==null)A=!0,se(M);else{var Z=n(f);Z!==null&&ie(O,Z.startTime-Y)}}function M(Y,Z){A=!1,I&&(I=!1,P(k),k=-1),v=!0;var Q=S;try{for(w(Z),m=n(u);m!==null&&(!(m.expirationTime>Z)||Y&&!K());){var B=m.callback;if(typeof B=="function"){m.callback=null,S=m.priorityLevel;var j=B(m.expirationTime<=Z);Z=e.unstable_now(),typeof j=="function"?m.callback=j:m===n(u)&&i(u),w(Z)}else i(u);m=n(u)}if(m!==null)var fe=!0;else{var pe=n(f);pe!==null&&ie(O,pe.startTime-Z),fe=!1}return fe}finally{m=null,S=Q,v=!1}}var D=!1,N=null,k=-1,U=5,z=-1;function K(){return!(e.unstable_now()-z<U)}function X(){if(N!==null){var Y=e.unstable_now();z=Y;var Z=!0;try{Z=N(!0,Y)}finally{Z?J():(D=!1,N=null)}}else D=!1}var J;if(typeof C=="function")J=function(){C(X)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,re=q.port2;q.port1.onmessage=X,J=function(){re.postMessage(null)}}else J=function(){E(X,0)};function se(Y){N=Y,D||(D=!0,J())}function ie(Y,Z){k=E(function(){Y(e.unstable_now())},Z)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Y){Y.callback=null},e.unstable_continueExecution=function(){A||v||(A=!0,se(M))},e.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):U=0<Y?Math.floor(1e3/Y):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(Y){switch(S){case 1:case 2:case 3:var Z=3;break;default:Z=S}var Q=S;S=Z;try{return Y()}finally{S=Q}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Y,Z){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var Q=S;S=Y;try{return Z()}finally{S=Q}},e.unstable_scheduleCallback=function(Y,Z,Q){var B=e.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?B+Q:B):Q=B,Y){case 1:var j=-1;break;case 2:j=250;break;case 5:j=1073741823;break;case 4:j=1e4;break;default:j=5e3}return j=Q+j,Y={id:p++,callback:Z,priorityLevel:Y,startTime:Q,expirationTime:j,sortIndex:-1},Q>B?(Y.sortIndex=Q,t(f,Y),n(u)===null&&Y===n(f)&&(I?(P(k),k=-1):I=!0,ie(O,Q-B))):(Y.sortIndex=j,t(u,Y),A||v||(A=!0,se(M))),Y},e.unstable_shouldYield=K,e.unstable_wrapCallback=function(Y){var Z=S;return function(){var Q=S;S=Z;try{return Y.apply(this,arguments)}finally{S=Q}}}}(Hh)),Hh}var Gy;function $C(){return Gy||(Gy=1,Lh.exports=xC()),Lh.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xy;function WC(){if(xy)return Rn;xy=1;var e=Kp(),t=$C();function n(o){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+o,c=1;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+o+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function a(o,r){l(o,r),l(o+"Capture",r)}function l(o,r){for(s[o]=r,o=0;o<r.length;o++)i.add(r[o])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function S(o){return u.call(m,o)?!0:u.call(p,o)?!1:f.test(o)?m[o]=!0:(p[o]=!0,!1)}function v(o,r,c,h){if(c!==null&&c.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return h?!1:c!==null?!c.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function A(o,r,c,h){if(r===null||typeof r>"u"||v(o,r,c,h))return!0;if(h)return!1;if(c!==null)switch(c.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function I(o,r,c,h,g,y,T){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=h,this.attributeNamespace=g,this.mustUseProperty=c,this.propertyName=o,this.type=r,this.sanitizeURL=y,this.removeEmptyString=T}var E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){E[o]=new I(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var r=o[0];E[r]=new I(r,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){E[o]=new I(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){E[o]=new I(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){E[o]=new I(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){E[o]=new I(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){E[o]=new I(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){E[o]=new I(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){E[o]=new I(o,5,!1,o.toLowerCase(),null,!1,!1)});var P=/[\-:]([a-z])/g;function C(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var r=o.replace(P,C);E[r]=new I(r,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var r=o.replace(P,C);E[r]=new I(r,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var r=o.replace(P,C);E[r]=new I(r,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){E[o]=new I(o,1,!1,o.toLowerCase(),null,!1,!1)}),E.xlinkHref=new I("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){E[o]=new I(o,1,!1,o.toLowerCase(),null,!0,!0)});function w(o,r,c,h){var g=E.hasOwnProperty(r)?E[r]:null;(g!==null?g.type!==0:h||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(A(r,c,g,h)&&(c=null),h||g===null?S(r)&&(c===null?o.removeAttribute(r):o.setAttribute(r,""+c)):g.mustUseProperty?o[g.propertyName]=c===null?g.type===3?!1:"":c:(r=g.attributeName,h=g.attributeNamespace,c===null?o.removeAttribute(r):(g=g.type,c=g===3||g===4&&c===!0?"":""+c,h?o.setAttributeNS(h,r,c):o.setAttribute(r,c))))}var O=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),D=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),k=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),z=Symbol.for("react.provider"),K=Symbol.for("react.context"),X=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),q=Symbol.for("react.suspense_list"),re=Symbol.for("react.memo"),se=Symbol.for("react.lazy"),ie=Symbol.for("react.offscreen"),Y=Symbol.iterator;function Z(o){return o===null||typeof o!="object"?null:(o=Y&&o[Y]||o["@@iterator"],typeof o=="function"?o:null)}var Q=Object.assign,B;function j(o){if(B===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);B=r&&r[1]||""}return`
`+B+o}var fe=!1;function pe(o,r){if(!o||fe)return"";fe=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(W){var h=W}Reflect.construct(o,[],r)}else{try{r.call()}catch(W){h=W}o.call(r.prototype)}else{try{throw Error()}catch(W){h=W}o()}}catch(W){if(W&&h&&typeof W.stack=="string"){for(var g=W.stack.split(`
`),y=h.stack.split(`
`),T=g.length-1,b=y.length-1;1<=T&&0<=b&&g[T]!==y[b];)b--;for(;1<=T&&0<=b;T--,b--)if(g[T]!==y[b]){if(T!==1||b!==1)do if(T--,b--,0>b||g[T]!==y[b]){var F=`
`+g[T].replace(" at new "," at ");return o.displayName&&F.includes("<anonymous>")&&(F=F.replace("<anonymous>",o.displayName)),F}while(1<=T&&0<=b);break}}}finally{fe=!1,Error.prepareStackTrace=c}return(o=o?o.displayName||o.name:"")?j(o):""}function Me(o){switch(o.tag){case 5:return j(o.type);case 16:return j("Lazy");case 13:return j("Suspense");case 19:return j("SuspenseList");case 0:case 2:case 15:return o=pe(o.type,!1),o;case 11:return o=pe(o.type.render,!1),o;case 1:return o=pe(o.type,!0),o;default:return""}}function he(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case N:return"Fragment";case D:return"Portal";case U:return"Profiler";case k:return"StrictMode";case J:return"Suspense";case q:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case K:return(o.displayName||"Context")+".Consumer";case z:return(o._context.displayName||"Context")+".Provider";case X:var r=o.render;return o=o.displayName,o||(o=r.displayName||r.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case re:return r=o.displayName||null,r!==null?r:he(o.type)||"Memo";case se:r=o._payload,o=o._init;try{return he(o(r))}catch{}}return null}function Te(o){var r=o.type;switch(o.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=r.render,o=o.displayName||o.name||"",r.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return he(r);case 8:return r===k?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function _e(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function ce(o){var r=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function ve(o){var r=ce(o)?"checked":"value",c=Object.getOwnPropertyDescriptor(o.constructor.prototype,r),h=""+o[r];if(!o.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,y=c.set;return Object.defineProperty(o,r,{configurable:!0,get:function(){return g.call(this)},set:function(T){h=""+T,y.call(this,T)}}),Object.defineProperty(o,r,{enumerable:c.enumerable}),{getValue:function(){return h},setValue:function(T){h=""+T},stopTracking:function(){o._valueTracker=null,delete o[r]}}}}function Ge(o){o._valueTracker||(o._valueTracker=ve(o))}function Pe(o){if(!o)return!1;var r=o._valueTracker;if(!r)return!0;var c=r.getValue(),h="";return o&&(h=ce(o)?o.checked?"true":"false":o.value),o=h,o!==c?(r.setValue(o),!0):!1}function Xn(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function rt(o,r){var c=r.checked;return Q({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??o._wrapperState.initialChecked})}function it(o,r){var c=r.defaultValue==null?"":r.defaultValue,h=r.checked!=null?r.checked:r.defaultChecked;c=_e(r.value!=null?r.value:c),o._wrapperState={initialChecked:h,initialValue:c,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function Vn(o,r){r=r.checked,r!=null&&w(o,"checked",r,!1)}function In(o,r){Vn(o,r);var c=_e(r.value),h=r.type;if(c!=null)h==="number"?(c===0&&o.value===""||o.value!=c)&&(o.value=""+c):o.value!==""+c&&(o.value=""+c);else if(h==="submit"||h==="reset"){o.removeAttribute("value");return}r.hasOwnProperty("value")?Ai(o,r.type,c):r.hasOwnProperty("defaultValue")&&Ai(o,r.type,_e(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(o.defaultChecked=!!r.defaultChecked)}function Kn(o,r,c){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var h=r.type;if(!(h!=="submit"&&h!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+o._wrapperState.initialValue,c||r===o.value||(o.value=r),o.defaultValue=r}c=o.name,c!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,c!==""&&(o.name=c)}function Ai(o,r,c){(r!=="number"||Xn(o.ownerDocument)!==o)&&(c==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+c&&(o.defaultValue=""+c))}var Ii=Array.isArray;function ho(o,r,c,h){if(o=o.options,r){r={};for(var g=0;g<c.length;g++)r["$"+c[g]]=!0;for(c=0;c<o.length;c++)g=r.hasOwnProperty("$"+o[c].value),o[c].selected!==g&&(o[c].selected=g),g&&h&&(o[c].defaultSelected=!0)}else{for(c=""+_e(c),r=null,g=0;g<o.length;g++){if(o[g].value===c){o[g].selected=!0,h&&(o[g].defaultSelected=!0);return}r!==null||o[g].disabled||(r=o[g])}r!==null&&(r.selected=!0)}}function or(o,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return Q({},r,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function zg(o,r){var c=r.value;if(c==null){if(c=r.children,r=r.defaultValue,c!=null){if(r!=null)throw Error(n(92));if(Ii(c)){if(1<c.length)throw Error(n(93));c=c[0]}r=c}r==null&&(r=""),c=r}o._wrapperState={initialValue:_e(c)}}function jg(o,r){var c=_e(r.value),h=_e(r.defaultValue);c!=null&&(c=""+c,c!==o.value&&(o.value=c),r.defaultValue==null&&o.defaultValue!==c&&(o.defaultValue=c)),h!=null&&(o.defaultValue=""+h)}function Xg(o){var r=o.textContent;r===o._wrapperState.initialValue&&r!==""&&r!==null&&(o.value=r)}function Vg(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Yu(o,r){return o==null||o==="http://www.w3.org/1999/xhtml"?Vg(r):o==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var oc,Kg=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,c,h,g){MSApp.execUnsafeLocalFunction(function(){return o(r,c,h,g)})}:o}(function(o,r){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=r;else{for(oc=oc||document.createElement("div"),oc.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=oc.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;r.firstChild;)o.appendChild(r.firstChild)}});function ya(o,r){if(r){var c=o.firstChild;if(c&&c===o.lastChild&&c.nodeType===3){c.nodeValue=r;return}}o.textContent=r}var va={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},GT=["Webkit","ms","Moz","O"];Object.keys(va).forEach(function(o){GT.forEach(function(r){r=r+o.charAt(0).toUpperCase()+o.substring(1),va[r]=va[o]})});function qg(o,r,c){return r==null||typeof r=="boolean"||r===""?"":c||typeof r!="number"||r===0||va.hasOwnProperty(o)&&va[o]?(""+r).trim():r+"px"}function Zg(o,r){o=o.style;for(var c in r)if(r.hasOwnProperty(c)){var h=c.indexOf("--")===0,g=qg(c,r[c],h);c==="float"&&(c="cssFloat"),h?o.setProperty(c,g):o[c]=g}}var xT=Q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function zu(o,r){if(r){if(xT[o]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,o));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function ju(o,r){if(o.indexOf("-")===-1)return typeof r.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Xu=null;function Vu(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Ku=null,Qr=null,Jr=null;function Qg(o){if(o=Ga(o)){if(typeof Ku!="function")throw Error(n(280));var r=o.stateNode;r&&(r=Rc(r),Ku(o.stateNode,o.type,r))}}function Jg(o){Qr?Jr?Jr.push(o):Jr=[o]:Qr=o}function em(){if(Qr){var o=Qr,r=Jr;if(Jr=Qr=null,Qg(o),r)for(o=0;o<r.length;o++)Qg(r[o])}}function tm(o,r){return o(r)}function nm(){}var qu=!1;function im(o,r,c){if(qu)return o(r,c);qu=!0;try{return tm(o,r,c)}finally{qu=!1,(Qr!==null||Jr!==null)&&(nm(),em())}}function Sa(o,r){var c=o.stateNode;if(c===null)return null;var h=Rc(c);if(h===null)return null;c=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(o=o.type,h=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!h;break e;default:o=!1}if(o)return null;if(c&&typeof c!="function")throw Error(n(231,r,typeof c));return c}var Zu=!1;if(d)try{var Aa={};Object.defineProperty(Aa,"passive",{get:function(){Zu=!0}}),window.addEventListener("test",Aa,Aa),window.removeEventListener("test",Aa,Aa)}catch{Zu=!1}function $T(o,r,c,h,g,y,T,b,F){var W=Array.prototype.slice.call(arguments,3);try{r.apply(c,W)}catch(te){this.onError(te)}}var Ia=!1,rc=null,sc=!1,Qu=null,WT={onError:function(o){Ia=!0,rc=o}};function YT(o,r,c,h,g,y,T,b,F){Ia=!1,rc=null,$T.apply(WT,arguments)}function zT(o,r,c,h,g,y,T,b,F){if(YT.apply(this,arguments),Ia){if(Ia){var W=rc;Ia=!1,rc=null}else throw Error(n(198));sc||(sc=!0,Qu=W)}}function rr(o){var r=o,c=o;if(o.alternate)for(;r.return;)r=r.return;else{o=r;do r=o,(r.flags&4098)!==0&&(c=r.return),o=r.return;while(o)}return r.tag===3?c:null}function om(o){if(o.tag===13){var r=o.memoizedState;if(r===null&&(o=o.alternate,o!==null&&(r=o.memoizedState)),r!==null)return r.dehydrated}return null}function rm(o){if(rr(o)!==o)throw Error(n(188))}function jT(o){var r=o.alternate;if(!r){if(r=rr(o),r===null)throw Error(n(188));return r!==o?null:o}for(var c=o,h=r;;){var g=c.return;if(g===null)break;var y=g.alternate;if(y===null){if(h=g.return,h!==null){c=h;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===c)return rm(g),o;if(y===h)return rm(g),r;y=y.sibling}throw Error(n(188))}if(c.return!==h.return)c=g,h=y;else{for(var T=!1,b=g.child;b;){if(b===c){T=!0,c=g,h=y;break}if(b===h){T=!0,h=g,c=y;break}b=b.sibling}if(!T){for(b=y.child;b;){if(b===c){T=!0,c=y,h=g;break}if(b===h){T=!0,h=y,c=g;break}b=b.sibling}if(!T)throw Error(n(189))}}if(c.alternate!==h)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?o:r}function sm(o){return o=jT(o),o!==null?am(o):null}function am(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var r=am(o);if(r!==null)return r;o=o.sibling}return null}var lm=t.unstable_scheduleCallback,cm=t.unstable_cancelCallback,XT=t.unstable_shouldYield,VT=t.unstable_requestPaint,Et=t.unstable_now,KT=t.unstable_getCurrentPriorityLevel,Ju=t.unstable_ImmediatePriority,dm=t.unstable_UserBlockingPriority,ac=t.unstable_NormalPriority,qT=t.unstable_LowPriority,um=t.unstable_IdlePriority,lc=null,Ti=null;function ZT(o){if(Ti&&typeof Ti.onCommitFiberRoot=="function")try{Ti.onCommitFiberRoot(lc,o,void 0,(o.current.flags&128)===128)}catch{}}var di=Math.clz32?Math.clz32:eE,QT=Math.log,JT=Math.LN2;function eE(o){return o>>>=0,o===0?32:31-(QT(o)/JT|0)|0}var cc=64,dc=4194304;function Ta(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function uc(o,r){var c=o.pendingLanes;if(c===0)return 0;var h=0,g=o.suspendedLanes,y=o.pingedLanes,T=c&268435455;if(T!==0){var b=T&~g;b!==0?h=Ta(b):(y&=T,y!==0&&(h=Ta(y)))}else T=c&~g,T!==0?h=Ta(T):y!==0&&(h=Ta(y));if(h===0)return 0;if(r!==0&&r!==h&&(r&g)===0&&(g=h&-h,y=r&-r,g>=y||g===16&&(y&4194240)!==0))return r;if((h&4)!==0&&(h|=c&16),r=o.entangledLanes,r!==0)for(o=o.entanglements,r&=h;0<r;)c=31-di(r),g=1<<c,h|=o[c],r&=~g;return h}function tE(o,r){switch(o){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function nE(o,r){for(var c=o.suspendedLanes,h=o.pingedLanes,g=o.expirationTimes,y=o.pendingLanes;0<y;){var T=31-di(y),b=1<<T,F=g[T];F===-1?((b&c)===0||(b&h)!==0)&&(g[T]=tE(b,r)):F<=r&&(o.expiredLanes|=b),y&=~b}}function ef(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function fm(){var o=cc;return cc<<=1,(cc&4194240)===0&&(cc=64),o}function tf(o){for(var r=[],c=0;31>c;c++)r.push(o);return r}function Ea(o,r,c){o.pendingLanes|=r,r!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,r=31-di(r),o[r]=c}function iE(o,r){var c=o.pendingLanes&~r;o.pendingLanes=r,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=r,o.mutableReadLanes&=r,o.entangledLanes&=r,r=o.entanglements;var h=o.eventTimes;for(o=o.expirationTimes;0<c;){var g=31-di(c),y=1<<g;r[g]=0,h[g]=-1,o[g]=-1,c&=~y}}function nf(o,r){var c=o.entangledLanes|=r;for(o=o.entanglements;c;){var h=31-di(c),g=1<<h;g&r|o[h]&r&&(o[h]|=r),c&=~g}}var et=0;function hm(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var pm,of,gm,mm,ym,rf=!1,fc=[],po=null,go=null,mo=null,Ca=new Map,wa=new Map,yo=[],oE="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function vm(o,r){switch(o){case"focusin":case"focusout":po=null;break;case"dragenter":case"dragleave":go=null;break;case"mouseover":case"mouseout":mo=null;break;case"pointerover":case"pointerout":Ca.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":wa.delete(r.pointerId)}}function _a(o,r,c,h,g,y){return o===null||o.nativeEvent!==y?(o={blockedOn:r,domEventName:c,eventSystemFlags:h,nativeEvent:y,targetContainers:[g]},r!==null&&(r=Ga(r),r!==null&&of(r)),o):(o.eventSystemFlags|=h,r=o.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),o)}function rE(o,r,c,h,g){switch(r){case"focusin":return po=_a(po,o,r,c,h,g),!0;case"dragenter":return go=_a(go,o,r,c,h,g),!0;case"mouseover":return mo=_a(mo,o,r,c,h,g),!0;case"pointerover":var y=g.pointerId;return Ca.set(y,_a(Ca.get(y)||null,o,r,c,h,g)),!0;case"gotpointercapture":return y=g.pointerId,wa.set(y,_a(wa.get(y)||null,o,r,c,h,g)),!0}return!1}function Sm(o){var r=sr(o.target);if(r!==null){var c=rr(r);if(c!==null){if(r=c.tag,r===13){if(r=om(c),r!==null){o.blockedOn=r,ym(o.priority,function(){gm(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){o.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}o.blockedOn=null}function hc(o){if(o.blockedOn!==null)return!1;for(var r=o.targetContainers;0<r.length;){var c=af(o.domEventName,o.eventSystemFlags,r[0],o.nativeEvent);if(c===null){c=o.nativeEvent;var h=new c.constructor(c.type,c);Xu=h,c.target.dispatchEvent(h),Xu=null}else return r=Ga(c),r!==null&&of(r),o.blockedOn=c,!1;r.shift()}return!0}function Am(o,r,c){hc(o)&&c.delete(r)}function sE(){rf=!1,po!==null&&hc(po)&&(po=null),go!==null&&hc(go)&&(go=null),mo!==null&&hc(mo)&&(mo=null),Ca.forEach(Am),wa.forEach(Am)}function Ra(o,r){o.blockedOn===r&&(o.blockedOn=null,rf||(rf=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,sE)))}function Pa(o){function r(g){return Ra(g,o)}if(0<fc.length){Ra(fc[0],o);for(var c=1;c<fc.length;c++){var h=fc[c];h.blockedOn===o&&(h.blockedOn=null)}}for(po!==null&&Ra(po,o),go!==null&&Ra(go,o),mo!==null&&Ra(mo,o),Ca.forEach(r),wa.forEach(r),c=0;c<yo.length;c++)h=yo[c],h.blockedOn===o&&(h.blockedOn=null);for(;0<yo.length&&(c=yo[0],c.blockedOn===null);)Sm(c),c.blockedOn===null&&yo.shift()}var es=O.ReactCurrentBatchConfig,pc=!0;function aE(o,r,c,h){var g=et,y=es.transition;es.transition=null;try{et=1,sf(o,r,c,h)}finally{et=g,es.transition=y}}function lE(o,r,c,h){var g=et,y=es.transition;es.transition=null;try{et=4,sf(o,r,c,h)}finally{et=g,es.transition=y}}function sf(o,r,c,h){if(pc){var g=af(o,r,c,h);if(g===null)Cf(o,r,h,gc,c),vm(o,h);else if(rE(g,o,r,c,h))h.stopPropagation();else if(vm(o,h),r&4&&-1<oE.indexOf(o)){for(;g!==null;){var y=Ga(g);if(y!==null&&pm(y),y=af(o,r,c,h),y===null&&Cf(o,r,h,gc,c),y===g)break;g=y}g!==null&&h.stopPropagation()}else Cf(o,r,h,null,c)}}var gc=null;function af(o,r,c,h){if(gc=null,o=Vu(h),o=sr(o),o!==null)if(r=rr(o),r===null)o=null;else if(c=r.tag,c===13){if(o=om(r),o!==null)return o;o=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;o=null}else r!==o&&(o=null);return gc=o,null}function Im(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(KT()){case Ju:return 1;case dm:return 4;case ac:case qT:return 16;case um:return 536870912;default:return 16}default:return 16}}var vo=null,lf=null,mc=null;function Tm(){if(mc)return mc;var o,r=lf,c=r.length,h,g="value"in vo?vo.value:vo.textContent,y=g.length;for(o=0;o<c&&r[o]===g[o];o++);var T=c-o;for(h=1;h<=T&&r[c-h]===g[y-h];h++);return mc=g.slice(o,1<h?1-h:void 0)}function yc(o){var r=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&r===13&&(o=13)):o=r,o===10&&(o=13),32<=o||o===13?o:0}function vc(){return!0}function Em(){return!1}function bn(o){function r(c,h,g,y,T){this._reactName=c,this._targetInst=g,this.type=h,this.nativeEvent=y,this.target=T,this.currentTarget=null;for(var b in o)o.hasOwnProperty(b)&&(c=o[b],this[b]=c?c(y):y[b]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?vc:Em,this.isPropagationStopped=Em,this}return Q(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=vc)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=vc)},persist:function(){},isPersistent:vc}),r}var ts={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cf=bn(ts),Da=Q({},ts,{view:0,detail:0}),cE=bn(Da),df,uf,Ma,Sc=Q({},Da,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hf,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Ma&&(Ma&&o.type==="mousemove"?(df=o.screenX-Ma.screenX,uf=o.screenY-Ma.screenY):uf=df=0,Ma=o),df)},movementY:function(o){return"movementY"in o?o.movementY:uf}}),Cm=bn(Sc),dE=Q({},Sc,{dataTransfer:0}),uE=bn(dE),fE=Q({},Da,{relatedTarget:0}),ff=bn(fE),hE=Q({},ts,{animationName:0,elapsedTime:0,pseudoElement:0}),pE=bn(hE),gE=Q({},ts,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),mE=bn(gE),yE=Q({},ts,{data:0}),wm=bn(yE),vE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},SE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},AE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function IE(o){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(o):(o=AE[o])?!!r[o]:!1}function hf(){return IE}var TE=Q({},Da,{key:function(o){if(o.key){var r=vE[o.key]||o.key;if(r!=="Unidentified")return r}return o.type==="keypress"?(o=yc(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?SE[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hf,charCode:function(o){return o.type==="keypress"?yc(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?yc(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),EE=bn(TE),CE=Q({},Sc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),_m=bn(CE),wE=Q({},Da,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hf}),_E=bn(wE),RE=Q({},ts,{propertyName:0,elapsedTime:0,pseudoElement:0}),PE=bn(RE),DE=Q({},Sc,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),ME=bn(DE),NE=[9,13,27,32],pf=d&&"CompositionEvent"in window,Na=null;d&&"documentMode"in document&&(Na=document.documentMode);var bE=d&&"TextEvent"in window&&!Na,Rm=d&&(!pf||Na&&8<Na&&11>=Na),Pm=" ",Dm=!1;function Mm(o,r){switch(o){case"keyup":return NE.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nm(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var ns=!1;function OE(o,r){switch(o){case"compositionend":return Nm(r);case"keypress":return r.which!==32?null:(Dm=!0,Pm);case"textInput":return o=r.data,o===Pm&&Dm?null:o;default:return null}}function kE(o,r){if(ns)return o==="compositionend"||!pf&&Mm(o,r)?(o=Tm(),mc=lf=vo=null,ns=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Rm&&r.locale!=="ko"?null:r.data;default:return null}}var BE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function bm(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r==="input"?!!BE[o.type]:r==="textarea"}function Om(o,r,c,h){Jg(h),r=Cc(r,"onChange"),0<r.length&&(c=new cf("onChange","change",null,c,h),o.push({event:c,listeners:r}))}var ba=null,Oa=null;function FE(o){Zm(o,0)}function Ac(o){var r=as(o);if(Pe(r))return o}function LE(o,r){if(o==="change")return r}var km=!1;if(d){var gf;if(d){var mf="oninput"in document;if(!mf){var Bm=document.createElement("div");Bm.setAttribute("oninput","return;"),mf=typeof Bm.oninput=="function"}gf=mf}else gf=!1;km=gf&&(!document.documentMode||9<document.documentMode)}function Fm(){ba&&(ba.detachEvent("onpropertychange",Lm),Oa=ba=null)}function Lm(o){if(o.propertyName==="value"&&Ac(Oa)){var r=[];Om(r,Oa,o,Vu(o)),im(FE,r)}}function HE(o,r,c){o==="focusin"?(Fm(),ba=r,Oa=c,ba.attachEvent("onpropertychange",Lm)):o==="focusout"&&Fm()}function UE(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Ac(Oa)}function GE(o,r){if(o==="click")return Ac(r)}function xE(o,r){if(o==="input"||o==="change")return Ac(r)}function $E(o,r){return o===r&&(o!==0||1/o===1/r)||o!==o&&r!==r}var ui=typeof Object.is=="function"?Object.is:$E;function ka(o,r){if(ui(o,r))return!0;if(typeof o!="object"||o===null||typeof r!="object"||r===null)return!1;var c=Object.keys(o),h=Object.keys(r);if(c.length!==h.length)return!1;for(h=0;h<c.length;h++){var g=c[h];if(!u.call(r,g)||!ui(o[g],r[g]))return!1}return!0}function Hm(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Um(o,r){var c=Hm(o);o=0;for(var h;c;){if(c.nodeType===3){if(h=o+c.textContent.length,o<=r&&h>=r)return{node:c,offset:r-o};o=h}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Hm(c)}}function Gm(o,r){return o&&r?o===r?!0:o&&o.nodeType===3?!1:r&&r.nodeType===3?Gm(o,r.parentNode):"contains"in o?o.contains(r):o.compareDocumentPosition?!!(o.compareDocumentPosition(r)&16):!1:!1}function xm(){for(var o=window,r=Xn();r instanceof o.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)o=r.contentWindow;else break;r=Xn(o.document)}return r}function yf(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r&&(r==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||r==="textarea"||o.contentEditable==="true")}function WE(o){var r=xm(),c=o.focusedElem,h=o.selectionRange;if(r!==c&&c&&c.ownerDocument&&Gm(c.ownerDocument.documentElement,c)){if(h!==null&&yf(c)){if(r=h.start,o=h.end,o===void 0&&(o=r),"selectionStart"in c)c.selectionStart=r,c.selectionEnd=Math.min(o,c.value.length);else if(o=(r=c.ownerDocument||document)&&r.defaultView||window,o.getSelection){o=o.getSelection();var g=c.textContent.length,y=Math.min(h.start,g);h=h.end===void 0?y:Math.min(h.end,g),!o.extend&&y>h&&(g=h,h=y,y=g),g=Um(c,y);var T=Um(c,h);g&&T&&(o.rangeCount!==1||o.anchorNode!==g.node||o.anchorOffset!==g.offset||o.focusNode!==T.node||o.focusOffset!==T.offset)&&(r=r.createRange(),r.setStart(g.node,g.offset),o.removeAllRanges(),y>h?(o.addRange(r),o.extend(T.node,T.offset)):(r.setEnd(T.node,T.offset),o.addRange(r)))}}for(r=[],o=c;o=o.parentNode;)o.nodeType===1&&r.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<r.length;c++)o=r[c],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var YE=d&&"documentMode"in document&&11>=document.documentMode,is=null,vf=null,Ba=null,Sf=!1;function $m(o,r,c){var h=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Sf||is==null||is!==Xn(h)||(h=is,"selectionStart"in h&&yf(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Ba&&ka(Ba,h)||(Ba=h,h=Cc(vf,"onSelect"),0<h.length&&(r=new cf("onSelect","select",null,r,c),o.push({event:r,listeners:h}),r.target=is)))}function Ic(o,r){var c={};return c[o.toLowerCase()]=r.toLowerCase(),c["Webkit"+o]="webkit"+r,c["Moz"+o]="moz"+r,c}var os={animationend:Ic("Animation","AnimationEnd"),animationiteration:Ic("Animation","AnimationIteration"),animationstart:Ic("Animation","AnimationStart"),transitionend:Ic("Transition","TransitionEnd")},Af={},Wm={};d&&(Wm=document.createElement("div").style,"AnimationEvent"in window||(delete os.animationend.animation,delete os.animationiteration.animation,delete os.animationstart.animation),"TransitionEvent"in window||delete os.transitionend.transition);function Tc(o){if(Af[o])return Af[o];if(!os[o])return o;var r=os[o],c;for(c in r)if(r.hasOwnProperty(c)&&c in Wm)return Af[o]=r[c];return o}var Ym=Tc("animationend"),zm=Tc("animationiteration"),jm=Tc("animationstart"),Xm=Tc("transitionend"),Vm=new Map,Km="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function So(o,r){Vm.set(o,r),a(r,[o])}for(var If=0;If<Km.length;If++){var Tf=Km[If],zE=Tf.toLowerCase(),jE=Tf[0].toUpperCase()+Tf.slice(1);So(zE,"on"+jE)}So(Ym,"onAnimationEnd"),So(zm,"onAnimationIteration"),So(jm,"onAnimationStart"),So("dblclick","onDoubleClick"),So("focusin","onFocus"),So("focusout","onBlur"),So(Xm,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fa="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),XE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fa));function qm(o,r,c){var h=o.type||"unknown-event";o.currentTarget=c,zT(h,r,void 0,o),o.currentTarget=null}function Zm(o,r){r=(r&4)!==0;for(var c=0;c<o.length;c++){var h=o[c],g=h.event;h=h.listeners;e:{var y=void 0;if(r)for(var T=h.length-1;0<=T;T--){var b=h[T],F=b.instance,W=b.currentTarget;if(b=b.listener,F!==y&&g.isPropagationStopped())break e;qm(g,b,W),y=F}else for(T=0;T<h.length;T++){if(b=h[T],F=b.instance,W=b.currentTarget,b=b.listener,F!==y&&g.isPropagationStopped())break e;qm(g,b,W),y=F}}}if(sc)throw o=Qu,sc=!1,Qu=null,o}function lt(o,r){var c=r[Mf];c===void 0&&(c=r[Mf]=new Set);var h=o+"__bubble";c.has(h)||(Qm(r,o,2,!1),c.add(h))}function Ef(o,r,c){var h=0;r&&(h|=4),Qm(c,o,h,r)}var Ec="_reactListening"+Math.random().toString(36).slice(2);function La(o){if(!o[Ec]){o[Ec]=!0,i.forEach(function(c){c!=="selectionchange"&&(XE.has(c)||Ef(c,!1,o),Ef(c,!0,o))});var r=o.nodeType===9?o:o.ownerDocument;r===null||r[Ec]||(r[Ec]=!0,Ef("selectionchange",!1,r))}}function Qm(o,r,c,h){switch(Im(r)){case 1:var g=aE;break;case 4:g=lE;break;default:g=sf}c=g.bind(null,r,c,o),g=void 0,!Zu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),h?g!==void 0?o.addEventListener(r,c,{capture:!0,passive:g}):o.addEventListener(r,c,!0):g!==void 0?o.addEventListener(r,c,{passive:g}):o.addEventListener(r,c,!1)}function Cf(o,r,c,h,g){var y=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var T=h.tag;if(T===3||T===4){var b=h.stateNode.containerInfo;if(b===g||b.nodeType===8&&b.parentNode===g)break;if(T===4)for(T=h.return;T!==null;){var F=T.tag;if((F===3||F===4)&&(F=T.stateNode.containerInfo,F===g||F.nodeType===8&&F.parentNode===g))return;T=T.return}for(;b!==null;){if(T=sr(b),T===null)return;if(F=T.tag,F===5||F===6){h=y=T;continue e}b=b.parentNode}}h=h.return}im(function(){var W=y,te=Vu(c),ne=[];e:{var ee=Vm.get(o);if(ee!==void 0){var ge=cf,Se=o;switch(o){case"keypress":if(yc(c)===0)break e;case"keydown":case"keyup":ge=EE;break;case"focusin":Se="focus",ge=ff;break;case"focusout":Se="blur",ge=ff;break;case"beforeblur":case"afterblur":ge=ff;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=Cm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=uE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=_E;break;case Ym:case zm:case jm:ge=pE;break;case Xm:ge=PE;break;case"scroll":ge=cE;break;case"wheel":ge=ME;break;case"copy":case"cut":case"paste":ge=mE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=_m}var Ae=(r&4)!==0,Ct=!Ae&&o==="scroll",x=Ae?ee!==null?ee+"Capture":null:ee;Ae=[];for(var H=W,$;H!==null;){$=H;var oe=$.stateNode;if($.tag===5&&oe!==null&&($=oe,x!==null&&(oe=Sa(H,x),oe!=null&&Ae.push(Ha(H,oe,$)))),Ct)break;H=H.return}0<Ae.length&&(ee=new ge(ee,Se,null,c,te),ne.push({event:ee,listeners:Ae}))}}if((r&7)===0){e:{if(ee=o==="mouseover"||o==="pointerover",ge=o==="mouseout"||o==="pointerout",ee&&c!==Xu&&(Se=c.relatedTarget||c.fromElement)&&(sr(Se)||Se[Hi]))break e;if((ge||ee)&&(ee=te.window===te?te:(ee=te.ownerDocument)?ee.defaultView||ee.parentWindow:window,ge?(Se=c.relatedTarget||c.toElement,ge=W,Se=Se?sr(Se):null,Se!==null&&(Ct=rr(Se),Se!==Ct||Se.tag!==5&&Se.tag!==6)&&(Se=null)):(ge=null,Se=W),ge!==Se)){if(Ae=Cm,oe="onMouseLeave",x="onMouseEnter",H="mouse",(o==="pointerout"||o==="pointerover")&&(Ae=_m,oe="onPointerLeave",x="onPointerEnter",H="pointer"),Ct=ge==null?ee:as(ge),$=Se==null?ee:as(Se),ee=new Ae(oe,H+"leave",ge,c,te),ee.target=Ct,ee.relatedTarget=$,oe=null,sr(te)===W&&(Ae=new Ae(x,H+"enter",Se,c,te),Ae.target=$,Ae.relatedTarget=Ct,oe=Ae),Ct=oe,ge&&Se)t:{for(Ae=ge,x=Se,H=0,$=Ae;$;$=rs($))H++;for($=0,oe=x;oe;oe=rs(oe))$++;for(;0<H-$;)Ae=rs(Ae),H--;for(;0<$-H;)x=rs(x),$--;for(;H--;){if(Ae===x||x!==null&&Ae===x.alternate)break t;Ae=rs(Ae),x=rs(x)}Ae=null}else Ae=null;ge!==null&&Jm(ne,ee,ge,Ae,!1),Se!==null&&Ct!==null&&Jm(ne,Ct,Se,Ae,!0)}}e:{if(ee=W?as(W):window,ge=ee.nodeName&&ee.nodeName.toLowerCase(),ge==="select"||ge==="input"&&ee.type==="file")var Ce=LE;else if(bm(ee))if(km)Ce=xE;else{Ce=UE;var be=HE}else(ge=ee.nodeName)&&ge.toLowerCase()==="input"&&(ee.type==="checkbox"||ee.type==="radio")&&(Ce=GE);if(Ce&&(Ce=Ce(o,W))){Om(ne,Ce,c,te);break e}be&&be(o,ee,W),o==="focusout"&&(be=ee._wrapperState)&&be.controlled&&ee.type==="number"&&Ai(ee,"number",ee.value)}switch(be=W?as(W):window,o){case"focusin":(bm(be)||be.contentEditable==="true")&&(is=be,vf=W,Ba=null);break;case"focusout":Ba=vf=is=null;break;case"mousedown":Sf=!0;break;case"contextmenu":case"mouseup":case"dragend":Sf=!1,$m(ne,c,te);break;case"selectionchange":if(YE)break;case"keydown":case"keyup":$m(ne,c,te)}var Oe;if(pf)e:{switch(o){case"compositionstart":var Le="onCompositionStart";break e;case"compositionend":Le="onCompositionEnd";break e;case"compositionupdate":Le="onCompositionUpdate";break e}Le=void 0}else ns?Mm(o,c)&&(Le="onCompositionEnd"):o==="keydown"&&c.keyCode===229&&(Le="onCompositionStart");Le&&(Rm&&c.locale!=="ko"&&(ns||Le!=="onCompositionStart"?Le==="onCompositionEnd"&&ns&&(Oe=Tm()):(vo=te,lf="value"in vo?vo.value:vo.textContent,ns=!0)),be=Cc(W,Le),0<be.length&&(Le=new wm(Le,o,null,c,te),ne.push({event:Le,listeners:be}),Oe?Le.data=Oe:(Oe=Nm(c),Oe!==null&&(Le.data=Oe)))),(Oe=bE?OE(o,c):kE(o,c))&&(W=Cc(W,"onBeforeInput"),0<W.length&&(te=new wm("onBeforeInput","beforeinput",null,c,te),ne.push({event:te,listeners:W}),te.data=Oe))}Zm(ne,r)})}function Ha(o,r,c){return{instance:o,listener:r,currentTarget:c}}function Cc(o,r){for(var c=r+"Capture",h=[];o!==null;){var g=o,y=g.stateNode;g.tag===5&&y!==null&&(g=y,y=Sa(o,c),y!=null&&h.unshift(Ha(o,y,g)),y=Sa(o,r),y!=null&&h.push(Ha(o,y,g))),o=o.return}return h}function rs(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function Jm(o,r,c,h,g){for(var y=r._reactName,T=[];c!==null&&c!==h;){var b=c,F=b.alternate,W=b.stateNode;if(F!==null&&F===h)break;b.tag===5&&W!==null&&(b=W,g?(F=Sa(c,y),F!=null&&T.unshift(Ha(c,F,b))):g||(F=Sa(c,y),F!=null&&T.push(Ha(c,F,b)))),c=c.return}T.length!==0&&o.push({event:r,listeners:T})}var VE=/\r\n?/g,KE=/\u0000|\uFFFD/g;function e0(o){return(typeof o=="string"?o:""+o).replace(VE,`
`).replace(KE,"")}function wc(o,r,c){if(r=e0(r),e0(o)!==r&&c)throw Error(n(425))}function _c(){}var wf=null,_f=null;function Rf(o,r){return o==="textarea"||o==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Pf=typeof setTimeout=="function"?setTimeout:void 0,qE=typeof clearTimeout=="function"?clearTimeout:void 0,t0=typeof Promise=="function"?Promise:void 0,ZE=typeof queueMicrotask=="function"?queueMicrotask:typeof t0<"u"?function(o){return t0.resolve(null).then(o).catch(QE)}:Pf;function QE(o){setTimeout(function(){throw o})}function Df(o,r){var c=r,h=0;do{var g=c.nextSibling;if(o.removeChild(c),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(h===0){o.removeChild(g),Pa(r);return}h--}else c!=="$"&&c!=="$?"&&c!=="$!"||h++;c=g}while(c);Pa(r)}function Ao(o){for(;o!=null;o=o.nextSibling){var r=o.nodeType;if(r===1||r===3)break;if(r===8){if(r=o.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return o}function n0(o){o=o.previousSibling;for(var r=0;o;){if(o.nodeType===8){var c=o.data;if(c==="$"||c==="$!"||c==="$?"){if(r===0)return o;r--}else c==="/$"&&r++}o=o.previousSibling}return null}var ss=Math.random().toString(36).slice(2),Ei="__reactFiber$"+ss,Ua="__reactProps$"+ss,Hi="__reactContainer$"+ss,Mf="__reactEvents$"+ss,JE="__reactListeners$"+ss,eC="__reactHandles$"+ss;function sr(o){var r=o[Ei];if(r)return r;for(var c=o.parentNode;c;){if(r=c[Hi]||c[Ei]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(o=n0(o);o!==null;){if(c=o[Ei])return c;o=n0(o)}return r}o=c,c=o.parentNode}return null}function Ga(o){return o=o[Ei]||o[Hi],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function as(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(n(33))}function Rc(o){return o[Ua]||null}var Nf=[],ls=-1;function Io(o){return{current:o}}function ct(o){0>ls||(o.current=Nf[ls],Nf[ls]=null,ls--)}function st(o,r){ls++,Nf[ls]=o.current,o.current=r}var To={},Qt=Io(To),Tn=Io(!1),ar=To;function cs(o,r){var c=o.type.contextTypes;if(!c)return To;var h=o.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===r)return h.__reactInternalMemoizedMaskedChildContext;var g={},y;for(y in c)g[y]=r[y];return h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=r,o.__reactInternalMemoizedMaskedChildContext=g),g}function En(o){return o=o.childContextTypes,o!=null}function Pc(){ct(Tn),ct(Qt)}function i0(o,r,c){if(Qt.current!==To)throw Error(n(168));st(Qt,r),st(Tn,c)}function o0(o,r,c){var h=o.stateNode;if(r=r.childContextTypes,typeof h.getChildContext!="function")return c;h=h.getChildContext();for(var g in h)if(!(g in r))throw Error(n(108,Te(o)||"Unknown",g));return Q({},c,h)}function Dc(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||To,ar=Qt.current,st(Qt,o),st(Tn,Tn.current),!0}function r0(o,r,c){var h=o.stateNode;if(!h)throw Error(n(169));c?(o=o0(o,r,ar),h.__reactInternalMemoizedMergedChildContext=o,ct(Tn),ct(Qt),st(Qt,o)):ct(Tn),st(Tn,c)}var Ui=null,Mc=!1,bf=!1;function s0(o){Ui===null?Ui=[o]:Ui.push(o)}function tC(o){Mc=!0,s0(o)}function Eo(){if(!bf&&Ui!==null){bf=!0;var o=0,r=et;try{var c=Ui;for(et=1;o<c.length;o++){var h=c[o];do h=h(!0);while(h!==null)}Ui=null,Mc=!1}catch(g){throw Ui!==null&&(Ui=Ui.slice(o+1)),lm(Ju,Eo),g}finally{et=r,bf=!1}}return null}var ds=[],us=0,Nc=null,bc=0,qn=[],Zn=0,lr=null,Gi=1,xi="";function cr(o,r){ds[us++]=bc,ds[us++]=Nc,Nc=o,bc=r}function a0(o,r,c){qn[Zn++]=Gi,qn[Zn++]=xi,qn[Zn++]=lr,lr=o;var h=Gi;o=xi;var g=32-di(h)-1;h&=~(1<<g),c+=1;var y=32-di(r)+g;if(30<y){var T=g-g%5;y=(h&(1<<T)-1).toString(32),h>>=T,g-=T,Gi=1<<32-di(r)+g|c<<g|h,xi=y+o}else Gi=1<<y|c<<g|h,xi=o}function Of(o){o.return!==null&&(cr(o,1),a0(o,1,0))}function kf(o){for(;o===Nc;)Nc=ds[--us],ds[us]=null,bc=ds[--us],ds[us]=null;for(;o===lr;)lr=qn[--Zn],qn[Zn]=null,xi=qn[--Zn],qn[Zn]=null,Gi=qn[--Zn],qn[Zn]=null}var On=null,kn=null,pt=!1,fi=null;function l0(o,r){var c=ti(5,null,null,0);c.elementType="DELETED",c.stateNode=r,c.return=o,r=o.deletions,r===null?(o.deletions=[c],o.flags|=16):r.push(c)}function c0(o,r){switch(o.tag){case 5:var c=o.type;return r=r.nodeType!==1||c.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(o.stateNode=r,On=o,kn=Ao(r.firstChild),!0):!1;case 6:return r=o.pendingProps===""||r.nodeType!==3?null:r,r!==null?(o.stateNode=r,On=o,kn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(c=lr!==null?{id:Gi,overflow:xi}:null,o.memoizedState={dehydrated:r,treeContext:c,retryLane:1073741824},c=ti(18,null,null,0),c.stateNode=r,c.return=o,o.child=c,On=o,kn=null,!0):!1;default:return!1}}function Bf(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Ff(o){if(pt){var r=kn;if(r){var c=r;if(!c0(o,r)){if(Bf(o))throw Error(n(418));r=Ao(c.nextSibling);var h=On;r&&c0(o,r)?l0(h,c):(o.flags=o.flags&-4097|2,pt=!1,On=o)}}else{if(Bf(o))throw Error(n(418));o.flags=o.flags&-4097|2,pt=!1,On=o}}}function d0(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;On=o}function Oc(o){if(o!==On)return!1;if(!pt)return d0(o),pt=!0,!1;var r;if((r=o.tag!==3)&&!(r=o.tag!==5)&&(r=o.type,r=r!=="head"&&r!=="body"&&!Rf(o.type,o.memoizedProps)),r&&(r=kn)){if(Bf(o))throw u0(),Error(n(418));for(;r;)l0(o,r),r=Ao(r.nextSibling)}if(d0(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,r=0;o;){if(o.nodeType===8){var c=o.data;if(c==="/$"){if(r===0){kn=Ao(o.nextSibling);break e}r--}else c!=="$"&&c!=="$!"&&c!=="$?"||r++}o=o.nextSibling}kn=null}}else kn=On?Ao(o.stateNode.nextSibling):null;return!0}function u0(){for(var o=kn;o;)o=Ao(o.nextSibling)}function fs(){kn=On=null,pt=!1}function Lf(o){fi===null?fi=[o]:fi.push(o)}var nC=O.ReactCurrentBatchConfig;function xa(o,r,c){if(o=c.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(n(309));var h=c.stateNode}if(!h)throw Error(n(147,o));var g=h,y=""+o;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===y?r.ref:(r=function(T){var b=g.refs;T===null?delete b[y]:b[y]=T},r._stringRef=y,r)}if(typeof o!="string")throw Error(n(284));if(!c._owner)throw Error(n(290,o))}return o}function kc(o,r){throw o=Object.prototype.toString.call(r),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o))}function f0(o){var r=o._init;return r(o._payload)}function h0(o){function r(x,H){if(o){var $=x.deletions;$===null?(x.deletions=[H],x.flags|=16):$.push(H)}}function c(x,H){if(!o)return null;for(;H!==null;)r(x,H),H=H.sibling;return null}function h(x,H){for(x=new Map;H!==null;)H.key!==null?x.set(H.key,H):x.set(H.index,H),H=H.sibling;return x}function g(x,H){return x=No(x,H),x.index=0,x.sibling=null,x}function y(x,H,$){return x.index=$,o?($=x.alternate,$!==null?($=$.index,$<H?(x.flags|=2,H):$):(x.flags|=2,H)):(x.flags|=1048576,H)}function T(x){return o&&x.alternate===null&&(x.flags|=2),x}function b(x,H,$,oe){return H===null||H.tag!==6?(H=Ph($,x.mode,oe),H.return=x,H):(H=g(H,$),H.return=x,H)}function F(x,H,$,oe){var Ce=$.type;return Ce===N?te(x,H,$.props.children,oe,$.key):H!==null&&(H.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===se&&f0(Ce)===H.type)?(oe=g(H,$.props),oe.ref=xa(x,H,$),oe.return=x,oe):(oe=od($.type,$.key,$.props,null,x.mode,oe),oe.ref=xa(x,H,$),oe.return=x,oe)}function W(x,H,$,oe){return H===null||H.tag!==4||H.stateNode.containerInfo!==$.containerInfo||H.stateNode.implementation!==$.implementation?(H=Dh($,x.mode,oe),H.return=x,H):(H=g(H,$.children||[]),H.return=x,H)}function te(x,H,$,oe,Ce){return H===null||H.tag!==7?(H=yr($,x.mode,oe,Ce),H.return=x,H):(H=g(H,$),H.return=x,H)}function ne(x,H,$){if(typeof H=="string"&&H!==""||typeof H=="number")return H=Ph(""+H,x.mode,$),H.return=x,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case M:return $=od(H.type,H.key,H.props,null,x.mode,$),$.ref=xa(x,null,H),$.return=x,$;case D:return H=Dh(H,x.mode,$),H.return=x,H;case se:var oe=H._init;return ne(x,oe(H._payload),$)}if(Ii(H)||Z(H))return H=yr(H,x.mode,$,null),H.return=x,H;kc(x,H)}return null}function ee(x,H,$,oe){var Ce=H!==null?H.key:null;if(typeof $=="string"&&$!==""||typeof $=="number")return Ce!==null?null:b(x,H,""+$,oe);if(typeof $=="object"&&$!==null){switch($.$$typeof){case M:return $.key===Ce?F(x,H,$,oe):null;case D:return $.key===Ce?W(x,H,$,oe):null;case se:return Ce=$._init,ee(x,H,Ce($._payload),oe)}if(Ii($)||Z($))return Ce!==null?null:te(x,H,$,oe,null);kc(x,$)}return null}function ge(x,H,$,oe,Ce){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return x=x.get($)||null,b(H,x,""+oe,Ce);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case M:return x=x.get(oe.key===null?$:oe.key)||null,F(H,x,oe,Ce);case D:return x=x.get(oe.key===null?$:oe.key)||null,W(H,x,oe,Ce);case se:var be=oe._init;return ge(x,H,$,be(oe._payload),Ce)}if(Ii(oe)||Z(oe))return x=x.get($)||null,te(H,x,oe,Ce,null);kc(H,oe)}return null}function Se(x,H,$,oe){for(var Ce=null,be=null,Oe=H,Le=H=0,Ht=null;Oe!==null&&Le<$.length;Le++){Oe.index>Le?(Ht=Oe,Oe=null):Ht=Oe.sibling;var qe=ee(x,Oe,$[Le],oe);if(qe===null){Oe===null&&(Oe=Ht);break}o&&Oe&&qe.alternate===null&&r(x,Oe),H=y(qe,H,Le),be===null?Ce=qe:be.sibling=qe,be=qe,Oe=Ht}if(Le===$.length)return c(x,Oe),pt&&cr(x,Le),Ce;if(Oe===null){for(;Le<$.length;Le++)Oe=ne(x,$[Le],oe),Oe!==null&&(H=y(Oe,H,Le),be===null?Ce=Oe:be.sibling=Oe,be=Oe);return pt&&cr(x,Le),Ce}for(Oe=h(x,Oe);Le<$.length;Le++)Ht=ge(Oe,x,Le,$[Le],oe),Ht!==null&&(o&&Ht.alternate!==null&&Oe.delete(Ht.key===null?Le:Ht.key),H=y(Ht,H,Le),be===null?Ce=Ht:be.sibling=Ht,be=Ht);return o&&Oe.forEach(function(bo){return r(x,bo)}),pt&&cr(x,Le),Ce}function Ae(x,H,$,oe){var Ce=Z($);if(typeof Ce!="function")throw Error(n(150));if($=Ce.call($),$==null)throw Error(n(151));for(var be=Ce=null,Oe=H,Le=H=0,Ht=null,qe=$.next();Oe!==null&&!qe.done;Le++,qe=$.next()){Oe.index>Le?(Ht=Oe,Oe=null):Ht=Oe.sibling;var bo=ee(x,Oe,qe.value,oe);if(bo===null){Oe===null&&(Oe=Ht);break}o&&Oe&&bo.alternate===null&&r(x,Oe),H=y(bo,H,Le),be===null?Ce=bo:be.sibling=bo,be=bo,Oe=Ht}if(qe.done)return c(x,Oe),pt&&cr(x,Le),Ce;if(Oe===null){for(;!qe.done;Le++,qe=$.next())qe=ne(x,qe.value,oe),qe!==null&&(H=y(qe,H,Le),be===null?Ce=qe:be.sibling=qe,be=qe);return pt&&cr(x,Le),Ce}for(Oe=h(x,Oe);!qe.done;Le++,qe=$.next())qe=ge(Oe,x,Le,qe.value,oe),qe!==null&&(o&&qe.alternate!==null&&Oe.delete(qe.key===null?Le:qe.key),H=y(qe,H,Le),be===null?Ce=qe:be.sibling=qe,be=qe);return o&&Oe.forEach(function(BC){return r(x,BC)}),pt&&cr(x,Le),Ce}function Ct(x,H,$,oe){if(typeof $=="object"&&$!==null&&$.type===N&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case M:e:{for(var Ce=$.key,be=H;be!==null;){if(be.key===Ce){if(Ce=$.type,Ce===N){if(be.tag===7){c(x,be.sibling),H=g(be,$.props.children),H.return=x,x=H;break e}}else if(be.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===se&&f0(Ce)===be.type){c(x,be.sibling),H=g(be,$.props),H.ref=xa(x,be,$),H.return=x,x=H;break e}c(x,be);break}else r(x,be);be=be.sibling}$.type===N?(H=yr($.props.children,x.mode,oe,$.key),H.return=x,x=H):(oe=od($.type,$.key,$.props,null,x.mode,oe),oe.ref=xa(x,H,$),oe.return=x,x=oe)}return T(x);case D:e:{for(be=$.key;H!==null;){if(H.key===be)if(H.tag===4&&H.stateNode.containerInfo===$.containerInfo&&H.stateNode.implementation===$.implementation){c(x,H.sibling),H=g(H,$.children||[]),H.return=x,x=H;break e}else{c(x,H);break}else r(x,H);H=H.sibling}H=Dh($,x.mode,oe),H.return=x,x=H}return T(x);case se:return be=$._init,Ct(x,H,be($._payload),oe)}if(Ii($))return Se(x,H,$,oe);if(Z($))return Ae(x,H,$,oe);kc(x,$)}return typeof $=="string"&&$!==""||typeof $=="number"?($=""+$,H!==null&&H.tag===6?(c(x,H.sibling),H=g(H,$),H.return=x,x=H):(c(x,H),H=Ph($,x.mode,oe),H.return=x,x=H),T(x)):c(x,H)}return Ct}var hs=h0(!0),p0=h0(!1),Bc=Io(null),Fc=null,ps=null,Hf=null;function Uf(){Hf=ps=Fc=null}function Gf(o){var r=Bc.current;ct(Bc),o._currentValue=r}function xf(o,r,c){for(;o!==null;){var h=o.alternate;if((o.childLanes&r)!==r?(o.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),o===c)break;o=o.return}}function gs(o,r){Fc=o,Hf=ps=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&r)!==0&&(Cn=!0),o.firstContext=null)}function Qn(o){var r=o._currentValue;if(Hf!==o)if(o={context:o,memoizedValue:r,next:null},ps===null){if(Fc===null)throw Error(n(308));ps=o,Fc.dependencies={lanes:0,firstContext:o}}else ps=ps.next=o;return r}var dr=null;function $f(o){dr===null?dr=[o]:dr.push(o)}function g0(o,r,c,h){var g=r.interleaved;return g===null?(c.next=c,$f(r)):(c.next=g.next,g.next=c),r.interleaved=c,$i(o,h)}function $i(o,r){o.lanes|=r;var c=o.alternate;for(c!==null&&(c.lanes|=r),c=o,o=o.return;o!==null;)o.childLanes|=r,c=o.alternate,c!==null&&(c.childLanes|=r),c=o,o=o.return;return c.tag===3?c.stateNode:null}var Co=!1;function Wf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function m0(o,r){o=o.updateQueue,r.updateQueue===o&&(r.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Wi(o,r){return{eventTime:o,lane:r,tag:0,payload:null,callback:null,next:null}}function wo(o,r,c){var h=o.updateQueue;if(h===null)return null;if(h=h.shared,(Ve&2)!==0){var g=h.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),h.pending=r,$i(o,c)}return g=h.interleaved,g===null?(r.next=r,$f(h)):(r.next=g.next,g.next=r),h.interleaved=r,$i(o,c)}function Lc(o,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194240)!==0)){var h=r.lanes;h&=o.pendingLanes,c|=h,r.lanes=c,nf(o,c)}}function y0(o,r){var c=o.updateQueue,h=o.alternate;if(h!==null&&(h=h.updateQueue,c===h)){var g=null,y=null;if(c=c.firstBaseUpdate,c!==null){do{var T={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};y===null?g=y=T:y=y.next=T,c=c.next}while(c!==null);y===null?g=y=r:y=y.next=r}else g=y=r;c={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:h.shared,effects:h.effects},o.updateQueue=c;return}o=c.lastBaseUpdate,o===null?c.firstBaseUpdate=r:o.next=r,c.lastBaseUpdate=r}function Hc(o,r,c,h){var g=o.updateQueue;Co=!1;var y=g.firstBaseUpdate,T=g.lastBaseUpdate,b=g.shared.pending;if(b!==null){g.shared.pending=null;var F=b,W=F.next;F.next=null,T===null?y=W:T.next=W,T=F;var te=o.alternate;te!==null&&(te=te.updateQueue,b=te.lastBaseUpdate,b!==T&&(b===null?te.firstBaseUpdate=W:b.next=W,te.lastBaseUpdate=F))}if(y!==null){var ne=g.baseState;T=0,te=W=F=null,b=y;do{var ee=b.lane,ge=b.eventTime;if((h&ee)===ee){te!==null&&(te=te.next={eventTime:ge,lane:0,tag:b.tag,payload:b.payload,callback:b.callback,next:null});e:{var Se=o,Ae=b;switch(ee=r,ge=c,Ae.tag){case 1:if(Se=Ae.payload,typeof Se=="function"){ne=Se.call(ge,ne,ee);break e}ne=Se;break e;case 3:Se.flags=Se.flags&-65537|128;case 0:if(Se=Ae.payload,ee=typeof Se=="function"?Se.call(ge,ne,ee):Se,ee==null)break e;ne=Q({},ne,ee);break e;case 2:Co=!0}}b.callback!==null&&b.lane!==0&&(o.flags|=64,ee=g.effects,ee===null?g.effects=[b]:ee.push(b))}else ge={eventTime:ge,lane:ee,tag:b.tag,payload:b.payload,callback:b.callback,next:null},te===null?(W=te=ge,F=ne):te=te.next=ge,T|=ee;if(b=b.next,b===null){if(b=g.shared.pending,b===null)break;ee=b,b=ee.next,ee.next=null,g.lastBaseUpdate=ee,g.shared.pending=null}}while(!0);if(te===null&&(F=ne),g.baseState=F,g.firstBaseUpdate=W,g.lastBaseUpdate=te,r=g.shared.interleaved,r!==null){g=r;do T|=g.lane,g=g.next;while(g!==r)}else y===null&&(g.shared.lanes=0);hr|=T,o.lanes=T,o.memoizedState=ne}}function v0(o,r,c){if(o=r.effects,r.effects=null,o!==null)for(r=0;r<o.length;r++){var h=o[r],g=h.callback;if(g!==null){if(h.callback=null,h=c,typeof g!="function")throw Error(n(191,g));g.call(h)}}}var $a={},Ci=Io($a),Wa=Io($a),Ya=Io($a);function ur(o){if(o===$a)throw Error(n(174));return o}function Yf(o,r){switch(st(Ya,r),st(Wa,o),st(Ci,$a),o=r.nodeType,o){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Yu(null,"");break;default:o=o===8?r.parentNode:r,r=o.namespaceURI||null,o=o.tagName,r=Yu(r,o)}ct(Ci),st(Ci,r)}function ms(){ct(Ci),ct(Wa),ct(Ya)}function S0(o){ur(Ya.current);var r=ur(Ci.current),c=Yu(r,o.type);r!==c&&(st(Wa,o),st(Ci,c))}function zf(o){Wa.current===o&&(ct(Ci),ct(Wa))}var yt=Io(0);function Uc(o){for(var r=o;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var jf=[];function Xf(){for(var o=0;o<jf.length;o++)jf[o]._workInProgressVersionPrimary=null;jf.length=0}var Gc=O.ReactCurrentDispatcher,Vf=O.ReactCurrentBatchConfig,fr=0,vt=null,Nt=null,Ft=null,xc=!1,za=!1,ja=0,iC=0;function Jt(){throw Error(n(321))}function Kf(o,r){if(r===null)return!1;for(var c=0;c<r.length&&c<o.length;c++)if(!ui(o[c],r[c]))return!1;return!0}function qf(o,r,c,h,g,y){if(fr=y,vt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Gc.current=o===null||o.memoizedState===null?aC:lC,o=c(h,g),za){y=0;do{if(za=!1,ja=0,25<=y)throw Error(n(301));y+=1,Ft=Nt=null,r.updateQueue=null,Gc.current=cC,o=c(h,g)}while(za)}if(Gc.current=Yc,r=Nt!==null&&Nt.next!==null,fr=0,Ft=Nt=vt=null,xc=!1,r)throw Error(n(300));return o}function Zf(){var o=ja!==0;return ja=0,o}function wi(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ft===null?vt.memoizedState=Ft=o:Ft=Ft.next=o,Ft}function Jn(){if(Nt===null){var o=vt.alternate;o=o!==null?o.memoizedState:null}else o=Nt.next;var r=Ft===null?vt.memoizedState:Ft.next;if(r!==null)Ft=r,Nt=o;else{if(o===null)throw Error(n(310));Nt=o,o={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},Ft===null?vt.memoizedState=Ft=o:Ft=Ft.next=o}return Ft}function Xa(o,r){return typeof r=="function"?r(o):r}function Qf(o){var r=Jn(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=o;var h=Nt,g=h.baseQueue,y=c.pending;if(y!==null){if(g!==null){var T=g.next;g.next=y.next,y.next=T}h.baseQueue=g=y,c.pending=null}if(g!==null){y=g.next,h=h.baseState;var b=T=null,F=null,W=y;do{var te=W.lane;if((fr&te)===te)F!==null&&(F=F.next={lane:0,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null}),h=W.hasEagerState?W.eagerState:o(h,W.action);else{var ne={lane:te,action:W.action,hasEagerState:W.hasEagerState,eagerState:W.eagerState,next:null};F===null?(b=F=ne,T=h):F=F.next=ne,vt.lanes|=te,hr|=te}W=W.next}while(W!==null&&W!==y);F===null?T=h:F.next=b,ui(h,r.memoizedState)||(Cn=!0),r.memoizedState=h,r.baseState=T,r.baseQueue=F,c.lastRenderedState=h}if(o=c.interleaved,o!==null){g=o;do y=g.lane,vt.lanes|=y,hr|=y,g=g.next;while(g!==o)}else g===null&&(c.lanes=0);return[r.memoizedState,c.dispatch]}function Jf(o){var r=Jn(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=o;var h=c.dispatch,g=c.pending,y=r.memoizedState;if(g!==null){c.pending=null;var T=g=g.next;do y=o(y,T.action),T=T.next;while(T!==g);ui(y,r.memoizedState)||(Cn=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),c.lastRenderedState=y}return[y,h]}function A0(){}function I0(o,r){var c=vt,h=Jn(),g=r(),y=!ui(h.memoizedState,g);if(y&&(h.memoizedState=g,Cn=!0),h=h.queue,eh(C0.bind(null,c,h,o),[o]),h.getSnapshot!==r||y||Ft!==null&&Ft.memoizedState.tag&1){if(c.flags|=2048,Va(9,E0.bind(null,c,h,g,r),void 0,null),Lt===null)throw Error(n(349));(fr&30)!==0||T0(c,r,g)}return g}function T0(o,r,c){o.flags|=16384,o={getSnapshot:r,value:c},r=vt.updateQueue,r===null?(r={lastEffect:null,stores:null},vt.updateQueue=r,r.stores=[o]):(c=r.stores,c===null?r.stores=[o]:c.push(o))}function E0(o,r,c,h){r.value=c,r.getSnapshot=h,w0(r)&&_0(o)}function C0(o,r,c){return c(function(){w0(r)&&_0(o)})}function w0(o){var r=o.getSnapshot;o=o.value;try{var c=r();return!ui(o,c)}catch{return!0}}function _0(o){var r=$i(o,1);r!==null&&mi(r,o,1,-1)}function R0(o){var r=wi();return typeof o=="function"&&(o=o()),r.memoizedState=r.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Xa,lastRenderedState:o},r.queue=o,o=o.dispatch=sC.bind(null,vt,o),[r.memoizedState,o]}function Va(o,r,c,h){return o={tag:o,create:r,destroy:c,deps:h,next:null},r=vt.updateQueue,r===null?(r={lastEffect:null,stores:null},vt.updateQueue=r,r.lastEffect=o.next=o):(c=r.lastEffect,c===null?r.lastEffect=o.next=o:(h=c.next,c.next=o,o.next=h,r.lastEffect=o)),o}function P0(){return Jn().memoizedState}function $c(o,r,c,h){var g=wi();vt.flags|=o,g.memoizedState=Va(1|r,c,void 0,h===void 0?null:h)}function Wc(o,r,c,h){var g=Jn();h=h===void 0?null:h;var y=void 0;if(Nt!==null){var T=Nt.memoizedState;if(y=T.destroy,h!==null&&Kf(h,T.deps)){g.memoizedState=Va(r,c,y,h);return}}vt.flags|=o,g.memoizedState=Va(1|r,c,y,h)}function D0(o,r){return $c(8390656,8,o,r)}function eh(o,r){return Wc(2048,8,o,r)}function M0(o,r){return Wc(4,2,o,r)}function N0(o,r){return Wc(4,4,o,r)}function b0(o,r){if(typeof r=="function")return o=o(),r(o),function(){r(null)};if(r!=null)return o=o(),r.current=o,function(){r.current=null}}function O0(o,r,c){return c=c!=null?c.concat([o]):null,Wc(4,4,b0.bind(null,r,o),c)}function th(){}function k0(o,r){var c=Jn();r=r===void 0?null:r;var h=c.memoizedState;return h!==null&&r!==null&&Kf(r,h[1])?h[0]:(c.memoizedState=[o,r],o)}function B0(o,r){var c=Jn();r=r===void 0?null:r;var h=c.memoizedState;return h!==null&&r!==null&&Kf(r,h[1])?h[0]:(o=o(),c.memoizedState=[o,r],o)}function F0(o,r,c){return(fr&21)===0?(o.baseState&&(o.baseState=!1,Cn=!0),o.memoizedState=c):(ui(c,r)||(c=fm(),vt.lanes|=c,hr|=c,o.baseState=!0),r)}function oC(o,r){var c=et;et=c!==0&&4>c?c:4,o(!0);var h=Vf.transition;Vf.transition={};try{o(!1),r()}finally{et=c,Vf.transition=h}}function L0(){return Jn().memoizedState}function rC(o,r,c){var h=Do(o);if(c={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null},H0(o))U0(r,c);else if(c=g0(o,r,c,h),c!==null){var g=dn();mi(c,o,h,g),G0(c,r,h)}}function sC(o,r,c){var h=Do(o),g={lane:h,action:c,hasEagerState:!1,eagerState:null,next:null};if(H0(o))U0(r,g);else{var y=o.alternate;if(o.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var T=r.lastRenderedState,b=y(T,c);if(g.hasEagerState=!0,g.eagerState=b,ui(b,T)){var F=r.interleaved;F===null?(g.next=g,$f(r)):(g.next=F.next,F.next=g),r.interleaved=g;return}}catch{}finally{}c=g0(o,r,g,h),c!==null&&(g=dn(),mi(c,o,h,g),G0(c,r,h))}}function H0(o){var r=o.alternate;return o===vt||r!==null&&r===vt}function U0(o,r){za=xc=!0;var c=o.pending;c===null?r.next=r:(r.next=c.next,c.next=r),o.pending=r}function G0(o,r,c){if((c&4194240)!==0){var h=r.lanes;h&=o.pendingLanes,c|=h,r.lanes=c,nf(o,c)}}var Yc={readContext:Qn,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useInsertionEffect:Jt,useLayoutEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useMutableSource:Jt,useSyncExternalStore:Jt,useId:Jt,unstable_isNewReconciler:!1},aC={readContext:Qn,useCallback:function(o,r){return wi().memoizedState=[o,r===void 0?null:r],o},useContext:Qn,useEffect:D0,useImperativeHandle:function(o,r,c){return c=c!=null?c.concat([o]):null,$c(4194308,4,b0.bind(null,r,o),c)},useLayoutEffect:function(o,r){return $c(4194308,4,o,r)},useInsertionEffect:function(o,r){return $c(4,2,o,r)},useMemo:function(o,r){var c=wi();return r=r===void 0?null:r,o=o(),c.memoizedState=[o,r],o},useReducer:function(o,r,c){var h=wi();return r=c!==void 0?c(r):r,h.memoizedState=h.baseState=r,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:r},h.queue=o,o=o.dispatch=rC.bind(null,vt,o),[h.memoizedState,o]},useRef:function(o){var r=wi();return o={current:o},r.memoizedState=o},useState:R0,useDebugValue:th,useDeferredValue:function(o){return wi().memoizedState=o},useTransition:function(){var o=R0(!1),r=o[0];return o=oC.bind(null,o[1]),wi().memoizedState=o,[r,o]},useMutableSource:function(){},useSyncExternalStore:function(o,r,c){var h=vt,g=wi();if(pt){if(c===void 0)throw Error(n(407));c=c()}else{if(c=r(),Lt===null)throw Error(n(349));(fr&30)!==0||T0(h,r,c)}g.memoizedState=c;var y={value:c,getSnapshot:r};return g.queue=y,D0(C0.bind(null,h,y,o),[o]),h.flags|=2048,Va(9,E0.bind(null,h,y,c,r),void 0,null),c},useId:function(){var o=wi(),r=Lt.identifierPrefix;if(pt){var c=xi,h=Gi;c=(h&~(1<<32-di(h)-1)).toString(32)+c,r=":"+r+"R"+c,c=ja++,0<c&&(r+="H"+c.toString(32)),r+=":"}else c=iC++,r=":"+r+"r"+c.toString(32)+":";return o.memoizedState=r},unstable_isNewReconciler:!1},lC={readContext:Qn,useCallback:k0,useContext:Qn,useEffect:eh,useImperativeHandle:O0,useInsertionEffect:M0,useLayoutEffect:N0,useMemo:B0,useReducer:Qf,useRef:P0,useState:function(){return Qf(Xa)},useDebugValue:th,useDeferredValue:function(o){var r=Jn();return F0(r,Nt.memoizedState,o)},useTransition:function(){var o=Qf(Xa)[0],r=Jn().memoizedState;return[o,r]},useMutableSource:A0,useSyncExternalStore:I0,useId:L0,unstable_isNewReconciler:!1},cC={readContext:Qn,useCallback:k0,useContext:Qn,useEffect:eh,useImperativeHandle:O0,useInsertionEffect:M0,useLayoutEffect:N0,useMemo:B0,useReducer:Jf,useRef:P0,useState:function(){return Jf(Xa)},useDebugValue:th,useDeferredValue:function(o){var r=Jn();return Nt===null?r.memoizedState=o:F0(r,Nt.memoizedState,o)},useTransition:function(){var o=Jf(Xa)[0],r=Jn().memoizedState;return[o,r]},useMutableSource:A0,useSyncExternalStore:I0,useId:L0,unstable_isNewReconciler:!1};function hi(o,r){if(o&&o.defaultProps){r=Q({},r),o=o.defaultProps;for(var c in o)r[c]===void 0&&(r[c]=o[c]);return r}return r}function nh(o,r,c,h){r=o.memoizedState,c=c(h,r),c=c==null?r:Q({},r,c),o.memoizedState=c,o.lanes===0&&(o.updateQueue.baseState=c)}var zc={isMounted:function(o){return(o=o._reactInternals)?rr(o)===o:!1},enqueueSetState:function(o,r,c){o=o._reactInternals;var h=dn(),g=Do(o),y=Wi(h,g);y.payload=r,c!=null&&(y.callback=c),r=wo(o,y,g),r!==null&&(mi(r,o,g,h),Lc(r,o,g))},enqueueReplaceState:function(o,r,c){o=o._reactInternals;var h=dn(),g=Do(o),y=Wi(h,g);y.tag=1,y.payload=r,c!=null&&(y.callback=c),r=wo(o,y,g),r!==null&&(mi(r,o,g,h),Lc(r,o,g))},enqueueForceUpdate:function(o,r){o=o._reactInternals;var c=dn(),h=Do(o),g=Wi(c,h);g.tag=2,r!=null&&(g.callback=r),r=wo(o,g,h),r!==null&&(mi(r,o,h,c),Lc(r,o,h))}};function x0(o,r,c,h,g,y,T){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(h,y,T):r.prototype&&r.prototype.isPureReactComponent?!ka(c,h)||!ka(g,y):!0}function $0(o,r,c){var h=!1,g=To,y=r.contextType;return typeof y=="object"&&y!==null?y=Qn(y):(g=En(r)?ar:Qt.current,h=r.contextTypes,y=(h=h!=null)?cs(o,g):To),r=new r(c,y),o.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=zc,o.stateNode=r,r._reactInternals=o,h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=g,o.__reactInternalMemoizedMaskedChildContext=y),r}function W0(o,r,c,h){o=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,h),r.state!==o&&zc.enqueueReplaceState(r,r.state,null)}function ih(o,r,c,h){var g=o.stateNode;g.props=c,g.state=o.memoizedState,g.refs={},Wf(o);var y=r.contextType;typeof y=="object"&&y!==null?g.context=Qn(y):(y=En(r)?ar:Qt.current,g.context=cs(o,y)),g.state=o.memoizedState,y=r.getDerivedStateFromProps,typeof y=="function"&&(nh(o,r,y,c),g.state=o.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(r=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),r!==g.state&&zc.enqueueReplaceState(g,g.state,null),Hc(o,c,g,h),g.state=o.memoizedState),typeof g.componentDidMount=="function"&&(o.flags|=4194308)}function ys(o,r){try{var c="",h=r;do c+=Me(h),h=h.return;while(h);var g=c}catch(y){g=`
Error generating stack: `+y.message+`
`+y.stack}return{value:o,source:r,stack:g,digest:null}}function oh(o,r,c){return{value:o,source:null,stack:c??null,digest:r??null}}function rh(o,r){try{console.error(r.value)}catch(c){setTimeout(function(){throw c})}}var dC=typeof WeakMap=="function"?WeakMap:Map;function Y0(o,r,c){c=Wi(-1,c),c.tag=3,c.payload={element:null};var h=r.value;return c.callback=function(){Qc||(Qc=!0,Ah=h),rh(o,r)},c}function z0(o,r,c){c=Wi(-1,c),c.tag=3;var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var g=r.value;c.payload=function(){return h(g)},c.callback=function(){rh(o,r)}}var y=o.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(c.callback=function(){rh(o,r),typeof h!="function"&&(Ro===null?Ro=new Set([this]):Ro.add(this));var T=r.stack;this.componentDidCatch(r.value,{componentStack:T!==null?T:""})}),c}function j0(o,r,c){var h=o.pingCache;if(h===null){h=o.pingCache=new dC;var g=new Set;h.set(r,g)}else g=h.get(r),g===void 0&&(g=new Set,h.set(r,g));g.has(c)||(g.add(c),o=CC.bind(null,o,r,c),r.then(o,o))}function X0(o){do{var r;if((r=o.tag===13)&&(r=o.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return o;o=o.return}while(o!==null);return null}function V0(o,r,c,h,g){return(o.mode&1)===0?(o===r?o.flags|=65536:(o.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(r=Wi(-1,1),r.tag=2,wo(c,r,1))),c.lanes|=1),o):(o.flags|=65536,o.lanes=g,o)}var uC=O.ReactCurrentOwner,Cn=!1;function cn(o,r,c,h){r.child=o===null?p0(r,null,c,h):hs(r,o.child,c,h)}function K0(o,r,c,h,g){c=c.render;var y=r.ref;return gs(r,g),h=qf(o,r,c,h,y,g),c=Zf(),o!==null&&!Cn?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~g,Yi(o,r,g)):(pt&&c&&Of(r),r.flags|=1,cn(o,r,h,g),r.child)}function q0(o,r,c,h,g){if(o===null){var y=c.type;return typeof y=="function"&&!Rh(y)&&y.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(r.tag=15,r.type=y,Z0(o,r,y,h,g)):(o=od(c.type,null,h,r,r.mode,g),o.ref=r.ref,o.return=r,r.child=o)}if(y=o.child,(o.lanes&g)===0){var T=y.memoizedProps;if(c=c.compare,c=c!==null?c:ka,c(T,h)&&o.ref===r.ref)return Yi(o,r,g)}return r.flags|=1,o=No(y,h),o.ref=r.ref,o.return=r,r.child=o}function Z0(o,r,c,h,g){if(o!==null){var y=o.memoizedProps;if(ka(y,h)&&o.ref===r.ref)if(Cn=!1,r.pendingProps=h=y,(o.lanes&g)!==0)(o.flags&131072)!==0&&(Cn=!0);else return r.lanes=o.lanes,Yi(o,r,g)}return sh(o,r,c,h,g)}function Q0(o,r,c){var h=r.pendingProps,g=h.children,y=o!==null?o.memoizedState:null;if(h.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},st(Ss,Bn),Bn|=c;else{if((c&1073741824)===0)return o=y!==null?y.baseLanes|c:c,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:o,cachePool:null,transitions:null},r.updateQueue=null,st(Ss,Bn),Bn|=o,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=y!==null?y.baseLanes:c,st(Ss,Bn),Bn|=h}else y!==null?(h=y.baseLanes|c,r.memoizedState=null):h=c,st(Ss,Bn),Bn|=h;return cn(o,r,g,c),r.child}function J0(o,r){var c=r.ref;(o===null&&c!==null||o!==null&&o.ref!==c)&&(r.flags|=512,r.flags|=2097152)}function sh(o,r,c,h,g){var y=En(c)?ar:Qt.current;return y=cs(r,y),gs(r,g),c=qf(o,r,c,h,y,g),h=Zf(),o!==null&&!Cn?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~g,Yi(o,r,g)):(pt&&h&&Of(r),r.flags|=1,cn(o,r,c,g),r.child)}function ey(o,r,c,h,g){if(En(c)){var y=!0;Dc(r)}else y=!1;if(gs(r,g),r.stateNode===null)Xc(o,r),$0(r,c,h),ih(r,c,h,g),h=!0;else if(o===null){var T=r.stateNode,b=r.memoizedProps;T.props=b;var F=T.context,W=c.contextType;typeof W=="object"&&W!==null?W=Qn(W):(W=En(c)?ar:Qt.current,W=cs(r,W));var te=c.getDerivedStateFromProps,ne=typeof te=="function"||typeof T.getSnapshotBeforeUpdate=="function";ne||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(b!==h||F!==W)&&W0(r,T,h,W),Co=!1;var ee=r.memoizedState;T.state=ee,Hc(r,h,T,g),F=r.memoizedState,b!==h||ee!==F||Tn.current||Co?(typeof te=="function"&&(nh(r,c,te,h),F=r.memoizedState),(b=Co||x0(r,c,b,h,ee,F,W))?(ne||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(r.flags|=4194308)):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=F),T.props=h,T.state=F,T.context=W,h=b):(typeof T.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{T=r.stateNode,m0(o,r),b=r.memoizedProps,W=r.type===r.elementType?b:hi(r.type,b),T.props=W,ne=r.pendingProps,ee=T.context,F=c.contextType,typeof F=="object"&&F!==null?F=Qn(F):(F=En(c)?ar:Qt.current,F=cs(r,F));var ge=c.getDerivedStateFromProps;(te=typeof ge=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(b!==ne||ee!==F)&&W0(r,T,h,F),Co=!1,ee=r.memoizedState,T.state=ee,Hc(r,h,T,g);var Se=r.memoizedState;b!==ne||ee!==Se||Tn.current||Co?(typeof ge=="function"&&(nh(r,c,ge,h),Se=r.memoizedState),(W=Co||x0(r,c,W,h,ee,Se,F)||!1)?(te||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(h,Se,F),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(h,Se,F)),typeof T.componentDidUpdate=="function"&&(r.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof T.componentDidUpdate!="function"||b===o.memoizedProps&&ee===o.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||b===o.memoizedProps&&ee===o.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=Se),T.props=h,T.state=Se,T.context=F,h=W):(typeof T.componentDidUpdate!="function"||b===o.memoizedProps&&ee===o.memoizedState||(r.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||b===o.memoizedProps&&ee===o.memoizedState||(r.flags|=1024),h=!1)}return ah(o,r,c,h,y,g)}function ah(o,r,c,h,g,y){J0(o,r);var T=(r.flags&128)!==0;if(!h&&!T)return g&&r0(r,c,!1),Yi(o,r,y);h=r.stateNode,uC.current=r;var b=T&&typeof c.getDerivedStateFromError!="function"?null:h.render();return r.flags|=1,o!==null&&T?(r.child=hs(r,o.child,null,y),r.child=hs(r,null,b,y)):cn(o,r,b,y),r.memoizedState=h.state,g&&r0(r,c,!0),r.child}function ty(o){var r=o.stateNode;r.pendingContext?i0(o,r.pendingContext,r.pendingContext!==r.context):r.context&&i0(o,r.context,!1),Yf(o,r.containerInfo)}function ny(o,r,c,h,g){return fs(),Lf(g),r.flags|=256,cn(o,r,c,h),r.child}var lh={dehydrated:null,treeContext:null,retryLane:0};function ch(o){return{baseLanes:o,cachePool:null,transitions:null}}function iy(o,r,c){var h=r.pendingProps,g=yt.current,y=!1,T=(r.flags&128)!==0,b;if((b=T)||(b=o!==null&&o.memoizedState===null?!1:(g&2)!==0),b?(y=!0,r.flags&=-129):(o===null||o.memoizedState!==null)&&(g|=1),st(yt,g&1),o===null)return Ff(r),o=r.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((r.mode&1)===0?r.lanes=1:o.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(T=h.children,o=h.fallback,y?(h=r.mode,y=r.child,T={mode:"hidden",children:T},(h&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=T):y=rd(T,h,0,null),o=yr(o,h,c,null),y.return=r,o.return=r,y.sibling=o,r.child=y,r.child.memoizedState=ch(c),r.memoizedState=lh,o):dh(r,T));if(g=o.memoizedState,g!==null&&(b=g.dehydrated,b!==null))return fC(o,r,T,h,b,g,c);if(y){y=h.fallback,T=r.mode,g=o.child,b=g.sibling;var F={mode:"hidden",children:h.children};return(T&1)===0&&r.child!==g?(h=r.child,h.childLanes=0,h.pendingProps=F,r.deletions=null):(h=No(g,F),h.subtreeFlags=g.subtreeFlags&14680064),b!==null?y=No(b,y):(y=yr(y,T,c,null),y.flags|=2),y.return=r,h.return=r,h.sibling=y,r.child=h,h=y,y=r.child,T=o.child.memoizedState,T=T===null?ch(c):{baseLanes:T.baseLanes|c,cachePool:null,transitions:T.transitions},y.memoizedState=T,y.childLanes=o.childLanes&~c,r.memoizedState=lh,h}return y=o.child,o=y.sibling,h=No(y,{mode:"visible",children:h.children}),(r.mode&1)===0&&(h.lanes=c),h.return=r,h.sibling=null,o!==null&&(c=r.deletions,c===null?(r.deletions=[o],r.flags|=16):c.push(o)),r.child=h,r.memoizedState=null,h}function dh(o,r){return r=rd({mode:"visible",children:r},o.mode,0,null),r.return=o,o.child=r}function jc(o,r,c,h){return h!==null&&Lf(h),hs(r,o.child,null,c),o=dh(r,r.pendingProps.children),o.flags|=2,r.memoizedState=null,o}function fC(o,r,c,h,g,y,T){if(c)return r.flags&256?(r.flags&=-257,h=oh(Error(n(422))),jc(o,r,T,h)):r.memoizedState!==null?(r.child=o.child,r.flags|=128,null):(y=h.fallback,g=r.mode,h=rd({mode:"visible",children:h.children},g,0,null),y=yr(y,g,T,null),y.flags|=2,h.return=r,y.return=r,h.sibling=y,r.child=h,(r.mode&1)!==0&&hs(r,o.child,null,T),r.child.memoizedState=ch(T),r.memoizedState=lh,y);if((r.mode&1)===0)return jc(o,r,T,null);if(g.data==="$!"){if(h=g.nextSibling&&g.nextSibling.dataset,h)var b=h.dgst;return h=b,y=Error(n(419)),h=oh(y,h,void 0),jc(o,r,T,h)}if(b=(T&o.childLanes)!==0,Cn||b){if(h=Lt,h!==null){switch(T&-T){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=(g&(h.suspendedLanes|T))!==0?0:g,g!==0&&g!==y.retryLane&&(y.retryLane=g,$i(o,g),mi(h,o,g,-1))}return _h(),h=oh(Error(n(421))),jc(o,r,T,h)}return g.data==="$?"?(r.flags|=128,r.child=o.child,r=wC.bind(null,o),g._reactRetry=r,null):(o=y.treeContext,kn=Ao(g.nextSibling),On=r,pt=!0,fi=null,o!==null&&(qn[Zn++]=Gi,qn[Zn++]=xi,qn[Zn++]=lr,Gi=o.id,xi=o.overflow,lr=r),r=dh(r,h.children),r.flags|=4096,r)}function oy(o,r,c){o.lanes|=r;var h=o.alternate;h!==null&&(h.lanes|=r),xf(o.return,r,c)}function uh(o,r,c,h,g){var y=o.memoizedState;y===null?o.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:c,tailMode:g}:(y.isBackwards=r,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=c,y.tailMode=g)}function ry(o,r,c){var h=r.pendingProps,g=h.revealOrder,y=h.tail;if(cn(o,r,h.children,c),h=yt.current,(h&2)!==0)h=h&1|2,r.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=r.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&oy(o,c,r);else if(o.tag===19)oy(o,c,r);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}h&=1}if(st(yt,h),(r.mode&1)===0)r.memoizedState=null;else switch(g){case"forwards":for(c=r.child,g=null;c!==null;)o=c.alternate,o!==null&&Uc(o)===null&&(g=c),c=c.sibling;c=g,c===null?(g=r.child,r.child=null):(g=c.sibling,c.sibling=null),uh(r,!1,g,c,y);break;case"backwards":for(c=null,g=r.child,r.child=null;g!==null;){if(o=g.alternate,o!==null&&Uc(o)===null){r.child=g;break}o=g.sibling,g.sibling=c,c=g,g=o}uh(r,!0,c,null,y);break;case"together":uh(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Xc(o,r){(r.mode&1)===0&&o!==null&&(o.alternate=null,r.alternate=null,r.flags|=2)}function Yi(o,r,c){if(o!==null&&(r.dependencies=o.dependencies),hr|=r.lanes,(c&r.childLanes)===0)return null;if(o!==null&&r.child!==o.child)throw Error(n(153));if(r.child!==null){for(o=r.child,c=No(o,o.pendingProps),r.child=c,c.return=r;o.sibling!==null;)o=o.sibling,c=c.sibling=No(o,o.pendingProps),c.return=r;c.sibling=null}return r.child}function hC(o,r,c){switch(r.tag){case 3:ty(r),fs();break;case 5:S0(r);break;case 1:En(r.type)&&Dc(r);break;case 4:Yf(r,r.stateNode.containerInfo);break;case 10:var h=r.type._context,g=r.memoizedProps.value;st(Bc,h._currentValue),h._currentValue=g;break;case 13:if(h=r.memoizedState,h!==null)return h.dehydrated!==null?(st(yt,yt.current&1),r.flags|=128,null):(c&r.child.childLanes)!==0?iy(o,r,c):(st(yt,yt.current&1),o=Yi(o,r,c),o!==null?o.sibling:null);st(yt,yt.current&1);break;case 19:if(h=(c&r.childLanes)!==0,(o.flags&128)!==0){if(h)return ry(o,r,c);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),st(yt,yt.current),h)break;return null;case 22:case 23:return r.lanes=0,Q0(o,r,c)}return Yi(o,r,c)}var sy,fh,ay,ly;sy=function(o,r){for(var c=r.child;c!==null;){if(c.tag===5||c.tag===6)o.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===r)break;for(;c.sibling===null;){if(c.return===null||c.return===r)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},fh=function(){},ay=function(o,r,c,h){var g=o.memoizedProps;if(g!==h){o=r.stateNode,ur(Ci.current);var y=null;switch(c){case"input":g=rt(o,g),h=rt(o,h),y=[];break;case"select":g=Q({},g,{value:void 0}),h=Q({},h,{value:void 0}),y=[];break;case"textarea":g=or(o,g),h=or(o,h),y=[];break;default:typeof g.onClick!="function"&&typeof h.onClick=="function"&&(o.onclick=_c)}zu(c,h);var T;c=null;for(W in g)if(!h.hasOwnProperty(W)&&g.hasOwnProperty(W)&&g[W]!=null)if(W==="style"){var b=g[W];for(T in b)b.hasOwnProperty(T)&&(c||(c={}),c[T]="")}else W!=="dangerouslySetInnerHTML"&&W!=="children"&&W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&W!=="autoFocus"&&(s.hasOwnProperty(W)?y||(y=[]):(y=y||[]).push(W,null));for(W in h){var F=h[W];if(b=g!=null?g[W]:void 0,h.hasOwnProperty(W)&&F!==b&&(F!=null||b!=null))if(W==="style")if(b){for(T in b)!b.hasOwnProperty(T)||F&&F.hasOwnProperty(T)||(c||(c={}),c[T]="");for(T in F)F.hasOwnProperty(T)&&b[T]!==F[T]&&(c||(c={}),c[T]=F[T])}else c||(y||(y=[]),y.push(W,c)),c=F;else W==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,b=b?b.__html:void 0,F!=null&&b!==F&&(y=y||[]).push(W,F)):W==="children"?typeof F!="string"&&typeof F!="number"||(y=y||[]).push(W,""+F):W!=="suppressContentEditableWarning"&&W!=="suppressHydrationWarning"&&(s.hasOwnProperty(W)?(F!=null&&W==="onScroll"&&lt("scroll",o),y||b===F||(y=[])):(y=y||[]).push(W,F))}c&&(y=y||[]).push("style",c);var W=y;(r.updateQueue=W)&&(r.flags|=4)}},ly=function(o,r,c,h){c!==h&&(r.flags|=4)};function Ka(o,r){if(!pt)switch(o.tailMode){case"hidden":r=o.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?o.tail=null:c.sibling=null;break;case"collapsed":c=o.tail;for(var h=null;c!==null;)c.alternate!==null&&(h=c),c=c.sibling;h===null?r||o.tail===null?o.tail=null:o.tail.sibling=null:h.sibling=null}}function en(o){var r=o.alternate!==null&&o.alternate.child===o.child,c=0,h=0;if(r)for(var g=o.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags&14680064,h|=g.flags&14680064,g.return=o,g=g.sibling;else for(g=o.child;g!==null;)c|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=o,g=g.sibling;return o.subtreeFlags|=h,o.childLanes=c,r}function pC(o,r,c){var h=r.pendingProps;switch(kf(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return en(r),null;case 1:return En(r.type)&&Pc(),en(r),null;case 3:return h=r.stateNode,ms(),ct(Tn),ct(Qt),Xf(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(Oc(r)?r.flags|=4:o===null||o.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,fi!==null&&(Eh(fi),fi=null))),fh(o,r),en(r),null;case 5:zf(r);var g=ur(Ya.current);if(c=r.type,o!==null&&r.stateNode!=null)ay(o,r,c,h,g),o.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!h){if(r.stateNode===null)throw Error(n(166));return en(r),null}if(o=ur(Ci.current),Oc(r)){h=r.stateNode,c=r.type;var y=r.memoizedProps;switch(h[Ei]=r,h[Ua]=y,o=(r.mode&1)!==0,c){case"dialog":lt("cancel",h),lt("close",h);break;case"iframe":case"object":case"embed":lt("load",h);break;case"video":case"audio":for(g=0;g<Fa.length;g++)lt(Fa[g],h);break;case"source":lt("error",h);break;case"img":case"image":case"link":lt("error",h),lt("load",h);break;case"details":lt("toggle",h);break;case"input":it(h,y),lt("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!y.multiple},lt("invalid",h);break;case"textarea":zg(h,y),lt("invalid",h)}zu(c,y),g=null;for(var T in y)if(y.hasOwnProperty(T)){var b=y[T];T==="children"?typeof b=="string"?h.textContent!==b&&(y.suppressHydrationWarning!==!0&&wc(h.textContent,b,o),g=["children",b]):typeof b=="number"&&h.textContent!==""+b&&(y.suppressHydrationWarning!==!0&&wc(h.textContent,b,o),g=["children",""+b]):s.hasOwnProperty(T)&&b!=null&&T==="onScroll"&&lt("scroll",h)}switch(c){case"input":Ge(h),Kn(h,y,!0);break;case"textarea":Ge(h),Xg(h);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(h.onclick=_c)}h=g,r.updateQueue=h,h!==null&&(r.flags|=4)}else{T=g.nodeType===9?g:g.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=Vg(c)),o==="http://www.w3.org/1999/xhtml"?c==="script"?(o=T.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof h.is=="string"?o=T.createElement(c,{is:h.is}):(o=T.createElement(c),c==="select"&&(T=o,h.multiple?T.multiple=!0:h.size&&(T.size=h.size))):o=T.createElementNS(o,c),o[Ei]=r,o[Ua]=h,sy(o,r,!1,!1),r.stateNode=o;e:{switch(T=ju(c,h),c){case"dialog":lt("cancel",o),lt("close",o),g=h;break;case"iframe":case"object":case"embed":lt("load",o),g=h;break;case"video":case"audio":for(g=0;g<Fa.length;g++)lt(Fa[g],o);g=h;break;case"source":lt("error",o),g=h;break;case"img":case"image":case"link":lt("error",o),lt("load",o),g=h;break;case"details":lt("toggle",o),g=h;break;case"input":it(o,h),g=rt(o,h),lt("invalid",o);break;case"option":g=h;break;case"select":o._wrapperState={wasMultiple:!!h.multiple},g=Q({},h,{value:void 0}),lt("invalid",o);break;case"textarea":zg(o,h),g=or(o,h),lt("invalid",o);break;default:g=h}zu(c,g),b=g;for(y in b)if(b.hasOwnProperty(y)){var F=b[y];y==="style"?Zg(o,F):y==="dangerouslySetInnerHTML"?(F=F?F.__html:void 0,F!=null&&Kg(o,F)):y==="children"?typeof F=="string"?(c!=="textarea"||F!=="")&&ya(o,F):typeof F=="number"&&ya(o,""+F):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?F!=null&&y==="onScroll"&&lt("scroll",o):F!=null&&w(o,y,F,T))}switch(c){case"input":Ge(o),Kn(o,h,!1);break;case"textarea":Ge(o),Xg(o);break;case"option":h.value!=null&&o.setAttribute("value",""+_e(h.value));break;case"select":o.multiple=!!h.multiple,y=h.value,y!=null?ho(o,!!h.multiple,y,!1):h.defaultValue!=null&&ho(o,!!h.multiple,h.defaultValue,!0);break;default:typeof g.onClick=="function"&&(o.onclick=_c)}switch(c){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return en(r),null;case 6:if(o&&r.stateNode!=null)ly(o,r,o.memoizedProps,h);else{if(typeof h!="string"&&r.stateNode===null)throw Error(n(166));if(c=ur(Ya.current),ur(Ci.current),Oc(r)){if(h=r.stateNode,c=r.memoizedProps,h[Ei]=r,(y=h.nodeValue!==c)&&(o=On,o!==null))switch(o.tag){case 3:wc(h.nodeValue,c,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&wc(h.nodeValue,c,(o.mode&1)!==0)}y&&(r.flags|=4)}else h=(c.nodeType===9?c:c.ownerDocument).createTextNode(h),h[Ei]=r,r.stateNode=h}return en(r),null;case 13:if(ct(yt),h=r.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(pt&&kn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)u0(),fs(),r.flags|=98560,y=!1;else if(y=Oc(r),h!==null&&h.dehydrated!==null){if(o===null){if(!y)throw Error(n(318));if(y=r.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[Ei]=r}else fs(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;en(r),y=!1}else fi!==null&&(Eh(fi),fi=null),y=!0;if(!y)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=c,r):(h=h!==null,h!==(o!==null&&o.memoizedState!==null)&&h&&(r.child.flags|=8192,(r.mode&1)!==0&&(o===null||(yt.current&1)!==0?bt===0&&(bt=3):_h())),r.updateQueue!==null&&(r.flags|=4),en(r),null);case 4:return ms(),fh(o,r),o===null&&La(r.stateNode.containerInfo),en(r),null;case 10:return Gf(r.type._context),en(r),null;case 17:return En(r.type)&&Pc(),en(r),null;case 19:if(ct(yt),y=r.memoizedState,y===null)return en(r),null;if(h=(r.flags&128)!==0,T=y.rendering,T===null)if(h)Ka(y,!1);else{if(bt!==0||o!==null&&(o.flags&128)!==0)for(o=r.child;o!==null;){if(T=Uc(o),T!==null){for(r.flags|=128,Ka(y,!1),h=T.updateQueue,h!==null&&(r.updateQueue=h,r.flags|=4),r.subtreeFlags=0,h=c,c=r.child;c!==null;)y=c,o=h,y.flags&=14680066,T=y.alternate,T===null?(y.childLanes=0,y.lanes=o,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=T.childLanes,y.lanes=T.lanes,y.child=T.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=T.memoizedProps,y.memoizedState=T.memoizedState,y.updateQueue=T.updateQueue,y.type=T.type,o=T.dependencies,y.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),c=c.sibling;return st(yt,yt.current&1|2),r.child}o=o.sibling}y.tail!==null&&Et()>As&&(r.flags|=128,h=!0,Ka(y,!1),r.lanes=4194304)}else{if(!h)if(o=Uc(T),o!==null){if(r.flags|=128,h=!0,c=o.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),Ka(y,!0),y.tail===null&&y.tailMode==="hidden"&&!T.alternate&&!pt)return en(r),null}else 2*Et()-y.renderingStartTime>As&&c!==1073741824&&(r.flags|=128,h=!0,Ka(y,!1),r.lanes=4194304);y.isBackwards?(T.sibling=r.child,r.child=T):(c=y.last,c!==null?c.sibling=T:r.child=T,y.last=T)}return y.tail!==null?(r=y.tail,y.rendering=r,y.tail=r.sibling,y.renderingStartTime=Et(),r.sibling=null,c=yt.current,st(yt,h?c&1|2:c&1),r):(en(r),null);case 22:case 23:return wh(),h=r.memoizedState!==null,o!==null&&o.memoizedState!==null!==h&&(r.flags|=8192),h&&(r.mode&1)!==0?(Bn&1073741824)!==0&&(en(r),r.subtreeFlags&6&&(r.flags|=8192)):en(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function gC(o,r){switch(kf(r),r.tag){case 1:return En(r.type)&&Pc(),o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 3:return ms(),ct(Tn),ct(Qt),Xf(),o=r.flags,(o&65536)!==0&&(o&128)===0?(r.flags=o&-65537|128,r):null;case 5:return zf(r),null;case 13:if(ct(yt),o=r.memoizedState,o!==null&&o.dehydrated!==null){if(r.alternate===null)throw Error(n(340));fs()}return o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 19:return ct(yt),null;case 4:return ms(),null;case 10:return Gf(r.type._context),null;case 22:case 23:return wh(),null;case 24:return null;default:return null}}var Vc=!1,tn=!1,mC=typeof WeakSet=="function"?WeakSet:Set,ye=null;function vs(o,r){var c=o.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(h){It(o,r,h)}else c.current=null}function hh(o,r,c){try{c()}catch(h){It(o,r,h)}}var cy=!1;function yC(o,r){if(wf=pc,o=xm(),yf(o)){if("selectionStart"in o)var c={start:o.selectionStart,end:o.selectionEnd};else e:{c=(c=o.ownerDocument)&&c.defaultView||window;var h=c.getSelection&&c.getSelection();if(h&&h.rangeCount!==0){c=h.anchorNode;var g=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{c.nodeType,y.nodeType}catch{c=null;break e}var T=0,b=-1,F=-1,W=0,te=0,ne=o,ee=null;t:for(;;){for(var ge;ne!==c||g!==0&&ne.nodeType!==3||(b=T+g),ne!==y||h!==0&&ne.nodeType!==3||(F=T+h),ne.nodeType===3&&(T+=ne.nodeValue.length),(ge=ne.firstChild)!==null;)ee=ne,ne=ge;for(;;){if(ne===o)break t;if(ee===c&&++W===g&&(b=T),ee===y&&++te===h&&(F=T),(ge=ne.nextSibling)!==null)break;ne=ee,ee=ne.parentNode}ne=ge}c=b===-1||F===-1?null:{start:b,end:F}}else c=null}c=c||{start:0,end:0}}else c=null;for(_f={focusedElem:o,selectionRange:c},pc=!1,ye=r;ye!==null;)if(r=ye,o=r.child,(r.subtreeFlags&1028)!==0&&o!==null)o.return=r,ye=o;else for(;ye!==null;){r=ye;try{var Se=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(Se!==null){var Ae=Se.memoizedProps,Ct=Se.memoizedState,x=r.stateNode,H=x.getSnapshotBeforeUpdate(r.elementType===r.type?Ae:hi(r.type,Ae),Ct);x.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var $=r.stateNode.containerInfo;$.nodeType===1?$.textContent="":$.nodeType===9&&$.documentElement&&$.removeChild($.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(oe){It(r,r.return,oe)}if(o=r.sibling,o!==null){o.return=r.return,ye=o;break}ye=r.return}return Se=cy,cy=!1,Se}function qa(o,r,c){var h=r.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var g=h=h.next;do{if((g.tag&o)===o){var y=g.destroy;g.destroy=void 0,y!==void 0&&hh(r,c,y)}g=g.next}while(g!==h)}}function Kc(o,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var c=r=r.next;do{if((c.tag&o)===o){var h=c.create;c.destroy=h()}c=c.next}while(c!==r)}}function ph(o){var r=o.ref;if(r!==null){var c=o.stateNode;switch(o.tag){case 5:o=c;break;default:o=c}typeof r=="function"?r(o):r.current=o}}function dy(o){var r=o.alternate;r!==null&&(o.alternate=null,dy(r)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(r=o.stateNode,r!==null&&(delete r[Ei],delete r[Ua],delete r[Mf],delete r[JE],delete r[eC])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function uy(o){return o.tag===5||o.tag===3||o.tag===4}function fy(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||uy(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function gh(o,r,c){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?c.nodeType===8?c.parentNode.insertBefore(o,r):c.insertBefore(o,r):(c.nodeType===8?(r=c.parentNode,r.insertBefore(o,c)):(r=c,r.appendChild(o)),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=_c));else if(h!==4&&(o=o.child,o!==null))for(gh(o,r,c),o=o.sibling;o!==null;)gh(o,r,c),o=o.sibling}function mh(o,r,c){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?c.insertBefore(o,r):c.appendChild(o);else if(h!==4&&(o=o.child,o!==null))for(mh(o,r,c),o=o.sibling;o!==null;)mh(o,r,c),o=o.sibling}var $t=null,pi=!1;function _o(o,r,c){for(c=c.child;c!==null;)hy(o,r,c),c=c.sibling}function hy(o,r,c){if(Ti&&typeof Ti.onCommitFiberUnmount=="function")try{Ti.onCommitFiberUnmount(lc,c)}catch{}switch(c.tag){case 5:tn||vs(c,r);case 6:var h=$t,g=pi;$t=null,_o(o,r,c),$t=h,pi=g,$t!==null&&(pi?(o=$t,c=c.stateNode,o.nodeType===8?o.parentNode.removeChild(c):o.removeChild(c)):$t.removeChild(c.stateNode));break;case 18:$t!==null&&(pi?(o=$t,c=c.stateNode,o.nodeType===8?Df(o.parentNode,c):o.nodeType===1&&Df(o,c),Pa(o)):Df($t,c.stateNode));break;case 4:h=$t,g=pi,$t=c.stateNode.containerInfo,pi=!0,_o(o,r,c),$t=h,pi=g;break;case 0:case 11:case 14:case 15:if(!tn&&(h=c.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){g=h=h.next;do{var y=g,T=y.destroy;y=y.tag,T!==void 0&&((y&2)!==0||(y&4)!==0)&&hh(c,r,T),g=g.next}while(g!==h)}_o(o,r,c);break;case 1:if(!tn&&(vs(c,r),h=c.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=c.memoizedProps,h.state=c.memoizedState,h.componentWillUnmount()}catch(b){It(c,r,b)}_o(o,r,c);break;case 21:_o(o,r,c);break;case 22:c.mode&1?(tn=(h=tn)||c.memoizedState!==null,_o(o,r,c),tn=h):_o(o,r,c);break;default:_o(o,r,c)}}function py(o){var r=o.updateQueue;if(r!==null){o.updateQueue=null;var c=o.stateNode;c===null&&(c=o.stateNode=new mC),r.forEach(function(h){var g=_C.bind(null,o,h);c.has(h)||(c.add(h),h.then(g,g))})}}function gi(o,r){var c=r.deletions;if(c!==null)for(var h=0;h<c.length;h++){var g=c[h];try{var y=o,T=r,b=T;e:for(;b!==null;){switch(b.tag){case 5:$t=b.stateNode,pi=!1;break e;case 3:$t=b.stateNode.containerInfo,pi=!0;break e;case 4:$t=b.stateNode.containerInfo,pi=!0;break e}b=b.return}if($t===null)throw Error(n(160));hy(y,T,g),$t=null,pi=!1;var F=g.alternate;F!==null&&(F.return=null),g.return=null}catch(W){It(g,r,W)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)gy(r,o),r=r.sibling}function gy(o,r){var c=o.alternate,h=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(gi(r,o),_i(o),h&4){try{qa(3,o,o.return),Kc(3,o)}catch(Ae){It(o,o.return,Ae)}try{qa(5,o,o.return)}catch(Ae){It(o,o.return,Ae)}}break;case 1:gi(r,o),_i(o),h&512&&c!==null&&vs(c,c.return);break;case 5:if(gi(r,o),_i(o),h&512&&c!==null&&vs(c,c.return),o.flags&32){var g=o.stateNode;try{ya(g,"")}catch(Ae){It(o,o.return,Ae)}}if(h&4&&(g=o.stateNode,g!=null)){var y=o.memoizedProps,T=c!==null?c.memoizedProps:y,b=o.type,F=o.updateQueue;if(o.updateQueue=null,F!==null)try{b==="input"&&y.type==="radio"&&y.name!=null&&Vn(g,y),ju(b,T);var W=ju(b,y);for(T=0;T<F.length;T+=2){var te=F[T],ne=F[T+1];te==="style"?Zg(g,ne):te==="dangerouslySetInnerHTML"?Kg(g,ne):te==="children"?ya(g,ne):w(g,te,ne,W)}switch(b){case"input":In(g,y);break;case"textarea":jg(g,y);break;case"select":var ee=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!y.multiple;var ge=y.value;ge!=null?ho(g,!!y.multiple,ge,!1):ee!==!!y.multiple&&(y.defaultValue!=null?ho(g,!!y.multiple,y.defaultValue,!0):ho(g,!!y.multiple,y.multiple?[]:"",!1))}g[Ua]=y}catch(Ae){It(o,o.return,Ae)}}break;case 6:if(gi(r,o),_i(o),h&4){if(o.stateNode===null)throw Error(n(162));g=o.stateNode,y=o.memoizedProps;try{g.nodeValue=y}catch(Ae){It(o,o.return,Ae)}}break;case 3:if(gi(r,o),_i(o),h&4&&c!==null&&c.memoizedState.isDehydrated)try{Pa(r.containerInfo)}catch(Ae){It(o,o.return,Ae)}break;case 4:gi(r,o),_i(o);break;case 13:gi(r,o),_i(o),g=o.child,g.flags&8192&&(y=g.memoizedState!==null,g.stateNode.isHidden=y,!y||g.alternate!==null&&g.alternate.memoizedState!==null||(Sh=Et())),h&4&&py(o);break;case 22:if(te=c!==null&&c.memoizedState!==null,o.mode&1?(tn=(W=tn)||te,gi(r,o),tn=W):gi(r,o),_i(o),h&8192){if(W=o.memoizedState!==null,(o.stateNode.isHidden=W)&&!te&&(o.mode&1)!==0)for(ye=o,te=o.child;te!==null;){for(ne=ye=te;ye!==null;){switch(ee=ye,ge=ee.child,ee.tag){case 0:case 11:case 14:case 15:qa(4,ee,ee.return);break;case 1:vs(ee,ee.return);var Se=ee.stateNode;if(typeof Se.componentWillUnmount=="function"){h=ee,c=ee.return;try{r=h,Se.props=r.memoizedProps,Se.state=r.memoizedState,Se.componentWillUnmount()}catch(Ae){It(h,c,Ae)}}break;case 5:vs(ee,ee.return);break;case 22:if(ee.memoizedState!==null){vy(ne);continue}}ge!==null?(ge.return=ee,ye=ge):vy(ne)}te=te.sibling}e:for(te=null,ne=o;;){if(ne.tag===5){if(te===null){te=ne;try{g=ne.stateNode,W?(y=g.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(b=ne.stateNode,F=ne.memoizedProps.style,T=F!=null&&F.hasOwnProperty("display")?F.display:null,b.style.display=qg("display",T))}catch(Ae){It(o,o.return,Ae)}}}else if(ne.tag===6){if(te===null)try{ne.stateNode.nodeValue=W?"":ne.memoizedProps}catch(Ae){It(o,o.return,Ae)}}else if((ne.tag!==22&&ne.tag!==23||ne.memoizedState===null||ne===o)&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===o)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===o)break e;te===ne&&(te=null),ne=ne.return}te===ne&&(te=null),ne.sibling.return=ne.return,ne=ne.sibling}}break;case 19:gi(r,o),_i(o),h&4&&py(o);break;case 21:break;default:gi(r,o),_i(o)}}function _i(o){var r=o.flags;if(r&2){try{e:{for(var c=o.return;c!==null;){if(uy(c)){var h=c;break e}c=c.return}throw Error(n(160))}switch(h.tag){case 5:var g=h.stateNode;h.flags&32&&(ya(g,""),h.flags&=-33);var y=fy(o);mh(o,y,g);break;case 3:case 4:var T=h.stateNode.containerInfo,b=fy(o);gh(o,b,T);break;default:throw Error(n(161))}}catch(F){It(o,o.return,F)}o.flags&=-3}r&4096&&(o.flags&=-4097)}function vC(o,r,c){ye=o,my(o)}function my(o,r,c){for(var h=(o.mode&1)!==0;ye!==null;){var g=ye,y=g.child;if(g.tag===22&&h){var T=g.memoizedState!==null||Vc;if(!T){var b=g.alternate,F=b!==null&&b.memoizedState!==null||tn;b=Vc;var W=tn;if(Vc=T,(tn=F)&&!W)for(ye=g;ye!==null;)T=ye,F=T.child,T.tag===22&&T.memoizedState!==null?Sy(g):F!==null?(F.return=T,ye=F):Sy(g);for(;y!==null;)ye=y,my(y),y=y.sibling;ye=g,Vc=b,tn=W}yy(o)}else(g.subtreeFlags&8772)!==0&&y!==null?(y.return=g,ye=y):yy(o)}}function yy(o){for(;ye!==null;){var r=ye;if((r.flags&8772)!==0){var c=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:tn||Kc(5,r);break;case 1:var h=r.stateNode;if(r.flags&4&&!tn)if(c===null)h.componentDidMount();else{var g=r.elementType===r.type?c.memoizedProps:hi(r.type,c.memoizedProps);h.componentDidUpdate(g,c.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var y=r.updateQueue;y!==null&&v0(r,y,h);break;case 3:var T=r.updateQueue;if(T!==null){if(c=null,r.child!==null)switch(r.child.tag){case 5:c=r.child.stateNode;break;case 1:c=r.child.stateNode}v0(r,T,c)}break;case 5:var b=r.stateNode;if(c===null&&r.flags&4){c=b;var F=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":F.autoFocus&&c.focus();break;case"img":F.src&&(c.src=F.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var W=r.alternate;if(W!==null){var te=W.memoizedState;if(te!==null){var ne=te.dehydrated;ne!==null&&Pa(ne)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}tn||r.flags&512&&ph(r)}catch(ee){It(r,r.return,ee)}}if(r===o){ye=null;break}if(c=r.sibling,c!==null){c.return=r.return,ye=c;break}ye=r.return}}function vy(o){for(;ye!==null;){var r=ye;if(r===o){ye=null;break}var c=r.sibling;if(c!==null){c.return=r.return,ye=c;break}ye=r.return}}function Sy(o){for(;ye!==null;){var r=ye;try{switch(r.tag){case 0:case 11:case 15:var c=r.return;try{Kc(4,r)}catch(F){It(r,c,F)}break;case 1:var h=r.stateNode;if(typeof h.componentDidMount=="function"){var g=r.return;try{h.componentDidMount()}catch(F){It(r,g,F)}}var y=r.return;try{ph(r)}catch(F){It(r,y,F)}break;case 5:var T=r.return;try{ph(r)}catch(F){It(r,T,F)}}}catch(F){It(r,r.return,F)}if(r===o){ye=null;break}var b=r.sibling;if(b!==null){b.return=r.return,ye=b;break}ye=r.return}}var SC=Math.ceil,qc=O.ReactCurrentDispatcher,yh=O.ReactCurrentOwner,ei=O.ReactCurrentBatchConfig,Ve=0,Lt=null,Pt=null,Wt=0,Bn=0,Ss=Io(0),bt=0,Za=null,hr=0,Zc=0,vh=0,Qa=null,wn=null,Sh=0,As=1/0,zi=null,Qc=!1,Ah=null,Ro=null,Jc=!1,Po=null,ed=0,Ja=0,Ih=null,td=-1,nd=0;function dn(){return(Ve&6)!==0?Et():td!==-1?td:td=Et()}function Do(o){return(o.mode&1)===0?1:(Ve&2)!==0&&Wt!==0?Wt&-Wt:nC.transition!==null?(nd===0&&(nd=fm()),nd):(o=et,o!==0||(o=window.event,o=o===void 0?16:Im(o.type)),o)}function mi(o,r,c,h){if(50<Ja)throw Ja=0,Ih=null,Error(n(185));Ea(o,c,h),((Ve&2)===0||o!==Lt)&&(o===Lt&&((Ve&2)===0&&(Zc|=c),bt===4&&Mo(o,Wt)),_n(o,h),c===1&&Ve===0&&(r.mode&1)===0&&(As=Et()+500,Mc&&Eo()))}function _n(o,r){var c=o.callbackNode;nE(o,r);var h=uc(o,o===Lt?Wt:0);if(h===0)c!==null&&cm(c),o.callbackNode=null,o.callbackPriority=0;else if(r=h&-h,o.callbackPriority!==r){if(c!=null&&cm(c),r===1)o.tag===0?tC(Iy.bind(null,o)):s0(Iy.bind(null,o)),ZE(function(){(Ve&6)===0&&Eo()}),c=null;else{switch(hm(h)){case 1:c=Ju;break;case 4:c=dm;break;case 16:c=ac;break;case 536870912:c=um;break;default:c=ac}c=Dy(c,Ay.bind(null,o))}o.callbackPriority=r,o.callbackNode=c}}function Ay(o,r){if(td=-1,nd=0,(Ve&6)!==0)throw Error(n(327));var c=o.callbackNode;if(Is()&&o.callbackNode!==c)return null;var h=uc(o,o===Lt?Wt:0);if(h===0)return null;if((h&30)!==0||(h&o.expiredLanes)!==0||r)r=id(o,h);else{r=h;var g=Ve;Ve|=2;var y=Ey();(Lt!==o||Wt!==r)&&(zi=null,As=Et()+500,gr(o,r));do try{TC();break}catch(b){Ty(o,b)}while(!0);Uf(),qc.current=y,Ve=g,Pt!==null?r=0:(Lt=null,Wt=0,r=bt)}if(r!==0){if(r===2&&(g=ef(o),g!==0&&(h=g,r=Th(o,g))),r===1)throw c=Za,gr(o,0),Mo(o,h),_n(o,Et()),c;if(r===6)Mo(o,h);else{if(g=o.current.alternate,(h&30)===0&&!AC(g)&&(r=id(o,h),r===2&&(y=ef(o),y!==0&&(h=y,r=Th(o,y))),r===1))throw c=Za,gr(o,0),Mo(o,h),_n(o,Et()),c;switch(o.finishedWork=g,o.finishedLanes=h,r){case 0:case 1:throw Error(n(345));case 2:mr(o,wn,zi);break;case 3:if(Mo(o,h),(h&130023424)===h&&(r=Sh+500-Et(),10<r)){if(uc(o,0)!==0)break;if(g=o.suspendedLanes,(g&h)!==h){dn(),o.pingedLanes|=o.suspendedLanes&g;break}o.timeoutHandle=Pf(mr.bind(null,o,wn,zi),r);break}mr(o,wn,zi);break;case 4:if(Mo(o,h),(h&4194240)===h)break;for(r=o.eventTimes,g=-1;0<h;){var T=31-di(h);y=1<<T,T=r[T],T>g&&(g=T),h&=~y}if(h=g,h=Et()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*SC(h/1960))-h,10<h){o.timeoutHandle=Pf(mr.bind(null,o,wn,zi),h);break}mr(o,wn,zi);break;case 5:mr(o,wn,zi);break;default:throw Error(n(329))}}}return _n(o,Et()),o.callbackNode===c?Ay.bind(null,o):null}function Th(o,r){var c=Qa;return o.current.memoizedState.isDehydrated&&(gr(o,r).flags|=256),o=id(o,r),o!==2&&(r=wn,wn=c,r!==null&&Eh(r)),o}function Eh(o){wn===null?wn=o:wn.push.apply(wn,o)}function AC(o){for(var r=o;;){if(r.flags&16384){var c=r.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var h=0;h<c.length;h++){var g=c[h],y=g.getSnapshot;g=g.value;try{if(!ui(y(),g))return!1}catch{return!1}}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Mo(o,r){for(r&=~vh,r&=~Zc,o.suspendedLanes|=r,o.pingedLanes&=~r,o=o.expirationTimes;0<r;){var c=31-di(r),h=1<<c;o[c]=-1,r&=~h}}function Iy(o){if((Ve&6)!==0)throw Error(n(327));Is();var r=uc(o,0);if((r&1)===0)return _n(o,Et()),null;var c=id(o,r);if(o.tag!==0&&c===2){var h=ef(o);h!==0&&(r=h,c=Th(o,h))}if(c===1)throw c=Za,gr(o,0),Mo(o,r),_n(o,Et()),c;if(c===6)throw Error(n(345));return o.finishedWork=o.current.alternate,o.finishedLanes=r,mr(o,wn,zi),_n(o,Et()),null}function Ch(o,r){var c=Ve;Ve|=1;try{return o(r)}finally{Ve=c,Ve===0&&(As=Et()+500,Mc&&Eo())}}function pr(o){Po!==null&&Po.tag===0&&(Ve&6)===0&&Is();var r=Ve;Ve|=1;var c=ei.transition,h=et;try{if(ei.transition=null,et=1,o)return o()}finally{et=h,ei.transition=c,Ve=r,(Ve&6)===0&&Eo()}}function wh(){Bn=Ss.current,ct(Ss)}function gr(o,r){o.finishedWork=null,o.finishedLanes=0;var c=o.timeoutHandle;if(c!==-1&&(o.timeoutHandle=-1,qE(c)),Pt!==null)for(c=Pt.return;c!==null;){var h=c;switch(kf(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&Pc();break;case 3:ms(),ct(Tn),ct(Qt),Xf();break;case 5:zf(h);break;case 4:ms();break;case 13:ct(yt);break;case 19:ct(yt);break;case 10:Gf(h.type._context);break;case 22:case 23:wh()}c=c.return}if(Lt=o,Pt=o=No(o.current,null),Wt=Bn=r,bt=0,Za=null,vh=Zc=hr=0,wn=Qa=null,dr!==null){for(r=0;r<dr.length;r++)if(c=dr[r],h=c.interleaved,h!==null){c.interleaved=null;var g=h.next,y=c.pending;if(y!==null){var T=y.next;y.next=g,h.next=T}c.pending=h}dr=null}return o}function Ty(o,r){do{var c=Pt;try{if(Uf(),Gc.current=Yc,xc){for(var h=vt.memoizedState;h!==null;){var g=h.queue;g!==null&&(g.pending=null),h=h.next}xc=!1}if(fr=0,Ft=Nt=vt=null,za=!1,ja=0,yh.current=null,c===null||c.return===null){bt=1,Za=r,Pt=null;break}e:{var y=o,T=c.return,b=c,F=r;if(r=Wt,b.flags|=32768,F!==null&&typeof F=="object"&&typeof F.then=="function"){var W=F,te=b,ne=te.tag;if((te.mode&1)===0&&(ne===0||ne===11||ne===15)){var ee=te.alternate;ee?(te.updateQueue=ee.updateQueue,te.memoizedState=ee.memoizedState,te.lanes=ee.lanes):(te.updateQueue=null,te.memoizedState=null)}var ge=X0(T);if(ge!==null){ge.flags&=-257,V0(ge,T,b,y,r),ge.mode&1&&j0(y,W,r),r=ge,F=W;var Se=r.updateQueue;if(Se===null){var Ae=new Set;Ae.add(F),r.updateQueue=Ae}else Se.add(F);break e}else{if((r&1)===0){j0(y,W,r),_h();break e}F=Error(n(426))}}else if(pt&&b.mode&1){var Ct=X0(T);if(Ct!==null){(Ct.flags&65536)===0&&(Ct.flags|=256),V0(Ct,T,b,y,r),Lf(ys(F,b));break e}}y=F=ys(F,b),bt!==4&&(bt=2),Qa===null?Qa=[y]:Qa.push(y),y=T;do{switch(y.tag){case 3:y.flags|=65536,r&=-r,y.lanes|=r;var x=Y0(y,F,r);y0(y,x);break e;case 1:b=F;var H=y.type,$=y.stateNode;if((y.flags&128)===0&&(typeof H.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(Ro===null||!Ro.has($)))){y.flags|=65536,r&=-r,y.lanes|=r;var oe=z0(y,b,r);y0(y,oe);break e}}y=y.return}while(y!==null)}wy(c)}catch(Ce){r=Ce,Pt===c&&c!==null&&(Pt=c=c.return);continue}break}while(!0)}function Ey(){var o=qc.current;return qc.current=Yc,o===null?Yc:o}function _h(){(bt===0||bt===3||bt===2)&&(bt=4),Lt===null||(hr&268435455)===0&&(Zc&268435455)===0||Mo(Lt,Wt)}function id(o,r){var c=Ve;Ve|=2;var h=Ey();(Lt!==o||Wt!==r)&&(zi=null,gr(o,r));do try{IC();break}catch(g){Ty(o,g)}while(!0);if(Uf(),Ve=c,qc.current=h,Pt!==null)throw Error(n(261));return Lt=null,Wt=0,bt}function IC(){for(;Pt!==null;)Cy(Pt)}function TC(){for(;Pt!==null&&!XT();)Cy(Pt)}function Cy(o){var r=Py(o.alternate,o,Bn);o.memoizedProps=o.pendingProps,r===null?wy(o):Pt=r,yh.current=null}function wy(o){var r=o;do{var c=r.alternate;if(o=r.return,(r.flags&32768)===0){if(c=pC(c,r,Bn),c!==null){Pt=c;return}}else{if(c=gC(c,r),c!==null){c.flags&=32767,Pt=c;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{bt=6,Pt=null;return}}if(r=r.sibling,r!==null){Pt=r;return}Pt=r=o}while(r!==null);bt===0&&(bt=5)}function mr(o,r,c){var h=et,g=ei.transition;try{ei.transition=null,et=1,EC(o,r,c,h)}finally{ei.transition=g,et=h}return null}function EC(o,r,c,h){do Is();while(Po!==null);if((Ve&6)!==0)throw Error(n(327));c=o.finishedWork;var g=o.finishedLanes;if(c===null)return null;if(o.finishedWork=null,o.finishedLanes=0,c===o.current)throw Error(n(177));o.callbackNode=null,o.callbackPriority=0;var y=c.lanes|c.childLanes;if(iE(o,y),o===Lt&&(Pt=Lt=null,Wt=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||Jc||(Jc=!0,Dy(ac,function(){return Is(),null})),y=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||y){y=ei.transition,ei.transition=null;var T=et;et=1;var b=Ve;Ve|=4,yh.current=null,yC(o,c),gy(c,o),WE(_f),pc=!!wf,_f=wf=null,o.current=c,vC(c),VT(),Ve=b,et=T,ei.transition=y}else o.current=c;if(Jc&&(Jc=!1,Po=o,ed=g),y=o.pendingLanes,y===0&&(Ro=null),ZT(c.stateNode),_n(o,Et()),r!==null)for(h=o.onRecoverableError,c=0;c<r.length;c++)g=r[c],h(g.value,{componentStack:g.stack,digest:g.digest});if(Qc)throw Qc=!1,o=Ah,Ah=null,o;return(ed&1)!==0&&o.tag!==0&&Is(),y=o.pendingLanes,(y&1)!==0?o===Ih?Ja++:(Ja=0,Ih=o):Ja=0,Eo(),null}function Is(){if(Po!==null){var o=hm(ed),r=ei.transition,c=et;try{if(ei.transition=null,et=16>o?16:o,Po===null)var h=!1;else{if(o=Po,Po=null,ed=0,(Ve&6)!==0)throw Error(n(331));var g=Ve;for(Ve|=4,ye=o.current;ye!==null;){var y=ye,T=y.child;if((ye.flags&16)!==0){var b=y.deletions;if(b!==null){for(var F=0;F<b.length;F++){var W=b[F];for(ye=W;ye!==null;){var te=ye;switch(te.tag){case 0:case 11:case 15:qa(8,te,y)}var ne=te.child;if(ne!==null)ne.return=te,ye=ne;else for(;ye!==null;){te=ye;var ee=te.sibling,ge=te.return;if(dy(te),te===W){ye=null;break}if(ee!==null){ee.return=ge,ye=ee;break}ye=ge}}}var Se=y.alternate;if(Se!==null){var Ae=Se.child;if(Ae!==null){Se.child=null;do{var Ct=Ae.sibling;Ae.sibling=null,Ae=Ct}while(Ae!==null)}}ye=y}}if((y.subtreeFlags&2064)!==0&&T!==null)T.return=y,ye=T;else e:for(;ye!==null;){if(y=ye,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:qa(9,y,y.return)}var x=y.sibling;if(x!==null){x.return=y.return,ye=x;break e}ye=y.return}}var H=o.current;for(ye=H;ye!==null;){T=ye;var $=T.child;if((T.subtreeFlags&2064)!==0&&$!==null)$.return=T,ye=$;else e:for(T=H;ye!==null;){if(b=ye,(b.flags&2048)!==0)try{switch(b.tag){case 0:case 11:case 15:Kc(9,b)}}catch(Ce){It(b,b.return,Ce)}if(b===T){ye=null;break e}var oe=b.sibling;if(oe!==null){oe.return=b.return,ye=oe;break e}ye=b.return}}if(Ve=g,Eo(),Ti&&typeof Ti.onPostCommitFiberRoot=="function")try{Ti.onPostCommitFiberRoot(lc,o)}catch{}h=!0}return h}finally{et=c,ei.transition=r}}return!1}function _y(o,r,c){r=ys(c,r),r=Y0(o,r,1),o=wo(o,r,1),r=dn(),o!==null&&(Ea(o,1,r),_n(o,r))}function It(o,r,c){if(o.tag===3)_y(o,o,c);else for(;r!==null;){if(r.tag===3){_y(r,o,c);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Ro===null||!Ro.has(h))){o=ys(c,o),o=z0(r,o,1),r=wo(r,o,1),o=dn(),r!==null&&(Ea(r,1,o),_n(r,o));break}}r=r.return}}function CC(o,r,c){var h=o.pingCache;h!==null&&h.delete(r),r=dn(),o.pingedLanes|=o.suspendedLanes&c,Lt===o&&(Wt&c)===c&&(bt===4||bt===3&&(Wt&130023424)===Wt&&500>Et()-Sh?gr(o,0):vh|=c),_n(o,r)}function Ry(o,r){r===0&&((o.mode&1)===0?r=1:(r=dc,dc<<=1,(dc&130023424)===0&&(dc=4194304)));var c=dn();o=$i(o,r),o!==null&&(Ea(o,r,c),_n(o,c))}function wC(o){var r=o.memoizedState,c=0;r!==null&&(c=r.retryLane),Ry(o,c)}function _C(o,r){var c=0;switch(o.tag){case 13:var h=o.stateNode,g=o.memoizedState;g!==null&&(c=g.retryLane);break;case 19:h=o.stateNode;break;default:throw Error(n(314))}h!==null&&h.delete(r),Ry(o,c)}var Py;Py=function(o,r,c){if(o!==null)if(o.memoizedProps!==r.pendingProps||Tn.current)Cn=!0;else{if((o.lanes&c)===0&&(r.flags&128)===0)return Cn=!1,hC(o,r,c);Cn=(o.flags&131072)!==0}else Cn=!1,pt&&(r.flags&1048576)!==0&&a0(r,bc,r.index);switch(r.lanes=0,r.tag){case 2:var h=r.type;Xc(o,r),o=r.pendingProps;var g=cs(r,Qt.current);gs(r,c),g=qf(null,r,h,o,g,c);var y=Zf();return r.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,En(h)?(y=!0,Dc(r)):y=!1,r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,Wf(r),g.updater=zc,r.stateNode=g,g._reactInternals=r,ih(r,h,o,c),r=ah(null,r,h,!0,y,c)):(r.tag=0,pt&&y&&Of(r),cn(null,r,g,c),r=r.child),r;case 16:h=r.elementType;e:{switch(Xc(o,r),o=r.pendingProps,g=h._init,h=g(h._payload),r.type=h,g=r.tag=PC(h),o=hi(h,o),g){case 0:r=sh(null,r,h,o,c);break e;case 1:r=ey(null,r,h,o,c);break e;case 11:r=K0(null,r,h,o,c);break e;case 14:r=q0(null,r,h,hi(h.type,o),c);break e}throw Error(n(306,h,""))}return r;case 0:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:hi(h,g),sh(o,r,h,g,c);case 1:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:hi(h,g),ey(o,r,h,g,c);case 3:e:{if(ty(r),o===null)throw Error(n(387));h=r.pendingProps,y=r.memoizedState,g=y.element,m0(o,r),Hc(r,h,null,c);var T=r.memoizedState;if(h=T.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){g=ys(Error(n(423)),r),r=ny(o,r,h,c,g);break e}else if(h!==g){g=ys(Error(n(424)),r),r=ny(o,r,h,c,g);break e}else for(kn=Ao(r.stateNode.containerInfo.firstChild),On=r,pt=!0,fi=null,c=p0(r,null,h,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(fs(),h===g){r=Yi(o,r,c);break e}cn(o,r,h,c)}r=r.child}return r;case 5:return S0(r),o===null&&Ff(r),h=r.type,g=r.pendingProps,y=o!==null?o.memoizedProps:null,T=g.children,Rf(h,g)?T=null:y!==null&&Rf(h,y)&&(r.flags|=32),J0(o,r),cn(o,r,T,c),r.child;case 6:return o===null&&Ff(r),null;case 13:return iy(o,r,c);case 4:return Yf(r,r.stateNode.containerInfo),h=r.pendingProps,o===null?r.child=hs(r,null,h,c):cn(o,r,h,c),r.child;case 11:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:hi(h,g),K0(o,r,h,g,c);case 7:return cn(o,r,r.pendingProps,c),r.child;case 8:return cn(o,r,r.pendingProps.children,c),r.child;case 12:return cn(o,r,r.pendingProps.children,c),r.child;case 10:e:{if(h=r.type._context,g=r.pendingProps,y=r.memoizedProps,T=g.value,st(Bc,h._currentValue),h._currentValue=T,y!==null)if(ui(y.value,T)){if(y.children===g.children&&!Tn.current){r=Yi(o,r,c);break e}}else for(y=r.child,y!==null&&(y.return=r);y!==null;){var b=y.dependencies;if(b!==null){T=y.child;for(var F=b.firstContext;F!==null;){if(F.context===h){if(y.tag===1){F=Wi(-1,c&-c),F.tag=2;var W=y.updateQueue;if(W!==null){W=W.shared;var te=W.pending;te===null?F.next=F:(F.next=te.next,te.next=F),W.pending=F}}y.lanes|=c,F=y.alternate,F!==null&&(F.lanes|=c),xf(y.return,c,r),b.lanes|=c;break}F=F.next}}else if(y.tag===10)T=y.type===r.type?null:y.child;else if(y.tag===18){if(T=y.return,T===null)throw Error(n(341));T.lanes|=c,b=T.alternate,b!==null&&(b.lanes|=c),xf(T,c,r),T=y.sibling}else T=y.child;if(T!==null)T.return=y;else for(T=y;T!==null;){if(T===r){T=null;break}if(y=T.sibling,y!==null){y.return=T.return,T=y;break}T=T.return}y=T}cn(o,r,g.children,c),r=r.child}return r;case 9:return g=r.type,h=r.pendingProps.children,gs(r,c),g=Qn(g),h=h(g),r.flags|=1,cn(o,r,h,c),r.child;case 14:return h=r.type,g=hi(h,r.pendingProps),g=hi(h.type,g),q0(o,r,h,g,c);case 15:return Z0(o,r,r.type,r.pendingProps,c);case 17:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:hi(h,g),Xc(o,r),r.tag=1,En(h)?(o=!0,Dc(r)):o=!1,gs(r,c),$0(r,h,g),ih(r,h,g,c),ah(null,r,h,!0,o,c);case 19:return ry(o,r,c);case 22:return Q0(o,r,c)}throw Error(n(156,r.tag))};function Dy(o,r){return lm(o,r)}function RC(o,r,c,h){this.tag=o,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ti(o,r,c,h){return new RC(o,r,c,h)}function Rh(o){return o=o.prototype,!(!o||!o.isReactComponent)}function PC(o){if(typeof o=="function")return Rh(o)?1:0;if(o!=null){if(o=o.$$typeof,o===X)return 11;if(o===re)return 14}return 2}function No(o,r){var c=o.alternate;return c===null?(c=ti(o.tag,r,o.key,o.mode),c.elementType=o.elementType,c.type=o.type,c.stateNode=o.stateNode,c.alternate=o,o.alternate=c):(c.pendingProps=r,c.type=o.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=o.flags&14680064,c.childLanes=o.childLanes,c.lanes=o.lanes,c.child=o.child,c.memoizedProps=o.memoizedProps,c.memoizedState=o.memoizedState,c.updateQueue=o.updateQueue,r=o.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=o.sibling,c.index=o.index,c.ref=o.ref,c}function od(o,r,c,h,g,y){var T=2;if(h=o,typeof o=="function")Rh(o)&&(T=1);else if(typeof o=="string")T=5;else e:switch(o){case N:return yr(c.children,g,y,r);case k:T=8,g|=8;break;case U:return o=ti(12,c,r,g|2),o.elementType=U,o.lanes=y,o;case J:return o=ti(13,c,r,g),o.elementType=J,o.lanes=y,o;case q:return o=ti(19,c,r,g),o.elementType=q,o.lanes=y,o;case ie:return rd(c,g,y,r);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case z:T=10;break e;case K:T=9;break e;case X:T=11;break e;case re:T=14;break e;case se:T=16,h=null;break e}throw Error(n(130,o==null?o:typeof o,""))}return r=ti(T,c,r,g),r.elementType=o,r.type=h,r.lanes=y,r}function yr(o,r,c,h){return o=ti(7,o,h,r),o.lanes=c,o}function rd(o,r,c,h){return o=ti(22,o,h,r),o.elementType=ie,o.lanes=c,o.stateNode={isHidden:!1},o}function Ph(o,r,c){return o=ti(6,o,null,r),o.lanes=c,o}function Dh(o,r,c){return r=ti(4,o.children!==null?o.children:[],o.key,r),r.lanes=c,r.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},r}function DC(o,r,c,h,g){this.tag=r,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=tf(0),this.expirationTimes=tf(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=tf(0),this.identifierPrefix=h,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function Mh(o,r,c,h,g,y,T,b,F){return o=new DC(o,r,c,b,F),r===1?(r=1,y===!0&&(r|=8)):r=0,y=ti(3,null,null,r),o.current=y,y.stateNode=o,y.memoizedState={element:h,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},Wf(y),o}function MC(o,r,c){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:h==null?null:""+h,children:o,containerInfo:r,implementation:c}}function My(o){if(!o)return To;o=o._reactInternals;e:{if(rr(o)!==o||o.tag!==1)throw Error(n(170));var r=o;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(En(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(o.tag===1){var c=o.type;if(En(c))return o0(o,c,r)}return r}function Ny(o,r,c,h,g,y,T,b,F){return o=Mh(c,h,!0,o,g,y,T,b,F),o.context=My(null),c=o.current,h=dn(),g=Do(c),y=Wi(h,g),y.callback=r??null,wo(c,y,g),o.current.lanes=g,Ea(o,g,h),_n(o,h),o}function sd(o,r,c,h){var g=r.current,y=dn(),T=Do(g);return c=My(c),r.context===null?r.context=c:r.pendingContext=c,r=Wi(y,T),r.payload={element:o},h=h===void 0?null:h,h!==null&&(r.callback=h),o=wo(g,r,T),o!==null&&(mi(o,g,T,y),Lc(o,g,T)),T}function ad(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function by(o,r){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var c=o.retryLane;o.retryLane=c!==0&&c<r?c:r}}function Nh(o,r){by(o,r),(o=o.alternate)&&by(o,r)}function NC(){return null}var Oy=typeof reportError=="function"?reportError:function(o){console.error(o)};function bh(o){this._internalRoot=o}ld.prototype.render=bh.prototype.render=function(o){var r=this._internalRoot;if(r===null)throw Error(n(409));sd(o,r,null,null)},ld.prototype.unmount=bh.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var r=o.containerInfo;pr(function(){sd(null,o,null,null)}),r[Hi]=null}};function ld(o){this._internalRoot=o}ld.prototype.unstable_scheduleHydration=function(o){if(o){var r=mm();o={blockedOn:null,target:o,priority:r};for(var c=0;c<yo.length&&r!==0&&r<yo[c].priority;c++);yo.splice(c,0,o),c===0&&Sm(o)}};function Oh(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function cd(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function ky(){}function bC(o,r,c,h,g){if(g){if(typeof h=="function"){var y=h;h=function(){var W=ad(T);y.call(W)}}var T=Ny(r,h,o,0,null,!1,!1,"",ky);return o._reactRootContainer=T,o[Hi]=T.current,La(o.nodeType===8?o.parentNode:o),pr(),T}for(;g=o.lastChild;)o.removeChild(g);if(typeof h=="function"){var b=h;h=function(){var W=ad(F);b.call(W)}}var F=Mh(o,0,!1,null,null,!1,!1,"",ky);return o._reactRootContainer=F,o[Hi]=F.current,La(o.nodeType===8?o.parentNode:o),pr(function(){sd(r,F,c,h)}),F}function dd(o,r,c,h,g){var y=c._reactRootContainer;if(y){var T=y;if(typeof g=="function"){var b=g;g=function(){var F=ad(T);b.call(F)}}sd(r,T,o,g)}else T=bC(c,r,o,g,h);return ad(T)}pm=function(o){switch(o.tag){case 3:var r=o.stateNode;if(r.current.memoizedState.isDehydrated){var c=Ta(r.pendingLanes);c!==0&&(nf(r,c|1),_n(r,Et()),(Ve&6)===0&&(As=Et()+500,Eo()))}break;case 13:pr(function(){var h=$i(o,1);if(h!==null){var g=dn();mi(h,o,1,g)}}),Nh(o,1)}},of=function(o){if(o.tag===13){var r=$i(o,134217728);if(r!==null){var c=dn();mi(r,o,134217728,c)}Nh(o,134217728)}},gm=function(o){if(o.tag===13){var r=Do(o),c=$i(o,r);if(c!==null){var h=dn();mi(c,o,r,h)}Nh(o,r)}},mm=function(){return et},ym=function(o,r){var c=et;try{return et=o,r()}finally{et=c}},Ku=function(o,r,c){switch(r){case"input":if(In(o,c),r=c.name,c.type==="radio"&&r!=null){for(c=o;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<c.length;r++){var h=c[r];if(h!==o&&h.form===o.form){var g=Rc(h);if(!g)throw Error(n(90));Pe(h),In(h,g)}}}break;case"textarea":jg(o,c);break;case"select":r=c.value,r!=null&&ho(o,!!c.multiple,r,!1)}},tm=Ch,nm=pr;var OC={usingClientEntryPoint:!1,Events:[Ga,as,Rc,Jg,em,Ch]},el={findFiberByHostInstance:sr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kC={bundleType:el.bundleType,version:el.version,rendererPackageName:el.rendererPackageName,rendererConfig:el.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:O.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=sm(o),o===null?null:o.stateNode},findFiberByHostInstance:el.findFiberByHostInstance||NC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ud=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ud.isDisabled&&ud.supportsFiber)try{lc=ud.inject(kC),Ti=ud}catch{}}return Rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OC,Rn.createPortal=function(o,r){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Oh(r))throw Error(n(200));return MC(o,r,null,c)},Rn.createRoot=function(o,r){if(!Oh(o))throw Error(n(299));var c=!1,h="",g=Oy;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(g=r.onRecoverableError)),r=Mh(o,1,!1,null,null,c,!1,h,g),o[Hi]=r.current,La(o.nodeType===8?o.parentNode:o),new bh(r)},Rn.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var r=o._reactInternals;if(r===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=sm(r),o=o===null?null:o.stateNode,o},Rn.flushSync=function(o){return pr(o)},Rn.hydrate=function(o,r,c){if(!cd(r))throw Error(n(200));return dd(null,o,r,!0,c)},Rn.hydrateRoot=function(o,r,c){if(!Oh(o))throw Error(n(405));var h=c!=null&&c.hydratedSources||null,g=!1,y="",T=Oy;if(c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(y=c.identifierPrefix),c.onRecoverableError!==void 0&&(T=c.onRecoverableError)),r=Ny(r,null,o,1,c??null,g,!1,y,T),o[Hi]=r.current,La(o),h)for(o=0;o<h.length;o++)c=h[o],g=c._getVersion,g=g(c._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[c,g]:r.mutableSourceEagerHydrationData.push(c,g);return new ld(r)},Rn.render=function(o,r,c){if(!cd(r))throw Error(n(200));return dd(null,o,r,!1,c)},Rn.unmountComponentAtNode=function(o){if(!cd(o))throw Error(n(40));return o._reactRootContainer?(pr(function(){dd(null,null,o,!1,function(){o._reactRootContainer=null,o[Hi]=null})}),!0):!1},Rn.unstable_batchedUpdates=Ch,Rn.unstable_renderSubtreeIntoContainer=function(o,r,c,h){if(!cd(c))throw Error(n(200));if(o==null||o._reactInternals===void 0)throw Error(n(38));return dd(o,r,c,!1,h)},Rn.version="18.3.1-next-f1338f8080-20240426",Rn}var $y;function YC(){if($y)return Fh.exports;$y=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Fh.exports=WC(),Fh.exports}var Wy;function zC(){if(Wy)return fd;Wy=1;var e=YC();return fd.createRoot=e.createRoot,fd.hydrateRoot=e.hydrateRoot,fd}var jC=zC();const XC=BS(jC);class VC{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let i=this.length++;for(;i>0;){const s=i-1>>1,a=this.values[s];if(n>=a)break;this.ids[i]=this.ids[s],this.values[i]=a,i=s}this.ids[i]=t,this.values[i]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let l=(a<<1)+1;const d=l+1;let u=this.ids[l],f=this.values[l];const p=this.values[d];if(d<this.length&&p<f&&(l=d,u=this.ids[d],f=p),f>=i)break;this.ids[a]=u,this.values[a]=f,a=l}this.ids[a]=n,this.values[a]=i}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Yy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Uh=3;class qp{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[i,s]=new Uint8Array(t,n+0,2);if(i!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==Uh)throw new Error(`Got v${a} data when expected v${Uh}.`);const l=Yy[s&15];if(!l)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,n+2,1),[u]=new Uint32Array(t,n+4,1);return new qp(u,d,l,void 0,t,n)}constructor(t,n=16,i=Float64Array,s=ArrayBuffer,a,l=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=l;let d=t,u=d;this._levelBounds=[d*4];do d=Math.ceil(d/this.nodeSize),u+=d,this._levelBounds.push(u*4);while(d!==1);this.ArrayType=i,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const f=Yy.indexOf(this.ArrayType),p=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(f<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,l+8,u*4),this._indices=new this.IndexArrayType(this.data,l+8+p,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+p+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+p,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Uh<<4)+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new VC}add(t,n,i=t,s=n){const a=this._pos>>2,l=this._boxes;return this._indices[a]=a,l[this._pos++]=t,l[this._pos++]=n,l[this._pos++]=i,l[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),i>this.maxX&&(this.maxX=i),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,i=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let l=0,d=0;l<this.numItems;l++){const u=t[d++],f=t[d++],p=t[d++],m=t[d++],S=Math.floor(a*((u+p)/2-this.minX)/n),v=Math.floor(a*((f+m)/2-this.minY)/i);s[l]=qC(S,v)}yp(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let l=0,d=0;l<this._levelBounds.length-1;l++){const u=this._levelBounds[l];for(;d<u;){const f=d;let p=t[d++],m=t[d++],S=t[d++],v=t[d++];for(let A=1;A<this.nodeSize&&d<u;A++)p=Math.min(p,t[d++]),m=Math.min(m,t[d++]),S=Math.max(S,t[d++]),v=Math.max(v,t[d++]);this._indices[this._pos>>2]=f,t[this._pos++]=p,t[this._pos++]=m,t[this._pos++]=S,t[this._pos++]=v}}}search(t,n,i,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const d=[],u=[];for(;l!==void 0;){const f=Math.min(l+this.nodeSize*4,jy(l,this._levelBounds));for(let p=l;p<f;p+=4){if(i<this._boxes[p]||s<this._boxes[p+1]||t>this._boxes[p+2]||n>this._boxes[p+3])continue;const m=this._indices[p>>2]|0;l>=this.numItems*4?d.push(m):(a===void 0||a(m))&&u.push(m)}l=d.pop()}return u}neighbors(t,n,i=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const d=this._queue,u=[],f=s*s;e:for(;l!==void 0;){const p=Math.min(l+this.nodeSize*4,jy(l,this._levelBounds));for(let m=l;m<p;m+=4){const S=this._indices[m>>2]|0,v=zy(t,this._boxes[m],this._boxes[m+2]),A=zy(n,this._boxes[m+1],this._boxes[m+3]),I=v*v+A*A;I>f||(l>=this.numItems*4?d.push(S<<1,I):(a===void 0||a(S))&&d.push((S<<1)+1,I))}for(;d.length&&d.peek()&1;)if(d.peekValue()>f||(u.push(d.pop()>>1),u.length===i))break e;l=d.length?d.pop()>>1:void 0}return d.clear(),u}}function zy(e,t,n){return e<t?t-e:e<=n?0:e-n}function jy(e,t){let n=0,i=t.length-1;for(;n<i;){const s=n+i>>1;t[s]>e?i=s:n=s+1}return t[n]}function yp(e,t,n,i,s,a){if(Math.floor(i/a)>=Math.floor(s/a))return;const l=e[i+s>>1];let d=i-1,u=s+1;for(;;){do d++;while(e[d]<l);do u--;while(e[u]>l);if(d>=u)break;KC(e,t,n,d,u)}yp(e,t,n,i,u,a),yp(e,t,n,u+1,s,a)}function KC(e,t,n,i,s){const a=e[i];e[i]=e[s],e[s]=a;const l=4*i,d=4*s,u=t[l],f=t[l+1],p=t[l+2],m=t[l+3];t[l]=t[d],t[l+1]=t[d+1],t[l+2]=t[d+2],t[l+3]=t[d+3],t[d]=u,t[d+1]=f,t[d+2]=p,t[d+3]=m;const S=n[i];n[i]=n[s],n[s]=S}function qC(e,t){let n=e^t,i=65535^n,s=65535^(e|t),a=e&(t^65535),l=n|i>>1,d=n>>1^n,u=s>>1^i&a>>1^s,f=n&s>>1^a>>1^a;n=l,i=d,s=u,a=f,l=n&n>>2^i&i>>2,d=n&i>>2^i&(n^i)>>2,u^=n&s>>2^i&a>>2,f^=i&s>>2^(n^i)&a>>2,n=l,i=d,s=u,a=f,l=n&n>>4^i&i>>4,d=n&i>>4^i&(n^i)>>4,u^=n&s>>4^i&a>>4,f^=i&s>>4^(n^i)&a>>4,n=l,i=d,s=u,a=f,u^=n&s>>8^i&a>>8,f^=i&s>>8^(n^i)&a>>8,n=u^u>>1,i=f^f>>1;let p=e^t,m=i|65535^(p|n);return p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|p)>>>0}function ri(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Zp(e,t){return{x:e.x-t.x,y:e.y-t.y}}function _t(e,t){return{x:e.x*t,y:e.y*t}}function Ko(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function mt(e){const t=Ko(e);return t===0?{x:0,y:0}:_t(e,1/t)}function si(e,t){return Ko(Zp(e,t))}function Wd(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function Yd(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,i)=>({x:n.x+i.x,y:n.y+i.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Xe(e,t,n,i){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>i/2&&(a=a-Math.sign(a)*i),{x:s,y:a}}function We(e,t,n){const i=Xe(e,t,n.width,n.height);return mt(i)}function G(e,t,n,i){const s=Xe(e,t,n,i);return Ko(s)}function Dn(e,t,n,i){const s=Xe(e,t,n,i);return s.x*s.x+s.y*s.y}function FS(e,t){return e.x*t.x+e.y*t.y}function ZC(e,t){const n=FS(e,t),i=Ko(e),s=Ko(t);if(i===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(i*s)));return Math.acos(a)}function vp(e,t){const n=Math.cos(t),i=Math.sin(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function QC(e,t){return t.split(".").reduce((n,i)=>{if(n&&typeof n=="object"&&i in n)return n[i]},e)}function Vi(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new qp(e.length),i=new Map,s=new Map;let a=0;const l=new Uint32Array(e.length);for(let u=0;u<e.length;u++){const f=e[u];f.width!==void 0&&f.height!==void 0?n.add(f.position.x,f.position.y,f.position.x+f.width,f.position.y+f.height):n.add(f.position.x,f.position.y,f.position.x,f.position.y)}return n.finish(),{all(){return e},byRect(u){const{width:f,height:p}=t,m=[];a++;const S=[];u.left<0?(S.push({left:u.left+f,right:f}),S.push({left:0,right:u.right})):u.right>f?(S.push({left:u.left,right:f}),S.push({left:0,right:u.right-f})):S.push({left:u.left,right:u.right});const v=[];u.top<0?(v.push({top:u.top+p,bottom:p}),v.push({top:0,bottom:u.bottom})):u.bottom>p?(v.push({top:u.top,bottom:p}),v.push({top:0,bottom:u.bottom-p})):v.push({top:u.top,bottom:u.bottom});for(let A=0;A<S.length;A++){const I=S[A];for(let E=0;E<v.length;E++){const P=v[E],C=n.search(I.left,P.top,I.right,P.bottom);for(let w=0;w<C.length;w++){const O=C[w];l[O]!==a&&(l[O]=a,m.push(e[O]))}}}return m},byRadius(u,f){const{width:p,height:m}=t,S=[];a++;const v=f*f,A=u.x-f,I=u.x+f,E=u.y-f,P=u.y+f,C=[];A<0?(C.push({left:A+p,right:p}),C.push({left:0,right:I})):I>p?(C.push({left:A,right:p}),C.push({left:0,right:I-p})):C.push({left:A,right:I});const w=[];E<0?(w.push({top:E+m,bottom:m}),w.push({top:0,bottom:P})):P>m?(w.push({top:E,bottom:m}),w.push({top:0,bottom:P-m})):w.push({top:E,bottom:P});for(let O=0;O<C.length;O++){const M=C[O];for(let D=0;D<w.length;D++){const N=w[D],k=n.search(M.left,N.top,M.right,N.bottom);for(let U=0;U<k.length;U++){const z=k[U];if(l[z]!==a){l[z]=a;const K=e[z];Dn(u,K.position,p,m)<=v&&S.push(K)}}}}return S},byProperty(u,f){var p;if(!i.has(u)){const m=new Map;for(let S=0;S<e.length;S++){const v=e[S],A=v[u];m.has(A)||m.set(A,[]),m.get(A).push(v)}i.set(u,m)}return((p=i.get(u))==null?void 0:p.get(f))||[]},byPropertyPath(u,f){var p;if(!s.has(u)){const m=new Map;for(let S=0;S<e.length;S++){const v=e[S],A=QC(v,u);m.has(A)||m.set(A,[]),m.get(A).push(v)}s.set(u,m)}return((p=s.get(u))==null?void 0:p.get(f))||[]},resetPropertyCache(){i.clear(),s.clear()},count(){return e.length}}}function pu(e){var m,S;const t=e.entities.entities,n=[],i=[],s=[],a=[],l=[],d=[],u=[];for(const v in t){const A=t[v];switch(A.type){case"human":n.push(A);break;case"berryBush":i.push(A);break;case"corpse":s.push(A);break;case"prey":a.push(A);break;case"predator":l.push(A);break;case"building":d.push(A);break;case"tree":u.push(A);break}}const f=e.mapDimensions;return{...e,search:{human:Vi(n,f),berryBush:Vi(i,f),corpse:Vi(s,f),prey:Vi(a,f),predator:Vi(l,f),building:Vi(d,f),tree:Vi(u,f),tasks:((m=e.search)==null?void 0:m.tasks)??Vi([],f)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((S=e.cache)==null?void 0:S.tribeCenters)??{}}}}function JC(e){const t=[];for(const n in e.tasks)t.push(e.tasks[n]);e.search.tasks=Vi(t,e.mapDimensions)}const ue={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire"},nr={[ue.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[ue.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[ue.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[ue.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}}},ew=.5,tw="#FFA500",nw="#FF4500",Xy=4,iw=10,Qp=60;function Jp(e){return nr[e].dimensions}function ow(e){return nr[e].constructionTimeHours}function rw(e){return nr[e].destructionTimeHours}const LS=5;function sw(){return nr[ue.PlantingZone].dimensions}function Vy(e,t,n){const i=e.position.x+n.width/2,a=t.position.x-n.width/2-i,l=e.position.y-n.height/2,d=e.position.y+n.height/2,u=t.position.y-n.height/2,f=t.position.y+n.height/2,p=Math.min(d,f)-Math.max(l,u);return a>=-5&&a<=LS&&p>n.height*.5}function Ky(e,t,n){const i=e.position.y+n.height/2,a=t.position.y-n.height/2-i,l=e.position.x-n.width/2,d=e.position.x+n.width/2,u=t.position.x-n.width/2,f=t.position.x+n.width/2,p=Math.min(d,f)-Math.max(l,u);return a>=-5&&a<=LS&&p>n.width*.5}function aw(e){var l;const t={},n=sw(),i=e;if(!((l=i.search)!=null&&l.building))return t;const a=i.search.building.all().filter(d=>d.buildingType===ue.PlantingZone&&d.isConstructed);for(const d of a)t[d.id]={top:!1,bottom:!1,left:!1,right:!1};for(let d=0;d<a.length;d++){const u=a[d];for(let f=d+1;f<a.length;f++){const p=a[f];u.ownerId===p.ownerId&&(Vy(u,p,n)&&(t[u.id].right=!0,t[p.id].left=!0),Vy(p,u,n)&&(t[p.id].right=!0,t[u.id].left=!0),Ky(u,p,n)&&(t[u.id].bottom=!0,t[p.id].top=!0),Ky(p,u,n)&&(t[p.id].bottom=!0,t[u.id].top=!0))}}return t}function Ol(e){e.plantingZoneConnections=aw(e)}var Rr=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(Rr||{});class lw{constructor(){Re(this,"worker",null);Re(this,"pendingRequests",new Map);Re(this,"requestQueue",[]);Re(this,"isProcessing",!1);Re(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case Rr.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case Rr.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case Rr.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,i)=>{if(!this.worker){i(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:i});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),i(s)}})}queueOperation(t){return new Promise((n,i)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){i(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),i=t,s={type:Rr.SAVE_REQUEST,id:n,gameState:i};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Rr.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Rr.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const eg=new lw;async function tg(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,roleManagerOpen:e.roleManagerOpen,armyControlOpen:e.armyControlOpen,tribeModalOpen:e.tribeModalOpen,cameraFollowingPlayer:e.cameraFollowingPlayer,cameraZoom:e.cameraZoom,isDraggingMinimap:e.isDraggingMinimap,minimapDragDistance:e.minimapDragDistance,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks,isDraggingViewport:e.isDraggingViewport,viewportDragButton:e.viewportDragButton,viewportDragDistance:e.viewportDragDistance};await eg.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function cw(){try{const e=await eg.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=pu(t);return Ol(n),n}catch(e){return console.error("Failed to load game:",e),await HS(),null}}async function HS(){try{await eg.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const US=ke.createContext(void 0),dw=({initialAppState:e,children:t})=>{const[n,i]=ke.useState(e),[s,a]=ke.useState(void 0),[l,d]=ke.useState(null),[u,f]=ke.useState(!1);ke.useEffect(()=>{cw().then(A=>{A&&d(A),f(!0)})},[]);const p=(A,I)=>{i(A),A==="gameOver"&&I?a(I):A!=="gameOver"&&a(void 0)},m=()=>{i("intro"),a(void 0),v()},S=A=>{tg(A),d(A)},v=()=>{HS(),d(null)};return Fe.jsx(US.Provider,{value:{appState:n,setAppState:p,returnToIntro:m,gameOverDetails:s,contextReady:u,savedGameState:l,setSavedGameState:d,saveCurrentGame:S,clearCurrentSave:v},children:t})},jr=()=>{const e=ke.useContext(US);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var on=function(){return on=Object.assign||function(t){for(var n,i=1,s=arguments.length;i<s;i++){n=arguments[i];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},on.apply(this,arguments)};function kl(e,t,n){if(n||arguments.length===2)for(var i=0,s=t.length,a;i<s;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return e.concat(a||Array.prototype.slice.call(t))}var dt="-ms-",El="-moz-",Je="-webkit-",GS="comm",gu="rule",ng="decl",uw="@import",xS="@keyframes",fw="@layer",$S=Math.abs,ig=String.fromCharCode,Sp=Object.assign;function hw(e,t){return Ut(e,0)^45?(((t<<2^Ut(e,0))<<2^Ut(e,1))<<2^Ut(e,2))<<2^Ut(e,3):0}function WS(e){return e.trim()}function qi(e,t){return(e=t.exec(e))?e[0]:e}function $e(e,t,n){return e.replace(t,n)}function Od(e,t,n){return e.indexOf(t,n)}function Ut(e,t){return e.charCodeAt(t)|0}function Zs(e,t,n){return e.slice(t,n)}function Oi(e){return e.length}function YS(e){return e.length}function ml(e,t){return t.push(e),e}function pw(e,t){return e.map(t).join("")}function qy(e,t){return e.filter(function(n){return!qi(n,t)})}var mu=1,Qs=1,zS=0,ai=0,Mt=0,fa="";function yu(e,t,n,i,s,a,l,d){return{value:e,root:t,parent:n,type:i,props:s,children:a,line:mu,column:Qs,length:l,return:"",siblings:d}}function Ho(e,t){return Sp(yu("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Ts(e){for(;e.root;)e=Ho(e.root,{children:[e]});ml(e,e.siblings)}function gw(){return Mt}function mw(){return Mt=ai>0?Ut(fa,--ai):0,Qs--,Mt===10&&(Qs=1,mu--),Mt}function Si(){return Mt=ai<zS?Ut(fa,ai++):0,Qs++,Mt===10&&(Qs=1,mu++),Mt}function br(){return Ut(fa,ai)}function kd(){return ai}function vu(e,t){return Zs(fa,e,t)}function Ap(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function yw(e){return mu=Qs=1,zS=Oi(fa=e),ai=0,[]}function vw(e){return fa="",e}function Gh(e){return WS(vu(ai-1,Ip(e===91?e+2:e===40?e+1:e)))}function Sw(e){for(;(Mt=br())&&Mt<33;)Si();return Ap(e)>2||Ap(Mt)>3?"":" "}function Aw(e,t){for(;--t&&Si()&&!(Mt<48||Mt>102||Mt>57&&Mt<65||Mt>70&&Mt<97););return vu(e,kd()+(t<6&&br()==32&&Si()==32))}function Ip(e){for(;Si();)switch(Mt){case e:return ai;case 34:case 39:e!==34&&e!==39&&Ip(Mt);break;case 40:e===41&&Ip(e);break;case 92:Si();break}return ai}function Iw(e,t){for(;Si()&&e+Mt!==57;)if(e+Mt===84&&br()===47)break;return"/*"+vu(t,ai-1)+"*"+ig(e===47?e:Si())}function Tw(e){for(;!Ap(br());)Si();return vu(e,ai)}function Ew(e){return vw(Bd("",null,null,null,[""],e=yw(e),0,[0],e))}function Bd(e,t,n,i,s,a,l,d,u){for(var f=0,p=0,m=l,S=0,v=0,A=0,I=1,E=1,P=1,C=0,w="",O=s,M=a,D=i,N=w;E;)switch(A=C,C=Si()){case 40:if(A!=108&&Ut(N,m-1)==58){Od(N+=$e(Gh(C),"&","&\f"),"&\f",$S(f?d[f-1]:0))!=-1&&(P=-1);break}case 34:case 39:case 91:N+=Gh(C);break;case 9:case 10:case 13:case 32:N+=Sw(A);break;case 92:N+=Aw(kd()-1,7);continue;case 47:switch(br()){case 42:case 47:ml(Cw(Iw(Si(),kd()),t,n,u),u);break;default:N+="/"}break;case 123*I:d[f++]=Oi(N)*P;case 125*I:case 59:case 0:switch(C){case 0:case 125:E=0;case 59+p:P==-1&&(N=$e(N,/\f/g,"")),v>0&&Oi(N)-m&&ml(v>32?Qy(N+";",i,n,m-1,u):Qy($e(N," ","")+";",i,n,m-2,u),u);break;case 59:N+=";";default:if(ml(D=Zy(N,t,n,f,p,s,d,w,O=[],M=[],m,a),a),C===123)if(p===0)Bd(N,t,D,D,O,a,m,d,M);else switch(S===99&&Ut(N,3)===110?100:S){case 100:case 108:case 109:case 115:Bd(e,D,D,i&&ml(Zy(e,D,D,0,0,s,d,w,s,O=[],m,M),M),s,M,m,d,i?O:M);break;default:Bd(N,D,D,D,[""],M,0,d,M)}}f=p=v=0,I=P=1,w=N="",m=l;break;case 58:m=1+Oi(N),v=A;default:if(I<1){if(C==123)--I;else if(C==125&&I++==0&&mw()==125)continue}switch(N+=ig(C),C*I){case 38:P=p>0?1:(N+="\f",-1);break;case 44:d[f++]=(Oi(N)-1)*P,P=1;break;case 64:br()===45&&(N+=Gh(Si())),S=br(),p=m=Oi(w=N+=Tw(kd())),C++;break;case 45:A===45&&Oi(N)==2&&(I=0)}}return a}function Zy(e,t,n,i,s,a,l,d,u,f,p,m){for(var S=s-1,v=s===0?a:[""],A=YS(v),I=0,E=0,P=0;I<i;++I)for(var C=0,w=Zs(e,S+1,S=$S(E=l[I])),O=e;C<A;++C)(O=WS(E>0?v[C]+" "+w:$e(w,/&\f/g,v[C])))&&(u[P++]=O);return yu(e,t,n,s===0?gu:d,u,f,p,m)}function Cw(e,t,n,i){return yu(e,t,n,GS,ig(gw()),Zs(e,2,-2),0,i)}function Qy(e,t,n,i,s){return yu(e,t,n,ng,Zs(e,0,i),Zs(e,i+1,-1),i,s)}function jS(e,t,n){switch(hw(e,t)){case 5103:return Je+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Je+e+e;case 4789:return El+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Je+e+El+e+dt+e+e;case 5936:switch(Ut(e,t+11)){case 114:return Je+e+dt+$e(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Je+e+dt+$e(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Je+e+dt+$e(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Je+e+dt+e+e;case 6165:return Je+e+dt+"flex-"+e+e;case 5187:return Je+e+$e(e,/(\w+).+(:[^]+)/,Je+"box-$1$2"+dt+"flex-$1$2")+e;case 5443:return Je+e+dt+"flex-item-"+$e(e,/flex-|-self/g,"")+(qi(e,/flex-|baseline/)?"":dt+"grid-row-"+$e(e,/flex-|-self/g,""))+e;case 4675:return Je+e+dt+"flex-line-pack"+$e(e,/align-content|flex-|-self/g,"")+e;case 5548:return Je+e+dt+$e(e,"shrink","negative")+e;case 5292:return Je+e+dt+$e(e,"basis","preferred-size")+e;case 6060:return Je+"box-"+$e(e,"-grow","")+Je+e+dt+$e(e,"grow","positive")+e;case 4554:return Je+$e(e,/([^-])(transform)/g,"$1"+Je+"$2")+e;case 6187:return $e($e($e(e,/(zoom-|grab)/,Je+"$1"),/(image-set)/,Je+"$1"),e,"")+e;case 5495:case 3959:return $e(e,/(image-set\([^]*)/,Je+"$1$`$1");case 4968:return $e($e(e,/(.+:)(flex-)?(.*)/,Je+"box-pack:$3"+dt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Je+e+e;case 4200:if(!qi(e,/flex-|baseline/))return dt+"grid-column-align"+Zs(e,t)+e;break;case 2592:case 3360:return dt+$e(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(i,s){return t=s,qi(i.props,/grid-\w+-end/)})?~Od(e+(n=n[t].value),"span",0)?e:dt+$e(e,"-start","")+e+dt+"grid-row-span:"+(~Od(n,"span",0)?qi(n,/\d+/):+qi(n,/\d+/)-+qi(e,/\d+/))+";":dt+$e(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(i){return qi(i.props,/grid-\w+-start/)})?e:dt+$e($e(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return $e(e,/(.+)-inline(.+)/,Je+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Oi(e)-1-t>6)switch(Ut(e,t+1)){case 109:if(Ut(e,t+4)!==45)break;case 102:return $e(e,/(.+:)(.+)-([^]+)/,"$1"+Je+"$2-$3$1"+El+(Ut(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Od(e,"stretch",0)?jS($e(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return $e(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,s,a,l,d,u,f){return dt+s+":"+a+f+(l?dt+s+"-span:"+(d?u:+u-+a)+f:"")+e});case 4949:if(Ut(e,t+6)===121)return $e(e,":",":"+Je)+e;break;case 6444:switch(Ut(e,Ut(e,14)===45?18:11)){case 120:return $e(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Je+(Ut(e,14)===45?"inline-":"")+"box$3$1"+Je+"$2$3$1"+dt+"$2box$3")+e;case 100:return $e(e,":",":"+dt)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return $e(e,"scroll-","scroll-snap-")+e}return e}function zd(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function ww(e,t,n,i){switch(e.type){case fw:if(e.children.length)break;case uw:case ng:return e.return=e.return||e.value;case GS:return"";case xS:return e.return=e.value+"{"+zd(e.children,i)+"}";case gu:if(!Oi(e.value=e.props.join(",")))return""}return Oi(n=zd(e.children,i))?e.return=e.value+"{"+n+"}":""}function _w(e){var t=YS(e);return function(n,i,s,a){for(var l="",d=0;d<t;d++)l+=e[d](n,i,s,a)||"";return l}}function Rw(e){return function(t){t.root||(t=t.return)&&e(t)}}function Pw(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case ng:e.return=jS(e.value,e.length,n);return;case xS:return zd([Ho(e,{value:$e(e.value,"@","@"+Je)})],i);case gu:if(e.length)return pw(n=e.props,function(s){switch(qi(s,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Ts(Ho(e,{props:[$e(s,/:(read-\w+)/,":"+El+"$1")]})),Ts(Ho(e,{props:[s]})),Sp(e,{props:qy(n,i)});break;case"::placeholder":Ts(Ho(e,{props:[$e(s,/:(plac\w+)/,":"+Je+"input-$1")]})),Ts(Ho(e,{props:[$e(s,/:(plac\w+)/,":"+El+"$1")]})),Ts(Ho(e,{props:[$e(s,/:(plac\w+)/,dt+"input-$1")]})),Ts(Ho(e,{props:[s]})),Sp(e,{props:qy(n,i)});break}return""})}}var Dw={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Un={},Js=typeof process<"u"&&Un!==void 0&&(Un.REACT_APP_SC_ATTR||Un.SC_ATTR)||"data-styled",XS="active",VS="data-styled-version",Su="6.1.13",og=`/*!sc*/
`,jd=typeof window<"u"&&"HTMLElement"in window,Mw=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Un!==void 0&&Un.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Un.REACT_APP_SC_DISABLE_SPEEDY!==""?Un.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Un.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Un!==void 0&&Un.SC_DISABLE_SPEEDY!==void 0&&Un.SC_DISABLE_SPEEDY!==""&&Un.SC_DISABLE_SPEEDY!=="false"&&Un.SC_DISABLE_SPEEDY),Nw={},Au=Object.freeze([]),ea=Object.freeze({});function KS(e,t,n){return n===void 0&&(n=ea),e.theme!==n.theme&&e.theme||t||n.theme}var qS=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),bw=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Ow=/(^-|-$)/g;function Jy(e){return e.replace(bw,"-").replace(Ow,"")}var kw=/(a)(d)/gi,hd=52,ev=function(e){return String.fromCharCode(e+(e>25?39:97))};function Tp(e){var t,n="";for(t=Math.abs(e);t>hd;t=t/hd|0)n=ev(t%hd)+n;return(ev(t%hd)+n).replace(kw,"$1-$2")}var xh,ZS=5381,Fs=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},QS=function(e){return Fs(ZS,e)};function JS(e){return Tp(QS(e)>>>0)}function Bw(e){return e.displayName||e.name||"Component"}function $h(e){return typeof e=="string"&&!0}var eA=typeof Symbol=="function"&&Symbol.for,tA=eA?Symbol.for("react.memo"):60115,Fw=eA?Symbol.for("react.forward_ref"):60112,Lw={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},Hw={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},nA={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},Uw=((xh={})[Fw]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},xh[tA]=nA,xh);function tv(e){return("type"in(t=e)&&t.type.$$typeof)===tA?nA:"$$typeof"in e?Uw[e.$$typeof]:Lw;var t}var Gw=Object.defineProperty,xw=Object.getOwnPropertyNames,nv=Object.getOwnPropertySymbols,$w=Object.getOwnPropertyDescriptor,Ww=Object.getPrototypeOf,iv=Object.prototype;function iA(e,t,n){if(typeof t!="string"){if(iv){var i=Ww(t);i&&i!==iv&&iA(e,i,n)}var s=xw(t);nv&&(s=s.concat(nv(t)));for(var a=tv(e),l=tv(t),d=0;d<s.length;++d){var u=s[d];if(!(u in Hw||n&&n[u]||l&&u in l||a&&u in a)){var f=$w(t,u);try{Gw(e,u,f)}catch{}}}}return e}function ta(e){return typeof e=="function"}function rg(e){return typeof e=="object"&&"styledComponentId"in e}function Mr(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function Ep(e,t){if(e.length===0)return"";for(var n=e[0],i=1;i<e.length;i++)n+=e[i];return n}function Bl(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function Cp(e,t,n){if(n===void 0&&(n=!1),!n&&!Bl(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)e[i]=Cp(e[i],t[i]);else if(Bl(t))for(var i in t)e[i]=Cp(e[i],t[i]);return e}function sg(e,t){Object.defineProperty(e,"toString",{value:t})}function Vl(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var Yw=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,i=0;i<t;i++)n+=this.groupSizes[i];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var i=this.groupSizes,s=i.length,a=s;t>=a;)if((a<<=1)<0)throw Vl(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(i),this.length=a;for(var l=s;l<a;l++)this.groupSizes[l]=0}for(var d=this.indexOfGroup(t+1),u=(l=0,n.length);l<u;l++)this.tag.insertRule(d,n[l])&&(this.groupSizes[t]++,d++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],i=this.indexOfGroup(t),s=i+n;this.groupSizes[t]=0;for(var a=i;a<s;a++)this.tag.deleteRule(i)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var i=this.groupSizes[t],s=this.indexOfGroup(t),a=s+i,l=s;l<a;l++)n+="".concat(this.tag.getRule(l)).concat(og);return n},e}(),Fd=new Map,Xd=new Map,Ld=1,pd=function(e){if(Fd.has(e))return Fd.get(e);for(;Xd.has(Ld);)Ld++;var t=Ld++;return Fd.set(e,t),Xd.set(t,e),t},zw=function(e,t){Ld=t+1,Fd.set(e,t),Xd.set(t,e)},jw="style[".concat(Js,"][").concat(VS,'="').concat(Su,'"]'),Xw=new RegExp("^".concat(Js,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),Vw=function(e,t,n){for(var i,s=n.split(","),a=0,l=s.length;a<l;a++)(i=s[a])&&e.registerName(t,i)},Kw=function(e,t){for(var n,i=((n=t.textContent)!==null&&n!==void 0?n:"").split(og),s=[],a=0,l=i.length;a<l;a++){var d=i[a].trim();if(d){var u=d.match(Xw);if(u){var f=0|parseInt(u[1],10),p=u[2];f!==0&&(zw(p,f),Vw(e,p,u[3]),e.getTag().insertRules(f,s)),s.length=0}else s.push(d)}}},ov=function(e){for(var t=document.querySelectorAll(jw),n=0,i=t.length;n<i;n++){var s=t[n];s&&s.getAttribute(Js)!==XS&&(Kw(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function qw(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var oA=function(e){var t=document.head,n=e||t,i=document.createElement("style"),s=function(d){var u=Array.from(d.querySelectorAll("style[".concat(Js,"]")));return u[u.length-1]}(n),a=s!==void 0?s.nextSibling:null;i.setAttribute(Js,XS),i.setAttribute(VS,Su);var l=qw();return l&&i.setAttribute("nonce",l),n.insertBefore(i,a),i},Zw=function(){function e(t){this.element=oA(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,s=0,a=i.length;s<a;s++){var l=i[s];if(l.ownerNode===n)return l}throw Vl(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),Qw=function(){function e(t){this.element=oA(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),Jw=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),rv=jd,e_={isServer:!jd,useCSSOMInjection:!Mw},Vd=function(){function e(t,n,i){t===void 0&&(t=ea),n===void 0&&(n={});var s=this;this.options=on(on({},e_),t),this.gs=n,this.names=new Map(i),this.server=!!t.isServer,!this.server&&jd&&rv&&(rv=!1,ov(this)),sg(this,function(){return function(a){for(var l=a.getTag(),d=l.length,u="",f=function(m){var S=function(P){return Xd.get(P)}(m);if(S===void 0)return"continue";var v=a.names.get(S),A=l.getGroup(m);if(v===void 0||!v.size||A.length===0)return"continue";var I="".concat(Js,".g").concat(m,'[id="').concat(S,'"]'),E="";v!==void 0&&v.forEach(function(P){P.length>0&&(E+="".concat(P,","))}),u+="".concat(A).concat(I,'{content:"').concat(E,'"}').concat(og)},p=0;p<d;p++)f(p);return u}(s)})}return e.registerId=function(t){return pd(t)},e.prototype.rehydrate=function(){!this.server&&jd&&ov(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(on(on({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var i=n.useCSSOMInjection,s=n.target;return n.isServer?new Jw(s):i?new Zw(s):new Qw(s)}(this.options),new Yw(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(pd(t),this.names.has(t))this.names.get(t).add(n);else{var i=new Set;i.add(n),this.names.set(t,i)}},e.prototype.insertRules=function(t,n,i){this.registerName(t,n),this.getTag().insertRules(pd(t),i)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(pd(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),t_=/&/g,n_=/^\s*\/\/.*$/gm;function rA(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(i){return"".concat(t," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=rA(n.children,t)),n})}function i_(e){var t,n,i,s=ea,a=s.options,l=a===void 0?ea:a,d=s.plugins,u=d===void 0?Au:d,f=function(S,v,A){return A.startsWith(n)&&A.endsWith(n)&&A.replaceAll(n,"").length>0?".".concat(t):S},p=u.slice();p.push(function(S){S.type===gu&&S.value.includes("&")&&(S.props[0]=S.props[0].replace(t_,n).replace(i,f))}),l.prefix&&p.push(Pw),p.push(ww);var m=function(S,v,A,I){v===void 0&&(v=""),A===void 0&&(A=""),I===void 0&&(I="&"),t=I,n=v,i=new RegExp("\\".concat(n,"\\b"),"g");var E=S.replace(n_,""),P=Ew(A||v?"".concat(A," ").concat(v," { ").concat(E," }"):E);l.namespace&&(P=rA(P,l.namespace));var C=[];return zd(P,_w(p.concat(Rw(function(w){return C.push(w)})))),C};return m.hash=u.length?u.reduce(function(S,v){return v.name||Vl(15),Fs(S,v.name)},ZS).toString():"",m}var o_=new Vd,wp=i_(),sA=ki.createContext({shouldForwardProp:void 0,styleSheet:o_,stylis:wp});sA.Consumer;ki.createContext(void 0);function _p(){return ke.useContext(sA)}var r_=function(){function e(t,n){var i=this;this.inject=function(s,a){a===void 0&&(a=wp);var l=i.name+a.hash;s.hasNameForId(i.id,l)||s.insertRules(i.id,l,a(i.rules,l,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,sg(this,function(){throw Vl(12,String(i.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=wp),this.name+t.hash},e}(),s_=function(e){return e>="A"&&e<="Z"};function sv(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(n===1&&i==="-"&&e[0]==="-")return e;s_(i)?t+="-"+i.toLowerCase():t+=i}return t.startsWith("ms-")?"-"+t:t}var aA=function(e){return e==null||e===!1||e===""},lA=function(e){var t,n,i=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!aA(a)&&(Array.isArray(a)&&a.isCss||ta(a)?i.push("".concat(sv(s),":"),a,";"):Bl(a)?i.push.apply(i,kl(kl(["".concat(s," {")],lA(a),!1),["}"],!1)):i.push("".concat(sv(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in Dw||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function jo(e,t,n,i){if(aA(e))return[];if(rg(e))return[".".concat(e.styledComponentId)];if(ta(e)){if(!ta(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return jo(s,t,n,i)}var a;return e instanceof r_?n?(e.inject(n,i),[e.getName(i)]):[e]:Bl(e)?lA(e):Array.isArray(e)?Array.prototype.concat.apply(Au,e.map(function(l){return jo(l,t,n,i)})):[e.toString()]}function cA(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(ta(n)&&!rg(n))return!1}return!0}var a_=QS(Su),l_=function(){function e(t,n,i){this.rules=t,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&cA(t),this.componentId=n,this.baseHash=Fs(a_,n),this.baseStyle=i,Vd.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,i){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=Mr(s,this.staticRulesId);else{var a=Ep(jo(this.rules,t,n,i)),l=Tp(Fs(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,l)){var d=i(a,".".concat(l),void 0,this.componentId);n.insertRules(this.componentId,l,d)}s=Mr(s,l),this.staticRulesId=l}else{for(var u=Fs(this.baseHash,i.hash),f="",p=0;p<this.rules.length;p++){var m=this.rules[p];if(typeof m=="string")f+=m;else if(m){var S=Ep(jo(m,t,n,i));u=Fs(u,S+p),f+=S}}if(f){var v=Tp(u>>>0);n.hasNameForId(this.componentId,v)||n.insertRules(this.componentId,v,i(f,".".concat(v),void 0,this.componentId)),s=Mr(s,v)}}return s},e}(),ag=ki.createContext(void 0);ag.Consumer;var Wh={};function c_(e,t,n){var i=rg(e),s=e,a=!$h(e),l=t.attrs,d=l===void 0?Au:l,u=t.componentId,f=u===void 0?function(O,M){var D=typeof O!="string"?"sc":Jy(O);Wh[D]=(Wh[D]||0)+1;var N="".concat(D,"-").concat(JS(Su+D+Wh[D]));return M?"".concat(M,"-").concat(N):N}(t.displayName,t.parentComponentId):u,p=t.displayName,m=p===void 0?function(O){return $h(O)?"styled.".concat(O):"Styled(".concat(Bw(O),")")}(e):p,S=t.displayName&&t.componentId?"".concat(Jy(t.displayName),"-").concat(t.componentId):t.componentId||f,v=i&&s.attrs?s.attrs.concat(d).filter(Boolean):d,A=t.shouldForwardProp;if(i&&s.shouldForwardProp){var I=s.shouldForwardProp;if(t.shouldForwardProp){var E=t.shouldForwardProp;A=function(O,M){return I(O,M)&&E(O,M)}}else A=I}var P=new l_(n,S,i?s.componentStyle:void 0);function C(O,M){return function(D,N,k){var U=D.attrs,z=D.componentStyle,K=D.defaultProps,X=D.foldedComponentIds,J=D.styledComponentId,q=D.target,re=ki.useContext(ag),se=_p(),ie=D.shouldForwardProp||se.shouldForwardProp,Y=KS(N,re,K)||ea,Z=function(Me,he,Te){for(var _e,ce=on(on({},he),{className:void 0,theme:Te}),ve=0;ve<Me.length;ve+=1){var Ge=ta(_e=Me[ve])?_e(ce):_e;for(var Pe in Ge)ce[Pe]=Pe==="className"?Mr(ce[Pe],Ge[Pe]):Pe==="style"?on(on({},ce[Pe]),Ge[Pe]):Ge[Pe]}return he.className&&(ce.className=Mr(ce.className,he.className)),ce}(U,N,Y),Q=Z.as||q,B={};for(var j in Z)Z[j]===void 0||j[0]==="$"||j==="as"||j==="theme"&&Z.theme===Y||(j==="forwardedAs"?B.as=Z.forwardedAs:ie&&!ie(j,Q)||(B[j]=Z[j]));var fe=function(Me,he){var Te=_p(),_e=Me.generateAndInjectStyles(he,Te.styleSheet,Te.stylis);return _e}(z,Z),pe=Mr(X,J);return fe&&(pe+=" "+fe),Z.className&&(pe+=" "+Z.className),B[$h(Q)&&!qS.has(Q)?"class":"className"]=pe,B.ref=k,ke.createElement(Q,B)}(w,O,M)}C.displayName=m;var w=ki.forwardRef(C);return w.attrs=v,w.componentStyle=P,w.displayName=m,w.shouldForwardProp=A,w.foldedComponentIds=i?Mr(s.foldedComponentIds,s.styledComponentId):"",w.styledComponentId=S,w.target=i?s.target:e,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(O){this._foldedDefaultProps=i?function(M){for(var D=[],N=1;N<arguments.length;N++)D[N-1]=arguments[N];for(var k=0,U=D;k<U.length;k++)Cp(M,U[k],!0);return M}({},s.defaultProps,O):O}}),sg(w,function(){return".".concat(w.styledComponentId)}),a&&iA(w,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function av(e,t){for(var n=[e[0]],i=0,s=t.length;i<s;i+=1)n.push(t[i],e[i+1]);return n}var lv=function(e){return Object.assign(e,{isCss:!0})};function dA(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(ta(e)||Bl(e))return lv(jo(av(Au,kl([e],t,!0))));var i=e;return t.length===0&&i.length===1&&typeof i[0]=="string"?jo(i):lv(jo(av(i,t)))}function Rp(e,t,n){if(n===void 0&&(n=ea),!t)throw Vl(1,t);var i=function(s){for(var a=[],l=1;l<arguments.length;l++)a[l-1]=arguments[l];return e(t,n,dA.apply(void 0,kl([s],a,!1)))};return i.attrs=function(s){return Rp(e,t,on(on({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},i.withConfig=function(s){return Rp(e,t,on(on({},n),s))},i}var uA=function(e){return Rp(c_,e)},kt=uA;qS.forEach(function(e){kt[e]=uA(e)});var d_=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=cA(t),Vd.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,i,s){var a=s(Ep(jo(this.rules,n,i,s)),""),l=this.componentId+t;i.insertRules(l,l,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,i,s){t>2&&Vd.registerId(this.componentId+t),this.removeStyles(t,i),this.createStyles(t,n,i,s)},e}();function u_(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=dA.apply(void 0,kl([e],t,!1)),s="sc-global-".concat(JS(JSON.stringify(i))),a=new d_(i,s),l=function(u){var f=_p(),p=ki.useContext(ag),m=ki.useRef(f.styleSheet.allocateGSInstance(s)).current;return f.styleSheet.server&&d(m,u,f.styleSheet,p,f.stylis),ki.useLayoutEffect(function(){if(!f.styleSheet.server)return d(m,u,f.styleSheet,p,f.stylis),function(){return a.removeStyles(m,f.styleSheet)}},[m,u,f.styleSheet,p,f.stylis]),null};function d(u,f,p,m,S){if(a.isStatic)a.renderStyles(u,Nw,p,S);else{var v=on(on({},f),{theme:KS(f,m,l.defaultProps)});a.renderStyles(u,v,p,S)}}return ki.memo(l)}function fA(e,t){var n=ke.useRef(null),i=ke.useRef(!1),s=ke.useRef(e);s.current=e;var a=ke.useCallback(function(d){i.current&&(s.current(d),n.current=requestAnimationFrame(a))},[]),l=ke.useMemo(function(){return[function(){i.current&&(i.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){i.current||(i.current=!0,n.current=requestAnimationFrame(a))},function(){return i.current}]},[]);return ke.useEffect(function(){return l[0]},[]),l}function f_(e,t,n,i,s){var l;(l=e.onExit)==null||l.call(e,i,t);const a=s.find(({id:d})=>d===t);return a!=null&&a.onEnter?a.onEnter(i,n):{...n,enteredAt:i.updateContext.gameState.time}}function h_(e,t){return t.find(({id:n})=>n===e)}function p_(e,t){return e!==t}function g_(e){e&&console.warn(`No handler found for state: ${e}`)}const Cl="bushGrowing",Dr="bushFull",Hd="bushSpreading",Fl="bushDying",Ot=24,Gt=10,Ze=4e3,Qe=4e3,Kd=5,m_=15,y_=5e3,io=100,oo=20,ro=60,hA=200,v_=1e3,S_=5,A_=3,I_=12,T_=940,Pp=20,cv=90,pA=100,uo=5,E_=.5,qo=30,so=.1,yl=.9,C_=2,w_=2;var An=(e=>(e.Berry="berry",e.Meat="meat",e))(An||{});const lg={berry:"",meat:""};function gA(e,t){return e+t*65536}function mA(e){return{gridX:e%65536,gridY:Math.floor(e/65536)}}function __(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function yA(){return{lastUpdateTime:0,sectors:{}}}const jt=20,qd=100,vA=20,SA=0,R_=20,P_=1,AA=.15,D_=.5,M_=.01,N_=24,b_="#6B5344",O_="#4A3728",dv=.85,IA=35,k_=30,uv=1.25,fv=40,Yh=Math.PI/6,TA=.5,B_=1,Iu=10,Ll=80,EA=3,nl=5,rn=150,cg=rn*.8,F_=rn*.2,sn=rn*.8,Zo=30,CA=10,L_=10,H_=.5,ze=30,xr=ze*.75,Tu=30,Kl=Tu*.75,wA=50,U_=20,G_=Ll*.8,x_=.7,Hl=16,Eu=40,$_=24,dg=16,W_=72/3,hv=24,Y_=1.25,z_=1.5,na=rn*.6,Cu=50,j_=1,X_=350,ug=Ll*.65,V_=80,K_=50,q_=1,Z_=128,_A=10,pv=100,fg=35,fo=30,wu=.5,_u=2.5,hg=20,yn=250,pg=.4,gg=150,mg=6,Q_=5,yg=2,Ru=.5,Pu=1.5,J_=1,eR=.5,tR=.5,nR=1.5,iR=.25,oR=2.5,rR=45,sR=.05,aR=200;var ut=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(ut||{}),je=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e[e.SupplyChain=5]="SupplyChain",e))(je||{}),$r=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))($r||{});const Zd=24,lR=24;let cR=0;function dR(){return`notification-${Date.now()}-${cR++}`}function Ul(e,t){if(t.identifier){const i=e.notifications.find(s=>s.identifier===t.identifier);if(i){if(i.dismissedUntil&&e.time<i.dismissedUntil)return;i.message=t.message,i.timestamp=e.time,i.creationTime=Date.now(),i.duration=t.duration,i.targetEntityIds=t.targetEntityIds,i.highlightedEntityIds=t.highlightedEntityIds,i.targetPosition=t.targetPosition,i.targetArea=t.targetArea,i.targetRadius=t.targetRadius,i.isDismissed=!1,i.dismissedUntil=void 0;return}}const n={...t,id:dR(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function uR(e,t){const n=e.notifications.find(i=>i.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+lR))}function fR(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function hR(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const i of n.highlightedEntityIds){const s=e.entities.entities[i];s&&(s.isHighlighted=!0)}}function vg(e,t,n,i){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,l={x:Math.cos(s)*a,y:Math.sin(s)*a},d=ri(e,l);return{x:(d.x%n+n)%n,y:(d.y%i+i)%i}}function zn(e,t,n,i){const s=t,{width:a,height:l}=t.mapDimensions,d={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},u=f=>{for(let p=0;p<f.length;p++){const m=f[p];if(i!==void 0&&m.id===i)continue;const S=Dn(e,m.position,a,l),v=n+m.radius;if(S<v*v)return!0}return!1};return u(s.search.human.byRect(d))||u(s.search.berryBush.byRect(d))||u(s.search.corpse.byRect(d))}function pR(e,t,n,i,s){const a=t.mapDimensions.width,l=t.mapDimensions.height;if(!zn(e,t,i,s)&&!Bi(t.soilDepletion,e,a,l))return e;const d=i;for(let u=d;u<=n;u+=d){const f=Math.ceil(2*Math.PI*u/d);for(let p=0;p<f;p++){const m=p/f*2*Math.PI,S={x:Math.cos(m)*u,y:Math.sin(m)*u},v=ri(e,S),A={x:(v.x%a+a)%a,y:(v.y%l+l)%l};if(!zn(A,t,i,s)&&!Bi(t.soilDepletion,A,a,l))return A}}return null}function vn(e,t){var l,d;const n=t;if((d=(l=n.cache)==null?void 0:l.tribeCenters)!=null&&d[e])return n.cache.tribeCenters[e];const i=t.search.building.byProperty("ownerId",e);if(i.length>0){const u=i.map(f=>f.position);return n.cache.tribeCenters[e]=Yd(u)}const s=li(e,t);if(s.length===0){const u=t.entities.entities[e];return n.cache.tribeCenters[e]=u?u.position:{x:0,y:0}}const a=s.map(u=>u.position);return n.cache.tribeCenters[e]=Yd(a)}function gv(e,t){const i=[...xl(e,t),e].map(s=>s.position);return Yd(i)}function Dp(e,t,n){const i=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,l=e.y-t.position.y;return Math.abs(a)>i/2&&(a-=Math.sign(a)*i),Math.abs(l)>s/2&&(l-=Math.sign(l)*s),Math.abs(a)<=t.width/2&&Math.abs(l)<=t.height/2}const ia=80,mn=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],me=20,Li=(e,t,n)=>{var d,u,f,p;if(!e||!t||e===t)return!1;const i=n.entities.entities[e],s=n.entities.entities[t],a=(u=(d=i==null?void 0:i.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[t],l=(p=(f=s==null?void 0:s.tribeControl)==null?void 0:f.diplomacy)==null?void 0:p[e];return a===ut.Hostile||l===ut.Hostile},Xr=(e,t,n)=>e.id===t.id?!1:Li(e.leaderId,t.leaderId,n),Xt=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:Li(e.leaderId,t.ownerId,n),ir=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=sn||t.hunger>=sn||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||Xr(e,t,n))return!1;const i=e.gender==="female"?e:t;return!(i.isPregnant||i.age>Eu)},Qd=1,oa=150*.6,mv=150*.25,gR=150*.7,mR=150*.8,yR=400,RA=800,vR=150,SR=300,AR=2,yv=800,IR=500,TR=150*.85,ER=150,PA=3,CR=24,DA=600,wR=1,_R=1,RR=.5,PR=1,DR=.5,MR=2,Ns=24,Ls=12,Mp=24,MA=1.5,NR=150,bR=200,OR=100,kR=.7,BR=300,FR=400,zh=600,LR=600,Jd=.15,Np=200,js=30*.75*1.2,NA=20,bA=.3,OA=.6,kA=.8,HR=1,UR=3,GR=5,xR=6,vv=.5,$R=.4,WR=.6,YR=.8,zR=2,Qi=800,Sv=2,bp=.7,Op=.5,Hs=10,jR=.5,Xs=400,BA=800,XR=8,VR=16,FA=5,LA=600,Ji=100,KR=100,HA=150,Av=600,Iv=250,qR=.5,ZR=.7,QR=300,JR=150;function UA(e){const t=Math.floor(e.x/me),n=Math.floor(e.y/me);return{x:t,y:n}}function kp(e,t){const n=Math.ceil(t/me),i=e%n*me+me/2,s=Math.floor(e/n)*me+me/2;return{x:i,y:s}}function e1(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(i/me),l=Math.floor(s/me),d=Math.ceil(t/me);return l*d+a}function $n(e,t,n){const i=e1({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[i]||null}function Sg(e,t){return t.terrainOwnership.includes(e)}function GA(e,t,n,i){var l;const s=n;return(l=s.search)!=null&&l.human?s.search.human.byRadius(e,i).some(d=>Li(t,d.leaderId,n)):!1}function t1(e,t,n,i,s=!1,a){if(s&&a&&GA(e,a,i,HA))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:l,height:d}=i.mapDimensions,u=Math.ceil(l/me),f=Math.ceil(d/me),p=Math.ceil(t/me),m=t*t,S=Math.floor(e.x/me),v=Math.floor(e.y/me);let A=!1,I=!1;for(let E=-p;E<=p;E++)for(let P=-p;P<=p;P++){const C=((S+P)%u+u)%u,w=((v+E)%f+f)%f,O=C*me+me/2,M=w*me+me/2;if(Dn(e,{x:O,y:M},l,d)<=m){const N=w*u+C,k=i.terrainOwnership[N];if(k===n)A=!0;else if(k!==null){if(s&&a&&Li(a,k,i))continue;I=!0}}}return I?{valid:!1,reason:"Position overlaps with another tribe's territory"}:A?{valid:!0}:Sg(n,i)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function xA(e,t,n,i){if(!Sg(n,i))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(GA(e,n,i,HA))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=i.mapDimensions,l=Math.ceil(s/me),d=Math.ceil(a/me),u=Math.ceil(t/me),f=t*t,p=Math.floor(e.x/me),m=Math.floor(e.y/me);let S=!1;for(let v=-u;v<=u;v++){for(let A=-u;A<=u;A++){const I=((p+A)%l+l)%l,E=((m+v)%d+d)%d,P=I*me+me/2,C=E*me+me/2;if(Dn(e,{x:P,y:C},s,a)<=f){const O=E*l+I;if(i.terrainOwnership[O]===n){S=!0;break}}}if(S)break}return S?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function $A(e,t,n,i=0,s=!1,a){if(i>0){const d=t1(e,i,t,n,s,a);return d.valid?{canPlace:!0}:{canPlace:!1,reason:d.reason}}const l=$n(e.x,e.y,n);return l===null||l===t?{canPlace:!0}:s&&a&&Li(a,l,n)?{canPlace:!0}:l!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function Bp(e,t,n){const i=$n(e.x,e.y,n);return i===null||i===t}function Wn(e,t,n){const i=$n(e.x,e.y,n);return i===null||i===t||!Li(t,i,n)}function n1(e,t,n,i){if(Bp(t,n,i))return t;const{width:s,height:a}=i.mapDimensions,l=Xe(e,t,s,a),d=Math.sqrt(l.x**2+l.y**2);if(d===0)return e;let u=e;const f=G(e,t,s,a),p=f/10;for(let m=p;m<=f;m+=p){const S={x:((e.x+l.x*m/d)%s+s)%s,y:((e.y+l.y*m/d)%a+a)%a};if(Bp(S,n,i))u=S;else break}return u}function WA(e,t,n,i,{allowOverwrite:s}){const{width:a,height:l}=i.mapDimensions,d=Math.ceil(a/me),u=Math.ceil(l/me),f=Math.ceil(t/me),p=Math.floor(e.x/me),m=Math.floor(e.y/me);for(let C=-f;C<=f;C++)for(let w=-f;w<=f;w++){const O=((p+w)%d+d)%d,M=((m+C)%u+u)%u,D=O*me+me/2,N=M*me+me/2;if(G(e,{x:D,y:N},a,l)<=t){const U=M*d+O,z=i.terrainOwnership[U];(s||z===null||z===n)&&(i.terrainOwnership[U]=n)}}const S=3,v=f+S+2,A=[];for(let C=-v;C<=v;C++)for(let w=-v;w<=v;w++){const O=((p+w)%d+d)%d,M=((m+C)%u+u)%u,D=M*d+O;if(i.terrainOwnership[D]===null){let N=!1;const k=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const U of k){let z=!1,K=!1;for(let X=1;X<=S;X++){const J=((O+U.x*X)%d+d)%d,re=((M+U.y*X)%u+u)%u*d+J;if(i.terrainOwnership[re]===n){z=!0;break}}if(z)for(let X=1;X<=S;X++){const J=((O-U.x*X)%d+d)%d,re=((M-U.y*X)%u+u)%u*d+J;if(i.terrainOwnership[re]===n){K=!0;break}}if(z&&K){N=!0;break}}N&&A.push(D)}}for(const C of A)i.terrainOwnership[C]=n;const I=250,E=new Set;for(let C=-v;C<=v;C++)for(let w=-v;w<=v;w++){const O=((p+w)%d+d)%d,D=((m+C)%u+u)%u*d+O;if(i.terrainOwnership[D]===null&&!E.has(D)){const N=[],k=[D];E.add(D),N.push(D);let U=!0,z=0;for(;z<k.length;){const K=k[z++];if(N.length>I){U=!1;break}const X=K%d,J=Math.floor(K/d),q=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:re,ny:se}of q){const ie=((X+re)%d+d)%d,Z=((J+se)%u+u)%u*d+ie;i.terrainOwnership[Z]===null&&!E.has(Z)&&(E.add(Z),U&&(N.push(Z),k.push(Z)))}}if(U&&N.length<=I)for(const K of N)i.terrainOwnership[K]=n}}const P=[];for(let C=-v;C<=v;C++)for(let w=-v;w<=v;w++){const O=((p+w)%d+d)%d,M=((m+C)%u+u)%u,D=M*d+O;if(i.terrainOwnership[D]===null){let N=0;for(let k=-1;k<=1;k++)for(let U=-1;U<=1;U++){if(U===0&&k===0)continue;const z=((O+U)%d+d)%d,X=((M+k)%u+u)%u*d+z;i.terrainOwnership[X]===n&&N++}N>=5&&P.push(D)}}for(const C of P)i.terrainOwnership[C]=n}function YA(e,t,n,i){WA(e,t,n,i,{allowOverwrite:!1})}function zA(e,t,n,i){WA(e,t,n,i,{allowOverwrite:!0})}function i1(e,t,n){const{width:i,height:s}=n.mapDimensions,a=Math.ceil(i/me),l=Math.ceil(s/me),d=Math.floor(e.x/me),u=Math.floor(e.y/me),f=50;for(let p=0;p<=f;p++){const m=-p,S=p,v=-p,A=p;for(let I=v;I<=A;I++)for(let E=m;E<=S;E++){if(p>0&&E>m&&E<S&&I>v&&I<A)continue;const P=((d+E)%a+a)%a,C=((u+I)%l+l)%l,w=C*a+P;if(n.terrainOwnership[w]===t){let O=!1;const M=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:D,ny:N}of M){const k=((P+D)%a+a)%a,z=((C+N)%l+l)%l*a+k;if(n.terrainOwnership[z]!==t){O=!0;break}}if(O)return{x:P*me+me/2,y:C*me+me/2}}}}return null}function eu(e,t,n){const i=e.terrainOwnership;for(let s=0;s<i.length;s++)i[s]===t&&(i[s]=n)}function xe(e,t,n,i,s){const a=t,l=i,d="position"in e&&e.id?e:null,u=d?d.position:e,f=a.search[n].byRadius(u,l);let p=null,m=l;for(const S of f){if(S.id===(d==null?void 0:d.id)||s&&!s(S))continue;const v=G(u,S.position,t.mapDimensions.width,t.mapDimensions.height);v<m&&(m=v,p=S)}return p}function o1(e,t,n,i){return t.search[n].byRadius(e,i)}function Tv(e,t,n,i){return o1(e,t,n,i).length}function Tt(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function jA(e,t){var l;const i=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const d of i){if(d.attackTargetId!==e)continue;const u=G(d.position,((l=t.entities.entities[e])==null?void 0:l.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<a&&(s=d,a=u)}return s}function XA(e){return e.search.human.all()}function r1(e,t,n){const{width:i,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const l of a){const d=G(e,l.position,i,s),u=l.type==="tree"?l.radius*2:l.radius;if(d<u)return l}}function s1(e,t,n,i,s){const{width:a,height:l}=i.mapDimensions,d=n*n;if(s){for(let S=0;S<s.length;S++)if(Dn(e,s[S],a,l)<d)return!0;return!1}const u=XA(i),f=new Set;for(let S=0;S<u.length;S++){const v=u[S];v.leaderId&&v.leaderId!==t&&f.add(v.leaderId)}const p=f.values();let m=p.next();for(;!m.done;){const S=m.value,v=vn(S,i);if(Dn(e,v,a,l)<d)return!0;m=p.next()}return!1}var Ie=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(Ie||{});function Ue(e,t,n,i,s,a,l){const d={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:i,entityId:s,targetPosition:a,targetEntityId:l};return e.visualEffects.push(d),e.nextVisualEffectId++,d.id}const Ke=1,Gl=3,to=100,VA=20,lo=10,a1=.5,Or=150,l1=25,c1=.5,kr=100,KA=25,Ag=.5,qA=15,tu=4,d1=.75,u1=15,Fp=8,ZA=20,f1=.5;function ra(e,t,n,i,s,a){if(n===void 0)return!1;const{width:l,height:d}=i.mapDimensions;if(s&&a!==void 0&&Dn(s,e,l,d)>a*a)return!1;const u=Jp(t),f=Math.sqrt(u.width*u.width+u.height*u.height)/2;if(zn(e,i,f*.8))return!1;if(t===ue.PlantingZone){const{depletedSectors:I}=CI(i.soilDepletion,e,u.width,u.height,l,d);if(I.length>0)return!1}const m=i.search.building.byRadius(e,f*2);for(const I of m){const E=Dn(e,I.position,l,d),P=(Math.max(u.width,u.height)+Math.max(I.width,I.height))/2;if(E<P*P*.81)return!1}const S=t===ue.BorderPost;return!!$A(e,n,i,S?Qp:ia,S,n).canPlace}function h1(e){const t=[],n=2*Math.PI/e;for(let i=0;i<e;i++){const s=i*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function Vs(e,t,n,i,s,a,l){const d=performance.now(),u=n,f=Jp(e),p=n.mapDimensions.width,m=n.mapDimensions.height,S=u.search.building.byProperty("ownerId",t),v=[];if(S.length>0){a&&v.unshift(a);const C=vn(t,n),w=[...S].sort((O,M)=>{const D=Dn(O.position,C,p,m),N=Dn(M.position,C,p,m);return D-N});v.push(...w.map(O=>O.position))}else v.push(vn(t,n));const A=Math.min(v.length,XR),I=Math.max(f.width,f.height),E=I+20,P=I/2;for(let C=0;C<A;C++){const w=v[C];for(let O=E;O<=i;O+=P){const M=Math.max(8,Math.min(VR,Math.ceil(2*Math.PI*O/I))),D=h1(M);for(let N=0;N<M;N++){const k=D[N].cos*O,U=D[N].sin*O,z=w.x+k,K=w.y+U,X=(z%p+p)%p,J=(K%m+m)%m;if(!s1({x:X,y:J},t,s,n,l)&&ra({x:X,y:J},e,t,n))return performance.now()-d,{x:X,y:J}}}}performance.now()-d}function Xo(e,t,n,i){if(t===ue.BorderPost)return zA(e,Qp,n,i),Ue(i,Ie.BorderClaim,e,Ke,n),null;const s=QO(i.entities,e,t,n);return t===ue.Bonfire&&(s.storageCapacity=tu,s.storedItems=[]),YA(e,ia,n,i),t===ue.PlantingZone&&Ol(i),s}function Lp(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===ue.PlantingZone&&Ol(t))}function p1(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let l=e.x-a.position.x,d=e.y-a.position.y;const u=t.mapDimensions.width,f=t.mapDimensions.height;if(Math.abs(l)>u/2&&(l-=Math.sign(l)*u),Math.abs(d)>f/2&&(d-=Math.sign(d)*f),Math.abs(l)<=a.width/2&&Math.abs(d)<=a.height/2)return a}}var ae=(e=>(e.Leader="leader",e.Gatherer="gatherer",e.Planter="planter",e.Hunter="hunter",e.Mover="mover",e.Warrior="warrior",e))(ae||{});const Rt=30,ha=Rt*.6,QA="#4CAF50",JA="#FF5722",eI="#9C27B0",g1="#2196F3",tI="#FFC107",m1="#DC143C",Ig="#FFFFFF",Tg=[5,5],Du=5,sa=15,y1=20,v1=16,S1=10,A1=16,I1=16,nu=["","","","","","","","","",""],wl=8,T1="#FFFFFF",at=18,tt=15,E1="rgba(0, 0, 0, 0.7)",C1=4,Oo=150,Fn=15,ji=10,$o="#555",w1="#f44336",_1="#4CAF50",R1="#2196F3",P1="#FFC107",gd=16,Zi=32,md=28,D1=10,M1=8,N1=8,b1=8,vr=28,il=40,ol=10,Ev=8,O1=11,jh=40,Cv=5,k1=10,B1="#FFA500",F1="#808080",no=120,nI=30,L1=20,Gn="#2d3748",ft="#ffffff",vl="#4a5568",iI=5,Eg="#bdc9f792",oI="#272c36ff",rI="#a0aec0",iu=300,sI="rgba(255, 255, 255, 0.5)",H1="rgba(0, 0, 0, 0.8)",U1="#FFFFFF",wv=14,_v=8,Rv=-15,aI="#FFD700",lI=5,G1=30,x1="rgba(0, 0, 0, 0.5)",$1="#FFFFFF",W1=33,Y1=400,z1=20,j1=10,X1="rgba(0, 0, 0, 0.7)",V1="#FFFFFF",Xh=20,Pv=16,K1=.5,Dv=5,cI="#FFD700",q1=40,Cg=4,dI=3,Z1=5,uI=20,fI=5,Q1="#FFFFFF",J1="#FF6B6B",Ln=80,Sr=10,yd=300,Ar=15,eP=8,tP="rgba(0, 0, 0, 0.8)",nP="#FFFFFF",Vh=14,Mv=10,Ri=20,iP="#FF6B6B",oP="#4CAF50",Nv="#FFD700",rP="rgba(255, 255, 0, 0.3)",sP=2,aP=500,lP=120,cP=45,dP="#FFD700",uP=3,fP=4,Kh=225,bv=20,hP="#666",pP="#1a2a3a";let qh=0;function ou(){const e=nu[qh];return qh=(qh+1)%nu.length,e}function Ov(e,t,n){return t.search.human.byRadius(e.position,n).filter(a=>{var d;return!(a.id===e.id||a.gender===e.gender||!a.isAdult||a.hunger>=sn||(a.procreationCooldown||0)>0||a.gender==="female"&&a.isPregnant||(e.motherId===a.id||e.fatherId===a.id)&&((d=a.partnerIds)!=null&&d.length))}).sort((a,l)=>{const d=a.id===e.motherId||a.id===e.fatherId,u=e.id===a.motherId||e.id===a.fatherId,f=l.id===e.motherId||l.id===e.fatherId,p=e.id===l.motherId||e.id===l.fatherId;return d||u?1:f||p?-1:a.age-l.age})}function Wr(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),i=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(i),t.length>0)return t[0];if(n.sort(i),n.length>0)return n[0]}function Mn(e,t){const n=e,i=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...i,...s]}function gP(e,t,n){var s;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||e.motherId&&e.motherId===t.motherId||e.fatherId&&e.fatherId===t.fatherId||(s=e.partnerIds)!=null&&s.includes(t.id))return!0;if(e.motherId){const a=n.entities.entities[e.motherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(e.fatherId){const a=n.entities.entities[e.fatherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(t.motherId){const a=n.entities.entities[t.motherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}if(t.fatherId){const a=n.entities.entities[t.fatherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}return!1}function Hp(e,t){var a,l,d,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(l=t.partnerIds)!=null&&l.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,i=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((d=e.ancestorIds)==null?void 0:d.some(f=>t.ancestorIds.includes(f)))||((u=t.ancestorIds)==null?void 0:u.some(f=>e.ancestorIds.includes(f)));return n||i||s}function mP(e,t){const n=[];if(e.motherId){const i=t.entities.entities[e.motherId];i&&n.push(i)}if(e.fatherId){const i=t.entities.entities[e.fatherId];i&&n.push(i)}return n}function hI(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const i=t.entities.entities[n];if(i&&i.gender==="male")return i}return null}function Up(e,t){var n;if(!e.isAdult){if(e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human")return i}if(e.motherId){const i=t.entities.entities[e.motherId];if(i&&i.type==="human")return i}}if(e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human"&&((n=Wr(Mn(t,i)))==null?void 0:n.id)===e.id)return i}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?hI(e,t):null}function ru(e,t){let n=e;const i=new Set;i.add(n.id);for(let s=0;s<EA;s++){let a=null;if(n.gender==="female"&&(a=hI(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||i.has(a.id))break;n=a,i.add(n.id)}return n}function xl(e,t){var i;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(i=e.partnerIds)==null||i.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),Mn(t,e).forEach(s=>n.add(s)),Array.from(n)}function su(e,t){const n=new Map;function i(s){const a=Mn(t,s);for(const l of a)n.has(l.id)||(n.set(l.id,l),i(l))}return i(e),Array.from(n.values())}function li(e,t){return t.search.human.byProperty("leaderId",e)}function au(e,t,n=new Map,i=new Set){var a;if(n.has(e))return n.get(e);if(i.has(e))return e;i.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const l=s.partnerIds.find(d=>{const u=t.entities.entities[d];return u&&u.gender==="male"});if(l){const d=au(l,t,n,i);return n.set(e,d),d}}if(s.fatherId&&t.entities.entities[s.fatherId]){const l=au(s.fatherId,t,n,i);return n.set(e,l),l}return n.set(e,e),e}function yP(e,t){e.leaderId=e.id,e.tribeRole=ae.Leader,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{roleWeights:{[ae.Leader]:0,[ae.Gatherer]:2,[ae.Planter]:2,[ae.Hunter]:2,[ae.Mover]:2,[ae.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}}),e.tribeInfo||(e.tribeInfo={tribeBadge:ou(),tribeColor:mn[Math.floor(Math.random()*mn.length)]}),e.tribeControl||(e.tribeControl={roleWeights:{[ae.Leader]:0,[ae.Gatherer]:2,[ae.Planter]:2,[ae.Hunter]:2,[ae.Mover]:2,[ae.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}})}function vP(e,t){if(e.length===0)return null;const n=new Map,i=new Map;for(const l of e){const d=au(l.id,t,n);i.has(d)||i.set(d,[]),i.get(d).push(l)}let s=null,a=0;for(const[l,d]of i.entries())d.length>a&&(a=d.length,s=l);return s&&t.entities.entities[s]||null}function ql(e,t){var p,m,S;const n=new Map;for(let v=0;v<e.terrainOwnership.length;v++){const A=e.terrainOwnership[v];A!==null&&(n.has(A)||n.set(A,[]),n.get(A).push(v))}const{width:i,height:s}=e.mapDimensions,a=Math.ceil(i/me),l=new Map,d=Object.values(e.entities.entities).filter(v=>v.type==="human");for(const v of d)v.leaderId&&(l.has(v.leaderId)||l.set(v.leaderId,{leaderId:v.leaderId,tribeInfo:v.tribeInfo,members:[]}),(p=l.get(v.leaderId))==null||p.members.push(v));const u=t?(S=(m=e.entities.entities[t])==null?void 0:m.tribeControl)==null?void 0:S.diplomacy:void 0,f=Array.from(l.values()).map(v=>{var w,O;const A=e.entities.entities[v.leaderId],I=v.members.filter(M=>M.isAdult).length,E=v.members.length-I,P=n.get(v.leaderId)||[];let C=A==null?void 0:A.position;if(P.length>0){const M=P[0],D=M%a*me,N=Math.floor(M/a)*me,k={x:D,y:N};let U=0,z=0;for(const J of P){const q=J%a*me,re=Math.floor(J/a)*me,se=Xe(k,{x:q,y:re},i,s);U+=se.x,z+=se.y}const K=U/P.length,X=z/P.length;C={x:((k.x+K)%i+i)%i,y:((k.y+X)%s+s)%s}}return{leaderId:v.leaderId,tribeBadge:((w=v==null?void 0:v.tribeInfo)==null?void 0:w.tribeBadge)||"",tribeColor:((O=v==null?void 0:v.tribeInfo)==null?void 0:O.tribeColor)||"",adultCount:I,childCount:E,isPlayerTribe:v.leaderId===t,leaderAge:(A==null?void 0:A.age)??0,leaderGender:(A==null?void 0:A.gender)??"male",diplomacyStatus:(u==null?void 0:u[v.leaderId??-1])??ut.Friendly,territoryCenter:C}});return f.sort((v,A)=>v.isPlayerTribe?-1:A.isPlayerTribe?1:A.adultCount+A.childCount-(v.adultCount+v.childCount)),f}function jn(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function pI(e){var a;const t=new Set,i=e.search.human.all(),s=new Map;for(const l of i)l.leaderId&&(s.has(l.leaderId)||s.set(l.leaderId,[]),(a=s.get(l.leaderId))==null||a.push(l));for(const[l,d]of s){if(d.length===0)continue;const u=e.entities.entities[l],f=!u,p=u&&u.leaderId!==l;(f||p)&&t.add(l)}for(let l=0;l<e.terrainOwnership.length;l++){const d=e.terrainOwnership[l];d!==null&&!s.has(d)&&t.add(d)}return Array.from(t)}function SP(e,t){const n=new Map,s=t.search.human.all(),a=xl(e,t);for(const d of a)n.set(d,3);for(const d of s)d.id===e.id||n.has(d)||Hp(e,d)&&n.set(d,2);const l=Array.from(n.keys());for(const d of l)if(d.partnerIds)for(const u of d.partnerIds){const f=t.entities.entities[u];f&&!n.has(f)&&f.id!==e.id&&n.set(f,1)}return n}function AP(e,t){const n=li(e,t);if(n.length===0)return null;const i=t.entities.entities[e];if(i&&i.leaderId&&i.leaderId!==i.id)return i.leaderId;const s=new Map;for(const d of n){const u=SP(d,t);for(const[f,p]of u)if(f.leaderId&&f.leaderId!==e){const m=f.leaderId,S=t.entities.entities[m];if(S&&S.leaderId===S.id){const v=s.get(m)||0;s.set(m,v+p)}}}let a=null,l=0;for(const[d,u]of s)u>l&&(l=u,a=d);return a}function kv(e,t,n){var p,m;const i=li(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=i.length>0?(p=i[0].tribeInfo)==null?void 0:p.tribeBadge:"?",l=s.leaderId===e||!s.leaderId;if(l){const S=n.entities.entities[e];yP(s,S)}const d=((m=s.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const S of i)S.id!==t&&(S.leaderId=t,S.tribeInfo=s.tribeInfo,S.tribeRole=void 0);const f=n.search.building.byProperty("ownerId",e);for(const S of f)S.ownerId=t;eu(n,e,t),Ul(n,{identifier:`tribe-merge-${e}`,type:$r.TribeMerged,message:l?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${d}!`,duration:Zd,targetEntityIds:[t],highlightedEntityIds:[t,...i.map(S=>S.id)]})}function IP(e){var n;const t=pI(e);for(const i of t){const s=li(i,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",i);for(const f of u)Lp(f.id,e);eu(e,i,null),Ul(e,{identifier:`tribe-dissolved-${i}`,type:$r.TribeMerged,message:"An extinct tribe has been dissolved.",duration:Zd});continue}const a=vP(s,e);if(a){kv(i,a.id,e);continue}const l=AP(i,e);if(l)kv(i,l,e);else{const d=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const p of s)p.leaderId=void 0,p.tribeInfo=void 0,p.tribeRole=void 0;const f=e.search.building.byProperty("ownerId",i);for(const p of f)Lp(p.id,e);eu(e,i,null),Ul(e,{identifier:`tribe-dissolved-${i}`,type:$r.TribeMerged,message:`Tribe ${d} has been dissolved due to lack of leadership.`,duration:Zd})}}}var At=(e=>(e.Wood="wood",e))(At||{});const wg={wood:""},an="treeGrowing",Vt="treeFull",Sn="treeSpreading",xt="treeFallen",co="treeStump",Yr="treeDying",TP=500;function EP(e,t){if(!e.leaderId)return 0;const n=CP(e.leaderId,t),i=wP(e.leaderId,t);return i===0?0:Math.min(1,n/i)}function CP(e,t){const n=jn({leaderId:e},t),i=pa(e,t),s=n.reduce((l,d)=>l+d.food.length,0),a=i.reduce((l,d)=>{var f;const u=(f=d.storedItems)==null?void 0:f.filter(p=>p.item.type===An.Berry||p.item.type===An.Meat);return l+((u==null?void 0:u.length)||0)},0);return s+a}function wP(e,t){const n=jn({leaderId:e},t),i=pa(e,t),s=n.reduce((l,d)=>l+d.maxFood,0),a=i.reduce((l,d)=>l+(d.storageCapacity||0),0);return s+a}function gI(e,t,n=!1){const i=pa(e,t,n);if(i.length===0)return 0;const s=i.reduce((l,d)=>{var u;return l+(((u=d.storedItems)==null?void 0:u.length)||0)},0),a=i.reduce((l,d)=>l+(d.storageCapacity||0),0);return a===0?0:Math.min(1,s/a)}function $l(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const n=jn({leaderId:e},t),i=0,l=t.search.building.byProperty("ownerId",e).reduce((A,I)=>{if(I.isConstructed)return A;const E=nr[I.buildingType].cost.wood||0;return A+E},0),u=aa(e,t).reduce((A,I)=>{const P=(I.maxFuelLevel||kr)-(I.fuelLevel||0);if(P<=0)return A;const C=Math.ceil(P/KA),w=I.storedItems.filter(M=>M.item.type===At.Wood).length,O=Math.max(0,C-w);return A+O},0),p=pa(e,t).reduce((A,I)=>{var P;const E=(P=I.storedItems)==null?void 0:P.filter(C=>C.item.type===At.Wood);return A+((E==null?void 0:E.length)||0)},0),m=n.reduce((A,I)=>{var E;return A+(((E=I.heldItem)==null?void 0:E.type)===At.Wood?1:0)},0),S=p+m,v=l+u+i;return t.cache.tribeWoodNeeds[e]=Math.max(0,v-S),t.cache.tribeWoodNeeds[e]}function mI(e,t){const n=t;if(e&&n.cache.tribeAvailableWoodOnGround[e]!==void 0)return n.cache.tribeAvailableWoodOnGround[e];const i=n.search.tree.all().filter(s=>!(s.stateMachine[0]===xt)||s.wood.length===0?!1:Wn(s.position,e,t));return n.cache.tribeAvailableWoodOnGround[e]=i.reduce((s,a)=>s+a.wood.length,0),n.cache.tribeAvailableWoodOnGround[e]}function yI(e,t){const n=jn({leaderId:e},t);if(n.length===0)return{count:0,ratio:0};const i=_P(e,t);return{count:i,ratio:i/n.length}}function _P(e,t){return t.search.berryBush.all().filter(a=>$n(a.position.x,a.position.y,t)===e).filter(a=>{const l=a.stateMachine&&a.stateMachine[0]==="bushDying",d=a.food.length>0,u=Bi(t.soilDepletion,a.position,t.mapDimensions.width,t.mapDimensions.height);return!l&&d&&!u}).length}function Mu(e,t,n=!1){const i=typeof e=="object"?e.leaderId:e;return i?t.search.building.byProperty("buildingType",ue.PlantingZone).filter(a=>{if(!n&&!a.isConstructed)return!1;if(a.ownerId){const l=t.entities.entities[a.ownerId];return l&&l.leaderId===i}return!1}):[]}function vI(e,t){const{width:n,height:i,position:s}=e,{width:a,height:l}=t.mapDimensions,{depletedSectors:d,totalSectorsCount:u}=CI(t.soilDepletion,s,n,i,a,l);return u===0?!0:d.length/u<.25}function _g(e){const t=qo*2,n=Math.floor(e.width/t),i=Math.floor(e.height/t);return n*i}function SI(e,t){const n=t,i=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,i).filter(l=>{const d=Math.abs(l.position.x-e.position.x),u=Math.abs(l.position.y-e.position.y);return d<=e.width/2&&u<=e.height/2}).length}function RP(e,t){if(!e.leaderId)return[];const n=pa(e.leaderId,t),i=jn(e,t);return n.map(s=>{var f;const a=s.storageCapacity||0,l=((f=s.storedItems)==null?void 0:f.length)||0,d=i.filter(p=>{if(p.activeAction!=="depositing")return!1;if(typeof p.target=="object"&&"x"in p.target){const m=p.target;return G(m,s.position,t.mapDimensions.width,t.mapDimensions.height)<=50}return!1}).length,u=G(e.position,s.position,t.mapDimensions.width,t.mapDimensions.height);return{storage:s,capacity:a,currentItems:l,assignedDepositors:d,distance:u}})}function AI(e,t){const n=RP(e,t);if(n.length===0)return null;const i=n.filter(s=>{const a=s.currentItems<s.capacity,l=s.distance<=TP;return a&&l});return i.length===0?null:(i.sort((s,a)=>{const l=s.currentItems/s.capacity,d=a.currentItems/a.capacity;return Math.abs(l-d)>.1?l-d:s.assignedDepositors!==a.assignedDepositors?s.assignedDepositors-a.assignedDepositors:s.distance-a.distance}),i[0].storage)}function PP(e,t){if(!e.leaderId)return null;const i=aa(e.leaderId,t).filter(s=>{const a=s.storageCapacity||tu;return s.storedItems.length<a});if(i.length>0){const s=i.filter(a=>{const l=a.fuelLevel??0,d=a.maxFuelLevel??kr;return l<d*Ag});return s.length>0?(s.sort((a,l)=>{const d=a.fuelLevel??0,u=l.fuelLevel??0,f=a.maxFuelLevel??kr,p=l.maxFuelLevel??kr,m=d/f,S=u/p,v=m<.25,A=S<.25;return v!==A?v?-1:1:d-u}),s[0]):(i.sort((a,l)=>{const d=G(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height),u=G(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);return d-u}),i[0])}return AI(e,t)}function II(e,t,n){return jn({leaderId:e},t).filter(s=>s.activeAction===n).length}function pa(e,t,n=!1){return t.search.building.byProperty("buildingType",ue.StorageSpot).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function aa(e,t,n=!1){return t.search.building.byProperty("buildingType",ue.Bonfire).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function DP(e,t){const n=Mu(e,t);if(n.length===0)return null;const i=t.mapDimensions.width,s=t.mapDimensions.height,a=t.soilDepletion;for(const l of n){const d=_g(l);if(SI(l,t)>=d)continue;const f=20;for(let p=0;p<f;p++){const m=l.position.x+(Math.random()-.5)*l.width,S=l.position.y+(Math.random()-.5)*l.height,v={x:(m%i+i)%i,y:(S%s+s)%s};if(!Bi(a,v,i,s)&&!zn(v,t,qo))return{position:v,zoneId:l.id}}}return null}function Zl(e,t,n=void 0){return n?Mu(n,t).some(l=>Dp(e,l,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===ue.PlantingZone&&Dp(e,a,t))}function Nu(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/jt),gridY:Math.floor(s/jt)}}function TI(e,t,n){const i=gA(t,n);return e.sectors[i]||(e.sectors[i]=__()),e.sectors[i]}function Rg(e,t,n){const i=gA(t,n),s=e.sectors[i];return s?s.health:qd}function Bi(e,t,n,i){const{gridX:s,gridY:a}=Nu(t,n,i);return Rg(e,s,a)<vA}function EI(e,t,n){return Rg(e,t,n)>=vA}function MP(e,t,n,i,s,a,l){const{gridX:d,gridY:u}=Nu(t,s,a),f=TI(e,d,u),p=f.lastAffectedBy[n]||0;if(i-p<AA)return;const m=Zl(t,l)?TA:1,S=P_*m;f.health=Math.max(SA,f.health-S),f.lastWalkTime=i,f.lastAffectedBy[n]=i}function NP(e,t,n,i,s,a){const{gridX:l,gridY:d}=Nu(t,i,s),u=TI(e,l,d),f=Zl(t,a)?TA:1,p=R_*f;u.health=Math.max(SA,u.health-p),u.lastPlantTime=n}function bP(e,t,n,i,s){let a=0;for(let l=-1;l<=1;l++)for(let d=-1;d<=1;d++){if(l===0&&d===0)continue;const u=((t+l)%i+i)%i,f=((n+d)%s+s)%s;EI(e,u,f)&&a++}return a}function OP({soilDepletion:e,time:t,mapDimensions:{width:n,height:i}}){if(t-e.lastUpdateTime<B_)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/jt),l=Math.ceil(i/jt),d=[];for(const u of Object.keys(e.sectors)){const f=Number(u),p=e.sectors[f],m=Math.max(p.lastWalkTime,p.lastPlantTime);if(t-m<N_)continue;const{gridX:S,gridY:v}=mA(f),A=bP(e,S,v,a,l),I=A>0?M_*(A/8):0,E=D_+I;p.health=Math.min(qd,p.health+E*s),p.health>=qd&&d.push(f);const P=t-AA*10;for(const C of Object.keys(p.lastAffectedBy)){const w=Number(C);p.lastAffectedBy[w]<P&&delete p.lastAffectedBy[w]}}for(const u of d)delete e.sectors[u]}function kP(e,t){const n=[];for(const i of Object.keys(e.sectors)){const s=Number(i),a=e.sectors[s];if(a.health<t){const{gridX:l,gridY:d}=mA(s);n.push({gridX:l,gridY:d,health:a.health})}}return n}function CI(e,t,n,i,s,a){const l=[],d=n/2,u=i/2,f=t.x-d,p=t.x+d,m=t.y-u,S=t.y+u,v=Math.floor(f/jt),A=Math.floor((p-.001)/jt),I=Math.floor(m/jt),E=Math.floor((S-.001)/jt),P=Math.ceil(s/jt),C=Math.ceil(a/jt);let w=0;for(let O=v;O<=A;O++)for(let M=I;M<=E;M++){w++;const D=(O%P+P)%P,N=(M%C+C)%C;EI(e,D,N)||l.push({gridX:D,gridY:N})}return{depletedSectors:l,totalSectorsCount:w}}function Bv(e,t,n,i,s){const{gridX:a,gridY:l}=Nu(t,n,i),d=Rg(e,a,l);return 1+(s-1)*Math.sqrt(1-d/qd)}const BP={id:Cl,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ot/Gt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Fl,data:{...e,enteredAt:i.gameState.time}};if(!Bi(i.gameState.soilDepletion,n.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)){const l=Zl(n.position,i.gameState)?w_:1;n.timeSinceLastBerryRegen+=s*l,n.timeSinceLastBerryRegen>=I_&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:An.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:Dr,data:{...e,enteredAt:i.gameState.time,previousState:Cl}}:{nextState:Cl,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},FP={id:Dr,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ot/Gt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Fl,data:{...e,enteredAt:i.gameState.time,previousState:Dr}};if(n.food.length<n.maxFood)return{nextState:Cl,data:{...e,enteredAt:i.gameState.time,previousState:Dr}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=cv){n.timeSinceLastSpreadAttempt=0;const l=i.gameState.time-n.timeSinceLastHarvest>=cv,d=Zl(n.position,i.gameState)?C_:1,u=i.gameState.ecosystem.berryBushSpreadChance*d;if(l&&Math.random()<u)return{nextState:Hd,data:{...e,enteredAt:i.gameState.time,previousState:Dr}}}return{nextState:Dr,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function LP(e,t,n){const i=xl(e,t),s=t;for(const a of i){if(G(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height)>n)continue;const d=s.search.human.byProperty("attackTargetId",a.id);for(const u of d)if(u.leaderId!==e.leaderId&&G(e.position,u.position,t.mapDimensions.width,t.mapDimensions.height)<=n)return{familyMember:a,aggressor:u}}}function HP(e,t){const i=t.search.human.byRadius(e.position,BR);let s,a=1/0;for(const l of i){if(l.id===e.id||l.hitpoints<=0||l.hitpoints/l.maxHitpoints>kR||gP(e,l,t)||e.leaderId===l.leaderId&&e.leaderId)continue;const d=G(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);d<a&&(a=d,s=l)}return s}function UP(e,t,n){return t.search.human.byRadius(e.position,n).filter(s=>Xr(e,s,t))}function GP(e,t,n){const i=n.search.human.byProperty("leaderId",e);let s=0;for(const a of i)a.attackTargetId===t&&s++;return s}function lu(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let i=n.hitpoints;return i+=(n.maxAge-n.age)*.5,i+=n.food.length*2,t+i},0)}var le=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(le||{});const bu={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},wI={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var bs=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(bs||{});const rl={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var de=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenTribeModal="OpenTribeModal",e.RecenterCamera="RecenterCamera",e.CloseTribeModal="CloseTribeModal",e.OpenRoleManager="OpenRoleManager",e.CloseRoleManager="CloseRoleManager",e.IncreaseRoleWeight="IncreaseRoleWeight",e.DecreaseRoleWeight="DecreaseRoleWeight",e.OpenArmyControl="OpenArmyControl",e.CloseArmyControl="CloseArmyControl",e.IncreaseArmyObjective="IncreaseArmyObjective",e.DecreaseArmyObjective="DecreaseArmyObjective",e))(de||{});const Zh=30,xP=.4,$P=24,_I=50,WP=100,YP=160,zP=72,RI=10,Pg=2,jP=10,XP=15,Gp=5,xp=5,$p=5,Fv=600,VP=1.5,PI=.1,Qh=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,Jh=""+new URL("gather-CU75596W.mp3",import.meta.url).href,KP=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,Lv=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,qP=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,ZP=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,QP=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,JP=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,eD=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,tD=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Ee=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Ee||{});const nD=new Map([[0,Qh],[1,Jh],[2,KP],[3,Lv],[4,qP],[5,ZP],[6,QP],[12,JP],[13,eD],[7,Qh],[8,Lv],[9,Jh],[10,Jh],[11,Qh],[14,tD]]);let sl,Wl;function iD(){if(!(typeof window>"u"))return Wl}function Dg(){if(!(typeof window>"u"))return!sl&&typeof window.AudioContext=="function"&&(sl=new window.AudioContext,Wl=sl.createGain(),Wl.connect(sl.destination),_l(.1,!1)),sl}function _l(e,t){Wl&&(Wl.gain.value=t?0:e/10)}const DI=new Map;let vd=!1,Hv=!1;async function oD(){if(Hv||vd)return;const e=Dg();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),vd=!0,console.log("Starting sound loading...");const t=[];nD.forEach((n,i)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{DI.set(i,a)}).catch(a=>{console.error(`Error loading sound ${Ee[i]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),Hv=!0,vd=!1,console.log("All sounds loaded successfully.")}catch(n){vd=!1,console.error("An error occurred while loading sounds:",n)}}const Rl=new Map;function Mg(e,t){const n=Dg(),i=iD();if(!n||!i||i.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=DI.get(e);if(!s){console.warn(`Sound buffer not found for type: ${Ee[e]}`);return}if(t!=null&&t.trackId&&Rl.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const l=n.createGain(),d=n.createStereoPanner();let u=l;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const f=Xe(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),p=G(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(p>Fv)return;const m=1-Math.pow(p/Fv,VP);l.gain.value=Math.max(0,m);const S=Math.sin(f.x/p*(Math.PI/2));d.pan.value=isNaN(S)?0:S,l.connect(d),u=d}else{const f=e===Ee.GameOver?.4:e===Ee.SoundTrack1?1:.2;l.gain.value=f}a.connect(u),u.connect(i),a.start(0),t!=null&&t.trackId&&(Rl.set(t.trackId,{sourceNode:a,gainNode:l}),a.onended=()=>{Rl.delete(t.trackId)})}function ep(e,t=1){const n=Rl.get(e),i=Dg();if(n&&i){const{sourceNode:s,gainNode:a}=n,l=i.currentTime;a.gain.setValueAtTime(a.gain.value,l),a.gain.linearRampToValueAtTime(0,l+t),s.stop(l+t),s.onended=null,Rl.delete(e)}}function Ne(e,t,n){const i=Tt(e.gameState);i&&Mg(t,{position:n,listenerPosition:i.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}var R=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.FAILURE=1]="FAILURE",e[e.RUNNING=2]="RUNNING",e[e.NOT_EVALUATED=3]="NOT_EVALUATED",e))(R||{});class Nn{constructor(){Re(this,"name");Re(this,"depth");Re(this,"children");Re(this,"child")}getLastStatus(t){return _.get(t.aiBlackboard,`${this.name}_lastStatus`)??3}setLastStatus(t,n){_.set(t.aiBlackboard,`${this.name}_lastStatus`,n)}getRunningChildIndex(t){return _.get(t.aiBlackboard,`${this.name}_runningChildIndex`)}setRunningChildIndex(t,n){_.set(t.aiBlackboard,`${this.name}_runningChildIndex`,n)}}const _={create(){return{data:{},nodeExecutionData:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e},recordNodeExecution({nodeExecutionData:e},t,n,i,s,a){const l=e[t]||{lastExecuted:0,status:R.FAILURE,depth:0,debugInfo:"",executionHistory:[]},d=l.executionHistory[l.executionHistory.length-1];d&&i-(d==null?void 0:d.time)>Qd&&l.executionHistory.push({time:d.time+Qd,status:R.NOT_EVALUATED}),l.executionHistory.push({time:i,status:n});const u=G1/Gt*Ot,f=i-u;l.executionHistory=l.executionHistory.filter(m=>m.time>=f);const p={...l,lastExecuted:i,status:n,depth:s,debugInfo:a};e[t]=p},getNodeExecutionData({nodeExecutionData:e}){return e},cleanupOldEntries({nodeExecutionData:e},t){const n=CR,i=[];for(const[s,a]of Object.entries(e))t-a.lastExecuted>n&&i.push(s);for(const s of i)delete e[s]}},Ng="tribeSplit_phase",Ql="tribeSplit_strategy",bg="tribeSplit_targetPosition",Ou="tribeSplit_targetBuildingId",ku="tribeSplit_familyIds",MI="tribeSplit_phaseStartTime",NI="tribeSplit_lastFailureTime";function bI(e,t){_.set(e,Ng,"idle"),_.delete(e,Ql),_.delete(e,bg),_.delete(e,Ou),_.delete(e,ku),_.set(e,NI,t)}function rD(e,t){const n=_.get(e,NI);return n?t-n>=zP:!0}function sD(e,t){const n=_.get(e,MI);return n?t-n>=YP:!1}function Og(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(pI(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!rD(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const i=t.entities.entities[e.leaderId];if(!i||i.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=Wr(Mn(t,i));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(ru(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const l=li(e.leaderId,t).filter(v=>v.isAdult);if(l.length<Zh)return{canSplit:!1,reason:"Tribe too small"};const u=su(e,t).length+1,p=su(i,t).length+1;if(u>=p&&u>Zh)return{canSplit:!0,progress:1,strategy:Uv(e,t)};const m=Math.max(l.length*xP,Zh),S=u/m;if(u>=m){const v=Uv(e,t);return{canSplit:!0,progress:S,strategy:v}}return{canSplit:!1,progress:S,reason:`Family too small: ${u} < ${m}`}}function Uv(e,t){if(!e.leaderId)return"migration";const n=t;if(!($n(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===ue.StorageSpot&&a.isConstructed);return s.length>0&&s.find(l=>G(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height)<=WP)?"concentration":"migration"}function OI(e,t){if(!e.aiBlackboard)return!1;const n=_.get(e.aiBlackboard,Ql);if(!n)return!1;const i=su(e,t),s=[e.id,...i.map(a=>a.id)];return _.set(e.aiBlackboard,ku,s),n==="migration"?lD(e,t):n==="concentration"?cD(e,t):!1}function aD(e,t,n){if(zn(e,n,30))return!1;const s=$n(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function lD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,i=t.mapDimensions.height,s=Math.min(n,i)/2,a=50,l=50;for(let d=0;d<=s;d+=a){const u=d===0?1:Math.max(8,Math.ceil(2*Math.PI*d/l)),f=d===0?0:2*Math.PI/u;for(let p=0;p<u;p++){const m=p*f,S=Math.cos(m)*d,v=Math.sin(m)*d,A=e.position.x+S,I=e.position.y+v,E={x:(A%n+n)%n,y:(I%i+i)%i};if(aD(E,e.leaderId,t))return _.set(e.aiBlackboard,bg,E),!0}}return!1}function cD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const i=t.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===ue.StorageSpot&&l.isConstructed);if(i.length===0)return!1;let s=null,a=1/0;for(const l of i){const d=G(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);d<a&&(a=d,s=l)}return s?(_.set(e.aiBlackboard,Ou,s.id),!0):!1}function dD(e,t){var d;if(!e.aiBlackboard)return[!1,0];const n=_.get(e.aiBlackboard,Ql),i=(d=_.get(e.aiBlackboard,ku))==null?void 0:d.filter(u=>!!t.entities.entities[u]);if(!n||!i)return[!1,0];let s;if(n==="migration"){const u=_.get(e.aiBlackboard,bg);if(!u)return[!1,0];s=u}else if(n==="concentration"){const u=_.get(e.aiBlackboard,Ou);if(!u)return[!1,0];const f=t.entities.entities[u];if(!f)return[!1,0];s=f.position}else return[!1,0];let a=0;for(const u of i){const f=t.entities.entities[u];if(!f||f.type!=="human")continue;G(f.position,s,t.mapDimensions.width,t.mapDimensions.height)<=_I&&a++}const l=Math.ceil(i.length*.5);return[a>=l,a/l]}function kI(e,t){var u;if(!e.aiBlackboard)return!1;const n=_.get(e.aiBlackboard,Ql),i=_.get(e.aiBlackboard,ku);if(!n||!i)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=ou(),l=mn[Math.floor(Math.random()*mn.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:l},e.tribeRole=ae.Leader,e.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=ut.Hostile);for(const f of i){if(f===e.id)continue;const p=t.entities.entities[f];!p||p.type!=="human"||(p.leaderId=e.id,p.tribeInfo={tribeBadge:a,tribeColor:l})}if(n==="concentration"){const f=_.get(e.aiBlackboard,Ou);if(f){const p=t.entities.entities[f];p&&p.type==="building"&&(p.ownerId=e.id)}}return Ul(t,{type:$r.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:Zd,targetEntityIds:[e.id],highlightedEntityIds:i}),Ne({gameState:t},Ee.TribeSplit,e.position),bI(e.aiBlackboard,t.time),!0}function Sl(e){return e?_.get(e,Ng)??"idle":"idle"}function Es(e,t,n){_.set(e,Ng,t),_.set(e,MI,n)}function BI(e,t){_.set(e,Ql,t)}function uD(e,t){bI(e,t)}function fD(e,t){return sD(e,t)?(uD(e,t),!0):!1}function FI(e,t){const n=Og(e,t);return{canSplit:n.canSplit,progress:n.progress}}function LI(e,t){if(!e.aiBlackboard)return;const n=Og(e,t);!n.canSplit||!n.strategy||(BI(e.aiBlackboard,n.strategy),OI(e,t)&&kI(e,t))}const hD=20,Kt=30,pD=.5,gD=.3,mD=2,yD=50;function kg(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>Zo&&n.push({type:le.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const l=xe(t,e,"berryBush",ze,f=>f.food.length>0),d=xe(t,e,"corpse",ze,f=>f.food.length>0);let u=null;l&&d?u=G(t.position,l.position,e.mapDimensions.width,e.mapDimensions.height)<=G(t.position,d.position,e.mapDimensions.width,e.mapDimensions.height)?l:d:u=l||d,u&&n.push({type:le.Gather,action:"gathering",key:"e",targetEntity:u})}const i=xe(t,e,"human",ze,l=>ir(t,l,e));if(i&&n.push({type:le.Procreate,action:"procreating",key:"r",targetEntity:i}),t.food.length>0&&t.isAdult){const l=xe(t,e,"human",ze,d=>{const u=d;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=Zo});l&&n.push({type:le.FeedChild,action:"feeding",key:"h",targetEntity:l})}const s=xe(t,e,"human",yn,l=>Xr(t,l,e))??xe(t,e,"predator",yn)??xe(t,e,"prey",yn);if(s&&n.push({type:le.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(l=>l.type===An.Berry).length>=uo&&n.push({type:le.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const l=xe(t,e,"building",Kt,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});l&&n.push({type:le.Deposit,action:"idle",key:"x",targetEntity:l})}if(t.food.length<t.maxFood&&t.isAdult){const l=xe(t,e,"building",Kt,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});l&&n.push({type:le.Retrieve,action:"idle",key:"z",targetEntity:l})}if(((a=t.heldItem)==null?void 0:a.type)===At.Wood){const l=xe(t,e,"building",Kt,d=>{const u=d;return u.buildingType===ue.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});l&&n.push({type:le.Deposit,action:"depositing",key:"x",targetEntity:l})}if(FI(t,e).canSplit&&n.push({type:le.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const l=xe(t,e,"tree",Tu,d=>d.wood&&d.wood.length>0);l&&n.push({type:le.Chop,action:"chopping",key:"c",targetEntity:l})}return n}const vD={id:Hd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i,a=i.deltaTime*(Ot/Gt);if(n.age+=a,n.age>=n.lifespan)return{nextState:Fl,data:{...e,enteredAt:s.time,previousState:Hd}};const l=vg(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return zn(l,s,15)||tc(s.entities,l,s.time),{nextState:Dr,data:{...e,enteredAt:s.time,previousState:Hd}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},SD={id:Fl,update:e=>({nextState:Fl,data:e}),onEnter:(e,t)=>(Zr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},AD=[BP,FP,vD,SD],St="humanIdle",Pr="humanMoving",Al="humanEating",ga="humanGathering",Pl="humanDepositing",Dl="humanRetrieving",Nr="humanProcreating",Qo="humanAttacking",Ud="humanPlanting",Bg="humanChopping",ID={id:St,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:Qo,data:{...e,enteredAt:i.gameState.time,previousState:St,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:(n.hunger>=cg?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:i.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:Pr,data:{...e,enteredAt:i.gameState.time,previousState:St,target:n.target}}:n.activeAction==="gathering"?{nextState:ga,data:{...e,enteredAt:i.gameState.time,previousState:St,target:n.target}}:n.activeAction==="eating"?{nextState:Al,data:{...e,enteredAt:i.gameState.time,previousState:St}}:n.activeAction==="planting"&&n.target?{nextState:Ud,data:{...e,enteredAt:i.gameState.time,previousState:St,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:Pl,data:{...e,enteredAt:i.gameState.time,previousState:St}}:n.activeAction==="retrieving"?{nextState:Dl,data:{...e,enteredAt:i.gameState.time,previousState:St}}:n.activeAction==="chopping"&&n.target?{nextState:Bg,data:{...e,enteredAt:i.gameState.time,previousState:St,state:"chopping"}}:{nextState:St,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function HI(e,t=1){let n=L_;return e.hunger>=cg&&(n*=H_),e.age>=G_&&(n*=x_),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const tp=7.5;class TD{constructor(){Re(this,"id",Pr)}update(t,n){var S;const{entity:i,updateContext:s}=n;if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:Qo,data:{...t,enteredAt:s.gameState.time,previousState:Pr,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:St,data:{...t,enteredAt:s.gameState.time,previousState:Pr}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(S=n.updateContext.gameState.entities.entities[i.target])==null?void 0:S.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*tp*2,y:i.position.y+i.direction.y*tp*2}),!a)return{nextState:St,data:{...t,enteredAt:s.gameState.time,previousState:Pr}};const{width:l,height:d}=s.gameState.mapDimensions,u=G(i.position,a,l,d);if(u<tp)return{nextState:St,data:{...t,enteredAt:s.gameState.time,previousState:Pr}};const f=Xe(i.position,a,l,d),p=mt(f);if(u>fv){const v=vp(p,-Yh),A=vp(p,Yh),I=[p,v,A],E=I.map((C,w)=>{const O=ri(i.position,_t(C,fv)),M={x:(O.x%l+l)%l,y:(O.y%d+d)%d},D=Bv(s.gameState.soilDepletion,M,l,d,uv),k=Math.cos(w===0?0:Yh);return D*k});let P=0;for(let C=1;C<E.length;C++)E[C]>E[P]&&(P=C);i.direction=I[P]}else i.direction=p;const m=Bv(s.gameState.soilDepletion,i.position,l,d,uv);return i.acceleration=HI(i,m),{nextState:Pr,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const ED=new TD,CD={id:Al,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:St,data:{...e,enteredAt:i.gameState.time,previousState:Al}}:(n.food.length>0&&(!n.eatingCooldownTime||i.gameState.time>=n.eatingCooldownTime)&&n.hunger>Zo&&(n.hunger=Math.max(0,n.hunger-Zo),n.food.pop(),n.eatingCooldownTime=i.gameState.time+1,Ne(i,Ee.Eat,n.position),(!n.lastEatingEffectTime||i.gameState.time-n.lastEatingEffectTime>2)&&(Ue(i.gameState,Ie.Eating,n.position,Ke,n.id),n.lastEatingEffectTime=i.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:St,data:{...e,enteredAt:i.gameState.time,previousState:Al}}:{nextState:Al,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class wD{constructor(){Re(this,"id",ga)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const _D=new wD,RD={id:Pl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:St,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Pl}}:{nextState:Pl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},PD={id:Dl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:St,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Dl}}:{nextState:Dl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},DD=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),MD=(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time<(e.procreationEndTime||0))return{nextState:Nr,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<sn&&a.hunger<sn&&!n.procreationCooldown&&!a.procreationCooldown){const l=n.gender==="female"?n:a.gender==="female"?a:void 0,d=n.gender==="male"?n:a.gender==="male"?a:void 0;l&&d&&(l.isPregnant=!0,l.gestationTime=W_,l.pregnancyFatherId=d.id,n.procreationCooldown=hv,a.procreationCooldown=hv,Ne(i,Ee.Procreate,l.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:St,data:{...e,enteredAt:s.time,previousState:Nr}}},ND={id:Nr,onEnter:DD,update:MD},bD={id:Qo,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:St,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:St,data:{...e}};const i=G(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Xe(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=mt(s),i<=fo||i<=yn&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=HI(t.entity),{nextState:Qo,data:e}}},OD={id:Ud,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time-e.enteredAt>=E_){const l=n.food.filter(u=>u.type===An.Berry).length,d=Bi(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(l>=uo&&!d){for(let u=0;u<uo;u++){const f=n.food.findIndex(p=>p.type===An.Berry);f>-1&&n.food.splice(f,1)}tc(s.entities,e.plantingSpot,s.time),NP(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:St,data:{...e,enteredAt:s.time,previousState:Ud}}}return{nextState:Ud,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class kD{constructor(){Re(this,"id",Bg)}update(t,n){const{entity:i,updateContext:s}=n;return i.activeAction!=="chopping"||i.heldItem?{nextState:St,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const BD=new kD,FD=[ID,ED,CD,_D,RD,PD,ND,bD,OD,BD],vi="preyIdle",xo="preyMoving",Il="preyGrazing",Tl="preyProcreating",LD={id:vi,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:xo,data:{...e,enteredAt:i.gameState.time,previousState:vi,target:n.target}}:n.activeAction==="grazing"?{nextState:Il,data:{...e,enteredAt:i.gameState.time,previousState:vi}}:n.activeAction==="procreating"?{nextState:Tl,data:{...e,enteredAt:i.gameState.time,previousState:vi}}:{nextState:vi,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},UI=12,Bu=120,Gv=50,HD=12,GI=30,UD=2,la=50,GD=100,xI=2,xD=.9,$D=1,WD=50,YD=.5,$I=20,Fu=140,xv=40,zD=12,WI=40,jD=3,ca=60,Vr=40,XD=50,YI=320,zI=25,VD=60,jI=2,KD=90,qD=.7,ZD=1,XI=3,Fg=80,VI=10,Lu=80,KI=40,qI=2,cu=30,Us=20,Br=40,Gs=24,Fr=48,xs=12,Lr=40,$s=20,Hr=60,Ws=.75,Wo=2.5,Ys=.25,Yo=2,ZI=4;function QD(e){let t=HD;return e.isAdult||(t*=.7),e.hunger>=WD&&(t*=YD),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function JD(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),p=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|f<<8|p}function Yl(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const np=10;class eM{constructor(){Re(this,"id",xo)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction!=="moving")return{nextState:vi,data:{...t,enteredAt:s.gameState.time,previousState:xo}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*np*2,y:i.position.y+i.direction.y*np*2}),!a)return{nextState:vi,data:{...t,enteredAt:s.gameState.time,previousState:xo}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=mt(l),i.acceleration=QD(i),G(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<np?{nextState:vi,data:{...t,enteredAt:s.gameState.time,previousState:xo}}:{nextState:xo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const tM=new eM,nM={id:Il,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:xo,data:{...e,enteredAt:i.gameState.time,previousState:Il,target:n.target}}:n.activeAction!=="grazing"?{nextState:vi,data:{...e,enteredAt:i.gameState.time,previousState:Il}}:{nextState:Il,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},iM={id:Tl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:xo,data:{...e,enteredAt:i.gameState.time,previousState:Tl,target:n.target}}:n.activeAction!=="procreating"?{nextState:vi,data:{...e,enteredAt:i.gameState.time,previousState:Tl}}:{nextState:Tl,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},oM=[LD,tM,nM,iM],gn="predatorIdle",Uo="predatorMoving",eo="predatorAttacking",Os="predatorProcreating",Ur="predatorEating",rM={id:gn,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:Ur,data:{...e,enteredAt:i.gameState.time,previousState:gn,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:eo,data:{...e,enteredAt:i.gameState.time,previousState:gn,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction==="moving"?{nextState:Uo,data:{...e,enteredAt:i.gameState.time,previousState:gn,target:n.target}}:n.activeAction==="procreating"?{nextState:Os,data:{...e,enteredAt:i.gameState.time,previousState:gn}}:{nextState:gn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function QI(e){let t=zD;return e.hunger>=KD&&(t*=qD),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function sM(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),p=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|f<<8|p}function zl(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const ip=12;class aM{constructor(){Re(this,"id",Uo)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction==="eating")return{nextState:Ur,data:{...t,enteredAt:s.gameState.time,previousState:Uo,preyId:i.attackTargetId,eatingStartTime:s.gameState.time}};if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:eo,data:{...t,enteredAt:s.gameState.time,previousState:Uo,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:gn,data:{...t,enteredAt:s.gameState.time,previousState:Uo}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*ip*2,y:i.position.y+i.direction.y*ip*2}),!a)return{nextState:gn,data:{...t,enteredAt:s.gameState.time,previousState:Uo}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=mt(l),i.acceleration=QI(i),G(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<ip?{nextState:gn,data:{...t,enteredAt:s.gameState.time,previousState:Uo}}:{nextState:Uo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const lM=new aM,cM={id:eo,update:(e,t)=>{const{entity:n,updateContext:i}=t;if(n.activeAction==="eating")return{nextState:Ur,data:{...e,enteredAt:i.gameState.time,previousState:eo,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:eo}};const s=i.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:eo}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:eo}};const l=G(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),d=Xe(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return n.direction=mt(d),l>Vr?n.acceleration=QI(n):n.acceleration=0,{nextState:eo,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},dM={id:Os,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:Ur,data:{...e,enteredAt:i.gameState.time,previousState:Os,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:eo,data:{...e,enteredAt:i.gameState.time,previousState:Os,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction!=="procreating"?{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:Os}}:{nextState:Os,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},uM={id:Ur,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:Ur}}:{nextState:Ur,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},fM=[rM,lM,cM,dM,uM],hM=24*30*10,Jo=24*5,pM=48,gM=72,Jl=20,mM="#3b2016",yM="#5c3a21",vM="#376d31",SM="#76a331",AM="#a6c44a",IM="rgba(0, 0, 0, 0.25)",TM=60,EM=24*7,CM=.1,$v=1,Hu=5,wM={id:an,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.age>=n.lifespan?{nextState:Yr,data:{enteredAt:i.gameState.time,previousState:an}}:n.age>=Jo?{nextState:Vt,data:{enteredAt:i.gameState.time,previousState:an}}:{nextState:an,data:e}}},_M={id:Vt,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ot/Gt);return n.age>=n.lifespan?{nextState:Yr,data:{...e,enteredAt:i.gameState.time,previousState:Vt}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=EM&&(n.timeSinceLastSpreadAttempt=0,Math.random()<CM)?{nextState:Sn,data:{...e,enteredAt:i.gameState.time,previousState:Vt}}:{nextState:Vt,data:e})}},RM={id:Sn,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(n.age>=n.lifespan)return{nextState:Yr,data:{...e,enteredAt:s.time,previousState:Sn}};const a=vg(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return zn(a,s,25)||jl(s.entities,a,s.time),{nextState:Vt,data:{...e,enteredAt:s.time,previousState:Sn}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},PM={id:xt,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=pM?{nextState:co,data:{enteredAt:n.gameState.time,previousState:xt}}:{nextState:xt,data:e}}},DM={id:co,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=gM?{nextState:Yr,data:{enteredAt:n.gameState.time,previousState:co}}:{nextState:co,data:e}}},MM={id:Yr,update:e=>({nextState:Yr,data:e}),onEnter:(e,t)=>(Zr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},NM=[wM,_M,RM,PM,DM,MM],Wv=[...AD,...FD,...oM,...fM,...NM];function bM(e,t,n){const i=h_(e,Wv);if(!i)return g_(e),[e,t];const{nextState:s,data:a}=i.update(t,n);return p_(e,s)?[s,f_(i,s,a,n,Wv)]:[s,a]}function Lg(e,t){return`${e},${t}`}const Yv=Ot*10;function JI(e){return e%Yv/Yv}function eT(e){const t=JI(e);return(Math.cos(t*2*Math.PI)+1)/2}function OM(e){const t=JI(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function tT(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/to),gridY:Math.floor(s/to)}}function er(e,t,n,i,s){const{gridX:a,gridY:l}=tT(t,i,s),d=Lg(a,l),u=e.sectors[d],f=u?u.currentTemperature:VA,m=(eT(n)*2-1)*u1;return f+m}function kM(e){const{sectors:t}=e.temperature,{width:n,height:i}=e.mapDimensions,s=Math.ceil(n/to),a=Math.ceil(i/to);for(const d in t){const u=t[d];u.currentTemperature=u.baseTemperature}const l=Math.ceil(Or/to);Object.values(e.entities.entities).forEach(d=>{if(d.type==="building"){const u=d;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const f=tT(u.position,n,i);for(let p=-l;p<=l;p++)for(let m=-l;m<=l;m++){const S=(f.gridX+m+s)%s,v=(f.gridY+p+a)%a,A=Lg(S,v),I=t[A];if(I){const E={x:(S+.5)*to,y:(v+.5)*to},P=G(u.position,E,n,i);if(P<Or){const C=l1*(1-P/Or);I.currentTemperature+=C}}}}}})}function nT(e,t){const n={},i=Math.ceil(e/to),s=Math.ceil(t/to);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const d=Lg(l,a);let u=VA;const f=a/s*10-5;u+=f,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),n[d]={baseTemperature:u,currentTemperature:u}}return{sectors:n}}function BM(e,t,n){var d;const{gameState:i}=t,s=n*(Ot/Gt);e.isAdult=e.age>=dg;const a=er(i.temperature,e.position,i.time,i.mapDimensions.width,i.mapDimensions.height);if(a<lo){const u=(lo-a)*a1*s;e.hitpoints-=u}if(e.movementSlowdown&&i.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<rn){const u=1-e.hunger/rn*eR,f=J_*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+f)}if(e.hunger+=n*(nl/(Ot/Gt)),e.hunger>=rn)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-Zo);else{const u=tR*s;e.hitpoints-=u}if(e.age+=n/Iu,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((nl*Y_-nl)/(Ot/Gt)),(!e.lastPregnantEffectTime||i.time-e.lastPregnantEffectTime>Gl*3)&&(Ue(i,Ie.Pregnant,e.position,Gl,e.id),e.lastPregnantEffectTime=i.time),e.gestationTime<=0&&(ZO(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===ha&&(e.radius=Rt):e.hunger+=n*((nl*z_-nl)/(Ot/Gt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const f=i.entities.entities[e.motherId];f&&u.push(f)}if(e.fatherId){const f=i.entities.entities[e.fatherId];f&&u.push(f)}for(const f of u)if(f.age>=ug&&f.hunger>=V_&&G(e.position,f.position,i.mapDimensions.width,i.mapDimensions.height)<=K_){e.food.pop(),f.hunger=Math.max(0,f.hunger-Zo),e.feedParentCooldownTime=q_;break}}let l;if(e.hitpoints<=0?a<lo?l="hypothermia":e.hunger>=rn?l="hunger":l="killed":e.age>=e.maxAge&&(l="oldAge"),l){if(e.leaderId===e.id){const u=Wr(Mn(i,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeRole=ae.Leader,u.tribeControl=e.tribeControl??{roleWeights:{[ae.Leader]:0,[ae.Gatherer]:2,[ae.Planter]:2,[ae.Hunter]:2,[ae.Mover]:2,[ae.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}};const f=i;eu(i,e.id,u.id);const p=f.search.human.byProperty("leaderId",e.id);for(const v of p)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const m=f.search.building.byProperty("ownerId",e.id);for(const v of m)v.ownerId=u.id;for(const v of su(u,i))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const S=ql(i).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of S){const A=i.entities.entities[v.leaderId];if((d=A==null?void 0:A.tribeControl)!=null&&d.diplomacy){const I=A.tribeControl.diplomacy[e.id];I!==void 0&&(A.tribeControl.diplomacy[u.id]=I,delete A.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=Wr(Mn(i,e));u?(u.isPlayer=!0,i.generationCount++):(i.gameOver=!0,i.causeOfGameOver=l,Ul(i,{identifier:"no_heir",type:$r.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}VO(i.entities,e.position,e.gender,e.age,e.radius,e.id,i.time,e.food,e.hunger),Zr(i.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function FM(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/Z_);const i=Math.floor(_A*(1-e.decayProgress));e.food.length>i&&e.food.splice(i),e.decayProgress>=1&&e.food.length<=0&&Zr(t.gameState.entities,e.id)}function LM(e,t,n){const i=n*(Ot/Gt);e.age+=n/Iu,e.isAdult=e.age>=xI;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=Bu){const l=ZI*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};l.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,l.x)),l.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,l.y));const d=Math.random()<.5?"male":"female",u=e,f=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let p;if(f)p=JD(u.geneCode,f.geneCode);else{p=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}da(t.gameState.entities,l,d,0,GI*.5,p,e.id,e.fatherId,e.aiType),Ue(t.gameState,Ie.Procreation,e.position,Gl,e.id),Ne(t,Ee.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=i,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=UI&&(a=!0),a&&(KO(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Zr(t.gameState.entities,e.id))}function HM(e,t,n){const i=n*(Ot/Gt);e.age+=n/Iu,e.isAdult=e.age>=XI;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=Fu){const l=ZI*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};l.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,l.x)),l.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,l.y));const d=Math.random()<.5?"male":"female",u=e,f=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let p;if(f)p=sM(u.geneCode,f.geneCode);else{p=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}ua(t.gameState.entities,l,d,0,WI*.6,p,e.id,e.pregnancyFatherId,e.aiType),Ue(t.gameState,Ie.Procreation,e.position,Gl,e.id),Ne(t,Ee.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=i,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=i,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=$I&&(a=!0),a&&(qO(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Zr(t.gameState.entities,e.id))}var tr=(e=>(e[e.TaskBased=0]="TaskBased",e))(tr||{});const zv="Human Behavior",UM=1;class GM{constructor(){Re(this,"nodeData",new Map);Re(this,"pathStack",[]);Re(this,"startTimeStack",[])}nodeStart(t){this.pathStack.push(t),this.startTimeStack.push(performance.now())}nodeEnd(){if(this.startTimeStack.length===0||this.pathStack.length===0){console.error("BTProfiler: nodeEnd() called without a matching nodeStart().");return}const t=performance.now(),n=this.startTimeStack.pop(),i=t-n,s=this.pathStack.join(" > "),a=this.nodeData.get(s)??{path:s,totalTime:0,callCount:0,minTime:1/0,maxTime:-1/0};a.totalTime+=i,a.callCount++,a.minTime=Math.min(a.minTime,i),a.maxTime=Math.max(a.maxTime,i),this.nodeData.set(s,a),this.pathStack.pop()}report(t={}){const{showAll:n=!1}=t,i=Array.from(this.nodeData.values());if(i.length===0){console.log("--- Behavior Tree Profiler: No data collected. ---");return}let s=i,a="--- Behavior Tree Full Report ---";if(!n){const d=this.nodeData.get(zv);if(d){const u=d.totalTime*UM/100;s=i.filter(f=>f.totalTime>u&&f.path!==zv),a="--- Behavior Tree Problem Report ---"}else console.log('BTProfiler: Root node "Human Behavior" not found. Showing full report.'),a="--- Behavior Tree Full Report (Root Not Found) ---"}const l=s.sort((d,u)=>u.totalTime-d.totalTime);console.log(a),l.length>0?console.table(l.map(d=>({Path:d.path,"Total Time (ms)":d.totalTime.toFixed(3),Calls:d.callCount,"Avg Time (ms)":(d.totalTime/d.callCount).toFixed(3),"Min Time (ms)":d.minTime.toFixed(3),"Max Time (ms)":d.maxTime.toFixed(3)}))):console.log("No significant performance problems detected."),console.log("------------------------------------")}reset(){this.nodeData.clear(),this.pathStack=[],this.startTimeStack=[]}getNodeData(t){return this.nodeData.get(t)}}const nt=new GM;function qt(e){return Array.isArray(e)?e:[e,""]}class He extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{for(const a of this.children){const[l,d]=qt(a.execute(n,i,s));if(l!==R.SUCCESS)return this.setLastStatus(n,l),this.name&&_.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,d),l}return this.setLastStatus(n,R.SUCCESS),this.name&&_.recordNodeExecution(s,this.name,R.SUCCESS,i.gameState.time,this.depth,""),R.SUCCESS}finally{this.name&&nt.nodeEnd()}}}class ci extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{const a=this.getRunningChildIndex(n)??0;for(let l=a;l<this.children.length;l++){const d=this.children[l],[u,f]=qt(d.execute(n,i,s));if(u!==R.FAILURE){if(u===R.SUCCESS)return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,R.SUCCESS),this.name&&_.recordNodeExecution(s,this.name,R.SUCCESS,i.gameState.time,this.depth,f),R.SUCCESS;if(u===R.RUNNING)return this.setRunningChildIndex(n,l),this.setLastStatus(n,R.RUNNING),this.name&&_.recordNodeExecution(s,this.name,R.RUNNING,i.gameState.time,this.depth,f),R.RUNNING}}return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,R.FAILURE),this.name&&_.recordNodeExecution(s,this.name,R.FAILURE,i.gameState.time,this.depth,""),R.FAILURE}finally{this.name&&nt.nodeEnd()}}}class jv extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{let a=!0;for(const d of this.children){const[u,f]=qt(d.execute(n,i,s));u===R.FAILURE&&(a=!1),this.name&&_.recordNodeExecution(s,this.name,u,i.gameState.time,this.depth,f)}const l=a?R.SUCCESS:R.FAILURE;return this.setLastStatus(n,l),l}finally{this.name&&nt.nodeEnd()}}}class we extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.action=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{const[a,l]=qt(this.action(n,i,s));return this.setLastStatus(n,a),this.name&&_.recordNodeExecution(s,this.name,a,i.gameState.time,this.depth,l),a}finally{this.name&&nt.nodeEnd()}}}class De extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.condition=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{const[a,l]=qt(this.condition(n,i,s)),d=a?R.SUCCESS:R.FAILURE;return this.setLastStatus(n,d),this.name&&_.recordNodeExecution(s,this.name,d,i.gameState.time,this.depth,l),d}finally{this.name&&nt.nodeEnd()}}}class xM extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{const[a,l]=qt(this.child.execute(n,i,s));let d;switch(a){case R.SUCCESS:d=R.FAILURE;break;case R.FAILURE:d=R.SUCCESS;break;case R.RUNNING:default:d=a;break}return this.setLastStatus(n,d),this.name&&_.recordNodeExecution(s,this.name,d,i.gameState.time,this.depth,l),d}finally{this.name&&nt.nodeEnd()}}}class $M extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{const[,a]=qt(this.child.execute(n,i,s)),l=R.SUCCESS;return this.setLastStatus(n,l),this.name&&_.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,a),l}finally{this.name&&nt.nodeEnd()}}}class ks extends Nn{constructor(n,i,s,a=0){super();Re(this,"name");Re(this,"depth");Re(this,"startTimeKey");this.child=n,this.timeoutDurationHours=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.startTimeKey=`timeout_${this.name}_startTime`}execute(n,i,s){nt.nodeStart(this.name);try{const a=i.gameState.time;let l=_.get(s,this.startTimeKey);const[d,u]=qt(this.child.execute(n,i,s));if(d===R.RUNNING){l===void 0&&(_.set(s,this.startTimeKey,a),l=a);const f=a-l;if(f>this.timeoutDurationHours){_.delete(s,this.startTimeKey),this.setLastStatus(n,R.FAILURE);const m=`Timed out after ${f.toFixed(2)}h.`;return _.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m),this.getLastStatus(n)}this.setLastStatus(n,R.RUNNING);const p=`Running for ${f.toFixed(2)}h. ${u}`;return _.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,p),this.getLastStatus(n)}return l!==void 0&&_.delete(s,this.startTimeKey),this.setLastStatus(n,d),_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{nt.nodeEnd()}}}class xn extends Nn{constructor(n,i,s,a=0,l){super();Re(this,"name");Re(this,"depth");Re(this,"statusKey");Re(this,"timestampKey");this.child=n,this.cacheDurationHours=i,this.validityCheck=l,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.statusKey=`caching_${this.name}_status`,this.timestampKey=`caching_${this.name}_timestamp`}execute(n,i,s){nt.nodeStart(this.name);try{const a=i.gameState.time,l=_.get(s,this.statusKey),d=_.get(s,this.timestampKey);if(l!==void 0&&d!==void 0){const m=a-d>this.cacheDurationHours,S=this.validityCheck?this.validityCheck(n,i,s):!0;if(!m&&S){const v=(d+this.cacheDurationHours-a).toFixed(2),A=`Cache hit. Status: ${R[l]}. ${v}h left.`;return this.setLastStatus(n,l),_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,A),this.getLastStatus(n)}}const[u,f]=qt(this.child.execute(n,i,s));(u===R.SUCCESS||u===R.FAILURE)&&(_.set(s,this.statusKey,u),_.set(s,this.timestampKey,a)),this.setLastStatus(n,u);const p=`Cache miss. Child returned ${R[u]}. ${f}`;return _.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,p),this.getLastStatus(n)}finally{nt.nodeEnd()}}}class ma extends Nn{constructor(n,i,s,a=0){super();Re(this,"name");Re(this,"depth");Re(this,"cooldownKey");this.cooldownDurationHours=n,this.child=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.cooldownKey=`cooldown_${this.name}`}execute(n,i,s){nt.nodeStart(this.name);try{const a=i.gameState.time,l=_.get(s,this.cooldownKey);if(this.child.getLastStatus(n)===R.RUNNING){const[f,p]=qt(this.child.execute(n,i,s));if(this.setLastStatus(n,f),this.name){const m=`Continuing running child. ${p}`;_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m)}return this.getLastStatus(n)}if(l!==void 0&&a<l){const p=`Cooldown active, ${(l-a).toFixed(2)}h left`;return this.setLastStatus(n,R.FAILURE),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,p),this.getLastStatus(n)}const[d,u]=qt(this.child.execute(n,i,s));return d===R.SUCCESS&&_.set(s,this.cooldownKey,a+this.cooldownDurationHours),this.setLastStatus(n,d),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{nt.nodeEnd()}}}class Pn extends Nn{constructor(n,i,s,a=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.behaviorKey=i,this.name=s,this.depth=a;const l=(d,u)=>{d.depth=u,d.children?d.children.forEach(f=>l(f,u+1)):d.child&&l(d.child,u+1)};l(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{if(n.isPlayer&&!i.gameState.autopilotControls.behaviors[this.behaviorKey]){const u=`Player autopilot for '${this.behaviorKey}' is disabled.`;return this.setLastStatus(n,R.FAILURE),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,u),this.getLastStatus(n)}const[l,d]=qt(this.child.execute(n,i,s));return this.setLastStatus(n,l),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,d),this.getLastStatus(n)}finally{this.name&&nt.nodeEnd()}}}class WM extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,d)=>{l.depth=d,l.children?l.children.forEach(u=>a(u,d+1)):l.child&&a(l.child,d+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{if(n.isPlayer&&i.gameState.autopilotControls.isManuallyMoving)return this.setLastStatus(n,R.FAILURE),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Manual movement active, AI blocked."),this.getLastStatus(n);const[a,l]=qt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&nt.nodeEnd()}}}class Cs extends Nn{constructor(n,i,s=0){super();Re(this,"name");Re(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,d)=>{l.depth=d,l.children?l.children.forEach(u=>a(u,d+1)):l.child&&a(l.child,d+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&nt.nodeStart(this.name);try{if(n.isPlayer)return this.setLastStatus(n,R.FAILURE),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Player controlled, AI blocked."),this.getLastStatus(n);const[a,l]=qt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&nt.nodeEnd()}}}const Vo=24,iT=2,Hg=3;function Zt(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}class Fi extends Nn{constructor(n,i,s,a=0){super();Re(this,"name");Re(this,"depth");Re(this,"registeredKey");this.child=n,this.config=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.registeredKey=`${this.name}_registered`}execute(n,i,s){nt.nodeStart(this.name);try{const a=Zt(n,i.gameState);if(!a||!a.aiBlackboard){const[A,I]=qt(this.child.execute(n,i,s));return this.setLastStatus(n,A),_.recordNodeExecution(s,this.name,A,i.gameState.time,this.depth,`No coordination: ${I}`),A}const l=i.gameState.time,d=_.get(s,this.registeredKey)??!1,u=this.getTaskTarget(n,i,s);if(!u)return this.setLastStatus(n,R.FAILURE),_.recordNodeExecution(s,this.name,R.FAILURE,l,this.depth,"No task target found"),R.FAILURE;const f=this.getTaskKey(u);if(d){const[A,I]=qt(this.child.execute(n,i,s));return A===R.RUNNING?(this.refreshTaskTimestamp(a.aiBlackboard,f,n.id,l),this.setLastStatus(n,A),_.recordNodeExecution(s,this.name,A,l,this.depth,`Continuing: ${I}`),A):(this.removeFromTask(a.aiBlackboard,f,n.id),_.delete(s,this.registeredKey),this.setLastStatus(n,A),_.recordNodeExecution(s,this.name,A,l,this.depth,`Completed: ${I}`),A)}if(!this.canJoinTask(a.aiBlackboard,f,n.id,l)){this.setLastStatus(n,R.FAILURE);const A=_.get(a.aiBlackboard,f),I=(A==null?void 0:A.memberIds.length)??0,E=this.config.maxCapacity??1;return _.recordNodeExecution(s,this.name,R.FAILURE,l,this.depth,`Task full: ${I}/${E}`),R.FAILURE}if(!this.registerTask(a.aiBlackboard,f,n.id,l))return this.setLastStatus(n,R.FAILURE),_.recordNodeExecution(s,this.name,R.FAILURE,l,this.depth,"Failed to register task"),R.FAILURE;_.set(s,this.registeredKey,!0);const[S,v]=qt(this.child.execute(n,i,s));if(S===R.RUNNING){this.setLastStatus(n,S);const A=_.get(a.aiBlackboard,f),I=(A==null?void 0:A.memberIds.length)??0,E=this.config.maxCapacity??1;return _.recordNodeExecution(s,this.name,S,l,this.depth,`Started (${I}/${E}): ${v}`),S}else return this.removeFromTask(a.aiBlackboard,f,n.id),_.delete(s,this.registeredKey),this.setLastStatus(n,S),_.recordNodeExecution(s,this.name,S,l,this.depth,`Immediate result: ${v}`),S}finally{nt.nodeEnd()}}getTaskTarget(n,i,s){var l,d,u,f;if(this.config.taskType==="procreation")return((d=(l=this.config).getTargetId)==null?void 0:d.call(l,n,i,s))??null;const a=(f=(u=this.config).getTargetId)==null?void 0:f.call(u,n,i,s);return a??null}getTaskKey(n){return this.config.generateTaskKey?this.config.generateTaskKey(this.config.taskType,n):`tribal_${this.config.taskType}_${n}`}canJoinTask(n,i,s,a){const l=_.get(n,i);if(!l||a-l.startTime>Vo||l.memberIds.includes(s))return!0;const d=this.config.maxCapacity??1;return l.memberIds.length<d}registerTask(n,i,s,a){let l=_.get(n,i);return l?a-l.startTime>Vo?(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},_.set(n,i,l),!0):l.memberIds.length>=(this.config.maxCapacity??1)?!!l.memberIds.includes(s):(l.memberIds.includes(s)||(l.memberIds.push(s),_.set(n,i,l)),!0):(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},_.set(n,i,l),!0)}refreshTaskTimestamp(n,i,s,a){const l=_.get(n,i);l&&l.memberIds.includes(s)&&(l.startTime=a,_.set(n,i,l))}removeFromTask(n,i,s){const a=_.get(n,i);a&&(a.memberIds=a.memberIds.filter(l=>l!==s),a.memberIds.length===0?_.delete(n,i):_.set(n,i,a))}}function YM(e){return new He([new De((t,n)=>{const i=t.hunger>=oa,s=t.food.length>0,a=!t.eatingCooldownTime||n.gameState.time>=t.eatingCooldownTime;return[!!(i&&s&&a),`${Math.floor(t.hunger-oa)}, ${t.food.length}, ${t.eatingCooldownTime?Math.floor(t.eatingCooldownTime-n.gameState.time):""}`]},"Can Eat",e+1),new we(t=>(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",R.RUNNING),"Eat",e+1)],"Eating",e)}const Uu="tribe_logistics_demands";function Kr(e){return _.get(e,Uu)||[]}function oT(e,t,n,i){const s=Kr(e),a=s.find(l=>l.requesterId===t&&l.resourceType===n);if(a)a.updatedAt=i;else{const l={requesterId:t,resourceType:n,updatedAt:i};s.push(l)}_.set(e,Uu,s)}function zM(e,t,n,i,s){const a=Kr(e),l=a.find(d=>d.requesterId===t&&d.resourceType===n);return l&&!l.claimedBy?(l.updatedAt=s,l.claimedBy=i,_.set(e,Uu,a),!0):!1}function jM(e){return Kr(e).filter(n=>!n.claimedBy).sort((n,i)=>n.updatedAt-i.updatedAt)}function rT(e,t,n){let i=Kr(e);i=i.filter(s=>!(s.requesterId===t&&s.resourceType===n)),_.set(e,Uu,i)}function sT(e,t,n){return Kr(e).find(s=>s.requesterId===t&&s.resourceType===n)}function Yn(e,t,n){return Gu(e,n)?e.tribeRole===t:!0}function Gu(e,t){if(!e.leaderId)return!1;const n=t.entities.entities[e.leaderId];return!n||!n.tribeControl?!1:t.search.human.byProperty("leaderId",n.id).filter(s=>s.isAdult).length>=jP}function XM(e){return new He([new De((n,i)=>{if(!!!n.leaderId||!Gu(n,i.gameState))return!1;const a=n.id===n.leaderId,l=Yn(n,ae.Warrior,i.gameState)||Yn(n,ae.Hunter,i.gameState),d=!n.isAdult&&(!n.fatherId||!i.gameState.entities.entities[n.fatherId])&&(!n.motherId||!i.gameState.entities.entities[n.motherId]);return a||l||d},"Demand eligible?",e+1),new we((n,i)=>{const s=Zt(n,i.gameState);if(!s||!s.aiBlackboard)return[R.NOT_EVALUATED,"No leader for coordination"];if(n.food.length<n.maxFood*.5){oT(s.aiBlackboard,n.id,"food",i.gameState.time);const a=sT(s.aiBlackboard,n.id,"food");if(a&&a.claimedBy){const l=i.gameState.entities.entities[a.claimedBy];if(!l||l.type!=="human")return[R.NOT_EVALUATED,"Supplier not found or invalid"];const d=G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return d>aR?[R.NOT_EVALUATED,`Supplier too far (${d.toFixed(1)}px), waiting`]:d<=ze?(n.activeAction="retrieving",n.target=l.id,[R.RUNNING,`Retrieving from supplier ${l.id}`]):(n.target=l.id,n.activeAction="moving",[R.RUNNING,`Moving to supplier ${l.id}, distance: ${d.toFixed(1)}`])}return[R.NOT_EVALUATED,"Waiting for supplier"]}return[R.NOT_EVALUATED,"No demand needed"]},"Create Demand",e+1)],"Demand",e)}const Ug=400,VM=25;function Xv(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function KM(e,t,n=Ug){return t.search.building.byRadius(e.position,n).some(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed&&l.storageCapacity&&l.storedItems.length<l.storageCapacity})}function qM(e,t,n=Ug,i,s){return t.search.building.byRadius(e.position,n).filter(d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===e.leaderId&&u.isConstructed&&u.storedItems.filter(f=>f.item.itemType==="food").length>0}).filter(d=>{if(i){const u=`tribal_storage_${d.id}`,f=_.get(i,u);if(f&&f.memberIds.length>=Hg&&(!s||!f.memberIds.includes(s)))return!1}return!0})}function ZM(e,t,n=Ug){return t.search.building.byRadius(e.position,n).filter(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed})}function aT(e,t,n){if(t.length===0)return null;let i=null,s=1/0;for(const a of t){const l=G(e.position,a.position,n.mapDimensions.width,n.mapDimensions.height);l<s&&(s=l,i=a)}return i?{storage:i,distance:s}:null}function lT(e){const t=e.storedItems.length,n=Xv(t+e.id)*2*Math.PI,i=Xv(t+e.id+1)*VM;return{x:Math.cos(n)*i,y:Math.sin(n)*i}}const Vv="FINDING_DEMAND",Kv="RETRIEVING_FROM_STORAGE",qv="DELIVERING_TO_DEMANDER",Gd="supply_phase",Wp="supply_targetDemanderId",cT="supply_targetStorageId",xd="supply_targetResourceType";function Pi(e){e.aiBlackboard&&(_.delete(e.aiBlackboard,Gd),_.delete(e.aiBlackboard,Wp),_.delete(e.aiBlackboard,cT),_.delete(e.aiBlackboard,xd))}function QM(e){return new we((t,n)=>{var a;if(!Gu(t,n.gameState))return Pi(t),[R.FAILURE,"Tribe roles not effective"];if(!Yn(t,ae.Mover,n.gameState))return Pi(t),[R.FAILURE,"Not a Mover"];const i=Zt(t,n.gameState);if(!i||!i.aiBlackboard)return Pi(t),[R.FAILURE,"No leader or blackboard"];if(!t.aiBlackboard)return[R.FAILURE,"No AI blackboard"];const s=_.get(t.aiBlackboard,Gd)||Vv;if(s===Vv){const l=jM(i.aiBlackboard).filter(f=>f.requesterId!==t.id);if(l.length===0)return[R.FAILURE,"No unclaimed demands"];const d=l[0];return zM(i.aiBlackboard,d.requesterId,d.resourceType,t.id,n.gameState.time)?(_.set(t.aiBlackboard,Wp,d.requesterId),_.set(t.aiBlackboard,xd,d.resourceType),_.set(t.aiBlackboard,Gd,Kv),[R.RUNNING,`Claimed ${d.resourceType} demand for ${d.requesterId}, moving to retrieval phase`]):(Pi(t),[R.FAILURE,"Failed to claim demand"])}if(s===Kv){const l=_.get(t.aiBlackboard,xd),d=l==="food"&&t.food.length>0,u=l==="wood"&&((a=t.heldItem)==null?void 0:a.type)===At.Wood;if(d||u)return _.set(t.aiBlackboard,Gd,qv),[R.RUNNING,`${l} retrieved, moving to delivery phase`];const f=ZM(t,n.gameState,400).filter(v=>l==="food"?v.storedItems.some(A=>A.item.itemType==="food"):l==="wood"?v.storedItems.some(A=>A.item.type===At.Wood):!1);if(f.length===0)return[R.FAILURE,`No storage with ${l} found nearby`];const p=aT(t,f,n.gameState);if(!p)return Pi(t),[R.FAILURE,"Could not find closest storage"];const{storage:m,distance:S}=p;return _.set(t.aiBlackboard,cT,m.id),S<=Kt?(t.activeAction="retrieving",t.target=m.id,[R.RUNNING,`Retrieving from storage ${m.id}`]):(t.target=m.id,t.activeAction="moving",[R.RUNNING,`Moving to storage ${m.id}, distance: ${S.toFixed(1)}`])}if(s===qv){const l=_.get(t.aiBlackboard,xd)||"food",d=_.get(t.aiBlackboard,Wp);if(!d)return Pi(t),[R.FAILURE,"Demander ID not found in blackboard"];const u=sT(i.aiBlackboard,d,l);if(!u||u.claimedBy!==t.id)return Pi(t),[R.FAILURE,"Demand not found"];const f=n.gameState.entities.entities[d];if(!f)return Pi(t),[R.FAILURE,"Demander not found"];if(l==="food"?t.food.length===0:!t.heldItem)return Pi(t),[R.SUCCESS,`Successfully delivered ${l} to ${d}`];const m=G(t.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),S=f.type==="building"&&f.buildingType===ue.Bonfire?Kt:ze;return m<=S?(t.activeAction="depositing",l==="food"&&(t.activeActionPayload={amount:Math.min(f.maxFood/2||1,t.food.length||1)}),t.target=f.id,[R.RUNNING,`Delivering to demander ${f.id}`]):(t.target=f.id,t.activeAction="moving",[R.RUNNING,`Moving to demander ${f.id}, distance: ${m.toFixed(1)}`])}return Pi(t),[R.FAILURE,"Unknown supply phase"]},"Supply",e)}function JM(e){return new He([new De((t,n,i)=>{if(t.isAdult&&t.hitpoints>t.maxHitpoints*Jd||!(t.hitpoints<t.maxHitpoints*.1)&&t.isAdult&&t.hunger>TR)return!1;const a=jA(t.id,n.gameState);return a?(_.set(i,"fleeThreat",a.id),!0):!1},"Should Flee",e+1),new we((t,n,i)=>{const s=_.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return R.FAILURE;t.activeAction="moving";const l=Xe(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=mt(l),u=ri(t.position,_t(d,Np));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=d,R.RUNNING},"Execute Flee",e+1)],"Flee",e)}const Ir="resourceSource";function eN(e){const t=new we((i,s,a)=>{const l=Zt(i,s.gameState),d=l?$l(l.id,s.gameState):0,u=i.hunger>mv,f=Mn(s.gameState,i).filter(I=>I.hunger>na),p=u||f.length>0,m=Yn(i,ae.Gatherer,s.gameState),S=()=>{const I=xe(i,s.gameState,"berryBush",zh,P=>{if(P.food.length===0||i.leaderId&&!Wn(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const C=`tribal_gather_${P.id}`,w=_.get(l.aiBlackboard,C);if(w&&s.gameState.time-w.startTime<=Vo&&!w.memberIds.includes(i.id))return!1}return!0}),E=xe(i,s.gameState,"corpse",zh,P=>{if(P.food.length===0||i.leaderId&&!Wn(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const C=`tribal_gather_${P.id}`,w=_.get(l.aiBlackboard,C);if(w&&s.gameState.time-w.startTime<=Vo&&!w.memberIds.includes(i.id))return!1}return!0});if(I&&E){const P=G(i.position,I.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height),C=G(i.position,E.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);return P<=C?I:E}return I||E},v=()=>xe(i,s.gameState,"tree",zh,I=>{if(I.stateMachine[0]!==xt||I.wood.length===0||i.leaderId&&!Wn(I.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const E=`tribal_gather_${I.id}`,P=_.get(l.aiBlackboard,E);if(P&&s.gameState.time-P.startTime<=Vo&&!P.memberIds.includes(i.id))return!1}return!0});let A=null;return p&&i.food.length<i.maxFood?A=S():d>0&&!i.heldItem?A=v():m&&(i.heldItem||(A=v()),!A&&i.food.length<i.maxFood&&(A=S())),A?(_.set(a,Ir,A.id),[R.SUCCESS,`Found ${A.type}: ${A.id} at ${A.position.x.toFixed(0)},${A.position.y.toFixed(0)}`]):[R.FAILURE,"No resource found"]},"Find Closest Resource Source",e+4),n=new Fi(new we((i,s,a)=>{const l=_.get(a,Ir);if(!l)return[R.FAILURE,"No target in blackboard"];const d=s.gameState.entities.entities[l];return d?(d.type==="tree"&&"wood"in d?d.wood.length===0:d.food.length===0)?(_.delete(a,Ir),[R.FAILURE,"Resource source is depleted"]):G(i.position,d.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<xr?(i.activeAction="gathering",i.direction={x:0,y:0},i.target=d.id,_.delete(a,Ir),[R.SUCCESS,`Gathering from ${d.type}`]):(i.activeAction="moving",i.target=d.id,i.direction=We(i.position,d.position,s.gameState.mapDimensions),[R.RUNNING,`Moving to ${d.type}`]):(_.delete(a,Ir),[R.FAILURE,"Resource source is invalid"])},"Move To Resource and Gather",e+3),{taskType:"gather",maxCapacity:2,getTargetId:(i,s,a)=>_.get(a,Ir)??null},"Tribal Gather Task",e+3);return new He([new De((i,s)=>{const a=Zt(i,s.gameState),l=a?$l(a.id,s.gameState):0,d=i.food.length<i.maxFood,u=!i.heldItem,f=i.hunger>mv,p=Mn(s.gameState,i).filter(I=>I.hunger>na),m=Yn(i,ae.Gatherer,s.gameState),S=KM(i,s.gameState),v=d&&(f||p.length>0||m&&S),A=u&&(l>0||m&&S);return[(i.isAdult&&(v||A))??!1,`${f?"Hungry ":""}${p.length>0?"Children("+p.length+") ":""}${l>0?"WoodNeed("+l+") ":""}${A&&l<=0?"Wood ":""}${S?"Storage":""}`]},"Should Gather Resources",e+1),new ci([new He([new De((i,s,a)=>_.has(a,Ir),"Has Resource Source?",e+2),n],"Continue Gathering Action",e+2),new He([new xn(t,RR,"Cache Resource Source Search",e+3),n],"Find New Resource Source and Gather",e+2)],"Perform or Start Gathering",e+1)],"Gather Resources",e)}const tN=.5;function nN(e){return new we((t,n,i)=>{const{gameState:s}=n,{width:a,height:l}=s.mapDimensions;let d=_.get(i,"wanderTarget");const u=_.get(i,"lastWanderTime")??0,f=s.time;if(!d||f-u>tN||G(t.position,d,a,l)<20){const m=vg(t.position,vR,a,l);t.leaderId?Bp(m,t.leaderId,s)?d=m:d=n1(t.position,m,t.leaderId,s):d=m,_.set(i,"wanderTarget",d),_.set(i,"lastWanderTime",f)}if(d&&G(t.position,d,a,l)>10){t.activeAction="moving",t.target=d;let S=d.x-t.position.x,v=d.y-t.position.y;return Math.abs(S)>a/2&&(S=S>0?S-a:S+a),Math.abs(v)>l/2&&(v=v>0?v-l:v+l),t.direction=mt({x:S,y:v}),R.RUNNING}return t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,R.SUCCESS},"Idle/Wander",e)}const Sd="procreationWanderStartTime",Zv=(e,t,n)=>t.find(i=>ir(e,i,n)),Qv={taskType:"procreation",maxCapacity:2,getTargetId:(e,t,n)=>_.get(n,"procreationPartner")??null};function iN(e){const t=new De((a,l,d)=>{const u=Ov(a,l.gameState,xr),f=Zv(a,u,l.gameState);return f?(_.set(d,"procreationPartner",f.id),!0):[!1,"No immediate partner found"]},"Find Immediate Partner"),n=new Fi(new we((a,l,d)=>{var p;const u=_.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=void 0,_.delete(d,"procreationPartner"),_.delete(d,Sd),(p=a.partnerIds)!=null&&p.includes(f.id)||(a.partnerIds=a.partnerIds?[...a.partnerIds,f.id]:[f.id]),R.SUCCESS):R.FAILURE},"Start Procreating"),Qv,"Tribal Start Procreating",e+2),i=new De((a,l,d)=>{const u=Ov(a,l.gameState,IR),f=Zv(a,u,l.gameState);return f?(_.set(d,"procreationPartner",f.id),!0):[!1,"No distant partner found"]},"Locate Distant Partner"),s=new Fi(new we((a,l,d)=>{const u=_.get(d,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return[R.FAILURE,"No partner found"];if(f.isPregnant)return[R.FAILURE,"Partner is pregnant"];if(a.hunger>sn)return[R.FAILURE,"Too hungry to procreate"];const p=G(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);if(p<xr)return[R.SUCCESS,"Reached partner"];if(a.leaderId&&!Wn(f.position,a.leaderId,l.gameState))return[R.FAILURE,"Partner out of operating range"];a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=mt(m),[R.RUNNING,`${p.toFixed(1)} units away`]},"Move Towards Partner"),Qv,"Tribal Move To Partner",e+3);return new He([new De(a=>!a.isAdult||a.gender==="female"&&a.isPregnant?[!1,"Not adult or pregnant"]:a.age<Hl||a.gender==="female"&&a.age>Eu?[!1,"Not fertile due to age or pregnancy status"]:a.hunger>=sn?[!1,"Too hungry"]:!0,"Is Fertile (age, not pregnant)",e+1),new De(a=>a.hunger<sn,"Is Healthy (hunger)",e+1),new De(a=>(a.procreationCooldown||0)<=0,"Is Ready (cooldown)",e+1),new ci([new He([new De((a,l)=>{const d=Tv(a.position,l.gameState,"berryBush",yv);return[d>=AR,`Found ${d} bushes`]},"Is Environment Viable (food)",e+3),new we((a,l,d)=>(_.delete(d,Sd),R.SUCCESS),"Clear Wander Timer",e+3)],"Sufficient Food Path",e+2),new He([new De((a,l)=>{const d=Mn(l.gameState,a);return Wr(d)?[!1,"Has an heir"]:!0},"Is Male Without Heir",e+3),new we((a,l,d)=>{const u=_.get(d,Sd);if(u===void 0)return _.set(d,Sd,l.gameState.time),[R.FAILURE,"Starting heirless wander timer"];const f=l.gameState.time-u;return f>=$_?Tv(a.position,l.gameState,"berryBush",yv)>=1?[R.SUCCESS,`Wandered for ${f.toFixed(1)}h, minimum food found`]:[R.FAILURE,"Desperate but no food sources nearby"]:[R.FAILURE,`Wandering for heir, ${f.toFixed(1)}h elapsed`]},"Check Wander Timer",e+3)],"Heirless Desperation Path",e+2)],"Check Environment Or Desperation",e+1),new De((a,l,d)=>{var f;const u=_.get(d,"procreationPartner");return u&&((f=u.partnerIds)!=null&&f.length)&&!u.partnerIds.includes(a.id)&&a.leaderId!==a.id&&a.leaderId&&u.partnerIds.map(p=>l.gameState.entities.entities[p]).filter(p=>!!p).some(p=>G(a.position,p.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<FR)?[!1,"Partner's primary partner is too close"]:!0},"Is Partner's Primary Partner Nearby",e+1),new ci([new He([t,n],"Procreate With Immediate Partner",e+2),new ma(wR,new He([i,s,n],"Seek Distant Partner Action",e+3),"Seek Distant Partner Cooldown",e+2)],"Find Partner And Procreate",e+1)],"Procreate",e)}const ws="attackTarget",Tr="homeCenter",op=150;function oN(e){return new He([new De((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.hitpoints>0&&G(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=op){if(_.set(i,ws,l.id),!_.get(i,Tr)){const d=t.leaderId?vn(t.leaderId,s):xl(t,s).length>0?gv(t,s):t.position;_.set(i,Tr,d)}return!0}}if(!Yn(t,ae.Warrior,s))return[!1,"Not a Warrior"];const a=xe(t,s,"human",op,l=>l.hitpoints>0&&Xr(t,l,s));if(a){_.set(i,ws,a.id);const l=t.leaderId?vn(t.leaderId,s):xl(t,s).length>0?gv(t,s):t.position;return _.set(i,Tr,l),!0}return _.set(i,ws,void 0),_.set(i,Tr,void 0),!1},"Find Attack Target",e+1),new we((t,n,i)=>{const s=_.get(i,ws),a=s&&n.gameState.entities.entities[s],l=_.get(i,Tr);if(!a||!l)return R.FAILURE;const{gameState:d}=n;return G(t.position,l,d.mapDimensions.width,d.mapDimensions.height)>DA?(t.activeAction="idle",t.attackTargetId=void 0,_.set(i,ws,void 0),_.set(i,Tr,void 0),R.FAILURE):a.hitpoints<=0||G(t.position,a.position,d.mapDimensions.width,d.mapDimensions.height)>op?(t.activeAction==="attacking"&&(t.activeAction="idle",t.attackTargetId=void 0),_.set(i,ws,void 0),_.set(i,Tr,void 0),R.SUCCESS):(t.activeAction==="attacking"&&t.attackTargetId===a.id||(t.activeAction="attacking",t.attackTargetId=a.id),R.RUNNING)},"Execute Attack",e+1)],"Attack",e)}const rN=(e,t,n)=>{const i=Mn(t.gameState,e).filter(l=>!l.isAdult);if(i.length===0)return R.FAILURE;let s=null,a=na;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(_.set(n,"targetChild",s.id),R.SUCCESS):R.FAILURE},sN=(e,t,n)=>{const i=_.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?G(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>Cu?(e.activeAction="moving",e.target=s.id,e.direction=We(e.position,s.position,t.gameState.mapDimensions),R.RUNNING):(e.activeAction="feeding",e.target=void 0,_.set(n,"targetChild",void 0),R.SUCCESS):R.FAILURE};function aN(e){return new He([new De(t=>(t.isAdult&&t.food.length>0&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child",e+1),new we(rN,"Find Hungriest Child",e+1),new we(sN,"Move To Child and Feed",e+1)],"Feed Child",e)}function lN(e){return new He([new De(t=>!t.isAdult&&t.hunger>=na,"Is Hungry Child",e+1),new we((t,n,i)=>{const s=mP(t,n.gameState);if(s.length===0)return R.FAILURE;const a=xe(t,n.gameState,"human",X_,l=>s.some(d=>d.id===l.id)&&l.food.length>0);return a?(_.set(i,"targetParent",a.id),R.SUCCESS):R.FAILURE},"Find Parent With Food",e+1),new we((t,n,i)=>{const s=_.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return R.FAILURE;const l=G(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=Cu?(t.target=void 0,R.SUCCESS):(t.target=a.id,t.activeAction="moving",R.RUNNING)},"Move To Parent",e+1)],"Seek Food From Parent",e)}const Er="plantingSpot",_s="plantingZoneId",cN=50;function dN(e,t,n,i){const s=Xe(e,t,n,i);return ri(e,s)}function uN(e){const t=new we((s,a,l)=>{const d=_.get(l,Er);if(!d)return _.delete(l,Er),_.delete(l,_s),[R.FAILURE,"Planting spot is missing"];if(Bi(a.gameState.soilDepletion,d,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height))return _.delete(l,Er),_.delete(l,_s),[R.FAILURE,"Soil is depleted at planting spot"];if(zn(d,a.gameState,qo,s.id))return _.delete(l,Er),_.delete(l,_s),[R.FAILURE,"Planting spot is occupied"];const u=dN(s.position,d,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height),f=G(s.position,u,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height);return f>xr?(s.activeAction="moving",s.target=u,s.direction=We(s.position,u,a.gameState.mapDimensions),[R.RUNNING,"Moving to planting spot: "+f.toFixed(2)+" units away"]):zn(d,a.gameState,qo,s.id)?(_.delete(l,Er),_.delete(l,_s),[R.FAILURE,"Planting spot is now occupied"]):(s.activeAction="planting",s.target=d,[R.RUNNING,"Planting state initiated"])},"Move To Spot and Plant",e+4),n=new Fi(t,{taskType:"plant",maxCapacity:2,proximityRadius:cN,getTargetId:(s,a,l)=>_.get(l,_s)??null},"Coordinated Planting",e+3),i=new we((s,a,l)=>{const d=DP(s,a.gameState);return d?(_.set(l,Er,d.position),_.set(l,_s,d.zoneId),[R.SUCCESS,`Found new spot at ${d.position.x.toFixed(0)}, ${d.position.y.toFixed(0)} (Zone ${d.zoneId})`]):[R.FAILURE,"No suitable planting spot found"]},"Find Optimal Planting Spot",e+3);return new He([new De((s,a)=>{if(!Yn(s,ae.Planter,a.gameState))return[!1,"Not a Planter"];const l=s.food.filter(f=>f.type===An.Berry).length>=uo,d=s.hunger<gR,u=(s.isAdult&&l&&d)??!1;return[u,u?"Can plant":`Cannot plant: adult=${s.isAdult}, berries=${s.food.filter(f=>f.type===An.Berry).length}/${uo}, hunger=${s.hunger.toFixed(0)}`]},"Can Plant",e+1),new De((s,a)=>{if(!s.leaderId)return[!1,"No tribe"];const l=EP(s,a.gameState),{count:d,ratio:u}=yI(s.leaderId,a.gameState);let f;return l<bA?f=HR:l<OA?f=UR:l<kA?f=GR:f=xR,[u<f||d<=Hs,`Food security: ${(l*100).toFixed(0)}%, Bush density: ${u.toFixed(1)}/${f}`]},"Needs More Bushes (Adaptive)",e+1),new De((s,a)=>{if(!s.leaderId)return[!0,"No tribe coordination needed"];const l=jn(s,a.gameState),d=II(s.leaderId,a.gameState,"planting"),u=Math.max(1,Math.ceil(l.length*.3));return[d<u,`Active planters: ${d}/${u}`]},"Not Too Many Planters",e+1),new ci([new He([new De((s,a,l)=>_.has(l,Er),"Has Planting Spot?",e+2),n],"Continue Planting Action",e+2),new ma(_R,i,"Find Planting Spot Cooldown",e+2)],"Perform or Start Planting",e+1)],"Plant Bush",e)}const Jv="lastDepositTime",Rs="assignedStorageSpot";function fN(e){return new ci([new He([new De((t,n,i)=>{var d;const s=((d=t.heldItem)==null?void 0:d.type)===At.Wood;if(!t.isAdult)return[!1,"Not an adult"];if(!t.leaderId)return[!1,"No tribe"];let a=null,l="";if(s)a=PP(t,n.gameState),l=`Holding wood${a?` (Target: ${a.id})`:""}`;else{if(!Yn(t,ae.Gatherer,n.gameState)&&!Yn(t,ae.Mover,n.gameState)&&!Yn(t,ae.Hunter,n.gameState))return[!1,"Not a Gatherer/Mover/Hunter and not holding wood"];const u=_.get(i,Jv)||0,f=n.gameState.time-u;if(f<vv)return[!1,`Cooldown: ${(vv-f).toFixed(1)}h remaining`];const p=gI(t.leaderId,n.gameState);let m;p<.3?m=$R:p<.7?m=WR:m=YR;const S=t.food.length/t.maxFood;if(S<=m)return[!1,`Food ${(S*100).toFixed(0)}% < threshold ${(m*100).toFixed(0)}%`];a=AI(t,n.gameState),l=`Storage util: ${(p*100).toFixed(0)}%, Personal: ${(S*100).toFixed(0)}%`}return a?(_.set(i,Rs,a.id),[!0,l]):[!1,"No available tribe storage nearby"]},"Check for Excess Food and Storage",e+1),new De((t,n)=>{if(!t.leaderId)return[!0,"No tribe coordination needed"];const i=II(t.leaderId,n.gameState,"depositing"),s=jn(t,n.gameState),a=aa(t.leaderId,n.gameState).length,l=Math.max(2,Math.ceil(s.length*.4)+a);return[i<l,`Active depositors: ${i}/${l}`]},"Not Too Many Depositors",e+1),new Fi(new we((t,n,i)=>{var d,u;const s=_.get(i,Rs);if(!s)return[R.FAILURE,"No storage assigned"];const a=n.gameState.entities.entities[s];if(!a)return _.delete(i,Rs),[R.FAILURE,"Storage entity missing"];if((((d=a.storedItems)==null?void 0:d.length)??0)>=(a.storageCapacity??0))return _.delete(i,Rs),[R.FAILURE,"Storage full"];const l=G(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l<=Kt){t.activeAction="depositing",t.target=void 0,_.set(i,Jv,n.gameState.time),_.delete(i,Rs);const f=((u=t.heldItem)==null?void 0:u.type)===At.Wood;return[R.SUCCESS,f?"Depositing wood":"Depositing food"]}return t.activeAction="moving",t.target=a.position,[R.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`]},"Navigate to Storage and Deposit",e+2),{taskType:"storage",maxCapacity:Hg,storageAction:"deposit",getTargetId:(t,n,i)=>_.get(i,Rs)??null},"Tribal Storage Deposit Task",e+1)],"Deposit Sequence",e)],"Storage Deposit Behavior",e)}const Ad="retrievalStorageId";function hN(e){return new ci([new He([new De((t,n,i)=>{if(t.hunger<=oa)return[!1,"Not hungry enough"];if(t.food.length>=t.maxFood)return[!1,"Inventory full"];const s=Zt(t,n.gameState),a=qM(t,n.gameState,void 0,s==null?void 0:s.aiBlackboard,t.id),l=aT(t,a,n.gameState),d=l==null?void 0:l.storage;return d?(_.set(i,Ad,d.id),[!0,`Storage with food found at distance ${l.distance.toFixed(1)}`]):[!1,"No tribe storage with food nearby"]},"Check for Hunger and Storage Food",e+1),new Fi(new we((t,n,i)=>{const s=_.get(i,Ad);if(!s)return[R.FAILURE,"No storage target"];const a=n.gameState.entities.entities[s];if(!a)return _.delete(i,Ad),[R.FAILURE,"Storage not found"];const l=G(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=Kt?(t.activeAction="retrieving",t.target=void 0,[R.SUCCESS,"Retrieving food"]):(t.activeAction="moving",t.target=a.position,[R.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`])},"Navigate to Storage and Retrieve",e+2),{taskType:"storage",maxCapacity:Hg,storageAction:"retrieve",getTargetId:(t,n,i)=>_.get(i,Ad)??null},"Coordinated Storage Retrieve",e+1)],"Retrieve Sequence",e)],"Storage Retrieve Behavior",e)}const rp="combatTarget",sp="homeCenter";function pN(e){const t=new De(a=>a.isAdult&&a.leaderId?a.id!==a.leaderId:!1,"Is Tribe Follower?",e+1),n=new De(a=>a.hunger<mR&&a.hitpoints>=a.maxHitpoints*Jd,"Is Fit for Combat?",e+1),i=new we((a,l,d)=>{const{gameState:u}=l,f=u.entities.entities[a.leaderId];if(!f)return R.FAILURE;const p=UP(f,u,ER);if(p.length===0)return R.FAILURE;p.sort((m,S)=>{const v=G(a.position,m.position,u.mapDimensions.width,u.mapDimensions.height),A=G(a.position,S.position,u.mapDimensions.width,u.mapDimensions.height);return v-A});for(const m of p)if(GP(f.id,m.id,u)<PA){_.set(d,rp,m.id);const v=vn(f.id,u);return _.set(d,sp,v),R.SUCCESS}return R.FAILURE},"Find Best Target",e+1),s=new we((a,l,d)=>{const u=_.get(d,rp),f=u&&l.gameState.entities.entities[u],p=_.get(d,sp);if(!f||!p)return R.FAILURE;const{gameState:m}=l;return G(a.position,p,m.mapDimensions.width,m.mapDimensions.height)>DA?(a.activeAction==="attacking"&&a.attackTargetId===f.id&&(a.activeAction="idle",a.attackTargetId=void 0),_.set(d,rp,void 0),_.set(d,sp,void 0),R.FAILURE):((!a.lastTargetAcquiredEffectTime||l.gameState.time-a.lastTargetAcquiredEffectTime>Ke*5)&&(Ue(l.gameState,Ie.TargetAcquired,a.position,Ke,a.id),a.lastTargetAcquiredEffectTime=l.gameState.time),a.activeAction="attacking",a.attackTargetId=f.id,a.target=void 0,R.RUNNING)},"Attack Target",e+1);return new He([t,n,i,s],"Tribe Member Combat",e)}function gN(e){const t=new De((M,D)=>!M.leaderId||M.leaderId!==M.id?[!1,"Not a tribe leader"]:Mn(D.gameState,M).length<Pg?[!1,"Leader has no children"]:[!0,"Is tribe leader"],"Is Leader",e+1),n=new we((M,D,N)=>{const k=jn(M,D.gameState),U=k.filter(Y=>Y.isAdult),z=pa(M.leaderId,D.gameState,!0),K=Mu(M,D.gameState,!0).filter(Y=>vI(Y,D.gameState)),X=gI(M.leaderId,D.gameState),{count:J,ratio:q}=yI(M.leaderId,D.gameState),re=K.length/Math.max(1,k.length),se=Math.ceil(U.length*(1+jR)),ie=aa(M.leaderId,D.gameState,!0);return _.set(N,"tribeAnalysis_adultCount",U.length),_.set(N,"tribeAnalysis_existingStorageSpots",z.length),_.set(N,"tribeAnalysis_existingPlantingZones",K.length),_.set(N,"tribeAnalysis_existingBonfires",ie.length),_.set(N,"tribeAnalysis_storageUtilization",X),_.set(N,"tribeAnalysis_bushCount",J),_.set(N,"tribeAnalysis_bushDensity",q),_.set(N,"tribeAnalysis_zoneDensity",re),_.set(N,"tribeAnalysis_projectedAdultCount",se),[R.SUCCESS,`Analyzed tribe: ${U.length} adults, ${z.length} storage, ${K.length} viable planting zones, ${ie.length} bonfires`]},"Analyze Tribe",e+1),i=new xn(n,1,"Cached Tribe Analysis",e+1),s=new De((M,D,N)=>{const k=_.get(N,"tribeAnalysis_adultCount");return k===void 0?[!1,"No tribe analysis available"]:k<Sv?[!1,`Tribe too small: ${k}/${Sv} adults`]:[!0,`Tribe size sufficient: ${k} adults`]},"Has Minimum Tribe Size",e+1),a=new De((M,D,N)=>{if(_.has(N,"buildingPlacement_storageTarget"))return[!0,"Placement already in progress"];const k=_.get(N,"tribeAnalysis_adultCount"),U=_.get(N,"tribeAnalysis_existingStorageSpots"),z=_.get(N,"tribeAnalysis_storageUtilization"),K=_.get(N,"tribeAnalysis_projectedAdultCount");if(k===void 0||U===void 0||z===void 0||K===void 0)return[!1,"No tribe analysis available"];const X=U===0,J=z*(K/Math.max(1,k));return X||z>bp||J>bp?[!0,X?"Bootstrap: First storage spot":`Utilization: ${(z*100).toFixed(0)}% (projected: ${(J*100).toFixed(0)}%)`]:[!1,`Storage adequate: ${U}, util: ${(z*100).toFixed(0)}%`]},"Needs Storage",e+2),l=new we((M,D,N)=>{if(_.has(N,"buildingPlacement_storageTarget"))return[R.SUCCESS,"Using existing storage placement target"];const k=_.get(N,"tribeAnalysis_existingStorageSpots");if(k===void 0)return[R.FAILURE,"No tribe analysis available"];const z=k===0?BA:Xs,K=Vs(ue.StorageSpot,M.id,D.gameState,Qi,z,M.position);return K?(_.set(N,"buildingPlacement_storageTarget",K),[R.SUCCESS,`Found storage location at (${K.x.toFixed(0)}, ${K.y.toFixed(0)})`]):[R.FAILURE,`No valid location found for storage within ${Qi}px`]},"Find Storage Location",e+2),d=new we((M,D,N)=>{const k=_.get(N,"buildingPlacement_storageTarget");if(!k)return[R.FAILURE,"No target location in blackboard"];const U=G(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U<=Ji?[R.SUCCESS,`Reached storage location (${U.toFixed(0)}px away)`]:(M.activeAction="moving",M.target=k,M.direction=We(M.position,k,D.gameState.mapDimensions),[R.RUNNING,`Moving to storage location (${U.toFixed(0)}px away)`])},"Move To Storage Location",e+2),u=new we((M,D,N)=>{const k=_.get(N,"buildingPlacement_storageTarget");if(!k)return[R.FAILURE,"No target location in blackboard"];const U=G(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U>Ji?[R.FAILURE,`Too far from placement location: ${U.toFixed(0)}px`]:(Xo(k,ue.StorageSpot,M.id,D.gameState),_.delete(N,"buildingPlacement_storageTarget"),_.delete(N,"caching_Cached Tribe Analysis_status"),_.delete(N,"caching_Cached Tribe Analysis_timestamp"),delete N.nodeExecutionData["Cached Tribe Analysis"],[R.SUCCESS,`Placed storage at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`])},"Place Storage",e+2),f=new He([a,l,d,u],"Storage Sequence",e+1),p=new De((M,D,N)=>{if(!M.leaderId)return[!1,"No tribe"];if(_.has(N,"buildingPlacement_bonfireTarget"))return[!0,"Placement already in progress"];const k=_.get(N,"tribeAnalysis_existingBonfires")||0,U=_.get(N,"tribeAnalysis_adultCount")||0,z=vn(M.leaderId,D.gameState),K=er(D.gameState.temperature,z,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height),X=K<qA&&k===0,J=k>0&&k<Math.ceil(U/ZA),q=jn(M,D.gameState),re=aa(M.leaderId,D.gameState,!0),se=q.filter(Y=>er(D.gameState.temperature,Y.position,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)<lo+5?re.every(j=>G(Y.position,j.position,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)>Or*1.5):!1),ie=se.length>=3;if(X||J||ie){if(ie){const Z=se.reduce((Q,B)=>({x:Q.x+B.position.x,y:Q.y+B.position.y}),{x:0,y:0});Z.x/=se.length,Z.y/=se.length,_.set(N,"buildingPlacement_coldClusterPos",Z)}else _.delete(N,"buildingPlacement_coldClusterPos");let Y="";return X?Y=`Cold at center: ${K.toFixed(1)}C`:J?Y=`Tribe size: ${U}/${k} fires`:Y=`Cold cluster: ${se.length} members`,[!0,Y]}return[!1,`Adequate heating: ${k} fires for ${U} adults`]},"Needs Bonfire",e+2),m=new we((M,D,N)=>{if(_.has(N,"buildingPlacement_bonfireTarget"))return[R.SUCCESS,"Using existing bonfire placement target"];const k=_.get(N,"buildingPlacement_coldClusterPos"),U=Vs(ue.Bonfire,M.id,D.gameState,Qi,Xs,k||M.position);return U?(_.set(N,"buildingPlacement_bonfireTarget",U),[R.SUCCESS,`Found bonfire location at (${U.x.toFixed(0)}, ${U.y.toFixed(0)})`]):[R.FAILURE,`No valid location found for bonfire within ${Qi}px`]},"Find Bonfire Location",e+2),S=new we((M,D,N)=>{const k=_.get(N,"buildingPlacement_bonfireTarget");if(!k)return[R.FAILURE,"No target location in blackboard"];const U=G(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U<=Ji?[R.SUCCESS,`Reached bonfire location (${U.toFixed(0)}px away)`]:(M.activeAction="moving",M.target=k,M.direction=We(M.position,k,D.gameState.mapDimensions),[R.RUNNING,`Moving to bonfire location (${U.toFixed(0)}px away)`])},"Move To Bonfire Location",e+2),v=new we((M,D,N)=>{const k=_.get(N,"buildingPlacement_bonfireTarget");if(!k)return[R.FAILURE,"No target location in blackboard"];const U=G(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U>Ji?[R.FAILURE,`Too far from placement location: ${U.toFixed(0)}px`]:(Xo(k,ue.Bonfire,M.id,D.gameState),_.delete(N,"buildingPlacement_bonfireTarget"),_.delete(N,"caching_Cached Tribe Analysis_status"),_.delete(N,"caching_Cached Tribe Analysis_timestamp"),delete N.nodeExecutionData["Cached Tribe Analysis"],[R.SUCCESS,`Placed bonfire at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`])},"Place Bonfire",e+2),A=new He([p,m,S,v],"Bonfire Sequence",e+1),I=new De((M,D,N)=>{if(_.has(N,"buildingPlacement_plantingTarget"))return[!0,"Placement already in progress"];const k=_.get(N,"tribeAnalysis_adultCount"),U=_.get(N,"tribeAnalysis_existingPlantingZones"),z=_.get(N,"tribeAnalysis_bushDensity"),K=_.get(N,"tribeAnalysis_bushCount"),X=_.get(N,"tribeAnalysis_zoneDensity"),J=_.get(N,"tribeAnalysis_projectedAdultCount");if(k===void 0||U===void 0||z===void 0||K===void 0||X===void 0||J===void 0)return[!1,"No tribe analysis available"];const q=z*(k/Math.max(1,J)),se=U===0||z<Op||q<Op||K<=Hs&&U<=Hs;return se&&X>q&&(K>Hs||U>Hs)?[!1,`Planting zone density (${X.toFixed(2)}) exceeds projected density (${q.toFixed(2)})`]:se?[!0,`Low bush density: ${z.toFixed(1)}, count: ${K}/${U} (projected: ${q.toFixed(1)})`]:[!1,`Planting zones adequate: ${U}, density: ${z.toFixed(1)}`]},"Needs Planting Zone",e+2),E=new we((M,D,N)=>{if(_.has(N,"buildingPlacement_plantingTarget"))return[R.SUCCESS,"Using existing planting zone placement target"];const k=Vs(ue.PlantingZone,M.id,D.gameState,Qi,Xs,M.position);return k?(_.set(N,"buildingPlacement_plantingTarget",k),[R.SUCCESS,`Found planting zone location at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`]):[R.FAILURE,`No valid location found for planting zone within ${Qi}px`]},"Find Planting Zone Location",e+2),P=new we((M,D,N)=>{const k=_.get(N,"buildingPlacement_plantingTarget");if(!k)return[R.FAILURE,"No target location in blackboard"];const U=G(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U<=Ji?[R.SUCCESS,`Reached planting zone location (${U.toFixed(0)}px away)`]:(M.activeAction="moving",M.target=k,M.direction=We(M.position,k,D.gameState.mapDimensions),[R.RUNNING,`Moving to planting zone location (${U.toFixed(0)}px away)`])},"Move To Planting Zone Location",e+2),C=new we((M,D,N)=>{const k=_.get(N,"buildingPlacement_plantingTarget");if(!k)return[R.FAILURE,"No target location in blackboard"];const U=G(M.position,k,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return U>Ji?[R.FAILURE,`Too far from placement location: ${U.toFixed(0)}px`]:(Xo(k,ue.PlantingZone,M.id,D.gameState),_.delete(N,"buildingPlacement_plantingTarget"),_.delete(N,"caching_Cached Tribe Analysis_status"),_.delete(N,"caching_Cached Tribe Analysis_timestamp"),delete N.nodeExecutionData["Cached Tribe Analysis"],[R.SUCCESS,`Placed planting zone at (${k.x.toFixed(0)}, ${k.y.toFixed(0)})`])},"Place Planting Zone",e+2),w=new He([I,E,P,C],"Planting Zone Sequence",e+1),O=new ci([f,A,w],"Building Type Selector",e+1);return new He([t,i,s,O],"Leader Building Placement",e)}const ko="takeOverBuildingTarget";function mN(e){const t=new He([new De((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=_.get(s,ko);if(a){const d=i.gameState.entities.entities[a];if(d&&d.type==="building"&&Xt(n,d,i.gameState))return[!0,`Continuing to target building ${a}`];_.delete(s,ko)}const l=xe(n,i.gameState,"building",LA,d=>Xt(n,d,i.gameState)&&d.isConstructed);return l?(_.set(s,ko,l.id),[!0,`Found enemy building at distance ${G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Take Over",e+2),new we((n,i,s)=>{const a=_.get(s,ko);if(!a)return R.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Xt(n,l,i.gameState)?(_.delete(s,ko),n.activeAction="idle",n.target=void 0,R.FAILURE):G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<ze?(n.activeAction="idle",n.target=void 0,R.SUCCESS):(n.activeAction="moving",n.target=l.id,R.RUNNING)},"Move to Enemy Building",e+2),new we((n,i,s)=>{const a=_.get(s,ko);if(!a)return R.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Xt(n,l,i.gameState)?(_.delete(s,ko),R.FAILURE):(n.activeAction="takingOverBuilding",n.target=l.id,_.delete(s,ko),R.SUCCESS)},"Initiate Building Takeover",e+2)],"Take Over Building Action",e+1);return new ma(FA,t,"Take Over Building Cooldown",e)}const eS=2,yN=40,tS=3;function vN(e){const t=new De(a=>{if(!a.isAdult)return[!1,"Not an adult"];if(a.hunger>cg)return[!1,`Too hungry (${a.hunger.toFixed(1)})`];const l=a.leaderId===a.id,d=a.tribeRole===ae.Warrior;return!l&&!d?[!1,`Not a Warrior or Leader (role: ${a.tribeRole||"none"})`]:[!0,l?"Is Leader":"Is Warrior"]},"Is Warrior or Leader",e+1),n=new De(a=>{var d,u;if(a.leaderId!==a.id)return[!0,"Warrior follows leader strategy"];const l=((u=(d=a.tribeControl)==null?void 0:d.armyControl)==null?void 0:u.expandBorders)??0;return l<eS?[!1,`Expand borders weight too low: ${l}/${eS}`]:[!0,`Expand borders weight: ${l}`]},"Has Expand Borders Weight",e+1),i=new De((a,l)=>{if(!a.leaderId)return[!1,"No tribe leader"];const u=l.gameState.search.building.byProperty("ownerId",a.leaderId);return u.length===0?[!1,"No territory to expand"]:[!0,`Tribe has ${u.length} buildings`]},"Has Territory",e+1),s=new we((a,l,d)=>{if(!a.leaderId)return[R.FAILURE,"No leader"];const u=l.gameState,f=u.mapDimensions.width,p=u.mapDimensions.height,m=i1(a.position,a.leaderId,u);if(!m)return[R.FAILURE,"Could not find territory edge"];const S=G(a.position,m,f,p);if(S>yN)return a.activeAction="moving",a.target=m,[R.RUNNING,`Approaching territory edge (${S.toFixed(0)}px)`];const A=u.search.building.byProperty("ownerId",a.leaderId),I=Yd(A.map(k=>k.position));_.get(d,"pioneerOrbitDirection")===void 0&&_.set(d,"pioneerOrbitDirection",1);const E=Math.ceil(f/me),P=Math.ceil(p/me),C=UA(a.position),w=[];for(let k=-3;k<=tS;k++)for(let U=-3;U<=tS;U++){if(U===0&&k===0)continue;const z=((C.x+U)%E+E)%E,K=((C.y+k)%P+P)%P,X=K*E+z,J=u.terrainOwnership[X],q=J!==null&&Li(a.leaderId,J,u);if(J!==null&&!q)continue;const re={x:z*me+me/2,y:K*me+me/2};$A(re,a.leaderId,u,Qp,!0,a.leaderId).canPlace&&w.push({pos:re,gx:z,gy:K})}if(w.length===0)return _.set(d,"pioneerOrbitDirection",-_.get(d,"pioneerOrbitDirection")),[R.RUNNING,"Blocked, reversing orbit direction"];const O=mt(Xe(I,a.position,f,p)),M=vp(O,_.get(d,"pioneerOrbitDirection")*(Math.PI/2));let D=w[0],N=-1/0;for(const k of w){let U=0;for(let se=-1;se<=1;se++)for(let ie=-1;ie<=1;ie++){if(ie===0&&se===0)continue;const Y=((k.gx+ie)%E+E)%E,Z=((k.gy+se)%P+P)%P;u.terrainOwnership[Z*E+Y]===a.leaderId&&U++}const z=mt(Xe(a.position,k.pos,f,p)),K=FS(z,M),X=G(I,k.pos,f,p),J=G(I,a.position,f,p),q=X>J?1:0,re=U*2+K*1.5+q*.5;re>N&&(N=re,D=k)}return Xo(a.position,ue.BorderPost,a.leaderId,u),a.target=D.pos,a.activeAction="moving",[R.RUNNING,"Expanding territory (cell-based)"]},"Pioneer Expansion",e+1);return new He([t,n,i,s],"Border Expansion",e)}const Bo="removeEnemyBuildingTarget";function SN(e){const t=new He([new De((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=_.get(s,Bo);if(a){const d=i.gameState.entities.entities[a];if(d&&d.type==="building"&&Xt(n,d,i.gameState))return[!0,`Continuing to target building ${a}`];_.delete(s,Bo)}const l=xe(n,i.gameState,"building",LA,d=>Xt(n,d,i.gameState)&&d.isConstructed);return l?(_.set(s,Bo,l.id),[!0,`Found enemy building at distance ${G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Destroy",e+2),new we((n,i,s)=>{const a=_.get(s,Bo);if(!a)return R.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Xt(n,l,i.gameState)?(_.delete(s,Bo),n.activeAction="idle",n.target=void 0,R.FAILURE):G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<ze?(n.activeAction="idle",n.target=void 0,R.SUCCESS):(n.activeAction="moving",n.target=l.id,R.RUNNING)},"Move to Enemy Building",e+2),new we((n,i,s)=>{const a=_.get(s,Bo);if(!a)return R.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Xt(n,l,i.gameState)?(_.delete(s,Bo),R.FAILURE):(n.activeAction="destroyingBuilding",n.target=l.id,_.delete(s,Bo),R.SUCCESS)},"Initiate Building Destruction",e+2)],"Remove Enemy Building Action",e+1);return new ma(FA,t,"Remove Enemy Building Cooldown",e)}function AN(e){return new He([new we((t,n,i)=>{const s=Up(t,n.gameState);return s?(_.set(i,"patriarchTarget",s.id),[R.SUCCESS,`Found patriarch: ${s.id}`]):(_.delete(i,"patriarchTarget"),[R.FAILURE,"No patriarch found"])},"Find Patriarch",e+1),new we((t,n,i)=>{const s=_.get(i,"patriarchTarget"),a=s&&n.gameState.entities.entities[s];if(!a)return[R.FAILURE,"Patriarch target missing from blackboard"];const l=G(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l>SR){t.activeAction="moving",t.target=a.id;const d=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=mt(d),[R.RUNNING,`Moving to patriarch at ${l.toFixed(0)}`]}return t.activeAction="idle",t.target=void 0,t.direction={x:0,y:0},[R.SUCCESS,`Arrived at patriarch at ${l.toFixed(0)}`]},"Move Towards Patriarch",e+1)],"Follow Patriarch",e)}function IN(e){const t=new ci([new He([new De((n,i)=>{if(!n.aiBlackboard)return[!1,"No blackboard"];if(!n.leaderId||n.leaderId===n.id)return[!1,"No tribe or the leader"];if(ru(n,i.gameState).id!==n.id)return[!1,"Not patriarch"];const a=Sl(n.aiBlackboard);return a!=="idle"&&fD(n.aiBlackboard,i.gameState.time)?(Es(n.aiBlackboard,"idle",i.gameState.time),[!1,"Phase timed out, reset to idle"]):[a==="idle",`Phase: ${a}`]},"Is Idle?",e+2),new we((n,i)=>{if(!n.aiBlackboard)return R.FAILURE;const s=Og(n,i.gameState);return s.canSplit&&s.strategy?(Es(n.aiBlackboard,"planning",i.gameState.time),BI(n.aiBlackboard,s.strategy),R.SUCCESS):[R.FAILURE,s.reason||"Cannot split"]},"Check Split Conditions",e+2)],"Check Phase",e+1),new He([new De(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Sl(n.aiBlackboard);return[i==="planning",`Phase: ${i}`]},"Is Planning?",e+2),new we((n,i)=>n.aiBlackboard?OI(n,i.gameState)?(Es(n.aiBlackboard,"gathering",i.gameState.time),R.SUCCESS):(Es(n.aiBlackboard,"idle",i.gameState.time),R.FAILURE):R.FAILURE,"Plan Split Strategy",e+2)],"Planning Phase",e+1),new He([new De(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Sl(n.aiBlackboard);return[i==="gathering",`Phase: ${i}`]},"Is Gathering?",e+2),new we((n,i)=>{if(!n.aiBlackboard)return R.FAILURE;const[s,a]=dD(n,i.gameState);return s?(Es(n.aiBlackboard,"executing",i.gameState.time),R.SUCCESS):[R.RUNNING,`Progress: ${a.toFixed(2)}`]},"Wait for Family to Gather",e+2)],"Gathering Phase",e+1),new He([new De(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Sl(n.aiBlackboard);return[i==="executing",`Phase: ${i}`]},"Is Executing?",e+2),new we((n,i)=>n.aiBlackboard?kI(n,i.gameState)?R.SUCCESS:(Es(n.aiBlackboard,"idle",i.gameState.time),R.FAILURE):R.FAILURE,"Execute Tribe Split",e+2)],"Execution Phase",e+1)],"Tribe Split State Machine",e+1);return new ma($P,t,"Tribe Split Cooldown",e)}const Id="jealousyAttackTarget";function TN(e){return new He([new De((t,n,i)=>{var l,d;if(!t.isAdult)return[!1,"Not an adult"];if(t.gender!=="male")return[!1,"Not male"];const s=((d=(l=t.partnerIds)==null?void 0:l.map(u=>{var f;return(f=n.gameState.entities.entities[u])==null?void 0:f.pregnancyFatherId}))==null?void 0:d.filter(u=>!!u&&u!==t.id))??[],a=n.gameState.search.human.byRadius(t.position,NR).find(u=>s.includes(u.id));return a?t.leaderId&&a.id===t.leaderId?[!1,"Stranger is the tribe leader - no attack"]:(_.set(i,Id,a.id),[!0,`Partner cheating with ${a.id}`]):(_.delete(i,Id),!1)},"Check for Infidelity",e+1),new we((t,n,i)=>{const s=_.get(i,Id),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(_.delete(i,Id),[R.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?R.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[R.RUNNING,`Attacking ${a.id}`])},"Execute Jealousy Attack",e+1)],"Jealousy Attack",e)}const Td="defendAggressor";function EN(e){return new He([new De((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const s=LP(t,n.gameState,bR);return s?(_.set(i,Td,s.aggressor.id),[!0,`Family member ${s.familyMember.id} attacked by ${s.aggressor.id}`]):(_.delete(i,Td),!1)},"Check Family Under Attack",e+1),new we((t,n,i)=>{const s=_.get(i,Td),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(_.delete(i,Td),[R.FAILURE,"Target invalid/dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?R.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[R.RUNNING,`Attacking aggressor ${a.id}`])},"Execute Family Defense Attack",e+1)],"Defend Family",e)}const Ed="desperateAttackTarget";function CN(e){return new He([new De(t=>t.hunger>OR,"Is Starving",e+1),new De((t,n)=>{if(!t.isAdult)return[!1,"Not an adult"];const i=xe(t,n.gameState,"berryBush",ze,a=>a.food.length>0),s=xe(t,n.gameState,"corpse",ze,a=>a.food.length>0);return!i&&!s},"No Other Food Available",e+1),new De((t,n,i)=>{const s=HP(t,n.gameState);return s?(_.set(i,Ed,s.id),[!0,`Found weak target ${s.id}`]):(_.delete(i,Ed),!1)},"Find Weak Target",e+1),new we((t,n,i)=>{const s=_.get(i,Ed),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(_.delete(i,Ed),[R.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?R.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[R.RUNNING,`Desperately attacking ${a.id}`])},"Execute Desperate Attack",e+1)],"Desperate Attack",e)}function wN(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const a=G(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?yn:fo;return a<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,R.SUCCESS):(t.activeAction="moving",t.target=s.id,t.direction=We(t.position,s.position,e.mapDimensions),R.RUNNING)}function _N(e){return new He([new De((t,n)=>t.isPlayer===!0&&!!n.gameState.autopilotControls.activeAutopilotAction,"Has Player Command",e+1),new we((t,n)=>{var a;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return R.FAILURE;switch(s.action){case le.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=s.position;return G(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<NA?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),R.SUCCESS):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),R.RUNNING)}case le.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l)return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;let d=!1;if(l.type==="berryBush")d=l.food.length===0;else if(l.type==="corpse")d=l.food.length===0;else if(l.type==="tree"){const f=l;d=f.stateMachine[0]!==xt||f.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;return d?(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>xr?(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),R.RUNNING):(t.activeAction="gathering",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,R.SUCCESS)}case le.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const[d]=l.stateMachine??[];return!(d===an||d===Vt||d===Sn)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Kl?(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),R.RUNNING):(t.activeAction="chopping",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,R.SUCCESS)}case le.AutopilotAttack:return"targetEntityId"in s?wN(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE);case le.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||!ir(t,l,n.gameState)?(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=js?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,R.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),R.RUNNING)}case le.AutopilotPlant:{if(t.activeAction==="planting")return R.RUNNING;if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=s.position;return zn(l,i,qo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE):G(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<=js?(t.activeAction="planting",t.target=l,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,R.RUNNING):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),R.RUNNING)}case le.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=js?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",R.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),R.RUNNING)}case le.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=i.entities.entities[s.targetEntityId];if(!l||l.buildingType!==ue.StorageSpot&&l.buildingType!==ue.Bonfire||!l.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const d=l.storageCapacity??0;if(l.storedItems.length>=d||t.leaderId!==l.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const f=t.food.length>0,p=!!t.heldItem;if(l.buildingType===ue.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==At.Wood)return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE}else if(!f&&!p)return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;return G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Kt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,R.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),R.RUNNING)}case le.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.buildingType!==ue.StorageSpot||!l.isConstructed||l.storedItems.length===0||t.leaderId!==l.ownerId||t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Kt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,R.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),R.RUNNING)}case le.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Xt(t,l,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="takingOverBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,R.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),R.RUNNING)}case le.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Xt(t,l,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="destroyingBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,R.SUCCESS):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),R.RUNNING)}case le.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const l=s.position,d=s.buildingType;if(!d)return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE;const u=G(t.position,l,i.mapDimensions.width,i.mapDimensions.height),f=100;return u<=f?ra(l,d,t.leaderId,i,t.position,f)?(Xo(l,d,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",R.SUCCESS):(i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),R.RUNNING)}default:return i.autopilotControls.activeAutopilotAction=void 0,R.FAILURE}},"Execute Player Command",e+1)],"Player Command Handler",e)}function RN(e){const t=new De(i=>i.id===i.leaderId,"Is Leader?",e+1),n=new we((i,s)=>{var f,p,m,S,v,A;const{gameState:a}=s,l=li(i.id,a),d=lu(l),u=ql(a).filter(I=>I.leaderId!==i.id);for(const I of u){const E=li(I.leaderId,a),P=lu(E),C=((p=(f=i.tribeControl)==null?void 0:f.diplomacy)==null?void 0:p[I.leaderId])||ut.Friendly,w=a.entities.entities[I.leaderId];((S=(m=w==null?void 0:w.tribeControl)==null?void 0:m.diplomacy)==null?void 0:S[i.id])===ut.Hostile||d>P*MA?C!==ut.Hostile&&((v=i.tribeControl)!=null&&v.diplomacy)&&(i.tribeControl.diplomacy[I.leaderId]=ut.Hostile):C!==ut.Friendly&&((A=i.tribeControl)!=null&&A.diplomacy)&&(i.tribeControl.diplomacy[I.leaderId]=ut.Friendly)}return R.SUCCESS},"Evaluate Diplomacy",e+2);return new He([t,new ma(Mp,n,"Diplomacy Cooldown",e+1)],"Manage Diplomacy",e)}const al="huntTarget";function PN(e){return new He([new xn(new De((n,i,s)=>{if(!n.isAdult)return[!1,"Not an adult"];if(!n.leaderId)return[!1,"Not in a tribe"];if(!Yn(n,ae.Hunter,i.gameState))return[!1,"Not a Hunter"];const a=xe(n.position,i.gameState,"prey",yR,l=>!(n.leaderId&&!Wn(l.position,n.leaderId,i.gameState)));return a?(_.set(s,al,a.id),[!0,"Found prey"]):[!1,"No suitable prey found"]},"Find Prey Target",e+2),MR,"Cache Find Prey",e+1),new Fi(new ks(new we((n,i,s)=>{if(!n.leaderId)return R.FAILURE;const a=_.get(s,al);if(!a)return R.FAILURE;const l=i.gameState.entities.entities[a];if(!l||l.hitpoints<=0)return _.delete(s,al),n.activeAction="idle",n.attackTargetId=void 0,R.SUCCESS;const{gameState:d}=i,u=vn(n.leaderId,d);return G(n.position,u,d.mapDimensions.width,d.mapDimensions.height)>RA?(_.delete(s,al),n.activeAction="idle",n.attackTargetId=void 0,R.FAILURE):(n.activeAction="attacking",n.attackTargetId=l.id,R.RUNNING)},"Hunt Prey Action",e+3),Ns,"Hunt Prey Timeout",e+2),{taskType:"hunt",maxCapacity:iT,getTargetId:(n,i,s)=>_.get(s,al)??null},"Tribal Hunt Task",e+1)],"Human Hunt Prey Sequence",e)}const Cd="defendTarget",ap=150;function DN(e){return new He([new De((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult - children flee instead"];if(t.hitpoints<=t.maxHitpoints*.3)return[!1,"Too injured to defend"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.type==="predator"&&l.hitpoints>0&&G(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=ap)return _.set(i,Cd,l.id),[!0,"Continuing defense"]}const a=xe(t,s,"predator",ap,l=>l.hitpoints>0&&(l.isAdult||!1));if(a){const l=G(t.position,a.position,s.mapDimensions.width,s.mapDimensions.height),d=a.attackTargetId===t.id,u=l<80;if(d||u)return _.set(i,Cd,a.id),[!0,"Predator threat detected"]}return _.set(i,Cd,void 0),[!1,"No predator threat"]},"Detect Predator Threat",e+1),new we((t,n,i)=>{const s=_.get(i,Cd),a=s&&n.gameState.entities.entities[s];if(!a)return R.FAILURE;const{gameState:l}=n,d=G(t.position,a.position,l.mapDimensions.width,l.mapDimensions.height);return t.hitpoints<t.maxHitpoints*.3?R.FAILURE:a.hitpoints<=0||d>ap*1.5?(t.activeAction="idle",t.attackTargetId=void 0,R.SUCCESS):(t.activeAction="attacking",t.attackTargetId=a.id,R.RUNNING)},"Defend Against Predator",e+1)],"Human Defend Against Predator",e)}function MN(e){const t=new we((n,i)=>{if(!n.leaderId||!n.isAdult)return R.FAILURE;const s=i.gameState.entities.entities[n.leaderId];if(!s||!s.tribeControl)return R.FAILURE;if(n.id===s.id)return n.tribeRole!==ae.Leader&&(n.tribeRole=ae.Leader),R.SUCCESS;const l=jn(s,i.gameState).filter(I=>I.id!==s.id),d=l.length;if(d===0)return R.SUCCESS;const u=s.tribeControl.roleWeights;let f=0;const p=[];for(const I of Object.values(ae))I!==ae.Leader&&(f+=u[I]||0,p.push(I));if(f===0)return n.tribeRole||(n.tribeRole=ae.Gatherer),R.SUCCESS;const m={},S={},v={};for(const I of p)m[I]=0,S[I]=u[I]/f*d;for(const I of l)I.tribeRole&&I.tribeRole!==ae.Leader&&(m[I.tribeRole]=(m[I.tribeRole]||0)+1);for(const I of p)v[I]=S[I]-m[I];let A=!1;if((!n.tribeRole||n.tribeRole===ae.Leader||v[n.tribeRole]<-.5&&p.some(P=>v[P]>.5))&&(A=!0),A){let I=null,E=-1/0;const P=[...p].sort(()=>Math.random()-.5);for(const C of P){const w=v[C];w>E&&(E=w,I=C)}if(I)n.tribeRole=I;else{const C=Math.random()*f;let w=0;for(const O of p)if(w+=u[O],C<=w){n.tribeRole=O;break}}}return R.SUCCESS},"Assign Tribe Role",e+1);return new xn(t,Ls,"Cache Tribe Role Assignment",e)}const NN=5,bN=0,ON=10;function kN(e){return e<bA?{[ae.Leader]:0,[ae.Gatherer]:7,[ae.Planter]:2,[ae.Hunter]:1,[ae.Mover]:1,[ae.Warrior]:0}:e<OA?{[ae.Leader]:0,[ae.Gatherer]:5,[ae.Planter]:4,[ae.Hunter]:2,[ae.Mover]:2,[ae.Warrior]:1}:e<kA?{[ae.Leader]:0,[ae.Gatherer]:4,[ae.Planter]:3,[ae.Hunter]:3,[ae.Mover]:3,[ae.Warrior]:2}:{[ae.Leader]:0,[ae.Gatherer]:3,[ae.Planter]:3,[ae.Hunter]:4,[ae.Mover]:3,[ae.Warrior]:3}}function BN(e){if(e.length===0)return 0;let t=0,n=0;for(const i of e)t+=i.food.length,n+=i.maxFood;return n===0?0:t/n}function FN(e,t){return e<t?Math.min(e+1,ON):e>t?Math.max(e-1,bN):e}function LN(e){const t=new we((n,i)=>{if(!n.leaderId||n.id!==n.leaderId||!n.tribeControl)return R.FAILURE;const s=jn(n,i.gameState);if(s.filter(m=>m.isAdult).length<NN)return R.FAILURE;const l=BN(s),d=kN(l),u=n.tribeControl.roleWeights;let f=!1;const p=[ae.Gatherer,ae.Planter,ae.Hunter,ae.Mover,ae.Warrior];for(const m of p){const S=u[m]||0,v=d[m],A=FN(S,v);A!==S&&(u[m]=A,f=!0)}if(f){const m=`Adjusted weights for food security: ${(l*100).toFixed(1)}%`;return[R.SUCCESS,m]}return R.FAILURE},"Manage Tribe Role Weights",e+1);return new xn(t,Ls,"Cache Role Management",e)}const Cr="treeTarget";function HN(e){const t=new we((i,s,a)=>{const l=Zt(i,s.gameState),d=xe(i,s.gameState,"tree",LR,u=>{const[f]=u.stateMachine??[];if(!(f===an||f===Vt||f===Sn)||i.leaderId&&!Wn(u.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const m=`tribal_chop_${u.id}`,S=_.get(l.aiBlackboard,m);if(S&&s.gameState.time-S.startTime<=Vo&&!S.memberIds.includes(i.id))return!1}return!0});return d?(_.set(a,Cr,d.id),[R.SUCCESS,`Found tree: ${d.id} at ${d.position.x.toFixed(0)},${d.position.y.toFixed(0)}`]):[R.FAILURE,"No tree found"]},"Find Closest Tree",e+4),n=new Fi(new we((i,s,a)=>{const l=_.get(a,Cr);if(!l)return[R.FAILURE,"No target in blackboard"];const d=s.gameState.entities.entities[l];if(!d)return _.delete(a,Cr),[R.FAILURE,"Tree no longer exists"];const[u]=d.stateMachine??[];return u===an||u===Vt||u===Sn?G(i.position,d.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Kl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=d.id,_.delete(a,Cr),[R.SUCCESS,`Chopping tree ${d.id}`]):(i.activeAction="moving",i.target=d.id,i.direction=We(i.position,d.position,s.gameState.mapDimensions),[R.RUNNING,`Moving to tree ${d.id}`]):(_.delete(a,Cr),[R.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop",e+3),{taskType:"chop",maxCapacity:1,getTargetId:(i,s,a)=>_.get(a,Cr)??null},"Tribal Chop Task",e+3);return new He([new De((i,s)=>{const a=Zt(i,s.gameState);if(!a)return[!1,"No leader for coordination"];const l=$l(a.id,s.gameState);if(l<=0)return[!1,"No wood need"];const d=mI(a.id,s.gameState);return[l>d,`Wood need: ${l}, Available on ground: ${d}`]},"Need Wood?",e+1),new De(i=>{const s=!i.heldItem;return[(i.isAdult&&s)??!1,`${s?"Can chop":"Holding item"}`]},"Should Chop Tree",e+1),new ci([new He([new De((i,s,a)=>_.has(a,Cr),"Has Tree Target?",e+2),n],"Continue Chopping Action",e+2),new He([new xn(t,PR,"Cache Tree Search",e+3),n],"Find New Tree and Chop",e+2)],"Perform or Start Chopping",e+1)],"Chop Tree",e)}const wr="cleanupTreeTarget";function UN(e){const t=new we((i,s,a)=>{const l=Zt(i,s.gameState),d=Mu(i,s.gameState);if(d.length===0)return[R.FAILURE,"No planting zones found"];const u=s.gameState;let f=null,p=1/0;for(const m of d){const S=Math.sqrt(m.width*m.width+m.height*m.height)/2,v=u.search.tree.byRadius(m.position,S);for(const A of v){const[I]=A.stateMachine??[];if(!(I===an||I===Vt||I===Sn)||!Dp(A.position,m,s.gameState))continue;if(l&&l.aiBlackboard){const C=`tribal_cleanup_tree_${A.id}`,w=_.get(l.aiBlackboard,C);if(w&&s.gameState.time-w.startTime<=Vo&&!w.memberIds.includes(i.id))continue}const P=G(i.position,A.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);P<p&&(p=P,f=A)}}return f?(_.set(a,wr,f.id),[R.SUCCESS,`Found nuisance tree: ${f.id} at ${f.position.x.toFixed(0)},${f.position.y.toFixed(0)}`]):[R.FAILURE,"No nuisance trees found in planting zones"]},"Find Nuisance Tree",e+4),n=new Fi(new we((i,s,a)=>{const l=_.get(a,wr);if(!l)return[R.FAILURE,"No target in blackboard"];const d=s.gameState.entities.entities[l];if(!d)return _.delete(a,wr),[R.FAILURE,"Tree no longer exists"];const[u]=d.stateMachine??[];return u===an||u===Vt||u===Sn?G(i.position,d.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Kl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=d.id,_.delete(a,wr),[R.SUCCESS,`Chopping nuisance tree ${d.id}`]):(i.activeAction="moving",i.target=d.id,i.direction=We(i.position,d.position,s.gameState.mapDimensions),[R.RUNNING,`Moving to nuisance tree ${d.id}`]):(_.delete(a,wr),[R.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop (Cleanup)",e+3),{taskType:"cleanup_tree",maxCapacity:1,getTargetId:(i,s,a)=>_.get(a,wr)??null},"Tribal Cleanup Tree Task",e+3);return new He([new De((i,s)=>{const a=Yn(i,ae.Planter,s.gameState),l=Yn(i,ae.Gatherer,s.gameState),d=!i.heldItem;return[!!(i.isAdult&&(a||l)&&d),`${d?"Planter/Gatherer role eligible":"Holding item"}`]},"Should Cleanup Zone?",e+1),new ci([new He([new De((i,s,a)=>_.has(a,wr),"Has Cleanup Target?",e+2),n],"Continue Cleanup Action",e+2),new He([new xn(t,DR,"Cache Cleanup Search",e+3),n],"Find New Nuisance Tree and Chop",e+2)],"Perform or Start Cleanup",e+1)],"Cleanup Planting Zones",e)}const ll="bonfireTargetId",GN=800;function xN(e){return new He([new De((t,n)=>{const i=er(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<lo+8;return[s,`Temp: ${i.toFixed(1)}C`+(s?" (Cold)":"")]},"Is Cold?",e+1),new we((t,n,i)=>{const s=Zt(t,n.gameState),a=xe(t,n.gameState,"building",GN,l=>{if(!(l.buildingType===ue.Bonfire&&l.isConstructed&&!l.isBeingDestroyed&&(l.fuelLevel??0)>0)||l.ownerId!==t.leaderId)return!1;if(s&&s.aiBlackboard){const u=`tribal_warmth_${l.id}`,f=_.get(s.aiBlackboard,u);if(f&&n.gameState.time-f.startTime<=Vo&&f.memberIds.length>=Fp&&!f.memberIds.includes(t.id))return!1}return!0});return a?(_.set(i,ll,a.id),[R.SUCCESS,`Found bonfire ${a.id}`]):(_.delete(i,ll),[R.FAILURE,"No available fueled bonfires found"])},"Find Bonfire",e+1),new Fi(new we((t,n,i)=>{const s=_.get(i,ll),a=s&&n.gameState.entities.entities[s];if(!a||(a.fuelLevel??0)<=0||!a.isConstructed)return _.delete(i,ll),R.FAILURE;const l=t.id*137%360*(Math.PI/180),d=Or*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,p={x:(a.position.x+Math.cos(l)*d+u)%u,y:(a.position.y+Math.sin(l)*d+f)%f},m=G(t.position,p,u,f);return m>10?(t.activeAction="moving",t.target=p,t.direction=We(t.position,p,n.gameState.mapDimensions),[R.RUNNING,`Moving to personal warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[R.RUNNING,"Staying warm at personal spot"])},"Move to Warmth Spot",e+2),{taskType:"warmth",maxCapacity:Fp,getTargetId:(t,n,i)=>_.get(i,ll)??null},"Tribal Warmth Task",e+1)],"Gather at Bonfire Sequence",e)}function $N(e){const t=new we((n,i,s)=>{if(!n.leaderId||n.id!==n.leaderId)return[R.FAILURE,"Not a tribe leader"];const a=aa(n.id,i.gameState);let l=0;for(const d of a)if(d.isConstructed&&d.fuelLevel!==void 0){const u=d.maxFuelLevel??kr;d.fuelLevel<u*Ag&&(oT(s,d.id,"wood",i.gameState.time),l++)}return[R.SUCCESS,`Tribe logistics: ${l} wood demands registered for bonfires`]},"Manage Tribe Logistics",e+1);return new xn(t,f1,"Cached Tribe Logistics",e)}const WN="tribeSplit_strategy",YN="tribeSplit_targetPosition",zN="tribeSplit_targetBuildingId",jN="tribeSplit_familyIds";function XN(e){return new He([new De((t,n)=>{const i=ru(t,n.gameState);if(!i.aiBlackboard)return[!1,"Patriarch has no blackboard"];const s=Sl(i.aiBlackboard);if(s!=="gathering")return[!1,`Patriarch phase: ${s}`];const a=_.get(i.aiBlackboard,jN);return!a||!a.includes(t.id)?[!1,"Not in split family"]:[!0,"Gathering for split"]},"Should Gather for Split?",e+1),new we((t,n)=>{const i=ru(t,n.gameState),s=_.get(i.aiBlackboard,WN);let a;if(s==="migration")a=_.get(i.aiBlackboard,YN);else if(s==="concentration"){const d=_.get(i.aiBlackboard,zN);if(d){const u=n.gameState.entities.entities[d];u&&(a=u.position)}}if(!a)return R.FAILURE;const l=G(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=_I?(t.activeAction="idle",t.target=void 0,R.SUCCESS):(t.activeAction="moving",t.target=a,[R.RUNNING,`Distance: ${l.toFixed(2)}`])},"Move to Split Gathering Point",e+1)],"Tribe Split Gather Behavior",e)}function VN(){const e=new ci([JM(2),EN(2),new Pn(DN(2),"attack","Gated Defend Against Predator",2),new Pn(TN(2),"attack","Gated Jealousy Attack",2),new Pn(CN(2),"attack","Gated Desperate Attack",2),_N(2),new Cs(new ci([new xn(mN(5),Ls,"Cache Take Over Building",4),new xn(SN(5),Ls,"Cache Remove Enemy Building",4)],"Building Interaction Selector",3),"Gated Leader Building Interactions",2),pN(2),new Pn(oN(3),"attack","Gated Attacking",2),xN(2),YM(2),XM(2),hN(2),new Pn(new xn(gN(4),zR,"Cache Building Placement",3),"build","Gated Leader Building Placement",2),new Cs(new xn(vN(4),Ls,"Cache Border Post Placement",3),"Gated Border Post Placement",2),IN(2),XN(2),QM(2),new Pn(iN(3),"procreation","Gated Procreation",2),new ks(new Pn(UN(4),"chopping","Gated Cleanup Trees",3),Ns,"Timeout Cleanup Trees",2),new ks(new Pn(uN(4),"planting","Gated Planting",3),Ns,"Timeout Planting",2),new Pn(fN(3),"gathering","Gated Storage Deposit",2),new Pn(aN(3),"feedChildren","Gated Feed Child",2),new ks(new Pn(eN(4),"gathering","Gated Gathering",3),Ns,"Timeout Gathering",2),new ks(new Pn(HN(4),"chopping","Gated Chopping",3),Ns,"Timeout Chopping",2),lN(2),new Pn(PN(3),"attack","Gated Hunt Prey",2),new Cs(AN(2),"Gated Follow Patriarch",2),new ks(new Cs(nN(2),"Gated Idle Wander",3),Ns,"Timeout Idle Wander",2)],"AI Root Selector",1),t=new jv([new xM(new $M(MN(4),"Role Assignment Success",3),"Role Assignment Gate",2),new Pn(new xn(LN(4),Ls,"Cache Role Management",3),"roleManagement","Gated Role Management",2),new Cs(RN(3),"Gated Diplomacy",2),new Cs($N(2),"Gated Logistics Management",2)],"Non blocking",1),n=new jv([e,t],"AI Root Sequence",1);return new WM(n,"Manual Control Gate",0)}var V=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e[e.HumanDiplomacy=25]="HumanDiplomacy",e[e.AnimalFlee=26]="AnimalFlee",e[e.AnimalGraze=27]="AnimalGraze",e[e.AnimalHunt=28]="AnimalHunt",e[e.AnimalAttack=29]="AnimalAttack",e[e.AnimalProcreate=30]="AnimalProcreate",e[e.AnimalWander=31]="AnimalWander",e[e.AnimalFeedChild=32]="AnimalFeedChild",e[e.AnimalSeekFoodFromParent=33]="AnimalSeekFoodFromParent",e[e.AnimalHerd=34]="AnimalHerd",e[e.AnimalTerritorial=35]="AnimalTerritorial",e[e.AnimalPack=36]="AnimalPack",e))(V||{}),L=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(L||{});const Bt=3,KN=250,dT=.8,qN=100,ZN=5,Yp="currentAiTask",uT="lastTaskResult",fT="lastTaskMessage",zp="taskHistory";function du({aiBlackboard:e}){return _.get(e,Yp)||null}function ao({aiBlackboard:e},t){t?_.set(e,Yp,t):_.delete(e,Yp)}function QN(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function JN(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function hT(e,t,n,i){const s=t.type===V.Wait?eb:i[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=L.Failure;const[l,d,u]=JN(a);if(_.set(e.aiBlackboard,uT,l),_.set(e.aiBlackboard,fT,d),l!==L.Running){const f=_.get(e.aiBlackboard,zp)||[];if(f.unshift({type:t.type,result:l,completedAtTick:n.gameState.time,message:d}),f.length>5&&f.pop(),_.set(e.aiBlackboard,zp,f),delete n.gameState.tasks[t.id],ao(e,null),l===L.Success){const p=u||t.nextTask;p&&(n.gameState.tasks[p.id]=p,p.claimedByEntityId=e.id,ao(e,p.id))}}return l}function ot(e){return 1/(1+e/KN)}function ec(e,t,n){for(let i=0;i<n.length;i++){const s=n[i];if(!s.producer)continue;const a=s.producer(e,t);for(const l in a){const d=a[l],u=t.gameState.tasks[l];t.gameState.tasks[l]=d,u&&(t.gameState.tasks[l].claimedByEntityId=u.claimedByEntityId)}}}const wd=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:V.Wait,creatorEntityId:e.id,validUntilTime:t+Bt}),eb={type:V.Wait,executor:(e,t,n)=>n.gameState.time>=e.validUntilTime-1?[L.Success,"Wait complete"]:[L.Running,"Waiting"]};function ht(e){const{type:t,requireAdult:n,autopilotBehavior:i,producer:s,scorer:a,executor:l}=e;return{type:t,producer:s,scorer:a?(f,p,m)=>n&&!f.isAdult||i&&f.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?null:a(f,p,m):void 0,executor:l?(f,p,m)=>n&&!p.isAdult||i&&p.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?L.Failure:m.gameState.autopilotControls.activeAutopilotAction&&f.type!==V.HumanPlayerCommand&&p.isPlayer?[L.Failure,"Autopilot action active",{id:`player-command-${p.id}`,type:V.HumanPlayerCommand,position:p.position,creatorEntityId:p.id,validUntilTime:m.gameState.time+Bt}]:l(f,p,m):void 0}}const tb=ht({type:V.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>oa&&e.food.length>0){const i=`eat-task-${e.id}`;n[i]={id:i,type:V.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/rn,executor:(e,t)=>e.target!==t.id?L.Empty:t.hunger<oa?L.Success:t.food.length===0?L.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",L.Running)}),nb=ht({type:V.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="berryBush"||i.food.length===0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=ot(s),l=e.hunger/rn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[L.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="berryBush"||i.food.length===0||t.food.length>=t.maxFood?[L.Success,"Bush is empty"]:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",[L.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[L.Running,"Gathering berries"])}}),ib=ht({type:V.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="corpse"||i.food.length===0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=ot(s),l=e.hunger/rn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return L.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="corpse"||i.food.length===0||t.food.length>=t.maxFood?L.Success:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",L.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",L.Running)}}),ob=ht({type:V.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=Hl&&e.age<=Eu&&e.hunger<sn&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:V.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<Hl||e.hunger>=sn||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="female"||i.isPregnant||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return ot(s)*dT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="female"||t.hunger>=sn?L.Failure:i.isPregnant?L.Success:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",t.direction=We(t.position,i.position,n.gameState.mapDimensions),L.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",L.Running)}}),rb=ht({type:V.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=Hl&&e.hunger<sn&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:V.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<Hl||e.age>Eu||e.hunger>=sn||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="male"||i.hunger>=sn||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return ot(s)*dT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="male"||i.hunger>=sn?L.Failure:t.isPregnant?L.Success:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",t.direction=We(t.position,i.position,n.gameState.mapDimensions),L.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",L.Running)}}),sb=ht({type:V.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=na){const i=`feed-child-task-${e.id}`;n[i]={id:i,type:V.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.isAdult||!(i.motherId===e.id||i.fatherId===e.id))return null;const a=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=ot(a),d=i.hunger/rn;return(l+d)/2},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.isAdult||t.food.length===0?L.Failure:i.hunger<na/2?L.Success:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Cu?(t.target=i.position,t.activeAction="moving",t.direction=We(t.position,i.position,n.gameState.mapDimensions),L.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="feeding",L.Running)}});function Gg(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const i=G(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return ot(i)}function ab(e,t,n){if(e.leaderId!==t.creatorEntityId||!e.leaderId)return null;const i=t.target;if(!i)return null;const{width:s,height:a}=n.gameState.mapDimensions,l=G(e.position,i,s,a),d=ot(l)*.5,u=vn(e.leaderId,n.gameState),f=G(u,i,s,a),p=Math.max(0,1-f/800)*.25,m=Math.ceil(s/me),S=Math.ceil(a/me),v=UA(i);let A=0;for(let E=-1;E<=1;E++)for(let P=-1;P<=1;P++){if(P===0&&E===0)continue;const C=((v.x+P)%m+m)%m,w=((v.y+E)%S+S)%S;n.gameState.terrainOwnership[w*m+C]===e.leaderId&&A++}const I=A/8*.25;return d+p+I}function xu(e,t,n,i,s){const a=e.target;return G(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",L.Running):(Xo(a,i,t.leaderId,n.gameState),L.Success)}const lb=ht({type:V.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:Gg,executor:(e,t,n)=>xu(e,t,n,ue.StorageSpot,Ji)}),cb=ht({type:V.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:Gg,executor:(e,t,n)=>xu(e,t,n,ue.Bonfire,Ji)}),db=ht({type:V.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:Gg,executor:(e,t,n)=>xu(e,t,n,ue.PlantingZone,Ji)}),ub=ht({type:V.HumanPlaceBorderPost,scorer:ab,requireAdult:!0,autopilotBehavior:"build",executor:(e,t,n)=>xu(e,t,n,ue.BorderPost,KR)}),fb=ht({type:V.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(u=>u.type===An.Berry).length<uo)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const l=t.target,d=G(e.position,l,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return ot(d)},executor:(e,t,n)=>{if(t.food.filter(d=>d.type===An.Berry).length<uo)return t.activeAction="idle",L.Failure;const s=e.target;return G(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>xr?(t.target=s,t.activeAction="moving",L.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(d=>d.type==="berryBush"&&G(d.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<ZN)?(t.activeAction="idle",L.Success):L.Running)}}),hb=ht({type:V.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var f;if(typeof t.target!="number")return null;const i=e.food.length>0,s=((f=e.heldItem)==null?void 0:f.type)===At.Wood;if(!i&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==ue.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const l=G(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=ot(l),u=s?.6:e.food.length/e.maxFood*.4;return(d+u)/2},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return L.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==ue.StorageSpot)return L.Failure;const s=t.food.length>0,a=((d=t.heldItem)==null?void 0:d.type)===At.Wood;return!s&&!a?L.Success:i.storedItems.length>=i.storageCapacity?L.Failure:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",L.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",L.Running)}}),pb=ht({type:V.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var d;if(typeof t.target!="number"||!(((d=e.heldItem)==null?void 0:d.type)===At.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==ue.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||tu;if(s.storedItems.length>=a)return null;const l=G(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return ot(l)},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return L.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==ue.Bonfire)return L.Failure;if(!(((d=t.heldItem)==null?void 0:d.type)===At.Wood))return L.Success;const a=i.storageCapacity||tu;return i.storedItems.length>=a?L.Failure:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",L.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",L.Running)}}),gb=ht({type:V.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=oa||e.food.length>0||typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="building"||i.buildingType!==ue.StorageSpot||i.ownerId!==e.leaderId||!i.storedItems.some(u=>u.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=ot(s),l=e.hunger/rn,d=1-e.food.length/e.maxFood;return(a+l+d)/3},executor:(e,t,n)=>{if(typeof e.target!="number")return L.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="building"||i.buildingType!==ue.StorageSpot||!i.storedItems.some(a=>a.item.itemType==="food")?L.Failure:t.food.length>0?L.Success:t.food.length>=t.maxFood?L.Failure:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",L.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="retrieving",L.Running)}}),mb=ht({type:V.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree")return null;const[s]=i.stateMachine??[];if(!(s===an||s===Vt||s===Sn)||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.heldItem||e.food.length===0)return null;const l=Zt(e,n.gameState);if(!l)return null;const d=$l(l.id,n.gameState);if(d<=0)return null;const u=mI(l.id,n.gameState);if(u>=d)return null;const f=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),p=ot(f),m=Math.min(1,(d-u)/10);return(p+m)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[L.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="tree")return[L.Failure,"Tree not found"];const[s]=i.stateMachine??[];if(s===xt){const d={id:`gather-wood-${t.id}-${n.gameState.time}`,type:V.HumanGatherWood,position:i.position,creatorEntityId:t.id,target:i.id,validUntilTime:n.gameState.time+1};return[L.Success,"Tree fell!",d]}return s===an||s===Vt||s===Sn?t.heldItem?[L.Failure,"Hands full"]:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Kl?(t.target=i.position,t.activeAction="moving",[L.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="chopping",[L.Running,"Chopping tree"]):[L.Failure,"Tree is not standing"]}}),yb=ht({type:V.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree"||i.wood.length===0)return null;const[s]=i.stateMachine??[];if(s!==xt||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState)||e.heldItem)return null;const a=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=ot(a),d=Zt(e,n.gameState),u=d?$l(d.id,n.gameState):0,f=Math.min(1,u/10);return(l+f)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[L.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[L.Success,"Already holding wood"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="tree"||i.wood.length===0||t.heldItem?[L.Failure,"Tree gone, empty, or human full"]:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",[L.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[L.Running,"Gathering wood"])}}),vb=ht({type:V.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="prey"||i.hitpoints<=0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState))return null;const s=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const d=vn(e.leaderId,n.gameState);if(G(e.position,d,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>RA)return null}const a=ot(s),l=e.hunger/rn;return(a+l)/2*.6},executor:(e,t,n)=>{if(typeof e.target!="number")return[L.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[L.Success,"Prey is dead"];const s=G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[L.Running,"Chasing prey"]:[L.Running,"Attacking prey"]}}),Sb=ht({type:V.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="predator"||i.hitpoints<=0||e.leaderId&&!Wn(i.position,e.leaderId,n.gameState))return null;const s=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(ot(s)+.3)/1.3},executor:(e,t,n)=>{if(typeof e.target!="number")return[L.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[L.Failure,"Too injured to continue"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[L.Success,"Predator eliminated"];const s=G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[L.Running,"Chasing predator"]:[L.Running,"Fighting predator"]}});function Ab(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,L.Failure;const a=G(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?yn:fo;return a<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,L.Success):(t.activeAction="moving",t.target=s.id,t.direction=We(t.position,s.position,e.mapDimensions),L.Running)}const Ib=ht({type:V.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const i=`player-command-${e.id}`;n[i]={id:i,type:V.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t)=>t.type===V.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return[L.Failure,"No active autopilot action"];switch(s.action){case le.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,L.Failure;const l=s.position;return G(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<NA?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[L.Success,"Reached target position"]):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),[L.Running,"Moving to target"])}case le.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l)return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Target entity not found"];let d=!1;if(l.type==="berryBush")d=l.food.length===0;else if(l.type==="corpse")d=l.food.length===0;else if(l.type==="tree"){const f=l;d=f.stateMachine[0]!==xt||f.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Invalid target type"];return d?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Target is depleted"]):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>xr?(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[L.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[L.Success,"At target, gathering",wd(t,i.time)])}case le.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Invalid target entity"];const[d]=l.stateMachine??[];return!(d===an||d===Vt||d===Sn)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Tree is not standing or human is holding an item"]):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)>Kl?(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[L.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[L.Success,"At tree, chopping",wd(t,i.time)])}case le.AutopilotAttack:return"targetEntityId"in s?Ab(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,L.Failure);case le.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.type!=="human"||!ir(t,l,i))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Invalid target for procreation"];const d=G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height);return l.isPregnant||t.isPregnant?t.gender==="male"&&l.pregnancyFatherId!==t.id?[L.Failure,"Target is pregnant by another"]:[L.Success,"Procreation conditions met"]:d<=js?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,[L.Running,"Procreating"]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[L.Running,"Moving to procreation target"])}case le.AutopilotPlant:{if(t.activeAction==="planting")return[L.Running,"Planting"];if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No position specified"];const l=s.position;return zn(l,i,qo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Position is occupied"]):G(t.position,l,i.mapDimensions.width,i.mapDimensions.height)<=js?(t.activeAction="planting",t.target=l,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,[L.Running,"Planting"]):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),[L.Running,"Moving to planting target"])}case le.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Invalid target for feeding child"]):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=js?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[L.Success,"Feeding child"]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[L.Running,"Moving to feeding target"])}case le.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];if(!l||l.buildingType!==ue.StorageSpot&&l.buildingType!==ue.Bonfire||!l.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Invalid target building"];const d=l.storageCapacity??0;if(l.storedItems.length>=d)return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Storage is full"];if(t.leaderId!==l.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Human does not belong to the same tribe as the building"];const f=t.food.length>0,p=!!t.heldItem;if(l.buildingType===ue.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==At.Wood)return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Bonfires only accept wood"]}else if(!f&&!p)return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No items to deposit"];return G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Kt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[L.Success,"Depositing items",wd(t,i.time)]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[L.Running,"Moving to deposit target"])}case le.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.buildingType!==ue.StorageSpot||!l.isConstructed||l.storedItems.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Invalid target building"]):t.leaderId!==l.ownerId?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Storage is full"]):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=Kt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[L.Success,"Retrieving items",wd(t,i.time)]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[L.Running,"Moving to retrieve target"])}case le.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Xt(t,l,i)?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Only leaders can take over buildings"]):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="takingOverBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[L.Success,"Taking over building"]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[L.Running,"Moving to takeover target"])}case le.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No target entity ID"];const l=i.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Xt(t,l,i)?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Only leaders can remove enemy buildings"]):G(t.position,l.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="destroyingBuilding",t.target=l.id,i.autopilotControls.activeAutopilotAction=void 0,[L.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=l.id,t.direction=We(t.position,l.position,i.mapDimensions),[L.Running,"Moving to removal target"])}case le.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,L.Failure;const l=s.position,d=s.buildingType;if(!d)return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"No building type specified"];const u=G(t.position,l,i.mapDimensions.width,i.mapDimensions.height),f=100;return u<=f?ra(l,d,t.leaderId,i,t.position,f)?(Xo(l,d,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[L.Success,"Building placed"]):(i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=l,t.direction=We(t.position,l,i.mapDimensions),[L.Running,"Moving to placement target"])}default:return i.autopilotControls.activeAutopilotAction=void 0,[L.Failure,"Unknown or unhandled action"]}}}),Tb=ht({type:V.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:n}=t,i={},s=$n(e.position.x,e.position.y,n),a=s!==null&&s!==e.leaderId&&Li(e.leaderId,s,n),l=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(a||l){const d=`attack-human-${e.id}`;i[d]={id:d,type:V.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:n.time+Bt}}return i},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="human"||i.hitpoints<=0||i.id===e.id||i.leaderId===e.leaderId)return null;const{gameState:s}=n,a=Xr(e,i,s),l=$n(i.position.x,i.position.y,s)===e.leaderId,d=i.activeAction==="attacking"&&i.attackTargetId!==void 0;if(!a&&!d)return null;let u=.5;const f=G(e.position,i.position,s.mapDimensions.width,s.mapDimensions.height),p=ot(f);return l&&a&&(u+=.1),(p+u)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[L.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[L.Success,"Target eliminated"];const s=G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[L.Running,"Chasing human target"]:[L.Running,"Fighting human target"]}}),Eb=ht({type:V.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,n)=>{if(typeof t.target!="number"||eT(n.gameState.time)>.5)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.buildingType!==ue.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0||e.leaderId!==i.ownerId)return null;const s=er(n.gameState.temperature,e.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=lo+5;if(s>=a)return null;const l=(a-s)/15,d=(1-e.hitpoints/e.maxHitpoints)*.8,u=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),f=ot(u);let p=(l+d+f)/2;return e.hitpoints/e.maxHitpoints<.2&&s<lo&&(p=Math.max(p,1.2)),p},executor:(e,t,n)=>{if(typeof e.target!="number")return L.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.buildingType!==ue.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0)return L.Failure;const s=er(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=lo+5;if(s>=a)return t.activeAction="idle",[L.Success,"Comfortable temperature reached"];const l=t.id*137%360*(Math.PI/180),d=Or*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,p={x:(i.position.x+Math.cos(l)*d+u)%u,y:(i.position.y+Math.sin(l)*d+f)%f},m=G(t.position,p,u,f);return m>10?(t.activeAction="moving",t.target=p,t.direction=We(t.position,p,n.gameState.mapDimensions),[L.Running,`Moving to warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[L.Running,"Staying warm at bonfire"])}}),Cb=ht({type:V.HumanFlee,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hitpoints<e.maxHitpoints*Jd){const i=jA(e.id,t.gameState);if(i){const s=`flee-task-${e.id}`;n[s]={id:s,type:V.HumanFlee,position:e.position,creatorEntityId:e.id,target:i.id,validUntilTime:t.gameState.time+Bt}}}return n},scorer:(e,t,n)=>typeof t.target!="number"||!n.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*Jd?.9:null,executor:(e,t,n)=>{if(typeof e.target!="number")return L.Failure;const i=n.gameState.entities.entities[e.target];if(!i)return t.activeAction="idle",t.attackTargetId=void 0,L.Success;if(G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Np)return t.activeAction="idle",t.target=void 0,L.Success;t.activeAction="moving",t.attackTargetId=void 0;const a=Xe(i.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=mt(a),d=ri(t.position,_t(l,Np));return t.target={x:(d.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(d.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=l,L.Running}}),wb=ht({type:V.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(!e.leaderId||e.id===e.leaderId)return i;const s=vn(e.leaderId,n),a=`stay-near-tribe-${e.id}`;return i[a]={id:a,type:V.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:n.time+Bt},i},scorer:(e,t,n)=>{if(!e.leaderId||e.id===e.leaderId)return null;const i=vn(e.leaderId,n.gameState),s=G(e.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=Av)return null;const a=s-Av;return Math.min(.95,.5+a/1e3*qR)},executor:(e,t,n)=>{if(!t.leaderId)return L.Failure;const i=vn(t.leaderId,n.gameState),s=G(t.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<QR?(t.activeAction="idle",t.target=void 0,L.Success):(t.activeAction="moving",t.target=i,t.direction=We(t.position,i,n.gameState.mapDimensions),[L.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),_b=ht({type:V.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(e.isAdult)return i;const s=Up(e,n);if(!s)return i;const a=`stay-near-parent-${e.id}`;return i[a]={id:a,type:V.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:n.time+Bt},i},scorer:(e,t,n)=>{if(e.isAdult)return null;const i=Up(e,n.gameState);if(!i||i.id!==t.target||e.leaderId&&Sg(e.leaderId,n.gameState)&&$n(i.position.x,i.position.y,n.gameState)!==e.leaderId)return null;const s=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=Iv)return null;const a=s-Iv;return Math.min(.98,.6+a/500*ZR)},executor:(e,t,n)=>{if(typeof e.target!="number")return t.activeAction="idle",L.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="human")return t.activeAction="idle",t.target=void 0,L.Failure;const s=G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<=JR?(t.activeAction="idle",t.target=void 0,L.Success):(t.activeAction="moving",t.target=i.id,t.direction=We(t.position,i.position,n.gameState.mapDimensions),[L.Running,`Returning to parent (${Math.round(s)}px away)`])}}),Rb=ht({type:V.HumanDiplomacy,requireAdult:!0,scorer:(e,t)=>e.id===e.leaderId&&t.creatorEntityId===e.id?1:null,executor:(e,t,n)=>{var d,u,f,p,m,S;const{gameState:i}=n,s=li(t.id,i),a=lu(s),l=ql(i).filter(v=>v.leaderId!==t.id);for(const v of l){const A=li(v.leaderId,i),I=lu(A),E=((u=(d=t.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[v.leaderId])||ut.Friendly,P=i.entities.entities[v.leaderId];((p=(f=P==null?void 0:P.tribeControl)==null?void 0:f.diplomacy)==null?void 0:p[t.id])===ut.Hostile||a>I*MA?E!==ut.Hostile&&((m=t.tribeControl)!=null&&m.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=ut.Hostile):E!==ut.Friendly&&((S=t.tribeControl)!=null&&S.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=ut.Friendly)}return t.aiBlackboard&&_.set(t.aiBlackboard,"lastDiplomacyCheckTime",i.time),L.Success}}),$u=[tb,nb,ib,ob,rb,sb,lb,cb,db,ub,fb,hb,pb,gb,mb,yb,vb,Sb,Ib,Tb,Eb,Cb,wb,_b,Rb].reduce((e,t)=>(e[t.type]=t,e),{}),Pb=Object.values($u);function Db(e,t){ec(e,t,Pb)}function Mb(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const i=du(e);if(i){const s=t.gameState.tasks[i];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),ao(e,null)}return}let n=du(e);if(n){const i=t.gameState.tasks[n];(!i||i.claimedByEntityId&&i.claimedByEntityId!==e.id)&&(ao(e,null),n=null)}if(!n){const i=Nb(e,t);if(i&&t.gameState.tasks[i]){const s=t.gameState.tasks[i];n=i,ao(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const i=t.gameState.tasks[n];i?hT(e,i,t,$u):ao(e,null)}}function Nb(e,t){let n=null,i=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=$u[a.type];if(!l||!l.scorer)continue;const d=l.scorer(e,a,t);d!==null&&d>i&&(i=d,n=a.id)}return i>0?n:null}VN();function bb(e,t){const n=performance.now();switch(e.aiType){case tr.TaskBased:default:Mb(e,t);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}const Ob=(e,t)=>{const n={};for(let i=0;i<iT;i++){const s=`hunt-prey-${e.id}-${i}`;n[s]={id:s,type:V.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},kb=(e,t)=>{const n={};if(e.hitpoints<=0)return n;const i=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((i==null?void 0:i.type)==="human"))return n;for(let a=0;a<PA;a++){const l=`hunt-predator-${e.id}-${a}`;n[l]={id:l,type:V.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},uu=GD*1.5,Bb=(e,t)=>{const n={},i=t.gameState,s=[...i.search.human.byRadius(e.position,uu),...i.search.predator.byRadius(e.position,uu)].filter(u=>{if(u.id===e.id)return!1;if(e.type==="prey")return u.type==="human"||u.type==="predator";if(e.type==="predator"){if(u.type==="human")return!0;if(u.type==="predator")return u.geneCode!==e.geneCode}return!1});if(s.length===0)return n;let a=s[0],l=si(e.position,a.position);for(let u=1;u<s.length;u++){const f=si(e.position,s[u].position);f<l&&(l=f,a=s[u])}const d=`animal-flee-${e.id}-${a.id}`;return n[d]={id:d,type:V.AnimalFlee,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1},n},Fb=(e,t,n)=>{const i=n.gameState.entities.entities[t.target];if(!i)return null;const s=si(e.position,i.position);return s>uu?null:ot(s)*.95},Lb=(e,t,n)=>{const i=n.gameState.entities.entities[e.target];if(!i)return L.Failure;if(si(t.position,i.position)>uu*1.2)return L.Success;const a=mt(Zp(t.position,i.position)),l=ri(t.position,_t(a,100));return t.activeAction="moving",t.target=l,L.Running},Hb={type:V.AnimalFlee,producer:Bb,scorer:Fb,executor:Lb},pT=600,Ub=(e,t)=>{if(e.type!=="prey")return{};const n={},s=t.gameState.search.berryBush.byRadius(e.position,pT).filter(a=>a.food.length>0);for(const a of s){const l=`animal-graze-${e.id}-${a.id}`;n[l]={id:l,type:V.AnimalGraze,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},Gb=(e,t,n)=>{if(e.type!=="prey")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.food.length===0)return null;const s=si(e.position,i.position);if(s>pT)return null;const a=ot(s),l=Math.max(0,e.hunger/Bu);return e.hunger<20&&s>100?null:a*l*.65},xb=(e,t,n)=>{if(t.type!=="prey")return L.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.food.length===0||(t.activeAction="grazing",t.target=i.id,t.hunger<5)?L.Success:L.Running},$b={type:V.AnimalGraze,producer:Ub,scorer:Gb,executor:xb},gT=800,Wb=(e,t)=>{if(e.type!=="predator")return{};const n={},s=t.gameState.search.prey.byRadius(e.position,gT).filter(a=>a.type==="prey");for(const a of s){const l=`animal-hunt-${e.id}-${a.id}`;n[l]={id:l,type:V.AnimalHunt,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},Yb=(e,t,n)=>{if(e.type!=="predator")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.hitpoints<=0)return null;const s=si(e.position,i.position);if(s>gT)return null;const a=ot(s),l=Math.max(0,e.hunger/Fu);return e.hunger<30&&s>200?null:a*l*.8},zb=(e,t,n)=>{if(t.type!=="predator")return L.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.hitpoints<=0||(t.activeAction="attacking",t.target=i.id,t.hunger<10)?L.Success:L.Running},jb={type:V.AnimalHunt,producer:Wb,scorer:Yb,executor:zb},mT=500,Xb=(e,t)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,mT).filter(a=>{if(a.id===e.id||a.type!==e.type)return!1;const l=a;return l.isAdult&&l.gender!==e.gender&&(!l.procreationCooldown||l.procreationCooldown<=0)&&!l.isPregnant});for(const a of s){const l=`animal-procreate-${e.id}-${a.id}`;n[l]={id:l,type:V.AnimalProcreate,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},Vb=(e,t,n)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return null;const i=n.gameState.entities.entities[t.target];if(!i||!i.isAdult||i.gender===e.gender||i.procreationCooldown&&i.procreationCooldown>0||i.isPregnant)return null;const s=si(e.position,i.position);return s>mT?null:ot(s)*.6},Kb=(e,t,n)=>{const i=n.gameState.entities.entities[e.target];return!i||i.isPregnant||i.procreationCooldown&&i.procreationCooldown>0?L.Failure:(t.activeAction="procreating",t.target=i.id,t.isPregnant||t.procreationCooldown&&t.procreationCooldown>0?L.Success:L.Running)},qb={type:V.AnimalProcreate,producer:Xb,scorer:Vb,executor:Kb},Zb=200,Qb=(e,t)=>{const n=`animal-wander-${e.id}`,i=Math.random()*Math.PI*2,s=Math.random()*Zb,a={x:e.position.x+Math.cos(i)*s,y:e.position.y+Math.sin(i)*s};a.x=Math.max(0,Math.min(t.gameState.mapDimensions.width,a.x)),a.y=Math.max(0,Math.min(t.gameState.mapDimensions.height,a.y));const l={};return l[n]={id:n,type:V.AnimalWander,position:a,creatorEntityId:e.id,validUntilTime:t.gameState.time+5},l},Jb=()=>.1,eO=(e,t)=>si(t.position,e.position)<10?(t.activeAction="idle",L.Success):(t.activeAction="moving",t.target=e.position,L.Running),tO={type:V.AnimalWander,producer:Qb,scorer:Jb,executor:eO},nO=(e,t)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,600).filter(a=>{if(a.type!==e.type)return!1;const l=a;return l.motherId===e.id&&l.hunger>=Lu});for(const a of s){const l=`animal-feed-child-${e.id}-${a.id}`;n[l]={id:l,type:V.AnimalFeedChild,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},iO=(e,t,n)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.motherId!==e.id)return null;const s=si(e.position,i.position),a=ot(s),l=e.type==="prey"?Bu:Fu,d=Math.max(0,i.hunger/l);return a*d*.9},oO=(e,t,n)=>{const i=n.gameState.entities.entities[e.target];return!i||i.hunger<Lu/2?L.Success:si(t.position,i.position)<30?(t.activeAction="feeding",L.Running):(t.activeAction="moving",t.target=i.id,L.Running)},rO={type:V.AnimalFeedChild,producer:nO,scorer:iO,executor:oO},sO=(e,t)=>{if(e.isAdult||e.hunger<Lu||!e.motherId)return{};const n=t.gameState.entities.entities[e.motherId];if(!n)return{};const i={},s=`animal-seek-food-${e.id}-${n.id}`;return i[s]={id:s,type:V.AnimalSeekFoodFromParent,position:n.position,creatorEntityId:e.id,target:n.id,validUntilTime:t.gameState.time+1},i},aO=(e,t,n)=>{if(e.isAdult||!e.motherId)return null;const i=n.gameState.entities.entities[e.motherId];if(!i)return null;const s=si(e.position,i.position),a=ot(s),l=e.type==="prey"?Bu:Fu,d=Math.max(0,e.hunger/l);return a*d*.85},lO=(e,t,n)=>{const i=n.gameState.entities.entities[e.target];return!i||t.hunger<Lu/2?L.Success:(si(t.position,i.position)<30||(t.activeAction="moving",t.target=i.id),L.Running)},cO={type:V.AnimalSeekFoodFromParent,producer:sO,scorer:aO,executor:lO},dO=(e,t)=>{if(e.type!=="prey")return{};if(e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return{};const n={},i=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,l=i.search.prey.byRadius(e.position,la*5),d=[];for(const u of l)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&d.push(u);if(d.length>=2){let u=0,f=0;for(const S of d)u+=S.position.x,f+=S.position.y;u/=d.length,f/=d.length;const p={x:u,y:f};if(G(e.position,p,s,a)>la*2){const S=`animal-herd-${e.id}`;n[S]={id:S,type:V.AnimalHerd,position:p,creatorEntityId:e.id,target:p,validUntilTime:t.gameState.time+1}}}return n},uO=(e,t,n)=>{if(e.type!=="prey"||e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return null;const i=t.target,{width:s,height:a}=n.gameState.mapDimensions,l=G(e.position,i,s,a);return l<=la*2?null:ot(l)*.4},fO=(e,t,n)=>{if(t.type!=="prey")return L.Failure;const i=e.target,{width:s,height:a}=n.gameState.mapDimensions;if(G(t.position,i,s,a)<=la*2)return t.activeAction="idle",t.direction={x:0,y:0},L.Success;t.activeAction="moving",t.target=i;const d=Xe(t.position,i,s,a);return t.direction=mt(d),L.Running},hO={type:V.AnimalHerd,producer:dO,scorer:uO,executor:fO},pO=(e,t)=>{if(e.type!=="predator")return{};const n=e.hunger>100,i=e.hitpoints<e.maxHitpoints*.5;if(!n&&!i)return{};if(e.attackCooldown&&e.attackCooldown>0)return{};const s={},l=t.gameState.search.human.byRadius(e.position,Vr*2);let d=null,u=1/0;for(const f of l)if(f.hitpoints>0){const p=G(e.position,f.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);p<u&&(u=p,d=f)}if(d){const f=`animal-attack-human-${e.id}-${d.id}`;s[f]={id:f,type:V.AnimalAttack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return s},gO=(e,t,n)=>{if(e.type!=="predator")return null;const i=t.target,s=n.gameState.entities.entities[i];if(!s||s.hitpoints<=0)return null;const a=G(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>Vr*2.5?null:ot(a)*.75},mO=(e,t,n)=>{if(t.type!=="predator")return L.Failure;const i=e.target,s=n.gameState.entities.entities[i];if(!s||s.hitpoints<=0)return L.Success;const{width:a,height:l}=n.gameState.mapDimensions;if(G(t.position,s.position,a,l)<=Vr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},L.Running;{t.activeAction="moving",t.target=s.id;const u=Xe(t.position,s.position,a,l);return t.direction=mt(u),L.Running}},yO={type:V.AnimalAttack,producer:pO,scorer:gO,executor:mO},vO=(e,t)=>{if(e.type!=="predator")return{};if(!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120||e.attackCooldown&&e.attackCooldown>0)return{};const n={},s=t.gameState.search.predator.byRadius(e.position,YI);let a=null,l=1/0;for(const d of s)if(d.id!==e.id&&d.hitpoints>0&&d.isAdult&&e.fatherId!==d.fatherId&&e.gender===d.gender&&e.fatherId!==void 0&&d.fatherId!==void 0){const u=G(e.position,d.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);u<l&&(l=u,a=d)}if(a){const d=`animal-territorial-${e.id}-${a.id}`;n[d]={id:d,type:V.AnimalTerritorial,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},SO=(e,t,n)=>{if(e.type!=="predator"||!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120)return null;const i=t.target,s=n.gameState.entities.entities[i];if(!s||s.hitpoints<=0)return null;const a=G(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>YI*1.2?null:ot(a)*.7},AO=(e,t,n)=>{if(t.type!=="predator")return L.Failure;const i=e.target,s=n.gameState.entities.entities[i];if(!s||s.hitpoints<=0)return L.Success;const{width:a,height:l}=n.gameState.mapDimensions;if(G(t.position,s.position,a,l)<=Vr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},L.Running;{t.activeAction="moving",t.target=s.id;const u=Xe(t.position,s.position,a,l);return t.direction=mt(u),L.Running}},IO={type:V.AnimalTerritorial,producer:vO,scorer:SO,executor:AO},TO=(e,t)=>{if(e.type!=="predator")return{};if(e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return{};if(e.fatherId===void 0)return{};const n={},i=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,l=i.search.predator.byRadius(e.position,ca*4);let d=null;for(const u of l)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&u.fatherId===e.fatherId&&(u.age>=e.age||u.hitpoints>e.hitpoints)&&(!d||u.age>d.age)&&(d=u);if(d&&G(e.position,d.position,s,a)>ca*2){const f=`animal-pack-follow-${e.id}-${d.id}`;n[f]={id:f,type:V.AnimalPack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return n},EO=(e,t,n)=>{if(e.type!=="predator"||e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return null;const i=t.target,s=n.gameState.entities.entities[i];if(!s||s.hitpoints<=0)return null;const{width:a,height:l}=n.gameState.mapDimensions,d=G(e.position,s.position,a,l);return d<=ca*2?null:ot(d)*.35},CO=(e,t,n)=>{if(t.type!=="predator")return L.Failure;const i=e.target,s=n.gameState.entities.entities[i];if(!s||s.hitpoints<=0)return L.Success;const{width:a,height:l}=n.gameState.mapDimensions;if(G(t.position,s.position,a,l)<=ca*2)return t.activeAction="idle",t.direction={x:0,y:0},L.Success;t.activeAction="moving",t.target=s.id;const u=Xe(t.position,s.position,a,l);return t.direction=mt(u),L.Running},wO={type:V.AnimalPack,producer:TO,scorer:EO,executor:CO},ln={};ln[V.HumanHuntPrey]={type:V.HumanHuntPrey,producer:Ob};ln[V.HumanHuntPredator]={type:V.HumanHuntPredator,producer:kb};ln[V.AnimalFlee]=Hb;ln[V.AnimalGraze]=$b;ln[V.AnimalHunt]=jb;ln[V.AnimalAttack]=yO;ln[V.AnimalProcreate]=qb;ln[V.AnimalWander]=tO;ln[V.AnimalFeedChild]=rO;ln[V.AnimalSeekFoodFromParent]=cO;ln[V.AnimalHerd]=hO;ln[V.AnimalTerritorial]=IO;ln[V.AnimalPack]=wO;function nS(e,t){ec(e,t,Object.values(ln))}function yT(e,t){let n=du(e);if(n){const i=t.gameState.tasks[n];(!i||i.claimedByEntityId&&i.claimedByEntityId!==e.id)&&(ao(e,null),n=null)}if(!n){const i=_O(e,t);if(i&&t.gameState.tasks[i]){const s=t.gameState.tasks[i];n=i,ao(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const i=t.gameState.tasks[n];i?hT(e,i,t,ln):ao(e,null)}}function _O(e,t){let n=null,i=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,1e3);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=ln[a.type];if(!l||!l.scorer)continue;const d=l.scorer(e,a,t);d!==null&&d>i&&(i=d,n=a.id)}return i>0?n:null}function RO(e,t){yT(e,t)}function PO(e,t){yT(e,t)}const DO=(e,t)=>{if(e.buildingType!==ue.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,i=_g(e);if(SI(e,n)>=i)return{};const a=n.search.tasks.byProperty("creatorEntityId",e.id).find(p=>p.type===V.HumanPlantBush);if(a)return{[a.id]:a};const l=n.mapDimensions.width,d=n.mapDimensions.height,u=n.soilDepletion,f=10;for(let p=0;p<f;p++){const m=e.position.x+(Math.random()-.5)*e.width,S=e.position.y+(Math.random()-.5)*e.height,v={x:(m%l+l)%l,y:(S%d+d)%d};if(!Bi(u,v,l,d)&&!zn(v,n,qo)){const A=`plant-bush-${e.id}`,I={id:A,type:V.HumanPlantBush,position:v,creatorEntityId:e.id,target:v,validUntilTime:n.time+qN};return{[A]:I}}}return{}},MO=(e,t)=>{const n={};if(e.buildingType===ue.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const i=`stockpile-${e.id}`;n[i]={id:i,type:V.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},NO=(e,t)=>{const n={};if(e.buildingType===ue.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*Ag){const i=`fuel-bonfire-${e.id}`;n[i]={id:i,type:V.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},bO=(e,t)=>{const n={};if(e.buildingType===ue.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let i=0;i<Fp;i++){const s=`seek-warmth-${e.id}-${i}`;n[s]={id:s,type:V.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},OO=(e,t)=>{const n={};if(e.buildingType===ue.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(i=>i.item.itemType==="food")){const i=`retrieve-from-${e.id}`;n[i]={id:i,type:V.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},kO={[V.HumanPlantBush]:{type:V.HumanPlantBush,producer:DO},[V.HumanStockpile]:{type:V.HumanStockpile,producer:MO},[V.HumanFuelBonfire]:{type:V.HumanFuelBonfire,producer:NO},[V.HumanSeekWarmth]:{type:V.HumanSeekWarmth,producer:bO},[V.HumanRetrieve]:{type:V.HumanRetrieve,producer:OO}};function vT(e,t){ec(e,t,Object.values(kO))}function BO(e,t){const{gameState:n,deltaTime:i}=t,s=i*(Ot/Gt);if(e.isBeingDestroyed){const a=rw(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){const l=e.buildingType===ue.PlantingZone;Zr(n.entities,e.id),l&&Ol(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=ow(e.buildingType);a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&YA(e.position,ia,e.ownerId,n),e.buildingType===ue.PlantingZone&&Ol(n))}if(e.buildingType===ue.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*c1,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*d1)){const a=e.storedItems.findIndex(l=>l.item.itemType==="item"&&l.item.type===At.Wood);a!==-1&&(e.storedItems.splice(a,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+KA))}vT(e,t)}function FO(e,t){const n=t.deltaTime*Ot/Gt;if(e.age+=n,!e.stateMachine)return;const[i]=e.stateMachine;i!==xt&&i!==co&&i!==Yr&&(e.age>=Jo&&!e.woodGenerated&&(e.wood=Array.from({length:Hu},()=>({itemType:"item",type:At.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=Jl*Math.min(1,Math.max(.4,e.age/Jo)))}const LO={type:V.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const i=`gather-berries-${e.id}`;n[i]={id:i,type:V.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},HO={type:V.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===an||i===Vt||i===Sn){const a=`chop-tree-${e.id}`;n[a]={id:a,type:V.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},UO={type:V.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===xt&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:V.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},GO=[LO,HO,UO].reduce((e,t)=>(e[t.type]=t,e),{});function iS(e,t){ec(e,t,Object.values(GO))}const xO={type:V.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const i=`gather-meat-${e.id}`;n[i]={id:i,type:V.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},$O=[xO].reduce((e,t)=>(e[t.type]=t,e),{});function WO(e,t){ec(e,t,Object.values($O))}var $d=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))($d||{});function lp(e,t,n){switch(n){case 0:YO(e,t);break;case 1:zO(e,t);break;case 2:jO(e,t);break}}function YO(e,t){e.forces.push(_t(e.velocity,-.1));const n=_t(mt(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(i=>{t.gameState.time-i.startTime<i.duration&&i.type==="slow"&&(e.velocity=_t(e.velocity,.5))}),e.debuffs=e.debuffs.filter(i=>t.gameState.time-i.startTime<i.duration),e.velocity=ri(e.velocity,e.forces.reduce(ri,{x:0,y:0})),Ko(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=ri(e.position,_t(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&Ko(e.velocity)>.1&&MP(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?BM(e,t,t.deltaTime):e.type==="corpse"?FM(e,t):e.type==="prey"?LM(e,t,t.deltaTime):e.type==="predator"?HM(e,t,t.deltaTime):e.type==="building"?BO(e,t):e.type==="tree"?FO(e,t):e.type,e.stateMachine&&(e.stateMachine=bM(...e.stateMachine,{entity:e,updateContext:t}))}function zO(e,t){ST(e,t)&&(e.type==="human"?Db(e,t):e.type==="corpse"?WO(e,t):e.type==="prey"||e.type==="predator"?nS(e,t):e.type==="building"?vT(e,t):(e.type==="tree"||e.type==="berryBush")&&iS(e,t))}function jO(e,t){ST(e,t)&&(_.cleanupOldEntries(e.aiBlackboard,t.gameState.time),e.type==="human"?bb(e,t):e.type==="corpse"||(e.type==="prey"?RO(e,t):e.type==="predator"?PO(e,t):e.type==="building"||e.type==="tree"||e.type),_.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function ST(e,t){const n=_.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-n+(Math.random()-Math.random())*Qd/10>Qd}function XO(e){const t=e.gameState.entities.entities;for(const n in t)lp(t[n],e,$d.Physics);for(const n in t)lp(t[n],e,$d.PrepareAI);JC(e.gameState);for(const n in t)lp(t[n],e,$d.ExecuteAI)}function AT(){return{entities:{},nextEntityId:1}}function qr(e,t,n){const i={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:_.create(),...n};return e.entities[i.id]=i,i}function tc(e,t,n){return qr(e,"berryBush",{position:t,radius:Pp,food:Array.from({length:A_},()=>({itemType:"food",type:An.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:S_,lifespan:T_,age:0,spreadRadius:Pp,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:_.create(),stateMachine:[Cl,{enteredAt:n,previousState:void 0}]})}function jl(e,t,n,i=0){const s=i>=Jo;return qr(e,"tree",{position:t,radius:Jl,age:i,lifespan:hM,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:TM,stateMachine:[an,{enteredAt:n,previousState:void 0}],aiBlackboard:_.create(),wood:s?Array.from({length:Hu},()=>({itemType:"item",type:At.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function zs(e,t,n,i,s=!1,a=U_,l=wA,d,u,f=[],p,m,S=tr.TaskBased){const v=a>=dg;return qr(e,"human",{position:t,radius:v?Rt:ha,hunger:l,hitpoints:pv,maxHitpoints:pv,age:a,gender:i,isPlayer:s,food:[],maxFood:CA,maxAge:Ll,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:d,fatherId:u,ancestorIds:f,stateMachine:[St,{enteredAt:n,previousState:void 0}],leaderId:p,tribeInfo:m,aiType:S,aiBlackboard:_.create()})}function xg(e,t,n,i,s,a,l,d,u,f,p){let m,S;switch(l){case"human":m=_A,S=sn;break;case"prey":m=2,S=120;break;case"predator":m=4,S=140;break}return qr(e,"corpse",{position:t,radius:s,gender:n,age:i,originalEntityId:a,originalEntityType:l,timeOfDeath:d,decayProgress:0,geneCode:p,food:[...Array.from({length:Math.max(m*Math.max(S-f,0)/S,0)},()=>({itemType:"food",type:An.Meat})),...u].map(A=>({...A,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:_.create()})}function VO(e,t,n,i,s,a,l,d,u){return xg(e,t,n,i,s,a,"human",l,d,u)}function KO(e,t,n,i,s,a,l,d){return xg(e,t,n,i,s,a,"prey",l,[],0,d)}function qO(e,t,n,i,s,a,l,d){return xg(e,t,n,i,s,a,"predator",l,[],0,d)}function ZO(e,t,n){const i=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=i?[...i.ancestorIds||[],i.id]:[],l=[...s,...a],d=[...new Set(l)],u=d.slice(Math.max(d.length-EA,0)),f=Math.random()<.5?"male":"female",p=ri(e.position,{x:5,y:5}),m=zs(n.gameState.entities,p,n.gameState.time,f,!1,0,wA/2,e.id,t,u,(i==null?void 0:i.leaderId)??e.leaderId,(i==null?void 0:i.tribeInfo)??e.tribeInfo,e.aiType);return Ne(n,Ee.Birth,e.position),m}function Zr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function da(e,t,n,i=UD,s=GI,a,l,d,u=tr.TaskBased){const f=i>=xI,p=Date.now();return qr(e,"prey",{position:t,radius:f?Rt*.7:ha*.7,hunger:s,hitpoints:Gv,maxHitpoints:Gv,age:i,maxAge:UI,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:d,stateMachine:[vi,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:_.create()})}function ua(e,t,n,i=jD,s=WI,a,l,d,u=tr.TaskBased){const f=i>=XI,p=Date.now();return qr(e,"predator",{position:t,radius:f?Rt*.9:ha*.9,hunger:s,hitpoints:xv,maxHitpoints:xv,age:i,maxAge:$I,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:d,stateMachine:[gn,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:_.create()})}function QO(e,t,n,i){const s=Jp(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:i,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:hD,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===ue.Bonfire?kr:void 0,maxFuelLevel:n===ue.Bonfire?kr:void 0,aiBlackboard:_.create(),stateMachine:["",{enteredAt:0}]};return qr(e,"building",a)}var hn=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(hn||{}),Gr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(Gr||{}),pn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(pn||{});const jp={},Xp={},JO=[{key:hn.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:hn.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>F_,isCompleted:!1,minDisplayTime:Dv,highlightedUIElements:[Gr.HUNGER_BAR]},{key:hn.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!xe(t,e,"berryBush",ze*5,i=>i.food.length>0),getTargets:(e,t)=>{const n=[];for(const i of Object.values(e.entities.entities))i.type==="berryBush"&&i.food.length>0&&G(t.position,i.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(i);return n.map(i=>i.id)},isCompleted:!1,minDisplayTime:Dv},{key:hn.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=xe(t,e,"berryBush",ze,i=>i.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:hn.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[Gr.FOOD_BAR]},{key:hn.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>Mn(e,t).length>0,getTargets:(e,t)=>{const n=xe(t,e,"human",ze,i=>ir(t,i,e));return n?[n.id]:[]},isCompleted:!1},{key:hn.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>kg(e,t).some(i=>i.type===le.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:hn.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[Gr.COMMAND_BUTTONS],isCompleted:!1},{key:hn.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:hn.AUTOPILOT},{key:hn.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=xe(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=xe(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:hn.ANIMALS_INTRODUCTION},{key:hn.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!xe(t,e,"predator",120),getTargets:(e,t)=>{const n=xe(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:hn.HUNT_PREY}].map(e=>({...e,condition:e.condition?nk(e.condition):void 0,getTargets:e.getTargets?ik(e.getTargets):void 0}));function IT(){return{steps:JO.map(e=>({...e,isCompleted:!1}))}}function TT(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:pn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function ek(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function tk(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const i=Tt(e);if(!i){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/K1;switch(n.transitionState){case pn.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=pn.ACTIVE);break;case pn.ACTIVE:{const u=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),f=jp[s.condition];f&&u&&f(e,i)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=pn.FADING_OUT);break}case pn.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const d=ek(e);d!==null?(n.currentStepIndex=d,n.transitionState=pn.FADING_IN):(n.isActive=!1,n.transitionState=pn.INACTIVE)}break}if(n.transitionState!==pn.FADING_OUT&&n.transitionState!==pn.INACTIVE){const d=Xp[s.getTargets||""];d?n.highlightedEntityIds=[...d(e,i)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function nk(e){const t=`condition_${Object.keys(jp).length+1}`;return jp[t]=e,t}function ik(e){const t=`getTargets_${Object.keys(Xp).length+1}`;return Xp[t]=e,t}function ok(){const e=AT(),t=0;for(let S=0;S<pA;S++){const v={x:Math.random()*Ze,y:Math.random()*Qe};tc(e,v,t)}for(let S=0;S<hA;S++){const v={x:Math.random()*Ze,y:Math.random()*Qe};jl(e,v,t)}const n=Ze/2,i=Qe/2;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,A=100+Math.random()*100,I={x:n+Math.cos(v)*A,y:i+Math.sin(v)*A};jl(e,I,t,Jo)}const s=zs(e,{x:n-25,y:i},t,"male",!0),a=zs(e,{x:n+25,y:i},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:mn[0]},s.aiType=tr.TaskBased,a.aiType=tr.TaskBased;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,A=Ze/2,I=Qe/2,E={x:n+Math.cos(v)*A,y:i+Math.sin(v)*I},P=zs(e,{x:E.x,y:E.y},t,"male",!1);P.leaderId=P.id,P.tribeInfo={tribeBadge:nu[S%nu.length],tribeColor:mn[S%mn.length]};const C=zs(e,{x:E.x+50,y:E.y},t,"female",!1);C.leaderId=P.id,C.tribeInfo=P.tribeInfo}for(let S=0;S<VI;S++){const v={x:n+Ze*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};da(e,v,"male",void 0,void 0,Yl()),da(e,{x:v.x+20,y:v.y},"female",void 0,void 0,Yl())}const l={x:n+Ze*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};ua(e,l,"male",void 0,void 0,zl()),ua(e,{x:l.x+20,y:l.y},"female",void 0,void 0,zl());const d=[{id:"muteButton",action:de.ToggleMute,currentWidth:no,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:ft},{id:"pauseButton",action:de.TogglePause,currentWidth:no,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:ft},{id:"returnToIntroButton",action:de.ReturnToIntro,currentWidth:no,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:ft}],u=IT(),f=TT(),p={time:t,entities:e,mapDimensions:{width:Ze,height:Qe},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:PI,isMuted:!1,uiButtons:d,tutorial:u,tutorialState:f,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:$r.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:Br,preyProcreationCooldown:Fr,predatorGestationPeriod:Lr,predatorProcreationCooldown:Hr,preyHungerIncreasePerHour:Wo,predatorHungerIncreasePerHour:Yo,berryBushSpreadChance:so},soilDepletion:yA(),temperature:nT(Ze,Qe),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ze/me)*Math.ceil(Qe/me)).fill(null),tasks:{}},m=pu(p);return console.log("Game world initialized:",m),m}function rk(){const e=AT(),t=0;for(let u=0;u<pA;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};tc(e,f,t)}for(let u=0;u<hA;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};jl(e,f,t)}const n=Ze/2,i=Qe/2;for(let u=0;u<5;u++){const f=u/5*Math.PI*2,p=100+Math.random()*100,m={x:n+Math.cos(f)*p,y:i+Math.sin(f)*p};jl(e,m,t,Jo)}for(let u=0;u<m_;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe},p=Math.random()<.5?"male":"female";zs(e,f,t,p,!1)}for(let u=0;u<VI;u++){const f={x:Math.random()*Ze,y:Math.random()*Qe};da(e,f,"male",void 0,void 0,Yl()),da(e,{x:f.x+20,y:f.y},"female",void 0,void 0,Yl())}const s={x:Math.random()*Ze,y:Math.random()*Qe};ua(e,s,"male",void 0,void 0,zl()),ua(e,{x:s.x+20,y:s.y},"female",void 0,void 0,zl());const a=IT(),l=TT(),d={time:t,entities:e,mapDimensions:{width:Ze,height:Qe},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Ze/2,y:Qe/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:PI,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:l,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:Br,preyProcreationCooldown:Fr,predatorGestationPeriod:Lr,predatorProcreationCooldown:Hr,preyHungerIncreasePerHour:Wo,predatorHungerIncreasePerHour:Yo,berryBushSpreadChance:so},soilDepletion:yA(),temperature:nT(Ze,Qe),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ze/me)*Math.ceil(Qe/me)).fill(null),tasks:{}};return pu(d)}const sk="humanProcreation",ak="human",lk="human",ck=ze,dk=(e,t,n)=>ir(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,uk=(e,t,n)=>{const{gameState:i}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,l=e.gender==="female"?e:t,d=(a.partnerIds||[]).length===0;if(e.stateMachine[0]!==Nr&&(e.stateMachine=[Nr,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:n.gameState.time+1}]),t.stateMachine[0]!==Nr&&(t.stateMachine=[Nr,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),d&&a.leaderId&&a.leaderId!==a.id){const u=i.entities.entities[a.leaderId];if(u){const f=Hp(a,u),p=Hp(l,u);if(!f&&!p){const m=ou();a.leaderId=a.id,a.tribeInfo={tribeBadge:m,tribeColor:mn[Math.floor(Math.random()*mn.length)]},a.tribeRole=ae.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&l){const u=ou();a.leaderId=a.id,a.tribeInfo={tribeBadge:u,tribeColor:mn[Math.floor(Math.random()*mn.length)]},a.tribeRole=ae.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}e.activeAction=void 0,Ue(i,Ie.Procreation,s,Gl),Ue(i,Ie.Partnered,e.position,Ke,e.id),Ue(i,Ie.Partnered,t.position,Ke,t.id),e.lastPartneredEffectTime=i.time,t.lastPartneredEffectTime=i.time,t.activeAction=void 0,Ne(n,Ee.Procreate,s)},fk={id:sk,sourceType:ak,targetType:lk,maxDistance:ck,checker:dk,perform:uk},hk={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:Cu,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Zo&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-Zo),e.feedChildCooldownTime=j_,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ue(n.gameState,Ie.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Ne(n,Ee.ChildFed,t.position)}},pk={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:yn,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==Qo||e.attackTargetId!==t.id)return!1;const i=G(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=fo,a=!s&&i<=yn;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?wu:pg,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:i}=n,s=G(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>fo,l=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),d=ZC(mt(l),t.direction);if(Math.abs(d)<rR*Math.PI/180&&Math.random()<sR)Ue(i,Ie.AttackDeflected,t.position,Ke,t.id);else{let p=a?hg:fg;if(e.gender==="male"&&(p*=nR),e.isAdult||(p*=iR),(!t.isAdult||t.age>=ug)&&e.isAdult&&(p*=oR),a){const S=s/gg;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+S,data:{attackerId:e.id,targetId:t.id,damage:p,pushbackForce:yg,attackerPosition:{...e.position}}}),Ue(i,Ie.StoneProjectile,e.position,S,void 0,t.position,t.id),Ne(n,Ee.Attack,e.position)}else{t.hitpoints-=p,t.movementSlowdown={modifier:Ru,endTime:i.time+Pu},Ue(i,Ie.Hit,t.position,Ke,t.id);const S=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),v=_t(S,Q_);t.forces.push(v),t.hitpoints<=0?Ne(n,Ee.HumanDeath,t.position):Ne(n,Ee.Attack,e.position),Ue(i,Ie.Attack,e.position,Ke,e.id)}}e.attackCooldown={melee:_u,ranged:mg};const f=e.stateMachine[1];f.attackStartTime=i.time}},gk={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:Rt*2,checker:(e,t,{gameState:n})=>G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const i=G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(i===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const a=(e.radius+t.radius-i)*.05,l=mt(Zp(e.position,t.position)),d=_t(l,a);e.forces.push(d),t.forces.push(_t(d,-1))}},mk={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:Rt*.6+Jl*.4,checker:(e,t,{gameState:n})=>{const i=t.stateMachine[0];if(i==="fallen"||i==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const d=l*2.5,u=mt(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=_t(u,d);e.forces.push(f)}},yk={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:Rt*.6+Jl*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const d=l*2.5,u=mt(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=_t(u,d);e.forces.push(f)}},vk={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:Rt*.6+Jl*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const d=l*2.5,u=mt(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=_t(u,d);e.forces.push(f)}},Sk={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:ze,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===ga&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Ue(n.gameState,Ie.BushClaimed,t.position,Ke),Ne(n,Ee.Gather,e.position)}},Ak={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:ze,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===ga&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,Ne(n,Ee.Gather,e.position)}},Ik={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:ze,checker:(e,t,n)=>e.isAdult&&t.stateMachine[0]===xt&&t.wood.length>0&&e.stateMachine[0]===ga&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const i=t.wood.pop();i&&(e.heldItem=i),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[co,{enteredAt:n.gameState.time,previousState:xt}]),Ne(n,Ee.Gather,e.position)}},Tk=[Sk,Ak,Ik],Ek={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:la,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=$D,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+xD,Ue(n.gameState,Ie.BushClaimed,t.position,Ke,e.id),Ne(n,Ee.Gather,e.position))}},Ck={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:XD,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=VD;const i=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=_t(i,8);t.forces.push(s),e.huntCooldown=ZD,t.hitpoints<=0?(Ne(n,Ee.HumanDeath,t.position),Ue(n.gameState,Ie.Hit,t.position,Ke,t.id)):(Ue(n.gameState,Ie.Hit,t.position,Ke,t.id),t.fleeCooldown=5,Ne(n,Ee.Attack,e.position)),Ue(n.gameState,Ie.Attack,e.position,Ke,e.id)}},wk={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:yn,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==Qo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=G(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=fo,a=!s&&i<=yn;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?wu:pg,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:i}=n,s=G(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>fo;let l=(a?hg:fg)*1.2;if(e.gender==="male"&&(l*=1.3),a){const u=s/gg;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+u,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:yg,attackerPosition:{...e.position}}}),Ue(i,Ie.StoneProjectile,e.position,u,void 0,t.position,t.id),Ne(n,Ee.Attack,e.position)}else{t.hitpoints-=l;const u=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),f=_t(u,6);t.forces.push(f),t.hitpoints<=0?(Ne(n,Ee.HumanDeath,t.position),Ue(i,Ie.Hit,t.position,Ke,t.id)):(Ue(i,Ie.Hit,t.position,Ke,t.id),t.fleeCooldown=8,Ne(n,Ee.Attack,e.position)),Ue(i,Ie.Attack,e.position,Ke,e.id)}e.attackCooldown={melee:_u,ranged:mg};const d=e.stateMachine[1];d.attackStartTime=i.time}},_k={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:Vr,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=zI;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:Ru,endTime:n.gameState.time+Pu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=_t(s,7);t.forces.push(a),e.attackCooldown=jI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Fg),Ne(n,Ee.HumanDeath,t.position),Ue(n.gameState,Ie.Hit,t.position,Ke,t.id)):(Ue(n.gameState,Ie.Hit,t.position,Ke,t.id),Ne(n,Ee.Attack,e.position)),Ue(n.gameState,Ie.Attack,e.position,Ke,e.id)}},Rk={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:yn,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==Qo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=G(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=fo,a=!s&&i<=yn;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?wu:pg,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:i}=n,s=G(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>fo;let l=(a?hg:fg)*.8;e.gender==="male"&&(l*=1.2);const d=Object.values(i.entities.entities).filter(f=>f.type==="human"&&f.id!==e.id).filter(f=>{const p=f;return Math.sqrt(Math.pow(p.position.x-e.position.x,2)+Math.pow(p.position.y-e.position.y,2))<100&&p.activeAction==="attacking"&&p.attackTargetId===t.id}).length;if(d>0&&(l*=1+d*.2),a){const f=s/gg;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+f,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:yg,attackerPosition:{...e.position}}}),Ue(i,Ie.StoneProjectile,e.position,f,void 0,t.position,t.id),Ne(n,Ee.Attack,e.position)}else{t.hitpoints-=l;const f=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),p=_t(f,8);t.forces.push(p),t.hitpoints<=0?(Ne(n,Ee.HumanDeath,t.position),Ue(i,Ie.Hit,t.position,Ke,t.id)):(Ue(i,Ie.Hit,t.position,Ke,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),Ne(n,Ee.Attack,e.position)),Ue(i,Ie.Attack,e.position,Ke,e.id)}e.attackCooldown={melee:_u,ranged:mg};const u=e.stateMachine[1];u.attackStartTime=i.time}},Pk={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:la,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Ue(n.gameState,Ie.Procreation,i.position,Ke,i.id),Ne(n,Ee.Procreate,i.position)}},Dk={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:ca,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.pregnancyFatherId=e.gender==="male"?e.id:t.id,i.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Ue(n.gameState,Ie.Procreation,i.position,Ke,i.id),Ne(n,Ee.Procreate,i.position)}},Mk={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:KI,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=cu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-cu),e.feedChildCooldownTime=qI,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ue(n.gameState,Ie.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Ne(n,Ee.ChildFed,t.position)}},Nk={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:KI,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=cu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-cu),e.feedChildCooldownTime=qI,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ue(n.gameState,Ie.ChildFed,t.position,Ke,t.id),t.lastChildFedEffectTime=n.gameState.time),Ne(n,Ee.ChildFed,t.position)}},bk={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:ca,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-Fg),e.eatingCooldownTime=n.gameState.time+2,Ue(n.gameState,Ie.Eating,e.position,Ke,e.id),Ne(n,Ee.Gather,e.position))}},Ok={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:Vr,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=zI;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:Ru,endTime:n.gameState.time+Pu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=_t(s,7);t.forces.push(a),e.attackCooldown=jI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Fg),Ne(n,Ee.HumanDeath,t.position),Ue(n.gameState,Ie.Hit,t.position,Ke,t.id)):(Ue(n.gameState,Ie.Hit,t.position,Ke,t.id),Ne(n,Ee.Attack,e.position)),Ue(n.gameState,Ie.Attack,e.position,Ke,e.id)}},kk={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:Kt,checker:(e,t,n)=>{var f;const i=t.buildingType===ue.StorageSpot,s=t.buildingType===ue.Bonfire;if(!i&&!s||e.stateMachine[0]!==Pl||!t.isConstructed)return!1;const a=e.food.length>0,l=((f=e.heldItem)==null?void 0:f.type)===At.Wood;if(s&&!l||!a&&!l)return!1;const d=t.storageCapacity??0;return!(t.storedItems.length>=d||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<pD)},perform:(e,t,n)=>{var s;let i=null;if(t.buildingType===ue.Bonfire?((s=e.heldItem)==null?void 0:s.type)===At.Wood&&(i=e.heldItem,e.heldItem=void 0):e.heldItem?(i=e.heldItem,e.heldItem=void 0):i=e.food.pop()??null,i&&(t.storedItems.push({item:i,positionOffset:lT(t)}),t.buildingType===ue.Bonfire)){const a=Zt(e,n.gameState);a&&a.aiBlackboard&&rT(a.aiBlackboard,t.id,"wood")}t.lastDepositTime=n.gameState.time,Ne(n,Ee.StorageDeposit,t.position)}},Bk={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:Kt,checker:(e,t,n)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Dl||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<gD),perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&(e.food.push(i.item),lT(t)),t.lastRetrieveTime=n.gameState.time,Ne(n,Ee.StorageRetrieve,t.position)}},Fk={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:Kt,checker:(e,t,n)=>{var d;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==ga||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const i=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!i||!((d=i.tribeControl)!=null&&d.diplomacy)||(t.ownerId?i.tribeControl.diplomacy[t.ownerId]:void 0)!==ut.Hostile||n.gameState.time-(t.lastStealTime??0)<mD)return!1;const l=jn({leaderId:t.ownerId},n.gameState);for(const u of l)if(G(e.position,u.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=yD)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&e.food.push(i.item),t.lastStealTime=n.gameState.time,Ne(n,Ee.StorageSteal,t.position),Ue(n.gameState,Ie.Attack,t.position,.5)}},Lk={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!Xt(e,t,n.gameState)||!xA(t.position,ia,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,zA(t.position,ia,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Ue(n.gameState,Ie.BushClaimed,t.position,2,t.id)}},Hk={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!Xt(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Ue(n.gameState,Ie.Hit,t.position,1,t.id)}},Uk={id:"supplyTransfer",sourceType:"human",targetType:"human",maxDistance:ze,checker:(e,t)=>!(e.activeAction!=="depositing"||t.activeAction!=="retrieving"||e.leaderId!==t.leaderId||e.food.length===0||t.food.length>=t.maxFood),perform:(e,t,n)=>{var l;const i=Math.min(((l=e.activeActionPayload)==null?void 0:l.amount)||1,e.food.length,t.maxFood-t.food.length),s=e.food.splice(0,i);t.food.push(...s);const a=Zt(t,n.gameState);a&&a.aiBlackboard&&rT(a.aiBlackboard,t.id,"food"),e.activeAction="idle",e.target=void 0,e.activeActionPayload=void 0,t.activeAction="idle",t.target=void 0,Ne(n,Ee.StorageDeposit,t.position)}},Gk={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:Tu,checker:(e,t,n)=>{const[i]=t.stateMachine??[],s=i===an||i===Vt||i===Sn;return e.isAdult&&s&&e.stateMachine[0]===Bg&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const{gameState:i}=n;if(t.stateMachine=[xt,{enteredAt:i.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/Jo),a=Math.floor($v+s*(Hu-$v));t.wood=Array.from({length:a},()=>({itemType:"item",type:At.Wood,id:i.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=i.time+1,Ne(n,Ee.Gather,e.position)}},xk=[gk,mk,yk,vk,...Tk,fk,hk,pk,kk,Bk,Fk,Lk,Hk,Uk,Gk,Ek,Mk,Nk,bk,Ck,wk,Rk,_k,Ok,Pk,Dk],oS=Object.values(xk.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const i={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[n].interactions.push(i),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));let rS=0;function $k(e){const{gameState:t}=e,n=t,{width:i,height:s}=t.mapDimensions;rS++;const a=rS%2===0;for(let l=0;l<oS.length;l++){const d=oS[l],u=n.search[d.sourceType].all();for(let f=0;f<u.length;f++){const p=u[f],m=n.search[d.targetType].byRadius(p.position,d.maxDistance);for(let S=0;S<m.length;S++){const v=m[S];if(p.id===v.id)continue;const A=Dn(p.position,v.position,i,s);for(let I=0;I<d.interactions.length;I++){const E=d.interactions[I];!E.isCollision&&a||A<=E.maxDistanceSq&&E.checker(p,v,e)&&E.perform(p,v,e)}}}}}function ET(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function Wk(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),i=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,p=50+Math.random()*100;a={x:Math.max(50,Math.min(Ze-50,u.position.x+Math.cos(f)*p)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*p))}}else a={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let l=!0;const d=100;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){l=!1;break}if(l){for(const u of i)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){l=!1;break}}if(l)return a}return{x:Ze*.3+Math.random()*Ze*.4,y:Qe*.3+Math.random()*Qe*.4}}function Yk(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,p=100+Math.random()*150;a={x:Math.max(50,Math.min(Ze-50,u.position.x+Math.cos(f)*p)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*p))}}else a={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let l=!0;const d=150;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){l=!1;break}if(l)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Ze,y:50+Math.random()*100};case 1:return{x:Ze-150+Math.random()*100,y:Math.random()*Qe};case 2:return{x:Math.random()*Ze,y:Qe-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Qe}}}function zk(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let i=0;i<20;i++){const s={x:50+Math.random()*(Ze-100),y:50+Math.random()*(Qe-100)};let a=!0;const l=80,d=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<l){a=!1;break}if(a){for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<d){a=!1;break}}if(a)return s}return{x:Math.random()*Ze,y:Math.random()*Qe}}function CT(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=Wk(n),a=i%2===0?"male":"female";da(e.entities,s,a,void 0,void 0,Yl())}}function wT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=Yk(n),a=i%2===0?"male":"female";ua(e.entities,s,a,void 0,void 0,zl())}}function jk(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count();let s=!1;return n===0&&(CT(e,6),s=!0),i===0&&(wT(e,3),s=!0),s}function Xk(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const l=Math.max(2,Math.floor(8-n));CT(e,l),a=!0}if(i>0&&i<2){const l=Math.max(1,Math.floor(3-i));wT(e,l),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let l=0;l<5;l++){const d=zk(t);tc(e.entities,d,e.time)}a=!0}return a}const Vk=1,Kk=.3,qk=.8,sS=.8,Zk=.99,Qk=.05;var _T=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.NO_ACTION=14]="NO_ACTION",e))(_T||{});const cp=Object.keys(_T).length/2;class Jk{constructor(){Re(this,"qTable",new Map);Re(this,"epsilon",sS);Re(this,"lastState",null);Re(this,"lastAction",null)}discretizeState(t,n,i){const s=Math.min(4,Math.floor(t/25)),a=Math.min(4,Math.floor(n/5)),l=Math.min(4,Math.floor(i/15));return`${s}-${a}-${l}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,i){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,i)}getBestAction(t){let n=0,i=this.getQValue(t,0);for(let s=1;s<cp;s++){const a=this.getQValue(t,s);a>i&&(i=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*cp):this.getBestAction(t)}applyEmergencyCorrections(t,n,i,s){t<io*.5&&(s.ecosystem.preyGestationPeriod=Math.max(Us,s.ecosystem.preyGestationPeriod*.8),s.ecosystem.preyProcreationCooldown=Math.max(Gs,s.ecosystem.preyProcreationCooldown*.8),s.ecosystem.preyHungerIncreasePerHour=Math.max(Ws,s.ecosystem.preyHungerIncreasePerHour*.9)),n<oo*.6&&(s.ecosystem.predatorGestationPeriod=Math.max(xs,s.ecosystem.predatorGestationPeriod*.75),s.ecosystem.predatorProcreationCooldown=Math.max($s,s.ecosystem.predatorProcreationCooldown*.75),s.ecosystem.predatorHungerIncreasePerHour=Math.max(Ys,s.ecosystem.predatorHungerIncreasePerHour*.85)),i<ro*.5&&(s.ecosystem.berryBushSpreadChance=Math.min(yl,s.ecosystem.berryBushSpreadChance*1.2)),t>io*1.4&&(s.ecosystem.preyHungerIncreasePerHour=Math.min(Wo,s.ecosystem.preyHungerIncreasePerHour*1.05)),n>oo*1.4&&(s.ecosystem.predatorHungerIncreasePerHour=Math.min(Yo,s.ecosystem.predatorHungerIncreasePerHour*1.05)),i>ro*1.4&&(s.ecosystem.berryBushSpreadChance=Math.max(so,s.ecosystem.berryBushSpreadChance*.95))}calculateReward(t,n,i){const s=Math.abs(t-io),a=Math.abs(n-oo),l=Math.abs(i-ro),d=s/io,u=a/oo,f=l/ro,p=d+u+f;return 100*Math.exp(-p*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(Br,n.ecosystem.preyGestationPeriod+.2*(Br-Us));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(Us,n.ecosystem.preyGestationPeriod-.2*(Br-Us));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(Fr,n.ecosystem.preyProcreationCooldown+.2*(Fr-Gs));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max(Gs,n.ecosystem.preyProcreationCooldown-.2*(Fr-Gs));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(Wo,n.ecosystem.preyHungerIncreasePerHour+.2*(Wo-Ws));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(Ws,n.ecosystem.preyHungerIncreasePerHour-.2*(Wo-Ws));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(Lr,n.ecosystem.predatorGestationPeriod+.2*(Lr-xs));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max(xs,n.ecosystem.predatorGestationPeriod-.2*(Lr-xs));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min(Hr,n.ecosystem.predatorProcreationCooldown+.2*(Hr-$s));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max($s,n.ecosystem.predatorProcreationCooldown-.2*(Hr-$s));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(Yo,n.ecosystem.predatorHungerIncreasePerHour+.2*(Yo-Ys));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(Ys,n.ecosystem.predatorHungerIncreasePerHour-.2*(Yo-Ys));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(yl,n.ecosystem.berryBushSpreadChance+.2*(yl-so));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(so,n.ecosystem.berryBushSpreadChance-.2*(yl-so));break}}updateQTable(t,n,i,s){const a=this.getQValue(t,n),l=Math.max(...Array.from({length:cp},(u,f)=>this.getQValue(s,f))),d=a+Kk*(i+qk*l-a);this.setQValue(t,n,d)}step(t){const n=t,i=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count();this.applyEmergencyCorrections(i,s,a,t);const l=this.discretizeState(i,s,a);if(this.lastState!==null&&this.lastAction!==null){const u=this.calculateReward(i,s,a);this.updateQTable(this.lastState,this.lastAction,u,l)}const d=this.chooseAction(l);this.applyAction(d,t),this.epsilon=Math.max(Qk,this.epsilon*Zk),this.lastState=l,this.lastAction=d}reset(){this.qTable.clear(),this.epsilon=sS,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let RT=new Jk;function eB(e){jk(e),Xk(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=Us+(Br-Us)*.3,e.ecosystem.preyProcreationCooldown=Gs+(Fr-Gs)*.3,e.ecosystem.preyHungerIncreasePerHour=Ws+(Wo-Ws)*.3,e.ecosystem.predatorGestationPeriod=xs+(Lr-xs)*.3,e.ecosystem.predatorProcreationCooldown=$s+(Hr-$s)*.3,e.ecosystem.predatorHungerIncreasePerHour=Ys+(Yo-Ys)*.3,e.ecosystem.berryBushSpreadChance=so+(yl-so)*.7),RT.step(e)}function tB(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<Vk)&&(e.ecosystem.lastUpdateTime=e.time,eB(e))}function nB(){return RT.getStats()}function iB(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function oB(e){const{gameState:t}=e,n=t.time,i=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of i)switch(a.type){case"ranged-impact":{const l=t.entities.entities[a.data.targetId];if(!l||l.hitpoints<=0)continue;l.hitpoints-=a.data.damage,l.movementSlowdown={modifier:Ru,endTime:t.time+Pu};const d=Xe(a.data.attackerPosition,l.position,t.mapDimensions.width,t.mapDimensions.height),u=_t(d,a.data.pushbackForce);l.forces.push(u),Ue(t,Ie.Hit,l.position,Ke,l.id),l.hitpoints<=0?Ne(e,Ee.HumanDeath,l.position):Ne(e,Ee.Attack,l.position);break}}}const PT="ownedIndices",aS="frontierScanIndex",Ml="frontierCandidates";function rB(e){const{gameState:t}=e,n=t,s=n.search.human.all().filter(f=>f.leaderId===f.id),{width:a,height:l}=t.mapDimensions,d=Math.ceil(a/me),u=Math.ceil(l/me);for(const f of s){if(!f.aiBlackboard)continue;const p=_.get(f.aiBlackboard,PT)||[];if(p.length===0)continue;let m=_.get(f.aiBlackboard,aS)||0;const S=_.get(f.aiBlackboard,Ml)||{},v=vn(f.id,t),A=20;for(let E=0;E<A;E++){m>=p.length&&(m=0);const P=p[m];m=(m+1)%p.length;const C=P%d,w=Math.floor(P/d),O=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:M,dy:D}of O){const N=(C+M+d)%d,k=(w+D+u)%u,U=k*d+N,z=t.terrainOwnership[U],K=z!==null&&Li(f.id,z,t);if(z===null||K){let X=0;for(const{dx:j,dy:fe}of O){const pe=(N+j+d)%d,Me=(k+fe+u)%u;t.terrainOwnership[Me*d+pe]===f.id&&X++}const J=X*20,q=kp(U,a),re=n.search.berryBush.byRadius(q,100),se=n.search.tree.byRadius(q,100),ie=re.length*10+se.length*5,Y=K?50:0,Q=G(q,v,a,l)/100*5,B=J+ie+Y-Q;S[U.toString()]={score:B,fromIdx:P,lastSeenTime:t.time}}}}const I=Object.entries(S).sort((E,P)=>P[1].score-E[1].score);if(I.length>50){const E={};for(let P=0;P<50;P++){const[C,w]=I[P];E[C]=w}_.set(f.aiBlackboard,Ml,E)}else _.set(f.aiBlackboard,Ml,S);_.set(f.aiBlackboard,aS,m)}}function sB(e){var m,S,v;const{gameState:t}=e,n=t,i=n.search.human.all(),s=new Map,a=new Set;for(let A=0;A<i.length;A++){const I=i[A];I.leaderId&&(s.has(I.leaderId)||s.set(I.leaderId,[]),s.get(I.leaderId).push(I),I.leaderId===I.id&&a.add(I.id))}const l=Object.values(t.tasks),d=new Map;for(let A=0;A<l.length;A++){const I=l[A];I.creatorEntityId&&(d.has(I.creatorEntityId)||d.set(I.creatorEntityId,[]),d.get(I.creatorEntityId).push(I))}const u=n.search.building.all(),f=new Map;for(let A=0;A<u.length;A++){const I=u[A];if(I.ownerId){const E=t.entities.entities[I.ownerId],P=E==null?void 0:E.leaderId;P&&(f.has(P)||f.set(P,[]),f.get(P).push(I))}}const p=new Map;for(const A of a)p.set(A,vn(A,t));for(const A of a){const I=t.entities.entities[A];if(!I)continue;const E=[];for(let k=0;k<t.terrainOwnership.length;k++)t.terrainOwnership[k]===A&&E.push(k);_.set(I.aiBlackboard,PT,E);const P=s.get(A)||[];if(P.length<Pg)continue;const C=P.filter(k=>k.isAdult);if(C.length===0)continue;const w=d.get(A)||[],O=k=>w.some(U=>U.type===k),M=f.get(A)||[],D=[];for(const[k,U]of p.entries())k!==A&&D.push(U);if(!O(V.HumanPlaceStorage)){const k=M.filter(J=>J.buildingType===ue.StorageSpot);let U=0,z=0;for(let J=0;J<k.length;J++){const q=k[J];U+=((m=q.storedItems)==null?void 0:m.length)||0,z+=q.storageCapacity||0}const K=z>0?U/z:0;if(k.length===0||K>bp){const J=k.length===0?BA:Xs,q=Vs(ue.StorageSpot,A,t,Qi,J,I.position,D);q&&_d(A,V.HumanPlaceStorage,q,t)}}if(!O(V.HumanPlaceBonfire)){const k=M.filter(re=>re.buildingType===ue.Bonfire),U=p.get(A),K=er(t.temperature,U,t.time,t.mapDimensions.width,t.mapDimensions.height)<qA&&k.length===0,X=k.length>0&&k.length<Math.ceil(C.length/ZA);let J;const q=P.filter(re=>er(t.temperature,re.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<lo+5?k.every(Y=>G(re.position,Y.position,t.mapDimensions.width,t.mapDimensions.height)>Or*1.5):!1);if(q.length>=3){const re=q.reduce((ie,Y)=>ie+Y.position.x,0)/q.length,se=q.reduce((ie,Y)=>ie+Y.position.y,0)/q.length;J={x:re,y:se}}if(K||X||J){const re=Vs(ue.Bonfire,A,t,Qi,Xs,J||I.position,D);re&&_d(A,V.HumanPlaceBonfire,re,t)}}if(!O(V.HumanPlacePlantingZone)){const U=M.filter(K=>K.buildingType===ue.PlantingZone&&vI(K,t)).reduce((K,X)=>K+_g(X),0),z=Math.max(Hs,C.length*Op);if(U<z){const K=Vs(ue.PlantingZone,A,t,Qi,Xs,I.position,D);K&&_d(A,V.HumanPlacePlantingZone,K,t)}}if((((v=(S=I.tribeControl)==null?void 0:S.armyControl)==null?void 0:v.expandBorders)??0)>=2){const k=_.get(I.aiBlackboard,Ml)||{},{width:U,height:z}=t.mapDimensions,K=M.filter(q=>q.buildingType===ue.BorderPost),X=w.filter(q=>q.type===V.HumanPlaceBorderPost);for(const q in k){const re=parseInt(q,10),se=t.terrainOwnership[re],ie=se!==null&&Li(I.id,se,t);if(se===A||se!==null&&!ie){delete k[q];continue}const Y=kp(re,U);(K.some(Q=>Dn(Y,Q.position,U,z)<100*100)||X.some(Q=>Dn(Y,Q.position,U,z)<100*100))&&delete k[q]}_.set(I.aiBlackboard,Ml,k);const J=3;if(X.length<J){const q=Object.entries(k).map(([Y,Z])=>({idx:parseInt(Y,10),...Z})).sort((Y,Z)=>Z.score-Y.score),re=[];for(const Y of q){if(re.length>=J-X.length)break;const Z=kp(Y.idx,U);re.every(B=>Dn(Z,B,U,z)>100*100)&&re.push(Z)}const se=new Set(X.map(Y=>{const Z=Y.id.split("-");return parseInt(Z[Z.length-1],10)}).filter(Y=>!isNaN(Y))),ie=[];for(let Y=0;Y<J;Y++)se.has(Y)||ie.push(Y);for(let Y=0;Y<re.length;Y++)_d(A,V.HumanPlaceBorderPost,re[Y],t,ie[Y])}}}}function _d(e,t,n,i,s=0){const a=`${V[t]}-${e}-${s}`;i.tasks[a]={id:a,position:n,type:t,creatorEntityId:e,target:n,validUntilTime:i.time+12}}function aB(e){const{gameState:t}=e,s=t.search.human.all().filter(a=>a.leaderId===a.id);for(const a of s){if(!a.aiBlackboard)continue;const l=`diplomacy-${a.id}`;if(t.tasks[l])continue;const d=_.get(a.aiBlackboard,"lastDiplomacyCheckTime")??-1/0;if(t.time-d<Mp)continue;const u={id:l,type:V.HumanDiplomacy,position:a.position,creatorEntityId:a.id,validUntilTime:t.time+Mp};t.tasks[l]=u}}const lB=1/60;function cB(e,t){if(!e.cameraFollowingPlayer)return;const n=Tt(e);n&&(e.viewportCenter=Wd(e.viewportCenter,n.position,Kd*t))}function Wu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(tg(e),e.lastAutosaveTime=n)}for(;t>0;){const n=pu(e),i=Math.min(t,lB),s=i*(Ot/Gt);n.time+=s,cB(n,i),fR(n),QN(n),tB(n),OP(n),kM(n),hR(n),oB({gameState:n}),XO({gameState:n,deltaTime:i}),$k({gameState:n,deltaTime:i}),rB({gameState:n}),Math.floor(n.time)>Math.floor(n.time-s)&&(IP(n),sB({gameState:n}),aB({gameState:n})),ET(n),tk(n,i),iB(n),e=n,t-=i}return e}function dp(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,d=iI;if(e.beginPath(),e.moveTo(i+d,s),e.lineTo(i+a-d,s),e.quadraticCurveTo(i+a,s,i+a,s+d),e.lineTo(i+a,s+l-d),e.quadraticCurveTo(i+a,s+l,i+a-d,s+l),e.lineTo(i+d,s+l),e.quadraticCurveTo(i,s+l,i,s+l-d),e.lineTo(i,s+d),e.quadraticCurveTo(i,s,i+d,s),e.closePath(),e.fillStyle=t.isDisabled?oI:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*lI)+1)/2;e.strokeStyle=aI,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<iu){const f=1-u/iu;e.fillStyle=sI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Eg,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?rI:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function dB(e,t,n,i){e.save(),e.font=`${wv}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,l=wv,d=a+_v*2,u=l+_v*2,f=i.x-d/2,p=e.canvas.height,m=t.y<p/2?t.y+t.height-Rv:t.y-u+Rv;e.fillStyle=H1,e.fillRect(f,m,d,u),e.fillStyle=U1,e.fillText(n,i.x,m+u/2+l/2),e.restore()}function uB(e,t,n){e.save();const i=Tt(t),s=[{id:"fastForwardButton",action:de.FastForward,text:"FFWD [T]",currentWidth:no*1.3,backgroundColor:Gn,textColor:ft,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:de.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?vl:Gn,currentWidth:t.isPaused?no*1.4:no*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:ft},{id:"muteButton",action:de.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?vl:Gn,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:no,rect:{x:0,y:0,width:0,height:0},textColor:ft},{id:"returnToIntroButton",action:de.ReturnToIntro,text:"EXIT",backgroundColor:Gn,tooltip:"Return to Main Menu [ESC]",currentWidth:no*.9,rect:{x:0,y:0,width:0,height:0},textColor:ft}];if(t.uiButtons.push(...s),i){const f=kg(t,i),p=new Set(f.map(C=>C.type));let m=[{playerAction:le.Gather,buttonAction:de.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>i.isAdult===!0},{playerAction:le.Eat,buttonAction:de.CommandEat,shortcut:"F",name:"Eat"},{playerAction:le.Plant,buttonAction:de.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>i.isAdult===!0},{playerAction:le.Procreate,buttonAction:de.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>i.isAdult===!0},{playerAction:le.FeedChild,buttonAction:de.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>i.isAdult===!0},{playerAction:le.Attack,buttonAction:de.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>i.isAdult===!0&&i.leaderId===i.id},{playerAction:le.ArmyControl,buttonAction:de.OpenArmyControl,shortcut:"V",name:"Army Control",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&li(i.id,t).length>XP},{playerAction:le.TribeSplit,buttonAction:de.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>i.leaderId!==void 0&&i.leaderId!==i.id&&i.isAdult===!0},{playerAction:le.Build,buttonAction:de.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&li(i.id,t).length>Pg},{playerAction:le.Build,buttonAction:de.OpenRoleManager,shortcut:"U",name:"Roles",toggleKey:"roleManagement",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Gu(i,t)}];m=m.filter(C=>C.condition?C.condition():!0);const S=1,v=m.length,A=v*Ln+(v-1)*Sr,I=S*Ln+(S-1)*Sr,E=(n-A)/2,P=e.canvas.height-I-20;if(m.forEach((C,w)=>{const O=w%v,M=Math.floor(w/v),D=E+O*(Ln+Sr),N=P+M*(Ln+Sr),k=!!C.toggleKey,U=k&&t.autopilotControls.behaviors[C.toggleKey],z=!p.has(C.playerAction),X=C.playerAction===le.Build&&t.buildMenuOpen,J=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",q=k?`${C.name}${J}`:C.name,re=U||X||C.buttonAction===de.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)?vl:Gn,se={id:`commandButton_${C.name}`,action:C.buttonAction,rect:{x:D,y:N,width:Ln,height:Ln},icon:C.buttonAction===de.OpenRoleManager?"":bu[C.playerAction],text:C.shortcut,backgroundColor:re,textColor:ft,currentWidth:Ln,tooltip:q,isDisabled:z,activated:U||C.buttonAction===de.CommandBuild&&X||C.buttonAction===de.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)};t.uiButtons.push(se)}),t.buildMenuOpen){const C=[{id:"buildMenu_storageSpot",action:de.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:de.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_bonfire",action:de.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:de.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:de.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"}],w=C.length,O=w*Ln+(w-1)*Sr,M=(n-O)/2,D=P-Ln-Sr;C.forEach((N,k)=>{const U=M+k*(Ln+Sr),z=D,K=N.action===de.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||N.action===de.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||N.action===de.SelectBorderPost&&t.selectedBuildingType==="borderPost"||N.action===de.SelectBonfire&&t.selectedBuildingType==="bonfire"||N.action===de.SelectRemovalTool&&t.selectedBuildingType==="removal",X={id:N.id,action:N.action,rect:{x:U,y:z,width:Ln,height:Ln},icon:N.icon,text:N.shortcut,backgroundColor:K?vl:Gn,textColor:ft,currentWidth:Ln,tooltip:N.name,activated:K};t.uiButtons.push(X),dp(e,X,t.hoveredButtonId===X.id)})}}let a=n-tt;s.forEach(f=>{const p=tt,m=a-f.currentWidth;f.rect={x:m,y:p,width:f.currentWidth,height:nI},dp(e,f,t.hoveredButtonId===f.id),a-=f.currentWidth+L1});let l=null;t.uiButtons.filter(f=>f.id.startsWith("commandButton_")||f.id.startsWith("buildMenu_")).forEach(f=>{l||(l={x:f.rect.x,y:f.rect.y,width:f.rect.width,height:f.rect.height}),l.x=Math.min(l.x,f.rect.x),l.y=Math.min(l.y,f.rect.y),l.width=Math.max(l.width,f.rect.x+f.rect.width-l.x),l.height=Math.max(l.height,f.rect.y+f.rect.height-l.y),f.id.startsWith("commandButton_")&&dp(e,f,t.hoveredButtonId===f.id)});const u=t.hoveredButtonId?t.uiButtons.find(f=>f.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&dB(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:l}}function fB(e){e.save(),e.fillStyle=x1,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=$1,e.font=`${W1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function Vp(e,t,n,i){const s=t.x-n.width/2,a=t.y-n.height/2,l=s+e.x,d=a+e.y,u=(l%i.width+i.width)%i.width,f=(d%i.height+i.height)%i.height;return{x:u,y:f}}function nc(e,t,n,i){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>i.width/2&&(s=s-Math.sign(s)*i.width),Math.abs(a)>i.height/2&&(a=a-Math.sign(a)*i.height),{x:s+n.width/2,y:a+n.height/2}}function Nl(e,t,n,i){const s=nc(e.position,t,n,i),l=("radius"in e?e.radius:20)+20;return s.x>=-l&&s.x<=n.width+l&&s.y>=-l&&s.y<=n.height+l}function oi(e,t,n,i,s,...a){const l={...s.position};for(let d=-n;d<=n;d+=n)for(let u=-t;u<=t;u+=t)s.position.x=l.x+u,s.position.y=l.y+d,i(e,s,...a);s.position=l}function DT(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const i=n.getContext("2d");if(!i)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:n,ctx:i}}function Ks(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function zr(e,t){return Math.round(e*t)/t}function $g(e,t=8){const i=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(i/(Math.PI*2)*t)%t}function Wg(e,t=8){const n=e/t*Math.PI*2;return[Math.cos(n),Math.sin(n)]}const hB=25,pB=0,lS=28;function MT(e,t,n,i,s,a,l,d,u,f){e.save();const{x:p,y:m}=nc(t,l,{width:d,height:u},f);e.strokeStyle=i,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(p,m,n+Du,0,2*Math.PI),e.stroke(),e.restore()}function gB(e,t,n,i,s,a,l){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&MT(e,m.targetEntity.position,m.targetEntity.radius,Ig,Tg,2,i,s,a,l)}),e.font=`${sa}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:d,y:u}=nc(n.position,i,{width:s,height:a},l);let f=0,p={};t.forEach(m=>{const S=bu[m.type];if(m.targetEntity){p[m.targetEntity.id]=(p[m.targetEntity.id]||0)+1;const v=m.targetEntity.position.x-i.x+s/2,A=m.targetEntity.position.y-i.y+a/2,I=`${S}${m.key.toUpperCase()}`,E=A-m.targetEntity.radius-Du-sa/2-(p[m.targetEntity.id]-1)*lS;e.fillText(I,v,E)}else{e.textAlign="left";const v=`${S}${m.key.toUpperCase()}`,A=d+hB,E=u+pB+f*lS;e.fillText(v,A,E),f++,e.textAlign="center"}}),e.restore()}function mB(e,t,n,i,s,a,l){const f=Kh+8+30,p={x:bv,y:a-bv-f,width:Kh,height:Kh};t.minimapRect=p,e.save(),e.fillStyle=pP,e.fillRect(p.x,p.y,p.width,p.height),e.strokeStyle=hP,e.lineWidth=2,e.strokeRect(p.x,p.y,p.width,p.height);const{width:m,height:S}=t.mapDimensions,v=Math.ceil(m/me),A=Math.ceil(S/me),I=new Map;i.forEach((he,Te)=>{const _e=he.isPlayerTribe?0:Te%(mn.length-1)+1;I.set(he.leaderId,mn[_e])});const E=p.width/v,P=p.height/A,C=p.x+p.width/2,w=p.y+p.height/2,O=v>400?4:v>200?2:1;for(let he=0;he<A;he+=O)for(let Te=0;Te<v;Te+=O){const _e=he*v+Te,ce=t.terrainOwnership[_e];if(ce!==null){const ve=(Te+.5)*me,Ge=(he+.5)*me,Pe=Xe(n,{x:ve,y:Ge},m,S),Xn=C+Pe.x/m*p.width,rt=w+Pe.y/S*p.height,it=t.hoveredMinimapTribeId===ce;if(e.fillStyle=I.get(ce)||"#888",it){const Vn=(Math.sin(t.time*5)+1)/2;e.globalAlpha=.6+Vn*.4}else e.globalAlpha=.8;e.fillRect(Xn-E*O/2,rt-P*O/2,E*O,P*O)}}e.globalAlpha=1,e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip();for(const he of i){if(!he.territoryCenter)continue;const Te=Xe(n,he.territoryCenter,m,S),_e=C+Te.x/m*p.width,ce=w+Te.y/S*p.height;e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="white",e.fillText(he.tribeBadge,_e,ce),he.isPlayerTribe&&(e.strokeStyle="gold",e.lineWidth=1,e.beginPath(),e.arc(_e,ce,10,0,Math.PI*2),e.stroke())}e.restore();const M=s/l,D=a/l,N=M/m*p.width,k=D/S*p.height;e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.strokeRect(C-N/2,w-k/2,N,k),e.restore(),e.restore();const U=p.y+p.height+8,z=p.x,K=U,X="recenter_camera_btn",J={id:X,action:de.RecenterCamera,rect:{x:z,y:K,width:30,height:30},text:"",currentWidth:30,backgroundColor:t.cameraFollowingPlayer?vl:Gn,textColor:ft,tooltip:"Lock camera to player"};t.uiButtons.push(J),e.fillStyle=t.hoveredButtonId===X?"#4a5568":J.backgroundColor,e.fillRect(z,K,30,30),e.strokeStyle="#666",e.strokeRect(z,K,30,30);const q=z+30/2,re=K+30/2,se=30*.35;e.strokeStyle=ft,e.lineWidth=2,e.beginPath(),e.arc(q,re,se,0,Math.PI*2),e.stroke();const ie=se*.6;e.beginPath(),e.moveTo(q-ie,re),e.lineTo(q+ie,re),e.moveTo(q,re-ie),e.lineTo(q,re+ie),e.stroke(),e.fillStyle=ft,e.beginPath(),e.arc(q,re,2,0,Math.PI*2),e.fill();const Y="open_tribe_modal_btn",Z=`Tribes (${i.length})`;e.font='10px "Press Start 2P", Arial';const Q=e.measureText(Z),B=Math.max(30,Q.width+16),j=30,fe=z+30+8,pe=U,Me={id:Y,action:de.OpenTribeModal,rect:{x:fe,y:pe,width:B,height:j},text:Z,currentWidth:B,backgroundColor:Gn,textColor:ft,tooltip:"View all tribes and diplomacy"};t.uiButtons.push(Me),e.fillStyle=t.hoveredButtonId===Y?"#4a5568":Gn,e.fillRect(fe,pe,B,j),e.strokeStyle="#666",e.strokeRect(fe,pe,B,j),e.fillStyle=ft,e.textAlign="center",e.textBaseline="middle",e.fillText(Z,fe+B/2,pe+j/2)}const Be=(e,t,n,i,s,a,l)=>{a==="transparent"||i<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*l),Math.floor(n*l),Math.ceil(i*l),Math.ceil(s*l)))},cS=10,dS=10,Di=6,Ki=4,Rd=2,yB=5,ii=4,vB=2,nn=4,SB=2,gt=3,Ps=2,Go=0,bl=Go+Ki-1,un=bl,wt=bl+ii-1,AB="rgba(0, 0, 0, 0.4)",IB=4,TB=1,Yg={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,i,s,a,l,d="male",u=20,f=[1,0],p=!1,m=0){const S=["dead","stunned"].includes(l),v=S?dS+4:cS,A=S?cS+4:dS+gt,I=.15,E=Math.min(i*(1-2*I)/v,s*(1-2*I)/A),P=v*E,C=A*E,w=t+(i-P)/2,O=n+(s-C)/2;e.save(),f[0]<0&&!S?(e.translate(w+P,O),e.scale(-1,1)):e.translate(w,O);const D="#D09A5A",N=u>50?"#BDBDBD":"#281808",k="#7F5C4A",U="#6B4F3A",z="#E0D8C0",K="#A0522D",X=1-Math.max(0,Math.min(100,m))/100*.2,J=d==="male"?1.1:.9,q=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let re=yB*X*J*q,se=vB*X*J*q,ie=SB*X*q;p&&d==="female"&&(re*=1.5);const Y=Math.round((v-re)/2),Z=Math.round((v-Di)/2),Q=Y-se,B=Y+re,j=1,fe=Y+(re/2-j/2)-ie,pe=Y+(re/2+j/2),Me=f[1]<-.2&&Math.abs(f[0])<.7,he=ce=>{e.fillStyle=AB,e.beginPath();const ve=v/2,Ge=ce;e.ellipse(Math.floor(ve*E),Math.floor(Ge*E),Math.max(1,Math.floor(IB*E)),Math.max(1,Math.floor(TB*E)),0,0,2*Math.PI),e.fill()},Te=(ce,ve)=>{d==="male"?(Be(e,Y,bl+ce,re,ii-Ps,ve,E),Be(e,Y,bl+ii-Ps+ce,re,Ps,k,E)):Be(e,Y,bl+ce,re,ii,U,E)},_e=(ce,ve)=>{Me?Be(e,Z,Go+ce,Di,Ki,N,E):(Be(e,Z,Go+ce,Di,Ki,ve,E),Be(e,Z,Go+ce,Di,Rd,N,E),d==="female"?(Be(e,Z-1,Go+Rd+ce,1,Ki,N,E),Be(e,Z+Di,Go+Rd+ce,1,Ki,N,E)):Be(e,Z+1,Go+2+ce,Di-2,Ki-2,N,E))};switch(l){case"idle":{const ce=a*Math.PI*2,ve=Math.sin(ce)*.5,Pe=(Math.cos(ce*2)+1)*.25;he(wt+gt+1),Be(e,fe+ve,wt+Pe,ie,gt,D,E),Be(e,pe-ve,wt+Pe,ie,gt,D,E),Te(Pe,D),Be(e,Q,un+Pe,se,nn,D,E),Be(e,B,un+Pe,se,nn,D,E),_e(Pe,D);break}case"walk":{const ce=a*Math.PI*2,ve=Math.sin(ce)*2,Pe=Math.abs(Math.cos(ce))*1;he(wt+gt+1),Be(e,fe+ve,wt+Pe,ie,gt,D,E),Be(e,pe-ve,wt+Pe,ie,gt,D,E),Te(Pe,D),Be(e,Q-ve,un+Pe,se,nn,D,E),Be(e,B+ve,un+Pe,se,nn,D,E),_e(Pe,D);break}case"gathering":{const ce=a*Math.PI*2,ve=1,Ge=(Math.sin(ce)+1)/2*2,Pe=ve+Math.abs(Math.cos(ce))*.5;he(wt+gt+1),Be(e,fe,wt+Pe,ie,gt-ve,D,E),Be(e,pe,wt+Pe,ie,gt-ve,D,E),Te(Pe,D),Be(e,Q+1,un+Pe-Ge,se,nn,D,E),Be(e,B-1,un+Pe-Ge,se,nn,D,E),_e(Pe,D);break}case"eat":{he(wt+gt+1),Be(e,fe,wt+1,ie,gt-1,D,E),Be(e,pe,wt+1,ie,gt-1,D,E),Te(1,D);const Ge=(Math.sin(a*Math.PI*4)+1)/2,Pe=Z+Di/2,Xn=Go+Ki/2,rt=B+(Pe-B)*Ge,it=un+1+(Xn-(un+1))*Ge;Be(e,Q,un+1,se,nn,D,E),Be(e,rt,it,se,nn,D,E),Be(e,rt,it-1,1,1,K,E),_e(1,D);break}case"procreate":{const ce=(Math.sin(a*Math.PI*8)+1)/4,ve=(Math.sin(a*Math.PI*6)+1)*.5,Ge=1.5,Pe=Ge-ve;he(wt+gt+1),Be(e,fe,wt+Pe,ie,gt-Ge,D,E),Be(e,pe,wt+Pe,ie,gt-Ge,D,E),Te(Pe,D),Be(e,Q,un+Pe,se,nn,D,E),Be(e,B,un+Pe,se,nn,D,E),_e(Pe,D),e.globalAlpha=ce,Te(Pe,"white"),e.globalAlpha=1;break}case"attacking":{const ce=Math.sin(a*Math.PI)*1.5,ve=Math.abs(Math.sin(a*Math.PI));he(wt+gt+1),Be(e,fe-ce,wt+ve,ie,gt,D,E),Be(e,pe+ce*.5,wt+ve,ie,gt,D,E),Te(ve,D),Be(e,Q,un+ve-2,se,nn,D,E),Be(e,B,un+ve-2.5,se,nn,D,E),_e(ve,D);break}case"defending":{he(wt+gt+1),Be(e,fe,wt+1,ie,gt-1,D,E),Be(e,pe,wt+1,ie,gt-1,D,E),Te(1,D),Be(e,Q-1,un+1-1,se,nn,D,E),Be(e,B+1,un+1-1,se,nn,D,E),_e(1,D);break}case"stunned":case"dead":{const ce=l==="dead",ve=ce?Math.min(1,a):0,Ge=ve>.5?z:D,Pe=d==="male"?k:U,Xn=ve>.8?"transparent":N,rt=v/2,it=A/2,Vn=2;he(A-1),Be(e,rt-ie-Vn,it,ie,gt,Ge,E),Be(e,rt+Vn,it,ie,gt,Ge,E),Be(e,rt-se-Vn,it-ii+1,se,nn,Ge,E),Be(e,rt+Vn,it-ii+1,se,nn,Ge,E);const In=rt-re/2,Kn=it-ii/2;d==="male"?(ve<.7&&Be(e,In,Kn+ii-Ps,re,Ps,Pe,E),Be(e,In,Kn,re,ii-Ps,Ge,E)):ve<.7?Be(e,In,Kn,re,ii,Pe,E):Be(e,In,Kn,re,ii,Ge,E);const Ai=rt-Di/2,Ii=it-ii/2-Ki+1;if(Be(e,Ai,Ii,Di,Ki,Ge,E),Xn!=="transparent"&&Be(e,Ai,Ii,Di,Rd,Xn,E),ce&&ve>.6){const ho="#B0A890";for(let or=0;or<3;or++)Be(e,In+1,Kn+or*1+1,re-2,.5,ho,E)}break}default:Be(e,0,0,v,A,"magenta",E);break}e.restore()}};function EB(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function Xl(e,t,n,i,s,a=!1,l=!1,d=!1,u=!1){i<dg&&(n=n*.75),Yg.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,i,[0,0],!1,0);let f,p;a?(f=D1,p=QA):l?(f=M1,p=tI):d?(f=N1,p=eI):u&&(f=b1,p=JA),f&&p&&EB(e,t,n/2,f,p)}function CB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s,d=4;let u;const f=l+(i.length-1)*d;i.length>1&&f>a?u=(a-l)/(i.length-1):u=d,i.length<=1&&(u=0);for(let p=0;p<i.length;p++){const{member:m,isPlayer:S,isHeir:v,isPartner:A,isParent:I}=i[p],E=t+p*(s+u)+s/2,P=n+s/4;Xl(e,{x:E,y:P},s,m.age,m.gender,S,v,A,I)}e.restore()}function wB(e,t,n,i,s){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,i,s);const a=500,l=Math.min(s*.8,n.length*(il+Ev)+120),d=(i-a)/2,u=(s-l)/2;e.fillStyle="#2d3748",e.strokeStyle="#4a5568",e.lineWidth=4,e.fillRect(d,u,a,l),e.strokeRect(d,u,a,l),e.fillStyle="#fff",e.font='20px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="top",e.fillText("WORLD TRIBES",i/2,u+30);const f=u+80,p=a-ol*4,m=d+ol*2;for(let C=0;C<n.length;C++){const w=n[C],O=f+C*(il+Ev);if(O+il>u+l-60)break;const M=O+il/2;w.isPlayerTribe&&(e.fillStyle="rgba(255, 215, 0, 0.2)",e.fillRect(m,O,p,il));let D=m+ol;if(e.font=`${vr}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillStyle="white",e.fillText(w.tribeBadge,D,M),D+=vr+ol*2,w.isPlayerTribe)e.fillStyle="#aaa",e.font='10px "Press Start 2P", Arial',e.textAlign="left",e.fillText("(YOU)",D,M);else{const N=w.diplomacyStatus===ut.Friendly?"":"",k=`modal_diplomacy_${w.leaderId}`,U={x:D,y:M-vr/2,width:vr*1.5,height:vr},z={id:k,action:de.ToggleDiplomacy,rect:U,text:"",icon:N,backgroundColor:"transparent",textColor:"white",currentWidth:U.width,tooltip:`Set status to ${w.diplomacyStatus===ut.Friendly?"Hostile":"Friendly"}`,targetTribeId:w.leaderId};t.uiButtons.push(z),t.hoveredButtonId===k&&(e.fillStyle=Eg,e.fillRect(U.x,U.y,U.width,U.height)),e.font=`${vr*.8}px Arial`,e.textAlign="center",e.fillText(N,U.x+U.width/2,M)}D+=vr*2+ol,Xl(e,{x:D+10,y:M},Zi*.6,25,"male"),e.fillStyle="white",e.font=`${O1}px "Press Start 2P"`,e.fillText(`${w.adultCount}`,D+30,M),D+=80,Xl(e,{x:D+10,y:M},Zi*.6,5,"female"),e.fillText(`${w.childCount}`,D+30,M)}const S=120,v=40,A=i/2-S/2,I=u+l-60,E="close_tribe_modal_btn",P={id:E,action:de.CloseTribeModal,rect:{x:A,y:I,width:S,height:v},text:"CLOSE",currentWidth:S,backgroundColor:Gn,textColor:ft};t.uiButtons.push(P),e.fillStyle=t.hoveredButtonId===E?"#4a5568":Gn,e.fillRect(A,I,S,v),e.strokeStyle="#fff",e.strokeRect(A,I,S,v),e.fillStyle=ft,e.font='12px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="middle",e.fillText("CLOSE",i/2,I+v/2),e.restore()}function _B(e,t,n,i,s){const a=uI,l=fI,d=t+i-a-l,u=n+l;e.save(),e.lineWidth=2,e.strokeStyle=s?J1:Q1,e.beginPath();const f=5;e.moveTo(d+f,u+f),e.lineTo(d+a-f,u+a-f),e.moveTo(d+a-f,u+f),e.lineTo(d+f,u+a-f),e.stroke(),e.restore()}function RB(e,t,n,i){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===pn.INACTIVE)return;const l=a.steps[s.currentStepIndex];if(!l)return;e.save(),e.globalAlpha=s.transitionAlpha;const d=Y1,u=z1,f=j1,p=`${Xh}px "Press Start 2P", Arial`,m=`${Pv}px "Press Start 2P", Arial`,S=V1,v=Pv*1.5;e.font=m;const A=l.text.split(" ");let I="";const E=[];for(let z=0;z<A.length;z++){const K=I+A[z]+" ";e.measureText(K).width>d-u*2&&z>0?(E.push(I),I=A[z]+" "):I=K}E.push(I);const P=u*2+Xh+u/2+E.length*v,C=(n-d)/2,w=i-P-160;e.fillStyle=X1,e.beginPath(),e.moveTo(C+f,w),e.lineTo(C+d-f,w),e.quadraticCurveTo(C+d,w,C+d,w+f),e.lineTo(C+d,w+P-f),e.quadraticCurveTo(C+d,w+P,C+d-f,w+P),e.lineTo(C+f,w+P),e.quadraticCurveTo(C,w+P,C,w+P-f),e.lineTo(C,w+f),e.quadraticCurveTo(C,w,C+f,w),e.closePath(),e.fill(),e.fillStyle=S,e.textAlign="center",e.textBaseline="top",e.font=p,e.fillText(l.title,C+d/2,w+u),e.font=m;let O=w+u+Xh+u/2;for(const z of E)e.fillText(z,C+d/2,O),O+=v;const M=t.hoveredButtonId==="tutorial-dismiss";_B(e,C,w,d,M),e.restore();const D=uI,N=fI,k=C+d-D-N,U=w+N;return{x:k,y:U,width:D,height:D}}function up(e,t,n){e.save();const i=Z1,s={x:t.x-i,y:t.y-i,width:t.width+i*2,height:t.height+i*2};e.strokeStyle=cI,e.lineWidth=dI+Math.sin(n*Cg)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function PB(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const NT=10,DB=3,uS=NT*.7;function MB(e,t){const{position:n,food:i,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,NT,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),i.length>0){const a=Math.PI*2/Math.min(i.length,s);for(let l=0;l<i.length;l++){const d=l*a,u=n.x+uS*Math.cos(d),f=n.y+uS*Math.sin(d);e.beginPath(),e.arc(u,f,DB,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const fS=(e,t,n=70,i=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${i}%)`},NB=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[i,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${i}, ${s}%, ${Math.max(0,a-t)}%)`},Pd=(e,t,n,i,s,a,l,d=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=d?NB(l,15):l,e.beginPath(),e.roundRect(-i/2,0,i,s,i/2),e.fill(),e.restore()},fp=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),i=75;if(!n)return`hsl(0, 0%, ${i}%)`;const[,s,a,l]=n.map(Number),d=a*(1-t),u=l+(i-l)*t;return`hsl(${s}, ${d}%, ${u}%)`},bT={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,i,s,a,l,d={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=i*.15,f=t+i/2,p=n+s/2,m=i-u*2,S=s-u*2,{gender:v,age:A,direction:I,isPregnant:E,hungryLevel:P,geneCode:C}=d,w=.8+Math.min(A,10)/10*.4,O=v==="male"?1.05:.95,M=1-P/100*.3,D=m*.5*M*w*O;let N=S*.3*w*O;const k=m*.15*w*O,U=D*.2,z=S*.3,K=fS(C,0,30,50);let X=fS(C,8,50,40);if(A>45){const he=Math.min(1,(A-45)/15);X=fp(X,he)}e.translate(f,p),I[0]<0&&e.scale(-1,1);const J=Math.sin(a*Math.PI*2),q=Math.cos(a*Math.PI*2),re=z+N*.2;if(l==="dead"){const he=Math.min(a,1);e.translate(0,S*.2),e.rotate(Math.PI/2);const Te=fp(X,he),_e=fp(K,he);e.globalAlpha=.5+he*.5,e.strokeStyle=Te,e.lineWidth=U*.5,e.beginPath(),e.moveTo(-D*.4,0),e.lineTo(D*.4,0),e.stroke();for(let ce=-1;ce<=1;ce+=1)e.beginPath(),e.arc(0,0,N*.4,Math.PI*.4*ce-Math.PI*.2,Math.PI*.4*ce+Math.PI*.2),e.stroke();e.fillStyle=_e,e.beginPath(),e.arc(D*.5,0,k,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(D*.55,0,k*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,re,D*.7,D*.25,0,0,2*Math.PI),e.fill();let se=0,ie=0,Y=0,Z=0,Q=0,B=0;switch(l){case"idle":ie=J*(S*.02),Y=J*.05,Z=-J*.05,Q=-J*.05,B=J*.05;break;case"walk":ie=Math.abs(q)*(S*-.04),Y=J*.7,Z=-J*.7,Q=-J*.7,B=J*.7;break;case"eat":se=S*.1,ie=S*.05,se+=J*(S*.02);break;case"procreate":ie=S*.05;const he=(1-q)*-m*.05;e.translate(he,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}E&&v==="female"&&(N*=1.6);const j=ie,fe=j-N*.2;Pd(e,D*-.35,fe,U,z,Q,X,!0),Pd(e,D*.35,fe,U,z,B,X,!0),e.fillStyle=X,e.beginPath(),e.ellipse(0,j,D/2,N/2,0,0,2*Math.PI),e.fill();const pe=D*.45,Me=fe+se;e.fillStyle=K,e.beginPath(),e.arc(pe,Me,k,0,Math.PI*2),e.fill(),I[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(pe+k*.3,Me-k*.2,k*.15,0,Math.PI*2),e.fill()),Pd(e,D*-.35,fe,U,z,Y,X),Pd(e,D*.35,fe,U,z,Z,X),e.restore()}};function bB(e,t){let[n,i,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),i=Math.max(0,i-t),s=Math.max(0,s-t),`rgb(${n}, ${i}, ${s})`}function OB(e){const t=(e&16711680)>>16,n=(e&65280)>>8,i=e&255,s=`rgb(${t}, ${n}, ${i})`,a=bB(s,40),l=(e&255)%100+50,d=(e>>8&255)%100,u=(e>>16&255)%100,f=`rgb(${l}, ${d}, ${u})`,p=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:f,eyeColor:p}}const OT={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,i,s,a,l,d={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:f,direction:p,isPregnant:m,hungryLevel:S,geneCode:v}=d;e.save();const A=i*.15,I=Math.max(1,Math.floor((i-A*2)/10)),E=p[0]<0;e.translate(t+i/2,n+s/2),E&&e.scale(-1,1);const P=OB(v),C=.8+Math.min(f,20)/20*.4,w=u==="male"?1.05:.95,O=1-S/100*.25,M=C*w*O,D=Math.max(0,Math.min(1,(f-15)/5));e.filter=`grayscale(${D})`;const N=P.furColor,k=P.darkerFurColor,U=P.eyeColor,z="#FFFFFF",K="#c75c5c",X="#E0E0E0",J="#A0A0A0",q=s/2-2*I,re=Math.sin(a*Math.PI*2),se=Math.abs(re);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,q,I*4,I,0,0,2*Math.PI),e.fill(),e.filter="none",l==="dead"){const rt=Math.min(1,a*2);e.save(),e.translate(0,q-I*3),e.rotate(-Math.PI/2);const it=(Vn,In,Kn,Ai,Ii=!1)=>{e.fillStyle=Ii?J:X,e.fillRect(Vn*I,In*I,Kn*I,Ai*I)};rt<1&&(e.globalAlpha=1-rt,e.fillStyle=N,e.beginPath(),e.ellipse(0,0,I*3,I*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),rt>0&&(e.globalAlpha=rt,it(-1,-4,2,2),it(1,-3.5,1,1,!0),it(-.5,-2,1,5,!0),it(-2.5,-1,5,.5),it(-2.5,0,5,.5),it(-2.5,1,5,.5),it(-3,-2,-1,2,!0),it(3,-2,1,2),it(-3,2,-1,2,!0),it(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=N;let ie=0,Y=0,Z=0,Q=[0,0,0,0];switch(l){case"idle":ie=re*I*.1;break;case"walk":const rt=Math.sin(a*Math.PI*4);ie=Math.abs(rt)*-I*.5,Q=[rt*I,-rt*I,-rt*I,rt*I];break;case"attacking":const it=Math.sin(a*Math.PI*4);Y=I*2+it*I,Z=I*2,ie=I;break;case"eat":Z=I*3+se*I,ie=I*1.5,e.fillStyle=K,e.fillRect(-I,q-I,I*2,I);break;case"procreate":ie=Math.sin(a*Math.PI*8)*I*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let In=0;In<5;In++){const Kn=(Math.random()-.5)*I*8,Ai=q+(Math.random()-.5)*I*2;se>.5&&e.fillRect(Kn,Ai,I*.5,I*.5)}break}const B=I*3*M*(m?1.3:1),j=I*5*M,fe=-j/1.5,pe=q-B-I*2.5+ie;e.fillStyle=N,e.beginPath(),e.moveTo(fe-I*.5,pe+B*.5),e.quadraticCurveTo(fe-I*3,pe-I,fe-I*2+re*I,pe+B+I),e.fill();const Me=I*1.2*M,he=I*3*M,Te=I*2.5*M,_e=fe+j*.8,ce=fe+j*.2;e.fillStyle=k,e.fillRect(ce,q-Te,Me,Te+Q[2]),e.fillRect(_e,q-he,Me,he+Q[0]),e.fillStyle=N,e.beginPath(),e.moveTo(fe,pe+B),e.lineTo(fe,pe+I),e.quadraticCurveTo(fe+j/2,pe,fe+j,pe+I),e.lineTo(fe+j,pe+B),e.fill(),e.fillStyle=N,e.fillRect(ce+I/2,q-Te,Me,Te+Q[3]),e.fillRect(_e+I/2,q-he,Me,he+Q[1]);const ve=I*3.5*M,Ge=fe+j-ve*.3+Y,Pe=pe-ve*.3+Z;e.fillStyle=N,e.beginPath(),e.arc(Ge,Pe,ve/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(Ge+ve*.4,Pe+ve*.2,I*1.5,I,0,0,Math.PI*2),e.fill(),p[1]>=0&&(e.fillStyle=U,e.fillRect(Ge+I*.5,Pe-I*.5,I*.5,I*.5),l==="attacking"&&(e.fillStyle=z,e.fillRect(Ge+ve*.5,Pe+ve*.4,I,I*.4))),e.fillStyle=k,e.beginPath(),e.moveTo(Ge-ve*.4,Pe-ve*.3),e.lineTo(Ge,Pe-ve*.7),e.lineTo(Ge,Pe-ve*.2),e.fill(),e.restore()}};class ic{constructor(t=200){Re(this,"cache",new Map);Re(this,"maxSize");this.maxSize=t}getOrRender(t,n,i,s){const a=this.cache.get(t);if(a)return this.cache.delete(t),this.cache.set(t,a),a;const{canvas:l,ctx:d}=DT(n,i);if(s(d),this.cache.size>=this.maxSize){const u=this.cache.keys().next().value;u!==void 0&&this.cache.delete(u)}return this.cache.set(t,l),l}clear(){this.cache.clear()}}const kB=9,BB=new ic(200);function FB(e,t){const{position:n,gender:i,age:s,decayProgress:a,food:l,radius:d,originalEntityType:u,geneCode:f}=t,p=zr(a,20),m=Math.floor(s),S=`${u}_${i}_${m}_${p}_${d}_${f||0}`,v=Math.ceil(d*2)+4,A=BB.getOrRender(S,v,v,I=>{I.translate(v/2,v/2),u==="human"?Yg.render(I,-v/2+2,-v/2+2,v-4,v-4,p,"dead",i,m,[0,0],!1,0):u==="prey"?bT.render(I,-v/2+2,-v/2+2,v-4,v-4,p,"dead",{gender:i,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}):u==="predator"&&OT.render(I,-v/2+2,-v/2+2,v-4,v-4,p,"dead",{gender:i,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024})});if(e.save(),e.globalAlpha=1-a,e.drawImage(A,n.x-A.width/2,n.y-A.height/2),e.restore(),l.length>0){e.save(),e.font=`${kB}px Arial`,e.textAlign="center",e.textBaseline="middle";const I=Rt*.9,E=Math.PI/CA*3;l.forEach((P,C)=>{const w=C*E,O=n.x+I*Math.cos(w)*Math.atan2(C,C),M=n.y+I*Math.sin(w)*Math.atan2(C,C),D=lg[P.type];e.fillText(D,O,M)}),e.restore()}}function zo(e,t,n,i,s,a,l,d){e.save(),e.fillStyle=l,e.fillRect(t,n,i,s),e.fillStyle=d,e.fillRect(t,n,i*Math.max(0,a),s),e.restore()}function LB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s;let d;l>a||l+(i.length-1)*4>a?d=(a-l)/(i.length-1):d=4,i.length===1&&(d=0);for(let u=0;u<i.length;u++){const f=lg[i[u].type];e.fillText(f,t+u*(s+d),n)}e.restore()}function HB(e,t,n,i,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let l,d=Rt/2;const u=bu[a.action],f=wI[a.action],p=`${u} ${f}`;if("targetEntityId"in a){const m=t.entities.entities[a.targetEntityId];m&&(l=m.position,d=m.radius)}else"position"in a&&(l=a.position);if(l){MT(e,l,d,Ig,Tg,2,n,i,s,t.mapDimensions),e.save(),e.font=`${sa}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:S}=nc(l,n,{width:i,height:s},t.mapDimensions),v=S-d-Du-sa/2;e.fillText(p,m,v),e.restore()}}function UB(e,t,n,i,s){e.save();const a=(Math.sin(s*Cg)+1)/2,l=n+Du+a*5;e.strokeStyle=Ig,e.lineWidth=2,e.setLineDash(Tg),e.beginPath(),e.arc(t.x,t.y,l,0,Math.PI*2),e.stroke(),e.setLineDash([]);const d=bu[i],u=wI[i];if(d){e.font=`${sa*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const f=t.y-l-25;e.fillText(d,t.x,f),e.font=`${sa*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,f+25)}e.restore()}function GB(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(Tt(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const l=t.entities.entities[n.targetEntityId];l&&(s=l.position,a=l.radius||(l.type==="building"?20:30))}if(s){const l=(d,u)=>{UB(d,u.position,a,n.action,t.time)};oi(e,t.mapDimensions.width,t.mapDimensions.height,l,{position:{...s}},s,a+30)}}}function hS(e,t,n,i,s,a,l=!0){const d=t.split(" ");let u="";const f=[];for(let p=0;p<d.length;p++){const m=u+d[p]+" ";e.measureText(m).width>s&&p>0?(f.push(u),u=d[p]+" "):u=m}if(f.push(u),l)for(let p=0;p<f.length;p++)e.fillText(f[p],n,i+p*a);return f.length*a}function xB(e){return 1-Math.pow(1-e,3)}function $B(e,t,n,i){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(l=>!l.isDismissed);if(s.length===0)return;e.save();let a=i-lP;for(const l of s){const d=n-yd-Ar;e.font=`${Vh}px "Press Start 2P", Arial`;const u=d+Ar,f=yd-Ar*2,p=hS(e,l.message,-9999,-9999,f,Vh*1.2,!1),m=Ar*2+p+Ri,S=a-m,v=Date.now()-l.creationTime,A=Math.min(v/aP,1),I=xB(A),E=i,P=E+(S-E)*I;e.fillStyle=tP,e.beginPath(),e.roundRect(d,P,yd,m,eP),e.fill(),e.fillStyle=nP,e.textBaseline="top",hS(e,l.message,u,P+Ar,f,Vh*1.2,!0);const C=P+m-Ri-Ar/2,w=d+yd-Ri-Ar/2,O={x:w,y:C,width:Ri,height:Ri};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[l.id]=O);const M=t.hoveredButtonId===`notification-dismiss-${l.id}`;if(e.fillStyle=M?Nv:iP,e.font=`${Ri}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",O.x+O.width/2,O.y+O.height/2),l.targetEntityIds||l.targetPosition||l.targetArea||l.targetRadius){const k={x:w-Ri-Mv,y:C,width:Ri,height:Ri};t.notificationButtonRects&&(t.notificationButtonRects.view[l.id]=k);const U=t.hoveredButtonId===`notification-view-${l.id}`;e.fillStyle=U?Nv:oP,e.font=`${Ri*(U?1.5:1.2)}px Arial`,e.fillText("",k.x+k.width/2,k.y+k.height/2)}a-=m+Mv}e.restore()}function WB(e){return e.length===0?0:e.reduce((n,i)=>n+i,0)/e.length}function hp(e,t,n,i,s,a,l,d){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(i,s,a,l),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(i,s,a,l);const u=WB(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,i+tt,s+tt+8);const f=Math.max(...n,1),p=n.map(m=>m/f*l);if(e.beginPath(),e.strokeStyle=d,e.lineWidth=2,p.length>1){e.moveTo(i,s+l-p[0]);for(let m=1;m<p.length;m++){const S=i+m/(p.length-1)*a,v=s+l-p[m];e.lineTo(S,v)}}else if(p.length===1){const m=s+l-p[0];e.moveTo(i,m),e.lineTo(i+a,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${f.toFixed(2)}ms`,i+a-tt,s+tt+8),e.restore()}function YB(e,t,n){const{performanceMetrics:i}=t;if(!i)return;const s=280,a=240,l=n-s-tt,d=tt+at*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(l,d,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(l,d,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=d+tt+5;const f=l+tt;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",f,u),u+=25,e.fillStyle="white",e.font="12px monospace";const p=zB(t);e.fillText(`FPS: ${p.toFixed(1)}`,f,u),u+=20;const m=s-tt*2,S=45,v=10;hp(e,"Render",pp(t,"renderTime"),f,u,m,S,"#4CAF50"),u+=S+v,hp(e,"World Update",pp(t,"worldUpdateTime"),f,u,m,S,"#2196F3"),u+=S+v,hp(e,"AI Update",pp(t,"aiUpdateTime"),f,u,m,S,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",l+s/2,d+a-10),e.restore()}function zB(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(Ot/Gt);return t.history.filter(a=>n-a.bucketTime/(Ot/Gt)<1).length}function jB(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const l=Math.floor(a.bucketTime/(Ot/Gt));n.set(l,(n.get(l)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function pp(e,t){return jB(e.performanceMetrics.history,t)}function fu(e,t,n,i,s,a,l){e.save();const{position:d}=t;e.strokeStyle=i,e.lineWidth=s+Math.sin(l*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(d.x,d.y,n,0,2*Math.PI),e.stroke(),e.restore()}function XB(e,t,n,i){if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;const a=Zt(s,t);if(!a||!a.aiBlackboard)return;const l=Kr(a.aiBlackboard),d=500,u=Math.min(i*.9,700),f=n-d-10,p=tt+at*2;t.debugPanelRect={x:f,y:p,width:d,height:u},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(f,p,d,u),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(f,p,d,u),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";const m=14,S=f+15;let v=p+20;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Supply Chain Debugger",S,v),v+=25,e.fillStyle="#aaaaaa",e.font="11px monospace",e.fillText(`Tribe Leader: ${a.isPlayer?"Player":"#"+a.id}`,S,v),v+=m,e.fillText(`Current Time: ${t.time.toFixed(1)}h`,S,v),v+=20;const A=v,I=u-(A-p)-30;VB(e,t,l,S,A,d-30,I,m),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+4' to toggle this debugger",f+d/2,p+u-10),e.restore()}function VB(e,t,n,i,s,a,l,d){var A,I;const u=((A=t.debugPanelScroll)==null?void 0:A.x)??0,f=((I=t.debugPanelScroll)==null?void 0:I.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-u,-f);let p=s;e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(` Active Demands (${n.length})`,i,p),p+=18,n.length===0?(e.fillStyle="#888888",e.font="11px monospace",e.fillText("No active demands",i,p),p+=d):[...n].sort((P,C)=>C.updatedAt-P.updatedAt).forEach((P,C)=>{const w=t.entities.entities[P.requesterId];let O=w?w.isPlayer?"Player":`Human #${w.id}`:`Unknown #${P.requesterId}`;w&&(O+=` (Food: ${w.food.length}), Active action: ${w.activeAction||"idle"}`);let M="None";if(P.claimedBy){const U=t.entities.entities[P.claimedBy];M=U?U.isPlayer?"Player":`Human #${U.id}`:`Unknown #${P.claimedBy}`,U&&(M+=" (Food: "+U.food.length+"), Active action: "+(U.activeAction||"idle")+")")}const D=t.time-P.updatedAt,N=p,k=d*5+10;e.fillStyle=P.claimedBy?"rgba(50, 100, 50, 0.3)":"rgba(50, 50, 50, 0.3)",e.fillRect(i-5,N-2,a,k),e.strokeStyle=P.claimedBy?"#44ff44":"#666666",e.lineWidth=1,e.strokeRect(i-5,N-2,a,k),e.fillStyle="#ffaa00",e.font="bold 12px monospace",e.fillText(`#${C+1}`,i,p),p+=d,e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Requester: ${O}`,i+10,p),p+=d,e.fillStyle="#ffff88",e.fillText(`Resource: ${P.resourceType}`,i+10,p),p+=d,e.fillStyle=P.claimedBy?"#44ff44":"#ff8844",e.fillText(`Status: ${P.claimedBy?"Claimed":"Pending"}`,i+10,p),p+=d,P.claimedBy?(e.fillStyle="#aaffaa",e.fillText(`Mover: ${M}`,i+10,p)):(e.fillStyle="#888888",e.fillText(`Mover: ${M}`,i+10,p)),p+=d,e.fillStyle="#aaaaaa",e.font="10px monospace",e.fillText(`Updated: ${D.toFixed(1)}h ago`,i+10,p),p+=d+5}),p+=10,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Statistics",i,p),p+=18;const m=n.filter(E=>!E.claimedBy).length,S=n.filter(E=>E.claimedBy).length;e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Total Demands: ${n.length}`,i,p),p+=d,e.fillStyle="#ff8844",e.fillText(`Pending: ${m}`,i,p),p+=d,e.fillStyle="#44ff44",e.fillText(`Claimed: ${S}`,i,p),p+=d;const v=p-s;t.debugPanelContentSize={width:a,height:v},e.restore()}function KB(e,t,n){if(!n.debugCharacterId)return;const i=n.search.human.byProperty("id",n.debugCharacterId)[0];if(!i)return;const s=Zt(i,n);if(!s||!s.aiBlackboard||s.id!==t.leaderId)return;Kr(s.aiBlackboard).some(l=>l.requesterId===t.id)&&fu(e,t,t.radius+15,"#ff6644",3,2,n.time),t.tribeRole===ae.Mover&&fu(e,t,t.radius+15,"#44ff44",3,2,n.time)}const qB={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"},ZB=new ic(1e4);function QB(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?Rt+20:Rt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,i.x,i.y-l+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function JB(e,t,n,i,s){e.save(),e.font=`${wl}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(i?Rt:ha)-wl-s),e.restore()}function eF(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function tF(e,t,n){var d;const{position:i,radius:s}=t,a=i.x-jh/2,l=i.y-s-k1;if(t.stateMachine[0]===Qo){const u=t.stateMachine[1],f=n-u.attackStartTime,p=Math.min(f/wu,1);zo(e,a,l,jh,Cv,p,$o,B1)}else if((d=t.attackCooldown)!=null&&d.melee&&t.attackCooldown.melee>0){const u=1-t.attackCooldown.melee/_u;zo(e,a,l,jh,Cv,u,$o,F1)}}function nF(e,t,n=!1,i=!1,s=!1,a=!1,l=!1,d=!1,u=!1,f){var k,U;const{position:p,activeAction:m="idle"}=t,S=t.isAdult?Rt:Rt*.6,v=qB[m]||"idle",A=zr(t.animationProgress||0,12),I=$g(t.direction,8),E=Math.floor(t.age),P=zr(t.hunger/100,5)*100,C=`${v}_${t.gender}_${E}_${I}_${A}_${t.isPregnant??!1}_${P}_${S}`,w=Math.ceil(S*2)+4,O=ZB.getOrRender(C,w,w,z=>{z.translate(w/2,w/2);const K=Wg(I,8);Yg.render(z,-w/2+2,-w/2+2,w-4,w-4,A,v,t.gender,E,K,t.isPregnant??!1,P)});e.drawImage(O,p.x-O.width/2,p.y-O.height/2),d&&(e.save(),e.strokeStyle=m1,e.lineWidth=2,e.beginPath(),e.arc(p.x,p.y,S+3,0,2*Math.PI),e.stroke(),e.restore());let M,D;if(l?(M=v1,D=tI):n?(M=y1,D=QA):s?(M=S1,D=g1):i?(M=A1,D=JA):a&&(M=I1,D=eI),M&&D&&eF(e,p,S,M,D),(k=t.tribeInfo)!=null&&k.tribeBadge&&JB(e,p,t.tribeInfo.tribeBadge,t.isAdult??!1,M??0),t.heldItem){const z=wg[t.heldItem.type],K=(U=t.tribeInfo)!=null&&U.tribeBadge?wl:0;e.save(),e.font=`${wl}px Arial`,e.textAlign="center",e.textBaseline="middle";const X=p.y-(t.isAdult?Rt:ha)-wl-(M??0)-K;e.fillText(z,p.x,X),e.restore()}const N=u&&(f.debugCharacterId===void 0||t.id===f.debugCharacterId);tF(e,t,f.time),N&&QB(e,t),f.debugPanel===je.SupplyChain&&KB(e,t,f)}const iF={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},oF=new ic(200);function rF(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?Rt+20:Rt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function sF(e,t,n=!1,i){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,d=iF[a]||"idle",u=zr(t.animationProgress||0,12),f=$g(t.direction||{x:1,y:0},8),p=Math.floor(t.age),m=zr(t.hunger/100,5)*100,S=`${d}_${p}_${f}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,v=Math.ceil(l*2)+4,A=oF.getOrRender(S,v,v,E=>{E.translate(v/2,v/2);const P=Wg(f,8);bT.render(E,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:p,direction:P,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(A,s.x-A.width/2,s.y-A.height/2),t.hitpoints<t.maxHitpoints){const E=l*1.5,P=3,C=s.x-E/2,w=s.y-l-8;e.fillStyle="#555",e.fillRect(C,w,E,P);const O=t.hitpoints/t.maxHitpoints;e.fillStyle=O>.5?"#4CAF50":O>.25?"#FFC107":"#F44336",e.fillRect(C,w,E*O,P)}n&&(i===void 0||t.id===i)&&rF(e,t)}const aF={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},lF=new ic(200);function cF(e,t){const{radius:n,position:i,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?Rt+20:Rt*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function dF(e,t,n=!1,i){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,d=aF[a]||"idle",u=zr(t.animationProgress||0,12),f=$g(t.direction||{x:1,y:0},8),p=Math.floor(t.age),m=zr(t.hunger/100,5)*100,S=`${d}_${p}_${f}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,v=Math.ceil(l*2)+4,A=lF.getOrRender(S,v,v,E=>{E.translate(v/2,v/2);const P=Wg(f,8);OT.render(E,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:p,direction:P,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(A,s.x-A.width/2,s.y-A.height/2),t.hitpoints<t.maxHitpoints){const E=l*1.5,P=3,C=s.x-E/2,w=s.y-l-8;e.fillStyle="#555",e.fillRect(C,w,E,P);const O=t.hitpoints/t.maxHitpoints;e.fillStyle=O>.5?"#4CAF50":O>.25?"#FFC107":"#F44336",e.fillRect(C,w,E*O,P)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,l+3,0,2*Math.PI),e.stroke()),n&&(i===void 0||t.id===i)&&cF(e,t)}const kT=15;function uF(e,t,n,i,s=1.5){const a=n-t.startTime,l=Math.min(a/t.duration,1),d=1-l,f=1+Math.sin(l*Math.PI*2)*(s-1),p=kT*f;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,p),0,Math.PI*2),e.fillStyle=i,e.fill(),e.restore()}function cl(e,t,n,i,s=2){const a=n-t.startTime,l=Math.min(a/t.duration,1),d=1-l,u=kT*2*l;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=i,e.lineWidth=s,e.stroke(),e.restore()}function Xi(e,t,n,i){const s=n-t.startTime,a=Math.min(s/t.duration,1),l=1-a,d=-20*a;e.save(),e.globalAlpha=l,e.font="20px Arial",e.textAlign="center",e.fillText(i,t.position.x,t.position.y+d),e.restore()}function fF(e,t,n,i){const{width:s,height:a}=i.mapDimensions;let l=t.targetPosition;if(t.targetEntityId){const I=i.entities.entities[t.targetEntityId];I&&(l=I.position)}if(!l)return;const d=n-t.startTime,u=Math.min(d/t.duration,1);let f=l.x-t.position.x,p=l.y-t.position.y;f=f-Math.round(f/s)*s,p=p-Math.round(p/a)*a;const m={x:f,y:p},S=t.position.x+m.x*u,v=t.position.y+m.y*u,A=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(S,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(S,v+A),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function BT(e,t,n,i){switch(t.type){case Ie.Procreation:Xi(e,t,n,"");break;case Ie.Pregnant:uF(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Ie.TargetAcquired:cl(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Ie.Attack:Xi(e,t,n,"");break;case Ie.Partnered:Xi(e,t,n,"");break;case Ie.BushClaimed:cl(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Ie.BushClaimLost:cl(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Ie.Eating:Xi(e,t,n,"");break;case Ie.ChildFed:Xi(e,t,n,"");break;case Ie.AttackDeflected:Xi(e,t,n,"");break;case Ie.AttackResisted:Xi(e,t,n,"");break;case Ie.Hit:Xi(e,t,n,"");break;case Ie.SeizeBuildup:cl(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Ie.BorderClaim:Xi(e,t,n,"");break;case Ie.Seize:cl(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Ie.StoneProjectile:fF(e,t,n,i);break}}const pS=8,hF=1.5,pF=.5,gS=2,gF="#5a5a5a",mF="#7e7e7e",yF="#8B0000",vF="#FF4444",SF=6,AF=new ic(1e3),mS=20;function IF(e,t,n=!1,i=!0){if(n)return`ghost_${e.buildingType}_${i}`;const s=e,a=s.buildingType===ue.Bonfire&&(s.fuelLevel??0)>0;return`${s.id}_${s.buildingType}_${s.width}_${s.height}_${t}_${s.isConstructed}_${a}`}function FT(e,t,n=!1,i=!0){const s=IF(e,t,n,i),{width:a,height:l,id:d,buildingType:u}=e,f=a+mS*2,p=l+mS*2;return AF.getOrRender(s,f,p,m=>{const S=nr[u],v="isConstructed"in e?e.isConstructed:!0;if(m.translate(f/2,p/2),n){const A=i?"#4CAF50":"#F44336";gp(m,a,l,9999,A),m.font=`${Math.min(a,l)*.5}px Arial`,m.textAlign="center",m.textBaseline="middle",m.fillStyle=A,m.fillText(S.icon,0,0)}else{const A=e;let I=S.icon;A.buildingType===ue.Bonfire&&v&&(I=(A.fuelLevel??0)>0?"":""),t?gp(m,a,l,d,yF,vF):gp(m,a,l,d),m.globalAlpha=.5,m.font=`${Math.min(a,l,30)*.5}px Arial`,m.textAlign="center",m.textBaseline="middle",m.shadowColor="rgba(0,0,0,0.5)",m.shadowBlur=4,m.fillStyle="#FFFFFF",m.fillText(I,0,0)}})}function gp(e,t,n,i,s,a){const l=(t+n)*2,d=Math.floor(l/pS),u=-t/2,f=t/2,p=-n/2,m=n/2;for(let S=0;S<d;S++){const v=i+S*13,A=Ks(v),I=Ks(v+1);let E=S*pS,P=0,C=0;E<t?(P=u+E,C=p):E<t+n?(P=f,C=p+(E-t)):E<t*2+n?(P=f-(E-(t+n)),C=m):(P=u,C=m-(E-(t*2+n)));const w=(I-.5)*gS,O=(Ks(v+2)-.5)*gS;e.beginPath();const M=hF+A*pF;s?e.fillStyle=s:e.fillStyle=A>.5?a||mF:s||gF,e.ellipse(P+w,C+O,M,M*.85,I*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function TF(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:i}=t;e.save(),e.font=`${SF}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,i.forEach(s=>{const a=s.item.type,l=(lg[a]||wg[a])??"?",d={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(l,d.x,d.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function EF(e,t,n){const{position:i,width:s,height:a,constructionProgress:l,destructionProgress:d,isConstructed:u,isBeingDestroyed:f}=t,p=Tt(n),m=!!(p&&Xt(p,t,n)),S=FT(t,m);e.save(),u||(e.globalAlpha=.3+l*.7),e.drawImage(S,i.x-S.width/2,i.y-S.height/2),e.restore();const v=s,A=i.x-v/2,I=i.y+a/2+iw;u?f&&zo(e,A,I,v,Xy,1-d,$o,nw):zo(e,A,I,v,Xy,l,$o,tw),(t.buildingType===ue.StorageSpot||t.buildingType===ue.Bonfire)&&u&&TF(e,t)}function CF(e,t,n,i,s){const a=nr[n],{width:l,height:d}=a.dimensions,u=FT({buildingType:n,width:l,height:d,id:9999},!1,!0,i),f=(m,S)=>{m.save(),m.globalAlpha=ew,m.drawImage(u,S.x-u.width/2,S.y-u.height/2),m.restore()},p={position:{...t},radius:Math.max(l,d)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:_.create()};oi(e,s.width,s.height,(m,S)=>f(m,S.position),p)}const Bs=1,wF=20,yi=4,yS=8,_F="rgba(34, 85, 34, 0.25)",RF="rgba(139, 50, 50, 0.25)",qs=new Map,PF=50;function DF(e,t){return e.map(n=>n.id).sort((n,i)=>n-i).join(",")+`_${t}`}function MF(){if(qs.size>PF){const e=qs.keys().next().value;e&&qs.delete(e)}}function NF(e){const t=new Map;for(const n of e){const i=n.ownerId;i&&(t.has(i)||t.set(i,[]),t.get(i).push(n))}return t}function bF(e,t,n,i){let s=0;const a=Math.max(i.width,i.height)/2;for(const l of n){const d=e-l.position.x,u=t-l.position.y,f=d*d+u*u;f>0?s+=a*a/f:s+=100}return s}function OF(e,t,n){let i=1/0,s=1/0,a=-1/0,l=-1/0;for(const d of e)i=Math.min(i,d.position.x-t.width/2),s=Math.min(s,d.position.y-t.height/2),a=Math.max(a,d.position.x+t.width/2),l=Math.max(l,d.position.y+t.height/2);return{minX:i-n,minY:s-n,maxX:a+n,maxY:l+n}}function kF(e,t,n,i){const s=DF(e,i);if(qs.has(s))return qs.get(s);const a=n.maxX-n.minX,l=n.maxY-n.minY,d=Math.ceil(a/yi),u=Math.ceil(l/yi),f=[],p=[];for(let v=0;v<u;v++)f[v]=new Array(d);for(let v=0;v<u;v++)for(let A=0;A<d;A++){const I=n.minX+A*yi,E=n.minY+v*yi,P=bF(I,E,e,t);f[v][A]=P}for(let v=1;v<u-1;v++)for(let A=1;A<d-1;A++)if(f[v][A]>=Bs&&(f[v-1][A]<Bs||f[v+1][A]<Bs||f[v][A-1]<Bs||f[v][A+1]<Bs)){const E=n.minX+A*yi,P=n.minY+v*yi;p.push({x:E,y:P})}const m=LF(p),S={fieldValues:f,edgePoints:p,regions:m,bounds:n};return qs.set(s,S),MF(),S}function BF(e,t,n,i,s,a){if(t.length===0)return;const{bounds:l}=a,d=10;if(!a.canvas){const u=l.maxX-l.minX+d*2,f=l.maxY-l.minY+d*2,{canvas:p,ctx:m}=DT(u,f);m.translate(-l.minX+d,-l.minY+d);const{fieldValues:S,regions:v}=a;FF(m,S,l,i);let A=s;for(const I of v){const E=HF(I);UF(m,E,i,A),A+=1e3}a.canvas=p}e.save(),e.globalAlpha=1,e.drawImage(a.canvas,l.minX-d,l.minY-d),e.restore()}function FF(e,t,n,i){const s=i?RF:_F;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++)if(t[a][l]>=Bs){const d=n.minX+l*yi,u=n.minY+a*yi;e.rect(d,u,yi,yi)}e.fill(),e.restore()}function LF(e){if(e.length===0)return[];const t=yi*2,n=t,i=new Map;function s(f,p){const m=Math.floor(f/n),S=Math.floor(p/n);return`${m},${S}`}for(let f=0;f<e.length;f++){const p=s(e[f].x,e[f].y);i.has(p)||i.set(p,[]),i.get(p).push(f)}function a(f,p){const m=[],S=Math.floor(f/n),v=Math.floor(p/n);for(let A=-1;A<=1;A++)for(let I=-1;I<=1;I++){const E=`${S+A},${v+I}`,P=i.get(E);P&&m.push(...P)}return m}const l=new Set,d=[],u=t*t;for(let f=0;f<e.length;f++){if(l.has(f))continue;const p=[],m=[f];for(;m.length>0;){const S=m.shift();if(l.has(S))continue;l.add(S),p.push(e[S]);const v=a(e[S].x,e[S].y);for(const A of v){if(l.has(A))continue;const I=e[A].x-e[S].x,E=e[A].y-e[S].y;I*I+E*E<=u&&m.push(A)}}p.length>0&&d.push(p)}return d}function HF(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const i=t[t.length-1];let s=0,a=1/0;for(let l=0;l<n.length;l++){const d=n[l].x-i.x,u=n[l].y-i.y,f=d*d+u*u;f<a&&(a=f,s=l)}t.push(n.splice(s,1)[0])}return t}function UF(e,t,n,i){if(t.length===0)return;let s=0,a=0;for(let l=1;l<t.length;l++){const d=t[l-1],u=t[l],f=u.x-d.x,p=u.y-d.y,m=Math.sqrt(f*f+p*p);for(s+=m;s>=yS;){s-=yS;const S=1-s/m,v=d.x+f*S,A=d.y+p*S;GF(e,v,A,n,i+a*13),a++}}}function GF(e,t,n,i,s){const a=Ks(s),l=Ks(s+1),d=(l-.5)*2,u=(Ks(s+2)-.5)*2;e.beginPath();const f=1.5+a*.5;i?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+d,n+u,f,f*.85,l*Math.PI,0,Math.PI*2),e.fill(),i||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function xF(e,t,n,i){var m,S,v;const s=t;if(!((m=s.search)!=null&&m.building))return;const l=s.search.building.all().filter(A=>A.buildingType===ue.PlantingZone&&A.isConstructed);if(l.length===0)return;const d=l.filter(A=>Nl(A,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(d.length===0)return;const u=nr[ue.PlantingZone].dimensions,f=NF(d),p=i?t.entities.entities[i]:void 0;for(const[A,I]of f){const E=((v=(S=p==null?void 0:p.tribeControl)==null?void 0:S.diplomacy)==null?void 0:v[A])==="Hostile",P=typeof A=="number"?A:0,C=OF(I,u,wF),w=kF(I,u,C,E);BF(e,I,u,E,P,w)}}const $F=.001,WF=.05,YF=12;function zF(e,t,n){const{position:i,age:s,swayOffset:a}=t,[l]=t.stateMachine??[],d=Math.min(1,Math.max(.4,s/Jo)),f=l!==xt&&l!==co?Math.sin(n*$F+a)*WF:0;if(e.save(),e.translate(i.x,i.y),e.scale(d,d),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=IM,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),l===co?mp(e,10,8):l===xt?(e.rotate(Math.PI/2),mp(e,10,30),e.translate(0,-25),vS(e,40,20,40,15)):(e.rotate(f),mp(e,10,30),e.translate(0,-25),e.rotate(f*.5),vS(e,40,20,40,15)),e.restore(),(l===xt||l===co)&&t.wood&&t.wood.length>0){e.save(),e.font=`${YF}px Arial`,e.textAlign="center",e.textBaseline="middle";const p=t.radius*1.1,m=Math.PI*2/(Hu-1);t.wood.forEach((S,v)=>{const A=v===0?0:p,I=v===0?0:(v-1)*m,E=i.x+A*Math.cos(I),P=i.y+A*Math.sin(I),C=wg[S.type];e.fillText(C,E,P)}),e.restore()}}function mp(e,t,n){e.fillStyle=mM,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=yM,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function vS(e,t,n,i,s){e.fillStyle=vM,SS(e,t+4,n+4,i+2,s+2),e.translate(0,-2),e.fillStyle=SM,SS(e,t,n,i,s),e.fillStyle=AM,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function SS(e,t,n,i,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-i),e.lineTo(0,-i-s),e.lineTo(n/2,-i),e.lineTo(t/2,0),e.closePath(),e.fill()}const Dd=200;let Fo=null;function jF(e,t,n,i,s){const a=OM(t.time);if(a<=0)return;Fo||(Fo=document.createElement("canvas")),(Fo.width!==i.width||Fo.height!==i.height)&&(Fo.width=i.width,Fo.height=i.height);const l=Fo.getContext("2d");if(l){l.clearRect(0,0,i.width,i.height),l.fillStyle=`rgba(0, 0, 40, ${a*.85})`,l.fillRect(0,0,i.width,i.height),l.globalCompositeOperation="destination-out";for(const d of s){const u=nc(d.position,n,i,t.mapDimensions),f=l.createRadialGradient(u.x,u.y,0,u.x,u.y,d.radius);f.addColorStop(0,`rgba(255, 255, 255, ${d.intensity})`),f.addColorStop(1,"rgba(255, 255, 255, 0)"),l.fillStyle=f,l.beginPath(),l.arc(u.x,u.y,d.radius,0,Math.PI*2),l.fill()}l.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(Fo,0,0),e.restore()}}function AS(e,t,n,i,s,a,l){for(let d=-s.height;d<=s.height;d+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const f={x:t.x+u,y:t.y+d};Nl({position:f,radius:n},a,l,s)&&e.push({position:f,radius:n,intensity:i})}}function XF(e,t,n,i,s,a=[]){const l=Tt(t),d=l?Mn(t,l):[],u=Wr(d),{width:f,height:p}=t.mapDimensions,m=[];a.forEach(P=>{m.push({position:P,radius:30,intensity:.3})}),xF(e,t,i,l==null?void 0:l.leaderId);const S=t,v={left:i.x-s.width/2-Dd,top:i.y-s.height/2-Dd,right:i.x+s.width/2+Dd,bottom:i.y+s.height/2+Dd};[...S.search.human.byRect(v),...S.search.building.byRect(v),...S.search.berryBush.byRect(v),...S.search.tree.byRect(v),...S.search.corpse.byRect(v),...S.search.prey.byRect(v),...S.search.predator.byRect(v)].sort((P,C)=>n&&P.id===t.debugCharacterId&&P.id!==C.id||P.type==="building"&&C.type!=="building"||P.position.y<C.position.y?-1:P.position.y>C.position.y?1:P.id-C.id).forEach(P=>{var C,w;if(P.type==="building"){const O=P;if(O.isConstructed){const M=O.buildingType===ue.Bonfire&&(O.fuelLevel??0)>0,D=M?180:60,N=M?.9:.4;AS(m,O.position,D,N,t.mapDimensions,i,s)}if(O.buildingType===ue.PlantingZone&&O.isConstructed)return;oi(e,f,p,EF,O,t,l,t.time)}else if(P.type==="berryBush")oi(e,f,p,MB,P,t,l,t.time);else if(P.type==="tree")oi(e,f,p,zF,P,t.time);else if(P.type==="human"){const O=P,M=O.id===(l==null?void 0:l.id),D=d.some(K=>K.id===O.id),N=O.id===(u==null?void 0:u.id),k=l&&(O.id===l.motherId||O.id===l.fatherId),U=l&&(((C=O.partnerIds)==null?void 0:C.includes(l.id))||((w=l.partnerIds)==null?void 0:w.includes(O.id))),z=(l==null?void 0:l.attackTargetId)===O.id;AS(m,O.position,40,.3,t.mapDimensions,i,s),oi(e,f,p,nF,O,M,k,D,U,N,z,n,t)}else P.type==="corpse"?oi(e,f,p,FB,P):P.type==="prey"?oi(e,f,p,sF,P,n,t.time,t.debugCharacterId):P.type==="predator"&&oi(e,f,p,dF,P,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(P=>Nl(P,i,s,t.mapDimensions)).forEach(P=>{oi(e,f,p,BT,P,t.time,t)});const E=t.notifications.filter(P=>!P.isDismissed);for(const P of E)if(P.highlightedEntityIds&&P.renderHighlights)for(const C of P.highlightedEntityIds){const w=t.entities.entities[C];w&&Nl(w,i,s,t.mapDimensions)&&oi(e,f,p,fu,w,cP,dP,fP,uP,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const P of t.tutorialState.highlightedEntityIds){const C=t.entities.entities[P];C&&Nl(C,i,s,t.mapDimensions)&&oi(e,f,p,fu,C,q1,cI,dI,Cg,t.time)}jF(e,t,i,s,m)}function VF(e,t,n,i,s,a){let l=null,d=null;e.textAlign="left";let u=tt+at;const p=t.time/(Ot/Gt)/Iu%1,m=rl[bs.Time],S=25,v=tt+S;e.fillText(m,tt,u+Fn/2+at/3),zo(e,v,u,Oo,Fn,p,$o,P1),u+=Fn+ji;const A=u+Zi/2,I=u+(Zi-Fn)/2,E=5;Xl(e,{x:tt*2,y:A},Zi,5,n.gender,!1,!1,!1);const P=tt+Zi+E,C=Oo+S-(Zi+E)*2;zo(e,P,I,C,Fn,Math.floor(n.age)/Ll,$o,R1),Xl(e,{x:P+C+E+Zi/2,y:A},Zi,Ll,n.gender,!1,!1,!1),u+=Fn+ji*2;const w=[],O=new Set;if(w.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),O.add(n.id),i&&!O.has(i.id)&&(w.push({member:i,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),O.add(i.id)),s.forEach(q=>{O.has(q.id)||(w.push({member:q,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),O.add(q.id))}),a.forEach(q=>{O.has(q.id)||(w.push({member:q,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),O.add(q.id))}),n.motherId&&!O.has(n.motherId)){const q=t.entities.entities[n.motherId];q&&(w.push({member:q,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),O.add(q.id))}if(n.fatherId&&!O.has(n.fatherId)){const q=t.entities.entities[n.fatherId];q&&(w.push({member:q,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),O.add(q.id))}const M=rl[bs.Family],D=10,N=tt+at+D,k=Oo+S-(at+D),U=u+md/2;e.font=`${at}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(M,tt,U);const z=u+md/2;CB(e,N,z,w,md,k),u+=md+ji,e.textBaseline="alphabetic";const K=rl[bs.Hitpoints];e.fillText(K,tt,u+Fn/2+at/3),zo(e,v,u,Oo,Fn,n.hitpoints/n.maxHitpoints,$o,_1),u+=Fn+ji;const X=rl[bs.Hunger];e.fillText(X,tt,u+Fn/2+at/3),zo(e,v,u,Oo,Fn,(rn-n.hunger)/rn,$o,w1),l={x:tt,y:u-ji/2,width:Oo+S,height:Fn+ji},u+=Fn+ji,e.textBaseline="middle";const J=rl[bs.Food];return e.fillText(J,tt,u+gd/2),LB(e,v,u+gd/2,n.food,gd,Oo),d={x:tt,y:u-ji/5,width:Oo+S,height:gd+ji},e.textBaseline="alphabetic",{hungerBarRect:l,foodBarRect:d}}let dl=[],IS=0;const KF=36,qF=200;function ZF(e,t,n,i){const s=t.search.prey.count(),a=t.search.predator.count(),l=t.search.berryBush.count();t.time-IS>=KF&&(dl.push({time:t.time,prey:s,predators:a,bushes:l}),dl.length>qF&&(dl=dl.slice(-200)),IS=t.time);const d=Ze*Qe,u=s/d*1e6,f=a/d*1e6,p=l/d*1e6,m=nB(),S=Math.floor(t.time/(24*365)),v=Math.floor(t.time%(24*365)/24),A=Math.floor(t.time%24),I=400,E=Math.min(i*.8,600),P=n-I-10,C=tt+at*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(P,C,I,E),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(P,C,I,E),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let w=C+20;const O=14,M=P+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",M,w),w+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${S}, Day ${v}, Hour ${A}`,M,w),w+=O,e.fillText(`Map Size: ${Ze}  ${Qe} pixels`,M,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",M,w),w+=18,m&&(e.fillText(`Q-Table Size: ${m.qTableSize} entries`,M,w),w+=O,e.fillText(`Exploration Rate: ${(m.explorationRate*100).toFixed(1)}%`,M,w),w+=O);const D=dl.slice(-20);D.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",M,w),w+=30,QF(e,M,w,D),w+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",M,w),w+=18,e.fillStyle="white",e.font="12px monospace";const N=(io/d*1e6).toFixed(2),k=(oo/d*1e6).toFixed(2),U=(ro/d*1e6).toFixed(2);e.fillText(`Prey: ${u.toFixed(2)} (target: ${N})`,M,w),w+=O,e.fillText(`Predators: ${f.toFixed(2)} (target: ${k})`,M,w),w+=O,e.fillText(`Bushes: ${p.toFixed(2)} (target: ${U})`,M,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",M,w),w+=18,e.fillStyle="white",e.font="12px monospace";const z=Math.round(s/io*100),K=Math.round(a/oo*100),X=Math.round(l/ro*100),J=q=>q<50?"#ff4444":q<80?"#ffaa44":q>120?"#44aaff":"#44ff44";e.fillStyle=J(z),e.fillText(`Prey: ${s}/${io} (${z}%)`,M,w),w+=O,e.fillStyle=J(K),e.fillText(`Predators: ${a}/${oo} (${K}%)`,M,w),w+=O,e.fillStyle=J(X),e.fillText(`Bushes: ${l}/${ro} (${X}%)`,M,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",M,w),w+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",M,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,M,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,M,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,M,w),w+=13,e.fillText("Predators:",M,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,M,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,M,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,M,w),w+=13,e.fillText("Bushes:",M,w),w+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,M,w),w+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",P+I/2,C+E-10),e.restore()}function QF(e,t,n,i){if(i.length<2)return;const d={prey:Math.max(...i.map(f=>f.prey),io),predators:Math.max(...i.map(f=>f.predators),oo),bushes:Math.max(...i.map(f=>f.bushes),ro)};[{data:i.map(f=>f.prey),color:"#44ff44",label:"Prey",target:io,max:d.prey},{data:i.map(f=>f.predators),color:"#ff4444",label:"Predators",target:oo,max:d.predators},{data:i.map(f=>f.bushes),color:"#ffaa44",label:"Bushes",target:ro,max:d.bushes}].forEach((f,p)=>{const m=t+p*115,S=n;e.fillStyle=f.color,e.font="10px monospace",e.fillText(f.label,m,S-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,S,100,30),e.beginPath(),e.strokeStyle=f.color;for(let A=0;A<f.data.length;A++){const I=m+A/(f.data.length-1)*100,E=S+30-f.data[A]/f.max*30;A===0?e.moveTo(I,E):e.lineTo(I,E)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=S+30-f.target/f.max*30;e.moveTo(m,v),e.lineTo(m+100,v),e.stroke(),e.setLineDash([])})}function JF(e,t){const n=t.search.human.byProperty("leaderId",e),i={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||i.children++,s.gender==="male"?i.males++:s.gender==="female"&&i.females++,s.age>=ug&&i.old++;return i}function eL(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(f=>n.berryBush.byRadius(f.position,f.radius)).reduce((f,p)=>f+p.food.length,0),u=n.building.byProperty("ownerId",e).filter(f=>f.buildingType===ue.StorageSpot).reduce((f,p)=>f+(p.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:u,consumptionRate:0}}function tL(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,l=new Map,d=new Map;for(const f of s){const p=au(f.id,t,l);d.has(p)||d.set(p,[]),d.get(p).push(f)}const u=[];for(const[f,p]of d.entries()){const m=a[f];m&&u.push({patriarch:m,memberCount:p.length,members:p.map(S=>S.id)})}return u.sort((f,p)=>p.memberCount-f.memberCount),u.slice(0,n)}let ul=[],Mi=[],TS=0;const nL=36,ES=200;function iL(e,t,n,i){var O;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(O=Zt(s,t))==null?void 0:O.id;if(!a)return;const l=JF(a,t),d=eL(a,t);if(t.time-TS>=nL){ul.push({time:t.time,total:l.total,children:l.children,males:l.males,females:l.females,old:l.old});const M=d.totalBushFood+d.totalStorageFood;Mi.push({time:t.time,bushFood:d.totalBushFood,storageFood:d.totalStorageFood,totalFood:M}),ul.length>ES&&(ul=ul.slice(-200)),Mi.length>ES&&(Mi=Mi.slice(-200)),TS=t.time}let u=0;if(Mi.length>=2){const M=Mi[Mi.length-1],D=Mi[Mi.length-2],N=M.time-D.time;N>0&&(u=(D.totalFood-M.totalFood)/N)}const f=400,p=Math.min(i*.9,700),m=n-f-10,S=tt+at*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,S,f,p),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,S,f,p),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=S+20;const A=13,I=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",I,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",I,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${l.total}`,I,v),v+=A,e.fillStyle="#00ffff",e.fillText(`Children: ${l.children}`,I,v),v+=A,e.fillStyle="#4488ff",e.fillText(`Males: ${l.males}`,I,v),v+=A,e.fillStyle="#ff88ff",e.fillText(`Females: ${l.females}`,I,v),v+=A,e.fillStyle="#888888",e.fillText(`Old (${l.old})`,I,v),v+=20;const E=ul.slice(-50);E.length>1&&(oL(e,I,v,E),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",I,v),v+=18;const P=d.totalBushFood+d.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${P}`,I,v),v+=A,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${d.totalBushFood}`,I,v),v+=A,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${d.totalStorageFood}`,I,v),v+=A,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,I,v),v+=20;const C=Mi.slice(-50);C.length>1&&(rL(e,I,v,C),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",I,v),v+=18;const w=tL(a,t,5);e.fillStyle="white",e.font="11px monospace",w.length===0?(e.fillText("No families found",I,v),v+=A):w.forEach((M,D)=>{const k=`${D+1}. ${M.patriarch.isPlayer?"Player":"#"+M.patriarch.id} (${M.memberCount} members, can split: ${FI(M.patriarch,t).canSplit})`;e.fillText(k,I,v),v+=A}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+f/2,S+p-10),e.restore()}function oL(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.total),color:"#ffffff",label:"Total"},{data:i.map(u=>u.children),color:"#00ffff",label:"Children"},{data:i.map(u=>u.males),color:"#4488ff",label:"Males"},{data:i.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:i.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const p=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function rL(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:i.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:i.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const p=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function CS(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,d=iI;if(e.beginPath(),e.moveTo(i+d,s),e.lineTo(i+a-d,s),e.quadraticCurveTo(i+a,s,i+a,s+d),e.lineTo(i+a,s+l-d),e.quadraticCurveTo(i+a,s+l,i+a-d,s+l),e.lineTo(i+d,s+l),e.quadraticCurveTo(i,s+l,i,s+l-d),e.lineTo(i,s+d),e.quadraticCurveTo(i,s,i+d,s),e.closePath(),e.fillStyle=t.isDisabled?oI:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*lI)+1)/2;e.strokeStyle=aI,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<iu){const f=1-u/iu;e.fillStyle=sI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Eg,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?rI:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.font=`${at*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function sL(e,t,n,i){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,i);const s=500,a=150,l=(n-s)/2,d=(i-a)/2;e.fillStyle=ft,e.font=`${at*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,d+a/3-10),e.fillText("to the main menu?",n/2,d+a/3+10);const u=no*1.5,f=nI,p=d+a-f-tt*2,m=20,S=u*2+m,v=l+(s-S)/2,A={id:"confirmExitYes",action:de.ConfirmExitYes,rect:{x:v,y:p,width:u,height:f},text:"Yes",backgroundColor:Gn,textColor:ft,currentWidth:u},I=v+u+m,E={id:"confirmExitNo",action:de.ConfirmExitNo,rect:{x:I,y:p,width:u,height:f},text:"No",backgroundColor:Gn,textColor:ft,currentWidth:u};t.uiButtons.push(A,E),CS(e,A,t.hoveredButtonId===A.id),CS(e,E,t.hoveredButtonId===E.id),e.restore()}const Lo=600,Ds=30,Ni=60,Yt=30,aL="";function lL(e,t,n){const i=[];if(!n.tribeControl||!n.leaderId)return i;const{width:s,height:a}=e.canvas,l=(s-Lo)/2,d=480,u=(a-d)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(l,u,Lo,d,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=ft,e.font=`${at*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Tribe Roles",l+Lo/2,u+Ds);const f=30,p=l+Lo-Ds-f,m=u+Ds,S=t.hoveredButtonId==="roleManager_close";e.fillStyle=S?"#ff7777":"#ff5555",e.fillRect(p,m,f,f),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",p+f/2,m+f/2),i.push({id:"roleManager_close",action:de.CloseRoleManager,rect:{x:p,y:m,width:f,height:f},text:"X",currentWidth:f,backgroundColor:"#ff5555",textColor:"#ffffff"});const A=li(n.leaderId,t).filter(X=>X.isAdult),I={[ae.Leader]:0,[ae.Gatherer]:0,[ae.Planter]:0,[ae.Hunter]:0,[ae.Mover]:0,[ae.Warrior]:0};A.forEach(X=>{X.tribeRole&&I[X.tribeRole]++});const E=n.tribeControl.roleWeights,P=[{role:ae.Gatherer,emoji:"",name:"Gatherer"},{role:ae.Planter,emoji:"",name:"Planter"},{role:ae.Hunter,emoji:"",name:"Hunter"},{role:ae.Mover,emoji:"",name:"Mover"},{role:ae.Warrior,emoji:"",name:"Warrior"}];let C=0;P.forEach(X=>{C+=E[X.role]||0});let w=u+Ds+70;const O=l+Ds,M=l+Lo-Ds;P.forEach(X=>{const J=E[X.role]||0,q=C>0?Math.round(J/C*100):0,re=I[X.role]||0;e.textAlign="left",e.textBaseline="middle",e.font=`${at*.8}px "Press Start 2P", Arial`,e.fillStyle=ft,e.fillText(`${X.emoji} ${re} ${X.name}`,O,w+Ni/2);const se=l+220,ie=se+Yt+15,Z=ie+200+15,Q=`role_minus_${X.role}`,B=t.hoveredButtonId===Q,j=J<=0,fe=j?"#555":B?"#dd6666":"#cc4444";e.fillStyle=fe,e.fillRect(se,w+(Ni-Yt)/2,Yt,Yt),e.fillStyle=j?"#888":"#fff",e.textAlign="center",e.fillText("-",se+Yt/2,w+Ni/2+2),i.push({id:Q,action:de.DecreaseRoleWeight,targetRole:X.role,rect:{x:se,y:w+(Ni-Yt)/2,width:Yt,height:Yt},text:"-",currentWidth:Yt,backgroundColor:fe,textColor:"#fff",isDisabled:j}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#fff";let pe=ie;for(let ce=0;ce<J;ce++)e.fillText(aL,pe,w+Ni/2+2),pe+=18;const Me=`role_plus_${X.role}`,he=t.hoveredButtonId===Me,Te=J>=10,_e=Te?"#555":he?"#66dd66":"#44cc44";e.fillStyle=_e,e.fillRect(Z,w+(Ni-Yt)/2,Yt,Yt),e.fillStyle=Te?"#888":"#fff",e.textAlign="center",e.font=`${at*.8}px "Press Start 2P", Arial`,e.fillText("+",Z+Yt/2,w+Ni/2+4),i.push({id:Me,action:de.IncreaseRoleWeight,targetRole:X.role,rect:{x:Z,y:w+(Ni-Yt)/2,width:Yt,height:Yt},text:"+",currentWidth:Yt,backgroundColor:_e,textColor:"#fff",isDisabled:Te}),e.textAlign="right",e.font=`${at*.8}px "Press Start 2P", Arial`,e.fillStyle=ft,e.fillText(`${q}%`,M,w+Ni/2),w+=Ni});const D=I[ae.Leader],N=Object.values(I).reduce((X,J)=>X+J,0),k=A.length-N;e.textAlign="center",e.fillStyle="#aaa",e.font=`${at*.6}px "Press Start 2P", Arial`,e.fillText(`Adults: ${A.length} | Leader: ${D} | Assigned: ${N} | Unassigned: ${k}`,l+Lo/2,w+10),e.fillText("(Adjust weights to control role distribution)",l+Lo/2,w+30);const U=t.autopilotControls.behaviors.roleManagement,z=U?" Auto-adjust: ON":" Auto-adjust: OFF",K=U?"#4CAF50":"#888";return e.fillStyle=K,e.font=`${at*.6}px "Press Start 2P", Arial`,e.fillText(`${z} (Shift+U to toggle)`,l+Lo/2,w+50),e.restore(),i}const _r=600,Ms=30,bi=60,zt=30,wS=[{key:"protectHomeland",emoji:"",name:"Protect Homeland",description:"Stay inside territory and protect from enemies"},{key:"expandBorders",emoji:"",name:"Expand Borders",description:"Expand territory by placing border posts (Coming Soon)"},{key:"invadeEnemies",emoji:"",name:"Invade Enemies",description:"Attack enemies outside of our border"}];function cL(e,t,n){const i=[];if(!n.tribeControl||n.leaderId!==n.id)return i;const s=n.tribeControl.armyControl??{protectHomeland:Gp,expandBorders:xp,invadeEnemies:$p},{width:a,height:l}=e.canvas,d=(a-_r)/2,u=350,f=(l-u)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(d,f,_r,u,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=ft,e.font=`${at*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Army Control",d+_r/2,f+Ms);const p=30,m=d+_r-Ms-p,S=f+Ms,v=t.hoveredButtonId==="armyControl_close";e.fillStyle=v?"#ff7777":"#ff5555",e.fillRect(m,S,p,p),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",m+p/2,S+p/2),i.push({id:"armyControl_close",action:de.CloseArmyControl,rect:{x:m,y:S,width:p,height:p},text:"X",currentWidth:p,backgroundColor:"#ff5555",textColor:"#ffffff"});let A=0;wS.forEach(C=>{A+=s[C.key]||0});let I=f+Ms+70;const E=d+Ms,P=d+_r-Ms;return wS.forEach(C=>{const w=s[C.key]||0,O=A>0?Math.round(w/A*100):0;e.textAlign="left",e.textBaseline="middle",e.font=`${at*.8}px "Press Start 2P", Arial`,e.fillStyle=ft,e.fillText(`${C.emoji} ${C.name}`,E,I+bi/2);const M=d+320,D=M+zt+15,N=120,k=D+N+15,U=`army_minus_${C.key}`,z=t.hoveredButtonId===U,K=w<=0,X=K?"#555":z?"#dd6666":"#cc4444";e.fillStyle=X,e.fillRect(M,I+(bi-zt)/2,zt,zt),e.fillStyle=K?"#888":"#fff",e.textAlign="center",e.fillText("-",M+zt/2,I+bi/2+2),i.push({id:U,action:de.DecreaseArmyObjective,targetArmyObjective:C.key,rect:{x:M,y:I+(bi-zt)/2,width:zt,height:zt},text:"-",currentWidth:zt,backgroundColor:X,textColor:"#fff",isDisabled:K}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#4CAF50";const J=N-10,q=12,re=I+bi/2-q/2;e.fillStyle="#333",e.fillRect(D,re,J,q);const se=w/10*J;e.fillStyle="#4CAF50",e.fillRect(D,re,se,q);const ie=`army_plus_${C.key}`,Y=t.hoveredButtonId===ie,Z=w>=10,Q=Z?"#555":Y?"#66dd66":"#44cc44";e.fillStyle=Q,e.fillRect(k,I+(bi-zt)/2,zt,zt),e.fillStyle=Z?"#888":"#fff",e.textAlign="center",e.font=`${at*.8}px "Press Start 2P", Arial`,e.fillText("+",k+zt/2,I+bi/2+4),i.push({id:ie,action:de.IncreaseArmyObjective,targetArmyObjective:C.key,rect:{x:k,y:I+(bi-zt)/2,width:zt,height:zt},text:"+",currentWidth:zt,backgroundColor:Q,textColor:"#fff",isDisabled:Z}),e.textAlign="right",e.font=`${at*.8}px "Press Start 2P", Arial`,e.fillStyle=ft,e.fillText(`${O}%`,P,I+bi/2),I+=bi}),e.textAlign="center",e.fillStyle="#aaa",e.font=`${at*.6}px "Press Start 2P", Arial`,e.fillText("Adjust priorities for warrior objectives",d+_r/2,I+10),e.fillText("Higher values = higher priority",d+_r/2,I+30),e.restore(),i}let _S="",RS=null;function dL(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function uL(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function Md(e,t,n,i,s,a,l){const d=((t+i)%a+a)%a,u=((n+s)%l+l)%l;return e.has(`${d},${u}`)}function fL(e,t,n,i){const s=kP(t.soilDepletion,IA);if(s.length===0)return;const{width:a,height:l}=t.mapDimensions,d=i.width/2,u=i.height/2,f=Math.ceil(a/jt),p=Math.ceil(l/jt),m=dL(s);m!==_S&&(_S=m,RS=uL(s));const S=RS,v=jt*2,A=n.x-d-v,I=n.x+d+v,E=n.y-u-v,P=n.y+u+v;e.save();const C=e.globalAlpha;for(const w of s){const O=w.gridX*jt,M=w.gridY*jt,D=hL(O,M,a,l,A,I,E,P);for(const N of D)pL(e,N.x,N.y,w.health,w.gridX,w.gridY,S,f,p)}e.globalAlpha=C,e.restore()}function hL(e,t,n,i,s,a,l,d){const u=[],f=jt,p=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-i},{dx:0,dy:i},{dx:-n,dy:-i},{dx:n,dy:-i},{dx:-n,dy:i},{dx:n,dy:i}];for(const m of p){const S=e+m.dx,v=t+m.dy;S+f>=s&&S<=a&&v+f>=l&&v<=d&&u.push({x:S,y:v})}return u}function pL(e,t,n,i,s,a,l,d,u){const f=Math.floor(t),p=Math.floor(n),m=jt,S=1-i/IA,A=i<k_?dv:dv*S,I=!Md(l,s,a,0,-1,d,u),E=!Md(l,s,a,0,1,d,u),P=!Md(l,s,a,-1,0,d,u),C=!Md(l,s,a,1,0,d,u);e.globalAlpha=A,e.fillStyle=b_,e.fillRect(f,p,m,m);const w=3;e.fillStyle=O_,e.globalAlpha=A*1.2,I&&e.fillRect(f,p,m,w),E&&e.fillRect(f,p+m-w,m,w),P&&e.fillRect(f,p,w,m),C&&e.fillRect(f+m-w,p,w,m),e.globalAlpha=A*.5;const O=w+1;I&&P&&e.fillRect(f,p,O,O),I&&C&&e.fillRect(f+m-O,p,O,O),E&&P&&e.fillRect(f,p+m-O,O,O),E&&C&&e.fillRect(f+m-O,p+m-O,O,O),e.globalAlpha=1}const fl=8,hl=12,fn=24;function PS(e,t,n,i,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-hl),e.stroke(),e.fillStyle=i,e.beginPath(),e.moveTo(t,n-hl),e.lineTo(t+fl,n-hl+fl/2),e.lineTo(t,n-hl+fl),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+fl/2,n-hl+fl/2))}function gL(e,t,n,i,s){const a=ql(t,s);let l=1;const d=new Map,u=new Map;for(const I of a){const P=I.leaderId===s?0:l++,C=mn[P%mn.length];d.set(I.leaderId,C),u.set(I.leaderId,I.tribeBadge||"")}const f=[],p=fn*2,m=Math.floor((n.x-i.width/2-p)/fn)*fn,S=Math.floor((n.x+i.width/2+p)/fn)*fn,v=Math.floor((n.y-i.height/2-p)/fn)*fn,A=Math.floor((n.y+i.height/2+p)/fn)*fn;for(let I=v;I<=A;I+=fn)for(let E=m;E<=S;E+=fn){const P=$n(E,I,t),C=E+fn,w=$n(C,I,t);if(P!==w){const D=P||w;if(D){const N=E+fn/2,k=I;PS(e,N,k,d.get(D)||"#000",u.get(D)||""),f.push({x:N,y:k})}}const O=I+fn,M=$n(E,O,t);if(P!==M){const D=P||M;if(D){const N=E,k=I+fn/2;PS(e,N,k,d.get(D)||"#000",u.get(D)||""),f.push({x:N,y:k})}}}return f}const Hn=12,Dt=16,ni=15;function DS(e){switch(e){case L.Success:return"#4CAF50";case L.Failure:return"#F44336";case L.Running:return"#FFC107";case L.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function mL(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function yL(e,t,n,i){var N;const{debugCharacterId:s}=t,a=500,l=Math.min(i*.9,800),d=n-a-10,u=tt+at*2;t.debugPanelRect={x:d,y:u,width:a,height:l},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(d,u,a,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(d,u,a,l),e.fillStyle="white",e.font=`${Hn}px monospace`,e.textAlign="left",e.textBaseline="top";let f=u+20;const p=d+15;if(e.fillStyle="#66ccff",e.font=`bold ${Hn+2}px monospace`,e.fillText(" Task AI Debugger",p,f),f+=25,!s){e.fillStyle="#888",e.font=`${Hn}px monospace`,e.fillText("No character selected for debugging.",p,f),e.fillText("Click on a character to inspect their Task AI.",p,f+20),e.restore();return}const m=t.entities.entities[s];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${Hn}px monospace`,e.fillText(`Character #${s} not found or not a character.`,p,f),e.restore();return}const S=m;e.fillStyle="white",e.font=`${Hn}px monospace`,e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,p,f),f+=Dt*1.5,e.fillStyle="#66ccff",e.font=`bold ${Hn}px monospace`,e.fillText(" Current Task",p,f),f+=Dt*1.5;const v=du(S),A=v?t.tasks[v]:null;if(e.font=`${Hn}px monospace`,A){const k=_.get(S.aiBlackboard,uT),U=_.get(S.aiBlackboard,fT),z=k!==void 0?L[k]:"N/A";e.fillStyle="white",e.fillText(`ID: ${A.id}`,p+ni,f),f+=Dt,e.fillText(`Type: ${V[A.type]}`,p+ni,f),f+=Dt,e.fillText(`Target: ${mL(A.target)}`,p+ni,f),f+=Dt,e.fillStyle=DS(k),e.fillText(`Status: ${z}`,p+ni,f),f+=Dt,U&&(e.fillStyle="#aaa",e.fillText(`Message: ${U}`,p+ni,f),f+=Dt)}else e.fillStyle="#888",e.fillText("No active task.",p+ni,f),f+=Dt;f+=Dt,e.fillStyle="#66ccff",e.font=`bold ${Hn}px monospace`,e.fillText(" Recent Task History (Last 5)",p,f),f+=Dt*1.5;const I=_.get(S.aiBlackboard,zp)||[];if(I.length===0)e.fillStyle="#888",e.font=`${Hn}px monospace`,e.fillText("No task history yet.",p+ni,f),f+=Dt;else for(const k of I){e.fillStyle="white",e.font=`${Hn}px monospace`;const U=V[k.type];e.fillText(` ${U}`,p+ni,f);const z=L[k.result];e.fillStyle=DS(k.result);const K=e.measureText(` ${U} `).width;e.fillText(`(${z})`,p+ni+K,f),e.fillStyle="#666";const X=e.measureText(`(${z}) `).width;e.fillText(`@ ${k.completedAtTick.toFixed(1)}h`,p+ni+K+X,f),f+=Dt,k.message&&(e.fillStyle="#888",e.fillText(`   ${k.message}`,p+ni,f),f+=Dt)}f+=Dt,e.fillStyle="#66ccff",e.font=`bold ${Hn}px monospace`,e.fillText(" Available Tasks",p,f),f+=Dt*1.5;const E=f,P=u+l-E-30;e.save(),e.beginPath(),e.rect(d,E,a,P),e.clip();const C=((N=t.debugPanelScroll)==null?void 0:N.y)??0;e.translate(0,-C);const w=t.search.tasks.byRadius(m.position,800);let O=0;if(w.length===0)e.fillStyle="#888",e.font=`${Hn}px monospace`,e.fillText("No tasks available in the world.",p+ni,f),f+=Dt;else{const k=w.map(U=>{const z=$u[U.type];return{task:U,score:z&&z.scorer&&S.type==="human"?z.scorer(S,U,{gameState:t,deltaTime:0}):null}});k.sort((U,z)=>{const K=U.score!==null?U.score:-1/0;return(z.score!==null?z.score:-1/0)-K});for(const{task:U,score:z}of k){let K="Unclaimed",X="#888";U.claimedByEntityId&&(U.claimedByEntityId===S.id?(K="Claimed by this character",X="#4CAF50"):(K=`Claimed by #${U.claimedByEntityId}`,X="#F44336")),e.font=`${Hn}px monospace`,e.fillStyle=X;const J=` Task ID: ${U.id}`;e.fillText(J,p,f),f+=Dt,e.fillStyle="white",e.fillText(`  Type: ${V[U.type]}`,p,f),f+=Dt;const q=z!==null?z.toFixed(3):"N/A";e.fillStyle=z!==null&&z>0?"#FFC107":"#888",e.fillText(`  Score: ${q}`,p,f),f+=Dt,e.fillStyle=X,e.fillText(`  Status: ${K}`,p,f),f+=Dt*1.5,O=Math.max(O,e.measureText(J).width+30)}}const M=f-E;t.debugPanelContentSize={width:O,height:M},e.restore();const D=u+l-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",d+a/2,D),e.restore()}function vL(e,t,n,i){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey"))switch(a.aiType){case tr.TaskBased:default:yL(e,t,n,i);break}}function hu(e,t,n,i,s,a=!1){var f;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),PB(e,t);return}const l=Tt(t),d=gL(e,t,n,s,l==null?void 0:l.leaderId);if(fL(e,t,n,s),XF(e,t,t.debugPanel===je.General,n,s,d),l&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const p=Vp(t.mousePosition,n,s,t.mapDimensions),m=ra(p,t.selectedBuildingType,l.leaderId,t);CF(e,p,t.selectedBuildingType,m,t.mapDimensions)}const u=t.notifications.filter(p=>!p.isDismissed);for(const p of u){const m=(Math.sin(t.time*sP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=rP,p.targetArea&&e.fillRect(p.targetArea.x,p.targetArea.y,p.targetArea.width,p.targetArea.height),p.targetRadius&&(e.beginPath(),e.arc(p.targetRadius.x,p.targetRadius.y,p.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,GB(e,t),e.restore(),!a){e.fillStyle=T1,e.font=`${at}px "Press Start 2P", Arial`,e.shadowColor=E1,e.shadowBlur=C1,t.uiButtons=[];let p=null,m=null;if(l){const A=Mn(t,l),I=Wr(A),E=((f=l.partnerIds)==null?void 0:f.map(C=>t.entities.entities[C]).filter(C=>C!==void 0))||[],P=VF(e,t,l,I,E,A);p=P.hungerBarRect,m=P.foodBarRect}const S=ql(t,l==null?void 0:l.leaderId);mB(e,t,n,S,e.canvas.width,e.canvas.height,t.cameraZoom);const{commandButtonsRect:v}=uB(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,l&&(HB(e,t,n,e.canvas.width,e.canvas.height),i.length>0&&gB(e,i,l,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:A}=t.tutorialState;A.includes(Gr.HUNGER_BAR)&&p&&up(e,p,t.time),A.includes(Gr.FOOD_BAR)&&m&&up(e,m,t.time),A.includes(Gr.COMMAND_BUTTONS)&&v&&up(e,v,t.time)}if(t.tutorialState.isActive){const A=RB(e,t,e.canvas.width,e.canvas.height);A&&t.uiButtons.push({id:"tutorial-dismiss",action:de.DismissTutorial,rect:A,text:"",currentWidth:A.width,backgroundColor:"transparent",textColor:"transparent"})}switch($B(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case je.Ecosystem:ZF(e,t,e.canvas.width,e.canvas.height);break;case je.Tribe:iL(e,t,e.canvas.width,e.canvas.height);break;case je.SupplyChain:XB(e,t,e.canvas.width,e.canvas.height);break;case je.Performance:YB(e,t,s.width);break;case je.General:vL(e,t,e.canvas.width,e.canvas.height);break}if(t.roleManagerOpen&&l&&l.leaderId===l.id){const A=lL(e,t,l);t.uiButtons.push(...A)}if(t.armyControlOpen&&l&&l.leaderId===l.id){const A=cL(e,t,l);t.uiButtons.push(...A)}t.tribeModalOpen&&wB(e,t,S,e.canvas.width,e.canvas.height),t.isPaused&&t.exitConfirmation!=="pending"&&fB(e),t.exitConfirmation==="pending"&&sL(e,t,e.canvas.width,e.canvas.height)}}const SL=kt.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,AL=kt.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,IL=kt.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,TL=kt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,MS=kt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,EL=kt.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,CL=kt.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,Nd="intro-soundtrack",NS=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=jr(),i=ke.useRef(null),s=ke.useRef(null),a=ke.useRef(rk()),l=ke.useRef(),d=ke.useRef(a.current.viewportCenter),u=ke.useRef(),f=ke.useCallback(()=>{ep(Nd,2),n(),e("game")},[e,n]),p=ke.useCallback(()=>{t&&(ep(Nd,2),e("game"))},[e,t]);ke.useEffect(()=>{const v=A=>{(A.key==="Enter"||A.key===" ")&&(t?p():f())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[f,p,t]),ke.useEffect(()=>(Mg(Ee.SoundTrack1,{loop:!0,trackId:Nd}),()=>{ep(Nd,2)}),[]),ke.useEffect(()=>{const v=i.current;if(!v)return;s.current=v.getContext("2d");const A=()=>{v&&s.current&&(v.width=window.innerWidth,v.height=window.innerHeight,hu(s.current,a.current,d.current,[],{width:v.width,height:v.height},!0))};return A(),window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]),ke.useEffect(()=>{const v=()=>{const I=XA(a.current);if(I.length>0){const E=Math.floor(Math.random()*I.length);u.current=I[E].id}};v();const A=setInterval(v,y_);return()=>clearInterval(A)},[]);const[m,S]=fA(v=>{var E,P;if(!s.current)return;if(l.current===void 0){l.current=v;return}const A=Math.min((v-l.current)/1e3,1);a.current=Wu(a.current,A);const I=u.current?a.current.entities.entities[u.current]:void 0;if(I){const{mapDimensions:C}=a.current,{width:w,height:O}=C;let M={...I.position};const D=M.x-d.current.x;Math.abs(D)>w/2&&(D>0?M.x-=w:M.x+=w);const N=M.y-d.current.y;Math.abs(N)>O/2&&(N>0?M.y-=O:M.y+=O);let k=Wd(d.current,M,Kd*A);k={x:(k.x%w+w)%w,y:(k.y%O+O)%O},d.current=k}hu(s.current,a.current,d.current,[],{width:((E=i.current)==null?void 0:E.width)||800,height:((P=i.current)==null?void 0:P.height)||600},!0),l.current=v});return ke.useEffect(()=>(S(),m),[S,m]),Fe.jsxs(SL,{children:[Fe.jsx(AL,{ref:i}),Fe.jsxs(IL,{children:[Fe.jsx(TL,{children:"Tribe2"}),Fe.jsxs(EL,{children:[Fe.jsx(MS,{onClick:f,children:"New Game"}),t&&Fe.jsx(MS,{onClick:p,children:"Load Game"})]}),Fe.jsxs(CL,{children:["by"," ",Fe.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function wL(){console.log("Tribe game initialized with detailed 2D world state.");const e=ok();return e.ecosystem={preyGestationPeriod:Br,preyProcreationCooldown:Fr,predatorGestationPeriod:Lr,predatorProcreationCooldown:Hr,preyHungerIncreasePerHour:Wo,predatorHungerIncreasePerHour:Yo,berryBushSpreadChance:so},e.debugPanel=je.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const _L=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:i,playerActionHintsRef:s})=>(ke.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const l=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,hu(t.current,n.current,i.current,s.current,{width:a.width,height:a.height},!1))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),Fe.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),RL=(e,t,n,i=!1)=>{var l,d;let s;const a=r1(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:le.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:le.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const u=a;t.isAdult&&Xr(t,u,n)?s={action:le.AutopilotAttack,targetEntityId:u.id}:ir(t,u,n)?s={action:le.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:le.AutopilotFeedChild,targetEntityId:u.id})}else if(a.type==="prey")s={action:le.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:le.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const u=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&Xt(t,u,n)&&u.isConstructed?s={action:le.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:le.Removal,position:a.position};else if(t.leaderId===t.id&&Xt(t,u,n)&&u.isConstructed)xA(u.position,ia,t.id,n).valid?s={action:le.TakeOverBuilding,targetEntityId:u.id}:s={action:le.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const f=u.ownerId===t.leaderId,p=u.storedItems.length>0,m=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(i&&u.isConstructed&&p&&t.food.length<t.maxFood)if(f)s={action:le.AutopilotRetrieve,targetEntityId:a.id};else{const S=t.leaderId?n.entities.entities[t.leaderId]:void 0;S&&((l=S.tribeControl)!=null&&l.diplomacy)?(u.ownerId&&S.tribeControl.diplomacy[u.ownerId])===ut.Hostile?s={action:le.AutopilotGather,targetEntityId:a.id}:s={action:le.AutopilotMove,position:e}:s={action:le.AutopilotMove,position:e}}else f&&u.isConstructed?(t.food.length>0||t.heldItem)&&m?s={action:le.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&p?s={action:le.AutopilotRetrieve,targetEntityId:a.id}:s={action:le.AutopilotMove,position:e}:s={action:le.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(f=>f.type===An.Berry).length>=uo&&!zn(e,n,qo)&&!Bi(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:le.AutopilotPlant,position:e}:u.buildingType===ue.Bonfire&&((d=t.heldItem)==null?void 0:d.type)===At.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:le.AutopilotDeposit,targetEntityId:u.id}:s={action:le.AutopilotMove,position:e}}else if(a.type==="tree"){const u=a,[f]=u.stateMachine??[],p=f===an||f===Vt||f===Sn;t.isAdult&&!t.heldItem&&p?s={action:le.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&f===xt&&u.wood.length>0?s={action:le.AutopilotGather,targetEntityId:u.id}:s={action:le.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===An.Berry).length>=uo&&(n.autopilotControls.isManuallyPlanting||Zl(e,n,t))&&!Bi(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:le.AutopilotPlant,position:e}:s={action:le.AutopilotMove,position:e};return s},PL=(e,t)=>{if(e.isPaused)return;const n=Tt(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=G(n.position,t,e.mapDimensions.width,e.mapDimensions.height),l=100;a<=l?ra(t,s,n.leaderId,e,n.position,l)&&(Xo(t,s,n.leaderId,e),e.selectedBuildingType=null):ra(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:le.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=p1(t,e);s&&Lp(s.id,e);return}const i=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,i?(e.autopilotControls.activeAutopilotAction=i,(i.action===le.AutopilotMove||i.action===le.AutopilotGather||i.action===le.AutopilotChop)&&(e.hasPlayerMovedEver=!0),i.action===le.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:le.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},DL=(e,t)=>{var l,d,u,f,p,m,S,v;const n=e.key.toLowerCase(),i=e.ctrlKey||e.metaKey;let s=!0,a=t;if(i){switch(n){case"s":tg(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:A}=t;A.activeAutopilotAction||A.isManuallyMoving||A.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(A.activeAutopilotAction=void 0,A.isManuallyMoving=!1,A.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"u":const I=Tt(t);I&&I.isAdult&&I.leaderId===I.id&&(e.shiftKey?t.autopilotControls.behaviors.roleManagement=!t.autopilotControls.behaviors.roleManagement:t.roleManagerOpen=!t.roleManagerOpen);break;case"v":{const C=Tt(t);C&&C.isAdult&&C.leaderId===C.id&&(t.armyControlOpen=!t.armyControlOpen);break}case"m":t.isMuted=!t.isMuted,_l(t.masterVolume,t.isMuted);break;case"=":case"+":const E=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(E.toFixed(1)),_l(t.masterVolume,t.isMuted);break;case"-":const P=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(P.toFixed(1)),_l(t.masterVolume,t.isMuted);break;case"t":a=Wu(t,RI);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===je.General?(a.debugPanel=je.None,a.debugCharacterId=void 0):(a.debugPanel=je.General,a.debugCharacterId||(a.debugCharacterId=((l=Tt(a))==null?void 0:l.id)??((d=Object.values(a.entities.entities).find(C=>C.type==="human"||C.type==="prey"||C.type==="predator"))==null?void 0:d.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===je.Ecosystem){a.debugPanel=je.None;break}a.debugPanel=je.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((u=Tt(a))==null?void 0:u.id)??((f=Object.values(a.entities.entities).find(C=>C.type==="human"||C.type==="prey"||C.type==="predator"))==null?void 0:f.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===je.Tribe){a.debugPanel=je.None;break}a.debugPanel=je.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((p=Tt(a))==null?void 0:p.id)??((m=a.search.human.all().find(C=>C.leaderId===C.id))==null?void 0:m.id))}else s=!1;break;case"$":if(e.shiftKey){if(a.debugPanel===je.SupplyChain){a.debugPanel=je.None;break}a.debugPanel=je.SupplyChain,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((S=Tt(a))==null?void 0:S.id)??((v=a.search.human.all().find(C=>C.leaderId===C.id))==null?void 0:v.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===je.Performance){a.debugPanel=je.None;break}a.debugPanel=je.Performance}else s=!1;break;case"tab":if(a.debugPanel!==je.General&&a.debugPanel!==je.Tribe&&a.debugPanel!==je.SupplyChain&&(a.debugPanel=je.General),a.debugPanel===je.General){const C=Object.values(a.entities.entities).filter(w=>w.type==="human"||w.type==="prey"||w.type==="predator");if(C.length>0){const w=C.sort((N,k)=>{if(N.type==="human"&&N.isPlayer)return-1;if(k.type==="human"&&k.isPlayer)return 1;if(N.type!==k.type){const U={human:0,prey:1,predator:2},z=U[N.type]??999,K=U[k.type]??999;return z-K}return N.id-k.id}),O=a.debugCharacterId,D=((O?w.findIndex(N=>N.id===O):-1)+1)%w.length;a.debugCharacterId=w[D].id}else a.debugCharacterId=void 0}else if(a.debugPanel===je.Tribe||a.debugPanel===je.SupplyChain){const C=a.search.human.all().filter(O=>O.leaderId===O.id);let w=C.findIndex(O=>O.id===a.debugCharacterId)+1;(w===-1||w>C.length-1)&&(w=0),a.debugCharacterId=C[w].id}else a.debugPanel=je.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},ML=(e,t,n,i,s)=>{var l;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",Ne(a,Ee.ButtonClick,i.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",Ne(a,Ee.ButtonClick,i.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",Ne(a,Ee.ButtonClick,i.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",Ne(a,Ee.ButtonClick,i.position);return}else if(e==="6"){n.selectedBuildingType="removal",Ne(a,Ee.ButtonClick,i.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=xe(i,n,"berryBush",ze,p=>p.food.length>0&&i.food.length<i.maxFood),u=xe(i,n,"corpse",ze,p=>p.food.length>0&&i.food.length<i.maxFood);let f=null;d&&u?f=G(i.position,d.position,n.mapDimensions.width,n.mapDimensions.height)<=G(i.position,u.position,n.mapDimensions.width,n.mapDimensions.height)?d:u:f=d||u,f&&(i.activeAction="gathering",Ne(a,Ee.Gather,i.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}xe(i,n,"human",ze,u=>ir(i,u,n))&&(i.activeAction="procreating",Ne(a,Ee.Procreate,i.position))}else if(e==="f")i.food.length>0&&(i.activeAction="eating",Ne(a,Ee.Eat,i.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=s.find(u=>u.type===le.FeedChild);d&&d.targetEntity&&(i.activeAction="feeding",i.target=d.targetEntity.id)}else if(e==="arrowup"||e==="w")i.direction.y=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")i.direction.y=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")i.direction.x=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")i.direction.x=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const d=xe(i,n,"human",yn,u=>Xr(i,u,n))??xe(i,n,"predator",yn)??xe(i,n,"prey",yn);d&&(i.activeAction="attacking",i.attackTargetId=d.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===le.Plant)){const u=pR(i.position,n,50,Pp);u&&(i.activeAction="planting",i.target=u,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=xe(i,n,"building",Kt,f=>{const p=f;return p.buildingType===ue.Bonfire&&p.isConstructed&&p.storedItems.length<(p.storageCapacity||0)});if(((l=i.heldItem)==null?void 0:l.type)===At.Wood&&d){i.activeAction="depositing",i.target=d.id,Ne(a,Ee.StorageDeposit,i.position);return}const u=xe(i,n,"building",Kt,f=>{const p=f;return p.buildingType===ue.StorageSpot&&p.ownerId===i.leaderId&&p.isConstructed&&p.storageCapacity!==void 0&&p.storedItems.length<p.storageCapacity});u&&(i.activeAction="idle",i.target=u.id,Ne(a,Ee.StorageDeposit,i.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=xe(i,n,"building",Kt,u=>{const f=u;return f.buildingType==="storageSpot"&&f.ownerId===i.leaderId&&f.isConstructed&&f.storedItems.length>0});d&&(i.activeAction="idle",i.target=d.id,Ne(a,Ee.StorageRetrieve,i.position))}else if(e==="k")LI(i,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,Ne(a,Ee.ButtonClick,i.position)}else if(e==="u"){if(t){n.autopilotControls.behaviors.roleManagement=!n.autopilotControls.behaviors.roleManagement;return}}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const d=xe(i,n,"tree",Tu,u=>u.wood&&u.wood.length>0&&!i.heldItem);d&&(i.activeAction="chopping",i.target=d.id)}},NL=(e,t,n,i)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!i.current.has("arrowup")&&!i.current.has("arrowdown")&&!i.current.has("arrowleft")&&!i.current.has("arrowright")&&!i.current.has("w")&&!i.current.has("a")&&!i.current.has("s")&&!i.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!i.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!i.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!i.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!i.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!i.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},bL=(e,t,n)=>{const{mapDimensions:i}=e,{width:s,height:a}=i;if(!e.cameraFollowingPlayer){if(e.cameraTargetPosition){const u=Xe(t,e.cameraTargetPosition,s,a);if(Ko(u)<1){const S=e.cameraTargetPosition;return e.cameraTargetPosition=void 0,S}const p=ri(t,u);let m=Wd(t,p,Kd*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return t}let d=Tt(e);if(e.debugCharacterId){const u=e.entities.entities[e.debugCharacterId];u&&"position"in u&&(d=u)}if(d){let u={...d.position};const f=u.x-t.x;Math.abs(f)>s/2&&(f>0?u.x-=s:u.x+=s);const p=u.y-t.y;Math.abs(p)>a/2&&(p>0?u.y-=a:u.y+=a);let m=Wd(t,u,Kd*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return e.viewportCenter};function OL(e,t){const{width:n,height:i}=e.mapDimensions;e.cameraTargetPosition=void 0,e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%i+i)%i}}const kL=(e,t,n,i)=>{var u,f;const s={gameState:n},a=Tt(n);a&&Ne(s,Ee.ButtonClick,a.position);const l=n.uiButtons.find(p=>p.id===e.id);l&&(l.lastActivated=Date.now()),t&&[de.CommandGather,de.CommandPlant,de.ToggleProcreationBehavior,de.CommandBuild,de.OpenRoleManager].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:d}=n.autopilotControls;switch(e.action){case de.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case de.ConfirmExitYes:i(),n.exitConfirmation="inactive";break;case de.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case de.ToggleMute:n.isMuted=!n.isMuted,_l(n.masterVolume,n.isMuted);break;case de.TogglePause:n.isPaused=!n.isPaused;break;case de.FastForward:return Wu(n,RI);case de.DismissTutorial:n.tutorialState.isActive=!1;break;case de.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case de.CommandGather:t?d.gathering=!d.gathering:a&&(a.activeAction="gathering");break;case de.CommandPlant:t?d.planting=!d.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case de.ToggleProcreationBehavior:d.procreation=!d.procreation;break;case de.ToggleAttackBehavior:d.attack=!d.attack;break;case de.ToggleFeedChildBehavior:d.feedChildren=!d.feedChildren;break;case de.CommandTribeSplit:a&&LI(a,n);break;case de.CommandBuild:t?d.build=!d.build:n.buildMenuOpen=!n.buildMenuOpen;break;case de.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case de.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case de.SelectRemovalTool:n.selectedBuildingType="removal";break;case de.SelectBorderPost:n.selectedBuildingType="borderPost";break;case de.SelectBonfire:n.selectedBuildingType="bonfire";break;case de.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const p=a.leaderId,m=e.targetTribeId,S=n.entities.entities[m],v=(u=a.tribeControl)==null?void 0:u.diplomacy,A=(f=S==null?void 0:S.tribeControl)==null?void 0:f.diplomacy;if(v&&A){const E=(v[m]||ut.Friendly)===ut.Friendly?ut.Hostile:ut.Friendly;v[m]=E,A[p]=E}}break;case de.OpenTribeModal:n.tribeModalOpen=!0;break;case de.RecenterCamera:n.cameraFollowingPlayer=!0;break;case de.CloseTribeModal:n.tribeModalOpen=!1;break;case de.OpenRoleManager:t?d.roleManagement=!d.roleManagement:n.roleManagerOpen=!0;break;case de.CloseRoleManager:n.roleManagerOpen=!1;break;case de.IncreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const p=a.tribeControl.roleWeights[e.targetRole]||0;p<10&&(a.tribeControl.roleWeights[e.targetRole]=p+1)}break;case de.DecreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const p=a.tribeControl.roleWeights[e.targetRole]||0;p>0&&(a.tribeControl.roleWeights[e.targetRole]=p-1)}break;case de.OpenArmyControl:n.armyControlOpen=!0;break;case de.CloseArmyControl:n.armyControlOpen=!1;break;case de.IncreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Gp,expandBorders:xp,invadeEnemies:$p});const p=a.tribeControl.armyControl[e.targetArmyObjective]||0;p<10&&(a.tribeControl.armyControl[e.targetArmyObjective]=p+1)}break;case de.DecreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Gp,expandBorders:xp,invadeEnemies:$p});const p=a.tribeControl.armyControl[e.targetArmyObjective]||0;p>0&&(a.tribeControl.armyControl[e.targetArmyObjective]=p-1)}break}return n};function BL(e,t,n){if(!e.notificationButtonRects)return!1;const i=Tt(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return uR(e,s),i&&Ne({gameState:e},Ee.ButtonClick,i.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const l=e.notifications.find(d=>d.id===s);if(l){let d=l.targetPosition;if(!d&&l.targetEntityIds&&l.targetEntityIds.length>0){const u=e.entities.entities[l.targetEntityIds[0]];u&&(d=u.position)}return d&&OL(e,d),i&&Ne({gameState:e},Ee.ButtonClick,i.position),l.highlightedEntityIds&&(l.renderHighlights=!l.renderHighlights),!0}}return!1}function LT(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const FL=(e,t)=>{var n;if(t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(LT(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},LL=(e,t)=>t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:LT(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},bS=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},HL=(e,t)=>{var n,i;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const l=t.debugPanelRect.height-60,d=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.height)??0)-l);return t.debugPanelScroll.y>d&&(t.debugPanelScroll.y=d),{newState:t,handled:!0}}return{newState:t,handled:!1}};function UL(e,t,n){if(!n.minimapRect)return;const{x:i,y:s,width:a,height:l}=n.minimapRect;e>=i&&e<=i+a&&t>=s&&t<=s+l&&(n.isDraggingMinimap=!0,n.minimapDragDistance=0)}function GL(e,t,n,i){n.isDraggingMinimap&&(n.isDraggingMinimap=!1,n.minimapDragDistance<5&&$L(e,t,n,i,!1))}function xL(e,t,n,i,s){if(!n.minimapRect){n.hoveredMinimapTribeId=null;return}if(n.isDraggingMinimap){if(i){n.minimapDragDistance+=Math.sqrt(i.x*i.x+i.y*i.y),n.cameraFollowingPlayer=!1,n.cameraTargetPosition=void 0;const{width:l,height:d}=n.mapDimensions,{width:u,height:f}=n.minimapRect,p=i.x/u*l,m=i.y/f*d,S=n.viewportCenter.x-p,v=n.viewportCenter.y-m,A={x:(S%l+l)%l,y:(v%d+d)%d};n.viewportCenter=A,s&&(s.current=A)}return}const a=HT(e,t,n.minimapRect,n);a?n.hoveredMinimapTribeId=$n(a.x,a.y,n):n.hoveredMinimapTribeId=null}function $L(e,t,n,i,s=!1){if(!n.minimapRect)return;const a=HT(e,t,n.minimapRect,n);a&&(n.cameraFollowingPlayer=!1,s?(n.viewportCenter=a,n.cameraTargetPosition=void 0,i&&(i.current=a)):n.cameraTargetPosition=a)}function WL(e,t,n,i,s){if(!i.minimapRect)return!1;const{x:a,y:l,width:d,height:u}=i.minimapRect;if(t>=a&&t<=a+d&&n>=l&&n<=l+u){i.cameraFollowingPlayer=!1,i.cameraTargetPosition=void 0;const{width:f,height:p}=i.mapDimensions,m=e.deltaX/d*f,S=e.deltaY/u*p,v=i.viewportCenter.x+m,A=i.viewportCenter.y+S,I={x:(v%f+f)%f,y:(A%p+p)%p};return i.viewportCenter=I,s&&(s.current=I),!0}return!1}function HT(e,t,n,i){const s=e-n.x,a=t-n.y;if(s<0||s>n.width||a<0||a>n.height)return null;const{width:l,height:d}=i.mapDimensions,u=n.width/2,f=n.height/2,p=s-u,m=a-f,S=p/n.width*l,v=m/n.height*d,A=i.viewportCenter.x+S,I=i.viewportCenter.y+v;return{x:(A%l+l)%l,y:(I%d+d)%d}}function YL(e,t,n){t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:i,height:s}=t.mapDimensions,a=t.viewportCenter.x+e.deltaX,l=t.viewportCenter.y+e.deltaY,d={x:(a%i+i)%i,y:(l%s+s)%s};return t.viewportCenter=d,n.current=d,!0}function zL(e,t){(e.button===1||e.button===2)&&(t.isDraggingViewport=!0,t.viewportDragButton=e.button,t.viewportDragDistance=0)}function jL(e,t,n){if(t.isDraggingViewport){t.viewportDragDistance+=Math.sqrt(e.movementX*e.movementX+e.movementY*e.movementY),t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:i,height:s}=t.mapDimensions,a=t.viewportCenter.x-e.movementX,l=t.viewportCenter.y-e.movementY,d={x:(a%i+i)%i,y:(l%s+s)%s};t.viewportCenter=d,n.current=d}}function XL(e,t){t.isDraggingViewport&&e.button===t.viewportDragButton&&(t.isDraggingViewport=!1,t.viewportDragButton=null)}const VL=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,returnToIntro:l})=>(ke.useEffect(()=>{const d=u=>{if(!e()||t.current.gameOver||!n.current)return;const f=n.current.getBoundingClientRect(),p=u.clientX-f.left,m=u.clientY-f.top;if(WL(u,p,m,t.current,i)){u.preventDefault();return}const S=FL(u,t.current);t.current=S.newState,!S.handled&&YL(u,t.current,i)&&u.preventDefault()};return window.addEventListener("wheel",d,{passive:!1}),()=>{window.removeEventListener("wheel",d)}},[e,n,t,i]),ke.useEffect(()=>{const d=f=>{if(!e()||t.current.gameOver||!n.current||!f.target||f.target!==n.current)return;const p=n.current.getBoundingClientRect(),m=f.clientX-p.left,S=f.clientY-p.top;if(BL(t.current,m,S))return;const A=t.current.uiButtons.find(C=>m>=C.rect.x&&m<=C.rect.x+C.rect.width&&S>=C.rect.y&&S<=C.rect.y+C.rect.height);if(A){t.current=kL(A,f.shiftKey,t.current,l);return}const I=t.current.minimapRect;if(I&&m>=I.x&&m<=I.x+I.width&&S>=I.y&&S<=I.y+I.height){UL(m,S,t.current);return}const E=LL(f,t.current);if(t.current=E.newState,E.handled)return;zL(f,t.current);const P=Vp({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);PL(t.current,P)},u=f=>{if(!e()||!n.current)return;const p=n.current.getBoundingClientRect(),m=f.clientX-p.left,S=f.clientY-p.top;GL(m,S,t.current,i),XL(f,t.current);const v=bS(f,t.current);t.current=v.newState};return window.addEventListener("mousedown",d),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("mouseup",u)}},[e,n,t,i,l]),ke.useEffect(()=>{const d=u=>{if(!e()||!n.current)return;const f=HL(u,t.current);if(t.current=f.newState,f.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const P=bS(u,t.current);t.current=P.newState}const p=n.current.getBoundingClientRect(),m=u.clientX-p.left,S=u.clientY-p.top;jL(u,t.current,i),t.current.mousePosition={x:m,y:S};let v;if(t.current.notificationButtonRects){for(const[P,C]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=C.x&&m<=C.x+C.width&&S>=C.y&&S<=C.y+C.height){v=`notification-dismiss-${P}`;break}if(!v){for(const[P,C]of Object.entries(t.current.notificationButtonRects.view))if(m>=C.x&&m<=C.x+C.width&&S>=C.y&&S<=C.y+C.height){v=`notification-view-${P}`;break}}}if(!v)for(let P=t.current.uiButtons.length-1;P>=0;P--){const C=t.current.uiButtons[P];if(m>=C.rect.x&&m<=C.rect.x+C.rect.width&&S>=C.rect.y&&S<=C.rect.y+C.rect.height){v=C.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0,t.current.hoveredMinimapTribeId=null;return}const A=t.current.minimapRect,I=t.current.isDraggingMinimap;if(A&&m>=A.x&&m<=A.x+A.width&&S>=A.y&&S<=A.y+A.height||I){xL(m,S,t.current,{x:u.movementX,y:u.movementY},i),t.current.autopilotControls.hoveredAutopilotAction=void 0;return}else t.current.hoveredMinimapTribeId=null;const E=Tt(t.current);if(E){const P=Vp({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=RL(P,E,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}},[e,n,t,i]),ke.useEffect(()=>{const d=f=>{if(!e()||t.current.gameOver)return;const p=f.key.toLowerCase();(p===" "||p==="p"||p==="tab"||(f.ctrlKey||f.metaKey)&&(p==="s"||p==="a"))&&f.preventDefault();const m=DL(f,t.current);if(t.current=m.newState,m.handled)return;const S=Tt(t.current);S&&(a.current.add(p),ML(p,f.shiftKey,t.current,S,s.current))},u=f=>{if(!e()||t.current.gameOver)return;const p=f.key.toLowerCase();a.current.delete(p);const m=Tt(t.current);m&&NL(p,m,t.current,a)};return window.addEventListener("keydown",d),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}},[e,t,s,a,l]),ke.useEffect(()=>{const d=n.current;if(!d)return;const u=f=>{e()&&f.preventDefault()};return d.addEventListener("contextmenu",u),()=>{d.removeEventListener("contextmenu",u)}},[n,e]),null),KL=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,canvasRef:l,setAppState:d,appState:u})=>{const f=ke.useRef(),{returnToIntro:p}=jr(),[m,S,v]=fA(A=>{var O,M;if(!t.current||!f.current){f.current=A;return}const I=Math.min(A-f.current,1e3)/1e3,{performanceMetrics:E}=e.current;E.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const P=performance.now();e.current=Wu(e.current,I),E.currentBucket.worldUpdateTime=performance.now()-P;const C=Tt(e.current);C?s.current=kg(e.current,C):s.current=[],(e.current.viewportCenter.x!==i.current.x||e.current.viewportCenter.y!==i.current.y)&&(i.current=e.current.viewportCenter),i.current=bL(e.current,i.current,I),e.current.viewportCenter=i.current;const w=performance.now();hu(t.current,e.current,i.current,s.current,{width:((O=l.current)==null?void 0:O.width)||800,height:((M=l.current)==null?void 0:M.height)||600},!1),E.currentBucket.renderTime=performance.now()-w,E.history.push({bucketTime:e.current.time,...E.currentBucket}),E.history.length>v_&&E.history.shift(),f.current=A,e.current.gameOver&&u!=="gameOver"&&(Mg(Ee.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),d("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return ke.useEffect(()=>(S(),m),[S,m]),Fe.jsx(VL,{isActive:v,gameStateRef:e,canvasRef:l,viewportCenterRef:i,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:p})},OS=()=>{const{savedGameState:e,contextReady:t}=jr(),[n,i]=ke.useState(null);return ke.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),i(e)):(console.log("Initializing new game state..."),i(wL())))},[t,e]),!t||!n?Fe.jsx("div",{children:"Loading..."}):Fe.jsx(qL,{initialState:n})},qL=({initialState:e})=>{const t=ke.useRef(null),n=ke.useRef(null),i=ke.useRef(e),s=ke.useRef(new Set),a=ke.useRef(e.debugPanel),l=ke.useRef(e.viewportCenter),d=ke.useRef([]),{appState:u,setAppState:f}=jr();return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(_L,{canvasRef:t,ctxRef:n,gameStateRef:i,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:d}),Fe.jsx(KL,{gameStateRef:i,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:d,keysPressed:s,canvasRef:t,setAppState:f,appState:u})]})},ZL=kt.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,QL=kt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,bd=kt.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,JL=kt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,eH=()=>{const{setAppState:e,gameOverDetails:t}=jr(),n=()=>{e("intro")};return Fe.jsxs(ZL,{children:[Fe.jsx(QL,{children:"Game Over"}),Fe.jsx(bd,{children:"Your tribe's lineage has ended."}),t&&Fe.jsxs(Fe.Fragment,{children:[Fe.jsxs(bd,{children:["Generations Survived: ",t.generations]}),Fe.jsxs(bd,{children:["Cause of Extinction: ",t.cause]})]}),!t&&Fe.jsx(bd,{children:"Game details are unavailable."}),Fe.jsx(JL,{onClick:n,children:"Return to Menu"})]})},tH=kt.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,nH=kt.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,iH=kt.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,oH=kt.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,rH=kt.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,UT=kt.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,sH=kt(UT)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,pl=800,gl=600,aH=()=>{const{returnToIntro:e}=jr(),t=ke.useRef(null),n=ke.useRef(),i=ke.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:pl,height:gl}}),s=l=>{const d={x:pl/2,y:gl/2};let u;l===Ie.StoneProjectile&&(u={x:d.x+200*(Math.random()-Math.random()),y:d.y+200*(Math.random()-Math.random())}),Ue(i.current,l,d,1,void 0,u)};ke.useEffect(()=>{const l=()=>{i.current.time+=.016,ET(i.current);const u=t.current,f=u==null?void 0:u.getContext("2d");f&&(f.clearRect(0,0,pl,gl),f.fillStyle="#2c5234",f.fillRect(0,0,pl,gl),i.current.visualEffects.forEach(p=>{BT(f,p,i.current.time,i.current)})),n.current=requestAnimationFrame(l)};return n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(Ie).filter(l=>isNaN(Number(l))).map(l=>({name:l,value:Ie[l]}));return Fe.jsxs(tH,{children:[Fe.jsxs(nH,{children:[Fe.jsx(rH,{children:"Visual Effects"}),a.map(l=>Fe.jsx(UT,{onClick:()=>s(l.value),children:l.name},l.name)),Fe.jsx(sH,{onClick:e,children:"Back to Intro"})]}),Fe.jsxs(iH,{children:[Fe.jsx(oH,{ref:t,width:pl,height:gl}),Fe.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},lH=u_`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function cH(e,t){ke.useEffect(()=>{const n=()=>{const i=document.location.hash;t(i==="#game"?"game":i==="#effects"?"effects":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),ke.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const dH=()=>{const{appState:e,setAppState:t}=jr();cH(e,t);const n=()=>{switch(e){case"intro":return Fe.jsx(NS,{});case"game":return Fe.jsx(OS,{});case"effects":return Fe.jsx(aH,{});case"gameOver":return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(OS,{}),Fe.jsx(eH,{})]});default:return Fe.jsx(NS,{})}};return Fe.jsxs(Fe.Fragment,{children:[Fe.jsx(lH,{}),n()]})},kS=document.getElementById("root");kS?oD().then(()=>{XC.createRoot(kS).render(Fe.jsx(ki.StrictMode,{children:Fe.jsx(dw,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:Fe.jsx(dH,{})})}))}):console.error("Failed to find the root element");
