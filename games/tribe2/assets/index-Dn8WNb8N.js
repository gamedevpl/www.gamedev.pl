var wC=Object.defineProperty;var RC=(e,t,n)=>t in e?wC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var De=(e,t,n)=>RC(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function Bv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var kh={exports:{}},ol={},bh={exports:{}},Ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var By;function PC(){if(By)return Ye;By=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.iterator;function S(b){return b===null||typeof b!="object"?null:(b=m&&b[m]||b["@@iterator"],typeof b=="function"?b:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,A={};function C(b,Y,de){this.props=b,this.context=Y,this.refs=A,this.updater=de||v}C.prototype.isReactComponent={},C.prototype.setState=function(b,Y){if(typeof b!="object"&&typeof b!="function"&&b!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,b,Y,"setState")},C.prototype.forceUpdate=function(b){this.updater.enqueueForceUpdate(this,b,"forceUpdate")};function P(){}P.prototype=C.prototype;function R(b,Y,de){this.props=b,this.context=Y,this.refs=A,this.updater=de||v}var w=R.prototype=new P;w.constructor=R,I(w,C.prototype),w.isPureReactComponent=!0;var B=Array.isArray,O=Object.prototype.hasOwnProperty,N={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function F(b,Y,de){var pe,Pe={},me=null,Oe=null;if(Y!=null)for(pe in Y.ref!==void 0&&(Oe=Y.ref),Y.key!==void 0&&(me=""+Y.key),Y)O.call(Y,pe)&&!M.hasOwnProperty(pe)&&(Pe[pe]=Y[pe]);var Ne=arguments.length-2;if(Ne===1)Pe.children=de;else if(1<Ne){for(var ue=Array(Ne),Se=0;Se<Ne;Se++)ue[Se]=arguments[Se+2];Pe.children=ue}if(b&&b.defaultProps)for(pe in Ne=b.defaultProps,Ne)Pe[pe]===void 0&&(Pe[pe]=Ne[pe]);return{$$typeof:e,type:b,key:me,ref:Oe,props:Pe,_owner:N.current}}function W(b,Y){return{$$typeof:e,type:b.type,key:Y,ref:b.ref,props:b.props,_owner:b._owner}}function Z(b){return typeof b=="object"&&b!==null&&b.$$typeof===e}function te(b){var Y={"=":"=0",":":"=2"};return"$"+b.replace(/[=:]/g,function(de){return Y[de]})}var j=/\/+/g;function ie(b,Y){return typeof b=="object"&&b!==null&&b.key!=null?te(""+b.key):Y.toString(36)}function se(b,Y,de,pe,Pe){var me=typeof b;(me==="undefined"||me==="boolean")&&(b=null);var Oe=!1;if(b===null)Oe=!0;else switch(me){case"string":case"number":Oe=!0;break;case"object":switch(b.$$typeof){case e:case t:Oe=!0}}if(Oe)return Oe=b,Pe=Pe(Oe),b=pe===""?"."+ie(Oe,0):pe,B(Pe)?(de="",b!=null&&(de=b.replace(j,"$&/")+"/"),se(Pe,Y,de,"",function(Se){return Se})):Pe!=null&&(Z(Pe)&&(Pe=W(Pe,de+(!Pe.key||Oe&&Oe.key===Pe.key?"":(""+Pe.key).replace(j,"$&/")+"/")+b)),Y.push(Pe)),1;if(Oe=0,pe=pe===""?".":pe+":",B(b))for(var Ne=0;Ne<b.length;Ne++){me=b[Ne];var ue=pe+ie(me,Ne);Oe+=se(me,Y,de,ue,Pe)}else if(ue=S(b),typeof ue=="function")for(b=ue.call(b),Ne=0;!(me=b.next()).done;)me=me.value,ue=pe+ie(me,Ne++),Oe+=se(me,Y,de,ue,Pe);else if(me==="object")throw Y=String(b),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.");return Oe}function _e(b,Y,de){if(b==null)return b;var pe=[],Pe=0;return se(b,pe,"","",function(me){return Y.call(de,me,Pe++)}),pe}function fe(b){if(b._status===-1){var Y=b._result;Y=Y(),Y.then(function(de){(b._status===0||b._status===-1)&&(b._status=1,b._result=de)},function(de){(b._status===0||b._status===-1)&&(b._status=2,b._result=de)}),b._status===-1&&(b._status=0,b._result=Y)}if(b._status===1)return b._result.default;throw b._result}var ne={current:null},z={transition:null},V={ReactCurrentDispatcher:ne,ReactCurrentBatchConfig:z,ReactCurrentOwner:N};function K(){throw Error("act(...) is not supported in production builds of React.")}return Ye.Children={map:_e,forEach:function(b,Y,de){_e(b,function(){Y.apply(this,arguments)},de)},count:function(b){var Y=0;return _e(b,function(){Y++}),Y},toArray:function(b){return _e(b,function(Y){return Y})||[]},only:function(b){if(!Z(b))throw Error("React.Children.only expected to receive a single React element child.");return b}},Ye.Component=C,Ye.Fragment=n,Ye.Profiler=s,Ye.PureComponent=R,Ye.StrictMode=i,Ye.Suspense=u,Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,Ye.act=K,Ye.cloneElement=function(b,Y,de){if(b==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+b+".");var pe=I({},b.props),Pe=b.key,me=b.ref,Oe=b._owner;if(Y!=null){if(Y.ref!==void 0&&(me=Y.ref,Oe=N.current),Y.key!==void 0&&(Pe=""+Y.key),b.type&&b.type.defaultProps)var Ne=b.type.defaultProps;for(ue in Y)O.call(Y,ue)&&!M.hasOwnProperty(ue)&&(pe[ue]=Y[ue]===void 0&&Ne!==void 0?Ne[ue]:Y[ue])}var ue=arguments.length-2;if(ue===1)pe.children=de;else if(1<ue){Ne=Array(ue);for(var Se=0;Se<ue;Se++)Ne[Se]=arguments[Se+2];pe.children=Ne}return{$$typeof:e,type:b.type,key:Pe,ref:me,props:pe,_owner:Oe}},Ye.createContext=function(b){return b={$$typeof:l,_currentValue:b,_currentValue2:b,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},b.Provider={$$typeof:a,_context:b},b.Consumer=b},Ye.createElement=F,Ye.createFactory=function(b){var Y=F.bind(null,b);return Y.type=b,Y},Ye.createRef=function(){return{current:null}},Ye.forwardRef=function(b){return{$$typeof:c,render:b}},Ye.isValidElement=Z,Ye.lazy=function(b){return{$$typeof:g,_payload:{_status:-1,_result:b},_init:fe}},Ye.memo=function(b,Y){return{$$typeof:f,type:b,compare:Y===void 0?null:Y}},Ye.startTransition=function(b){var Y=z.transition;z.transition={};try{b()}finally{z.transition=Y}},Ye.unstable_act=K,Ye.useCallback=function(b,Y){return ne.current.useCallback(b,Y)},Ye.useContext=function(b){return ne.current.useContext(b)},Ye.useDebugValue=function(){},Ye.useDeferredValue=function(b){return ne.current.useDeferredValue(b)},Ye.useEffect=function(b,Y){return ne.current.useEffect(b,Y)},Ye.useId=function(){return ne.current.useId()},Ye.useImperativeHandle=function(b,Y,de){return ne.current.useImperativeHandle(b,Y,de)},Ye.useInsertionEffect=function(b,Y){return ne.current.useInsertionEffect(b,Y)},Ye.useLayoutEffect=function(b,Y){return ne.current.useLayoutEffect(b,Y)},Ye.useMemo=function(b,Y){return ne.current.useMemo(b,Y)},Ye.useReducer=function(b,Y,de){return ne.current.useReducer(b,Y,de)},Ye.useRef=function(b){return ne.current.useRef(b)},Ye.useState=function(b){return ne.current.useState(b)},Ye.useSyncExternalStore=function(b,Y,de){return ne.current.useSyncExternalStore(b,Y,de)},Ye.useTransition=function(){return ne.current.useTransition()},Ye.version="18.3.1",Ye}var Fy;function qg(){return Fy||(Fy=1,bh.exports=PC()),bh.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ly;function DC(){if(Ly)return ol;Ly=1;var e=qg(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(c,u,f){var g,m={},S=null,v=null;f!==void 0&&(S=""+f),u.key!==void 0&&(S=""+u.key),u.ref!==void 0&&(v=u.ref);for(g in u)i.call(u,g)&&!a.hasOwnProperty(g)&&(m[g]=u[g]);if(c&&c.defaultProps)for(g in u=c.defaultProps,u)m[g]===void 0&&(m[g]=u[g]);return{$$typeof:t,type:c,key:S,ref:v,props:m,_owner:s.current}}return ol.Fragment=n,ol.jsx=l,ol.jsxs=l,ol}var Uy;function NC(){return Uy||(Uy=1,kh.exports=DC()),kh.exports}var Ue=NC(),Fe=qg();const ki=Bv(Fe);var hd={},Bh={exports:{}},Rn={},Fh={exports:{}},Lh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hy;function MC(){return Hy||(Hy=1,function(e){function t(z,V){var K=z.length;z.push(V);e:for(;0<K;){var b=K-1>>>1,Y=z[b];if(0<s(Y,V))z[b]=V,z[K]=Y,K=b;else break e}}function n(z){return z.length===0?null:z[0]}function i(z){if(z.length===0)return null;var V=z[0],K=z.pop();if(K!==V){z[0]=K;e:for(var b=0,Y=z.length,de=Y>>>1;b<de;){var pe=2*(b+1)-1,Pe=z[pe],me=pe+1,Oe=z[me];if(0>s(Pe,K))me<Y&&0>s(Oe,Pe)?(z[b]=Oe,z[me]=K,b=me):(z[b]=Pe,z[pe]=K,b=pe);else if(me<Y&&0>s(Oe,K))z[b]=Oe,z[me]=K,b=me;else break e}}return V}function s(z,V){var K=z.sortIndex-V.sortIndex;return K!==0?K:z.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var u=[],f=[],g=1,m=null,S=3,v=!1,I=!1,A=!1,C=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(z){for(var V=n(f);V!==null;){if(V.callback===null)i(f);else if(V.startTime<=z)i(f),V.sortIndex=V.expirationTime,t(u,V);else break;V=n(f)}}function B(z){if(A=!1,w(z),!I)if(n(u)!==null)I=!0,fe(O);else{var V=n(f);V!==null&&ne(B,V.startTime-z)}}function O(z,V){I=!1,A&&(A=!1,P(F),F=-1),v=!0;var K=S;try{for(w(V),m=n(u);m!==null&&(!(m.expirationTime>V)||z&&!te());){var b=m.callback;if(typeof b=="function"){m.callback=null,S=m.priorityLevel;var Y=b(m.expirationTime<=V);V=e.unstable_now(),typeof Y=="function"?m.callback=Y:m===n(u)&&i(u),w(V)}else i(u);m=n(u)}if(m!==null)var de=!0;else{var pe=n(f);pe!==null&&ne(B,pe.startTime-V),de=!1}return de}finally{m=null,S=K,v=!1}}var N=!1,M=null,F=-1,W=5,Z=-1;function te(){return!(e.unstable_now()-Z<W)}function j(){if(M!==null){var z=e.unstable_now();Z=z;var V=!0;try{V=M(!0,z)}finally{V?ie():(N=!1,M=null)}}else N=!1}var ie;if(typeof R=="function")ie=function(){R(j)};else if(typeof MessageChannel<"u"){var se=new MessageChannel,_e=se.port2;se.port1.onmessage=j,ie=function(){_e.postMessage(null)}}else ie=function(){C(j,0)};function fe(z){M=z,N||(N=!0,ie())}function ne(z,V){F=C(function(){z(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(z){z.callback=null},e.unstable_continueExecution=function(){I||v||(I=!0,fe(O))},e.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):W=0<z?Math.floor(1e3/z):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(z){switch(S){case 1:case 2:case 3:var V=3;break;default:V=S}var K=S;S=V;try{return z()}finally{S=K}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(z,V){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var K=S;S=z;try{return V()}finally{S=K}},e.unstable_scheduleCallback=function(z,V,K){var b=e.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?b+K:b):K=b,z){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=K+Y,z={id:g++,callback:V,priorityLevel:z,startTime:K,expirationTime:Y,sortIndex:-1},K>b?(z.sortIndex=K,t(f,z),n(u)===null&&z===n(f)&&(A?(P(F),F=-1):A=!0,ne(B,K-b))):(z.sortIndex=Y,t(u,z),I||v||(I=!0,fe(O))),z},e.unstable_shouldYield=te,e.unstable_wrapCallback=function(z){var V=S;return function(){var K=S;S=V;try{return z.apply(this,arguments)}finally{S=K}}}}(Lh)),Lh}var Gy;function OC(){return Gy||(Gy=1,Fh.exports=MC()),Fh.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var $y;function kC(){if($y)return Rn;$y=1;var e=qg(),t=OC();function n(o){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+o,d=1;d<arguments.length;d++)r+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+o+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function a(o,r){l(o,r),l(o+"Capture",r)}function l(o,r){for(s[o]=r,o=0;o<r.length;o++)i.add(r[o])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},m={};function S(o){return u.call(m,o)?!0:u.call(g,o)?!1:f.test(o)?m[o]=!0:(g[o]=!0,!1)}function v(o,r,d,h){if(d!==null&&d.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return h?!1:d!==null?!d.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function I(o,r,d,h){if(r===null||typeof r>"u"||v(o,r,d,h))return!0;if(h)return!1;if(d!==null)switch(d.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function A(o,r,d,h,p,y,E){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=h,this.attributeNamespace=p,this.mustUseProperty=d,this.propertyName=o,this.type=r,this.sanitizeURL=y,this.removeEmptyString=E}var C={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){C[o]=new A(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var r=o[0];C[r]=new A(r,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){C[o]=new A(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){C[o]=new A(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){C[o]=new A(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){C[o]=new A(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){C[o]=new A(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){C[o]=new A(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){C[o]=new A(o,5,!1,o.toLowerCase(),null,!1,!1)});var P=/[\-:]([a-z])/g;function R(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var r=o.replace(P,R);C[r]=new A(r,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var r=o.replace(P,R);C[r]=new A(r,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var r=o.replace(P,R);C[r]=new A(r,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){C[o]=new A(o,1,!1,o.toLowerCase(),null,!1,!1)}),C.xlinkHref=new A("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){C[o]=new A(o,1,!1,o.toLowerCase(),null,!0,!0)});function w(o,r,d,h){var p=C.hasOwnProperty(r)?C[r]:null;(p!==null?p.type!==0:h||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(I(r,d,p,h)&&(d=null),h||p===null?S(r)&&(d===null?o.removeAttribute(r):o.setAttribute(r,""+d)):p.mustUseProperty?o[p.propertyName]=d===null?p.type===3?!1:"":d:(r=p.attributeName,h=p.attributeNamespace,d===null?o.removeAttribute(r):(p=p.type,d=p===3||p===4&&d===!0?"":""+d,h?o.setAttributeNS(h,r,d):o.setAttribute(r,d))))}var B=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O=Symbol.for("react.element"),N=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),W=Symbol.for("react.profiler"),Z=Symbol.for("react.provider"),te=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),ie=Symbol.for("react.suspense"),se=Symbol.for("react.suspense_list"),_e=Symbol.for("react.memo"),fe=Symbol.for("react.lazy"),ne=Symbol.for("react.offscreen"),z=Symbol.iterator;function V(o){return o===null||typeof o!="object"?null:(o=z&&o[z]||o["@@iterator"],typeof o=="function"?o:null)}var K=Object.assign,b;function Y(o){if(b===void 0)try{throw Error()}catch(d){var r=d.stack.trim().match(/\n( *(at )?)/);b=r&&r[1]||""}return`
`+b+o}var de=!1;function pe(o,r){if(!o||de)return"";de=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(x){var h=x}Reflect.construct(o,[],r)}else{try{r.call()}catch(x){h=x}o.call(r.prototype)}else{try{throw Error()}catch(x){h=x}o()}}catch(x){if(x&&h&&typeof x.stack=="string"){for(var p=x.stack.split(`
`),y=h.stack.split(`
`),E=p.length-1,D=y.length-1;1<=E&&0<=D&&p[E]!==y[D];)D--;for(;1<=E&&0<=D;E--,D--)if(p[E]!==y[D]){if(E!==1||D!==1)do if(E--,D--,0>D||p[E]!==y[D]){var k=`
`+p[E].replace(" at new "," at ");return o.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",o.displayName)),k}while(1<=E&&0<=D);break}}}finally{de=!1,Error.prepareStackTrace=d}return(o=o?o.displayName||o.name:"")?Y(o):""}function Pe(o){switch(o.tag){case 5:return Y(o.type);case 16:return Y("Lazy");case 13:return Y("Suspense");case 19:return Y("SuspenseList");case 0:case 2:case 15:return o=pe(o.type,!1),o;case 11:return o=pe(o.type.render,!1),o;case 1:return o=pe(o.type,!0),o;default:return""}}function me(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case M:return"Fragment";case N:return"Portal";case W:return"Profiler";case F:return"StrictMode";case ie:return"Suspense";case se:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case te:return(o.displayName||"Context")+".Consumer";case Z:return(o._context.displayName||"Context")+".Provider";case j:var r=o.render;return o=o.displayName,o||(o=r.displayName||r.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case _e:return r=o.displayName||null,r!==null?r:me(o.type)||"Memo";case fe:r=o._payload,o=o._init;try{return me(o(r))}catch{}}return null}function Oe(o){var r=o.type;switch(o.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=r.render,o=o.displayName||o.name||"",r.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return me(r);case 8:return r===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Ne(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function ue(o){var r=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Se(o){var r=ue(o)?"checked":"value",d=Object.getOwnPropertyDescriptor(o.constructor.prototype,r),h=""+o[r];if(!o.hasOwnProperty(r)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var p=d.get,y=d.set;return Object.defineProperty(o,r,{configurable:!0,get:function(){return p.call(this)},set:function(E){h=""+E,y.call(this,E)}}),Object.defineProperty(o,r,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(E){h=""+E},stopTracking:function(){o._valueTracker=null,delete o[r]}}}}function xe(o){o._valueTracker||(o._valueTracker=Se(o))}function Ie(o){if(!o)return!1;var r=o._valueTracker;if(!r)return!0;var d=r.getValue(),h="";return o&&(h=ue(o)?o.checked?"true":"false":o.value),o=h,o!==d?(r.setValue(o),!0):!1}function oi(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function nt(o,r){var d=r.checked;return K({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??o._wrapperState.initialChecked})}function at(o,r){var d=r.defaultValue==null?"":r.defaultValue,h=r.checked!=null?r.checked:r.defaultChecked;d=Ne(r.value!=null?r.value:d),o._wrapperState={initialChecked:h,initialValue:d,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function mi(o,r){r=r.checked,r!=null&&w(o,"checked",r,!1)}function In(o,r){mi(o,r);var d=Ne(r.value),h=r.type;if(d!=null)h==="number"?(d===0&&o.value===""||o.value!=d)&&(o.value=""+d):o.value!==""+d&&(o.value=""+d);else if(h==="submit"||h==="reset"){o.removeAttribute("value");return}r.hasOwnProperty("value")?yi(o,r.type,d):r.hasOwnProperty("defaultValue")&&yi(o,r.type,Ne(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(o.defaultChecked=!!r.defaultChecked)}function Yn(o,r,d){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var h=r.type;if(!(h!=="submit"&&h!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+o._wrapperState.initialValue,d||r===o.value||(o.value=r),o.defaultValue=r}d=o.name,d!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,d!==""&&(o.name=d)}function yi(o,r,d){(r!=="number"||oi(o.ownerDocument)!==o)&&(d==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+d&&(o.defaultValue=""+d))}var Si=Array.isArray;function fo(o,r,d,h){if(o=o.options,r){r={};for(var p=0;p<d.length;p++)r["$"+d[p]]=!0;for(d=0;d<o.length;d++)p=r.hasOwnProperty("$"+o[d].value),o[d].selected!==p&&(o[d].selected=p),p&&h&&(o[d].defaultSelected=!0)}else{for(d=""+Ne(d),r=null,p=0;p<o.length;p++){if(o[p].value===d){o[p].selected=!0,h&&(o[p].defaultSelected=!0);return}r!==null||o[p].disabled||(r=o[p])}r!==null&&(r.selected=!0)}}function or(o,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return K({},r,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function zp(o,r){var d=r.value;if(d==null){if(d=r.children,r=r.defaultValue,d!=null){if(r!=null)throw Error(n(92));if(Si(d)){if(1<d.length)throw Error(n(93));d=d[0]}r=d}r==null&&(r=""),d=r}o._wrapperState={initialValue:Ne(d)}}function jp(o,r){var d=Ne(r.value),h=Ne(r.defaultValue);d!=null&&(d=""+d,d!==o.value&&(o.value=d),r.defaultValue==null&&o.defaultValue!==d&&(o.defaultValue=d)),h!=null&&(o.defaultValue=""+h)}function Xp(o){var r=o.textContent;r===o._wrapperState.initialValue&&r!==""&&r!==null&&(o.value=r)}function Vp(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Wu(o,r){return o==null||o==="http://www.w3.org/1999/xhtml"?Vp(r):o==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var rc,Kp=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,d,h,p){MSApp.execUnsafeLocalFunction(function(){return o(r,d,h,p)})}:o}(function(o,r){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=r;else{for(rc=rc||document.createElement("div"),rc.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=rc.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;r.firstChild;)o.appendChild(r.firstChild)}});function Aa(o,r){if(r){var d=o.firstChild;if(d&&d===o.lastChild&&d.nodeType===3){d.nodeValue=r;return}}o.textContent=r}var Ia={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},NT=["Webkit","ms","Moz","O"];Object.keys(Ia).forEach(function(o){NT.forEach(function(r){r=r+o.charAt(0).toUpperCase()+o.substring(1),Ia[r]=Ia[o]})});function qp(o,r,d){return r==null||typeof r=="boolean"||r===""?"":d||typeof r!="number"||r===0||Ia.hasOwnProperty(o)&&Ia[o]?(""+r).trim():r+"px"}function Zp(o,r){o=o.style;for(var d in r)if(r.hasOwnProperty(d)){var h=d.indexOf("--")===0,p=qp(d,r[d],h);d==="float"&&(d="cssFloat"),h?o.setProperty(d,p):o[d]=p}}var MT=K({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Yu(o,r){if(r){if(MT[o]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,o));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function zu(o,r){if(o.indexOf("-")===-1)return typeof r.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ju=null;function Xu(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Vu=null,Jr=null,es=null;function Qp(o){if(o=Wa(o)){if(typeof Vu!="function")throw Error(n(280));var r=o.stateNode;r&&(r=Pc(r),Vu(o.stateNode,o.type,r))}}function Jp(o){Jr?es?es.push(o):es=[o]:Jr=o}function em(){if(Jr){var o=Jr,r=es;if(es=Jr=null,Qp(o),r)for(o=0;o<r.length;o++)Qp(r[o])}}function tm(o,r){return o(r)}function nm(){}var Ku=!1;function im(o,r,d){if(Ku)return o(r,d);Ku=!0;try{return tm(o,r,d)}finally{Ku=!1,(Jr!==null||es!==null)&&(nm(),em())}}function Ta(o,r){var d=o.stateNode;if(d===null)return null;var h=Pc(d);if(h===null)return null;d=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(o=o.type,h=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!h;break e;default:o=!1}if(o)return null;if(d&&typeof d!="function")throw Error(n(231,r,typeof d));return d}var qu=!1;if(c)try{var Ea={};Object.defineProperty(Ea,"passive",{get:function(){qu=!0}}),window.addEventListener("test",Ea,Ea),window.removeEventListener("test",Ea,Ea)}catch{qu=!1}function OT(o,r,d,h,p,y,E,D,k){var x=Array.prototype.slice.call(arguments,3);try{r.apply(d,x)}catch(q){this.onError(q)}}var Ca=!1,sc=null,ac=!1,Zu=null,kT={onError:function(o){Ca=!0,sc=o}};function bT(o,r,d,h,p,y,E,D,k){Ca=!1,sc=null,OT.apply(kT,arguments)}function BT(o,r,d,h,p,y,E,D,k){if(bT.apply(this,arguments),Ca){if(Ca){var x=sc;Ca=!1,sc=null}else throw Error(n(198));ac||(ac=!0,Zu=x)}}function rr(o){var r=o,d=o;if(o.alternate)for(;r.return;)r=r.return;else{o=r;do r=o,(r.flags&4098)!==0&&(d=r.return),o=r.return;while(o)}return r.tag===3?d:null}function om(o){if(o.tag===13){var r=o.memoizedState;if(r===null&&(o=o.alternate,o!==null&&(r=o.memoizedState)),r!==null)return r.dehydrated}return null}function rm(o){if(rr(o)!==o)throw Error(n(188))}function FT(o){var r=o.alternate;if(!r){if(r=rr(o),r===null)throw Error(n(188));return r!==o?null:o}for(var d=o,h=r;;){var p=d.return;if(p===null)break;var y=p.alternate;if(y===null){if(h=p.return,h!==null){d=h;continue}break}if(p.child===y.child){for(y=p.child;y;){if(y===d)return rm(p),o;if(y===h)return rm(p),r;y=y.sibling}throw Error(n(188))}if(d.return!==h.return)d=p,h=y;else{for(var E=!1,D=p.child;D;){if(D===d){E=!0,d=p,h=y;break}if(D===h){E=!0,h=p,d=y;break}D=D.sibling}if(!E){for(D=y.child;D;){if(D===d){E=!0,d=y,h=p;break}if(D===h){E=!0,h=y,d=p;break}D=D.sibling}if(!E)throw Error(n(189))}}if(d.alternate!==h)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?o:r}function sm(o){return o=FT(o),o!==null?am(o):null}function am(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var r=am(o);if(r!==null)return r;o=o.sibling}return null}var lm=t.unstable_scheduleCallback,cm=t.unstable_cancelCallback,LT=t.unstable_shouldYield,UT=t.unstable_requestPaint,It=t.unstable_now,HT=t.unstable_getCurrentPriorityLevel,Qu=t.unstable_ImmediatePriority,dm=t.unstable_UserBlockingPriority,lc=t.unstable_NormalPriority,GT=t.unstable_LowPriority,um=t.unstable_IdlePriority,cc=null,vi=null;function $T(o){if(vi&&typeof vi.onCommitFiberRoot=="function")try{vi.onCommitFiberRoot(cc,o,void 0,(o.current.flags&128)===128)}catch{}}var ri=Math.clz32?Math.clz32:YT,xT=Math.log,WT=Math.LN2;function YT(o){return o>>>=0,o===0?32:31-(xT(o)/WT|0)|0}var dc=64,uc=4194304;function _a(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function fc(o,r){var d=o.pendingLanes;if(d===0)return 0;var h=0,p=o.suspendedLanes,y=o.pingedLanes,E=d&268435455;if(E!==0){var D=E&~p;D!==0?h=_a(D):(y&=E,y!==0&&(h=_a(y)))}else E=d&~p,E!==0?h=_a(E):y!==0&&(h=_a(y));if(h===0)return 0;if(r!==0&&r!==h&&(r&p)===0&&(p=h&-h,y=r&-r,p>=y||p===16&&(y&4194240)!==0))return r;if((h&4)!==0&&(h|=d&16),r=o.entangledLanes,r!==0)for(o=o.entanglements,r&=h;0<r;)d=31-ri(r),p=1<<d,h|=o[d],r&=~p;return h}function zT(o,r){switch(o){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function jT(o,r){for(var d=o.suspendedLanes,h=o.pingedLanes,p=o.expirationTimes,y=o.pendingLanes;0<y;){var E=31-ri(y),D=1<<E,k=p[E];k===-1?((D&d)===0||(D&h)!==0)&&(p[E]=zT(D,r)):k<=r&&(o.expiredLanes|=D),y&=~D}}function Ju(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function fm(){var o=dc;return dc<<=1,(dc&4194240)===0&&(dc=64),o}function ef(o){for(var r=[],d=0;31>d;d++)r.push(o);return r}function wa(o,r,d){o.pendingLanes|=r,r!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,r=31-ri(r),o[r]=d}function XT(o,r){var d=o.pendingLanes&~r;o.pendingLanes=r,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=r,o.mutableReadLanes&=r,o.entangledLanes&=r,r=o.entanglements;var h=o.eventTimes;for(o=o.expirationTimes;0<d;){var p=31-ri(d),y=1<<p;r[p]=0,h[p]=-1,o[p]=-1,d&=~y}}function tf(o,r){var d=o.entangledLanes|=r;for(o=o.entanglements;d;){var h=31-ri(d),p=1<<h;p&r|o[h]&r&&(o[h]|=r),d&=~p}}var tt=0;function hm(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var gm,nf,pm,mm,ym,of=!1,hc=[],ho=null,go=null,po=null,Ra=new Map,Pa=new Map,mo=[],VT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sm(o,r){switch(o){case"focusin":case"focusout":ho=null;break;case"dragenter":case"dragleave":go=null;break;case"mouseover":case"mouseout":po=null;break;case"pointerover":case"pointerout":Ra.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pa.delete(r.pointerId)}}function Da(o,r,d,h,p,y){return o===null||o.nativeEvent!==y?(o={blockedOn:r,domEventName:d,eventSystemFlags:h,nativeEvent:y,targetContainers:[p]},r!==null&&(r=Wa(r),r!==null&&nf(r)),o):(o.eventSystemFlags|=h,r=o.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),o)}function KT(o,r,d,h,p){switch(r){case"focusin":return ho=Da(ho,o,r,d,h,p),!0;case"dragenter":return go=Da(go,o,r,d,h,p),!0;case"mouseover":return po=Da(po,o,r,d,h,p),!0;case"pointerover":var y=p.pointerId;return Ra.set(y,Da(Ra.get(y)||null,o,r,d,h,p)),!0;case"gotpointercapture":return y=p.pointerId,Pa.set(y,Da(Pa.get(y)||null,o,r,d,h,p)),!0}return!1}function vm(o){var r=sr(o.target);if(r!==null){var d=rr(r);if(d!==null){if(r=d.tag,r===13){if(r=om(d),r!==null){o.blockedOn=r,ym(o.priority,function(){pm(d)});return}}else if(r===3&&d.stateNode.current.memoizedState.isDehydrated){o.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}o.blockedOn=null}function gc(o){if(o.blockedOn!==null)return!1;for(var r=o.targetContainers;0<r.length;){var d=sf(o.domEventName,o.eventSystemFlags,r[0],o.nativeEvent);if(d===null){d=o.nativeEvent;var h=new d.constructor(d.type,d);ju=h,d.target.dispatchEvent(h),ju=null}else return r=Wa(d),r!==null&&nf(r),o.blockedOn=d,!1;r.shift()}return!0}function Am(o,r,d){gc(o)&&d.delete(r)}function qT(){of=!1,ho!==null&&gc(ho)&&(ho=null),go!==null&&gc(go)&&(go=null),po!==null&&gc(po)&&(po=null),Ra.forEach(Am),Pa.forEach(Am)}function Na(o,r){o.blockedOn===r&&(o.blockedOn=null,of||(of=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,qT)))}function Ma(o){function r(p){return Na(p,o)}if(0<hc.length){Na(hc[0],o);for(var d=1;d<hc.length;d++){var h=hc[d];h.blockedOn===o&&(h.blockedOn=null)}}for(ho!==null&&Na(ho,o),go!==null&&Na(go,o),po!==null&&Na(po,o),Ra.forEach(r),Pa.forEach(r),d=0;d<mo.length;d++)h=mo[d],h.blockedOn===o&&(h.blockedOn=null);for(;0<mo.length&&(d=mo[0],d.blockedOn===null);)vm(d),d.blockedOn===null&&mo.shift()}var ts=B.ReactCurrentBatchConfig,pc=!0;function ZT(o,r,d,h){var p=tt,y=ts.transition;ts.transition=null;try{tt=1,rf(o,r,d,h)}finally{tt=p,ts.transition=y}}function QT(o,r,d,h){var p=tt,y=ts.transition;ts.transition=null;try{tt=4,rf(o,r,d,h)}finally{tt=p,ts.transition=y}}function rf(o,r,d,h){if(pc){var p=sf(o,r,d,h);if(p===null)Ef(o,r,h,mc,d),Sm(o,h);else if(KT(p,o,r,d,h))h.stopPropagation();else if(Sm(o,h),r&4&&-1<VT.indexOf(o)){for(;p!==null;){var y=Wa(p);if(y!==null&&gm(y),y=sf(o,r,d,h),y===null&&Ef(o,r,h,mc,d),y===p)break;p=y}p!==null&&h.stopPropagation()}else Ef(o,r,h,null,d)}}var mc=null;function sf(o,r,d,h){if(mc=null,o=Xu(h),o=sr(o),o!==null)if(r=rr(o),r===null)o=null;else if(d=r.tag,d===13){if(o=om(r),o!==null)return o;o=null}else if(d===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;o=null}else r!==o&&(o=null);return mc=o,null}function Im(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(HT()){case Qu:return 1;case dm:return 4;case lc:case GT:return 16;case um:return 536870912;default:return 16}default:return 16}}var yo=null,af=null,yc=null;function Tm(){if(yc)return yc;var o,r=af,d=r.length,h,p="value"in yo?yo.value:yo.textContent,y=p.length;for(o=0;o<d&&r[o]===p[o];o++);var E=d-o;for(h=1;h<=E&&r[d-h]===p[y-h];h++);return yc=p.slice(o,1<h?1-h:void 0)}function Sc(o){var r=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&r===13&&(o=13)):o=r,o===10&&(o=13),32<=o||o===13?o:0}function vc(){return!0}function Em(){return!1}function On(o){function r(d,h,p,y,E){this._reactName=d,this._targetInst=p,this.type=h,this.nativeEvent=y,this.target=E,this.currentTarget=null;for(var D in o)o.hasOwnProperty(D)&&(d=o[D],this[D]=d?d(y):y[D]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?vc:Em,this.isPropagationStopped=Em,this}return K(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=vc)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=vc)},persist:function(){},isPersistent:vc}),r}var ns={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},lf=On(ns),Oa=K({},ns,{view:0,detail:0}),JT=On(Oa),cf,df,ka,Ac=K({},Oa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ff,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==ka&&(ka&&o.type==="mousemove"?(cf=o.screenX-ka.screenX,df=o.screenY-ka.screenY):df=cf=0,ka=o),cf)},movementY:function(o){return"movementY"in o?o.movementY:df}}),Cm=On(Ac),eE=K({},Ac,{dataTransfer:0}),tE=On(eE),nE=K({},Oa,{relatedTarget:0}),uf=On(nE),iE=K({},ns,{animationName:0,elapsedTime:0,pseudoElement:0}),oE=On(iE),rE=K({},ns,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),sE=On(rE),aE=K({},ns,{data:0}),_m=On(aE),lE={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},cE={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dE={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uE(o){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(o):(o=dE[o])?!!r[o]:!1}function ff(){return uE}var fE=K({},Oa,{key:function(o){if(o.key){var r=lE[o.key]||o.key;if(r!=="Unidentified")return r}return o.type==="keypress"?(o=Sc(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?cE[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ff,charCode:function(o){return o.type==="keypress"?Sc(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?Sc(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),hE=On(fE),gE=K({},Ac,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),wm=On(gE),pE=K({},Oa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ff}),mE=On(pE),yE=K({},ns,{propertyName:0,elapsedTime:0,pseudoElement:0}),SE=On(yE),vE=K({},Ac,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),AE=On(vE),IE=[9,13,27,32],hf=c&&"CompositionEvent"in window,ba=null;c&&"documentMode"in document&&(ba=document.documentMode);var TE=c&&"TextEvent"in window&&!ba,Rm=c&&(!hf||ba&&8<ba&&11>=ba),Pm=" ",Dm=!1;function Nm(o,r){switch(o){case"keyup":return IE.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mm(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var is=!1;function EE(o,r){switch(o){case"compositionend":return Mm(r);case"keypress":return r.which!==32?null:(Dm=!0,Pm);case"textInput":return o=r.data,o===Pm&&Dm?null:o;default:return null}}function CE(o,r){if(is)return o==="compositionend"||!hf&&Nm(o,r)?(o=Tm(),yc=af=yo=null,is=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Rm&&r.locale!=="ko"?null:r.data;default:return null}}var _E={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Om(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r==="input"?!!_E[o.type]:r==="textarea"}function km(o,r,d,h){Jp(h),r=_c(r,"onChange"),0<r.length&&(d=new lf("onChange","change",null,d,h),o.push({event:d,listeners:r}))}var Ba=null,Fa=null;function wE(o){Zm(o,0)}function Ic(o){var r=ls(o);if(Ie(r))return o}function RE(o,r){if(o==="change")return r}var bm=!1;if(c){var gf;if(c){var pf="oninput"in document;if(!pf){var Bm=document.createElement("div");Bm.setAttribute("oninput","return;"),pf=typeof Bm.oninput=="function"}gf=pf}else gf=!1;bm=gf&&(!document.documentMode||9<document.documentMode)}function Fm(){Ba&&(Ba.detachEvent("onpropertychange",Lm),Fa=Ba=null)}function Lm(o){if(o.propertyName==="value"&&Ic(Fa)){var r=[];km(r,Fa,o,Xu(o)),im(wE,r)}}function PE(o,r,d){o==="focusin"?(Fm(),Ba=r,Fa=d,Ba.attachEvent("onpropertychange",Lm)):o==="focusout"&&Fm()}function DE(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Ic(Fa)}function NE(o,r){if(o==="click")return Ic(r)}function ME(o,r){if(o==="input"||o==="change")return Ic(r)}function OE(o,r){return o===r&&(o!==0||1/o===1/r)||o!==o&&r!==r}var si=typeof Object.is=="function"?Object.is:OE;function La(o,r){if(si(o,r))return!0;if(typeof o!="object"||o===null||typeof r!="object"||r===null)return!1;var d=Object.keys(o),h=Object.keys(r);if(d.length!==h.length)return!1;for(h=0;h<d.length;h++){var p=d[h];if(!u.call(r,p)||!si(o[p],r[p]))return!1}return!0}function Um(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Hm(o,r){var d=Um(o);o=0;for(var h;d;){if(d.nodeType===3){if(h=o+d.textContent.length,o<=r&&h>=r)return{node:d,offset:r-o};o=h}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Um(d)}}function Gm(o,r){return o&&r?o===r?!0:o&&o.nodeType===3?!1:r&&r.nodeType===3?Gm(o,r.parentNode):"contains"in o?o.contains(r):o.compareDocumentPosition?!!(o.compareDocumentPosition(r)&16):!1:!1}function $m(){for(var o=window,r=oi();r instanceof o.HTMLIFrameElement;){try{var d=typeof r.contentWindow.location.href=="string"}catch{d=!1}if(d)o=r.contentWindow;else break;r=oi(o.document)}return r}function mf(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r&&(r==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||r==="textarea"||o.contentEditable==="true")}function kE(o){var r=$m(),d=o.focusedElem,h=o.selectionRange;if(r!==d&&d&&d.ownerDocument&&Gm(d.ownerDocument.documentElement,d)){if(h!==null&&mf(d)){if(r=h.start,o=h.end,o===void 0&&(o=r),"selectionStart"in d)d.selectionStart=r,d.selectionEnd=Math.min(o,d.value.length);else if(o=(r=d.ownerDocument||document)&&r.defaultView||window,o.getSelection){o=o.getSelection();var p=d.textContent.length,y=Math.min(h.start,p);h=h.end===void 0?y:Math.min(h.end,p),!o.extend&&y>h&&(p=h,h=y,y=p),p=Hm(d,y);var E=Hm(d,h);p&&E&&(o.rangeCount!==1||o.anchorNode!==p.node||o.anchorOffset!==p.offset||o.focusNode!==E.node||o.focusOffset!==E.offset)&&(r=r.createRange(),r.setStart(p.node,p.offset),o.removeAllRanges(),y>h?(o.addRange(r),o.extend(E.node,E.offset)):(r.setEnd(E.node,E.offset),o.addRange(r)))}}for(r=[],o=d;o=o.parentNode;)o.nodeType===1&&r.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<r.length;d++)o=r[d],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var bE=c&&"documentMode"in document&&11>=document.documentMode,os=null,yf=null,Ua=null,Sf=!1;function xm(o,r,d){var h=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;Sf||os==null||os!==oi(h)||(h=os,"selectionStart"in h&&mf(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Ua&&La(Ua,h)||(Ua=h,h=_c(yf,"onSelect"),0<h.length&&(r=new lf("onSelect","select",null,r,d),o.push({event:r,listeners:h}),r.target=os)))}function Tc(o,r){var d={};return d[o.toLowerCase()]=r.toLowerCase(),d["Webkit"+o]="webkit"+r,d["Moz"+o]="moz"+r,d}var rs={animationend:Tc("Animation","AnimationEnd"),animationiteration:Tc("Animation","AnimationIteration"),animationstart:Tc("Animation","AnimationStart"),transitionend:Tc("Transition","TransitionEnd")},vf={},Wm={};c&&(Wm=document.createElement("div").style,"AnimationEvent"in window||(delete rs.animationend.animation,delete rs.animationiteration.animation,delete rs.animationstart.animation),"TransitionEvent"in window||delete rs.transitionend.transition);function Ec(o){if(vf[o])return vf[o];if(!rs[o])return o;var r=rs[o],d;for(d in r)if(r.hasOwnProperty(d)&&d in Wm)return vf[o]=r[d];return o}var Ym=Ec("animationend"),zm=Ec("animationiteration"),jm=Ec("animationstart"),Xm=Ec("transitionend"),Vm=new Map,Km="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function So(o,r){Vm.set(o,r),a(r,[o])}for(var Af=0;Af<Km.length;Af++){var If=Km[Af],BE=If.toLowerCase(),FE=If[0].toUpperCase()+If.slice(1);So(BE,"on"+FE)}So(Ym,"onAnimationEnd"),So(zm,"onAnimationIteration"),So(jm,"onAnimationStart"),So("dblclick","onDoubleClick"),So("focusin","onFocus"),So("focusout","onBlur"),So(Xm,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ha="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),LE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ha));function qm(o,r,d){var h=o.type||"unknown-event";o.currentTarget=d,BT(h,r,void 0,o),o.currentTarget=null}function Zm(o,r){r=(r&4)!==0;for(var d=0;d<o.length;d++){var h=o[d],p=h.event;h=h.listeners;e:{var y=void 0;if(r)for(var E=h.length-1;0<=E;E--){var D=h[E],k=D.instance,x=D.currentTarget;if(D=D.listener,k!==y&&p.isPropagationStopped())break e;qm(p,D,x),y=k}else for(E=0;E<h.length;E++){if(D=h[E],k=D.instance,x=D.currentTarget,D=D.listener,k!==y&&p.isPropagationStopped())break e;qm(p,D,x),y=k}}}if(ac)throw o=Zu,ac=!1,Zu=null,o}function lt(o,r){var d=r[Df];d===void 0&&(d=r[Df]=new Set);var h=o+"__bubble";d.has(h)||(Qm(r,o,2,!1),d.add(h))}function Tf(o,r,d){var h=0;r&&(h|=4),Qm(d,o,h,r)}var Cc="_reactListening"+Math.random().toString(36).slice(2);function Ga(o){if(!o[Cc]){o[Cc]=!0,i.forEach(function(d){d!=="selectionchange"&&(LE.has(d)||Tf(d,!1,o),Tf(d,!0,o))});var r=o.nodeType===9?o:o.ownerDocument;r===null||r[Cc]||(r[Cc]=!0,Tf("selectionchange",!1,r))}}function Qm(o,r,d,h){switch(Im(r)){case 1:var p=ZT;break;case 4:p=QT;break;default:p=rf}d=p.bind(null,r,d,o),p=void 0,!qu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),h?p!==void 0?o.addEventListener(r,d,{capture:!0,passive:p}):o.addEventListener(r,d,!0):p!==void 0?o.addEventListener(r,d,{passive:p}):o.addEventListener(r,d,!1)}function Ef(o,r,d,h,p){var y=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var E=h.tag;if(E===3||E===4){var D=h.stateNode.containerInfo;if(D===p||D.nodeType===8&&D.parentNode===p)break;if(E===4)for(E=h.return;E!==null;){var k=E.tag;if((k===3||k===4)&&(k=E.stateNode.containerInfo,k===p||k.nodeType===8&&k.parentNode===p))return;E=E.return}for(;D!==null;){if(E=sr(D),E===null)return;if(k=E.tag,k===5||k===6){h=y=E;continue e}D=D.parentNode}}h=h.return}im(function(){var x=y,q=Xu(d),Q=[];e:{var X=Vm.get(o);if(X!==void 0){var ge=lf,ve=o;switch(o){case"keypress":if(Sc(d)===0)break e;case"keydown":case"keyup":ge=hE;break;case"focusin":ve="focus",ge=uf;break;case"focusout":ve="blur",ge=uf;break;case"beforeblur":case"afterblur":ge=uf;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=Cm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=tE;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=mE;break;case Ym:case zm:case jm:ge=oE;break;case Xm:ge=SE;break;case"scroll":ge=JT;break;case"wheel":ge=AE;break;case"copy":case"cut":case"paste":ge=sE;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=wm}var Te=(r&4)!==0,Tt=!Te&&o==="scroll",G=Te?X!==null?X+"Capture":null:X;Te=[];for(var L=x,$;L!==null;){$=L;var J=$.stateNode;if($.tag===5&&J!==null&&($=J,G!==null&&(J=Ta(L,G),J!=null&&Te.push($a(L,J,$)))),Tt)break;L=L.return}0<Te.length&&(X=new ge(X,ve,null,d,q),Q.push({event:X,listeners:Te}))}}if((r&7)===0){e:{if(X=o==="mouseover"||o==="pointerover",ge=o==="mouseout"||o==="pointerout",X&&d!==ju&&(ve=d.relatedTarget||d.fromElement)&&(sr(ve)||ve[Hi]))break e;if((ge||X)&&(X=q.window===q?q:(X=q.ownerDocument)?X.defaultView||X.parentWindow:window,ge?(ve=d.relatedTarget||d.toElement,ge=x,ve=ve?sr(ve):null,ve!==null&&(Tt=rr(ve),ve!==Tt||ve.tag!==5&&ve.tag!==6)&&(ve=null)):(ge=null,ve=x),ge!==ve)){if(Te=Cm,J="onMouseLeave",G="onMouseEnter",L="mouse",(o==="pointerout"||o==="pointerover")&&(Te=wm,J="onPointerLeave",G="onPointerEnter",L="pointer"),Tt=ge==null?X:ls(ge),$=ve==null?X:ls(ve),X=new Te(J,L+"leave",ge,d,q),X.target=Tt,X.relatedTarget=$,J=null,sr(q)===x&&(Te=new Te(G,L+"enter",ve,d,q),Te.target=$,Te.relatedTarget=Tt,J=Te),Tt=J,ge&&ve)t:{for(Te=ge,G=ve,L=0,$=Te;$;$=ss($))L++;for($=0,J=G;J;J=ss(J))$++;for(;0<L-$;)Te=ss(Te),L--;for(;0<$-L;)G=ss(G),$--;for(;L--;){if(Te===G||G!==null&&Te===G.alternate)break t;Te=ss(Te),G=ss(G)}Te=null}else Te=null;ge!==null&&Jm(Q,X,ge,Te,!1),ve!==null&&Tt!==null&&Jm(Q,Tt,ve,Te,!0)}}e:{if(X=x?ls(x):window,ge=X.nodeName&&X.nodeName.toLowerCase(),ge==="select"||ge==="input"&&X.type==="file")var we=RE;else if(Om(X))if(bm)we=ME;else{we=DE;var ke=PE}else(ge=X.nodeName)&&ge.toLowerCase()==="input"&&(X.type==="checkbox"||X.type==="radio")&&(we=NE);if(we&&(we=we(o,x))){km(Q,we,d,q);break e}ke&&ke(o,X,x),o==="focusout"&&(ke=X._wrapperState)&&ke.controlled&&X.type==="number"&&yi(X,"number",X.value)}switch(ke=x?ls(x):window,o){case"focusin":(Om(ke)||ke.contentEditable==="true")&&(os=ke,yf=x,Ua=null);break;case"focusout":Ua=yf=os=null;break;case"mousedown":Sf=!0;break;case"contextmenu":case"mouseup":case"dragend":Sf=!1,xm(Q,d,q);break;case"selectionchange":if(bE)break;case"keydown":case"keyup":xm(Q,d,q)}var be;if(hf)e:{switch(o){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else is?Nm(o,d)&&(He="onCompositionEnd"):o==="keydown"&&d.keyCode===229&&(He="onCompositionStart");He&&(Rm&&d.locale!=="ko"&&(is||He!=="onCompositionStart"?He==="onCompositionEnd"&&is&&(be=Tm()):(yo=q,af="value"in yo?yo.value:yo.textContent,is=!0)),ke=_c(x,He),0<ke.length&&(He=new _m(He,o,null,d,q),Q.push({event:He,listeners:ke}),be?He.data=be:(be=Mm(d),be!==null&&(He.data=be)))),(be=TE?EE(o,d):CE(o,d))&&(x=_c(x,"onBeforeInput"),0<x.length&&(q=new _m("onBeforeInput","beforeinput",null,d,q),Q.push({event:q,listeners:x}),q.data=be))}Zm(Q,r)})}function $a(o,r,d){return{instance:o,listener:r,currentTarget:d}}function _c(o,r){for(var d=r+"Capture",h=[];o!==null;){var p=o,y=p.stateNode;p.tag===5&&y!==null&&(p=y,y=Ta(o,d),y!=null&&h.unshift($a(o,y,p)),y=Ta(o,r),y!=null&&h.push($a(o,y,p))),o=o.return}return h}function ss(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function Jm(o,r,d,h,p){for(var y=r._reactName,E=[];d!==null&&d!==h;){var D=d,k=D.alternate,x=D.stateNode;if(k!==null&&k===h)break;D.tag===5&&x!==null&&(D=x,p?(k=Ta(d,y),k!=null&&E.unshift($a(d,k,D))):p||(k=Ta(d,y),k!=null&&E.push($a(d,k,D)))),d=d.return}E.length!==0&&o.push({event:r,listeners:E})}var UE=/\r\n?/g,HE=/\u0000|\uFFFD/g;function e0(o){return(typeof o=="string"?o:""+o).replace(UE,`
`).replace(HE,"")}function wc(o,r,d){if(r=e0(r),e0(o)!==r&&d)throw Error(n(425))}function Rc(){}var Cf=null,_f=null;function wf(o,r){return o==="textarea"||o==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Rf=typeof setTimeout=="function"?setTimeout:void 0,GE=typeof clearTimeout=="function"?clearTimeout:void 0,t0=typeof Promise=="function"?Promise:void 0,$E=typeof queueMicrotask=="function"?queueMicrotask:typeof t0<"u"?function(o){return t0.resolve(null).then(o).catch(xE)}:Rf;function xE(o){setTimeout(function(){throw o})}function Pf(o,r){var d=r,h=0;do{var p=d.nextSibling;if(o.removeChild(d),p&&p.nodeType===8)if(d=p.data,d==="/$"){if(h===0){o.removeChild(p),Ma(r);return}h--}else d!=="$"&&d!=="$?"&&d!=="$!"||h++;d=p}while(d);Ma(r)}function vo(o){for(;o!=null;o=o.nextSibling){var r=o.nodeType;if(r===1||r===3)break;if(r===8){if(r=o.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return o}function n0(o){o=o.previousSibling;for(var r=0;o;){if(o.nodeType===8){var d=o.data;if(d==="$"||d==="$!"||d==="$?"){if(r===0)return o;r--}else d==="/$"&&r++}o=o.previousSibling}return null}var as=Math.random().toString(36).slice(2),Ai="__reactFiber$"+as,xa="__reactProps$"+as,Hi="__reactContainer$"+as,Df="__reactEvents$"+as,WE="__reactListeners$"+as,YE="__reactHandles$"+as;function sr(o){var r=o[Ai];if(r)return r;for(var d=o.parentNode;d;){if(r=d[Hi]||d[Ai]){if(d=r.alternate,r.child!==null||d!==null&&d.child!==null)for(o=n0(o);o!==null;){if(d=o[Ai])return d;o=n0(o)}return r}o=d,d=o.parentNode}return null}function Wa(o){return o=o[Ai]||o[Hi],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function ls(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(n(33))}function Pc(o){return o[xa]||null}var Nf=[],cs=-1;function Ao(o){return{current:o}}function ct(o){0>cs||(o.current=Nf[cs],Nf[cs]=null,cs--)}function st(o,r){cs++,Nf[cs]=o.current,o.current=r}var Io={},Qt=Ao(Io),Tn=Ao(!1),ar=Io;function ds(o,r){var d=o.type.contextTypes;if(!d)return Io;var h=o.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===r)return h.__reactInternalMemoizedMaskedChildContext;var p={},y;for(y in d)p[y]=r[y];return h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=r,o.__reactInternalMemoizedMaskedChildContext=p),p}function En(o){return o=o.childContextTypes,o!=null}function Dc(){ct(Tn),ct(Qt)}function i0(o,r,d){if(Qt.current!==Io)throw Error(n(168));st(Qt,r),st(Tn,d)}function o0(o,r,d){var h=o.stateNode;if(r=r.childContextTypes,typeof h.getChildContext!="function")return d;h=h.getChildContext();for(var p in h)if(!(p in r))throw Error(n(108,Oe(o)||"Unknown",p));return K({},d,h)}function Nc(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||Io,ar=Qt.current,st(Qt,o),st(Tn,Tn.current),!0}function r0(o,r,d){var h=o.stateNode;if(!h)throw Error(n(169));d?(o=o0(o,r,ar),h.__reactInternalMemoizedMergedChildContext=o,ct(Tn),ct(Qt),st(Qt,o)):ct(Tn),st(Tn,d)}var Gi=null,Mc=!1,Mf=!1;function s0(o){Gi===null?Gi=[o]:Gi.push(o)}function zE(o){Mc=!0,s0(o)}function To(){if(!Mf&&Gi!==null){Mf=!0;var o=0,r=tt;try{var d=Gi;for(tt=1;o<d.length;o++){var h=d[o];do h=h(!0);while(h!==null)}Gi=null,Mc=!1}catch(p){throw Gi!==null&&(Gi=Gi.slice(o+1)),lm(Qu,To),p}finally{tt=r,Mf=!1}}return null}var us=[],fs=0,Oc=null,kc=0,zn=[],jn=0,lr=null,$i=1,xi="";function cr(o,r){us[fs++]=kc,us[fs++]=Oc,Oc=o,kc=r}function a0(o,r,d){zn[jn++]=$i,zn[jn++]=xi,zn[jn++]=lr,lr=o;var h=$i;o=xi;var p=32-ri(h)-1;h&=~(1<<p),d+=1;var y=32-ri(r)+p;if(30<y){var E=p-p%5;y=(h&(1<<E)-1).toString(32),h>>=E,p-=E,$i=1<<32-ri(r)+p|d<<p|h,xi=y+o}else $i=1<<y|d<<p|h,xi=o}function Of(o){o.return!==null&&(cr(o,1),a0(o,1,0))}function kf(o){for(;o===Oc;)Oc=us[--fs],us[fs]=null,kc=us[--fs],us[fs]=null;for(;o===lr;)lr=zn[--jn],zn[jn]=null,xi=zn[--jn],zn[jn]=null,$i=zn[--jn],zn[jn]=null}var kn=null,bn=null,ut=!1,ai=null;function l0(o,r){var d=qn(5,null,null,0);d.elementType="DELETED",d.stateNode=r,d.return=o,r=o.deletions,r===null?(o.deletions=[d],o.flags|=16):r.push(d)}function c0(o,r){switch(o.tag){case 5:var d=o.type;return r=r.nodeType!==1||d.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(o.stateNode=r,kn=o,bn=vo(r.firstChild),!0):!1;case 6:return r=o.pendingProps===""||r.nodeType!==3?null:r,r!==null?(o.stateNode=r,kn=o,bn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(d=lr!==null?{id:$i,overflow:xi}:null,o.memoizedState={dehydrated:r,treeContext:d,retryLane:1073741824},d=qn(18,null,null,0),d.stateNode=r,d.return=o,o.child=d,kn=o,bn=null,!0):!1;default:return!1}}function bf(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Bf(o){if(ut){var r=bn;if(r){var d=r;if(!c0(o,r)){if(bf(o))throw Error(n(418));r=vo(d.nextSibling);var h=kn;r&&c0(o,r)?l0(h,d):(o.flags=o.flags&-4097|2,ut=!1,kn=o)}}else{if(bf(o))throw Error(n(418));o.flags=o.flags&-4097|2,ut=!1,kn=o}}}function d0(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;kn=o}function bc(o){if(o!==kn)return!1;if(!ut)return d0(o),ut=!0,!1;var r;if((r=o.tag!==3)&&!(r=o.tag!==5)&&(r=o.type,r=r!=="head"&&r!=="body"&&!wf(o.type,o.memoizedProps)),r&&(r=bn)){if(bf(o))throw u0(),Error(n(418));for(;r;)l0(o,r),r=vo(r.nextSibling)}if(d0(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,r=0;o;){if(o.nodeType===8){var d=o.data;if(d==="/$"){if(r===0){bn=vo(o.nextSibling);break e}r--}else d!=="$"&&d!=="$!"&&d!=="$?"||r++}o=o.nextSibling}bn=null}}else bn=kn?vo(o.stateNode.nextSibling):null;return!0}function u0(){for(var o=bn;o;)o=vo(o.nextSibling)}function hs(){bn=kn=null,ut=!1}function Ff(o){ai===null?ai=[o]:ai.push(o)}var jE=B.ReactCurrentBatchConfig;function Ya(o,r,d){if(o=d.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(n(309));var h=d.stateNode}if(!h)throw Error(n(147,o));var p=h,y=""+o;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===y?r.ref:(r=function(E){var D=p.refs;E===null?delete D[y]:D[y]=E},r._stringRef=y,r)}if(typeof o!="string")throw Error(n(284));if(!d._owner)throw Error(n(290,o))}return o}function Bc(o,r){throw o=Object.prototype.toString.call(r),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o))}function f0(o){var r=o._init;return r(o._payload)}function h0(o){function r(G,L){if(o){var $=G.deletions;$===null?(G.deletions=[L],G.flags|=16):$.push(L)}}function d(G,L){if(!o)return null;for(;L!==null;)r(G,L),L=L.sibling;return null}function h(G,L){for(G=new Map;L!==null;)L.key!==null?G.set(L.key,L):G.set(L.index,L),L=L.sibling;return G}function p(G,L){return G=No(G,L),G.index=0,G.sibling=null,G}function y(G,L,$){return G.index=$,o?($=G.alternate,$!==null?($=$.index,$<L?(G.flags|=2,L):$):(G.flags|=2,L)):(G.flags|=1048576,L)}function E(G){return o&&G.alternate===null&&(G.flags|=2),G}function D(G,L,$,J){return L===null||L.tag!==6?(L=Rh($,G.mode,J),L.return=G,L):(L=p(L,$),L.return=G,L)}function k(G,L,$,J){var we=$.type;return we===M?q(G,L,$.props.children,J,$.key):L!==null&&(L.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===fe&&f0(we)===L.type)?(J=p(L,$.props),J.ref=Ya(G,L,$),J.return=G,J):(J=rd($.type,$.key,$.props,null,G.mode,J),J.ref=Ya(G,L,$),J.return=G,J)}function x(G,L,$,J){return L===null||L.tag!==4||L.stateNode.containerInfo!==$.containerInfo||L.stateNode.implementation!==$.implementation?(L=Ph($,G.mode,J),L.return=G,L):(L=p(L,$.children||[]),L.return=G,L)}function q(G,L,$,J,we){return L===null||L.tag!==7?(L=yr($,G.mode,J,we),L.return=G,L):(L=p(L,$),L.return=G,L)}function Q(G,L,$){if(typeof L=="string"&&L!==""||typeof L=="number")return L=Rh(""+L,G.mode,$),L.return=G,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case O:return $=rd(L.type,L.key,L.props,null,G.mode,$),$.ref=Ya(G,null,L),$.return=G,$;case N:return L=Ph(L,G.mode,$),L.return=G,L;case fe:var J=L._init;return Q(G,J(L._payload),$)}if(Si(L)||V(L))return L=yr(L,G.mode,$,null),L.return=G,L;Bc(G,L)}return null}function X(G,L,$,J){var we=L!==null?L.key:null;if(typeof $=="string"&&$!==""||typeof $=="number")return we!==null?null:D(G,L,""+$,J);if(typeof $=="object"&&$!==null){switch($.$$typeof){case O:return $.key===we?k(G,L,$,J):null;case N:return $.key===we?x(G,L,$,J):null;case fe:return we=$._init,X(G,L,we($._payload),J)}if(Si($)||V($))return we!==null?null:q(G,L,$,J,null);Bc(G,$)}return null}function ge(G,L,$,J,we){if(typeof J=="string"&&J!==""||typeof J=="number")return G=G.get($)||null,D(L,G,""+J,we);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case O:return G=G.get(J.key===null?$:J.key)||null,k(L,G,J,we);case N:return G=G.get(J.key===null?$:J.key)||null,x(L,G,J,we);case fe:var ke=J._init;return ge(G,L,$,ke(J._payload),we)}if(Si(J)||V(J))return G=G.get($)||null,q(L,G,J,we,null);Bc(L,J)}return null}function ve(G,L,$,J){for(var we=null,ke=null,be=L,He=L=0,Ft=null;be!==null&&He<$.length;He++){be.index>He?(Ft=be,be=null):Ft=be.sibling;var Ze=X(G,be,$[He],J);if(Ze===null){be===null&&(be=Ft);break}o&&be&&Ze.alternate===null&&r(G,be),L=y(Ze,L,He),ke===null?we=Ze:ke.sibling=Ze,ke=Ze,be=Ft}if(He===$.length)return d(G,be),ut&&cr(G,He),we;if(be===null){for(;He<$.length;He++)be=Q(G,$[He],J),be!==null&&(L=y(be,L,He),ke===null?we=be:ke.sibling=be,ke=be);return ut&&cr(G,He),we}for(be=h(G,be);He<$.length;He++)Ft=ge(be,G,He,$[He],J),Ft!==null&&(o&&Ft.alternate!==null&&be.delete(Ft.key===null?He:Ft.key),L=y(Ft,L,He),ke===null?we=Ft:ke.sibling=Ft,ke=Ft);return o&&be.forEach(function(Mo){return r(G,Mo)}),ut&&cr(G,He),we}function Te(G,L,$,J){var we=V($);if(typeof we!="function")throw Error(n(150));if($=we.call($),$==null)throw Error(n(151));for(var ke=we=null,be=L,He=L=0,Ft=null,Ze=$.next();be!==null&&!Ze.done;He++,Ze=$.next()){be.index>He?(Ft=be,be=null):Ft=be.sibling;var Mo=X(G,be,Ze.value,J);if(Mo===null){be===null&&(be=Ft);break}o&&be&&Mo.alternate===null&&r(G,be),L=y(Mo,L,He),ke===null?we=Mo:ke.sibling=Mo,ke=Mo,be=Ft}if(Ze.done)return d(G,be),ut&&cr(G,He),we;if(be===null){for(;!Ze.done;He++,Ze=$.next())Ze=Q(G,Ze.value,J),Ze!==null&&(L=y(Ze,L,He),ke===null?we=Ze:ke.sibling=Ze,ke=Ze);return ut&&cr(G,He),we}for(be=h(G,be);!Ze.done;He++,Ze=$.next())Ze=ge(be,G,He,Ze.value,J),Ze!==null&&(o&&Ze.alternate!==null&&be.delete(Ze.key===null?He:Ze.key),L=y(Ze,L,He),ke===null?we=Ze:ke.sibling=Ze,ke=Ze);return o&&be.forEach(function(_C){return r(G,_C)}),ut&&cr(G,He),we}function Tt(G,L,$,J){if(typeof $=="object"&&$!==null&&$.type===M&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case O:e:{for(var we=$.key,ke=L;ke!==null;){if(ke.key===we){if(we=$.type,we===M){if(ke.tag===7){d(G,ke.sibling),L=p(ke,$.props.children),L.return=G,G=L;break e}}else if(ke.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===fe&&f0(we)===ke.type){d(G,ke.sibling),L=p(ke,$.props),L.ref=Ya(G,ke,$),L.return=G,G=L;break e}d(G,ke);break}else r(G,ke);ke=ke.sibling}$.type===M?(L=yr($.props.children,G.mode,J,$.key),L.return=G,G=L):(J=rd($.type,$.key,$.props,null,G.mode,J),J.ref=Ya(G,L,$),J.return=G,G=J)}return E(G);case N:e:{for(ke=$.key;L!==null;){if(L.key===ke)if(L.tag===4&&L.stateNode.containerInfo===$.containerInfo&&L.stateNode.implementation===$.implementation){d(G,L.sibling),L=p(L,$.children||[]),L.return=G,G=L;break e}else{d(G,L);break}else r(G,L);L=L.sibling}L=Ph($,G.mode,J),L.return=G,G=L}return E(G);case fe:return ke=$._init,Tt(G,L,ke($._payload),J)}if(Si($))return ve(G,L,$,J);if(V($))return Te(G,L,$,J);Bc(G,$)}return typeof $=="string"&&$!==""||typeof $=="number"?($=""+$,L!==null&&L.tag===6?(d(G,L.sibling),L=p(L,$),L.return=G,G=L):(d(G,L),L=Rh($,G.mode,J),L.return=G,G=L),E(G)):d(G,L)}return Tt}var gs=h0(!0),g0=h0(!1),Fc=Ao(null),Lc=null,ps=null,Lf=null;function Uf(){Lf=ps=Lc=null}function Hf(o){var r=Fc.current;ct(Fc),o._currentValue=r}function Gf(o,r,d){for(;o!==null;){var h=o.alternate;if((o.childLanes&r)!==r?(o.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),o===d)break;o=o.return}}function ms(o,r){Lc=o,Lf=ps=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&r)!==0&&(Cn=!0),o.firstContext=null)}function Xn(o){var r=o._currentValue;if(Lf!==o)if(o={context:o,memoizedValue:r,next:null},ps===null){if(Lc===null)throw Error(n(308));ps=o,Lc.dependencies={lanes:0,firstContext:o}}else ps=ps.next=o;return r}var dr=null;function $f(o){dr===null?dr=[o]:dr.push(o)}function p0(o,r,d,h){var p=r.interleaved;return p===null?(d.next=d,$f(r)):(d.next=p.next,p.next=d),r.interleaved=d,Wi(o,h)}function Wi(o,r){o.lanes|=r;var d=o.alternate;for(d!==null&&(d.lanes|=r),d=o,o=o.return;o!==null;)o.childLanes|=r,d=o.alternate,d!==null&&(d.childLanes|=r),d=o,o=o.return;return d.tag===3?d.stateNode:null}var Eo=!1;function xf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function m0(o,r){o=o.updateQueue,r.updateQueue===o&&(r.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Yi(o,r){return{eventTime:o,lane:r,tag:0,payload:null,callback:null,next:null}}function Co(o,r,d){var h=o.updateQueue;if(h===null)return null;if(h=h.shared,(Ve&2)!==0){var p=h.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),h.pending=r,Wi(o,d)}return p=h.interleaved,p===null?(r.next=r,$f(h)):(r.next=p.next,p.next=r),h.interleaved=r,Wi(o,d)}function Uc(o,r,d){if(r=r.updateQueue,r!==null&&(r=r.shared,(d&4194240)!==0)){var h=r.lanes;h&=o.pendingLanes,d|=h,r.lanes=d,tf(o,d)}}function y0(o,r){var d=o.updateQueue,h=o.alternate;if(h!==null&&(h=h.updateQueue,d===h)){var p=null,y=null;if(d=d.firstBaseUpdate,d!==null){do{var E={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};y===null?p=y=E:y=y.next=E,d=d.next}while(d!==null);y===null?p=y=r:y=y.next=r}else p=y=r;d={baseState:h.baseState,firstBaseUpdate:p,lastBaseUpdate:y,shared:h.shared,effects:h.effects},o.updateQueue=d;return}o=d.lastBaseUpdate,o===null?d.firstBaseUpdate=r:o.next=r,d.lastBaseUpdate=r}function Hc(o,r,d,h){var p=o.updateQueue;Eo=!1;var y=p.firstBaseUpdate,E=p.lastBaseUpdate,D=p.shared.pending;if(D!==null){p.shared.pending=null;var k=D,x=k.next;k.next=null,E===null?y=x:E.next=x,E=k;var q=o.alternate;q!==null&&(q=q.updateQueue,D=q.lastBaseUpdate,D!==E&&(D===null?q.firstBaseUpdate=x:D.next=x,q.lastBaseUpdate=k))}if(y!==null){var Q=p.baseState;E=0,q=x=k=null,D=y;do{var X=D.lane,ge=D.eventTime;if((h&X)===X){q!==null&&(q=q.next={eventTime:ge,lane:0,tag:D.tag,payload:D.payload,callback:D.callback,next:null});e:{var ve=o,Te=D;switch(X=r,ge=d,Te.tag){case 1:if(ve=Te.payload,typeof ve=="function"){Q=ve.call(ge,Q,X);break e}Q=ve;break e;case 3:ve.flags=ve.flags&-65537|128;case 0:if(ve=Te.payload,X=typeof ve=="function"?ve.call(ge,Q,X):ve,X==null)break e;Q=K({},Q,X);break e;case 2:Eo=!0}}D.callback!==null&&D.lane!==0&&(o.flags|=64,X=p.effects,X===null?p.effects=[D]:X.push(D))}else ge={eventTime:ge,lane:X,tag:D.tag,payload:D.payload,callback:D.callback,next:null},q===null?(x=q=ge,k=Q):q=q.next=ge,E|=X;if(D=D.next,D===null){if(D=p.shared.pending,D===null)break;X=D,D=X.next,X.next=null,p.lastBaseUpdate=X,p.shared.pending=null}}while(!0);if(q===null&&(k=Q),p.baseState=k,p.firstBaseUpdate=x,p.lastBaseUpdate=q,r=p.shared.interleaved,r!==null){p=r;do E|=p.lane,p=p.next;while(p!==r)}else y===null&&(p.shared.lanes=0);hr|=E,o.lanes=E,o.memoizedState=Q}}function S0(o,r,d){if(o=r.effects,r.effects=null,o!==null)for(r=0;r<o.length;r++){var h=o[r],p=h.callback;if(p!==null){if(h.callback=null,h=d,typeof p!="function")throw Error(n(191,p));p.call(h)}}}var za={},Ii=Ao(za),ja=Ao(za),Xa=Ao(za);function ur(o){if(o===za)throw Error(n(174));return o}function Wf(o,r){switch(st(Xa,r),st(ja,o),st(Ii,za),o=r.nodeType,o){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Wu(null,"");break;default:o=o===8?r.parentNode:r,r=o.namespaceURI||null,o=o.tagName,r=Wu(r,o)}ct(Ii),st(Ii,r)}function ys(){ct(Ii),ct(ja),ct(Xa)}function v0(o){ur(Xa.current);var r=ur(Ii.current),d=Wu(r,o.type);r!==d&&(st(ja,o),st(Ii,d))}function Yf(o){ja.current===o&&(ct(Ii),ct(ja))}var gt=Ao(0);function Gc(o){for(var r=o;r!==null;){if(r.tag===13){var d=r.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var zf=[];function jf(){for(var o=0;o<zf.length;o++)zf[o]._workInProgressVersionPrimary=null;zf.length=0}var $c=B.ReactCurrentDispatcher,Xf=B.ReactCurrentBatchConfig,fr=0,pt=null,Nt=null,bt=null,xc=!1,Va=!1,Ka=0,XE=0;function Jt(){throw Error(n(321))}function Vf(o,r){if(r===null)return!1;for(var d=0;d<r.length&&d<o.length;d++)if(!si(o[d],r[d]))return!1;return!0}function Kf(o,r,d,h,p,y){if(fr=y,pt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,$c.current=o===null||o.memoizedState===null?ZE:QE,o=d(h,p),Va){y=0;do{if(Va=!1,Ka=0,25<=y)throw Error(n(301));y+=1,bt=Nt=null,r.updateQueue=null,$c.current=JE,o=d(h,p)}while(Va)}if($c.current=zc,r=Nt!==null&&Nt.next!==null,fr=0,bt=Nt=pt=null,xc=!1,r)throw Error(n(300));return o}function qf(){var o=Ka!==0;return Ka=0,o}function Ti(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return bt===null?pt.memoizedState=bt=o:bt=bt.next=o,bt}function Vn(){if(Nt===null){var o=pt.alternate;o=o!==null?o.memoizedState:null}else o=Nt.next;var r=bt===null?pt.memoizedState:bt.next;if(r!==null)bt=r,Nt=o;else{if(o===null)throw Error(n(310));Nt=o,o={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},bt===null?pt.memoizedState=bt=o:bt=bt.next=o}return bt}function qa(o,r){return typeof r=="function"?r(o):r}function Zf(o){var r=Vn(),d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var h=Nt,p=h.baseQueue,y=d.pending;if(y!==null){if(p!==null){var E=p.next;p.next=y.next,y.next=E}h.baseQueue=p=y,d.pending=null}if(p!==null){y=p.next,h=h.baseState;var D=E=null,k=null,x=y;do{var q=x.lane;if((fr&q)===q)k!==null&&(k=k.next={lane:0,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null}),h=x.hasEagerState?x.eagerState:o(h,x.action);else{var Q={lane:q,action:x.action,hasEagerState:x.hasEagerState,eagerState:x.eagerState,next:null};k===null?(D=k=Q,E=h):k=k.next=Q,pt.lanes|=q,hr|=q}x=x.next}while(x!==null&&x!==y);k===null?E=h:k.next=D,si(h,r.memoizedState)||(Cn=!0),r.memoizedState=h,r.baseState=E,r.baseQueue=k,d.lastRenderedState=h}if(o=d.interleaved,o!==null){p=o;do y=p.lane,pt.lanes|=y,hr|=y,p=p.next;while(p!==o)}else p===null&&(d.lanes=0);return[r.memoizedState,d.dispatch]}function Qf(o){var r=Vn(),d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var h=d.dispatch,p=d.pending,y=r.memoizedState;if(p!==null){d.pending=null;var E=p=p.next;do y=o(y,E.action),E=E.next;while(E!==p);si(y,r.memoizedState)||(Cn=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),d.lastRenderedState=y}return[y,h]}function A0(){}function I0(o,r){var d=pt,h=Vn(),p=r(),y=!si(h.memoizedState,p);if(y&&(h.memoizedState=p,Cn=!0),h=h.queue,Jf(C0.bind(null,d,h,o),[o]),h.getSnapshot!==r||y||bt!==null&&bt.memoizedState.tag&1){if(d.flags|=2048,Za(9,E0.bind(null,d,h,p,r),void 0,null),Bt===null)throw Error(n(349));(fr&30)!==0||T0(d,r,p)}return p}function T0(o,r,d){o.flags|=16384,o={getSnapshot:r,value:d},r=pt.updateQueue,r===null?(r={lastEffect:null,stores:null},pt.updateQueue=r,r.stores=[o]):(d=r.stores,d===null?r.stores=[o]:d.push(o))}function E0(o,r,d,h){r.value=d,r.getSnapshot=h,_0(r)&&w0(o)}function C0(o,r,d){return d(function(){_0(r)&&w0(o)})}function _0(o){var r=o.getSnapshot;o=o.value;try{var d=r();return!si(o,d)}catch{return!0}}function w0(o){var r=Wi(o,1);r!==null&&ui(r,o,1,-1)}function R0(o){var r=Ti();return typeof o=="function"&&(o=o()),r.memoizedState=r.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:qa,lastRenderedState:o},r.queue=o,o=o.dispatch=qE.bind(null,pt,o),[r.memoizedState,o]}function Za(o,r,d,h){return o={tag:o,create:r,destroy:d,deps:h,next:null},r=pt.updateQueue,r===null?(r={lastEffect:null,stores:null},pt.updateQueue=r,r.lastEffect=o.next=o):(d=r.lastEffect,d===null?r.lastEffect=o.next=o:(h=d.next,d.next=o,o.next=h,r.lastEffect=o)),o}function P0(){return Vn().memoizedState}function Wc(o,r,d,h){var p=Ti();pt.flags|=o,p.memoizedState=Za(1|r,d,void 0,h===void 0?null:h)}function Yc(o,r,d,h){var p=Vn();h=h===void 0?null:h;var y=void 0;if(Nt!==null){var E=Nt.memoizedState;if(y=E.destroy,h!==null&&Vf(h,E.deps)){p.memoizedState=Za(r,d,y,h);return}}pt.flags|=o,p.memoizedState=Za(1|r,d,y,h)}function D0(o,r){return Wc(8390656,8,o,r)}function Jf(o,r){return Yc(2048,8,o,r)}function N0(o,r){return Yc(4,2,o,r)}function M0(o,r){return Yc(4,4,o,r)}function O0(o,r){if(typeof r=="function")return o=o(),r(o),function(){r(null)};if(r!=null)return o=o(),r.current=o,function(){r.current=null}}function k0(o,r,d){return d=d!=null?d.concat([o]):null,Yc(4,4,O0.bind(null,r,o),d)}function eh(){}function b0(o,r){var d=Vn();r=r===void 0?null:r;var h=d.memoizedState;return h!==null&&r!==null&&Vf(r,h[1])?h[0]:(d.memoizedState=[o,r],o)}function B0(o,r){var d=Vn();r=r===void 0?null:r;var h=d.memoizedState;return h!==null&&r!==null&&Vf(r,h[1])?h[0]:(o=o(),d.memoizedState=[o,r],o)}function F0(o,r,d){return(fr&21)===0?(o.baseState&&(o.baseState=!1,Cn=!0),o.memoizedState=d):(si(d,r)||(d=fm(),pt.lanes|=d,hr|=d,o.baseState=!0),r)}function VE(o,r){var d=tt;tt=d!==0&&4>d?d:4,o(!0);var h=Xf.transition;Xf.transition={};try{o(!1),r()}finally{tt=d,Xf.transition=h}}function L0(){return Vn().memoizedState}function KE(o,r,d){var h=Po(o);if(d={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null},U0(o))H0(r,d);else if(d=p0(o,r,d,h),d!==null){var p=un();ui(d,o,h,p),G0(d,r,h)}}function qE(o,r,d){var h=Po(o),p={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null};if(U0(o))H0(r,p);else{var y=o.alternate;if(o.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var E=r.lastRenderedState,D=y(E,d);if(p.hasEagerState=!0,p.eagerState=D,si(D,E)){var k=r.interleaved;k===null?(p.next=p,$f(r)):(p.next=k.next,k.next=p),r.interleaved=p;return}}catch{}finally{}d=p0(o,r,p,h),d!==null&&(p=un(),ui(d,o,h,p),G0(d,r,h))}}function U0(o){var r=o.alternate;return o===pt||r!==null&&r===pt}function H0(o,r){Va=xc=!0;var d=o.pending;d===null?r.next=r:(r.next=d.next,d.next=r),o.pending=r}function G0(o,r,d){if((d&4194240)!==0){var h=r.lanes;h&=o.pendingLanes,d|=h,r.lanes=d,tf(o,d)}}var zc={readContext:Xn,useCallback:Jt,useContext:Jt,useEffect:Jt,useImperativeHandle:Jt,useInsertionEffect:Jt,useLayoutEffect:Jt,useMemo:Jt,useReducer:Jt,useRef:Jt,useState:Jt,useDebugValue:Jt,useDeferredValue:Jt,useTransition:Jt,useMutableSource:Jt,useSyncExternalStore:Jt,useId:Jt,unstable_isNewReconciler:!1},ZE={readContext:Xn,useCallback:function(o,r){return Ti().memoizedState=[o,r===void 0?null:r],o},useContext:Xn,useEffect:D0,useImperativeHandle:function(o,r,d){return d=d!=null?d.concat([o]):null,Wc(4194308,4,O0.bind(null,r,o),d)},useLayoutEffect:function(o,r){return Wc(4194308,4,o,r)},useInsertionEffect:function(o,r){return Wc(4,2,o,r)},useMemo:function(o,r){var d=Ti();return r=r===void 0?null:r,o=o(),d.memoizedState=[o,r],o},useReducer:function(o,r,d){var h=Ti();return r=d!==void 0?d(r):r,h.memoizedState=h.baseState=r,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:r},h.queue=o,o=o.dispatch=KE.bind(null,pt,o),[h.memoizedState,o]},useRef:function(o){var r=Ti();return o={current:o},r.memoizedState=o},useState:R0,useDebugValue:eh,useDeferredValue:function(o){return Ti().memoizedState=o},useTransition:function(){var o=R0(!1),r=o[0];return o=VE.bind(null,o[1]),Ti().memoizedState=o,[r,o]},useMutableSource:function(){},useSyncExternalStore:function(o,r,d){var h=pt,p=Ti();if(ut){if(d===void 0)throw Error(n(407));d=d()}else{if(d=r(),Bt===null)throw Error(n(349));(fr&30)!==0||T0(h,r,d)}p.memoizedState=d;var y={value:d,getSnapshot:r};return p.queue=y,D0(C0.bind(null,h,y,o),[o]),h.flags|=2048,Za(9,E0.bind(null,h,y,d,r),void 0,null),d},useId:function(){var o=Ti(),r=Bt.identifierPrefix;if(ut){var d=xi,h=$i;d=(h&~(1<<32-ri(h)-1)).toString(32)+d,r=":"+r+"R"+d,d=Ka++,0<d&&(r+="H"+d.toString(32)),r+=":"}else d=XE++,r=":"+r+"r"+d.toString(32)+":";return o.memoizedState=r},unstable_isNewReconciler:!1},QE={readContext:Xn,useCallback:b0,useContext:Xn,useEffect:Jf,useImperativeHandle:k0,useInsertionEffect:N0,useLayoutEffect:M0,useMemo:B0,useReducer:Zf,useRef:P0,useState:function(){return Zf(qa)},useDebugValue:eh,useDeferredValue:function(o){var r=Vn();return F0(r,Nt.memoizedState,o)},useTransition:function(){var o=Zf(qa)[0],r=Vn().memoizedState;return[o,r]},useMutableSource:A0,useSyncExternalStore:I0,useId:L0,unstable_isNewReconciler:!1},JE={readContext:Xn,useCallback:b0,useContext:Xn,useEffect:Jf,useImperativeHandle:k0,useInsertionEffect:N0,useLayoutEffect:M0,useMemo:B0,useReducer:Qf,useRef:P0,useState:function(){return Qf(qa)},useDebugValue:eh,useDeferredValue:function(o){var r=Vn();return Nt===null?r.memoizedState=o:F0(r,Nt.memoizedState,o)},useTransition:function(){var o=Qf(qa)[0],r=Vn().memoizedState;return[o,r]},useMutableSource:A0,useSyncExternalStore:I0,useId:L0,unstable_isNewReconciler:!1};function li(o,r){if(o&&o.defaultProps){r=K({},r),o=o.defaultProps;for(var d in o)r[d]===void 0&&(r[d]=o[d]);return r}return r}function th(o,r,d,h){r=o.memoizedState,d=d(h,r),d=d==null?r:K({},r,d),o.memoizedState=d,o.lanes===0&&(o.updateQueue.baseState=d)}var jc={isMounted:function(o){return(o=o._reactInternals)?rr(o)===o:!1},enqueueSetState:function(o,r,d){o=o._reactInternals;var h=un(),p=Po(o),y=Yi(h,p);y.payload=r,d!=null&&(y.callback=d),r=Co(o,y,p),r!==null&&(ui(r,o,p,h),Uc(r,o,p))},enqueueReplaceState:function(o,r,d){o=o._reactInternals;var h=un(),p=Po(o),y=Yi(h,p);y.tag=1,y.payload=r,d!=null&&(y.callback=d),r=Co(o,y,p),r!==null&&(ui(r,o,p,h),Uc(r,o,p))},enqueueForceUpdate:function(o,r){o=o._reactInternals;var d=un(),h=Po(o),p=Yi(d,h);p.tag=2,r!=null&&(p.callback=r),r=Co(o,p,h),r!==null&&(ui(r,o,h,d),Uc(r,o,h))}};function $0(o,r,d,h,p,y,E){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(h,y,E):r.prototype&&r.prototype.isPureReactComponent?!La(d,h)||!La(p,y):!0}function x0(o,r,d){var h=!1,p=Io,y=r.contextType;return typeof y=="object"&&y!==null?y=Xn(y):(p=En(r)?ar:Qt.current,h=r.contextTypes,y=(h=h!=null)?ds(o,p):Io),r=new r(d,y),o.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=jc,o.stateNode=r,r._reactInternals=o,h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=p,o.__reactInternalMemoizedMaskedChildContext=y),r}function W0(o,r,d,h){o=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(d,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(d,h),r.state!==o&&jc.enqueueReplaceState(r,r.state,null)}function nh(o,r,d,h){var p=o.stateNode;p.props=d,p.state=o.memoizedState,p.refs={},xf(o);var y=r.contextType;typeof y=="object"&&y!==null?p.context=Xn(y):(y=En(r)?ar:Qt.current,p.context=ds(o,y)),p.state=o.memoizedState,y=r.getDerivedStateFromProps,typeof y=="function"&&(th(o,r,y,d),p.state=o.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(r=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),r!==p.state&&jc.enqueueReplaceState(p,p.state,null),Hc(o,d,p,h),p.state=o.memoizedState),typeof p.componentDidMount=="function"&&(o.flags|=4194308)}function Ss(o,r){try{var d="",h=r;do d+=Pe(h),h=h.return;while(h);var p=d}catch(y){p=`
Error generating stack: `+y.message+`
`+y.stack}return{value:o,source:r,stack:p,digest:null}}function ih(o,r,d){return{value:o,source:null,stack:d??null,digest:r??null}}function oh(o,r){try{console.error(r.value)}catch(d){setTimeout(function(){throw d})}}var eC=typeof WeakMap=="function"?WeakMap:Map;function Y0(o,r,d){d=Yi(-1,d),d.tag=3,d.payload={element:null};var h=r.value;return d.callback=function(){Jc||(Jc=!0,vh=h),oh(o,r)},d}function z0(o,r,d){d=Yi(-1,d),d.tag=3;var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var p=r.value;d.payload=function(){return h(p)},d.callback=function(){oh(o,r)}}var y=o.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(d.callback=function(){oh(o,r),typeof h!="function"&&(wo===null?wo=new Set([this]):wo.add(this));var E=r.stack;this.componentDidCatch(r.value,{componentStack:E!==null?E:""})}),d}function j0(o,r,d){var h=o.pingCache;if(h===null){h=o.pingCache=new eC;var p=new Set;h.set(r,p)}else p=h.get(r),p===void 0&&(p=new Set,h.set(r,p));p.has(d)||(p.add(d),o=gC.bind(null,o,r,d),r.then(o,o))}function X0(o){do{var r;if((r=o.tag===13)&&(r=o.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return o;o=o.return}while(o!==null);return null}function V0(o,r,d,h,p){return(o.mode&1)===0?(o===r?o.flags|=65536:(o.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(r=Yi(-1,1),r.tag=2,Co(d,r,1))),d.lanes|=1),o):(o.flags|=65536,o.lanes=p,o)}var tC=B.ReactCurrentOwner,Cn=!1;function dn(o,r,d,h){r.child=o===null?g0(r,null,d,h):gs(r,o.child,d,h)}function K0(o,r,d,h,p){d=d.render;var y=r.ref;return ms(r,p),h=Kf(o,r,d,h,y,p),d=qf(),o!==null&&!Cn?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,zi(o,r,p)):(ut&&d&&Of(r),r.flags|=1,dn(o,r,h,p),r.child)}function q0(o,r,d,h,p){if(o===null){var y=d.type;return typeof y=="function"&&!wh(y)&&y.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(r.tag=15,r.type=y,Z0(o,r,y,h,p)):(o=rd(d.type,null,h,r,r.mode,p),o.ref=r.ref,o.return=r,r.child=o)}if(y=o.child,(o.lanes&p)===0){var E=y.memoizedProps;if(d=d.compare,d=d!==null?d:La,d(E,h)&&o.ref===r.ref)return zi(o,r,p)}return r.flags|=1,o=No(y,h),o.ref=r.ref,o.return=r,r.child=o}function Z0(o,r,d,h,p){if(o!==null){var y=o.memoizedProps;if(La(y,h)&&o.ref===r.ref)if(Cn=!1,r.pendingProps=h=y,(o.lanes&p)!==0)(o.flags&131072)!==0&&(Cn=!0);else return r.lanes=o.lanes,zi(o,r,p)}return rh(o,r,d,h,p)}function Q0(o,r,d){var h=r.pendingProps,p=h.children,y=o!==null?o.memoizedState:null;if(h.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},st(As,Bn),Bn|=d;else{if((d&1073741824)===0)return o=y!==null?y.baseLanes|d:d,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:o,cachePool:null,transitions:null},r.updateQueue=null,st(As,Bn),Bn|=o,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=y!==null?y.baseLanes:d,st(As,Bn),Bn|=h}else y!==null?(h=y.baseLanes|d,r.memoizedState=null):h=d,st(As,Bn),Bn|=h;return dn(o,r,p,d),r.child}function J0(o,r){var d=r.ref;(o===null&&d!==null||o!==null&&o.ref!==d)&&(r.flags|=512,r.flags|=2097152)}function rh(o,r,d,h,p){var y=En(d)?ar:Qt.current;return y=ds(r,y),ms(r,p),d=Kf(o,r,d,h,y,p),h=qf(),o!==null&&!Cn?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,zi(o,r,p)):(ut&&h&&Of(r),r.flags|=1,dn(o,r,d,p),r.child)}function ey(o,r,d,h,p){if(En(d)){var y=!0;Nc(r)}else y=!1;if(ms(r,p),r.stateNode===null)Vc(o,r),x0(r,d,h),nh(r,d,h,p),h=!0;else if(o===null){var E=r.stateNode,D=r.memoizedProps;E.props=D;var k=E.context,x=d.contextType;typeof x=="object"&&x!==null?x=Xn(x):(x=En(d)?ar:Qt.current,x=ds(r,x));var q=d.getDerivedStateFromProps,Q=typeof q=="function"||typeof E.getSnapshotBeforeUpdate=="function";Q||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(D!==h||k!==x)&&W0(r,E,h,x),Eo=!1;var X=r.memoizedState;E.state=X,Hc(r,h,E,p),k=r.memoizedState,D!==h||X!==k||Tn.current||Eo?(typeof q=="function"&&(th(r,d,q,h),k=r.memoizedState),(D=Eo||$0(r,d,D,h,X,k,x))?(Q||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(r.flags|=4194308)):(typeof E.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=k),E.props=h,E.state=k,E.context=x,h=D):(typeof E.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{E=r.stateNode,m0(o,r),D=r.memoizedProps,x=r.type===r.elementType?D:li(r.type,D),E.props=x,Q=r.pendingProps,X=E.context,k=d.contextType,typeof k=="object"&&k!==null?k=Xn(k):(k=En(d)?ar:Qt.current,k=ds(r,k));var ge=d.getDerivedStateFromProps;(q=typeof ge=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(D!==Q||X!==k)&&W0(r,E,h,k),Eo=!1,X=r.memoizedState,E.state=X,Hc(r,h,E,p);var ve=r.memoizedState;D!==Q||X!==ve||Tn.current||Eo?(typeof ge=="function"&&(th(r,d,ge,h),ve=r.memoizedState),(x=Eo||$0(r,d,x,h,X,ve,k)||!1)?(q||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(h,ve,k),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(h,ve,k)),typeof E.componentDidUpdate=="function"&&(r.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof E.componentDidUpdate!="function"||D===o.memoizedProps&&X===o.memoizedState||(r.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||D===o.memoizedProps&&X===o.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=ve),E.props=h,E.state=ve,E.context=k,h=x):(typeof E.componentDidUpdate!="function"||D===o.memoizedProps&&X===o.memoizedState||(r.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||D===o.memoizedProps&&X===o.memoizedState||(r.flags|=1024),h=!1)}return sh(o,r,d,h,y,p)}function sh(o,r,d,h,p,y){J0(o,r);var E=(r.flags&128)!==0;if(!h&&!E)return p&&r0(r,d,!1),zi(o,r,y);h=r.stateNode,tC.current=r;var D=E&&typeof d.getDerivedStateFromError!="function"?null:h.render();return r.flags|=1,o!==null&&E?(r.child=gs(r,o.child,null,y),r.child=gs(r,null,D,y)):dn(o,r,D,y),r.memoizedState=h.state,p&&r0(r,d,!0),r.child}function ty(o){var r=o.stateNode;r.pendingContext?i0(o,r.pendingContext,r.pendingContext!==r.context):r.context&&i0(o,r.context,!1),Wf(o,r.containerInfo)}function ny(o,r,d,h,p){return hs(),Ff(p),r.flags|=256,dn(o,r,d,h),r.child}var ah={dehydrated:null,treeContext:null,retryLane:0};function lh(o){return{baseLanes:o,cachePool:null,transitions:null}}function iy(o,r,d){var h=r.pendingProps,p=gt.current,y=!1,E=(r.flags&128)!==0,D;if((D=E)||(D=o!==null&&o.memoizedState===null?!1:(p&2)!==0),D?(y=!0,r.flags&=-129):(o===null||o.memoizedState!==null)&&(p|=1),st(gt,p&1),o===null)return Bf(r),o=r.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((r.mode&1)===0?r.lanes=1:o.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(E=h.children,o=h.fallback,y?(h=r.mode,y=r.child,E={mode:"hidden",children:E},(h&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=E):y=sd(E,h,0,null),o=yr(o,h,d,null),y.return=r,o.return=r,y.sibling=o,r.child=y,r.child.memoizedState=lh(d),r.memoizedState=ah,o):ch(r,E));if(p=o.memoizedState,p!==null&&(D=p.dehydrated,D!==null))return nC(o,r,E,h,D,p,d);if(y){y=h.fallback,E=r.mode,p=o.child,D=p.sibling;var k={mode:"hidden",children:h.children};return(E&1)===0&&r.child!==p?(h=r.child,h.childLanes=0,h.pendingProps=k,r.deletions=null):(h=No(p,k),h.subtreeFlags=p.subtreeFlags&14680064),D!==null?y=No(D,y):(y=yr(y,E,d,null),y.flags|=2),y.return=r,h.return=r,h.sibling=y,r.child=h,h=y,y=r.child,E=o.child.memoizedState,E=E===null?lh(d):{baseLanes:E.baseLanes|d,cachePool:null,transitions:E.transitions},y.memoizedState=E,y.childLanes=o.childLanes&~d,r.memoizedState=ah,h}return y=o.child,o=y.sibling,h=No(y,{mode:"visible",children:h.children}),(r.mode&1)===0&&(h.lanes=d),h.return=r,h.sibling=null,o!==null&&(d=r.deletions,d===null?(r.deletions=[o],r.flags|=16):d.push(o)),r.child=h,r.memoizedState=null,h}function ch(o,r){return r=sd({mode:"visible",children:r},o.mode,0,null),r.return=o,o.child=r}function Xc(o,r,d,h){return h!==null&&Ff(h),gs(r,o.child,null,d),o=ch(r,r.pendingProps.children),o.flags|=2,r.memoizedState=null,o}function nC(o,r,d,h,p,y,E){if(d)return r.flags&256?(r.flags&=-257,h=ih(Error(n(422))),Xc(o,r,E,h)):r.memoizedState!==null?(r.child=o.child,r.flags|=128,null):(y=h.fallback,p=r.mode,h=sd({mode:"visible",children:h.children},p,0,null),y=yr(y,p,E,null),y.flags|=2,h.return=r,y.return=r,h.sibling=y,r.child=h,(r.mode&1)!==0&&gs(r,o.child,null,E),r.child.memoizedState=lh(E),r.memoizedState=ah,y);if((r.mode&1)===0)return Xc(o,r,E,null);if(p.data==="$!"){if(h=p.nextSibling&&p.nextSibling.dataset,h)var D=h.dgst;return h=D,y=Error(n(419)),h=ih(y,h,void 0),Xc(o,r,E,h)}if(D=(E&o.childLanes)!==0,Cn||D){if(h=Bt,h!==null){switch(E&-E){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=(p&(h.suspendedLanes|E))!==0?0:p,p!==0&&p!==y.retryLane&&(y.retryLane=p,Wi(o,p),ui(h,o,p,-1))}return _h(),h=ih(Error(n(421))),Xc(o,r,E,h)}return p.data==="$?"?(r.flags|=128,r.child=o.child,r=pC.bind(null,o),p._reactRetry=r,null):(o=y.treeContext,bn=vo(p.nextSibling),kn=r,ut=!0,ai=null,o!==null&&(zn[jn++]=$i,zn[jn++]=xi,zn[jn++]=lr,$i=o.id,xi=o.overflow,lr=r),r=ch(r,h.children),r.flags|=4096,r)}function oy(o,r,d){o.lanes|=r;var h=o.alternate;h!==null&&(h.lanes|=r),Gf(o.return,r,d)}function dh(o,r,d,h,p){var y=o.memoizedState;y===null?o.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:d,tailMode:p}:(y.isBackwards=r,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=d,y.tailMode=p)}function ry(o,r,d){var h=r.pendingProps,p=h.revealOrder,y=h.tail;if(dn(o,r,h.children,d),h=gt.current,(h&2)!==0)h=h&1|2,r.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=r.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&oy(o,d,r);else if(o.tag===19)oy(o,d,r);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}h&=1}if(st(gt,h),(r.mode&1)===0)r.memoizedState=null;else switch(p){case"forwards":for(d=r.child,p=null;d!==null;)o=d.alternate,o!==null&&Gc(o)===null&&(p=d),d=d.sibling;d=p,d===null?(p=r.child,r.child=null):(p=d.sibling,d.sibling=null),dh(r,!1,p,d,y);break;case"backwards":for(d=null,p=r.child,r.child=null;p!==null;){if(o=p.alternate,o!==null&&Gc(o)===null){r.child=p;break}o=p.sibling,p.sibling=d,d=p,p=o}dh(r,!0,d,null,y);break;case"together":dh(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Vc(o,r){(r.mode&1)===0&&o!==null&&(o.alternate=null,r.alternate=null,r.flags|=2)}function zi(o,r,d){if(o!==null&&(r.dependencies=o.dependencies),hr|=r.lanes,(d&r.childLanes)===0)return null;if(o!==null&&r.child!==o.child)throw Error(n(153));if(r.child!==null){for(o=r.child,d=No(o,o.pendingProps),r.child=d,d.return=r;o.sibling!==null;)o=o.sibling,d=d.sibling=No(o,o.pendingProps),d.return=r;d.sibling=null}return r.child}function iC(o,r,d){switch(r.tag){case 3:ty(r),hs();break;case 5:v0(r);break;case 1:En(r.type)&&Nc(r);break;case 4:Wf(r,r.stateNode.containerInfo);break;case 10:var h=r.type._context,p=r.memoizedProps.value;st(Fc,h._currentValue),h._currentValue=p;break;case 13:if(h=r.memoizedState,h!==null)return h.dehydrated!==null?(st(gt,gt.current&1),r.flags|=128,null):(d&r.child.childLanes)!==0?iy(o,r,d):(st(gt,gt.current&1),o=zi(o,r,d),o!==null?o.sibling:null);st(gt,gt.current&1);break;case 19:if(h=(d&r.childLanes)!==0,(o.flags&128)!==0){if(h)return ry(o,r,d);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),st(gt,gt.current),h)break;return null;case 22:case 23:return r.lanes=0,Q0(o,r,d)}return zi(o,r,d)}var sy,uh,ay,ly;sy=function(o,r){for(var d=r.child;d!==null;){if(d.tag===5||d.tag===6)o.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break;for(;d.sibling===null;){if(d.return===null||d.return===r)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},uh=function(){},ay=function(o,r,d,h){var p=o.memoizedProps;if(p!==h){o=r.stateNode,ur(Ii.current);var y=null;switch(d){case"input":p=nt(o,p),h=nt(o,h),y=[];break;case"select":p=K({},p,{value:void 0}),h=K({},h,{value:void 0}),y=[];break;case"textarea":p=or(o,p),h=or(o,h),y=[];break;default:typeof p.onClick!="function"&&typeof h.onClick=="function"&&(o.onclick=Rc)}Yu(d,h);var E;d=null;for(x in p)if(!h.hasOwnProperty(x)&&p.hasOwnProperty(x)&&p[x]!=null)if(x==="style"){var D=p[x];for(E in D)D.hasOwnProperty(E)&&(d||(d={}),d[E]="")}else x!=="dangerouslySetInnerHTML"&&x!=="children"&&x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(s.hasOwnProperty(x)?y||(y=[]):(y=y||[]).push(x,null));for(x in h){var k=h[x];if(D=p!=null?p[x]:void 0,h.hasOwnProperty(x)&&k!==D&&(k!=null||D!=null))if(x==="style")if(D){for(E in D)!D.hasOwnProperty(E)||k&&k.hasOwnProperty(E)||(d||(d={}),d[E]="");for(E in k)k.hasOwnProperty(E)&&D[E]!==k[E]&&(d||(d={}),d[E]=k[E])}else d||(y||(y=[]),y.push(x,d)),d=k;else x==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,D=D?D.__html:void 0,k!=null&&D!==k&&(y=y||[]).push(x,k)):x==="children"?typeof k!="string"&&typeof k!="number"||(y=y||[]).push(x,""+k):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&(s.hasOwnProperty(x)?(k!=null&&x==="onScroll"&&lt("scroll",o),y||D===k||(y=[])):(y=y||[]).push(x,k))}d&&(y=y||[]).push("style",d);var x=y;(r.updateQueue=x)&&(r.flags|=4)}},ly=function(o,r,d,h){d!==h&&(r.flags|=4)};function Qa(o,r){if(!ut)switch(o.tailMode){case"hidden":r=o.tail;for(var d=null;r!==null;)r.alternate!==null&&(d=r),r=r.sibling;d===null?o.tail=null:d.sibling=null;break;case"collapsed":d=o.tail;for(var h=null;d!==null;)d.alternate!==null&&(h=d),d=d.sibling;h===null?r||o.tail===null?o.tail=null:o.tail.sibling=null:h.sibling=null}}function en(o){var r=o.alternate!==null&&o.alternate.child===o.child,d=0,h=0;if(r)for(var p=o.child;p!==null;)d|=p.lanes|p.childLanes,h|=p.subtreeFlags&14680064,h|=p.flags&14680064,p.return=o,p=p.sibling;else for(p=o.child;p!==null;)d|=p.lanes|p.childLanes,h|=p.subtreeFlags,h|=p.flags,p.return=o,p=p.sibling;return o.subtreeFlags|=h,o.childLanes=d,r}function oC(o,r,d){var h=r.pendingProps;switch(kf(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return en(r),null;case 1:return En(r.type)&&Dc(),en(r),null;case 3:return h=r.stateNode,ys(),ct(Tn),ct(Qt),jf(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(bc(r)?r.flags|=4:o===null||o.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,ai!==null&&(Th(ai),ai=null))),uh(o,r),en(r),null;case 5:Yf(r);var p=ur(Xa.current);if(d=r.type,o!==null&&r.stateNode!=null)ay(o,r,d,h,p),o.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!h){if(r.stateNode===null)throw Error(n(166));return en(r),null}if(o=ur(Ii.current),bc(r)){h=r.stateNode,d=r.type;var y=r.memoizedProps;switch(h[Ai]=r,h[xa]=y,o=(r.mode&1)!==0,d){case"dialog":lt("cancel",h),lt("close",h);break;case"iframe":case"object":case"embed":lt("load",h);break;case"video":case"audio":for(p=0;p<Ha.length;p++)lt(Ha[p],h);break;case"source":lt("error",h);break;case"img":case"image":case"link":lt("error",h),lt("load",h);break;case"details":lt("toggle",h);break;case"input":at(h,y),lt("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!y.multiple},lt("invalid",h);break;case"textarea":zp(h,y),lt("invalid",h)}Yu(d,y),p=null;for(var E in y)if(y.hasOwnProperty(E)){var D=y[E];E==="children"?typeof D=="string"?h.textContent!==D&&(y.suppressHydrationWarning!==!0&&wc(h.textContent,D,o),p=["children",D]):typeof D=="number"&&h.textContent!==""+D&&(y.suppressHydrationWarning!==!0&&wc(h.textContent,D,o),p=["children",""+D]):s.hasOwnProperty(E)&&D!=null&&E==="onScroll"&&lt("scroll",h)}switch(d){case"input":xe(h),Yn(h,y,!0);break;case"textarea":xe(h),Xp(h);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(h.onclick=Rc)}h=p,r.updateQueue=h,h!==null&&(r.flags|=4)}else{E=p.nodeType===9?p:p.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=Vp(d)),o==="http://www.w3.org/1999/xhtml"?d==="script"?(o=E.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof h.is=="string"?o=E.createElement(d,{is:h.is}):(o=E.createElement(d),d==="select"&&(E=o,h.multiple?E.multiple=!0:h.size&&(E.size=h.size))):o=E.createElementNS(o,d),o[Ai]=r,o[xa]=h,sy(o,r,!1,!1),r.stateNode=o;e:{switch(E=zu(d,h),d){case"dialog":lt("cancel",o),lt("close",o),p=h;break;case"iframe":case"object":case"embed":lt("load",o),p=h;break;case"video":case"audio":for(p=0;p<Ha.length;p++)lt(Ha[p],o);p=h;break;case"source":lt("error",o),p=h;break;case"img":case"image":case"link":lt("error",o),lt("load",o),p=h;break;case"details":lt("toggle",o),p=h;break;case"input":at(o,h),p=nt(o,h),lt("invalid",o);break;case"option":p=h;break;case"select":o._wrapperState={wasMultiple:!!h.multiple},p=K({},h,{value:void 0}),lt("invalid",o);break;case"textarea":zp(o,h),p=or(o,h),lt("invalid",o);break;default:p=h}Yu(d,p),D=p;for(y in D)if(D.hasOwnProperty(y)){var k=D[y];y==="style"?Zp(o,k):y==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,k!=null&&Kp(o,k)):y==="children"?typeof k=="string"?(d!=="textarea"||k!=="")&&Aa(o,k):typeof k=="number"&&Aa(o,""+k):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?k!=null&&y==="onScroll"&&lt("scroll",o):k!=null&&w(o,y,k,E))}switch(d){case"input":xe(o),Yn(o,h,!1);break;case"textarea":xe(o),Xp(o);break;case"option":h.value!=null&&o.setAttribute("value",""+Ne(h.value));break;case"select":o.multiple=!!h.multiple,y=h.value,y!=null?fo(o,!!h.multiple,y,!1):h.defaultValue!=null&&fo(o,!!h.multiple,h.defaultValue,!0);break;default:typeof p.onClick=="function"&&(o.onclick=Rc)}switch(d){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return en(r),null;case 6:if(o&&r.stateNode!=null)ly(o,r,o.memoizedProps,h);else{if(typeof h!="string"&&r.stateNode===null)throw Error(n(166));if(d=ur(Xa.current),ur(Ii.current),bc(r)){if(h=r.stateNode,d=r.memoizedProps,h[Ai]=r,(y=h.nodeValue!==d)&&(o=kn,o!==null))switch(o.tag){case 3:wc(h.nodeValue,d,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&wc(h.nodeValue,d,(o.mode&1)!==0)}y&&(r.flags|=4)}else h=(d.nodeType===9?d:d.ownerDocument).createTextNode(h),h[Ai]=r,r.stateNode=h}return en(r),null;case 13:if(ct(gt),h=r.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(ut&&bn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)u0(),hs(),r.flags|=98560,y=!1;else if(y=bc(r),h!==null&&h.dehydrated!==null){if(o===null){if(!y)throw Error(n(318));if(y=r.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[Ai]=r}else hs(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;en(r),y=!1}else ai!==null&&(Th(ai),ai=null),y=!0;if(!y)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=d,r):(h=h!==null,h!==(o!==null&&o.memoizedState!==null)&&h&&(r.child.flags|=8192,(r.mode&1)!==0&&(o===null||(gt.current&1)!==0?Mt===0&&(Mt=3):_h())),r.updateQueue!==null&&(r.flags|=4),en(r),null);case 4:return ys(),uh(o,r),o===null&&Ga(r.stateNode.containerInfo),en(r),null;case 10:return Hf(r.type._context),en(r),null;case 17:return En(r.type)&&Dc(),en(r),null;case 19:if(ct(gt),y=r.memoizedState,y===null)return en(r),null;if(h=(r.flags&128)!==0,E=y.rendering,E===null)if(h)Qa(y,!1);else{if(Mt!==0||o!==null&&(o.flags&128)!==0)for(o=r.child;o!==null;){if(E=Gc(o),E!==null){for(r.flags|=128,Qa(y,!1),h=E.updateQueue,h!==null&&(r.updateQueue=h,r.flags|=4),r.subtreeFlags=0,h=d,d=r.child;d!==null;)y=d,o=h,y.flags&=14680066,E=y.alternate,E===null?(y.childLanes=0,y.lanes=o,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=E.childLanes,y.lanes=E.lanes,y.child=E.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=E.memoizedProps,y.memoizedState=E.memoizedState,y.updateQueue=E.updateQueue,y.type=E.type,o=E.dependencies,y.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),d=d.sibling;return st(gt,gt.current&1|2),r.child}o=o.sibling}y.tail!==null&&It()>Is&&(r.flags|=128,h=!0,Qa(y,!1),r.lanes=4194304)}else{if(!h)if(o=Gc(E),o!==null){if(r.flags|=128,h=!0,d=o.updateQueue,d!==null&&(r.updateQueue=d,r.flags|=4),Qa(y,!0),y.tail===null&&y.tailMode==="hidden"&&!E.alternate&&!ut)return en(r),null}else 2*It()-y.renderingStartTime>Is&&d!==1073741824&&(r.flags|=128,h=!0,Qa(y,!1),r.lanes=4194304);y.isBackwards?(E.sibling=r.child,r.child=E):(d=y.last,d!==null?d.sibling=E:r.child=E,y.last=E)}return y.tail!==null?(r=y.tail,y.rendering=r,y.tail=r.sibling,y.renderingStartTime=It(),r.sibling=null,d=gt.current,st(gt,h?d&1|2:d&1),r):(en(r),null);case 22:case 23:return Ch(),h=r.memoizedState!==null,o!==null&&o.memoizedState!==null!==h&&(r.flags|=8192),h&&(r.mode&1)!==0?(Bn&1073741824)!==0&&(en(r),r.subtreeFlags&6&&(r.flags|=8192)):en(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function rC(o,r){switch(kf(r),r.tag){case 1:return En(r.type)&&Dc(),o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 3:return ys(),ct(Tn),ct(Qt),jf(),o=r.flags,(o&65536)!==0&&(o&128)===0?(r.flags=o&-65537|128,r):null;case 5:return Yf(r),null;case 13:if(ct(gt),o=r.memoizedState,o!==null&&o.dehydrated!==null){if(r.alternate===null)throw Error(n(340));hs()}return o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 19:return ct(gt),null;case 4:return ys(),null;case 10:return Hf(r.type._context),null;case 22:case 23:return Ch(),null;case 24:return null;default:return null}}var Kc=!1,tn=!1,sC=typeof WeakSet=="function"?WeakSet:Set,ye=null;function vs(o,r){var d=o.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(h){St(o,r,h)}else d.current=null}function fh(o,r,d){try{d()}catch(h){St(o,r,h)}}var cy=!1;function aC(o,r){if(Cf=pc,o=$m(),mf(o)){if("selectionStart"in o)var d={start:o.selectionStart,end:o.selectionEnd};else e:{d=(d=o.ownerDocument)&&d.defaultView||window;var h=d.getSelection&&d.getSelection();if(h&&h.rangeCount!==0){d=h.anchorNode;var p=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{d.nodeType,y.nodeType}catch{d=null;break e}var E=0,D=-1,k=-1,x=0,q=0,Q=o,X=null;t:for(;;){for(var ge;Q!==d||p!==0&&Q.nodeType!==3||(D=E+p),Q!==y||h!==0&&Q.nodeType!==3||(k=E+h),Q.nodeType===3&&(E+=Q.nodeValue.length),(ge=Q.firstChild)!==null;)X=Q,Q=ge;for(;;){if(Q===o)break t;if(X===d&&++x===p&&(D=E),X===y&&++q===h&&(k=E),(ge=Q.nextSibling)!==null)break;Q=X,X=Q.parentNode}Q=ge}d=D===-1||k===-1?null:{start:D,end:k}}else d=null}d=d||{start:0,end:0}}else d=null;for(_f={focusedElem:o,selectionRange:d},pc=!1,ye=r;ye!==null;)if(r=ye,o=r.child,(r.subtreeFlags&1028)!==0&&o!==null)o.return=r,ye=o;else for(;ye!==null;){r=ye;try{var ve=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(ve!==null){var Te=ve.memoizedProps,Tt=ve.memoizedState,G=r.stateNode,L=G.getSnapshotBeforeUpdate(r.elementType===r.type?Te:li(r.type,Te),Tt);G.__reactInternalSnapshotBeforeUpdate=L}break;case 3:var $=r.stateNode.containerInfo;$.nodeType===1?$.textContent="":$.nodeType===9&&$.documentElement&&$.removeChild($.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(J){St(r,r.return,J)}if(o=r.sibling,o!==null){o.return=r.return,ye=o;break}ye=r.return}return ve=cy,cy=!1,ve}function Ja(o,r,d){var h=r.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var p=h=h.next;do{if((p.tag&o)===o){var y=p.destroy;p.destroy=void 0,y!==void 0&&fh(r,d,y)}p=p.next}while(p!==h)}}function qc(o,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var d=r=r.next;do{if((d.tag&o)===o){var h=d.create;d.destroy=h()}d=d.next}while(d!==r)}}function hh(o){var r=o.ref;if(r!==null){var d=o.stateNode;switch(o.tag){case 5:o=d;break;default:o=d}typeof r=="function"?r(o):r.current=o}}function dy(o){var r=o.alternate;r!==null&&(o.alternate=null,dy(r)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(r=o.stateNode,r!==null&&(delete r[Ai],delete r[xa],delete r[Df],delete r[WE],delete r[YE])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function uy(o){return o.tag===5||o.tag===3||o.tag===4}function fy(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||uy(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function gh(o,r,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?d.nodeType===8?d.parentNode.insertBefore(o,r):d.insertBefore(o,r):(d.nodeType===8?(r=d.parentNode,r.insertBefore(o,d)):(r=d,r.appendChild(o)),d=d._reactRootContainer,d!=null||r.onclick!==null||(r.onclick=Rc));else if(h!==4&&(o=o.child,o!==null))for(gh(o,r,d),o=o.sibling;o!==null;)gh(o,r,d),o=o.sibling}function ph(o,r,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?d.insertBefore(o,r):d.appendChild(o);else if(h!==4&&(o=o.child,o!==null))for(ph(o,r,d),o=o.sibling;o!==null;)ph(o,r,d),o=o.sibling}var Wt=null,ci=!1;function _o(o,r,d){for(d=d.child;d!==null;)hy(o,r,d),d=d.sibling}function hy(o,r,d){if(vi&&typeof vi.onCommitFiberUnmount=="function")try{vi.onCommitFiberUnmount(cc,d)}catch{}switch(d.tag){case 5:tn||vs(d,r);case 6:var h=Wt,p=ci;Wt=null,_o(o,r,d),Wt=h,ci=p,Wt!==null&&(ci?(o=Wt,d=d.stateNode,o.nodeType===8?o.parentNode.removeChild(d):o.removeChild(d)):Wt.removeChild(d.stateNode));break;case 18:Wt!==null&&(ci?(o=Wt,d=d.stateNode,o.nodeType===8?Pf(o.parentNode,d):o.nodeType===1&&Pf(o,d),Ma(o)):Pf(Wt,d.stateNode));break;case 4:h=Wt,p=ci,Wt=d.stateNode.containerInfo,ci=!0,_o(o,r,d),Wt=h,ci=p;break;case 0:case 11:case 14:case 15:if(!tn&&(h=d.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){p=h=h.next;do{var y=p,E=y.destroy;y=y.tag,E!==void 0&&((y&2)!==0||(y&4)!==0)&&fh(d,r,E),p=p.next}while(p!==h)}_o(o,r,d);break;case 1:if(!tn&&(vs(d,r),h=d.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=d.memoizedProps,h.state=d.memoizedState,h.componentWillUnmount()}catch(D){St(d,r,D)}_o(o,r,d);break;case 21:_o(o,r,d);break;case 22:d.mode&1?(tn=(h=tn)||d.memoizedState!==null,_o(o,r,d),tn=h):_o(o,r,d);break;default:_o(o,r,d)}}function gy(o){var r=o.updateQueue;if(r!==null){o.updateQueue=null;var d=o.stateNode;d===null&&(d=o.stateNode=new sC),r.forEach(function(h){var p=mC.bind(null,o,h);d.has(h)||(d.add(h),h.then(p,p))})}}function di(o,r){var d=r.deletions;if(d!==null)for(var h=0;h<d.length;h++){var p=d[h];try{var y=o,E=r,D=E;e:for(;D!==null;){switch(D.tag){case 5:Wt=D.stateNode,ci=!1;break e;case 3:Wt=D.stateNode.containerInfo,ci=!0;break e;case 4:Wt=D.stateNode.containerInfo,ci=!0;break e}D=D.return}if(Wt===null)throw Error(n(160));hy(y,E,p),Wt=null,ci=!1;var k=p.alternate;k!==null&&(k.return=null),p.return=null}catch(x){St(p,r,x)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)py(r,o),r=r.sibling}function py(o,r){var d=o.alternate,h=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(di(r,o),Ei(o),h&4){try{Ja(3,o,o.return),qc(3,o)}catch(Te){St(o,o.return,Te)}try{Ja(5,o,o.return)}catch(Te){St(o,o.return,Te)}}break;case 1:di(r,o),Ei(o),h&512&&d!==null&&vs(d,d.return);break;case 5:if(di(r,o),Ei(o),h&512&&d!==null&&vs(d,d.return),o.flags&32){var p=o.stateNode;try{Aa(p,"")}catch(Te){St(o,o.return,Te)}}if(h&4&&(p=o.stateNode,p!=null)){var y=o.memoizedProps,E=d!==null?d.memoizedProps:y,D=o.type,k=o.updateQueue;if(o.updateQueue=null,k!==null)try{D==="input"&&y.type==="radio"&&y.name!=null&&mi(p,y),zu(D,E);var x=zu(D,y);for(E=0;E<k.length;E+=2){var q=k[E],Q=k[E+1];q==="style"?Zp(p,Q):q==="dangerouslySetInnerHTML"?Kp(p,Q):q==="children"?Aa(p,Q):w(p,q,Q,x)}switch(D){case"input":In(p,y);break;case"textarea":jp(p,y);break;case"select":var X=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!y.multiple;var ge=y.value;ge!=null?fo(p,!!y.multiple,ge,!1):X!==!!y.multiple&&(y.defaultValue!=null?fo(p,!!y.multiple,y.defaultValue,!0):fo(p,!!y.multiple,y.multiple?[]:"",!1))}p[xa]=y}catch(Te){St(o,o.return,Te)}}break;case 6:if(di(r,o),Ei(o),h&4){if(o.stateNode===null)throw Error(n(162));p=o.stateNode,y=o.memoizedProps;try{p.nodeValue=y}catch(Te){St(o,o.return,Te)}}break;case 3:if(di(r,o),Ei(o),h&4&&d!==null&&d.memoizedState.isDehydrated)try{Ma(r.containerInfo)}catch(Te){St(o,o.return,Te)}break;case 4:di(r,o),Ei(o);break;case 13:di(r,o),Ei(o),p=o.child,p.flags&8192&&(y=p.memoizedState!==null,p.stateNode.isHidden=y,!y||p.alternate!==null&&p.alternate.memoizedState!==null||(Sh=It())),h&4&&gy(o);break;case 22:if(q=d!==null&&d.memoizedState!==null,o.mode&1?(tn=(x=tn)||q,di(r,o),tn=x):di(r,o),Ei(o),h&8192){if(x=o.memoizedState!==null,(o.stateNode.isHidden=x)&&!q&&(o.mode&1)!==0)for(ye=o,q=o.child;q!==null;){for(Q=ye=q;ye!==null;){switch(X=ye,ge=X.child,X.tag){case 0:case 11:case 14:case 15:Ja(4,X,X.return);break;case 1:vs(X,X.return);var ve=X.stateNode;if(typeof ve.componentWillUnmount=="function"){h=X,d=X.return;try{r=h,ve.props=r.memoizedProps,ve.state=r.memoizedState,ve.componentWillUnmount()}catch(Te){St(h,d,Te)}}break;case 5:vs(X,X.return);break;case 22:if(X.memoizedState!==null){Sy(Q);continue}}ge!==null?(ge.return=X,ye=ge):Sy(Q)}q=q.sibling}e:for(q=null,Q=o;;){if(Q.tag===5){if(q===null){q=Q;try{p=Q.stateNode,x?(y=p.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(D=Q.stateNode,k=Q.memoizedProps.style,E=k!=null&&k.hasOwnProperty("display")?k.display:null,D.style.display=qp("display",E))}catch(Te){St(o,o.return,Te)}}}else if(Q.tag===6){if(q===null)try{Q.stateNode.nodeValue=x?"":Q.memoizedProps}catch(Te){St(o,o.return,Te)}}else if((Q.tag!==22&&Q.tag!==23||Q.memoizedState===null||Q===o)&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===o)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===o)break e;q===Q&&(q=null),Q=Q.return}q===Q&&(q=null),Q.sibling.return=Q.return,Q=Q.sibling}}break;case 19:di(r,o),Ei(o),h&4&&gy(o);break;case 21:break;default:di(r,o),Ei(o)}}function Ei(o){var r=o.flags;if(r&2){try{e:{for(var d=o.return;d!==null;){if(uy(d)){var h=d;break e}d=d.return}throw Error(n(160))}switch(h.tag){case 5:var p=h.stateNode;h.flags&32&&(Aa(p,""),h.flags&=-33);var y=fy(o);ph(o,y,p);break;case 3:case 4:var E=h.stateNode.containerInfo,D=fy(o);gh(o,D,E);break;default:throw Error(n(161))}}catch(k){St(o,o.return,k)}o.flags&=-3}r&4096&&(o.flags&=-4097)}function lC(o,r,d){ye=o,my(o)}function my(o,r,d){for(var h=(o.mode&1)!==0;ye!==null;){var p=ye,y=p.child;if(p.tag===22&&h){var E=p.memoizedState!==null||Kc;if(!E){var D=p.alternate,k=D!==null&&D.memoizedState!==null||tn;D=Kc;var x=tn;if(Kc=E,(tn=k)&&!x)for(ye=p;ye!==null;)E=ye,k=E.child,E.tag===22&&E.memoizedState!==null?vy(p):k!==null?(k.return=E,ye=k):vy(p);for(;y!==null;)ye=y,my(y),y=y.sibling;ye=p,Kc=D,tn=x}yy(o)}else(p.subtreeFlags&8772)!==0&&y!==null?(y.return=p,ye=y):yy(o)}}function yy(o){for(;ye!==null;){var r=ye;if((r.flags&8772)!==0){var d=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:tn||qc(5,r);break;case 1:var h=r.stateNode;if(r.flags&4&&!tn)if(d===null)h.componentDidMount();else{var p=r.elementType===r.type?d.memoizedProps:li(r.type,d.memoizedProps);h.componentDidUpdate(p,d.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var y=r.updateQueue;y!==null&&S0(r,y,h);break;case 3:var E=r.updateQueue;if(E!==null){if(d=null,r.child!==null)switch(r.child.tag){case 5:d=r.child.stateNode;break;case 1:d=r.child.stateNode}S0(r,E,d)}break;case 5:var D=r.stateNode;if(d===null&&r.flags&4){d=D;var k=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":k.autoFocus&&d.focus();break;case"img":k.src&&(d.src=k.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var x=r.alternate;if(x!==null){var q=x.memoizedState;if(q!==null){var Q=q.dehydrated;Q!==null&&Ma(Q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}tn||r.flags&512&&hh(r)}catch(X){St(r,r.return,X)}}if(r===o){ye=null;break}if(d=r.sibling,d!==null){d.return=r.return,ye=d;break}ye=r.return}}function Sy(o){for(;ye!==null;){var r=ye;if(r===o){ye=null;break}var d=r.sibling;if(d!==null){d.return=r.return,ye=d;break}ye=r.return}}function vy(o){for(;ye!==null;){var r=ye;try{switch(r.tag){case 0:case 11:case 15:var d=r.return;try{qc(4,r)}catch(k){St(r,d,k)}break;case 1:var h=r.stateNode;if(typeof h.componentDidMount=="function"){var p=r.return;try{h.componentDidMount()}catch(k){St(r,p,k)}}var y=r.return;try{hh(r)}catch(k){St(r,y,k)}break;case 5:var E=r.return;try{hh(r)}catch(k){St(r,E,k)}}}catch(k){St(r,r.return,k)}if(r===o){ye=null;break}var D=r.sibling;if(D!==null){D.return=r.return,ye=D;break}ye=r.return}}var cC=Math.ceil,Zc=B.ReactCurrentDispatcher,mh=B.ReactCurrentOwner,Kn=B.ReactCurrentBatchConfig,Ve=0,Bt=null,wt=null,Yt=0,Bn=0,As=Ao(0),Mt=0,el=null,hr=0,Qc=0,yh=0,tl=null,_n=null,Sh=0,Is=1/0,ji=null,Jc=!1,vh=null,wo=null,ed=!1,Ro=null,td=0,nl=0,Ah=null,nd=-1,id=0;function un(){return(Ve&6)!==0?It():nd!==-1?nd:nd=It()}function Po(o){return(o.mode&1)===0?1:(Ve&2)!==0&&Yt!==0?Yt&-Yt:jE.transition!==null?(id===0&&(id=fm()),id):(o=tt,o!==0||(o=window.event,o=o===void 0?16:Im(o.type)),o)}function ui(o,r,d,h){if(50<nl)throw nl=0,Ah=null,Error(n(185));wa(o,d,h),((Ve&2)===0||o!==Bt)&&(o===Bt&&((Ve&2)===0&&(Qc|=d),Mt===4&&Do(o,Yt)),wn(o,h),d===1&&Ve===0&&(r.mode&1)===0&&(Is=It()+500,Mc&&To()))}function wn(o,r){var d=o.callbackNode;jT(o,r);var h=fc(o,o===Bt?Yt:0);if(h===0)d!==null&&cm(d),o.callbackNode=null,o.callbackPriority=0;else if(r=h&-h,o.callbackPriority!==r){if(d!=null&&cm(d),r===1)o.tag===0?zE(Iy.bind(null,o)):s0(Iy.bind(null,o)),$E(function(){(Ve&6)===0&&To()}),d=null;else{switch(hm(h)){case 1:d=Qu;break;case 4:d=dm;break;case 16:d=lc;break;case 536870912:d=um;break;default:d=lc}d=Dy(d,Ay.bind(null,o))}o.callbackPriority=r,o.callbackNode=d}}function Ay(o,r){if(nd=-1,id=0,(Ve&6)!==0)throw Error(n(327));var d=o.callbackNode;if(Ts()&&o.callbackNode!==d)return null;var h=fc(o,o===Bt?Yt:0);if(h===0)return null;if((h&30)!==0||(h&o.expiredLanes)!==0||r)r=od(o,h);else{r=h;var p=Ve;Ve|=2;var y=Ey();(Bt!==o||Yt!==r)&&(ji=null,Is=It()+500,pr(o,r));do try{fC();break}catch(D){Ty(o,D)}while(!0);Uf(),Zc.current=y,Ve=p,wt!==null?r=0:(Bt=null,Yt=0,r=Mt)}if(r!==0){if(r===2&&(p=Ju(o),p!==0&&(h=p,r=Ih(o,p))),r===1)throw d=el,pr(o,0),Do(o,h),wn(o,It()),d;if(r===6)Do(o,h);else{if(p=o.current.alternate,(h&30)===0&&!dC(p)&&(r=od(o,h),r===2&&(y=Ju(o),y!==0&&(h=y,r=Ih(o,y))),r===1))throw d=el,pr(o,0),Do(o,h),wn(o,It()),d;switch(o.finishedWork=p,o.finishedLanes=h,r){case 0:case 1:throw Error(n(345));case 2:mr(o,_n,ji);break;case 3:if(Do(o,h),(h&130023424)===h&&(r=Sh+500-It(),10<r)){if(fc(o,0)!==0)break;if(p=o.suspendedLanes,(p&h)!==h){un(),o.pingedLanes|=o.suspendedLanes&p;break}o.timeoutHandle=Rf(mr.bind(null,o,_n,ji),r);break}mr(o,_n,ji);break;case 4:if(Do(o,h),(h&4194240)===h)break;for(r=o.eventTimes,p=-1;0<h;){var E=31-ri(h);y=1<<E,E=r[E],E>p&&(p=E),h&=~y}if(h=p,h=It()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*cC(h/1960))-h,10<h){o.timeoutHandle=Rf(mr.bind(null,o,_n,ji),h);break}mr(o,_n,ji);break;case 5:mr(o,_n,ji);break;default:throw Error(n(329))}}}return wn(o,It()),o.callbackNode===d?Ay.bind(null,o):null}function Ih(o,r){var d=tl;return o.current.memoizedState.isDehydrated&&(pr(o,r).flags|=256),o=od(o,r),o!==2&&(r=_n,_n=d,r!==null&&Th(r)),o}function Th(o){_n===null?_n=o:_n.push.apply(_n,o)}function dC(o){for(var r=o;;){if(r.flags&16384){var d=r.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var h=0;h<d.length;h++){var p=d[h],y=p.getSnapshot;p=p.value;try{if(!si(y(),p))return!1}catch{return!1}}}if(d=r.child,r.subtreeFlags&16384&&d!==null)d.return=r,r=d;else{if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Do(o,r){for(r&=~yh,r&=~Qc,o.suspendedLanes|=r,o.pingedLanes&=~r,o=o.expirationTimes;0<r;){var d=31-ri(r),h=1<<d;o[d]=-1,r&=~h}}function Iy(o){if((Ve&6)!==0)throw Error(n(327));Ts();var r=fc(o,0);if((r&1)===0)return wn(o,It()),null;var d=od(o,r);if(o.tag!==0&&d===2){var h=Ju(o);h!==0&&(r=h,d=Ih(o,h))}if(d===1)throw d=el,pr(o,0),Do(o,r),wn(o,It()),d;if(d===6)throw Error(n(345));return o.finishedWork=o.current.alternate,o.finishedLanes=r,mr(o,_n,ji),wn(o,It()),null}function Eh(o,r){var d=Ve;Ve|=1;try{return o(r)}finally{Ve=d,Ve===0&&(Is=It()+500,Mc&&To())}}function gr(o){Ro!==null&&Ro.tag===0&&(Ve&6)===0&&Ts();var r=Ve;Ve|=1;var d=Kn.transition,h=tt;try{if(Kn.transition=null,tt=1,o)return o()}finally{tt=h,Kn.transition=d,Ve=r,(Ve&6)===0&&To()}}function Ch(){Bn=As.current,ct(As)}function pr(o,r){o.finishedWork=null,o.finishedLanes=0;var d=o.timeoutHandle;if(d!==-1&&(o.timeoutHandle=-1,GE(d)),wt!==null)for(d=wt.return;d!==null;){var h=d;switch(kf(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&Dc();break;case 3:ys(),ct(Tn),ct(Qt),jf();break;case 5:Yf(h);break;case 4:ys();break;case 13:ct(gt);break;case 19:ct(gt);break;case 10:Hf(h.type._context);break;case 22:case 23:Ch()}d=d.return}if(Bt=o,wt=o=No(o.current,null),Yt=Bn=r,Mt=0,el=null,yh=Qc=hr=0,_n=tl=null,dr!==null){for(r=0;r<dr.length;r++)if(d=dr[r],h=d.interleaved,h!==null){d.interleaved=null;var p=h.next,y=d.pending;if(y!==null){var E=y.next;y.next=p,h.next=E}d.pending=h}dr=null}return o}function Ty(o,r){do{var d=wt;try{if(Uf(),$c.current=zc,xc){for(var h=pt.memoizedState;h!==null;){var p=h.queue;p!==null&&(p.pending=null),h=h.next}xc=!1}if(fr=0,bt=Nt=pt=null,Va=!1,Ka=0,mh.current=null,d===null||d.return===null){Mt=1,el=r,wt=null;break}e:{var y=o,E=d.return,D=d,k=r;if(r=Yt,D.flags|=32768,k!==null&&typeof k=="object"&&typeof k.then=="function"){var x=k,q=D,Q=q.tag;if((q.mode&1)===0&&(Q===0||Q===11||Q===15)){var X=q.alternate;X?(q.updateQueue=X.updateQueue,q.memoizedState=X.memoizedState,q.lanes=X.lanes):(q.updateQueue=null,q.memoizedState=null)}var ge=X0(E);if(ge!==null){ge.flags&=-257,V0(ge,E,D,y,r),ge.mode&1&&j0(y,x,r),r=ge,k=x;var ve=r.updateQueue;if(ve===null){var Te=new Set;Te.add(k),r.updateQueue=Te}else ve.add(k);break e}else{if((r&1)===0){j0(y,x,r),_h();break e}k=Error(n(426))}}else if(ut&&D.mode&1){var Tt=X0(E);if(Tt!==null){(Tt.flags&65536)===0&&(Tt.flags|=256),V0(Tt,E,D,y,r),Ff(Ss(k,D));break e}}y=k=Ss(k,D),Mt!==4&&(Mt=2),tl===null?tl=[y]:tl.push(y),y=E;do{switch(y.tag){case 3:y.flags|=65536,r&=-r,y.lanes|=r;var G=Y0(y,k,r);y0(y,G);break e;case 1:D=k;var L=y.type,$=y.stateNode;if((y.flags&128)===0&&(typeof L.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(wo===null||!wo.has($)))){y.flags|=65536,r&=-r,y.lanes|=r;var J=z0(y,D,r);y0(y,J);break e}}y=y.return}while(y!==null)}_y(d)}catch(we){r=we,wt===d&&d!==null&&(wt=d=d.return);continue}break}while(!0)}function Ey(){var o=Zc.current;return Zc.current=zc,o===null?zc:o}function _h(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),Bt===null||(hr&268435455)===0&&(Qc&268435455)===0||Do(Bt,Yt)}function od(o,r){var d=Ve;Ve|=2;var h=Ey();(Bt!==o||Yt!==r)&&(ji=null,pr(o,r));do try{uC();break}catch(p){Ty(o,p)}while(!0);if(Uf(),Ve=d,Zc.current=h,wt!==null)throw Error(n(261));return Bt=null,Yt=0,Mt}function uC(){for(;wt!==null;)Cy(wt)}function fC(){for(;wt!==null&&!LT();)Cy(wt)}function Cy(o){var r=Py(o.alternate,o,Bn);o.memoizedProps=o.pendingProps,r===null?_y(o):wt=r,mh.current=null}function _y(o){var r=o;do{var d=r.alternate;if(o=r.return,(r.flags&32768)===0){if(d=oC(d,r,Bn),d!==null){wt=d;return}}else{if(d=rC(d,r),d!==null){d.flags&=32767,wt=d;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{Mt=6,wt=null;return}}if(r=r.sibling,r!==null){wt=r;return}wt=r=o}while(r!==null);Mt===0&&(Mt=5)}function mr(o,r,d){var h=tt,p=Kn.transition;try{Kn.transition=null,tt=1,hC(o,r,d,h)}finally{Kn.transition=p,tt=h}return null}function hC(o,r,d,h){do Ts();while(Ro!==null);if((Ve&6)!==0)throw Error(n(327));d=o.finishedWork;var p=o.finishedLanes;if(d===null)return null;if(o.finishedWork=null,o.finishedLanes=0,d===o.current)throw Error(n(177));o.callbackNode=null,o.callbackPriority=0;var y=d.lanes|d.childLanes;if(XT(o,y),o===Bt&&(wt=Bt=null,Yt=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||ed||(ed=!0,Dy(lc,function(){return Ts(),null})),y=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||y){y=Kn.transition,Kn.transition=null;var E=tt;tt=1;var D=Ve;Ve|=4,mh.current=null,aC(o,d),py(d,o),kE(_f),pc=!!Cf,_f=Cf=null,o.current=d,lC(d),UT(),Ve=D,tt=E,Kn.transition=y}else o.current=d;if(ed&&(ed=!1,Ro=o,td=p),y=o.pendingLanes,y===0&&(wo=null),$T(d.stateNode),wn(o,It()),r!==null)for(h=o.onRecoverableError,d=0;d<r.length;d++)p=r[d],h(p.value,{componentStack:p.stack,digest:p.digest});if(Jc)throw Jc=!1,o=vh,vh=null,o;return(td&1)!==0&&o.tag!==0&&Ts(),y=o.pendingLanes,(y&1)!==0?o===Ah?nl++:(nl=0,Ah=o):nl=0,To(),null}function Ts(){if(Ro!==null){var o=hm(td),r=Kn.transition,d=tt;try{if(Kn.transition=null,tt=16>o?16:o,Ro===null)var h=!1;else{if(o=Ro,Ro=null,td=0,(Ve&6)!==0)throw Error(n(331));var p=Ve;for(Ve|=4,ye=o.current;ye!==null;){var y=ye,E=y.child;if((ye.flags&16)!==0){var D=y.deletions;if(D!==null){for(var k=0;k<D.length;k++){var x=D[k];for(ye=x;ye!==null;){var q=ye;switch(q.tag){case 0:case 11:case 15:Ja(8,q,y)}var Q=q.child;if(Q!==null)Q.return=q,ye=Q;else for(;ye!==null;){q=ye;var X=q.sibling,ge=q.return;if(dy(q),q===x){ye=null;break}if(X!==null){X.return=ge,ye=X;break}ye=ge}}}var ve=y.alternate;if(ve!==null){var Te=ve.child;if(Te!==null){ve.child=null;do{var Tt=Te.sibling;Te.sibling=null,Te=Tt}while(Te!==null)}}ye=y}}if((y.subtreeFlags&2064)!==0&&E!==null)E.return=y,ye=E;else e:for(;ye!==null;){if(y=ye,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:Ja(9,y,y.return)}var G=y.sibling;if(G!==null){G.return=y.return,ye=G;break e}ye=y.return}}var L=o.current;for(ye=L;ye!==null;){E=ye;var $=E.child;if((E.subtreeFlags&2064)!==0&&$!==null)$.return=E,ye=$;else e:for(E=L;ye!==null;){if(D=ye,(D.flags&2048)!==0)try{switch(D.tag){case 0:case 11:case 15:qc(9,D)}}catch(we){St(D,D.return,we)}if(D===E){ye=null;break e}var J=D.sibling;if(J!==null){J.return=D.return,ye=J;break e}ye=D.return}}if(Ve=p,To(),vi&&typeof vi.onPostCommitFiberRoot=="function")try{vi.onPostCommitFiberRoot(cc,o)}catch{}h=!0}return h}finally{tt=d,Kn.transition=r}}return!1}function wy(o,r,d){r=Ss(d,r),r=Y0(o,r,1),o=Co(o,r,1),r=un(),o!==null&&(wa(o,1,r),wn(o,r))}function St(o,r,d){if(o.tag===3)wy(o,o,d);else for(;r!==null;){if(r.tag===3){wy(r,o,d);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(wo===null||!wo.has(h))){o=Ss(d,o),o=z0(r,o,1),r=Co(r,o,1),o=un(),r!==null&&(wa(r,1,o),wn(r,o));break}}r=r.return}}function gC(o,r,d){var h=o.pingCache;h!==null&&h.delete(r),r=un(),o.pingedLanes|=o.suspendedLanes&d,Bt===o&&(Yt&d)===d&&(Mt===4||Mt===3&&(Yt&130023424)===Yt&&500>It()-Sh?pr(o,0):yh|=d),wn(o,r)}function Ry(o,r){r===0&&((o.mode&1)===0?r=1:(r=uc,uc<<=1,(uc&130023424)===0&&(uc=4194304)));var d=un();o=Wi(o,r),o!==null&&(wa(o,r,d),wn(o,d))}function pC(o){var r=o.memoizedState,d=0;r!==null&&(d=r.retryLane),Ry(o,d)}function mC(o,r){var d=0;switch(o.tag){case 13:var h=o.stateNode,p=o.memoizedState;p!==null&&(d=p.retryLane);break;case 19:h=o.stateNode;break;default:throw Error(n(314))}h!==null&&h.delete(r),Ry(o,d)}var Py;Py=function(o,r,d){if(o!==null)if(o.memoizedProps!==r.pendingProps||Tn.current)Cn=!0;else{if((o.lanes&d)===0&&(r.flags&128)===0)return Cn=!1,iC(o,r,d);Cn=(o.flags&131072)!==0}else Cn=!1,ut&&(r.flags&1048576)!==0&&a0(r,kc,r.index);switch(r.lanes=0,r.tag){case 2:var h=r.type;Vc(o,r),o=r.pendingProps;var p=ds(r,Qt.current);ms(r,d),p=Kf(null,r,h,o,p,d);var y=qf();return r.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,En(h)?(y=!0,Nc(r)):y=!1,r.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,xf(r),p.updater=jc,r.stateNode=p,p._reactInternals=r,nh(r,h,o,d),r=sh(null,r,h,!0,y,d)):(r.tag=0,ut&&y&&Of(r),dn(null,r,p,d),r=r.child),r;case 16:h=r.elementType;e:{switch(Vc(o,r),o=r.pendingProps,p=h._init,h=p(h._payload),r.type=h,p=r.tag=SC(h),o=li(h,o),p){case 0:r=rh(null,r,h,o,d);break e;case 1:r=ey(null,r,h,o,d);break e;case 11:r=K0(null,r,h,o,d);break e;case 14:r=q0(null,r,h,li(h.type,o),d);break e}throw Error(n(306,h,""))}return r;case 0:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:li(h,p),rh(o,r,h,p,d);case 1:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:li(h,p),ey(o,r,h,p,d);case 3:e:{if(ty(r),o===null)throw Error(n(387));h=r.pendingProps,y=r.memoizedState,p=y.element,m0(o,r),Hc(r,h,null,d);var E=r.memoizedState;if(h=E.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:E.cache,pendingSuspenseBoundaries:E.pendingSuspenseBoundaries,transitions:E.transitions},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){p=Ss(Error(n(423)),r),r=ny(o,r,h,d,p);break e}else if(h!==p){p=Ss(Error(n(424)),r),r=ny(o,r,h,d,p);break e}else for(bn=vo(r.stateNode.containerInfo.firstChild),kn=r,ut=!0,ai=null,d=g0(r,null,h,d),r.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(hs(),h===p){r=zi(o,r,d);break e}dn(o,r,h,d)}r=r.child}return r;case 5:return v0(r),o===null&&Bf(r),h=r.type,p=r.pendingProps,y=o!==null?o.memoizedProps:null,E=p.children,wf(h,p)?E=null:y!==null&&wf(h,y)&&(r.flags|=32),J0(o,r),dn(o,r,E,d),r.child;case 6:return o===null&&Bf(r),null;case 13:return iy(o,r,d);case 4:return Wf(r,r.stateNode.containerInfo),h=r.pendingProps,o===null?r.child=gs(r,null,h,d):dn(o,r,h,d),r.child;case 11:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:li(h,p),K0(o,r,h,p,d);case 7:return dn(o,r,r.pendingProps,d),r.child;case 8:return dn(o,r,r.pendingProps.children,d),r.child;case 12:return dn(o,r,r.pendingProps.children,d),r.child;case 10:e:{if(h=r.type._context,p=r.pendingProps,y=r.memoizedProps,E=p.value,st(Fc,h._currentValue),h._currentValue=E,y!==null)if(si(y.value,E)){if(y.children===p.children&&!Tn.current){r=zi(o,r,d);break e}}else for(y=r.child,y!==null&&(y.return=r);y!==null;){var D=y.dependencies;if(D!==null){E=y.child;for(var k=D.firstContext;k!==null;){if(k.context===h){if(y.tag===1){k=Yi(-1,d&-d),k.tag=2;var x=y.updateQueue;if(x!==null){x=x.shared;var q=x.pending;q===null?k.next=k:(k.next=q.next,q.next=k),x.pending=k}}y.lanes|=d,k=y.alternate,k!==null&&(k.lanes|=d),Gf(y.return,d,r),D.lanes|=d;break}k=k.next}}else if(y.tag===10)E=y.type===r.type?null:y.child;else if(y.tag===18){if(E=y.return,E===null)throw Error(n(341));E.lanes|=d,D=E.alternate,D!==null&&(D.lanes|=d),Gf(E,d,r),E=y.sibling}else E=y.child;if(E!==null)E.return=y;else for(E=y;E!==null;){if(E===r){E=null;break}if(y=E.sibling,y!==null){y.return=E.return,E=y;break}E=E.return}y=E}dn(o,r,p.children,d),r=r.child}return r;case 9:return p=r.type,h=r.pendingProps.children,ms(r,d),p=Xn(p),h=h(p),r.flags|=1,dn(o,r,h,d),r.child;case 14:return h=r.type,p=li(h,r.pendingProps),p=li(h.type,p),q0(o,r,h,p,d);case 15:return Z0(o,r,r.type,r.pendingProps,d);case 17:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:li(h,p),Vc(o,r),r.tag=1,En(h)?(o=!0,Nc(r)):o=!1,ms(r,d),x0(r,h,p),nh(r,h,p,d),sh(null,r,h,!0,o,d);case 19:return ry(o,r,d);case 22:return Q0(o,r,d)}throw Error(n(156,r.tag))};function Dy(o,r){return lm(o,r)}function yC(o,r,d,h){this.tag=o,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function qn(o,r,d,h){return new yC(o,r,d,h)}function wh(o){return o=o.prototype,!(!o||!o.isReactComponent)}function SC(o){if(typeof o=="function")return wh(o)?1:0;if(o!=null){if(o=o.$$typeof,o===j)return 11;if(o===_e)return 14}return 2}function No(o,r){var d=o.alternate;return d===null?(d=qn(o.tag,r,o.key,o.mode),d.elementType=o.elementType,d.type=o.type,d.stateNode=o.stateNode,d.alternate=o,o.alternate=d):(d.pendingProps=r,d.type=o.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=o.flags&14680064,d.childLanes=o.childLanes,d.lanes=o.lanes,d.child=o.child,d.memoizedProps=o.memoizedProps,d.memoizedState=o.memoizedState,d.updateQueue=o.updateQueue,r=o.dependencies,d.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},d.sibling=o.sibling,d.index=o.index,d.ref=o.ref,d}function rd(o,r,d,h,p,y){var E=2;if(h=o,typeof o=="function")wh(o)&&(E=1);else if(typeof o=="string")E=5;else e:switch(o){case M:return yr(d.children,p,y,r);case F:E=8,p|=8;break;case W:return o=qn(12,d,r,p|2),o.elementType=W,o.lanes=y,o;case ie:return o=qn(13,d,r,p),o.elementType=ie,o.lanes=y,o;case se:return o=qn(19,d,r,p),o.elementType=se,o.lanes=y,o;case ne:return sd(d,p,y,r);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case Z:E=10;break e;case te:E=9;break e;case j:E=11;break e;case _e:E=14;break e;case fe:E=16,h=null;break e}throw Error(n(130,o==null?o:typeof o,""))}return r=qn(E,d,r,p),r.elementType=o,r.type=h,r.lanes=y,r}function yr(o,r,d,h){return o=qn(7,o,h,r),o.lanes=d,o}function sd(o,r,d,h){return o=qn(22,o,h,r),o.elementType=ne,o.lanes=d,o.stateNode={isHidden:!1},o}function Rh(o,r,d){return o=qn(6,o,null,r),o.lanes=d,o}function Ph(o,r,d){return r=qn(4,o.children!==null?o.children:[],o.key,r),r.lanes=d,r.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},r}function vC(o,r,d,h,p){this.tag=r,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ef(0),this.expirationTimes=ef(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ef(0),this.identifierPrefix=h,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function Dh(o,r,d,h,p,y,E,D,k){return o=new vC(o,r,d,D,k),r===1?(r=1,y===!0&&(r|=8)):r=0,y=qn(3,null,null,r),o.current=y,y.stateNode=o,y.memoizedState={element:h,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},xf(y),o}function AC(o,r,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:N,key:h==null?null:""+h,children:o,containerInfo:r,implementation:d}}function Ny(o){if(!o)return Io;o=o._reactInternals;e:{if(rr(o)!==o||o.tag!==1)throw Error(n(170));var r=o;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(En(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(o.tag===1){var d=o.type;if(En(d))return o0(o,d,r)}return r}function My(o,r,d,h,p,y,E,D,k){return o=Dh(d,h,!0,o,p,y,E,D,k),o.context=Ny(null),d=o.current,h=un(),p=Po(d),y=Yi(h,p),y.callback=r??null,Co(d,y,p),o.current.lanes=p,wa(o,p,h),wn(o,h),o}function ad(o,r,d,h){var p=r.current,y=un(),E=Po(p);return d=Ny(d),r.context===null?r.context=d:r.pendingContext=d,r=Yi(y,E),r.payload={element:o},h=h===void 0?null:h,h!==null&&(r.callback=h),o=Co(p,r,E),o!==null&&(ui(o,p,E,y),Uc(o,p,E)),E}function ld(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function Oy(o,r){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var d=o.retryLane;o.retryLane=d!==0&&d<r?d:r}}function Nh(o,r){Oy(o,r),(o=o.alternate)&&Oy(o,r)}function IC(){return null}var ky=typeof reportError=="function"?reportError:function(o){console.error(o)};function Mh(o){this._internalRoot=o}cd.prototype.render=Mh.prototype.render=function(o){var r=this._internalRoot;if(r===null)throw Error(n(409));ad(o,r,null,null)},cd.prototype.unmount=Mh.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var r=o.containerInfo;gr(function(){ad(null,o,null,null)}),r[Hi]=null}};function cd(o){this._internalRoot=o}cd.prototype.unstable_scheduleHydration=function(o){if(o){var r=mm();o={blockedOn:null,target:o,priority:r};for(var d=0;d<mo.length&&r!==0&&r<mo[d].priority;d++);mo.splice(d,0,o),d===0&&vm(o)}};function Oh(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function dd(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function by(){}function TC(o,r,d,h,p){if(p){if(typeof h=="function"){var y=h;h=function(){var x=ld(E);y.call(x)}}var E=My(r,h,o,0,null,!1,!1,"",by);return o._reactRootContainer=E,o[Hi]=E.current,Ga(o.nodeType===8?o.parentNode:o),gr(),E}for(;p=o.lastChild;)o.removeChild(p);if(typeof h=="function"){var D=h;h=function(){var x=ld(k);D.call(x)}}var k=Dh(o,0,!1,null,null,!1,!1,"",by);return o._reactRootContainer=k,o[Hi]=k.current,Ga(o.nodeType===8?o.parentNode:o),gr(function(){ad(r,k,d,h)}),k}function ud(o,r,d,h,p){var y=d._reactRootContainer;if(y){var E=y;if(typeof p=="function"){var D=p;p=function(){var k=ld(E);D.call(k)}}ad(r,E,o,p)}else E=TC(d,r,o,p,h);return ld(E)}gm=function(o){switch(o.tag){case 3:var r=o.stateNode;if(r.current.memoizedState.isDehydrated){var d=_a(r.pendingLanes);d!==0&&(tf(r,d|1),wn(r,It()),(Ve&6)===0&&(Is=It()+500,To()))}break;case 13:gr(function(){var h=Wi(o,1);if(h!==null){var p=un();ui(h,o,1,p)}}),Nh(o,1)}},nf=function(o){if(o.tag===13){var r=Wi(o,134217728);if(r!==null){var d=un();ui(r,o,134217728,d)}Nh(o,134217728)}},pm=function(o){if(o.tag===13){var r=Po(o),d=Wi(o,r);if(d!==null){var h=un();ui(d,o,r,h)}Nh(o,r)}},mm=function(){return tt},ym=function(o,r){var d=tt;try{return tt=o,r()}finally{tt=d}},Vu=function(o,r,d){switch(r){case"input":if(In(o,d),r=d.name,d.type==="radio"&&r!=null){for(d=o;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<d.length;r++){var h=d[r];if(h!==o&&h.form===o.form){var p=Pc(h);if(!p)throw Error(n(90));Ie(h),In(h,p)}}}break;case"textarea":jp(o,d);break;case"select":r=d.value,r!=null&&fo(o,!!d.multiple,r,!1)}},tm=Eh,nm=gr;var EC={usingClientEntryPoint:!1,Events:[Wa,ls,Pc,Jp,em,Eh]},il={findFiberByHostInstance:sr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},CC={bundleType:il.bundleType,version:il.version,rendererPackageName:il.rendererPackageName,rendererConfig:il.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:B.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=sm(o),o===null?null:o.stateNode},findFiberByHostInstance:il.findFiberByHostInstance||IC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var fd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!fd.isDisabled&&fd.supportsFiber)try{cc=fd.inject(CC),vi=fd}catch{}}return Rn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=EC,Rn.createPortal=function(o,r){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Oh(r))throw Error(n(200));return AC(o,r,null,d)},Rn.createRoot=function(o,r){if(!Oh(o))throw Error(n(299));var d=!1,h="",p=ky;return r!=null&&(r.unstable_strictMode===!0&&(d=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),r=Dh(o,1,!1,null,null,d,!1,h,p),o[Hi]=r.current,Ga(o.nodeType===8?o.parentNode:o),new Mh(r)},Rn.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var r=o._reactInternals;if(r===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=sm(r),o=o===null?null:o.stateNode,o},Rn.flushSync=function(o){return gr(o)},Rn.hydrate=function(o,r,d){if(!dd(r))throw Error(n(200));return ud(null,o,r,!0,d)},Rn.hydrateRoot=function(o,r,d){if(!Oh(o))throw Error(n(405));var h=d!=null&&d.hydratedSources||null,p=!1,y="",E=ky;if(d!=null&&(d.unstable_strictMode===!0&&(p=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onRecoverableError!==void 0&&(E=d.onRecoverableError)),r=My(r,null,o,1,d??null,p,!1,y,E),o[Hi]=r.current,Ga(o),h)for(o=0;o<h.length;o++)d=h[o],p=d._getVersion,p=p(d._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[d,p]:r.mutableSourceEagerHydrationData.push(d,p);return new cd(r)},Rn.render=function(o,r,d){if(!dd(r))throw Error(n(200));return ud(null,o,r,!1,d)},Rn.unmountComponentAtNode=function(o){if(!dd(o))throw Error(n(40));return o._reactRootContainer?(gr(function(){ud(null,null,o,!1,function(){o._reactRootContainer=null,o[Hi]=null})}),!0):!1},Rn.unstable_batchedUpdates=Eh,Rn.unstable_renderSubtreeIntoContainer=function(o,r,d,h){if(!dd(d))throw Error(n(200));if(o==null||o._reactInternals===void 0)throw Error(n(38));return ud(o,r,d,!1,h)},Rn.version="18.3.1-next-f1338f8080-20240426",Rn}var xy;function bC(){if(xy)return Bh.exports;xy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Bh.exports=kC(),Bh.exports}var Wy;function BC(){if(Wy)return hd;Wy=1;var e=bC();return hd.createRoot=e.createRoot,hd.hydrateRoot=e.hydrateRoot,hd}var FC=BC();const LC=Bv(FC);class UC{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let i=this.length++;for(;i>0;){const s=i-1>>1,a=this.values[s];if(n>=a)break;this.ids[i]=this.ids[s],this.values[i]=a,i=s}this.ids[i]=t,this.values[i]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let l=(a<<1)+1;const c=l+1;let u=this.ids[l],f=this.values[l];const g=this.values[c];if(c<this.length&&g<f&&(l=c,u=this.ids[c],f=g),f>=i)break;this.ids[a]=u,this.values[a]=f,a=l}this.ids[a]=n,this.values[a]=i}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Yy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Uh=3;class Zg{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[i,s]=new Uint8Array(t,n+0,2);if(i!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==Uh)throw new Error(`Got v${a} data when expected v${Uh}.`);const l=Yy[s&15];if(!l)throw new Error("Unrecognized array type.");const[c]=new Uint16Array(t,n+2,1),[u]=new Uint32Array(t,n+4,1);return new Zg(u,c,l,void 0,t,n)}constructor(t,n=16,i=Float64Array,s=ArrayBuffer,a,l=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=l;let c=t,u=c;this._levelBounds=[c*4];do c=Math.ceil(c/this.nodeSize),u+=c,this._levelBounds.push(u*4);while(c!==1);this.ArrayType=i,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const f=Yy.indexOf(this.ArrayType),g=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(f<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,l+8,u*4),this._indices=new this.IndexArrayType(this.data,l+8+g,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+g+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+g,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Uh<<4)+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new UC}add(t,n,i=t,s=n){const a=this._pos>>2,l=this._boxes;return this._indices[a]=a,l[this._pos++]=t,l[this._pos++]=n,l[this._pos++]=i,l[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),i>this.maxX&&(this.maxX=i),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,i=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let l=0,c=0;l<this.numItems;l++){const u=t[c++],f=t[c++],g=t[c++],m=t[c++],S=Math.floor(a*((u+g)/2-this.minX)/n),v=Math.floor(a*((f+m)/2-this.minY)/i);s[l]=GC(S,v)}vg(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let l=0,c=0;l<this._levelBounds.length-1;l++){const u=this._levelBounds[l];for(;c<u;){const f=c;let g=t[c++],m=t[c++],S=t[c++],v=t[c++];for(let I=1;I<this.nodeSize&&c<u;I++)g=Math.min(g,t[c++]),m=Math.min(m,t[c++]),S=Math.max(S,t[c++]),v=Math.max(v,t[c++]);this._indices[this._pos>>2]=f,t[this._pos++]=g,t[this._pos++]=m,t[this._pos++]=S,t[this._pos++]=v}}}search(t,n,i,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const c=[],u=[];for(;l!==void 0;){const f=Math.min(l+this.nodeSize*4,jy(l,this._levelBounds));for(let g=l;g<f;g+=4){if(i<this._boxes[g]||s<this._boxes[g+1]||t>this._boxes[g+2]||n>this._boxes[g+3])continue;const m=this._indices[g>>2]|0;l>=this.numItems*4?c.push(m):(a===void 0||a(m))&&u.push(m)}l=c.pop()}return u}neighbors(t,n,i=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const c=this._queue,u=[],f=s*s;e:for(;l!==void 0;){const g=Math.min(l+this.nodeSize*4,jy(l,this._levelBounds));for(let m=l;m<g;m+=4){const S=this._indices[m>>2]|0,v=zy(t,this._boxes[m],this._boxes[m+2]),I=zy(n,this._boxes[m+1],this._boxes[m+3]),A=v*v+I*I;A>f||(l>=this.numItems*4?c.push(S<<1,A):(a===void 0||a(S))&&c.push((S<<1)+1,A))}for(;c.length&&c.peek()&1;)if(c.peekValue()>f||(u.push(c.pop()>>1),u.length===i))break e;l=c.length?c.pop()>>1:void 0}return c.clear(),u}}function zy(e,t,n){return e<t?t-e:e<=n?0:e-n}function jy(e,t){let n=0,i=t.length-1;for(;n<i;){const s=n+i>>1;t[s]>e?i=s:n=s+1}return t[n]}function vg(e,t,n,i,s,a){if(Math.floor(i/a)>=Math.floor(s/a))return;const l=e[i+s>>1];let c=i-1,u=s+1;for(;;){do c++;while(e[c]<l);do u--;while(e[u]>l);if(c>=u)break;HC(e,t,n,c,u)}vg(e,t,n,i,u,a),vg(e,t,n,u+1,s,a)}function HC(e,t,n,i,s){const a=e[i];e[i]=e[s],e[s]=a;const l=4*i,c=4*s,u=t[l],f=t[l+1],g=t[l+2],m=t[l+3];t[l]=t[c],t[l+1]=t[c+1],t[l+2]=t[c+2],t[l+3]=t[c+3],t[c]=u,t[c+1]=f,t[c+2]=g,t[c+3]=m;const S=n[i];n[i]=n[s],n[s]=S}function GC(e,t){let n=e^t,i=65535^n,s=65535^(e|t),a=e&(t^65535),l=n|i>>1,c=n>>1^n,u=s>>1^i&a>>1^s,f=n&s>>1^a>>1^a;n=l,i=c,s=u,a=f,l=n&n>>2^i&i>>2,c=n&i>>2^i&(n^i)>>2,u^=n&s>>2^i&a>>2,f^=i&s>>2^(n^i)&a>>2,n=l,i=c,s=u,a=f,l=n&n>>4^i&i>>4,c=n&i>>4^i&(n^i)>>4,u^=n&s>>4^i&a>>4,f^=i&s>>4^(n^i)&a>>4,n=l,i=c,s=u,a=f,u^=n&s>>8^i&a>>8,f^=i&s>>8^(n^i)&a>>8,n=u^u>>1,i=f^f>>1;let g=e^t,m=i|65535^(g|n);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|g)>>>0}function $C(e,t){return t.split(".").reduce((n,i)=>{if(n&&typeof n=="object"&&i in n)return n[i]},e)}function Mi(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new Zg(e.length),i=new Map,s=new Map;for(const l of e)l.width!==void 0&&l.height!==void 0?n.add(l.position.x,l.position.y,l.position.x+l.width,l.position.y+l.height):n.add(l.position.x,l.position.y,l.position.x,l.position.y);return n.finish(),{all(){return e},byRect(l){const{width:c,height:u}=t,f=new Set,g=[];l.left<0?(g.push({left:l.left+c,right:c}),g.push({left:0,right:l.right})):l.right>c?(g.push({left:l.left,right:c}),g.push({left:0,right:l.right-c})):g.push({left:l.left,right:l.right});const m=[];l.top<0?(m.push({top:l.top+u,bottom:u}),m.push({top:0,bottom:l.bottom})):l.bottom>u?(m.push({top:l.top,bottom:u}),m.push({top:0,bottom:l.bottom-u})):m.push({top:l.top,bottom:l.bottom});for(const S of g)for(const v of m){const I=n.search(S.left,v.top,S.right,v.bottom);for(const A of I)f.add(A)}return Array.from(f).map(S=>e[S])},byRadius(l,c){const{width:u,height:f}=t,g=new Set;for(let m=-u;m<=u;m+=u)for(let S=-f;S<=f;S+=f){const v=l.x+m,I=l.y+S,A=Math.max(0,Math.min(v,u)),C=Math.max(0,Math.min(I,f));if((v-A)**2+(I-C)**2<=c**2){const R=n.neighbors(v,I,void 0,c);for(const w of R)g.add(w)}}return Array.from(g).map(m=>e[m])},byProperty(l,c){var u;if(!i.has(l)){const f=new Map;for(const g of e){const m=g[l];f.has(m)||f.set(m,[]),f.get(m).push(g)}i.set(l,f)}return((u=i.get(l))==null?void 0:u.get(c))||[]},byPropertyPath(l,c){var u;if(!s.has(l)){const f=new Map;for(const g of e){const m=$C(g,l);f.has(m)||f.set(m,[]),f.get(m).push(g)}s.set(l,f)}return((u=s.get(l))==null?void 0:u.get(c))||[]},resetPropertyCache(){i.clear(),s.clear()},count(){return e.length}}}const ea=80,$n=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],Re=20,Ct=24,Dt=10,Ke=4e3,Qe=4e3,Qg=2,xC=15,WC=5e3,no=100,io=20,oo=60,Fv=200,YC=1e3,ta=1,na=150*.6,Xy=150*.25,zC=150*.7,jC=150*.8,XC=400,Lv=800,VC=150,KC=300,qC=2,Vy=800,ZC=500,QC=150*.85,JC=150,Uv=3,e_=24,Hv=600,t_=1,n_=1,i_=.5,o_=1,r_=.5,s_=2,Os=24,Ls=12,a_=24,l_=1.5,c_=150,d_=200,u_=100,f_=.7,h_=300,g_=400,Hh=600,p_=600,Vd=.15,Ag=200,Ks=30*.75*1.2,Gv=20,$v=.3,xv=.6,Wv=.8,m_=1,y_=3,S_=5,v_=6,Ky=.5,A_=.4,I_=.6,T_=.8,E_=2,Zi=Ke/2,qy=2,Ig=.7,Tg=.5,Us=10,C_=.5,qs=400,Yv=800,__=8,Zy=5,w_=16,zv=5,jv=600,Qi=100,R_=100,Xv=150,Qy=600,Jy=250,P_=.5,D_=.7,N_=300,M_=150;function ti(e,t){return{x:e.x+t.x,y:e.y+t.y}}function O_(e,t){return{x:e.x-t.x,y:e.y-t.y}}function At(e,t){return{x:e.x*t,y:e.y*t}}function ia(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function ot(e){const t=ia(e);return t===0?{x:0,y:0}:At(e,1/t)}function Jg(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function Kd(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,i)=>({x:n.x+i.x,y:n.y+i.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Xe(e,t,n,i){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>i/2&&(a=a-Math.sign(a)*i),{x:s,y:a}}function $e(e,t,n){const i=Xe(e,t,n.width,n.height);return ot(i)}function U(e,t,n,i){const s=Xe(e,t,n,i);return ia(s)}function Vv(e,t){return e.x*t.x+e.y*t.y}function k_(e,t){const n=Vv(e,t),i=ia(e),s=ia(t);if(i===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(i*s)));return Math.acos(a)}function Eg(e,t){const n=Math.cos(t),i=Math.sin(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function b_(e,t,n){const i=Math.max(0,Math.min(1,n)),s={r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16)},a={r:parseInt(t.substring(1,3),16),g:parseInt(t.substring(3,5),16),b:parseInt(t.substring(5,7),16)},l=Math.round(s.r+(a.r-s.r)*i),c=Math.round(s.g+(a.g-s.g)*i),u=Math.round(s.b+(a.b-s.b)*i),f=g=>("00"+g.toString(16)).slice(-2);return`#${f(l)}${f(c)}${f(u)}`}const gu=10,bl=80,Kv=3,rl=5,on=150,ep=on*.8,B_=on*.2,rn=on*.8,qo=30,qv=10,F_=10,L_=.5,ze=30,Wr=ze*.75,pu=30,Kl=pu*.75,Zv=50,U_=20,H_=bl*.8,G_=.7,Bl=16,mu=40,$_=24,tp=16,x_=72/3,eS=24,W_=1.25,Y_=1.5,oa=on*.6,yu=50,z_=1,j_=350,np=bl*.65,X_=80,V_=50,K_=1,q_=128,Qv=10,tS=100,ip=35,co=30,Su=.5,vu=2.5,op=20,Sn=250,rp=.4,sp=150,ap=6,Z_=5,lp=2,Au=.5,Iu=1.5,Q_=1,J_=.5,ew=.5,tw=1.5,nw=.25,iw=2.5,ow=45,rw=.05,sw=200;var Ut=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(Ut||{}),je=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e[e.SupplyChain=5]="SupplyChain",e))(je||{}),Yr=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(Yr||{});const qd=24,aw=24;let lw=0;function cw(){return`notification-${Date.now()}-${lw++}`}function Fl(e,t){if(t.identifier){const i=e.notifications.find(s=>s.identifier===t.identifier);if(i){if(i.dismissedUntil&&e.time<i.dismissedUntil)return;i.message=t.message,i.timestamp=e.time,i.creationTime=Date.now(),i.duration=t.duration,i.targetEntityIds=t.targetEntityIds,i.highlightedEntityIds=t.highlightedEntityIds,i.targetPosition=t.targetPosition,i.targetArea=t.targetArea,i.targetRadius=t.targetRadius,i.isDismissed=!1,i.dismissedUntil=void 0;return}}const n={...t,id:cw(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function dw(e,t){const n=e.notifications.find(i=>i.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+aw))}function uw(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function fw(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const i of n.highlightedEntityIds){const s=e.entities.entities[i];s&&(s.isHighlighted=!0)}}const ce={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire"},tr={[ce.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[ce.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[ce.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[ce.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}}},hw=.5,gw="#FFA500",pw="#FF4500",nS=4,mw=10,cp=60;function dp(e){return tr[e].dimensions}function yw(e){return tr[e].constructionTimeHours}function Sw(e){return tr[e].destructionTimeHours}function vw(e,t,n,i,s){var l;(l=e.onExit)==null||l.call(e,i,t);const a=s.find(({id:c})=>c===t);return a!=null&&a.onEnter?a.onEnter(i,n):{...n,enteredAt:i.updateContext.gameState.time}}function Aw(e,t){return t.find(({id:n})=>n===e)}function Iw(e,t){return e!==t}function Tw(e){console.warn(`No handler found for state: ${e}`)}const Cl="bushGrowing",Nr="bushFull",Ld="bushSpreading",Ll="bushDying",Ew=5,Cw=3,_w=12,ww=940,Cg=20,iS=90,Jv=100,uo=5,Rw=.5,Zo=30,ro=.1,Sl=.9,Pw=2,Dw=2;var An=(e=>(e.Berry="berry",e.Meat="meat",e))(An||{});const up={berry:"",meat:""};function eA(e,t){return`${e},${t}`}function tA(e){const[t,n]=e.split(",").map(Number);return{gridX:t,gridY:n}}function Nw(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function nA(){return{lastUpdateTime:0,sectors:{}}}const Xt=20,Zd=100,iA=20,oA=0,Mw=20,Ow=1,rA=.15,kw=.5,bw=.01,Bw=24,Fw="#6B5344",Lw="#4A3728",oS=.85,sA=35,Uw=30,rS=1.25,sS=40,Gh=Math.PI/6,aA=.5,Hw=1;function fp(e,t,n,i){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,l={x:Math.cos(s)*a,y:Math.sin(s)*a},c=ti(e,l);return{x:(c.x%n+n)%n,y:(c.y%i+i)%i}}function Wn(e,t,n,i){const s=t,a={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},l=[...s.search.human.byRect(a),...s.search.berryBush.byRect(a),...s.search.corpse.byRect(a)];for(const c of l){if(i!==void 0&&c.id===i)continue;if(U(e,c.position,t.mapDimensions.width,t.mapDimensions.height)<n+c.radius)return!0}return!1}function Gw(e,t,n,i,s){const a=t.mapDimensions.width,l=t.mapDimensions.height;if(!Wn(e,t,i,s)&&!Fi(t.soilDepletion,e,a,l))return e;const c=i;for(let u=c;u<=n;u+=c){const f=Math.ceil(2*Math.PI*u/c);for(let g=0;g<f;g++){const m=g/f*2*Math.PI,S={x:Math.cos(m)*u,y:Math.sin(m)*u},v=ti(e,S),I={x:(v.x%a+a)%a,y:(v.y%l+l)%l};if(!Wn(I,t,i,s)&&!Fi(t.soilDepletion,I,a,l))return I}}return null}function ni(e,t){var l,c;const n=t;if((c=(l=n.cache)==null?void 0:l.tribeCenters)!=null&&c[e])return n.cache.tribeCenters[e];const i=t.search.building.byProperty("ownerId",e);if(i.length>0){const u=i.map(f=>f.position);return n.cache.tribeCenters[e]=Kd(u)}const s=Ui(e,t);if(s.length===0){const u=t.entities.entities[e];return n.cache.tribeCenters[e]=u?u.position:{x:0,y:0}}const a=s.map(u=>u.position);return n.cache.tribeCenters[e]=Kd(a)}function aS(e,t){const i=[...zl(e,t),e].map(s=>s.position);return Kd(i)}function _g(e,t,n){const i=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,l=e.y-t.position.y;return Math.abs(a)>i/2&&(a-=Math.sign(a)*i),Math.abs(l)>s/2&&(l-=Math.sign(l)*s),Math.abs(a)<=t.width/2&&Math.abs(l)<=t.height/2}var yt=(e=>(e.Wood="wood",e))(yt||{});const hp={wood:""},eo=100,lA=20,so=10,$w=.5,br=150,xw=25,Ww=.5,Br=100,cA=25,gp=.5,dA=15,Qd=4,Yw=.75,zw=15,wg=8,uA=20,jw=.5,ga=(e,t,n)=>{var c,u,f,g;if(!e||!t||e===t)return!1;const i=n.entities.entities[e],s=n.entities.entities[t],a=(u=(c=i==null?void 0:i.tribeControl)==null?void 0:c.diplomacy)==null?void 0:u[t],l=(g=(f=s==null?void 0:s.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[e];return a===Ut.Hostile||l===Ut.Hostile},Vr=(e,t,n)=>e.id===t.id?!1:ga(e.leaderId,t.leaderId,n),Vt=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:ga(e.leaderId,t.ownerId,n),nr=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=rn||t.hunger>=rn||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||Vr(e,t,n))return!1;const i=e.gender==="female"?e:t;return!(i.isPregnant||i.age>mu)};function Xw(e){const t=Math.floor(e.x/Re),n=Math.floor(e.y/Re);return{x:t,y:n}}function Vw(e,t){const n=Math.ceil(t/Re),i=e%n*Re+Re/2,s=Math.floor(e/n)*Re+Re/2;return{x:i,y:s}}function Kw(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(i/Re),l=Math.floor(s/Re),c=Math.ceil(t/Re);return l*c+a}function bi(e,t,n){const i=Kw({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[i]||null}function fA(e,t){return t.terrainOwnership.includes(e)}function hA(e,t,n,i){var l;const s=n;return(l=s.search)!=null&&l.human?s.search.human.byRadius(e,i).some(c=>ga(t,c.leaderId,n)):!1}function qw(e,t,n,i,s=!1,a){if(s&&a&&hA(e,a,i,Xv))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:l,height:c}=i.mapDimensions,u=Math.ceil(l/Re),f=Math.ceil(c/Re),g=Math.ceil(t/Re),m=Math.floor(e.x/Re),S=Math.floor(e.y/Re);let v=!1,I=!1;for(let A=-g;A<=g;A++)for(let C=-g;C<=g;C++){const P=((m+C)%u+u)%u,R=((S+A)%f+f)%f,w=P*Re+Re/2,B=R*Re+Re/2;if(U(e,{x:w,y:B},l,c)<=t){const N=R*u+P,M=i.terrainOwnership[N];if(M===n)v=!0;else if(M!==null){if(s&&a&&ga(a,M,i))continue;I=!0}}}return I?{valid:!1,reason:"Position overlaps with another tribe's territory"}:v?{valid:!0}:fA(n,i)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function gA(e,t,n,i){if(!fA(n,i))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(hA(e,n,i,Xv))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=i.mapDimensions,l=Math.ceil(s/Re),c=Math.ceil(a/Re),u=Math.ceil(t/Re),f=Math.floor(e.x/Re),g=Math.floor(e.y/Re);let m=!1;for(let S=-u;S<=u;S++){for(let v=-u;v<=u;v++){const I=((f+v)%l+l)%l,A=((g+S)%c+c)%c,C=I*Re+Re/2,P=A*Re+Re/2;if(U(e,{x:C,y:P},s,a)<=t){const w=A*l+I;if(i.terrainOwnership[w]===n){m=!0;break}}}if(m)break}return m?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function pA(e,t,n,i=0,s=!1,a){if(i>0){const c=qw(e,i,t,n,s,a);return c.valid?{canPlace:!0}:{canPlace:!1,reason:c.reason}}const l=bi(e.x,e.y,n);return l===null||l===t?{canPlace:!0}:s&&a&&ga(a,l,n)?{canPlace:!0}:l!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function Rg(e,t,n){const i=bi(e.x,e.y,n);return i===null||i===t}function ao(e,t,n){const i=bi(e.x,e.y,n);return i===null||i===t}function Zw(e,t,n,i){if(Rg(t,n,i))return t;const{width:s,height:a}=i.mapDimensions,l=Xe(e,t,s,a),c=Math.sqrt(l.x**2+l.y**2);if(c===0)return e;let u=e;const f=U(e,t,s,a),g=f/10;for(let m=g;m<=f;m+=g){const S={x:((e.x+l.x*m/c)%s+s)%s,y:((e.y+l.y*m/c)%a+a)%a};if(Rg(S,n,i))u=S;else break}return u}function mA(e,t,n,i,{allowOverwrite:s}){const{width:a,height:l}=i.mapDimensions,c=Math.ceil(a/Re),u=Math.ceil(l/Re),f=Math.ceil(t/Re),g=Math.floor(e.x/Re),m=Math.floor(e.y/Re);for(let R=-f;R<=f;R++)for(let w=-f;w<=f;w++){const B=((g+w)%c+c)%c,O=((m+R)%u+u)%u,N=B*Re+Re/2,M=O*Re+Re/2;if(U(e,{x:N,y:M},a,l)<=t){const W=O*c+B,Z=i.terrainOwnership[W];(s||Z===null||Z===n)&&(i.terrainOwnership[W]=n)}}const S=3,v=f+S+2,I=[];for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const B=((g+w)%c+c)%c,O=((m+R)%u+u)%u,N=O*c+B;if(i.terrainOwnership[N]===null){let M=!1;const F=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const W of F){let Z=!1,te=!1;for(let j=1;j<=S;j++){const ie=((B+W.x*j)%c+c)%c,_e=((O+W.y*j)%u+u)%u*c+ie;if(i.terrainOwnership[_e]===n){Z=!0;break}}if(Z)for(let j=1;j<=S;j++){const ie=((B-W.x*j)%c+c)%c,_e=((O-W.y*j)%u+u)%u*c+ie;if(i.terrainOwnership[_e]===n){te=!0;break}}if(Z&&te){M=!0;break}}M&&I.push(N)}}for(const R of I)i.terrainOwnership[R]=n;const A=250,C=new Set;for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const B=((g+w)%c+c)%c,N=((m+R)%u+u)%u*c+B;if(i.terrainOwnership[N]===null&&!C.has(N)){const M=[],F=[N];C.add(N),M.push(N);let W=!0,Z=0;for(;Z<F.length;){const te=F[Z++];if(M.length>A){W=!1;break}const j=te%c,ie=Math.floor(te/c),se=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:_e,ny:fe}of se){const ne=((j+_e)%c+c)%c,V=((ie+fe)%u+u)%u*c+ne;i.terrainOwnership[V]===null&&!C.has(V)&&(C.add(V),W&&(M.push(V),F.push(V)))}}if(W&&M.length<=A)for(const te of M)i.terrainOwnership[te]=n}}const P=[];for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const B=((g+w)%c+c)%c,O=((m+R)%u+u)%u,N=O*c+B;if(i.terrainOwnership[N]===null){let M=0;for(let F=-1;F<=1;F++)for(let W=-1;W<=1;W++){if(W===0&&F===0)continue;const Z=((B+W)%c+c)%c,j=((O+F)%u+u)%u*c+Z;i.terrainOwnership[j]===n&&M++}M>=5&&P.push(N)}}for(const R of P)i.terrainOwnership[R]=n}function yA(e,t,n,i){mA(e,t,n,i,{allowOverwrite:!1})}function SA(e,t,n,i){mA(e,t,n,i,{allowOverwrite:!0})}function vA(e,t,n){const{width:i,height:s}=n.mapDimensions,a=Math.ceil(i/Re),l=Math.ceil(s/Re),c=Math.floor(e.x/Re),u=Math.floor(e.y/Re),f=50;for(let g=0;g<=f;g++){const m=-g,S=g,v=-g,I=g;for(let A=v;A<=I;A++)for(let C=m;C<=S;C++){if(g>0&&C>m&&C<S&&A>v&&A<I)continue;const P=((c+C)%a+a)%a,R=((u+A)%l+l)%l,w=R*a+P;if(n.terrainOwnership[w]===t){let B=!1;const O=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:N,ny:M}of O){const F=((P+N)%a+a)%a,Z=((R+M)%l+l)%l*a+F;if(n.terrainOwnership[Z]!==t){B=!0;break}}if(B)return{x:P*Re+Re/2,y:R*Re+Re/2}}}}return null}function Jd(e,t,n){const i=e.terrainOwnership;for(let s=0;s<i.length;s++)i[s]===t&&(i[s]=n)}const sn="treeGrowing",Kt="treeFull",vn="treeSpreading",Gt="treeFallen",lo="treeStump",zr="treeDying",Qw=500;function Jw(e,t){if(!e.leaderId)return 0;const n=eR(e.leaderId,t),i=tR(e.leaderId,t);return i===0?0:Math.min(1,n/i)}function eR(e,t){const n=Nn({leaderId:e},t),i=Kr(e,t),s=n.reduce((l,c)=>l+c.food.length,0),a=i.reduce((l,c)=>{var f;const u=(f=c.storedItems)==null?void 0:f.filter(g=>g.item.type===An.Berry||g.item.type===An.Meat);return l+((u==null?void 0:u.length)||0)},0);return s+a}function tR(e,t){const n=Nn({leaderId:e},t),i=Kr(e,t),s=n.reduce((l,c)=>l+c.maxFood,0),a=i.reduce((l,c)=>l+(c.storageCapacity||0),0);return s+a}function pp(e,t,n=!1){const i=Kr(e,t,n);if(i.length===0)return 0;const s=i.reduce((l,c)=>{var u;return l+(((u=c.storedItems)==null?void 0:u.length)||0)},0),a=i.reduce((l,c)=>l+(c.storageCapacity||0),0);return a===0?0:Math.min(1,s/a)}function Ul(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const n=Nn({leaderId:e},t),i=0,l=t.search.building.byProperty("ownerId",e).reduce((I,A)=>{if(A.isConstructed)return I;const C=tr[A.buildingType].cost.wood||0;return I+C},0),u=jr(e,t).reduce((I,A)=>{const P=(A.maxFuelLevel||Br)-(A.fuelLevel||0);if(P<=0)return I;const R=Math.ceil(P/cA),w=A.storedItems.filter(O=>O.item.type===yt.Wood).length,B=Math.max(0,R-w);return I+B},0),g=Kr(e,t).reduce((I,A)=>{var P;const C=(P=A.storedItems)==null?void 0:P.filter(R=>R.item.type===yt.Wood);return I+((C==null?void 0:C.length)||0)},0),m=n.reduce((I,A)=>{var C;return I+(((C=A.heldItem)==null?void 0:C.type)===yt.Wood?1:0)},0),S=g+m,v=l+u+i;return t.cache.tribeWoodNeeds[e]=Math.max(0,v-S),t.cache.tribeWoodNeeds[e]}function AA(e,t){const n=t;if(e&&n.cache.tribeAvailableWoodOnGround[e]!==void 0)return n.cache.tribeAvailableWoodOnGround[e];const i=n.search.tree.all().filter(s=>{var l;return!(((l=s.stateMachine)==null?void 0:l[0])===Gt)||s.wood.length===0?!1:ao(s.position,e,t)});return n.cache.tribeAvailableWoodOnGround[e]=i.reduce((s,a)=>s+a.wood.length,0),n.cache.tribeAvailableWoodOnGround[e]}function IA(e,t){const n=Nn({leaderId:e},t);if(n.length===0)return{count:0,ratio:0};const i=nR(e,t);return{count:i,ratio:i/n.length}}function nR(e,t){const n=t;return n.search.berryBush.all().filter(a=>n.search.terrainOwnership.byRadius(a.position,a.radius).some(l=>l.ownerId===e)).filter(a=>{const l=a.stateMachine&&a.stateMachine[0]==="bushDying",c=a.food.length>0,u=Fi(t.soilDepletion,a.position,t.mapDimensions.width,t.mapDimensions.height);return!l&&c&&!u}).length}function ql(e,t,n=!1){const i=typeof e=="object"?e.leaderId:e;return i?t.search.building.byProperty("buildingType",ce.PlantingZone).filter(a=>{if(!n&&!a.isConstructed)return!1;if(a.ownerId){const l=t.entities.entities[a.ownerId];return l&&l.leaderId===i}return!1}):[]}function iR(e,t){const{width:n,height:i,position:s}=e,{width:a,height:l}=t.mapDimensions,{depletedSectors:c,totalSectorsCount:u}=RA(t.soilDepletion,s,n,i,a,l);return u===0?!0:c.length/u<.25}function mp(e){const t=Zo*2,n=Math.floor(e.width/t),i=Math.floor(e.height/t);return n*i}function TA(e,t){const n=t,i=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,i).filter(l=>{const c=Math.abs(l.position.x-e.position.x),u=Math.abs(l.position.y-e.position.y);return c<=e.width/2&&u<=e.height/2}).length}function oR(e,t){if(!e.leaderId)return[];const n=Kr(e.leaderId,t),i=Nn(e,t);return n.map(s=>{var f;const a=s.storageCapacity||0,l=((f=s.storedItems)==null?void 0:f.length)||0,c=i.filter(g=>{if(g.activeAction!=="depositing")return!1;if(typeof g.target=="object"&&"x"in g.target){const m=g.target;return U(m,s.position,t.mapDimensions.width,t.mapDimensions.height)<=50}return!1}).length,u=U(e.position,s.position,t.mapDimensions.width,t.mapDimensions.height);return{storage:s,capacity:a,currentItems:l,assignedDepositors:c,distance:u}})}function EA(e,t){const n=oR(e,t);if(n.length===0)return null;const i=n.filter(s=>{const a=s.currentItems<s.capacity,l=s.distance<=Qw;return a&&l});return i.length===0?null:(i.sort((s,a)=>{const l=s.currentItems/s.capacity,c=a.currentItems/a.capacity;return Math.abs(l-c)>.1?l-c:s.assignedDepositors!==a.assignedDepositors?s.assignedDepositors-a.assignedDepositors:s.distance-a.distance}),i[0].storage)}function rR(e,t){if(!e.leaderId)return null;const i=jr(e.leaderId,t).filter(s=>{const a=s.storageCapacity||Qd;return s.storedItems.length<a});if(i.length>0){const s=i.filter(a=>{const l=a.fuelLevel??0,c=a.maxFuelLevel??Br;return l<c*gp});return s.length>0?(s.sort((a,l)=>{const c=a.fuelLevel??0,u=l.fuelLevel??0,f=a.maxFuelLevel??Br,g=l.maxFuelLevel??Br,m=c/f,S=u/g,v=m<.25,I=S<.25;return v!==I?v?-1:1:c-u}),s[0]):(i.sort((a,l)=>{const c=U(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height),u=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);return c-u}),i[0])}return EA(e,t)}function CA(e,t,n){return Nn({leaderId:e},t).filter(s=>s.activeAction===n).length}function Kr(e,t,n=!1){return t.search.building.byProperty("buildingType",ce.StorageSpot).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function jr(e,t,n=!1){return t.search.building.byProperty("buildingType",ce.Bonfire).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function sR(e,t){const n=ql(e,t);if(n.length===0)return null;const i=t.mapDimensions.width,s=t.mapDimensions.height,a=t.soilDepletion;for(const l of n){const c=mp(l);if(TA(l,t)>=c)continue;const f=20;for(let g=0;g<f;g++){const m=l.position.x+(Math.random()-.5)*l.width,S=l.position.y+(Math.random()-.5)*l.height,v={x:(m%i+i)%i,y:(S%s+s)%s};if(!Fi(a,v,i,s)&&!Wn(v,t,Zo))return{position:v,zoneId:l.id}}}return null}function Zl(e,t,n=void 0){return n?ql(n,t).some(l=>_g(e,l,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===ce.PlantingZone&&_g(e,a,t))}function Tu(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/Xt),gridY:Math.floor(s/Xt)}}function _A(e,t,n){const i=eA(t,n);return e.sectors[i]||(e.sectors[i]=Nw()),e.sectors[i]}function yp(e,t,n){const i=eA(t,n),s=e.sectors[i];return s?s.health:Zd}function Fi(e,t,n,i){const{gridX:s,gridY:a}=Tu(t,n,i);return yp(e,s,a)<iA}function wA(e,t,n){return yp(e,t,n)>=iA}function aR(e,t,n,i,s,a,l){const{gridX:c,gridY:u}=Tu(t,s,a),f=_A(e,c,u),g=f.lastAffectedBy[n]||0;if(i-g<rA)return;const m=Zl(t,l)?aA:1,S=Ow*m;f.health=Math.max(oA,f.health-S),f.lastWalkTime=i,f.lastAffectedBy[n]=i}function lR(e,t,n,i,s,a){const{gridX:l,gridY:c}=Tu(t,i,s),u=_A(e,l,c),f=Zl(t,a)?aA:1,g=Mw*f;u.health=Math.max(oA,u.health-g),u.lastPlantTime=n}function cR(e,t,n,i,s){let a=0;for(let l=-1;l<=1;l++)for(let c=-1;c<=1;c++){if(l===0&&c===0)continue;const u=((t+l)%i+i)%i,f=((n+c)%s+s)%s;wA(e,u,f)&&a++}return a}function dR({soilDepletion:e,time:t,mapDimensions:{width:n,height:i}}){if(t-e.lastUpdateTime<Hw)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/Xt),l=Math.ceil(i/Xt),c=[];for(const u of Object.keys(e.sectors)){const f=e.sectors[u],g=Math.max(f.lastWalkTime,f.lastPlantTime);if(t-g<Bw)continue;const{gridX:m,gridY:S}=tA(u),v=cR(e,m,S,a,l),I=v>0?bw*(v/8):0,A=kw+I;f.health=Math.min(Zd,f.health+A*s),f.health>=Zd&&c.push(u);const C=t-rA*10;for(const P of Object.keys(f.lastAffectedBy))f.lastAffectedBy[Number(P)]<C&&delete f.lastAffectedBy[Number(P)]}for(const u of c)delete e.sectors[u]}function uR(e,t){const n=[];for(const i of Object.keys(e.sectors)){const s=e.sectors[i];if(s.health<t){const{gridX:a,gridY:l}=tA(i);n.push({gridX:a,gridY:l,health:s.health})}}return n}function RA(e,t,n,i,s,a){const l=[],c=n/2,u=i/2,f=t.x-c,g=t.x+c,m=t.y-u,S=t.y+u,v=Math.floor(f/Xt),I=Math.floor((g-.001)/Xt),A=Math.floor(m/Xt),C=Math.floor((S-.001)/Xt),P=Math.ceil(s/Xt),R=Math.ceil(a/Xt);let w=0;for(let B=v;B<=I;B++)for(let O=A;O<=C;O++){w++;const N=(B%P+P)%P,M=(O%R+R)%R;wA(e,N,M)||l.push({gridX:N,gridY:M})}return{depletedSectors:l,totalSectorsCount:w}}function lS(e,t,n,i,s){const{gridX:a,gridY:l}=Tu(t,n,i),c=yp(e,a,l);return 1+(s-1)*Math.sqrt(1-c/Zd)}const fR={id:Cl,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ct/Dt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Ll,data:{...e,enteredAt:i.gameState.time}};if(!Fi(i.gameState.soilDepletion,n.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)){const l=Zl(n.position,i.gameState)?Dw:1;n.timeSinceLastBerryRegen+=s*l,n.timeSinceLastBerryRegen>=_w&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:An.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:Nr,data:{...e,enteredAt:i.gameState.time,previousState:Cl}}:{nextState:Cl,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},hR={id:Nr,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ct/Dt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Ll,data:{...e,enteredAt:i.gameState.time,previousState:Nr}};if(n.food.length<n.maxFood)return{nextState:Cl,data:{...e,enteredAt:i.gameState.time,previousState:Nr}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=iS){n.timeSinceLastSpreadAttempt=0;const l=i.gameState.time-n.timeSinceLastHarvest>=iS,c=Zl(n.position,i.gameState)?Pw:1,u=i.gameState.ecosystem.berryBushSpreadChance*c;if(l&&Math.random()<u)return{nextState:Ld,data:{...e,enteredAt:i.gameState.time,previousState:Nr}}}return{nextState:Nr,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},gR={id:Ld,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i,a=i.deltaTime*(Ct/Dt);if(n.age+=a,n.age>=n.lifespan)return{nextState:Ll,data:{...e,enteredAt:s.time,previousState:Ld}};const l=fp(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Wn(l,s,15)||nc(s.entities,l,s.time),{nextState:Nr,data:{...e,enteredAt:s.time,previousState:Ld}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},pR={id:Ll,update:e=>({nextState:Ll,data:e}),onEnter:(e,t)=>(Zr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},mR=[fR,hR,gR,pR],mt="humanIdle",Pr="humanMoving",vl="humanEating",pa="humanGathering",_l="humanDepositing",wl="humanRetrieving",Or="humanProcreating",Qo="humanAttacking",Ud="humanPlanting",Sp="humanChopping",yR={id:mt,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:Qo,data:{...e,enteredAt:i.gameState.time,previousState:mt,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:(n.hunger>=ep?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:i.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:Pr,data:{...e,enteredAt:i.gameState.time,previousState:mt,target:n.target}}:n.activeAction==="gathering"?{nextState:pa,data:{...e,enteredAt:i.gameState.time,previousState:mt,target:n.target}}:n.activeAction==="eating"?{nextState:vl,data:{...e,enteredAt:i.gameState.time,previousState:mt}}:n.activeAction==="planting"&&n.target?{nextState:Ud,data:{...e,enteredAt:i.gameState.time,previousState:mt,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:_l,data:{...e,enteredAt:i.gameState.time,previousState:mt}}:n.activeAction==="retrieving"?{nextState:wl,data:{...e,enteredAt:i.gameState.time,previousState:mt}}:n.activeAction==="chopping"&&n.target?{nextState:Sp,data:{...e,enteredAt:i.gameState.time,previousState:mt,state:"chopping"}}:{nextState:mt,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function PA(e,t=1){let n=F_;return e.hunger>=ep&&(n*=L_),e.age>=H_&&(n*=G_),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const $h=7.5;class SR{constructor(){De(this,"id",Pr)}update(t,n){var S;const{entity:i,updateContext:s}=n;if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:Qo,data:{...t,enteredAt:s.gameState.time,previousState:Pr,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:Pr}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(S=n.updateContext.gameState.entities.entities[i.target])==null?void 0:S.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*$h*2,y:i.position.y+i.direction.y*$h*2}),!a)return{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:Pr}};const{width:l,height:c}=s.gameState.mapDimensions,u=U(i.position,a,l,c);if(u<$h)return{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:Pr}};const f=Xe(i.position,a,l,c),g=ot(f);if(u>sS){const v=Eg(g,-Gh),I=Eg(g,Gh),A=[g,v,I],C=A.map((R,w)=>{const B=ti(i.position,At(R,sS)),O={x:(B.x%l+l)%l,y:(B.y%c+c)%c},N=lS(s.gameState.soilDepletion,O,l,c,rS),F=Math.cos(w===0?0:Gh);return N*F});let P=0;for(let R=1;R<C.length;R++)C[R]>C[P]&&(P=R);i.direction=A[P]}else i.direction=g;const m=lS(s.gameState.soilDepletion,i.position,l,c,rS);return i.acceleration=PA(i,m),{nextState:Pr,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const vR=new SR,qe=1,Hl=3;function Ge(e,t,n,i,s,a,l){const c={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:i,entityId:s,targetPosition:a,targetEntityId:l};return e.visualEffects.push(c),e.nextVisualEffectId++,c.id}var Ee=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(Ee||{});const cS=600,AR=1.5,DA=.1,xh=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,Wh=""+new URL("gather-CU75596W.mp3",import.meta.url).href,IR=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,dS=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,TR=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,ER=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,CR=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,_R=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,wR=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,RR=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Ce=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Ce||{});const PR=new Map([[0,xh],[1,Wh],[2,IR],[3,dS],[4,TR],[5,ER],[6,CR],[12,_R],[13,wR],[7,xh],[8,dS],[9,Wh],[10,Wh],[11,xh],[14,RR]]);let sl,Gl;function DR(){if(!(typeof window>"u"))return Gl}function vp(){if(!(typeof window>"u"))return!sl&&typeof window.AudioContext=="function"&&(sl=new window.AudioContext,Gl=sl.createGain(),Gl.connect(sl.destination),Rl(.1,!1)),sl}function Rl(e,t){Gl&&(Gl.gain.value=t?0:e/10)}const NA=new Map;let gd=!1,uS=!1;async function NR(){if(uS||gd)return;const e=vp();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),gd=!0,console.log("Starting sound loading...");const t=[];PR.forEach((n,i)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{NA.set(i,a)}).catch(a=>{console.error(`Error loading sound ${Ce[i]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),uS=!0,gd=!1,console.log("All sounds loaded successfully.")}catch(n){gd=!1,console.error("An error occurred while loading sounds:",n)}}const Pl=new Map;function Ap(e,t){const n=vp(),i=DR();if(!n||!i||i.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=NA.get(e);if(!s){console.warn(`Sound buffer not found for type: ${Ce[e]}`);return}if(t!=null&&t.trackId&&Pl.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const l=n.createGain(),c=n.createStereoPanner();let u=l;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const f=Xe(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),g=U(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(g>cS)return;const m=1-Math.pow(g/cS,AR);l.gain.value=Math.max(0,m);const S=Math.sin(f.x/g*(Math.PI/2));c.pan.value=isNaN(S)?0:S,l.connect(c),u=c}else{const f=e===Ce.GameOver?.4:e===Ce.SoundTrack1?1:.2;l.gain.value=f}a.connect(u),u.connect(i),a.start(0),t!=null&&t.trackId&&(Pl.set(t.trackId,{sourceNode:a,gainNode:l}),a.onended=()=>{Pl.delete(t.trackId)})}function Yh(e,t=1){const n=Pl.get(e),i=vp();if(n&&i){const{sourceNode:s,gainNode:a}=n,l=i.currentTime;a.gain.setValueAtTime(a.gain.value,l),a.gain.linearRampToValueAtTime(0,l+t),s.stop(l+t),s.onended=null,Pl.delete(e)}}function Me(e,t,n){const i=vt(e.gameState);i&&Ap(t,{position:n,listenerPosition:i.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}const MR={id:vl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:mt,data:{...e,enteredAt:i.gameState.time,previousState:vl}}:(n.food.length>0&&(!n.eatingCooldownTime||i.gameState.time>=n.eatingCooldownTime)&&n.hunger>qo&&(n.hunger=Math.max(0,n.hunger-qo),n.food.pop(),n.eatingCooldownTime=i.gameState.time+1,Me(i,Ce.Eat,n.position),(!n.lastEatingEffectTime||i.gameState.time-n.lastEatingEffectTime>2)&&(Ge(i.gameState,Ee.Eating,n.position,qe,n.id),n.lastEatingEffectTime=i.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:mt,data:{...e,enteredAt:i.gameState.time,previousState:vl}}:{nextState:vl,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class OR{constructor(){De(this,"id",pa)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const kR=new OR,bR={id:_l,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:mt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:_l}}:{nextState:_l,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},BR={id:wl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:mt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:wl}}:{nextState:wl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},FR=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),LR=(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time<(e.procreationEndTime||0))return{nextState:Or,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<rn&&a.hunger<rn&&!n.procreationCooldown&&!a.procreationCooldown){const l=n.gender==="female"?n:a.gender==="female"?a:void 0,c=n.gender==="male"?n:a.gender==="male"?a:void 0;l&&c&&(l.isPregnant=!0,l.gestationTime=x_,l.pregnancyFatherId=c.id,n.procreationCooldown=eS,a.procreationCooldown=eS,Me(i,Ce.Procreate,l.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:mt,data:{...e,enteredAt:s.time,previousState:Or}}},UR={id:Or,onEnter:FR,update:LR},HR={id:Qo,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:mt,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:mt,data:{...e}};const i=U(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Xe(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=ot(s),i<=co||i<=Sn&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=PA(t.entity),{nextState:Qo,data:e}}},GR={id:Ud,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time-e.enteredAt>=Rw){const l=n.food.filter(u=>u.type===An.Berry).length,c=Fi(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(l>=uo&&!c){for(let u=0;u<uo;u++){const f=n.food.findIndex(g=>g.type===An.Berry);f>-1&&n.food.splice(f,1)}nc(s.entities,e.plantingSpot,s.time),lR(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:mt,data:{...e,enteredAt:s.time,previousState:Ud}}}return{nextState:Ud,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class $R{constructor(){De(this,"id",Sp)}update(t,n){const{entity:i,updateContext:s}=n;return i.activeAction!=="chopping"||i.heldItem?{nextState:mt,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const xR=new $R,WR=[yR,vR,MR,kR,bR,BR,UR,HR,GR,xR],hi="preyIdle",xo="preyMoving",Al="preyGrazing",Il="preyProcreating",YR={id:hi,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:xo,data:{...e,enteredAt:i.gameState.time,previousState:hi,target:n.target}}:n.activeAction==="grazing"?{nextState:Al,data:{...e,enteredAt:i.gameState.time,previousState:hi}}:n.activeAction==="procreating"?{nextState:Il,data:{...e,enteredAt:i.gameState.time,previousState:hi}}:{nextState:hi,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},MA=12,zR=120,fS=50,jR=12,OA=30,XR=2,yn=50,VR=100,Dl=2,zh=3,KR=.9,qR=1,ZR=50,QR=.5,kA=20,JR=140,hS=40,e1=12,bA=40,t1=3,Xo=60,gi=40,ks=50,gS=320,BA=25,n1=60,FA=2,i1=90,o1=.7,r1=1,Nl=3,jh=15,Ip=80,LA=10,Eu=80,ma=40,UA=2,eu=30,Hs=20,Fr=40,Gs=24,Lr=48,$s=12,Ur=40,xs=20,Hr=60,Ws=.75,Wo=2.5,Ys=.25,Yo=2,HA=4;function s1(e){let t=jR;return e.isAdult||(t*=.7),e.hunger>=ZR&&(t*=QR),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function a1(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,c=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),g=Math.floor((s+c)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function $l(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const Xh=10;class l1{constructor(){De(this,"id",xo)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction!=="moving")return{nextState:hi,data:{...t,enteredAt:s.gameState.time,previousState:xo}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*Xh*2,y:i.position.y+i.direction.y*Xh*2}),!a)return{nextState:hi,data:{...t,enteredAt:s.gameState.time,previousState:xo}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=ot(l),i.acceleration=s1(i),U(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Xh?{nextState:hi,data:{...t,enteredAt:s.gameState.time,previousState:xo}}:{nextState:xo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const c1=new l1,d1={id:Al,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:xo,data:{...e,enteredAt:i.gameState.time,previousState:Al,target:n.target}}:n.activeAction!=="grazing"?{nextState:hi,data:{...e,enteredAt:i.gameState.time,previousState:Al}}:{nextState:Al,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},u1={id:Il,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:xo,data:{...e,enteredAt:i.gameState.time,previousState:Il,target:n.target}}:n.activeAction!=="procreating"?{nextState:hi,data:{...e,enteredAt:i.gameState.time,previousState:Il}}:{nextState:Il,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},f1=[YR,c1,d1,u1],mn="predatorIdle",Uo="predatorMoving",Ji="predatorAttacking",bs="predatorProcreating",Gr="predatorEating",h1={id:mn,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:Gr,data:{...e,enteredAt:i.gameState.time,previousState:mn,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:Ji,data:{...e,enteredAt:i.gameState.time,previousState:mn,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction==="moving"?{nextState:Uo,data:{...e,enteredAt:i.gameState.time,previousState:mn,target:n.target}}:n.activeAction==="procreating"?{nextState:bs,data:{...e,enteredAt:i.gameState.time,previousState:mn}}:{nextState:mn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function GA(e){let t=e1;return e.hunger>=i1&&(t*=o1),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function g1(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,c=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),g=Math.floor((s+c)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function xl(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const Vh=12;class p1{constructor(){De(this,"id",Uo)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction==="eating")return{nextState:Gr,data:{...t,enteredAt:s.gameState.time,previousState:Uo,preyId:i.attackTargetId,eatingStartTime:s.gameState.time}};if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:Ji,data:{...t,enteredAt:s.gameState.time,previousState:Uo,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:Uo}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*Vh*2,y:i.position.y+i.direction.y*Vh*2}),!a)return{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:Uo}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=ot(l),i.acceleration=GA(i),U(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Vh?{nextState:mn,data:{...t,enteredAt:s.gameState.time,previousState:Uo}}:{nextState:Uo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const m1=new p1,y1={id:Ji,update:(e,t)=>{const{entity:n,updateContext:i}=t;if(n.activeAction==="eating")return{nextState:Gr,data:{...e,enteredAt:i.gameState.time,previousState:Ji,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:Ji}};const s=i.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:Ji}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:Ji}};const l=U(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=Xe(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return n.direction=ot(c),l>gi?n.acceleration=GA(n):n.acceleration=0,{nextState:Ji,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},S1={id:bs,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:Gr,data:{...e,enteredAt:i.gameState.time,previousState:bs,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:Ji,data:{...e,enteredAt:i.gameState.time,previousState:bs,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction!=="procreating"?{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:bs}}:{nextState:bs,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},v1={id:Gr,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:mn,data:{...e,enteredAt:i.gameState.time,previousState:Gr}}:{nextState:Gr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},A1=[h1,m1,y1,S1,v1],I1=24*30*10,Jo=24*5,T1=48,E1=72,Ql=20,C1="#3b2016",_1="#5c3a21",w1="#376d31",R1="#76a331",P1="#a6c44a",D1="rgba(0, 0, 0, 0.25)",N1=60,M1=24*7,O1=.1,pS=1,Cu=5,k1={id:sn,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.age>=n.lifespan?{nextState:zr,data:{enteredAt:i.gameState.time,previousState:sn}}:n.age>=Jo?{nextState:Kt,data:{enteredAt:i.gameState.time,previousState:sn}}:{nextState:sn,data:e}}},b1={id:Kt,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Ct/Dt);return n.age>=n.lifespan?{nextState:zr,data:{...e,enteredAt:i.gameState.time,previousState:Kt}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=M1&&(n.timeSinceLastSpreadAttempt=0,Math.random()<O1)?{nextState:vn,data:{...e,enteredAt:i.gameState.time,previousState:Kt}}:{nextState:Kt,data:e})}},B1={id:vn,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(n.age>=n.lifespan)return{nextState:zr,data:{...e,enteredAt:s.time,previousState:vn}};const a=fp(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Wn(a,s,25)||Yl(s.entities,a,s.time),{nextState:Kt,data:{...e,enteredAt:s.time,previousState:vn}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},F1={id:Gt,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=T1?{nextState:lo,data:{enteredAt:n.gameState.time,previousState:Gt}}:{nextState:Gt,data:e}}},L1={id:lo,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=E1?{nextState:zr,data:{enteredAt:n.gameState.time,previousState:lo}}:{nextState:lo,data:e}}},U1={id:zr,update:e=>({nextState:zr,data:e}),onEnter:(e,t)=>(Zr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},H1=[k1,b1,B1,F1,L1,U1],mS=[...mR,...WR,...f1,...A1,...H1];function G1(e,t,n){const i=Aw(e,mS);if(!i)return Tw(e),[e,t];const{nextState:s,data:a}=i.update(t,n);return Iw(e,s)?[s,vw(i,s,a,n,mS)]:[s,a]}const _t=30,ya=_t*.6,$A="#4CAF50",xA="#FF5722",WA="#9C27B0",$1="#2196F3",YA="#FFC107",x1="#DC143C",Tp="#FFFFFF",Ep=[5,5],_u=5,ra=15,W1=20,Y1=16,z1=10,j1=16,X1=16,tu=["","","","","","","","","",""],Ml=8,V1="#FFFFFF",it=18,et=15,K1="rgba(0, 0, 0, 0.7)",q1=4,Oo=150,Fn=15,Xi=10,zo="#555",Z1="#f44336",Q1="#4CAF50",J1="#2196F3",eP="#FFC107",pd=16,Sr=32,md=28,tP=10,nP=8,iP=8,oP=8,Zn=28,yd=40,rP="rgba(255, 215, 0, 0.7)",sP="rgba(0, 0, 0, 0.3)",Ci=10,yS=8,Kh=11,ko=20,qh=40,SS=5,aP=10,lP="#FFA500",cP="#808080",to=120,zA=30,dP=20,$o="#2d3748",Ht="#ffffff",Sd="#4a5568",jA=5,Cp="#bdc9f792",XA="#272c36ff",VA="#a0aec0",nu=300,KA="rgba(255, 255, 255, 0.5)",uP="rgba(0, 0, 0, 0.8)",fP="#FFFFFF",vS=14,AS=8,IS=-15,qA="#FFD700",ZA=5,hP=10,Zh=12,gP=10,pP="#4CAF50",mP="#F44336",yP="#FFC107",SP="rgba(255, 255, 255, 0.2)",TS="#FFFFFF",vP="#FF6B6B",AP=5,QA=30,al=50,vd=8,ES=10,IP="rgba(0, 0, 0, 0.5)",TP="#FFFFFF",EP=33,CP=400,_P=20,wP=10,RP="rgba(0, 0, 0, 0.7)",PP="#FFFFFF",Qh=20,CS=16,DP=.5,_S=5,JA="#FFD700",NP=40,_p=4,eI=3,MP=5,tI=20,nI=5,OP="#FFFFFF",kP="#FF6B6B",Ln=80,vr=10,Ad=300,Ar=15,bP=8,BP="rgba(0, 0, 0, 0.8)",FP="#FFFFFF",Jh=14,wS=10,_i=20,LP="#FF6B6B",UP="#4CAF50",RS="#FFD700",HP="rgba(255, 255, 0, 0.3)",GP=2,$P=500,xP=120,WP=45,YP="#FFD700",zP=3,jP=4;var ee=(e=>(e.Leader="leader",e.Gatherer="gatherer",e.Planter="planter",e.Hunter="hunter",e.Mover="mover",e.Warrior="warrior",e))(ee||{});function wp(e,t){return`${e},${t}`}const PS=Ct*10;function iI(e){return e%PS/PS}function oI(e){const t=iI(e);return(Math.cos(t*2*Math.PI)+1)/2}function XP(e){const t=iI(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function rI(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/eo),gridY:Math.floor(s/eo)}}function er(e,t,n,i,s){const{gridX:a,gridY:l}=rI(t,i,s),c=wp(a,l),u=e.sectors[c],f=u?u.currentTemperature:lA,m=(oI(n)*2-1)*zw;return f+m}function VP(e){const{sectors:t}=e.temperature,{width:n,height:i}=e.mapDimensions,s=Math.ceil(n/eo),a=Math.ceil(i/eo);for(const c in t){const u=t[c];u.currentTemperature=u.baseTemperature}const l=Math.ceil(br/eo);Object.values(e.entities.entities).forEach(c=>{if(c.type==="building"){const u=c;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const f=rI(u.position,n,i);for(let g=-l;g<=l;g++)for(let m=-l;m<=l;m++){const S=(f.gridX+m+s)%s,v=(f.gridY+g+a)%a,I=wp(S,v),A=t[I];if(A){const C={x:(S+.5)*eo,y:(v+.5)*eo},P=U(u.position,C,n,i);if(P<br){const R=xw*(1-P/br);A.currentTemperature+=R}}}}}})}function sI(e,t){const n={},i=Math.ceil(e/eo),s=Math.ceil(t/eo);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const c=wp(l,a);let u=lA;const f=a/s*10-5;u+=f,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),n[c]={baseTemperature:u,currentTemperature:u}}return{sectors:n}}function KP(e,t,n){var c;const{gameState:i}=t,s=n*(Ct/Dt);e.isAdult=e.age>=tp;const a=er(i.temperature,e.position,i.time,i.mapDimensions.width,i.mapDimensions.height);if(a<so){const u=(so-a)*$w*s;e.hitpoints-=u}if(e.movementSlowdown&&i.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<on){const u=1-e.hunger/on*J_,f=Q_*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+f)}if(e.hunger+=n*(rl/(Ct/Dt)),e.hunger>=on)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-qo);else{const u=ew*s;e.hitpoints-=u}if(e.age+=n/gu,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((rl*W_-rl)/(Ct/Dt)),(!e.lastPregnantEffectTime||i.time-e.lastPregnantEffectTime>Hl*3)&&(Ge(i,Ee.Pregnant,e.position,Hl,e.id),e.lastPregnantEffectTime=i.time),e.gestationTime<=0&&(pO(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===ya&&(e.radius=_t):e.hunger+=n*((rl*Y_-rl)/(Ct/Dt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const f=i.entities.entities[e.motherId];f&&u.push(f)}if(e.fatherId){const f=i.entities.entities[e.fatherId];f&&u.push(f)}for(const f of u)if(f.age>=np&&f.hunger>=X_&&U(e.position,f.position,i.mapDimensions.width,i.mapDimensions.height)<=V_){e.food.pop(),f.hunger=Math.max(0,f.hunger-qo),e.feedParentCooldownTime=K_;break}}let l;if(e.hitpoints<=0?a<so?l="hypothermia":e.hunger>=on?l="hunger":l="killed":e.age>=e.maxAge&&(l="oldAge"),l){if(e.leaderId===e.id){const u=Xr(Dn(i,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeRole=ee.Leader,u.tribeControl=e.tribeControl??{roleWeights:{[ee.Leader]:0,[ee.Gatherer]:2,[ee.Planter]:2,[ee.Hunter]:2,[ee.Mover]:2,[ee.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}};const f=i;Jd(i,e.id,u.id);const g=f.search.human.byProperty("leaderId",e.id);for(const v of g)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const m=f.search.building.byProperty("ownerId",e.id);for(const v of m)v.ownerId=u.id;for(const v of su(u,i))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const S=bu(i).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of S){const I=i.entities.entities[v.leaderId];if((c=I==null?void 0:I.tribeControl)!=null&&c.diplomacy){const A=I.tribeControl.diplomacy[e.id];A!==void 0&&(I.tribeControl.diplomacy[u.id]=A,delete I.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=Xr(Dn(i,e));u?(u.isPlayer=!0,i.generationCount++):(i.gameOver=!0,i.causeOfGameOver=l,Fl(i,{identifier:"no_heir",type:Yr.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}fO(i.entities,e.position,e.gender,e.age,e.radius,e.id,i.time,e.food,e.hunger),Zr(i.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function qP(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/q_);const i=Math.floor(Qv*(1-e.decayProgress));e.food.length>i&&e.food.splice(i),e.decayProgress>=1&&e.food.length<=0&&Zr(t.gameState.entities,e.id)}function ZP(e,t,n){const i=n*(Ct/Dt);e.age+=n/gu,e.isAdult=e.age>=Dl;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=zR){const l=HA*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};l.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,l.x)),l.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,l.y));const c=Math.random()<.5?"male":"female",u=e,f=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let g;if(f)g=a1(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}sa(t.gameState.entities,l,c,0,OA*.5,g,e.id,e.fatherId,e.aiType),Ge(t.gameState,Ee.Procreation,e.position,Hl,e.id),Me(t,Ce.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=i,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=MA&&(a=!0),a&&(hO(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Zr(t.gameState.entities,e.id))}function QP(e,t,n){const i=n*(Ct/Dt);e.age+=n/gu,e.isAdult=e.age>=Nl;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=JR){const l=HA*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};l.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,l.x)),l.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,l.y));const c=Math.random()<.5?"male":"female",u=e,f=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let g;if(f)g=g1(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}aa(t.gameState.entities,l,c,0,bA*.6,g,e.id,e.pregnancyFatherId,e.aiType),Ge(t.gameState,Ee.Procreation,e.position,Hl,e.id),Me(t,Ce.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=i,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=i,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=kA&&(a=!0),a&&(gO(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Zr(t.gameState.entities,e.id))}var $t=(e=>(e[e.BehaviorTreeBased=0]="BehaviorTreeBased",e[e.TaskBased=1]="TaskBased",e))($t||{}),T=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.FAILURE=1]="FAILURE",e[e.RUNNING=2]="RUNNING",e[e.NOT_EVALUATED=3]="NOT_EVALUATED",e))(T||{});class Mn{constructor(){De(this,"name");De(this,"depth");De(this,"children");De(this,"child")}getLastStatus(t){return _.get(t.aiBlackboard,`${this.name}_lastStatus`)??3}setLastStatus(t,n){_.set(t.aiBlackboard,`${this.name}_lastStatus`,n)}getRunningChildIndex(t){return _.get(t.aiBlackboard,`${this.name}_runningChildIndex`)}setRunningChildIndex(t,n){_.set(t.aiBlackboard,`${this.name}_runningChildIndex`,n)}}const _={create(){return{data:{},nodeExecutionData:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e},recordNodeExecution({nodeExecutionData:e},t,n,i,s,a){const l=e[t]||{lastExecuted:0,status:T.FAILURE,depth:0,debugInfo:"",executionHistory:[]},c=l.executionHistory[l.executionHistory.length-1];c&&i-(c==null?void 0:c.time)>ta&&l.executionHistory.push({time:c.time+ta,status:T.NOT_EVALUATED}),l.executionHistory.push({time:i,status:n});const u=QA/Dt*Ct,f=i-u;l.executionHistory=l.executionHistory.filter(m=>m.time>=f);const g={...l,lastExecuted:i,status:n,depth:s,debugInfo:a};e[t]=g},getNodeExecutionData({nodeExecutionData:e}){return e},cleanupOldEntries({nodeExecutionData:e},t){const n=e_,i=[];for(const[s,a]of Object.entries(e))t-a.lastExecuted>n&&i.push(s);for(const s of i)delete e[s]}},Bi=24,wu=2,Rp=3;function xt(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}function JP(e,t){if(!e.aiBlackboard)return;const n=e.aiBlackboard.data,i=[];for(const s in n)if(s.startsWith("tribal_")){const a=n[s];a&&typeof a=="object"&&"startTime"in a&&t-a.startTime>Bi&&i.push(s)}for(const s of i)_.delete(e.aiBlackboard,s)}const Jl="tribe_logistics_demands",eD=8;function ir(e){return _.get(e,Jl)||[]}function aI(e,t,n,i){const s=ir(e),a=s.find(l=>l.requesterId===t&&l.resourceType===n);if(a)a.updatedAt=i;else{const l={requesterId:t,resourceType:n,updatedAt:i};s.push(l)}_.set(e,Jl,s)}function tD(e,t,n,i,s){const a=ir(e),l=a.find(c=>c.requesterId===t&&c.resourceType===n);return l&&!l.claimedBy?(l.updatedAt=s,l.claimedBy=i,_.set(e,Jl,a),!0):!1}function nD(e){return ir(e).filter(n=>!n.claimedBy).sort((n,i)=>n.updatedAt-i.updatedAt)}function lI(e,t,n){let i=ir(e);i=i.filter(s=>!(s.requesterId===t&&s.resourceType===n)),_.set(e,Jl,i)}function cI(e,t,n){return ir(e).find(s=>s.requesterId===t&&s.resourceType===n)}function iD(e,t){let n=ir(e);n=n.filter(i=>t-i.updatedAt<=eD),_.set(e,Jl,n)}function Pp(e,t,n){const i=xt(e,t.gameState);i&&i.id===e.id&&i.aiBlackboard&&(JP(i,t.gameState.time),iD(i.aiBlackboard,t.gameState.time)),n.execute(e,t,e.aiBlackboard)}const DS="Human Behavior",oD=1;class rD{constructor(){De(this,"nodeData",new Map);De(this,"pathStack",[]);De(this,"startTimeStack",[])}nodeStart(t){this.pathStack.push(t),this.startTimeStack.push(performance.now())}nodeEnd(){if(this.startTimeStack.length===0||this.pathStack.length===0){console.error("BTProfiler: nodeEnd() called without a matching nodeStart().");return}const t=performance.now(),n=this.startTimeStack.pop(),i=t-n,s=this.pathStack.join(" > "),a=this.nodeData.get(s)??{path:s,totalTime:0,callCount:0,minTime:1/0,maxTime:-1/0};a.totalTime+=i,a.callCount++,a.minTime=Math.min(a.minTime,i),a.maxTime=Math.max(a.maxTime,i),this.nodeData.set(s,a),this.pathStack.pop()}report(t={}){const{showAll:n=!1}=t,i=Array.from(this.nodeData.values());if(i.length===0){console.log("--- Behavior Tree Profiler: No data collected. ---");return}let s=i,a="--- Behavior Tree Full Report ---";if(!n){const c=this.nodeData.get(DS);if(c){const u=c.totalTime*oD/100;s=i.filter(f=>f.totalTime>u&&f.path!==DS),a="--- Behavior Tree Problem Report ---"}else console.log('BTProfiler: Root node "Human Behavior" not found. Showing full report.'),a="--- Behavior Tree Full Report (Root Not Found) ---"}const l=s.sort((c,u)=>u.totalTime-c.totalTime);console.log(a),l.length>0?console.table(l.map(c=>({Path:c.path,"Total Time (ms)":c.totalTime.toFixed(3),Calls:c.callCount,"Avg Time (ms)":(c.totalTime/c.callCount).toFixed(3),"Min Time (ms)":c.minTime.toFixed(3),"Max Time (ms)":c.maxTime.toFixed(3)}))):console.log("No significant performance problems detected."),console.log("------------------------------------")}reset(){this.nodeData.clear(),this.pathStack=[],this.startTimeStack=[]}getNodeData(t){return this.nodeData.get(t)}}const rt=new rD;function qt(e){return Array.isArray(e)?e:[e,""]}class Ae extends Mn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{for(const a of this.children){const[l,c]=qt(a.execute(n,i,s));if(l!==T.SUCCESS)return this.setLastStatus(n,l),this.name&&_.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,c),l}return this.setLastStatus(n,T.SUCCESS),this.name&&_.recordNodeExecution(s,this.name,T.SUCCESS,i.gameState.time,this.depth,""),T.SUCCESS}finally{this.name&&rt.nodeEnd()}}}class ln extends Mn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const a=this.getRunningChildIndex(n)??0;for(let l=a;l<this.children.length;l++){const c=this.children[l],[u,f]=qt(c.execute(n,i,s));if(u!==T.FAILURE){if(u===T.SUCCESS)return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,T.SUCCESS),this.name&&_.recordNodeExecution(s,this.name,T.SUCCESS,i.gameState.time,this.depth,f),T.SUCCESS;if(u===T.RUNNING)return this.setRunningChildIndex(n,l),this.setLastStatus(n,T.RUNNING),this.name&&_.recordNodeExecution(s,this.name,T.RUNNING,i.gameState.time,this.depth,f),T.RUNNING}}return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,T.FAILURE),this.name&&_.recordNodeExecution(s,this.name,T.FAILURE,i.gameState.time,this.depth,""),T.FAILURE}finally{this.name&&rt.nodeEnd()}}}class NS extends Mn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{let a=!0;for(const c of this.children){const[u,f]=qt(c.execute(n,i,s));u===T.FAILURE&&(a=!1),this.name&&_.recordNodeExecution(s,this.name,u,i.gameState.time,this.depth,f)}const l=a?T.SUCCESS:T.FAILURE;return this.setLastStatus(n,l),l}finally{this.name&&rt.nodeEnd()}}}class ae extends Mn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.action=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=qt(this.action(n,i,s));return this.setLastStatus(n,a),this.name&&_.recordNodeExecution(s,this.name,a,i.gameState.time,this.depth,l),a}finally{this.name&&rt.nodeEnd()}}}class he extends Mn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.condition=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=qt(this.condition(n,i,s)),c=a?T.SUCCESS:T.FAILURE;return this.setLastStatus(n,c),this.name&&_.recordNodeExecution(s,this.name,c,i.gameState.time,this.depth,l),c}finally{this.name&&rt.nodeEnd()}}}class sD extends Mn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[a,l]=qt(this.child.execute(n,i,s));let c;switch(a){case T.SUCCESS:c=T.FAILURE;break;case T.FAILURE:c=T.SUCCESS;break;case T.RUNNING:default:c=a;break}return this.setLastStatus(n,c),this.name&&_.recordNodeExecution(s,this.name,c,i.gameState.time,this.depth,l),c}finally{this.name&&rt.nodeEnd()}}}class aD extends Mn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{const[,a]=qt(this.child.execute(n,i,s)),l=T.SUCCESS;return this.setLastStatus(n,l),this.name&&_.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,a),l}finally{this.name&&rt.nodeEnd()}}}class Mr extends Mn{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");De(this,"startTimeKey");this.child=n,this.timeoutDurationHours=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.startTimeKey=`timeout_${this.name}_startTime`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time;let l=_.get(s,this.startTimeKey);const[c,u]=qt(this.child.execute(n,i,s));if(c===T.RUNNING){l===void 0&&(_.set(s,this.startTimeKey,a),l=a);const f=a-l;if(f>this.timeoutDurationHours){_.delete(s,this.startTimeKey),this.setLastStatus(n,T.FAILURE);const m=`Timed out after ${f.toFixed(2)}h.`;return _.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m),this.getLastStatus(n)}this.setLastStatus(n,T.RUNNING);const g=`Running for ${f.toFixed(2)}h. ${u}`;return _.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}return l!==void 0&&_.delete(s,this.startTimeKey),this.setLastStatus(n,c),_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class Gn extends Mn{constructor(n,i,s,a=0,l){super();De(this,"name");De(this,"depth");De(this,"statusKey");De(this,"timestampKey");this.child=n,this.cacheDurationHours=i,this.validityCheck=l,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.statusKey=`caching_${this.name}_status`,this.timestampKey=`caching_${this.name}_timestamp`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time,l=_.get(s,this.statusKey),c=_.get(s,this.timestampKey);if(l!==void 0&&c!==void 0){const m=a-c>this.cacheDurationHours,S=this.validityCheck?this.validityCheck(n,i,s):!0;if(!m&&S){const v=(c+this.cacheDurationHours-a).toFixed(2),I=`Cache hit. Status: ${T[l]}. ${v}h left.`;return this.setLastStatus(n,l),_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,I),this.getLastStatus(n)}}const[u,f]=qt(this.child.execute(n,i,s));(u===T.SUCCESS||u===T.FAILURE)&&(_.set(s,this.statusKey,u),_.set(s,this.timestampKey,a)),this.setLastStatus(n,u);const g=`Cache miss. Child returned ${T[u]}. ${f}`;return _.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class Sa extends Mn{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");De(this,"cooldownKey");this.cooldownDurationHours=n,this.child=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.cooldownKey=`cooldown_${this.name}`}execute(n,i,s){rt.nodeStart(this.name);try{const a=i.gameState.time,l=_.get(s,this.cooldownKey);if(this.child.getLastStatus(n)===T.RUNNING){const[f,g]=qt(this.child.execute(n,i,s));if(this.setLastStatus(n,f),this.name){const m=`Continuing running child. ${g}`;_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m)}return this.getLastStatus(n)}if(l!==void 0&&a<l){const g=`Cooldown active, ${(l-a).toFixed(2)}h left`;return this.setLastStatus(n,T.FAILURE),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,g),this.getLastStatus(n)}const[c,u]=qt(this.child.execute(n,i,s));return c===T.SUCCESS&&_.set(s,this.cooldownKey,a+this.cooldownDurationHours),this.setLastStatus(n,c),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{rt.nodeEnd()}}}class Pn extends Mn{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");this.child=n,this.behaviorKey=i,this.name=s,this.depth=a;const l=(c,u)=>{c.depth=u,c.children?c.children.forEach(f=>l(f,u+1)):c.child&&l(c.child,u+1)};l(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer&&!i.gameState.autopilotControls.behaviors[this.behaviorKey]){const u=`Player autopilot for '${this.behaviorKey}' is disabled.`;return this.setLastStatus(n,T.FAILURE),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,u),this.getLastStatus(n)}const[l,c]=qt(this.child.execute(n,i,s));return this.setLastStatus(n,l),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,c),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class lD extends Mn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,c)=>{l.depth=c,l.children?l.children.forEach(u=>a(u,c+1)):l.child&&a(l.child,c+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer&&i.gameState.autopilotControls.isManuallyMoving)return this.setLastStatus(n,T.FAILURE),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Manual movement active, AI blocked."),this.getLastStatus(n);const[a,l]=qt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class Es extends Mn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,c)=>{l.depth=c,l.children?l.children.forEach(u=>a(u,c+1)):l.child&&a(l.child,c+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&rt.nodeStart(this.name);try{if(n.isPlayer)return this.setLastStatus(n,T.FAILURE),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Player controlled, AI blocked."),this.getLastStatus(n);const[a,l]=qt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&_.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&rt.nodeEnd()}}}class Li extends Mn{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");De(this,"registeredKey");this.child=n,this.config=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.registeredKey=`${this.name}_registered`}execute(n,i,s){rt.nodeStart(this.name);try{const a=xt(n,i.gameState);if(!a||!a.aiBlackboard){const[I,A]=qt(this.child.execute(n,i,s));return this.setLastStatus(n,I),_.recordNodeExecution(s,this.name,I,i.gameState.time,this.depth,`No coordination: ${A}`),I}const l=i.gameState.time,c=_.get(s,this.registeredKey)??!1,u=this.getTaskTarget(n,i,s);if(!u)return this.setLastStatus(n,T.FAILURE),_.recordNodeExecution(s,this.name,T.FAILURE,l,this.depth,"No task target found"),T.FAILURE;const f=this.getTaskKey(u);if(c){const[I,A]=qt(this.child.execute(n,i,s));return I===T.RUNNING?(this.refreshTaskTimestamp(a.aiBlackboard,f,n.id,l),this.setLastStatus(n,I),_.recordNodeExecution(s,this.name,I,l,this.depth,`Continuing: ${A}`),I):(this.removeFromTask(a.aiBlackboard,f,n.id),_.delete(s,this.registeredKey),this.setLastStatus(n,I),_.recordNodeExecution(s,this.name,I,l,this.depth,`Completed: ${A}`),I)}if(!this.canJoinTask(a.aiBlackboard,f,n.id,l)){this.setLastStatus(n,T.FAILURE);const I=_.get(a.aiBlackboard,f),A=(I==null?void 0:I.memberIds.length)??0,C=this.config.maxCapacity??1;return _.recordNodeExecution(s,this.name,T.FAILURE,l,this.depth,`Task full: ${A}/${C}`),T.FAILURE}if(!this.registerTask(a.aiBlackboard,f,n.id,l))return this.setLastStatus(n,T.FAILURE),_.recordNodeExecution(s,this.name,T.FAILURE,l,this.depth,"Failed to register task"),T.FAILURE;_.set(s,this.registeredKey,!0);const[S,v]=qt(this.child.execute(n,i,s));if(S===T.RUNNING){this.setLastStatus(n,S);const I=_.get(a.aiBlackboard,f),A=(I==null?void 0:I.memberIds.length)??0,C=this.config.maxCapacity??1;return _.recordNodeExecution(s,this.name,S,l,this.depth,`Started (${A}/${C}): ${v}`),S}else return this.removeFromTask(a.aiBlackboard,f,n.id),_.delete(s,this.registeredKey),this.setLastStatus(n,S),_.recordNodeExecution(s,this.name,S,l,this.depth,`Immediate result: ${v}`),S}finally{rt.nodeEnd()}}getTaskTarget(n,i,s){var l,c,u,f;if(this.config.taskType==="procreation")return((c=(l=this.config).getTargetId)==null?void 0:c.call(l,n,i,s))??null;const a=(f=(u=this.config).getTargetId)==null?void 0:f.call(u,n,i,s);return a??null}getTaskKey(n){return this.config.generateTaskKey?this.config.generateTaskKey(this.config.taskType,n):`tribal_${this.config.taskType}_${n}`}canJoinTask(n,i,s,a){const l=_.get(n,i);if(!l||a-l.startTime>Bi||l.memberIds.includes(s))return!0;const c=this.config.maxCapacity??1;return l.memberIds.length<c}registerTask(n,i,s,a){let l=_.get(n,i);return l?a-l.startTime>Bi?(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},_.set(n,i,l),!0):l.memberIds.length>=(this.config.maxCapacity??1)?!!l.memberIds.includes(s):(l.memberIds.includes(s)||(l.memberIds.push(s),_.set(n,i,l)),!0):(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},_.set(n,i,l),!0)}refreshTaskTimestamp(n,i,s,a){const l=_.get(n,i);l&&l.memberIds.includes(s)&&(l.startTime=a,_.set(n,i,l))}removeFromTask(n,i,s){const a=_.get(n,i);a&&(a.memberIds=a.memberIds.filter(l=>l!==s),a.memberIds.length===0?_.delete(n,i):_.set(n,i,a))}}function cD(e){return new Ae([new he((t,n)=>{const i=t.hunger>=na,s=t.food.length>0,a=!t.eatingCooldownTime||n.gameState.time>=t.eatingCooldownTime;return[!!(i&&s&&a),`${Math.floor(t.hunger-na)}, ${t.food.length}, ${t.eatingCooldownTime?Math.floor(t.eatingCooldownTime-n.gameState.time):""}`]},"Can Eat",e+1),new ae(t=>(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",T.RUNNING),"Eat",e+1)],"Eating",e)}const eg=30,dD=.4,uD=24,dI=50,fD=100,hD=160,gD=72,uI=10,Dp=5,pD=10,mD=15,Pg=5,Dg=5,Ng=5;function xn(e,t,n){return Ru(e,n)?e.tribeRole===t:!0}function Ru(e,t){if(!e.leaderId)return!1;const n=t.entities.entities[e.leaderId];return!n||!n.tribeControl?!1:t.search.human.byProperty("leaderId",n.id).filter(s=>s.isAdult).length>=pD}function yD(e){return new Ae([new he((n,i)=>{if(!!!n.leaderId||!Ru(n,i.gameState))return!1;const a=n.id===n.leaderId,l=xn(n,ee.Warrior,i.gameState)||xn(n,ee.Hunter,i.gameState),c=!n.isAdult&&(!n.fatherId||!i.gameState.entities.entities[n.fatherId])&&(!n.motherId||!i.gameState.entities.entities[n.motherId]);return a||l||c},"Demand eligible?",e+1),new ae((n,i)=>{const s=xt(n,i.gameState);if(!s||!s.aiBlackboard)return[T.NOT_EVALUATED,"No leader for coordination"];if(n.food.length<n.maxFood*.5){aI(s.aiBlackboard,n.id,"food",i.gameState.time);const a=cI(s.aiBlackboard,n.id,"food");if(a&&a.claimedBy){const l=i.gameState.entities.entities[a.claimedBy];if(!l||l.type!=="human")return[T.NOT_EVALUATED,"Supplier not found or invalid"];const c=U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return c>sw?[T.NOT_EVALUATED,`Supplier too far (${c.toFixed(1)}px), waiting`]:c<=ze?(n.activeAction="retrieving",n.target=l.id,[T.RUNNING,`Retrieving from supplier ${l.id}`]):(n.target=l.id,n.activeAction="moving",[T.RUNNING,`Moving to supplier ${l.id}, distance: ${c.toFixed(1)}`])}return[T.NOT_EVALUATED,"Waiting for supplier"]}return[T.NOT_EVALUATED,"No demand needed"]},"Create Demand",e+1)],"Demand",e)}const SD=20,Zt=30,vD=.5,AD=.3,ID=2,TD=50,Np=400,ED=25;function MS(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function CD(e,t,n=Np){return t.search.building.byRadius(e.position,n).some(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed&&l.storageCapacity&&l.storedItems.length<l.storageCapacity})}function _D(e,t,n=Np,i,s){return t.search.building.byRadius(e.position,n).filter(c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===e.leaderId&&u.isConstructed&&u.storedItems.filter(f=>f.item.itemType==="food").length>0}).filter(c=>{if(i){const u=`tribal_storage_${c.id}`,f=_.get(i,u);if(f&&f.memberIds.length>=Rp&&(!s||!f.memberIds.includes(s)))return!1}return!0})}function wD(e,t,n=Np){return t.search.building.byRadius(e.position,n).filter(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed})}function fI(e,t,n){if(t.length===0)return null;let i=null,s=1/0;for(const a of t){const l=U(e.position,a.position,n.mapDimensions.width,n.mapDimensions.height);l<s&&(s=l,i=a)}return i?{storage:i,distance:s}:null}function hI(e){const t=e.storedItems.length,n=MS(t+e.id)*2*Math.PI,i=MS(t+e.id+1)*ED;return{x:Math.cos(n)*i,y:Math.sin(n)*i}}const OS="FINDING_DEMAND",kS="RETRIEVING_FROM_STORAGE",bS="DELIVERING_TO_DEMANDER",Hd="supply_phase",Mg="supply_targetDemanderId",gI="supply_targetStorageId",Gd="supply_targetResourceType";function wi(e){e.aiBlackboard&&(_.delete(e.aiBlackboard,Hd),_.delete(e.aiBlackboard,Mg),_.delete(e.aiBlackboard,gI),_.delete(e.aiBlackboard,Gd))}function RD(e){return new ae((t,n)=>{var a;if(!Ru(t,n.gameState))return wi(t),[T.FAILURE,"Tribe roles not effective"];if(!xn(t,ee.Mover,n.gameState))return wi(t),[T.FAILURE,"Not a Mover"];const i=xt(t,n.gameState);if(!i||!i.aiBlackboard)return wi(t),[T.FAILURE,"No leader or blackboard"];if(!t.aiBlackboard)return[T.FAILURE,"No AI blackboard"];const s=_.get(t.aiBlackboard,Hd)||OS;if(s===OS){const l=nD(i.aiBlackboard).filter(f=>f.requesterId!==t.id);if(l.length===0)return[T.FAILURE,"No unclaimed demands"];const c=l[0];return tD(i.aiBlackboard,c.requesterId,c.resourceType,t.id,n.gameState.time)?(_.set(t.aiBlackboard,Mg,c.requesterId),_.set(t.aiBlackboard,Gd,c.resourceType),_.set(t.aiBlackboard,Hd,kS),[T.RUNNING,`Claimed ${c.resourceType} demand for ${c.requesterId}, moving to retrieval phase`]):(wi(t),[T.FAILURE,"Failed to claim demand"])}if(s===kS){const l=_.get(t.aiBlackboard,Gd),c=l==="food"&&t.food.length>0,u=l==="wood"&&((a=t.heldItem)==null?void 0:a.type)===yt.Wood;if(c||u)return _.set(t.aiBlackboard,Hd,bS),[T.RUNNING,`${l} retrieved, moving to delivery phase`];const f=wD(t,n.gameState,400).filter(v=>l==="food"?v.storedItems.some(I=>I.item.itemType==="food"):l==="wood"?v.storedItems.some(I=>I.item.type===yt.Wood):!1);if(f.length===0)return[T.FAILURE,`No storage with ${l} found nearby`];const g=fI(t,f,n.gameState);if(!g)return wi(t),[T.FAILURE,"Could not find closest storage"];const{storage:m,distance:S}=g;return _.set(t.aiBlackboard,gI,m.id),S<=Zt?(t.activeAction="retrieving",t.target=m.id,[T.RUNNING,`Retrieving from storage ${m.id}`]):(t.target=m.id,t.activeAction="moving",[T.RUNNING,`Moving to storage ${m.id}, distance: ${S.toFixed(1)}`])}if(s===bS){const l=_.get(t.aiBlackboard,Gd)||"food",c=_.get(t.aiBlackboard,Mg);if(!c)return wi(t),[T.FAILURE,"Demander ID not found in blackboard"];const u=cI(i.aiBlackboard,c,l);if(!u||u.claimedBy!==t.id)return wi(t),[T.FAILURE,"Demand not found"];const f=n.gameState.entities.entities[c];if(!f)return wi(t),[T.FAILURE,"Demander not found"];if(l==="food"?t.food.length===0:!t.heldItem)return wi(t),[T.SUCCESS,`Successfully delivered ${l} to ${c}`];const m=U(t.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),S=f.type==="building"&&f.buildingType===ce.Bonfire?Zt:ze;return m<=S?(t.activeAction="depositing",l==="food"&&(t.activeActionPayload={amount:Math.min(f.maxFood/2||1,t.food.length||1)}),t.target=f.id,[T.RUNNING,`Delivering to demander ${f.id}`]):(t.target=f.id,t.activeAction="moving",[T.RUNNING,`Moving to demander ${f.id}, distance: ${m.toFixed(1)}`])}return wi(t),[T.FAILURE,"Unknown supply phase"]},"Supply",e)}function PD(e){return new Ae([new he((t,n,i)=>{if(t.isAdult&&t.hitpoints>t.maxHitpoints*Vd||!(t.hitpoints<t.maxHitpoints*.1)&&t.isAdult&&t.hunger>QC)return!1;const a=pI(t.id,n.gameState);return a?(_.set(i,"fleeThreat",a.id),!0):!1},"Should Flee",e+1),new ae((t,n,i)=>{const s=_.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;t.activeAction="moving";const l=Xe(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=ot(l),u=ti(t.position,At(c,Ag));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,T.RUNNING},"Execute Flee",e+1)],"Flee",e)}const Ir="resourceSource";function DD(e){const t=new ae((i,s,a)=>{const l=xt(i,s.gameState),c=l?Ul(l.id,s.gameState):0,u=i.hunger>Xy,f=Dn(s.gameState,i).filter(A=>A.hunger>oa),g=u||f.length>0,m=xn(i,ee.Gatherer,s.gameState),S=()=>{const A=Be(i,s.gameState,"berryBush",Hh,P=>{if(P.food.length===0||i.leaderId&&!ao(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${P.id}`,w=_.get(l.aiBlackboard,R);if(w&&s.gameState.time-w.startTime<=Bi&&!w.memberIds.includes(i.id))return!1}return!0}),C=Be(i,s.gameState,"corpse",Hh,P=>{if(P.food.length===0||i.leaderId&&!ao(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${P.id}`,w=_.get(l.aiBlackboard,R);if(w&&s.gameState.time-w.startTime<=Bi&&!w.memberIds.includes(i.id))return!1}return!0});if(A&&C){const P=U(i.position,A.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height),R=U(i.position,C.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);return P<=R?A:C}return A||C},v=()=>Be(i,s.gameState,"tree",Hh,A=>{var C;if(((C=A.stateMachine)==null?void 0:C[0])!==Gt||A.wood.length===0||i.leaderId&&!ao(A.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const P=`tribal_gather_${A.id}`,R=_.get(l.aiBlackboard,P);if(R&&s.gameState.time-R.startTime<=Bi&&!R.memberIds.includes(i.id))return!1}return!0});let I=null;return g&&i.food.length<i.maxFood?I=S():c>0&&!i.heldItem?I=v():m&&(i.heldItem||(I=v()),!I&&i.food.length<i.maxFood&&(I=S())),I?(_.set(a,Ir,I.id),[T.SUCCESS,`Found ${I.type}: ${I.id} at ${I.position.x.toFixed(0)},${I.position.y.toFixed(0)}`]):[T.FAILURE,"No resource found"]},"Find Closest Resource Source",e+4),n=new Li(new ae((i,s,a)=>{const l=_.get(a,Ir);if(!l)return[T.FAILURE,"No target in blackboard"];const c=s.gameState.entities.entities[l];return c?(c.type==="tree"&&"wood"in c?c.wood.length===0:c.food.length===0)?(_.delete(a,Ir),[T.FAILURE,"Resource source is depleted"]):U(i.position,c.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Wr?(i.activeAction="gathering",i.direction={x:0,y:0},i.target=c.id,_.delete(a,Ir),[T.SUCCESS,`Gathering from ${c.type}`]):(i.activeAction="moving",i.target=c.id,i.direction=$e(i.position,c.position,s.gameState.mapDimensions),[T.RUNNING,`Moving to ${c.type}`]):(_.delete(a,Ir),[T.FAILURE,"Resource source is invalid"])},"Move To Resource and Gather",e+3),{taskType:"gather",maxCapacity:2,getTargetId:(i,s,a)=>_.get(a,Ir)??null},"Tribal Gather Task",e+3);return new Ae([new he((i,s)=>{const a=xt(i,s.gameState),l=a?Ul(a.id,s.gameState):0,c=i.food.length<i.maxFood,u=!i.heldItem,f=i.hunger>Xy,g=Dn(s.gameState,i).filter(A=>A.hunger>oa),m=xn(i,ee.Gatherer,s.gameState),S=CD(i,s.gameState),v=c&&(f||g.length>0||m&&S),I=u&&(l>0||m&&S);return[(i.isAdult&&(v||I))??!1,`${f?"Hungry ":""}${g.length>0?"Children("+g.length+") ":""}${l>0?"WoodNeed("+l+") ":""}${I&&l<=0?"Wood ":""}${S?"Storage":""}`]},"Should Gather Resources",e+1),new ln([new Ae([new he((i,s,a)=>_.has(a,Ir),"Has Resource Source?",e+2),n],"Continue Gathering Action",e+2),new Ae([new Gn(t,i_,"Cache Resource Source Search",e+3),n],"Find New Resource Source and Gather",e+2)],"Perform or Start Gathering",e+1)],"Gather Resources",e)}const ND=.5;function MD(e){return new ae((t,n,i)=>{const{gameState:s}=n,{width:a,height:l}=s.mapDimensions;let c=_.get(i,"wanderTarget");const u=_.get(i,"lastWanderTime")??0,f=s.time;if(!c||f-u>ND||U(t.position,c,a,l)<20){const m=fp(t.position,VC,a,l);t.leaderId?Rg(m,t.leaderId,s)?c=m:c=Zw(t.position,m,t.leaderId,s):c=m,_.set(i,"wanderTarget",c),_.set(i,"lastWanderTime",f)}if(c&&U(t.position,c,a,l)>10){t.activeAction="moving",t.target=c;let S=c.x-t.position.x,v=c.y-t.position.y;return Math.abs(S)>a/2&&(S=S>0?S-a:S+a),Math.abs(v)>l/2&&(v=v>0?v-l:v+l),t.direction=ot({x:S,y:v}),T.RUNNING}return t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,T.SUCCESS},"Idle/Wander",e)}const Id="procreationWanderStartTime",BS=(e,t,n)=>t.find(i=>nr(e,i,n)),FS={taskType:"procreation",maxCapacity:2,getTargetId:(e,t,n)=>_.get(n,"procreationPartner")??null};function OD(e){const t=new he((a,l,c)=>{const u=zS(a,l.gameState,Wr),f=BS(a,u,l.gameState);return f?(_.set(c,"procreationPartner",f.id),!0):[!1,"No immediate partner found"]},"Find Immediate Partner"),n=new Li(new ae((a,l,c)=>{var g;const u=_.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=void 0,_.delete(c,"procreationPartner"),_.delete(c,Id),(g=a.partnerIds)!=null&&g.includes(f.id)||(a.partnerIds=a.partnerIds?[...a.partnerIds,f.id]:[f.id]),T.SUCCESS):T.FAILURE},"Start Procreating"),FS,"Tribal Start Procreating",e+2),i=new he((a,l,c)=>{const u=zS(a,l.gameState,ZC),f=BS(a,u,l.gameState);return f?(_.set(c,"procreationPartner",f.id),!0):[!1,"No distant partner found"]},"Locate Distant Partner"),s=new Li(new ae((a,l,c)=>{const u=_.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return[T.FAILURE,"No partner found"];if(f.isPregnant)return[T.FAILURE,"Partner is pregnant"];if(a.hunger>rn)return[T.FAILURE,"Too hungry to procreate"];const g=U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);if(g<Wr)return[T.SUCCESS,"Reached partner"];if(a.leaderId&&!ao(f.position,a.leaderId,l.gameState))return[T.FAILURE,"Partner out of operating range"];a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),[T.RUNNING,`${g.toFixed(1)} units away`]},"Move Towards Partner"),FS,"Tribal Move To Partner",e+3);return new Ae([new he(a=>!a.isAdult||a.gender==="female"&&a.isPregnant?[!1,"Not adult or pregnant"]:a.age<Bl||a.gender==="female"&&a.age>mu?[!1,"Not fertile due to age or pregnancy status"]:a.hunger>=rn?[!1,"Too hungry"]:!0,"Is Fertile (age, not pregnant)",e+1),new he(a=>a.hunger<rn,"Is Healthy (hunger)",e+1),new he(a=>(a.procreationCooldown||0)<=0,"Is Ready (cooldown)",e+1),new ln([new Ae([new he((a,l)=>{const c=US(a.position,l.gameState,"berryBush",Vy);return[c>=qC,`Found ${c} bushes`]},"Is Environment Viable (food)",e+3),new ae((a,l,c)=>(_.delete(c,Id),T.SUCCESS),"Clear Wander Timer",e+3)],"Sufficient Food Path",e+2),new Ae([new he((a,l)=>{const c=Dn(l.gameState,a);return Xr(c)?[!1,"Has an heir"]:!0},"Is Male Without Heir",e+3),new ae((a,l,c)=>{const u=_.get(c,Id);if(u===void 0)return _.set(c,Id,l.gameState.time),[T.FAILURE,"Starting heirless wander timer"];const f=l.gameState.time-u;return f>=$_?US(a.position,l.gameState,"berryBush",Vy)>=1?[T.SUCCESS,`Wandered for ${f.toFixed(1)}h, minimum food found`]:[T.FAILURE,"Desperate but no food sources nearby"]:[T.FAILURE,`Wandering for heir, ${f.toFixed(1)}h elapsed`]},"Check Wander Timer",e+3)],"Heirless Desperation Path",e+2)],"Check Environment Or Desperation",e+1),new he((a,l,c)=>{var f;const u=_.get(c,"procreationPartner");return u&&((f=u.partnerIds)!=null&&f.length)&&!u.partnerIds.includes(a.id)&&a.leaderId!==a.id&&a.leaderId&&u.partnerIds.map(g=>l.gameState.entities.entities[g]).filter(g=>!!g).some(g=>U(a.position,g.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<g_)?[!1,"Partner's primary partner is too close"]:!0},"Is Partner's Primary Partner Nearby",e+1),new ln([new Ae([t,n],"Procreate With Immediate Partner",e+2),new Sa(t_,new Ae([i,s,n],"Seek Distant Partner Action",e+3),"Seek Distant Partner Cooldown",e+2)],"Find Partner And Procreate",e+1)],"Procreate",e)}const Cs="attackTarget",Tr="homeCenter",tg=150;function kD(e){return new Ae([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.hitpoints>0&&U(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=tg){if(_.set(i,Cs,l.id),!_.get(i,Tr)){const c=t.leaderId?ni(t.leaderId,s):zl(t,s).length>0?aS(t,s):t.position;_.set(i,Tr,c)}return!0}}if(!xn(t,ee.Warrior,s))return[!1,"Not a Warrior"];const a=Be(t,s,"human",tg,l=>l.hitpoints>0&&Vr(t,l,s));if(a){_.set(i,Cs,a.id);const l=t.leaderId?ni(t.leaderId,s):zl(t,s).length>0?aS(t,s):t.position;return _.set(i,Tr,l),!0}return _.set(i,Cs,void 0),_.set(i,Tr,void 0),!1},"Find Attack Target",e+1),new ae((t,n,i)=>{const s=_.get(i,Cs),a=s&&n.gameState.entities.entities[s],l=_.get(i,Tr);if(!a||!l)return T.FAILURE;const{gameState:c}=n;return U(t.position,l,c.mapDimensions.width,c.mapDimensions.height)>Hv?(t.activeAction="idle",t.attackTargetId=void 0,_.set(i,Cs,void 0),_.set(i,Tr,void 0),T.FAILURE):a.hitpoints<=0||U(t.position,a.position,c.mapDimensions.width,c.mapDimensions.height)>tg?(t.activeAction==="attacking"&&(t.activeAction="idle",t.attackTargetId=void 0),_.set(i,Cs,void 0),_.set(i,Tr,void 0),T.SUCCESS):(t.activeAction==="attacking"&&t.attackTargetId===a.id||(t.activeAction="attacking",t.attackTargetId=a.id),T.RUNNING)},"Execute Attack",e+1)],"Attack",e)}const bD=(e,t,n)=>{const i=Dn(t.gameState,e).filter(l=>!l.isAdult);if(i.length===0)return T.FAILURE;let s=null,a=oa;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(_.set(n,"targetChild",s.id),T.SUCCESS):T.FAILURE},BD=(e,t,n)=>{const i=_.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>yu?(e.activeAction="moving",e.target=s.id,e.direction=$e(e.position,s.position,t.gameState.mapDimensions),T.RUNNING):(e.activeAction="feeding",e.target=void 0,_.set(n,"targetChild",void 0),T.SUCCESS):T.FAILURE};function FD(e){return new Ae([new he(t=>(t.isAdult&&t.food.length>0&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child",e+1),new ae(bD,"Find Hungriest Child",e+1),new ae(BD,"Move To Child and Feed",e+1)],"Feed Child",e)}function LD(e){return new Ae([new he(t=>!t.isAdult&&t.hunger>=oa,"Is Hungry Child",e+1),new ae((t,n,i)=>{const s=AO(t,n.gameState);if(s.length===0)return T.FAILURE;const a=Be(t,n.gameState,"human",j_,l=>s.some(c=>c.id===l.id)&&l.food.length>0);return a?(_.set(i,"targetParent",a.id),T.SUCCESS):T.FAILURE},"Find Parent With Food",e+1),new ae((t,n,i)=>{const s=_.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=yu?(t.target=void 0,T.SUCCESS):(t.target=a.id,t.activeAction="moving",T.RUNNING)},"Move To Parent",e+1)],"Seek Food From Parent",e)}const Er="plantingSpot",_s="plantingZoneId",UD=50;function HD(e,t,n,i){const s=Xe(e,t,n,i);return ti(e,s)}function GD(e){const t=new ae((s,a,l)=>{const c=_.get(l,Er);if(!c)return _.delete(l,Er),_.delete(l,_s),[T.FAILURE,"Planting spot is missing"];if(Fi(a.gameState.soilDepletion,c,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height))return _.delete(l,Er),_.delete(l,_s),[T.FAILURE,"Soil is depleted at planting spot"];if(Wn(c,a.gameState,Zo,s.id))return _.delete(l,Er),_.delete(l,_s),[T.FAILURE,"Planting spot is occupied"];const u=HD(s.position,c,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height),f=U(s.position,u,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height);return f>Wr?(s.activeAction="moving",s.target=u,s.direction=$e(s.position,u,a.gameState.mapDimensions),[T.RUNNING,"Moving to planting spot: "+f.toFixed(2)+" units away"]):Wn(c,a.gameState,Zo,s.id)?(_.delete(l,Er),_.delete(l,_s),[T.FAILURE,"Planting spot is now occupied"]):(s.activeAction="planting",s.target=c,[T.RUNNING,"Planting state initiated"])},"Move To Spot and Plant",e+4),n=new Li(t,{taskType:"plant",maxCapacity:2,proximityRadius:UD,getTargetId:(s,a,l)=>_.get(l,_s)??null},"Coordinated Planting",e+3),i=new ae((s,a,l)=>{const c=sR(s,a.gameState);return c?(_.set(l,Er,c.position),_.set(l,_s,c.zoneId),[T.SUCCESS,`Found new spot at ${c.position.x.toFixed(0)}, ${c.position.y.toFixed(0)} (Zone ${c.zoneId})`]):[T.FAILURE,"No suitable planting spot found"]},"Find Optimal Planting Spot",e+3);return new Ae([new he((s,a)=>{if(!xn(s,ee.Planter,a.gameState))return[!1,"Not a Planter"];const l=s.food.filter(f=>f.type===An.Berry).length>=uo,c=s.hunger<zC,u=(s.isAdult&&l&&c)??!1;return[u,u?"Can plant":`Cannot plant: adult=${s.isAdult}, berries=${s.food.filter(f=>f.type===An.Berry).length}/${uo}, hunger=${s.hunger.toFixed(0)}`]},"Can Plant",e+1),new he((s,a)=>{if(!s.leaderId)return[!1,"No tribe"];const l=Jw(s,a.gameState),{count:c,ratio:u}=IA(s.leaderId,a.gameState);let f;return l<$v?f=m_:l<xv?f=y_:l<Wv?f=S_:f=v_,[u<f||c<=Us,`Food security: ${(l*100).toFixed(0)}%, Bush density: ${u.toFixed(1)}/${f}`]},"Needs More Bushes (Adaptive)",e+1),new he((s,a)=>{if(!s.leaderId)return[!0,"No tribe coordination needed"];const l=Nn(s,a.gameState),c=CA(s.leaderId,a.gameState,"planting"),u=Math.max(1,Math.ceil(l.length*.3));return[c<u,`Active planters: ${c}/${u}`]},"Not Too Many Planters",e+1),new ln([new Ae([new he((s,a,l)=>_.has(l,Er),"Has Planting Spot?",e+2),n],"Continue Planting Action",e+2),new Sa(n_,i,"Find Planting Spot Cooldown",e+2)],"Perform or Start Planting",e+1)],"Plant Bush",e)}const LS="lastDepositTime",ws="assignedStorageSpot";function $D(e){return new ln([new Ae([new he((t,n,i)=>{var c;const s=((c=t.heldItem)==null?void 0:c.type)===yt.Wood;if(!t.isAdult)return[!1,"Not an adult"];if(!t.leaderId)return[!1,"No tribe"];let a=null,l="";if(s)a=rR(t,n.gameState),l=`Holding wood${a?` (Target: ${a.id})`:""}`;else{if(!xn(t,ee.Gatherer,n.gameState)&&!xn(t,ee.Mover,n.gameState)&&!xn(t,ee.Hunter,n.gameState))return[!1,"Not a Gatherer/Mover/Hunter and not holding wood"];const u=_.get(i,LS)||0,f=n.gameState.time-u;if(f<Ky)return[!1,`Cooldown: ${(Ky-f).toFixed(1)}h remaining`];const g=pp(t.leaderId,n.gameState);let m;g<.3?m=A_:g<.7?m=I_:m=T_;const S=t.food.length/t.maxFood;if(S<=m)return[!1,`Food ${(S*100).toFixed(0)}% < threshold ${(m*100).toFixed(0)}%`];a=EA(t,n.gameState),l=`Storage util: ${(g*100).toFixed(0)}%, Personal: ${(S*100).toFixed(0)}%`}return a?(_.set(i,ws,a.id),[!0,l]):[!1,"No available tribe storage nearby"]},"Check for Excess Food and Storage",e+1),new he((t,n)=>{if(!t.leaderId)return[!0,"No tribe coordination needed"];const i=CA(t.leaderId,n.gameState,"depositing"),s=Nn(t,n.gameState),a=jr(t.leaderId,n.gameState).length,l=Math.max(2,Math.ceil(s.length*.4)+a);return[i<l,`Active depositors: ${i}/${l}`]},"Not Too Many Depositors",e+1),new Li(new ae((t,n,i)=>{var c,u;const s=_.get(i,ws);if(!s)return[T.FAILURE,"No storage assigned"];const a=n.gameState.entities.entities[s];if(!a)return _.delete(i,ws),[T.FAILURE,"Storage entity missing"];if((((c=a.storedItems)==null?void 0:c.length)??0)>=(a.storageCapacity??0))return _.delete(i,ws),[T.FAILURE,"Storage full"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l<=Zt){t.activeAction="depositing",t.target=void 0,_.set(i,LS,n.gameState.time),_.delete(i,ws);const f=((u=t.heldItem)==null?void 0:u.type)===yt.Wood;return[T.SUCCESS,f?"Depositing wood":"Depositing food"]}return t.activeAction="moving",t.target=a.position,[T.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`]},"Navigate to Storage and Deposit",e+2),{taskType:"storage",maxCapacity:Rp,storageAction:"deposit",getTargetId:(t,n,i)=>_.get(i,ws)??null},"Tribal Storage Deposit Task",e+1)],"Deposit Sequence",e)],"Storage Deposit Behavior",e)}const Td="retrievalStorageId";function xD(e){return new ln([new Ae([new he((t,n,i)=>{if(t.hunger<=na)return[!1,"Not hungry enough"];if(t.food.length>=t.maxFood)return[!1,"Inventory full"];const s=xt(t,n.gameState),a=_D(t,n.gameState,void 0,s==null?void 0:s.aiBlackboard,t.id),l=fI(t,a,n.gameState),c=l==null?void 0:l.storage;return c?(_.set(i,Td,c.id),[!0,`Storage with food found at distance ${l.distance.toFixed(1)}`]):[!1,"No tribe storage with food nearby"]},"Check for Hunger and Storage Food",e+1),new Li(new ae((t,n,i)=>{const s=_.get(i,Td);if(!s)return[T.FAILURE,"No storage target"];const a=n.gameState.entities.entities[s];if(!a)return _.delete(i,Td),[T.FAILURE,"Storage not found"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=Zt?(t.activeAction="retrieving",t.target=void 0,[T.SUCCESS,"Retrieving food"]):(t.activeAction="moving",t.target=a.position,[T.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`])},"Navigate to Storage and Retrieve",e+2),{taskType:"storage",maxCapacity:Rp,storageAction:"retrieve",getTargetId:(t,n,i)=>_.get(i,Td)??null},"Coordinated Storage Retrieve",e+1)],"Retrieve Sequence",e)],"Storage Retrieve Behavior",e)}const ng="combatTarget",ig="homeCenter";function WD(e){const t=new he(a=>a.isAdult&&a.leaderId?a.id!==a.leaderId:!1,"Is Tribe Follower?",e+1),n=new he(a=>a.hunger<jC&&a.hitpoints>=a.maxHitpoints*Vd,"Is Fit for Combat?",e+1),i=new ae((a,l,c)=>{const{gameState:u}=l,f=u.entities.entities[a.leaderId];if(!f)return T.FAILURE;const g=PO(f,u,JC);if(g.length===0)return T.FAILURE;g.sort((m,S)=>{const v=U(a.position,m.position,u.mapDimensions.width,u.mapDimensions.height),I=U(a.position,S.position,u.mapDimensions.width,u.mapDimensions.height);return v-I});for(const m of g)if(DO(f.id,m.id,u)<Uv){_.set(c,ng,m.id);const v=ni(f.id,u);return _.set(c,ig,v),T.SUCCESS}return T.FAILURE},"Find Best Target",e+1),s=new ae((a,l,c)=>{const u=_.get(c,ng),f=u&&l.gameState.entities.entities[u],g=_.get(c,ig);if(!f||!g)return T.FAILURE;const{gameState:m}=l;return U(a.position,g,m.mapDimensions.width,m.mapDimensions.height)>Hv?(a.activeAction==="attacking"&&a.attackTargetId===f.id&&(a.activeAction="idle",a.attackTargetId=void 0),_.set(c,ng,void 0),_.set(c,ig,void 0),T.FAILURE):((!a.lastTargetAcquiredEffectTime||l.gameState.time-a.lastTargetAcquiredEffectTime>qe*5)&&(Ge(l.gameState,Ee.TargetAcquired,a.position,qe,a.id),a.lastTargetAcquiredEffectTime=l.gameState.time),a.activeAction="attacking",a.attackTargetId=f.id,a.target=void 0,T.RUNNING)},"Attack Target",e+1);return new Ae([t,n,i,s],"Tribe Member Combat",e)}function YD(e){const t=new he((O,N)=>!O.leaderId||O.leaderId!==O.id?[!1,"Not a tribe leader"]:Dn(N.gameState,O).length<Dp?[!1,"Leader has no children"]:[!0,"Is tribe leader"],"Is Leader",e+1),n=new ae((O,N,M)=>{const F=Nn(O,N.gameState),W=F.filter(z=>z.isAdult),Z=Kr(O.leaderId,N.gameState,!0),te=ql(O,N.gameState,!0).filter(z=>iR(z,N.gameState)),j=pp(O.leaderId,N.gameState),{count:ie,ratio:se}=IA(O.leaderId,N.gameState),_e=te.length/Math.max(1,F.length),fe=Math.ceil(W.length*(1+C_)),ne=jr(O.leaderId,N.gameState,!0);return _.set(M,"tribeAnalysis_adultCount",W.length),_.set(M,"tribeAnalysis_existingStorageSpots",Z.length),_.set(M,"tribeAnalysis_existingPlantingZones",te.length),_.set(M,"tribeAnalysis_existingBonfires",ne.length),_.set(M,"tribeAnalysis_storageUtilization",j),_.set(M,"tribeAnalysis_bushCount",ie),_.set(M,"tribeAnalysis_bushDensity",se),_.set(M,"tribeAnalysis_zoneDensity",_e),_.set(M,"tribeAnalysis_projectedAdultCount",fe),[T.SUCCESS,`Analyzed tribe: ${W.length} adults, ${Z.length} storage, ${te.length} viable planting zones, ${ne.length} bonfires`]},"Analyze Tribe",e+1),i=new Gn(n,1,"Cached Tribe Analysis",e+1),s=new he((O,N,M)=>{const F=_.get(M,"tribeAnalysis_adultCount");return F===void 0?[!1,"No tribe analysis available"]:F<qy?[!1,`Tribe too small: ${F}/${qy} adults`]:[!0,`Tribe size sufficient: ${F} adults`]},"Has Minimum Tribe Size",e+1),a=new he((O,N,M)=>{if(_.has(M,"buildingPlacement_storageTarget"))return[!0,"Placement already in progress"];const F=_.get(M,"tribeAnalysis_adultCount"),W=_.get(M,"tribeAnalysis_existingStorageSpots"),Z=_.get(M,"tribeAnalysis_storageUtilization"),te=_.get(M,"tribeAnalysis_projectedAdultCount");if(F===void 0||W===void 0||Z===void 0||te===void 0)return[!1,"No tribe analysis available"];const j=W===0,ie=Z*(te/Math.max(1,F));return j||Z>Ig||ie>Ig?[!0,j?"Bootstrap: First storage spot":`Utilization: ${(Z*100).toFixed(0)}% (projected: ${(ie*100).toFixed(0)}%)`]:[!1,`Storage adequate: ${W}, util: ${(Z*100).toFixed(0)}%`]},"Needs Storage",e+2),l=new ae((O,N,M)=>{if(_.has(M,"buildingPlacement_storageTarget"))return[T.SUCCESS,"Using existing storage placement target"];const F=_.get(M,"tribeAnalysis_existingStorageSpots");if(F===void 0)return[T.FAILURE,"No tribe analysis available"];const Z=F===0?Yv:qs,te=Zs(ce.StorageSpot,O.id,N.gameState,Zi,Z,O.position);return te?(_.set(M,"buildingPlacement_storageTarget",te),[T.SUCCESS,`Found storage location at (${te.x.toFixed(0)}, ${te.y.toFixed(0)})`]):[T.FAILURE,`No valid location found for storage within ${Zi}px`]},"Find Storage Location",e+2),c=new ae((O,N,M)=>{const F=_.get(M,"buildingPlacement_storageTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const W=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return W<=Qi?[T.SUCCESS,`Reached storage location (${W.toFixed(0)}px away)`]:(O.activeAction="moving",O.target=F,O.direction=$e(O.position,F,N.gameState.mapDimensions),[T.RUNNING,`Moving to storage location (${W.toFixed(0)}px away)`])},"Move To Storage Location",e+2),u=new ae((O,N,M)=>{const F=_.get(M,"buildingPlacement_storageTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const W=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return W>Qi?[T.FAILURE,`Too far from placement location: ${W.toFixed(0)}px`]:(Vo(F,ce.StorageSpot,O.id,N.gameState),_.delete(M,"buildingPlacement_storageTarget"),_.delete(M,"caching_Cached Tribe Analysis_status"),_.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[T.SUCCESS,`Placed storage at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`])},"Place Storage",e+2),f=new Ae([a,l,c,u],"Storage Sequence",e+1),g=new he((O,N,M)=>{if(!O.leaderId)return[!1,"No tribe"];if(_.has(M,"buildingPlacement_bonfireTarget"))return[!0,"Placement already in progress"];const F=_.get(M,"tribeAnalysis_existingBonfires")||0,W=_.get(M,"tribeAnalysis_adultCount")||0,Z=ni(O.leaderId,N.gameState),te=er(N.gameState.temperature,Z,N.gameState.time,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height),j=te<dA&&F===0,ie=F>0&&F<Math.ceil(W/uA),se=Nn(O,N.gameState),_e=jr(O.leaderId,N.gameState,!0),fe=se.filter(z=>er(N.gameState.temperature,z.position,N.gameState.time,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height)<so+5?_e.every(Y=>U(z.position,Y.position,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height)>br*1.5):!1),ne=fe.length>=3;if(j||ie||ne){if(ne){const V=fe.reduce((K,b)=>({x:K.x+b.position.x,y:K.y+b.position.y}),{x:0,y:0});V.x/=fe.length,V.y/=fe.length,_.set(M,"buildingPlacement_coldClusterPos",V)}else _.delete(M,"buildingPlacement_coldClusterPos");let z="";return j?z=`Cold at center: ${te.toFixed(1)}C`:ie?z=`Tribe size: ${W}/${F} fires`:z=`Cold cluster: ${fe.length} members`,[!0,z]}return[!1,`Adequate heating: ${F} fires for ${W} adults`]},"Needs Bonfire",e+2),m=new ae((O,N,M)=>{if(_.has(M,"buildingPlacement_bonfireTarget"))return[T.SUCCESS,"Using existing bonfire placement target"];const F=_.get(M,"buildingPlacement_coldClusterPos"),W=Zs(ce.Bonfire,O.id,N.gameState,Zi,qs,F||O.position);return W?(_.set(M,"buildingPlacement_bonfireTarget",W),[T.SUCCESS,`Found bonfire location at (${W.x.toFixed(0)}, ${W.y.toFixed(0)})`]):[T.FAILURE,`No valid location found for bonfire within ${Zi}px`]},"Find Bonfire Location",e+2),S=new ae((O,N,M)=>{const F=_.get(M,"buildingPlacement_bonfireTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const W=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return W<=Qi?[T.SUCCESS,`Reached bonfire location (${W.toFixed(0)}px away)`]:(O.activeAction="moving",O.target=F,O.direction=$e(O.position,F,N.gameState.mapDimensions),[T.RUNNING,`Moving to bonfire location (${W.toFixed(0)}px away)`])},"Move To Bonfire Location",e+2),v=new ae((O,N,M)=>{const F=_.get(M,"buildingPlacement_bonfireTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const W=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return W>Qi?[T.FAILURE,`Too far from placement location: ${W.toFixed(0)}px`]:(Vo(F,ce.Bonfire,O.id,N.gameState),_.delete(M,"buildingPlacement_bonfireTarget"),_.delete(M,"caching_Cached Tribe Analysis_status"),_.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[T.SUCCESS,`Placed bonfire at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`])},"Place Bonfire",e+2),I=new Ae([g,m,S,v],"Bonfire Sequence",e+1),A=new he((O,N,M)=>{if(_.has(M,"buildingPlacement_plantingTarget"))return[!0,"Placement already in progress"];const F=_.get(M,"tribeAnalysis_adultCount"),W=_.get(M,"tribeAnalysis_existingPlantingZones"),Z=_.get(M,"tribeAnalysis_bushDensity"),te=_.get(M,"tribeAnalysis_bushCount"),j=_.get(M,"tribeAnalysis_zoneDensity"),ie=_.get(M,"tribeAnalysis_projectedAdultCount");if(F===void 0||W===void 0||Z===void 0||te===void 0||j===void 0||ie===void 0)return[!1,"No tribe analysis available"];const se=Z*(F/Math.max(1,ie)),fe=W===0||Z<Tg||se<Tg||te<=Us&&W<=Us;return fe&&j>se&&(te>Us||W>Us)?[!1,`Planting zone density (${j.toFixed(2)}) exceeds projected density (${se.toFixed(2)})`]:fe?[!0,`Low bush density: ${Z.toFixed(1)}, count: ${te}/${W} (projected: ${se.toFixed(1)})`]:[!1,`Planting zones adequate: ${W}, density: ${Z.toFixed(1)}`]},"Needs Planting Zone",e+2),C=new ae((O,N,M)=>{if(_.has(M,"buildingPlacement_plantingTarget"))return[T.SUCCESS,"Using existing planting zone placement target"];const F=Zs(ce.PlantingZone,O.id,N.gameState,Zi,qs,O.position);return F?(_.set(M,"buildingPlacement_plantingTarget",F),[T.SUCCESS,`Found planting zone location at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`]):[T.FAILURE,`No valid location found for planting zone within ${Zi}px`]},"Find Planting Zone Location",e+2),P=new ae((O,N,M)=>{const F=_.get(M,"buildingPlacement_plantingTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const W=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return W<=Qi?[T.SUCCESS,`Reached planting zone location (${W.toFixed(0)}px away)`]:(O.activeAction="moving",O.target=F,O.direction=$e(O.position,F,N.gameState.mapDimensions),[T.RUNNING,`Moving to planting zone location (${W.toFixed(0)}px away)`])},"Move To Planting Zone Location",e+2),R=new ae((O,N,M)=>{const F=_.get(M,"buildingPlacement_plantingTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const W=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return W>Qi?[T.FAILURE,`Too far from placement location: ${W.toFixed(0)}px`]:(Vo(F,ce.PlantingZone,O.id,N.gameState),_.delete(M,"buildingPlacement_plantingTarget"),_.delete(M,"caching_Cached Tribe Analysis_status"),_.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[T.SUCCESS,`Placed planting zone at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`])},"Place Planting Zone",e+2),w=new Ae([A,C,P,R],"Planting Zone Sequence",e+1),B=new ln([f,I,w],"Building Type Selector",e+1);return new Ae([t,i,s,B],"Leader Building Placement",e)}function Be(e,t,n,i,s){const a=t,l=i,c="position"in e&&e.id?e:null,u=c?c.position:e,f=a.search[n].byRadius(u,l);let g=null,m=l;for(const S of f){if(S.id===(c==null?void 0:c.id)||s&&!s(S))continue;const v=U(u,S.position,t.mapDimensions.width,t.mapDimensions.height);v<m&&(m=v,g=S)}return g}function zD(e,t,n,i){return t.search[n].byRadius(e,i)}function US(e,t,n,i){return zD(e,t,n,i).length}function vt(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function pI(e,t){var l;const i=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const c of i){if(c.attackTargetId!==e)continue;const u=U(c.position,((l=t.entities.entities[e])==null?void 0:l.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<a&&(s=c,a=u)}return s}function mI(e){return Object.values(e.entities.entities).filter(t=>t.type==="human")}function jD(e,t,n){const{width:i,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const l of a){const c=U(e,l.position,i,s),u=l.type==="tree"?l.radius*2:l.radius;if(c<u)return l}}function XD(e,t,n,i){const s=mI(i),a={};for(const l of s)!l.leaderId||l.leaderId===t||(a[l.leaderId]||(a[l.leaderId]={sumX:0,sumY:0,count:0}),a[l.leaderId].sumX+=l.position.x,a[l.leaderId].sumY+=l.position.y,a[l.leaderId].count++);for(const l in a){const c=a[l],u={x:c.sumX/c.count,y:c.sumY/c.count};if(U(e,u,i.mapDimensions.width,i.mapDimensions.height)<n)return!0}return!1}const bo="takeOverBuildingTarget";function VD(e){const t=new Ae([new he((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=_.get(s,bo);if(a){const c=i.gameState.entities.entities[a];if(c&&c.type==="building"&&Vt(n,c,i.gameState))return[!0,`Continuing to target building ${a}`];_.delete(s,bo)}const l=Be(n,i.gameState,"building",jv,c=>Vt(n,c,i.gameState)&&c.isConstructed);return l?(_.set(s,bo,l.id),[!0,`Found enemy building at distance ${U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Take Over",e+2),new ae((n,i,s)=>{const a=_.get(s,bo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(_.delete(s,bo),n.activeAction="idle",n.target=void 0,T.FAILURE):U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<ze?(n.activeAction="idle",n.target=void 0,T.SUCCESS):(n.activeAction="moving",n.target=l.id,T.RUNNING)},"Move to Enemy Building",e+2),new ae((n,i,s)=>{const a=_.get(s,bo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(_.delete(s,bo),T.FAILURE):(n.activeAction="takingOverBuilding",n.target=l.id,_.delete(s,bo),T.SUCCESS)},"Initiate Building Takeover",e+2)],"Take Over Building Action",e+1);return new Sa(zv,t,"Take Over Building Cooldown",e)}const HS=2,KD=40,GS=3;function qD(e){const t=new he(a=>{if(!a.isAdult)return[!1,"Not an adult"];if(a.hunger>ep)return[!1,`Too hungry (${a.hunger.toFixed(1)})`];const l=a.leaderId===a.id,c=a.tribeRole===ee.Warrior;return!l&&!c?[!1,`Not a Warrior or Leader (role: ${a.tribeRole||"none"})`]:[!0,l?"Is Leader":"Is Warrior"]},"Is Warrior or Leader",e+1),n=new he(a=>{var c,u;if(a.leaderId!==a.id)return[!0,"Warrior follows leader strategy"];const l=((u=(c=a.tribeControl)==null?void 0:c.armyControl)==null?void 0:u.expandBorders)??0;return l<HS?[!1,`Expand borders weight too low: ${l}/${HS}`]:[!0,`Expand borders weight: ${l}`]},"Has Expand Borders Weight",e+1),i=new he((a,l)=>{if(!a.leaderId)return[!1,"No tribe leader"];const u=l.gameState.search.building.byProperty("ownerId",a.leaderId);return u.length===0?[!1,"No territory to expand"]:[!0,`Tribe has ${u.length} buildings`]},"Has Territory",e+1),s=new ae((a,l,c)=>{if(!a.leaderId)return[T.FAILURE,"No leader"];const u=l.gameState,f=u.mapDimensions.width,g=u.mapDimensions.height,m=vA(a.position,a.leaderId,u);if(!m)return[T.FAILURE,"Could not find territory edge"];const S=U(a.position,m,f,g);if(S>KD)return a.activeAction="moving",a.target=m,[T.RUNNING,`Approaching territory edge (${S.toFixed(0)}px)`];const I=u.search.building.byProperty("ownerId",a.leaderId),A=Kd(I.map(F=>F.position));_.get(c,"pioneerOrbitDirection")===void 0&&_.set(c,"pioneerOrbitDirection",1);const C=Math.ceil(f/Re),P=Math.ceil(g/Re),R=Xw(a.position),w=[];for(let F=-3;F<=GS;F++)for(let W=-3;W<=GS;W++){if(W===0&&F===0)continue;const Z=((R.x+W)%C+C)%C,te=((R.y+F)%P+P)%P,j=te*C+Z,ie=u.terrainOwnership[j],se=ie!==null&&ga(a.leaderId,ie,u);if(ie!==null&&!se)continue;const _e={x:Z*Re+Re/2,y:te*Re+Re/2};pA(_e,a.leaderId,u,cp,!0,a.leaderId).canPlace&&w.push({pos:_e,gx:Z,gy:te})}if(w.length===0)return _.set(c,"pioneerOrbitDirection",-_.get(c,"pioneerOrbitDirection")),[T.RUNNING,"Blocked, reversing orbit direction"];const B=ot(Xe(A,a.position,f,g)),O=Eg(B,_.get(c,"pioneerOrbitDirection")*(Math.PI/2));let N=w[0],M=-1/0;for(const F of w){let W=0;for(let fe=-1;fe<=1;fe++)for(let ne=-1;ne<=1;ne++){if(ne===0&&fe===0)continue;const z=((F.gx+ne)%C+C)%C,V=((F.gy+fe)%P+P)%P;u.terrainOwnership[V*C+z]===a.leaderId&&W++}const Z=ot(Xe(a.position,F.pos,f,g)),te=Vv(Z,O),j=U(A,F.pos,f,g),ie=U(A,a.position,f,g),se=j>ie?1:0,_e=W*2+te*1.5+se*.5;_e>M&&(M=_e,N=F)}return Vo(a.position,ce.BorderPost,a.leaderId,u),a.target=N.pos,a.activeAction="moving",[T.RUNNING,"Expanding territory (cell-based)"]},"Pioneer Expansion",e+1);return new Ae([t,n,i,s],"Border Expansion",e)}const Bo="removeEnemyBuildingTarget";function ZD(e){const t=new Ae([new he((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=_.get(s,Bo);if(a){const c=i.gameState.entities.entities[a];if(c&&c.type==="building"&&Vt(n,c,i.gameState))return[!0,`Continuing to target building ${a}`];_.delete(s,Bo)}const l=Be(n,i.gameState,"building",jv,c=>Vt(n,c,i.gameState)&&c.isConstructed);return l?(_.set(s,Bo,l.id),[!0,`Found enemy building at distance ${U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Destroy",e+2),new ae((n,i,s)=>{const a=_.get(s,Bo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(_.delete(s,Bo),n.activeAction="idle",n.target=void 0,T.FAILURE):U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<ze?(n.activeAction="idle",n.target=void 0,T.SUCCESS):(n.activeAction="moving",n.target=l.id,T.RUNNING)},"Move to Enemy Building",e+2),new ae((n,i,s)=>{const a=_.get(s,Bo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Vt(n,l,i.gameState)?(_.delete(s,Bo),T.FAILURE):(n.activeAction="destroyingBuilding",n.target=l.id,_.delete(s,Bo),T.SUCCESS)},"Initiate Building Destruction",e+2)],"Remove Enemy Building Action",e+1);return new Sa(zv,t,"Remove Enemy Building Cooldown",e)}function QD(e){return new Ae([new ae((t,n,i)=>{const s=Lg(t,n.gameState);return s?(_.set(i,"patriarchTarget",s.id),[T.SUCCESS,`Found patriarch: ${s.id}`]):(_.delete(i,"patriarchTarget"),[T.FAILURE,"No patriarch found"])},"Find Patriarch",e+1),new ae((t,n,i)=>{const s=_.get(i,"patriarchTarget"),a=s&&n.gameState.entities.entities[s];if(!a)return[T.FAILURE,"Patriarch target missing from blackboard"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l>KC){t.activeAction="moving",t.target=a.id;const c=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(c),[T.RUNNING,`Moving to patriarch at ${l.toFixed(0)}`]}return t.activeAction="idle",t.target=void 0,t.direction={x:0,y:0},[T.SUCCESS,`Arrived at patriarch at ${l.toFixed(0)}`]},"Move Towards Patriarch",e+1)],"Follow Patriarch",e)}let og=0;function iu(){const e=tu[og];return og=(og+1)%tu.length,e}const Mp="tribeSplit_phase",ec="tribeSplit_strategy",Op="tribeSplit_targetPosition",Pu="tribeSplit_targetBuildingId",Du="tribeSplit_familyIds",yI="tribeSplit_phaseStartTime",SI="tribeSplit_lastFailureTime";function vI(e,t){_.set(e,Mp,"idle"),_.delete(e,ec),_.delete(e,Op),_.delete(e,Pu),_.delete(e,Du),_.set(e,SI,t)}function JD(e,t){const n=_.get(e,SI);return n?t-n>=gD:!0}function eN(e,t){const n=_.get(e,yI);return n?t-n>=hD:!1}function kp(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(LI(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!JD(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const i=t.entities.entities[e.leaderId];if(!i||i.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=Xr(Dn(t,i));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(ru(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const l=Ui(e.leaderId,t).filter(v=>v.isAdult);if(l.length<eg)return{canSplit:!1,reason:"Tribe too small"};const u=su(e,t).length+1,g=su(i,t).length+1;if(u>=g&&u>eg)return{canSplit:!0,progress:1,strategy:$S(e,t)};const m=Math.max(l.length*dD,eg),S=u/m;if(u>=m){const v=$S(e,t);return{canSplit:!0,progress:S,strategy:v}}return{canSplit:!1,progress:S,reason:`Family too small: ${u} < ${m}`}}function $S(e,t){if(!e.leaderId)return"migration";const n=t;if(!(bi(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===ce.StorageSpot&&a.isConstructed);return s.length>0&&s.find(l=>U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height)<=fD)?"concentration":"migration"}function AI(e,t){if(!e.aiBlackboard)return!1;const n=_.get(e.aiBlackboard,ec);if(!n)return!1;const i=su(e,t),s=[e.id,...i.map(a=>a.id)];return _.set(e.aiBlackboard,Du,s),n==="migration"?nN(e,t):n==="concentration"?iN(e,t):!1}function tN(e,t,n){if(Wn(e,n,30))return!1;const s=bi(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function nN(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,i=t.mapDimensions.height,s=Math.min(n,i)/2,a=50,l=50;for(let c=0;c<=s;c+=a){const u=c===0?1:Math.max(8,Math.ceil(2*Math.PI*c/l)),f=c===0?0:2*Math.PI/u;for(let g=0;g<u;g++){const m=g*f,S=Math.cos(m)*c,v=Math.sin(m)*c,I=e.position.x+S,A=e.position.y+v,C={x:(I%n+n)%n,y:(A%i+i)%i};if(tN(C,e.leaderId,t))return _.set(e.aiBlackboard,Op,C),!0}}return!1}function iN(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const i=t.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===ce.StorageSpot&&l.isConstructed);if(i.length===0)return!1;let s=null,a=1/0;for(const l of i){const c=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);c<a&&(a=c,s=l)}return s?(_.set(e.aiBlackboard,Pu,s.id),!0):!1}function oN(e,t){var c;if(!e.aiBlackboard)return[!1,0];const n=_.get(e.aiBlackboard,ec),i=(c=_.get(e.aiBlackboard,Du))==null?void 0:c.filter(u=>!!t.entities.entities[u]);if(!n||!i)return[!1,0];let s;if(n==="migration"){const u=_.get(e.aiBlackboard,Op);if(!u)return[!1,0];s=u}else if(n==="concentration"){const u=_.get(e.aiBlackboard,Pu);if(!u)return[!1,0];const f=t.entities.entities[u];if(!f)return[!1,0];s=f.position}else return[!1,0];let a=0;for(const u of i){const f=t.entities.entities[u];if(!f||f.type!=="human")continue;U(f.position,s,t.mapDimensions.width,t.mapDimensions.height)<=dI&&a++}const l=Math.ceil(i.length*.5);return[a>=l,a/l]}function II(e,t){var u;if(!e.aiBlackboard)return!1;const n=_.get(e.aiBlackboard,ec),i=_.get(e.aiBlackboard,Du);if(!n||!i)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=iu(),l=$n[Math.floor(Math.random()*$n.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:l},e.tribeRole=ee.Leader,e.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=Ut.Hostile);for(const f of i){if(f===e.id)continue;const g=t.entities.entities[f];!g||g.type!=="human"||(g.leaderId=e.id,g.tribeInfo={tribeBadge:a,tribeColor:l})}if(n==="concentration"){const f=_.get(e.aiBlackboard,Pu);if(f){const g=t.entities.entities[f];g&&g.type==="building"&&(g.ownerId=e.id)}}return Fl(t,{type:Yr.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:qd,targetEntityIds:[e.id],highlightedEntityIds:i}),Me({gameState:t},Ce.TribeSplit,e.position),vI(e.aiBlackboard,t.time),!0}function Tl(e){return e?_.get(e,Mp)??"idle":"idle"}function Rs(e,t,n){_.set(e,Mp,t),_.set(e,yI,n)}function TI(e,t){_.set(e,ec,t)}function rN(e,t){vI(e,t)}function sN(e,t){return eN(e,t)?(rN(e,t),!0):!1}function EI(e,t){const n=kp(e,t);return{canSplit:n.canSplit,progress:n.progress}}function CI(e,t){if(!e.aiBlackboard)return;const n=kp(e,t);!n.canSplit||!n.strategy||(TI(e.aiBlackboard,n.strategy),AI(e,t)&&II(e,t))}function aN(e){const t=new ln([new Ae([new he((n,i)=>{if(!n.aiBlackboard)return[!1,"No blackboard"];if(!n.leaderId||n.leaderId===n.id)return[!1,"No tribe or the leader"];if(ru(n,i.gameState).id!==n.id)return[!1,"Not patriarch"];const a=Tl(n.aiBlackboard);return a!=="idle"&&sN(n.aiBlackboard,i.gameState.time)?(Rs(n.aiBlackboard,"idle",i.gameState.time),[!1,"Phase timed out, reset to idle"]):[a==="idle",`Phase: ${a}`]},"Is Idle?",e+2),new ae((n,i)=>{if(!n.aiBlackboard)return T.FAILURE;const s=kp(n,i.gameState);return s.canSplit&&s.strategy?(Rs(n.aiBlackboard,"planning",i.gameState.time),TI(n.aiBlackboard,s.strategy),T.SUCCESS):[T.FAILURE,s.reason||"Cannot split"]},"Check Split Conditions",e+2)],"Check Phase",e+1),new Ae([new he(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Tl(n.aiBlackboard);return[i==="planning",`Phase: ${i}`]},"Is Planning?",e+2),new ae((n,i)=>n.aiBlackboard?AI(n,i.gameState)?(Rs(n.aiBlackboard,"gathering",i.gameState.time),T.SUCCESS):(Rs(n.aiBlackboard,"idle",i.gameState.time),T.FAILURE):T.FAILURE,"Plan Split Strategy",e+2)],"Planning Phase",e+1),new Ae([new he(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Tl(n.aiBlackboard);return[i==="gathering",`Phase: ${i}`]},"Is Gathering?",e+2),new ae((n,i)=>{if(!n.aiBlackboard)return T.FAILURE;const[s,a]=oN(n,i.gameState);return s?(Rs(n.aiBlackboard,"executing",i.gameState.time),T.SUCCESS):[T.RUNNING,`Progress: ${a.toFixed(2)}`]},"Wait for Family to Gather",e+2)],"Gathering Phase",e+1),new Ae([new he(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Tl(n.aiBlackboard);return[i==="executing",`Phase: ${i}`]},"Is Executing?",e+2),new ae((n,i)=>n.aiBlackboard?II(n,i.gameState)?T.SUCCESS:(Rs(n.aiBlackboard,"idle",i.gameState.time),T.FAILURE):T.FAILURE,"Execute Tribe Split",e+2)],"Execution Phase",e+1)],"Tribe Split State Machine",e+1);return new Sa(uD,t,"Tribe Split Cooldown",e)}const Ed="jealousyAttackTarget";function lN(e){return new Ae([new he((t,n,i)=>{var l,c;if(!t.isAdult)return[!1,"Not an adult"];if(t.gender!=="male")return[!1,"Not male"];const s=((c=(l=t.partnerIds)==null?void 0:l.map(u=>{var f;return(f=n.gameState.entities.entities[u])==null?void 0:f.pregnancyFatherId}))==null?void 0:c.filter(u=>!!u&&u!==t.id))??[],a=n.gameState.search.human.byRadius(t.position,c_).find(u=>s.includes(u.id));return a?t.leaderId&&a.id===t.leaderId?[!1,"Stranger is the tribe leader - no attack"]:(_.set(i,Ed,a.id),[!0,`Partner cheating with ${a.id}`]):(_.delete(i,Ed),!1)},"Check for Infidelity",e+1),new ae((t,n,i)=>{const s=_.get(i,Ed),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(_.delete(i,Ed),[T.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?T.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[T.RUNNING,`Attacking ${a.id}`])},"Execute Jealousy Attack",e+1)],"Jealousy Attack",e)}const Cd="defendAggressor";function cN(e){return new Ae([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const s=wO(t,n.gameState,d_);return s?(_.set(i,Cd,s.aggressor.id),[!0,`Family member ${s.familyMember.id} attacked by ${s.aggressor.id}`]):(_.delete(i,Cd),!1)},"Check Family Under Attack",e+1),new ae((t,n,i)=>{const s=_.get(i,Cd),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(_.delete(i,Cd),[T.FAILURE,"Target invalid/dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?T.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[T.RUNNING,`Attacking aggressor ${a.id}`])},"Execute Family Defense Attack",e+1)],"Defend Family",e)}const _d="desperateAttackTarget";function dN(e){return new Ae([new he(t=>t.hunger>u_,"Is Starving",e+1),new he((t,n)=>{if(!t.isAdult)return[!1,"Not an adult"];const i=Be(t,n.gameState,"berryBush",ze,a=>a.food.length>0),s=Be(t,n.gameState,"corpse",ze,a=>a.food.length>0);return!i&&!s},"No Other Food Available",e+1),new he((t,n,i)=>{const s=RO(t,n.gameState);return s?(_.set(i,_d,s.id),[!0,`Found weak target ${s.id}`]):(_.delete(i,_d),!1)},"Find Weak Target",e+1),new ae((t,n,i)=>{const s=_.get(i,_d),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(_.delete(i,_d),[T.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?T.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[T.RUNNING,`Desperately attacking ${a.id}`])},"Execute Desperate Attack",e+1)],"Desperate Attack",e)}var oe=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(oe||{});const Nu={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},_I={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var Bs=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(Bs||{});const ll={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var le=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenRoleManager="OpenRoleManager",e.CloseRoleManager="CloseRoleManager",e.IncreaseRoleWeight="IncreaseRoleWeight",e.DecreaseRoleWeight="DecreaseRoleWeight",e.OpenArmyControl="OpenArmyControl",e.CloseArmyControl="CloseArmyControl",e.IncreaseArmyObjective="IncreaseArmyObjective",e.DecreaseArmyObjective="DecreaseArmyObjective",e.SwitchAIType="SwitchAIType",e))(le||{});function uN(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const a=U(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),c=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?Sn:co;return a<=c?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=s.id,t.direction=$e(t.position,s.position,e.mapDimensions),T.RUNNING)}function fN(e){return new Ae([new he((t,n)=>t.isPlayer===!0&&!!n.gameState.autopilotControls.activeAutopilotAction,"Has Player Command",e+1),new ae((t,n)=>{var a,l;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return T.FAILURE;switch(s.action){case oe.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=s.position;return U(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<Gv?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),T.SUCCESS):(t.activeAction="moving",t.target=c,t.direction=$e(t.position,c,i.mapDimensions),T.RUNNING)}case oe.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];if(!c)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;let u=!1;if(c.type==="berryBush")u=c.food.length===0;else if(c.type==="corpse")u=c.food.length===0;else if(c.type==="tree"){const g=c;u=((a=g.stateMachine)==null?void 0:a[0])!==Gt||g.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;return u?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>Wr?(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),T.RUNNING):(t.activeAction="gathering",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS)}case oe.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];if(!c||c.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const[u]=c.stateMachine??[];return!(u===sn||u===Kt||u===vn)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>Kl?(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),T.RUNNING):(t.activeAction="chopping",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS)}case oe.AutopilotAttack:return"targetEntityId"in s?uN(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE);case oe.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="human"||!nr(t,c,n.gameState)?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.AutopilotPlant:{if(t.activeAction==="planting")return T.RUNNING;if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=s.position;return Wn(c,i,Zo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(t.activeAction="planting",t.target=c,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,T.RUNNING):(t.activeAction="moving",t.target=c,t.direction=$e(t.position,c,i.mapDimensions),T.RUNNING)}case oe.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="human"||c.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];if(!c||c.buildingType!==ce.StorageSpot&&c.buildingType!==ce.Bonfire||!c.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const u=c.storageCapacity??0;if(c.storedItems.length>=u||t.leaderId!==c.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const g=t.food.length>0,m=!!t.heldItem;if(c.buildingType===ce.Bonfire){if(((l=t.heldItem)==null?void 0:l.type)!==yt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE}else if(!g&&!m)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;return U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Zt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.buildingType!==ce.StorageSpot||!c.isConstructed||c.storedItems.length===0||t.leaderId!==c.ownerId||t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Zt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!Vt(t,c,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="takingOverBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!Vt(t,c,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="destroyingBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=s.position,u=s.buildingType;if(!u)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const f=U(t.position,c,i.mapDimensions.width,i.mapDimensions.height),g=100;return f<=g?la(c,u,t.leaderId,i,t.position,g)?(Vo(c,u,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",T.SUCCESS):(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):(t.activeAction="moving",t.target=c,t.direction=$e(t.position,c,i.mapDimensions),T.RUNNING)}default:return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE}},"Execute Player Command",e+1)],"Player Command Handler",e)}function hN(e){const t=new he(i=>i.id===i.leaderId,"Is Leader?",e+1),n=new ae((i,s)=>{var f,g,m,S,v,I;const{gameState:a}=s,l=Ui(i.id,a),c=XS(l),u=bu(a).filter(A=>A.leaderId!==i.id);for(const A of u){const C=Ui(A.leaderId,a),P=XS(C),R=((g=(f=i.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[A.leaderId])||Ut.Friendly,w=a.entities.entities[A.leaderId];((S=(m=w==null?void 0:w.tribeControl)==null?void 0:m.diplomacy)==null?void 0:S[i.id])===Ut.Hostile||c>P*l_?R!==Ut.Hostile&&((v=i.tribeControl)!=null&&v.diplomacy)&&(i.tribeControl.diplomacy[A.leaderId]=Ut.Hostile):R!==Ut.Friendly&&((I=i.tribeControl)!=null&&I.diplomacy)&&(i.tribeControl.diplomacy[A.leaderId]=Ut.Friendly)}return T.SUCCESS},"Evaluate Diplomacy",e+2);return new Ae([t,new Sa(a_,n,"Diplomacy Cooldown",e+1)],"Manage Diplomacy",e)}const cl="huntTarget";function gN(e){return new Ae([new Gn(new he((n,i,s)=>{if(!n.isAdult)return[!1,"Not an adult"];if(!n.leaderId)return[!1,"Not in a tribe"];if(!xn(n,ee.Hunter,i.gameState))return[!1,"Not a Hunter"];const a=Be(n.position,i.gameState,"prey",XC,l=>!(n.leaderId&&!ao(l.position,n.leaderId,i.gameState)));return a?(_.set(s,cl,a.id),[!0,"Found prey"]):[!1,"No suitable prey found"]},"Find Prey Target",e+2),s_,"Cache Find Prey",e+1),new Li(new Mr(new ae((n,i,s)=>{if(!n.leaderId)return T.FAILURE;const a=_.get(s,cl);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];if(!l||l.hitpoints<=0)return _.delete(s,cl),n.activeAction="idle",n.attackTargetId=void 0,T.SUCCESS;const{gameState:c}=i,u=ni(n.leaderId,c);return U(n.position,u,c.mapDimensions.width,c.mapDimensions.height)>Lv?(_.delete(s,cl),n.activeAction="idle",n.attackTargetId=void 0,T.FAILURE):(n.activeAction="attacking",n.attackTargetId=l.id,T.RUNNING)},"Hunt Prey Action",e+3),Os,"Hunt Prey Timeout",e+2),{taskType:"hunt",maxCapacity:wu,getTargetId:(n,i,s)=>_.get(s,cl)??null},"Tribal Hunt Task",e+1)],"Human Hunt Prey Sequence",e)}const wd="defendTarget",rg=150;function pN(e){return new Ae([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult - children flee instead"];if(t.hitpoints<=t.maxHitpoints*.3)return[!1,"Too injured to defend"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.type==="predator"&&l.hitpoints>0&&U(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=rg)return _.set(i,wd,l.id),[!0,"Continuing defense"]}const a=Be(t,s,"predator",rg,l=>l.hitpoints>0&&(l.isAdult||!1));if(a){const l=U(t.position,a.position,s.mapDimensions.width,s.mapDimensions.height),c=a.attackTargetId===t.id,u=l<80;if(c||u)return _.set(i,wd,a.id),[!0,"Predator threat detected"]}return _.set(i,wd,void 0),[!1,"No predator threat"]},"Detect Predator Threat",e+1),new ae((t,n,i)=>{const s=_.get(i,wd),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const{gameState:l}=n,c=U(t.position,a.position,l.mapDimensions.width,l.mapDimensions.height);return t.hitpoints<t.maxHitpoints*.3?T.FAILURE:a.hitpoints<=0||c>rg*1.5?(t.activeAction="idle",t.attackTargetId=void 0,T.SUCCESS):(t.activeAction="attacking",t.attackTargetId=a.id,T.RUNNING)},"Defend Against Predator",e+1)],"Human Defend Against Predator",e)}function mN(e){const t=new ae((n,i)=>{if(!n.leaderId||!n.isAdult)return T.FAILURE;const s=i.gameState.entities.entities[n.leaderId];if(!s||!s.tribeControl)return T.FAILURE;if(n.id===s.id)return n.tribeRole!==ee.Leader&&(n.tribeRole=ee.Leader),T.SUCCESS;const l=Nn(s,i.gameState).filter(A=>A.id!==s.id),c=l.length;if(c===0)return T.SUCCESS;const u=s.tribeControl.roleWeights;let f=0;const g=[];for(const A of Object.values(ee))A!==ee.Leader&&(f+=u[A]||0,g.push(A));if(f===0)return n.tribeRole||(n.tribeRole=ee.Gatherer),T.SUCCESS;const m={},S={},v={};for(const A of g)m[A]=0,S[A]=u[A]/f*c;for(const A of l)A.tribeRole&&A.tribeRole!==ee.Leader&&(m[A.tribeRole]=(m[A.tribeRole]||0)+1);for(const A of g)v[A]=S[A]-m[A];let I=!1;if((!n.tribeRole||n.tribeRole===ee.Leader||v[n.tribeRole]<-.5&&g.some(P=>v[P]>.5))&&(I=!0),I){let A=null,C=-1/0;const P=[...g].sort(()=>Math.random()-.5);for(const R of P){const w=v[R];w>C&&(C=w,A=R)}if(A)n.tribeRole=A;else{const R=Math.random()*f;let w=0;for(const B of g)if(w+=u[B],R<=w){n.tribeRole=B;break}}}return T.SUCCESS},"Assign Tribe Role",e+1);return new Gn(t,Ls,"Cache Tribe Role Assignment",e)}const yN=5,SN=0,vN=10;function AN(e){return e<$v?{[ee.Leader]:0,[ee.Gatherer]:7,[ee.Planter]:2,[ee.Hunter]:1,[ee.Mover]:1,[ee.Warrior]:0}:e<xv?{[ee.Leader]:0,[ee.Gatherer]:5,[ee.Planter]:4,[ee.Hunter]:2,[ee.Mover]:2,[ee.Warrior]:1}:e<Wv?{[ee.Leader]:0,[ee.Gatherer]:4,[ee.Planter]:3,[ee.Hunter]:3,[ee.Mover]:3,[ee.Warrior]:2}:{[ee.Leader]:0,[ee.Gatherer]:3,[ee.Planter]:3,[ee.Hunter]:4,[ee.Mover]:3,[ee.Warrior]:3}}function IN(e){if(e.length===0)return 0;let t=0,n=0;for(const i of e)t+=i.food.length,n+=i.maxFood;return n===0?0:t/n}function TN(e,t){return e<t?Math.min(e+1,vN):e>t?Math.max(e-1,SN):e}function EN(e){const t=new ae((n,i)=>{if(!n.leaderId||n.id!==n.leaderId||!n.tribeControl)return T.FAILURE;const s=Nn(n,i.gameState);if(s.filter(m=>m.isAdult).length<yN)return T.FAILURE;const l=IN(s),c=AN(l),u=n.tribeControl.roleWeights;let f=!1;const g=[ee.Gatherer,ee.Planter,ee.Hunter,ee.Mover,ee.Warrior];for(const m of g){const S=u[m]||0,v=c[m],I=TN(S,v);I!==S&&(u[m]=I,f=!0)}if(f){const m=`Adjusted weights for food security: ${(l*100).toFixed(1)}%`;return[T.SUCCESS,m]}return T.FAILURE},"Manage Tribe Role Weights",e+1);return new Gn(t,Ls,"Cache Role Management",e)}const Cr="treeTarget";function CN(e){const t=new ae((i,s,a)=>{const l=xt(i,s.gameState),c=Be(i,s.gameState,"tree",p_,u=>{const[f]=u.stateMachine??[];if(!(f===sn||f===Kt||f===vn)||i.leaderId&&!ao(u.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const m=`tribal_chop_${u.id}`,S=_.get(l.aiBlackboard,m);if(S&&s.gameState.time-S.startTime<=Bi&&!S.memberIds.includes(i.id))return!1}return!0});return c?(_.set(a,Cr,c.id),[T.SUCCESS,`Found tree: ${c.id} at ${c.position.x.toFixed(0)},${c.position.y.toFixed(0)}`]):[T.FAILURE,"No tree found"]},"Find Closest Tree",e+4),n=new Li(new ae((i,s,a)=>{const l=_.get(a,Cr);if(!l)return[T.FAILURE,"No target in blackboard"];const c=s.gameState.entities.entities[l];if(!c)return _.delete(a,Cr),[T.FAILURE,"Tree no longer exists"];const[u]=c.stateMachine??[];return u===sn||u===Kt||u===vn?U(i.position,c.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Kl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=c.id,_.delete(a,Cr),[T.SUCCESS,`Chopping tree ${c.id}`]):(i.activeAction="moving",i.target=c.id,i.direction=$e(i.position,c.position,s.gameState.mapDimensions),[T.RUNNING,`Moving to tree ${c.id}`]):(_.delete(a,Cr),[T.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop",e+3),{taskType:"chop",maxCapacity:1,getTargetId:(i,s,a)=>_.get(a,Cr)??null},"Tribal Chop Task",e+3);return new Ae([new he((i,s)=>{const a=xt(i,s.gameState);if(!a)return[!1,"No leader for coordination"];const l=Ul(a.id,s.gameState);if(l<=0)return[!1,"No wood need"];const c=AA(a.id,s.gameState);return[l>c,`Wood need: ${l}, Available on ground: ${c}`]},"Need Wood?",e+1),new he(i=>{const s=!i.heldItem;return[(i.isAdult&&s)??!1,`${s?"Can chop":"Holding item"}`]},"Should Chop Tree",e+1),new ln([new Ae([new he((i,s,a)=>_.has(a,Cr),"Has Tree Target?",e+2),n],"Continue Chopping Action",e+2),new Ae([new Gn(t,o_,"Cache Tree Search",e+3),n],"Find New Tree and Chop",e+2)],"Perform or Start Chopping",e+1)],"Chop Tree",e)}const _r="cleanupTreeTarget";function _N(e){const t=new ae((i,s,a)=>{const l=xt(i,s.gameState),c=ql(i,s.gameState);if(c.length===0)return[T.FAILURE,"No planting zones found"];const u=s.gameState;let f=null,g=1/0;for(const m of c){const S=Math.sqrt(m.width*m.width+m.height*m.height)/2,v=u.search.tree.byRadius(m.position,S);for(const I of v){const[A]=I.stateMachine??[];if(!(A===sn||A===Kt||A===vn)||!_g(I.position,m,s.gameState))continue;if(l&&l.aiBlackboard){const R=`tribal_cleanup_tree_${I.id}`,w=_.get(l.aiBlackboard,R);if(w&&s.gameState.time-w.startTime<=Bi&&!w.memberIds.includes(i.id))continue}const P=U(i.position,I.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);P<g&&(g=P,f=I)}}return f?(_.set(a,_r,f.id),[T.SUCCESS,`Found nuisance tree: ${f.id} at ${f.position.x.toFixed(0)},${f.position.y.toFixed(0)}`]):[T.FAILURE,"No nuisance trees found in planting zones"]},"Find Nuisance Tree",e+4),n=new Li(new ae((i,s,a)=>{const l=_.get(a,_r);if(!l)return[T.FAILURE,"No target in blackboard"];const c=s.gameState.entities.entities[l];if(!c)return _.delete(a,_r),[T.FAILURE,"Tree no longer exists"];const[u]=c.stateMachine??[];return u===sn||u===Kt||u===vn?U(i.position,c.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Kl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=c.id,_.delete(a,_r),[T.SUCCESS,`Chopping nuisance tree ${c.id}`]):(i.activeAction="moving",i.target=c.id,i.direction=$e(i.position,c.position,s.gameState.mapDimensions),[T.RUNNING,`Moving to nuisance tree ${c.id}`]):(_.delete(a,_r),[T.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop (Cleanup)",e+3),{taskType:"cleanup_tree",maxCapacity:1,getTargetId:(i,s,a)=>_.get(a,_r)??null},"Tribal Cleanup Tree Task",e+3);return new Ae([new he((i,s)=>{const a=xn(i,ee.Planter,s.gameState),l=xn(i,ee.Gatherer,s.gameState),c=!i.heldItem;return[!!(i.isAdult&&(a||l)&&c),`${c?"Planter/Gatherer role eligible":"Holding item"}`]},"Should Cleanup Zone?",e+1),new ln([new Ae([new he((i,s,a)=>_.has(a,_r),"Has Cleanup Target?",e+2),n],"Continue Cleanup Action",e+2),new Ae([new Gn(t,r_,"Cache Cleanup Search",e+3),n],"Find New Nuisance Tree and Chop",e+2)],"Perform or Start Cleanup",e+1)],"Cleanup Planting Zones",e)}const dl="bonfireTargetId",wN=800;function RN(e){return new Ae([new he((t,n)=>{const i=er(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<so+8;return[s,`Temp: ${i.toFixed(1)}C`+(s?" (Cold)":"")]},"Is Cold?",e+1),new ae((t,n,i)=>{const s=xt(t,n.gameState),a=Be(t,n.gameState,"building",wN,l=>{if(!(l.buildingType===ce.Bonfire&&l.isConstructed&&!l.isBeingDestroyed&&(l.fuelLevel??0)>0)||l.ownerId!==t.leaderId)return!1;if(s&&s.aiBlackboard){const u=`tribal_warmth_${l.id}`,f=_.get(s.aiBlackboard,u);if(f&&n.gameState.time-f.startTime<=Bi&&f.memberIds.length>=wg&&!f.memberIds.includes(t.id))return!1}return!0});return a?(_.set(i,dl,a.id),[T.SUCCESS,`Found bonfire ${a.id}`]):(_.delete(i,dl),[T.FAILURE,"No available fueled bonfires found"])},"Find Bonfire",e+1),new Li(new ae((t,n,i)=>{const s=_.get(i,dl),a=s&&n.gameState.entities.entities[s];if(!a||(a.fuelLevel??0)<=0||!a.isConstructed)return _.delete(i,dl),T.FAILURE;const l=t.id*137%360*(Math.PI/180),c=br*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,g={x:(a.position.x+Math.cos(l)*c+u)%u,y:(a.position.y+Math.sin(l)*c+f)%f},m=U(t.position,g,u,f);return m>10?(t.activeAction="moving",t.target=g,t.direction=$e(t.position,g,n.gameState.mapDimensions),[T.RUNNING,`Moving to personal warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[T.RUNNING,"Staying warm at personal spot"])},"Move to Warmth Spot",e+2),{taskType:"warmth",maxCapacity:wg,getTargetId:(t,n,i)=>_.get(i,dl)??null},"Tribal Warmth Task",e+1)],"Gather at Bonfire Sequence",e)}function PN(e){const t=new ae((n,i,s)=>{if(!n.leaderId||n.id!==n.leaderId)return[T.FAILURE,"Not a tribe leader"];const a=jr(n.id,i.gameState);let l=0;for(const c of a)if(c.isConstructed&&c.fuelLevel!==void 0){const u=c.maxFuelLevel??Br;c.fuelLevel<u*gp&&(aI(s,c.id,"wood",i.gameState.time),l++)}return[T.SUCCESS,`Tribe logistics: ${l} wood demands registered for bonfires`]},"Manage Tribe Logistics",e+1);return new Gn(t,jw,"Cached Tribe Logistics",e)}function DN(e){return new Ae([new he((t,n,i)=>{const s=Be(t,n.gameState,"predator",yn*2,()=>!0),a=Be(t,n.gameState,"human",yn*2,()=>!0);let l=null,c=1/0;if(s){const u=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<c&&(c=u,l=s)}if(a){const u=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<c&&(c=u,l=a)}return l&&c<yn*1.5?(_.set(i,"fleeThreat",l.id),_.set(i,"fleeDistance",c),!0):!1},"Detect Threat",e+1),new ae((t,n,i)=>{const s=_.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;t.activeAction="moving";const l=Xe(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=ot(l),u=ti(t.position,At(c,VR));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,t.fleeCooldown=n.gameState.time+2,T.RUNNING},"Execute Flee",e+1)],"Prey Flee",e)}function NN(e){return new Ae([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=30||t.eatingCooldownTime&&t.eatingCooldownTime>n.gameState.time)return!1;const s=Be(t,n.gameState,"berryBush",yn*10,a=>a.food.length>0);return s?U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=yn?(_.set(i,"grazingTarget",s.id),!0):(_.set(i,"grazingTarget",s.id),_.set(i,"needToMoveToTarget",!0),!0):!1},"Find Berry Bush",e+1),new ae((t,n,i)=>{const s=_.get(i,"grazingTarget"),a=s&&n.gameState.entities.entities[s],l=_.get(i,"needToMoveToTarget");if(!a)return T.FAILURE;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=yn)return t.activeAction="grazing",t.target=a.id,t.direction={x:0,y:0},_.delete(i,"needToMoveToTarget"),T.RUNNING;if(l||c>yn){t.activeAction="moving",t.target=a.id;const u=$e(t.position,a.position,n.gameState.mapDimensions);return t.direction=u,T.RUNNING}return T.FAILURE},"Move to Bush or Graze",e+1)],"Prey Graze",e)}function MN(e){const t=new he((a,l,c)=>{const u=Be(a,l.gameState,"prey",yn,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Dl&&f.age<=zh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(_.set(c,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new ae((a,l,c)=>{const u=_.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},_.delete(c,"procreationPartner"),T.SUCCESS):T.FAILURE},"Start Procreating",e+2),i=new he((a,l,c)=>{const u=Be(a,l.gameState,"prey",yn*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Dl&&f.age<=zh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(_.set(c,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new ae((a,l,c)=>{const u=_.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return T.FAILURE;if(U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=yn)return T.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),T.RUNNING},"Move Towards Partner",e+2);return new Ae([new he(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=Dl&&a.age<=zh&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new ln([new Ae([t,n],"Procreate With Immediate Partner",e+2),new Ae([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Prey Procreate",e)}const ON=(e,t,n)=>{const i=t.gameState.search.prey.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="prey");if(i.length===0)return T.FAILURE;let s=null,a=Eu;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(_.set(n,"targetChild",s.id),T.SUCCESS):T.FAILURE},kN=(e,t,n)=>{const i=_.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>ma?(e.activeAction="moving",e.target=s.id,e.direction=$e(e.position,s.position,t.gameState.mapDimensions),T.RUNNING):(e.activeAction="feeding",e.target=void 0,_.set(n,"targetChild",void 0),T.SUCCESS):T.FAILURE};function bN(e){return new Ae([new he(t=>(t.isAdult&&t.gender==="female"&&t.hunger<80&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new ae(ON,"Find Hungriest Prey Child",e+1),new ae(kN,"Move To Child and Feed",e+1)],"Feed Prey Child",e)}function BN(e){return new Ae([new he(t=>!t.isAdult&&t.hunger>=Eu,"Is Hungry Prey Child",e+1),new ae((t,n,i)=>{if(!t.motherId)return T.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(_.set(i,"targetParent",s.id),T.SUCCESS):T.FAILURE},"Find Female Parent",e+1),new ae((t,n,i)=>{const s=_.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=ma?(t.target=void 0,T.SUCCESS):(t.target=a.id,t.activeAction="moving",T.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}const Rd="huntTarget";function FN(e,t,n){if(!(e!=null&&e.aiBlackboard))return!0;const i=`tribal_hunt_${t}`,s=_.get(e.aiBlackboard,i);return!s||n-s.startTime>Bi?!0:s.memberIds.length<(s.maxCapacity||wu)}function LN(e,t,n,i){if(!(e!=null&&e.aiBlackboard))return;const s=`tribal_hunt_${n}`;let a=_.get(e.aiBlackboard,s);a||(a={memberIds:[],startTime:i,maxCapacity:wu},_.set(e.aiBlackboard,s,a)),a.memberIds.includes(t.id)||a.memberIds.push(t.id)}function UN(e,t){if(!(e!=null&&e.aiBlackboard))return 0;const n=`tribal_hunt_${t}`,i=_.get(e.aiBlackboard,n);return(i==null?void 0:i.memberIds.length)??0}function $d(e,t,n=new Set){if(n.has(e.id))return e;n.add(e.id);for(const i of[e.fatherId,e.pregnancyFatherId,e.motherId]){if(!i||i===e.id)continue;const s=t.entities.entities[i];if(s)return $d(s,t,n)}return e}function HN(e){return new Ae([new he((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=50||t.huntCooldown&&t.huntCooldown>0)return!1;const s=Be(t,n.gameState,"prey",ks*10,a=>{if(a.hitpoints<=0)return!1;const l=$d(t,n.gameState);return!(l&&!FN(l,a.id,n.gameState.time))});if(s){const a=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=$d(t,n.gameState),c=l?UN(l,s.id):0;if(a<=ks)return _.set(i,Rd,s.id),[!0,`Prey in range (${c} hunters)`];if(a<=ks*10)return _.set(i,Rd,s.id),_.set(i,"needToApproach",!0),[!0,`Approaching prey (${c} hunters)`]}return!1},"Find Prey Target",e+1),new Mr(new ae((t,n,i)=>{const s=_.get(i,Rd),a=s&&n.gameState.entities.entities[s],l=_.get(i,"needToApproach");if(!a||a.hitpoints<=0)return _.delete(i,Rd),_.delete(i,"needToApproach"),T.SUCCESS;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=ks)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},_.delete(i,"needToApproach"),T.RUNNING;if(l||c>ks){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),LN($d(t,n.gameState),t,a.id,n.gameState.time),T.RUNNING}return T.FAILURE},"Hunt or Approach Prey",e+3),10,"Hunt Timeout (10 hour)",e+2)],"Predator Hunt",e)}function GN(e){return new Ae([new he((t,n,i)=>{const s=t.hunger>100,a=t.hitpoints<t.maxHitpoints*.5;if(!s&&!a||t.attackCooldown&&t.attackCooldown>0)return!1;const l=Be(t,n.gameState,"human",gi*2,c=>c.hitpoints>0);if(l){const c=U(t.position,l.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=gi)return _.set(i,"attackTarget",l.id),!0;if(s&&c<=gi*2)return _.set(i,"attackTarget",l.id),_.set(i,"needToApproach",!0),!0}return!1},"Find Human Target",e+1),new ae((t,n,i)=>{const s=_.get(i,"attackTarget"),a=s&&n.gameState.entities.entities[s],l=_.get(i,"needToApproach");if(!a||a.hitpoints<=0)return T.FAILURE;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=gi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},_.delete(i,"needToApproach"),T.RUNNING;if(l||c>gi){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),T.RUNNING}return T.FAILURE},"Attack or Approach Human",e+1)],"Predator Attack Human",e)}function $N(e){const t=new he((a,l,c)=>{const u=Be(a,l.gameState,"predator",Xo,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Nl&&f.age<=jh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(_.set(c,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new ae((a,l,c)=>{const u=_.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},_.delete(c,"procreationPartner"),T.SUCCESS):T.FAILURE},"Start Procreating",e+2),i=new he((a,l,c)=>{const u=Be(a,l.gameState,"predator",Xo*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Nl&&f.age<=jh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(_.set(c,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new ae((a,l,c)=>{const u=_.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return T.FAILURE;if(U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=Xo)return T.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=ot(m),T.RUNNING},"Move Towards Partner",e+2);return new Ae([new he(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=Nl&&a.age<=jh&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new ln([new Ae([t,n],"Procreate With Immediate Partner",e+2),new Ae([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Predator Procreate",e)}const xN=(e,t,n)=>{const i=t.gameState.search.predator.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="predator");if(i.length===0)return T.FAILURE;let s=null,a=Eu;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(_.set(n,"targetChild",s.id),T.SUCCESS):T.FAILURE},WN=(e,t,n)=>{const i=_.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>ma?(e.activeAction="moving",e.target=s.id,e.direction=$e(e.position,s.position,t.gameState.mapDimensions),T.RUNNING):(e.activeAction="feeding",e.target=void 0,_.set(n,"targetChild",void 0),T.SUCCESS):T.FAILURE};function YN(e){return new Ae([new he(t=>(t.isAdult&&t.gender==="female"&&t.hunger<90&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new ae(xN,"Find Hungriest Predator Child",e+1),new ae(WN,"Move To Child and Feed",e+1)],"Feed Predator Child",e)}function zN(e){return new Ae([new he(t=>!t.isAdult&&t.hunger>=Eu,"Is Hungry Predator Child",e+1),new ae((t,n,i)=>{if(!t.motherId)return T.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(_.set(i,"targetParent",s.id),T.SUCCESS):T.FAILURE},"Find Female Parent",e+1),new ae((t,n,i)=>{const s=_.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=ma?(t.target=void 0,T.SUCCESS):(t.target=a.id,t.activeAction="moving",T.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}function wI(e){return new ae((t,n,i)=>{t.activeAction="idle";let s=_.get(i,"wanderTarget"),a=_.get(i,"wanderStartTime");const l=n.gameState.time;if(!s||!a||l-a>2){const c=Math.random()*2*Math.PI,u=50+Math.random()*100,f={x:Math.cos(c),y:Math.sin(c)},g=ti(t.position,At(f,u));s={x:(g.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(g.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},_.set(i,"wanderTarget",s),_.set(i,"wanderStartTime",l)}if(s){t.target=s;let c=s.x-t.position.x,u=s.y-t.position.y;const f=n.gameState.mapDimensions.width,g=n.gameState.mapDimensions.height;Math.abs(c)>f/2&&(c=c>0?c-f:c+f),Math.abs(u)>g/2&&(u=u>0?u-g:u+g);const m=ot({x:c,y:u});t.direction=m}return T.SUCCESS},"Animal Wander",e)}function jN(e){return new Ae([new he((t,n,i)=>{if(t.hunger>90||t.hitpoints<t.maxHitpoints*.3||t.activeAction==="grazing"||t.activeAction==="procreating")return!1;const s=Object.values(n.gameState.entities.entities),a=[];for(const l of s)if(l.type==="prey"&&l.id!==t.id){const c=l;c.hitpoints>0&&c.isAdult&&U(t.position,c.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=yn*5&&a.push(c)}if(a.length>=2){let l=0,c=0;for(const g of a)l+=g.position.x,c+=g.position.y;l/=a.length,c/=a.length;const u={x:l,y:c};if(U(t.position,u,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>yn*2)return _.set(i,"herdCenter",u),_.set(i,"herdSize",a.length),!0}return!1},"Find Herd",e+1),new ae((t,n,i)=>{const s=_.get(i,"herdCenter");if(!s)return T.FAILURE;if(U(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>yn*2){t.activeAction="moving",t.target=s;const l=Xe(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(l),T.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},T.SUCCESS},"Join Herd",e+1)],"Prey Herd Behavior",e)}function XN(e){return new Ae([new he((t,n,i)=>{if(t.hunger>100||t.hitpoints<t.maxHitpoints*.4||t.activeAction==="attacking"||t.activeAction==="procreating")return!1;const s=Be(t,n.gameState,"predator",Xo*4,a=>a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==void 0&&a.fatherId===t.fatherId&&a.age>=t.age||a.hitpoints>t.hitpoints);return s&&U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Xo*2?(_.set(i,"packLeader",s.id),!0):!1},"Find Pack Leader",e+1),new ae((t,n,i)=>{const s=_.get(i,"packLeader"),a=s&&n.gameState.entities.entities[s];if(!a||a.hitpoints<=0)return T.FAILURE;if(U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Xo*2){t.activeAction="moving",t.target=a.id;const c=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(c),T.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},T.SUCCESS},"Follow Pack Leader",e+1)],"Predator Pack Behavior",e)}function VN(e){return new Ae([new he((t,n,i)=>{if(!t.isAdult||t.hitpoints<t.maxHitpoints*.6||t.hunger>120||t.attackCooldown&&t.attackCooldown>0)return!1;const s=Be(t,n.gameState,"predator",gS,a=>!!(a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==a.fatherId&&t.gender===a.gender&&t.fatherId!==void 0&&a.fatherId!==void 0));if(s){const a=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(a<=gi)return _.set(i,"territorialTarget",s.id),!0;if(a<=gS)return _.set(i,"territorialTarget",s.id),_.set(i,"needToApproach",!0),!0}return!1},"Find Territorial Rival",e+1),new ae((t,n,i)=>{const s=_.get(i,"territorialTarget"),a=s&&n.gameState.entities.entities[s],l=_.get(i,"needToApproach");if(!a||a.hitpoints<=0)return T.FAILURE;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=gi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},_.delete(i,"needToApproach"),T.RUNNING;if(l||c>gi){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=ot(u),T.RUNNING}return T.FAILURE},"Territorial Fight or Approach",e+1)],"Predator Territorial Defense",e)}const KN="tribeSplit_strategy",qN="tribeSplit_targetPosition",ZN="tribeSplit_targetBuildingId",QN="tribeSplit_familyIds";function JN(e){return new Ae([new he((t,n)=>{const i=ru(t,n.gameState);if(!i.aiBlackboard)return[!1,"Patriarch has no blackboard"];const s=Tl(i.aiBlackboard);if(s!=="gathering")return[!1,`Patriarch phase: ${s}`];const a=_.get(i.aiBlackboard,QN);return!a||!a.includes(t.id)?[!1,"Not in split family"]:[!0,"Gathering for split"]},"Should Gather for Split?",e+1),new ae((t,n)=>{const i=ru(t,n.gameState),s=_.get(i.aiBlackboard,KN);let a;if(s==="migration")a=_.get(i.aiBlackboard,qN);else if(s==="concentration"){const c=_.get(i.aiBlackboard,ZN);if(c){const u=n.gameState.entities.entities[c];u&&(a=u.position)}}if(!a)return T.FAILURE;const l=U(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=dI?(t.activeAction="idle",t.target=void 0,T.SUCCESS):(t.activeAction="moving",t.target=a,[T.RUNNING,`Distance: ${l.toFixed(2)}`])},"Move to Split Gathering Point",e+1)],"Tribe Split Gather Behavior",e)}function eM(){const e=new ln([PD(2),cN(2),new Pn(pN(2),"attack","Gated Defend Against Predator",2),new Pn(lN(2),"attack","Gated Jealousy Attack",2),new Pn(dN(2),"attack","Gated Desperate Attack",2),fN(2),new Es(new ln([new Gn(VD(5),Ls,"Cache Take Over Building",4),new Gn(ZD(5),Ls,"Cache Remove Enemy Building",4)],"Building Interaction Selector",3),"Gated Leader Building Interactions",2),WD(2),new Pn(kD(3),"attack","Gated Attacking",2),RN(2),cD(2),yD(2),xD(2),new Pn(new Gn(YD(4),E_,"Cache Building Placement",3),"build","Gated Leader Building Placement",2),new Es(new Gn(qD(4),Ls,"Cache Border Post Placement",3),"Gated Border Post Placement",2),aN(2),JN(2),RD(2),new Pn(OD(3),"procreation","Gated Procreation",2),new Mr(new Pn(_N(4),"chopping","Gated Cleanup Trees",3),Os,"Timeout Cleanup Trees",2),new Mr(new Pn(GD(4),"planting","Gated Planting",3),Os,"Timeout Planting",2),new Pn($D(3),"gathering","Gated Storage Deposit",2),new Pn(FD(3),"feedChildren","Gated Feed Child",2),new Mr(new Pn(DD(4),"gathering","Gated Gathering",3),Os,"Timeout Gathering",2),new Mr(new Pn(CN(4),"chopping","Gated Chopping",3),Os,"Timeout Chopping",2),LD(2),new Pn(gN(3),"attack","Gated Hunt Prey",2),new Es(QD(2),"Gated Follow Patriarch",2),new Mr(new Es(MD(2),"Gated Idle Wander",3),Os,"Timeout Idle Wander",2)],"AI Root Selector",1),t=new NS([new sD(new aD(mN(4),"Role Assignment Success",3),"Role Assignment Gate",2),new Pn(new Gn(EN(4),Ls,"Cache Role Management",3),"roleManagement","Gated Role Management",2),new Es(hN(3),"Gated Diplomacy",2),new Es(PN(2),"Gated Logistics Management",2)],"Non blocking",1),n=new NS([e,t],"AI Root Sequence",1);return new lD(n,"Manual Control Gate",0)}var re=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e))(re||{}),H=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(H||{});const Ot=1,tM=250,RI=.8,nM=100,iM=5,Og="currentAiTask",PI="lastTaskResult",DI="lastTaskMessage",kg="taskHistory";function bg({aiBlackboard:e}){return _.get(e,Og)||null}function zs({aiBlackboard:e},t){t?_.set(e,Og,t):_.delete(e,Og)}function oM(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function rM(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function sM(e,t,n,i){const s=t.type===re.Wait?aM:i[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=H.Failure;const[l,c,u]=rM(a);if(_.set(e.aiBlackboard,PI,l),_.set(e.aiBlackboard,DI,c),l!==H.Running){const f=_.get(e.aiBlackboard,kg)||[];if(f.unshift({type:t.type,result:l,completedAtTick:n.gameState.time,message:c}),f.length>5&&f.pop(),_.set(e.aiBlackboard,kg,f),delete n.gameState.tasks[t.id],zs(e,null),l===H.Success){const g=u||t.nextTask;g&&(n.gameState.tasks[g.id]=g,g.claimedByEntityId=e.id,zs(e,g.id))}}return l}function cn(e){return 1/(1+e/tM)}function tc(e,t,n){for(let i=0;i<n.length;i++){const s=n[i];if(!s.producer)continue;const a=s.producer(e,t);for(const l in a){const c=a[l],u=t.gameState.tasks[l];t.gameState.tasks[l]=c,u&&(t.gameState.tasks[l].claimedByEntityId=u.claimedByEntityId)}}}const Pd=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:re.Wait,creatorEntityId:e.id,validUntilTime:t+Ot}),aM={type:re.Wait,executor:(e,t,n)=>n.gameState.time>=e.validUntilTime-1?[H.Success,"Wait complete"]:[H.Running,"Waiting"]};function ht(e){const{type:t,requireAdult:n,autopilotBehavior:i,producer:s,scorer:a,executor:l}=e;return{type:t,producer:s,scorer:a?(f,g,m)=>n&&!f.isAdult||i&&f.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?null:a(f,g,m):void 0,executor:l?(f,g,m)=>n&&!g.isAdult||i&&g.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?H.Failure:m.gameState.autopilotControls.activeAutopilotAction&&f.type!==re.HumanPlayerCommand&&g.isPlayer?[H.Failure,"Autopilot action active",{id:`player-command-${g.id}`,type:re.HumanPlayerCommand,position:g.position,creatorEntityId:g.id,validUntilTime:m.gameState.time+Ot}]:l(f,g,m):void 0}}const lM=ht({type:re.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>na&&e.food.length>0){const i=`eat-task-${e.id}`;n[i]={id:i,type:re.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/on,executor:(e,t)=>e.target!==t.id?H.Empty:t.hunger<na?H.Success:t.food.length===0?H.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",H.Running)}),cM=ht({type:re.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="berryBush"||i.food.length===0||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=cn(s),l=e.hunger/on;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[H.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="berryBush"||i.food.length===0||t.food.length>=t.maxFood?[H.Success,"Bush is empty"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",[H.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[H.Running,"Gathering berries"])}}),dM=ht({type:re.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="corpse"||i.food.length===0||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=cn(s),l=e.hunger/on;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return H.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="corpse"||i.food.length===0||t.food.length>=t.maxFood?H.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",H.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",H.Running)}}),uM=ht({type:re.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=Bl&&e.age<=mu&&e.hunger<rn&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:re.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<Bl||e.hunger>=rn||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="female"||i.isPregnant||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(s)*RI},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="female"||t.hunger>=rn?H.Failure:i.isPregnant?H.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",t.direction=$e(t.position,i.position,n.gameState.mapDimensions),H.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",H.Running)}}),fM=ht({type:re.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=Bl&&e.hunger<rn&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:re.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<Bl||e.age>mu||e.hunger>=rn||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="male"||i.hunger>=rn||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(s)*RI},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="male"||i.hunger>=rn?H.Failure:t.isPregnant?H.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",t.direction=$e(t.position,i.position,n.gameState.mapDimensions),H.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",H.Running)}}),hM=ht({type:re.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=oa){const i=`feed-child-task-${e.id}`;n[i]={id:i,type:re.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.isAdult||!(i.motherId===e.id||i.fatherId===e.id))return null;const a=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=cn(a),c=i.hunger/on;return(l+c)/2},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.isAdult||t.food.length===0?H.Failure:i.hunger<oa/2?H.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>yu?(t.target=i.position,t.activeAction="moving",t.direction=$e(t.position,i.position,n.gameState.mapDimensions),H.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="feeding",H.Running)}});function Mu(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const i=U(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(i)}function Ou(e,t,n,i,s){const a=e.target;return U(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",H.Running):(Vo(a,i,t.leaderId,n.gameState),H.Success)}const gM=ht({type:re.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:Mu,executor:(e,t,n)=>Ou(e,t,n,ce.StorageSpot,Qi)}),pM=ht({type:re.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:Mu,executor:(e,t,n)=>Ou(e,t,n,ce.Bonfire,Qi)}),mM=ht({type:re.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:Mu,executor:(e,t,n)=>Ou(e,t,n,ce.PlantingZone,Qi)}),yM=ht({type:re.HumanPlaceBorderPost,requireAdult:!0,autopilotBehavior:"build",scorer:Mu,executor:(e,t,n)=>Ou(e,t,n,ce.BorderPost,R_)}),SM=ht({type:re.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(u=>u.type===An.Berry).length<uo)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const l=t.target,c=U(e.position,l,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(c)},executor:(e,t,n)=>{if(t.food.filter(c=>c.type===An.Berry).length<uo)return t.activeAction="idle",H.Failure;const s=e.target;return U(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Wr?(t.target=s,t.activeAction="moving",H.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(c=>c.type==="berryBush"&&U(c.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<iM)?(t.activeAction="idle",H.Success):H.Running)}}),vM=ht({type:re.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var f;if(typeof t.target!="number")return null;const i=e.food.length>0,s=((f=e.heldItem)==null?void 0:f.type)===yt.Wood;if(!i&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==ce.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const l=U(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=cn(l),u=s?.6:e.food.length/e.maxFood*.4;return(c+u)/2},executor:(e,t,n)=>{var c;if(typeof e.target!="number")return H.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==ce.StorageSpot)return H.Failure;const s=t.food.length>0,a=((c=t.heldItem)==null?void 0:c.type)===yt.Wood;return!s&&!a?H.Success:i.storedItems.length>=i.storageCapacity?H.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",H.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",H.Running)}}),AM=ht({type:re.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var c;if(typeof t.target!="number"||!(((c=e.heldItem)==null?void 0:c.type)===yt.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==ce.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||Qd;if(s.storedItems.length>=a)return null;const l=U(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return cn(l)},executor:(e,t,n)=>{var c;if(typeof e.target!="number")return H.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==ce.Bonfire)return H.Failure;if(!(((c=t.heldItem)==null?void 0:c.type)===yt.Wood))return H.Success;const a=i.storageCapacity||Qd;return i.storedItems.length>=a?H.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",H.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",H.Running)}}),IM=ht({type:re.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=na||e.food.length>0||typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="building"||i.buildingType!==ce.StorageSpot||i.ownerId!==e.leaderId||!i.storedItems.some(u=>u.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=cn(s),l=e.hunger/on,c=1-e.food.length/e.maxFood;return(a+l+c)/3},executor:(e,t,n)=>{if(typeof e.target!="number")return H.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="building"||i.buildingType!==ce.StorageSpot||!i.storedItems.some(a=>a.item.itemType==="food")?H.Failure:t.food.length>0?H.Success:t.food.length>=t.maxFood?H.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",H.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="retrieving",H.Running)}}),TM=ht({type:re.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree")return null;const[s]=i.stateMachine??[];if(!(s===sn||s===Kt||s===vn)||e.heldItem||e.food.length===0)return null;const l=xt(e,n.gameState);if(!l)return null;const c=Ul(l.id,n.gameState);if(c<=0)return null;const u=AA(l.id,n.gameState);if(u>=c)return null;const f=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),g=cn(f),m=Math.min(1,(c-u)/10);return(g+m)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[H.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="tree")return[H.Failure,"Tree not found"];const[s]=i.stateMachine??[];if(s===Gt){const c={id:`gather-wood-${t.id}-${n.gameState.time}`,type:re.HumanGatherWood,position:i.position,creatorEntityId:t.id,target:i.id,validUntilTime:n.gameState.time+1};return[H.Success,"Tree fell!",c]}return s===sn||s===Kt||s===vn?t.heldItem?[H.Failure,"Hands full"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Kl?(t.target=i.position,t.activeAction="moving",[H.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="chopping",[H.Running,"Chopping tree"]):[H.Failure,"Tree is not standing"]}}),EM=ht({type:re.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree"||i.wood.length===0)return null;const[s]=i.stateMachine??[];if(s!==Gt||e.heldItem)return null;const a=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=cn(a),c=xt(e,n.gameState),u=c?Ul(c.id,n.gameState):0,f=Math.min(1,u/10);return(l+f)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[H.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[H.Success,"Already holding wood"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="tree"||i.wood.length===0||t.heldItem?[H.Failure,"Tree gone, empty, or human full"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>ze?(t.target=i.position,t.activeAction="moving",[H.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[H.Running,"Gathering wood"])}}),CM=ht({type:re.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="prey"||i.hitpoints<=0||e.leaderId&&!ao(i.position,e.leaderId,n.gameState))return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const c=ni(e.leaderId,n.gameState);if(U(e.position,c,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Lv)return null}const a=cn(s),l=e.hunger/on;return(a+l)/2*.6},executor:(e,t,n)=>{if(typeof e.target!="number")return[H.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[H.Success,"Prey is dead"];const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[H.Running,"Chasing prey"]:[H.Running,"Attacking prey"]}}),_M=ht({type:re.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="predator"||i.hitpoints<=0||e.leaderId&&!ao(i.position,e.leaderId,n.gameState))return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(cn(s)+.3)/1.3},executor:(e,t,n)=>{if(typeof e.target!="number")return[H.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[H.Failure,"Too injured to continue"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[H.Success,"Predator eliminated"];const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[H.Running,"Chasing predator"]:[H.Running,"Fighting predator"]}});function wM(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,H.Failure;const a=U(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),c=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?Sn:co;return a<=c?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,H.Success):(t.activeAction="moving",t.target=s.id,t.direction=$e(t.position,s.position,e.mapDimensions),H.Running)}const RM=ht({type:re.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const i=`player-command-${e.id}`;n[i]={id:i,type:re.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+Ot}}return n},scorer:(e,t)=>t.type===re.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a,l;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return[H.Failure,"No active autopilot action"];switch(s.action){case oe.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,H.Failure;const c=s.position;return U(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<Gv?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[H.Success,"Reached target position"]):(t.activeAction="moving",t.target=c,t.direction=$e(t.position,c,i.mapDimensions),[H.Running,"Moving to target"])}case oe.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No target entity ID"];const c=i.entities.entities[s.targetEntityId];if(!c)return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Target entity not found"];let u=!1;if(c.type==="berryBush")u=c.food.length===0;else if(c.type==="corpse")u=c.food.length===0;else if(c.type==="tree"){const g=c;u=((a=g.stateMachine)==null?void 0:a[0])!==Gt||g.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Invalid target type"];return u?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Target is depleted"]):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>Wr?(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),[H.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,[H.Success,"At target, gathering",Pd(t,i.time)])}case oe.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No target entity ID"];const c=i.entities.entities[s.targetEntityId];if(!c||c.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Invalid target entity"];const[u]=c.stateMachine??[];return!(u===sn||u===Kt||u===vn)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Tree is not standing or human is holding an item"]):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>Kl?(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),[H.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,[H.Success,"At tree, chopping",Pd(t,i.time)])}case oe.AutopilotAttack:return"targetEntityId"in s?wM(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,H.Failure);case oe.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No target entity ID"];const c=i.entities.entities[s.targetEntityId];if(!c||c.type!=="human"||!nr(t,c,i))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Invalid target for procreation"];const u=U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height);return c.isPregnant||t.isPregnant?t.gender==="male"&&c.pregnancyFatherId!==t.id?[H.Failure,"Target is pregnant by another"]:[H.Success,"Procreation conditions met"]:u<=Ks?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,[H.Running,"Procreating"]):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),[H.Running,"Moving to procreation target"])}case oe.AutopilotPlant:{if(t.activeAction==="planting")return[H.Running,"Planting"];if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No position specified"];const c=s.position;return Wn(c,i,Zo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Position is occupied"]):U(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(t.activeAction="planting",t.target=c,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,[H.Running,"Planting"]):(t.activeAction="moving",t.target=c,t.direction=$e(t.position,c,i.mapDimensions),[H.Running,"Moving to planting target"])}case oe.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No target entity ID"];const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="human"||c.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Invalid target for feeding child"]):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Ks?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[H.Success,"Feeding child"]):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),[H.Running,"Moving to feeding target"])}case oe.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No target entity ID"];const c=i.entities.entities[s.targetEntityId];if(!c||c.buildingType!==ce.StorageSpot&&c.buildingType!==ce.Bonfire||!c.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Invalid target building"];const u=c.storageCapacity??0;if(c.storedItems.length>=u)return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Storage is full"];if(t.leaderId!==c.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Human does not belong to the same tribe as the building"];const g=t.food.length>0,m=!!t.heldItem;if(c.buildingType===ce.Bonfire){if(((l=t.heldItem)==null?void 0:l.type)!==yt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Bonfires only accept wood"]}else if(!g&&!m)return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No items to deposit"];return U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Zt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[H.Success,"Depositing items",Pd(t,i.time)]):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),[H.Running,"Moving to deposit target"])}case oe.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No target entity ID"];const c=i.entities.entities[s.targetEntityId];return!c||c.buildingType!==ce.StorageSpot||!c.isConstructed||c.storedItems.length===0?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Invalid target building"]):t.leaderId!==c.ownerId?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Storage is full"]):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Zt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,[H.Success,"Retrieving items",Pd(t,i.time)]):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),[H.Running,"Moving to retrieve target"])}case oe.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No target entity ID"];const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!Vt(t,c,i)?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Only leaders can take over buildings"]):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="takingOverBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,[H.Success,"Taking over building"]):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),[H.Running,"Moving to takeover target"])}case oe.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No target entity ID"];const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!Vt(t,c,i)?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Invalid target building"]):t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Only leaders can remove enemy buildings"]):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=ze?(t.activeAction="destroyingBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,[H.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=c.id,t.direction=$e(t.position,c.position,i.mapDimensions),[H.Running,"Moving to removal target"])}case oe.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,H.Failure;const c=s.position,u=s.buildingType;if(!u)return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"No building type specified"];const f=U(t.position,c,i.mapDimensions.width,i.mapDimensions.height),g=100;return f<=g?la(c,u,t.leaderId,i,t.position,g)?(Vo(c,u,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[H.Success,"Building placed"]):(i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=c,t.direction=$e(t.position,c,i.mapDimensions),[H.Running,"Moving to placement target"])}default:return i.autopilotControls.activeAutopilotAction=void 0,[H.Failure,"Unknown or unhandled action"]}}}),PM=ht({type:re.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:n}=t,i={},s=bi(e.position.x,e.position.y,n),a=s!==null&&s!==e.leaderId,l=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(a||l){const c=`attack-human-${e.id}-${n.time.toFixed(2)}`;i[c]={id:c,type:re.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:n.time+Ot}}return i},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="human"||i.hitpoints<=0||i.id===e.id||i.leaderId===e.leaderId)return null;const{gameState:s}=n,a=Vr(e,i,s),l=bi(i.position.x,i.position.y,s)===e.leaderId;if(!a&&!l)return null;let c=.5;const u=U(e.position,i.position,s.mapDimensions.width,s.mapDimensions.height),f=cn(u);return l&&(c+=.1),(f+c)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[H.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[H.Success,"Target eliminated"];const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=i.id,s>ze?[H.Running,"Chasing human target"]:[H.Running,"Fighting human target"]}}),DM=ht({type:re.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,n)=>{if(typeof t.target!="number"||oI(n.gameState.time)>.5)return null;const i=n.gameState.entities.entities[t.target];if(!i||i.buildingType!==ce.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0||e.leaderId!==i.ownerId)return null;const s=er(n.gameState.temperature,e.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=so+5;if(s>=a)return null;const l=(a-s)/15,c=(1-e.hitpoints/e.maxHitpoints)*.8,u=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),f=cn(u);let g=(l+c+f)/2;return e.hitpoints/e.maxHitpoints<.2&&s<so&&(g=Math.max(g,1.2)),g},executor:(e,t,n)=>{if(typeof e.target!="number")return H.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.buildingType!==ce.Bonfire||!i.isConstructed||(i.fuelLevel??0)<=0)return H.Failure;const s=er(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=so+5;if(s>=a)return t.activeAction="idle",[H.Success,"Comfortable temperature reached"];const l=t.id*137%360*(Math.PI/180),c=br*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,g={x:(i.position.x+Math.cos(l)*c+u)%u,y:(i.position.y+Math.sin(l)*c+f)%f},m=U(t.position,g,u,f);return m>10?(t.activeAction="moving",t.target=g,t.direction=$e(t.position,g,n.gameState.mapDimensions),[H.Running,`Moving to warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[H.Running,"Staying warm at bonfire"])}}),NM=ht({type:re.HumanFlee,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hitpoints<e.maxHitpoints*Vd){const i=pI(e.id,t.gameState);if(i){const s=`flee-task-${e.id}`;n[s]={id:s,type:re.HumanFlee,position:e.position,creatorEntityId:e.id,target:i.id,validUntilTime:t.gameState.time+Ot}}}return n},scorer:(e,t,n)=>typeof t.target!="number"||!n.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*Vd?.9:null,executor:(e,t,n)=>{if(typeof e.target!="number")return H.Failure;const i=n.gameState.entities.entities[e.target];if(!i)return t.activeAction="idle",t.attackTargetId=void 0,H.Success;if(U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ag)return t.activeAction="idle",t.target=void 0,H.Success;t.activeAction="moving",t.attackTargetId=void 0;const a=Xe(i.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=ot(a),c=ti(t.position,At(l,Ag));return t.target={x:(c.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(c.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=l,H.Running}}),MM=ht({type:re.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(!e.leaderId||e.id===e.leaderId)return i;const s=ni(e.leaderId,n),a=`stay-near-tribe-${e.id}`;return i[a]={id:a,type:re.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:n.time+Ot},i},scorer:(e,t,n)=>{if(!e.leaderId||e.id===e.leaderId)return null;const i=ni(e.leaderId,n.gameState),s=U(e.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=Qy)return null;const a=s-Qy;return Math.min(.95,.5+a/1e3*P_)},executor:(e,t,n)=>{if(!t.leaderId)return H.Failure;const i=ni(t.leaderId,n.gameState),s=U(t.position,i,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<N_?(t.activeAction="idle",t.target=void 0,H.Success):(t.activeAction="moving",t.target=i,t.direction=$e(t.position,i,n.gameState.mapDimensions),[H.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),OM=ht({type:re.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,i={};if(e.isAdult)return i;const s=Lg(e,n);if(!s)return i;const a=`stay-near-parent-${e.id}`;return i[a]={id:a,type:re.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:n.time+Ot},i},scorer:(e,t,n)=>{if(e.isAdult)return null;const i=Lg(e,n.gameState);if(!i||i.id!==t.target)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=Jy)return null;const a=s-Jy;return Math.min(.98,.6+a/500*D_)},executor:(e,t,n)=>{if(typeof e.target!="number")return H.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="human")return t.activeAction="idle",H.Failure;const s=U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<=M_?(t.activeAction="idle",t.target=void 0,t.direction={x:0,y:0},H.Success):(t.activeAction="moving",t.target=i.id,t.direction=$e(t.position,i.position,n.gameState.mapDimensions),[H.Running,`Returning to parent (${Math.round(s)}px away)`])}}),ku=[lM,cM,dM,uM,fM,hM,gM,pM,mM,yM,SM,vM,AM,IM,TM,EM,CM,_M,RM,PM,DM,NM,MM,OM].reduce((e,t)=>(e[t.type]=t,e),{}),kM=Object.values(ku);function bM(e,t){tc(e,t,kM)}function BM(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const i=bg(e);if(i){const s=t.gameState.tasks[i];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),zs(e,null)}return}let n=bg(e);if(n){const i=t.gameState.tasks[n];(!i||i.claimedByEntityId&&i.claimedByEntityId!==e.id)&&(zs(e,null),n=null)}if(!n){const i=FM(e,t);if(i&&t.gameState.tasks[i]){const s=t.gameState.tasks[i];n=i,zs(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const i=t.gameState.tasks[n];i?sM(e,i,t,ku):zs(e,null)}}function FM(e,t){let n=null,i=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=ku[a.type];if(!l||!l.scorer)continue;const c=l.scorer(e,a,t);c!==null&&c>i&&(i=c,n=a.id)}return i>0?n:null}const NI=eM();function LM(e,t){const n=performance.now();switch(e.aiType){case $t.TaskBased:BM(e,t);break;case $t.BehaviorTreeBased:default:Pp(e,t,NI);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}function UM(){return new ln([DN(1),bN(1),BN(1),NN(1),MN(1),jN(1),wI(1)],"Prey Behavior Root",0)}function HM(){return new ln([HN(1),GN(1),YN(1),zN(1),VN(1),$N(1),XN(1),wI(1)],"Predator Behavior Root",0)}const GM=(e,t)=>{const n={};for(let i=0;i<wu;i++){const s=`hunt-prey-${e.id}-${i}`;n[s]={id:s,type:re.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},$M=(e,t)=>{const n={};if(e.hitpoints<=0)return n;const i=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((i==null?void 0:i.type)==="human"))return n;for(let a=0;a<Uv;a++){const l=`hunt-predator-${e.id}-${a}`;n[l]={id:l,type:re.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},xM={[re.HumanHuntPrey]:{type:re.HumanHuntPrey,producer:GM},[re.HumanHuntPredator]:{type:re.HumanHuntPredator,producer:$M}};function ou(e,t){tc(e,t,Object.values(xM))}const MI=UM();function WM(e,t){switch(e.aiType){case $t.TaskBased:ou(e,t);break;case $t.BehaviorTreeBased:default:Pp(e,t,MI);break}}const OI=HM();function YM(e,t){switch(e.aiType){case $t.TaskBased:ou(e,t);break;case $t.BehaviorTreeBased:default:Pp(e,t,OI);break}}const kI=5;function zM(){return tr[ce.PlantingZone].dimensions}function xS(e,t,n){const i=e.position.x+n.width/2,a=t.position.x-n.width/2-i,l=e.position.y-n.height/2,c=e.position.y+n.height/2,u=t.position.y-n.height/2,f=t.position.y+n.height/2,g=Math.min(c,f)-Math.max(l,u);return a>=-5&&a<=kI&&g>n.height*.5}function WS(e,t,n){const i=e.position.y+n.height/2,a=t.position.y-n.height/2-i,l=e.position.x-n.width/2,c=e.position.x+n.width/2,u=t.position.x-n.width/2,f=t.position.x+n.width/2,g=Math.min(c,f)-Math.max(l,u);return a>=-5&&a<=kI&&g>n.width*.5}function jM(e){var l;const t={},n=zM(),i=e;if(!((l=i.search)!=null&&l.building))return t;const a=i.search.building.all().filter(c=>c.buildingType===ce.PlantingZone&&c.isConstructed);for(const c of a)t[c.id]={top:!1,bottom:!1,left:!1,right:!1};for(let c=0;c<a.length;c++){const u=a[c];for(let f=c+1;f<a.length;f++){const g=a[f];u.ownerId===g.ownerId&&(xS(u,g,n)&&(t[u.id].right=!0,t[g.id].left=!0),xS(g,u,n)&&(t[g.id].right=!0,t[u.id].left=!0),WS(u,g,n)&&(t[u.id].bottom=!0,t[g.id].top=!0),WS(g,u,n)&&(t[g.id].bottom=!0,t[u.id].top=!0))}}return t}function Wl(e){e.plantingZoneConnections=jM(e)}const XM=(e,t)=>{if(e.buildingType!==ce.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,i=mp(e);if(TA(e,n)>=i)return{};const a=n.search.tasks.byProperty("creatorEntityId",e.id).find(g=>g.type===re.HumanPlantBush);if(a)return{[a.id]:a};const l=n.mapDimensions.width,c=n.mapDimensions.height,u=n.soilDepletion,f=10;for(let g=0;g<f;g++){const m=e.position.x+(Math.random()-.5)*e.width,S=e.position.y+(Math.random()-.5)*e.height,v={x:(m%l+l)%l,y:(S%c+c)%c};if(!Fi(u,v,l,c)&&!Wn(v,n,Zo)){const I=`plant-bush-${e.id}-${n.time}`,A={id:I,type:re.HumanPlantBush,position:v,creatorEntityId:e.id,target:v,validUntilTime:n.time+nM};return{[I]:A}}}return{}},VM=(e,t)=>{const n={};if(e.buildingType===ce.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const i=`stockpile-${e.id}`;n[i]={id:i,type:re.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n},KM=(e,t)=>{const n={};if(e.buildingType===ce.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*gp){const i=`fuel-bonfire-${e.id}`;n[i]={id:i,type:re.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n},qM=(e,t)=>{const n={};if(e.buildingType===ce.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let i=0;i<wg;i++){const s=`seek-warmth-${e.id}-${i}`;n[s]={id:s,type:re.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n},ZM=(e,t)=>{const n={};if(e.buildingType===ce.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(i=>i.item.itemType==="food")){const i=`retrieve-from-${e.id}`;n[i]={id:i,type:re.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n},QM={[re.HumanPlantBush]:{type:re.HumanPlantBush,producer:XM},[re.HumanStockpile]:{type:re.HumanStockpile,producer:VM},[re.HumanFuelBonfire]:{type:re.HumanFuelBonfire,producer:KM},[re.HumanSeekWarmth]:{type:re.HumanSeekWarmth,producer:qM},[re.HumanRetrieve]:{type:re.HumanRetrieve,producer:ZM}};function bI(e,t){tc(e,t,Object.values(QM))}function JM(e,t){const{gameState:n,deltaTime:i}=t,s=i*(Ct/Dt);if(e.isBeingDestroyed){const a=Sw(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){const l=e.buildingType===ce.PlantingZone;Zr(n.entities,e.id),l&&Wl(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=yw(e.buildingType);a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&yA(e.position,ea,e.ownerId,n),e.buildingType===ce.PlantingZone&&Wl(n))}if(e.buildingType===ce.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*Ww,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*Yw)){const a=e.storedItems.findIndex(l=>l.item.itemType==="item"&&l.item.type===yt.Wood);a!==-1&&(e.storedItems.splice(a,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+cA))}bI(e,t)}function eO(e,t){const n=t.deltaTime*Ct/Dt;if(e.age+=n,!e.stateMachine)return;const[i]=e.stateMachine;i!==Gt&&i!==lo&&i!==zr&&(e.age>=Jo&&!e.woodGenerated&&(e.wood=Array.from({length:Cu},()=>({itemType:"item",type:yt.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=Ql*Math.min(1,Math.max(.4,e.age/Jo)))}const tO={type:re.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const i=`gather-berries-${e.id}`;n[i]={id:i,type:re.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n}},nO={type:re.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===sn||i===Kt||i===vn){const a=`chop-tree-${e.id}`;n[a]={id:a,type:re.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n}},iO={type:re.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===Gt&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:re.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n}},oO=[tO,nO,iO].reduce((e,t)=>(e[t.type]=t,e),{});function YS(e,t){tc(e,t,Object.values(oO))}const rO={type:re.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const i=`gather-meat-${e.id}`;n[i]={id:i,type:re.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Ot}}return n}},sO=[rO].reduce((e,t)=>(e[t.type]=t,e),{});function aO(e,t){tc(e,t,Object.values(sO))}var xd=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(xd||{});function sg(e,t,n){switch(n){case 0:lO(e,t);break;case 1:cO(e,t);break;case 2:"aiBlackboard"in e&&dO(e,t);break}}function lO(e,t){e.forces.push(At(e.velocity,-.1));const n=At(ot(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(i=>{t.gameState.time-i.startTime<i.duration&&i.type==="slow"&&(e.velocity=At(e.velocity,.5))}),e.debuffs=e.debuffs.filter(i=>t.gameState.time-i.startTime<i.duration),e.velocity=ti(e.velocity,e.forces.reduce(ti,{x:0,y:0})),ia(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=ti(e.position,At(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&ia(e.velocity)>.1&&aR(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?KP(e,t,t.deltaTime):e.type==="corpse"?qP(e,t):e.type==="prey"?ZP(e,t,t.deltaTime):e.type==="predator"?QP(e,t,t.deltaTime):e.type==="building"?JM(e,t):e.type==="tree"?eO(e,t):e.type,e.stateMachine&&(e.stateMachine=G1(...e.stateMachine,{entity:e,updateContext:t}))}function cO(e,t){e.type==="human"?bM(e,t):e.type==="corpse"?aO(e,t):e.type==="prey"||e.type==="predator"?ou(e,t):e.type==="building"?bI(e,t):(e.type==="tree"||e.type==="berryBush")&&YS(e,t)}function dO(e,t){const n=_.get(e.aiBlackboard,"lastAiUpdateTime")??0;t.gameState.time-n+(Math.random()-Math.random())*ta/10<=ta||(_.cleanupOldEntries(e.aiBlackboard,t.gameState.time),e.type==="human"?LM(e,t):e.type==="corpse"||(e.type==="prey"?WM(e,t):e.type==="predator"?YM(e,t):e.type==="building"||e.type==="tree"||e.type),_.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function uO(e){const t=e.gameState.entities,n=Object.values(t.entities);for(const i of n)sg(i,e,xd.Physics);for(const i of n)sg(i,e,xd.PrepareAI);NO(e.gameState);for(const i of n)sg(i,e,xd.ExecuteAI)}function BI(){return{entities:{},nextEntityId:1}}function qr(e,t,n){const i={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],...n};return e.entities[i.id]=i,i}function nc(e,t,n){return qr(e,"berryBush",{position:t,radius:Cg,food:Array.from({length:Cw},()=>({itemType:"food",type:An.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:Ew,lifespan:ww,age:0,spreadRadius:Cg,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,stateMachine:[Cl,{enteredAt:n,previousState:void 0}]})}function Yl(e,t,n,i=0){const s=i>=Jo;return qr(e,"tree",{position:t,radius:Ql,age:i,lifespan:I1,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:N1,stateMachine:[sn,{enteredAt:n,previousState:void 0}],wood:s?Array.from({length:Cu},()=>({itemType:"item",type:yt.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function js(e,t,n,i,s=!1,a=U_,l=Zv,c,u,f=[],g,m,S=$t.TaskBased){const v=a>=tp;return qr(e,"human",{position:t,radius:v?_t:ya,hunger:l,hitpoints:tS,maxHitpoints:tS,age:a,gender:i,isPlayer:s,food:[],maxFood:qv,maxAge:bl,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:c,fatherId:u,ancestorIds:f,stateMachine:[mt,{enteredAt:n,previousState:void 0}],leaderId:g,tribeInfo:m,aiType:S,aiBlackboard:_.create()})}function bp(e,t,n,i,s,a,l,c,u,f,g){let m,S;switch(l){case"human":m=Qv,S=rn;break;case"prey":m=2,S=120;break;case"predator":m=4,S=140;break}return qr(e,"corpse",{position:t,radius:s,gender:n,age:i,originalEntityId:a,originalEntityType:l,timeOfDeath:c,decayProgress:0,geneCode:g,food:[...Array.from({length:Math.max(m*Math.max(S-f,0)/S,0)},()=>({itemType:"food",type:An.Meat})),...u].map(I=>({...I,id:e.nextEntityId++})),stateMachine:void 0})}function fO(e,t,n,i,s,a,l,c,u){return bp(e,t,n,i,s,a,"human",l,c,u)}function hO(e,t,n,i,s,a,l,c){return bp(e,t,n,i,s,a,"prey",l,[],0,c)}function gO(e,t,n,i,s,a,l,c){return bp(e,t,n,i,s,a,"predator",l,[],0,c)}function pO(e,t,n){const i=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=i?[...i.ancestorIds||[],i.id]:[],l=[...s,...a],c=[...new Set(l)],u=c.slice(Math.max(c.length-Kv,0)),f=Math.random()<.5?"male":"female",g=ti(e.position,{x:5,y:5}),m=js(n.gameState.entities,g,n.gameState.time,f,!1,0,Zv/2,e.id,t,u,(i==null?void 0:i.leaderId)??e.leaderId,(i==null?void 0:i.tribeInfo)??e.tribeInfo,e.aiType);return Me(n,Ce.Birth,e.position),m}function Zr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function sa(e,t,n,i=XR,s=OA,a,l,c,u=$t.BehaviorTreeBased){const f=i>=Dl,g=Date.now();return qr(e,"prey",{position:t,radius:f?_t*.7:ya*.7,hunger:s,hitpoints:fS,maxHitpoints:fS,age:i,maxAge:MA,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:c,stateMachine:[hi,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:_.create()})}function aa(e,t,n,i=t1,s=bA,a,l,c,u=$t.BehaviorTreeBased){const f=i>=Nl,g=Date.now();return qr(e,"predator",{position:t,radius:f?_t*.9:ya*.9,hunger:s,hitpoints:hS,maxHitpoints:hS,age:i,maxAge:kA,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:c,stateMachine:[mn,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:_.create()})}function mO(e,t,n,i){const s=dp(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:i,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:SD,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===ce.Bonfire?Br:void 0,maxFuelLevel:n===ce.Bonfire?Br:void 0};return qr(e,"building",a)}function la(e,t,n,i,s,a){if(n===void 0||s&&a!==void 0&&U(s,e,i.mapDimensions.width,i.mapDimensions.height)>a)return!1;const l=dp(t),c=Math.sqrt(l.width*l.width+l.height*l.height)/2;if(Wn(e,i,c*.8))return!1;if(t===ce.PlantingZone){const{depletedSectors:v}=RA(i.soilDepletion,e,l.width,l.height,i.mapDimensions.width,i.mapDimensions.height);if(v.length>0)return!1}const f=i.search.building.byRadius(e,c*2);for(const v of f){const I=U(e,v.position,i.mapDimensions.width,i.mapDimensions.height),A=(Math.max(l.width,l.height)+Math.max(v.width,v.height))/2;if(I<A*.9)return!1}const g=t===ce.BorderPost;return!!pA(e,n,i,g?cp:ea,g,n).canPlace}function yO(e){const t=[],n=2*Math.PI/e;for(let i=0;i<e;i++){const s=i*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function Zs(e,t,n,i,s,a){const l=performance.now(),c={totalTimeMs:0,anchorsSearched:0,candidatesTested:0,canPlaceChecks:0,tribeDistanceChecks:0},u=n,f=dp(e),g=n.mapDimensions.width,m=n.mapDimensions.height,S=u.search.building.byProperty("ownerId",t),v=[];if(S.length>0){a&&v.unshift(a);const R=ni(t,n),w=[...S].sort((B,O)=>{const N=U(B.position,R,g,m),M=U(O.position,R,g,m);return N-M});v.push(...w.map(B=>B.position))}else v.push(ni(t,n));const I=Math.min(v.length,__),A=Math.max(f.width,f.height),C=A+20,P=A/2;for(let R=0;R<I;R++){const w=v[R];c.anchorsSearched++;for(let B=C;B<=i;B+=P){const O=Math.max(8,Math.min(w_,Math.ceil(2*Math.PI*B/A))),N=yO(O);for(let M=0;M<O;M++){c.candidatesTested++;const F=N[M].cos*B,W=N[M].sin*B,Z=w.x+F,te=w.y+W,j=(Z%g+g)%g,ie=(te%m+m)%m;if(c.tribeDistanceChecks++,!XD({x:j,y:ie},t,s,n)&&(c.canPlaceChecks++,la({x:j,y:ie},e,t,n)))return c.totalTimeMs=performance.now()-l,c.totalTimeMs>Zy&&console.log(`[BuildingPlacement] Slow search for ${e}: ${c.totalTimeMs.toFixed(2)}ms | anchors=${c.anchorsSearched}, candidates=${c.candidatesTested}, canPlace=${c.canPlaceChecks}, tribeDist=${c.tribeDistanceChecks}`),{x:j,y:ie}}}}c.totalTimeMs=performance.now()-l,c.totalTimeMs>Zy&&console.log(`[BuildingPlacement] Slow search (no valid location) for ${e}: ${c.totalTimeMs.toFixed(2)}ms | anchors=${c.anchorsSearched}, candidates=${c.candidatesTested}, canPlace=${c.canPlaceChecks}, tribeDist=${c.tribeDistanceChecks}`)}function Vo(e,t,n,i){if(t===ce.BorderPost)return SA(e,cp,n,i),Ge(i,Ee.BorderClaim,e,qe,n),null;const s=mO(i.entities,e,t,n);return t===ce.Bonfire&&(s.storageCapacity=Qd,s.storedItems=[]),yA(e,ea,n,i),t===ce.PlantingZone&&Wl(i),s}function Bg(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===ce.PlantingZone&&Wl(t))}function SO(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let l=e.x-a.position.x,c=e.y-a.position.y;const u=t.mapDimensions.width,f=t.mapDimensions.height;if(Math.abs(l)>u/2&&(l-=Math.sign(l)*u),Math.abs(c)>f/2&&(c-=Math.sign(c)*f),Math.abs(l)<=a.width/2&&Math.abs(c)<=a.height/2)return a}}function zS(e,t,n){return t.search.human.byRadius(e.position,n).filter(a=>{var c;return!(a.id===e.id||a.gender===e.gender||!a.isAdult||a.hunger>=rn||(a.procreationCooldown||0)>0||a.gender==="female"&&a.isPregnant||(e.motherId===a.id||e.fatherId===a.id)&&((c=a.partnerIds)!=null&&c.length))}).sort((a,l)=>{const c=a.id===e.motherId||a.id===e.fatherId,u=e.id===a.motherId||e.id===a.fatherId,f=l.id===e.motherId||l.id===e.fatherId,g=e.id===l.motherId||e.id===l.fatherId;return c||u?1:f||g?-1:a.age-l.age})}function Xr(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),i=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(i),t.length>0)return t[0];if(n.sort(i),n.length>0)return n[0]}function Dn(e,t){const n=e,i=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...i,...s]}function vO(e,t,n){var s;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||e.motherId&&e.motherId===t.motherId||e.fatherId&&e.fatherId===t.fatherId||(s=e.partnerIds)!=null&&s.includes(t.id))return!0;if(e.motherId){const a=n.entities.entities[e.motherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(e.fatherId){const a=n.entities.entities[e.fatherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(t.motherId){const a=n.entities.entities[t.motherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}if(t.fatherId){const a=n.entities.entities[t.fatherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}return!1}function Fg(e,t){var a,l,c,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(l=t.partnerIds)!=null&&l.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,i=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((c=e.ancestorIds)==null?void 0:c.some(f=>t.ancestorIds.includes(f)))||((u=t.ancestorIds)==null?void 0:u.some(f=>e.ancestorIds.includes(f)));return n||i||s}function AO(e,t){const n=[];if(e.motherId){const i=t.entities.entities[e.motherId];i&&n.push(i)}if(e.fatherId){const i=t.entities.entities[e.fatherId];i&&n.push(i)}return n}function FI(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const i=t.entities.entities[n];if(i&&i.gender==="male")return i}return null}function Lg(e,t){var n;if(!e.isAdult){if(e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human")return i}if(e.motherId){const i=t.entities.entities[e.motherId];if(i&&i.type==="human")return i}}if(e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human"&&((n=Xr(Dn(t,i)))==null?void 0:n.id)===e.id)return i}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?FI(e,t):null}function ru(e,t){let n=e;const i=new Set;i.add(n.id);for(let s=0;s<Kv;s++){let a=null;if(n.gender==="female"&&(a=FI(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||i.has(a.id))break;n=a,i.add(n.id)}return n}function zl(e,t){var i;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(i=e.partnerIds)==null||i.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),Dn(t,e).forEach(s=>n.add(s)),Array.from(n)}function su(e,t){const n=new Map;function i(s){const a=Dn(t,s);for(const l of a)n.has(l.id)||(n.set(l.id,l),i(l))}return i(e),Array.from(n.values())}function Ui(e,t){return t.search.human.byProperty("leaderId",e)}function au(e,t,n=new Map,i=new Set){var a;if(n.has(e))return n.get(e);if(i.has(e))return e;i.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const l=s.partnerIds.find(c=>{const u=t.entities.entities[c];return u&&u.gender==="male"});if(l){const c=au(l,t,n,i);return n.set(e,c),c}}if(s.fatherId&&t.entities.entities[s.fatherId]){const l=au(s.fatherId,t,n,i);return n.set(e,l),l}return n.set(e,e),e}function IO(e,t){e.leaderId=e.id,e.tribeRole=ee.Leader,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{roleWeights:{[ee.Leader]:0,[ee.Gatherer]:2,[ee.Planter]:2,[ee.Hunter]:2,[ee.Mover]:2,[ee.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}}),e.tribeInfo||(e.tribeInfo={tribeBadge:iu(),tribeColor:$n[Math.floor(Math.random()*$n.length)]}),e.tribeControl||(e.tribeControl={roleWeights:{[ee.Leader]:0,[ee.Gatherer]:2,[ee.Planter]:2,[ee.Hunter]:2,[ee.Mover]:2,[ee.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}})}function TO(e,t){if(e.length===0)return null;const n=new Map,i=new Map;for(const l of e){const c=au(l.id,t,n);i.has(c)||i.set(c,[]),i.get(c).push(l)}let s=null,a=0;for(const[l,c]of i.entries())c.length>a&&(a=c.length,s=l);return s&&t.entities.entities[s]||null}function bu(e,t){var l,c,u;const n=new Map,i=Object.values(e.entities.entities).filter(f=>f.type==="human");for(const f of i)f.leaderId&&(n.has(f.leaderId)||n.set(f.leaderId,{leaderId:f.leaderId,tribeInfo:f.tribeInfo,members:[]}),(l=n.get(f.leaderId))==null||l.members.push(f));const s=t?(u=(c=e.entities.entities[t])==null?void 0:c.tribeControl)==null?void 0:u.diplomacy:void 0,a=Array.from(n.values()).map(f=>{var v,I;const g=e.entities.entities[f.leaderId],m=f.members.filter(A=>A.isAdult).length,S=f.members.length-m;return{leaderId:f.leaderId,tribeBadge:((v=f==null?void 0:f.tribeInfo)==null?void 0:v.tribeBadge)||"",tribeColor:((I=f==null?void 0:f.tribeInfo)==null?void 0:I.tribeColor)||"",adultCount:m,childCount:S,isPlayerTribe:f.leaderId===t,leaderAge:(g==null?void 0:g.age)??0,leaderGender:(g==null?void 0:g.gender)??"male",diplomacyStatus:(s==null?void 0:s[f.leaderId??-1])??Ut.Friendly}});return a.sort((f,g)=>f.isPlayerTribe?-1:g.isPlayerTribe?1:g.adultCount+g.childCount-(f.adultCount+f.childCount)),a}function Nn(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function LI(e){var a;const t=new Set,i=e.search.human.all(),s=new Map;for(const l of i)l.leaderId&&(s.has(l.leaderId)||s.set(l.leaderId,[]),(a=s.get(l.leaderId))==null||a.push(l));for(const[l,c]of s){if(c.length===0)continue;const u=e.entities.entities[l],f=!u,g=u&&u.leaderId!==l;(f||g)&&t.add(l)}for(let l=0;l<e.terrainOwnership.length;l++){const c=e.terrainOwnership[l];c!==null&&!s.has(c)&&t.add(c)}return Array.from(t)}function EO(e,t){const n=new Map,s=t.search.human.all(),a=zl(e,t);for(const c of a)n.set(c,3);for(const c of s)c.id===e.id||n.has(c)||Fg(e,c)&&n.set(c,2);const l=Array.from(n.keys());for(const c of l)if(c.partnerIds)for(const u of c.partnerIds){const f=t.entities.entities[u];f&&!n.has(f)&&f.id!==e.id&&n.set(f,1)}return n}function CO(e,t){const n=Ui(e,t);if(n.length===0)return null;const i=t.entities.entities[e];if(i&&i.leaderId&&i.leaderId!==i.id)return i.leaderId;const s=new Map;for(const c of n){const u=EO(c,t);for(const[f,g]of u)if(f.leaderId&&f.leaderId!==e){const m=f.leaderId,S=t.entities.entities[m];if(S&&S.leaderId===S.id){const v=s.get(m)||0;s.set(m,v+g)}}}let a=null,l=0;for(const[c,u]of s)u>l&&(l=u,a=c);return a}function jS(e,t,n){var g,m;const i=Ui(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=i.length>0?(g=i[0].tribeInfo)==null?void 0:g.tribeBadge:"?",l=s.leaderId===e||!s.leaderId;if(l){const S=n.entities.entities[e];IO(s,S)}const c=((m=s.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const S of i)S.id!==t&&(S.leaderId=t,S.tribeInfo=s.tribeInfo,S.tribeRole=void 0);const f=n.search.building.byProperty("ownerId",e);for(const S of f)S.ownerId=t;Jd(n,e,t),Fl(n,{identifier:`tribe-merge-${e}`,type:Yr.TribeMerged,message:l?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${c}!`,duration:qd,targetEntityIds:[t],highlightedEntityIds:[t,...i.map(S=>S.id)]})}function _O(e){var n;const t=LI(e);for(const i of t){const s=Ui(i,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",i);for(const f of u)Bg(f.id,e);Jd(e,i,null),Fl(e,{identifier:`tribe-dissolved-${i}`,type:Yr.TribeMerged,message:"An extinct tribe has been dissolved.",duration:qd});continue}const a=TO(s,e);if(a){jS(i,a.id,e);continue}const l=CO(i,e);if(l)jS(i,l,e);else{const c=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const g of s)g.leaderId=void 0,g.tribeInfo=void 0,g.tribeRole=void 0;const f=e.search.building.byProperty("ownerId",i);for(const g of f)Bg(g.id,e);Jd(e,i,null),Fl(e,{identifier:`tribe-dissolved-${i}`,type:Yr.TribeMerged,message:`Tribe ${c} has been dissolved due to lack of leadership.`,duration:qd})}}}function wO(e,t,n){const i=zl(e,t),s=t;for(const a of i){if(U(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height)>n)continue;const c=s.search.human.byProperty("attackTargetId",a.id);for(const u of c)if(u.leaderId!==e.leaderId&&U(e.position,u.position,t.mapDimensions.width,t.mapDimensions.height)<=n)return{familyMember:a,aggressor:u}}}function RO(e,t){const i=t.search.human.byRadius(e.position,h_);let s,a=1/0;for(const l of i){if(l.id===e.id||l.hitpoints<=0||l.hitpoints/l.maxHitpoints>f_||vO(e,l,t)||e.leaderId===l.leaderId&&e.leaderId)continue;const c=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);c<a&&(a=c,s=l)}return s}function PO(e,t,n){return t.search.human.byRadius(e.position,n).filter(s=>Vr(e,s,t))}function DO(e,t,n){const i=n.search.human.byProperty("leaderId",e);let s=0;for(const a of i)a.attackTargetId===t&&s++;return s}function XS(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let i=n.hitpoints;return i+=(n.maxAge-n.age)*.5,i+=n.food.length*2,t+i},0)}function Bp(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>qo&&n.push({type:oe.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const l=Be(t,e,"berryBush",ze,f=>f.food.length>0),c=Be(t,e,"corpse",ze,f=>f.food.length>0);let u=null;l&&c?u=U(t.position,l.position,e.mapDimensions.width,e.mapDimensions.height)<=U(t.position,c.position,e.mapDimensions.width,e.mapDimensions.height)?l:c:u=l||c,u&&n.push({type:oe.Gather,action:"gathering",key:"e",targetEntity:u})}const i=Be(t,e,"human",ze,l=>nr(t,l,e));if(i&&n.push({type:oe.Procreate,action:"procreating",key:"r",targetEntity:i}),t.food.length>0&&t.isAdult){const l=Be(t,e,"human",ze,c=>{const u=c;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=qo});l&&n.push({type:oe.FeedChild,action:"feeding",key:"h",targetEntity:l})}const s=Be(t,e,"human",Sn,l=>Vr(t,l,e))??Be(t,e,"predator",Sn)??Be(t,e,"prey",Sn);if(s&&n.push({type:oe.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(l=>l.type===An.Berry).length>=uo&&n.push({type:oe.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const l=Be(t,e,"building",Zt,c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});l&&n.push({type:oe.Deposit,action:"idle",key:"x",targetEntity:l})}if(t.food.length<t.maxFood&&t.isAdult){const l=Be(t,e,"building",Zt,c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});l&&n.push({type:oe.Retrieve,action:"idle",key:"z",targetEntity:l})}if(((a=t.heldItem)==null?void 0:a.type)===yt.Wood){const l=Be(t,e,"building",Zt,c=>{const u=c;return u.buildingType===ce.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});l&&n.push({type:oe.Deposit,action:"depositing",key:"x",targetEntity:l})}if(EI(t,e).canSplit&&n.push({type:oe.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const l=Be(t,e,"tree",pu,c=>c.wood&&c.wood.length>0);l&&n.push({type:oe.Chop,action:"chopping",key:"c",targetEntity:l})}return n}function Bu(e){var m;const t=Object.values(e.entities.entities),n=[],i=[],s=[],a=[],l=[],c=[],u=[];for(const S of t)switch(S.type){case"human":n.push(S);break;case"berryBush":i.push(S);break;case"corpse":s.push(S);break;case"prey":a.push(S);break;case"predator":l.push(S);break;case"building":c.push(S);break;case"tree":u.push(S);break}const f=e.mapDimensions;return{...e,search:{human:Mi(n,f),berryBush:Mi(i,f),corpse:Mi(s,f),prey:Mi(a,f),predator:Mi(l,f),building:Mi(c,f),tree:Mi(u,f),terrainOwnership:Mi(e.terrainOwnership.map((S,v)=>S===null?null:{position:Vw(v,e.mapDimensions.width),width:Re,height:Re,ownerId:S}).filter(S=>S!==null),f),tasks:((m=e.search)==null?void 0:m.tasks)??Mi([],f)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:{}}}}function NO(e){e.search.tasks=Mi(Object.values(e.tasks),e.mapDimensions)}var Dr=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(Dr||{});class MO{constructor(){De(this,"worker",null);De(this,"pendingRequests",new Map);De(this,"requestQueue",[]);De(this,"isProcessing",!1);De(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case Dr.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case Dr.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case Dr.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,i)=>{if(!this.worker){i(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:i});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),i(s)}})}queueOperation(t){return new Promise((n,i)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){i(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),i=t,s={type:Dr.SAVE_REQUEST,id:n,gameState:i};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Dr.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Dr.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const Fp=new MO;async function Lp(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,roleManagerOpen:e.roleManagerOpen,armyControlOpen:e.armyControlOpen,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks};await Fp.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function OO(){try{const e=await Fp.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=Bu(t);return Wl(n),n}catch(e){return console.error("Failed to load game:",e),await UI(),null}}async function UI(){try{await Fp.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const HI=Fe.createContext(void 0),kO=({initialAppState:e,children:t})=>{const[n,i]=Fe.useState(e),[s,a]=Fe.useState(void 0),[l,c]=Fe.useState(null),[u,f]=Fe.useState(!1);Fe.useEffect(()=>{OO().then(I=>{I&&c(I),f(!0)})},[]);const g=(I,A)=>{i(I),I==="gameOver"&&A?a(A):I!=="gameOver"&&a(void 0)},m=()=>{i("intro"),a(void 0),v()},S=I=>{Lp(I),c(I)},v=()=>{UI(),c(null)};return Ue.jsx(HI.Provider,{value:{appState:n,setAppState:g,returnToIntro:m,gameOverDetails:s,contextReady:u,savedGameState:l,setSavedGameState:c,saveCurrentGame:S,clearCurrentSave:v},children:t})},Qr=()=>{const e=Fe.useContext(HI);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var an=function(){return an=Object.assign||function(t){for(var n,i=1,s=arguments.length;i<s;i++){n=arguments[i];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},an.apply(this,arguments)};function jl(e,t,n){if(n||arguments.length===2)for(var i=0,s=t.length,a;i<s;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return e.concat(a||Array.prototype.slice.call(t))}var dt="-ms-",Ol="-moz-",Je="-webkit-",GI="comm",Fu="rule",Up="decl",bO="@import",$I="@keyframes",BO="@layer",xI=Math.abs,Hp=String.fromCharCode,Ug=Object.assign;function FO(e,t){return Lt(e,0)^45?(((t<<2^Lt(e,0))<<2^Lt(e,1))<<2^Lt(e,2))<<2^Lt(e,3):0}function WI(e){return e.trim()}function qi(e,t){return(e=t.exec(e))?e[0]:e}function We(e,t,n){return e.replace(t,n)}function Wd(e,t,n){return e.indexOf(t,n)}function Lt(e,t){return e.charCodeAt(t)|0}function ca(e,t,n){return e.slice(t,n)}function Oi(e){return e.length}function YI(e){return e.length}function El(e,t){return t.push(e),e}function LO(e,t){return e.map(t).join("")}function VS(e,t){return e.filter(function(n){return!qi(n,t)})}var Lu=1,da=1,zI=0,ii=0,Pt=0,va="";function Uu(e,t,n,i,s,a,l,c){return{value:e,root:t,parent:n,type:i,props:s,children:a,line:Lu,column:da,length:l,return:"",siblings:c}}function Ho(e,t){return Ug(Uu("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Ps(e){for(;e.root;)e=Ho(e.root,{children:[e]});El(e,e.siblings)}function UO(){return Pt}function HO(){return Pt=ii>0?Lt(va,--ii):0,da--,Pt===10&&(da=1,Lu--),Pt}function pi(){return Pt=ii<zI?Lt(va,ii++):0,da++,Pt===10&&(da=1,Lu++),Pt}function $r(){return Lt(va,ii)}function Yd(){return ii}function Hu(e,t){return ca(va,e,t)}function Hg(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function GO(e){return Lu=da=1,zI=Oi(va=e),ii=0,[]}function $O(e){return va="",e}function ag(e){return WI(Hu(ii-1,Gg(e===91?e+2:e===40?e+1:e)))}function xO(e){for(;(Pt=$r())&&Pt<33;)pi();return Hg(e)>2||Hg(Pt)>3?"":" "}function WO(e,t){for(;--t&&pi()&&!(Pt<48||Pt>102||Pt>57&&Pt<65||Pt>70&&Pt<97););return Hu(e,Yd()+(t<6&&$r()==32&&pi()==32))}function Gg(e){for(;pi();)switch(Pt){case e:return ii;case 34:case 39:e!==34&&e!==39&&Gg(Pt);break;case 40:e===41&&Gg(e);break;case 92:pi();break}return ii}function YO(e,t){for(;pi()&&e+Pt!==57;)if(e+Pt===84&&$r()===47)break;return"/*"+Hu(t,ii-1)+"*"+Hp(e===47?e:pi())}function zO(e){for(;!Hg($r());)pi();return Hu(e,ii)}function jO(e){return $O(zd("",null,null,null,[""],e=GO(e),0,[0],e))}function zd(e,t,n,i,s,a,l,c,u){for(var f=0,g=0,m=l,S=0,v=0,I=0,A=1,C=1,P=1,R=0,w="",B=s,O=a,N=i,M=w;C;)switch(I=R,R=pi()){case 40:if(I!=108&&Lt(M,m-1)==58){Wd(M+=We(ag(R),"&","&\f"),"&\f",xI(f?c[f-1]:0))!=-1&&(P=-1);break}case 34:case 39:case 91:M+=ag(R);break;case 9:case 10:case 13:case 32:M+=xO(I);break;case 92:M+=WO(Yd()-1,7);continue;case 47:switch($r()){case 42:case 47:El(XO(YO(pi(),Yd()),t,n,u),u);break;default:M+="/"}break;case 123*A:c[f++]=Oi(M)*P;case 125*A:case 59:case 0:switch(R){case 0:case 125:C=0;case 59+g:P==-1&&(M=We(M,/\f/g,"")),v>0&&Oi(M)-m&&El(v>32?qS(M+";",i,n,m-1,u):qS(We(M," ","")+";",i,n,m-2,u),u);break;case 59:M+=";";default:if(El(N=KS(M,t,n,f,g,s,c,w,B=[],O=[],m,a),a),R===123)if(g===0)zd(M,t,N,N,B,a,m,c,O);else switch(S===99&&Lt(M,3)===110?100:S){case 100:case 108:case 109:case 115:zd(e,N,N,i&&El(KS(e,N,N,0,0,s,c,w,s,B=[],m,O),O),s,O,m,c,i?B:O);break;default:zd(M,N,N,N,[""],O,0,c,O)}}f=g=v=0,A=P=1,w=M="",m=l;break;case 58:m=1+Oi(M),v=I;default:if(A<1){if(R==123)--A;else if(R==125&&A++==0&&HO()==125)continue}switch(M+=Hp(R),R*A){case 38:P=g>0?1:(M+="\f",-1);break;case 44:c[f++]=(Oi(M)-1)*P,P=1;break;case 64:$r()===45&&(M+=ag(pi())),S=$r(),g=m=Oi(w=M+=zO(Yd())),R++;break;case 45:I===45&&Oi(M)==2&&(A=0)}}return a}function KS(e,t,n,i,s,a,l,c,u,f,g,m){for(var S=s-1,v=s===0?a:[""],I=YI(v),A=0,C=0,P=0;A<i;++A)for(var R=0,w=ca(e,S+1,S=xI(C=l[A])),B=e;R<I;++R)(B=WI(C>0?v[R]+" "+w:We(w,/&\f/g,v[R])))&&(u[P++]=B);return Uu(e,t,n,s===0?Fu:c,u,f,g,m)}function XO(e,t,n,i){return Uu(e,t,n,GI,Hp(UO()),ca(e,2,-2),0,i)}function qS(e,t,n,i,s){return Uu(e,t,n,Up,ca(e,0,i),ca(e,i+1,-1),i,s)}function jI(e,t,n){switch(FO(e,t)){case 5103:return Je+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Je+e+e;case 4789:return Ol+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Je+e+Ol+e+dt+e+e;case 5936:switch(Lt(e,t+11)){case 114:return Je+e+dt+We(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Je+e+dt+We(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Je+e+dt+We(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Je+e+dt+e+e;case 6165:return Je+e+dt+"flex-"+e+e;case 5187:return Je+e+We(e,/(\w+).+(:[^]+)/,Je+"box-$1$2"+dt+"flex-$1$2")+e;case 5443:return Je+e+dt+"flex-item-"+We(e,/flex-|-self/g,"")+(qi(e,/flex-|baseline/)?"":dt+"grid-row-"+We(e,/flex-|-self/g,""))+e;case 4675:return Je+e+dt+"flex-line-pack"+We(e,/align-content|flex-|-self/g,"")+e;case 5548:return Je+e+dt+We(e,"shrink","negative")+e;case 5292:return Je+e+dt+We(e,"basis","preferred-size")+e;case 6060:return Je+"box-"+We(e,"-grow","")+Je+e+dt+We(e,"grow","positive")+e;case 4554:return Je+We(e,/([^-])(transform)/g,"$1"+Je+"$2")+e;case 6187:return We(We(We(e,/(zoom-|grab)/,Je+"$1"),/(image-set)/,Je+"$1"),e,"")+e;case 5495:case 3959:return We(e,/(image-set\([^]*)/,Je+"$1$`$1");case 4968:return We(We(e,/(.+:)(flex-)?(.*)/,Je+"box-pack:$3"+dt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Je+e+e;case 4200:if(!qi(e,/flex-|baseline/))return dt+"grid-column-align"+ca(e,t)+e;break;case 2592:case 3360:return dt+We(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(i,s){return t=s,qi(i.props,/grid-\w+-end/)})?~Wd(e+(n=n[t].value),"span",0)?e:dt+We(e,"-start","")+e+dt+"grid-row-span:"+(~Wd(n,"span",0)?qi(n,/\d+/):+qi(n,/\d+/)-+qi(e,/\d+/))+";":dt+We(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(i){return qi(i.props,/grid-\w+-start/)})?e:dt+We(We(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return We(e,/(.+)-inline(.+)/,Je+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Oi(e)-1-t>6)switch(Lt(e,t+1)){case 109:if(Lt(e,t+4)!==45)break;case 102:return We(e,/(.+:)(.+)-([^]+)/,"$1"+Je+"$2-$3$1"+Ol+(Lt(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Wd(e,"stretch",0)?jI(We(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return We(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,s,a,l,c,u,f){return dt+s+":"+a+f+(l?dt+s+"-span:"+(c?u:+u-+a)+f:"")+e});case 4949:if(Lt(e,t+6)===121)return We(e,":",":"+Je)+e;break;case 6444:switch(Lt(e,Lt(e,14)===45?18:11)){case 120:return We(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Je+(Lt(e,14)===45?"inline-":"")+"box$3$1"+Je+"$2$3$1"+dt+"$2box$3")+e;case 100:return We(e,":",":"+dt)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return We(e,"scroll-","scroll-snap-")+e}return e}function lu(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function VO(e,t,n,i){switch(e.type){case BO:if(e.children.length)break;case bO:case Up:return e.return=e.return||e.value;case GI:return"";case $I:return e.return=e.value+"{"+lu(e.children,i)+"}";case Fu:if(!Oi(e.value=e.props.join(",")))return""}return Oi(n=lu(e.children,i))?e.return=e.value+"{"+n+"}":""}function KO(e){var t=YI(e);return function(n,i,s,a){for(var l="",c=0;c<t;c++)l+=e[c](n,i,s,a)||"";return l}}function qO(e){return function(t){t.root||(t=t.return)&&e(t)}}function ZO(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case Up:e.return=jI(e.value,e.length,n);return;case $I:return lu([Ho(e,{value:We(e.value,"@","@"+Je)})],i);case Fu:if(e.length)return LO(n=e.props,function(s){switch(qi(s,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Ps(Ho(e,{props:[We(s,/:(read-\w+)/,":"+Ol+"$1")]})),Ps(Ho(e,{props:[s]})),Ug(e,{props:VS(n,i)});break;case"::placeholder":Ps(Ho(e,{props:[We(s,/:(plac\w+)/,":"+Je+"input-$1")]})),Ps(Ho(e,{props:[We(s,/:(plac\w+)/,":"+Ol+"$1")]})),Ps(Ho(e,{props:[We(s,/:(plac\w+)/,dt+"input-$1")]})),Ps(Ho(e,{props:[s]})),Ug(e,{props:VS(n,i)});break}return""})}}var QO={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Hn={},ua=typeof process<"u"&&Hn!==void 0&&(Hn.REACT_APP_SC_ATTR||Hn.SC_ATTR)||"data-styled",XI="active",VI="data-styled-version",Gu="6.1.13",Gp=`/*!sc*/
`,cu=typeof window<"u"&&"HTMLElement"in window,JO=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Hn!==void 0&&Hn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Hn.REACT_APP_SC_DISABLE_SPEEDY!==""?Hn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Hn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Hn!==void 0&&Hn.SC_DISABLE_SPEEDY!==void 0&&Hn.SC_DISABLE_SPEEDY!==""&&Hn.SC_DISABLE_SPEEDY!=="false"&&Hn.SC_DISABLE_SPEEDY),ek={},$u=Object.freeze([]),fa=Object.freeze({});function KI(e,t,n){return n===void 0&&(n=fa),e.theme!==n.theme&&e.theme||t||n.theme}var qI=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),tk=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,nk=/(^-|-$)/g;function ZS(e){return e.replace(tk,"-").replace(nk,"")}var ik=/(a)(d)/gi,Dd=52,QS=function(e){return String.fromCharCode(e+(e>25?39:97))};function $g(e){var t,n="";for(t=Math.abs(e);t>Dd;t=t/Dd|0)n=QS(t%Dd)+n;return(QS(t%Dd)+n).replace(ik,"$1-$2")}var lg,ZI=5381,Xs=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},QI=function(e){return Xs(ZI,e)};function JI(e){return $g(QI(e)>>>0)}function ok(e){return e.displayName||e.name||"Component"}function cg(e){return typeof e=="string"&&!0}var eT=typeof Symbol=="function"&&Symbol.for,tT=eT?Symbol.for("react.memo"):60115,rk=eT?Symbol.for("react.forward_ref"):60112,sk={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},ak={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},nT={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},lk=((lg={})[rk]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},lg[tT]=nT,lg);function JS(e){return("type"in(t=e)&&t.type.$$typeof)===tT?nT:"$$typeof"in e?lk[e.$$typeof]:sk;var t}var ck=Object.defineProperty,dk=Object.getOwnPropertyNames,ev=Object.getOwnPropertySymbols,uk=Object.getOwnPropertyDescriptor,fk=Object.getPrototypeOf,tv=Object.prototype;function iT(e,t,n){if(typeof t!="string"){if(tv){var i=fk(t);i&&i!==tv&&iT(e,i,n)}var s=dk(t);ev&&(s=s.concat(ev(t)));for(var a=JS(e),l=JS(t),c=0;c<s.length;++c){var u=s[c];if(!(u in ak||n&&n[u]||l&&u in l||a&&u in a)){var f=uk(t,u);try{ck(e,u,f)}catch{}}}}return e}function ha(e){return typeof e=="function"}function $p(e){return typeof e=="object"&&"styledComponentId"in e}function kr(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function xg(e,t){if(e.length===0)return"";for(var n=e[0],i=1;i<e.length;i++)n+=e[i];return n}function Xl(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function Wg(e,t,n){if(n===void 0&&(n=!1),!n&&!Xl(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)e[i]=Wg(e[i],t[i]);else if(Xl(t))for(var i in t)e[i]=Wg(e[i],t[i]);return e}function xp(e,t){Object.defineProperty(e,"toString",{value:t})}function ic(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var hk=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,i=0;i<t;i++)n+=this.groupSizes[i];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var i=this.groupSizes,s=i.length,a=s;t>=a;)if((a<<=1)<0)throw ic(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(i),this.length=a;for(var l=s;l<a;l++)this.groupSizes[l]=0}for(var c=this.indexOfGroup(t+1),u=(l=0,n.length);l<u;l++)this.tag.insertRule(c,n[l])&&(this.groupSizes[t]++,c++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],i=this.indexOfGroup(t),s=i+n;this.groupSizes[t]=0;for(var a=i;a<s;a++)this.tag.deleteRule(i)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var i=this.groupSizes[t],s=this.indexOfGroup(t),a=s+i,l=s;l<a;l++)n+="".concat(this.tag.getRule(l)).concat(Gp);return n},e}(),jd=new Map,du=new Map,Xd=1,Nd=function(e){if(jd.has(e))return jd.get(e);for(;du.has(Xd);)Xd++;var t=Xd++;return jd.set(e,t),du.set(t,e),t},gk=function(e,t){Xd=t+1,jd.set(e,t),du.set(t,e)},pk="style[".concat(ua,"][").concat(VI,'="').concat(Gu,'"]'),mk=new RegExp("^".concat(ua,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),yk=function(e,t,n){for(var i,s=n.split(","),a=0,l=s.length;a<l;a++)(i=s[a])&&e.registerName(t,i)},Sk=function(e,t){for(var n,i=((n=t.textContent)!==null&&n!==void 0?n:"").split(Gp),s=[],a=0,l=i.length;a<l;a++){var c=i[a].trim();if(c){var u=c.match(mk);if(u){var f=0|parseInt(u[1],10),g=u[2];f!==0&&(gk(g,f),yk(e,g,u[3]),e.getTag().insertRules(f,s)),s.length=0}else s.push(c)}}},nv=function(e){for(var t=document.querySelectorAll(pk),n=0,i=t.length;n<i;n++){var s=t[n];s&&s.getAttribute(ua)!==XI&&(Sk(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function vk(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var oT=function(e){var t=document.head,n=e||t,i=document.createElement("style"),s=function(c){var u=Array.from(c.querySelectorAll("style[".concat(ua,"]")));return u[u.length-1]}(n),a=s!==void 0?s.nextSibling:null;i.setAttribute(ua,XI),i.setAttribute(VI,Gu);var l=vk();return l&&i.setAttribute("nonce",l),n.insertBefore(i,a),i},Ak=function(){function e(t){this.element=oT(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,s=0,a=i.length;s<a;s++){var l=i[s];if(l.ownerNode===n)return l}throw ic(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),Ik=function(){function e(t){this.element=oT(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),Tk=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),iv=cu,Ek={isServer:!cu,useCSSOMInjection:!JO},uu=function(){function e(t,n,i){t===void 0&&(t=fa),n===void 0&&(n={});var s=this;this.options=an(an({},Ek),t),this.gs=n,this.names=new Map(i),this.server=!!t.isServer,!this.server&&cu&&iv&&(iv=!1,nv(this)),xp(this,function(){return function(a){for(var l=a.getTag(),c=l.length,u="",f=function(m){var S=function(P){return du.get(P)}(m);if(S===void 0)return"continue";var v=a.names.get(S),I=l.getGroup(m);if(v===void 0||!v.size||I.length===0)return"continue";var A="".concat(ua,".g").concat(m,'[id="').concat(S,'"]'),C="";v!==void 0&&v.forEach(function(P){P.length>0&&(C+="".concat(P,","))}),u+="".concat(I).concat(A,'{content:"').concat(C,'"}').concat(Gp)},g=0;g<c;g++)f(g);return u}(s)})}return e.registerId=function(t){return Nd(t)},e.prototype.rehydrate=function(){!this.server&&cu&&nv(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(an(an({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var i=n.useCSSOMInjection,s=n.target;return n.isServer?new Tk(s):i?new Ak(s):new Ik(s)}(this.options),new hk(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(Nd(t),this.names.has(t))this.names.get(t).add(n);else{var i=new Set;i.add(n),this.names.set(t,i)}},e.prototype.insertRules=function(t,n,i){this.registerName(t,n),this.getTag().insertRules(Nd(t),i)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(Nd(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),Ck=/&/g,_k=/^\s*\/\/.*$/gm;function rT(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(i){return"".concat(t," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=rT(n.children,t)),n})}function wk(e){var t,n,i,s=fa,a=s.options,l=a===void 0?fa:a,c=s.plugins,u=c===void 0?$u:c,f=function(S,v,I){return I.startsWith(n)&&I.endsWith(n)&&I.replaceAll(n,"").length>0?".".concat(t):S},g=u.slice();g.push(function(S){S.type===Fu&&S.value.includes("&")&&(S.props[0]=S.props[0].replace(Ck,n).replace(i,f))}),l.prefix&&g.push(ZO),g.push(VO);var m=function(S,v,I,A){v===void 0&&(v=""),I===void 0&&(I=""),A===void 0&&(A="&"),t=A,n=v,i=new RegExp("\\".concat(n,"\\b"),"g");var C=S.replace(_k,""),P=jO(I||v?"".concat(I," ").concat(v," { ").concat(C," }"):C);l.namespace&&(P=rT(P,l.namespace));var R=[];return lu(P,KO(g.concat(qO(function(w){return R.push(w)})))),R};return m.hash=u.length?u.reduce(function(S,v){return v.name||ic(15),Xs(S,v.name)},ZI).toString():"",m}var Rk=new uu,Yg=wk(),sT=ki.createContext({shouldForwardProp:void 0,styleSheet:Rk,stylis:Yg});sT.Consumer;ki.createContext(void 0);function zg(){return Fe.useContext(sT)}var Pk=function(){function e(t,n){var i=this;this.inject=function(s,a){a===void 0&&(a=Yg);var l=i.name+a.hash;s.hasNameForId(i.id,l)||s.insertRules(i.id,l,a(i.rules,l,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,xp(this,function(){throw ic(12,String(i.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Yg),this.name+t.hash},e}(),Dk=function(e){return e>="A"&&e<="Z"};function ov(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(n===1&&i==="-"&&e[0]==="-")return e;Dk(i)?t+="-"+i.toLowerCase():t+=i}return t.startsWith("ms-")?"-"+t:t}var aT=function(e){return e==null||e===!1||e===""},lT=function(e){var t,n,i=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!aT(a)&&(Array.isArray(a)&&a.isCss||ha(a)?i.push("".concat(ov(s),":"),a,";"):Xl(a)?i.push.apply(i,jl(jl(["".concat(s," {")],lT(a),!1),["}"],!1)):i.push("".concat(ov(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in QO||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function Ko(e,t,n,i){if(aT(e))return[];if($p(e))return[".".concat(e.styledComponentId)];if(ha(e)){if(!ha(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return Ko(s,t,n,i)}var a;return e instanceof Pk?n?(e.inject(n,i),[e.getName(i)]):[e]:Xl(e)?lT(e):Array.isArray(e)?Array.prototype.concat.apply($u,e.map(function(l){return Ko(l,t,n,i)})):[e.toString()]}function cT(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(ha(n)&&!$p(n))return!1}return!0}var Nk=QI(Gu),Mk=function(){function e(t,n,i){this.rules=t,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&cT(t),this.componentId=n,this.baseHash=Xs(Nk,n),this.baseStyle=i,uu.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,i){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=kr(s,this.staticRulesId);else{var a=xg(Ko(this.rules,t,n,i)),l=$g(Xs(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,l)){var c=i(a,".".concat(l),void 0,this.componentId);n.insertRules(this.componentId,l,c)}s=kr(s,l),this.staticRulesId=l}else{for(var u=Xs(this.baseHash,i.hash),f="",g=0;g<this.rules.length;g++){var m=this.rules[g];if(typeof m=="string")f+=m;else if(m){var S=xg(Ko(m,t,n,i));u=Xs(u,S+g),f+=S}}if(f){var v=$g(u>>>0);n.hasNameForId(this.componentId,v)||n.insertRules(this.componentId,v,i(f,".".concat(v),void 0,this.componentId)),s=kr(s,v)}}return s},e}(),Wp=ki.createContext(void 0);Wp.Consumer;var dg={};function Ok(e,t,n){var i=$p(e),s=e,a=!cg(e),l=t.attrs,c=l===void 0?$u:l,u=t.componentId,f=u===void 0?function(B,O){var N=typeof B!="string"?"sc":ZS(B);dg[N]=(dg[N]||0)+1;var M="".concat(N,"-").concat(JI(Gu+N+dg[N]));return O?"".concat(O,"-").concat(M):M}(t.displayName,t.parentComponentId):u,g=t.displayName,m=g===void 0?function(B){return cg(B)?"styled.".concat(B):"Styled(".concat(ok(B),")")}(e):g,S=t.displayName&&t.componentId?"".concat(ZS(t.displayName),"-").concat(t.componentId):t.componentId||f,v=i&&s.attrs?s.attrs.concat(c).filter(Boolean):c,I=t.shouldForwardProp;if(i&&s.shouldForwardProp){var A=s.shouldForwardProp;if(t.shouldForwardProp){var C=t.shouldForwardProp;I=function(B,O){return A(B,O)&&C(B,O)}}else I=A}var P=new Mk(n,S,i?s.componentStyle:void 0);function R(B,O){return function(N,M,F){var W=N.attrs,Z=N.componentStyle,te=N.defaultProps,j=N.foldedComponentIds,ie=N.styledComponentId,se=N.target,_e=ki.useContext(Wp),fe=zg(),ne=N.shouldForwardProp||fe.shouldForwardProp,z=KI(M,_e,te)||fa,V=function(Pe,me,Oe){for(var Ne,ue=an(an({},me),{className:void 0,theme:Oe}),Se=0;Se<Pe.length;Se+=1){var xe=ha(Ne=Pe[Se])?Ne(ue):Ne;for(var Ie in xe)ue[Ie]=Ie==="className"?kr(ue[Ie],xe[Ie]):Ie==="style"?an(an({},ue[Ie]),xe[Ie]):xe[Ie]}return me.className&&(ue.className=kr(ue.className,me.className)),ue}(W,M,z),K=V.as||se,b={};for(var Y in V)V[Y]===void 0||Y[0]==="$"||Y==="as"||Y==="theme"&&V.theme===z||(Y==="forwardedAs"?b.as=V.forwardedAs:ne&&!ne(Y,K)||(b[Y]=V[Y]));var de=function(Pe,me){var Oe=zg(),Ne=Pe.generateAndInjectStyles(me,Oe.styleSheet,Oe.stylis);return Ne}(Z,V),pe=kr(j,ie);return de&&(pe+=" "+de),V.className&&(pe+=" "+V.className),b[cg(K)&&!qI.has(K)?"class":"className"]=pe,b.ref=F,Fe.createElement(K,b)}(w,B,O)}R.displayName=m;var w=ki.forwardRef(R);return w.attrs=v,w.componentStyle=P,w.displayName=m,w.shouldForwardProp=I,w.foldedComponentIds=i?kr(s.foldedComponentIds,s.styledComponentId):"",w.styledComponentId=S,w.target=i?s.target:e,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(B){this._foldedDefaultProps=i?function(O){for(var N=[],M=1;M<arguments.length;M++)N[M-1]=arguments[M];for(var F=0,W=N;F<W.length;F++)Wg(O,W[F],!0);return O}({},s.defaultProps,B):B}}),xp(w,function(){return".".concat(w.styledComponentId)}),a&&iT(w,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function rv(e,t){for(var n=[e[0]],i=0,s=t.length;i<s;i+=1)n.push(t[i],e[i+1]);return n}var sv=function(e){return Object.assign(e,{isCss:!0})};function dT(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(ha(e)||Xl(e))return sv(Ko(rv($u,jl([e],t,!0))));var i=e;return t.length===0&&i.length===1&&typeof i[0]=="string"?Ko(i):sv(Ko(rv(i,t)))}function jg(e,t,n){if(n===void 0&&(n=fa),!t)throw ic(1,t);var i=function(s){for(var a=[],l=1;l<arguments.length;l++)a[l-1]=arguments[l];return e(t,n,dT.apply(void 0,jl([s],a,!1)))};return i.attrs=function(s){return jg(e,t,an(an({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},i.withConfig=function(s){return jg(e,t,an(an({},n),s))},i}var uT=function(e){return jg(Ok,e)},kt=uT;qI.forEach(function(e){kt[e]=uT(e)});var kk=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=cT(t),uu.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,i,s){var a=s(xg(Ko(this.rules,n,i,s)),""),l=this.componentId+t;i.insertRules(l,l,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,i,s){t>2&&uu.registerId(this.componentId+t),this.removeStyles(t,i),this.createStyles(t,n,i,s)},e}();function bk(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=dT.apply(void 0,jl([e],t,!1)),s="sc-global-".concat(JI(JSON.stringify(i))),a=new kk(i,s),l=function(u){var f=zg(),g=ki.useContext(Wp),m=ki.useRef(f.styleSheet.allocateGSInstance(s)).current;return f.styleSheet.server&&c(m,u,f.styleSheet,g,f.stylis),ki.useLayoutEffect(function(){if(!f.styleSheet.server)return c(m,u,f.styleSheet,g,f.stylis),function(){return a.removeStyles(m,f.styleSheet)}},[m,u,f.styleSheet,g,f.stylis]),null};function c(u,f,g,m,S){if(a.isStatic)a.renderStyles(u,ek,g,S);else{var v=an(an({},f),{theme:KI(f,m,l.defaultProps)});a.renderStyles(u,v,g,S)}}return ki.memo(l)}function fT(e,t){var n=Fe.useRef(null),i=Fe.useRef(!1),s=Fe.useRef(e);s.current=e;var a=Fe.useCallback(function(c){i.current&&(s.current(c),n.current=requestAnimationFrame(a))},[]),l=Fe.useMemo(function(){return[function(){i.current&&(i.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){i.current||(i.current=!0,n.current=requestAnimationFrame(a))},function(){return i.current}]},[]);return Fe.useEffect(function(){return l[0]},[]),l}var gn=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(gn||{}),xr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(xr||{}),pn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(pn||{});const Xg={},Vg={},Bk=[{key:gn.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:gn.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>B_,isCompleted:!1,minDisplayTime:_S,highlightedUIElements:[xr.HUNGER_BAR]},{key:gn.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!Be(t,e,"berryBush",ze*5,i=>i.food.length>0),getTargets:(e,t)=>{const n=[];for(const i of Object.values(e.entities.entities))i.type==="berryBush"&&i.food.length>0&&U(t.position,i.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(i);return n.map(i=>i.id)},isCompleted:!1,minDisplayTime:_S},{key:gn.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=Be(t,e,"berryBush",ze,i=>i.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:gn.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[xr.FOOD_BAR]},{key:gn.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>Dn(e,t).length>0,getTargets:(e,t)=>{const n=Be(t,e,"human",ze,i=>nr(t,i,e));return n?[n.id]:[]},isCompleted:!1},{key:gn.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>Bp(e,t).some(i=>i.type===oe.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:gn.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[xr.COMMAND_BUTTONS],isCompleted:!1},{key:gn.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:gn.AUTOPILOT},{key:gn.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=Be(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=Be(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:gn.ANIMALS_INTRODUCTION},{key:gn.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!Be(t,e,"predator",120),getTargets:(e,t)=>{const n=Be(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:gn.HUNT_PREY}].map(e=>({...e,condition:e.condition?Uk(e.condition):void 0,getTargets:e.getTargets?Hk(e.getTargets):void 0}));function hT(){return{steps:Bk.map(e=>({...e,isCompleted:!1}))}}function gT(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:pn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function Fk(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function Lk(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const i=vt(e);if(!i){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/DP;switch(n.transitionState){case pn.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=pn.ACTIVE);break;case pn.ACTIVE:{const u=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),f=Xg[s.condition];f&&u&&f(e,i)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=pn.FADING_OUT);break}case pn.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const c=Fk(e);c!==null?(n.currentStepIndex=c,n.transitionState=pn.FADING_IN):(n.isActive=!1,n.transitionState=pn.INACTIVE)}break}if(n.transitionState!==pn.FADING_OUT&&n.transitionState!==pn.INACTIVE){const c=Vg[s.getTargets||""];c?n.highlightedEntityIds=[...c(e,i)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function Uk(e){const t=`condition_${Object.keys(Xg).length+1}`;return Xg[t]=e,t}function Hk(e){const t=`getTargets_${Object.keys(Vg).length+1}`;return Vg[t]=e,t}function Gk(){const e=BI(),t=0;for(let S=0;S<Jv;S++){const v={x:Math.random()*Ke,y:Math.random()*Qe};nc(e,v,t)}for(let S=0;S<Fv;S++){const v={x:Math.random()*Ke,y:Math.random()*Qe};Yl(e,v,t)}const n=Ke/2,i=Qe/2;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,I=100+Math.random()*100,A={x:n+Math.cos(v)*I,y:i+Math.sin(v)*I};Yl(e,A,t,Jo)}const s=js(e,{x:n-25,y:i},t,"male",!0),a=js(e,{x:n+25,y:i},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:$n[0]},s.aiType=$t.TaskBased,a.aiType=$t.TaskBased;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,I=Ke/2,A=Qe/2,C={x:n+Math.cos(v)*I,y:i+Math.sin(v)*A},P=js(e,{x:C.x,y:C.y},t,"male",!1);P.leaderId=P.id,P.tribeInfo={tribeBadge:tu[S%tu.length],tribeColor:$n[S%$n.length]};const R=js(e,{x:C.x+50,y:C.y},t,"female",!1);R.leaderId=P.id,R.tribeInfo=P.tribeInfo}for(let S=0;S<LA;S++){const v={x:n+Ke*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};sa(e,v,"male",void 0,void 0,$l()),sa(e,{x:v.x+20,y:v.y},"female",void 0,void 0,$l())}const l={x:n+Ke*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};aa(e,l,"male",void 0,void 0,xl()),aa(e,{x:l.x+20,y:l.y},"female",void 0,void 0,xl());const c=[{id:"muteButton",action:le.ToggleMute,currentWidth:to,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Ht},{id:"pauseButton",action:le.TogglePause,currentWidth:to,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Ht},{id:"returnToIntroButton",action:le.ReturnToIntro,currentWidth:to,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:Ht}],u=hT(),f=gT(),g={time:t,entities:e,mapDimensions:{width:Ke,height:Qe},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:DA,isMuted:!1,uiButtons:c,tutorial:u,tutorialState:f,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:Yr.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:Fr,preyProcreationCooldown:Lr,predatorGestationPeriod:Ur,predatorProcreationCooldown:Hr,preyHungerIncreasePerHour:Wo,predatorHungerIncreasePerHour:Yo,berryBushSpreadChance:ro},soilDepletion:nA(),temperature:sI(Ke,Qe),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ke/Re)*Math.ceil(Qe/Re)).fill(null),tasks:{}},m=Bu(g);return console.log("Game world initialized:",m),m}function $k(){const e=BI(),t=0;for(let u=0;u<Jv;u++){const f={x:Math.random()*Ke,y:Math.random()*Qe};nc(e,f,t)}for(let u=0;u<Fv;u++){const f={x:Math.random()*Ke,y:Math.random()*Qe};Yl(e,f,t)}const n=Ke/2,i=Qe/2;for(let u=0;u<5;u++){const f=u/5*Math.PI*2,g=100+Math.random()*100,m={x:n+Math.cos(f)*g,y:i+Math.sin(f)*g};Yl(e,m,t,Jo)}for(let u=0;u<xC;u++){const f={x:Math.random()*Ke,y:Math.random()*Qe},g=Math.random()<.5?"male":"female";js(e,f,t,g,!1)}for(let u=0;u<LA;u++){const f={x:Math.random()*Ke,y:Math.random()*Qe};sa(e,f,"male",void 0,void 0,$l()),sa(e,{x:f.x+20,y:f.y},"female",void 0,void 0,$l())}const s={x:Math.random()*Ke,y:Math.random()*Qe};aa(e,s,"male",void 0,void 0,xl()),aa(e,{x:s.x+20,y:s.y},"female",void 0,void 0,xl());const a=hT(),l=gT(),c={time:t,entities:e,mapDimensions:{width:Ke,height:Qe},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Ke/2,y:Qe/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:DA,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:l,debugPanel:je.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:Fr,preyProcreationCooldown:Lr,predatorGestationPeriod:Ur,predatorProcreationCooldown:Hr,preyHungerIncreasePerHour:Wo,predatorHungerIncreasePerHour:Yo,berryBushSpreadChance:ro},soilDepletion:nA(),temperature:sI(Ke,Qe),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ke/Re)*Math.ceil(Qe/Re)).fill(null),tasks:{}};return Bu(c)}const xk="humanProcreation",Wk="human",Yk="human",zk=ze,jk=(e,t,n)=>nr(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,Xk=(e,t,n)=>{var u,f,g,m;const{gameState:i}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,l=e.gender==="female"?e:t,c=(a.partnerIds||[]).length===0;if(((u=e.stateMachine)==null?void 0:u[0])!==Or&&(e.stateMachine=[Or,{partnerId:t.id,previousState:(f=e.stateMachine)==null?void 0:f[0],procreationEndTime:n.gameState.time+1}]),((g=t.stateMachine)==null?void 0:g[0])!==Or&&(t.stateMachine=[Or,{partnerId:e.id,previousState:(m=t.stateMachine)==null?void 0:m[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),c&&a.leaderId&&a.leaderId!==a.id){const S=i.entities.entities[a.leaderId];if(S){const v=Fg(a,S),I=Fg(l,S);if(!v&&!I){const A=iu();a.leaderId=a.id,a.tribeInfo={tribeBadge:A,tribeColor:$n[Math.floor(Math.random()*$n.length)]},a.tribeRole=ee.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&l){const S=iu();a.leaderId=a.id,a.tribeInfo={tribeBadge:S,tribeColor:$n[Math.floor(Math.random()*$n.length)]},a.tribeRole=ee.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}e.activeAction=void 0,Ge(i,Ee.Procreation,s,Hl),Ge(i,Ee.Partnered,e.position,qe,e.id),Ge(i,Ee.Partnered,t.position,qe,t.id),e.lastPartneredEffectTime=i.time,t.lastPartneredEffectTime=i.time,t.activeAction=void 0,Me(n,Ce.Procreate,s)},Vk={id:xk,sourceType:Wk,targetType:Yk,maxDistance:zk,checker:jk,perform:Xk},Kk={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:yu,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=qo&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-qo),e.feedChildCooldownTime=z_,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ee.ChildFed,t.position,qe,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,Ce.ChildFed,t.position)}},qk={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:Sn,checker:(e,t,n)=>{var g,m,S;if(((g=e.stateMachine)==null?void 0:g[0])!==Qo||e.attackTargetId!==t.id)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=co,a=!s&&i<=Sn;if(!s&&!a||(s?((m=e.attackCooldown)==null?void 0:m.melee)||0:((S=e.attackCooldown)==null?void 0:S.ranged)||0)>0)return!1;const c=s?Su:rp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>co,l=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),c=k_(ot(l),t.direction);if(Math.abs(c)<ow*Math.PI/180&&Math.random()<rw)Ge(i,Ee.AttackDeflected,t.position,qe,t.id);else{let g=a?op:ip;if(e.gender==="male"&&(g*=tw),e.isAdult||(g*=nw),(!t.isAdult||t.age>=np)&&e.isAdult&&(g*=iw),a){const S=s/sp;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+S,data:{attackerId:e.id,targetId:t.id,damage:g,pushbackForce:lp,attackerPosition:{...e.position}}}),Ge(i,Ee.StoneProjectile,e.position,S,void 0,t.position,t.id),Me(n,Ce.Attack,e.position)}else{t.hitpoints-=g,t.movementSlowdown={modifier:Au,endTime:i.time+Iu},Ge(i,Ee.Hit,t.position,qe,t.id);const S=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),v=At(S,Z_);t.forces.push(v),t.hitpoints<=0?Me(n,Ce.HumanDeath,t.position):Me(n,Ce.Attack,e.position),Ge(i,Ee.Attack,e.position,qe,e.id)}}e.attackCooldown={melee:vu,ranged:ap};const f=e.stateMachine[1];f.attackStartTime=i.time}},Zk={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:_t*2,checker:(e,t,{gameState:n})=>U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const i=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(i===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const a=(e.radius+t.radius-i)*.05,l=ot(O_(e.position,t.position)),c=At(l,a);e.forces.push(c),t.forces.push(At(c,-1))}},Qk={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:_t*.6+Ql*.4,checker:(e,t,{gameState:n})=>{var c;const i=(c=t.stateMachine)==null?void 0:c[0];if(i==="fallen"||i==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const c=l*2.5,u=ot(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=At(u,c);e.forces.push(f)}},Jk={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:_t*.6+Ql*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const c=l*2.5,u=ot(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=At(u,c);e.forces.push(f)}},eb={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:_t*.6+Ql*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const c=l*2.5,u=ot(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=At(u,c);e.forces.push(f)}},tb={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:ze,checker:(e,t,n)=>{var i;return e.isAdult&&t.food.length>0&&((i=e.stateMachine)==null?void 0:i[0])===pa&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Ge(n.gameState,Ee.BushClaimed,t.position,qe),Me(n,Ce.Gather,e.position)}},nb={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:ze,checker:(e,t,n)=>{var i;return e.isAdult&&t.food.length>0&&((i=e.stateMachine)==null?void 0:i[0])===pa&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,Me(n,Ce.Gather,e.position)}},ib={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:ze,checker:(e,t,n)=>{var i,s;return e.isAdult&&((i=t.stateMachine)==null?void 0:i[0])===Gt&&t.wood.length>0&&((s=e.stateMachine)==null?void 0:s[0])===pa&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const i=t.wood.pop();i&&(e.heldItem=i),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[lo,{enteredAt:n.gameState.time,previousState:Gt}]),Me(n,Ce.Gather,e.position)}},ob=[tb,nb,ib],rb={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:yn,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=qR,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+KR,Ge(n.gameState,Ee.BushClaimed,t.position,qe,e.id),Me(n,Ce.Gather,e.position))}},sb={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:ks,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=n1;const i=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=At(i,8);t.forces.push(s),e.huntCooldown=r1,t.hitpoints<=0?(Me(n,Ce.HumanDeath,t.position),Ge(n.gameState,Ee.Hit,t.position,qe,t.id)):(Ge(n.gameState,Ee.Hit,t.position,qe,t.id),t.fleeCooldown=5,Me(n,Ce.Attack,e.position)),Ge(n.gameState,Ee.Attack,e.position,qe,e.id)}},ab={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:Sn,checker:(e,t,n)=>{var g,m,S;if(((g=e.stateMachine)==null?void 0:g[0])!==Qo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=co,a=!s&&i<=Sn;if(!s&&!a||(s?((m=e.attackCooldown)==null?void 0:m.melee)||0:((S=e.attackCooldown)==null?void 0:S.ranged)||0)>0)return!1;const c=s?Su:rp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>co;let l=(a?op:ip)*1.2;if(e.gender==="male"&&(l*=1.3),a){const u=s/sp;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+u,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:lp,attackerPosition:{...e.position}}}),Ge(i,Ee.StoneProjectile,e.position,u,void 0,t.position,t.id),Me(n,Ce.Attack,e.position)}else{t.hitpoints-=l;const u=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),f=At(u,6);t.forces.push(f),t.hitpoints<=0?(Me(n,Ce.HumanDeath,t.position),Ge(i,Ee.Hit,t.position,qe,t.id)):(Ge(i,Ee.Hit,t.position,qe,t.id),t.fleeCooldown=8,Me(n,Ce.Attack,e.position)),Ge(i,Ee.Attack,e.position,qe,e.id)}e.attackCooldown={melee:vu,ranged:ap};const c=e.stateMachine[1];c.attackStartTime=i.time}},lb={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:gi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=BA;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:Au,endTime:n.gameState.time+Iu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=At(s,7);t.forces.push(a),e.attackCooldown=FA,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Ip),Me(n,Ce.HumanDeath,t.position),Ge(n.gameState,Ee.Hit,t.position,qe,t.id)):(Ge(n.gameState,Ee.Hit,t.position,qe,t.id),Me(n,Ce.Attack,e.position)),Ge(n.gameState,Ee.Attack,e.position,qe,e.id)}},cb={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:Sn,checker:(e,t,n)=>{var g,m,S;if(((g=e.stateMachine)==null?void 0:g[0])!==Qo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=co,a=!s&&i<=Sn;if(!s&&!a||(s?((m=e.attackCooldown)==null?void 0:m.melee)||0:((S=e.attackCooldown)==null?void 0:S.ranged)||0)>0)return!1;const c=s?Su:rp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>co;let l=(a?op:ip)*.8;e.gender==="male"&&(l*=1.2);const c=Object.values(i.entities.entities).filter(f=>f.type==="human"&&f.id!==e.id).filter(f=>{const g=f;return Math.sqrt(Math.pow(g.position.x-e.position.x,2)+Math.pow(g.position.y-e.position.y,2))<100&&g.activeAction==="attacking"&&g.attackTargetId===t.id}).length;if(c>0&&(l*=1+c*.2),a){const f=s/sp;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+f,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:lp,attackerPosition:{...e.position}}}),Ge(i,Ee.StoneProjectile,e.position,f,void 0,t.position,t.id),Me(n,Ce.Attack,e.position)}else{t.hitpoints-=l;const f=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),g=At(f,8);t.forces.push(g),t.hitpoints<=0?(Me(n,Ce.HumanDeath,t.position),Ge(i,Ee.Hit,t.position,qe,t.id)):(Ge(i,Ee.Hit,t.position,qe,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),Me(n,Ce.Attack,e.position)),Ge(i,Ee.Attack,e.position,qe,e.id)}e.attackCooldown={melee:vu,ranged:ap};const u=e.stateMachine[1];u.attackStartTime=i.time}},db={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:yn,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Ge(n.gameState,Ee.Procreation,i.position,qe,i.id),Me(n,Ce.Procreate,i.position)}},ub={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:Xo,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.pregnancyFatherId=e.gender==="male"?e.id:t.id,i.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Ge(n.gameState,Ee.Procreation,i.position,qe,i.id),Me(n,Ce.Procreate,i.position)}},fb={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:ma,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=eu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-eu),e.feedChildCooldownTime=UA,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ee.ChildFed,t.position,qe,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,Ce.ChildFed,t.position)}},hb={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:ma,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=eu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-eu),e.feedChildCooldownTime=UA,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ee.ChildFed,t.position,qe,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,Ce.ChildFed,t.position)}},gb={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:Xo,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-Ip),e.eatingCooldownTime=n.gameState.time+2,Ge(n.gameState,Ee.Eating,e.position,qe,e.id),Me(n,Ce.Gather,e.position))}},pb={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:gi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=BA;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:Au,endTime:n.gameState.time+Iu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=At(s,7);t.forces.push(a),e.attackCooldown=FA,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Ip),Me(n,Ce.HumanDeath,t.position),Ge(n.gameState,Ee.Hit,t.position,qe,t.id)):(Ge(n.gameState,Ee.Hit,t.position,qe,t.id),Me(n,Ce.Attack,e.position)),Ge(n.gameState,Ee.Attack,e.position,qe,e.id)}},mb={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:Zt,checker:(e,t,n)=>{var f,g;const i=t.buildingType===ce.StorageSpot,s=t.buildingType===ce.Bonfire;if(!i&&!s||((f=e.stateMachine)==null?void 0:f[0])!==_l||!t.isConstructed)return!1;const a=e.food.length>0,l=((g=e.heldItem)==null?void 0:g.type)===yt.Wood;if(s&&!l||!a&&!l)return!1;const c=t.storageCapacity??0;return!(t.storedItems.length>=c||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<vD)},perform:(e,t,n)=>{var s;let i=null;if(t.buildingType===ce.Bonfire?((s=e.heldItem)==null?void 0:s.type)===yt.Wood&&(i=e.heldItem,e.heldItem=void 0):e.heldItem?(i=e.heldItem,e.heldItem=void 0):i=e.food.pop()??null,i&&(t.storedItems.push({item:i,positionOffset:hI(t)}),t.buildingType===ce.Bonfire)){const a=xt(e,n.gameState);a&&a.aiBlackboard&&lI(a.aiBlackboard,t.id,"wood")}t.lastDepositTime=n.gameState.time,Me(n,Ce.StorageDeposit,t.position)}},yb={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:Zt,checker:(e,t,n)=>{var s;return!(t.buildingType!=="storageSpot"||((s=e.stateMachine)==null?void 0:s[0])!==wl||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<AD)},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&(e.food.push(i.item),hI(t)),t.lastRetrieveTime=n.gameState.time,Me(n,Ce.StorageRetrieve,t.position)}},Sb={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:Zt,checker:(e,t,n)=>{var c,u;if(t.buildingType!=="storageSpot"||((c=e.stateMachine)==null?void 0:c[0])!==pa||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const i=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!i||!((u=i.tribeControl)!=null&&u.diplomacy)||(t.ownerId?i.tribeControl.diplomacy[t.ownerId]:void 0)!==Ut.Hostile||n.gameState.time-(t.lastStealTime??0)<ID)return!1;const l=Nn({leaderId:t.ownerId},n.gameState);for(const f of l)if(U(e.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=TD)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&e.food.push(i.item),t.lastStealTime=n.gameState.time,Me(n,Ce.StorageSteal,t.position),Ge(n.gameState,Ee.Attack,t.position,.5)}},vb={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!Vt(e,t,n.gameState)||!gA(t.position,ea,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,SA(t.position,ea,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Ge(n.gameState,Ee.BushClaimed,t.position,2,t.id)}},Ab={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!Vt(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Ge(n.gameState,Ee.Hit,t.position,1,t.id)}},Ib={id:"supplyTransfer",sourceType:"human",targetType:"human",maxDistance:ze,checker:(e,t)=>!(e.activeAction!=="depositing"||t.activeAction!=="retrieving"||e.leaderId!==t.leaderId||e.food.length===0||t.food.length>=t.maxFood),perform:(e,t,n)=>{var l;const i=Math.min(((l=e.activeActionPayload)==null?void 0:l.amount)||1,e.food.length,t.maxFood-t.food.length),s=e.food.splice(0,i);t.food.push(...s);const a=xt(t,n.gameState);a&&a.aiBlackboard&&lI(a.aiBlackboard,t.id,"food"),e.activeAction="idle",e.target=void 0,e.activeActionPayload=void 0,t.activeAction="idle",t.target=void 0,Me(n,Ce.StorageDeposit,t.position)}},Tb={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:pu,checker:(e,t,n)=>{var a;const[i]=t.stateMachine??[],s=i===sn||i===Kt||i===vn;return e.isAdult&&s&&((a=e.stateMachine)==null?void 0:a[0])===Sp&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{var s;const{gameState:i}=n;if(t.stateMachine=[Gt,{enteredAt:i.time,previousState:(s=t.stateMachine)==null?void 0:s[0]}],!t.woodGenerated){const a=Math.min(1,t.age/Jo),l=Math.floor(pS+a*(Cu-pS));t.wood=Array.from({length:l},()=>({itemType:"item",type:yt.Wood,id:i.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=i.time+1,Me(n,Ce.Gather,e.position)}},Eb=[Zk,Qk,Jk,eb,...ob,Vk,Kk,qk,mb,yb,Sb,vb,Ab,Ib,Tb,rb,fb,hb,gb,sb,ab,cb,lb,pb,db,ub],Cb=Object.values(Eb.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;return e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]}),e[n].interactions.push(t),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));function _b(e){const{gameState:t}=e,n=t,{width:i,height:s}=t.mapDimensions;for(const a of Cb){const l=n.search[a.sourceType].all();for(const c of l){const u=n.search[a.targetType].byRadius(c.position,a.maxDistance);for(const f of u){if(c.id===f.id)continue;const g=U(c.position,f.position,i,s);for(const m of a.interactions)g<=m.maxDistance&&m.checker(c,f,e)&&m.perform(c,f,e)}}}}function pT(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function wb(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),i=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=50+Math.random()*100;a={x:Math.max(50,Math.min(Ke-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*g))}}else a={x:50+Math.random()*(Ke-100),y:50+Math.random()*(Qe-100)};let l=!0;const c=100;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){l=!1;break}if(l){for(const u of i)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){l=!1;break}}if(l)return a}return{x:Ke*.3+Math.random()*Ke*.4,y:Qe*.3+Math.random()*Qe*.4}}function Rb(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=100+Math.random()*150;a={x:Math.max(50,Math.min(Ke-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*g))}}else a={x:50+Math.random()*(Ke-100),y:50+Math.random()*(Qe-100)};let l=!0;const c=150;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){l=!1;break}if(l)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Ke,y:50+Math.random()*100};case 1:return{x:Ke-150+Math.random()*100,y:Math.random()*Qe};case 2:return{x:Math.random()*Ke,y:Qe-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Qe}}}function Pb(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let i=0;i<20;i++){const s={x:50+Math.random()*(Ke-100),y:50+Math.random()*(Qe-100)};let a=!0;const l=80,c=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<l){a=!1;break}if(a){for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){a=!1;break}}if(a)return s}return{x:Math.random()*Ke,y:Math.random()*Qe}}function mT(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=wb(n),a=i%2===0?"male":"female";sa(e.entities,s,a,void 0,void 0,$l())}}function yT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=Rb(n),a=i%2===0?"male":"female";aa(e.entities,s,a,void 0,void 0,xl())}}function Db(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count();let s=!1;return n===0&&(mT(e,6),s=!0),i===0&&(yT(e,3),s=!0),s}function Nb(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const l=Math.max(2,Math.floor(8-n));mT(e,l),a=!0}if(i>0&&i<2){const l=Math.max(1,Math.floor(3-i));yT(e,l),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let l=0;l<5;l++){const c=Pb(t);nc(e.entities,c,e.time)}a=!0}return a}const Mb=1,Ob=.3,kb=.8,av=.8,bb=.99,Bb=.05;var ST=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.NO_ACTION=14]="NO_ACTION",e))(ST||{});const ug=Object.keys(ST).length/2;class Fb{constructor(){De(this,"qTable",new Map);De(this,"epsilon",av);De(this,"lastState",null);De(this,"lastAction",null)}discretizeState(t,n,i){const s=Math.min(4,Math.floor(t/25)),a=Math.min(4,Math.floor(n/5)),l=Math.min(4,Math.floor(i/15));return`${s}-${a}-${l}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,i){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,i)}getBestAction(t){let n=0,i=this.getQValue(t,0);for(let s=1;s<ug;s++){const a=this.getQValue(t,s);a>i&&(i=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*ug):this.getBestAction(t)}applyEmergencyCorrections(t,n,i,s){t<no*.5&&(s.ecosystem.preyGestationPeriod=Math.max(Hs,s.ecosystem.preyGestationPeriod*.8),s.ecosystem.preyProcreationCooldown=Math.max(Gs,s.ecosystem.preyProcreationCooldown*.8),s.ecosystem.preyHungerIncreasePerHour=Math.max(Ws,s.ecosystem.preyHungerIncreasePerHour*.9)),n<io*.6&&(s.ecosystem.predatorGestationPeriod=Math.max($s,s.ecosystem.predatorGestationPeriod*.75),s.ecosystem.predatorProcreationCooldown=Math.max(xs,s.ecosystem.predatorProcreationCooldown*.75),s.ecosystem.predatorHungerIncreasePerHour=Math.max(Ys,s.ecosystem.predatorHungerIncreasePerHour*.85)),i<oo*.5&&(s.ecosystem.berryBushSpreadChance=Math.min(Sl,s.ecosystem.berryBushSpreadChance*1.2)),t>no*1.4&&(s.ecosystem.preyHungerIncreasePerHour=Math.min(Wo,s.ecosystem.preyHungerIncreasePerHour*1.05)),n>io*1.4&&(s.ecosystem.predatorHungerIncreasePerHour=Math.min(Yo,s.ecosystem.predatorHungerIncreasePerHour*1.05)),i>oo*1.4&&(s.ecosystem.berryBushSpreadChance=Math.max(ro,s.ecosystem.berryBushSpreadChance*.95))}calculateReward(t,n,i){const s=Math.abs(t-no),a=Math.abs(n-io),l=Math.abs(i-oo),c=s/no,u=a/io,f=l/oo,g=c+u+f;return 100*Math.exp(-g*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(Fr,n.ecosystem.preyGestationPeriod+.2*(Fr-Hs));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(Hs,n.ecosystem.preyGestationPeriod-.2*(Fr-Hs));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(Lr,n.ecosystem.preyProcreationCooldown+.2*(Lr-Gs));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max(Gs,n.ecosystem.preyProcreationCooldown-.2*(Lr-Gs));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(Wo,n.ecosystem.preyHungerIncreasePerHour+.2*(Wo-Ws));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(Ws,n.ecosystem.preyHungerIncreasePerHour-.2*(Wo-Ws));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(Ur,n.ecosystem.predatorGestationPeriod+.2*(Ur-$s));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max($s,n.ecosystem.predatorGestationPeriod-.2*(Ur-$s));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min(Hr,n.ecosystem.predatorProcreationCooldown+.2*(Hr-xs));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(xs,n.ecosystem.predatorProcreationCooldown-.2*(Hr-xs));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(Yo,n.ecosystem.predatorHungerIncreasePerHour+.2*(Yo-Ys));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(Ys,n.ecosystem.predatorHungerIncreasePerHour-.2*(Yo-Ys));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(Sl,n.ecosystem.berryBushSpreadChance+.2*(Sl-ro));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(ro,n.ecosystem.berryBushSpreadChance-.2*(Sl-ro));break}}updateQTable(t,n,i,s){const a=this.getQValue(t,n),l=Math.max(...Array.from({length:ug},(u,f)=>this.getQValue(s,f))),c=a+Ob*(i+kb*l-a);this.setQValue(t,n,c)}step(t){const n=t,i=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count();this.applyEmergencyCorrections(i,s,a,t);const l=this.discretizeState(i,s,a);if(this.lastState!==null&&this.lastAction!==null){const u=this.calculateReward(i,s,a);this.updateQTable(this.lastState,this.lastAction,u,l)}const c=this.chooseAction(l);this.applyAction(c,t),this.epsilon=Math.max(Bb,this.epsilon*bb),this.lastState=l,this.lastAction=c}reset(){this.qTable.clear(),this.epsilon=av,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let vT=new Fb;function Lb(e){Db(e),Nb(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=Hs+(Fr-Hs)*.3,e.ecosystem.preyProcreationCooldown=Gs+(Lr-Gs)*.3,e.ecosystem.preyHungerIncreasePerHour=Ws+(Wo-Ws)*.3,e.ecosystem.predatorGestationPeriod=$s+(Ur-$s)*.3,e.ecosystem.predatorProcreationCooldown=xs+(Hr-xs)*.3,e.ecosystem.predatorHungerIncreasePerHour=Ys+(Yo-Ys)*.3,e.ecosystem.berryBushSpreadChance=ro+(Sl-ro)*.7),vT.step(e)}function Ub(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<Mb)&&(e.ecosystem.lastUpdateTime=e.time,Lb(e))}function Hb(){return vT.getStats()}function Gb(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function $b(e){const{gameState:t}=e,n=t.time,i=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of i)switch(a.type){case"ranged-impact":{const l=t.entities.entities[a.data.targetId];if(!l||l.hitpoints<=0)continue;l.hitpoints-=a.data.damage,l.movementSlowdown={modifier:Au,endTime:t.time+Iu};const c=Xe(a.data.attackerPosition,l.position,t.mapDimensions.width,t.mapDimensions.height),u=At(c,a.data.pushbackForce);l.forces.push(u),Ge(t,Ee.Hit,l.position,qe,l.id),l.hitpoints<=0?Me(e,Ce.HumanDeath,l.position):Me(e,Ce.Attack,l.position);break}}}function xb(e){var a,l;const{gameState:t}=e,i=t.search.human.all(),s=new Set;for(const c of i)c.leaderId&&c.leaderId===c.id&&s.add(c.id);for(const c of s){const u=t.entities.entities[c];if(!u)continue;const f=Nn(u,t);if(f.length<Dp)continue;const g=f.filter(v=>v.isAdult);if(g.length===0)continue;const m=Object.values(t.tasks).filter(v=>v.creatorEntityId===c),S=v=>m.some(I=>I.type===v);if(!S(re.HumanPlaceStorage)){const v=Kr(c,t,!0),I=pp(c,t,!0);if(v.length===0||I>Ig){const C=v.length===0?Yv:qs,P=Zs(ce.StorageSpot,c,t,Zi,C,u.position);P&&Md(c,re.HumanPlaceStorage,P,t)}}if(!S(re.HumanPlaceBonfire)){const v=jr(c,t,!0),I=ni(c,t),C=er(t.temperature,I,t.time,t.mapDimensions.width,t.mapDimensions.height)<dA&&v.length===0,P=v.length>0&&v.length<Math.ceil(g.length/uA);let R;const w=f.filter(B=>er(t.temperature,B.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<so+5?v.every(M=>U(B.position,M.position,t.mapDimensions.width,t.mapDimensions.height)>br*1.5):!1);if(w.length>=3){const B=w.reduce((N,M)=>N+M.position.x,0)/w.length,O=w.reduce((N,M)=>N+M.position.y,0)/w.length;R={x:B,y:O}}if(C||P||R){const B=Zs(ce.Bonfire,c,t,Zi,qs,R||u.position);B&&Md(c,re.HumanPlaceBonfire,B,t)}}if(!S(re.HumanPlacePlantingZone)){const I=ql(c,t,!0).reduce((C,P)=>C+mp(P),0),A=Math.max(Us,g.length*Tg);if(I<A){const C=Zs(ce.PlantingZone,c,t,Zi,qs,u.position);C&&Md(c,re.HumanPlacePlantingZone,C,t)}}if(!S(re.HumanPlaceBorderPost)&&(((l=(a=u.tribeControl)==null?void 0:a.armyControl)==null?void 0:l.expandBorders)??0)>=2){const I=vA(u.position,c,t);I&&Md(c,re.HumanPlaceBorderPost,I,t)}}}function Md(e,t,n,i){const s=`${re[t]}-${e}-${i.time.toFixed(2)}`;i.tasks[s]={id:s,position:n,type:t,creatorEntityId:e,target:n,validUntilTime:i.time+12}}const Wb=1/60;function Yb(e,t){const n=vt(e);n&&(e.viewportCenter=Jg(e.viewportCenter,n.position,Qg*t))}function xu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(Lp(e),e.lastAutosaveTime=n)}for(;t>0;){const n=Bu(e),i=Math.min(t,Wb),s=i*(Ct/Dt);n.time+=s,Yb(n,i),uw(n),oM(n),Ub(n),dR(n),VP(n),fw(n),$b({gameState:n}),uO({gameState:n,deltaTime:i}),_b({gameState:n,deltaTime:i}),Math.floor(n.time)>Math.floor(n.time-s)&&(_O(n),xb({gameState:n})),pT(n),Lk(n,i),Gb(n),e=n,t-=i}return e}function fg(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,c=jA;if(e.beginPath(),e.moveTo(i+c,s),e.lineTo(i+a-c,s),e.quadraticCurveTo(i+a,s,i+a,s+c),e.lineTo(i+a,s+l-c),e.quadraticCurveTo(i+a,s+l,i+a-c,s+l),e.lineTo(i+c,s+l),e.quadraticCurveTo(i,s+l,i,s+l-c),e.lineTo(i,s+c),e.quadraticCurveTo(i,s,i+c,s),e.closePath(),e.fillStyle=t.isDisabled?XA:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*ZA)+1)/2;e.strokeStyle=qA,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<nu){const f=1-u/nu;e.fillStyle=KA,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Cp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?VA:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function zb(e,t,n,i){e.save(),e.font=`${vS}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,l=vS,c=a+AS*2,u=l+AS*2,f=i.x-c/2,g=e.canvas.height,m=t.y<g/2?t.y+t.height-IS:t.y-u+IS;e.fillStyle=uP,e.fillRect(f,m,c,u),e.fillStyle=fP,e.fillText(n,i.x,m+u/2+l/2),e.restore()}function jb(e,t,n){e.save();const i=vt(t),s=[{id:"fastForwardButton",action:le.FastForward,text:"FFWD [T]",currentWidth:to*1.3,backgroundColor:$o,textColor:Ht,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:le.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?Sd:$o,currentWidth:t.isPaused?to*1.4:to*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:Ht},{id:"muteButton",action:le.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?Sd:$o,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:to,rect:{x:0,y:0,width:0,height:0},textColor:Ht},{id:"returnToIntroButton",action:le.ReturnToIntro,text:"EXIT",backgroundColor:$o,tooltip:"Return to Main Menu [ESC]",currentWidth:to*.9,rect:{x:0,y:0,width:0,height:0},textColor:Ht}];if(t.uiButtons.push(...s),i){const f=Bp(t,i),g=new Set(f.map(R=>R.type));let m=[{playerAction:oe.Gather,buttonAction:le.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>i.isAdult===!0},{playerAction:oe.Eat,buttonAction:le.CommandEat,shortcut:"F",name:"Eat"},{playerAction:oe.Plant,buttonAction:le.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>i.isAdult===!0},{playerAction:oe.Procreate,buttonAction:le.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>i.isAdult===!0},{playerAction:oe.FeedChild,buttonAction:le.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>i.isAdult===!0},{playerAction:oe.Attack,buttonAction:le.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>i.isAdult===!0&&i.leaderId===i.id},{playerAction:oe.ArmyControl,buttonAction:le.OpenArmyControl,shortcut:"V",name:"Army Control",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Ui(i.id,t).length>mD},{playerAction:oe.TribeSplit,buttonAction:le.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>i.leaderId!==void 0&&i.leaderId!==i.id&&i.isAdult===!0},{playerAction:oe.Build,buttonAction:le.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Ui(i.id,t).length>Dp},{playerAction:oe.Build,buttonAction:le.OpenRoleManager,shortcut:"U",name:"Roles",toggleKey:"roleManagement",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Ru(i,t)}];m=m.filter(R=>R.condition?R.condition():!0);const S=1,v=m.length,I=v*Ln+(v-1)*vr,A=S*Ln+(S-1)*vr,C=(n-I)/2,P=e.canvas.height-A-20;if(m.forEach((R,w)=>{const B=w%v,O=Math.floor(w/v),N=C+B*(Ln+vr),M=P+O*(Ln+vr),F=!!R.toggleKey,W=F&&t.autopilotControls.behaviors[R.toggleKey],Z=!g.has(R.playerAction),j=R.playerAction===oe.Build&&t.buildMenuOpen,ie=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",se=F?`${R.name}${ie}`:R.name,_e=W||j||R.buttonAction===le.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)?Sd:$o,fe={id:`commandButton_${R.name}`,action:R.buttonAction,rect:{x:N,y:M,width:Ln,height:Ln},icon:R.buttonAction===le.OpenRoleManager?"":Nu[R.playerAction],text:R.shortcut,backgroundColor:_e,textColor:Ht,currentWidth:Ln,tooltip:se,isDisabled:Z,activated:W||R.buttonAction===le.CommandBuild&&j||R.buttonAction===le.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)};t.uiButtons.push(fe)}),t.buildMenuOpen){const R=[{id:"buildMenu_storageSpot",action:le.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:le.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_bonfire",action:le.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:le.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:le.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"}],w=R.length,B=w*Ln+(w-1)*vr,O=(n-B)/2,N=P-Ln-vr;R.forEach((M,F)=>{const W=O+F*(Ln+vr),Z=N,te=M.action===le.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||M.action===le.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||M.action===le.SelectBorderPost&&t.selectedBuildingType==="borderPost"||M.action===le.SelectBonfire&&t.selectedBuildingType==="bonfire"||M.action===le.SelectRemovalTool&&t.selectedBuildingType==="removal",j={id:M.id,action:M.action,rect:{x:W,y:Z,width:Ln,height:Ln},icon:M.icon,text:M.shortcut,backgroundColor:te?Sd:$o,textColor:Ht,currentWidth:Ln,tooltip:M.name,activated:te};t.uiButtons.push(j),fg(e,j,t.hoveredButtonId===j.id)})}}let a=n-et;s.forEach(f=>{const g=et,m=a-f.currentWidth;f.rect={x:m,y:g,width:f.currentWidth,height:zA},fg(e,f,t.hoveredButtonId===f.id),a-=f.currentWidth+dP});let l=null;t.uiButtons.filter(f=>f.id.startsWith("commandButton_")||f.id.startsWith("buildMenu_")).forEach(f=>{l||(l={x:f.rect.x,y:f.rect.y,width:f.rect.width,height:f.rect.height}),l.x=Math.min(l.x,f.rect.x),l.y=Math.min(l.y,f.rect.y),l.width=Math.max(l.width,f.rect.x+f.rect.width-l.x),l.height=Math.max(l.height,f.rect.y+f.rect.height-l.y),f.id.startsWith("commandButton_")&&fg(e,f,t.hoveredButtonId===f.id)});const u=t.hoveredButtonId?t.uiButtons.find(f=>f.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&zb(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:l}}function Xb(e){e.save(),e.fillStyle=IP,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=TP,e.font=`${EP}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function Kg(e,t,n,i){const s=t.x-n.width/2,a=t.y-n.height/2,l=s+e.x,c=a+e.y,u=(l%i.width+i.width)%i.width,f=(c%i.height+i.height)%i.height;return{x:u,y:f}}function oc(e,t,n,i){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>i.width/2&&(s=s-Math.sign(s)*i.width),Math.abs(a)>i.height/2&&(a=a-Math.sign(a)*i.height),{x:s+n.width/2,y:a+n.height/2}}function Vs(e,t,n,i){const s=oc(e.position,t,n,i),l=("radius"in e?e.radius:20)+20;return s.x>=-l&&s.x<=n.width+l&&s.y>=-l&&s.y<=n.height+l}function ei(e,t,n,i,s,...a){const l={...s.position};for(let c=-n;c<=n;c+=n)for(let u=-t;u<=t;u+=t)s.position.x=l.x+u,s.position.y=l.y+c,i(e,s,...a);s.position=l}function AT(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const i=n.getContext("2d");if(!i)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:n,ctx:i}}function Qs(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}const Vb=25,Kb=0,lv=28;function IT(e,t,n,i,s,a,l,c,u,f){e.save();const{x:g,y:m}=oc(t,l,{width:c,height:u},f);e.strokeStyle=i,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(g,m,n+_u,0,2*Math.PI),e.stroke(),e.restore()}function qb(e,t,n,i,s,a,l){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&IT(e,m.targetEntity.position,m.targetEntity.radius,Tp,Ep,2,i,s,a,l)}),e.font=`${ra}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:c,y:u}=oc(n.position,i,{width:s,height:a},l);let f=0,g={};t.forEach(m=>{const S=Nu[m.type];if(m.targetEntity){g[m.targetEntity.id]=(g[m.targetEntity.id]||0)+1;const v=m.targetEntity.position.x-i.x+s/2,I=m.targetEntity.position.y-i.y+a/2,A=`${S}${m.key.toUpperCase()}`,C=I-m.targetEntity.radius-_u-ra/2-(g[m.targetEntity.id]-1)*lv;e.fillText(A,v,C)}else{e.textAlign="left";const v=`${S}${m.key.toUpperCase()}`,I=c+Vb,C=u+Kb+f*lv;e.fillText(v,I,C),f++,e.textAlign="center"}}),e.restore()}const Le=(e,t,n,i,s,a,l)=>{a==="transparent"||i<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*l),Math.floor(n*l),Math.ceil(i*l),Math.ceil(s*l)))},cv=10,dv=10,Ri=6,Ki=4,Od=2,Zb=5,Jn=4,Qb=2,nn=4,Jb=2,ft=3,Ds=2,Go=0,kl=Go+Ki-1,fn=kl,Et=kl+Jn-1,eB="rgba(0, 0, 0, 0.4)",tB=4,nB=1,Yp={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,i,s,a,l,c="male",u=20,f=[1,0],g=!1,m=0){const S=["dead","stunned"].includes(l),v=S?dv+4:cv,I=S?cv+4:dv+ft,A=.15,C=Math.min(i*(1-2*A)/v,s*(1-2*A)/I),P=v*C,R=I*C,w=t+(i-P)/2,B=n+(s-R)/2;e.save(),f[0]<0&&!S?(e.translate(w+P,B),e.scale(-1,1)):e.translate(w,B);const N="#D09A5A",M=u>50?"#BDBDBD":"#281808",F="#7F5C4A",W="#6B4F3A",Z="#E0D8C0",te="#A0522D",j=1-Math.max(0,Math.min(100,m))/100*.2,ie=c==="male"?1.1:.9,se=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let _e=Zb*j*ie*se,fe=Qb*j*ie*se,ne=Jb*j*se;g&&c==="female"&&(_e*=1.5);const z=Math.round((v-_e)/2),V=Math.round((v-Ri)/2),K=z-fe,b=z+_e,Y=1,de=z+(_e/2-Y/2)-ne,pe=z+(_e/2+Y/2),Pe=f[1]<-.2&&Math.abs(f[0])<.7,me=ue=>{e.fillStyle=eB,e.beginPath();const Se=v/2,xe=ue;e.ellipse(Math.floor(Se*C),Math.floor(xe*C),Math.max(1,Math.floor(tB*C)),Math.max(1,Math.floor(nB*C)),0,0,2*Math.PI),e.fill()},Oe=(ue,Se)=>{c==="male"?(Le(e,z,kl+ue,_e,Jn-Ds,Se,C),Le(e,z,kl+Jn-Ds+ue,_e,Ds,F,C)):Le(e,z,kl+ue,_e,Jn,W,C)},Ne=(ue,Se)=>{Pe?Le(e,V,Go+ue,Ri,Ki,M,C):(Le(e,V,Go+ue,Ri,Ki,Se,C),Le(e,V,Go+ue,Ri,Od,M,C),c==="female"?(Le(e,V-1,Go+Od+ue,1,Ki,M,C),Le(e,V+Ri,Go+Od+ue,1,Ki,M,C)):Le(e,V+1,Go+2+ue,Ri-2,Ki-2,M,C))};switch(l){case"idle":{const ue=a*Math.PI*2,Se=Math.sin(ue)*.5,Ie=(Math.cos(ue*2)+1)*.25;me(Et+ft+1),Le(e,de+Se,Et+Ie,ne,ft,N,C),Le(e,pe-Se,Et+Ie,ne,ft,N,C),Oe(Ie,N),Le(e,K,fn+Ie,fe,nn,N,C),Le(e,b,fn+Ie,fe,nn,N,C),Ne(Ie,N);break}case"walk":{const ue=a*Math.PI*2,Se=Math.sin(ue)*2,Ie=Math.abs(Math.cos(ue))*1;me(Et+ft+1),Le(e,de+Se,Et+Ie,ne,ft,N,C),Le(e,pe-Se,Et+Ie,ne,ft,N,C),Oe(Ie,N),Le(e,K-Se,fn+Ie,fe,nn,N,C),Le(e,b+Se,fn+Ie,fe,nn,N,C),Ne(Ie,N);break}case"gathering":{const ue=a*Math.PI*2,Se=1,xe=(Math.sin(ue)+1)/2*2,Ie=Se+Math.abs(Math.cos(ue))*.5;me(Et+ft+1),Le(e,de,Et+Ie,ne,ft-Se,N,C),Le(e,pe,Et+Ie,ne,ft-Se,N,C),Oe(Ie,N),Le(e,K+1,fn+Ie-xe,fe,nn,N,C),Le(e,b-1,fn+Ie-xe,fe,nn,N,C),Ne(Ie,N);break}case"eat":{me(Et+ft+1),Le(e,de,Et+1,ne,ft-1,N,C),Le(e,pe,Et+1,ne,ft-1,N,C),Oe(1,N);const xe=(Math.sin(a*Math.PI*4)+1)/2,Ie=V+Ri/2,oi=Go+Ki/2,nt=b+(Ie-b)*xe,at=fn+1+(oi-(fn+1))*xe;Le(e,K,fn+1,fe,nn,N,C),Le(e,nt,at,fe,nn,N,C),Le(e,nt,at-1,1,1,te,C),Ne(1,N);break}case"procreate":{const ue=(Math.sin(a*Math.PI*8)+1)/4,Se=(Math.sin(a*Math.PI*6)+1)*.5,xe=1.5,Ie=xe-Se;me(Et+ft+1),Le(e,de,Et+Ie,ne,ft-xe,N,C),Le(e,pe,Et+Ie,ne,ft-xe,N,C),Oe(Ie,N),Le(e,K,fn+Ie,fe,nn,N,C),Le(e,b,fn+Ie,fe,nn,N,C),Ne(Ie,N),e.globalAlpha=ue,Oe(Ie,"white"),e.globalAlpha=1;break}case"attacking":{const ue=Math.sin(a*Math.PI)*1.5,Se=Math.abs(Math.sin(a*Math.PI));me(Et+ft+1),Le(e,de-ue,Et+Se,ne,ft,N,C),Le(e,pe+ue*.5,Et+Se,ne,ft,N,C),Oe(Se,N),Le(e,K,fn+Se-2,fe,nn,N,C),Le(e,b,fn+Se-2.5,fe,nn,N,C),Ne(Se,N);break}case"defending":{me(Et+ft+1),Le(e,de,Et+1,ne,ft-1,N,C),Le(e,pe,Et+1,ne,ft-1,N,C),Oe(1,N),Le(e,K-1,fn+1-1,fe,nn,N,C),Le(e,b+1,fn+1-1,fe,nn,N,C),Ne(1,N);break}case"stunned":case"dead":{const ue=l==="dead",Se=ue?Math.min(1,a):0,xe=Se>.5?Z:N,Ie=c==="male"?F:W,oi=Se>.8?"transparent":M,nt=v/2,at=I/2,mi=2;me(I-1),Le(e,nt-ne-mi,at,ne,ft,xe,C),Le(e,nt+mi,at,ne,ft,xe,C),Le(e,nt-fe-mi,at-Jn+1,fe,nn,xe,C),Le(e,nt+mi,at-Jn+1,fe,nn,xe,C);const In=nt-_e/2,Yn=at-Jn/2;c==="male"?(Se<.7&&Le(e,In,Yn+Jn-Ds,_e,Ds,Ie,C),Le(e,In,Yn,_e,Jn-Ds,xe,C)):Se<.7?Le(e,In,Yn,_e,Jn,Ie,C):Le(e,In,Yn,_e,Jn,xe,C);const yi=nt-Ri/2,Si=at-Jn/2-Ki+1;if(Le(e,yi,Si,Ri,Ki,xe,C),oi!=="transparent"&&Le(e,yi,Si,Ri,Od,oi,C),ue&&Se>.6){const fo="#B0A890";for(let or=0;or<3;or++)Le(e,In+1,Yn+or*1+1,_e-2,.5,fo,C)}break}default:Le(e,0,0,v,I,"magenta",C);break}e.restore()}};function iB(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function Vl(e,t,n,i,s,a=!1,l=!1,c=!1,u=!1){i<tp&&(n=n*.75),Yp.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,i,[0,0],!1,0);let f,g;a?(f=tP,g=$A):l?(f=nP,g=YA):c?(f=iP,g=WA):u&&(f=oP,g=xA),f&&g&&iB(e,t,n/2,f,g)}function oB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s,c=4;let u;const f=l+(i.length-1)*c;i.length>1&&f>a?u=(a-l)/(i.length-1):u=c,i.length<=1&&(u=0);for(let g=0;g<i.length;g++){const{member:m,isPlayer:S,isHeir:v,isPartner:I,isParent:A}=i[g],C=t+g*(s+u)+s/2,P=n+s/4;Vl(e,{x:C,y:P},s,m.age,m.gender,S,v,I,A)}e.restore()}function rB(e,t,n,i,s){if(n.length===0)return;e.save();const a=Ci,l=" 00",c=" 00";e.font=`${Kh}px "Press Start 2P", Arial`;const u=e.measureText(l).width,f=e.measureText(c).width,g=Ci+Zn+Ci+Zn+Ci+ko+u+Ci/2+ko+f,m=n.length*yd+(n.length-1)*yS,S=s-m-Ci;e.fillStyle=sP,e.fillRect(a,S,g,m);for(let v=0;v<n.length;v++){const I=n[v],A=S+v*(yd+yS),C=A+yd/2;I.isPlayerTribe&&(e.fillStyle=rP,e.fillRect(a,A,g,yd));let P=a+Ci;if(e.font=`${Zn}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillText(I.tribeBadge,P,C-Zn/4),P+=Zn+Ci,!I.isPlayerTribe){const R=I.diplomacyStatus===Ut.Friendly?"":"",w=`diplomacyButton_${I.leaderId}`,B={x:P-2,y:C-Zn/2-2,width:Zn+4,height:Zn+4},O={id:w,action:le.ToggleDiplomacy,rect:B,text:"",icon:R,backgroundColor:"transparent",textColor:"white",currentWidth:Zn,tooltip:`Toggle diplomacy with this tribe (Currently: ${I.diplomacyStatus})`,targetTribeId:I.leaderId};t.uiButtons.push(O),t.hoveredButtonId===w&&(e.fillStyle=Cp,e.globalAlpha=.5,e.fillRect(B.x,B.y,B.width,B.height),e.globalAlpha=1),e.font=`${Zn*.8}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="center",e.fillText(R,P+Zn/2,C)}P+=Zn+Ci,I.adultCount>0&&(Vl(e,{x:P+ko/2,y:C},ko,25,"male"),P+=ko/2,e.font=`${Kh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${I.adultCount}`,P,C),P+=e.measureText(` ${I.adultCount}`).width+Ci/2),I.childCount>0&&(Vl(e,{x:P+ko/2,y:C},ko,1,"female"),P+=ko/2,e.font=`${Kh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${I.childCount}`,P,C))}e.restore()}function sB(e,t,n,i,s){const a=tI,l=nI,c=t+i-a-l,u=n+l;e.save(),e.lineWidth=2,e.strokeStyle=s?kP:OP,e.beginPath();const f=5;e.moveTo(c+f,u+f),e.lineTo(c+a-f,u+a-f),e.moveTo(c+a-f,u+f),e.lineTo(c+f,u+a-f),e.stroke(),e.restore()}function aB(e,t,n,i){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===pn.INACTIVE)return;const l=a.steps[s.currentStepIndex];if(!l)return;e.save(),e.globalAlpha=s.transitionAlpha;const c=CP,u=_P,f=wP,g=`${Qh}px "Press Start 2P", Arial`,m=`${CS}px "Press Start 2P", Arial`,S=PP,v=CS*1.5;e.font=m;const I=l.text.split(" ");let A="";const C=[];for(let Z=0;Z<I.length;Z++){const te=A+I[Z]+" ";e.measureText(te).width>c-u*2&&Z>0?(C.push(A),A=I[Z]+" "):A=te}C.push(A);const P=u*2+Qh+u/2+C.length*v,R=(n-c)/2,w=i-P-160;e.fillStyle=RP,e.beginPath(),e.moveTo(R+f,w),e.lineTo(R+c-f,w),e.quadraticCurveTo(R+c,w,R+c,w+f),e.lineTo(R+c,w+P-f),e.quadraticCurveTo(R+c,w+P,R+c-f,w+P),e.lineTo(R+f,w+P),e.quadraticCurveTo(R,w+P,R,w+P-f),e.lineTo(R,w+f),e.quadraticCurveTo(R,w,R+f,w),e.closePath(),e.fill(),e.fillStyle=S,e.textAlign="center",e.textBaseline="top",e.font=g,e.fillText(l.title,R+c/2,w+u),e.font=m;let B=w+u+Qh+u/2;for(const Z of C)e.fillText(Z,R+c/2,B),B+=v;const O=t.hoveredButtonId==="tutorial-dismiss";sB(e,R,w,c,O),e.restore();const N=tI,M=nI,F=R+c-N-M,W=w+M;return{x:F,y:W,width:N,height:N}}function hg(e,t,n){e.save();const i=MP,s={x:t.x-i,y:t.y-i,width:t.width+i*2,height:t.height+i*2};e.strokeStyle=JA,e.lineWidth=eI+Math.sin(n*_p)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function lB(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const TT=10,cB=3,uv=TT*.7;function dB(e,t){const{position:n,food:i,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,TT,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),i.length>0){const a=Math.PI*2/Math.min(i.length,s);for(let l=0;l<i.length;l++){const c=l*a,u=n.x+uv*Math.cos(c),f=n.y+uv*Math.sin(c);e.beginPath(),e.arc(u,f,cB,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const fv=(e,t,n=70,i=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${i}%)`},uB=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[i,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${i}, ${s}%, ${Math.max(0,a-t)}%)`},kd=(e,t,n,i,s,a,l,c=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=c?uB(l,15):l,e.beginPath(),e.roundRect(-i/2,0,i,s,i/2),e.fill(),e.restore()},gg=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),i=75;if(!n)return`hsl(0, 0%, ${i}%)`;const[,s,a,l]=n.map(Number),c=a*(1-t),u=l+(i-l)*t;return`hsl(${s}, ${c}%, ${u}%)`},ET={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,i,s,a,l,c={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=i*.15,f=t+i/2,g=n+s/2,m=i-u*2,S=s-u*2,{gender:v,age:I,direction:A,isPregnant:C,hungryLevel:P,geneCode:R}=c,w=.8+Math.min(I,10)/10*.4,B=v==="male"?1.05:.95,O=1-P/100*.3,N=m*.5*O*w*B;let M=S*.3*w*B;const F=m*.15*w*B,W=N*.2,Z=S*.3,te=fv(R,0,30,50);let j=fv(R,8,50,40);if(I>45){const me=Math.min(1,(I-45)/15);j=gg(j,me)}e.translate(f,g),A[0]<0&&e.scale(-1,1);const ie=Math.sin(a*Math.PI*2),se=Math.cos(a*Math.PI*2),_e=Z+M*.2;if(l==="dead"){const me=Math.min(a,1);e.translate(0,S*.2),e.rotate(Math.PI/2);const Oe=gg(j,me),Ne=gg(te,me);e.globalAlpha=.5+me*.5,e.strokeStyle=Oe,e.lineWidth=W*.5,e.beginPath(),e.moveTo(-N*.4,0),e.lineTo(N*.4,0),e.stroke();for(let ue=-1;ue<=1;ue+=1)e.beginPath(),e.arc(0,0,M*.4,Math.PI*.4*ue-Math.PI*.2,Math.PI*.4*ue+Math.PI*.2),e.stroke();e.fillStyle=Ne,e.beginPath(),e.arc(N*.5,0,F,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(N*.55,0,F*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,_e,N*.7,N*.25,0,0,2*Math.PI),e.fill();let fe=0,ne=0,z=0,V=0,K=0,b=0;switch(l){case"idle":ne=ie*(S*.02),z=ie*.05,V=-ie*.05,K=-ie*.05,b=ie*.05;break;case"walk":ne=Math.abs(se)*(S*-.04),z=ie*.7,V=-ie*.7,K=-ie*.7,b=ie*.7;break;case"eat":fe=S*.1,ne=S*.05,fe+=ie*(S*.02);break;case"procreate":ne=S*.05;const me=(1-se)*-m*.05;e.translate(me,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}C&&v==="female"&&(M*=1.6);const Y=ne,de=Y-M*.2;kd(e,N*-.35,de,W,Z,K,j,!0),kd(e,N*.35,de,W,Z,b,j,!0),e.fillStyle=j,e.beginPath(),e.ellipse(0,Y,N/2,M/2,0,0,2*Math.PI),e.fill();const pe=N*.45,Pe=de+fe;e.fillStyle=te,e.beginPath(),e.arc(pe,Pe,F,0,Math.PI*2),e.fill(),A[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(pe+F*.3,Pe-F*.2,F*.15,0,Math.PI*2),e.fill()),kd(e,N*-.35,de,W,Z,z,j),kd(e,N*.35,de,W,Z,V,j),e.restore()}};function fB(e,t){let[n,i,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),i=Math.max(0,i-t),s=Math.max(0,s-t),`rgb(${n}, ${i}, ${s})`}function hB(e){const t=(e&16711680)>>16,n=(e&65280)>>8,i=e&255,s=`rgb(${t}, ${n}, ${i})`,a=fB(s,40),l=(e&255)%100+50,c=(e>>8&255)%100,u=(e>>16&255)%100,f=`rgb(${l}, ${c}, ${u})`,g=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:f,eyeColor:g}}const CT={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,i,s,a,l,c={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:f,direction:g,isPregnant:m,hungryLevel:S,geneCode:v}=c;e.save();const I=i*.15,A=Math.max(1,Math.floor((i-I*2)/10)),C=g[0]<0;e.translate(t+i/2,n+s/2),C&&e.scale(-1,1);const P=hB(v),R=.8+Math.min(f,20)/20*.4,w=u==="male"?1.05:.95,B=1-S/100*.25,O=R*w*B,N=Math.max(0,Math.min(1,(f-15)/5));e.filter=`grayscale(${N})`;const M=P.furColor,F=P.darkerFurColor,W=P.eyeColor,Z="#FFFFFF",te="#c75c5c",j="#E0E0E0",ie="#A0A0A0",se=s/2-2*A,_e=Math.sin(a*Math.PI*2),fe=Math.abs(_e);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,se,A*4,A,0,0,2*Math.PI),e.fill(),e.filter="none",l==="dead"){const nt=Math.min(1,a*2);e.save(),e.translate(0,se-A*3),e.rotate(-Math.PI/2);const at=(mi,In,Yn,yi,Si=!1)=>{e.fillStyle=Si?ie:j,e.fillRect(mi*A,In*A,Yn*A,yi*A)};nt<1&&(e.globalAlpha=1-nt,e.fillStyle=M,e.beginPath(),e.ellipse(0,0,A*3,A*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),nt>0&&(e.globalAlpha=nt,at(-1,-4,2,2),at(1,-3.5,1,1,!0),at(-.5,-2,1,5,!0),at(-2.5,-1,5,.5),at(-2.5,0,5,.5),at(-2.5,1,5,.5),at(-3,-2,-1,2,!0),at(3,-2,1,2),at(-3,2,-1,2,!0),at(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=M;let ne=0,z=0,V=0,K=[0,0,0,0];switch(l){case"idle":ne=_e*A*.1;break;case"walk":const nt=Math.sin(a*Math.PI*4);ne=Math.abs(nt)*-A*.5,K=[nt*A,-nt*A,-nt*A,nt*A];break;case"attacking":const at=Math.sin(a*Math.PI*4);z=A*2+at*A,V=A*2,ne=A;break;case"eat":V=A*3+fe*A,ne=A*1.5,e.fillStyle=te,e.fillRect(-A,se-A,A*2,A);break;case"procreate":ne=Math.sin(a*Math.PI*8)*A*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let In=0;In<5;In++){const Yn=(Math.random()-.5)*A*8,yi=se+(Math.random()-.5)*A*2;fe>.5&&e.fillRect(Yn,yi,A*.5,A*.5)}break}const b=A*3*O*(m?1.3:1),Y=A*5*O,de=-Y/1.5,pe=se-b-A*2.5+ne;e.fillStyle=M,e.beginPath(),e.moveTo(de-A*.5,pe+b*.5),e.quadraticCurveTo(de-A*3,pe-A,de-A*2+_e*A,pe+b+A),e.fill();const Pe=A*1.2*O,me=A*3*O,Oe=A*2.5*O,Ne=de+Y*.8,ue=de+Y*.2;e.fillStyle=F,e.fillRect(ue,se-Oe,Pe,Oe+K[2]),e.fillRect(Ne,se-me,Pe,me+K[0]),e.fillStyle=M,e.beginPath(),e.moveTo(de,pe+b),e.lineTo(de,pe+A),e.quadraticCurveTo(de+Y/2,pe,de+Y,pe+A),e.lineTo(de+Y,pe+b),e.fill(),e.fillStyle=M,e.fillRect(ue+A/2,se-Oe,Pe,Oe+K[3]),e.fillRect(Ne+A/2,se-me,Pe,me+K[1]);const Se=A*3.5*O,xe=de+Y-Se*.3+z,Ie=pe-Se*.3+V;e.fillStyle=M,e.beginPath(),e.arc(xe,Ie,Se/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(xe+Se*.4,Ie+Se*.2,A*1.5,A,0,0,Math.PI*2),e.fill(),g[1]>=0&&(e.fillStyle=W,e.fillRect(xe+A*.5,Ie-A*.5,A*.5,A*.5),l==="attacking"&&(e.fillStyle=Z,e.fillRect(xe+Se*.5,Ie+Se*.4,A,A*.4))),e.fillStyle=F,e.beginPath(),e.moveTo(xe-Se*.4,Ie-Se*.3),e.lineTo(xe,Ie-Se*.7),e.lineTo(xe,Ie-Se*.2),e.fill(),e.restore()}},gB=9;function pB(e,t){const{position:n,gender:i,age:s,decayProgress:a,food:l,radius:c,originalEntityType:u,geneCode:f}=t;if(e.save(),e.globalAlpha=1-a,u==="human"?Yp.render(e,n.x-c,n.y-c,c*2,c*2,a,"dead",i,s,[0,0],!1,0):u==="prey"?ET.render(e,n.x-c,n.y-c,c*2,c*2,a,"dead",{gender:i,age:s,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}):u==="predator"&&CT.render(e,n.x-c,n.y-c,c*2,c*2,a,"dead",{gender:i,age:s,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}),e.restore(),l.length>0){e.save(),e.font=`${gB}px Arial`,e.textAlign="center",e.textBaseline="middle";const g=_t*.9,m=Math.PI/qv*3;l.forEach((S,v)=>{const I=v*m,A=n.x+g*Math.cos(I)*Math.atan2(v,v),C=n.y+g*Math.sin(I)*Math.atan2(v,v),P=up[S.type];e.fillText(P,A,C)}),e.restore()}}function jo(e,t,n,i,s,a,l,c){e.save(),e.fillStyle=l,e.fillRect(t,n,i,s),e.fillStyle=c,e.fillRect(t,n,i*Math.max(0,a),s),e.restore()}function mB(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s;let c;l>a||l+(i.length-1)*4>a?c=(a-l)/(i.length-1):c=4,i.length===1&&(c=0);for(let u=0;u<i.length;u++){const f=up[i[u].type];e.fillText(f,t+u*(s+c),n)}e.restore()}function yB(e,t,n,i,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let l,c=_t/2;const u=Nu[a.action],f=_I[a.action],g=`${u} ${f}`;if("targetEntityId"in a){const m=t.entities.entities[a.targetEntityId];m&&(l=m.position,c=m.radius)}else"position"in a&&(l=a.position);if(l){IT(e,l,c,Tp,Ep,2,n,i,s,t.mapDimensions),e.save(),e.font=`${ra}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:S}=oc(l,n,{width:i,height:s},t.mapDimensions),v=S-c-_u-ra/2;e.fillText(g,m,v),e.restore()}}function SB(e,t,n,i,s){e.save();const a=(Math.sin(s*_p)+1)/2,l=n+_u+a*5;e.strokeStyle=Tp,e.lineWidth=2,e.setLineDash(Ep),e.beginPath(),e.arc(t.x,t.y,l,0,Math.PI*2),e.stroke(),e.setLineDash([]);const c=Nu[i],u=_I[i];if(c){e.font=`${ra*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const f=t.y-l-25;e.fillText(c,t.x,f),e.font=`${ra*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,f+25)}e.restore()}function vB(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(vt(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const l=t.entities.entities[n.targetEntityId];l&&(s=l.position,a=l.radius||(l.type==="building"?20:30))}if(s){const l=(c,u)=>{SB(c,u.position,a,n.action,t.time)};ei(e,t.mapDimensions.width,t.mapDimensions.height,l,{position:{...s}},s,a+30)}}}function hv(e,t,n,i,s,a,l=!0){const c=t.split(" ");let u="";const f=[];for(let g=0;g<c.length;g++){const m=u+c[g]+" ";e.measureText(m).width>s&&g>0?(f.push(u),u=c[g]+" "):u=m}if(f.push(u),l)for(let g=0;g<f.length;g++)e.fillText(f[g],n,i+g*a);return f.length*a}function AB(e){return 1-Math.pow(1-e,3)}function IB(e,t,n,i){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(l=>!l.isDismissed);if(s.length===0)return;e.save();let a=i-xP;for(const l of s){const c=n-Ad-Ar;e.font=`${Jh}px "Press Start 2P", Arial`;const u=c+Ar,f=Ad-Ar*2,g=hv(e,l.message,-9999,-9999,f,Jh*1.2,!1),m=Ar*2+g+_i,S=a-m,v=Date.now()-l.creationTime,I=Math.min(v/$P,1),A=AB(I),C=i,P=C+(S-C)*A;e.fillStyle=BP,e.beginPath(),e.roundRect(c,P,Ad,m,bP),e.fill(),e.fillStyle=FP,e.textBaseline="top",hv(e,l.message,u,P+Ar,f,Jh*1.2,!0);const R=P+m-_i-Ar/2,w=c+Ad-_i-Ar/2,B={x:w,y:R,width:_i,height:_i};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[l.id]=B);const O=t.hoveredButtonId===`notification-dismiss-${l.id}`;if(e.fillStyle=O?RS:LP,e.font=`${_i}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",B.x+B.width/2,B.y+B.height/2),l.targetEntityIds||l.targetPosition||l.targetArea||l.targetRadius){const F={x:w-_i-wS,y:R,width:_i,height:_i};t.notificationButtonRects&&(t.notificationButtonRects.view[l.id]=F);const W=t.hoveredButtonId===`notification-view-${l.id}`;e.fillStyle=W?RS:UP,e.font=`${_i*(W?1.5:1.2)}px Arial`,e.fillText("",F.x+F.width/2,F.y+F.height/2)}a-=m+wS}e.restore()}function TB(e){return e.length===0?0:e.reduce((n,i)=>n+i,0)/e.length}function pg(e,t,n,i,s,a,l,c){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(i,s,a,l),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(i,s,a,l);const u=TB(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,i+et,s+et+8);const f=Math.max(...n,1),g=n.map(m=>m/f*l);if(e.beginPath(),e.strokeStyle=c,e.lineWidth=2,g.length>1){e.moveTo(i,s+l-g[0]);for(let m=1;m<g.length;m++){const S=i+m/(g.length-1)*a,v=s+l-g[m];e.lineTo(S,v)}}else if(g.length===1){const m=s+l-g[0];e.moveTo(i,m),e.lineTo(i+a,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${f.toFixed(2)}ms`,i+a-et,s+et+8),e.restore()}function EB(e,t,n){const{performanceMetrics:i}=t;if(!i)return;const s=280,a=240,l=n-s-et,c=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(l,c,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(l,c,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=c+et+5;const f=l+et;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",f,u),u+=25,e.fillStyle="white",e.font="12px monospace";const g=CB(t);e.fillText(`FPS: ${g.toFixed(1)}`,f,u),u+=20;const m=s-et*2,S=45,v=10;pg(e,"Render",mg(t,"renderTime"),f,u,m,S,"#4CAF50"),u+=S+v,pg(e,"World Update",mg(t,"worldUpdateTime"),f,u,m,S,"#2196F3"),u+=S+v,pg(e,"AI Update",mg(t,"aiUpdateTime"),f,u,m,S,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",l+s/2,c+a-10),e.restore()}function CB(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(Ct/Dt);return t.history.filter(a=>n-a.bucketTime/(Ct/Dt)<1).length}function _B(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const l=Math.floor(a.bucketTime/(Ct/Dt));n.set(l,(n.get(l)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function mg(e,t){return _B(e.performanceMetrics.history,t)}function wB(e,t,n,i){const{debugCharacterId:s,time:a}=t,l=500,c=Math.min(i*.9,800),u=n-l-10,f=et+it*2;t.debugPanelRect={x:u,y:f,width:l,height:c},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(u,f,l,c),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(u,f,l,c),e.fillStyle="white",e.font="12px monospace",e.textAlign="left",e.textBaseline="top";let g=f+20;const m=u+15;if(e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Behavior Tree Debugger",m,g),g+=25,!s){e.fillStyle="#888",e.font="12px monospace",e.fillText("No character selected for debugging.",m,g),e.fillText("Click on a character to inspect behavior.",m,g+20),e.restore();return}const S=t.entities.entities[s];if(!S){e.fillStyle="#ff4444",e.font="12px monospace",e.fillText(`Character #${s} not found (might be dead).`,m,g),e.restore();return}if(!S.aiBlackboard){e.fillStyle="#ffaa44",e.font="12px monospace",e.fillText(`Character #${s} has no AI Blackboard.`,m,g),e.restore();return}e.fillStyle="white",e.font="12px monospace",e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,m,g),g+=20,RB(e,S,a,m,g,l-30,c-(g-f)-10,t),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '~' to toggle this debugger",u+l/2,f+c-10),e.restore()}function RB(e,t,n,i,s,a,l,c){var P,R;const u=t.aiBlackboard.nodeExecutionData,f=t.type==="human"?NI:t.type==="predator"?OI:t.type==="prey"?MI:null;if(!f)return;const g=((P=c.debugPanelScroll)==null?void 0:P.x)??0,m=((R=c.debugPanelScroll)==null?void 0:R.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-g,-m),e.font=`${hP}px Arial`,e.textAlign="left",e.textBaseline="top";const S=w=>{switch(w){case T.SUCCESS:return pP;case T.FAILURE:return mP;case T.RUNNING:return yP;case T.NOT_EVALUATED:case null:default:return SP}};let v=0;const I=(w,B)=>{if(!w.name||!u[w.name])return B;let O=B;const N=O+Zh>s+m&&O<s+l+m,M=u[w.name],F=i+(w.depth??0)*gP;let W=T.NOT_EVALUATED,Z=TS,te="";if(M){W=M.status,te=M.debugInfo;const ne=AP/Dt*Ct,z=n-M.lastExecuted,V=Math.max(0,1-z/ne);Z=b_(TS,vP,V),z>ta&&(W=T.NOT_EVALUATED)}const j=S(W),ie=` ${w.name}`+(te?`: ${te}`:""),se=e.measureText(ie).width,_e=al+ES,fe=F-i+8+se+_e;if(fe>v&&(v=fe),N&&(e.fillStyle=j,e.fillText("",F,O),e.fillStyle=Z,e.fillText(ie,F+8,O),M&&M.executionHistory.length>0)){const{executionHistory:ne}=M,z=QA/Dt*Ct,V=n,K=V-z,b=i+a-al-ES;let Y=b;const de=O+(Zh-vd)/2,pe=ne.filter(Ie=>Ie.time<K);let Pe=pe.length>0?pe[pe.length-1].status:null,me=K;const Oe=ne.filter(Ie=>Ie.time>=K&&Ie.time<=V),Ne=al/z;e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(b,de,al,vd);for(const Ie of Oe){const nt=(Ie.time-me)*Ne;nt>0&&(e.fillStyle=S(Pe),e.fillRect(Y,de,nt,vd),Y+=nt),Pe=Ie.status,me=Ie.time}n-me>ta&&(Pe=T.NOT_EVALUATED);const Se=(V-me)*Ne;e.fillStyle=S(Pe);const xe=b+al-Y;e.fillRect(Y,de,Math.min(Se,xe),vd)}if(O+=Zh,w.children)for(const ne of w.children)O=I(ne,O);else w.child&&(O=I(w.child,O));return O},C=I(f,s)-s;c.debugPanelContentSize={width:v,height:C},e.restore()}function fu(e,t,n,i,s,a,l){e.save();const{position:c}=t;e.strokeStyle=i,e.lineWidth=s+Math.sin(l*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(c.x,c.y,n,0,2*Math.PI),e.stroke(),e.restore()}function PB(e,t,n,i){if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;const a=xt(s,t);if(!a||!a.aiBlackboard)return;const l=ir(a.aiBlackboard),c=500,u=Math.min(i*.9,700),f=n-c-10,g=et+it*2;t.debugPanelRect={x:f,y:g,width:c,height:u},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(f,g,c,u),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(f,g,c,u),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";const m=14,S=f+15;let v=g+20;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Supply Chain Debugger",S,v),v+=25,e.fillStyle="#aaaaaa",e.font="11px monospace",e.fillText(`Tribe Leader: ${a.isPlayer?"Player":"#"+a.id}`,S,v),v+=m,e.fillText(`Current Time: ${t.time.toFixed(1)}h`,S,v),v+=20;const I=v,A=u-(I-g)-30;DB(e,t,l,S,I,c-30,A,m),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+4' to toggle this debugger",f+c/2,g+u-10),e.restore()}function DB(e,t,n,i,s,a,l,c){var I,A;const u=((I=t.debugPanelScroll)==null?void 0:I.x)??0,f=((A=t.debugPanelScroll)==null?void 0:A.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-u,-f);let g=s;e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(` Active Demands (${n.length})`,i,g),g+=18,n.length===0?(e.fillStyle="#888888",e.font="11px monospace",e.fillText("No active demands",i,g),g+=c):[...n].sort((P,R)=>R.updatedAt-P.updatedAt).forEach((P,R)=>{const w=t.entities.entities[P.requesterId];let B=w?w.isPlayer?"Player":`Human #${w.id}`:`Unknown #${P.requesterId}`;w&&(B+=` (Food: ${w.food.length}), Active action: ${w.activeAction||"idle"}`);let O="None";if(P.claimedBy){const W=t.entities.entities[P.claimedBy];O=W?W.isPlayer?"Player":`Human #${W.id}`:`Unknown #${P.claimedBy}`,W&&(O+=" (Food: "+W.food.length+"), Active action: "+(W.activeAction||"idle")+")")}const N=t.time-P.updatedAt,M=g,F=c*5+10;e.fillStyle=P.claimedBy?"rgba(50, 100, 50, 0.3)":"rgba(50, 50, 50, 0.3)",e.fillRect(i-5,M-2,a,F),e.strokeStyle=P.claimedBy?"#44ff44":"#666666",e.lineWidth=1,e.strokeRect(i-5,M-2,a,F),e.fillStyle="#ffaa00",e.font="bold 12px monospace",e.fillText(`#${R+1}`,i,g),g+=c,e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Requester: ${B}`,i+10,g),g+=c,e.fillStyle="#ffff88",e.fillText(`Resource: ${P.resourceType}`,i+10,g),g+=c,e.fillStyle=P.claimedBy?"#44ff44":"#ff8844",e.fillText(`Status: ${P.claimedBy?"Claimed":"Pending"}`,i+10,g),g+=c,P.claimedBy?(e.fillStyle="#aaffaa",e.fillText(`Mover: ${O}`,i+10,g)):(e.fillStyle="#888888",e.fillText(`Mover: ${O}`,i+10,g)),g+=c,e.fillStyle="#aaaaaa",e.font="10px monospace",e.fillText(`Updated: ${N.toFixed(1)}h ago`,i+10,g),g+=c+5}),g+=10,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Statistics",i,g),g+=18;const m=n.filter(C=>!C.claimedBy).length,S=n.filter(C=>C.claimedBy).length;e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Total Demands: ${n.length}`,i,g),g+=c,e.fillStyle="#ff8844",e.fillText(`Pending: ${m}`,i,g),g+=c,e.fillStyle="#44ff44",e.fillText(`Claimed: ${S}`,i,g),g+=c;const v=g-s;t.debugPanelContentSize={width:a,height:v},e.restore()}function NB(e,t,n){if(!n.debugCharacterId)return;const i=n.search.human.byProperty("id",n.debugCharacterId)[0];if(!i)return;const s=xt(i,n);if(!s||!s.aiBlackboard||s.id!==t.leaderId)return;ir(s.aiBlackboard).some(l=>l.requesterId===t.id)&&fu(e,t,t.radius+15,"#ff6644",3,2,n.time),t.tribeRole===ee.Mover&&fu(e,t,t.radius+15,"#44ff44",3,2,n.time)}const MB={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"};function OB(e,t){var c;const{radius:n,position:i,activeAction:s="idle"}=t,a=((c=t.stateMachine)==null?void 0:c[0])||"N/A",l=t.isAdult?_t+20:_t*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,i.x,i.y-l+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function kB(e,t,n,i,s){e.save(),e.font=`${Ml}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(i?_t:ya)-Ml-s),e.restore()}function bB(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function BB(e,t,n){var c,u;const{position:i,radius:s}=t,a=i.x-qh/2,l=i.y-s-aP;if(((c=t.stateMachine)==null?void 0:c[0])===Qo){const f=t.stateMachine[1],g=n-f.attackStartTime,m=Math.min(g/Su,1);jo(e,a,l,qh,SS,m,zo,lP)}else if((u=t.attackCooldown)!=null&&u.melee&&t.attackCooldown.melee>0){const f=1-t.attackCooldown.melee/vu;jo(e,a,l,qh,SS,f,zo,cP)}}function FB(e,t,n=!1,i=!1,s=!1,a=!1,l=!1,c=!1,u=!1,f){var P,R;const{position:g,activeAction:m="idle"}=t,S=t.isAdult?_t:_t*.6,v=MB[m]||"idle";Yp.render(e,g.x-S,g.y-S,S*2,S*2,t.animationProgress||0,v,t.gender,t.age,[t.direction.x,t.direction.y],t.isPregnant??!1,t.hunger),c&&(e.save(),e.strokeStyle=x1,e.lineWidth=2,e.beginPath(),e.arc(g.x,g.y,S+3,0,2*Math.PI),e.stroke(),e.restore());let I,A;if(l?(I=Y1,A=YA):n?(I=W1,A=$A):s?(I=z1,A=$1):i?(I=j1,A=xA):a&&(I=X1,A=WA),I&&A&&bB(e,g,S,I,A),(P=t.tribeInfo)!=null&&P.tribeBadge&&kB(e,g,t.tribeInfo.tribeBadge,t.isAdult??!1,I??0),t.heldItem){const w=hp[t.heldItem.type],B=(R=t.tribeInfo)!=null&&R.tribeBadge?Ml:0;e.save(),e.font=`${Ml}px Arial`,e.textAlign="center",e.textBaseline="middle";const O=g.y-(t.isAdult?_t:ya)-Ml-(I??0)-B;e.fillText(w,g.x,O),e.restore()}const C=u&&(f.debugCharacterId===void 0||t.id===f.debugCharacterId);BB(e,t,f.time),C&&OB(e,t),f.debugPanel===je.SupplyChain&&NB(e,t,f)}const LB={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"};function UB(e,t){var c;const{radius:n,position:i,activeAction:s="idle"}=t,a=((c=t.stateMachine)==null?void 0:c[0])||"N/A",l=t.isAdult?_t+20:_t*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function HB(e,t,n=!1,i){var f,g;const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,c=LB[a]||"idle";if(ET.render(e,s.x-l,s.y-l,l*2,l*2,t.animationProgress||0,c,{gender:t.gender,age:t.age,direction:[((f=t.direction)==null?void 0:f.x)||1,((g=t.direction)==null?void 0:g.y)||0],isPregnant:t.isPregnant??!1,hungryLevel:t.hunger,geneCode:t.geneCode}),t.hitpoints<t.maxHitpoints){const m=l*1.5,S=3,v=s.x-m/2,I=s.y-l-8;e.fillStyle="#555",e.fillRect(v,I,m,S);const A=t.hitpoints/t.maxHitpoints;e.fillStyle=A>.5?"#4CAF50":A>.25?"#FFC107":"#F44336",e.fillRect(v,I,m*A,S)}n&&(i===void 0||t.id===i)&&UB(e,t)}const GB={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"};function $B(e,t){var c;const{radius:n,position:i,activeAction:s="idle"}=t,a=((c=t.stateMachine)==null?void 0:c[0])||"N/A",l=t.isAdult?_t+20:_t*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function xB(e,t,n=!1,i){var f,g;const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,c=GB[a]||"idle";if(CT.render(e,s.x-l,s.y-l,l*2,l*2,t.animationProgress||0,c,{gender:t.gender,age:t.age,direction:[((f=t.direction)==null?void 0:f.x)||1,((g=t.direction)==null?void 0:g.y)||0],isPregnant:t.isPregnant??!1,hungryLevel:t.hunger,geneCode:t.geneCode}),t.hitpoints<t.maxHitpoints){const m=l*1.5,S=3,v=s.x-m/2,I=s.y-l-8;e.fillStyle="#555",e.fillRect(v,I,m,S);const A=t.hitpoints/t.maxHitpoints;e.fillStyle=A>.5?"#4CAF50":A>.25?"#FFC107":"#F44336",e.fillRect(v,I,m*A,S)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,l+3,0,2*Math.PI),e.stroke()),n&&(i===void 0||t.id===i)&&$B(e,t)}const _T=15;function WB(e,t,n,i,s=1.5){const a=n-t.startTime,l=Math.min(a/t.duration,1),c=1-l,f=1+Math.sin(l*Math.PI*2)*(s-1),g=_T*f;e.save(),e.globalAlpha=c,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,g),0,Math.PI*2),e.fillStyle=i,e.fill(),e.restore()}function ul(e,t,n,i,s=2){const a=n-t.startTime,l=Math.min(a/t.duration,1),c=1-l,u=_T*2*l;e.save(),e.globalAlpha=c,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=i,e.lineWidth=s,e.stroke(),e.restore()}function Vi(e,t,n,i){const s=n-t.startTime,a=Math.min(s/t.duration,1),l=1-a,c=-20*a;e.save(),e.globalAlpha=l,e.font="20px Arial",e.textAlign="center",e.fillText(i,t.position.x,t.position.y+c),e.restore()}function YB(e,t,n,i){const{width:s,height:a}=i.mapDimensions;let l=t.targetPosition;if(t.targetEntityId){const A=i.entities.entities[t.targetEntityId];A&&(l=A.position)}if(!l)return;const c=n-t.startTime,u=Math.min(c/t.duration,1);let f=l.x-t.position.x,g=l.y-t.position.y;f=f-Math.round(f/s)*s,g=g-Math.round(g/a)*a;const m={x:f,y:g},S=t.position.x+m.x*u,v=t.position.y+m.y*u,I=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(S,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(S,v+I),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function wT(e,t,n,i){switch(t.type){case Ee.Procreation:Vi(e,t,n,"");break;case Ee.Pregnant:WB(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Ee.TargetAcquired:ul(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Ee.Attack:Vi(e,t,n,"");break;case Ee.Partnered:Vi(e,t,n,"");break;case Ee.BushClaimed:ul(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Ee.BushClaimLost:ul(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Ee.Eating:Vi(e,t,n,"");break;case Ee.ChildFed:Vi(e,t,n,"");break;case Ee.AttackDeflected:Vi(e,t,n,"");break;case Ee.AttackResisted:Vi(e,t,n,"");break;case Ee.Hit:Vi(e,t,n,"");break;case Ee.SeizeBuildup:ul(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Ee.BorderClaim:Vi(e,t,n,"");break;case Ee.Seize:ul(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Ee.StoneProjectile:YB(e,t,n,i);break}}const gv=8,zB=1.5,jB=.5,pv=2,XB="#5a5a5a",VB="#7e7e7e",KB="#8B0000",qB="#FF4444",ZB=6,wr=new Map,QB=200,mv=20;function JB(e,t,n=!1,i=!0){if(n)return`ghost_${e.buildingType}_${i}`;const s=e,a=s.buildingType===ce.Bonfire&&(s.fuelLevel??0)>0;return`${s.id}_${s.buildingType}_${s.width}_${s.height}_${t}_${s.isConstructed}_${a}`}function RT(e,t,n=!1,i=!0){const s=JB(e,t,n,i),a=wr.get(s);if(a)return wr.delete(s),wr.set(s,a),a;const{buildingType:l,width:c,height:u,id:f}=e,g=tr[l],m="isConstructed"in e?e.isConstructed:!0,S=c+mv*2,v=u+mv*2,{canvas:I,ctx:A}=AT(S,v);if(A.translate(S/2,v/2),n){const C=i?"#4CAF50":"#F44336";yg(A,c,u,9999,C),A.font=`${Math.min(c,u)*.5}px Arial`,A.textAlign="center",A.textBaseline="middle",A.fillStyle=C,A.fillText(g.icon,0,0)}else{const C=e;let P=g.icon;C.buildingType===ce.Bonfire&&m&&(P=(C.fuelLevel??0)>0?"":""),t?yg(A,c,u,f,KB,qB):yg(A,c,u,f),A.globalAlpha=.5,A.font=`${Math.min(c,u,30)*.5}px Arial`,A.textAlign="center",A.textBaseline="middle",A.shadowColor="rgba(0,0,0,0.5)",A.shadowBlur=4,A.fillStyle="#FFFFFF",A.fillText(P,0,0)}if(wr.size>=QB){const C=wr.keys().next().value;C&&wr.delete(C)}return wr.set(s,I),I}function yg(e,t,n,i,s,a){const l=(t+n)*2,c=Math.floor(l/gv),u=-t/2,f=t/2,g=-n/2,m=n/2;for(let S=0;S<c;S++){const v=i+S*13,I=Qs(v),A=Qs(v+1);let C=S*gv,P=0,R=0;C<t?(P=u+C,R=g):C<t+n?(P=f,R=g+(C-t)):C<t*2+n?(P=f-(C-(t+n)),R=m):(P=u,R=m-(C-(t*2+n)));const w=(A-.5)*pv,B=(Qs(v+2)-.5)*pv;e.beginPath();const O=zB+I*jB;s?e.fillStyle=s:e.fillStyle=I>.5?a||VB:s||XB,e.ellipse(P+w,R+B,O,O*.85,A*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function eF(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:i}=t;e.save(),e.font=`${ZB}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,i.forEach(s=>{const a=s.item.type,l=(up[a]||hp[a])??"?",c={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(l,c.x,c.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function tF(e,t,n){const{position:i,width:s,height:a,constructionProgress:l,destructionProgress:c,isConstructed:u,isBeingDestroyed:f}=t,g=vt(n),m=!!(g&&Vt(g,t,n)),S=RT(t,m);e.save(),u||(e.globalAlpha=.3+l*.7),e.drawImage(S,i.x-S.width/2,i.y-S.height/2),e.restore();const v=s,I=i.x-v/2,A=i.y+a/2+mw;u?f&&jo(e,I,A,v,nS,1-c,zo,pw):jo(e,I,A,v,nS,l,zo,gw),(t.buildingType===ce.StorageSpot||t.buildingType===ce.Bonfire)&&u&&eF(e,t)}function nF(e,t,n,i,s){const a=tr[n],{width:l,height:c}=a.dimensions,u=RT({buildingType:n,width:l,height:c,id:9999},!1,!0,i),f=(m,S)=>{m.save(),m.globalAlpha=hw,m.drawImage(u,S.x-u.width/2,S.y-u.height/2),m.restore()},g={position:{...t},radius:Math.max(l,c)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[]};ei(e,s.width,s.height,(m,S)=>f(m,S.position),g)}const Fs=1,iF=20,fi=4,yv=8,oF="rgba(34, 85, 34, 0.25)",rF="rgba(139, 50, 50, 0.25)",Js=new Map,sF=50;function aF(e,t){return e.map(n=>n.id).sort((n,i)=>n-i).join(",")+`_${t}`}function lF(){if(Js.size>sF){const e=Js.keys().next().value;e&&Js.delete(e)}}function cF(e){const t=new Map;for(const n of e){const i=n.ownerId;i&&(t.has(i)||t.set(i,[]),t.get(i).push(n))}return t}function dF(e,t,n,i){let s=0;const a=Math.max(i.width,i.height)/2;for(const l of n){const c=e-l.position.x,u=t-l.position.y,f=c*c+u*u;f>0?s+=a*a/f:s+=100}return s}function uF(e,t,n){let i=1/0,s=1/0,a=-1/0,l=-1/0;for(const c of e)i=Math.min(i,c.position.x-t.width/2),s=Math.min(s,c.position.y-t.height/2),a=Math.max(a,c.position.x+t.width/2),l=Math.max(l,c.position.y+t.height/2);return{minX:i-n,minY:s-n,maxX:a+n,maxY:l+n}}function fF(e,t,n,i){const s=aF(e,i);if(Js.has(s))return Js.get(s);const a=n.maxX-n.minX,l=n.maxY-n.minY,c=Math.ceil(a/fi),u=Math.ceil(l/fi),f=[],g=[];for(let v=0;v<u;v++)f[v]=new Array(c);for(let v=0;v<u;v++)for(let I=0;I<c;I++){const A=n.minX+I*fi,C=n.minY+v*fi,P=dF(A,C,e,t);f[v][I]=P}for(let v=1;v<u-1;v++)for(let I=1;I<c-1;I++)if(f[v][I]>=Fs&&(f[v-1][I]<Fs||f[v+1][I]<Fs||f[v][I-1]<Fs||f[v][I+1]<Fs)){const C=n.minX+I*fi,P=n.minY+v*fi;g.push({x:C,y:P})}const m=pF(g),S={fieldValues:f,edgePoints:g,regions:m,bounds:n};return Js.set(s,S),lF(),S}function hF(e,t,n,i,s,a){if(t.length===0)return;const{bounds:l}=a,c=10;if(!a.canvas){const u=l.maxX-l.minX+c*2,f=l.maxY-l.minY+c*2,{canvas:g,ctx:m}=AT(u,f);m.translate(-l.minX+c,-l.minY+c);const{fieldValues:S,regions:v}=a;gF(m,S,l,i);let I=s;for(const A of v){const C=mF(A);yF(m,C,i,I),I+=1e3}a.canvas=g}e.save(),e.globalAlpha=1,e.drawImage(a.canvas,l.minX-c,l.minY-c),e.restore()}function gF(e,t,n,i){const s=i?rF:oF;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++)if(t[a][l]>=Fs){const c=n.minX+l*fi,u=n.minY+a*fi;e.rect(c,u,fi,fi)}e.fill(),e.restore()}function pF(e){if(e.length===0)return[];const t=fi*2,n=t,i=new Map;function s(f,g){const m=Math.floor(f/n),S=Math.floor(g/n);return`${m},${S}`}for(let f=0;f<e.length;f++){const g=s(e[f].x,e[f].y);i.has(g)||i.set(g,[]),i.get(g).push(f)}function a(f,g){const m=[],S=Math.floor(f/n),v=Math.floor(g/n);for(let I=-1;I<=1;I++)for(let A=-1;A<=1;A++){const C=`${S+I},${v+A}`,P=i.get(C);P&&m.push(...P)}return m}const l=new Set,c=[],u=t*t;for(let f=0;f<e.length;f++){if(l.has(f))continue;const g=[],m=[f];for(;m.length>0;){const S=m.shift();if(l.has(S))continue;l.add(S),g.push(e[S]);const v=a(e[S].x,e[S].y);for(const I of v){if(l.has(I))continue;const A=e[I].x-e[S].x,C=e[I].y-e[S].y;A*A+C*C<=u&&m.push(I)}}g.length>0&&c.push(g)}return c}function mF(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const i=t[t.length-1];let s=0,a=1/0;for(let l=0;l<n.length;l++){const c=n[l].x-i.x,u=n[l].y-i.y,f=c*c+u*u;f<a&&(a=f,s=l)}t.push(n.splice(s,1)[0])}return t}function yF(e,t,n,i){if(t.length===0)return;let s=0,a=0;for(let l=1;l<t.length;l++){const c=t[l-1],u=t[l],f=u.x-c.x,g=u.y-c.y,m=Math.sqrt(f*f+g*g);for(s+=m;s>=yv;){s-=yv;const S=1-s/m,v=c.x+f*S,I=c.y+g*S;SF(e,v,I,n,i+a*13),a++}}}function SF(e,t,n,i,s){const a=Qs(s),l=Qs(s+1),c=(l-.5)*2,u=(Qs(s+2)-.5)*2;e.beginPath();const f=1.5+a*.5;i?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+c,n+u,f,f*.85,l*Math.PI,0,Math.PI*2),e.fill(),i||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function vF(e,t,n,i){var m,S,v;const s=t;if(!((m=s.search)!=null&&m.building))return;const l=s.search.building.all().filter(I=>I.buildingType===ce.PlantingZone&&I.isConstructed);if(l.length===0)return;const c=l.filter(I=>Vs(I,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(c.length===0)return;const u=tr[ce.PlantingZone].dimensions,f=cF(c),g=i?t.entities.entities[i]:void 0;for(const[I,A]of f){const C=((v=(S=g==null?void 0:g.tribeControl)==null?void 0:S.diplomacy)==null?void 0:v[I])==="Hostile",P=typeof I=="number"?I:0,R=uF(A,u,iF),w=fF(A,u,R,C);hF(e,A,u,C,P,w)}}const AF=.001,IF=.05,TF=12;function EF(e,t,n){const{position:i,age:s,swayOffset:a}=t,[l]=t.stateMachine??[],c=Math.min(1,Math.max(.4,s/Jo)),f=l!==Gt&&l!==lo?Math.sin(n*AF+a)*IF:0;if(e.save(),e.translate(i.x,i.y),e.scale(c,c),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=D1,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),l===lo?Sg(e,10,8):l===Gt?(e.rotate(Math.PI/2),Sg(e,10,30),e.translate(0,-25),Sv(e,40,20,40,15)):(e.rotate(f),Sg(e,10,30),e.translate(0,-25),e.rotate(f*.5),Sv(e,40,20,40,15)),e.restore(),(l===Gt||l===lo)&&t.wood&&t.wood.length>0){e.save(),e.font=`${TF}px Arial`,e.textAlign="center",e.textBaseline="middle";const g=t.radius*1.1,m=Math.PI*2/(Cu-1);t.wood.forEach((S,v)=>{const I=v===0?0:g,A=v===0?0:(v-1)*m,C=i.x+I*Math.cos(A),P=i.y+I*Math.sin(A),R=hp[S.type];e.fillText(R,C,P)}),e.restore()}}function Sg(e,t,n){e.fillStyle=C1,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=_1,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function Sv(e,t,n,i,s){e.fillStyle=w1,vv(e,t+4,n+4,i+2,s+2),e.translate(0,-2),e.fillStyle=R1,vv(e,t,n,i,s),e.fillStyle=P1,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function vv(e,t,n,i,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-i),e.lineTo(0,-i-s),e.lineTo(n/2,-i),e.lineTo(t/2,0),e.closePath(),e.fill()}let Fo=null;function CF(e,t,n,i,s){const a=XP(t.time);if(a<=0)return;Fo||(Fo=document.createElement("canvas")),(Fo.width!==i.width||Fo.height!==i.height)&&(Fo.width=i.width,Fo.height=i.height);const l=Fo.getContext("2d");if(l){l.clearRect(0,0,i.width,i.height),l.fillStyle=`rgba(0, 0, 40, ${a*.85})`,l.fillRect(0,0,i.width,i.height),l.globalCompositeOperation="destination-out";for(const c of s){const u=oc(c.position,n,i,t.mapDimensions),f=l.createRadialGradient(u.x,u.y,0,u.x,u.y,c.radius);f.addColorStop(0,`rgba(255, 255, 255, ${c.intensity})`),f.addColorStop(1,"rgba(255, 255, 255, 0)"),l.fillStyle=f,l.beginPath(),l.arc(u.x,u.y,c.radius,0,Math.PI*2),l.fill()}l.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(Fo,0,0),e.restore()}}function Av(e,t,n,i,s,a,l){for(let c=-s.height;c<=s.height;c+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const f={x:t.x+u,y:t.y+c};Vs({position:f,radius:n},a,l,s)&&e.push({position:f,radius:n,intensity:i})}}function _F(e,t,n,i,s,a=[]){const l=vt(t),c=l?Dn(t,l):[],u=Xr(c),{width:f,height:g}=t.mapDimensions,m=[];a.forEach(C=>{m.push({position:C,radius:30,intensity:.3})}),vF(e,t,i,l==null?void 0:l.leaderId),Object.values(t.entities.entities).sort((C,P)=>n&&C.id===t.debugCharacterId&&C.id!==P.id||C.type==="building"&&P.type!=="building"?-1:C.position.y-P.position.y||C.id-P.id).filter(C=>Vs(C,i,s,t.mapDimensions)).forEach(C=>{var P,R;if(C.type==="building"){const w=C;if(w.isConstructed){const B=w.buildingType===ce.Bonfire&&(w.fuelLevel??0)>0,O=B?180:60,N=B?.9:.4;Av(m,w.position,O,N,t.mapDimensions,i,s)}if(w.buildingType===ce.PlantingZone&&w.isConstructed)return;ei(e,f,g,tF,w,t,l,t.time)}else if(C.type==="berryBush")ei(e,f,g,dB,C,t,l,t.time);else if(C.type==="tree")ei(e,f,g,EF,C,t.time);else if(C.type==="human"){const w=C,B=w.id===(l==null?void 0:l.id),O=c.some(Z=>Z.id===w.id),N=w.id===(u==null?void 0:u.id),M=l&&(w.id===l.motherId||w.id===l.fatherId),F=l&&(((P=w.partnerIds)==null?void 0:P.includes(l.id))||((R=l.partnerIds)==null?void 0:R.includes(w.id))),W=(l==null?void 0:l.attackTargetId)===w.id;Av(m,w.position,40,.3,t.mapDimensions,i,s),ei(e,f,g,FB,w,B,M,O,F,N,W,n,t)}else C.type==="corpse"?ei(e,f,g,pB,C):C.type==="prey"?ei(e,f,g,HB,C,n,t.time,t.debugCharacterId):C.type==="predator"&&ei(e,f,g,xB,C,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(C=>Vs(C,i,s,t.mapDimensions)).forEach(C=>{ei(e,f,g,wT,C,t.time,t)});const A=t.notifications.filter(C=>!C.isDismissed);for(const C of A)if(C.highlightedEntityIds&&C.renderHighlights)for(const P of C.highlightedEntityIds){const R=t.entities.entities[P];R&&Vs(R,i,s,t.mapDimensions)&&ei(e,f,g,fu,R,WP,YP,jP,zP,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const C of t.tutorialState.highlightedEntityIds){const P=t.entities.entities[C];P&&Vs(P,i,s,t.mapDimensions)&&ei(e,f,g,fu,P,NP,JA,eI,_p,t.time)}CF(e,t,i,s,m)}function wF(e,t,n,i,s,a){let l=null,c=null;e.textAlign="left";let u=et+it;const g=t.time/(Ct/Dt)/gu%1,m=ll[Bs.Time],S=25,v=et+S;e.fillText(m,et,u+Fn/2+it/3),jo(e,v,u,Oo,Fn,g,zo,eP),u+=Fn+Xi;const I=u+Sr/2,A=u+(Sr-Fn)/2,C=5;Vl(e,{x:et*2,y:I},Sr,5,n.gender,!1,!1,!1);const P=et+Sr+C,R=Oo+S-(Sr+C)*2;jo(e,P,A,R,Fn,Math.floor(n.age)/bl,zo,J1),Vl(e,{x:P+R+C+Sr/2,y:I},Sr,bl,n.gender,!1,!1,!1),u+=Fn+Xi*2;const w=[],B=new Set;if(w.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),B.add(n.id),i&&!B.has(i.id)&&(w.push({member:i,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),B.add(i.id)),s.forEach(se=>{B.has(se.id)||(w.push({member:se,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),B.add(se.id))}),a.forEach(se=>{B.has(se.id)||(w.push({member:se,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),B.add(se.id))}),n.motherId&&!B.has(n.motherId)){const se=t.entities.entities[n.motherId];se&&(w.push({member:se,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),B.add(se.id))}if(n.fatherId&&!B.has(n.fatherId)){const se=t.entities.entities[n.fatherId];se&&(w.push({member:se,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),B.add(se.id))}const O=ll[Bs.Family],N=10,M=et+it+N,F=Oo+S-(it+N),W=u+md/2;e.font=`${it}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(O,et,W);const Z=u+md/2;oB(e,M,Z,w,md,F),u+=md+Xi,e.textBaseline="alphabetic";const te=ll[Bs.Hitpoints];e.fillText(te,et,u+Fn/2+it/3),jo(e,v,u,Oo,Fn,n.hitpoints/n.maxHitpoints,zo,Q1),u+=Fn+Xi;const j=ll[Bs.Hunger];e.fillText(j,et,u+Fn/2+it/3),jo(e,v,u,Oo,Fn,(on-n.hunger)/on,zo,Z1),l={x:et,y:u-Xi/2,width:Oo+S,height:Fn+Xi},u+=Fn+Xi,e.textBaseline="middle";const ie=ll[Bs.Food];return e.fillText(ie,et,u+pd/2),mB(e,v,u+pd/2,n.food,pd,Oo),c={x:et,y:u-Xi/5,width:Oo+S,height:pd+Xi},e.textBaseline="alphabetic",{hungerBarRect:l,foodBarRect:c}}let fl=[],Iv=0;const RF=36,PF=200;function DF(e,t,n,i){const s=t.search.prey.count(),a=t.search.predator.count(),l=t.search.berryBush.count();t.time-Iv>=RF&&(fl.push({time:t.time,prey:s,predators:a,bushes:l}),fl.length>PF&&(fl=fl.slice(-200)),Iv=t.time);const c=Ke*Qe,u=s/c*1e6,f=a/c*1e6,g=l/c*1e6,m=Hb(),S=Math.floor(t.time/(24*365)),v=Math.floor(t.time%(24*365)/24),I=Math.floor(t.time%24),A=400,C=Math.min(i*.8,600),P=n-A-10,R=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(P,R,A,C),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(P,R,A,C),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let w=R+20;const B=14,O=P+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",O,w),w+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${S}, Day ${v}, Hour ${I}`,O,w),w+=B,e.fillText(`Map Size: ${Ke}  ${Qe} pixels`,O,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",O,w),w+=18,m&&(e.fillText(`Q-Table Size: ${m.qTableSize} entries`,O,w),w+=B,e.fillText(`Exploration Rate: ${(m.explorationRate*100).toFixed(1)}%`,O,w),w+=B);const N=fl.slice(-20);N.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",O,w),w+=30,NF(e,O,w,N),w+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",O,w),w+=18,e.fillStyle="white",e.font="12px monospace";const M=(no/c*1e6).toFixed(2),F=(io/c*1e6).toFixed(2),W=(oo/c*1e6).toFixed(2);e.fillText(`Prey: ${u.toFixed(2)} (target: ${M})`,O,w),w+=B,e.fillText(`Predators: ${f.toFixed(2)} (target: ${F})`,O,w),w+=B,e.fillText(`Bushes: ${g.toFixed(2)} (target: ${W})`,O,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",O,w),w+=18,e.fillStyle="white",e.font="12px monospace";const Z=Math.round(s/no*100),te=Math.round(a/io*100),j=Math.round(l/oo*100),ie=se=>se<50?"#ff4444":se<80?"#ffaa44":se>120?"#44aaff":"#44ff44";e.fillStyle=ie(Z),e.fillText(`Prey: ${s}/${no} (${Z}%)`,O,w),w+=B,e.fillStyle=ie(te),e.fillText(`Predators: ${a}/${io} (${te}%)`,O,w),w+=B,e.fillStyle=ie(j),e.fillText(`Bushes: ${l}/${oo} (${j}%)`,O,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",O,w),w+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",O,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,O,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,O,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,O,w),w+=13,e.fillText("Predators:",O,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,O,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,O,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,O,w),w+=13,e.fillText("Bushes:",O,w),w+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,O,w),w+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",P+A/2,R+C-10),e.restore()}function NF(e,t,n,i){if(i.length<2)return;const c={prey:Math.max(...i.map(f=>f.prey),no),predators:Math.max(...i.map(f=>f.predators),io),bushes:Math.max(...i.map(f=>f.bushes),oo)};[{data:i.map(f=>f.prey),color:"#44ff44",label:"Prey",target:no,max:c.prey},{data:i.map(f=>f.predators),color:"#ff4444",label:"Predators",target:io,max:c.predators},{data:i.map(f=>f.bushes),color:"#ffaa44",label:"Bushes",target:oo,max:c.bushes}].forEach((f,g)=>{const m=t+g*115,S=n;e.fillStyle=f.color,e.font="10px monospace",e.fillText(f.label,m,S-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,S,100,30),e.beginPath(),e.strokeStyle=f.color;for(let I=0;I<f.data.length;I++){const A=m+I/(f.data.length-1)*100,C=S+30-f.data[I]/f.max*30;I===0?e.moveTo(A,C):e.lineTo(A,C)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=S+30-f.target/f.max*30;e.moveTo(m,v),e.lineTo(m+100,v),e.stroke(),e.setLineDash([])})}function MF(e,t){const n=t.search.human.byProperty("leaderId",e),i={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||i.children++,s.gender==="male"?i.males++:s.gender==="female"&&i.females++,s.age>=np&&i.old++;return i}function OF(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(f=>n.berryBush.byRadius(f.position,f.radius)).reduce((f,g)=>f+g.food.length,0),u=n.building.byProperty("ownerId",e).filter(f=>f.buildingType===ce.StorageSpot).reduce((f,g)=>f+(g.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:u,consumptionRate:0}}function kF(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,l=new Map,c=new Map;for(const f of s){const g=au(f.id,t,l);c.has(g)||c.set(g,[]),c.get(g).push(f)}const u=[];for(const[f,g]of c.entries()){const m=a[f];m&&u.push({patriarch:m,memberCount:g.length,members:g.map(S=>S.id)})}return u.sort((f,g)=>g.memberCount-f.memberCount),u.slice(0,n)}let hl=[],Pi=[],Tv=0;const bF=36,Ev=200;function BF(e,t,n,i){var B;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(B=xt(s,t))==null?void 0:B.id;if(!a)return;const l=MF(a,t),c=OF(a,t);if(t.time-Tv>=bF){hl.push({time:t.time,total:l.total,children:l.children,males:l.males,females:l.females,old:l.old});const O=c.totalBushFood+c.totalStorageFood;Pi.push({time:t.time,bushFood:c.totalBushFood,storageFood:c.totalStorageFood,totalFood:O}),hl.length>Ev&&(hl=hl.slice(-200)),Pi.length>Ev&&(Pi=Pi.slice(-200)),Tv=t.time}let u=0;if(Pi.length>=2){const O=Pi[Pi.length-1],N=Pi[Pi.length-2],M=O.time-N.time;M>0&&(u=(N.totalFood-O.totalFood)/M)}const f=400,g=Math.min(i*.9,700),m=n-f-10,S=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,S,f,g),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,S,f,g),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=S+20;const I=13,A=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",A,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",A,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${l.total}`,A,v),v+=I,e.fillStyle="#00ffff",e.fillText(`Children: ${l.children}`,A,v),v+=I,e.fillStyle="#4488ff",e.fillText(`Males: ${l.males}`,A,v),v+=I,e.fillStyle="#ff88ff",e.fillText(`Females: ${l.females}`,A,v),v+=I,e.fillStyle="#888888",e.fillText(`Old (${l.old})`,A,v),v+=20;const C=hl.slice(-50);C.length>1&&(FF(e,A,v,C),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",A,v),v+=18;const P=c.totalBushFood+c.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${P}`,A,v),v+=I,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${c.totalBushFood}`,A,v),v+=I,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${c.totalStorageFood}`,A,v),v+=I,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,A,v),v+=20;const R=Pi.slice(-50);R.length>1&&(LF(e,A,v,R),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",A,v),v+=18;const w=kF(a,t,5);e.fillStyle="white",e.font="11px monospace",w.length===0?(e.fillText("No families found",A,v),v+=I):w.forEach((O,N)=>{const F=`${N+1}. ${O.patriarch.isPlayer?"Player":"#"+O.patriarch.id} (${O.memberCount} members, can split: ${EI(O.patriarch,t).canSplit})`;e.fillText(F,A,v),v+=I}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+f/2,S+g-10),e.restore()}function FF(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.total),color:"#ffffff",label:"Total"},{data:i.map(u=>u.children),color:"#00ffff",label:"Children"},{data:i.map(u=>u.males),color:"#4488ff",label:"Males"},{data:i.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:i.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function LF(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:i.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:i.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function Cv(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,c=jA;if(e.beginPath(),e.moveTo(i+c,s),e.lineTo(i+a-c,s),e.quadraticCurveTo(i+a,s,i+a,s+c),e.lineTo(i+a,s+l-c),e.quadraticCurveTo(i+a,s+l,i+a-c,s+l),e.lineTo(i+c,s+l),e.quadraticCurveTo(i,s+l,i,s+l-c),e.lineTo(i,s+c),e.quadraticCurveTo(i,s,i+c,s),e.closePath(),e.fillStyle=t.isDisabled?XA:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*ZA)+1)/2;e.strokeStyle=qA,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<nu){const f=1-u/nu;e.fillStyle=KA,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Cp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?VA:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.font=`${it*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function UF(e,t,n,i){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,i);const s=500,a=150,l=(n-s)/2,c=(i-a)/2;e.fillStyle=Ht,e.font=`${it*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,c+a/3-10),e.fillText("to the main menu?",n/2,c+a/3+10);const u=to*1.5,f=zA,g=c+a-f-et*2,m=20,S=u*2+m,v=l+(s-S)/2,I={id:"confirmExitYes",action:le.ConfirmExitYes,rect:{x:v,y:g,width:u,height:f},text:"Yes",backgroundColor:$o,textColor:Ht,currentWidth:u},A=v+u+m,C={id:"confirmExitNo",action:le.ConfirmExitNo,rect:{x:A,y:g,width:u,height:f},text:"No",backgroundColor:$o,textColor:Ht,currentWidth:u};t.uiButtons.push(I,C),Cv(e,I,t.hoveredButtonId===I.id),Cv(e,C,t.hoveredButtonId===C.id),e.restore()}const Lo=600,Ns=30,Di=60,zt=30,HF="";function GF(e,t,n){const i=[];if(!n.tribeControl||!n.leaderId)return i;const{width:s,height:a}=e.canvas,l=(s-Lo)/2,c=480,u=(a-c)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(l,u,Lo,c,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Ht,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Tribe Roles",l+Lo/2,u+Ns);const f=30,g=l+Lo-Ns-f,m=u+Ns,S=t.hoveredButtonId==="roleManager_close";e.fillStyle=S?"#ff7777":"#ff5555",e.fillRect(g,m,f,f),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",g+f/2,m+f/2),i.push({id:"roleManager_close",action:le.CloseRoleManager,rect:{x:g,y:m,width:f,height:f},text:"X",currentWidth:f,backgroundColor:"#ff5555",textColor:"#ffffff"});const I=Ui(n.leaderId,t).filter(j=>j.isAdult),A={[ee.Leader]:0,[ee.Gatherer]:0,[ee.Planter]:0,[ee.Hunter]:0,[ee.Mover]:0,[ee.Warrior]:0};I.forEach(j=>{j.tribeRole&&A[j.tribeRole]++});const C=n.tribeControl.roleWeights,P=[{role:ee.Gatherer,emoji:"",name:"Gatherer"},{role:ee.Planter,emoji:"",name:"Planter"},{role:ee.Hunter,emoji:"",name:"Hunter"},{role:ee.Mover,emoji:"",name:"Mover"},{role:ee.Warrior,emoji:"",name:"Warrior"}];let R=0;P.forEach(j=>{R+=C[j.role]||0});let w=u+Ns+70;const B=l+Ns,O=l+Lo-Ns;P.forEach(j=>{const ie=C[j.role]||0,se=R>0?Math.round(ie/R*100):0,_e=A[j.role]||0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${j.emoji} ${_e} ${j.name}`,B,w+Di/2);const fe=l+220,ne=fe+zt+15,V=ne+200+15,K=`role_minus_${j.role}`,b=t.hoveredButtonId===K,Y=ie<=0,de=Y?"#555":b?"#dd6666":"#cc4444";e.fillStyle=de,e.fillRect(fe,w+(Di-zt)/2,zt,zt),e.fillStyle=Y?"#888":"#fff",e.textAlign="center",e.fillText("-",fe+zt/2,w+Di/2+2),i.push({id:K,action:le.DecreaseRoleWeight,targetRole:j.role,rect:{x:fe,y:w+(Di-zt)/2,width:zt,height:zt},text:"-",currentWidth:zt,backgroundColor:de,textColor:"#fff",isDisabled:Y}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#fff";let pe=ne;for(let ue=0;ue<ie;ue++)e.fillText(HF,pe,w+Di/2+2),pe+=18;const Pe=`role_plus_${j.role}`,me=t.hoveredButtonId===Pe,Oe=ie>=10,Ne=Oe?"#555":me?"#66dd66":"#44cc44";e.fillStyle=Ne,e.fillRect(V,w+(Di-zt)/2,zt,zt),e.fillStyle=Oe?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",V+zt/2,w+Di/2+4),i.push({id:Pe,action:le.IncreaseRoleWeight,targetRole:j.role,rect:{x:V,y:w+(Di-zt)/2,width:zt,height:zt},text:"+",currentWidth:zt,backgroundColor:Ne,textColor:"#fff",isDisabled:Oe}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${se}%`,O,w+Di/2),w+=Di});const N=A[ee.Leader],M=Object.values(A).reduce((j,ie)=>j+ie,0),F=I.length-M;e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`Adults: ${I.length} | Leader: ${N} | Assigned: ${M} | Unassigned: ${F}`,l+Lo/2,w+10),e.fillText("(Adjust weights to control role distribution)",l+Lo/2,w+30);const W=t.autopilotControls.behaviors.roleManagement,Z=W?" Auto-adjust: ON":" Auto-adjust: OFF",te=W?"#4CAF50":"#888";return e.fillStyle=te,e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`${Z} (Shift+U to toggle)`,l+Lo/2,w+50),e.restore(),i}const Rr=600,Ms=30,Ni=60,jt=30,_v=[{key:"protectHomeland",emoji:"",name:"Protect Homeland",description:"Stay inside territory and protect from enemies"},{key:"expandBorders",emoji:"",name:"Expand Borders",description:"Expand territory by placing border posts (Coming Soon)"},{key:"invadeEnemies",emoji:"",name:"Invade Enemies",description:"Attack enemies outside of our border"}];function $F(e,t,n){const i=[];if(!n.tribeControl||n.leaderId!==n.id)return i;const s=n.tribeControl.armyControl??{protectHomeland:Pg,expandBorders:Dg,invadeEnemies:Ng},{width:a,height:l}=e.canvas,c=(a-Rr)/2,u=350,f=(l-u)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(c,f,Rr,u,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Ht,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Army Control",c+Rr/2,f+Ms);const g=30,m=c+Rr-Ms-g,S=f+Ms,v=t.hoveredButtonId==="armyControl_close";e.fillStyle=v?"#ff7777":"#ff5555",e.fillRect(m,S,g,g),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",m+g/2,S+g/2),i.push({id:"armyControl_close",action:le.CloseArmyControl,rect:{x:m,y:S,width:g,height:g},text:"X",currentWidth:g,backgroundColor:"#ff5555",textColor:"#ffffff"});let I=0;_v.forEach(R=>{I+=s[R.key]||0});let A=f+Ms+70;const C=c+Ms,P=c+Rr-Ms;return _v.forEach(R=>{const w=s[R.key]||0,B=I>0?Math.round(w/I*100):0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${R.emoji} ${R.name}`,C,A+Ni/2);const O=c+320,N=O+jt+15,M=120,F=N+M+15,W=`army_minus_${R.key}`,Z=t.hoveredButtonId===W,te=w<=0,j=te?"#555":Z?"#dd6666":"#cc4444";e.fillStyle=j,e.fillRect(O,A+(Ni-jt)/2,jt,jt),e.fillStyle=te?"#888":"#fff",e.textAlign="center",e.fillText("-",O+jt/2,A+Ni/2+2),i.push({id:W,action:le.DecreaseArmyObjective,targetArmyObjective:R.key,rect:{x:O,y:A+(Ni-jt)/2,width:jt,height:jt},text:"-",currentWidth:jt,backgroundColor:j,textColor:"#fff",isDisabled:te}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#4CAF50";const ie=M-10,se=12,_e=A+Ni/2-se/2;e.fillStyle="#333",e.fillRect(N,_e,ie,se);const fe=w/10*ie;e.fillStyle="#4CAF50",e.fillRect(N,_e,fe,se);const ne=`army_plus_${R.key}`,z=t.hoveredButtonId===ne,V=w>=10,K=V?"#555":z?"#66dd66":"#44cc44";e.fillStyle=K,e.fillRect(F,A+(Ni-jt)/2,jt,jt),e.fillStyle=V?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",F+jt/2,A+Ni/2+4),i.push({id:ne,action:le.IncreaseArmyObjective,targetArmyObjective:R.key,rect:{x:F,y:A+(Ni-jt)/2,width:jt,height:jt},text:"+",currentWidth:jt,backgroundColor:K,textColor:"#fff",isDisabled:V}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ht,e.fillText(`${B}%`,P,A+Ni/2),A+=Ni}),e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText("Adjust priorities for warrior objectives",c+Rr/2,A+10),e.fillText("Higher values = higher priority",c+Rr/2,A+30),e.restore(),i}let wv="",Rv=null;function xF(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function WF(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function bd(e,t,n,i,s,a,l){const c=((t+i)%a+a)%a,u=((n+s)%l+l)%l;return e.has(`${c},${u}`)}function YF(e,t,n,i){const s=uR(t.soilDepletion,sA);if(s.length===0)return;const{width:a,height:l}=t.mapDimensions,c=i.width/2,u=i.height/2,f=Math.ceil(a/Xt),g=Math.ceil(l/Xt),m=xF(s);m!==wv&&(wv=m,Rv=WF(s));const S=Rv,v=Xt*2,I=n.x-c-v,A=n.x+c+v,C=n.y-u-v,P=n.y+u+v;e.save();const R=e.globalAlpha;for(const w of s){const B=w.gridX*Xt,O=w.gridY*Xt,N=zF(B,O,a,l,I,A,C,P);for(const M of N)jF(e,M.x,M.y,w.health,w.gridX,w.gridY,S,f,g)}e.globalAlpha=R,e.restore()}function zF(e,t,n,i,s,a,l,c){const u=[],f=Xt,g=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-i},{dx:0,dy:i},{dx:-n,dy:-i},{dx:n,dy:-i},{dx:-n,dy:i},{dx:n,dy:i}];for(const m of g){const S=e+m.dx,v=t+m.dy;S+f>=s&&S<=a&&v+f>=l&&v<=c&&u.push({x:S,y:v})}return u}function jF(e,t,n,i,s,a,l,c,u){const f=Math.floor(t),g=Math.floor(n),m=Xt,S=1-i/sA,I=i<Uw?oS:oS*S,A=!bd(l,s,a,0,-1,c,u),C=!bd(l,s,a,0,1,c,u),P=!bd(l,s,a,-1,0,c,u),R=!bd(l,s,a,1,0,c,u);e.globalAlpha=I,e.fillStyle=Fw,e.fillRect(f,g,m,m);const w=3;e.fillStyle=Lw,e.globalAlpha=I*1.2,A&&e.fillRect(f,g,m,w),C&&e.fillRect(f,g+m-w,m,w),P&&e.fillRect(f,g,w,m),R&&e.fillRect(f+m-w,g,w,m),e.globalAlpha=I*.5;const B=w+1;A&&P&&e.fillRect(f,g,B,B),A&&R&&e.fillRect(f+m-B,g,B,B),C&&P&&e.fillRect(f,g+m-B,B,B),C&&R&&e.fillRect(f+m-B,g+m-B,B,B),e.globalAlpha=1}const gl=8,pl=12,hn=24;function Pv(e,t,n,i,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-pl),e.stroke(),e.fillStyle=i,e.beginPath(),e.moveTo(t,n-pl),e.lineTo(t+gl,n-pl+gl/2),e.lineTo(t,n-pl+gl),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+gl/2,n-pl+gl/2))}function XF(e,t,n,i,s){const a=bu(t,s);let l=1;const c=new Map,u=new Map;for(const A of a){const P=A.leaderId===s?0:l++,R=$n[P%$n.length];c.set(A.leaderId,R),u.set(A.leaderId,A.tribeBadge||"")}const f=[],g=hn*2,m=Math.floor((n.x-i.width/2-g)/hn)*hn,S=Math.floor((n.x+i.width/2+g)/hn)*hn,v=Math.floor((n.y-i.height/2-g)/hn)*hn,I=Math.floor((n.y+i.height/2+g)/hn)*hn;for(let A=v;A<=I;A+=hn)for(let C=m;C<=S;C+=hn){const P=bi(C,A,t),R=C+hn,w=bi(R,A,t);if(P!==w){const N=P||w;if(N){const M=C+hn/2,F=A;Pv(e,M,F,c.get(N)||"#000",u.get(N)||""),f.push({x:M,y:F})}}const B=A+hn,O=bi(C,B,t);if(P!==O){const N=P||O;if(N){const M=C,F=A+hn/2;Pv(e,M,F,c.get(N)||"#000",u.get(N)||""),f.push({x:M,y:F})}}}return f}const Un=12,Rt=16,Qn=15;function Dv(e){switch(e){case H.Success:return"#4CAF50";case H.Failure:return"#F44336";case H.Running:return"#FFC107";case H.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function VF(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function KF(e,t,n,i){var M;const{debugCharacterId:s}=t,a=500,l=Math.min(i*.9,800),c=n-a-10,u=et+it*2;t.debugPanelRect={x:c,y:u,width:a,height:l},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(c,u,a,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(c,u,a,l),e.fillStyle="white",e.font=`${Un}px monospace`,e.textAlign="left",e.textBaseline="top";let f=u+20;const g=c+15;if(e.fillStyle="#66ccff",e.font=`bold ${Un+2}px monospace`,e.fillText(" Task AI Debugger",g,f),f+=25,!s){e.fillStyle="#888",e.font=`${Un}px monospace`,e.fillText("No character selected for debugging.",g,f),e.fillText("Click on a character to inspect their Task AI.",g,f+20),e.restore();return}const m=t.entities.entities[s];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${Un}px monospace`,e.fillText(`Character #${s} not found or not a character.`,g,f),e.restore();return}const S=m;e.fillStyle="white",e.font=`${Un}px monospace`,e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,g,f),f+=Rt*1.5,e.fillStyle="#66ccff",e.font=`bold ${Un}px monospace`,e.fillText(" Current Task",g,f),f+=Rt*1.5;const v=bg(S),I=v?t.tasks[v]:null;if(e.font=`${Un}px monospace`,I){const F=_.get(S.aiBlackboard,PI),W=_.get(S.aiBlackboard,DI),Z=F!==void 0?H[F]:"N/A";e.fillStyle="white",e.fillText(`ID: ${I.id}`,g+Qn,f),f+=Rt,e.fillText(`Type: ${re[I.type]}`,g+Qn,f),f+=Rt,e.fillText(`Target: ${VF(I.target)}`,g+Qn,f),f+=Rt,e.fillStyle=Dv(F),e.fillText(`Status: ${Z}`,g+Qn,f),f+=Rt,W&&(e.fillStyle="#aaa",e.fillText(`Message: ${W}`,g+Qn,f),f+=Rt)}else e.fillStyle="#888",e.fillText("No active task.",g+Qn,f),f+=Rt;f+=Rt,e.fillStyle="#66ccff",e.font=`bold ${Un}px monospace`,e.fillText(" Recent Task History (Last 5)",g,f),f+=Rt*1.5;const A=_.get(S.aiBlackboard,kg)||[];if(A.length===0)e.fillStyle="#888",e.font=`${Un}px monospace`,e.fillText("No task history yet.",g+Qn,f),f+=Rt;else for(const F of A){e.fillStyle="white",e.font=`${Un}px monospace`;const W=re[F.type];e.fillText(` ${W}`,g+Qn,f);const Z=H[F.result];e.fillStyle=Dv(F.result);const te=e.measureText(` ${W} `).width;e.fillText(`(${Z})`,g+Qn+te,f),e.fillStyle="#666";const j=e.measureText(`(${Z}) `).width;e.fillText(`@ ${F.completedAtTick.toFixed(1)}h`,g+Qn+te+j,f),f+=Rt,F.message&&(e.fillStyle="#888",e.fillText(`   ${F.message}`,g+Qn,f),f+=Rt)}f+=Rt,e.fillStyle="#66ccff",e.font=`bold ${Un}px monospace`,e.fillText(" Available Tasks",g,f),f+=Rt*1.5;const C=f,P=u+l-C-30;e.save(),e.beginPath(),e.rect(c,C,a,P),e.clip();const R=((M=t.debugPanelScroll)==null?void 0:M.y)??0;e.translate(0,-R);const w=Object.values(t.tasks);let B=0;if(w.length===0)e.fillStyle="#888",e.font=`${Un}px monospace`,e.fillText("No tasks available in the world.",g+Qn,f),f+=Rt;else for(const F of w){const W=ku[F.type],Z=W&&W.scorer&&S.type==="human"?W.scorer(S,F,{gameState:t,deltaTime:0}):null;let te="Unclaimed",j="#888";F.claimedByEntityId&&(F.claimedByEntityId===S.id?(te="Claimed by this character",j="#4CAF50"):(te=`Claimed by #${F.claimedByEntityId}`,j="#F44336")),e.font=`${Un}px monospace`,e.fillStyle=j;const ie=` Task ID: ${F.id}`;e.fillText(ie,g,f),f+=Rt,e.fillStyle="white",e.fillText(`  Type: ${re[F.type]}`,g,f),f+=Rt;const se=Z!==null?Z.toFixed(3):"N/A";e.fillStyle=Z!==null&&Z>0?"#FFC107":"#888",e.fillText(`  Score: ${se}`,g,f),f+=Rt,e.fillStyle=j,e.fillText(`  Status: ${te}`,g,f),f+=Rt*1.5,B=Math.max(B,e.measureText(ie).width+30)}const O=f-C;t.debugPanelContentSize={width:B,height:O},e.restore();const N=u+l-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",c+a/2,N),e.restore()}function qF(e,t,n,i){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey")return;switch(a.aiType){case $t.TaskBased:KF(e,t,n,i);break;case $t.BehaviorTreeBased:wB(e,t,n,i);break}const l=500,c=n-l-10,u=et+it*2,f=150,g=25,m=c+l-f-15,S=u+15,v={x:m,y:S,width:f,height:g};t.uiButtons.push({id:"switch-ai-type-button",action:le.SwitchAIType,rect:v,text:"",currentWidth:f,backgroundColor:"rgba(100, 100, 100, 0.5)",textColor:"white"}),e.save(),e.fillStyle="rgba(100, 100, 100, 0.8)",e.fillRect(m,S,f,g),e.strokeStyle="#fff",e.lineWidth=1,e.strokeRect(m,S,f,g),e.fillStyle="white",e.font="10px monospace",e.textAlign="center",e.textBaseline="middle";const I=a.aiType===$t.BehaviorTreeBased?"BT":"Task";e.fillText(`AI: ${I} (Switch)`,m+f/2,S+g/2),e.restore()}function hu(e,t,n,i,s,a=!1){var f;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),lB(e,t);return}const l=vt(t),c=XF(e,t,n,s,l==null?void 0:l.leaderId);if(YF(e,t,n,s),_F(e,t,t.debugPanel===je.General,n,s,c),l&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const g=Kg(t.mousePosition,n,s,t.mapDimensions),m=la(g,t.selectedBuildingType,l.leaderId,t);nF(e,g,t.selectedBuildingType,m,t.mapDimensions)}const u=t.notifications.filter(g=>!g.isDismissed);for(const g of u){const m=(Math.sin(t.time*GP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=HP,g.targetArea&&e.fillRect(g.targetArea.x,g.targetArea.y,g.targetArea.width,g.targetArea.height),g.targetRadius&&(e.beginPath(),e.arc(g.targetRadius.x,g.targetRadius.y,g.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,vB(e,t),e.restore(),!a){e.fillStyle=V1,e.font=`${it}px "Press Start 2P", Arial`,e.shadowColor=K1,e.shadowBlur=q1,t.uiButtons=[];let g=null,m=null;if(l){const I=Dn(t,l),A=Xr(I),C=((f=l.partnerIds)==null?void 0:f.map(R=>t.entities.entities[R]).filter(R=>R!==void 0))||[],P=wF(e,t,l,A,C,I);g=P.hungerBarRect,m=P.foodBarRect}const S=bu(t,l==null?void 0:l.leaderId);rB(e,t,S,e.canvas.width,e.canvas.height);const{commandButtonsRect:v}=jb(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,l&&(yB(e,t,n,e.canvas.width,e.canvas.height),i.length>0&&qb(e,i,l,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:I}=t.tutorialState;I.includes(xr.HUNGER_BAR)&&g&&hg(e,g,t.time),I.includes(xr.FOOD_BAR)&&m&&hg(e,m,t.time),I.includes(xr.COMMAND_BUTTONS)&&v&&hg(e,v,t.time)}if(t.tutorialState.isActive){const I=aB(e,t,e.canvas.width,e.canvas.height);I&&t.uiButtons.push({id:"tutorial-dismiss",action:le.DismissTutorial,rect:I,text:"",currentWidth:I.width,backgroundColor:"transparent",textColor:"transparent"})}switch(IB(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case je.Ecosystem:DF(e,t,e.canvas.width,e.canvas.height);break;case je.Tribe:BF(e,t,e.canvas.width,e.canvas.height);break;case je.SupplyChain:PB(e,t,e.canvas.width,e.canvas.height);break;case je.Performance:EB(e,t,s.width);break;case je.General:qF(e,t,e.canvas.width,e.canvas.height);break}if(t.roleManagerOpen&&l&&l.leaderId===l.id){const I=GF(e,t,l);t.uiButtons.push(...I)}if(t.armyControlOpen&&l&&l.leaderId===l.id){const I=$F(e,t,l);t.uiButtons.push(...I)}t.isPaused&&t.exitConfirmation!=="pending"&&Xb(e),t.exitConfirmation==="pending"&&UF(e,t,e.canvas.width,e.canvas.height)}}const ZF=kt.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,QF=kt.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,JF=kt.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,eL=kt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Nv=kt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,tL=kt.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,nL=kt.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,Bd="intro-soundtrack",Mv=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=Qr(),i=Fe.useRef(null),s=Fe.useRef(null),a=Fe.useRef($k()),l=Fe.useRef(),c=Fe.useRef(a.current.viewportCenter),u=Fe.useRef(),f=Fe.useCallback(()=>{Yh(Bd,2),n(),e("game")},[e,n]),g=Fe.useCallback(()=>{t&&(Yh(Bd,2),e("game"))},[e,t]);Fe.useEffect(()=>{const v=I=>{(I.key==="Enter"||I.key===" ")&&(t?g():f())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[f,g,t]),Fe.useEffect(()=>(Ap(Ce.SoundTrack1,{loop:!0,trackId:Bd}),()=>{Yh(Bd,2)}),[]),Fe.useEffect(()=>{const v=i.current;if(!v)return;s.current=v.getContext("2d");const I=()=>{v&&s.current&&(v.width=window.innerWidth,v.height=window.innerHeight,hu(s.current,a.current,c.current,[],{width:v.width,height:v.height},!0))};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]),Fe.useEffect(()=>{const v=()=>{const A=mI(a.current);if(A.length>0){const C=Math.floor(Math.random()*A.length);u.current=A[C].id}};v();const I=setInterval(v,WC);return()=>clearInterval(I)},[]);const[m,S]=fT(v=>{var C,P;if(!s.current)return;if(l.current===void 0){l.current=v;return}const I=Math.min((v-l.current)/1e3,1);a.current=xu(a.current,I);const A=u.current?a.current.entities.entities[u.current]:void 0;if(A){const{mapDimensions:R}=a.current,{width:w,height:B}=R;let O={...A.position};const N=O.x-c.current.x;Math.abs(N)>w/2&&(N>0?O.x-=w:O.x+=w);const M=O.y-c.current.y;Math.abs(M)>B/2&&(M>0?O.y-=B:O.y+=B);let F=Jg(c.current,O,Qg*I);F={x:(F.x%w+w)%w,y:(F.y%B+B)%B},c.current=F}hu(s.current,a.current,c.current,[],{width:((C=i.current)==null?void 0:C.width)||800,height:((P=i.current)==null?void 0:P.height)||600},!0),l.current=v});return Fe.useEffect(()=>(S(),m),[S,m]),Ue.jsxs(ZF,{children:[Ue.jsx(QF,{ref:i}),Ue.jsxs(JF,{children:[Ue.jsx(eL,{children:"Tribe2"}),Ue.jsxs(tL,{children:[Ue.jsx(Nv,{onClick:f,children:"New Game"}),t&&Ue.jsx(Nv,{onClick:g,children:"Load Game"})]}),Ue.jsxs(nL,{children:["by"," ",Ue.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function iL(){console.log("Tribe game initialized with detailed 2D world state.");const e=Gk();return e.ecosystem={preyGestationPeriod:Fr,preyProcreationCooldown:Lr,predatorGestationPeriod:Ur,predatorProcreationCooldown:Hr,preyHungerIncreasePerHour:Wo,predatorHungerIncreasePerHour:Yo,berryBushSpreadChance:ro},e.debugPanel=je.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const oL=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:i,playerActionHintsRef:s})=>(Fe.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const l=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,hu(t.current,n.current,i.current,s.current,{width:a.width,height:a.height},!1))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),Ue.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),rL=(e,t,n,i=!1)=>{var l,c;let s;const a=jD(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:oe.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:oe.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const u=a;t.isAdult&&Vr(t,u,n)?s={action:oe.AutopilotAttack,targetEntityId:u.id}:nr(t,u,n)?s={action:oe.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:oe.AutopilotFeedChild,targetEntityId:u.id})}else if(a.type==="prey")s={action:oe.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:oe.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const u=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&Vt(t,u,n)&&u.isConstructed?s={action:oe.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:oe.Removal,position:a.position};else if(t.leaderId===t.id&&Vt(t,u,n)&&u.isConstructed)gA(u.position,ea,t.id,n).valid?s={action:oe.TakeOverBuilding,targetEntityId:u.id}:s={action:oe.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const f=u.ownerId===t.leaderId,g=u.storedItems.length>0,m=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(i&&u.isConstructed&&g&&t.food.length<t.maxFood)if(f)s={action:oe.AutopilotRetrieve,targetEntityId:a.id};else{const S=t.leaderId?n.entities.entities[t.leaderId]:void 0;S&&((l=S.tribeControl)!=null&&l.diplomacy)?(u.ownerId&&S.tribeControl.diplomacy[u.ownerId])===Ut.Hostile?s={action:oe.AutopilotGather,targetEntityId:a.id}:s={action:oe.AutopilotMove,position:e}:s={action:oe.AutopilotMove,position:e}}else f&&u.isConstructed?(t.food.length>0||t.heldItem)&&m?s={action:oe.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&g?s={action:oe.AutopilotRetrieve,targetEntityId:a.id}:s={action:oe.AutopilotMove,position:e}:s={action:oe.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(f=>f.type===An.Berry).length>=uo&&!Wn(e,n,Zo)&&!Fi(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:oe.AutopilotPlant,position:e}:u.buildingType===ce.Bonfire&&((c=t.heldItem)==null?void 0:c.type)===yt.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:oe.AutopilotDeposit,targetEntityId:u.id}:s={action:oe.AutopilotMove,position:e}}else if(a.type==="tree"){const u=a,[f]=u.stateMachine??[],g=f===sn||f===Kt||f===vn;t.isAdult&&!t.heldItem&&g?s={action:oe.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&f===Gt&&u.wood.length>0?s={action:oe.AutopilotGather,targetEntityId:u.id}:s={action:oe.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===An.Berry).length>=uo&&(n.autopilotControls.isManuallyPlanting||Zl(e,n,t))&&!Fi(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:oe.AutopilotPlant,position:e}:s={action:oe.AutopilotMove,position:e};return s},sL=(e,t)=>{if(e.isPaused)return;const n=vt(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=U(n.position,t,e.mapDimensions.width,e.mapDimensions.height),l=100;a<=l?la(t,s,n.leaderId,e,n.position,l)&&(Vo(t,s,n.leaderId,e),e.selectedBuildingType=null):la(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:oe.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=SO(t,e);s&&Bg(s.id,e);return}const i=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,i?(e.autopilotControls.activeAutopilotAction=i,(i.action===oe.AutopilotMove||i.action===oe.AutopilotGather||i.action===oe.AutopilotChop)&&(e.hasPlayerMovedEver=!0),i.action===oe.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:oe.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},aL=(e,t)=>{var l,c,u,f,g,m,S,v;const n=e.key.toLowerCase(),i=e.ctrlKey||e.metaKey;let s=!0,a=t;if(i){switch(n){case"s":Lp(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:I}=t;I.activeAutopilotAction||I.isManuallyMoving||I.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(I.activeAutopilotAction=void 0,I.isManuallyMoving=!1,I.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"u":const A=vt(t);A&&A.isAdult&&A.leaderId===A.id&&(e.shiftKey?t.autopilotControls.behaviors.roleManagement=!t.autopilotControls.behaviors.roleManagement:t.roleManagerOpen=!t.roleManagerOpen);break;case"v":{const R=vt(t);R&&R.isAdult&&R.leaderId===R.id&&(t.armyControlOpen=!t.armyControlOpen);break}case"m":t.isMuted=!t.isMuted,Rl(t.masterVolume,t.isMuted);break;case"=":case"+":const C=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(C.toFixed(1)),Rl(t.masterVolume,t.isMuted);break;case"-":const P=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(P.toFixed(1)),Rl(t.masterVolume,t.isMuted);break;case"t":a=xu(t,uI);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===je.General?(a.debugPanel=je.None,a.debugCharacterId=void 0):(a.debugPanel=je.General,a.debugCharacterId||(a.debugCharacterId=((l=vt(a))==null?void 0:l.id)??((c=Object.values(a.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:c.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===je.Ecosystem){a.debugPanel=je.None;break}a.debugPanel=je.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((u=vt(a))==null?void 0:u.id)??((f=Object.values(a.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:f.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===je.Tribe){a.debugPanel=je.None;break}a.debugPanel=je.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((g=vt(a))==null?void 0:g.id)??((m=a.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:m.id))}else s=!1;break;case"$":if(e.shiftKey){if(a.debugPanel===je.SupplyChain){a.debugPanel=je.None;break}a.debugPanel=je.SupplyChain,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((S=vt(a))==null?void 0:S.id)??((v=a.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:v.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===je.Performance){a.debugPanel=je.None;break}a.debugPanel=je.Performance}else s=!1;break;case"tab":if(a.debugPanel!==je.General&&a.debugPanel!==je.Tribe&&a.debugPanel!==je.SupplyChain&&(a.debugPanel=je.General),a.debugPanel===je.General){const R=Object.values(a.entities.entities).filter(w=>w.type==="human"||w.type==="prey"||w.type==="predator");if(R.length>0){const w=R.sort((M,F)=>{if(M.type==="human"&&M.isPlayer)return-1;if(F.type==="human"&&F.isPlayer)return 1;if(M.type!==F.type){const W={human:0,prey:1,predator:2},Z=W[M.type]??999,te=W[F.type]??999;return Z-te}return M.id-F.id}),B=a.debugCharacterId,N=((B?w.findIndex(M=>M.id===B):-1)+1)%w.length;a.debugCharacterId=w[N].id}else a.debugCharacterId=void 0}else if(a.debugPanel===je.Tribe||a.debugPanel===je.SupplyChain){const R=a.search.human.all().filter(B=>B.leaderId===B.id);let w=R.findIndex(B=>B.id===a.debugCharacterId)+1;(w===-1||w>R.length-1)&&(w=0),a.debugCharacterId=R[w].id}else a.debugPanel=je.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},lL=(e,t,n,i,s)=>{var l;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",Me(a,Ce.ButtonClick,i.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",Me(a,Ce.ButtonClick,i.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",Me(a,Ce.ButtonClick,i.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",Me(a,Ce.ButtonClick,i.position);return}else if(e==="6"){n.selectedBuildingType="removal",Me(a,Ce.ButtonClick,i.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const c=Be(i,n,"berryBush",ze,g=>g.food.length>0&&i.food.length<i.maxFood),u=Be(i,n,"corpse",ze,g=>g.food.length>0&&i.food.length<i.maxFood);let f=null;c&&u?f=U(i.position,c.position,n.mapDimensions.width,n.mapDimensions.height)<=U(i.position,u.position,n.mapDimensions.width,n.mapDimensions.height)?c:u:f=c||u,f&&(i.activeAction="gathering",Me(a,Ce.Gather,i.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}Be(i,n,"human",ze,u=>nr(i,u,n))&&(i.activeAction="procreating",Me(a,Ce.Procreate,i.position))}else if(e==="f")i.food.length>0&&(i.activeAction="eating",Me(a,Ce.Eat,i.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const c=s.find(u=>u.type===oe.FeedChild);c&&c.targetEntity&&(i.activeAction="feeding",i.target=c.targetEntity.id)}else if(e==="arrowup"||e==="w")i.direction.y=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")i.direction.y=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")i.direction.x=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")i.direction.x=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const c=Be(i,n,"human",Sn,u=>Vr(i,u,n))??Be(i,n,"predator",Sn)??Be(i,n,"prey",Sn);c&&(i.activeAction="attacking",i.attackTargetId=c.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===oe.Plant)){const u=Gw(i.position,n,50,Cg);u&&(i.activeAction="planting",i.target=u,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const c=Be(i,n,"building",Zt,f=>{const g=f;return g.buildingType===ce.Bonfire&&g.isConstructed&&g.storedItems.length<(g.storageCapacity||0)});if(((l=i.heldItem)==null?void 0:l.type)===yt.Wood&&c){i.activeAction="depositing",i.target=c.id,Me(a,Ce.StorageDeposit,i.position);return}const u=Be(i,n,"building",Zt,f=>{const g=f;return g.buildingType===ce.StorageSpot&&g.ownerId===i.leaderId&&g.isConstructed&&g.storageCapacity!==void 0&&g.storedItems.length<g.storageCapacity});u&&(i.activeAction="idle",i.target=u.id,Me(a,Ce.StorageDeposit,i.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const c=Be(i,n,"building",Zt,u=>{const f=u;return f.buildingType==="storageSpot"&&f.ownerId===i.leaderId&&f.isConstructed&&f.storedItems.length>0});c&&(i.activeAction="idle",i.target=c.id,Me(a,Ce.StorageRetrieve,i.position))}else if(e==="k")CI(i,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,Me(a,Ce.ButtonClick,i.position)}else if(e==="u"){if(t){n.autopilotControls.behaviors.roleManagement=!n.autopilotControls.behaviors.roleManagement;return}}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const c=Be(i,n,"tree",pu,u=>u.wood&&u.wood.length>0&&!i.heldItem);c&&(i.activeAction="chopping",i.target=c.id)}},cL=(e,t,n,i)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!i.current.has("arrowup")&&!i.current.has("arrowdown")&&!i.current.has("arrowleft")&&!i.current.has("arrowright")&&!i.current.has("w")&&!i.current.has("a")&&!i.current.has("s")&&!i.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!i.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!i.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!i.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!i.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!i.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},dL=(e,t,n)=>{let s=vt(e);if(e.debugCharacterId){const a=e.entities.entities[e.debugCharacterId];a&&"position"in a&&(s=a)}if(s){const{mapDimensions:a}=e,{width:l,height:c}=a;let u={...s.position};const f=u.x-t.x;Math.abs(f)>l/2&&(f>0?u.x-=l:u.x+=l);const g=u.y-t.y;Math.abs(g)>c/2&&(g>0?u.y-=c:u.y+=c);let m=Jg(t,u,Qg*n);return m={x:(m.x%l+l)%l,y:(m.y%c+c)%c},m}return e.viewportCenter};function uL(e,t){const{width:n,height:i}=e.mapDimensions;e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%i+i)%i}}const fL=(e,t,n,i)=>{var u,f;const s={gameState:n},a=vt(n);a&&Me(s,Ce.ButtonClick,a.position);const l=n.uiButtons.find(g=>g.id===e.id);l&&(l.lastActivated=Date.now()),t&&[le.CommandGather,le.CommandPlant,le.ToggleProcreationBehavior,le.CommandBuild,le.OpenRoleManager].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:c}=n.autopilotControls;switch(e.action){case le.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case le.ConfirmExitYes:i(),n.exitConfirmation="inactive";break;case le.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case le.ToggleMute:n.isMuted=!n.isMuted,Rl(n.masterVolume,n.isMuted);break;case le.TogglePause:n.isPaused=!n.isPaused;break;case le.FastForward:return xu(n,uI);case le.DismissTutorial:n.tutorialState.isActive=!1;break;case le.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case le.CommandGather:t?c.gathering=!c.gathering:a&&(a.activeAction="gathering");break;case le.CommandPlant:t?c.planting=!c.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case le.ToggleProcreationBehavior:c.procreation=!c.procreation;break;case le.ToggleAttackBehavior:c.attack=!c.attack;break;case le.ToggleFeedChildBehavior:c.feedChildren=!c.feedChildren;break;case le.CommandTribeSplit:a&&CI(a,n);break;case le.CommandBuild:t?c.build=!c.build:n.buildMenuOpen=!n.buildMenuOpen;break;case le.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case le.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case le.SelectRemovalTool:n.selectedBuildingType="removal";break;case le.SelectBorderPost:n.selectedBuildingType="borderPost";break;case le.SelectBonfire:n.selectedBuildingType="bonfire";break;case le.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const g=a.leaderId,m=e.targetTribeId,S=n.entities.entities[m],v=(u=a.tribeControl)==null?void 0:u.diplomacy,I=(f=S==null?void 0:S.tribeControl)==null?void 0:f.diplomacy;if(v&&I){const C=(v[m]||Ut.Friendly)===Ut.Friendly?Ut.Hostile:Ut.Friendly;v[m]=C,I[g]=C}}break;case le.OpenRoleManager:t?c.roleManagement=!c.roleManagement:n.roleManagerOpen=!0;break;case le.CloseRoleManager:n.roleManagerOpen=!1;break;case le.IncreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const g=a.tribeControl.roleWeights[e.targetRole]||0;g<10&&(a.tribeControl.roleWeights[e.targetRole]=g+1)}break;case le.DecreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const g=a.tribeControl.roleWeights[e.targetRole]||0;g>0&&(a.tribeControl.roleWeights[e.targetRole]=g-1)}break;case le.OpenArmyControl:n.armyControlOpen=!0;break;case le.CloseArmyControl:n.armyControlOpen=!1;break;case le.IncreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Pg,expandBorders:Dg,invadeEnemies:Ng});const g=a.tribeControl.armyControl[e.targetArmyObjective]||0;g<10&&(a.tribeControl.armyControl[e.targetArmyObjective]=g+1)}break;case le.DecreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Pg,expandBorders:Dg,invadeEnemies:Ng});const g=a.tribeControl.armyControl[e.targetArmyObjective]||0;g>0&&(a.tribeControl.armyControl[e.targetArmyObjective]=g-1)}break;case le.SwitchAIType:if(n.debugCharacterId){const g=n.entities.entities[n.debugCharacterId];g&&(g.aiType=g.aiType===$t.BehaviorTreeBased?$t.TaskBased:$t.BehaviorTreeBased)}break}return n};function hL(e,t,n){if(!e.notificationButtonRects)return!1;const i=vt(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return dw(e,s),i&&Me({gameState:e},Ce.ButtonClick,i.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const l=e.notifications.find(c=>c.id===s);if(l){let c=l.targetPosition;if(!c&&l.targetEntityIds&&l.targetEntityIds.length>0){const u=e.entities.entities[l.targetEntityIds[0]];u&&(c=u.position)}return c&&uL(e,c),i&&Me({gameState:e},Ce.ButtonClick,i.position),l.highlightedEntityIds&&(l.renderHighlights=!l.renderHighlights),!0}}return!1}function PT(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const gL=(e,t)=>{var n;if(t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(PT(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},pL=(e,t)=>t.debugPanel!==je.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:PT(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Ov=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},mL=(e,t)=>{var n,i;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const l=t.debugPanelRect.height-60,c=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.height)??0)-l);return t.debugPanelScroll.y>c&&(t.debugPanelScroll.y=c),{newState:t,handled:!0}}return{newState:t,handled:!1}},yL=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,returnToIntro:l})=>(Fe.useEffect(()=>{const c=u=>{if(!e()||t.current.gameOver||!n.current)return;const f=gL(u,t.current);t.current=f.newState,f.handled};return window.addEventListener("wheel",c,{passive:!1}),()=>{window.removeEventListener("wheel",c)}},[e,n,t]),Fe.useEffect(()=>{const c=f=>{if(!e()||t.current.gameOver||!n.current||!f.target||f.target!==n.current)return;const g=n.current.getBoundingClientRect(),m=f.clientX-g.left,S=f.clientY-g.top;if(hL(t.current,m,S))return;const I=t.current.uiButtons.find(P=>m>=P.rect.x&&m<=P.rect.x+P.rect.width&&S>=P.rect.y&&S<=P.rect.y+P.rect.height);if(I){t.current=fL(I,f.shiftKey,t.current,l);return}const A=pL(f,t.current);if(t.current=A.newState,A.handled)return;const C=Kg({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);sL(t.current,C)},u=f=>{if(!e()||!n.current)return;const g=Ov(f,t.current);t.current=g.newState};return window.addEventListener("mousedown",c),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",c),window.removeEventListener("mouseup",u)}},[e,n,t,i,l]),Fe.useEffect(()=>{const c=u=>{if(!e()||!n.current)return;const f=mL(u,t.current);if(t.current=f.newState,f.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const A=Ov(u,t.current);t.current=A.newState}const g=n.current.getBoundingClientRect(),m=u.clientX-g.left,S=u.clientY-g.top;t.current.mousePosition={x:m,y:S};let v;if(t.current.notificationButtonRects){for(const[A,C]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=C.x&&m<=C.x+C.width&&S>=C.y&&S<=C.y+C.height){v=`notification-dismiss-${A}`;break}if(!v){for(const[A,C]of Object.entries(t.current.notificationButtonRects.view))if(m>=C.x&&m<=C.x+C.width&&S>=C.y&&S<=C.y+C.height){v=`notification-view-${A}`;break}}}if(!v)for(let A=t.current.uiButtons.length-1;A>=0;A--){const C=t.current.uiButtons[A];if(m>=C.rect.x&&m<=C.rect.x+C.rect.width&&S>=C.rect.y&&S<=C.rect.y+C.rect.height){v=C.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0;return}const I=vt(t.current);if(I){const A=Kg({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=rL(A,I,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",c),()=>{window.removeEventListener("mousemove",c)}},[e,n,t,i]),Fe.useEffect(()=>{const c=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();(g===" "||g==="p"||g==="tab"||(f.ctrlKey||f.metaKey)&&(g==="s"||g==="a"))&&f.preventDefault();const m=aL(f,t.current);if(t.current=m.newState,m.handled)return;const S=vt(t.current);S&&(a.current.add(g),lL(g,f.shiftKey,t.current,S,s.current))},u=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();a.current.delete(g);const m=vt(t.current);m&&cL(g,m,t.current,a)};return window.addEventListener("keydown",c),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",c),window.removeEventListener("keyup",u)}},[e,t,s,a,l]),null),SL=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,canvasRef:l,setAppState:c,appState:u})=>{const f=Fe.useRef(),{returnToIntro:g}=Qr(),[m,S,v]=fT(I=>{var B,O;if(!t.current||!f.current){f.current=I;return}const A=Math.min(I-f.current,1e3)/1e3,{performanceMetrics:C}=e.current;C.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const P=performance.now();e.current=xu(e.current,A),C.currentBucket.worldUpdateTime=performance.now()-P;const R=vt(e.current);R?s.current=Bp(e.current,R):s.current=[],i.current=dL(e.current,i.current,A);const w=performance.now();hu(t.current,e.current,i.current,s.current,{width:((B=l.current)==null?void 0:B.width)||800,height:((O=l.current)==null?void 0:O.height)||600},!1),C.currentBucket.renderTime=performance.now()-w,C.history.push({bucketTime:e.current.time,...C.currentBucket}),C.history.length>YC&&C.history.shift(),f.current=I,e.current.gameOver&&u!=="gameOver"&&(Ap(Ce.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),c("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return Fe.useEffect(()=>(S(),m),[S,m]),Ue.jsx(yL,{isActive:v,gameStateRef:e,canvasRef:l,viewportCenterRef:i,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:g})},kv=()=>{const{savedGameState:e,contextReady:t}=Qr(),[n,i]=Fe.useState(null);return Fe.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),i(e)):(console.log("Initializing new game state..."),i(iL())))},[t,e]),!t||!n?Ue.jsx("div",{children:"Loading..."}):Ue.jsx(vL,{initialState:n})},vL=({initialState:e})=>{const t=Fe.useRef(null),n=Fe.useRef(null),i=Fe.useRef(e),s=Fe.useRef(new Set),a=Fe.useRef(e.debugPanel),l=Fe.useRef(e.viewportCenter),c=Fe.useRef([]),{appState:u,setAppState:f}=Qr();return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(oL,{canvasRef:t,ctxRef:n,gameStateRef:i,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:c}),Ue.jsx(SL,{gameStateRef:i,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:c,keysPressed:s,canvasRef:t,setAppState:f,appState:u})]})},AL=kt.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,IL=kt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Fd=kt.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,TL=kt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,EL=()=>{const{setAppState:e,gameOverDetails:t}=Qr(),n=()=>{e("intro")};return Ue.jsxs(AL,{children:[Ue.jsx(IL,{children:"Game Over"}),Ue.jsx(Fd,{children:"Your tribe's lineage has ended."}),t&&Ue.jsxs(Ue.Fragment,{children:[Ue.jsxs(Fd,{children:["Generations Survived: ",t.generations]}),Ue.jsxs(Fd,{children:["Cause of Extinction: ",t.cause]})]}),!t&&Ue.jsx(Fd,{children:"Game details are unavailable."}),Ue.jsx(TL,{onClick:n,children:"Return to Menu"})]})},CL=kt.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,_L=kt.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,wL=kt.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,RL=kt.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,PL=kt.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,DT=kt.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,DL=kt(DT)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,ml=800,yl=600,NL=()=>{const{returnToIntro:e}=Qr(),t=Fe.useRef(null),n=Fe.useRef(),i=Fe.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:ml,height:yl}}),s=l=>{const c={x:ml/2,y:yl/2};let u;l===Ee.StoneProjectile&&(u={x:c.x+200*(Math.random()-Math.random()),y:c.y+200*(Math.random()-Math.random())}),Ge(i.current,l,c,1,void 0,u)};Fe.useEffect(()=>{const l=()=>{i.current.time+=.016,pT(i.current);const u=t.current,f=u==null?void 0:u.getContext("2d");f&&(f.clearRect(0,0,ml,yl),f.fillStyle="#2c5234",f.fillRect(0,0,ml,yl),i.current.visualEffects.forEach(g=>{wT(f,g,i.current.time,i.current)})),n.current=requestAnimationFrame(l)};return n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(Ee).filter(l=>isNaN(Number(l))).map(l=>({name:l,value:Ee[l]}));return Ue.jsxs(CL,{children:[Ue.jsxs(_L,{children:[Ue.jsx(PL,{children:"Visual Effects"}),a.map(l=>Ue.jsx(DT,{onClick:()=>s(l.value),children:l.name},l.name)),Ue.jsx(DL,{onClick:e,children:"Back to Intro"})]}),Ue.jsxs(wL,{children:[Ue.jsx(RL,{ref:t,width:ml,height:yl}),Ue.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},ML=bk`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function OL(e,t){Fe.useEffect(()=>{const n=()=>{const i=document.location.hash;t(i==="#game"?"game":i==="#effects"?"effects":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),Fe.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const kL=()=>{const{appState:e,setAppState:t}=Qr();OL(e,t);const n=()=>{switch(e){case"intro":return Ue.jsx(Mv,{});case"game":return Ue.jsx(kv,{});case"effects":return Ue.jsx(NL,{});case"gameOver":return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(kv,{}),Ue.jsx(EL,{})]});default:return Ue.jsx(Mv,{})}};return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(ML,{}),n()]})},bv=document.getElementById("root");bv?NR().then(()=>{LC.createRoot(bv).render(Ue.jsx(ki.StrictMode,{children:Ue.jsx(kO,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:Ue.jsx(kL,{})})}))}):console.error("Failed to find the root element");
