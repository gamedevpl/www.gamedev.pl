var rC=Object.defineProperty;var sC=(e,t,n)=>t in e?rC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Pe=(e,t,n)=>sC(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const l of s.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(a){if(a.ep)return;a.ep=!0;const s=n(a);fetch(a.href,s)}})();function Ev(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ah={exports:{}},Qa={},Eh={exports:{}},We={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _y;function aC(){if(_y)return We;_y=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),g=Symbol.for("react.lazy"),m=Symbol.iterator;function S(b){return b===null||typeof b!="object"?null:(b=m&&b[m]||b["@@iterator"],typeof b=="function"?b:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},T=Object.assign,I={};function _(b,W,se){this.props=b,this.context=W,this.refs=I,this.updater=se||v}_.prototype.isReactComponent={},_.prototype.setState=function(b,W){if(typeof b!="object"&&typeof b!="function"&&b!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,b,W,"setState")},_.prototype.forceUpdate=function(b){this.updater.enqueueForceUpdate(this,b,"forceUpdate")};function N(){}N.prototype=_.prototype;function R(b,W,se){this.props=b,this.context=W,this.refs=I,this.updater=se||v}var w=R.prototype=new N;w.constructor=R,T(w,_.prototype),w.isPureReactComponent=!0;var B=Array.isArray,O=Object.prototype.hasOwnProperty,D={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function F(b,W,se){var fe,Re={},ge=null,Me=null;if(W!=null)for(fe in W.ref!==void 0&&(Me=W.ref),W.key!==void 0&&(ge=""+W.key),W)O.call(W,fe)&&!M.hasOwnProperty(fe)&&(Re[fe]=W[fe]);var De=arguments.length-2;if(De===1)Re.children=se;else if(1<De){for(var ae=Array(De),me=0;me<De;me++)ae[me]=arguments[me+2];Re.children=ae}if(b&&b.defaultProps)for(fe in De=b.defaultProps,De)Re[fe]===void 0&&(Re[fe]=De[fe]);return{$$typeof:e,type:b,key:ge,ref:Me,props:Re,_owner:D.current}}function x(b,W){return{$$typeof:e,type:b.type,key:W,ref:b.ref,props:b.props,_owner:b._owner}}function q(b){return typeof b=="object"&&b!==null&&b.$$typeof===e}function ee(b){var W={"=":"=0",":":"=2"};return"$"+b.replace(/[=:]/g,function(se){return W[se]})}var z=/\/+/g;function ne(b,W){return typeof b=="object"&&b!==null&&b.key!=null?ee(""+b.key):W.toString(36)}function ie(b,W,se,fe,Re){var ge=typeof b;(ge==="undefined"||ge==="boolean")&&(b=null);var Me=!1;if(b===null)Me=!0;else switch(ge){case"string":case"number":Me=!0;break;case"object":switch(b.$$typeof){case e:case t:Me=!0}}if(Me)return Me=b,Re=Re(Me),b=fe===""?"."+ne(Me,0):fe,B(Re)?(se="",b!=null&&(se=b.replace(z,"$&/")+"/"),ie(Re,W,se,"",function(me){return me})):Re!=null&&(q(Re)&&(Re=x(Re,se+(!Re.key||Me&&Me.key===Re.key?"":(""+Re.key).replace(z,"$&/")+"/")+b)),W.push(Re)),1;if(Me=0,fe=fe===""?".":fe+":",B(b))for(var De=0;De<b.length;De++){ge=b[De];var ae=fe+ne(ge,De);Me+=ie(ge,W,se,ae,Re)}else if(ae=S(b),typeof ae=="function")for(b=ae.call(b),De=0;!(ge=b.next()).done;)ge=ge.value,ae=fe+ne(ge,De++),Me+=ie(ge,W,se,ae,Re);else if(ge==="object")throw W=String(b),Error("Objects are not valid as a React child (found: "+(W==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":W)+"). If you meant to render a collection of children, use an array instead.");return Me}function Ee(b,W,se){if(b==null)return b;var fe=[],Re=0;return ie(b,fe,"","",function(ge){return W.call(se,ge,Re++)}),fe}function le(b){if(b._status===-1){var W=b._result;W=W(),W.then(function(se){(b._status===0||b._status===-1)&&(b._status=1,b._result=se)},function(se){(b._status===0||b._status===-1)&&(b._status=2,b._result=se)}),b._status===-1&&(b._status=0,b._result=W)}if(b._status===1)return b._result.default;throw b._result}var te={current:null},Y={transition:null},X={ReactCurrentDispatcher:te,ReactCurrentBatchConfig:Y,ReactCurrentOwner:D};function V(){throw Error("act(...) is not supported in production builds of React.")}return We.Children={map:Ee,forEach:function(b,W,se){Ee(b,function(){W.apply(this,arguments)},se)},count:function(b){var W=0;return Ee(b,function(){W++}),W},toArray:function(b){return Ee(b,function(W){return W})||[]},only:function(b){if(!q(b))throw Error("React.Children.only expected to receive a single React element child.");return b}},We.Component=_,We.Fragment=n,We.Profiler=a,We.PureComponent=R,We.StrictMode=i,We.Suspense=u,We.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X,We.act=V,We.cloneElement=function(b,W,se){if(b==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+b+".");var fe=T({},b.props),Re=b.key,ge=b.ref,Me=b._owner;if(W!=null){if(W.ref!==void 0&&(ge=W.ref,Me=D.current),W.key!==void 0&&(Re=""+W.key),b.type&&b.type.defaultProps)var De=b.type.defaultProps;for(ae in W)O.call(W,ae)&&!M.hasOwnProperty(ae)&&(fe[ae]=W[ae]===void 0&&De!==void 0?De[ae]:W[ae])}var ae=arguments.length-2;if(ae===1)fe.children=se;else if(1<ae){De=Array(ae);for(var me=0;me<ae;me++)De[me]=arguments[me+2];fe.children=De}return{$$typeof:e,type:b.type,key:Re,ref:ge,props:fe,_owner:Me}},We.createContext=function(b){return b={$$typeof:l,_currentValue:b,_currentValue2:b,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},b.Provider={$$typeof:s,_context:b},b.Consumer=b},We.createElement=F,We.createFactory=function(b){var W=F.bind(null,b);return W.type=b,W},We.createRef=function(){return{current:null}},We.forwardRef=function(b){return{$$typeof:c,render:b}},We.isValidElement=q,We.lazy=function(b){return{$$typeof:g,_payload:{_status:-1,_result:b},_init:le}},We.memo=function(b,W){return{$$typeof:f,type:b,compare:W===void 0?null:W}},We.startTransition=function(b){var W=Y.transition;Y.transition={};try{b()}finally{Y.transition=W}},We.unstable_act=V,We.useCallback=function(b,W){return te.current.useCallback(b,W)},We.useContext=function(b){return te.current.useContext(b)},We.useDebugValue=function(){},We.useDeferredValue=function(b){return te.current.useDeferredValue(b)},We.useEffect=function(b,W){return te.current.useEffect(b,W)},We.useId=function(){return te.current.useId()},We.useImperativeHandle=function(b,W,se){return te.current.useImperativeHandle(b,W,se)},We.useInsertionEffect=function(b,W){return te.current.useInsertionEffect(b,W)},We.useLayoutEffect=function(b,W){return te.current.useLayoutEffect(b,W)},We.useMemo=function(b,W){return te.current.useMemo(b,W)},We.useReducer=function(b,W,se){return te.current.useReducer(b,W,se)},We.useRef=function(b){return te.current.useRef(b)},We.useState=function(b){return te.current.useState(b)},We.useSyncExternalStore=function(b,W,se){return te.current.useSyncExternalStore(b,W,se)},We.useTransition=function(){return te.current.useTransition()},We.version="18.3.1",We}var wy;function Ug(){return wy||(wy=1,Eh.exports=aC()),Eh.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ry;function lC(){if(Ry)return Qa;Ry=1;var e=Ug(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function l(c,u,f){var g,m={},S=null,v=null;f!==void 0&&(S=""+f),u.key!==void 0&&(S=""+u.key),u.ref!==void 0&&(v=u.ref);for(g in u)i.call(u,g)&&!s.hasOwnProperty(g)&&(m[g]=u[g]);if(c&&c.defaultProps)for(g in u=c.defaultProps,u)m[g]===void 0&&(m[g]=u[g]);return{$$typeof:t,type:c,key:S,ref:v,props:m,_owner:a.current}}return Qa.Fragment=n,Qa.jsx=l,Qa.jsxs=l,Qa}var Py;function cC(){return Py||(Py=1,Ah.exports=lC()),Ah.exports}var Le=cC(),Be=Ug();const Di=Ev(Be);var rd={},Ch={exports:{}},vn={},_h={exports:{}},wh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dy;function dC(){return Dy||(Dy=1,function(e){function t(Y,X){var V=Y.length;Y.push(X);e:for(;0<V;){var b=V-1>>>1,W=Y[b];if(0<a(W,X))Y[b]=X,Y[V]=W,V=b;else break e}}function n(Y){return Y.length===0?null:Y[0]}function i(Y){if(Y.length===0)return null;var X=Y[0],V=Y.pop();if(V!==X){Y[0]=V;e:for(var b=0,W=Y.length,se=W>>>1;b<se;){var fe=2*(b+1)-1,Re=Y[fe],ge=fe+1,Me=Y[ge];if(0>a(Re,V))ge<W&&0>a(Me,Re)?(Y[b]=Me,Y[ge]=V,b=ge):(Y[b]=Re,Y[fe]=V,b=fe);else if(ge<W&&0>a(Me,V))Y[b]=Me,Y[ge]=V,b=ge;else break e}}return X}function a(Y,X){var V=Y.sortIndex-X.sortIndex;return V!==0?V:Y.id-X.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;e.unstable_now=function(){return s.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var u=[],f=[],g=1,m=null,S=3,v=!1,T=!1,I=!1,_=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(Y){for(var X=n(f);X!==null;){if(X.callback===null)i(f);else if(X.startTime<=Y)i(f),X.sortIndex=X.expirationTime,t(u,X);else break;X=n(f)}}function B(Y){if(I=!1,w(Y),!T)if(n(u)!==null)T=!0,le(O);else{var X=n(f);X!==null&&te(B,X.startTime-Y)}}function O(Y,X){T=!1,I&&(I=!1,N(F),F=-1),v=!0;var V=S;try{for(w(X),m=n(u);m!==null&&(!(m.expirationTime>X)||Y&&!ee());){var b=m.callback;if(typeof b=="function"){m.callback=null,S=m.priorityLevel;var W=b(m.expirationTime<=X);X=e.unstable_now(),typeof W=="function"?m.callback=W:m===n(u)&&i(u),w(X)}else i(u);m=n(u)}if(m!==null)var se=!0;else{var fe=n(f);fe!==null&&te(B,fe.startTime-X),se=!1}return se}finally{m=null,S=V,v=!1}}var D=!1,M=null,F=-1,x=5,q=-1;function ee(){return!(e.unstable_now()-q<x)}function z(){if(M!==null){var Y=e.unstable_now();q=Y;var X=!0;try{X=M(!0,Y)}finally{X?ne():(D=!1,M=null)}}else D=!1}var ne;if(typeof R=="function")ne=function(){R(z)};else if(typeof MessageChannel<"u"){var ie=new MessageChannel,Ee=ie.port2;ie.port1.onmessage=z,ne=function(){Ee.postMessage(null)}}else ne=function(){_(z,0)};function le(Y){M=Y,D||(D=!0,ne())}function te(Y,X){F=_(function(){Y(e.unstable_now())},X)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Y){Y.callback=null},e.unstable_continueExecution=function(){T||v||(T=!0,le(O))},e.unstable_forceFrameRate=function(Y){0>Y||125<Y?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<Y?Math.floor(1e3/Y):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(Y){switch(S){case 1:case 2:case 3:var X=3;break;default:X=S}var V=S;S=X;try{return Y()}finally{S=V}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Y,X){switch(Y){case 1:case 2:case 3:case 4:case 5:break;default:Y=3}var V=S;S=Y;try{return X()}finally{S=V}},e.unstable_scheduleCallback=function(Y,X,V){var b=e.unstable_now();switch(typeof V=="object"&&V!==null?(V=V.delay,V=typeof V=="number"&&0<V?b+V:b):V=b,Y){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=V+W,Y={id:g++,callback:X,priorityLevel:Y,startTime:V,expirationTime:W,sortIndex:-1},V>b?(Y.sortIndex=V,t(f,Y),n(u)===null&&Y===n(f)&&(I?(N(F),F=-1):I=!0,te(B,V-b))):(Y.sortIndex=W,t(u,Y),T||v||(T=!0,le(O))),Y},e.unstable_shouldYield=ee,e.unstable_wrapCallback=function(Y){var X=S;return function(){var V=S;S=X;try{return Y.apply(this,arguments)}finally{S=V}}}}(wh)),wh}var Ny;function uC(){return Ny||(Ny=1,_h.exports=dC()),_h.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var My;function fC(){if(My)return vn;My=1;var e=Ug(),t=uC();function n(o){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+o,d=1;d<arguments.length;d++)r+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+o+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,a={};function s(o,r){l(o,r),l(o+"Capture",r)}function l(o,r){for(a[o]=r,o=0;o<r.length;o++)i.add(r[o])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,g={},m={};function S(o){return u.call(m,o)?!0:u.call(g,o)?!1:f.test(o)?m[o]=!0:(g[o]=!0,!1)}function v(o,r,d,h){if(d!==null&&d.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return h?!1:d!==null?!d.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function T(o,r,d,h){if(r===null||typeof r>"u"||v(o,r,d,h))return!0;if(h)return!1;if(d!==null)switch(d.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function I(o,r,d,h,p,y,E){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=h,this.attributeNamespace=p,this.mustUseProperty=d,this.propertyName=o,this.type=r,this.sanitizeURL=y,this.removeEmptyString=E}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){_[o]=new I(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var r=o[0];_[r]=new I(r,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){_[o]=new I(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){_[o]=new I(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){_[o]=new I(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){_[o]=new I(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){_[o]=new I(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){_[o]=new I(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){_[o]=new I(o,5,!1,o.toLowerCase(),null,!1,!1)});var N=/[\-:]([a-z])/g;function R(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var r=o.replace(N,R);_[r]=new I(r,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var r=o.replace(N,R);_[r]=new I(r,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var r=o.replace(N,R);_[r]=new I(r,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){_[o]=new I(o,1,!1,o.toLowerCase(),null,!1,!1)}),_.xlinkHref=new I("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){_[o]=new I(o,1,!1,o.toLowerCase(),null,!0,!0)});function w(o,r,d,h){var p=_.hasOwnProperty(r)?_[r]:null;(p!==null?p.type!==0:h||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(T(r,d,p,h)&&(d=null),h||p===null?S(r)&&(d===null?o.removeAttribute(r):o.setAttribute(r,""+d)):p.mustUseProperty?o[p.propertyName]=d===null?p.type===3?!1:"":d:(r=p.attributeName,h=p.attributeNamespace,d===null?o.removeAttribute(r):(p=p.type,d=p===3||p===4&&d===!0?"":""+d,h?o.setAttributeNS(h,r,d):o.setAttribute(r,d))))}var B=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O=Symbol.for("react.element"),D=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),q=Symbol.for("react.provider"),ee=Symbol.for("react.context"),z=Symbol.for("react.forward_ref"),ne=Symbol.for("react.suspense"),ie=Symbol.for("react.suspense_list"),Ee=Symbol.for("react.memo"),le=Symbol.for("react.lazy"),te=Symbol.for("react.offscreen"),Y=Symbol.iterator;function X(o){return o===null||typeof o!="object"?null:(o=Y&&o[Y]||o["@@iterator"],typeof o=="function"?o:null)}var V=Object.assign,b;function W(o){if(b===void 0)try{throw Error()}catch(d){var r=d.stack.trim().match(/\n( *(at )?)/);b=r&&r[1]||""}return`
`+b+o}var se=!1;function fe(o,r){if(!o||se)return"";se=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch($){var h=$}Reflect.construct(o,[],r)}else{try{r.call()}catch($){h=$}o.call(r.prototype)}else{try{throw Error()}catch($){h=$}o()}}catch($){if($&&h&&typeof $.stack=="string"){for(var p=$.stack.split(`
`),y=h.stack.split(`
`),E=p.length-1,P=y.length-1;1<=E&&0<=P&&p[E]!==y[P];)P--;for(;1<=E&&0<=P;E--,P--)if(p[E]!==y[P]){if(E!==1||P!==1)do if(E--,P--,0>P||p[E]!==y[P]){var k=`
`+p[E].replace(" at new "," at ");return o.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",o.displayName)),k}while(1<=E&&0<=P);break}}}finally{se=!1,Error.prepareStackTrace=d}return(o=o?o.displayName||o.name:"")?W(o):""}function Re(o){switch(o.tag){case 5:return W(o.type);case 16:return W("Lazy");case 13:return W("Suspense");case 19:return W("SuspenseList");case 0:case 2:case 15:return o=fe(o.type,!1),o;case 11:return o=fe(o.type.render,!1),o;case 1:return o=fe(o.type,!0),o;default:return""}}function ge(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case M:return"Fragment";case D:return"Portal";case x:return"Profiler";case F:return"StrictMode";case ne:return"Suspense";case ie:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case ee:return(o.displayName||"Context")+".Consumer";case q:return(o._context.displayName||"Context")+".Provider";case z:var r=o.render;return o=o.displayName,o||(o=r.displayName||r.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case Ee:return r=o.displayName||null,r!==null?r:ge(o.type)||"Memo";case le:r=o._payload,o=o._init;try{return ge(o(r))}catch{}}return null}function Me(o){var r=o.type;switch(o.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=r.render,o=o.displayName||o.name||"",r.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ge(r);case 8:return r===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function De(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function ae(o){var r=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function me(o){var r=ae(o)?"checked":"value",d=Object.getOwnPropertyDescriptor(o.constructor.prototype,r),h=""+o[r];if(!o.hasOwnProperty(r)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var p=d.get,y=d.set;return Object.defineProperty(o,r,{configurable:!0,get:function(){return p.call(this)},set:function(E){h=""+E,y.call(this,E)}}),Object.defineProperty(o,r,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(E){h=""+E},stopTracking:function(){o._valueTracker=null,delete o[r]}}}}function $e(o){o._valueTracker||(o._valueTracker=me(o))}function ve(o){if(!o)return!1;var r=o._valueTracker;if(!r)return!0;var d=r.getValue(),h="";return o&&(h=ae(o)?o.checked?"true":"false":o.value),o=h,o!==d?(r.setValue(o),!0):!1}function Qn(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function tt(o,r){var d=r.checked;return V({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??o._wrapperState.initialChecked})}function at(o,r){var d=r.defaultValue==null?"":r.defaultValue,h=r.checked!=null?r.checked:r.defaultChecked;d=De(r.value!=null?r.value:d),o._wrapperState={initialChecked:h,initialValue:d,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function fi(o,r){r=r.checked,r!=null&&w(o,"checked",r,!1)}function hn(o,r){fi(o,r);var d=De(r.value),h=r.type;if(d!=null)h==="number"?(d===0&&o.value===""||o.value!=d)&&(o.value=""+d):o.value!==""+d&&(o.value=""+d);else if(h==="submit"||h==="reset"){o.removeAttribute("value");return}r.hasOwnProperty("value")?hi(o,r.type,d):r.hasOwnProperty("defaultValue")&&hi(o,r.type,De(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(o.defaultChecked=!!r.defaultChecked)}function Hn(o,r,d){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var h=r.type;if(!(h!=="submit"&&h!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+o._wrapperState.initialValue,d||r===o.value||(o.value=r),o.defaultValue=r}d=o.name,d!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,d!==""&&(o.name=d)}function hi(o,r,d){(r!=="number"||Qn(o.ownerDocument)!==o)&&(d==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+d&&(o.defaultValue=""+d))}var gi=Array.isArray;function ro(o,r,d,h){if(o=o.options,r){r={};for(var p=0;p<d.length;p++)r["$"+d[p]]=!0;for(d=0;d<o.length;d++)p=r.hasOwnProperty("$"+o[d].value),o[d].selected!==p&&(o[d].selected=p),p&&h&&(o[d].defaultSelected=!0)}else{for(d=""+De(d),r=null,p=0;p<o.length;p++){if(o[p].value===d){o[p].selected=!0,h&&(o[p].defaultSelected=!0);return}r!==null||o[p].disabled||(r=o[p])}r!==null&&(r.selected=!0)}}function Qo(o,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return V({},r,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function Bp(o,r){var d=r.value;if(d==null){if(d=r.children,r=r.defaultValue,d!=null){if(r!=null)throw Error(n(92));if(gi(d)){if(1<d.length)throw Error(n(93));d=d[0]}r=d}r==null&&(r=""),d=r}o._wrapperState={initialValue:De(d)}}function Fp(o,r){var d=De(r.value),h=De(r.defaultValue);d!=null&&(d=""+d,d!==o.value&&(o.value=d),r.defaultValue==null&&o.defaultValue!==d&&(o.defaultValue=d)),h!=null&&(o.defaultValue=""+h)}function Lp(o){var r=o.textContent;r===o._wrapperState.initialValue&&r!==""&&r!==null&&(o.value=r)}function Up(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Ou(o,r){return o==null||o==="http://www.w3.org/1999/xhtml"?Up(r):o==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var Zl,Hp=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,d,h,p){MSApp.execUnsafeLocalFunction(function(){return o(r,d,h,p)})}:o}(function(o,r){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=r;else{for(Zl=Zl||document.createElement("div"),Zl.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=Zl.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;r.firstChild;)o.appendChild(r.firstChild)}});function ga(o,r){if(r){var d=o.firstChild;if(d&&d===o.lastChild&&d.nodeType===3){d.nodeValue=r;return}}o.textContent=r}var pa={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},cA=["Webkit","ms","Moz","O"];Object.keys(pa).forEach(function(o){cA.forEach(function(r){r=r+o.charAt(0).toUpperCase()+o.substring(1),pa[r]=pa[o]})});function Gp(o,r,d){return r==null||typeof r=="boolean"||r===""?"":d||typeof r!="number"||r===0||pa.hasOwnProperty(o)&&pa[o]?(""+r).trim():r+"px"}function $p(o,r){o=o.style;for(var d in r)if(r.hasOwnProperty(d)){var h=d.indexOf("--")===0,p=Gp(d,r[d],h);d==="float"&&(d="cssFloat"),h?o.setProperty(d,p):o[d]=p}}var dA=V({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ku(o,r){if(r){if(dA[o]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,o));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function bu(o,r){if(o.indexOf("-")===-1)return typeof r.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Bu=null;function Fu(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Lu=null,Xr=null,Vr=null;function xp(o){if(o=La(o)){if(typeof Lu!="function")throw Error(n(280));var r=o.stateNode;r&&(r=Ic(r),Lu(o.stateNode,o.type,r))}}function Wp(o){Xr?Vr?Vr.push(o):Vr=[o]:Xr=o}function Yp(){if(Xr){var o=Xr,r=Vr;if(Vr=Xr=null,xp(o),r)for(o=0;o<r.length;o++)xp(r[o])}}function zp(o,r){return o(r)}function jp(){}var Uu=!1;function Xp(o,r,d){if(Uu)return o(r,d);Uu=!0;try{return zp(o,r,d)}finally{Uu=!1,(Xr!==null||Vr!==null)&&(jp(),Yp())}}function ma(o,r){var d=o.stateNode;if(d===null)return null;var h=Ic(d);if(h===null)return null;d=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(o=o.type,h=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!h;break e;default:o=!1}if(o)return null;if(d&&typeof d!="function")throw Error(n(231,r,typeof d));return d}var Hu=!1;if(c)try{var ya={};Object.defineProperty(ya,"passive",{get:function(){Hu=!0}}),window.addEventListener("test",ya,ya),window.removeEventListener("test",ya,ya)}catch{Hu=!1}function uA(o,r,d,h,p,y,E,P,k){var $=Array.prototype.slice.call(arguments,3);try{r.apply(d,$)}catch(K){this.onError(K)}}var Sa=!1,Ql=null,Jl=!1,Gu=null,fA={onError:function(o){Sa=!0,Ql=o}};function hA(o,r,d,h,p,y,E,P,k){Sa=!1,Ql=null,uA.apply(fA,arguments)}function gA(o,r,d,h,p,y,E,P,k){if(hA.apply(this,arguments),Sa){if(Sa){var $=Ql;Sa=!1,Ql=null}else throw Error(n(198));Jl||(Jl=!0,Gu=$)}}function Jo(o){var r=o,d=o;if(o.alternate)for(;r.return;)r=r.return;else{o=r;do r=o,(r.flags&4098)!==0&&(d=r.return),o=r.return;while(o)}return r.tag===3?d:null}function Vp(o){if(o.tag===13){var r=o.memoizedState;if(r===null&&(o=o.alternate,o!==null&&(r=o.memoizedState)),r!==null)return r.dehydrated}return null}function Kp(o){if(Jo(o)!==o)throw Error(n(188))}function pA(o){var r=o.alternate;if(!r){if(r=Jo(o),r===null)throw Error(n(188));return r!==o?null:o}for(var d=o,h=r;;){var p=d.return;if(p===null)break;var y=p.alternate;if(y===null){if(h=p.return,h!==null){d=h;continue}break}if(p.child===y.child){for(y=p.child;y;){if(y===d)return Kp(p),o;if(y===h)return Kp(p),r;y=y.sibling}throw Error(n(188))}if(d.return!==h.return)d=p,h=y;else{for(var E=!1,P=p.child;P;){if(P===d){E=!0,d=p,h=y;break}if(P===h){E=!0,h=p,d=y;break}P=P.sibling}if(!E){for(P=y.child;P;){if(P===d){E=!0,d=y,h=p;break}if(P===h){E=!0,h=y,d=p;break}P=P.sibling}if(!E)throw Error(n(189))}}if(d.alternate!==h)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?o:r}function qp(o){return o=pA(o),o!==null?Zp(o):null}function Zp(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var r=Zp(o);if(r!==null)return r;o=o.sibling}return null}var Qp=t.unstable_scheduleCallback,Jp=t.unstable_cancelCallback,mA=t.unstable_shouldYield,yA=t.unstable_requestPaint,vt=t.unstable_now,SA=t.unstable_getCurrentPriorityLevel,$u=t.unstable_ImmediatePriority,em=t.unstable_UserBlockingPriority,ec=t.unstable_NormalPriority,vA=t.unstable_LowPriority,tm=t.unstable_IdlePriority,tc=null,pi=null;function IA(o){if(pi&&typeof pi.onCommitFiberRoot=="function")try{pi.onCommitFiberRoot(tc,o,void 0,(o.current.flags&128)===128)}catch{}}var Jn=Math.clz32?Math.clz32:EA,TA=Math.log,AA=Math.LN2;function EA(o){return o>>>=0,o===0?32:31-(TA(o)/AA|0)|0}var nc=64,ic=4194304;function va(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function oc(o,r){var d=o.pendingLanes;if(d===0)return 0;var h=0,p=o.suspendedLanes,y=o.pingedLanes,E=d&268435455;if(E!==0){var P=E&~p;P!==0?h=va(P):(y&=E,y!==0&&(h=va(y)))}else E=d&~p,E!==0?h=va(E):y!==0&&(h=va(y));if(h===0)return 0;if(r!==0&&r!==h&&(r&p)===0&&(p=h&-h,y=r&-r,p>=y||p===16&&(y&4194240)!==0))return r;if((h&4)!==0&&(h|=d&16),r=o.entangledLanes,r!==0)for(o=o.entanglements,r&=h;0<r;)d=31-Jn(r),p=1<<d,h|=o[d],r&=~p;return h}function CA(o,r){switch(o){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function _A(o,r){for(var d=o.suspendedLanes,h=o.pingedLanes,p=o.expirationTimes,y=o.pendingLanes;0<y;){var E=31-Jn(y),P=1<<E,k=p[E];k===-1?((P&d)===0||(P&h)!==0)&&(p[E]=CA(P,r)):k<=r&&(o.expiredLanes|=P),y&=~P}}function xu(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function nm(){var o=nc;return nc<<=1,(nc&4194240)===0&&(nc=64),o}function Wu(o){for(var r=[],d=0;31>d;d++)r.push(o);return r}function Ia(o,r,d){o.pendingLanes|=r,r!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,r=31-Jn(r),o[r]=d}function wA(o,r){var d=o.pendingLanes&~r;o.pendingLanes=r,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=r,o.mutableReadLanes&=r,o.entangledLanes&=r,r=o.entanglements;var h=o.eventTimes;for(o=o.expirationTimes;0<d;){var p=31-Jn(d),y=1<<p;r[p]=0,h[p]=-1,o[p]=-1,d&=~y}}function Yu(o,r){var d=o.entangledLanes|=r;for(o=o.entanglements;d;){var h=31-Jn(d),p=1<<h;p&r|o[h]&r&&(o[h]|=r),d&=~p}}var et=0;function im(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var om,zu,rm,sm,am,ju=!1,rc=[],so=null,ao=null,lo=null,Ta=new Map,Aa=new Map,co=[],RA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function lm(o,r){switch(o){case"focusin":case"focusout":so=null;break;case"dragenter":case"dragleave":ao=null;break;case"mouseover":case"mouseout":lo=null;break;case"pointerover":case"pointerout":Ta.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Aa.delete(r.pointerId)}}function Ea(o,r,d,h,p,y){return o===null||o.nativeEvent!==y?(o={blockedOn:r,domEventName:d,eventSystemFlags:h,nativeEvent:y,targetContainers:[p]},r!==null&&(r=La(r),r!==null&&zu(r)),o):(o.eventSystemFlags|=h,r=o.targetContainers,p!==null&&r.indexOf(p)===-1&&r.push(p),o)}function PA(o,r,d,h,p){switch(r){case"focusin":return so=Ea(so,o,r,d,h,p),!0;case"dragenter":return ao=Ea(ao,o,r,d,h,p),!0;case"mouseover":return lo=Ea(lo,o,r,d,h,p),!0;case"pointerover":var y=p.pointerId;return Ta.set(y,Ea(Ta.get(y)||null,o,r,d,h,p)),!0;case"gotpointercapture":return y=p.pointerId,Aa.set(y,Ea(Aa.get(y)||null,o,r,d,h,p)),!0}return!1}function cm(o){var r=er(o.target);if(r!==null){var d=Jo(r);if(d!==null){if(r=d.tag,r===13){if(r=Vp(d),r!==null){o.blockedOn=r,am(o.priority,function(){rm(d)});return}}else if(r===3&&d.stateNode.current.memoizedState.isDehydrated){o.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}o.blockedOn=null}function sc(o){if(o.blockedOn!==null)return!1;for(var r=o.targetContainers;0<r.length;){var d=Vu(o.domEventName,o.eventSystemFlags,r[0],o.nativeEvent);if(d===null){d=o.nativeEvent;var h=new d.constructor(d.type,d);Bu=h,d.target.dispatchEvent(h),Bu=null}else return r=La(d),r!==null&&zu(r),o.blockedOn=d,!1;r.shift()}return!0}function dm(o,r,d){sc(o)&&d.delete(r)}function DA(){ju=!1,so!==null&&sc(so)&&(so=null),ao!==null&&sc(ao)&&(ao=null),lo!==null&&sc(lo)&&(lo=null),Ta.forEach(dm),Aa.forEach(dm)}function Ca(o,r){o.blockedOn===r&&(o.blockedOn=null,ju||(ju=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,DA)))}function _a(o){function r(p){return Ca(p,o)}if(0<rc.length){Ca(rc[0],o);for(var d=1;d<rc.length;d++){var h=rc[d];h.blockedOn===o&&(h.blockedOn=null)}}for(so!==null&&Ca(so,o),ao!==null&&Ca(ao,o),lo!==null&&Ca(lo,o),Ta.forEach(r),Aa.forEach(r),d=0;d<co.length;d++)h=co[d],h.blockedOn===o&&(h.blockedOn=null);for(;0<co.length&&(d=co[0],d.blockedOn===null);)cm(d),d.blockedOn===null&&co.shift()}var Kr=B.ReactCurrentBatchConfig,ac=!0;function NA(o,r,d,h){var p=et,y=Kr.transition;Kr.transition=null;try{et=1,Xu(o,r,d,h)}finally{et=p,Kr.transition=y}}function MA(o,r,d,h){var p=et,y=Kr.transition;Kr.transition=null;try{et=4,Xu(o,r,d,h)}finally{et=p,Kr.transition=y}}function Xu(o,r,d,h){if(ac){var p=Vu(o,r,d,h);if(p===null)ff(o,r,h,lc,d),lm(o,h);else if(PA(p,o,r,d,h))h.stopPropagation();else if(lm(o,h),r&4&&-1<RA.indexOf(o)){for(;p!==null;){var y=La(p);if(y!==null&&om(y),y=Vu(o,r,d,h),y===null&&ff(o,r,h,lc,d),y===p)break;p=y}p!==null&&h.stopPropagation()}else ff(o,r,h,null,d)}}var lc=null;function Vu(o,r,d,h){if(lc=null,o=Fu(h),o=er(o),o!==null)if(r=Jo(o),r===null)o=null;else if(d=r.tag,d===13){if(o=Vp(r),o!==null)return o;o=null}else if(d===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;o=null}else r!==o&&(o=null);return lc=o,null}function um(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(SA()){case $u:return 1;case em:return 4;case ec:case vA:return 16;case tm:return 536870912;default:return 16}default:return 16}}var uo=null,Ku=null,cc=null;function fm(){if(cc)return cc;var o,r=Ku,d=r.length,h,p="value"in uo?uo.value:uo.textContent,y=p.length;for(o=0;o<d&&r[o]===p[o];o++);var E=d-o;for(h=1;h<=E&&r[d-h]===p[y-h];h++);return cc=p.slice(o,1<h?1-h:void 0)}function dc(o){var r=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&r===13&&(o=13)):o=r,o===10&&(o=13),32<=o||o===13?o:0}function uc(){return!0}function hm(){return!1}function Rn(o){function r(d,h,p,y,E){this._reactName=d,this._targetInst=p,this.type=h,this.nativeEvent=y,this.target=E,this.currentTarget=null;for(var P in o)o.hasOwnProperty(P)&&(d=o[P],this[P]=d?d(y):y[P]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?uc:hm,this.isPropagationStopped=hm,this}return V(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=uc)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=uc)},persist:function(){},isPersistent:uc}),r}var qr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qu=Rn(qr),wa=V({},qr,{view:0,detail:0}),OA=Rn(wa),Zu,Qu,Ra,fc=V({},wa,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ef,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Ra&&(Ra&&o.type==="mousemove"?(Zu=o.screenX-Ra.screenX,Qu=o.screenY-Ra.screenY):Qu=Zu=0,Ra=o),Zu)},movementY:function(o){return"movementY"in o?o.movementY:Qu}}),gm=Rn(fc),kA=V({},fc,{dataTransfer:0}),bA=Rn(kA),BA=V({},wa,{relatedTarget:0}),Ju=Rn(BA),FA=V({},qr,{animationName:0,elapsedTime:0,pseudoElement:0}),LA=Rn(FA),UA=V({},qr,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),HA=Rn(UA),GA=V({},qr,{data:0}),pm=Rn(GA),$A={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},WA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function YA(o){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(o):(o=WA[o])?!!r[o]:!1}function ef(){return YA}var zA=V({},wa,{key:function(o){if(o.key){var r=$A[o.key]||o.key;if(r!=="Unidentified")return r}return o.type==="keypress"?(o=dc(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?xA[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ef,charCode:function(o){return o.type==="keypress"?dc(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?dc(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),jA=Rn(zA),XA=V({},fc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mm=Rn(XA),VA=V({},wa,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ef}),KA=Rn(VA),qA=V({},qr,{propertyName:0,elapsedTime:0,pseudoElement:0}),ZA=Rn(qA),QA=V({},fc,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),JA=Rn(QA),eE=[9,13,27,32],tf=c&&"CompositionEvent"in window,Pa=null;c&&"documentMode"in document&&(Pa=document.documentMode);var tE=c&&"TextEvent"in window&&!Pa,ym=c&&(!tf||Pa&&8<Pa&&11>=Pa),Sm=" ",vm=!1;function Im(o,r){switch(o){case"keyup":return eE.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Tm(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Zr=!1;function nE(o,r){switch(o){case"compositionend":return Tm(r);case"keypress":return r.which!==32?null:(vm=!0,Sm);case"textInput":return o=r.data,o===Sm&&vm?null:o;default:return null}}function iE(o,r){if(Zr)return o==="compositionend"||!tf&&Im(o,r)?(o=fm(),cc=Ku=uo=null,Zr=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return ym&&r.locale!=="ko"?null:r.data;default:return null}}var oE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Am(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r==="input"?!!oE[o.type]:r==="textarea"}function Em(o,r,d,h){Wp(h),r=yc(r,"onChange"),0<r.length&&(d=new qu("onChange","change",null,d,h),o.push({event:d,listeners:r}))}var Da=null,Na=null;function rE(o){$m(o,0)}function hc(o){var r=ns(o);if(ve(r))return o}function sE(o,r){if(o==="change")return r}var Cm=!1;if(c){var nf;if(c){var of="oninput"in document;if(!of){var _m=document.createElement("div");_m.setAttribute("oninput","return;"),of=typeof _m.oninput=="function"}nf=of}else nf=!1;Cm=nf&&(!document.documentMode||9<document.documentMode)}function wm(){Da&&(Da.detachEvent("onpropertychange",Rm),Na=Da=null)}function Rm(o){if(o.propertyName==="value"&&hc(Na)){var r=[];Em(r,Na,o,Fu(o)),Xp(rE,r)}}function aE(o,r,d){o==="focusin"?(wm(),Da=r,Na=d,Da.attachEvent("onpropertychange",Rm)):o==="focusout"&&wm()}function lE(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return hc(Na)}function cE(o,r){if(o==="click")return hc(r)}function dE(o,r){if(o==="input"||o==="change")return hc(r)}function uE(o,r){return o===r&&(o!==0||1/o===1/r)||o!==o&&r!==r}var ei=typeof Object.is=="function"?Object.is:uE;function Ma(o,r){if(ei(o,r))return!0;if(typeof o!="object"||o===null||typeof r!="object"||r===null)return!1;var d=Object.keys(o),h=Object.keys(r);if(d.length!==h.length)return!1;for(h=0;h<d.length;h++){var p=d[h];if(!u.call(r,p)||!ei(o[p],r[p]))return!1}return!0}function Pm(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Dm(o,r){var d=Pm(o);o=0;for(var h;d;){if(d.nodeType===3){if(h=o+d.textContent.length,o<=r&&h>=r)return{node:d,offset:r-o};o=h}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Pm(d)}}function Nm(o,r){return o&&r?o===r?!0:o&&o.nodeType===3?!1:r&&r.nodeType===3?Nm(o,r.parentNode):"contains"in o?o.contains(r):o.compareDocumentPosition?!!(o.compareDocumentPosition(r)&16):!1:!1}function Mm(){for(var o=window,r=Qn();r instanceof o.HTMLIFrameElement;){try{var d=typeof r.contentWindow.location.href=="string"}catch{d=!1}if(d)o=r.contentWindow;else break;r=Qn(o.document)}return r}function rf(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r&&(r==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||r==="textarea"||o.contentEditable==="true")}function fE(o){var r=Mm(),d=o.focusedElem,h=o.selectionRange;if(r!==d&&d&&d.ownerDocument&&Nm(d.ownerDocument.documentElement,d)){if(h!==null&&rf(d)){if(r=h.start,o=h.end,o===void 0&&(o=r),"selectionStart"in d)d.selectionStart=r,d.selectionEnd=Math.min(o,d.value.length);else if(o=(r=d.ownerDocument||document)&&r.defaultView||window,o.getSelection){o=o.getSelection();var p=d.textContent.length,y=Math.min(h.start,p);h=h.end===void 0?y:Math.min(h.end,p),!o.extend&&y>h&&(p=h,h=y,y=p),p=Dm(d,y);var E=Dm(d,h);p&&E&&(o.rangeCount!==1||o.anchorNode!==p.node||o.anchorOffset!==p.offset||o.focusNode!==E.node||o.focusOffset!==E.offset)&&(r=r.createRange(),r.setStart(p.node,p.offset),o.removeAllRanges(),y>h?(o.addRange(r),o.extend(E.node,E.offset)):(r.setEnd(E.node,E.offset),o.addRange(r)))}}for(r=[],o=d;o=o.parentNode;)o.nodeType===1&&r.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<r.length;d++)o=r[d],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var hE=c&&"documentMode"in document&&11>=document.documentMode,Qr=null,sf=null,Oa=null,af=!1;function Om(o,r,d){var h=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;af||Qr==null||Qr!==Qn(h)||(h=Qr,"selectionStart"in h&&rf(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Oa&&Ma(Oa,h)||(Oa=h,h=yc(sf,"onSelect"),0<h.length&&(r=new qu("onSelect","select",null,r,d),o.push({event:r,listeners:h}),r.target=Qr)))}function gc(o,r){var d={};return d[o.toLowerCase()]=r.toLowerCase(),d["Webkit"+o]="webkit"+r,d["Moz"+o]="moz"+r,d}var Jr={animationend:gc("Animation","AnimationEnd"),animationiteration:gc("Animation","AnimationIteration"),animationstart:gc("Animation","AnimationStart"),transitionend:gc("Transition","TransitionEnd")},lf={},km={};c&&(km=document.createElement("div").style,"AnimationEvent"in window||(delete Jr.animationend.animation,delete Jr.animationiteration.animation,delete Jr.animationstart.animation),"TransitionEvent"in window||delete Jr.transitionend.transition);function pc(o){if(lf[o])return lf[o];if(!Jr[o])return o;var r=Jr[o],d;for(d in r)if(r.hasOwnProperty(d)&&d in km)return lf[o]=r[d];return o}var bm=pc("animationend"),Bm=pc("animationiteration"),Fm=pc("animationstart"),Lm=pc("transitionend"),Um=new Map,Hm="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fo(o,r){Um.set(o,r),s(r,[o])}for(var cf=0;cf<Hm.length;cf++){var df=Hm[cf],gE=df.toLowerCase(),pE=df[0].toUpperCase()+df.slice(1);fo(gE,"on"+pE)}fo(bm,"onAnimationEnd"),fo(Bm,"onAnimationIteration"),fo(Fm,"onAnimationStart"),fo("dblclick","onDoubleClick"),fo("focusin","onFocus"),fo("focusout","onBlur"),fo(Lm,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ka="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mE=new Set("cancel close invalid load scroll toggle".split(" ").concat(ka));function Gm(o,r,d){var h=o.type||"unknown-event";o.currentTarget=d,gA(h,r,void 0,o),o.currentTarget=null}function $m(o,r){r=(r&4)!==0;for(var d=0;d<o.length;d++){var h=o[d],p=h.event;h=h.listeners;e:{var y=void 0;if(r)for(var E=h.length-1;0<=E;E--){var P=h[E],k=P.instance,$=P.currentTarget;if(P=P.listener,k!==y&&p.isPropagationStopped())break e;Gm(p,P,$),y=k}else for(E=0;E<h.length;E++){if(P=h[E],k=P.instance,$=P.currentTarget,P=P.listener,k!==y&&p.isPropagationStopped())break e;Gm(p,P,$),y=k}}}if(Jl)throw o=Gu,Jl=!1,Gu=null,o}function lt(o,r){var d=r[Sf];d===void 0&&(d=r[Sf]=new Set);var h=o+"__bubble";d.has(h)||(xm(r,o,2,!1),d.add(h))}function uf(o,r,d){var h=0;r&&(h|=4),xm(d,o,h,r)}var mc="_reactListening"+Math.random().toString(36).slice(2);function ba(o){if(!o[mc]){o[mc]=!0,i.forEach(function(d){d!=="selectionchange"&&(mE.has(d)||uf(d,!1,o),uf(d,!0,o))});var r=o.nodeType===9?o:o.ownerDocument;r===null||r[mc]||(r[mc]=!0,uf("selectionchange",!1,r))}}function xm(o,r,d,h){switch(um(r)){case 1:var p=NA;break;case 4:p=MA;break;default:p=Xu}d=p.bind(null,r,d,o),p=void 0,!Hu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(p=!0),h?p!==void 0?o.addEventListener(r,d,{capture:!0,passive:p}):o.addEventListener(r,d,!0):p!==void 0?o.addEventListener(r,d,{passive:p}):o.addEventListener(r,d,!1)}function ff(o,r,d,h,p){var y=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var E=h.tag;if(E===3||E===4){var P=h.stateNode.containerInfo;if(P===p||P.nodeType===8&&P.parentNode===p)break;if(E===4)for(E=h.return;E!==null;){var k=E.tag;if((k===3||k===4)&&(k=E.stateNode.containerInfo,k===p||k.nodeType===8&&k.parentNode===p))return;E=E.return}for(;P!==null;){if(E=er(P),E===null)return;if(k=E.tag,k===5||k===6){h=y=E;continue e}P=P.parentNode}}h=h.return}Xp(function(){var $=y,K=Fu(d),Z=[];e:{var j=Um.get(o);if(j!==void 0){var ue=qu,ye=o;switch(o){case"keypress":if(dc(d)===0)break e;case"keydown":case"keyup":ue=jA;break;case"focusin":ye="focus",ue=Ju;break;case"focusout":ye="blur",ue=Ju;break;case"beforeblur":case"afterblur":ue=Ju;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ue=gm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ue=bA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ue=KA;break;case bm:case Bm:case Fm:ue=LA;break;case Lm:ue=ZA;break;case"scroll":ue=OA;break;case"wheel":ue=JA;break;case"copy":case"cut":case"paste":ue=HA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ue=mm}var Ie=(r&4)!==0,It=!Ie&&o==="scroll",U=Ie?j!==null?j+"Capture":null:j;Ie=[];for(var L=$,H;L!==null;){H=L;var Q=H.stateNode;if(H.tag===5&&Q!==null&&(H=Q,U!==null&&(Q=ma(L,U),Q!=null&&Ie.push(Ba(L,Q,H)))),It)break;L=L.return}0<Ie.length&&(j=new ue(j,ye,null,d,K),Z.push({event:j,listeners:Ie}))}}if((r&7)===0){e:{if(j=o==="mouseover"||o==="pointerover",ue=o==="mouseout"||o==="pointerout",j&&d!==Bu&&(ye=d.relatedTarget||d.fromElement)&&(er(ye)||ye[Bi]))break e;if((ue||j)&&(j=K.window===K?K:(j=K.ownerDocument)?j.defaultView||j.parentWindow:window,ue?(ye=d.relatedTarget||d.toElement,ue=$,ye=ye?er(ye):null,ye!==null&&(It=Jo(ye),ye!==It||ye.tag!==5&&ye.tag!==6)&&(ye=null)):(ue=null,ye=$),ue!==ye)){if(Ie=gm,Q="onMouseLeave",U="onMouseEnter",L="mouse",(o==="pointerout"||o==="pointerover")&&(Ie=mm,Q="onPointerLeave",U="onPointerEnter",L="pointer"),It=ue==null?j:ns(ue),H=ye==null?j:ns(ye),j=new Ie(Q,L+"leave",ue,d,K),j.target=It,j.relatedTarget=H,Q=null,er(K)===$&&(Ie=new Ie(U,L+"enter",ye,d,K),Ie.target=H,Ie.relatedTarget=It,Q=Ie),It=Q,ue&&ye)t:{for(Ie=ue,U=ye,L=0,H=Ie;H;H=es(H))L++;for(H=0,Q=U;Q;Q=es(Q))H++;for(;0<L-H;)Ie=es(Ie),L--;for(;0<H-L;)U=es(U),H--;for(;L--;){if(Ie===U||U!==null&&Ie===U.alternate)break t;Ie=es(Ie),U=es(U)}Ie=null}else Ie=null;ue!==null&&Wm(Z,j,ue,Ie,!1),ye!==null&&It!==null&&Wm(Z,It,ye,Ie,!0)}}e:{if(j=$?ns($):window,ue=j.nodeName&&j.nodeName.toLowerCase(),ue==="select"||ue==="input"&&j.type==="file")var Ce=sE;else if(Am(j))if(Cm)Ce=dE;else{Ce=lE;var Oe=aE}else(ue=j.nodeName)&&ue.toLowerCase()==="input"&&(j.type==="checkbox"||j.type==="radio")&&(Ce=cE);if(Ce&&(Ce=Ce(o,$))){Em(Z,Ce,d,K);break e}Oe&&Oe(o,j,$),o==="focusout"&&(Oe=j._wrapperState)&&Oe.controlled&&j.type==="number"&&hi(j,"number",j.value)}switch(Oe=$?ns($):window,o){case"focusin":(Am(Oe)||Oe.contentEditable==="true")&&(Qr=Oe,sf=$,Oa=null);break;case"focusout":Oa=sf=Qr=null;break;case"mousedown":af=!0;break;case"contextmenu":case"mouseup":case"dragend":af=!1,Om(Z,d,K);break;case"selectionchange":if(hE)break;case"keydown":case"keyup":Om(Z,d,K)}var ke;if(tf)e:{switch(o){case"compositionstart":var Ue="onCompositionStart";break e;case"compositionend":Ue="onCompositionEnd";break e;case"compositionupdate":Ue="onCompositionUpdate";break e}Ue=void 0}else Zr?Im(o,d)&&(Ue="onCompositionEnd"):o==="keydown"&&d.keyCode===229&&(Ue="onCompositionStart");Ue&&(ym&&d.locale!=="ko"&&(Zr||Ue!=="onCompositionStart"?Ue==="onCompositionEnd"&&Zr&&(ke=fm()):(uo=K,Ku="value"in uo?uo.value:uo.textContent,Zr=!0)),Oe=yc($,Ue),0<Oe.length&&(Ue=new pm(Ue,o,null,d,K),Z.push({event:Ue,listeners:Oe}),ke?Ue.data=ke:(ke=Tm(d),ke!==null&&(Ue.data=ke)))),(ke=tE?nE(o,d):iE(o,d))&&($=yc($,"onBeforeInput"),0<$.length&&(K=new pm("onBeforeInput","beforeinput",null,d,K),Z.push({event:K,listeners:$}),K.data=ke))}$m(Z,r)})}function Ba(o,r,d){return{instance:o,listener:r,currentTarget:d}}function yc(o,r){for(var d=r+"Capture",h=[];o!==null;){var p=o,y=p.stateNode;p.tag===5&&y!==null&&(p=y,y=ma(o,d),y!=null&&h.unshift(Ba(o,y,p)),y=ma(o,r),y!=null&&h.push(Ba(o,y,p))),o=o.return}return h}function es(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function Wm(o,r,d,h,p){for(var y=r._reactName,E=[];d!==null&&d!==h;){var P=d,k=P.alternate,$=P.stateNode;if(k!==null&&k===h)break;P.tag===5&&$!==null&&(P=$,p?(k=ma(d,y),k!=null&&E.unshift(Ba(d,k,P))):p||(k=ma(d,y),k!=null&&E.push(Ba(d,k,P)))),d=d.return}E.length!==0&&o.push({event:r,listeners:E})}var yE=/\r\n?/g,SE=/\u0000|\uFFFD/g;function Ym(o){return(typeof o=="string"?o:""+o).replace(yE,`
`).replace(SE,"")}function Sc(o,r,d){if(r=Ym(r),Ym(o)!==r&&d)throw Error(n(425))}function vc(){}var hf=null,gf=null;function pf(o,r){return o==="textarea"||o==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var mf=typeof setTimeout=="function"?setTimeout:void 0,vE=typeof clearTimeout=="function"?clearTimeout:void 0,zm=typeof Promise=="function"?Promise:void 0,IE=typeof queueMicrotask=="function"?queueMicrotask:typeof zm<"u"?function(o){return zm.resolve(null).then(o).catch(TE)}:mf;function TE(o){setTimeout(function(){throw o})}function yf(o,r){var d=r,h=0;do{var p=d.nextSibling;if(o.removeChild(d),p&&p.nodeType===8)if(d=p.data,d==="/$"){if(h===0){o.removeChild(p),_a(r);return}h--}else d!=="$"&&d!=="$?"&&d!=="$!"||h++;d=p}while(d);_a(r)}function ho(o){for(;o!=null;o=o.nextSibling){var r=o.nodeType;if(r===1||r===3)break;if(r===8){if(r=o.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return o}function jm(o){o=o.previousSibling;for(var r=0;o;){if(o.nodeType===8){var d=o.data;if(d==="$"||d==="$!"||d==="$?"){if(r===0)return o;r--}else d==="/$"&&r++}o=o.previousSibling}return null}var ts=Math.random().toString(36).slice(2),mi="__reactFiber$"+ts,Fa="__reactProps$"+ts,Bi="__reactContainer$"+ts,Sf="__reactEvents$"+ts,AE="__reactListeners$"+ts,EE="__reactHandles$"+ts;function er(o){var r=o[mi];if(r)return r;for(var d=o.parentNode;d;){if(r=d[Bi]||d[mi]){if(d=r.alternate,r.child!==null||d!==null&&d.child!==null)for(o=jm(o);o!==null;){if(d=o[mi])return d;o=jm(o)}return r}o=d,d=o.parentNode}return null}function La(o){return o=o[mi]||o[Bi],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function ns(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(n(33))}function Ic(o){return o[Fa]||null}var vf=[],is=-1;function go(o){return{current:o}}function ct(o){0>is||(o.current=vf[is],vf[is]=null,is--)}function st(o,r){is++,vf[is]=o.current,o.current=r}var po={},zt=go(po),gn=go(!1),tr=po;function os(o,r){var d=o.type.contextTypes;if(!d)return po;var h=o.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===r)return h.__reactInternalMemoizedMaskedChildContext;var p={},y;for(y in d)p[y]=r[y];return h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=r,o.__reactInternalMemoizedMaskedChildContext=p),p}function pn(o){return o=o.childContextTypes,o!=null}function Tc(){ct(gn),ct(zt)}function Xm(o,r,d){if(zt.current!==po)throw Error(n(168));st(zt,r),st(gn,d)}function Vm(o,r,d){var h=o.stateNode;if(r=r.childContextTypes,typeof h.getChildContext!="function")return d;h=h.getChildContext();for(var p in h)if(!(p in r))throw Error(n(108,Me(o)||"Unknown",p));return V({},d,h)}function Ac(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||po,tr=zt.current,st(zt,o),st(gn,gn.current),!0}function Km(o,r,d){var h=o.stateNode;if(!h)throw Error(n(169));d?(o=Vm(o,r,tr),h.__reactInternalMemoizedMergedChildContext=o,ct(gn),ct(zt),st(zt,o)):ct(gn),st(gn,d)}var Fi=null,Ec=!1,If=!1;function qm(o){Fi===null?Fi=[o]:Fi.push(o)}function CE(o){Ec=!0,qm(o)}function mo(){if(!If&&Fi!==null){If=!0;var o=0,r=et;try{var d=Fi;for(et=1;o<d.length;o++){var h=d[o];do h=h(!0);while(h!==null)}Fi=null,Ec=!1}catch(p){throw Fi!==null&&(Fi=Fi.slice(o+1)),Qp($u,mo),p}finally{et=r,If=!1}}return null}var rs=[],ss=0,Cc=null,_c=0,Gn=[],$n=0,nr=null,Li=1,Ui="";function ir(o,r){rs[ss++]=_c,rs[ss++]=Cc,Cc=o,_c=r}function Zm(o,r,d){Gn[$n++]=Li,Gn[$n++]=Ui,Gn[$n++]=nr,nr=o;var h=Li;o=Ui;var p=32-Jn(h)-1;h&=~(1<<p),d+=1;var y=32-Jn(r)+p;if(30<y){var E=p-p%5;y=(h&(1<<E)-1).toString(32),h>>=E,p-=E,Li=1<<32-Jn(r)+p|d<<p|h,Ui=y+o}else Li=1<<y|d<<p|h,Ui=o}function Tf(o){o.return!==null&&(ir(o,1),Zm(o,1,0))}function Af(o){for(;o===Cc;)Cc=rs[--ss],rs[ss]=null,_c=rs[--ss],rs[ss]=null;for(;o===nr;)nr=Gn[--$n],Gn[$n]=null,Ui=Gn[--$n],Gn[$n]=null,Li=Gn[--$n],Gn[$n]=null}var Pn=null,Dn=null,ut=!1,ti=null;function Qm(o,r){var d=zn(5,null,null,0);d.elementType="DELETED",d.stateNode=r,d.return=o,r=o.deletions,r===null?(o.deletions=[d],o.flags|=16):r.push(d)}function Jm(o,r){switch(o.tag){case 5:var d=o.type;return r=r.nodeType!==1||d.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(o.stateNode=r,Pn=o,Dn=ho(r.firstChild),!0):!1;case 6:return r=o.pendingProps===""||r.nodeType!==3?null:r,r!==null?(o.stateNode=r,Pn=o,Dn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(d=nr!==null?{id:Li,overflow:Ui}:null,o.memoizedState={dehydrated:r,treeContext:d,retryLane:1073741824},d=zn(18,null,null,0),d.stateNode=r,d.return=o,o.child=d,Pn=o,Dn=null,!0):!1;default:return!1}}function Ef(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Cf(o){if(ut){var r=Dn;if(r){var d=r;if(!Jm(o,r)){if(Ef(o))throw Error(n(418));r=ho(d.nextSibling);var h=Pn;r&&Jm(o,r)?Qm(h,d):(o.flags=o.flags&-4097|2,ut=!1,Pn=o)}}else{if(Ef(o))throw Error(n(418));o.flags=o.flags&-4097|2,ut=!1,Pn=o}}}function e0(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;Pn=o}function wc(o){if(o!==Pn)return!1;if(!ut)return e0(o),ut=!0,!1;var r;if((r=o.tag!==3)&&!(r=o.tag!==5)&&(r=o.type,r=r!=="head"&&r!=="body"&&!pf(o.type,o.memoizedProps)),r&&(r=Dn)){if(Ef(o))throw t0(),Error(n(418));for(;r;)Qm(o,r),r=ho(r.nextSibling)}if(e0(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,r=0;o;){if(o.nodeType===8){var d=o.data;if(d==="/$"){if(r===0){Dn=ho(o.nextSibling);break e}r--}else d!=="$"&&d!=="$!"&&d!=="$?"||r++}o=o.nextSibling}Dn=null}}else Dn=Pn?ho(o.stateNode.nextSibling):null;return!0}function t0(){for(var o=Dn;o;)o=ho(o.nextSibling)}function as(){Dn=Pn=null,ut=!1}function _f(o){ti===null?ti=[o]:ti.push(o)}var _E=B.ReactCurrentBatchConfig;function Ua(o,r,d){if(o=d.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(n(309));var h=d.stateNode}if(!h)throw Error(n(147,o));var p=h,y=""+o;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===y?r.ref:(r=function(E){var P=p.refs;E===null?delete P[y]:P[y]=E},r._stringRef=y,r)}if(typeof o!="string")throw Error(n(284));if(!d._owner)throw Error(n(290,o))}return o}function Rc(o,r){throw o=Object.prototype.toString.call(r),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o))}function n0(o){var r=o._init;return r(o._payload)}function i0(o){function r(U,L){if(o){var H=U.deletions;H===null?(U.deletions=[L],U.flags|=16):H.push(L)}}function d(U,L){if(!o)return null;for(;L!==null;)r(U,L),L=L.sibling;return null}function h(U,L){for(U=new Map;L!==null;)L.key!==null?U.set(L.key,L):U.set(L.index,L),L=L.sibling;return U}function p(U,L){return U=Co(U,L),U.index=0,U.sibling=null,U}function y(U,L,H){return U.index=H,o?(H=U.alternate,H!==null?(H=H.index,H<L?(U.flags|=2,L):H):(U.flags|=2,L)):(U.flags|=1048576,L)}function E(U){return o&&U.alternate===null&&(U.flags|=2),U}function P(U,L,H,Q){return L===null||L.tag!==6?(L=mh(H,U.mode,Q),L.return=U,L):(L=p(L,H),L.return=U,L)}function k(U,L,H,Q){var Ce=H.type;return Ce===M?K(U,L,H.props.children,Q,H.key):L!==null&&(L.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===le&&n0(Ce)===L.type)?(Q=p(L,H.props),Q.ref=Ua(U,L,H),Q.return=U,Q):(Q=Zc(H.type,H.key,H.props,null,U.mode,Q),Q.ref=Ua(U,L,H),Q.return=U,Q)}function $(U,L,H,Q){return L===null||L.tag!==4||L.stateNode.containerInfo!==H.containerInfo||L.stateNode.implementation!==H.implementation?(L=yh(H,U.mode,Q),L.return=U,L):(L=p(L,H.children||[]),L.return=U,L)}function K(U,L,H,Q,Ce){return L===null||L.tag!==7?(L=ur(H,U.mode,Q,Ce),L.return=U,L):(L=p(L,H),L.return=U,L)}function Z(U,L,H){if(typeof L=="string"&&L!==""||typeof L=="number")return L=mh(""+L,U.mode,H),L.return=U,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case O:return H=Zc(L.type,L.key,L.props,null,U.mode,H),H.ref=Ua(U,null,L),H.return=U,H;case D:return L=yh(L,U.mode,H),L.return=U,L;case le:var Q=L._init;return Z(U,Q(L._payload),H)}if(gi(L)||X(L))return L=ur(L,U.mode,H,null),L.return=U,L;Rc(U,L)}return null}function j(U,L,H,Q){var Ce=L!==null?L.key:null;if(typeof H=="string"&&H!==""||typeof H=="number")return Ce!==null?null:P(U,L,""+H,Q);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case O:return H.key===Ce?k(U,L,H,Q):null;case D:return H.key===Ce?$(U,L,H,Q):null;case le:return Ce=H._init,j(U,L,Ce(H._payload),Q)}if(gi(H)||X(H))return Ce!==null?null:K(U,L,H,Q,null);Rc(U,H)}return null}function ue(U,L,H,Q,Ce){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return U=U.get(H)||null,P(L,U,""+Q,Ce);if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case O:return U=U.get(Q.key===null?H:Q.key)||null,k(L,U,Q,Ce);case D:return U=U.get(Q.key===null?H:Q.key)||null,$(L,U,Q,Ce);case le:var Oe=Q._init;return ue(U,L,H,Oe(Q._payload),Ce)}if(gi(Q)||X(Q))return U=U.get(H)||null,K(L,U,Q,Ce,null);Rc(L,Q)}return null}function ye(U,L,H,Q){for(var Ce=null,Oe=null,ke=L,Ue=L=0,kt=null;ke!==null&&Ue<H.length;Ue++){ke.index>Ue?(kt=ke,ke=null):kt=ke.sibling;var Ke=j(U,ke,H[Ue],Q);if(Ke===null){ke===null&&(ke=kt);break}o&&ke&&Ke.alternate===null&&r(U,ke),L=y(Ke,L,Ue),Oe===null?Ce=Ke:Oe.sibling=Ke,Oe=Ke,ke=kt}if(Ue===H.length)return d(U,ke),ut&&ir(U,Ue),Ce;if(ke===null){for(;Ue<H.length;Ue++)ke=Z(U,H[Ue],Q),ke!==null&&(L=y(ke,L,Ue),Oe===null?Ce=ke:Oe.sibling=ke,Oe=ke);return ut&&ir(U,Ue),Ce}for(ke=h(U,ke);Ue<H.length;Ue++)kt=ue(ke,U,Ue,H[Ue],Q),kt!==null&&(o&&kt.alternate!==null&&ke.delete(kt.key===null?Ue:kt.key),L=y(kt,L,Ue),Oe===null?Ce=kt:Oe.sibling=kt,Oe=kt);return o&&ke.forEach(function(_o){return r(U,_o)}),ut&&ir(U,Ue),Ce}function Ie(U,L,H,Q){var Ce=X(H);if(typeof Ce!="function")throw Error(n(150));if(H=Ce.call(H),H==null)throw Error(n(151));for(var Oe=Ce=null,ke=L,Ue=L=0,kt=null,Ke=H.next();ke!==null&&!Ke.done;Ue++,Ke=H.next()){ke.index>Ue?(kt=ke,ke=null):kt=ke.sibling;var _o=j(U,ke,Ke.value,Q);if(_o===null){ke===null&&(ke=kt);break}o&&ke&&_o.alternate===null&&r(U,ke),L=y(_o,L,Ue),Oe===null?Ce=_o:Oe.sibling=_o,Oe=_o,ke=kt}if(Ke.done)return d(U,ke),ut&&ir(U,Ue),Ce;if(ke===null){for(;!Ke.done;Ue++,Ke=H.next())Ke=Z(U,Ke.value,Q),Ke!==null&&(L=y(Ke,L,Ue),Oe===null?Ce=Ke:Oe.sibling=Ke,Oe=Ke);return ut&&ir(U,Ue),Ce}for(ke=h(U,ke);!Ke.done;Ue++,Ke=H.next())Ke=ue(ke,U,Ue,Ke.value,Q),Ke!==null&&(o&&Ke.alternate!==null&&ke.delete(Ke.key===null?Ue:Ke.key),L=y(Ke,L,Ue),Oe===null?Ce=Ke:Oe.sibling=Ke,Oe=Ke);return o&&ke.forEach(function(oC){return r(U,oC)}),ut&&ir(U,Ue),Ce}function It(U,L,H,Q){if(typeof H=="object"&&H!==null&&H.type===M&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case O:e:{for(var Ce=H.key,Oe=L;Oe!==null;){if(Oe.key===Ce){if(Ce=H.type,Ce===M){if(Oe.tag===7){d(U,Oe.sibling),L=p(Oe,H.props.children),L.return=U,U=L;break e}}else if(Oe.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===le&&n0(Ce)===Oe.type){d(U,Oe.sibling),L=p(Oe,H.props),L.ref=Ua(U,Oe,H),L.return=U,U=L;break e}d(U,Oe);break}else r(U,Oe);Oe=Oe.sibling}H.type===M?(L=ur(H.props.children,U.mode,Q,H.key),L.return=U,U=L):(Q=Zc(H.type,H.key,H.props,null,U.mode,Q),Q.ref=Ua(U,L,H),Q.return=U,U=Q)}return E(U);case D:e:{for(Oe=H.key;L!==null;){if(L.key===Oe)if(L.tag===4&&L.stateNode.containerInfo===H.containerInfo&&L.stateNode.implementation===H.implementation){d(U,L.sibling),L=p(L,H.children||[]),L.return=U,U=L;break e}else{d(U,L);break}else r(U,L);L=L.sibling}L=yh(H,U.mode,Q),L.return=U,U=L}return E(U);case le:return Oe=H._init,It(U,L,Oe(H._payload),Q)}if(gi(H))return ye(U,L,H,Q);if(X(H))return Ie(U,L,H,Q);Rc(U,H)}return typeof H=="string"&&H!==""||typeof H=="number"?(H=""+H,L!==null&&L.tag===6?(d(U,L.sibling),L=p(L,H),L.return=U,U=L):(d(U,L),L=mh(H,U.mode,Q),L.return=U,U=L),E(U)):d(U,L)}return It}var ls=i0(!0),o0=i0(!1),Pc=go(null),Dc=null,cs=null,wf=null;function Rf(){wf=cs=Dc=null}function Pf(o){var r=Pc.current;ct(Pc),o._currentValue=r}function Df(o,r,d){for(;o!==null;){var h=o.alternate;if((o.childLanes&r)!==r?(o.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),o===d)break;o=o.return}}function ds(o,r){Dc=o,wf=cs=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&r)!==0&&(mn=!0),o.firstContext=null)}function xn(o){var r=o._currentValue;if(wf!==o)if(o={context:o,memoizedValue:r,next:null},cs===null){if(Dc===null)throw Error(n(308));cs=o,Dc.dependencies={lanes:0,firstContext:o}}else cs=cs.next=o;return r}var or=null;function Nf(o){or===null?or=[o]:or.push(o)}function r0(o,r,d,h){var p=r.interleaved;return p===null?(d.next=d,Nf(r)):(d.next=p.next,p.next=d),r.interleaved=d,Hi(o,h)}function Hi(o,r){o.lanes|=r;var d=o.alternate;for(d!==null&&(d.lanes|=r),d=o,o=o.return;o!==null;)o.childLanes|=r,d=o.alternate,d!==null&&(d.childLanes|=r),d=o,o=o.return;return d.tag===3?d.stateNode:null}var yo=!1;function Mf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function s0(o,r){o=o.updateQueue,r.updateQueue===o&&(r.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function Gi(o,r){return{eventTime:o,lane:r,tag:0,payload:null,callback:null,next:null}}function So(o,r,d){var h=o.updateQueue;if(h===null)return null;if(h=h.shared,(je&2)!==0){var p=h.pending;return p===null?r.next=r:(r.next=p.next,p.next=r),h.pending=r,Hi(o,d)}return p=h.interleaved,p===null?(r.next=r,Nf(h)):(r.next=p.next,p.next=r),h.interleaved=r,Hi(o,d)}function Nc(o,r,d){if(r=r.updateQueue,r!==null&&(r=r.shared,(d&4194240)!==0)){var h=r.lanes;h&=o.pendingLanes,d|=h,r.lanes=d,Yu(o,d)}}function a0(o,r){var d=o.updateQueue,h=o.alternate;if(h!==null&&(h=h.updateQueue,d===h)){var p=null,y=null;if(d=d.firstBaseUpdate,d!==null){do{var E={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};y===null?p=y=E:y=y.next=E,d=d.next}while(d!==null);y===null?p=y=r:y=y.next=r}else p=y=r;d={baseState:h.baseState,firstBaseUpdate:p,lastBaseUpdate:y,shared:h.shared,effects:h.effects},o.updateQueue=d;return}o=d.lastBaseUpdate,o===null?d.firstBaseUpdate=r:o.next=r,d.lastBaseUpdate=r}function Mc(o,r,d,h){var p=o.updateQueue;yo=!1;var y=p.firstBaseUpdate,E=p.lastBaseUpdate,P=p.shared.pending;if(P!==null){p.shared.pending=null;var k=P,$=k.next;k.next=null,E===null?y=$:E.next=$,E=k;var K=o.alternate;K!==null&&(K=K.updateQueue,P=K.lastBaseUpdate,P!==E&&(P===null?K.firstBaseUpdate=$:P.next=$,K.lastBaseUpdate=k))}if(y!==null){var Z=p.baseState;E=0,K=$=k=null,P=y;do{var j=P.lane,ue=P.eventTime;if((h&j)===j){K!==null&&(K=K.next={eventTime:ue,lane:0,tag:P.tag,payload:P.payload,callback:P.callback,next:null});e:{var ye=o,Ie=P;switch(j=r,ue=d,Ie.tag){case 1:if(ye=Ie.payload,typeof ye=="function"){Z=ye.call(ue,Z,j);break e}Z=ye;break e;case 3:ye.flags=ye.flags&-65537|128;case 0:if(ye=Ie.payload,j=typeof ye=="function"?ye.call(ue,Z,j):ye,j==null)break e;Z=V({},Z,j);break e;case 2:yo=!0}}P.callback!==null&&P.lane!==0&&(o.flags|=64,j=p.effects,j===null?p.effects=[P]:j.push(P))}else ue={eventTime:ue,lane:j,tag:P.tag,payload:P.payload,callback:P.callback,next:null},K===null?($=K=ue,k=Z):K=K.next=ue,E|=j;if(P=P.next,P===null){if(P=p.shared.pending,P===null)break;j=P,P=j.next,j.next=null,p.lastBaseUpdate=j,p.shared.pending=null}}while(!0);if(K===null&&(k=Z),p.baseState=k,p.firstBaseUpdate=$,p.lastBaseUpdate=K,r=p.shared.interleaved,r!==null){p=r;do E|=p.lane,p=p.next;while(p!==r)}else y===null&&(p.shared.lanes=0);ar|=E,o.lanes=E,o.memoizedState=Z}}function l0(o,r,d){if(o=r.effects,r.effects=null,o!==null)for(r=0;r<o.length;r++){var h=o[r],p=h.callback;if(p!==null){if(h.callback=null,h=d,typeof p!="function")throw Error(n(191,p));p.call(h)}}}var Ha={},yi=go(Ha),Ga=go(Ha),$a=go(Ha);function rr(o){if(o===Ha)throw Error(n(174));return o}function Of(o,r){switch(st($a,r),st(Ga,o),st(yi,Ha),o=r.nodeType,o){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Ou(null,"");break;default:o=o===8?r.parentNode:r,r=o.namespaceURI||null,o=o.tagName,r=Ou(r,o)}ct(yi),st(yi,r)}function us(){ct(yi),ct(Ga),ct($a)}function c0(o){rr($a.current);var r=rr(yi.current),d=Ou(r,o.type);r!==d&&(st(Ga,o),st(yi,d))}function kf(o){Ga.current===o&&(ct(yi),ct(Ga))}var ht=go(0);function Oc(o){for(var r=o;r!==null;){if(r.tag===13){var d=r.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var bf=[];function Bf(){for(var o=0;o<bf.length;o++)bf[o]._workInProgressVersionPrimary=null;bf.length=0}var kc=B.ReactCurrentDispatcher,Ff=B.ReactCurrentBatchConfig,sr=0,gt=null,Pt=null,Mt=null,bc=!1,xa=!1,Wa=0,wE=0;function jt(){throw Error(n(321))}function Lf(o,r){if(r===null)return!1;for(var d=0;d<r.length&&d<o.length;d++)if(!ei(o[d],r[d]))return!1;return!0}function Uf(o,r,d,h,p,y){if(sr=y,gt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,kc.current=o===null||o.memoizedState===null?NE:ME,o=d(h,p),xa){y=0;do{if(xa=!1,Wa=0,25<=y)throw Error(n(301));y+=1,Mt=Pt=null,r.updateQueue=null,kc.current=OE,o=d(h,p)}while(xa)}if(kc.current=Lc,r=Pt!==null&&Pt.next!==null,sr=0,Mt=Pt=gt=null,bc=!1,r)throw Error(n(300));return o}function Hf(){var o=Wa!==0;return Wa=0,o}function Si(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Mt===null?gt.memoizedState=Mt=o:Mt=Mt.next=o,Mt}function Wn(){if(Pt===null){var o=gt.alternate;o=o!==null?o.memoizedState:null}else o=Pt.next;var r=Mt===null?gt.memoizedState:Mt.next;if(r!==null)Mt=r,Pt=o;else{if(o===null)throw Error(n(310));Pt=o,o={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},Mt===null?gt.memoizedState=Mt=o:Mt=Mt.next=o}return Mt}function Ya(o,r){return typeof r=="function"?r(o):r}function Gf(o){var r=Wn(),d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var h=Pt,p=h.baseQueue,y=d.pending;if(y!==null){if(p!==null){var E=p.next;p.next=y.next,y.next=E}h.baseQueue=p=y,d.pending=null}if(p!==null){y=p.next,h=h.baseState;var P=E=null,k=null,$=y;do{var K=$.lane;if((sr&K)===K)k!==null&&(k=k.next={lane:0,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null}),h=$.hasEagerState?$.eagerState:o(h,$.action);else{var Z={lane:K,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null};k===null?(P=k=Z,E=h):k=k.next=Z,gt.lanes|=K,ar|=K}$=$.next}while($!==null&&$!==y);k===null?E=h:k.next=P,ei(h,r.memoizedState)||(mn=!0),r.memoizedState=h,r.baseState=E,r.baseQueue=k,d.lastRenderedState=h}if(o=d.interleaved,o!==null){p=o;do y=p.lane,gt.lanes|=y,ar|=y,p=p.next;while(p!==o)}else p===null&&(d.lanes=0);return[r.memoizedState,d.dispatch]}function $f(o){var r=Wn(),d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var h=d.dispatch,p=d.pending,y=r.memoizedState;if(p!==null){d.pending=null;var E=p=p.next;do y=o(y,E.action),E=E.next;while(E!==p);ei(y,r.memoizedState)||(mn=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),d.lastRenderedState=y}return[y,h]}function d0(){}function u0(o,r){var d=gt,h=Wn(),p=r(),y=!ei(h.memoizedState,p);if(y&&(h.memoizedState=p,mn=!0),h=h.queue,xf(g0.bind(null,d,h,o),[o]),h.getSnapshot!==r||y||Mt!==null&&Mt.memoizedState.tag&1){if(d.flags|=2048,za(9,h0.bind(null,d,h,p,r),void 0,null),Ot===null)throw Error(n(349));(sr&30)!==0||f0(d,r,p)}return p}function f0(o,r,d){o.flags|=16384,o={getSnapshot:r,value:d},r=gt.updateQueue,r===null?(r={lastEffect:null,stores:null},gt.updateQueue=r,r.stores=[o]):(d=r.stores,d===null?r.stores=[o]:d.push(o))}function h0(o,r,d,h){r.value=d,r.getSnapshot=h,p0(r)&&m0(o)}function g0(o,r,d){return d(function(){p0(r)&&m0(o)})}function p0(o){var r=o.getSnapshot;o=o.value;try{var d=r();return!ei(o,d)}catch{return!0}}function m0(o){var r=Hi(o,1);r!==null&&ri(r,o,1,-1)}function y0(o){var r=Si();return typeof o=="function"&&(o=o()),r.memoizedState=r.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ya,lastRenderedState:o},r.queue=o,o=o.dispatch=DE.bind(null,gt,o),[r.memoizedState,o]}function za(o,r,d,h){return o={tag:o,create:r,destroy:d,deps:h,next:null},r=gt.updateQueue,r===null?(r={lastEffect:null,stores:null},gt.updateQueue=r,r.lastEffect=o.next=o):(d=r.lastEffect,d===null?r.lastEffect=o.next=o:(h=d.next,d.next=o,o.next=h,r.lastEffect=o)),o}function S0(){return Wn().memoizedState}function Bc(o,r,d,h){var p=Si();gt.flags|=o,p.memoizedState=za(1|r,d,void 0,h===void 0?null:h)}function Fc(o,r,d,h){var p=Wn();h=h===void 0?null:h;var y=void 0;if(Pt!==null){var E=Pt.memoizedState;if(y=E.destroy,h!==null&&Lf(h,E.deps)){p.memoizedState=za(r,d,y,h);return}}gt.flags|=o,p.memoizedState=za(1|r,d,y,h)}function v0(o,r){return Bc(8390656,8,o,r)}function xf(o,r){return Fc(2048,8,o,r)}function I0(o,r){return Fc(4,2,o,r)}function T0(o,r){return Fc(4,4,o,r)}function A0(o,r){if(typeof r=="function")return o=o(),r(o),function(){r(null)};if(r!=null)return o=o(),r.current=o,function(){r.current=null}}function E0(o,r,d){return d=d!=null?d.concat([o]):null,Fc(4,4,A0.bind(null,r,o),d)}function Wf(){}function C0(o,r){var d=Wn();r=r===void 0?null:r;var h=d.memoizedState;return h!==null&&r!==null&&Lf(r,h[1])?h[0]:(d.memoizedState=[o,r],o)}function _0(o,r){var d=Wn();r=r===void 0?null:r;var h=d.memoizedState;return h!==null&&r!==null&&Lf(r,h[1])?h[0]:(o=o(),d.memoizedState=[o,r],o)}function w0(o,r,d){return(sr&21)===0?(o.baseState&&(o.baseState=!1,mn=!0),o.memoizedState=d):(ei(d,r)||(d=nm(),gt.lanes|=d,ar|=d,o.baseState=!0),r)}function RE(o,r){var d=et;et=d!==0&&4>d?d:4,o(!0);var h=Ff.transition;Ff.transition={};try{o(!1),r()}finally{et=d,Ff.transition=h}}function R0(){return Wn().memoizedState}function PE(o,r,d){var h=Ao(o);if(d={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null},P0(o))D0(r,d);else if(d=r0(o,r,d,h),d!==null){var p=tn();ri(d,o,h,p),N0(d,r,h)}}function DE(o,r,d){var h=Ao(o),p={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null};if(P0(o))D0(r,p);else{var y=o.alternate;if(o.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var E=r.lastRenderedState,P=y(E,d);if(p.hasEagerState=!0,p.eagerState=P,ei(P,E)){var k=r.interleaved;k===null?(p.next=p,Nf(r)):(p.next=k.next,k.next=p),r.interleaved=p;return}}catch{}finally{}d=r0(o,r,p,h),d!==null&&(p=tn(),ri(d,o,h,p),N0(d,r,h))}}function P0(o){var r=o.alternate;return o===gt||r!==null&&r===gt}function D0(o,r){xa=bc=!0;var d=o.pending;d===null?r.next=r:(r.next=d.next,d.next=r),o.pending=r}function N0(o,r,d){if((d&4194240)!==0){var h=r.lanes;h&=o.pendingLanes,d|=h,r.lanes=d,Yu(o,d)}}var Lc={readContext:xn,useCallback:jt,useContext:jt,useEffect:jt,useImperativeHandle:jt,useInsertionEffect:jt,useLayoutEffect:jt,useMemo:jt,useReducer:jt,useRef:jt,useState:jt,useDebugValue:jt,useDeferredValue:jt,useTransition:jt,useMutableSource:jt,useSyncExternalStore:jt,useId:jt,unstable_isNewReconciler:!1},NE={readContext:xn,useCallback:function(o,r){return Si().memoizedState=[o,r===void 0?null:r],o},useContext:xn,useEffect:v0,useImperativeHandle:function(o,r,d){return d=d!=null?d.concat([o]):null,Bc(4194308,4,A0.bind(null,r,o),d)},useLayoutEffect:function(o,r){return Bc(4194308,4,o,r)},useInsertionEffect:function(o,r){return Bc(4,2,o,r)},useMemo:function(o,r){var d=Si();return r=r===void 0?null:r,o=o(),d.memoizedState=[o,r],o},useReducer:function(o,r,d){var h=Si();return r=d!==void 0?d(r):r,h.memoizedState=h.baseState=r,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:r},h.queue=o,o=o.dispatch=PE.bind(null,gt,o),[h.memoizedState,o]},useRef:function(o){var r=Si();return o={current:o},r.memoizedState=o},useState:y0,useDebugValue:Wf,useDeferredValue:function(o){return Si().memoizedState=o},useTransition:function(){var o=y0(!1),r=o[0];return o=RE.bind(null,o[1]),Si().memoizedState=o,[r,o]},useMutableSource:function(){},useSyncExternalStore:function(o,r,d){var h=gt,p=Si();if(ut){if(d===void 0)throw Error(n(407));d=d()}else{if(d=r(),Ot===null)throw Error(n(349));(sr&30)!==0||f0(h,r,d)}p.memoizedState=d;var y={value:d,getSnapshot:r};return p.queue=y,v0(g0.bind(null,h,y,o),[o]),h.flags|=2048,za(9,h0.bind(null,h,y,d,r),void 0,null),d},useId:function(){var o=Si(),r=Ot.identifierPrefix;if(ut){var d=Ui,h=Li;d=(h&~(1<<32-Jn(h)-1)).toString(32)+d,r=":"+r+"R"+d,d=Wa++,0<d&&(r+="H"+d.toString(32)),r+=":"}else d=wE++,r=":"+r+"r"+d.toString(32)+":";return o.memoizedState=r},unstable_isNewReconciler:!1},ME={readContext:xn,useCallback:C0,useContext:xn,useEffect:xf,useImperativeHandle:E0,useInsertionEffect:I0,useLayoutEffect:T0,useMemo:_0,useReducer:Gf,useRef:S0,useState:function(){return Gf(Ya)},useDebugValue:Wf,useDeferredValue:function(o){var r=Wn();return w0(r,Pt.memoizedState,o)},useTransition:function(){var o=Gf(Ya)[0],r=Wn().memoizedState;return[o,r]},useMutableSource:d0,useSyncExternalStore:u0,useId:R0,unstable_isNewReconciler:!1},OE={readContext:xn,useCallback:C0,useContext:xn,useEffect:xf,useImperativeHandle:E0,useInsertionEffect:I0,useLayoutEffect:T0,useMemo:_0,useReducer:$f,useRef:S0,useState:function(){return $f(Ya)},useDebugValue:Wf,useDeferredValue:function(o){var r=Wn();return Pt===null?r.memoizedState=o:w0(r,Pt.memoizedState,o)},useTransition:function(){var o=$f(Ya)[0],r=Wn().memoizedState;return[o,r]},useMutableSource:d0,useSyncExternalStore:u0,useId:R0,unstable_isNewReconciler:!1};function ni(o,r){if(o&&o.defaultProps){r=V({},r),o=o.defaultProps;for(var d in o)r[d]===void 0&&(r[d]=o[d]);return r}return r}function Yf(o,r,d,h){r=o.memoizedState,d=d(h,r),d=d==null?r:V({},r,d),o.memoizedState=d,o.lanes===0&&(o.updateQueue.baseState=d)}var Uc={isMounted:function(o){return(o=o._reactInternals)?Jo(o)===o:!1},enqueueSetState:function(o,r,d){o=o._reactInternals;var h=tn(),p=Ao(o),y=Gi(h,p);y.payload=r,d!=null&&(y.callback=d),r=So(o,y,p),r!==null&&(ri(r,o,p,h),Nc(r,o,p))},enqueueReplaceState:function(o,r,d){o=o._reactInternals;var h=tn(),p=Ao(o),y=Gi(h,p);y.tag=1,y.payload=r,d!=null&&(y.callback=d),r=So(o,y,p),r!==null&&(ri(r,o,p,h),Nc(r,o,p))},enqueueForceUpdate:function(o,r){o=o._reactInternals;var d=tn(),h=Ao(o),p=Gi(d,h);p.tag=2,r!=null&&(p.callback=r),r=So(o,p,h),r!==null&&(ri(r,o,h,d),Nc(r,o,h))}};function M0(o,r,d,h,p,y,E){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(h,y,E):r.prototype&&r.prototype.isPureReactComponent?!Ma(d,h)||!Ma(p,y):!0}function O0(o,r,d){var h=!1,p=po,y=r.contextType;return typeof y=="object"&&y!==null?y=xn(y):(p=pn(r)?tr:zt.current,h=r.contextTypes,y=(h=h!=null)?os(o,p):po),r=new r(d,y),o.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Uc,o.stateNode=r,r._reactInternals=o,h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=p,o.__reactInternalMemoizedMaskedChildContext=y),r}function k0(o,r,d,h){o=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(d,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(d,h),r.state!==o&&Uc.enqueueReplaceState(r,r.state,null)}function zf(o,r,d,h){var p=o.stateNode;p.props=d,p.state=o.memoizedState,p.refs={},Mf(o);var y=r.contextType;typeof y=="object"&&y!==null?p.context=xn(y):(y=pn(r)?tr:zt.current,p.context=os(o,y)),p.state=o.memoizedState,y=r.getDerivedStateFromProps,typeof y=="function"&&(Yf(o,r,y,d),p.state=o.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(r=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),r!==p.state&&Uc.enqueueReplaceState(p,p.state,null),Mc(o,d,p,h),p.state=o.memoizedState),typeof p.componentDidMount=="function"&&(o.flags|=4194308)}function fs(o,r){try{var d="",h=r;do d+=Re(h),h=h.return;while(h);var p=d}catch(y){p=`
Error generating stack: `+y.message+`
`+y.stack}return{value:o,source:r,stack:p,digest:null}}function jf(o,r,d){return{value:o,source:null,stack:d??null,digest:r??null}}function Xf(o,r){try{console.error(r.value)}catch(d){setTimeout(function(){throw d})}}var kE=typeof WeakMap=="function"?WeakMap:Map;function b0(o,r,d){d=Gi(-1,d),d.tag=3,d.payload={element:null};var h=r.value;return d.callback=function(){zc||(zc=!0,lh=h),Xf(o,r)},d}function B0(o,r,d){d=Gi(-1,d),d.tag=3;var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var p=r.value;d.payload=function(){return h(p)},d.callback=function(){Xf(o,r)}}var y=o.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(d.callback=function(){Xf(o,r),typeof h!="function"&&(Io===null?Io=new Set([this]):Io.add(this));var E=r.stack;this.componentDidCatch(r.value,{componentStack:E!==null?E:""})}),d}function F0(o,r,d){var h=o.pingCache;if(h===null){h=o.pingCache=new kE;var p=new Set;h.set(r,p)}else p=h.get(r),p===void 0&&(p=new Set,h.set(r,p));p.has(d)||(p.add(d),o=XE.bind(null,o,r,d),r.then(o,o))}function L0(o){do{var r;if((r=o.tag===13)&&(r=o.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return o;o=o.return}while(o!==null);return null}function U0(o,r,d,h,p){return(o.mode&1)===0?(o===r?o.flags|=65536:(o.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(r=Gi(-1,1),r.tag=2,So(d,r,1))),d.lanes|=1),o):(o.flags|=65536,o.lanes=p,o)}var bE=B.ReactCurrentOwner,mn=!1;function en(o,r,d,h){r.child=o===null?o0(r,null,d,h):ls(r,o.child,d,h)}function H0(o,r,d,h,p){d=d.render;var y=r.ref;return ds(r,p),h=Uf(o,r,d,h,y,p),d=Hf(),o!==null&&!mn?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,$i(o,r,p)):(ut&&d&&Tf(r),r.flags|=1,en(o,r,h,p),r.child)}function G0(o,r,d,h,p){if(o===null){var y=d.type;return typeof y=="function"&&!ph(y)&&y.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(r.tag=15,r.type=y,$0(o,r,y,h,p)):(o=Zc(d.type,null,h,r,r.mode,p),o.ref=r.ref,o.return=r,r.child=o)}if(y=o.child,(o.lanes&p)===0){var E=y.memoizedProps;if(d=d.compare,d=d!==null?d:Ma,d(E,h)&&o.ref===r.ref)return $i(o,r,p)}return r.flags|=1,o=Co(y,h),o.ref=r.ref,o.return=r,r.child=o}function $0(o,r,d,h,p){if(o!==null){var y=o.memoizedProps;if(Ma(y,h)&&o.ref===r.ref)if(mn=!1,r.pendingProps=h=y,(o.lanes&p)!==0)(o.flags&131072)!==0&&(mn=!0);else return r.lanes=o.lanes,$i(o,r,p)}return Vf(o,r,d,h,p)}function x0(o,r,d){var h=r.pendingProps,p=h.children,y=o!==null?o.memoizedState:null;if(h.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},st(gs,Nn),Nn|=d;else{if((d&1073741824)===0)return o=y!==null?y.baseLanes|d:d,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:o,cachePool:null,transitions:null},r.updateQueue=null,st(gs,Nn),Nn|=o,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=y!==null?y.baseLanes:d,st(gs,Nn),Nn|=h}else y!==null?(h=y.baseLanes|d,r.memoizedState=null):h=d,st(gs,Nn),Nn|=h;return en(o,r,p,d),r.child}function W0(o,r){var d=r.ref;(o===null&&d!==null||o!==null&&o.ref!==d)&&(r.flags|=512,r.flags|=2097152)}function Vf(o,r,d,h,p){var y=pn(d)?tr:zt.current;return y=os(r,y),ds(r,p),d=Uf(o,r,d,h,y,p),h=Hf(),o!==null&&!mn?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~p,$i(o,r,p)):(ut&&h&&Tf(r),r.flags|=1,en(o,r,d,p),r.child)}function Y0(o,r,d,h,p){if(pn(d)){var y=!0;Ac(r)}else y=!1;if(ds(r,p),r.stateNode===null)Gc(o,r),O0(r,d,h),zf(r,d,h,p),h=!0;else if(o===null){var E=r.stateNode,P=r.memoizedProps;E.props=P;var k=E.context,$=d.contextType;typeof $=="object"&&$!==null?$=xn($):($=pn(d)?tr:zt.current,$=os(r,$));var K=d.getDerivedStateFromProps,Z=typeof K=="function"||typeof E.getSnapshotBeforeUpdate=="function";Z||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(P!==h||k!==$)&&k0(r,E,h,$),yo=!1;var j=r.memoizedState;E.state=j,Mc(r,h,E,p),k=r.memoizedState,P!==h||j!==k||gn.current||yo?(typeof K=="function"&&(Yf(r,d,K,h),k=r.memoizedState),(P=yo||M0(r,d,P,h,j,k,$))?(Z||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(r.flags|=4194308)):(typeof E.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=k),E.props=h,E.state=k,E.context=$,h=P):(typeof E.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{E=r.stateNode,s0(o,r),P=r.memoizedProps,$=r.type===r.elementType?P:ni(r.type,P),E.props=$,Z=r.pendingProps,j=E.context,k=d.contextType,typeof k=="object"&&k!==null?k=xn(k):(k=pn(d)?tr:zt.current,k=os(r,k));var ue=d.getDerivedStateFromProps;(K=typeof ue=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(P!==Z||j!==k)&&k0(r,E,h,k),yo=!1,j=r.memoizedState,E.state=j,Mc(r,h,E,p);var ye=r.memoizedState;P!==Z||j!==ye||gn.current||yo?(typeof ue=="function"&&(Yf(r,d,ue,h),ye=r.memoizedState),($=yo||M0(r,d,$,h,j,ye,k)||!1)?(K||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(h,ye,k),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(h,ye,k)),typeof E.componentDidUpdate=="function"&&(r.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof E.componentDidUpdate!="function"||P===o.memoizedProps&&j===o.memoizedState||(r.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||P===o.memoizedProps&&j===o.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=ye),E.props=h,E.state=ye,E.context=k,h=$):(typeof E.componentDidUpdate!="function"||P===o.memoizedProps&&j===o.memoizedState||(r.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||P===o.memoizedProps&&j===o.memoizedState||(r.flags|=1024),h=!1)}return Kf(o,r,d,h,y,p)}function Kf(o,r,d,h,p,y){W0(o,r);var E=(r.flags&128)!==0;if(!h&&!E)return p&&Km(r,d,!1),$i(o,r,y);h=r.stateNode,bE.current=r;var P=E&&typeof d.getDerivedStateFromError!="function"?null:h.render();return r.flags|=1,o!==null&&E?(r.child=ls(r,o.child,null,y),r.child=ls(r,null,P,y)):en(o,r,P,y),r.memoizedState=h.state,p&&Km(r,d,!0),r.child}function z0(o){var r=o.stateNode;r.pendingContext?Xm(o,r.pendingContext,r.pendingContext!==r.context):r.context&&Xm(o,r.context,!1),Of(o,r.containerInfo)}function j0(o,r,d,h,p){return as(),_f(p),r.flags|=256,en(o,r,d,h),r.child}var qf={dehydrated:null,treeContext:null,retryLane:0};function Zf(o){return{baseLanes:o,cachePool:null,transitions:null}}function X0(o,r,d){var h=r.pendingProps,p=ht.current,y=!1,E=(r.flags&128)!==0,P;if((P=E)||(P=o!==null&&o.memoizedState===null?!1:(p&2)!==0),P?(y=!0,r.flags&=-129):(o===null||o.memoizedState!==null)&&(p|=1),st(ht,p&1),o===null)return Cf(r),o=r.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((r.mode&1)===0?r.lanes=1:o.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(E=h.children,o=h.fallback,y?(h=r.mode,y=r.child,E={mode:"hidden",children:E},(h&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=E):y=Qc(E,h,0,null),o=ur(o,h,d,null),y.return=r,o.return=r,y.sibling=o,r.child=y,r.child.memoizedState=Zf(d),r.memoizedState=qf,o):Qf(r,E));if(p=o.memoizedState,p!==null&&(P=p.dehydrated,P!==null))return BE(o,r,E,h,P,p,d);if(y){y=h.fallback,E=r.mode,p=o.child,P=p.sibling;var k={mode:"hidden",children:h.children};return(E&1)===0&&r.child!==p?(h=r.child,h.childLanes=0,h.pendingProps=k,r.deletions=null):(h=Co(p,k),h.subtreeFlags=p.subtreeFlags&14680064),P!==null?y=Co(P,y):(y=ur(y,E,d,null),y.flags|=2),y.return=r,h.return=r,h.sibling=y,r.child=h,h=y,y=r.child,E=o.child.memoizedState,E=E===null?Zf(d):{baseLanes:E.baseLanes|d,cachePool:null,transitions:E.transitions},y.memoizedState=E,y.childLanes=o.childLanes&~d,r.memoizedState=qf,h}return y=o.child,o=y.sibling,h=Co(y,{mode:"visible",children:h.children}),(r.mode&1)===0&&(h.lanes=d),h.return=r,h.sibling=null,o!==null&&(d=r.deletions,d===null?(r.deletions=[o],r.flags|=16):d.push(o)),r.child=h,r.memoizedState=null,h}function Qf(o,r){return r=Qc({mode:"visible",children:r},o.mode,0,null),r.return=o,o.child=r}function Hc(o,r,d,h){return h!==null&&_f(h),ls(r,o.child,null,d),o=Qf(r,r.pendingProps.children),o.flags|=2,r.memoizedState=null,o}function BE(o,r,d,h,p,y,E){if(d)return r.flags&256?(r.flags&=-257,h=jf(Error(n(422))),Hc(o,r,E,h)):r.memoizedState!==null?(r.child=o.child,r.flags|=128,null):(y=h.fallback,p=r.mode,h=Qc({mode:"visible",children:h.children},p,0,null),y=ur(y,p,E,null),y.flags|=2,h.return=r,y.return=r,h.sibling=y,r.child=h,(r.mode&1)!==0&&ls(r,o.child,null,E),r.child.memoizedState=Zf(E),r.memoizedState=qf,y);if((r.mode&1)===0)return Hc(o,r,E,null);if(p.data==="$!"){if(h=p.nextSibling&&p.nextSibling.dataset,h)var P=h.dgst;return h=P,y=Error(n(419)),h=jf(y,h,void 0),Hc(o,r,E,h)}if(P=(E&o.childLanes)!==0,mn||P){if(h=Ot,h!==null){switch(E&-E){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=(p&(h.suspendedLanes|E))!==0?0:p,p!==0&&p!==y.retryLane&&(y.retryLane=p,Hi(o,p),ri(h,o,p,-1))}return gh(),h=jf(Error(n(421))),Hc(o,r,E,h)}return p.data==="$?"?(r.flags|=128,r.child=o.child,r=VE.bind(null,o),p._reactRetry=r,null):(o=y.treeContext,Dn=ho(p.nextSibling),Pn=r,ut=!0,ti=null,o!==null&&(Gn[$n++]=Li,Gn[$n++]=Ui,Gn[$n++]=nr,Li=o.id,Ui=o.overflow,nr=r),r=Qf(r,h.children),r.flags|=4096,r)}function V0(o,r,d){o.lanes|=r;var h=o.alternate;h!==null&&(h.lanes|=r),Df(o.return,r,d)}function Jf(o,r,d,h,p){var y=o.memoizedState;y===null?o.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:d,tailMode:p}:(y.isBackwards=r,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=d,y.tailMode=p)}function K0(o,r,d){var h=r.pendingProps,p=h.revealOrder,y=h.tail;if(en(o,r,h.children,d),h=ht.current,(h&2)!==0)h=h&1|2,r.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=r.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&V0(o,d,r);else if(o.tag===19)V0(o,d,r);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}h&=1}if(st(ht,h),(r.mode&1)===0)r.memoizedState=null;else switch(p){case"forwards":for(d=r.child,p=null;d!==null;)o=d.alternate,o!==null&&Oc(o)===null&&(p=d),d=d.sibling;d=p,d===null?(p=r.child,r.child=null):(p=d.sibling,d.sibling=null),Jf(r,!1,p,d,y);break;case"backwards":for(d=null,p=r.child,r.child=null;p!==null;){if(o=p.alternate,o!==null&&Oc(o)===null){r.child=p;break}o=p.sibling,p.sibling=d,d=p,p=o}Jf(r,!0,d,null,y);break;case"together":Jf(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function Gc(o,r){(r.mode&1)===0&&o!==null&&(o.alternate=null,r.alternate=null,r.flags|=2)}function $i(o,r,d){if(o!==null&&(r.dependencies=o.dependencies),ar|=r.lanes,(d&r.childLanes)===0)return null;if(o!==null&&r.child!==o.child)throw Error(n(153));if(r.child!==null){for(o=r.child,d=Co(o,o.pendingProps),r.child=d,d.return=r;o.sibling!==null;)o=o.sibling,d=d.sibling=Co(o,o.pendingProps),d.return=r;d.sibling=null}return r.child}function FE(o,r,d){switch(r.tag){case 3:z0(r),as();break;case 5:c0(r);break;case 1:pn(r.type)&&Ac(r);break;case 4:Of(r,r.stateNode.containerInfo);break;case 10:var h=r.type._context,p=r.memoizedProps.value;st(Pc,h._currentValue),h._currentValue=p;break;case 13:if(h=r.memoizedState,h!==null)return h.dehydrated!==null?(st(ht,ht.current&1),r.flags|=128,null):(d&r.child.childLanes)!==0?X0(o,r,d):(st(ht,ht.current&1),o=$i(o,r,d),o!==null?o.sibling:null);st(ht,ht.current&1);break;case 19:if(h=(d&r.childLanes)!==0,(o.flags&128)!==0){if(h)return K0(o,r,d);r.flags|=128}if(p=r.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),st(ht,ht.current),h)break;return null;case 22:case 23:return r.lanes=0,x0(o,r,d)}return $i(o,r,d)}var q0,eh,Z0,Q0;q0=function(o,r){for(var d=r.child;d!==null;){if(d.tag===5||d.tag===6)o.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break;for(;d.sibling===null;){if(d.return===null||d.return===r)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},eh=function(){},Z0=function(o,r,d,h){var p=o.memoizedProps;if(p!==h){o=r.stateNode,rr(yi.current);var y=null;switch(d){case"input":p=tt(o,p),h=tt(o,h),y=[];break;case"select":p=V({},p,{value:void 0}),h=V({},h,{value:void 0}),y=[];break;case"textarea":p=Qo(o,p),h=Qo(o,h),y=[];break;default:typeof p.onClick!="function"&&typeof h.onClick=="function"&&(o.onclick=vc)}ku(d,h);var E;d=null;for($ in p)if(!h.hasOwnProperty($)&&p.hasOwnProperty($)&&p[$]!=null)if($==="style"){var P=p[$];for(E in P)P.hasOwnProperty(E)&&(d||(d={}),d[E]="")}else $!=="dangerouslySetInnerHTML"&&$!=="children"&&$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(a.hasOwnProperty($)?y||(y=[]):(y=y||[]).push($,null));for($ in h){var k=h[$];if(P=p!=null?p[$]:void 0,h.hasOwnProperty($)&&k!==P&&(k!=null||P!=null))if($==="style")if(P){for(E in P)!P.hasOwnProperty(E)||k&&k.hasOwnProperty(E)||(d||(d={}),d[E]="");for(E in k)k.hasOwnProperty(E)&&P[E]!==k[E]&&(d||(d={}),d[E]=k[E])}else d||(y||(y=[]),y.push($,d)),d=k;else $==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,P=P?P.__html:void 0,k!=null&&P!==k&&(y=y||[]).push($,k)):$==="children"?typeof k!="string"&&typeof k!="number"||(y=y||[]).push($,""+k):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&(a.hasOwnProperty($)?(k!=null&&$==="onScroll"&&lt("scroll",o),y||P===k||(y=[])):(y=y||[]).push($,k))}d&&(y=y||[]).push("style",d);var $=y;(r.updateQueue=$)&&(r.flags|=4)}},Q0=function(o,r,d,h){d!==h&&(r.flags|=4)};function ja(o,r){if(!ut)switch(o.tailMode){case"hidden":r=o.tail;for(var d=null;r!==null;)r.alternate!==null&&(d=r),r=r.sibling;d===null?o.tail=null:d.sibling=null;break;case"collapsed":d=o.tail;for(var h=null;d!==null;)d.alternate!==null&&(h=d),d=d.sibling;h===null?r||o.tail===null?o.tail=null:o.tail.sibling=null:h.sibling=null}}function Xt(o){var r=o.alternate!==null&&o.alternate.child===o.child,d=0,h=0;if(r)for(var p=o.child;p!==null;)d|=p.lanes|p.childLanes,h|=p.subtreeFlags&14680064,h|=p.flags&14680064,p.return=o,p=p.sibling;else for(p=o.child;p!==null;)d|=p.lanes|p.childLanes,h|=p.subtreeFlags,h|=p.flags,p.return=o,p=p.sibling;return o.subtreeFlags|=h,o.childLanes=d,r}function LE(o,r,d){var h=r.pendingProps;switch(Af(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xt(r),null;case 1:return pn(r.type)&&Tc(),Xt(r),null;case 3:return h=r.stateNode,us(),ct(gn),ct(zt),Bf(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(wc(r)?r.flags|=4:o===null||o.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,ti!==null&&(uh(ti),ti=null))),eh(o,r),Xt(r),null;case 5:kf(r);var p=rr($a.current);if(d=r.type,o!==null&&r.stateNode!=null)Z0(o,r,d,h,p),o.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!h){if(r.stateNode===null)throw Error(n(166));return Xt(r),null}if(o=rr(yi.current),wc(r)){h=r.stateNode,d=r.type;var y=r.memoizedProps;switch(h[mi]=r,h[Fa]=y,o=(r.mode&1)!==0,d){case"dialog":lt("cancel",h),lt("close",h);break;case"iframe":case"object":case"embed":lt("load",h);break;case"video":case"audio":for(p=0;p<ka.length;p++)lt(ka[p],h);break;case"source":lt("error",h);break;case"img":case"image":case"link":lt("error",h),lt("load",h);break;case"details":lt("toggle",h);break;case"input":at(h,y),lt("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!y.multiple},lt("invalid",h);break;case"textarea":Bp(h,y),lt("invalid",h)}ku(d,y),p=null;for(var E in y)if(y.hasOwnProperty(E)){var P=y[E];E==="children"?typeof P=="string"?h.textContent!==P&&(y.suppressHydrationWarning!==!0&&Sc(h.textContent,P,o),p=["children",P]):typeof P=="number"&&h.textContent!==""+P&&(y.suppressHydrationWarning!==!0&&Sc(h.textContent,P,o),p=["children",""+P]):a.hasOwnProperty(E)&&P!=null&&E==="onScroll"&&lt("scroll",h)}switch(d){case"input":$e(h),Hn(h,y,!0);break;case"textarea":$e(h),Lp(h);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(h.onclick=vc)}h=p,r.updateQueue=h,h!==null&&(r.flags|=4)}else{E=p.nodeType===9?p:p.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=Up(d)),o==="http://www.w3.org/1999/xhtml"?d==="script"?(o=E.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof h.is=="string"?o=E.createElement(d,{is:h.is}):(o=E.createElement(d),d==="select"&&(E=o,h.multiple?E.multiple=!0:h.size&&(E.size=h.size))):o=E.createElementNS(o,d),o[mi]=r,o[Fa]=h,q0(o,r,!1,!1),r.stateNode=o;e:{switch(E=bu(d,h),d){case"dialog":lt("cancel",o),lt("close",o),p=h;break;case"iframe":case"object":case"embed":lt("load",o),p=h;break;case"video":case"audio":for(p=0;p<ka.length;p++)lt(ka[p],o);p=h;break;case"source":lt("error",o),p=h;break;case"img":case"image":case"link":lt("error",o),lt("load",o),p=h;break;case"details":lt("toggle",o),p=h;break;case"input":at(o,h),p=tt(o,h),lt("invalid",o);break;case"option":p=h;break;case"select":o._wrapperState={wasMultiple:!!h.multiple},p=V({},h,{value:void 0}),lt("invalid",o);break;case"textarea":Bp(o,h),p=Qo(o,h),lt("invalid",o);break;default:p=h}ku(d,p),P=p;for(y in P)if(P.hasOwnProperty(y)){var k=P[y];y==="style"?$p(o,k):y==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,k!=null&&Hp(o,k)):y==="children"?typeof k=="string"?(d!=="textarea"||k!=="")&&ga(o,k):typeof k=="number"&&ga(o,""+k):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(a.hasOwnProperty(y)?k!=null&&y==="onScroll"&&lt("scroll",o):k!=null&&w(o,y,k,E))}switch(d){case"input":$e(o),Hn(o,h,!1);break;case"textarea":$e(o),Lp(o);break;case"option":h.value!=null&&o.setAttribute("value",""+De(h.value));break;case"select":o.multiple=!!h.multiple,y=h.value,y!=null?ro(o,!!h.multiple,y,!1):h.defaultValue!=null&&ro(o,!!h.multiple,h.defaultValue,!0);break;default:typeof p.onClick=="function"&&(o.onclick=vc)}switch(d){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Xt(r),null;case 6:if(o&&r.stateNode!=null)Q0(o,r,o.memoizedProps,h);else{if(typeof h!="string"&&r.stateNode===null)throw Error(n(166));if(d=rr($a.current),rr(yi.current),wc(r)){if(h=r.stateNode,d=r.memoizedProps,h[mi]=r,(y=h.nodeValue!==d)&&(o=Pn,o!==null))switch(o.tag){case 3:Sc(h.nodeValue,d,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&Sc(h.nodeValue,d,(o.mode&1)!==0)}y&&(r.flags|=4)}else h=(d.nodeType===9?d:d.ownerDocument).createTextNode(h),h[mi]=r,r.stateNode=h}return Xt(r),null;case 13:if(ct(ht),h=r.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(ut&&Dn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)t0(),as(),r.flags|=98560,y=!1;else if(y=wc(r),h!==null&&h.dehydrated!==null){if(o===null){if(!y)throw Error(n(318));if(y=r.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[mi]=r}else as(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Xt(r),y=!1}else ti!==null&&(uh(ti),ti=null),y=!0;if(!y)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=d,r):(h=h!==null,h!==(o!==null&&o.memoizedState!==null)&&h&&(r.child.flags|=8192,(r.mode&1)!==0&&(o===null||(ht.current&1)!==0?Dt===0&&(Dt=3):gh())),r.updateQueue!==null&&(r.flags|=4),Xt(r),null);case 4:return us(),eh(o,r),o===null&&ba(r.stateNode.containerInfo),Xt(r),null;case 10:return Pf(r.type._context),Xt(r),null;case 17:return pn(r.type)&&Tc(),Xt(r),null;case 19:if(ct(ht),y=r.memoizedState,y===null)return Xt(r),null;if(h=(r.flags&128)!==0,E=y.rendering,E===null)if(h)ja(y,!1);else{if(Dt!==0||o!==null&&(o.flags&128)!==0)for(o=r.child;o!==null;){if(E=Oc(o),E!==null){for(r.flags|=128,ja(y,!1),h=E.updateQueue,h!==null&&(r.updateQueue=h,r.flags|=4),r.subtreeFlags=0,h=d,d=r.child;d!==null;)y=d,o=h,y.flags&=14680066,E=y.alternate,E===null?(y.childLanes=0,y.lanes=o,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=E.childLanes,y.lanes=E.lanes,y.child=E.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=E.memoizedProps,y.memoizedState=E.memoizedState,y.updateQueue=E.updateQueue,y.type=E.type,o=E.dependencies,y.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),d=d.sibling;return st(ht,ht.current&1|2),r.child}o=o.sibling}y.tail!==null&&vt()>ps&&(r.flags|=128,h=!0,ja(y,!1),r.lanes=4194304)}else{if(!h)if(o=Oc(E),o!==null){if(r.flags|=128,h=!0,d=o.updateQueue,d!==null&&(r.updateQueue=d,r.flags|=4),ja(y,!0),y.tail===null&&y.tailMode==="hidden"&&!E.alternate&&!ut)return Xt(r),null}else 2*vt()-y.renderingStartTime>ps&&d!==1073741824&&(r.flags|=128,h=!0,ja(y,!1),r.lanes=4194304);y.isBackwards?(E.sibling=r.child,r.child=E):(d=y.last,d!==null?d.sibling=E:r.child=E,y.last=E)}return y.tail!==null?(r=y.tail,y.rendering=r,y.tail=r.sibling,y.renderingStartTime=vt(),r.sibling=null,d=ht.current,st(ht,h?d&1|2:d&1),r):(Xt(r),null);case 22:case 23:return hh(),h=r.memoizedState!==null,o!==null&&o.memoizedState!==null!==h&&(r.flags|=8192),h&&(r.mode&1)!==0?(Nn&1073741824)!==0&&(Xt(r),r.subtreeFlags&6&&(r.flags|=8192)):Xt(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function UE(o,r){switch(Af(r),r.tag){case 1:return pn(r.type)&&Tc(),o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 3:return us(),ct(gn),ct(zt),Bf(),o=r.flags,(o&65536)!==0&&(o&128)===0?(r.flags=o&-65537|128,r):null;case 5:return kf(r),null;case 13:if(ct(ht),o=r.memoizedState,o!==null&&o.dehydrated!==null){if(r.alternate===null)throw Error(n(340));as()}return o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 19:return ct(ht),null;case 4:return us(),null;case 10:return Pf(r.type._context),null;case 22:case 23:return hh(),null;case 24:return null;default:return null}}var $c=!1,Vt=!1,HE=typeof WeakSet=="function"?WeakSet:Set,pe=null;function hs(o,r){var d=o.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(h){mt(o,r,h)}else d.current=null}function th(o,r,d){try{d()}catch(h){mt(o,r,h)}}var J0=!1;function GE(o,r){if(hf=ac,o=Mm(),rf(o)){if("selectionStart"in o)var d={start:o.selectionStart,end:o.selectionEnd};else e:{d=(d=o.ownerDocument)&&d.defaultView||window;var h=d.getSelection&&d.getSelection();if(h&&h.rangeCount!==0){d=h.anchorNode;var p=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{d.nodeType,y.nodeType}catch{d=null;break e}var E=0,P=-1,k=-1,$=0,K=0,Z=o,j=null;t:for(;;){for(var ue;Z!==d||p!==0&&Z.nodeType!==3||(P=E+p),Z!==y||h!==0&&Z.nodeType!==3||(k=E+h),Z.nodeType===3&&(E+=Z.nodeValue.length),(ue=Z.firstChild)!==null;)j=Z,Z=ue;for(;;){if(Z===o)break t;if(j===d&&++$===p&&(P=E),j===y&&++K===h&&(k=E),(ue=Z.nextSibling)!==null)break;Z=j,j=Z.parentNode}Z=ue}d=P===-1||k===-1?null:{start:P,end:k}}else d=null}d=d||{start:0,end:0}}else d=null;for(gf={focusedElem:o,selectionRange:d},ac=!1,pe=r;pe!==null;)if(r=pe,o=r.child,(r.subtreeFlags&1028)!==0&&o!==null)o.return=r,pe=o;else for(;pe!==null;){r=pe;try{var ye=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(ye!==null){var Ie=ye.memoizedProps,It=ye.memoizedState,U=r.stateNode,L=U.getSnapshotBeforeUpdate(r.elementType===r.type?Ie:ni(r.type,Ie),It);U.__reactInternalSnapshotBeforeUpdate=L}break;case 3:var H=r.stateNode.containerInfo;H.nodeType===1?H.textContent="":H.nodeType===9&&H.documentElement&&H.removeChild(H.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(Q){mt(r,r.return,Q)}if(o=r.sibling,o!==null){o.return=r.return,pe=o;break}pe=r.return}return ye=J0,J0=!1,ye}function Xa(o,r,d){var h=r.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var p=h=h.next;do{if((p.tag&o)===o){var y=p.destroy;p.destroy=void 0,y!==void 0&&th(r,d,y)}p=p.next}while(p!==h)}}function xc(o,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var d=r=r.next;do{if((d.tag&o)===o){var h=d.create;d.destroy=h()}d=d.next}while(d!==r)}}function nh(o){var r=o.ref;if(r!==null){var d=o.stateNode;switch(o.tag){case 5:o=d;break;default:o=d}typeof r=="function"?r(o):r.current=o}}function ey(o){var r=o.alternate;r!==null&&(o.alternate=null,ey(r)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(r=o.stateNode,r!==null&&(delete r[mi],delete r[Fa],delete r[Sf],delete r[AE],delete r[EE])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function ty(o){return o.tag===5||o.tag===3||o.tag===4}function ny(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||ty(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function ih(o,r,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?d.nodeType===8?d.parentNode.insertBefore(o,r):d.insertBefore(o,r):(d.nodeType===8?(r=d.parentNode,r.insertBefore(o,d)):(r=d,r.appendChild(o)),d=d._reactRootContainer,d!=null||r.onclick!==null||(r.onclick=vc));else if(h!==4&&(o=o.child,o!==null))for(ih(o,r,d),o=o.sibling;o!==null;)ih(o,r,d),o=o.sibling}function oh(o,r,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?d.insertBefore(o,r):d.appendChild(o);else if(h!==4&&(o=o.child,o!==null))for(oh(o,r,d),o=o.sibling;o!==null;)oh(o,r,d),o=o.sibling}var Ht=null,ii=!1;function vo(o,r,d){for(d=d.child;d!==null;)iy(o,r,d),d=d.sibling}function iy(o,r,d){if(pi&&typeof pi.onCommitFiberUnmount=="function")try{pi.onCommitFiberUnmount(tc,d)}catch{}switch(d.tag){case 5:Vt||hs(d,r);case 6:var h=Ht,p=ii;Ht=null,vo(o,r,d),Ht=h,ii=p,Ht!==null&&(ii?(o=Ht,d=d.stateNode,o.nodeType===8?o.parentNode.removeChild(d):o.removeChild(d)):Ht.removeChild(d.stateNode));break;case 18:Ht!==null&&(ii?(o=Ht,d=d.stateNode,o.nodeType===8?yf(o.parentNode,d):o.nodeType===1&&yf(o,d),_a(o)):yf(Ht,d.stateNode));break;case 4:h=Ht,p=ii,Ht=d.stateNode.containerInfo,ii=!0,vo(o,r,d),Ht=h,ii=p;break;case 0:case 11:case 14:case 15:if(!Vt&&(h=d.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){p=h=h.next;do{var y=p,E=y.destroy;y=y.tag,E!==void 0&&((y&2)!==0||(y&4)!==0)&&th(d,r,E),p=p.next}while(p!==h)}vo(o,r,d);break;case 1:if(!Vt&&(hs(d,r),h=d.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=d.memoizedProps,h.state=d.memoizedState,h.componentWillUnmount()}catch(P){mt(d,r,P)}vo(o,r,d);break;case 21:vo(o,r,d);break;case 22:d.mode&1?(Vt=(h=Vt)||d.memoizedState!==null,vo(o,r,d),Vt=h):vo(o,r,d);break;default:vo(o,r,d)}}function oy(o){var r=o.updateQueue;if(r!==null){o.updateQueue=null;var d=o.stateNode;d===null&&(d=o.stateNode=new HE),r.forEach(function(h){var p=KE.bind(null,o,h);d.has(h)||(d.add(h),h.then(p,p))})}}function oi(o,r){var d=r.deletions;if(d!==null)for(var h=0;h<d.length;h++){var p=d[h];try{var y=o,E=r,P=E;e:for(;P!==null;){switch(P.tag){case 5:Ht=P.stateNode,ii=!1;break e;case 3:Ht=P.stateNode.containerInfo,ii=!0;break e;case 4:Ht=P.stateNode.containerInfo,ii=!0;break e}P=P.return}if(Ht===null)throw Error(n(160));iy(y,E,p),Ht=null,ii=!1;var k=p.alternate;k!==null&&(k.return=null),p.return=null}catch($){mt(p,r,$)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)ry(r,o),r=r.sibling}function ry(o,r){var d=o.alternate,h=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(oi(r,o),vi(o),h&4){try{Xa(3,o,o.return),xc(3,o)}catch(Ie){mt(o,o.return,Ie)}try{Xa(5,o,o.return)}catch(Ie){mt(o,o.return,Ie)}}break;case 1:oi(r,o),vi(o),h&512&&d!==null&&hs(d,d.return);break;case 5:if(oi(r,o),vi(o),h&512&&d!==null&&hs(d,d.return),o.flags&32){var p=o.stateNode;try{ga(p,"")}catch(Ie){mt(o,o.return,Ie)}}if(h&4&&(p=o.stateNode,p!=null)){var y=o.memoizedProps,E=d!==null?d.memoizedProps:y,P=o.type,k=o.updateQueue;if(o.updateQueue=null,k!==null)try{P==="input"&&y.type==="radio"&&y.name!=null&&fi(p,y),bu(P,E);var $=bu(P,y);for(E=0;E<k.length;E+=2){var K=k[E],Z=k[E+1];K==="style"?$p(p,Z):K==="dangerouslySetInnerHTML"?Hp(p,Z):K==="children"?ga(p,Z):w(p,K,Z,$)}switch(P){case"input":hn(p,y);break;case"textarea":Fp(p,y);break;case"select":var j=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!y.multiple;var ue=y.value;ue!=null?ro(p,!!y.multiple,ue,!1):j!==!!y.multiple&&(y.defaultValue!=null?ro(p,!!y.multiple,y.defaultValue,!0):ro(p,!!y.multiple,y.multiple?[]:"",!1))}p[Fa]=y}catch(Ie){mt(o,o.return,Ie)}}break;case 6:if(oi(r,o),vi(o),h&4){if(o.stateNode===null)throw Error(n(162));p=o.stateNode,y=o.memoizedProps;try{p.nodeValue=y}catch(Ie){mt(o,o.return,Ie)}}break;case 3:if(oi(r,o),vi(o),h&4&&d!==null&&d.memoizedState.isDehydrated)try{_a(r.containerInfo)}catch(Ie){mt(o,o.return,Ie)}break;case 4:oi(r,o),vi(o);break;case 13:oi(r,o),vi(o),p=o.child,p.flags&8192&&(y=p.memoizedState!==null,p.stateNode.isHidden=y,!y||p.alternate!==null&&p.alternate.memoizedState!==null||(ah=vt())),h&4&&oy(o);break;case 22:if(K=d!==null&&d.memoizedState!==null,o.mode&1?(Vt=($=Vt)||K,oi(r,o),Vt=$):oi(r,o),vi(o),h&8192){if($=o.memoizedState!==null,(o.stateNode.isHidden=$)&&!K&&(o.mode&1)!==0)for(pe=o,K=o.child;K!==null;){for(Z=pe=K;pe!==null;){switch(j=pe,ue=j.child,j.tag){case 0:case 11:case 14:case 15:Xa(4,j,j.return);break;case 1:hs(j,j.return);var ye=j.stateNode;if(typeof ye.componentWillUnmount=="function"){h=j,d=j.return;try{r=h,ye.props=r.memoizedProps,ye.state=r.memoizedState,ye.componentWillUnmount()}catch(Ie){mt(h,d,Ie)}}break;case 5:hs(j,j.return);break;case 22:if(j.memoizedState!==null){ly(Z);continue}}ue!==null?(ue.return=j,pe=ue):ly(Z)}K=K.sibling}e:for(K=null,Z=o;;){if(Z.tag===5){if(K===null){K=Z;try{p=Z.stateNode,$?(y=p.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(P=Z.stateNode,k=Z.memoizedProps.style,E=k!=null&&k.hasOwnProperty("display")?k.display:null,P.style.display=Gp("display",E))}catch(Ie){mt(o,o.return,Ie)}}}else if(Z.tag===6){if(K===null)try{Z.stateNode.nodeValue=$?"":Z.memoizedProps}catch(Ie){mt(o,o.return,Ie)}}else if((Z.tag!==22&&Z.tag!==23||Z.memoizedState===null||Z===o)&&Z.child!==null){Z.child.return=Z,Z=Z.child;continue}if(Z===o)break e;for(;Z.sibling===null;){if(Z.return===null||Z.return===o)break e;K===Z&&(K=null),Z=Z.return}K===Z&&(K=null),Z.sibling.return=Z.return,Z=Z.sibling}}break;case 19:oi(r,o),vi(o),h&4&&oy(o);break;case 21:break;default:oi(r,o),vi(o)}}function vi(o){var r=o.flags;if(r&2){try{e:{for(var d=o.return;d!==null;){if(ty(d)){var h=d;break e}d=d.return}throw Error(n(160))}switch(h.tag){case 5:var p=h.stateNode;h.flags&32&&(ga(p,""),h.flags&=-33);var y=ny(o);oh(o,y,p);break;case 3:case 4:var E=h.stateNode.containerInfo,P=ny(o);ih(o,P,E);break;default:throw Error(n(161))}}catch(k){mt(o,o.return,k)}o.flags&=-3}r&4096&&(o.flags&=-4097)}function $E(o,r,d){pe=o,sy(o)}function sy(o,r,d){for(var h=(o.mode&1)!==0;pe!==null;){var p=pe,y=p.child;if(p.tag===22&&h){var E=p.memoizedState!==null||$c;if(!E){var P=p.alternate,k=P!==null&&P.memoizedState!==null||Vt;P=$c;var $=Vt;if($c=E,(Vt=k)&&!$)for(pe=p;pe!==null;)E=pe,k=E.child,E.tag===22&&E.memoizedState!==null?cy(p):k!==null?(k.return=E,pe=k):cy(p);for(;y!==null;)pe=y,sy(y),y=y.sibling;pe=p,$c=P,Vt=$}ay(o)}else(p.subtreeFlags&8772)!==0&&y!==null?(y.return=p,pe=y):ay(o)}}function ay(o){for(;pe!==null;){var r=pe;if((r.flags&8772)!==0){var d=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:Vt||xc(5,r);break;case 1:var h=r.stateNode;if(r.flags&4&&!Vt)if(d===null)h.componentDidMount();else{var p=r.elementType===r.type?d.memoizedProps:ni(r.type,d.memoizedProps);h.componentDidUpdate(p,d.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var y=r.updateQueue;y!==null&&l0(r,y,h);break;case 3:var E=r.updateQueue;if(E!==null){if(d=null,r.child!==null)switch(r.child.tag){case 5:d=r.child.stateNode;break;case 1:d=r.child.stateNode}l0(r,E,d)}break;case 5:var P=r.stateNode;if(d===null&&r.flags&4){d=P;var k=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":k.autoFocus&&d.focus();break;case"img":k.src&&(d.src=k.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var $=r.alternate;if($!==null){var K=$.memoizedState;if(K!==null){var Z=K.dehydrated;Z!==null&&_a(Z)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Vt||r.flags&512&&nh(r)}catch(j){mt(r,r.return,j)}}if(r===o){pe=null;break}if(d=r.sibling,d!==null){d.return=r.return,pe=d;break}pe=r.return}}function ly(o){for(;pe!==null;){var r=pe;if(r===o){pe=null;break}var d=r.sibling;if(d!==null){d.return=r.return,pe=d;break}pe=r.return}}function cy(o){for(;pe!==null;){var r=pe;try{switch(r.tag){case 0:case 11:case 15:var d=r.return;try{xc(4,r)}catch(k){mt(r,d,k)}break;case 1:var h=r.stateNode;if(typeof h.componentDidMount=="function"){var p=r.return;try{h.componentDidMount()}catch(k){mt(r,p,k)}}var y=r.return;try{nh(r)}catch(k){mt(r,y,k)}break;case 5:var E=r.return;try{nh(r)}catch(k){mt(r,E,k)}}}catch(k){mt(r,r.return,k)}if(r===o){pe=null;break}var P=r.sibling;if(P!==null){P.return=r.return,pe=P;break}pe=r.return}}var xE=Math.ceil,Wc=B.ReactCurrentDispatcher,rh=B.ReactCurrentOwner,Yn=B.ReactCurrentBatchConfig,je=0,Ot=null,_t=null,Gt=0,Nn=0,gs=go(0),Dt=0,Va=null,ar=0,Yc=0,sh=0,Ka=null,yn=null,ah=0,ps=1/0,xi=null,zc=!1,lh=null,Io=null,jc=!1,To=null,Xc=0,qa=0,ch=null,Vc=-1,Kc=0;function tn(){return(je&6)!==0?vt():Vc!==-1?Vc:Vc=vt()}function Ao(o){return(o.mode&1)===0?1:(je&2)!==0&&Gt!==0?Gt&-Gt:_E.transition!==null?(Kc===0&&(Kc=nm()),Kc):(o=et,o!==0||(o=window.event,o=o===void 0?16:um(o.type)),o)}function ri(o,r,d,h){if(50<qa)throw qa=0,ch=null,Error(n(185));Ia(o,d,h),((je&2)===0||o!==Ot)&&(o===Ot&&((je&2)===0&&(Yc|=d),Dt===4&&Eo(o,Gt)),Sn(o,h),d===1&&je===0&&(r.mode&1)===0&&(ps=vt()+500,Ec&&mo()))}function Sn(o,r){var d=o.callbackNode;_A(o,r);var h=oc(o,o===Ot?Gt:0);if(h===0)d!==null&&Jp(d),o.callbackNode=null,o.callbackPriority=0;else if(r=h&-h,o.callbackPriority!==r){if(d!=null&&Jp(d),r===1)o.tag===0?CE(uy.bind(null,o)):qm(uy.bind(null,o)),IE(function(){(je&6)===0&&mo()}),d=null;else{switch(im(h)){case 1:d=$u;break;case 4:d=em;break;case 16:d=ec;break;case 536870912:d=tm;break;default:d=ec}d=vy(d,dy.bind(null,o))}o.callbackPriority=r,o.callbackNode=d}}function dy(o,r){if(Vc=-1,Kc=0,(je&6)!==0)throw Error(n(327));var d=o.callbackNode;if(ms()&&o.callbackNode!==d)return null;var h=oc(o,o===Ot?Gt:0);if(h===0)return null;if((h&30)!==0||(h&o.expiredLanes)!==0||r)r=qc(o,h);else{r=h;var p=je;je|=2;var y=hy();(Ot!==o||Gt!==r)&&(xi=null,ps=vt()+500,cr(o,r));do try{zE();break}catch(P){fy(o,P)}while(!0);Rf(),Wc.current=y,je=p,_t!==null?r=0:(Ot=null,Gt=0,r=Dt)}if(r!==0){if(r===2&&(p=xu(o),p!==0&&(h=p,r=dh(o,p))),r===1)throw d=Va,cr(o,0),Eo(o,h),Sn(o,vt()),d;if(r===6)Eo(o,h);else{if(p=o.current.alternate,(h&30)===0&&!WE(p)&&(r=qc(o,h),r===2&&(y=xu(o),y!==0&&(h=y,r=dh(o,y))),r===1))throw d=Va,cr(o,0),Eo(o,h),Sn(o,vt()),d;switch(o.finishedWork=p,o.finishedLanes=h,r){case 0:case 1:throw Error(n(345));case 2:dr(o,yn,xi);break;case 3:if(Eo(o,h),(h&130023424)===h&&(r=ah+500-vt(),10<r)){if(oc(o,0)!==0)break;if(p=o.suspendedLanes,(p&h)!==h){tn(),o.pingedLanes|=o.suspendedLanes&p;break}o.timeoutHandle=mf(dr.bind(null,o,yn,xi),r);break}dr(o,yn,xi);break;case 4:if(Eo(o,h),(h&4194240)===h)break;for(r=o.eventTimes,p=-1;0<h;){var E=31-Jn(h);y=1<<E,E=r[E],E>p&&(p=E),h&=~y}if(h=p,h=vt()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*xE(h/1960))-h,10<h){o.timeoutHandle=mf(dr.bind(null,o,yn,xi),h);break}dr(o,yn,xi);break;case 5:dr(o,yn,xi);break;default:throw Error(n(329))}}}return Sn(o,vt()),o.callbackNode===d?dy.bind(null,o):null}function dh(o,r){var d=Ka;return o.current.memoizedState.isDehydrated&&(cr(o,r).flags|=256),o=qc(o,r),o!==2&&(r=yn,yn=d,r!==null&&uh(r)),o}function uh(o){yn===null?yn=o:yn.push.apply(yn,o)}function WE(o){for(var r=o;;){if(r.flags&16384){var d=r.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var h=0;h<d.length;h++){var p=d[h],y=p.getSnapshot;p=p.value;try{if(!ei(y(),p))return!1}catch{return!1}}}if(d=r.child,r.subtreeFlags&16384&&d!==null)d.return=r,r=d;else{if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function Eo(o,r){for(r&=~sh,r&=~Yc,o.suspendedLanes|=r,o.pingedLanes&=~r,o=o.expirationTimes;0<r;){var d=31-Jn(r),h=1<<d;o[d]=-1,r&=~h}}function uy(o){if((je&6)!==0)throw Error(n(327));ms();var r=oc(o,0);if((r&1)===0)return Sn(o,vt()),null;var d=qc(o,r);if(o.tag!==0&&d===2){var h=xu(o);h!==0&&(r=h,d=dh(o,h))}if(d===1)throw d=Va,cr(o,0),Eo(o,r),Sn(o,vt()),d;if(d===6)throw Error(n(345));return o.finishedWork=o.current.alternate,o.finishedLanes=r,dr(o,yn,xi),Sn(o,vt()),null}function fh(o,r){var d=je;je|=1;try{return o(r)}finally{je=d,je===0&&(ps=vt()+500,Ec&&mo())}}function lr(o){To!==null&&To.tag===0&&(je&6)===0&&ms();var r=je;je|=1;var d=Yn.transition,h=et;try{if(Yn.transition=null,et=1,o)return o()}finally{et=h,Yn.transition=d,je=r,(je&6)===0&&mo()}}function hh(){Nn=gs.current,ct(gs)}function cr(o,r){o.finishedWork=null,o.finishedLanes=0;var d=o.timeoutHandle;if(d!==-1&&(o.timeoutHandle=-1,vE(d)),_t!==null)for(d=_t.return;d!==null;){var h=d;switch(Af(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&Tc();break;case 3:us(),ct(gn),ct(zt),Bf();break;case 5:kf(h);break;case 4:us();break;case 13:ct(ht);break;case 19:ct(ht);break;case 10:Pf(h.type._context);break;case 22:case 23:hh()}d=d.return}if(Ot=o,_t=o=Co(o.current,null),Gt=Nn=r,Dt=0,Va=null,sh=Yc=ar=0,yn=Ka=null,or!==null){for(r=0;r<or.length;r++)if(d=or[r],h=d.interleaved,h!==null){d.interleaved=null;var p=h.next,y=d.pending;if(y!==null){var E=y.next;y.next=p,h.next=E}d.pending=h}or=null}return o}function fy(o,r){do{var d=_t;try{if(Rf(),kc.current=Lc,bc){for(var h=gt.memoizedState;h!==null;){var p=h.queue;p!==null&&(p.pending=null),h=h.next}bc=!1}if(sr=0,Mt=Pt=gt=null,xa=!1,Wa=0,rh.current=null,d===null||d.return===null){Dt=1,Va=r,_t=null;break}e:{var y=o,E=d.return,P=d,k=r;if(r=Gt,P.flags|=32768,k!==null&&typeof k=="object"&&typeof k.then=="function"){var $=k,K=P,Z=K.tag;if((K.mode&1)===0&&(Z===0||Z===11||Z===15)){var j=K.alternate;j?(K.updateQueue=j.updateQueue,K.memoizedState=j.memoizedState,K.lanes=j.lanes):(K.updateQueue=null,K.memoizedState=null)}var ue=L0(E);if(ue!==null){ue.flags&=-257,U0(ue,E,P,y,r),ue.mode&1&&F0(y,$,r),r=ue,k=$;var ye=r.updateQueue;if(ye===null){var Ie=new Set;Ie.add(k),r.updateQueue=Ie}else ye.add(k);break e}else{if((r&1)===0){F0(y,$,r),gh();break e}k=Error(n(426))}}else if(ut&&P.mode&1){var It=L0(E);if(It!==null){(It.flags&65536)===0&&(It.flags|=256),U0(It,E,P,y,r),_f(fs(k,P));break e}}y=k=fs(k,P),Dt!==4&&(Dt=2),Ka===null?Ka=[y]:Ka.push(y),y=E;do{switch(y.tag){case 3:y.flags|=65536,r&=-r,y.lanes|=r;var U=b0(y,k,r);a0(y,U);break e;case 1:P=k;var L=y.type,H=y.stateNode;if((y.flags&128)===0&&(typeof L.getDerivedStateFromError=="function"||H!==null&&typeof H.componentDidCatch=="function"&&(Io===null||!Io.has(H)))){y.flags|=65536,r&=-r,y.lanes|=r;var Q=B0(y,P,r);a0(y,Q);break e}}y=y.return}while(y!==null)}py(d)}catch(Ce){r=Ce,_t===d&&d!==null&&(_t=d=d.return);continue}break}while(!0)}function hy(){var o=Wc.current;return Wc.current=Lc,o===null?Lc:o}function gh(){(Dt===0||Dt===3||Dt===2)&&(Dt=4),Ot===null||(ar&268435455)===0&&(Yc&268435455)===0||Eo(Ot,Gt)}function qc(o,r){var d=je;je|=2;var h=hy();(Ot!==o||Gt!==r)&&(xi=null,cr(o,r));do try{YE();break}catch(p){fy(o,p)}while(!0);if(Rf(),je=d,Wc.current=h,_t!==null)throw Error(n(261));return Ot=null,Gt=0,Dt}function YE(){for(;_t!==null;)gy(_t)}function zE(){for(;_t!==null&&!mA();)gy(_t)}function gy(o){var r=Sy(o.alternate,o,Nn);o.memoizedProps=o.pendingProps,r===null?py(o):_t=r,rh.current=null}function py(o){var r=o;do{var d=r.alternate;if(o=r.return,(r.flags&32768)===0){if(d=LE(d,r,Nn),d!==null){_t=d;return}}else{if(d=UE(d,r),d!==null){d.flags&=32767,_t=d;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{Dt=6,_t=null;return}}if(r=r.sibling,r!==null){_t=r;return}_t=r=o}while(r!==null);Dt===0&&(Dt=5)}function dr(o,r,d){var h=et,p=Yn.transition;try{Yn.transition=null,et=1,jE(o,r,d,h)}finally{Yn.transition=p,et=h}return null}function jE(o,r,d,h){do ms();while(To!==null);if((je&6)!==0)throw Error(n(327));d=o.finishedWork;var p=o.finishedLanes;if(d===null)return null;if(o.finishedWork=null,o.finishedLanes=0,d===o.current)throw Error(n(177));o.callbackNode=null,o.callbackPriority=0;var y=d.lanes|d.childLanes;if(wA(o,y),o===Ot&&(_t=Ot=null,Gt=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||jc||(jc=!0,vy(ec,function(){return ms(),null})),y=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||y){y=Yn.transition,Yn.transition=null;var E=et;et=1;var P=je;je|=4,rh.current=null,GE(o,d),ry(d,o),fE(gf),ac=!!hf,gf=hf=null,o.current=d,$E(d),yA(),je=P,et=E,Yn.transition=y}else o.current=d;if(jc&&(jc=!1,To=o,Xc=p),y=o.pendingLanes,y===0&&(Io=null),IA(d.stateNode),Sn(o,vt()),r!==null)for(h=o.onRecoverableError,d=0;d<r.length;d++)p=r[d],h(p.value,{componentStack:p.stack,digest:p.digest});if(zc)throw zc=!1,o=lh,lh=null,o;return(Xc&1)!==0&&o.tag!==0&&ms(),y=o.pendingLanes,(y&1)!==0?o===ch?qa++:(qa=0,ch=o):qa=0,mo(),null}function ms(){if(To!==null){var o=im(Xc),r=Yn.transition,d=et;try{if(Yn.transition=null,et=16>o?16:o,To===null)var h=!1;else{if(o=To,To=null,Xc=0,(je&6)!==0)throw Error(n(331));var p=je;for(je|=4,pe=o.current;pe!==null;){var y=pe,E=y.child;if((pe.flags&16)!==0){var P=y.deletions;if(P!==null){for(var k=0;k<P.length;k++){var $=P[k];for(pe=$;pe!==null;){var K=pe;switch(K.tag){case 0:case 11:case 15:Xa(8,K,y)}var Z=K.child;if(Z!==null)Z.return=K,pe=Z;else for(;pe!==null;){K=pe;var j=K.sibling,ue=K.return;if(ey(K),K===$){pe=null;break}if(j!==null){j.return=ue,pe=j;break}pe=ue}}}var ye=y.alternate;if(ye!==null){var Ie=ye.child;if(Ie!==null){ye.child=null;do{var It=Ie.sibling;Ie.sibling=null,Ie=It}while(Ie!==null)}}pe=y}}if((y.subtreeFlags&2064)!==0&&E!==null)E.return=y,pe=E;else e:for(;pe!==null;){if(y=pe,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:Xa(9,y,y.return)}var U=y.sibling;if(U!==null){U.return=y.return,pe=U;break e}pe=y.return}}var L=o.current;for(pe=L;pe!==null;){E=pe;var H=E.child;if((E.subtreeFlags&2064)!==0&&H!==null)H.return=E,pe=H;else e:for(E=L;pe!==null;){if(P=pe,(P.flags&2048)!==0)try{switch(P.tag){case 0:case 11:case 15:xc(9,P)}}catch(Ce){mt(P,P.return,Ce)}if(P===E){pe=null;break e}var Q=P.sibling;if(Q!==null){Q.return=P.return,pe=Q;break e}pe=P.return}}if(je=p,mo(),pi&&typeof pi.onPostCommitFiberRoot=="function")try{pi.onPostCommitFiberRoot(tc,o)}catch{}h=!0}return h}finally{et=d,Yn.transition=r}}return!1}function my(o,r,d){r=fs(d,r),r=b0(o,r,1),o=So(o,r,1),r=tn(),o!==null&&(Ia(o,1,r),Sn(o,r))}function mt(o,r,d){if(o.tag===3)my(o,o,d);else for(;r!==null;){if(r.tag===3){my(r,o,d);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Io===null||!Io.has(h))){o=fs(d,o),o=B0(r,o,1),r=So(r,o,1),o=tn(),r!==null&&(Ia(r,1,o),Sn(r,o));break}}r=r.return}}function XE(o,r,d){var h=o.pingCache;h!==null&&h.delete(r),r=tn(),o.pingedLanes|=o.suspendedLanes&d,Ot===o&&(Gt&d)===d&&(Dt===4||Dt===3&&(Gt&130023424)===Gt&&500>vt()-ah?cr(o,0):sh|=d),Sn(o,r)}function yy(o,r){r===0&&((o.mode&1)===0?r=1:(r=ic,ic<<=1,(ic&130023424)===0&&(ic=4194304)));var d=tn();o=Hi(o,r),o!==null&&(Ia(o,r,d),Sn(o,d))}function VE(o){var r=o.memoizedState,d=0;r!==null&&(d=r.retryLane),yy(o,d)}function KE(o,r){var d=0;switch(o.tag){case 13:var h=o.stateNode,p=o.memoizedState;p!==null&&(d=p.retryLane);break;case 19:h=o.stateNode;break;default:throw Error(n(314))}h!==null&&h.delete(r),yy(o,d)}var Sy;Sy=function(o,r,d){if(o!==null)if(o.memoizedProps!==r.pendingProps||gn.current)mn=!0;else{if((o.lanes&d)===0&&(r.flags&128)===0)return mn=!1,FE(o,r,d);mn=(o.flags&131072)!==0}else mn=!1,ut&&(r.flags&1048576)!==0&&Zm(r,_c,r.index);switch(r.lanes=0,r.tag){case 2:var h=r.type;Gc(o,r),o=r.pendingProps;var p=os(r,zt.current);ds(r,d),p=Uf(null,r,h,o,p,d);var y=Hf();return r.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,pn(h)?(y=!0,Ac(r)):y=!1,r.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,Mf(r),p.updater=Uc,r.stateNode=p,p._reactInternals=r,zf(r,h,o,d),r=Kf(null,r,h,!0,y,d)):(r.tag=0,ut&&y&&Tf(r),en(null,r,p,d),r=r.child),r;case 16:h=r.elementType;e:{switch(Gc(o,r),o=r.pendingProps,p=h._init,h=p(h._payload),r.type=h,p=r.tag=ZE(h),o=ni(h,o),p){case 0:r=Vf(null,r,h,o,d);break e;case 1:r=Y0(null,r,h,o,d);break e;case 11:r=H0(null,r,h,o,d);break e;case 14:r=G0(null,r,h,ni(h.type,o),d);break e}throw Error(n(306,h,""))}return r;case 0:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:ni(h,p),Vf(o,r,h,p,d);case 1:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:ni(h,p),Y0(o,r,h,p,d);case 3:e:{if(z0(r),o===null)throw Error(n(387));h=r.pendingProps,y=r.memoizedState,p=y.element,s0(o,r),Mc(r,h,null,d);var E=r.memoizedState;if(h=E.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:E.cache,pendingSuspenseBoundaries:E.pendingSuspenseBoundaries,transitions:E.transitions},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){p=fs(Error(n(423)),r),r=j0(o,r,h,d,p);break e}else if(h!==p){p=fs(Error(n(424)),r),r=j0(o,r,h,d,p);break e}else for(Dn=ho(r.stateNode.containerInfo.firstChild),Pn=r,ut=!0,ti=null,d=o0(r,null,h,d),r.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(as(),h===p){r=$i(o,r,d);break e}en(o,r,h,d)}r=r.child}return r;case 5:return c0(r),o===null&&Cf(r),h=r.type,p=r.pendingProps,y=o!==null?o.memoizedProps:null,E=p.children,pf(h,p)?E=null:y!==null&&pf(h,y)&&(r.flags|=32),W0(o,r),en(o,r,E,d),r.child;case 6:return o===null&&Cf(r),null;case 13:return X0(o,r,d);case 4:return Of(r,r.stateNode.containerInfo),h=r.pendingProps,o===null?r.child=ls(r,null,h,d):en(o,r,h,d),r.child;case 11:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:ni(h,p),H0(o,r,h,p,d);case 7:return en(o,r,r.pendingProps,d),r.child;case 8:return en(o,r,r.pendingProps.children,d),r.child;case 12:return en(o,r,r.pendingProps.children,d),r.child;case 10:e:{if(h=r.type._context,p=r.pendingProps,y=r.memoizedProps,E=p.value,st(Pc,h._currentValue),h._currentValue=E,y!==null)if(ei(y.value,E)){if(y.children===p.children&&!gn.current){r=$i(o,r,d);break e}}else for(y=r.child,y!==null&&(y.return=r);y!==null;){var P=y.dependencies;if(P!==null){E=y.child;for(var k=P.firstContext;k!==null;){if(k.context===h){if(y.tag===1){k=Gi(-1,d&-d),k.tag=2;var $=y.updateQueue;if($!==null){$=$.shared;var K=$.pending;K===null?k.next=k:(k.next=K.next,K.next=k),$.pending=k}}y.lanes|=d,k=y.alternate,k!==null&&(k.lanes|=d),Df(y.return,d,r),P.lanes|=d;break}k=k.next}}else if(y.tag===10)E=y.type===r.type?null:y.child;else if(y.tag===18){if(E=y.return,E===null)throw Error(n(341));E.lanes|=d,P=E.alternate,P!==null&&(P.lanes|=d),Df(E,d,r),E=y.sibling}else E=y.child;if(E!==null)E.return=y;else for(E=y;E!==null;){if(E===r){E=null;break}if(y=E.sibling,y!==null){y.return=E.return,E=y;break}E=E.return}y=E}en(o,r,p.children,d),r=r.child}return r;case 9:return p=r.type,h=r.pendingProps.children,ds(r,d),p=xn(p),h=h(p),r.flags|=1,en(o,r,h,d),r.child;case 14:return h=r.type,p=ni(h,r.pendingProps),p=ni(h.type,p),G0(o,r,h,p,d);case 15:return $0(o,r,r.type,r.pendingProps,d);case 17:return h=r.type,p=r.pendingProps,p=r.elementType===h?p:ni(h,p),Gc(o,r),r.tag=1,pn(h)?(o=!0,Ac(r)):o=!1,ds(r,d),O0(r,h,p),zf(r,h,p,d),Kf(null,r,h,!0,o,d);case 19:return K0(o,r,d);case 22:return x0(o,r,d)}throw Error(n(156,r.tag))};function vy(o,r){return Qp(o,r)}function qE(o,r,d,h){this.tag=o,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function zn(o,r,d,h){return new qE(o,r,d,h)}function ph(o){return o=o.prototype,!(!o||!o.isReactComponent)}function ZE(o){if(typeof o=="function")return ph(o)?1:0;if(o!=null){if(o=o.$$typeof,o===z)return 11;if(o===Ee)return 14}return 2}function Co(o,r){var d=o.alternate;return d===null?(d=zn(o.tag,r,o.key,o.mode),d.elementType=o.elementType,d.type=o.type,d.stateNode=o.stateNode,d.alternate=o,o.alternate=d):(d.pendingProps=r,d.type=o.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=o.flags&14680064,d.childLanes=o.childLanes,d.lanes=o.lanes,d.child=o.child,d.memoizedProps=o.memoizedProps,d.memoizedState=o.memoizedState,d.updateQueue=o.updateQueue,r=o.dependencies,d.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},d.sibling=o.sibling,d.index=o.index,d.ref=o.ref,d}function Zc(o,r,d,h,p,y){var E=2;if(h=o,typeof o=="function")ph(o)&&(E=1);else if(typeof o=="string")E=5;else e:switch(o){case M:return ur(d.children,p,y,r);case F:E=8,p|=8;break;case x:return o=zn(12,d,r,p|2),o.elementType=x,o.lanes=y,o;case ne:return o=zn(13,d,r,p),o.elementType=ne,o.lanes=y,o;case ie:return o=zn(19,d,r,p),o.elementType=ie,o.lanes=y,o;case te:return Qc(d,p,y,r);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case q:E=10;break e;case ee:E=9;break e;case z:E=11;break e;case Ee:E=14;break e;case le:E=16,h=null;break e}throw Error(n(130,o==null?o:typeof o,""))}return r=zn(E,d,r,p),r.elementType=o,r.type=h,r.lanes=y,r}function ur(o,r,d,h){return o=zn(7,o,h,r),o.lanes=d,o}function Qc(o,r,d,h){return o=zn(22,o,h,r),o.elementType=te,o.lanes=d,o.stateNode={isHidden:!1},o}function mh(o,r,d){return o=zn(6,o,null,r),o.lanes=d,o}function yh(o,r,d){return r=zn(4,o.children!==null?o.children:[],o.key,r),r.lanes=d,r.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},r}function QE(o,r,d,h,p){this.tag=r,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Wu(0),this.expirationTimes=Wu(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Wu(0),this.identifierPrefix=h,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function Sh(o,r,d,h,p,y,E,P,k){return o=new QE(o,r,d,P,k),r===1?(r=1,y===!0&&(r|=8)):r=0,y=zn(3,null,null,r),o.current=y,y.stateNode=o,y.memoizedState={element:h,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mf(y),o}function JE(o,r,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:D,key:h==null?null:""+h,children:o,containerInfo:r,implementation:d}}function Iy(o){if(!o)return po;o=o._reactInternals;e:{if(Jo(o)!==o||o.tag!==1)throw Error(n(170));var r=o;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(pn(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(o.tag===1){var d=o.type;if(pn(d))return Vm(o,d,r)}return r}function Ty(o,r,d,h,p,y,E,P,k){return o=Sh(d,h,!0,o,p,y,E,P,k),o.context=Iy(null),d=o.current,h=tn(),p=Ao(d),y=Gi(h,p),y.callback=r??null,So(d,y,p),o.current.lanes=p,Ia(o,p,h),Sn(o,h),o}function Jc(o,r,d,h){var p=r.current,y=tn(),E=Ao(p);return d=Iy(d),r.context===null?r.context=d:r.pendingContext=d,r=Gi(y,E),r.payload={element:o},h=h===void 0?null:h,h!==null&&(r.callback=h),o=So(p,r,E),o!==null&&(ri(o,p,E,y),Nc(o,p,E)),E}function ed(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function Ay(o,r){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var d=o.retryLane;o.retryLane=d!==0&&d<r?d:r}}function vh(o,r){Ay(o,r),(o=o.alternate)&&Ay(o,r)}function eC(){return null}var Ey=typeof reportError=="function"?reportError:function(o){console.error(o)};function Ih(o){this._internalRoot=o}td.prototype.render=Ih.prototype.render=function(o){var r=this._internalRoot;if(r===null)throw Error(n(409));Jc(o,r,null,null)},td.prototype.unmount=Ih.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var r=o.containerInfo;lr(function(){Jc(null,o,null,null)}),r[Bi]=null}};function td(o){this._internalRoot=o}td.prototype.unstable_scheduleHydration=function(o){if(o){var r=sm();o={blockedOn:null,target:o,priority:r};for(var d=0;d<co.length&&r!==0&&r<co[d].priority;d++);co.splice(d,0,o),d===0&&cm(o)}};function Th(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function nd(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function Cy(){}function tC(o,r,d,h,p){if(p){if(typeof h=="function"){var y=h;h=function(){var $=ed(E);y.call($)}}var E=Ty(r,h,o,0,null,!1,!1,"",Cy);return o._reactRootContainer=E,o[Bi]=E.current,ba(o.nodeType===8?o.parentNode:o),lr(),E}for(;p=o.lastChild;)o.removeChild(p);if(typeof h=="function"){var P=h;h=function(){var $=ed(k);P.call($)}}var k=Sh(o,0,!1,null,null,!1,!1,"",Cy);return o._reactRootContainer=k,o[Bi]=k.current,ba(o.nodeType===8?o.parentNode:o),lr(function(){Jc(r,k,d,h)}),k}function id(o,r,d,h,p){var y=d._reactRootContainer;if(y){var E=y;if(typeof p=="function"){var P=p;p=function(){var k=ed(E);P.call(k)}}Jc(r,E,o,p)}else E=tC(d,r,o,p,h);return ed(E)}om=function(o){switch(o.tag){case 3:var r=o.stateNode;if(r.current.memoizedState.isDehydrated){var d=va(r.pendingLanes);d!==0&&(Yu(r,d|1),Sn(r,vt()),(je&6)===0&&(ps=vt()+500,mo()))}break;case 13:lr(function(){var h=Hi(o,1);if(h!==null){var p=tn();ri(h,o,1,p)}}),vh(o,1)}},zu=function(o){if(o.tag===13){var r=Hi(o,134217728);if(r!==null){var d=tn();ri(r,o,134217728,d)}vh(o,134217728)}},rm=function(o){if(o.tag===13){var r=Ao(o),d=Hi(o,r);if(d!==null){var h=tn();ri(d,o,r,h)}vh(o,r)}},sm=function(){return et},am=function(o,r){var d=et;try{return et=o,r()}finally{et=d}},Lu=function(o,r,d){switch(r){case"input":if(hn(o,d),r=d.name,d.type==="radio"&&r!=null){for(d=o;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<d.length;r++){var h=d[r];if(h!==o&&h.form===o.form){var p=Ic(h);if(!p)throw Error(n(90));ve(h),hn(h,p)}}}break;case"textarea":Fp(o,d);break;case"select":r=d.value,r!=null&&ro(o,!!d.multiple,r,!1)}},zp=fh,jp=lr;var nC={usingClientEntryPoint:!1,Events:[La,ns,Ic,Wp,Yp,fh]},Za={findFiberByHostInstance:er,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iC={bundleType:Za.bundleType,version:Za.version,rendererPackageName:Za.rendererPackageName,rendererConfig:Za.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:B.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=qp(o),o===null?null:o.stateNode},findFiberByHostInstance:Za.findFiberByHostInstance||eC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var od=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!od.isDisabled&&od.supportsFiber)try{tc=od.inject(iC),pi=od}catch{}}return vn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nC,vn.createPortal=function(o,r){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Th(r))throw Error(n(200));return JE(o,r,null,d)},vn.createRoot=function(o,r){if(!Th(o))throw Error(n(299));var d=!1,h="",p=Ey;return r!=null&&(r.unstable_strictMode===!0&&(d=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(p=r.onRecoverableError)),r=Sh(o,1,!1,null,null,d,!1,h,p),o[Bi]=r.current,ba(o.nodeType===8?o.parentNode:o),new Ih(r)},vn.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var r=o._reactInternals;if(r===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=qp(r),o=o===null?null:o.stateNode,o},vn.flushSync=function(o){return lr(o)},vn.hydrate=function(o,r,d){if(!nd(r))throw Error(n(200));return id(null,o,r,!0,d)},vn.hydrateRoot=function(o,r,d){if(!Th(o))throw Error(n(405));var h=d!=null&&d.hydratedSources||null,p=!1,y="",E=Ey;if(d!=null&&(d.unstable_strictMode===!0&&(p=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onRecoverableError!==void 0&&(E=d.onRecoverableError)),r=Ty(r,null,o,1,d??null,p,!1,y,E),o[Bi]=r.current,ba(o),h)for(o=0;o<h.length;o++)d=h[o],p=d._getVersion,p=p(d._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[d,p]:r.mutableSourceEagerHydrationData.push(d,p);return new td(r)},vn.render=function(o,r,d){if(!nd(r))throw Error(n(200));return id(null,o,r,!1,d)},vn.unmountComponentAtNode=function(o){if(!nd(o))throw Error(n(40));return o._reactRootContainer?(lr(function(){id(null,null,o,!1,function(){o._reactRootContainer=null,o[Bi]=null})}),!0):!1},vn.unstable_batchedUpdates=fh,vn.unstable_renderSubtreeIntoContainer=function(o,r,d,h){if(!nd(d))throw Error(n(200));if(o==null||o._reactInternals===void 0)throw Error(n(38));return id(o,r,d,!1,h)},vn.version="18.3.1-next-f1338f8080-20240426",vn}var Oy;function hC(){if(Oy)return Ch.exports;Oy=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Ch.exports=fC(),Ch.exports}var ky;function gC(){if(ky)return rd;ky=1;var e=hC();return rd.createRoot=e.createRoot,rd.hydrateRoot=e.hydrateRoot,rd}var pC=gC();const mC=Ev(pC);class yC{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let i=this.length++;for(;i>0;){const a=i-1>>1,s=this.values[a];if(n>=s)break;this.ids[i]=this.ids[a],this.values[i]=s,i=a}this.ids[i]=t,this.values[i]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],a=this.length>>1;let s=0;for(;s<a;){let l=(s<<1)+1;const c=l+1;let u=this.ids[l],f=this.values[l];const g=this.values[c];if(c<this.length&&g<f&&(l=c,u=this.ids[c],f=g),f>=i)break;this.ids[s]=u,this.values[s]=f,s=l}this.ids[s]=n,this.values[s]=i}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const by=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Rh=3;class Hg{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[i,a]=new Uint8Array(t,n+0,2);if(i!==251)throw new Error("Data does not appear to be in a Flatbush format.");const s=a>>4;if(s!==Rh)throw new Error(`Got v${s} data when expected v${Rh}.`);const l=by[a&15];if(!l)throw new Error("Unrecognized array type.");const[c]=new Uint16Array(t,n+2,1),[u]=new Uint32Array(t,n+4,1);return new Hg(u,c,l,void 0,t,n)}constructor(t,n=16,i=Float64Array,a=ArrayBuffer,s,l=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=l;let c=t,u=c;this._levelBounds=[c*4];do c=Math.ceil(c/this.nodeSize),u+=c,this._levelBounds.push(u*4);while(c!==1);this.ArrayType=i,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const f=by.indexOf(this.ArrayType),g=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(f<0)throw new Error(`Unexpected typed array class: ${i}.`);s&&s.byteLength!==void 0&&!s.buffer?(this.data=s,this._boxes=new this.ArrayType(this.data,l+8,u*4),this._indices=new this.IndexArrayType(this.data,l+8+g,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new a(8+g+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+g,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Rh<<4)+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new yC}add(t,n,i=t,a=n){const s=this._pos>>2,l=this._boxes;return this._indices[s]=s,l[this._pos++]=t,l[this._pos++]=n,l[this._pos++]=i,l[this._pos++]=a,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),i>this.maxX&&(this.maxX=i),a>this.maxY&&(this.maxY=a),s}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,i=this.maxY-this.minY||1,a=new Uint32Array(this.numItems),s=65535;for(let l=0,c=0;l<this.numItems;l++){const u=t[c++],f=t[c++],g=t[c++],m=t[c++],S=Math.floor(s*((u+g)/2-this.minX)/n),v=Math.floor(s*((f+m)/2-this.minY)/i);a[l]=vC(S,v)}cg(a,t,this._indices,0,this.numItems-1,this.nodeSize);for(let l=0,c=0;l<this._levelBounds.length-1;l++){const u=this._levelBounds[l];for(;c<u;){const f=c;let g=t[c++],m=t[c++],S=t[c++],v=t[c++];for(let T=1;T<this.nodeSize&&c<u;T++)g=Math.min(g,t[c++]),m=Math.min(m,t[c++]),S=Math.max(S,t[c++]),v=Math.max(v,t[c++]);this._indices[this._pos>>2]=f,t[this._pos++]=g,t[this._pos++]=m,t[this._pos++]=S,t[this._pos++]=v}}}search(t,n,i,a,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const c=[],u=[];for(;l!==void 0;){const f=Math.min(l+this.nodeSize*4,Fy(l,this._levelBounds));for(let g=l;g<f;g+=4){if(i<this._boxes[g]||a<this._boxes[g+1]||t>this._boxes[g+2]||n>this._boxes[g+3])continue;const m=this._indices[g>>2]|0;l>=this.numItems*4?c.push(m):(s===void 0||s(m))&&u.push(m)}l=c.pop()}return u}neighbors(t,n,i=1/0,a=1/0,s){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const c=this._queue,u=[],f=a*a;e:for(;l!==void 0;){const g=Math.min(l+this.nodeSize*4,Fy(l,this._levelBounds));for(let m=l;m<g;m+=4){const S=this._indices[m>>2]|0,v=By(t,this._boxes[m],this._boxes[m+2]),T=By(n,this._boxes[m+1],this._boxes[m+3]),I=v*v+T*T;I>f||(l>=this.numItems*4?c.push(S<<1,I):(s===void 0||s(S))&&c.push((S<<1)+1,I))}for(;c.length&&c.peek()&1;)if(c.peekValue()>f||(u.push(c.pop()>>1),u.length===i))break e;l=c.length?c.pop()>>1:void 0}return c.clear(),u}}function By(e,t,n){return e<t?t-e:e<=n?0:e-n}function Fy(e,t){let n=0,i=t.length-1;for(;n<i;){const a=n+i>>1;t[a]>e?i=a:n=a+1}return t[n]}function cg(e,t,n,i,a,s){if(Math.floor(i/s)>=Math.floor(a/s))return;const l=e[i+a>>1];let c=i-1,u=a+1;for(;;){do c++;while(e[c]<l);do u--;while(e[u]>l);if(c>=u)break;SC(e,t,n,c,u)}cg(e,t,n,i,u,s),cg(e,t,n,u+1,a,s)}function SC(e,t,n,i,a){const s=e[i];e[i]=e[a],e[a]=s;const l=4*i,c=4*a,u=t[l],f=t[l+1],g=t[l+2],m=t[l+3];t[l]=t[c],t[l+1]=t[c+1],t[l+2]=t[c+2],t[l+3]=t[c+3],t[c]=u,t[c+1]=f,t[c+2]=g,t[c+3]=m;const S=n[i];n[i]=n[a],n[a]=S}function vC(e,t){let n=e^t,i=65535^n,a=65535^(e|t),s=e&(t^65535),l=n|i>>1,c=n>>1^n,u=a>>1^i&s>>1^a,f=n&a>>1^s>>1^s;n=l,i=c,a=u,s=f,l=n&n>>2^i&i>>2,c=n&i>>2^i&(n^i)>>2,u^=n&a>>2^i&s>>2,f^=i&a>>2^(n^i)&s>>2,n=l,i=c,a=u,s=f,l=n&n>>4^i&i>>4,c=n&i>>4^i&(n^i)>>4,u^=n&a>>4^i&s>>4,f^=i&a>>4^(n^i)&s>>4,n=l,i=c,a=u,s=f,u^=n&a>>8^i&s>>8,f^=i&a>>8^(n^i)&s>>8,n=u^u>>1,i=f^f>>1;let g=e^t,m=i|65535^(g|n);return g=(g|g<<8)&16711935,g=(g|g<<4)&252645135,g=(g|g<<2)&858993459,g=(g|g<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|g)>>>0}function IC(e,t){return t.split(".").reduce((n,i)=>{if(n&&typeof n=="object"&&i in n)return n[i]},e)}function wo(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new Hg(e.length),i=new Map,a=new Map;for(const l of e)l.width!==void 0&&l.height!==void 0?n.add(l.position.x,l.position.y,l.position.x+l.width,l.position.y+l.height):n.add(l.position.x,l.position.y,l.position.x,l.position.y);return n.finish(),{all(){return e},byRect(l){const{width:c,height:u}=t,f=new Set,g=[];l.left<0?(g.push({left:l.left+c,right:c}),g.push({left:0,right:l.right})):l.right>c?(g.push({left:l.left,right:c}),g.push({left:0,right:l.right-c})):g.push({left:l.left,right:l.right});const m=[];l.top<0?(m.push({top:l.top+u,bottom:u}),m.push({top:0,bottom:l.bottom})):l.bottom>u?(m.push({top:l.top,bottom:u}),m.push({top:0,bottom:l.bottom-u})):m.push({top:l.top,bottom:l.bottom});for(const S of g)for(const v of m){const T=n.search(S.left,v.top,S.right,v.bottom);for(const I of T)f.add(I)}return Array.from(f).map(S=>e[S])},byRadius(l,c){const{width:u,height:f}=t,g=new Set;for(let m=-u;m<=u;m+=u)for(let S=-f;S<=f;S+=f){const v=l.x+m,T=l.y+S,I=Math.max(0,Math.min(v,u)),_=Math.max(0,Math.min(T,f));if((v-I)**2+(T-_)**2<=c**2){const R=n.neighbors(v,T,void 0,c);for(const w of R)g.add(w)}}return Array.from(g).map(m=>e[m])},byProperty(l,c){var u;if(!i.has(l)){const f=new Map;for(const g of e){const m=g[l];f.has(m)||f.set(m,[]),f.get(m).push(g)}i.set(l,f)}return((u=i.get(l))==null?void 0:u.get(c))||[]},byPropertyPath(l,c){var u;if(!a.has(l)){const f=new Map;for(const g of e){const m=IC(g,l);f.has(m)||f.set(m,[]),f.get(m).push(g)}a.set(l,f)}return((u=a.get(l))==null?void 0:u.get(c))||[]},resetPropertyCache(){i.clear(),a.clear()},count(){return e.length}}}const js=80,Fn=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],we=20,At=24,Rt=10,Xe=4e3,qe=4e3,Gg=2,TC=15,AC=5e3,Qi=100,Ji=20,eo=60,Cv=200,EC=1e3,Xs=1,Vs=150*.6,Ly=150*.25,CC=150*.7,_C=150*.8,wC=400,RC=800,PC=150,DC=300,NC=2,Uy=800,MC=500,OC=150*.85,kC=150,bC=3,BC=24,_v=600,FC=1,LC=1,UC=.5,HC=1,GC=.5,$C=2,ws=24,Ms=12,xC=24,WC=1.5,YC=150,zC=200,jC=100,XC=.7,VC=300,KC=400,Ph=600,qC=600,wv=.15,ZC=200,Dh=30*.75*1.2,QC=20,Rv=.3,Pv=.6,Dv=.8,JC=1,e_=3,t_=5,n_=6,Hy=.5,i_=.4,o_=.6,r_=.8,s_=2,Xi=Xe/2,Gy=2,dg=.7,ug=.5,fl=10,a_=.5,$s=400,Nv=800,l_=8,$y=5,c_=16,Mv=5,Ov=600,Vi=100,d_=100,kv=150;function ci(e,t){return{x:e.x+t.x,y:e.y+t.y}}function u_(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Et(e,t){return{x:e.x*t,y:e.y*t}}function Ks(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function rt(e){const t=Ks(e);return t===0?{x:0,y:0}:Et(e,1/t)}function $g(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function Hd(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,i)=>({x:n.x+i.x,y:n.y+i.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function ze(e,t,n,i){let a=t.x-e.x,s=t.y-e.y;return Math.abs(a)>n/2&&(a=a-Math.sign(a)*n),Math.abs(s)>i/2&&(s=s-Math.sign(s)*i),{x:a,y:s}}function ot(e,t,n){const i=ze(e,t,n.width,n.height);return rt(i)}function G(e,t,n,i){const a=ze(e,t,n,i);return Ks(a)}function bv(e,t){return e.x*t.x+e.y*t.y}function f_(e,t){const n=bv(e,t),i=Ks(e),a=Ks(t);if(i===0||a===0)return 0;const s=Math.max(-1,Math.min(1,n/(i*a)));return Math.acos(s)}function fg(e,t){const n=Math.cos(t),i=Math.sin(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function h_(e,t,n){const i=Math.max(0,Math.min(1,n)),a={r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16)},s={r:parseInt(t.substring(1,3),16),g:parseInt(t.substring(3,5),16),b:parseInt(t.substring(5,7),16)},l=Math.round(a.r+(s.r-a.r)*i),c=Math.round(a.g+(s.g-a.g)*i),u=Math.round(a.b+(s.b-a.b)*i),f=g=>("00"+g.toString(16)).slice(-2);return`#${f(l)}${f(c)}${f(u)}`}const iu=10,Dl=80,Bv=3,Ja=5,ln=150,xg=ln*.8,g_=ln*.2,qt=ln*.8,zo=30,Fv=10,p_=10,m_=.5,Ze=30,qs=Ze*.75,ou=30,Wg=ou*.75,Lv=50,y_=20,S_=Dl*.8,v_=.7,Nl=16,ru=40,I_=24,Yg=16,T_=72/3,xy=24,A_=1.25,E_=1.5,Zs=ln*.6,su=50,C_=1,__=350,zg=Dl*.65,w_=80,R_=50,P_=1,D_=128,Uv=10,Wy=100,jg=35,jo=30,au=.5,lu=2.5,Xg=20,Tn=250,Vg=.4,Kg=150,qg=6,N_=5,Zg=2,cu=.5,du=1.5,M_=1,O_=.5,k_=.5,b_=1.5,B_=.25,F_=2.5,L_=45,U_=.05,H_=200;var Ft=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(Ft||{}),Ye=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e[e.SupplyChain=5]="SupplyChain",e))(Ye||{}),Lr=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(Lr||{});const Gd=24,G_=24;let $_=0;function x_(){return`notification-${Date.now()}-${$_++}`}function Ml(e,t){if(t.identifier){const i=e.notifications.find(a=>a.identifier===t.identifier);if(i){if(i.dismissedUntil&&e.time<i.dismissedUntil)return;i.message=t.message,i.timestamp=e.time,i.creationTime=Date.now(),i.duration=t.duration,i.targetEntityIds=t.targetEntityIds,i.highlightedEntityIds=t.highlightedEntityIds,i.targetPosition=t.targetPosition,i.targetArea=t.targetArea,i.targetRadius=t.targetRadius,i.isDismissed=!1,i.dismissedUntil=void 0;return}}const n={...t,id:x_(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function W_(e,t){const n=e.notifications.find(i=>i.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+G_))}function Y_(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function z_(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const i of n.highlightedEntityIds){const a=e.entities.entities[i];a&&(a.isHighlighted=!0)}}const he={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire"},qo={[he.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[he.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[he.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[he.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}}},j_=.5,X_="#FFA500",V_="#FF4500",Yy=4,K_=10,Qg=60;function Jg(e){return qo[e].dimensions}function q_(e){return qo[e].constructionTimeHours}function Z_(e){return qo[e].destructionTimeHours}function Q_(e,t,n,i,a){var l;(l=e.onExit)==null||l.call(e,i,t);const s=a.find(({id:c})=>c===t);return s!=null&&s.onEnter?s.onEnter(i,n):{...n,enteredAt:i.updateContext.gameState.time}}function J_(e,t){return t.find(({id:n})=>n===e)}function ew(e,t){return e!==t}function tw(e){console.warn(`No handler found for state: ${e}`)}const vl="bushGrowing",Er="bushFull",Pd="bushSpreading",Ol="bushDying",nw=5,iw=3,ow=12,rw=940,hg=20,zy=90,Hv=100,io=5,sw=.5,Ur=30,to=.1,hl=.9,aw=2,lw=2;var fn=(e=>(e.Berry="berry",e.Meat="meat",e))(fn||{});const ep={berry:"",meat:""};function Gv(e,t){return`${e},${t}`}function $v(e){const[t,n]=e.split(",").map(Number);return{gridX:t,gridY:n}}function cw(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function xv(){return{lastUpdateTime:0,sectors:{}}}const Wt=20,$d=100,Wv=20,Yv=0,dw=20,uw=1,zv=.15,fw=.5,hw=.01,gw=24,pw="#6B5344",mw="#4A3728",jy=.85,jv=35,yw=30,Xy=1.25,Vy=40,Nh=Math.PI/6,Xv=.5,Sw=1;function tp(e,t,n,i){const a=Math.random()*Math.PI*2,s=Math.sqrt(Math.random())*t,l={x:Math.cos(a)*s,y:Math.sin(a)*s},c=ci(e,l);return{x:(c.x%n+n)%n,y:(c.y%i+i)%i}}function qn(e,t,n,i){const a=t,s={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},l=[...a.search.human.byRect(s),...a.search.berryBush.byRect(s),...a.search.corpse.byRect(s)];for(const c of l){if(i!==void 0&&c.id===i)continue;if(G(e,c.position,t.mapDimensions.width,t.mapDimensions.height)<n+c.radius)return!0}return!1}function vw(e,t,n,i,a){const s=t.mapDimensions.width,l=t.mapDimensions.height;if(!qn(e,t,i,a)&&!Mi(t.soilDepletion,e,s,l))return e;const c=i;for(let u=c;u<=n;u+=c){const f=Math.ceil(2*Math.PI*u/c);for(let g=0;g<f;g++){const m=g/f*2*Math.PI,S={x:Math.cos(m)*u,y:Math.sin(m)*u},v=ci(e,S),T={x:(v.x%s+s)%s,y:(v.y%l+l)%l};if(!qn(T,t,i,a)&&!Mi(t.soilDepletion,T,s,l))return T}}return null}function Xo(e,t){const n=t.search.building.byProperty("ownerId",e);if(n.length>0){const s=n.map(l=>l.position);return Hd(s)}const i=ki(e,t);if(i.length===0){const s=t.entities.entities[e];return s?s.position:{x:0,y:0}}const a=i.map(s=>s.position);return Hd(a)}function Ky(e,t){const i=[...Gl(e,t),e].map(a=>a.position);return Hd(i)}function gg(e,t,n){const i=n.mapDimensions.width,a=n.mapDimensions.height;let s=e.x-t.position.x,l=e.y-t.position.y;return Math.abs(s)>i/2&&(s-=Math.sign(s)*i),Math.abs(l)>a/2&&(l-=Math.sign(l)*a),Math.abs(s)<=t.width/2&&Math.abs(l)<=t.height/2}var St=(e=>(e.Wood="wood",e))(St||{});const np={wood:""},qi=100,Vv=20,xs=10,Iw=.5,Ws=150,Tw=25,Aw=.5,Rr=100,Kv=25,ip=.5,qv=15,xd=4,Ew=.75,Cw=15,qy=8,Zv=12,_w=.5,aa=(e,t,n)=>{var c,u,f,g;if(!e||!t||e===t)return!1;const i=n.entities.entities[e],a=n.entities.entities[t],s=(u=(c=i==null?void 0:i.tribeControl)==null?void 0:c.diplomacy)==null?void 0:u[t],l=(g=(f=a==null?void 0:a.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[e];return s===Ft.Hostile||l===Ft.Hostile},la=(e,t,n)=>e.id===t.id?!1:aa(e.leaderId,t.leaderId,n),cn=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:aa(e.leaderId,t.ownerId,n),xr=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=qt||t.hunger>=qt||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||la(e,t,n))return!1;const i=e.gender==="female"?e:t;return!(i.isPregnant||i.age>ru)};function ww(e){const t=Math.floor(e.x/we),n=Math.floor(e.y/we);return{x:t,y:n}}function Rw(e,t){const n=Math.ceil(t/we),i=e%n*we+we/2,a=Math.floor(e/n)*we+we/2;return{x:i,y:a}}function Pw(e,t,n){const i=(e.x%t+t)%t,a=(e.y%n+n)%n,s=Math.floor(i/we),l=Math.floor(a/we),c=Math.ceil(t/we);return l*c+s}function xo(e,t,n){const i=Pw({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[i]||null}function Qv(e,t){return t.terrainOwnership.includes(e)}function Jv(e,t,n,i){var l;const a=n;return(l=a.search)!=null&&l.human?a.search.human.byRadius(e,i).some(c=>aa(t,c.leaderId,n)):!1}function Dw(e,t,n,i,a=!1,s){if(a&&s&&Jv(e,s,i,kv))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:l,height:c}=i.mapDimensions,u=Math.ceil(l/we),f=Math.ceil(c/we),g=Math.ceil(t/we),m=Math.floor(e.x/we),S=Math.floor(e.y/we);let v=!1,T=!1;for(let I=-g;I<=g;I++)for(let _=-g;_<=g;_++){const N=((m+_)%u+u)%u,R=((S+I)%f+f)%f,w=N*we+we/2,B=R*we+we/2;if(G(e,{x:w,y:B},l,c)<=t){const D=R*u+N,M=i.terrainOwnership[D];if(M===n)v=!0;else if(M!==null){if(a&&s&&aa(s,M,i))continue;T=!0}}}return T?{valid:!1,reason:"Position overlaps with another tribe's territory"}:v?{valid:!0}:Qv(n,i)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function eI(e,t,n,i){if(!Qv(n,i))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(Jv(e,n,i,kv))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:a,height:s}=i.mapDimensions,l=Math.ceil(a/we),c=Math.ceil(s/we),u=Math.ceil(t/we),f=Math.floor(e.x/we),g=Math.floor(e.y/we);let m=!1;for(let S=-u;S<=u;S++){for(let v=-u;v<=u;v++){const T=((f+v)%l+l)%l,I=((g+S)%c+c)%c,_=T*we+we/2,N=I*we+we/2;if(G(e,{x:_,y:N},a,s)<=t){const w=I*l+T;if(i.terrainOwnership[w]===n){m=!0;break}}}if(m)break}return m?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function tI(e,t,n,i=0,a=!1,s){if(i>0){const c=Dw(e,i,t,n,a,s);return c.valid?{canPlace:!0}:{canPlace:!1,reason:c.reason}}const l=xo(e.x,e.y,n);return l===null||l===t?{canPlace:!0}:a&&s&&aa(s,l,n)?{canPlace:!0}:l!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function pg(e,t,n){const i=xo(e.x,e.y,n);return i===null||i===t}function Pr(e,t,n){const i=xo(e.x,e.y,n);return i===null||i===t}function Nw(e,t,n,i){if(pg(t,n,i))return t;const{width:a,height:s}=i.mapDimensions,l=ze(e,t,a,s),c=Math.sqrt(l.x**2+l.y**2);if(c===0)return e;let u=e;const f=G(e,t,a,s),g=f/10;for(let m=g;m<=f;m+=g){const S={x:((e.x+l.x*m/c)%a+a)%a,y:((e.y+l.y*m/c)%s+s)%s};if(pg(S,n,i))u=S;else break}return u}function nI(e,t,n,i,{allowOverwrite:a}){const{width:s,height:l}=i.mapDimensions,c=Math.ceil(s/we),u=Math.ceil(l/we),f=Math.ceil(t/we),g=Math.floor(e.x/we),m=Math.floor(e.y/we);for(let R=-f;R<=f;R++)for(let w=-f;w<=f;w++){const B=((g+w)%c+c)%c,O=((m+R)%u+u)%u,D=B*we+we/2,M=O*we+we/2;if(G(e,{x:D,y:M},s,l)<=t){const x=O*c+B,q=i.terrainOwnership[x];(a||q===null||q===n)&&(i.terrainOwnership[x]=n)}}const S=3,v=f+S+2,T=[];for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const B=((g+w)%c+c)%c,O=((m+R)%u+u)%u,D=O*c+B;if(i.terrainOwnership[D]===null){let M=!1;const F=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const x of F){let q=!1,ee=!1;for(let z=1;z<=S;z++){const ne=((B+x.x*z)%c+c)%c,Ee=((O+x.y*z)%u+u)%u*c+ne;if(i.terrainOwnership[Ee]===n){q=!0;break}}if(q)for(let z=1;z<=S;z++){const ne=((B-x.x*z)%c+c)%c,Ee=((O-x.y*z)%u+u)%u*c+ne;if(i.terrainOwnership[Ee]===n){ee=!0;break}}if(q&&ee){M=!0;break}}M&&T.push(D)}}for(const R of T)i.terrainOwnership[R]=n;const I=250,_=new Set;for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const B=((g+w)%c+c)%c,D=((m+R)%u+u)%u*c+B;if(i.terrainOwnership[D]===null&&!_.has(D)){const M=[],F=[D];_.add(D),M.push(D);let x=!0,q=0;for(;q<F.length;){const ee=F[q++];if(M.length>I){x=!1;break}const z=ee%c,ne=Math.floor(ee/c),ie=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:Ee,ny:le}of ie){const te=((z+Ee)%c+c)%c,X=((ne+le)%u+u)%u*c+te;i.terrainOwnership[X]===null&&!_.has(X)&&(_.add(X),x&&(M.push(X),F.push(X)))}}if(x&&M.length<=I)for(const ee of M)i.terrainOwnership[ee]=n}}const N=[];for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const B=((g+w)%c+c)%c,O=((m+R)%u+u)%u,D=O*c+B;if(i.terrainOwnership[D]===null){let M=0;for(let F=-1;F<=1;F++)for(let x=-1;x<=1;x++){if(x===0&&F===0)continue;const q=((B+x)%c+c)%c,z=((O+F)%u+u)%u*c+q;i.terrainOwnership[z]===n&&M++}M>=5&&N.push(D)}}for(const R of N)i.terrainOwnership[R]=n}function iI(e,t,n,i){nI(e,t,n,i,{allowOverwrite:!1})}function oI(e,t,n,i){nI(e,t,n,i,{allowOverwrite:!0})}function rI(e,t,n){const{width:i,height:a}=n.mapDimensions,s=Math.ceil(i/we),l=Math.ceil(a/we),c=Math.floor(e.x/we),u=Math.floor(e.y/we),f=50;for(let g=0;g<=f;g++){const m=-g,S=g,v=-g,T=g;for(let I=v;I<=T;I++)for(let _=m;_<=S;_++){if(g>0&&_>m&&_<S&&I>v&&I<T)continue;const N=((c+_)%s+s)%s,R=((u+I)%l+l)%l,w=R*s+N;if(n.terrainOwnership[w]===t){let B=!1;const O=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:D,ny:M}of O){const F=((N+D)%s+s)%s,q=((R+M)%l+l)%l*s+F;if(n.terrainOwnership[q]!==t){B=!0;break}}if(B)return{x:N*we+we/2,y:R*we+we/2}}}}return null}function Wd(e,t,n){const i=e.terrainOwnership;for(let a=0;a<i.length;a++)i[a]===t&&(i[a]=n)}const Kn="treeGrowing",Ln="treeFull",di="treeSpreading",An="treeFallen",no="treeStump",Hr="treeDying",Mw=500;function Ow(e,t){if(!e.leaderId)return 0;const n=kw(e.leaderId,t),i=bw(e.leaderId,t);return i===0?0:Math.min(1,n/i)}function kw(e,t){const n=Cn({leaderId:e},t),i=Wr(e,t),a=n.reduce((l,c)=>l+c.food.length,0),s=i.reduce((l,c)=>{var f;const u=(f=c.storedItems)==null?void 0:f.filter(g=>g.item.type===fn.Berry||g.item.type===fn.Meat);return l+((u==null?void 0:u.length)||0)},0);return a+s}function bw(e,t){const n=Cn({leaderId:e},t),i=Wr(e,t),a=n.reduce((l,c)=>l+c.maxFood,0),s=i.reduce((l,c)=>l+(c.storageCapacity||0),0);return a+s}function op(e,t){const n=Wr(e,t);if(n.length===0)return 0;const i=n.reduce((s,l)=>{var c;return s+(((c=l.storedItems)==null?void 0:c.length)||0)},0),a=n.reduce((s,l)=>s+(l.storageCapacity||0),0);return a===0?0:Math.min(1,i/a)}function mg(e,t){const n=Cn({leaderId:e},t),i=0,l=t.search.building.all().filter(T=>{if(!T.ownerId)return!1;const I=t.entities.entities[T.ownerId];return I&&I.leaderId===e}).reduce((T,I)=>{if(I.isConstructed)return T;const _=qo[I.buildingType].cost.wood||0;return T+_},0),u=Gr(e,t).reduce((T,I)=>{const N=(I.maxFuelLevel||Rr)-(I.fuelLevel||0);if(N<=0)return T;const R=Math.ceil(N/Kv),w=I.storedItems.filter(O=>O.item.type===St.Wood).length,B=Math.max(0,R-w);return T+B},0),g=Wr(e,t).reduce((T,I)=>{var N;const _=(N=I.storedItems)==null?void 0:N.filter(R=>R.item.type===St.Wood);return T+((_==null?void 0:_.length)||0)},0),m=n.reduce((T,I)=>{var _;return T+(((_=I.heldItem)==null?void 0:_.type)===St.Wood?1:0)},0),S=g+m,v=l+u+i;return Math.max(0,v-S)}function Bw(e,t){return t.search.tree.all().filter(a=>{var l;return!(((l=a.stateMachine)==null?void 0:l[0])===An)||a.wood.length===0?!1:Pr(a.position,e,t)}).reduce((a,s)=>a+s.wood.length,0)}function rp(e,t){const n=Cn({leaderId:e},t);if(n.length===0)return{count:0,ratio:0};const i=Fw(e,t);return{count:i,ratio:i/n.length}}function Fw(e,t){const n=t;return n.search.berryBush.all().filter(s=>n.search.terrainOwnership.byRadius(s.position,s.radius).some(l=>l.ownerId===e)).filter(s=>{const l=s.stateMachine&&s.stateMachine[0]==="bushDying",c=s.food.length>0,u=Mi(t.soilDepletion,s.position,t.mapDimensions.width,t.mapDimensions.height);return!l&&c&&!u}).length}function uu(e,t,n=!1){return e.leaderId?t.search.building.byProperty("ownerId",e.leaderId).filter(s=>!(s.buildingType!==he.PlantingZone||!n&&!s.isConstructed)):[]}function Lw(e,t){const{width:n,height:i,position:a}=e,{width:s,height:l}=t.mapDimensions,{depletedSectors:c,totalSectorsCount:u}=fI(t.soilDepletion,a,n,i,s,l);return u===0?!0:c.length/u<.25}function sI(e){const t=Ur*2,n=Math.floor(e.width/t),i=Math.floor(e.height/t);return n*i}function aI(e,t){const n=t,i=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,i).filter(l=>{const c=Math.abs(l.position.x-e.position.x),u=Math.abs(l.position.y-e.position.y);return c<=e.width/2&&u<=e.height/2}).length}function Uw(e,t){if(!e.leaderId)return[];const n=Wr(e.leaderId,t),i=Cn(e,t);return n.map(a=>{var f;const s=a.storageCapacity||0,l=((f=a.storedItems)==null?void 0:f.length)||0,c=i.filter(g=>{if(g.activeAction!=="depositing")return!1;if(typeof g.target=="object"&&"x"in g.target){const m=g.target;return G(m,a.position,t.mapDimensions.width,t.mapDimensions.height)<=50}return!1}).length,u=G(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height);return{storage:a,capacity:s,currentItems:l,assignedDepositors:c,distance:u}})}function lI(e,t){const n=Uw(e,t);if(n.length===0)return null;const i=n.filter(a=>{const s=a.currentItems<a.capacity,l=a.distance<=Mw;return s&&l});return i.length===0?null:(i.sort((a,s)=>{const l=a.currentItems/a.capacity,c=s.currentItems/s.capacity;return Math.abs(l-c)>.1?l-c:a.assignedDepositors!==s.assignedDepositors?a.assignedDepositors-s.assignedDepositors:a.distance-s.distance}),i[0].storage)}function Hw(e,t){if(!e.leaderId)return null;const i=Gr(e.leaderId,t).filter(a=>{const s=a.storageCapacity||xd;return a.storedItems.length<s});if(i.length>0){const a=i.filter(s=>{const l=s.fuelLevel??0,c=s.maxFuelLevel??Rr;return l<c*ip});return a.length>0?(a.sort((s,l)=>{const c=s.fuelLevel??0,u=l.fuelLevel??0,f=s.maxFuelLevel??Rr,g=l.maxFuelLevel??Rr,m=c/f,S=u/g,v=m<.25,T=S<.25;return v!==T?v?-1:1:c-u}),a[0]):(i.sort((s,l)=>{const c=G(e.position,s.position,t.mapDimensions.width,t.mapDimensions.height),u=G(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);return c-u}),i[0])}return lI(e,t)}function cI(e,t,n){return Cn({leaderId:e},t).filter(a=>a.activeAction===n).length}function Wr(e,t,n=!1){return t.search.building.all().filter(s=>{if(s.buildingType!==he.StorageSpot||!n&&!s.isConstructed)return!1;if(s.ownerId){const l=t.entities.entities[s.ownerId];return l&&l.leaderId===e}return!1})}function Gr(e,t,n=!1){return t.search.building.all().filter(s=>{if(s.buildingType!==he.Bonfire||!n&&!s.isConstructed)return!1;if(s.ownerId){const l=t.entities.entities[s.ownerId];return l&&l.leaderId===e}return!1})}function Gw(e,t){const n=uu(e,t);if(n.length===0)return null;const i=t.mapDimensions.width,a=t.mapDimensions.height,s=t.soilDepletion;for(const l of n){const c=sI(l);if(aI(l,t)>=c)continue;const f=20;for(let g=0;g<f;g++){const m=l.position.x+(Math.random()-.5)*l.width,S=l.position.y+(Math.random()-.5)*l.height,v={x:(m%i+i)%i,y:(S%a+a)%a};if(!Mi(s,v,i,a)&&!qn(v,t,Ur))return{position:v,zoneId:l.id}}}return null}function Yl(e,t,n=void 0){return n?uu(n,t).some(l=>gg(e,l,t)):t.search.building.byRadius(e,60).some(s=>s.buildingType===he.PlantingZone&&gg(e,s,t))}function fu(e,t,n){const i=(e.x%t+t)%t,a=(e.y%n+n)%n;return{gridX:Math.floor(i/Wt),gridY:Math.floor(a/Wt)}}function dI(e,t,n){const i=Gv(t,n);return e.sectors[i]||(e.sectors[i]=cw()),e.sectors[i]}function sp(e,t,n){const i=Gv(t,n),a=e.sectors[i];return a?a.health:$d}function Mi(e,t,n,i){const{gridX:a,gridY:s}=fu(t,n,i);return sp(e,a,s)<Wv}function uI(e,t,n){return sp(e,t,n)>=Wv}function $w(e,t,n,i,a,s,l){const{gridX:c,gridY:u}=fu(t,a,s),f=dI(e,c,u),g=f.lastAffectedBy[n]||0;if(i-g<zv)return;const m=Yl(t,l)?Xv:1,S=uw*m;f.health=Math.max(Yv,f.health-S),f.lastWalkTime=i,f.lastAffectedBy[n]=i}function xw(e,t,n,i,a,s){const{gridX:l,gridY:c}=fu(t,i,a),u=dI(e,l,c),f=Yl(t,s)?Xv:1,g=dw*f;u.health=Math.max(Yv,u.health-g),u.lastPlantTime=n}function Ww(e,t,n,i,a){let s=0;for(let l=-1;l<=1;l++)for(let c=-1;c<=1;c++){if(l===0&&c===0)continue;const u=((t+l)%i+i)%i,f=((n+c)%a+a)%a;uI(e,u,f)&&s++}return s}function Yw({soilDepletion:e,time:t,mapDimensions:{width:n,height:i}}){if(t-e.lastUpdateTime<Sw)return;const a=t-e.lastUpdateTime;e.lastUpdateTime=t;const s=Math.ceil(n/Wt),l=Math.ceil(i/Wt),c=[];for(const u of Object.keys(e.sectors)){const f=e.sectors[u],g=Math.max(f.lastWalkTime,f.lastPlantTime);if(t-g<gw)continue;const{gridX:m,gridY:S}=$v(u),v=Ww(e,m,S,s,l),T=v>0?hw*(v/8):0,I=fw+T;f.health=Math.min($d,f.health+I*a),f.health>=$d&&c.push(u);const _=t-zv*10;for(const N of Object.keys(f.lastAffectedBy))f.lastAffectedBy[Number(N)]<_&&delete f.lastAffectedBy[Number(N)]}for(const u of c)delete e.sectors[u]}function zw(e,t){const n=[];for(const i of Object.keys(e.sectors)){const a=e.sectors[i];if(a.health<t){const{gridX:s,gridY:l}=$v(i);n.push({gridX:s,gridY:l,health:a.health})}}return n}function fI(e,t,n,i,a,s){const l=[],c=n/2,u=i/2,f=t.x-c,g=t.x+c,m=t.y-u,S=t.y+u,v=Math.floor(f/Wt),T=Math.floor((g-.001)/Wt),I=Math.floor(m/Wt),_=Math.floor((S-.001)/Wt),N=Math.ceil(a/Wt),R=Math.ceil(s/Wt);let w=0;for(let B=v;B<=T;B++)for(let O=I;O<=_;O++){w++;const D=(B%N+N)%N,M=(O%R+R)%R;uI(e,D,M)||l.push({gridX:D,gridY:M})}return{depletedSectors:l,totalSectorsCount:w}}function Zy(e,t,n,i,a){const{gridX:s,gridY:l}=fu(t,n,i),c=sp(e,s,l);return 1+(a-1)*Math.sqrt(1-c/$d)}const jw={id:vl,update:(e,t)=>{const{entity:n,updateContext:i}=t,a=i.deltaTime*(At/Rt);if(n.age+=a,n.age>=n.lifespan)return{nextState:Ol,data:{...e,enteredAt:i.gameState.time}};if(!Mi(i.gameState.soilDepletion,n.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)){const l=Yl(n.position,i.gameState)?lw:1;n.timeSinceLastBerryRegen+=a*l,n.timeSinceLastBerryRegen>=ow&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:fn.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:Er,data:{...e,enteredAt:i.gameState.time,previousState:vl}}:{nextState:vl,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},Xw={id:Er,update:(e,t)=>{const{entity:n,updateContext:i}=t,a=i.deltaTime*(At/Rt);if(n.age+=a,n.age>=n.lifespan)return{nextState:Ol,data:{...e,enteredAt:i.gameState.time,previousState:Er}};if(n.food.length<n.maxFood)return{nextState:vl,data:{...e,enteredAt:i.gameState.time,previousState:Er}};if(n.timeSinceLastSpreadAttempt+=a,n.timeSinceLastSpreadAttempt>=zy){n.timeSinceLastSpreadAttempt=0;const l=i.gameState.time-n.timeSinceLastHarvest>=zy,c=Yl(n.position,i.gameState)?aw:1,u=i.gameState.ecosystem.berryBushSpreadChance*c;if(l&&Math.random()<u)return{nextState:Pd,data:{...e,enteredAt:i.gameState.time,previousState:Er}}}return{nextState:Er,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},Vw={id:Pd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:a}=i,s=i.deltaTime*(At/Rt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Ol,data:{...e,enteredAt:a.time,previousState:Pd}};const l=tp(n.position,n.spreadRadius,a.mapDimensions.width,a.mapDimensions.height);return qn(l,a,15)||Vl(a.entities,l,a.time),{nextState:Er,data:{...e,enteredAt:a.time,previousState:Pd}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},Kw={id:Ol,update:e=>({nextState:Ol,data:e}),onEnter:(e,t)=>(zr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},qw=[jw,Xw,Vw,Kw],pt="humanIdle",Tr="humanMoving",gl="humanEating",ca="humanGathering",Il="humanDepositing",Tl="humanRetrieving",_r="humanProcreating",Vo="humanAttacking",Dd="humanPlanting",ap="humanChopping",Zw={id:pt,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:Vo,data:{...e,enteredAt:i.gameState.time,previousState:pt,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:(n.hunger>=xg?(n.debuffs=n.debuffs.filter(a=>a.type!=="slow"),n.debuffs.push({type:"slow",startTime:i.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(a=>a.type!=="slow"),n.activeAction==="moving"?{nextState:Tr,data:{...e,enteredAt:i.gameState.time,previousState:pt,target:n.target}}:n.activeAction==="gathering"?{nextState:ca,data:{...e,enteredAt:i.gameState.time,previousState:pt,target:n.target}}:n.activeAction==="eating"?{nextState:gl,data:{...e,enteredAt:i.gameState.time,previousState:pt}}:n.activeAction==="planting"&&n.target?{nextState:Dd,data:{...e,enteredAt:i.gameState.time,previousState:pt,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:Il,data:{...e,enteredAt:i.gameState.time,previousState:pt}}:n.activeAction==="retrieving"?{nextState:Tl,data:{...e,enteredAt:i.gameState.time,previousState:pt}}:n.activeAction==="chopping"&&n.target?{nextState:ap,data:{...e,enteredAt:i.gameState.time,previousState:pt,state:"chopping"}}:{nextState:pt,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function hI(e,t=1){let n=p_;return e.hunger>=xg&&(n*=m_),e.age>=S_&&(n*=v_),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const Mh=7.5;class Qw{constructor(){Pe(this,"id",Tr)}update(t,n){var S;const{entity:i,updateContext:a}=n;if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:Vo,data:{...t,enteredAt:a.gameState.time,previousState:Tr,attackTargetId:i.attackTargetId,attackStartTime:a.gameState.time}};if(i.activeAction!=="moving")return{nextState:pt,data:{...t,enteredAt:a.gameState.time,previousState:Tr}};let s;if(typeof i.target=="object"?s=i.target:typeof i.target=="number"&&(s=(S=n.updateContext.gameState.entities.entities[i.target])==null?void 0:S.position),!s&&(i.direction.x!==0||i.direction.y!==0)&&(s={x:i.position.x+i.direction.x*Mh*2,y:i.position.y+i.direction.y*Mh*2}),!s)return{nextState:pt,data:{...t,enteredAt:a.gameState.time,previousState:Tr}};const{width:l,height:c}=a.gameState.mapDimensions,u=G(i.position,s,l,c);if(u<Mh)return{nextState:pt,data:{...t,enteredAt:a.gameState.time,previousState:Tr}};const f=ze(i.position,s,l,c),g=rt(f);if(u>Vy){const v=fg(g,-Nh),T=fg(g,Nh),I=[g,v,T],_=I.map((R,w)=>{const B=ci(i.position,Et(R,Vy)),O={x:(B.x%l+l)%l,y:(B.y%c+c)%c},D=Zy(a.gameState.soilDepletion,O,l,c,Xy),F=Math.cos(w===0?0:Nh);return D*F});let N=0;for(let R=1;R<_.length;R++)_[R]>_[N]&&(N=R);i.direction=I[N]}else i.direction=g;const m=Zy(a.gameState.soilDepletion,i.position,l,c,Xy);return i.acceleration=hI(i,m),{nextState:Tr,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const Jw=new Qw,Ve=1,kl=3;function Ge(e,t,n,i,a,s,l){const c={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:i,entityId:a,targetPosition:s,targetEntityId:l};return e.visualEffects.push(c),e.nextVisualEffectId++,c.id}var Te=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(Te||{});const Qy=600,eR=1.5,gI=.1,Oh=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,kh=""+new URL("gather-CU75596W.mp3",import.meta.url).href,tR=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,Jy=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,nR=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,iR=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,oR=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,rR=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,sR=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,aR=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Ae=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Ae||{});const lR=new Map([[0,Oh],[1,kh],[2,tR],[3,Jy],[4,nR],[5,iR],[6,oR],[12,rR],[13,sR],[7,Oh],[8,Jy],[9,kh],[10,kh],[11,Oh],[14,aR]]);let el,bl;function cR(){if(!(typeof window>"u"))return bl}function lp(){if(!(typeof window>"u"))return!el&&typeof window.AudioContext=="function"&&(el=new window.AudioContext,bl=el.createGain(),bl.connect(el.destination),Al(.1,!1)),el}function Al(e,t){bl&&(bl.gain.value=t?0:e/10)}const pI=new Map;let sd=!1,eS=!1;async function dR(){if(eS||sd)return;const e=lp();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),sd=!0,console.log("Starting sound loading...");const t=[];lR.forEach((n,i)=>{const a=fetch(n).then(s=>{if(!s.ok)throw new Error(`Failed to fetch sound: ${n}`);return s.arrayBuffer()}).then(s=>e.decodeAudioData(s)).then(s=>{pI.set(i,s)}).catch(s=>{console.error(`Error loading sound ${Ae[i]} from ${n}:`,s)});t.push(a)});try{await Promise.all(t),eS=!0,sd=!1,console.log("All sounds loaded successfully.")}catch(n){sd=!1,console.error("An error occurred while loading sounds:",n)}}const El=new Map;function cp(e,t){const n=lp(),i=cR();if(!n||!i||i.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const a=pI.get(e);if(!a){console.warn(`Sound buffer not found for type: ${Ae[e]}`);return}if(t!=null&&t.trackId&&El.has(t.trackId))return;const s=n.createBufferSource();s.buffer=a,s.loop=(t==null?void 0:t.loop)??!1;const l=n.createGain(),c=n.createStereoPanner();let u=l;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const f=ze(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),g=G(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(g>Qy)return;const m=1-Math.pow(g/Qy,eR);l.gain.value=Math.max(0,m);const S=Math.sin(f.x/g*(Math.PI/2));c.pan.value=isNaN(S)?0:S,l.connect(c),u=c}else{const f=e===Ae.GameOver?.4:e===Ae.SoundTrack1?1:.2;l.gain.value=f}s.connect(u),u.connect(i),s.start(0),t!=null&&t.trackId&&(El.set(t.trackId,{sourceNode:s,gainNode:l}),s.onended=()=>{El.delete(t.trackId)})}function bh(e,t=1){const n=El.get(e),i=lp();if(n&&i){const{sourceNode:a,gainNode:s}=n,l=i.currentTime;s.gain.setValueAtTime(s.gain.value,l),s.gain.linearRampToValueAtTime(0,l+t),a.stop(l+t),a.onended=null,El.delete(e)}}function Ne(e,t,n){const i=yt(e.gameState);i&&cp(t,{position:n,listenerPosition:i.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}const uR={id:gl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:pt,data:{...e,enteredAt:i.gameState.time,previousState:gl}}:(n.food.length>0&&(!n.eatingCooldownTime||i.gameState.time>=n.eatingCooldownTime)&&n.hunger>zo&&(n.hunger=Math.max(0,n.hunger-zo),n.food.pop(),n.eatingCooldownTime=i.gameState.time+1,Ne(i,Ae.Eat,n.position),(!n.lastEatingEffectTime||i.gameState.time-n.lastEatingEffectTime>2)&&(Ge(i.gameState,Te.Eating,n.position,Ve,n.id),n.lastEatingEffectTime=i.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:pt,data:{...e,enteredAt:i.gameState.time,previousState:gl}}:{nextState:gl,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class fR{constructor(){Pe(this,"id",ca)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const hR=new fR,gR={id:Il,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:pt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Il}}:{nextState:Il,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},pR={id:Tl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:pt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Tl}}:{nextState:Tl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},mR=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),yR=(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:a}=i;if(a.time<(e.procreationEndTime||0))return{nextState:_r,data:e};const s=a.entities.entities[e.partnerId];if(s&&s.type==="human"&&!s.isPregnant&&n.hunger<qt&&s.hunger<qt&&!n.procreationCooldown&&!s.procreationCooldown){const l=n.gender==="female"?n:s.gender==="female"?s:void 0,c=n.gender==="male"?n:s.gender==="male"?s:void 0;l&&c&&(l.isPregnant=!0,l.gestationTime=T_,l.pregnancyFatherId=c.id,n.procreationCooldown=xy,s.procreationCooldown=xy,Ne(i,Ae.Procreate,l.position))}return n.activeAction="idle",s&&(s.activeAction="idle"),{nextState:pt,data:{...e,enteredAt:a.time,previousState:_r}}},SR={id:_r,onEnter:mR,update:yR},vR={id:Vo,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var s;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:pt,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:pt,data:{...e}};const i=G(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),a=ze(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=rt(a),i<=jo||i<=Tn&&(((s=t.entity.attackCooldown)==null?void 0:s.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=hI(t.entity),{nextState:Vo,data:e}}},IR={id:Dd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:a}=i;if(a.time-e.enteredAt>=sw){const l=n.food.filter(u=>u.type===fn.Berry).length,c=Mi(a.soilDepletion,e.plantingSpot,a.mapDimensions.width,a.mapDimensions.height);if(l>=io&&!c){for(let u=0;u<io;u++){const f=n.food.findIndex(g=>g.type===fn.Berry);f>-1&&n.food.splice(f,1)}Vl(a.entities,e.plantingSpot,a.time),xw(a.soilDepletion,e.plantingSpot,a.time,a.mapDimensions.width,a.mapDimensions.height,a)}return n.activeAction="idle",{nextState:pt,data:{...e,enteredAt:a.time,previousState:Dd}}}return{nextState:Dd,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class TR{constructor(){Pe(this,"id",ap)}update(t,n){const{entity:i,updateContext:a}=n;return i.activeAction!=="chopping"||i.heldItem?{nextState:pt,data:{...t,enteredAt:a.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const AR=new TR,ER=[Zw,Jw,uR,hR,gR,pR,SR,vR,IR,AR],ai="preyIdle",Lo="preyMoving",pl="preyGrazing",ml="preyProcreating",CR={id:ai,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Lo,data:{...e,enteredAt:i.gameState.time,previousState:ai,target:n.target}}:n.activeAction==="grazing"?{nextState:pl,data:{...e,enteredAt:i.gameState.time,previousState:ai}}:n.activeAction==="procreating"?{nextState:ml,data:{...e,enteredAt:i.gameState.time,previousState:ai}}:{nextState:ai,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},mI=12,_R=120,tS=50,wR=12,yI=30,RR=2,dn=50,PR=100,Cl=2,Bh=3,DR=.9,NR=1,MR=50,OR=.5,SI=20,kR=140,nS=40,bR=12,vI=40,BR=3,Wo=60,li=40,Rs=50,iS=320,II=25,FR=60,TI=2,LR=90,UR=.7,HR=1,_l=3,Fh=15,dp=80,AI=10,hu=80,da=40,EI=2,Yd=30,Os=20,Dr=40,ks=24,Nr=48,bs=12,Mr=40,Bs=20,Or=60,Fs=.75,Uo=2.5,Ls=.25,Ho=2,CI=4;function GR(e){let t=wR;return e.isAdult||(t*=.7),e.hunger>=MR&&(t*=OR),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function $R(e,t){const n=e>>16&255,i=e>>8&255,a=e&255,s=t>>16&255,l=t>>8&255,c=t&255;let u=Math.floor((n+s)/2),f=Math.floor((i+l)/2),g=Math.floor((a+c)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function Bl(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const Lh=10;class xR{constructor(){Pe(this,"id",Lo)}update(t,n){var u;const{entity:i,updateContext:a}=n;if(i.activeAction!=="moving")return{nextState:ai,data:{...t,enteredAt:a.gameState.time,previousState:Lo}};let s;if(typeof i.target=="object"?s=i.target:typeof i.target=="number"&&(s=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!s&&(i.direction.x!==0||i.direction.y!==0)&&(s={x:i.position.x+i.direction.x*Lh*2,y:i.position.y+i.direction.y*Lh*2}),!s)return{nextState:ai,data:{...t,enteredAt:a.gameState.time,previousState:Lo}};const l=ze(i.position,s,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=rt(l),i.acceleration=GR(i),G(i.position,s,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height)<Lh?{nextState:ai,data:{...t,enteredAt:a.gameState.time,previousState:Lo}}:{nextState:Lo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const WR=new xR,YR={id:pl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Lo,data:{...e,enteredAt:i.gameState.time,previousState:pl,target:n.target}}:n.activeAction!=="grazing"?{nextState:ai,data:{...e,enteredAt:i.gameState.time,previousState:pl}}:{nextState:pl,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},zR={id:ml,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Lo,data:{...e,enteredAt:i.gameState.time,previousState:ml,target:n.target}}:n.activeAction!=="procreating"?{nextState:ai,data:{...e,enteredAt:i.gameState.time,previousState:ml}}:{nextState:ml,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},jR=[CR,WR,YR,zR],an="predatorIdle",ko="predatorMoving",Ki="predatorAttacking",Ps="predatorProcreating",kr="predatorEating",XR={id:an,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:kr,data:{...e,enteredAt:i.gameState.time,previousState:an,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:Ki,data:{...e,enteredAt:i.gameState.time,previousState:an,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction==="moving"?{nextState:ko,data:{...e,enteredAt:i.gameState.time,previousState:an,target:n.target}}:n.activeAction==="procreating"?{nextState:Ps,data:{...e,enteredAt:i.gameState.time,previousState:an}}:{nextState:an,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function _I(e){let t=bR;return e.hunger>=LR&&(t*=UR),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function VR(e,t){const n=e>>16&255,i=e>>8&255,a=e&255,s=t>>16&255,l=t>>8&255,c=t&255;let u=Math.floor((n+s)/2),f=Math.floor((i+l)/2),g=Math.floor((a+c)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(g=Math.max(0,Math.min(255,g+(Math.random()-.5)*60))),u<<16|f<<8|g}function Fl(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const Uh=12;class KR{constructor(){Pe(this,"id",ko)}update(t,n){var u;const{entity:i,updateContext:a}=n;if(i.activeAction==="eating")return{nextState:kr,data:{...t,enteredAt:a.gameState.time,previousState:ko,preyId:i.attackTargetId,eatingStartTime:a.gameState.time}};if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:Ki,data:{...t,enteredAt:a.gameState.time,previousState:ko,attackTargetId:i.attackTargetId,attackStartTime:a.gameState.time}};if(i.activeAction!=="moving")return{nextState:an,data:{...t,enteredAt:a.gameState.time,previousState:ko}};let s;if(typeof i.target=="object"?s=i.target:typeof i.target=="number"&&(s=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!s&&(i.direction.x!==0||i.direction.y!==0)&&(s={x:i.position.x+i.direction.x*Uh*2,y:i.position.y+i.direction.y*Uh*2}),!s)return{nextState:an,data:{...t,enteredAt:a.gameState.time,previousState:ko}};const l=ze(i.position,s,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=rt(l),i.acceleration=_I(i),G(i.position,s,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height)<Uh?{nextState:an,data:{...t,enteredAt:a.gameState.time,previousState:ko}}:{nextState:ko,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const qR=new KR,ZR={id:Ki,update:(e,t)=>{const{entity:n,updateContext:i}=t;if(n.activeAction==="eating")return{nextState:kr,data:{...e,enteredAt:i.gameState.time,previousState:Ki,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:an,data:{...e,enteredAt:i.gameState.time,previousState:Ki}};const a=i.gameState.entities.entities[n.attackTargetId];if(!a)return n.activeAction="idle",{nextState:an,data:{...e,enteredAt:i.gameState.time,previousState:Ki}};if(a.type==="prey"&&a.hitpoints<=0||a.type==="predator"&&a.hitpoints<=0||a.type==="human"&&a.hitpoints<=0)return n.activeAction="idle",{nextState:an,data:{...e,enteredAt:i.gameState.time,previousState:Ki}};const l=G(n.position,a.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=ze(n.position,a.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return n.direction=rt(c),l>li?n.acceleration=_I(n):n.acceleration=0,{nextState:Ki,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},QR={id:Ps,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:kr,data:{...e,enteredAt:i.gameState.time,previousState:Ps,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:Ki,data:{...e,enteredAt:i.gameState.time,previousState:Ps,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction!=="procreating"?{nextState:an,data:{...e,enteredAt:i.gameState.time,previousState:Ps}}:{nextState:Ps,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},JR={id:kr,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:an,data:{...e,enteredAt:i.gameState.time,previousState:kr}}:{nextState:kr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},e1=[XR,qR,ZR,QR,JR],t1=24*30*10,Ko=24*5,n1=48,i1=72,zl=20,o1="#3b2016",r1="#5c3a21",s1="#376d31",a1="#76a331",l1="#a6c44a",c1="rgba(0, 0, 0, 0.25)",d1=60,u1=24*7,f1=.1,oS=1,gu=5,h1={id:Kn,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.age>=n.lifespan?{nextState:Hr,data:{enteredAt:i.gameState.time,previousState:Kn}}:n.age>=Ko?{nextState:Ln,data:{enteredAt:i.gameState.time,previousState:Kn}}:{nextState:Kn,data:e}}},g1={id:Ln,update:(e,t)=>{const{entity:n,updateContext:i}=t,a=i.deltaTime*(At/Rt);return n.age>=n.lifespan?{nextState:Hr,data:{...e,enteredAt:i.gameState.time,previousState:Ln}}:(n.timeSinceLastSpreadAttempt+=a,n.timeSinceLastSpreadAttempt>=u1&&(n.timeSinceLastSpreadAttempt=0,Math.random()<f1)?{nextState:di,data:{...e,enteredAt:i.gameState.time,previousState:Ln}}:{nextState:Ln,data:e})}},p1={id:di,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:a}=i;if(n.age>=n.lifespan)return{nextState:Hr,data:{...e,enteredAt:a.time,previousState:di}};const s=tp(n.position,n.spreadRadius,a.mapDimensions.width,a.mapDimensions.height);return qn(s,a,25)||Ul(a.entities,s,a.time),{nextState:Ln,data:{...e,enteredAt:a.time,previousState:di}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},m1={id:An,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=n1?{nextState:no,data:{enteredAt:n.gameState.time,previousState:An}}:{nextState:An,data:e}}},y1={id:no,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=i1?{nextState:Hr,data:{enteredAt:n.gameState.time,previousState:no}}:{nextState:no,data:e}}},S1={id:Hr,update:e=>({nextState:Hr,data:e}),onEnter:(e,t)=>(zr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},v1=[h1,g1,p1,m1,y1,S1],rS=[...qw,...ER,...jR,...e1,...v1];function I1(e,t,n){const i=J_(e,rS);if(!i)return tw(e),[e,t];const{nextState:a,data:s}=i.update(t,n);return ew(e,a)?[a,Q_(i,a,s,n,rS)]:[a,s]}const Ct=30,ua=Ct*.6,wI="#4CAF50",RI="#FF5722",PI="#9C27B0",T1="#2196F3",DI="#FFC107",A1="#DC143C",up="#FFFFFF",fp=[5,5],pu=5,Qs=15,E1=20,C1=16,_1=10,w1=16,R1=16,zd=["","","","","","","","","",""],wl=8,P1="#FFFFFF",nt=18,Je=15,D1="rgba(0, 0, 0, 0.7)",N1=4,Ro=150,Mn=15,Wi=10,Go="#555",M1="#f44336",O1="#4CAF50",k1="#2196F3",b1="#FFC107",ad=16,fr=32,ld=28,B1=10,F1=8,L1=8,U1=8,jn=28,cd=40,H1="rgba(255, 215, 0, 0.7)",G1="rgba(0, 0, 0, 0.3)",Ii=10,sS=8,Hh=11,Po=20,Gh=40,aS=5,$1=10,x1="#FFA500",W1="#808080",Zi=120,NI=30,Y1=20,Fo="#2d3748",Lt="#ffffff",dd="#4a5568",MI=5,hp="#bdc9f792",OI="#272c36ff",kI="#a0aec0",jd=300,bI="rgba(255, 255, 255, 0.5)",z1="rgba(0, 0, 0, 0.8)",j1="#FFFFFF",lS=14,cS=8,dS=-15,BI="#FFD700",FI=5,X1=10,$h=12,V1=10,K1="#4CAF50",q1="#F44336",Z1="#FFC107",Q1="rgba(255, 255, 255, 0.2)",uS="#FFFFFF",J1="#FF6B6B",eP=5,LI=30,tl=50,ud=8,fS=10,tP="rgba(0, 0, 0, 0.5)",nP="#FFFFFF",iP=33,oP=400,rP=20,sP=10,aP="rgba(0, 0, 0, 0.7)",lP="#FFFFFF",xh=20,hS=16,cP=.5,gS=5,UI="#FFD700",dP=40,gp=4,HI=3,uP=5,GI=20,$I=5,fP="#FFFFFF",hP="#FF6B6B",On=80,hr=10,fd=300,gr=15,gP=8,pP="rgba(0, 0, 0, 0.8)",mP="#FFFFFF",Wh=14,pS=10,Ti=20,yP="#FF6B6B",SP="#4CAF50",mS="#FFD700",vP="rgba(255, 255, 0, 0.3)",IP=2,TP=500,AP=120,EP=45,CP="#FFD700",_P=3,wP=4;var J=(e=>(e.Leader="leader",e.Gatherer="gatherer",e.Planter="planter",e.Hunter="hunter",e.Mover="mover",e.Warrior="warrior",e))(J||{});function pp(e,t){return`${e},${t}`}const yS=At*10;function xI(e){return e%yS/yS}function RP(e){const t=xI(e);return(Math.cos(t*2*Math.PI)+1)/2}function PP(e){const t=xI(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function WI(e,t,n){const i=(e.x%t+t)%t,a=(e.y%n+n)%n;return{gridX:Math.floor(i/qi),gridY:Math.floor(a/qi)}}function Js(e,t,n,i,a){const{gridX:s,gridY:l}=WI(t,i,a),c=pp(s,l),u=e.sectors[c],f=u?u.currentTemperature:Vv,m=(RP(n)*2-1)*Cw;return f+m}function DP(e){const{sectors:t}=e.temperature,{width:n,height:i}=e.mapDimensions,a=Math.ceil(n/qi),s=Math.ceil(i/qi);for(const c in t){const u=t[c];u.currentTemperature=u.baseTemperature}const l=Math.ceil(Ws/qi);Object.values(e.entities.entities).forEach(c=>{if(c.type==="building"){const u=c;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const f=WI(u.position,n,i);for(let g=-l;g<=l;g++)for(let m=-l;m<=l;m++){const S=(f.gridX+m+a)%a,v=(f.gridY+g+s)%s,T=pp(S,v),I=t[T];if(I){const _={x:(S+.5)*qi,y:(v+.5)*qi},N=G(u.position,_,n,i);if(N<Ws){const R=Tw*(1-N/Ws);I.currentTemperature+=R}}}}}})}function YI(e,t){const n={},i=Math.ceil(e/qi),a=Math.ceil(t/qi);for(let s=0;s<a;s++)for(let l=0;l<i;l++){const c=pp(l,s);let u=Vv;const f=s/a*10-5;u+=f,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),n[c]={baseTemperature:u,currentTemperature:u}}return{sectors:n}}function NP(e,t,n){var c;const{gameState:i}=t,a=n*(At/Rt);e.isAdult=e.age>=Yg;const s=Js(i.temperature,e.position,i.time,i.mapDimensions.width,i.mapDimensions.height);if(s<xs){const u=(xs-s)*Iw*a;e.hitpoints-=u}if(e.movementSlowdown&&i.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<ln){const u=1-e.hunger/ln*O_,f=M_*u*a;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+f)}if(e.hunger+=n*(Ja/(At/Rt)),e.hunger>=ln)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-zo);else{const u=k_*a;e.hitpoints-=u}if(e.age+=n/iu,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=a,e.hunger+=n*((Ja*A_-Ja)/(At/Rt)),(!e.lastPregnantEffectTime||i.time-e.lastPregnantEffectTime>kl*3)&&(Ge(i,Te.Pregnant,e.position,kl,e.id),e.lastPregnantEffectTime=i.time),e.gestationTime<=0&&(DM(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=a,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=a,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=a,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=a,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=a,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===ua&&(e.radius=Ct):e.hunger+=n*((Ja*E_-Ja)/(At/Rt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const f=i.entities.entities[e.motherId];f&&u.push(f)}if(e.fatherId){const f=i.entities.entities[e.fatherId];f&&u.push(f)}for(const f of u)if(f.age>=zg&&f.hunger>=w_&&G(e.position,f.position,i.mapDimensions.width,i.mapDimensions.height)<=R_){e.food.pop(),f.hunger=Math.max(0,f.hunger-zo),e.feedParentCooldownTime=P_;break}}let l;if(e.hitpoints<=0?s<xs?l="hypothermia":e.hunger>=ln?l="hunger":l="killed":e.age>=e.maxAge&&(l="oldAge"),l){if(e.leaderId===e.id){const u=$r(En(i,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeRole=J.Leader,u.tribeControl=e.tribeControl??{roleWeights:{[J.Leader]:0,[J.Gatherer]:2,[J.Planter]:2,[J.Hunter]:2,[J.Mover]:2,[J.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}};const f=i;Wd(i,e.id,u.id);const g=f.search.human.byProperty("leaderId",e.id);for(const v of g)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const m=f.search.building.byProperty("ownerId",e.id);for(const v of m)v.ownerId=u.id;for(const v of Kd(u,i))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const S=Eu(i).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of S){const T=i.entities.entities[v.leaderId];if((c=T==null?void 0:T.tribeControl)!=null&&c.diplomacy){const I=T.tribeControl.diplomacy[e.id];I!==void 0&&(T.tribeControl.diplomacy[u.id]=I,delete T.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=$r(En(i,e));u?(u.isPlayer=!0,i.generationCount++):(i.gameOver=!0,i.causeOfGameOver=l,Ml(i,{identifier:"no_heir",type:Lr.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}wM(i.entities,e.position,e.gender,e.age,e.radius,e.id,i.time,e.food,e.hunger),zr(i.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function MP(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/D_);const i=Math.floor(Uv*(1-e.decayProgress));e.food.length>i&&e.food.splice(i),e.decayProgress>=1&&e.food.length<=0&&zr(t.gameState.entities,e.id)}function OP(e,t,n){const i=n*(At/Rt);e.age+=n/iu,e.isAdult=e.age>=Cl;let a=t.gameState.ecosystem.preyHungerIncreasePerHour*i;if(e.isPregnant&&(a*=1.2),e.hunger+=a,e.hunger>=_R){const l=CI*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};l.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,l.x)),l.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,l.y));const c=Math.random()<.5?"male":"female",u=e,f=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let g;if(f)g=$R(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}ea(t.gameState.entities,l,c,0,yI*.5,g,e.id,e.fatherId,e.aiType),Ge(t.gameState,Te.Procreation,e.position,kl,e.id),Ne(t,Ae.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=i,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let s=!1;e.hitpoints<=0&&(s=!0),e.age>=mI&&(s=!0),s&&(RM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),zr(t.gameState.entities,e.id))}function kP(e,t,n){const i=n*(At/Rt);e.age+=n/iu,e.isAdult=e.age>=_l;let a=t.gameState.ecosystem.predatorHungerIncreasePerHour*i;if(e.isPregnant&&(a*=1.3),e.hunger+=a,e.hunger>=kR){const l=CI*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};l.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,l.x)),l.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,l.y));const c=Math.random()<.5?"male":"female",u=e,f=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let g;if(f)g=VR(u.geneCode,f.geneCode);else{g=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);g=Math.max(0,Math.min(16777215,g+m))}ta(t.gameState.entities,l,c,0,vI*.6,g,e.id,e.pregnancyFatherId,e.aiType),Ge(t.gameState,Te.Procreation,e.position,kl,e.id),Ne(t,Ae.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=i,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=i,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let s=!1;e.hitpoints<=0&&(s=!0),e.age>=SI&&(s=!0),s&&(PM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),zr(t.gameState.entities,e.id))}var Ut=(e=>(e[e.BehaviorTreeBased=0]="BehaviorTreeBased",e[e.TaskBased=1]="TaskBased",e))(Ut||{}),A=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.FAILURE=1]="FAILURE",e[e.RUNNING=2]="RUNNING",e[e.NOT_EVALUATED=3]="NOT_EVALUATED",e))(A||{});class _n{constructor(){Pe(this,"name");Pe(this,"depth");Pe(this,"children");Pe(this,"child")}getLastStatus(t){return C.get(t.aiBlackboard,`${this.name}_lastStatus`)??3}setLastStatus(t,n){C.set(t.aiBlackboard,`${this.name}_lastStatus`,n)}getRunningChildIndex(t){return C.get(t.aiBlackboard,`${this.name}_runningChildIndex`)}setRunningChildIndex(t,n){C.set(t.aiBlackboard,`${this.name}_runningChildIndex`,n)}}const C={create(){return{data:{},nodeExecutionData:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e},recordNodeExecution({nodeExecutionData:e},t,n,i,a,s){const l=e[t]||{lastExecuted:0,status:A.FAILURE,depth:0,debugInfo:"",executionHistory:[]},c=l.executionHistory[l.executionHistory.length-1];c&&i-(c==null?void 0:c.time)>Xs&&l.executionHistory.push({time:c.time+Xs,status:A.NOT_EVALUATED}),l.executionHistory.push({time:i,status:n});const u=LI/Rt*At,f=i-u;l.executionHistory=l.executionHistory.filter(m=>m.time>=f);const g={...l,lastExecuted:i,status:n,depth:a,debugInfo:s};e[t]=g},getNodeExecutionData({nodeExecutionData:e}){return e},cleanupOldEntries({nodeExecutionData:e},t){const n=BC,i=[];for(const[a,s]of Object.entries(e))t-s.lastExecuted>n&&i.push(a);for(const a of i)delete e[a]}},Ni=24,mp=2,yp=3;function Qt(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}function bP(e,t){if(!e.aiBlackboard)return;const n=e.aiBlackboard.data,i=[];for(const a in n)if(a.startsWith("tribal_")){const s=n[a];s&&typeof s=="object"&&"startTime"in s&&t-s.startTime>Ni&&i.push(a)}for(const a of i)C.delete(e.aiBlackboard,a)}const jl="tribe_logistics_demands",BP=8;function Zo(e){return C.get(e,jl)||[]}function zI(e,t,n,i){const a=Zo(e),s=a.find(l=>l.requesterId===t&&l.resourceType===n);if(s)s.updatedAt=i;else{const l={requesterId:t,resourceType:n,updatedAt:i};a.push(l)}C.set(e,jl,a)}function FP(e,t,n,i,a){const s=Zo(e),l=s.find(c=>c.requesterId===t&&c.resourceType===n);return l&&!l.claimedBy?(l.updatedAt=a,l.claimedBy=i,C.set(e,jl,s),!0):!1}function LP(e){return Zo(e).filter(n=>!n.claimedBy).sort((n,i)=>n.updatedAt-i.updatedAt)}function jI(e,t,n){let i=Zo(e);i=i.filter(a=>!(a.requesterId===t&&a.resourceType===n)),C.set(e,jl,i)}function XI(e,t,n){return Zo(e).find(a=>a.requesterId===t&&a.resourceType===n)}function UP(e,t){let n=Zo(e);n=n.filter(i=>t-i.updatedAt<=BP),C.set(e,jl,n)}function Sp(e,t,n){if(e.aiBlackboard){const i=C.get(e.aiBlackboard,"lastAiUpdateTime")??0;if(t.gameState.time-i+(Math.random()-Math.random())*Xs/10>=Xs){e.aiBlackboard&&C.cleanupOldEntries(e.aiBlackboard,t.gameState.time);const a=Qt(e,t.gameState);a&&a.id===e.id&&a.aiBlackboard&&(bP(a,t.gameState.time),UP(a.aiBlackboard,t.gameState.time)),n.execute(e,t,e.aiBlackboard),C.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time)}}else console.warn(`Behavior Tree AI ticked for human ${e.id}, but the tree or blackboard was missing.`),e.activeAction="idle"}const SS="Human Behavior",HP=1;class GP{constructor(){Pe(this,"nodeData",new Map);Pe(this,"pathStack",[]);Pe(this,"startTimeStack",[])}nodeStart(t){this.pathStack.push(t),this.startTimeStack.push(performance.now())}nodeEnd(){if(this.startTimeStack.length===0||this.pathStack.length===0){console.error("BTProfiler: nodeEnd() called without a matching nodeStart().");return}const t=performance.now(),n=this.startTimeStack.pop(),i=t-n,a=this.pathStack.join(" > "),s=this.nodeData.get(a)??{path:a,totalTime:0,callCount:0,minTime:1/0,maxTime:-1/0};s.totalTime+=i,s.callCount++,s.minTime=Math.min(s.minTime,i),s.maxTime=Math.max(s.maxTime,i),this.nodeData.set(a,s),this.pathStack.pop()}report(t={}){const{showAll:n=!1}=t,i=Array.from(this.nodeData.values());if(i.length===0){console.log("--- Behavior Tree Profiler: No data collected. ---");return}let a=i,s="--- Behavior Tree Full Report ---";if(!n){const c=this.nodeData.get(SS);if(c){const u=c.totalTime*HP/100;a=i.filter(f=>f.totalTime>u&&f.path!==SS),s="--- Behavior Tree Problem Report ---"}else console.log('BTProfiler: Root node "Human Behavior" not found. Showing full report.'),s="--- Behavior Tree Full Report (Root Not Found) ---"}const l=a.sort((c,u)=>u.totalTime-c.totalTime);console.log(s),l.length>0?console.table(l.map(c=>({Path:c.path,"Total Time (ms)":c.totalTime.toFixed(3),Calls:c.callCount,"Avg Time (ms)":(c.totalTime/c.callCount).toFixed(3),"Min Time (ms)":c.minTime.toFixed(3),"Max Time (ms)":c.maxTime.toFixed(3)}))):console.log("No significant performance problems detected."),console.log("------------------------------------")}reset(){this.nodeData.clear(),this.pathStack=[],this.startTimeStack=[]}getNodeData(t){return this.nodeData.get(t)}}const it=new GP;function Yt(e){return Array.isArray(e)?e:[e,""]}class Se extends _n{constructor(n,i,a=0){super();Pe(this,"name");Pe(this,"depth");this.children=n,this.name=i,this.depth=a,this.children.forEach(s=>{s.depth=(this.depth??0)+1})}execute(n,i,a){this.name&&it.nodeStart(this.name);try{for(const s of this.children){const[l,c]=Yt(s.execute(n,i,a));if(l!==A.SUCCESS)return this.setLastStatus(n,l),this.name&&C.recordNodeExecution(a,this.name,l,i.gameState.time,this.depth,c),l}return this.setLastStatus(n,A.SUCCESS),this.name&&C.recordNodeExecution(a,this.name,A.SUCCESS,i.gameState.time,this.depth,""),A.SUCCESS}finally{this.name&&it.nodeEnd()}}}class Jt extends _n{constructor(n,i,a=0){super();Pe(this,"name");Pe(this,"depth");this.children=n,this.name=i,this.depth=a,this.children.forEach(s=>{s.depth=(this.depth??0)+1})}execute(n,i,a){this.name&&it.nodeStart(this.name);try{const s=this.getRunningChildIndex(n)??0;for(let l=s;l<this.children.length;l++){const c=this.children[l],[u,f]=Yt(c.execute(n,i,a));if(u!==A.FAILURE){if(u===A.SUCCESS)return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,A.SUCCESS),this.name&&C.recordNodeExecution(a,this.name,A.SUCCESS,i.gameState.time,this.depth,f),A.SUCCESS;if(u===A.RUNNING)return this.setRunningChildIndex(n,l),this.setLastStatus(n,A.RUNNING),this.name&&C.recordNodeExecution(a,this.name,A.RUNNING,i.gameState.time,this.depth,f),A.RUNNING}}return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,A.FAILURE),this.name&&C.recordNodeExecution(a,this.name,A.FAILURE,i.gameState.time,this.depth,""),A.FAILURE}finally{this.name&&it.nodeEnd()}}}class vS extends _n{constructor(n,i,a=0){super();Pe(this,"name");Pe(this,"depth");this.children=n,this.name=i,this.depth=a,this.children.forEach(s=>{s.depth=(this.depth??0)+1})}execute(n,i,a){this.name&&it.nodeStart(this.name);try{let s=!0;for(const c of this.children){const[u,f]=Yt(c.execute(n,i,a));u===A.FAILURE&&(s=!1),this.name&&C.recordNodeExecution(a,this.name,u,i.gameState.time,this.depth,f)}const l=s?A.SUCCESS:A.FAILURE;return this.setLastStatus(n,l),l}finally{this.name&&it.nodeEnd()}}}class oe extends _n{constructor(n,i,a=0){super();Pe(this,"name");Pe(this,"depth");this.action=n,this.name=i,this.depth=a}execute(n,i,a){this.name&&it.nodeStart(this.name);try{const[s,l]=Yt(this.action(n,i,a));return this.setLastStatus(n,s),this.name&&C.recordNodeExecution(a,this.name,s,i.gameState.time,this.depth,l),s}finally{this.name&&it.nodeEnd()}}}class ce extends _n{constructor(n,i,a=0){super();Pe(this,"name");Pe(this,"depth");this.condition=n,this.name=i,this.depth=a}execute(n,i,a){this.name&&it.nodeStart(this.name);try{const[s,l]=Yt(this.condition(n,i,a)),c=s?A.SUCCESS:A.FAILURE;return this.setLastStatus(n,c),this.name&&C.recordNodeExecution(a,this.name,c,i.gameState.time,this.depth,l),c}finally{this.name&&it.nodeEnd()}}}class $P extends _n{constructor(n,i,a=0){super();Pe(this,"name");Pe(this,"depth");this.child=n,this.name=i,this.depth=a,this.child.depth=(this.depth??0)+1}execute(n,i,a){this.name&&it.nodeStart(this.name);try{const[s,l]=Yt(this.child.execute(n,i,a));let c;switch(s){case A.SUCCESS:c=A.FAILURE;break;case A.FAILURE:c=A.SUCCESS;break;case A.RUNNING:default:c=s;break}return this.setLastStatus(n,c),this.name&&C.recordNodeExecution(a,this.name,c,i.gameState.time,this.depth,l),c}finally{this.name&&it.nodeEnd()}}}class xP extends _n{constructor(n,i,a=0){super();Pe(this,"name");Pe(this,"depth");this.child=n,this.name=i,this.depth=a,this.child.depth=(this.depth??0)+1}execute(n,i,a){this.name&&it.nodeStart(this.name);try{const[,s]=Yt(this.child.execute(n,i,a)),l=A.SUCCESS;return this.setLastStatus(n,l),this.name&&C.recordNodeExecution(a,this.name,l,i.gameState.time,this.depth,s),l}finally{this.name&&it.nodeEnd()}}}class Cr extends _n{constructor(n,i,a,s=0){super();Pe(this,"name");Pe(this,"depth");Pe(this,"startTimeKey");this.child=n,this.timeoutDurationHours=i,this.name=a,this.depth=s,this.child.depth=(this.depth??0)+1,this.startTimeKey=`timeout_${this.name}_startTime`}execute(n,i,a){it.nodeStart(this.name);try{const s=i.gameState.time;let l=C.get(a,this.startTimeKey);const[c,u]=Yt(this.child.execute(n,i,a));if(c===A.RUNNING){l===void 0&&(C.set(a,this.startTimeKey,s),l=s);const f=s-l;if(f>this.timeoutDurationHours){C.delete(a,this.startTimeKey),this.setLastStatus(n,A.FAILURE);const m=`Timed out after ${f.toFixed(2)}h.`;return C.recordNodeExecution(a,this.name,this.getLastStatus(n),s,this.depth,m),this.getLastStatus(n)}this.setLastStatus(n,A.RUNNING);const g=`Running for ${f.toFixed(2)}h. ${u}`;return C.recordNodeExecution(a,this.name,this.getLastStatus(n),s,this.depth,g),this.getLastStatus(n)}return l!==void 0&&C.delete(a,this.startTimeKey),this.setLastStatus(n,c),C.recordNodeExecution(a,this.name,this.getLastStatus(n),s,this.depth,u),this.getLastStatus(n)}finally{it.nodeEnd()}}}class Bn extends _n{constructor(n,i,a,s=0,l){super();Pe(this,"name");Pe(this,"depth");Pe(this,"statusKey");Pe(this,"timestampKey");this.child=n,this.cacheDurationHours=i,this.validityCheck=l,this.name=a,this.depth=s,this.child.depth=(this.depth??0)+1,this.statusKey=`caching_${this.name}_status`,this.timestampKey=`caching_${this.name}_timestamp`}execute(n,i,a){it.nodeStart(this.name);try{const s=i.gameState.time,l=C.get(a,this.statusKey),c=C.get(a,this.timestampKey);if(l!==void 0&&c!==void 0){const m=s-c>this.cacheDurationHours,S=this.validityCheck?this.validityCheck(n,i,a):!0;if(!m&&S){const v=(c+this.cacheDurationHours-s).toFixed(2),T=`Cache hit. Status: ${A[l]}. ${v}h left.`;return this.setLastStatus(n,l),C.recordNodeExecution(a,this.name,this.getLastStatus(n),s,this.depth,T),this.getLastStatus(n)}}const[u,f]=Yt(this.child.execute(n,i,a));(u===A.SUCCESS||u===A.FAILURE)&&(C.set(a,this.statusKey,u),C.set(a,this.timestampKey,s)),this.setLastStatus(n,u);const g=`Cache miss. Child returned ${A[u]}. ${f}`;return C.recordNodeExecution(a,this.name,this.getLastStatus(n),s,this.depth,g),this.getLastStatus(n)}finally{it.nodeEnd()}}}class fa extends _n{constructor(n,i,a,s=0){super();Pe(this,"name");Pe(this,"depth");Pe(this,"cooldownKey");this.cooldownDurationHours=n,this.child=i,this.name=a,this.depth=s,this.child.depth=(this.depth??0)+1,this.cooldownKey=`cooldown_${this.name}`}execute(n,i,a){it.nodeStart(this.name);try{const s=i.gameState.time,l=C.get(a,this.cooldownKey);if(this.child.getLastStatus(n)===A.RUNNING){const[f,g]=Yt(this.child.execute(n,i,a));if(this.setLastStatus(n,f),this.name){const m=`Continuing running child. ${g}`;C.recordNodeExecution(a,this.name,this.getLastStatus(n),s,this.depth,m)}return this.getLastStatus(n)}if(l!==void 0&&s<l){const g=`Cooldown active, ${(l-s).toFixed(2)}h left`;return this.setLastStatus(n,A.FAILURE),this.name&&C.recordNodeExecution(a,this.name,this.getLastStatus(n),s,this.depth,g),this.getLastStatus(n)}const[c,u]=Yt(this.child.execute(n,i,a));return c===A.SUCCESS&&C.set(a,this.cooldownKey,s+this.cooldownDurationHours),this.setLastStatus(n,c),this.name&&C.recordNodeExecution(a,this.name,this.getLastStatus(n),s,this.depth,u),this.getLastStatus(n)}finally{it.nodeEnd()}}}class In extends _n{constructor(n,i,a,s=0){super();Pe(this,"name");Pe(this,"depth");this.child=n,this.behaviorKey=i,this.name=a,this.depth=s;const l=(c,u)=>{c.depth=u,c.children?c.children.forEach(f=>l(f,u+1)):c.child&&l(c.child,u+1)};l(this.child,(this.depth??0)+1)}execute(n,i,a){this.name&&it.nodeStart(this.name);try{if(n.isPlayer&&!i.gameState.autopilotControls.behaviors[this.behaviorKey]){const u=`Player autopilot for '${this.behaviorKey}' is disabled.`;return this.setLastStatus(n,A.FAILURE),this.name&&C.recordNodeExecution(a,this.name,this.getLastStatus(n),i.gameState.time,this.depth,u),this.getLastStatus(n)}const[l,c]=Yt(this.child.execute(n,i,a));return this.setLastStatus(n,l),this.name&&C.recordNodeExecution(a,this.name,this.getLastStatus(n),i.gameState.time,this.depth,c),this.getLastStatus(n)}finally{this.name&&it.nodeEnd()}}}class WP extends _n{constructor(n,i,a=0){super();Pe(this,"name");Pe(this,"depth");this.child=n,this.name=i,this.depth=a;const s=(l,c)=>{l.depth=c,l.children?l.children.forEach(u=>s(u,c+1)):l.child&&s(l.child,c+1)};s(this.child,(this.depth??0)+1)}execute(n,i,a){this.name&&it.nodeStart(this.name);try{if(n.isPlayer&&i.gameState.autopilotControls.isManuallyMoving)return this.setLastStatus(n,A.FAILURE),this.name&&C.recordNodeExecution(a,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Manual movement active, AI blocked."),this.getLastStatus(n);const[s,l]=Yt(this.child.execute(n,i,a));return this.setLastStatus(n,s),this.name&&C.recordNodeExecution(a,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&it.nodeEnd()}}}class ys extends _n{constructor(n,i,a=0){super();Pe(this,"name");Pe(this,"depth");this.child=n,this.name=i,this.depth=a;const s=(l,c)=>{l.depth=c,l.children?l.children.forEach(u=>s(u,c+1)):l.child&&s(l.child,c+1)};s(this.child,(this.depth??0)+1)}execute(n,i,a){this.name&&it.nodeStart(this.name);try{if(n.isPlayer)return this.setLastStatus(n,A.FAILURE),this.name&&C.recordNodeExecution(a,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Player controlled, AI blocked."),this.getLastStatus(n);const[s,l]=Yt(this.child.execute(n,i,a));return this.setLastStatus(n,s),this.name&&C.recordNodeExecution(a,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&it.nodeEnd()}}}class Oi extends _n{constructor(n,i,a,s=0){super();Pe(this,"name");Pe(this,"depth");Pe(this,"registeredKey");this.child=n,this.config=i,this.name=a,this.depth=s,this.child.depth=(this.depth??0)+1,this.registeredKey=`${this.name}_registered`}execute(n,i,a){it.nodeStart(this.name);try{const s=Qt(n,i.gameState);if(!s||!s.aiBlackboard){const[T,I]=Yt(this.child.execute(n,i,a));return this.setLastStatus(n,T),C.recordNodeExecution(a,this.name,T,i.gameState.time,this.depth,`No coordination: ${I}`),T}const l=i.gameState.time,c=C.get(a,this.registeredKey)??!1,u=this.getTaskTarget(n,i,a);if(!u)return this.setLastStatus(n,A.FAILURE),C.recordNodeExecution(a,this.name,A.FAILURE,l,this.depth,"No task target found"),A.FAILURE;const f=this.getTaskKey(u);if(c){const[T,I]=Yt(this.child.execute(n,i,a));return T===A.RUNNING?(this.refreshTaskTimestamp(s.aiBlackboard,f,n.id,l),this.setLastStatus(n,T),C.recordNodeExecution(a,this.name,T,l,this.depth,`Continuing: ${I}`),T):(this.removeFromTask(s.aiBlackboard,f,n.id),C.delete(a,this.registeredKey),this.setLastStatus(n,T),C.recordNodeExecution(a,this.name,T,l,this.depth,`Completed: ${I}`),T)}if(!this.canJoinTask(s.aiBlackboard,f,n.id,l)){this.setLastStatus(n,A.FAILURE);const T=C.get(s.aiBlackboard,f),I=(T==null?void 0:T.memberIds.length)??0,_=this.config.maxCapacity??1;return C.recordNodeExecution(a,this.name,A.FAILURE,l,this.depth,`Task full: ${I}/${_}`),A.FAILURE}if(!this.registerTask(s.aiBlackboard,f,n.id,l))return this.setLastStatus(n,A.FAILURE),C.recordNodeExecution(a,this.name,A.FAILURE,l,this.depth,"Failed to register task"),A.FAILURE;C.set(a,this.registeredKey,!0);const[S,v]=Yt(this.child.execute(n,i,a));if(S===A.RUNNING){this.setLastStatus(n,S);const T=C.get(s.aiBlackboard,f),I=(T==null?void 0:T.memberIds.length)??0,_=this.config.maxCapacity??1;return C.recordNodeExecution(a,this.name,S,l,this.depth,`Started (${I}/${_}): ${v}`),S}else return this.removeFromTask(s.aiBlackboard,f,n.id),C.delete(a,this.registeredKey),this.setLastStatus(n,S),C.recordNodeExecution(a,this.name,S,l,this.depth,`Immediate result: ${v}`),S}finally{it.nodeEnd()}}getTaskTarget(n,i,a){var l,c,u,f;if(this.config.taskType==="procreation")return((c=(l=this.config).getTargetId)==null?void 0:c.call(l,n,i,a))??null;const s=(f=(u=this.config).getTargetId)==null?void 0:f.call(u,n,i,a);return s??null}getTaskKey(n){return this.config.generateTaskKey?this.config.generateTaskKey(this.config.taskType,n):`tribal_${this.config.taskType}_${n}`}canJoinTask(n,i,a,s){const l=C.get(n,i);if(!l||s-l.startTime>Ni||l.memberIds.includes(a))return!0;const c=this.config.maxCapacity??1;return l.memberIds.length<c}registerTask(n,i,a,s){let l=C.get(n,i);return l?s-l.startTime>Ni?(l={memberIds:[a],startTime:s,maxCapacity:this.config.maxCapacity??1},C.set(n,i,l),!0):l.memberIds.length>=(this.config.maxCapacity??1)?!!l.memberIds.includes(a):(l.memberIds.includes(a)||(l.memberIds.push(a),C.set(n,i,l)),!0):(l={memberIds:[a],startTime:s,maxCapacity:this.config.maxCapacity??1},C.set(n,i,l),!0)}refreshTaskTimestamp(n,i,a,s){const l=C.get(n,i);l&&l.memberIds.includes(a)&&(l.startTime=s,C.set(n,i,l))}removeFromTask(n,i,a){const s=C.get(n,i);s&&(s.memberIds=s.memberIds.filter(l=>l!==a),s.memberIds.length===0?C.delete(n,i):C.set(n,i,s))}}function YP(e){return new Se([new ce((t,n)=>{const i=t.hunger>=Vs,a=t.food.length>0,s=!t.eatingCooldownTime||n.gameState.time>=t.eatingCooldownTime;return[!!(i&&a&&s),`${Math.floor(t.hunger-Vs)}, ${t.food.length}, ${t.eatingCooldownTime?Math.floor(t.eatingCooldownTime-n.gameState.time):""}`]},"Can Eat",e+1),new oe(t=>(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",A.RUNNING),"Eat",e+1)],"Eating",e)}const Yh=30,zP=.4,jP=24,VI=50,XP=100,VP=160,KP=72,KI=10,vp=5,qP=10,ZP=15,yg=5,Sg=5,vg=5;function Un(e,t,n){return mu(e,n)?e.tribeRole===t:!0}function mu(e,t){if(!e.leaderId)return!1;const n=t.entities.entities[e.leaderId];return!n||!n.tribeControl?!1:t.search.human.byProperty("leaderId",n.id).filter(a=>a.isAdult).length>=qP}function QP(e){return new Se([new ce((n,i)=>{if(!!!n.leaderId||!mu(n,i.gameState))return!1;const s=n.id===n.leaderId,l=Un(n,J.Warrior,i.gameState)||Un(n,J.Hunter,i.gameState),c=!n.isAdult&&(!n.fatherId||!i.gameState.entities.entities[n.fatherId])&&(!n.motherId||!i.gameState.entities.entities[n.motherId]);return s||l||c},"Demand eligible?",e+1),new oe((n,i)=>{const a=Qt(n,i.gameState);if(!a||!a.aiBlackboard)return[A.NOT_EVALUATED,"No leader for coordination"];if(n.food.length<n.maxFood*.5){zI(a.aiBlackboard,n.id,"food",i.gameState.time);const s=XI(a.aiBlackboard,n.id,"food");if(s&&s.claimedBy){const l=i.gameState.entities.entities[s.claimedBy];if(!l||l.type!=="human")return[A.NOT_EVALUATED,"Supplier not found or invalid"];const c=G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return c>H_?[A.NOT_EVALUATED,`Supplier too far (${c.toFixed(1)}px), waiting`]:c<=Ze?(n.activeAction="retrieving",n.target=l.id,[A.RUNNING,`Retrieving from supplier ${l.id}`]):(n.target=l.id,n.activeAction="moving",[A.RUNNING,`Moving to supplier ${l.id}, distance: ${c.toFixed(1)}`])}return[A.NOT_EVALUATED,"Waiting for supplier"]}return[A.NOT_EVALUATED,"No demand needed"]},"Create Demand",e+1)],"Demand",e)}const JP=20,un=30,eD=.5,tD=.3,nD=2,iD=50,Ip=400,oD=25;function IS(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function rD(e,t,n=Ip){return t.search.building.byRadius(e.position,n).some(s=>{const l=s;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed&&l.storageCapacity&&l.storedItems.length<l.storageCapacity})}function sD(e,t,n=Ip,i,a){return t.search.building.byRadius(e.position,n).filter(c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===e.leaderId&&u.isConstructed&&u.storedItems.filter(f=>f.item.itemType==="food").length>0}).filter(c=>{if(i){const u=`tribal_storage_${c.id}`,f=C.get(i,u);if(f&&f.memberIds.length>=yp&&(!a||!f.memberIds.includes(a)))return!1}return!0})}function aD(e,t,n=Ip){return t.search.building.byRadius(e.position,n).filter(s=>{const l=s;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed})}function qI(e,t,n){if(t.length===0)return null;let i=null,a=1/0;for(const s of t){const l=G(e.position,s.position,n.mapDimensions.width,n.mapDimensions.height);l<a&&(a=l,i=s)}return i?{storage:i,distance:a}:null}function ZI(e){const t=e.storedItems.length,n=IS(t+e.id)*2*Math.PI,i=IS(t+e.id+1)*oD;return{x:Math.cos(n)*i,y:Math.sin(n)*i}}const TS="FINDING_DEMAND",AS="RETRIEVING_FROM_STORAGE",ES="DELIVERING_TO_DEMANDER",Nd="supply_phase",Ig="supply_targetDemanderId",QI="supply_targetStorageId",Md="supply_targetResourceType";function Ai(e){e.aiBlackboard&&(C.delete(e.aiBlackboard,Nd),C.delete(e.aiBlackboard,Ig),C.delete(e.aiBlackboard,QI),C.delete(e.aiBlackboard,Md))}function lD(e){return new oe((t,n)=>{var s;if(!mu(t,n.gameState))return Ai(t),[A.FAILURE,"Tribe roles not effective"];if(!Un(t,J.Mover,n.gameState))return Ai(t),[A.FAILURE,"Not a Mover"];const i=Qt(t,n.gameState);if(!i||!i.aiBlackboard)return Ai(t),[A.FAILURE,"No leader or blackboard"];if(!t.aiBlackboard)return[A.FAILURE,"No AI blackboard"];const a=C.get(t.aiBlackboard,Nd)||TS;if(a===TS){const l=LP(i.aiBlackboard).filter(f=>f.requesterId!==t.id);if(l.length===0)return[A.FAILURE,"No unclaimed demands"];const c=l[0];return FP(i.aiBlackboard,c.requesterId,c.resourceType,t.id,n.gameState.time)?(C.set(t.aiBlackboard,Ig,c.requesterId),C.set(t.aiBlackboard,Md,c.resourceType),C.set(t.aiBlackboard,Nd,AS),[A.RUNNING,`Claimed ${c.resourceType} demand for ${c.requesterId}, moving to retrieval phase`]):(Ai(t),[A.FAILURE,"Failed to claim demand"])}if(a===AS){const l=C.get(t.aiBlackboard,Md),c=l==="food"&&t.food.length>0,u=l==="wood"&&((s=t.heldItem)==null?void 0:s.type)===St.Wood;if(c||u)return C.set(t.aiBlackboard,Nd,ES),[A.RUNNING,`${l} retrieved, moving to delivery phase`];const f=aD(t,n.gameState,400).filter(v=>l==="food"?v.storedItems.some(T=>T.item.itemType==="food"):l==="wood"?v.storedItems.some(T=>T.item.type===St.Wood):!1);if(f.length===0)return[A.FAILURE,`No storage with ${l} found nearby`];const g=qI(t,f,n.gameState);if(!g)return Ai(t),[A.FAILURE,"Could not find closest storage"];const{storage:m,distance:S}=g;return C.set(t.aiBlackboard,QI,m.id),S<=un?(t.activeAction="retrieving",t.target=m.id,[A.RUNNING,`Retrieving from storage ${m.id}`]):(t.target=m.id,t.activeAction="moving",[A.RUNNING,`Moving to storage ${m.id}, distance: ${S.toFixed(1)}`])}if(a===ES){const l=C.get(t.aiBlackboard,Md)||"food",c=C.get(t.aiBlackboard,Ig);if(!c)return Ai(t),[A.FAILURE,"Demander ID not found in blackboard"];const u=XI(i.aiBlackboard,c,l);if(!u||u.claimedBy!==t.id)return Ai(t),[A.FAILURE,"Demand not found"];const f=n.gameState.entities.entities[c];if(!f)return Ai(t),[A.FAILURE,"Demander not found"];if(l==="food"?t.food.length===0:!t.heldItem)return Ai(t),[A.SUCCESS,`Successfully delivered ${l} to ${c}`];const m=G(t.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),S=f.type==="building"&&f.buildingType===he.Bonfire?un:Ze;return m<=S?(t.activeAction="depositing",l==="food"&&(t.activeActionPayload={amount:Math.min(f.maxFood/2||1,t.food.length||1)}),t.target=f.id,[A.RUNNING,`Delivering to demander ${f.id}`]):(t.target=f.id,t.activeAction="moving",[A.RUNNING,`Moving to demander ${f.id}, distance: ${m.toFixed(1)}`])}return Ai(t),[A.FAILURE,"Unknown supply phase"]},"Supply",e)}function cD(e){return new Se([new ce((t,n,i)=>{if(t.isAdult&&t.hitpoints>t.maxHitpoints*wv||!(t.hitpoints<t.maxHitpoints*.1)&&t.isAdult&&t.hunger>OC)return!1;const s=RD(t.id,n.gameState);return s?(C.set(i,"fleeThreat",s.id),!0):!1},"Should Flee",e+1),new oe((t,n,i)=>{const a=C.get(i,"fleeThreat"),s=a&&n.gameState.entities.entities[a];if(!s)return A.FAILURE;t.activeAction="moving";const l=ze(s.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=rt(l),u=ci(t.position,Et(c,ZC));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,A.RUNNING},"Execute Flee",e+1)],"Flee",e)}const pr="resourceSource";function dD(e){const t=new oe((i,a,s)=>{const l=Qt(i,a.gameState),c=l?mg(l.id,a.gameState):0,u=i.hunger>Ly,f=En(a.gameState,i).filter(I=>I.hunger>Zs),g=u||f.length>0,m=Un(i,J.Gatherer,a.gameState),S=()=>{const I=be(i,a.gameState,"berryBush",Ph,N=>{if(N.food.length===0||i.leaderId&&!Pr(N.position,i.leaderId,a.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${N.id}`,w=C.get(l.aiBlackboard,R);if(w&&a.gameState.time-w.startTime<=Ni&&!w.memberIds.includes(i.id))return!1}return!0}),_=be(i,a.gameState,"corpse",Ph,N=>{if(N.food.length===0||i.leaderId&&!Pr(N.position,i.leaderId,a.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${N.id}`,w=C.get(l.aiBlackboard,R);if(w&&a.gameState.time-w.startTime<=Ni&&!w.memberIds.includes(i.id))return!1}return!0});if(I&&_){const N=G(i.position,I.position,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height),R=G(i.position,_.position,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height);return N<=R?I:_}return I||_},v=()=>be(i,a.gameState,"tree",Ph,I=>{var _;if(((_=I.stateMachine)==null?void 0:_[0])!==An||I.wood.length===0||i.leaderId&&!Pr(I.position,i.leaderId,a.gameState))return!1;if(l&&l.aiBlackboard){const N=`tribal_gather_${I.id}`,R=C.get(l.aiBlackboard,N);if(R&&a.gameState.time-R.startTime<=Ni&&!R.memberIds.includes(i.id))return!1}return!0});let T=null;return g&&i.food.length<i.maxFood?T=S():c>0&&!i.heldItem?T=v():m&&(i.heldItem||(T=v()),!T&&i.food.length<i.maxFood&&(T=S())),T?(C.set(s,pr,T.id),[A.SUCCESS,`Found ${T.type}: ${T.id} at ${T.position.x.toFixed(0)},${T.position.y.toFixed(0)}`]):[A.FAILURE,"No resource found"]},"Find Closest Resource Source",e+4),n=new Oi(new oe((i,a,s)=>{const l=C.get(s,pr);if(!l)return[A.FAILURE,"No target in blackboard"];const c=a.gameState.entities.entities[l];return c?(c.type==="tree"&&"wood"in c?c.wood.length===0:c.food.length===0)?(C.delete(s,pr),[A.FAILURE,"Resource source is depleted"]):G(i.position,c.position,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height)<qs?(i.activeAction="gathering",i.direction={x:0,y:0},i.target=c.id,C.delete(s,pr),[A.SUCCESS,`Gathering from ${c.type}`]):(i.activeAction="moving",i.target=c.id,i.direction=ot(i.position,c.position,a.gameState.mapDimensions),[A.RUNNING,`Moving to ${c.type}`]):(C.delete(s,pr),[A.FAILURE,"Resource source is invalid"])},"Move To Resource and Gather",e+3),{taskType:"gather",maxCapacity:2,getTargetId:(i,a,s)=>C.get(s,pr)??null},"Tribal Gather Task",e+3);return new Se([new ce((i,a)=>{const s=Qt(i,a.gameState),l=s?mg(s.id,a.gameState):0,c=i.food.length<i.maxFood,u=!i.heldItem,f=i.hunger>Ly,g=En(a.gameState,i).filter(I=>I.hunger>Zs),m=Un(i,J.Gatherer,a.gameState),S=rD(i,a.gameState),v=c&&(f||g.length>0||m&&S),T=u&&(l>0||m&&S);return[(i.isAdult&&(v||T))??!1,`${f?"Hungry ":""}${g.length>0?"Children("+g.length+") ":""}${l>0?"WoodNeed("+l+") ":""}${T&&l<=0?"Wood ":""}${S?"Storage":""}`]},"Should Gather Resources",e+1),new Jt([new Se([new ce((i,a,s)=>C.has(s,pr),"Has Resource Source?",e+2),n],"Continue Gathering Action",e+2),new Se([new Bn(t,UC,"Cache Resource Source Search",e+3),n],"Find New Resource Source and Gather",e+2)],"Perform or Start Gathering",e+1)],"Gather Resources",e)}const uD=.5;function fD(e){return new oe((t,n,i)=>{const{gameState:a}=n,{width:s,height:l}=a.mapDimensions;let c=C.get(i,"wanderTarget");const u=C.get(i,"lastWanderTime")??0,f=a.time;if(!c||f-u>uD||G(t.position,c,s,l)<20){const m=tp(t.position,PC,s,l);t.leaderId?pg(m,t.leaderId,a)?c=m:c=Nw(t.position,m,t.leaderId,a):c=m,C.set(i,"wanderTarget",c),C.set(i,"lastWanderTime",f)}if(c&&G(t.position,c,s,l)>10){t.activeAction="moving",t.target=c;let S=c.x-t.position.x,v=c.y-t.position.y;return Math.abs(S)>s/2&&(S=S>0?S-s:S+s),Math.abs(v)>l/2&&(v=v>0?v-l:v+l),t.direction=rt({x:S,y:v}),A.RUNNING}return t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,A.SUCCESS},"Idle/Wander",e)}const hd="procreationWanderStartTime",CS=(e,t,n)=>t.find(i=>xr(e,i,n)),_S={taskType:"procreation",maxCapacity:2,getTargetId:(e,t,n)=>C.get(n,"procreationPartner")??null};function hD(e){const t=new ce((s,l,c)=>{const u=bS(s,l.gameState,qs),f=CS(s,u,l.gameState);return f?(C.set(c,"procreationPartner",f.id),!0):[!1,"No immediate partner found"]},"Find Immediate Partner"),n=new Oi(new oe((s,l,c)=>{var g;const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(s.activeAction="procreating",s.target=void 0,C.delete(c,"procreationPartner"),C.delete(c,hd),(g=s.partnerIds)!=null&&g.includes(f.id)||(s.partnerIds=s.partnerIds?[...s.partnerIds,f.id]:[f.id]),A.SUCCESS):A.FAILURE},"Start Procreating"),_S,"Tribal Start Procreating",e+2),i=new ce((s,l,c)=>{const u=bS(s,l.gameState,MC),f=CS(s,u,l.gameState);return f?(C.set(c,"procreationPartner",f.id),!0):[!1,"No distant partner found"]},"Locate Distant Partner"),a=new Oi(new oe((s,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return[A.FAILURE,"No partner found"];if(f.isPregnant)return[A.FAILURE,"Partner is pregnant"];if(s.hunger>qt)return[A.FAILURE,"Too hungry to procreate"];const g=G(s.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);if(g<qs)return[A.SUCCESS,"Reached partner"];if(s.leaderId&&!Pr(f.position,s.leaderId,l.gameState))return[A.FAILURE,"Partner out of operating range"];s.activeAction="moving",s.target=f.id;const m=ze(s.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return s.direction=rt(m),[A.RUNNING,`${g.toFixed(1)} units away`]},"Move Towards Partner"),_S,"Tribal Move To Partner",e+3);return new Se([new ce(s=>!s.isAdult||s.gender==="female"&&s.isPregnant?[!1,"Not adult or pregnant"]:s.age<Nl||s.gender==="female"&&s.age>ru?[!1,"Not fertile due to age or pregnancy status"]:s.hunger>=qt?[!1,"Too hungry"]:!0,"Is Fertile (age, not pregnant)",e+1),new ce(s=>s.hunger<qt,"Is Healthy (hunger)",e+1),new ce(s=>(s.procreationCooldown||0)<=0,"Is Ready (cooldown)",e+1),new Jt([new Se([new ce((s,l)=>{const c=RS(s.position,l.gameState,"berryBush",Uy);return[c>=NC,`Found ${c} bushes`]},"Is Environment Viable (food)",e+3),new oe((s,l,c)=>(C.delete(c,hd),A.SUCCESS),"Clear Wander Timer",e+3)],"Sufficient Food Path",e+2),new Se([new ce((s,l)=>{const c=En(l.gameState,s);return $r(c)?[!1,"Has an heir"]:!0},"Is Male Without Heir",e+3),new oe((s,l,c)=>{const u=C.get(c,hd);if(u===void 0)return C.set(c,hd,l.gameState.time),[A.FAILURE,"Starting heirless wander timer"];const f=l.gameState.time-u;return f>=I_?RS(s.position,l.gameState,"berryBush",Uy)>=1?[A.SUCCESS,`Wandered for ${f.toFixed(1)}h, minimum food found`]:[A.FAILURE,"Desperate but no food sources nearby"]:[A.FAILURE,`Wandering for heir, ${f.toFixed(1)}h elapsed`]},"Check Wander Timer",e+3)],"Heirless Desperation Path",e+2)],"Check Environment Or Desperation",e+1),new ce((s,l,c)=>{var f;const u=C.get(c,"procreationPartner");return u&&((f=u.partnerIds)!=null&&f.length)&&!u.partnerIds.includes(s.id)&&s.leaderId!==s.id&&s.leaderId&&u.partnerIds.map(g=>l.gameState.entities.entities[g]).filter(g=>!!g).some(g=>G(s.position,g.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<KC)?[!1,"Partner's primary partner is too close"]:!0},"Is Partner's Primary Partner Nearby",e+1),new Jt([new Se([t,n],"Procreate With Immediate Partner",e+2),new fa(FC,new Se([i,a,n],"Seek Distant Partner Action",e+3),"Seek Distant Partner Cooldown",e+2)],"Find Partner And Procreate",e+1)],"Procreate",e)}const Ss="attackTarget",mr="homeCenter",zh=150;function gD(e){return new Se([new ce((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const{gameState:a}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=a.entities.entities[t.attackTargetId];if(l&&l.hitpoints>0&&G(t.position,l.position,a.mapDimensions.width,a.mapDimensions.height)<=zh){if(C.set(i,Ss,l.id),!C.get(i,mr)){const c=t.leaderId?Xo(t.leaderId,a):Gl(t,a).length>0?Ky(t,a):t.position;C.set(i,mr,c)}return!0}}if(!Un(t,J.Warrior,a))return[!1,"Not a Warrior"];const s=be(t,a,"human",zh,l=>l.hitpoints>0&&la(t,l,a));if(s){C.set(i,Ss,s.id);const l=t.leaderId?Xo(t.leaderId,a):Gl(t,a).length>0?Ky(t,a):t.position;return C.set(i,mr,l),!0}return C.set(i,Ss,void 0),C.set(i,mr,void 0),!1},"Find Attack Target",e+1),new oe((t,n,i)=>{const a=C.get(i,Ss),s=a&&n.gameState.entities.entities[a],l=C.get(i,mr);if(!s||!l)return A.FAILURE;const{gameState:c}=n;return G(t.position,l,c.mapDimensions.width,c.mapDimensions.height)>_v?(t.activeAction="idle",t.attackTargetId=void 0,C.set(i,Ss,void 0),C.set(i,mr,void 0),A.FAILURE):s.hitpoints<=0||G(t.position,s.position,c.mapDimensions.width,c.mapDimensions.height)>zh?(t.activeAction==="attacking"&&(t.activeAction="idle",t.attackTargetId=void 0),C.set(i,Ss,void 0),C.set(i,mr,void 0),A.SUCCESS):(t.activeAction==="attacking"&&t.attackTargetId===s.id||(t.activeAction="attacking",t.attackTargetId=s.id),A.RUNNING)},"Execute Attack",e+1)],"Attack",e)}const pD=(e,t,n)=>{const i=En(t.gameState,e).filter(l=>!l.isAdult);if(i.length===0)return A.FAILURE;let a=null,s=Zs;for(const l of i)l.hunger>=s&&(s=l.hunger,a=l);return a?(C.set(n,"targetChild",a.id),A.SUCCESS):A.FAILURE},mD=(e,t,n)=>{const i=C.get(n,"targetChild"),a=i&&t.gameState.entities.entities[i];return a?G(e.position,a.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>su?(e.activeAction="moving",e.target=a.id,e.direction=ot(e.position,a.position,t.gameState.mapDimensions),A.RUNNING):(e.activeAction="feeding",e.target=void 0,C.set(n,"targetChild",void 0),A.SUCCESS):A.FAILURE};function yD(e){return new Se([new ce(t=>(t.isAdult&&t.food.length>0&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child",e+1),new oe(pD,"Find Hungriest Child",e+1),new oe(mD,"Move To Child and Feed",e+1)],"Feed Child",e)}function SD(e){return new Se([new ce(t=>!t.isAdult&&t.hunger>=Zs,"Is Hungry Child",e+1),new oe((t,n,i)=>{const a=bM(t,n.gameState);if(a.length===0)return A.FAILURE;const s=be(t,n.gameState,"human",__,l=>a.some(c=>c.id===l.id)&&l.food.length>0);return s?(C.set(i,"targetParent",s.id),A.SUCCESS):A.FAILURE},"Find Parent With Food",e+1),new oe((t,n,i)=>{const a=C.get(i,"targetParent"),s=a&&n.gameState.entities.entities[a];if(!s)return A.FAILURE;const l=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=su?(t.target=void 0,A.SUCCESS):(t.target=s.id,t.activeAction="moving",A.RUNNING)},"Move To Parent",e+1)],"Seek Food From Parent",e)}const yr="plantingSpot",vs="plantingZoneId",vD=50;function ID(e,t,n,i){const a=ze(e,t,n,i);return ci(e,a)}function TD(e){const t=new oe((a,s,l)=>{const c=C.get(l,yr);if(!c)return C.delete(l,yr),C.delete(l,vs),[A.FAILURE,"Planting spot is missing"];if(Mi(s.gameState.soilDepletion,c,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height))return C.delete(l,yr),C.delete(l,vs),[A.FAILURE,"Soil is depleted at planting spot"];if(qn(c,s.gameState,Ur,a.id))return C.delete(l,yr),C.delete(l,vs),[A.FAILURE,"Planting spot is occupied"];const u=ID(a.position,c,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height),f=G(a.position,u,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);return f>qs?(a.activeAction="moving",a.target=u,a.direction=ot(a.position,u,s.gameState.mapDimensions),[A.RUNNING,"Moving to planting spot: "+f.toFixed(2)+" units away"]):qn(c,s.gameState,Ur,a.id)?(C.delete(l,yr),C.delete(l,vs),[A.FAILURE,"Planting spot is now occupied"]):(a.activeAction="planting",a.target=c,[A.RUNNING,"Planting state initiated"])},"Move To Spot and Plant",e+4),n=new Oi(t,{taskType:"plant",maxCapacity:2,proximityRadius:vD,getTargetId:(a,s,l)=>C.get(l,vs)??null},"Coordinated Planting",e+3),i=new oe((a,s,l)=>{const c=Gw(a,s.gameState);return c?(C.set(l,yr,c.position),C.set(l,vs,c.zoneId),[A.SUCCESS,`Found new spot at ${c.position.x.toFixed(0)}, ${c.position.y.toFixed(0)} (Zone ${c.zoneId})`]):[A.FAILURE,"No suitable planting spot found"]},"Find Optimal Planting Spot",e+3);return new Se([new ce((a,s)=>{if(!Un(a,J.Planter,s.gameState))return[!1,"Not a Planter"];const l=a.food.filter(f=>f.type===fn.Berry).length>=io,c=a.hunger<CC,u=(a.isAdult&&l&&c)??!1;return[u,u?"Can plant":`Cannot plant: adult=${a.isAdult}, berries=${a.food.filter(f=>f.type===fn.Berry).length}/${io}, hunger=${a.hunger.toFixed(0)}`]},"Can Plant",e+1),new ce((a,s)=>{if(!a.leaderId)return[!1,"No tribe"];const l=Ow(a,s.gameState),{count:c,ratio:u}=rp(a.leaderId,s.gameState);let f;return l<Rv?f=JC:l<Pv?f=e_:l<Dv?f=t_:f=n_,[u<f||c<=fl,`Food security: ${(l*100).toFixed(0)}%, Bush density: ${u.toFixed(1)}/${f}`]},"Needs More Bushes (Adaptive)",e+1),new ce((a,s)=>{if(!a.leaderId)return[!0,"No tribe coordination needed"];const l=Cn(a,s.gameState),c=cI(a.leaderId,s.gameState,"planting"),u=Math.max(1,Math.ceil(l.length*.3));return[c<u,`Active planters: ${c}/${u}`]},"Not Too Many Planters",e+1),new Jt([new Se([new ce((a,s,l)=>C.has(l,yr),"Has Planting Spot?",e+2),n],"Continue Planting Action",e+2),new fa(LC,i,"Find Planting Spot Cooldown",e+2)],"Perform or Start Planting",e+1)],"Plant Bush",e)}const wS="lastDepositTime",Is="assignedStorageSpot";function AD(e){return new Jt([new Se([new ce((t,n,i)=>{var c;const a=((c=t.heldItem)==null?void 0:c.type)===St.Wood;if(!t.isAdult)return[!1,"Not an adult"];if(!t.leaderId)return[!1,"No tribe"];let s=null,l="";if(a)s=Hw(t,n.gameState),l=`Holding wood${s?` (Target: ${s.id})`:""}`;else{if(!Un(t,J.Gatherer,n.gameState)&&!Un(t,J.Mover,n.gameState)&&!Un(t,J.Hunter,n.gameState))return[!1,"Not a Gatherer/Mover/Hunter and not holding wood"];const u=C.get(i,wS)||0,f=n.gameState.time-u;if(f<Hy)return[!1,`Cooldown: ${(Hy-f).toFixed(1)}h remaining`];const g=op(t.leaderId,n.gameState);let m;g<.3?m=i_:g<.7?m=o_:m=r_;const S=t.food.length/t.maxFood;if(S<=m)return[!1,`Food ${(S*100).toFixed(0)}% < threshold ${(m*100).toFixed(0)}%`];s=lI(t,n.gameState),l=`Storage util: ${(g*100).toFixed(0)}%, Personal: ${(S*100).toFixed(0)}%`}return s?(C.set(i,Is,s.id),[!0,l]):[!1,"No available tribe storage nearby"]},"Check for Excess Food and Storage",e+1),new ce((t,n)=>{if(!t.leaderId)return[!0,"No tribe coordination needed"];const i=cI(t.leaderId,n.gameState,"depositing"),a=Cn(t,n.gameState),s=Gr(t.leaderId,n.gameState).length,l=Math.max(2,Math.ceil(a.length*.4)+s);return[i<l,`Active depositors: ${i}/${l}`]},"Not Too Many Depositors",e+1),new Oi(new oe((t,n,i)=>{var c,u;const a=C.get(i,Is);if(!a)return[A.FAILURE,"No storage assigned"];const s=n.gameState.entities.entities[a];if(!s)return C.delete(i,Is),[A.FAILURE,"Storage entity missing"];if((((c=s.storedItems)==null?void 0:c.length)??0)>=(s.storageCapacity??0))return C.delete(i,Is),[A.FAILURE,"Storage full"];const l=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l<=un){t.activeAction="depositing",t.target=void 0,C.set(i,wS,n.gameState.time),C.delete(i,Is);const f=((u=t.heldItem)==null?void 0:u.type)===St.Wood;return[A.SUCCESS,f?"Depositing wood":"Depositing food"]}return t.activeAction="moving",t.target=s.position,[A.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`]},"Navigate to Storage and Deposit",e+2),{taskType:"storage",maxCapacity:yp,storageAction:"deposit",getTargetId:(t,n,i)=>C.get(i,Is)??null},"Tribal Storage Deposit Task",e+1)],"Deposit Sequence",e)],"Storage Deposit Behavior",e)}const gd="retrievalStorageId";function ED(e){return new Jt([new Se([new ce((t,n,i)=>{if(t.hunger<=Vs)return[!1,"Not hungry enough"];if(t.food.length>=t.maxFood)return[!1,"Inventory full"];const a=Qt(t,n.gameState),s=sD(t,n.gameState,void 0,a==null?void 0:a.aiBlackboard,t.id),l=qI(t,s,n.gameState),c=l==null?void 0:l.storage;return c?(C.set(i,gd,c.id),[!0,`Storage with food found at distance ${l.distance.toFixed(1)}`]):[!1,"No tribe storage with food nearby"]},"Check for Hunger and Storage Food",e+1),new Oi(new oe((t,n,i)=>{const a=C.get(i,gd);if(!a)return[A.FAILURE,"No storage target"];const s=n.gameState.entities.entities[a];if(!s)return C.delete(i,gd),[A.FAILURE,"Storage not found"];const l=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=un?(t.activeAction="retrieving",t.target=void 0,[A.SUCCESS,"Retrieving food"]):(t.activeAction="moving",t.target=s.position,[A.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`])},"Navigate to Storage and Retrieve",e+2),{taskType:"storage",maxCapacity:yp,storageAction:"retrieve",getTargetId:(t,n,i)=>C.get(i,gd)??null},"Coordinated Storage Retrieve",e+1)],"Retrieve Sequence",e)],"Storage Retrieve Behavior",e)}const jh="combatTarget",Xh="homeCenter";function CD(e){const t=new ce(s=>s.isAdult&&s.leaderId?s.id!==s.leaderId:!1,"Is Tribe Follower?",e+1),n=new ce(s=>s.hunger<_C&&s.hitpoints>=s.maxHitpoints*wv,"Is Fit for Combat?",e+1),i=new oe((s,l,c)=>{const{gameState:u}=l,f=u.entities.entities[s.leaderId];if(!f)return A.FAILURE;const g=WM(f,u,kC);if(g.length===0)return A.FAILURE;g.sort((m,S)=>{const v=G(s.position,m.position,u.mapDimensions.width,u.mapDimensions.height),T=G(s.position,S.position,u.mapDimensions.width,u.mapDimensions.height);return v-T});for(const m of g)if(YM(f.id,m.id,u)<bC){C.set(c,jh,m.id);const v=Xo(f.id,u);return C.set(c,Xh,v),A.SUCCESS}return A.FAILURE},"Find Best Target",e+1),a=new oe((s,l,c)=>{const u=C.get(c,jh),f=u&&l.gameState.entities.entities[u],g=C.get(c,Xh);if(!f||!g)return A.FAILURE;const{gameState:m}=l;return G(s.position,g,m.mapDimensions.width,m.mapDimensions.height)>_v?(s.activeAction==="attacking"&&s.attackTargetId===f.id&&(s.activeAction="idle",s.attackTargetId=void 0),C.set(c,jh,void 0),C.set(c,Xh,void 0),A.FAILURE):((!s.lastTargetAcquiredEffectTime||l.gameState.time-s.lastTargetAcquiredEffectTime>Ve*5)&&(Ge(l.gameState,Te.TargetAcquired,s.position,Ve,s.id),s.lastTargetAcquiredEffectTime=l.gameState.time),s.activeAction="attacking",s.attackTargetId=f.id,s.target=void 0,A.RUNNING)},"Attack Target",e+1);return new Se([t,n,i,a],"Tribe Member Combat",e)}function _D(e){const t=new ce((O,D)=>!O.leaderId||O.leaderId!==O.id?[!1,"Not a tribe leader"]:En(D.gameState,O).length<vp?[!1,"Leader has no children"]:[!0,"Is tribe leader"],"Is Leader",e+1),n=new oe((O,D,M)=>{const F=Cn(O,D.gameState),x=F.filter(Y=>Y.isAdult),q=Wr(O.leaderId,D.gameState,!0),ee=uu(O,D.gameState,!0).filter(Y=>Lw(Y,D.gameState)),z=op(O.leaderId,D.gameState),{count:ne,ratio:ie}=rp(O.leaderId,D.gameState),Ee=ee.length/Math.max(1,F.length),le=Math.ceil(x.length*(1+a_)),te=Gr(O.leaderId,D.gameState,!0);return C.set(M,"tribeAnalysis_adultCount",x.length),C.set(M,"tribeAnalysis_existingStorageSpots",q.length),C.set(M,"tribeAnalysis_existingPlantingZones",ee.length),C.set(M,"tribeAnalysis_existingBonfires",te.length),C.set(M,"tribeAnalysis_storageUtilization",z),C.set(M,"tribeAnalysis_bushCount",ne),C.set(M,"tribeAnalysis_bushDensity",ie),C.set(M,"tribeAnalysis_zoneDensity",Ee),C.set(M,"tribeAnalysis_projectedAdultCount",le),[A.SUCCESS,`Analyzed tribe: ${x.length} adults, ${q.length} storage, ${ee.length} viable planting zones, ${te.length} bonfires`]},"Analyze Tribe",e+1),i=new Bn(n,1,"Cached Tribe Analysis",e+1),a=new ce((O,D,M)=>{const F=C.get(M,"tribeAnalysis_adultCount");return F===void 0?[!1,"No tribe analysis available"]:F<Gy?[!1,`Tribe too small: ${F}/${Gy} adults`]:[!0,`Tribe size sufficient: ${F} adults`]},"Has Minimum Tribe Size",e+1),s=new ce((O,D,M)=>{if(C.has(M,"buildingPlacement_storageTarget"))return[!0,"Placement already in progress"];const F=C.get(M,"tribeAnalysis_adultCount"),x=C.get(M,"tribeAnalysis_existingStorageSpots"),q=C.get(M,"tribeAnalysis_storageUtilization"),ee=C.get(M,"tribeAnalysis_projectedAdultCount");if(F===void 0||x===void 0||q===void 0||ee===void 0)return[!1,"No tribe analysis available"];const z=x===0,ne=q*(ee/Math.max(1,F));return z||q>dg||ne>dg?[!0,z?"Bootstrap: First storage spot":`Utilization: ${(q*100).toFixed(0)}% (projected: ${(ne*100).toFixed(0)}%)`]:[!1,`Storage adequate: ${x}, util: ${(q*100).toFixed(0)}%`]},"Needs Storage",e+2),l=new oe((O,D,M)=>{if(C.has(M,"buildingPlacement_storageTarget"))return[A.SUCCESS,"Using existing storage placement target"];const F=C.get(M,"tribeAnalysis_existingStorageSpots");if(F===void 0)return[A.FAILURE,"No tribe analysis available"];const q=F===0?Nv:$s,ee=Ys(he.StorageSpot,O.id,D.gameState,Xi,q,O.position);return ee?(C.set(M,"buildingPlacement_storageTarget",ee),[A.SUCCESS,`Found storage location at (${ee.x.toFixed(0)}, ${ee.y.toFixed(0)})`]):[A.FAILURE,`No valid location found for storage within ${Xi}px`]},"Find Storage Location",e+2),c=new oe((O,D,M)=>{const F=C.get(M,"buildingPlacement_storageTarget");if(!F)return[A.FAILURE,"No target location in blackboard"];const x=G(O.position,F,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return x<=Vi?[A.SUCCESS,`Reached storage location (${x.toFixed(0)}px away)`]:(O.activeAction="moving",O.target=F,O.direction=ot(O.position,F,D.gameState.mapDimensions),[A.RUNNING,`Moving to storage location (${x.toFixed(0)}px away)`])},"Move To Storage Location",e+2),u=new oe((O,D,M)=>{const F=C.get(M,"buildingPlacement_storageTarget");if(!F)return[A.FAILURE,"No target location in blackboard"];const x=G(O.position,F,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return x>Vi?[A.FAILURE,`Too far from placement location: ${x.toFixed(0)}px`]:(br(F,he.StorageSpot,O.id,D.gameState),C.delete(M,"buildingPlacement_storageTarget"),C.delete(M,"caching_Cached Tribe Analysis_status"),C.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[A.SUCCESS,`Placed storage at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`])},"Place Storage",e+2),f=new Se([s,l,c,u],"Storage Sequence",e+1),g=new ce((O,D,M)=>{if(!O.leaderId)return[!1,"No tribe"];if(C.has(M,"buildingPlacement_bonfireTarget"))return[!0,"Placement already in progress"];const F=C.get(M,"tribeAnalysis_existingBonfires")||0,x=C.get(M,"tribeAnalysis_adultCount")||0,q=Xo(O.leaderId,D.gameState),ee=Js(D.gameState.temperature,q,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height),z=ee<qv&&F===0,ne=F>0&&F<Math.ceil(x/Zv),ie=Cn(O,D.gameState),Ee=Gr(O.leaderId,D.gameState,!0),le=ie.filter(Y=>Js(D.gameState.temperature,Y.position,D.gameState.time,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)<xs+5?Ee.every(W=>G(Y.position,W.position,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height)>Ws*1.5):!1),te=le.length>=3;if(z||ne||te){if(te){const X=le.reduce((V,b)=>({x:V.x+b.position.x,y:V.y+b.position.y}),{x:0,y:0});X.x/=le.length,X.y/=le.length,C.set(M,"buildingPlacement_coldClusterPos",X)}else C.delete(M,"buildingPlacement_coldClusterPos");let Y="";return z?Y=`Cold at center: ${ee.toFixed(1)}C`:ne?Y=`Tribe size: ${x}/${F} fires`:Y=`Cold cluster: ${le.length} members`,[!0,Y]}return[!1,`Adequate heating: ${F} fires for ${x} adults`]},"Needs Bonfire",e+2),m=new oe((O,D,M)=>{if(C.has(M,"buildingPlacement_bonfireTarget"))return[A.SUCCESS,"Using existing bonfire placement target"];const F=C.get(M,"buildingPlacement_coldClusterPos"),x=Ys(he.Bonfire,O.id,D.gameState,Xi,$s,F||O.position);return x?(C.set(M,"buildingPlacement_bonfireTarget",x),[A.SUCCESS,`Found bonfire location at (${x.x.toFixed(0)}, ${x.y.toFixed(0)})`]):[A.FAILURE,`No valid location found for bonfire within ${Xi}px`]},"Find Bonfire Location",e+2),S=new oe((O,D,M)=>{const F=C.get(M,"buildingPlacement_bonfireTarget");if(!F)return[A.FAILURE,"No target location in blackboard"];const x=G(O.position,F,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return x<=Vi?[A.SUCCESS,`Reached bonfire location (${x.toFixed(0)}px away)`]:(O.activeAction="moving",O.target=F,O.direction=ot(O.position,F,D.gameState.mapDimensions),[A.RUNNING,`Moving to bonfire location (${x.toFixed(0)}px away)`])},"Move To Bonfire Location",e+2),v=new oe((O,D,M)=>{const F=C.get(M,"buildingPlacement_bonfireTarget");if(!F)return[A.FAILURE,"No target location in blackboard"];const x=G(O.position,F,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return x>Vi?[A.FAILURE,`Too far from placement location: ${x.toFixed(0)}px`]:(br(F,he.Bonfire,O.id,D.gameState),C.delete(M,"buildingPlacement_bonfireTarget"),C.delete(M,"caching_Cached Tribe Analysis_status"),C.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[A.SUCCESS,`Placed bonfire at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`])},"Place Bonfire",e+2),T=new Se([g,m,S,v],"Bonfire Sequence",e+1),I=new ce((O,D,M)=>{if(C.has(M,"buildingPlacement_plantingTarget"))return[!0,"Placement already in progress"];const F=C.get(M,"tribeAnalysis_adultCount"),x=C.get(M,"tribeAnalysis_existingPlantingZones"),q=C.get(M,"tribeAnalysis_bushDensity"),ee=C.get(M,"tribeAnalysis_bushCount"),z=C.get(M,"tribeAnalysis_zoneDensity"),ne=C.get(M,"tribeAnalysis_projectedAdultCount");if(F===void 0||x===void 0||q===void 0||ee===void 0||z===void 0||ne===void 0)return[!1,"No tribe analysis available"];const ie=q*(F/Math.max(1,ne)),le=x===0||q<ug||ie<ug||ee<=fl&&x<=fl;return le&&z>ie&&(ee>fl||x>fl)?[!1,`Planting zone density (${z.toFixed(2)}) exceeds projected density (${ie.toFixed(2)})`]:le?[!0,`Low bush density: ${q.toFixed(1)}, count: ${ee}/${x} (projected: ${ie.toFixed(1)})`]:[!1,`Planting zones adequate: ${x}, density: ${q.toFixed(1)}`]},"Needs Planting Zone",e+2),_=new oe((O,D,M)=>{if(C.has(M,"buildingPlacement_plantingTarget"))return[A.SUCCESS,"Using existing planting zone placement target"];const F=Ys(he.PlantingZone,O.id,D.gameState,Xi,$s,O.position);return F?(C.set(M,"buildingPlacement_plantingTarget",F),[A.SUCCESS,`Found planting zone location at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`]):[A.FAILURE,`No valid location found for planting zone within ${Xi}px`]},"Find Planting Zone Location",e+2),N=new oe((O,D,M)=>{const F=C.get(M,"buildingPlacement_plantingTarget");if(!F)return[A.FAILURE,"No target location in blackboard"];const x=G(O.position,F,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return x<=Vi?[A.SUCCESS,`Reached planting zone location (${x.toFixed(0)}px away)`]:(O.activeAction="moving",O.target=F,O.direction=ot(O.position,F,D.gameState.mapDimensions),[A.RUNNING,`Moving to planting zone location (${x.toFixed(0)}px away)`])},"Move To Planting Zone Location",e+2),R=new oe((O,D,M)=>{const F=C.get(M,"buildingPlacement_plantingTarget");if(!F)return[A.FAILURE,"No target location in blackboard"];const x=G(O.position,F,D.gameState.mapDimensions.width,D.gameState.mapDimensions.height);return x>Vi?[A.FAILURE,`Too far from placement location: ${x.toFixed(0)}px`]:(br(F,he.PlantingZone,O.id,D.gameState),C.delete(M,"buildingPlacement_plantingTarget"),C.delete(M,"caching_Cached Tribe Analysis_status"),C.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[A.SUCCESS,`Placed planting zone at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`])},"Place Planting Zone",e+2),w=new Se([I,_,N,R],"Planting Zone Sequence",e+1),B=new Jt([f,T,w],"Building Type Selector",e+1);return new Se([t,i,a,B],"Leader Building Placement",e)}function be(e,t,n,i,a){const s=t,l=i,c="position"in e&&e.id?e:null,u=c?c.position:e,f=s.search[n].byRadius(u,l);let g=null,m=l;for(const S of f){if(S.id===(c==null?void 0:c.id)||a&&!a(S))continue;const v=G(u,S.position,t.mapDimensions.width,t.mapDimensions.height);v<m&&(m=v,g=S)}return g}function wD(e,t,n,i){return t.search[n].byRadius(e,i)}function RS(e,t,n,i){return wD(e,t,n,i).length}function yt(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function RD(e,t){var l;const i=t.search.human.byProperty("activeAction","attacking");let a=null,s=1/0;for(const c of i){if(c.attackTargetId!==e)continue;const u=G(c.position,((l=t.entities.entities[e])==null?void 0:l.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<s&&(a=c,s=u)}return a}function JI(e){return Object.values(e.entities.entities).filter(t=>t.type==="human")}function PD(e,t,n){const{width:i,height:a}=t.mapDimensions,s=Object.values(t.entities.entities).reverse();for(const l of s){const c=G(e,l.position,i,a),u=l.type==="tree"?l.radius*2:l.radius;if(c<u)return l}}function DD(e,t,n,i){const a=JI(i),s={};for(const l of a)!l.leaderId||l.leaderId===t||(s[l.leaderId]||(s[l.leaderId]={sumX:0,sumY:0,count:0}),s[l.leaderId].sumX+=l.position.x,s[l.leaderId].sumY+=l.position.y,s[l.leaderId].count++);for(const l in s){const c=s[l],u={x:c.sumX/c.count,y:c.sumY/c.count};if(G(e,u,i.mapDimensions.width,i.mapDimensions.height)<n)return!0}return!1}const Do="takeOverBuildingTarget";function ND(e){const t=new Se([new ce((n,i,a)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const s=C.get(a,Do);if(s){const c=i.gameState.entities.entities[s];if(c&&c.type==="building"&&cn(n,c,i.gameState))return[!0,`Continuing to target building ${s}`];C.delete(a,Do)}const l=be(n,i.gameState,"building",Ov,c=>cn(n,c,i.gameState)&&c.isConstructed);return l?(C.set(a,Do,l.id),[!0,`Found enemy building at distance ${G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Take Over",e+2),new oe((n,i,a)=>{const s=C.get(a,Do);if(!s)return A.FAILURE;const l=i.gameState.entities.entities[s];return!l||l.type!=="building"||!cn(n,l,i.gameState)?(C.delete(a,Do),n.activeAction="idle",n.target=void 0,A.FAILURE):G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<Ze?(n.activeAction="idle",n.target=void 0,A.SUCCESS):(n.activeAction="moving",n.target=l.id,A.RUNNING)},"Move to Enemy Building",e+2),new oe((n,i,a)=>{const s=C.get(a,Do);if(!s)return A.FAILURE;const l=i.gameState.entities.entities[s];return!l||l.type!=="building"||!cn(n,l,i.gameState)?(C.delete(a,Do),A.FAILURE):(n.activeAction="takingOverBuilding",n.target=l.id,C.delete(a,Do),A.SUCCESS)},"Initiate Building Takeover",e+2)],"Take Over Building Action",e+1);return new fa(Mv,t,"Take Over Building Cooldown",e)}const PS=2,MD=40,DS=3;function OD(e){const t=new ce(s=>{if(!s.isAdult)return[!1,"Not an adult"];if(s.hunger>xg)return[!1,`Too hungry (${s.hunger.toFixed(1)})`];const l=s.leaderId===s.id,c=s.tribeRole===J.Warrior;return!l&&!c?[!1,`Not a Warrior or Leader (role: ${s.tribeRole||"none"})`]:[!0,l?"Is Leader":"Is Warrior"]},"Is Warrior or Leader",e+1),n=new ce(s=>{var c,u;if(s.leaderId!==s.id)return[!0,"Warrior follows leader strategy"];const l=((u=(c=s.tribeControl)==null?void 0:c.armyControl)==null?void 0:u.expandBorders)??0;return l<PS?[!1,`Expand borders weight too low: ${l}/${PS}`]:[!0,`Expand borders weight: ${l}`]},"Has Expand Borders Weight",e+1),i=new ce((s,l)=>{if(!s.leaderId)return[!1,"No tribe leader"];const u=l.gameState.search.building.byProperty("ownerId",s.leaderId);return u.length===0?[!1,"No territory to expand"]:[!0,`Tribe has ${u.length} buildings`]},"Has Territory",e+1),a=new oe((s,l,c)=>{if(!s.leaderId)return[A.FAILURE,"No leader"];const u=l.gameState,f=u.mapDimensions.width,g=u.mapDimensions.height,m=rI(s.position,s.leaderId,u);if(!m)return[A.FAILURE,"Could not find territory edge"];const S=G(s.position,m,f,g);if(S>MD)return s.activeAction="moving",s.target=m,[A.RUNNING,`Approaching territory edge (${S.toFixed(0)}px)`];const T=u.search.building.byProperty("ownerId",s.leaderId),I=Hd(T.map(F=>F.position));C.get(c,"pioneerOrbitDirection")===void 0&&C.set(c,"pioneerOrbitDirection",1);const _=Math.ceil(f/we),N=Math.ceil(g/we),R=ww(s.position),w=[];for(let F=-3;F<=DS;F++)for(let x=-3;x<=DS;x++){if(x===0&&F===0)continue;const q=((R.x+x)%_+_)%_,ee=((R.y+F)%N+N)%N,z=ee*_+q,ne=u.terrainOwnership[z],ie=ne!==null&&aa(s.leaderId,ne,u);if(ne!==null&&!ie)continue;const Ee={x:q*we+we/2,y:ee*we+we/2};tI(Ee,s.leaderId,u,Qg,!0,s.leaderId).canPlace&&w.push({pos:Ee,gx:q,gy:ee})}if(w.length===0)return C.set(c,"pioneerOrbitDirection",-C.get(c,"pioneerOrbitDirection")),[A.RUNNING,"Blocked, reversing orbit direction"];const B=rt(ze(I,s.position,f,g)),O=fg(B,C.get(c,"pioneerOrbitDirection")*(Math.PI/2));let D=w[0],M=-1/0;for(const F of w){let x=0;for(let le=-1;le<=1;le++)for(let te=-1;te<=1;te++){if(te===0&&le===0)continue;const Y=((F.gx+te)%_+_)%_,X=((F.gy+le)%N+N)%N;u.terrainOwnership[X*_+Y]===s.leaderId&&x++}const q=rt(ze(s.position,F.pos,f,g)),ee=bv(q,O),z=G(I,F.pos,f,g),ne=G(I,s.position,f,g),ie=z>ne?1:0,Ee=x*2+ee*1.5+ie*.5;Ee>M&&(M=Ee,D=F)}return br(s.position,he.BorderPost,s.leaderId,u),s.target=D.pos,s.activeAction="moving",[A.RUNNING,"Expanding territory (cell-based)"]},"Pioneer Expansion",e+1);return new Se([t,n,i,a],"Border Expansion",e)}const No="removeEnemyBuildingTarget";function kD(e){const t=new Se([new ce((n,i,a)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const s=C.get(a,No);if(s){const c=i.gameState.entities.entities[s];if(c&&c.type==="building"&&cn(n,c,i.gameState))return[!0,`Continuing to target building ${s}`];C.delete(a,No)}const l=be(n,i.gameState,"building",Ov,c=>cn(n,c,i.gameState)&&c.isConstructed);return l?(C.set(a,No,l.id),[!0,`Found enemy building at distance ${G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Destroy",e+2),new oe((n,i,a)=>{const s=C.get(a,No);if(!s)return A.FAILURE;const l=i.gameState.entities.entities[s];return!l||l.type!=="building"||!cn(n,l,i.gameState)?(C.delete(a,No),n.activeAction="idle",n.target=void 0,A.FAILURE):G(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<Ze?(n.activeAction="idle",n.target=void 0,A.SUCCESS):(n.activeAction="moving",n.target=l.id,A.RUNNING)},"Move to Enemy Building",e+2),new oe((n,i,a)=>{const s=C.get(a,No);if(!s)return A.FAILURE;const l=i.gameState.entities.entities[s];return!l||l.type!=="building"||!cn(n,l,i.gameState)?(C.delete(a,No),A.FAILURE):(n.activeAction="destroyingBuilding",n.target=l.id,C.delete(a,No),A.SUCCESS)},"Initiate Building Destruction",e+2)],"Remove Enemy Building Action",e+1);return new fa(Mv,t,"Remove Enemy Building Cooldown",e)}function bD(e){return new Se([new oe((t,n,i)=>{const a=BM(t,n.gameState);return a?(C.set(i,"patriarchTarget",a.id),[A.SUCCESS,`Found patriarch: ${a.id}`]):(C.delete(i,"patriarchTarget"),[A.FAILURE,"No patriarch found"])},"Find Patriarch",e+1),new oe((t,n,i)=>{const a=C.get(i,"patriarchTarget"),s=a&&n.gameState.entities.entities[a];if(!s)return[A.FAILURE,"Patriarch target missing from blackboard"];const l=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l>DC){t.activeAction="moving",t.target=s.id;const c=ze(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(c),[A.RUNNING,`Moving to patriarch at ${l.toFixed(0)}`]}return t.activeAction="idle",t.target=void 0,t.direction={x:0,y:0},[A.SUCCESS,`Arrived at patriarch at ${l.toFixed(0)}`]},"Move Towards Patriarch",e+1)],"Follow Patriarch",e)}let Vh=0;function Xd(){const e=zd[Vh];return Vh=(Vh+1)%zd.length,e}const Tp="tribeSplit_phase",Xl="tribeSplit_strategy",Ap="tribeSplit_targetPosition",yu="tribeSplit_targetBuildingId",Su="tribeSplit_familyIds",eT="tribeSplit_phaseStartTime",tT="tribeSplit_lastFailureTime";function nT(e,t){C.set(e,Tp,"idle"),C.delete(e,Xl),C.delete(e,Ap),C.delete(e,yu),C.delete(e,Su),C.set(e,tT,t)}function BD(e,t){const n=C.get(e,tT);return n?t-n>=KP:!0}function FD(e,t){const n=C.get(e,eT);return n?t-n>=VP:!1}function Ep(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(ST(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!BD(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const i=t.entities.entities[e.leaderId];if(!i||i.type!=="human")return{canSplit:!1,reason:"Leader not found"};const a=$r(En(t,i));if(a&&a.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(Vd(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const l=ki(e.leaderId,t).filter(v=>v.isAdult);if(l.length<Yh)return{canSplit:!1,reason:"Tribe too small"};const u=Kd(e,t).length+1,g=Kd(i,t).length+1;if(u>=g&&u>Yh)return{canSplit:!0,progress:1,strategy:NS(e,t)};const m=Math.max(l.length*zP,Yh),S=u/m;if(u>=m){const v=NS(e,t);return{canSplit:!0,progress:S,strategy:v}}return{canSplit:!1,progress:S,reason:`Family too small: ${u} < ${m}`}}function NS(e,t){if(!e.leaderId)return"migration";const n=t;if(!(xo(e.position.x,e.position.y,t)===e.leaderId))return"migration";const a=n.search.building.byProperty("ownerId",e.leaderId).filter(s=>s.buildingType===he.StorageSpot&&s.isConstructed);return a.length>0&&a.find(l=>G(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height)<=XP)?"concentration":"migration"}function iT(e,t){if(!e.aiBlackboard)return!1;const n=C.get(e.aiBlackboard,Xl);if(!n)return!1;const i=Kd(e,t),a=[e.id,...i.map(s=>s.id)];return C.set(e.aiBlackboard,Su,a),n==="migration"?UD(e,t):n==="concentration"?HD(e,t):!1}function LD(e,t,n){if(qn(e,n,30))return!1;const a=xo(e.x,e.y,n);return!(a===t||a!==null&&a!==t)}function UD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,i=t.mapDimensions.height,a=Math.min(n,i)/2,s=50,l=50;for(let c=0;c<=a;c+=s){const u=c===0?1:Math.max(8,Math.ceil(2*Math.PI*c/l)),f=c===0?0:2*Math.PI/u;for(let g=0;g<u;g++){const m=g*f,S=Math.cos(m)*c,v=Math.sin(m)*c,T=e.position.x+S,I=e.position.y+v,_={x:(T%n+n)%n,y:(I%i+i)%i};if(LD(_,e.leaderId,t))return C.set(e.aiBlackboard,Ap,_),!0}}return!1}function HD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const i=t.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===he.StorageSpot&&l.isConstructed);if(i.length===0)return!1;let a=null,s=1/0;for(const l of i){const c=G(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);c<s&&(s=c,a=l)}return a?(C.set(e.aiBlackboard,yu,a.id),!0):!1}function GD(e,t){var c;if(!e.aiBlackboard)return[!1,0];const n=C.get(e.aiBlackboard,Xl),i=(c=C.get(e.aiBlackboard,Su))==null?void 0:c.filter(u=>!!t.entities.entities[u]);if(!n||!i)return[!1,0];let a;if(n==="migration"){const u=C.get(e.aiBlackboard,Ap);if(!u)return[!1,0];a=u}else if(n==="concentration"){const u=C.get(e.aiBlackboard,yu);if(!u)return[!1,0];const f=t.entities.entities[u];if(!f)return[!1,0];a=f.position}else return[!1,0];let s=0;for(const u of i){const f=t.entities.entities[u];if(!f||f.type!=="human")continue;G(f.position,a,t.mapDimensions.width,t.mapDimensions.height)<=VI&&s++}const l=Math.ceil(i.length*.5);return[s>=l,s/l]}function oT(e,t){var u;if(!e.aiBlackboard)return!1;const n=C.get(e.aiBlackboard,Xl),i=C.get(e.aiBlackboard,Su);if(!n||!i)return!1;const a=e.leaderId?t.entities.entities[e.leaderId]:void 0,s=Xd(),l=Fn[Math.floor(Math.random()*Fn.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:s,tribeColor:l},e.tribeRole=J.Leader,e.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},a&&((u=a.tribeControl)!=null&&u.diplomacy)&&(a.tribeControl.diplomacy[e.id]=Ft.Hostile);for(const f of i){if(f===e.id)continue;const g=t.entities.entities[f];!g||g.type!=="human"||(g.leaderId=e.id,g.tribeInfo={tribeBadge:s,tribeColor:l})}if(n==="concentration"){const f=C.get(e.aiBlackboard,yu);if(f){const g=t.entities.entities[f];g&&g.type==="building"&&(g.ownerId=e.id)}}return Ml(t,{type:Lr.NewTribeFormed,message:`A new tribe has formed via ${n}! ${s}`,duration:Gd,targetEntityIds:[e.id],highlightedEntityIds:i}),Ne({gameState:t},Ae.TribeSplit,e.position),nT(e.aiBlackboard,t.time),!0}function yl(e){return e?C.get(e,Tp)??"idle":"idle"}function Ts(e,t,n){C.set(e,Tp,t),C.set(e,eT,n)}function rT(e,t){C.set(e,Xl,t)}function $D(e,t){nT(e,t)}function xD(e,t){return FD(e,t)?($D(e,t),!0):!1}function sT(e,t){const n=Ep(e,t);return{canSplit:n.canSplit,progress:n.progress}}function aT(e,t){if(!e.aiBlackboard)return;const n=Ep(e,t);!n.canSplit||!n.strategy||(rT(e.aiBlackboard,n.strategy),iT(e,t)&&oT(e,t))}function WD(e){const t=new Jt([new Se([new ce((n,i)=>{if(!n.aiBlackboard)return[!1,"No blackboard"];if(!n.leaderId||n.leaderId===n.id)return[!1,"No tribe or the leader"];if(Vd(n,i.gameState).id!==n.id)return[!1,"Not patriarch"];const s=yl(n.aiBlackboard);return s!=="idle"&&xD(n.aiBlackboard,i.gameState.time)?(Ts(n.aiBlackboard,"idle",i.gameState.time),[!1,"Phase timed out, reset to idle"]):[s==="idle",`Phase: ${s}`]},"Is Idle?",e+2),new oe((n,i)=>{if(!n.aiBlackboard)return A.FAILURE;const a=Ep(n,i.gameState);return a.canSplit&&a.strategy?(Ts(n.aiBlackboard,"planning",i.gameState.time),rT(n.aiBlackboard,a.strategy),A.SUCCESS):[A.FAILURE,a.reason||"Cannot split"]},"Check Split Conditions",e+2)],"Check Phase",e+1),new Se([new ce(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=yl(n.aiBlackboard);return[i==="planning",`Phase: ${i}`]},"Is Planning?",e+2),new oe((n,i)=>n.aiBlackboard?iT(n,i.gameState)?(Ts(n.aiBlackboard,"gathering",i.gameState.time),A.SUCCESS):(Ts(n.aiBlackboard,"idle",i.gameState.time),A.FAILURE):A.FAILURE,"Plan Split Strategy",e+2)],"Planning Phase",e+1),new Se([new ce(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=yl(n.aiBlackboard);return[i==="gathering",`Phase: ${i}`]},"Is Gathering?",e+2),new oe((n,i)=>{if(!n.aiBlackboard)return A.FAILURE;const[a,s]=GD(n,i.gameState);return a?(Ts(n.aiBlackboard,"executing",i.gameState.time),A.SUCCESS):[A.RUNNING,`Progress: ${s.toFixed(2)}`]},"Wait for Family to Gather",e+2)],"Gathering Phase",e+1),new Se([new ce(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=yl(n.aiBlackboard);return[i==="executing",`Phase: ${i}`]},"Is Executing?",e+2),new oe((n,i)=>n.aiBlackboard?oT(n,i.gameState)?A.SUCCESS:(Ts(n.aiBlackboard,"idle",i.gameState.time),A.FAILURE):A.FAILURE,"Execute Tribe Split",e+2)],"Execution Phase",e+1)],"Tribe Split State Machine",e+1);return new fa(jP,t,"Tribe Split Cooldown",e)}const pd="jealousyAttackTarget";function YD(e){return new Se([new ce((t,n,i)=>{var l,c;if(!t.isAdult)return[!1,"Not an adult"];if(t.gender!=="male")return[!1,"Not male"];const a=((c=(l=t.partnerIds)==null?void 0:l.map(u=>{var f;return(f=n.gameState.entities.entities[u])==null?void 0:f.pregnancyFatherId}))==null?void 0:c.filter(u=>!!u&&u!==t.id))??[],s=n.gameState.search.human.byRadius(t.position,YC).find(u=>a.includes(u.id));return s?t.leaderId&&s.id===t.leaderId?[!1,"Stranger is the tribe leader - no attack"]:(C.set(i,pd,s.id),[!0,`Partner cheating with ${s.id}`]):(C.delete(i,pd),!1)},"Check for Infidelity",e+1),new oe((t,n,i)=>{const a=C.get(i,pd),s=a&&n.gameState.entities.entities[a];return!s||s.hitpoints<=0?(C.delete(i,pd),[A.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===s.id?A.RUNNING:(t.activeAction="attacking",t.attackTargetId=s.id,[A.RUNNING,`Attacking ${s.id}`])},"Execute Jealousy Attack",e+1)],"Jealousy Attack",e)}const md="defendAggressor";function zD(e){return new Se([new ce((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const a=$M(t,n.gameState,zC);return a?(C.set(i,md,a.aggressor.id),[!0,`Family member ${a.familyMember.id} attacked by ${a.aggressor.id}`]):(C.delete(i,md),!1)},"Check Family Under Attack",e+1),new oe((t,n,i)=>{const a=C.get(i,md),s=a&&n.gameState.entities.entities[a];return!s||s.hitpoints<=0?(C.delete(i,md),[A.FAILURE,"Target invalid/dead"]):t.activeAction==="attacking"&&t.attackTargetId===s.id?A.RUNNING:(t.activeAction="attacking",t.attackTargetId=s.id,[A.RUNNING,`Attacking aggressor ${s.id}`])},"Execute Family Defense Attack",e+1)],"Defend Family",e)}const yd="desperateAttackTarget";function jD(e){return new Se([new ce(t=>t.hunger>jC,"Is Starving",e+1),new ce((t,n)=>{if(!t.isAdult)return[!1,"Not an adult"];const i=be(t,n.gameState,"berryBush",Ze,s=>s.food.length>0),a=be(t,n.gameState,"corpse",Ze,s=>s.food.length>0);return!i&&!a},"No Other Food Available",e+1),new ce((t,n,i)=>{const a=xM(t,n.gameState);return a?(C.set(i,yd,a.id),[!0,`Found weak target ${a.id}`]):(C.delete(i,yd),!1)},"Find Weak Target",e+1),new oe((t,n,i)=>{const a=C.get(i,yd),s=a&&n.gameState.entities.entities[a];return!s||s.hitpoints<=0?(C.delete(i,yd),[A.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===s.id?A.RUNNING:(t.activeAction="attacking",t.attackTargetId=s.id,[A.RUNNING,`Desperately attacking ${s.id}`])},"Execute Desperate Attack",e+1)],"Desperate Attack",e)}var de=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(de||{});const vu={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},lT={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var Ds=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(Ds||{});const nl={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var re=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenRoleManager="OpenRoleManager",e.CloseRoleManager="CloseRoleManager",e.IncreaseRoleWeight="IncreaseRoleWeight",e.DecreaseRoleWeight="DecreaseRoleWeight",e.OpenArmyControl="OpenArmyControl",e.CloseArmyControl="CloseArmyControl",e.IncreaseArmyObjective="IncreaseArmyObjective",e.DecreaseArmyObjective="DecreaseArmyObjective",e.SwitchAIType="SwitchAIType",e))(re||{});function XD(e,t,n,i){var u;const a=e.entities.entities[n.targetEntityId];if(!a||!("hitpoints"in a)||a.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const s=G(t.position,a.position,e.mapDimensions.width,e.mapDimensions.height),c=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?Tn:jo;return s<=c?(t.activeAction="attacking",t.attackTargetId=a.id,e.autopilotControls.activeAutopilotAction=void 0,A.SUCCESS):(t.activeAction="moving",t.target=a.id,t.direction=ot(t.position,a.position,e.mapDimensions),A.RUNNING)}function VD(e){return new Se([new ce((t,n)=>t.isPlayer===!0&&!!n.gameState.autopilotControls.activeAutopilotAction,"Has Player Command",e+1),new oe((t,n)=>{var s,l;const{gameState:i}=n,a=i.autopilotControls.activeAutopilotAction;if(!a)return A.FAILURE;switch(a.action){case de.AutopilotMove:{if(!("position"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=a.position;return G(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<QC?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),A.SUCCESS):(t.activeAction="moving",t.target=c,t.direction=ot(t.position,c,i.mapDimensions),A.RUNNING)}case de.AutopilotGather:{if(!("targetEntityId"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=i.entities.entities[a.targetEntityId];if(!c)return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;let u=!1;if(c.type==="berryBush")u=c.food.length===0;else if(c.type==="corpse")u=c.food.length===0;else if(c.type==="tree"){const g=c;u=((s=g.stateMachine)==null?void 0:s[0])!==An||g.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;return u?(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE):G(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>qs?(t.activeAction="moving",t.target=c.id,t.direction=ot(t.position,c.position,i.mapDimensions),A.RUNNING):(t.activeAction="gathering",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,A.SUCCESS)}case de.AutopilotChop:{if(!("targetEntityId"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=i.entities.entities[a.targetEntityId];if(!c||c.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const[u]=c.stateMachine??[];return!(u===Kn||u===Ln||u===di)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE):G(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>Wg?(t.activeAction="moving",t.target=c.id,t.direction=ot(t.position,c.position,i.mapDimensions),A.RUNNING):(t.activeAction="chopping",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,A.SUCCESS)}case de.AutopilotAttack:return"targetEntityId"in a?XD(i,t,a):(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE);case de.AutopilotProcreate:{if(!("targetEntityId"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=i.entities.entities[a.targetEntityId];return!c||c.type!=="human"||!xr(t,c,n.gameState)?(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE):G(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Dh?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,A.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=ot(t.position,c.position,i.mapDimensions),A.RUNNING)}case de.AutopilotPlant:{if(t.activeAction==="planting")return A.RUNNING;if(!("position"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=a.position;return qn(c,i,Ur,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE):G(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<=Dh?(t.activeAction="planting",t.target=c,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,A.RUNNING):(t.activeAction="moving",t.target=c,t.direction=ot(t.position,c,i.mapDimensions),A.RUNNING)}case de.AutopilotFeedChild:{if(!("targetEntityId"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=i.entities.entities[a.targetEntityId];return!c||c.type!=="human"||c.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE):G(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Dh?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",A.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=ot(t.position,c.position,i.mapDimensions),A.RUNNING)}case de.AutopilotDeposit:{if(!("targetEntityId"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=i.entities.entities[a.targetEntityId];if(!c||c.buildingType!==he.StorageSpot&&c.buildingType!==he.Bonfire||!c.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const u=c.storageCapacity??0;if(c.storedItems.length>=u||t.leaderId!==c.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const g=t.food.length>0,m=!!t.heldItem;if(c.buildingType===he.Bonfire){if(((l=t.heldItem)==null?void 0:l.type)!==St.Wood)return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE}else if(!g&&!m)return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;return G(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=un?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,A.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=ot(t.position,c.position,i.mapDimensions),A.RUNNING)}case de.AutopilotRetrieve:{if(!("targetEntityId"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=i.entities.entities[a.targetEntityId];return!c||c.buildingType!==he.StorageSpot||!c.isConstructed||c.storedItems.length===0||t.leaderId!==c.ownerId||t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE):G(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=un?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,A.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=ot(t.position,c.position,i.mapDimensions),A.RUNNING)}case de.TakeOverBuilding:{if(!("targetEntityId"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=i.entities.entities[a.targetEntityId];return!c||c.type!=="building"||!cn(t,c,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE):G(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Ze?(t.activeAction="takingOverBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,A.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=ot(t.position,c.position,i.mapDimensions),A.RUNNING)}case de.RemoveEnemyBuilding:{if(!("targetEntityId"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=i.entities.entities[a.targetEntityId];return!c||c.type!=="building"||!cn(t,c,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE):G(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Ze?(t.activeAction="destroyingBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,A.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=ot(t.position,c.position,i.mapDimensions),A.RUNNING)}case de.AutopilotBuildingPlacement:{if(!("position"in a)||!("buildingType"in a))return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const c=a.position,u=a.buildingType;if(!u)return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE;const f=G(t.position,c,i.mapDimensions.width,i.mapDimensions.height),g=100;return f<=g?Hl(c,u,t.leaderId,i,t.position,g)?(br(c,u,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",A.SUCCESS):(i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE):(t.activeAction="moving",t.target=c,t.direction=ot(t.position,c,i.mapDimensions),A.RUNNING)}default:return i.autopilotControls.activeAutopilotAction=void 0,A.FAILURE}},"Execute Player Command",e+1)],"Player Command Handler",e)}function KD(e){const t=new ce(i=>i.id===i.leaderId,"Is Leader?",e+1),n=new oe((i,a)=>{var f,g,m,S,v,T;const{gameState:s}=a,l=ki(i.id,s),c=FS(l),u=Eu(s).filter(I=>I.leaderId!==i.id);for(const I of u){const _=ki(I.leaderId,s),N=FS(_),R=((g=(f=i.tribeControl)==null?void 0:f.diplomacy)==null?void 0:g[I.leaderId])||Ft.Friendly,w=s.entities.entities[I.leaderId];((S=(m=w==null?void 0:w.tribeControl)==null?void 0:m.diplomacy)==null?void 0:S[i.id])===Ft.Hostile||c>N*WC?R!==Ft.Hostile&&((v=i.tribeControl)!=null&&v.diplomacy)&&(i.tribeControl.diplomacy[I.leaderId]=Ft.Hostile):R!==Ft.Friendly&&((T=i.tribeControl)!=null&&T.diplomacy)&&(i.tribeControl.diplomacy[I.leaderId]=Ft.Friendly)}return A.SUCCESS},"Evaluate Diplomacy",e+2);return new Se([t,new fa(xC,n,"Diplomacy Cooldown",e+1)],"Manage Diplomacy",e)}const il="huntTarget";function qD(e){return new Se([new Bn(new ce((n,i,a)=>{if(!n.isAdult)return[!1,"Not an adult"];if(!n.leaderId)return[!1,"Not in a tribe"];if(!Un(n,J.Hunter,i.gameState))return[!1,"Not a Hunter"];const s=be(n.position,i.gameState,"prey",wC,l=>!(n.leaderId&&!Pr(l.position,n.leaderId,i.gameState)));return s?(C.set(a,il,s.id),[!0,"Found prey"]):[!1,"No suitable prey found"]},"Find Prey Target",e+2),$C,"Cache Find Prey",e+1),new Oi(new Cr(new oe((n,i,a)=>{if(!n.leaderId)return A.FAILURE;const s=C.get(a,il);if(!s)return A.FAILURE;const l=i.gameState.entities.entities[s];if(!l||l.hitpoints<=0)return C.delete(a,il),n.activeAction="idle",n.attackTargetId=void 0,A.SUCCESS;const{gameState:c}=i,u=Xo(n.leaderId,c);return G(n.position,u,c.mapDimensions.width,c.mapDimensions.height)>RC?(C.delete(a,il),n.activeAction="idle",n.attackTargetId=void 0,A.FAILURE):(n.activeAction="attacking",n.attackTargetId=l.id,A.RUNNING)},"Hunt Prey Action",e+3),ws,"Hunt Prey Timeout",e+2),{taskType:"hunt",maxCapacity:mp,getTargetId:(n,i,a)=>C.get(a,il)??null},"Tribal Hunt Task",e+1)],"Human Hunt Prey Sequence",e)}const Sd="defendTarget",Kh=150;function ZD(e){return new Se([new ce((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult - children flee instead"];if(t.hitpoints<=t.maxHitpoints*.3)return[!1,"Too injured to defend"];const{gameState:a}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=a.entities.entities[t.attackTargetId];if(l&&l.type==="predator"&&l.hitpoints>0&&G(t.position,l.position,a.mapDimensions.width,a.mapDimensions.height)<=Kh)return C.set(i,Sd,l.id),[!0,"Continuing defense"]}const s=be(t,a,"predator",Kh,l=>l.hitpoints>0&&(l.isAdult||!1));if(s){const l=G(t.position,s.position,a.mapDimensions.width,a.mapDimensions.height),c=s.attackTargetId===t.id,u=l<80;if(c||u)return C.set(i,Sd,s.id),[!0,"Predator threat detected"]}return C.set(i,Sd,void 0),[!1,"No predator threat"]},"Detect Predator Threat",e+1),new oe((t,n,i)=>{const a=C.get(i,Sd),s=a&&n.gameState.entities.entities[a];if(!s)return A.FAILURE;const{gameState:l}=n,c=G(t.position,s.position,l.mapDimensions.width,l.mapDimensions.height);return t.hitpoints<t.maxHitpoints*.3?A.FAILURE:s.hitpoints<=0||c>Kh*1.5?(t.activeAction="idle",t.attackTargetId=void 0,A.SUCCESS):(t.activeAction="attacking",t.attackTargetId=s.id,A.RUNNING)},"Defend Against Predator",e+1)],"Human Defend Against Predator",e)}function QD(e){const t=new oe((n,i)=>{if(!n.leaderId||!n.isAdult)return A.FAILURE;const a=i.gameState.entities.entities[n.leaderId];if(!a||!a.tribeControl)return A.FAILURE;if(n.id===a.id)return n.tribeRole!==J.Leader&&(n.tribeRole=J.Leader),A.SUCCESS;const l=Cn(a,i.gameState).filter(I=>I.id!==a.id),c=l.length;if(c===0)return A.SUCCESS;const u=a.tribeControl.roleWeights;let f=0;const g=[];for(const I of Object.values(J))I!==J.Leader&&(f+=u[I]||0,g.push(I));if(f===0)return n.tribeRole||(n.tribeRole=J.Gatherer),A.SUCCESS;const m={},S={},v={};for(const I of g)m[I]=0,S[I]=u[I]/f*c;for(const I of l)I.tribeRole&&I.tribeRole!==J.Leader&&(m[I.tribeRole]=(m[I.tribeRole]||0)+1);for(const I of g)v[I]=S[I]-m[I];let T=!1;if((!n.tribeRole||n.tribeRole===J.Leader||v[n.tribeRole]<-.5&&g.some(N=>v[N]>.5))&&(T=!0),T){let I=null,_=-1/0;const N=[...g].sort(()=>Math.random()-.5);for(const R of N){const w=v[R];w>_&&(_=w,I=R)}if(I)n.tribeRole=I;else{const R=Math.random()*f;let w=0;for(const B of g)if(w+=u[B],R<=w){n.tribeRole=B;break}}}return A.SUCCESS},"Assign Tribe Role",e+1);return new Bn(t,Ms,"Cache Tribe Role Assignment",e)}const JD=5,eN=0,tN=10;function nN(e){return e<Rv?{[J.Leader]:0,[J.Gatherer]:7,[J.Planter]:2,[J.Hunter]:1,[J.Mover]:1,[J.Warrior]:0}:e<Pv?{[J.Leader]:0,[J.Gatherer]:5,[J.Planter]:4,[J.Hunter]:2,[J.Mover]:2,[J.Warrior]:1}:e<Dv?{[J.Leader]:0,[J.Gatherer]:4,[J.Planter]:3,[J.Hunter]:3,[J.Mover]:3,[J.Warrior]:2}:{[J.Leader]:0,[J.Gatherer]:3,[J.Planter]:3,[J.Hunter]:4,[J.Mover]:3,[J.Warrior]:3}}function iN(e){if(e.length===0)return 0;let t=0,n=0;for(const i of e)t+=i.food.length,n+=i.maxFood;return n===0?0:t/n}function oN(e,t){return e<t?Math.min(e+1,tN):e>t?Math.max(e-1,eN):e}function rN(e){const t=new oe((n,i)=>{if(!n.leaderId||n.id!==n.leaderId||!n.tribeControl)return A.FAILURE;const a=Cn(n,i.gameState);if(a.filter(m=>m.isAdult).length<JD)return A.FAILURE;const l=iN(a),c=nN(l),u=n.tribeControl.roleWeights;let f=!1;const g=[J.Gatherer,J.Planter,J.Hunter,J.Mover,J.Warrior];for(const m of g){const S=u[m]||0,v=c[m],T=oN(S,v);T!==S&&(u[m]=T,f=!0)}if(f){const m=`Adjusted weights for food security: ${(l*100).toFixed(1)}%`;return[A.SUCCESS,m]}return A.FAILURE},"Manage Tribe Role Weights",e+1);return new Bn(t,Ms,"Cache Role Management",e)}const Sr="treeTarget";function sN(e){const t=new oe((i,a,s)=>{const l=Qt(i,a.gameState),c=be(i,a.gameState,"tree",qC,u=>{const[f]=u.stateMachine??[];if(!(f===Kn||f===Ln||f===di)||i.leaderId&&!Pr(u.position,i.leaderId,a.gameState))return!1;if(l&&l.aiBlackboard){const m=`tribal_chop_${u.id}`,S=C.get(l.aiBlackboard,m);if(S&&a.gameState.time-S.startTime<=Ni&&!S.memberIds.includes(i.id))return!1}return!0});return c?(C.set(s,Sr,c.id),[A.SUCCESS,`Found tree: ${c.id} at ${c.position.x.toFixed(0)},${c.position.y.toFixed(0)}`]):[A.FAILURE,"No tree found"]},"Find Closest Tree",e+4),n=new Oi(new oe((i,a,s)=>{const l=C.get(s,Sr);if(!l)return[A.FAILURE,"No target in blackboard"];const c=a.gameState.entities.entities[l];if(!c)return C.delete(s,Sr),[A.FAILURE,"Tree no longer exists"];const[u]=c.stateMachine??[];return u===Kn||u===Ln||u===di?G(i.position,c.position,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height)<Wg?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=c.id,C.delete(s,Sr),[A.SUCCESS,`Chopping tree ${c.id}`]):(i.activeAction="moving",i.target=c.id,i.direction=ot(i.position,c.position,a.gameState.mapDimensions),[A.RUNNING,`Moving to tree ${c.id}`]):(C.delete(s,Sr),[A.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop",e+3),{taskType:"chop",maxCapacity:1,getTargetId:(i,a,s)=>C.get(s,Sr)??null},"Tribal Chop Task",e+3);return new Se([new ce((i,a)=>{const s=Qt(i,a.gameState);if(!s)return[!1,"No leader for coordination"];const l=mg(s.id,a.gameState);if(l<=0)return[!1,"No wood need"];const c=Bw(s.id,a.gameState);return[l>c,`Wood need: ${l}, Available on ground: ${c}`]},"Need Wood?",e+1),new ce(i=>{const a=!i.heldItem;return[(i.isAdult&&a)??!1,`${a?"Can chop":"Holding item"}`]},"Should Chop Tree",e+1),new Jt([new Se([new ce((i,a,s)=>C.has(s,Sr),"Has Tree Target?",e+2),n],"Continue Chopping Action",e+2),new Se([new Bn(t,HC,"Cache Tree Search",e+3),n],"Find New Tree and Chop",e+2)],"Perform or Start Chopping",e+1)],"Chop Tree",e)}const vr="cleanupTreeTarget";function aN(e){const t=new oe((i,a,s)=>{const l=Qt(i,a.gameState),c=uu(i,a.gameState);if(c.length===0)return[A.FAILURE,"No planting zones found"];const u=a.gameState;let f=null,g=1/0;for(const m of c){const S=Math.sqrt(m.width*m.width+m.height*m.height)/2,v=u.search.tree.byRadius(m.position,S);for(const T of v){const[I]=T.stateMachine??[];if(!(I===Kn||I===Ln||I===di)||!gg(T.position,m,a.gameState))continue;if(l&&l.aiBlackboard){const R=`tribal_cleanup_tree_${T.id}`,w=C.get(l.aiBlackboard,R);if(w&&a.gameState.time-w.startTime<=Ni&&!w.memberIds.includes(i.id))continue}const N=G(i.position,T.position,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height);N<g&&(g=N,f=T)}}return f?(C.set(s,vr,f.id),[A.SUCCESS,`Found nuisance tree: ${f.id} at ${f.position.x.toFixed(0)},${f.position.y.toFixed(0)}`]):[A.FAILURE,"No nuisance trees found in planting zones"]},"Find Nuisance Tree",e+4),n=new Oi(new oe((i,a,s)=>{const l=C.get(s,vr);if(!l)return[A.FAILURE,"No target in blackboard"];const c=a.gameState.entities.entities[l];if(!c)return C.delete(s,vr),[A.FAILURE,"Tree no longer exists"];const[u]=c.stateMachine??[];return u===Kn||u===Ln||u===di?G(i.position,c.position,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height)<Wg?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=c.id,C.delete(s,vr),[A.SUCCESS,`Chopping nuisance tree ${c.id}`]):(i.activeAction="moving",i.target=c.id,i.direction=ot(i.position,c.position,a.gameState.mapDimensions),[A.RUNNING,`Moving to nuisance tree ${c.id}`]):(C.delete(s,vr),[A.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop (Cleanup)",e+3),{taskType:"cleanup_tree",maxCapacity:1,getTargetId:(i,a,s)=>C.get(s,vr)??null},"Tribal Cleanup Tree Task",e+3);return new Se([new ce((i,a)=>{const s=Un(i,J.Planter,a.gameState),l=Un(i,J.Gatherer,a.gameState),c=!i.heldItem;return[!!(i.isAdult&&(s||l)&&c),`${c?"Planter/Gatherer role eligible":"Holding item"}`]},"Should Cleanup Zone?",e+1),new Jt([new Se([new ce((i,a,s)=>C.has(s,vr),"Has Cleanup Target?",e+2),n],"Continue Cleanup Action",e+2),new Se([new Bn(t,GC,"Cache Cleanup Search",e+3),n],"Find New Nuisance Tree and Chop",e+2)],"Perform or Start Cleanup",e+1)],"Cleanup Planting Zones",e)}const ol="bonfireTargetId",lN=800;function cN(e){return new Se([new ce((t,n)=>{const i=Js(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=i<xs+8;return[a,`Temp: ${i.toFixed(1)}C`+(a?" (Cold)":"")]},"Is Cold?",e+1),new oe((t,n,i)=>{const a=Qt(t,n.gameState),s=be(t,n.gameState,"building",lN,l=>{if(!(l.buildingType===he.Bonfire&&l.isConstructed&&!l.isBeingDestroyed&&(l.fuelLevel??0)>0)||l.ownerId!==t.leaderId)return!1;if(a&&a.aiBlackboard){const u=`tribal_warmth_${l.id}`,f=C.get(a.aiBlackboard,u);if(f&&n.gameState.time-f.startTime<=Ni&&f.memberIds.length>=qy&&!f.memberIds.includes(t.id))return!1}return!0});return s?(C.set(i,ol,s.id),[A.SUCCESS,`Found bonfire ${s.id}`]):(C.delete(i,ol),[A.FAILURE,"No available fueled bonfires found"])},"Find Bonfire",e+1),new Oi(new oe((t,n,i)=>{const a=C.get(i,ol),s=a&&n.gameState.entities.entities[a];if(!s||(s.fuelLevel??0)<=0||!s.isConstructed)return C.delete(i,ol),A.FAILURE;const l=t.id*137%360*(Math.PI/180),c=Ws*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,g={x:(s.position.x+Math.cos(l)*c+u)%u,y:(s.position.y+Math.sin(l)*c+f)%f},m=G(t.position,g,u,f);return m>10?(t.activeAction="moving",t.target=g,t.direction=ot(t.position,g,n.gameState.mapDimensions),[A.RUNNING,`Moving to personal warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[A.RUNNING,"Staying warm at personal spot"])},"Move to Warmth Spot",e+2),{taskType:"warmth",maxCapacity:qy,getTargetId:(t,n,i)=>C.get(i,ol)??null},"Tribal Warmth Task",e+1)],"Gather at Bonfire Sequence",e)}function dN(e){const t=new oe((n,i,a)=>{if(!n.leaderId||n.id!==n.leaderId)return[A.FAILURE,"Not a tribe leader"];const s=Gr(n.id,i.gameState);let l=0;for(const c of s)if(c.isConstructed&&c.fuelLevel!==void 0){const u=c.maxFuelLevel??Rr;c.fuelLevel<u*ip&&(zI(a,c.id,"wood",i.gameState.time),l++)}return[A.SUCCESS,`Tribe logistics: ${l} wood demands registered for bonfires`]},"Manage Tribe Logistics",e+1);return new Bn(t,_w,"Cached Tribe Logistics",e)}function uN(e){return new Se([new ce((t,n,i)=>{const a=be(t,n.gameState,"predator",dn*2,()=>!0),s=be(t,n.gameState,"human",dn*2,()=>!0);let l=null,c=1/0;if(a){const u=G(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<c&&(c=u,l=a)}if(s){const u=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<c&&(c=u,l=s)}return l&&c<dn*1.5?(C.set(i,"fleeThreat",l.id),C.set(i,"fleeDistance",c),!0):!1},"Detect Threat",e+1),new oe((t,n,i)=>{const a=C.get(i,"fleeThreat"),s=a&&n.gameState.entities.entities[a];if(!s)return A.FAILURE;t.activeAction="moving";const l=ze(s.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=rt(l),u=ci(t.position,Et(c,PR));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,t.fleeCooldown=n.gameState.time+2,A.RUNNING},"Execute Flee",e+1)],"Prey Flee",e)}function fN(e){return new Se([new ce((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=30||t.eatingCooldownTime&&t.eatingCooldownTime>n.gameState.time)return!1;const a=be(t,n.gameState,"berryBush",dn*10,s=>s.food.length>0);return a?G(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=dn?(C.set(i,"grazingTarget",a.id),!0):(C.set(i,"grazingTarget",a.id),C.set(i,"needToMoveToTarget",!0),!0):!1},"Find Berry Bush",e+1),new oe((t,n,i)=>{const a=C.get(i,"grazingTarget"),s=a&&n.gameState.entities.entities[a],l=C.get(i,"needToMoveToTarget");if(!s)return A.FAILURE;const c=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=dn)return t.activeAction="grazing",t.target=s.id,t.direction={x:0,y:0},C.delete(i,"needToMoveToTarget"),A.RUNNING;if(l||c>dn){t.activeAction="moving",t.target=s.id;const u=ot(t.position,s.position,n.gameState.mapDimensions);return t.direction=u,A.RUNNING}return A.FAILURE},"Move to Bush or Graze",e+1)],"Prey Graze",e)}function hN(e){const t=new ce((s,l,c)=>{const u=be(s,l.gameState,"prey",dn,f=>f.id!==s.id&&f.gender!==s.gender&&!!f.isAdult&&f.age>=Cl&&f.age<=Bh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(c,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new oe((s,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(s.activeAction="procreating",s.target=f.id,s.direction={x:0,y:0},C.delete(c,"procreationPartner"),A.SUCCESS):A.FAILURE},"Start Procreating",e+2),i=new ce((s,l,c)=>{const u=be(s,l.gameState,"prey",dn*10,f=>f.id!==s.id&&f.gender!==s.gender&&!!f.isAdult&&f.age>=Cl&&f.age<=Bh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(c,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),a=new oe((s,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return A.FAILURE;if(G(s.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=dn)return A.SUCCESS;s.activeAction="moving",s.target=f.id;const m=ze(s.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return s.direction=rt(m),A.RUNNING},"Move Towards Partner",e+2);return new Se([new ce(s=>!!(s.isAdult&&!s.isPregnant&&s.age>=Cl&&s.age<=Bh&&s.hunger<200&&(!s.procreationCooldown||s.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new Jt([new Se([t,n],"Procreate With Immediate Partner",e+2),new Se([i,a],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Prey Procreate",e)}const gN=(e,t,n)=>{const i=t.gameState.search.prey.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="prey");if(i.length===0)return A.FAILURE;let a=null,s=hu;for(const l of i)l.hunger>=s&&(s=l.hunger,a=l);return a?(C.set(n,"targetChild",a.id),A.SUCCESS):A.FAILURE},pN=(e,t,n)=>{const i=C.get(n,"targetChild"),a=i&&t.gameState.entities.entities[i];return a?G(e.position,a.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>da?(e.activeAction="moving",e.target=a.id,e.direction=ot(e.position,a.position,t.gameState.mapDimensions),A.RUNNING):(e.activeAction="feeding",e.target=void 0,C.set(n,"targetChild",void 0),A.SUCCESS):A.FAILURE};function mN(e){return new Se([new ce(t=>(t.isAdult&&t.gender==="female"&&t.hunger<80&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new oe(gN,"Find Hungriest Prey Child",e+1),new oe(pN,"Move To Child and Feed",e+1)],"Feed Prey Child",e)}function yN(e){return new Se([new ce(t=>!t.isAdult&&t.hunger>=hu,"Is Hungry Prey Child",e+1),new oe((t,n,i)=>{if(!t.motherId)return A.FAILURE;const a=n.gameState.entities.entities[t.motherId];return a?(C.set(i,"targetParent",a.id),A.SUCCESS):A.FAILURE},"Find Female Parent",e+1),new oe((t,n,i)=>{const a=C.get(i,"targetParent"),s=a&&n.gameState.entities.entities[a];if(!s)return A.FAILURE;const l=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=da?(t.target=void 0,A.SUCCESS):(t.target=s.id,t.activeAction="moving",A.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}const vd="huntTarget";function SN(e,t,n){if(!(e!=null&&e.aiBlackboard))return!0;const i=`tribal_hunt_${t}`,a=C.get(e.aiBlackboard,i);return!a||n-a.startTime>Ni?!0:a.memberIds.length<(a.maxCapacity||mp)}function vN(e,t,n,i){if(!(e!=null&&e.aiBlackboard))return;const a=`tribal_hunt_${n}`;let s=C.get(e.aiBlackboard,a);s||(s={memberIds:[],startTime:i,maxCapacity:mp},C.set(e.aiBlackboard,a,s)),s.memberIds.includes(t.id)||s.memberIds.push(t.id)}function IN(e,t){if(!(e!=null&&e.aiBlackboard))return 0;const n=`tribal_hunt_${t}`,i=C.get(e.aiBlackboard,n);return(i==null?void 0:i.memberIds.length)??0}function Od(e,t,n=new Set){if(n.has(e.id))return e;n.add(e.id);for(const i of[e.fatherId,e.pregnancyFatherId,e.motherId]){if(!i||i===e.id)continue;const a=t.entities.entities[i];if(a)return Od(a,t,n)}return e}function TN(e){return new Se([new ce((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=50||t.huntCooldown&&t.huntCooldown>0)return!1;const a=be(t,n.gameState,"prey",Rs*10,s=>{if(s.hitpoints<=0)return!1;const l=Od(t,n.gameState);return!(l&&!SN(l,s.id,n.gameState.time))});if(a){const s=G(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Od(t,n.gameState),c=l?IN(l,a.id):0;if(s<=Rs)return C.set(i,vd,a.id),[!0,`Prey in range (${c} hunters)`];if(s<=Rs*10)return C.set(i,vd,a.id),C.set(i,"needToApproach",!0),[!0,`Approaching prey (${c} hunters)`]}return!1},"Find Prey Target",e+1),new Cr(new oe((t,n,i)=>{const a=C.get(i,vd),s=a&&n.gameState.entities.entities[a],l=C.get(i,"needToApproach");if(!s||s.hitpoints<=0)return C.delete(i,vd),C.delete(i,"needToApproach"),A.SUCCESS;const c=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=Rs)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},C.delete(i,"needToApproach"),A.RUNNING;if(l||c>Rs){t.activeAction="moving",t.target=s.id;const u=ze(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(u),vN(Od(t,n.gameState),t,s.id,n.gameState.time),A.RUNNING}return A.FAILURE},"Hunt or Approach Prey",e+3),10,"Hunt Timeout (10 hour)",e+2)],"Predator Hunt",e)}function AN(e){return new Se([new ce((t,n,i)=>{const a=t.hunger>100,s=t.hitpoints<t.maxHitpoints*.5;if(!a&&!s||t.attackCooldown&&t.attackCooldown>0)return!1;const l=be(t,n.gameState,"human",li*2,c=>c.hitpoints>0);if(l){const c=G(t.position,l.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=li)return C.set(i,"attackTarget",l.id),!0;if(a&&c<=li*2)return C.set(i,"attackTarget",l.id),C.set(i,"needToApproach",!0),!0}return!1},"Find Human Target",e+1),new oe((t,n,i)=>{const a=C.get(i,"attackTarget"),s=a&&n.gameState.entities.entities[a],l=C.get(i,"needToApproach");if(!s||s.hitpoints<=0)return A.FAILURE;const c=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=li)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},C.delete(i,"needToApproach"),A.RUNNING;if(l||c>li){t.activeAction="moving",t.target=s.id;const u=ze(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(u),A.RUNNING}return A.FAILURE},"Attack or Approach Human",e+1)],"Predator Attack Human",e)}function EN(e){const t=new ce((s,l,c)=>{const u=be(s,l.gameState,"predator",Wo,f=>f.id!==s.id&&f.gender!==s.gender&&!!f.isAdult&&f.age>=_l&&f.age<=Fh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(c,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new oe((s,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(s.activeAction="procreating",s.target=f.id,s.direction={x:0,y:0},C.delete(c,"procreationPartner"),A.SUCCESS):A.FAILURE},"Start Procreating",e+2),i=new ce((s,l,c)=>{const u=be(s,l.gameState,"predator",Wo*10,f=>f.id!==s.id&&f.gender!==s.gender&&!!f.isAdult&&f.age>=_l&&f.age<=Fh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(c,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),a=new oe((s,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return A.FAILURE;if(G(s.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=Wo)return A.SUCCESS;s.activeAction="moving",s.target=f.id;const m=ze(s.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return s.direction=rt(m),A.RUNNING},"Move Towards Partner",e+2);return new Se([new ce(s=>!!(s.isAdult&&!s.isPregnant&&s.age>=_l&&s.age<=Fh&&s.hunger<200&&(!s.procreationCooldown||s.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new Jt([new Se([t,n],"Procreate With Immediate Partner",e+2),new Se([i,a],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Predator Procreate",e)}const CN=(e,t,n)=>{const i=t.gameState.search.predator.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="predator");if(i.length===0)return A.FAILURE;let a=null,s=hu;for(const l of i)l.hunger>=s&&(s=l.hunger,a=l);return a?(C.set(n,"targetChild",a.id),A.SUCCESS):A.FAILURE},_N=(e,t,n)=>{const i=C.get(n,"targetChild"),a=i&&t.gameState.entities.entities[i];return a?G(e.position,a.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>da?(e.activeAction="moving",e.target=a.id,e.direction=ot(e.position,a.position,t.gameState.mapDimensions),A.RUNNING):(e.activeAction="feeding",e.target=void 0,C.set(n,"targetChild",void 0),A.SUCCESS):A.FAILURE};function wN(e){return new Se([new ce(t=>(t.isAdult&&t.gender==="female"&&t.hunger<90&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new oe(CN,"Find Hungriest Predator Child",e+1),new oe(_N,"Move To Child and Feed",e+1)],"Feed Predator Child",e)}function RN(e){return new Se([new ce(t=>!t.isAdult&&t.hunger>=hu,"Is Hungry Predator Child",e+1),new oe((t,n,i)=>{if(!t.motherId)return A.FAILURE;const a=n.gameState.entities.entities[t.motherId];return a?(C.set(i,"targetParent",a.id),A.SUCCESS):A.FAILURE},"Find Female Parent",e+1),new oe((t,n,i)=>{const a=C.get(i,"targetParent"),s=a&&n.gameState.entities.entities[a];if(!s)return A.FAILURE;const l=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=da?(t.target=void 0,A.SUCCESS):(t.target=s.id,t.activeAction="moving",A.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}function cT(e){return new oe((t,n,i)=>{t.activeAction="idle";let a=C.get(i,"wanderTarget"),s=C.get(i,"wanderStartTime");const l=n.gameState.time;if(!a||!s||l-s>2){const c=Math.random()*2*Math.PI,u=50+Math.random()*100,f={x:Math.cos(c),y:Math.sin(c)},g=ci(t.position,Et(f,u));a={x:(g.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(g.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},C.set(i,"wanderTarget",a),C.set(i,"wanderStartTime",l)}if(a){t.target=a;let c=a.x-t.position.x,u=a.y-t.position.y;const f=n.gameState.mapDimensions.width,g=n.gameState.mapDimensions.height;Math.abs(c)>f/2&&(c=c>0?c-f:c+f),Math.abs(u)>g/2&&(u=u>0?u-g:u+g);const m=rt({x:c,y:u});t.direction=m}return A.SUCCESS},"Animal Wander",e)}function PN(e){return new Se([new ce((t,n,i)=>{if(t.hunger>90||t.hitpoints<t.maxHitpoints*.3||t.activeAction==="grazing"||t.activeAction==="procreating")return!1;const a=Object.values(n.gameState.entities.entities),s=[];for(const l of a)if(l.type==="prey"&&l.id!==t.id){const c=l;c.hitpoints>0&&c.isAdult&&G(t.position,c.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=dn*5&&s.push(c)}if(s.length>=2){let l=0,c=0;for(const g of s)l+=g.position.x,c+=g.position.y;l/=s.length,c/=s.length;const u={x:l,y:c};if(G(t.position,u,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>dn*2)return C.set(i,"herdCenter",u),C.set(i,"herdSize",s.length),!0}return!1},"Find Herd",e+1),new oe((t,n,i)=>{const a=C.get(i,"herdCenter");if(!a)return A.FAILURE;if(G(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>dn*2){t.activeAction="moving",t.target=a;const l=ze(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(l),A.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},A.SUCCESS},"Join Herd",e+1)],"Prey Herd Behavior",e)}function DN(e){return new Se([new ce((t,n,i)=>{if(t.hunger>100||t.hitpoints<t.maxHitpoints*.4||t.activeAction==="attacking"||t.activeAction==="procreating")return!1;const a=be(t,n.gameState,"predator",Wo*4,s=>s.id!==t.id&&s.hitpoints>0&&s.isAdult&&t.fatherId!==void 0&&s.fatherId===t.fatherId&&s.age>=t.age||s.hitpoints>t.hitpoints);return a&&G(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Wo*2?(C.set(i,"packLeader",a.id),!0):!1},"Find Pack Leader",e+1),new oe((t,n,i)=>{const a=C.get(i,"packLeader"),s=a&&n.gameState.entities.entities[a];if(!s||s.hitpoints<=0)return A.FAILURE;if(G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Wo*2){t.activeAction="moving",t.target=s.id;const c=ze(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(c),A.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},A.SUCCESS},"Follow Pack Leader",e+1)],"Predator Pack Behavior",e)}function NN(e){return new Se([new ce((t,n,i)=>{if(!t.isAdult||t.hitpoints<t.maxHitpoints*.6||t.hunger>120||t.attackCooldown&&t.attackCooldown>0)return!1;const a=be(t,n.gameState,"predator",iS,s=>!!(s.id!==t.id&&s.hitpoints>0&&s.isAdult&&t.fatherId!==s.fatherId&&t.gender===s.gender&&t.fatherId!==void 0&&s.fatherId!==void 0));if(a){const s=G(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=li)return C.set(i,"territorialTarget",a.id),!0;if(s<=iS)return C.set(i,"territorialTarget",a.id),C.set(i,"needToApproach",!0),!0}return!1},"Find Territorial Rival",e+1),new oe((t,n,i)=>{const a=C.get(i,"territorialTarget"),s=a&&n.gameState.entities.entities[a],l=C.get(i,"needToApproach");if(!s||s.hitpoints<=0)return A.FAILURE;const c=G(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=li)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},C.delete(i,"needToApproach"),A.RUNNING;if(l||c>li){t.activeAction="moving",t.target=s.id;const u=ze(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(u),A.RUNNING}return A.FAILURE},"Territorial Fight or Approach",e+1)],"Predator Territorial Defense",e)}const MN="tribeSplit_strategy",ON="tribeSplit_targetPosition",kN="tribeSplit_targetBuildingId",bN="tribeSplit_familyIds";function BN(e){return new Se([new ce((t,n)=>{const i=Vd(t,n.gameState);if(!i.aiBlackboard)return[!1,"Patriarch has no blackboard"];const a=yl(i.aiBlackboard);if(a!=="gathering")return[!1,`Patriarch phase: ${a}`];const s=C.get(i.aiBlackboard,bN);return!s||!s.includes(t.id)?[!1,"Not in split family"]:[!0,"Gathering for split"]},"Should Gather for Split?",e+1),new oe((t,n)=>{const i=Vd(t,n.gameState),a=C.get(i.aiBlackboard,MN);let s;if(a==="migration")s=C.get(i.aiBlackboard,ON);else if(a==="concentration"){const c=C.get(i.aiBlackboard,kN);if(c){const u=n.gameState.entities.entities[c];u&&(s=u.position)}}if(!s)return A.FAILURE;const l=G(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=VI?(t.activeAction="idle",t.target=void 0,A.SUCCESS):(t.activeAction="moving",t.target=s,[A.RUNNING,`Distance: ${l.toFixed(2)}`])},"Move to Split Gathering Point",e+1)],"Tribe Split Gather Behavior",e)}function FN(){const e=new Jt([cD(2),zD(2),new In(ZD(2),"attack","Gated Defend Against Predator",2),new In(YD(2),"attack","Gated Jealousy Attack",2),new In(jD(2),"attack","Gated Desperate Attack",2),VD(2),new ys(new Jt([new Bn(ND(5),Ms,"Cache Take Over Building",4),new Bn(kD(5),Ms,"Cache Remove Enemy Building",4)],"Building Interaction Selector",3),"Gated Leader Building Interactions",2),CD(2),new In(gD(3),"attack","Gated Attacking",2),cN(2),YP(2),QP(2),ED(2),new In(new Bn(_D(4),s_,"Cache Building Placement",3),"build","Gated Leader Building Placement",2),new ys(new Bn(OD(4),Ms,"Cache Border Post Placement",3),"Gated Border Post Placement",2),WD(2),BN(2),lD(2),new In(hD(3),"procreation","Gated Procreation",2),new Cr(new In(aN(4),"chopping","Gated Cleanup Trees",3),ws,"Timeout Cleanup Trees",2),new Cr(new In(TD(4),"planting","Gated Planting",3),ws,"Timeout Planting",2),new In(AD(3),"gathering","Gated Storage Deposit",2),new In(yD(3),"feedChildren","Gated Feed Child",2),new Cr(new In(dD(4),"gathering","Gated Gathering",3),ws,"Timeout Gathering",2),new Cr(new In(sN(4),"chopping","Gated Chopping",3),ws,"Timeout Chopping",2),SD(2),new In(qD(3),"attack","Gated Hunt Prey",2),new ys(bD(2),"Gated Follow Patriarch",2),new Cr(new ys(fD(2),"Gated Idle Wander",3),ws,"Timeout Idle Wander",2)],"AI Root Selector",1),t=new vS([new $P(new xP(QD(4),"Role Assignment Success",3),"Role Assignment Gate",2),new In(new Bn(rN(4),Ms,"Cache Role Management",3),"roleManagement","Gated Role Management",2),new ys(KD(3),"Gated Diplomacy",2),new ys(dN(2),"Gated Logistics Management",2)],"Non blocking",1),n=new vS([e,t],"AI Root Sequence",1);return new WP(n,"Manual Control Gate",0)}var He=(e=>(e[e.HumanGatherBerries=0]="HumanGatherBerries",e[e.HumanGatherMeat=1]="HumanGatherMeat",e[e.HumanEat=2]="HumanEat",e[e.HumanProcreateFemale=3]="HumanProcreateFemale",e[e.HumanProcreateMale=4]="HumanProcreateMale",e[e.HumanFeedChild=5]="HumanFeedChild",e[e.HumanPlaceStorage=6]="HumanPlaceStorage",e[e.HumanPlaceBonfire=7]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=8]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=9]="HumanPlaceBorderPost",e[e.HumanPlantBush=10]="HumanPlantBush",e[e.HumanStockpile=11]="HumanStockpile",e[e.HumanFuelBonfire=12]="HumanFuelBonfire",e[e.HumanRetrieve=13]="HumanRetrieve",e))(He||{}),_e=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(_e||{});const oo=1,LN=500,dT=.8,UN=100,HN=5,Tg="currentAiTask",GN="lastTaskResult",MS="taskHistory";function Ag({aiBlackboard:e}){return C.get(e,Tg)||null}function kd({aiBlackboard:e},t){t?C.set(e,Tg,t):C.delete(e,Tg)}function $N(e,t,n,i){const a=i[t.type];let s;if(a&&a.executor?s=a.executor(t,e,n):s=_e.Failure,C.set(e.aiBlackboard,GN,s),s!==_e.Running){const l=C.get(e.aiBlackboard,MS)||[];l.unshift({type:t.type,result:s,completedAtTick:n.gameState.time}),l.length>5&&l.pop(),C.set(e.aiBlackboard,MS,l),delete n.gameState.tasks[t.id],kd(e,null)}return s}function bi(e){return 1/(1+e/LN)}function wn(e){const{type:t,requireAdult:n,autopilotBehavior:i,producer:a,scorer:s,executor:l}=e;return{type:t,producer:a,scorer:s?(f,g,m)=>n&&!f.isAdult||i&&f.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?null:s(f,g,m):void 0,executor:l?(f,g,m)=>n&&!g.isAdult||i&&g.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?_e.Failure:l(f,g,m):void 0}}const xN=wn({type:He.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>Vs&&e.food.length>0){const i=`eat-task-${e.id}`;n[i]={id:i,type:He.HumanEat,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+oo}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/ln,executor:(e,t)=>e.target!==t.id?_e.Empty:t.hunger<Vs?_e.Success:t.food.length===0?_e.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",_e.Running)}),WN=wn({type:He.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="berryBush"||i.food.length===0||e.food.length>=e.maxFood)return null;const a=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=bi(a),l=e.hunger/ln;return(s+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return _e.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="berryBush"||i.food.length===0||t.food.length>=t.maxFood?_e.Success:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ze?(t.target=i.position,t.activeAction="moving",_e.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",_e.Running)}}),YN=wn({type:He.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="corpse"||i.food.length===0||e.food.length>=e.maxFood)return null;const a=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=bi(a),l=e.hunger/ln;return(s+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return _e.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="corpse"||i.food.length===0||t.food.length>=t.maxFood?_e.Success:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ze?(t.target=i.position,t.activeAction="moving",_e.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",_e.Running)}}),zN=wn({type:He.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=Nl&&e.age<=ru&&e.hunger<qt&&(e.procreationCooldown||0)<=0){const a=`procreate-female-task-${e.id}`;n[a]={id:a,type:He.HumanProcreateFemale,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+oo}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<Nl||e.hunger>=qt||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="female"||i.isPregnant||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const a=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return bi(a)*dT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="female"||t.hunger>=qt?_e.Failure:i.isPregnant?_e.Success:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ze?(t.target=i.position,t.activeAction="moving",t.direction=ot(t.position,i.position,n.gameState.mapDimensions),_e.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",_e.Running)}}),jN=wn({type:He.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=Nl&&e.hunger<qt&&(e.procreationCooldown||0)<=0){const a=`procreate-male-task-${e.id}`;n[a]={id:a,type:He.HumanProcreateMale,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+oo}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<Nl||e.age>ru||e.hunger>=qt||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="male"||i.hunger>=qt||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const a=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return bi(a)*dT},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="male"||i.hunger>=qt?_e.Failure:t.isPregnant?_e.Success:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ze?(t.target=i.position,t.activeAction="moving",t.direction=ot(t.position,i.position,n.gameState.mapDimensions),_e.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",_e.Running)}}),XN=wn({type:He.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=Zs){const i=`feed-child-task-${e.id}`;n[i]={id:i,type:He.HumanFeedChild,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+oo}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.isAdult||!(i.motherId===e.id||i.fatherId===e.id))return null;const s=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=bi(s),c=i.hunger/ln;return(l+c)/2},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.isAdult||t.food.length===0?_e.Failure:i.hunger<Zs/2?_e.Success:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>su?(t.target=i.position,t.activeAction="moving",t.direction=ot(t.position,i.position,n.gameState.mapDimensions),_e.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="feeding",_e.Running)}});function Iu(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const i=G(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return bi(i)}function Tu(e,t,n,i,a){const s=e.target;return G(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>a?(t.target=s,t.activeAction="moving",_e.Running):(br(s,i,t.leaderId,n.gameState),_e.Success)}const VN=wn({type:He.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:Iu,executor:(e,t,n)=>Tu(e,t,n,he.StorageSpot,Vi)}),KN=wn({type:He.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:Iu,executor:(e,t,n)=>Tu(e,t,n,he.Bonfire,Vi)}),qN=wn({type:He.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:Iu,executor:(e,t,n)=>Tu(e,t,n,he.PlantingZone,Vi)}),ZN=wn({type:He.HumanPlaceBorderPost,requireAdult:!0,autopilotBehavior:"build",scorer:Iu,executor:(e,t,n)=>Tu(e,t,n,he.BorderPost,d_)}),QN=wn({type:He.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(u=>u.type===fn.Berry).length<io)return null;const a=n.gameState.entities.entities[t.creatorEntityId];if(!a||a.type!=="building"||!a.ownerId)return null;const s=n.gameState.entities.entities[a.ownerId];if(!s||s.leaderId!==e.leaderId)return null;const l=t.target,c=G(e.position,l,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return bi(c)},executor:(e,t,n)=>{if(t.food.filter(c=>c.type===fn.Berry).length<io)return t.activeAction="idle",_e.Failure;const a=e.target;return G(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>qs?(t.target=a,t.activeAction="moving",_e.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=a),Object.values(n.gameState.entities.entities).find(c=>c.type==="berryBush"&&G(c.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<HN)?(t.activeAction="idle",_e.Success):_e.Running)}}),JN=wn({type:He.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var f;if(typeof t.target!="number")return null;const i=e.food.length>0,a=((f=e.heldItem)==null?void 0:f.type)===St.Wood;if(!i&&!a)return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==he.StorageSpot||e.leaderId!==s.ownerId||s.storedItems.length>=s.storageCapacity)return null;const l=G(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=bi(l),u=a?.6:e.food.length/e.maxFood*.4;return(c+u)/2},executor:(e,t,n)=>{var c;if(typeof e.target!="number")return _e.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==he.StorageSpot)return _e.Failure;const a=t.food.length>0,s=((c=t.heldItem)==null?void 0:c.type)===St.Wood;return!a&&!s?_e.Success:i.storedItems.length>=i.storageCapacity?_e.Failure:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ze?(t.target=i.position,t.activeAction="moving",_e.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",_e.Running)}}),eM=wn({type:He.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var c;if(typeof t.target!="number"||!(((c=e.heldItem)==null?void 0:c.type)===St.Wood))return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==he.Bonfire||e.leaderId!==a.ownerId)return null;const s=a.storageCapacity||xd;if(a.storedItems.length>=s)return null;const l=G(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return bi(l)},executor:(e,t,n)=>{var c;if(typeof e.target!="number")return _e.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==he.Bonfire)return _e.Failure;if(!(((c=t.heldItem)==null?void 0:c.type)===St.Wood))return _e.Success;const s=i.storageCapacity||xd;return i.storedItems.length>=s?_e.Failure:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ze?(t.target=i.position,t.activeAction="moving",_e.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",_e.Running)}}),tM=wn({type:He.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",producer:(e,t)=>{const n={};if(e.hunger>Vs&&e.food.length===0){const a=t.gameState.search.building.all().filter(s=>s.buildingType===he.StorageSpot&&s.isConstructed&&s.ownerId===e.leaderId&&s.storedItems.some(l=>l.item.itemType==="food"));if(a.length>0){let s=a[0],l=1/0;for(const u of a){const f=G(e.position,u.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);f<l&&(l=f,s=u)}const c=`retrieve-${e.id}-${s.id}`;n[c]={id:c,type:He.HumanRetrieve,creatorEntityId:e.id,target:s.id,validUntilTime:t.gameState.time+oo}}}return n},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="building"||i.buildingType!==he.StorageSpot||i.ownerId!==e.leaderId||!i.storedItems.some(c=>c.item.itemType==="food")||e.food.length>=e.maxFood)return null;const a=G(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=bi(a),l=e.hunger/ln;return(s+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return _e.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="building"||i.buildingType!==he.StorageSpot||!i.storedItems.some(s=>s.item.itemType==="food")?_e.Failure:t.food.length>0?_e.Success:t.food.length>=t.maxFood?_e.Failure:G(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Ze?(t.target=i.position,t.activeAction="moving",_e.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="retrieving",_e.Running)}}),Au=[xN,WN,YN,zN,jN,XN,VN,KN,qN,ZN,QN,JN,eM,tM].reduce((e,t)=>(e[t.type]=t,e),{});function nM(e,t){iM(e,t);let n=Ag(e);if(n){const i=t.gameState.tasks[n];(!i||i.claimedByEntityId&&i.claimedByEntityId!==e.id)&&(kd(e,null),n=null)}if(!n&&(n=oM(e,t),n)){kd(e,n);const i=t.gameState.tasks[n];i&&(i.claimedByEntityId=e.id)}if(n){const i=t.gameState.tasks[n];i?$N(e,i,t,Au):kd(e,null)}Ag(e)||(e.activeAction="idle")}function iM(e,t){for(const n of Object.values(Au))if(n.producer){const i=n.producer(e,t);for(const[a,s]of Object.entries(i))t.gameState.tasks[a]||(t.gameState.tasks[a]=s)}}function oM(e,t){let n=null,i=-1/0;for(const a of Object.values(t.gameState.tasks)){if(a.validUntilTime<t.gameState.time){delete t.gameState.tasks[a.id];continue}if(a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const s=Au[a.type];if(!s||!s.scorer)continue;const l=s.scorer(e,a,t);l!==null&&l>i&&(i=l,n=a.id)}return i>0?n:null}const uT=FN();function rM(e,t){const n=performance.now();switch(e.aiType){case Ut.TaskBased:nM(e,t);break;case Ut.BehaviorTreeBased:default:Sp(e,t,uT);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}function sM(){return new Jt([uN(1),mN(1),yN(1),fN(1),hN(1),PN(1),cT(1)],"Prey Behavior Root",0)}function aM(){return new Jt([TN(1),AN(1),wN(1),RN(1),NN(1),EN(1),DN(1),cT(1)],"Predator Behavior Root",0)}const fT=sM();function lM(e,t){switch(e.aiType){case Ut.TaskBased:break;case Ut.BehaviorTreeBased:default:Sp(e,t,fT);break}}const hT=aM();function cM(e,t){switch(e.aiType){case Ut.TaskBased:break;case Ut.BehaviorTreeBased:default:Sp(e,t,hT);break}}const gT=5;function dM(){return qo[he.PlantingZone].dimensions}function OS(e,t,n){const i=e.position.x+n.width/2,s=t.position.x-n.width/2-i,l=e.position.y-n.height/2,c=e.position.y+n.height/2,u=t.position.y-n.height/2,f=t.position.y+n.height/2,g=Math.min(c,f)-Math.max(l,u);return s>=-5&&s<=gT&&g>n.height*.5}function kS(e,t,n){const i=e.position.y+n.height/2,s=t.position.y-n.height/2-i,l=e.position.x-n.width/2,c=e.position.x+n.width/2,u=t.position.x-n.width/2,f=t.position.x+n.width/2,g=Math.min(c,f)-Math.max(l,u);return s>=-5&&s<=gT&&g>n.width*.5}function uM(e){var l;const t={},n=dM(),i=e;if(!((l=i.search)!=null&&l.building))return t;const s=i.search.building.all().filter(c=>c.buildingType===he.PlantingZone&&c.isConstructed);for(const c of s)t[c.id]={top:!1,bottom:!1,left:!1,right:!1};for(let c=0;c<s.length;c++){const u=s[c];for(let f=c+1;f<s.length;f++){const g=s[f];u.ownerId===g.ownerId&&(OS(u,g,n)&&(t[u.id].right=!0,t[g.id].left=!0),OS(g,u,n)&&(t[g.id].right=!0,t[u.id].left=!0),kS(u,g,n)&&(t[u.id].bottom=!0,t[g.id].top=!0),kS(g,u,n)&&(t[g.id].bottom=!0,t[u.id].top=!0))}}return t}function Ll(e){e.plantingZoneConnections=uM(e)}const fM=(e,t)=>{if(e.buildingType!==he.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,i=sI(e);if(aI(e,n)>=i)return{};const s=Object.values(n.tasks).find(g=>g.type===He.HumanPlantBush&&g.creatorEntityId===e.id);if(s)return{[s.id]:s};const l=n.mapDimensions.width,c=n.mapDimensions.height,u=n.soilDepletion,f=10;for(let g=0;g<f;g++){const m=e.position.x+(Math.random()-.5)*e.width,S=e.position.y+(Math.random()-.5)*e.height,v={x:(m%l+l)%l,y:(S%c+c)%c};if(!Mi(u,v,l,c)&&!qn(v,n,Ur)){const T=`plant-bush-${e.id}-${n.time}`,I={id:T,type:He.HumanPlantBush,creatorEntityId:e.id,target:v,validUntilTime:n.time+UN};return{[T]:I}}}return{}},hM=(e,t)=>{const n={};if(e.buildingType===he.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const i=`stockpile-${e.id}`;n[i]={id:i,type:He.HumanStockpile,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+oo}}return n},gM=(e,t)=>{const n={};if(e.buildingType===he.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*ip){const i=`fuel-bonfire-${e.id}`;n[i]={id:i,type:He.HumanFuelBonfire,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+oo}}return n},pM={[He.HumanPlantBush]:{type:He.HumanPlantBush,producer:fM},[He.HumanStockpile]:{type:He.HumanStockpile,producer:hM},[He.HumanFuelBonfire]:{type:He.HumanFuelBonfire,producer:gM}};function pT(e,t){for(const n of Object.values(pM))if(n&&n.producer){const i=n.producer(e,t);Object.assign(t.gameState.tasks,i)}}function mM(e,t){const{gameState:n,deltaTime:i}=t,a=i*(At/Rt);if(e.isBeingDestroyed){const s=Z_(e.buildingType);if(s>0?e.destructionProgress+=a/s:e.destructionProgress=1,e.destructionProgress>=1){const l=e.buildingType===he.PlantingZone;zr(n.entities,e.id),l&&Ll(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const s=q_(e.buildingType);s>0?e.constructionProgress+=a/s:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&iI(e.position,js,e.ownerId,n),e.buildingType===he.PlantingZone&&Ll(n))}if(e.buildingType===he.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=a*Aw,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*Ew)){const s=e.storedItems.findIndex(l=>l.item.itemType==="item"&&l.item.type===St.Wood);s!==-1&&(e.storedItems.splice(s,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+Kv))}pT(e,t)}function yM(e,t){const n=t.deltaTime*At/Rt;if(e.age+=n,!e.stateMachine)return;const[i]=e.stateMachine;i!==An&&i!==no&&i!==Hr&&(e.age>=Ko&&!e.woodGenerated&&(e.wood=Array.from({length:gu},()=>({itemType:"item",type:St.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=zl*Math.min(1,Math.max(.4,e.age/Ko)))}const SM={type:He.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.food.length>0){const i=`gather-berries-${e.id}`;n[i]={id:i,type:He.HumanGatherBerries,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+oo}}return n}},vM=[SM].reduce((e,t)=>(e[t.type]=t,e),{});function IM(e,t){for(const n of Object.values(vM))if(n.producer){const i=n.producer(e,t);for(const[a,s]of Object.entries(i))t.gameState.tasks[a]||(t.gameState.tasks[a]=s)}}const TM={type:He.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const i=`gather-meat-${e.id}`;n[i]={id:i,type:He.HumanGatherMeat,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+oo}}return n}},AM=[TM].reduce((e,t)=>(e[t.type]=t,e),{});function EM(e,t){for(const n of Object.values(AM))if(n.producer){const i=n.producer(e,t);for(const[a,s]of Object.entries(i))t.gameState.tasks[a]||(t.gameState.tasks[a]=s)}}function CM(e,t){e.forces.push(Et(e.velocity,-.1));const n=Et(rt(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(i=>{t.gameState.time-i.startTime<i.duration&&i.type==="slow"&&(e.velocity=Et(e.velocity,.5))}),e.debuffs=e.debuffs.filter(i=>t.gameState.time-i.startTime<i.duration),e.velocity=ci(e.velocity,e.forces.reduce(ci,{x:0,y:0})),Ks(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=ci(e.position,Et(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&Ks(e.velocity)>.1&&$w(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?NP(e,t,t.deltaTime):e.type==="corpse"?(MP(e,t),EM(e,t)):e.type==="prey"?OP(e,t,t.deltaTime):e.type==="predator"?kP(e,t,t.deltaTime):e.type==="building"?(mM(e,t),pT(e,t)):e.type==="tree"?yM(e,t):e.type==="berryBush"&&IM(e,t),e.type==="human"&&rM(e,t),e.type==="prey"?lM(e,t):e.type==="predator"&&cM(e,t),e.stateMachine&&(e.stateMachine=I1(...e.stateMachine,{entity:e,updateContext:t}))}function _M(e){const t=e.gameState.entities;Object.values(t.entities).forEach(n=>{CM(n,e)})}function mT(){return{entities:{},nextEntityId:1}}function Yr(e,t,n){const i={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],...n};return e.entities[i.id]=i,i}function Vl(e,t,n){return Yr(e,"berryBush",{position:t,radius:hg,food:Array.from({length:iw},()=>({itemType:"food",type:fn.Berry})).map(a=>({...a,id:e.nextEntityId++})),maxFood:nw,lifespan:rw,age:0,spreadRadius:hg,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,stateMachine:[vl,{enteredAt:n,previousState:void 0}]})}function Ul(e,t,n,i=0){const a=i>=Ko;return Yr(e,"tree",{position:t,radius:zl,age:i,lifespan:t1,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:d1,stateMachine:[Kn,{enteredAt:n,previousState:void 0}],wood:a?Array.from({length:gu},()=>({itemType:"item",type:St.Wood,id:e.nextEntityId++})):[],woodGenerated:a})}function Us(e,t,n,i,a=!1,s=y_,l=Lv,c,u,f=[],g,m,S=Ut.BehaviorTreeBased){const v=s>=Yg;return Yr(e,"human",{position:t,radius:v?Ct:ua,hunger:l,hitpoints:Wy,maxHitpoints:Wy,age:s,gender:i,isPlayer:a,food:[],maxFood:Fv,maxAge:Dl,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:c,fatherId:u,ancestorIds:f,stateMachine:[pt,{enteredAt:n,previousState:void 0}],leaderId:g,tribeInfo:m,aiType:S,aiBlackboard:C.create()})}function Cp(e,t,n,i,a,s,l,c,u,f,g){let m,S;switch(l){case"human":m=Uv,S=qt;break;case"prey":m=2,S=120;break;case"predator":m=4,S=140;break}return Yr(e,"corpse",{position:t,radius:a,gender:n,age:i,originalEntityId:s,originalEntityType:l,timeOfDeath:c,decayProgress:0,geneCode:g,food:[...Array.from({length:Math.max(m*Math.max(S-f,0)/S,0)},()=>({itemType:"food",type:fn.Meat})),...u].map(T=>({...T,id:e.nextEntityId++})),stateMachine:void 0})}function wM(e,t,n,i,a,s,l,c,u){return Cp(e,t,n,i,a,s,"human",l,c,u)}function RM(e,t,n,i,a,s,l,c){return Cp(e,t,n,i,a,s,"prey",l,[],0,c)}function PM(e,t,n,i,a,s,l,c){return Cp(e,t,n,i,a,s,"predator",l,[],0,c)}function DM(e,t,n){const i=t?n.gameState.entities.entities[t]:void 0,a=[...e.ancestorIds||[],e.id],s=i?[...i.ancestorIds||[],i.id]:[],l=[...a,...s],c=[...new Set(l)],u=c.slice(Math.max(c.length-Bv,0)),f=Math.random()<.5?"male":"female",g=ci(e.position,{x:5,y:5}),m=Us(n.gameState.entities,g,n.gameState.time,f,!1,0,Lv/2,e.id,t,u,(i==null?void 0:i.leaderId)??e.leaderId,(i==null?void 0:i.tribeInfo)??e.tribeInfo,e.aiType);return Ne(n,Ae.Birth,e.position),m}function zr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function ea(e,t,n,i=RR,a=yI,s,l,c,u=Ut.BehaviorTreeBased){const f=i>=Cl,g=Date.now();return Yr(e,"prey",{position:t,radius:f?Ct*.7:ua*.7,hunger:a,hitpoints:tS,maxHitpoints:tS,age:i,maxAge:mI,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:s,motherId:l,fatherId:c,stateMachine:[ai,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:C.create()})}function ta(e,t,n,i=BR,a=vI,s,l,c,u=Ut.BehaviorTreeBased){const f=i>=_l,g=Date.now();return Yr(e,"predator",{position:t,radius:f?Ct*.9:ua*.9,hunger:a,hitpoints:nS,maxHitpoints:nS,age:i,maxAge:SI,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:s,motherId:l,fatherId:c,stateMachine:[an,{enteredAt:g,previousState:void 0}],aiType:u,aiBlackboard:C.create()})}function NM(e,t,n,i){const a=Jg(n),s={position:t,radius:Math.max(a.width,a.height)/2,buildingType:n,ownerId:i,width:a.width,height:a.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:JP,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===he.Bonfire?Rr:void 0,maxFuelLevel:n===he.Bonfire?Rr:void 0};return Yr(e,"building",s)}function Hl(e,t,n,i,a,s){if(n===void 0||a&&s!==void 0&&G(a,e,i.mapDimensions.width,i.mapDimensions.height)>s)return!1;const l=Jg(t),c=Math.sqrt(l.width*l.width+l.height*l.height)/2;if(qn(e,i,c*.8))return!1;if(t===he.PlantingZone){const{depletedSectors:v}=fI(i.soilDepletion,e,l.width,l.height,i.mapDimensions.width,i.mapDimensions.height);if(v.length>0)return!1}const f=i.search.building.byRadius(e,c*2);for(const v of f){const T=G(e,v.position,i.mapDimensions.width,i.mapDimensions.height),I=(Math.max(l.width,l.height)+Math.max(v.width,v.height))/2;if(T<I*.9)return!1}const g=t===he.BorderPost;return!!tI(e,n,i,g?Qg:js,g,n).canPlace}function MM(e){const t=[],n=2*Math.PI/e;for(let i=0;i<e;i++){const a=i*n;t.push({cos:Math.cos(a),sin:Math.sin(a)})}return t}function Ys(e,t,n,i,a,s){const l=performance.now(),c={totalTimeMs:0,anchorsSearched:0,candidatesTested:0,canPlaceChecks:0,tribeDistanceChecks:0},u=n,f=Jg(e),g=n.mapDimensions.width,m=n.mapDimensions.height,S=u.search.building.byProperty("ownerId",t),v=[];if(S.length>0){s&&v.unshift(s);const R=Xo(t,n),w=[...S].sort((B,O)=>{const D=G(B.position,R,g,m),M=G(O.position,R,g,m);return D-M});v.push(...w.map(B=>B.position))}else v.push(Xo(t,n));const T=Math.min(v.length,l_),I=Math.max(f.width,f.height),_=I+20,N=I/2;for(let R=0;R<T;R++){const w=v[R];c.anchorsSearched++;for(let B=_;B<=i;B+=N){const O=Math.max(8,Math.min(c_,Math.ceil(2*Math.PI*B/I))),D=MM(O);for(let M=0;M<O;M++){c.candidatesTested++;const F=D[M].cos*B,x=D[M].sin*B,q=w.x+F,ee=w.y+x,z=(q%g+g)%g,ne=(ee%m+m)%m;if(c.tribeDistanceChecks++,!DD({x:z,y:ne},t,a,n)&&(c.canPlaceChecks++,Hl({x:z,y:ne},e,t,n)))return c.totalTimeMs=performance.now()-l,c.totalTimeMs>$y&&console.log(`[BuildingPlacement] Slow search for ${e}: ${c.totalTimeMs.toFixed(2)}ms | anchors=${c.anchorsSearched}, candidates=${c.candidatesTested}, canPlace=${c.canPlaceChecks}, tribeDist=${c.tribeDistanceChecks}`),{x:z,y:ne}}}}c.totalTimeMs=performance.now()-l,c.totalTimeMs>$y&&console.log(`[BuildingPlacement] Slow search (no valid location) for ${e}: ${c.totalTimeMs.toFixed(2)}ms | anchors=${c.anchorsSearched}, candidates=${c.candidatesTested}, canPlace=${c.canPlaceChecks}, tribeDist=${c.tribeDistanceChecks}`)}function br(e,t,n,i){if(t===he.BorderPost)return oI(e,Qg,n,i),Ge(i,Te.BorderClaim,e,Ve,n),null;const a=NM(i.entities,e,t,n);return t===he.Bonfire&&(a.storageCapacity=xd,a.storedItems=[]),iI(e,js,n,i),t===he.PlantingZone&&Ll(i),a}function Eg(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===he.PlantingZone&&Ll(t))}function OM(e,t){const a=t.search.building.byRadius(e,100);for(const s of a){let l=e.x-s.position.x,c=e.y-s.position.y;const u=t.mapDimensions.width,f=t.mapDimensions.height;if(Math.abs(l)>u/2&&(l-=Math.sign(l)*u),Math.abs(c)>f/2&&(c-=Math.sign(c)*f),Math.abs(l)<=s.width/2&&Math.abs(c)<=s.height/2)return s}}function bS(e,t,n){return t.search.human.byRadius(e.position,n).filter(s=>{var c;return!(s.id===e.id||s.gender===e.gender||!s.isAdult||s.hunger>=qt||(s.procreationCooldown||0)>0||s.gender==="female"&&s.isPregnant||(e.motherId===s.id||e.fatherId===s.id)&&((c=s.partnerIds)!=null&&c.length))}).sort((s,l)=>{const c=s.id===e.motherId||s.id===e.fatherId,u=e.id===s.motherId||e.id===s.fatherId,f=l.id===e.motherId||l.id===e.fatherId,g=e.id===l.motherId||e.id===l.fatherId;return c||u?1:f||g?-1:s.age-l.age})}function $r(e){if(e.length===0)return;const t=e.filter(a=>a.gender==="male"),n=e.filter(a=>a.gender==="female"),i=(a,s)=>a.age!==s.age?s.age-a.age:a.id-s.id;if(t.sort(i),t.length>0)return t[0];if(n.sort(i),n.length>0)return n[0]}function En(e,t){const n=e,i=n.search.human.byProperty("motherId",t.id),a=n.search.human.byProperty("fatherId",t.id);return[...i,...a]}function kM(e,t,n){var a;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||e.motherId&&e.motherId===t.motherId||e.fatherId&&e.fatherId===t.fatherId||(a=e.partnerIds)!=null&&a.includes(t.id))return!0;if(e.motherId){const s=n.entities.entities[e.motherId];if(s&&(s.motherId===t.id||s.fatherId===t.id))return!0}if(e.fatherId){const s=n.entities.entities[e.fatherId];if(s&&(s.motherId===t.id||s.fatherId===t.id))return!0}if(t.motherId){const s=n.entities.entities[t.motherId];if(s&&(s.motherId===e.id||s.fatherId===e.id))return!0}if(t.fatherId){const s=n.entities.entities[t.fatherId];if(s&&(s.motherId===e.id||s.fatherId===e.id))return!0}return!1}function Cg(e,t){var s,l,c,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(s=e.partnerIds)!=null&&s.includes(t.id)||(l=t.partnerIds)!=null&&l.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,i=t.motherId===e.motherId||t.fatherId===e.fatherId,a=((c=e.ancestorIds)==null?void 0:c.some(f=>t.ancestorIds.includes(f)))||((u=t.ancestorIds)==null?void 0:u.some(f=>e.ancestorIds.includes(f)));return n||i||a}function bM(e,t){const n=[];if(e.motherId){const i=t.entities.entities[e.motherId];i&&n.push(i)}if(e.fatherId){const i=t.entities.entities[e.fatherId];i&&n.push(i)}return n}function yT(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const i=t.entities.entities[n];if(i&&i.gender==="male")return i}return null}function BM(e,t){var n;if(!e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human")return i}if(e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human"&&((n=$r(En(t,i)))==null?void 0:n.id)===e.id)return i}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?yT(e,t):null}function Vd(e,t){let n=e;const i=new Set;i.add(n.id);for(let a=0;a<Bv;a++){let s=null;if(n.gender==="female"&&(s=yT(n,t)),!s&&n.fatherId&&(s=t.entities.entities[n.fatherId]||null),!s||i.has(s.id))break;n=s,i.add(n.id)}return n}function Gl(e,t){var i;const n=new Set;if(e.motherId){const a=t.entities.entities[e.motherId];a&&n.add(a)}if(e.fatherId){const a=t.entities.entities[e.fatherId];a&&n.add(a)}return(i=e.partnerIds)==null||i.forEach(a=>{const s=t.entities.entities[a];s&&n.add(s)}),En(t,e).forEach(a=>n.add(a)),Array.from(n)}function Kd(e,t){const n=new Map;function i(a){const s=En(t,a);for(const l of s)n.has(l.id)||(n.set(l.id,l),i(l))}return i(e),Array.from(n.values())}function ki(e,t){return t.search.human.byProperty("leaderId",e)}function qd(e,t,n=new Map,i=new Set){var s;if(n.has(e))return n.get(e);if(i.has(e))return e;i.add(e);const a=t.entities.entities[e];if(!a)return e;if(a.gender==="female"&&((s=a.partnerIds)!=null&&s.length)){const l=a.partnerIds.find(c=>{const u=t.entities.entities[c];return u&&u.gender==="male"});if(l){const c=qd(l,t,n,i);return n.set(e,c),c}}if(a.fatherId&&t.entities.entities[a.fatherId]){const l=qd(a.fatherId,t,n,i);return n.set(e,l),l}return n.set(e,e),e}function FM(e,t){e.leaderId=e.id,e.tribeRole=J.Leader,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{roleWeights:{[J.Leader]:0,[J.Gatherer]:2,[J.Planter]:2,[J.Hunter]:2,[J.Mover]:2,[J.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}}),e.tribeInfo||(e.tribeInfo={tribeBadge:Xd(),tribeColor:Fn[Math.floor(Math.random()*Fn.length)]}),e.tribeControl||(e.tribeControl={roleWeights:{[J.Leader]:0,[J.Gatherer]:2,[J.Planter]:2,[J.Hunter]:2,[J.Mover]:2,[J.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}})}function LM(e,t){if(e.length===0)return null;const n=new Map,i=new Map;for(const l of e){const c=qd(l.id,t,n);i.has(c)||i.set(c,[]),i.get(c).push(l)}let a=null,s=0;for(const[l,c]of i.entries())c.length>s&&(s=c.length,a=l);return a&&t.entities.entities[a]||null}function Eu(e,t){var l,c,u;const n=new Map,i=Object.values(e.entities.entities).filter(f=>f.type==="human");for(const f of i)f.leaderId&&(n.has(f.leaderId)||n.set(f.leaderId,{leaderId:f.leaderId,tribeInfo:f.tribeInfo,members:[]}),(l=n.get(f.leaderId))==null||l.members.push(f));const a=t?(u=(c=e.entities.entities[t])==null?void 0:c.tribeControl)==null?void 0:u.diplomacy:void 0,s=Array.from(n.values()).map(f=>{var v,T;const g=e.entities.entities[f.leaderId],m=f.members.filter(I=>I.isAdult).length,S=f.members.length-m;return{leaderId:f.leaderId,tribeBadge:((v=f==null?void 0:f.tribeInfo)==null?void 0:v.tribeBadge)||"",tribeColor:((T=f==null?void 0:f.tribeInfo)==null?void 0:T.tribeColor)||"",adultCount:m,childCount:S,isPlayerTribe:f.leaderId===t,leaderAge:(g==null?void 0:g.age)??0,leaderGender:(g==null?void 0:g.gender)??"male",diplomacyStatus:(a==null?void 0:a[f.leaderId??-1])??Ft.Friendly}});return s.sort((f,g)=>f.isPlayerTribe?-1:g.isPlayerTribe?1:g.adultCount+g.childCount-(f.adultCount+f.childCount)),s}function Cn(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function ST(e){var s;const t=new Set,i=e.search.human.all(),a=new Map;for(const l of i)l.leaderId&&(a.has(l.leaderId)||a.set(l.leaderId,[]),(s=a.get(l.leaderId))==null||s.push(l));for(const[l,c]of a){if(c.length===0)continue;const u=e.entities.entities[l],f=!u,g=u&&u.leaderId!==l;(f||g)&&t.add(l)}for(let l=0;l<e.terrainOwnership.length;l++){const c=e.terrainOwnership[l];c!==null&&!a.has(c)&&t.add(c)}return Array.from(t)}function UM(e,t){const n=new Map,a=t.search.human.all(),s=Gl(e,t);for(const c of s)n.set(c,3);for(const c of a)c.id===e.id||n.has(c)||Cg(e,c)&&n.set(c,2);const l=Array.from(n.keys());for(const c of l)if(c.partnerIds)for(const u of c.partnerIds){const f=t.entities.entities[u];f&&!n.has(f)&&f.id!==e.id&&n.set(f,1)}return n}function HM(e,t){const n=ki(e,t);if(n.length===0)return null;const i=t.entities.entities[e];if(i&&i.leaderId&&i.leaderId!==i.id)return i.leaderId;const a=new Map;for(const c of n){const u=UM(c,t);for(const[f,g]of u)if(f.leaderId&&f.leaderId!==e){const m=f.leaderId,S=t.entities.entities[m];if(S&&S.leaderId===S.id){const v=a.get(m)||0;a.set(m,v+g)}}}let s=null,l=0;for(const[c,u]of a)u>l&&(l=u,s=c);return s}function BS(e,t,n){var g,m;const i=ki(e,n);let a=n.entities.entities[t];if(!a||(a.leaderId&&n.entities.entities[a.leaderId]&&(t=a.leaderId,a=n.entities.entities[t]),!a))return;const s=i.length>0?(g=i[0].tribeInfo)==null?void 0:g.tribeBadge:"?",l=a.leaderId===e||!a.leaderId;if(l){const S=n.entities.entities[e];FM(a,S)}const c=((m=a.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const S of i)S.id!==t&&(S.leaderId=t,S.tribeInfo=a.tribeInfo,S.tribeRole=void 0);const f=n.search.building.byProperty("ownerId",e);for(const S of f)S.ownerId=t;Wd(n,e,t),Ml(n,{identifier:`tribe-merge-${e}`,type:Lr.TribeMerged,message:l?`Tribe ${s} has a new leader!`:`Tribe ${s} has merged into Tribe ${c}!`,duration:Gd,targetEntityIds:[t],highlightedEntityIds:[t,...i.map(S=>S.id)]})}function GM(e){var n;const t=ST(e);for(const i of t){const a=ki(i,e);if(a.length===0){const u=e.search.building.byProperty("ownerId",i);for(const f of u)Eg(f.id,e);Wd(e,i,null),Ml(e,{identifier:`tribe-dissolved-${i}`,type:Lr.TribeMerged,message:"An extinct tribe has been dissolved.",duration:Gd});continue}const s=LM(a,e);if(s){BS(i,s.id,e);continue}const l=HM(i,e);if(l)BS(i,l,e);else{const c=a.length>0?(n=a[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const g of a)g.leaderId=void 0,g.tribeInfo=void 0,g.tribeRole=void 0;const f=e.search.building.byProperty("ownerId",i);for(const g of f)Eg(g.id,e);Wd(e,i,null),Ml(e,{identifier:`tribe-dissolved-${i}`,type:Lr.TribeMerged,message:`Tribe ${c} has been dissolved due to lack of leadership.`,duration:Gd})}}}function $M(e,t,n){const i=Gl(e,t),a=t;for(const s of i){if(G(e.position,s.position,t.mapDimensions.width,t.mapDimensions.height)>n)continue;const c=a.search.human.byProperty("attackTargetId",s.id);for(const u of c)if(u.leaderId!==e.leaderId&&G(e.position,u.position,t.mapDimensions.width,t.mapDimensions.height)<=n)return{familyMember:s,aggressor:u}}}function xM(e,t){const i=t.search.human.byRadius(e.position,VC);let a,s=1/0;for(const l of i){if(l.id===e.id||l.hitpoints<=0||l.hitpoints/l.maxHitpoints>XC||kM(e,l,t)||e.leaderId===l.leaderId&&e.leaderId)continue;const c=G(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);c<s&&(s=c,a=l)}return a}function WM(e,t,n){return t.search.human.byRadius(e.position,n).filter(a=>la(e,a,t))}function YM(e,t,n){const i=n.search.human.byProperty("leaderId",e);let a=0;for(const s of i)s.attackTargetId===t&&a++;return a}function FS(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let i=n.hitpoints;return i+=(n.maxAge-n.age)*.5,i+=n.food.length*2,t+i},0)}function _p(e,t){var s;const n=[];if(t.food.length>0&&t.hunger>zo&&n.push({type:de.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const l=be(t,e,"berryBush",Ze,f=>f.food.length>0),c=be(t,e,"corpse",Ze,f=>f.food.length>0);let u=null;l&&c?u=G(t.position,l.position,e.mapDimensions.width,e.mapDimensions.height)<=G(t.position,c.position,e.mapDimensions.width,e.mapDimensions.height)?l:c:u=l||c,u&&n.push({type:de.Gather,action:"gathering",key:"e",targetEntity:u})}const i=be(t,e,"human",Ze,l=>xr(t,l,e));if(i&&n.push({type:de.Procreate,action:"procreating",key:"r",targetEntity:i}),t.food.length>0&&t.isAdult){const l=be(t,e,"human",Ze,c=>{const u=c;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=zo});l&&n.push({type:de.FeedChild,action:"feeding",key:"h",targetEntity:l})}const a=be(t,e,"human",Tn,l=>la(t,l,e))??be(t,e,"predator",Tn)??be(t,e,"prey",Tn);if(a&&n.push({type:de.Attack,action:"attacking",key:"q",targetEntity:a}),t.food.filter(l=>l.type===fn.Berry).length>=io&&n.push({type:de.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const l=be(t,e,"building",un,c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});l&&n.push({type:de.Deposit,action:"idle",key:"x",targetEntity:l})}if(t.food.length<t.maxFood&&t.isAdult){const l=be(t,e,"building",un,c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});l&&n.push({type:de.Retrieve,action:"idle",key:"z",targetEntity:l})}if(((s=t.heldItem)==null?void 0:s.type)===St.Wood){const l=be(t,e,"building",un,c=>{const u=c;return u.buildingType===he.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});l&&n.push({type:de.Deposit,action:"depositing",key:"x",targetEntity:l})}if(sT(t,e).canSplit&&n.push({type:de.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const l=be(t,e,"tree",ou,c=>c.wood&&c.wood.length>0);l&&n.push({type:de.Chop,action:"chopping",key:"c",targetEntity:l})}return n}function Cu(e){const t=Object.values(e.entities.entities),n=[],i=[],a=[],s=[],l=[],c=[],u=[];for(const m of t)switch(m.type){case"human":n.push(m);break;case"berryBush":i.push(m);break;case"corpse":a.push(m);break;case"prey":s.push(m);break;case"predator":l.push(m);break;case"building":c.push(m);break;case"tree":u.push(m);break}const f=e.mapDimensions;return{...e,search:{human:wo(n,f),berryBush:wo(i,f),corpse:wo(a,f),prey:wo(s,f),predator:wo(l,f),building:wo(c,f),tree:wo(u,f),terrainOwnership:wo(e.terrainOwnership.map((m,S)=>m===null?null:{position:Rw(S,e.mapDimensions.width),width:we,height:we,ownerId:m}).filter(m=>m!==null),f)}}}var Ar=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(Ar||{});class zM{constructor(){Pe(this,"worker",null);Pe(this,"pendingRequests",new Map);Pe(this,"requestQueue",[]);Pe(this,"isProcessing",!1);Pe(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case Ar.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case Ar.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case Ar.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,i)=>{if(!this.worker){i(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:i});try{this.worker.postMessage(t)}catch(a){this.pendingRequests.delete(t.id),i(a)}})}queueOperation(t){return new Promise((n,i)=>{this.requestQueue.push(async()=>{try{const a=await t();n(a)}catch(a){i(a)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),i=t,a={type:Ar.SAVE_REQUEST,id:n,gameState:i};await this.sendMessage(a)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Ar.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:Ar.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const wp=new zM;async function Rp(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,roleManagerOpen:e.roleManagerOpen,armyControlOpen:e.armyControlOpen,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks};await wp.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function jM(){try{const e=await wp.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=Cu(t);return Ll(n),n}catch(e){return console.error("Failed to load game:",e),await vT(),null}}async function vT(){try{await wp.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const IT=Be.createContext(void 0),XM=({initialAppState:e,children:t})=>{const[n,i]=Be.useState(e),[a,s]=Be.useState(void 0),[l,c]=Be.useState(null),[u,f]=Be.useState(!1);Be.useEffect(()=>{jM().then(T=>{T&&c(T),f(!0)})},[]);const g=(T,I)=>{i(T),T==="gameOver"&&I?s(I):T!=="gameOver"&&s(void 0)},m=()=>{i("intro"),s(void 0),v()},S=T=>{Rp(T),c(T)},v=()=>{vT(),c(null)};return Le.jsx(IT.Provider,{value:{appState:n,setAppState:g,returnToIntro:m,gameOverDetails:a,contextReady:u,savedGameState:l,setSavedGameState:c,saveCurrentGame:S,clearCurrentSave:v},children:t})},jr=()=>{const e=Be.useContext(IT);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var Zt=function(){return Zt=Object.assign||function(t){for(var n,i=1,a=arguments.length;i<a;i++){n=arguments[i];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(t[s]=n[s])}return t},Zt.apply(this,arguments)};function $l(e,t,n){if(n||arguments.length===2)for(var i=0,a=t.length,s;i<a;i++)(s||!(i in t))&&(s||(s=Array.prototype.slice.call(t,0,i)),s[i]=t[i]);return e.concat(s||Array.prototype.slice.call(t))}var dt="-ms-",Rl="-moz-",Qe="-webkit-",TT="comm",_u="rule",Pp="decl",VM="@import",AT="@keyframes",KM="@layer",ET=Math.abs,Dp=String.fromCharCode,_g=Object.assign;function qM(e,t){return Bt(e,0)^45?(((t<<2^Bt(e,0))<<2^Bt(e,1))<<2^Bt(e,2))<<2^Bt(e,3):0}function CT(e){return e.trim()}function ji(e,t){return(e=t.exec(e))?e[0]:e}function xe(e,t,n){return e.replace(t,n)}function bd(e,t,n){return e.indexOf(t,n)}function Bt(e,t){return e.charCodeAt(t)|0}function na(e,t,n){return e.slice(t,n)}function Pi(e){return e.length}function _T(e){return e.length}function Sl(e,t){return t.push(e),e}function ZM(e,t){return e.map(t).join("")}function LS(e,t){return e.filter(function(n){return!ji(n,t)})}var wu=1,ia=1,wT=0,Zn=0,wt=0,ha="";function Ru(e,t,n,i,a,s,l,c){return{value:e,root:t,parent:n,type:i,props:a,children:s,line:wu,column:ia,length:l,return:"",siblings:c}}function bo(e,t){return _g(Ru("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function As(e){for(;e.root;)e=bo(e.root,{children:[e]});Sl(e,e.siblings)}function QM(){return wt}function JM(){return wt=Zn>0?Bt(ha,--Zn):0,ia--,wt===10&&(ia=1,wu--),wt}function ui(){return wt=Zn<wT?Bt(ha,Zn++):0,ia++,wt===10&&(ia=1,wu++),wt}function Br(){return Bt(ha,Zn)}function Bd(){return Zn}function Pu(e,t){return na(ha,e,t)}function wg(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function eO(e){return wu=ia=1,wT=Pi(ha=e),Zn=0,[]}function tO(e){return ha="",e}function qh(e){return CT(Pu(Zn-1,Rg(e===91?e+2:e===40?e+1:e)))}function nO(e){for(;(wt=Br())&&wt<33;)ui();return wg(e)>2||wg(wt)>3?"":" "}function iO(e,t){for(;--t&&ui()&&!(wt<48||wt>102||wt>57&&wt<65||wt>70&&wt<97););return Pu(e,Bd()+(t<6&&Br()==32&&ui()==32))}function Rg(e){for(;ui();)switch(wt){case e:return Zn;case 34:case 39:e!==34&&e!==39&&Rg(wt);break;case 40:e===41&&Rg(e);break;case 92:ui();break}return Zn}function oO(e,t){for(;ui()&&e+wt!==57;)if(e+wt===84&&Br()===47)break;return"/*"+Pu(t,Zn-1)+"*"+Dp(e===47?e:ui())}function rO(e){for(;!wg(Br());)ui();return Pu(e,Zn)}function sO(e){return tO(Fd("",null,null,null,[""],e=eO(e),0,[0],e))}function Fd(e,t,n,i,a,s,l,c,u){for(var f=0,g=0,m=l,S=0,v=0,T=0,I=1,_=1,N=1,R=0,w="",B=a,O=s,D=i,M=w;_;)switch(T=R,R=ui()){case 40:if(T!=108&&Bt(M,m-1)==58){bd(M+=xe(qh(R),"&","&\f"),"&\f",ET(f?c[f-1]:0))!=-1&&(N=-1);break}case 34:case 39:case 91:M+=qh(R);break;case 9:case 10:case 13:case 32:M+=nO(T);break;case 92:M+=iO(Bd()-1,7);continue;case 47:switch(Br()){case 42:case 47:Sl(aO(oO(ui(),Bd()),t,n,u),u);break;default:M+="/"}break;case 123*I:c[f++]=Pi(M)*N;case 125*I:case 59:case 0:switch(R){case 0:case 125:_=0;case 59+g:N==-1&&(M=xe(M,/\f/g,"")),v>0&&Pi(M)-m&&Sl(v>32?HS(M+";",i,n,m-1,u):HS(xe(M," ","")+";",i,n,m-2,u),u);break;case 59:M+=";";default:if(Sl(D=US(M,t,n,f,g,a,c,w,B=[],O=[],m,s),s),R===123)if(g===0)Fd(M,t,D,D,B,s,m,c,O);else switch(S===99&&Bt(M,3)===110?100:S){case 100:case 108:case 109:case 115:Fd(e,D,D,i&&Sl(US(e,D,D,0,0,a,c,w,a,B=[],m,O),O),a,O,m,c,i?B:O);break;default:Fd(M,D,D,D,[""],O,0,c,O)}}f=g=v=0,I=N=1,w=M="",m=l;break;case 58:m=1+Pi(M),v=T;default:if(I<1){if(R==123)--I;else if(R==125&&I++==0&&JM()==125)continue}switch(M+=Dp(R),R*I){case 38:N=g>0?1:(M+="\f",-1);break;case 44:c[f++]=(Pi(M)-1)*N,N=1;break;case 64:Br()===45&&(M+=qh(ui())),S=Br(),g=m=Pi(w=M+=rO(Bd())),R++;break;case 45:T===45&&Pi(M)==2&&(I=0)}}return s}function US(e,t,n,i,a,s,l,c,u,f,g,m){for(var S=a-1,v=a===0?s:[""],T=_T(v),I=0,_=0,N=0;I<i;++I)for(var R=0,w=na(e,S+1,S=ET(_=l[I])),B=e;R<T;++R)(B=CT(_>0?v[R]+" "+w:xe(w,/&\f/g,v[R])))&&(u[N++]=B);return Ru(e,t,n,a===0?_u:c,u,f,g,m)}function aO(e,t,n,i){return Ru(e,t,n,TT,Dp(QM()),na(e,2,-2),0,i)}function HS(e,t,n,i,a){return Ru(e,t,n,Pp,na(e,0,i),na(e,i+1,-1),i,a)}function RT(e,t,n){switch(qM(e,t)){case 5103:return Qe+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Qe+e+e;case 4789:return Rl+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Qe+e+Rl+e+dt+e+e;case 5936:switch(Bt(e,t+11)){case 114:return Qe+e+dt+xe(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Qe+e+dt+xe(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Qe+e+dt+xe(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Qe+e+dt+e+e;case 6165:return Qe+e+dt+"flex-"+e+e;case 5187:return Qe+e+xe(e,/(\w+).+(:[^]+)/,Qe+"box-$1$2"+dt+"flex-$1$2")+e;case 5443:return Qe+e+dt+"flex-item-"+xe(e,/flex-|-self/g,"")+(ji(e,/flex-|baseline/)?"":dt+"grid-row-"+xe(e,/flex-|-self/g,""))+e;case 4675:return Qe+e+dt+"flex-line-pack"+xe(e,/align-content|flex-|-self/g,"")+e;case 5548:return Qe+e+dt+xe(e,"shrink","negative")+e;case 5292:return Qe+e+dt+xe(e,"basis","preferred-size")+e;case 6060:return Qe+"box-"+xe(e,"-grow","")+Qe+e+dt+xe(e,"grow","positive")+e;case 4554:return Qe+xe(e,/([^-])(transform)/g,"$1"+Qe+"$2")+e;case 6187:return xe(xe(xe(e,/(zoom-|grab)/,Qe+"$1"),/(image-set)/,Qe+"$1"),e,"")+e;case 5495:case 3959:return xe(e,/(image-set\([^]*)/,Qe+"$1$`$1");case 4968:return xe(xe(e,/(.+:)(flex-)?(.*)/,Qe+"box-pack:$3"+dt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Qe+e+e;case 4200:if(!ji(e,/flex-|baseline/))return dt+"grid-column-align"+na(e,t)+e;break;case 2592:case 3360:return dt+xe(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(i,a){return t=a,ji(i.props,/grid-\w+-end/)})?~bd(e+(n=n[t].value),"span",0)?e:dt+xe(e,"-start","")+e+dt+"grid-row-span:"+(~bd(n,"span",0)?ji(n,/\d+/):+ji(n,/\d+/)-+ji(e,/\d+/))+";":dt+xe(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(i){return ji(i.props,/grid-\w+-start/)})?e:dt+xe(xe(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return xe(e,/(.+)-inline(.+)/,Qe+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Pi(e)-1-t>6)switch(Bt(e,t+1)){case 109:if(Bt(e,t+4)!==45)break;case 102:return xe(e,/(.+:)(.+)-([^]+)/,"$1"+Qe+"$2-$3$1"+Rl+(Bt(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~bd(e,"stretch",0)?RT(xe(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return xe(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,a,s,l,c,u,f){return dt+a+":"+s+f+(l?dt+a+"-span:"+(c?u:+u-+s)+f:"")+e});case 4949:if(Bt(e,t+6)===121)return xe(e,":",":"+Qe)+e;break;case 6444:switch(Bt(e,Bt(e,14)===45?18:11)){case 120:return xe(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Qe+(Bt(e,14)===45?"inline-":"")+"box$3$1"+Qe+"$2$3$1"+dt+"$2box$3")+e;case 100:return xe(e,":",":"+dt)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return xe(e,"scroll-","scroll-snap-")+e}return e}function Zd(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function lO(e,t,n,i){switch(e.type){case KM:if(e.children.length)break;case VM:case Pp:return e.return=e.return||e.value;case TT:return"";case AT:return e.return=e.value+"{"+Zd(e.children,i)+"}";case _u:if(!Pi(e.value=e.props.join(",")))return""}return Pi(n=Zd(e.children,i))?e.return=e.value+"{"+n+"}":""}function cO(e){var t=_T(e);return function(n,i,a,s){for(var l="",c=0;c<t;c++)l+=e[c](n,i,a,s)||"";return l}}function dO(e){return function(t){t.root||(t=t.return)&&e(t)}}function uO(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case Pp:e.return=RT(e.value,e.length,n);return;case AT:return Zd([bo(e,{value:xe(e.value,"@","@"+Qe)})],i);case _u:if(e.length)return ZM(n=e.props,function(a){switch(ji(a,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":As(bo(e,{props:[xe(a,/:(read-\w+)/,":"+Rl+"$1")]})),As(bo(e,{props:[a]})),_g(e,{props:LS(n,i)});break;case"::placeholder":As(bo(e,{props:[xe(a,/:(plac\w+)/,":"+Qe+"input-$1")]})),As(bo(e,{props:[xe(a,/:(plac\w+)/,":"+Rl+"$1")]})),As(bo(e,{props:[xe(a,/:(plac\w+)/,dt+"input-$1")]})),As(bo(e,{props:[a]})),_g(e,{props:LS(n,i)});break}return""})}}var fO={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},bn={},oa=typeof process<"u"&&bn!==void 0&&(bn.REACT_APP_SC_ATTR||bn.SC_ATTR)||"data-styled",PT="active",DT="data-styled-version",Du="6.1.13",Np=`/*!sc*/
`,Qd=typeof window<"u"&&"HTMLElement"in window,hO=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&bn!==void 0&&bn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&bn.REACT_APP_SC_DISABLE_SPEEDY!==""?bn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&bn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&bn!==void 0&&bn.SC_DISABLE_SPEEDY!==void 0&&bn.SC_DISABLE_SPEEDY!==""&&bn.SC_DISABLE_SPEEDY!=="false"&&bn.SC_DISABLE_SPEEDY),gO={},Nu=Object.freeze([]),ra=Object.freeze({});function NT(e,t,n){return n===void 0&&(n=ra),e.theme!==n.theme&&e.theme||t||n.theme}var MT=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),pO=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,mO=/(^-|-$)/g;function GS(e){return e.replace(pO,"-").replace(mO,"")}var yO=/(a)(d)/gi,Id=52,$S=function(e){return String.fromCharCode(e+(e>25?39:97))};function Pg(e){var t,n="";for(t=Math.abs(e);t>Id;t=t/Id|0)n=$S(t%Id)+n;return($S(t%Id)+n).replace(yO,"$1-$2")}var Zh,OT=5381,Hs=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},kT=function(e){return Hs(OT,e)};function bT(e){return Pg(kT(e)>>>0)}function SO(e){return e.displayName||e.name||"Component"}function Qh(e){return typeof e=="string"&&!0}var BT=typeof Symbol=="function"&&Symbol.for,FT=BT?Symbol.for("react.memo"):60115,vO=BT?Symbol.for("react.forward_ref"):60112,IO={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},TO={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},LT={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},AO=((Zh={})[vO]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Zh[FT]=LT,Zh);function xS(e){return("type"in(t=e)&&t.type.$$typeof)===FT?LT:"$$typeof"in e?AO[e.$$typeof]:IO;var t}var EO=Object.defineProperty,CO=Object.getOwnPropertyNames,WS=Object.getOwnPropertySymbols,_O=Object.getOwnPropertyDescriptor,wO=Object.getPrototypeOf,YS=Object.prototype;function UT(e,t,n){if(typeof t!="string"){if(YS){var i=wO(t);i&&i!==YS&&UT(e,i,n)}var a=CO(t);WS&&(a=a.concat(WS(t)));for(var s=xS(e),l=xS(t),c=0;c<a.length;++c){var u=a[c];if(!(u in TO||n&&n[u]||l&&u in l||s&&u in s)){var f=_O(t,u);try{EO(e,u,f)}catch{}}}}return e}function sa(e){return typeof e=="function"}function Mp(e){return typeof e=="object"&&"styledComponentId"in e}function wr(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function Dg(e,t){if(e.length===0)return"";for(var n=e[0],i=1;i<e.length;i++)n+=e[i];return n}function xl(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function Ng(e,t,n){if(n===void 0&&(n=!1),!n&&!xl(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)e[i]=Ng(e[i],t[i]);else if(xl(t))for(var i in t)e[i]=Ng(e[i],t[i]);return e}function Op(e,t){Object.defineProperty(e,"toString",{value:t})}function Kl(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var RO=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,i=0;i<t;i++)n+=this.groupSizes[i];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var i=this.groupSizes,a=i.length,s=a;t>=s;)if((s<<=1)<0)throw Kl(16,"".concat(t));this.groupSizes=new Uint32Array(s),this.groupSizes.set(i),this.length=s;for(var l=a;l<s;l++)this.groupSizes[l]=0}for(var c=this.indexOfGroup(t+1),u=(l=0,n.length);l<u;l++)this.tag.insertRule(c,n[l])&&(this.groupSizes[t]++,c++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],i=this.indexOfGroup(t),a=i+n;this.groupSizes[t]=0;for(var s=i;s<a;s++)this.tag.deleteRule(i)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var i=this.groupSizes[t],a=this.indexOfGroup(t),s=a+i,l=a;l<s;l++)n+="".concat(this.tag.getRule(l)).concat(Np);return n},e}(),Ld=new Map,Jd=new Map,Ud=1,Td=function(e){if(Ld.has(e))return Ld.get(e);for(;Jd.has(Ud);)Ud++;var t=Ud++;return Ld.set(e,t),Jd.set(t,e),t},PO=function(e,t){Ud=t+1,Ld.set(e,t),Jd.set(t,e)},DO="style[".concat(oa,"][").concat(DT,'="').concat(Du,'"]'),NO=new RegExp("^".concat(oa,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),MO=function(e,t,n){for(var i,a=n.split(","),s=0,l=a.length;s<l;s++)(i=a[s])&&e.registerName(t,i)},OO=function(e,t){for(var n,i=((n=t.textContent)!==null&&n!==void 0?n:"").split(Np),a=[],s=0,l=i.length;s<l;s++){var c=i[s].trim();if(c){var u=c.match(NO);if(u){var f=0|parseInt(u[1],10),g=u[2];f!==0&&(PO(g,f),MO(e,g,u[3]),e.getTag().insertRules(f,a)),a.length=0}else a.push(c)}}},zS=function(e){for(var t=document.querySelectorAll(DO),n=0,i=t.length;n<i;n++){var a=t[n];a&&a.getAttribute(oa)!==PT&&(OO(e,a),a.parentNode&&a.parentNode.removeChild(a))}};function kO(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var HT=function(e){var t=document.head,n=e||t,i=document.createElement("style"),a=function(c){var u=Array.from(c.querySelectorAll("style[".concat(oa,"]")));return u[u.length-1]}(n),s=a!==void 0?a.nextSibling:null;i.setAttribute(oa,PT),i.setAttribute(DT,Du);var l=kO();return l&&i.setAttribute("nonce",l),n.insertBefore(i,s),i},bO=function(){function e(t){this.element=HT(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,a=0,s=i.length;a<s;a++){var l=i[a];if(l.ownerNode===n)return l}throw Kl(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),BO=function(){function e(t){this.element=HT(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),FO=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),jS=Qd,LO={isServer:!Qd,useCSSOMInjection:!hO},eu=function(){function e(t,n,i){t===void 0&&(t=ra),n===void 0&&(n={});var a=this;this.options=Zt(Zt({},LO),t),this.gs=n,this.names=new Map(i),this.server=!!t.isServer,!this.server&&Qd&&jS&&(jS=!1,zS(this)),Op(this,function(){return function(s){for(var l=s.getTag(),c=l.length,u="",f=function(m){var S=function(N){return Jd.get(N)}(m);if(S===void 0)return"continue";var v=s.names.get(S),T=l.getGroup(m);if(v===void 0||!v.size||T.length===0)return"continue";var I="".concat(oa,".g").concat(m,'[id="').concat(S,'"]'),_="";v!==void 0&&v.forEach(function(N){N.length>0&&(_+="".concat(N,","))}),u+="".concat(T).concat(I,'{content:"').concat(_,'"}').concat(Np)},g=0;g<c;g++)f(g);return u}(a)})}return e.registerId=function(t){return Td(t)},e.prototype.rehydrate=function(){!this.server&&Qd&&zS(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(Zt(Zt({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var i=n.useCSSOMInjection,a=n.target;return n.isServer?new FO(a):i?new bO(a):new BO(a)}(this.options),new RO(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(Td(t),this.names.has(t))this.names.get(t).add(n);else{var i=new Set;i.add(n),this.names.set(t,i)}},e.prototype.insertRules=function(t,n,i){this.registerName(t,n),this.getTag().insertRules(Td(t),i)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(Td(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),UO=/&/g,HO=/^\s*\/\/.*$/gm;function GT(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(i){return"".concat(t," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=GT(n.children,t)),n})}function GO(e){var t,n,i,a=ra,s=a.options,l=s===void 0?ra:s,c=a.plugins,u=c===void 0?Nu:c,f=function(S,v,T){return T.startsWith(n)&&T.endsWith(n)&&T.replaceAll(n,"").length>0?".".concat(t):S},g=u.slice();g.push(function(S){S.type===_u&&S.value.includes("&")&&(S.props[0]=S.props[0].replace(UO,n).replace(i,f))}),l.prefix&&g.push(uO),g.push(lO);var m=function(S,v,T,I){v===void 0&&(v=""),T===void 0&&(T=""),I===void 0&&(I="&"),t=I,n=v,i=new RegExp("\\".concat(n,"\\b"),"g");var _=S.replace(HO,""),N=sO(T||v?"".concat(T," ").concat(v," { ").concat(_," }"):_);l.namespace&&(N=GT(N,l.namespace));var R=[];return Zd(N,cO(g.concat(dO(function(w){return R.push(w)})))),R};return m.hash=u.length?u.reduce(function(S,v){return v.name||Kl(15),Hs(S,v.name)},OT).toString():"",m}var $O=new eu,Mg=GO(),$T=Di.createContext({shouldForwardProp:void 0,styleSheet:$O,stylis:Mg});$T.Consumer;Di.createContext(void 0);function Og(){return Be.useContext($T)}var xO=function(){function e(t,n){var i=this;this.inject=function(a,s){s===void 0&&(s=Mg);var l=i.name+s.hash;a.hasNameForId(i.id,l)||a.insertRules(i.id,l,s(i.rules,l,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,Op(this,function(){throw Kl(12,String(i.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Mg),this.name+t.hash},e}(),WO=function(e){return e>="A"&&e<="Z"};function XS(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(n===1&&i==="-"&&e[0]==="-")return e;WO(i)?t+="-"+i.toLowerCase():t+=i}return t.startsWith("ms-")?"-"+t:t}var xT=function(e){return e==null||e===!1||e===""},WT=function(e){var t,n,i=[];for(var a in e){var s=e[a];e.hasOwnProperty(a)&&!xT(s)&&(Array.isArray(s)&&s.isCss||sa(s)?i.push("".concat(XS(a),":"),s,";"):xl(s)?i.push.apply(i,$l($l(["".concat(a," {")],WT(s),!1),["}"],!1)):i.push("".concat(XS(a),": ").concat((t=a,(n=s)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in fO||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function Yo(e,t,n,i){if(xT(e))return[];if(Mp(e))return[".".concat(e.styledComponentId)];if(sa(e)){if(!sa(s=e)||s.prototype&&s.prototype.isReactComponent||!t)return[e];var a=e(t);return Yo(a,t,n,i)}var s;return e instanceof xO?n?(e.inject(n,i),[e.getName(i)]):[e]:xl(e)?WT(e):Array.isArray(e)?Array.prototype.concat.apply(Nu,e.map(function(l){return Yo(l,t,n,i)})):[e.toString()]}function YT(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(sa(n)&&!Mp(n))return!1}return!0}var YO=kT(Du),zO=function(){function e(t,n,i){this.rules=t,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&YT(t),this.componentId=n,this.baseHash=Hs(YO,n),this.baseStyle=i,eu.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,i){var a=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))a=wr(a,this.staticRulesId);else{var s=Dg(Yo(this.rules,t,n,i)),l=Pg(Hs(this.baseHash,s)>>>0);if(!n.hasNameForId(this.componentId,l)){var c=i(s,".".concat(l),void 0,this.componentId);n.insertRules(this.componentId,l,c)}a=wr(a,l),this.staticRulesId=l}else{for(var u=Hs(this.baseHash,i.hash),f="",g=0;g<this.rules.length;g++){var m=this.rules[g];if(typeof m=="string")f+=m;else if(m){var S=Dg(Yo(m,t,n,i));u=Hs(u,S+g),f+=S}}if(f){var v=Pg(u>>>0);n.hasNameForId(this.componentId,v)||n.insertRules(this.componentId,v,i(f,".".concat(v),void 0,this.componentId)),a=wr(a,v)}}return a},e}(),kp=Di.createContext(void 0);kp.Consumer;var Jh={};function jO(e,t,n){var i=Mp(e),a=e,s=!Qh(e),l=t.attrs,c=l===void 0?Nu:l,u=t.componentId,f=u===void 0?function(B,O){var D=typeof B!="string"?"sc":GS(B);Jh[D]=(Jh[D]||0)+1;var M="".concat(D,"-").concat(bT(Du+D+Jh[D]));return O?"".concat(O,"-").concat(M):M}(t.displayName,t.parentComponentId):u,g=t.displayName,m=g===void 0?function(B){return Qh(B)?"styled.".concat(B):"Styled(".concat(SO(B),")")}(e):g,S=t.displayName&&t.componentId?"".concat(GS(t.displayName),"-").concat(t.componentId):t.componentId||f,v=i&&a.attrs?a.attrs.concat(c).filter(Boolean):c,T=t.shouldForwardProp;if(i&&a.shouldForwardProp){var I=a.shouldForwardProp;if(t.shouldForwardProp){var _=t.shouldForwardProp;T=function(B,O){return I(B,O)&&_(B,O)}}else T=I}var N=new zO(n,S,i?a.componentStyle:void 0);function R(B,O){return function(D,M,F){var x=D.attrs,q=D.componentStyle,ee=D.defaultProps,z=D.foldedComponentIds,ne=D.styledComponentId,ie=D.target,Ee=Di.useContext(kp),le=Og(),te=D.shouldForwardProp||le.shouldForwardProp,Y=NT(M,Ee,ee)||ra,X=function(Re,ge,Me){for(var De,ae=Zt(Zt({},ge),{className:void 0,theme:Me}),me=0;me<Re.length;me+=1){var $e=sa(De=Re[me])?De(ae):De;for(var ve in $e)ae[ve]=ve==="className"?wr(ae[ve],$e[ve]):ve==="style"?Zt(Zt({},ae[ve]),$e[ve]):$e[ve]}return ge.className&&(ae.className=wr(ae.className,ge.className)),ae}(x,M,Y),V=X.as||ie,b={};for(var W in X)X[W]===void 0||W[0]==="$"||W==="as"||W==="theme"&&X.theme===Y||(W==="forwardedAs"?b.as=X.forwardedAs:te&&!te(W,V)||(b[W]=X[W]));var se=function(Re,ge){var Me=Og(),De=Re.generateAndInjectStyles(ge,Me.styleSheet,Me.stylis);return De}(q,X),fe=wr(z,ne);return se&&(fe+=" "+se),X.className&&(fe+=" "+X.className),b[Qh(V)&&!MT.has(V)?"class":"className"]=fe,b.ref=F,Be.createElement(V,b)}(w,B,O)}R.displayName=m;var w=Di.forwardRef(R);return w.attrs=v,w.componentStyle=N,w.displayName=m,w.shouldForwardProp=T,w.foldedComponentIds=i?wr(a.foldedComponentIds,a.styledComponentId):"",w.styledComponentId=S,w.target=i?a.target:e,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(B){this._foldedDefaultProps=i?function(O){for(var D=[],M=1;M<arguments.length;M++)D[M-1]=arguments[M];for(var F=0,x=D;F<x.length;F++)Ng(O,x[F],!0);return O}({},a.defaultProps,B):B}}),Op(w,function(){return".".concat(w.styledComponentId)}),s&&UT(w,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function VS(e,t){for(var n=[e[0]],i=0,a=t.length;i<a;i+=1)n.push(t[i],e[i+1]);return n}var KS=function(e){return Object.assign(e,{isCss:!0})};function zT(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(sa(e)||xl(e))return KS(Yo(VS(Nu,$l([e],t,!0))));var i=e;return t.length===0&&i.length===1&&typeof i[0]=="string"?Yo(i):KS(Yo(VS(i,t)))}function kg(e,t,n){if(n===void 0&&(n=ra),!t)throw Kl(1,t);var i=function(a){for(var s=[],l=1;l<arguments.length;l++)s[l-1]=arguments[l];return e(t,n,zT.apply(void 0,$l([a],s,!1)))};return i.attrs=function(a){return kg(e,t,Zt(Zt({},n),{attrs:Array.prototype.concat(n.attrs,a).filter(Boolean)}))},i.withConfig=function(a){return kg(e,t,Zt(Zt({},n),a))},i}var jT=function(e){return kg(jO,e)},Nt=jT;MT.forEach(function(e){Nt[e]=jT(e)});var XO=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=YT(t),eu.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,i,a){var s=a(Dg(Yo(this.rules,n,i,a)),""),l=this.componentId+t;i.insertRules(l,l,s)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,i,a){t>2&&eu.registerId(this.componentId+t),this.removeStyles(t,i),this.createStyles(t,n,i,a)},e}();function VO(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=zT.apply(void 0,$l([e],t,!1)),a="sc-global-".concat(bT(JSON.stringify(i))),s=new XO(i,a),l=function(u){var f=Og(),g=Di.useContext(kp),m=Di.useRef(f.styleSheet.allocateGSInstance(a)).current;return f.styleSheet.server&&c(m,u,f.styleSheet,g,f.stylis),Di.useLayoutEffect(function(){if(!f.styleSheet.server)return c(m,u,f.styleSheet,g,f.stylis),function(){return s.removeStyles(m,f.styleSheet)}},[m,u,f.styleSheet,g,f.stylis]),null};function c(u,f,g,m,S){if(s.isStatic)s.renderStyles(u,gO,g,S);else{var v=Zt(Zt({},f),{theme:NT(f,m,l.defaultProps)});s.renderStyles(u,v,g,S)}}return Di.memo(l)}function XT(e,t){var n=Be.useRef(null),i=Be.useRef(!1),a=Be.useRef(e);a.current=e;var s=Be.useCallback(function(c){i.current&&(a.current(c),n.current=requestAnimationFrame(s))},[]),l=Be.useMemo(function(){return[function(){i.current&&(i.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){i.current||(i.current=!0,n.current=requestAnimationFrame(s))},function(){return i.current}]},[]);return Be.useEffect(function(){return l[0]},[]),l}var rn=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(rn||{}),Fr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(Fr||{}),sn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(sn||{});const bg={},Bg={},KO=[{key:rn.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:rn.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>g_,isCompleted:!1,minDisplayTime:gS,highlightedUIElements:[Fr.HUNGER_BAR]},{key:rn.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!be(t,e,"berryBush",Ze*5,i=>i.food.length>0),getTargets:(e,t)=>{const n=[];for(const i of Object.values(e.entities.entities))i.type==="berryBush"&&i.food.length>0&&G(t.position,i.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(i);return n.map(i=>i.id)},isCompleted:!1,minDisplayTime:gS},{key:rn.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=be(t,e,"berryBush",Ze,i=>i.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:rn.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[Fr.FOOD_BAR]},{key:rn.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>En(e,t).length>0,getTargets:(e,t)=>{const n=be(t,e,"human",Ze,i=>xr(t,i,e));return n?[n.id]:[]},isCompleted:!1},{key:rn.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>_p(e,t).some(i=>i.type===de.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:rn.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[Fr.COMMAND_BUTTONS],isCompleted:!1},{key:rn.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:rn.AUTOPILOT},{key:rn.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=be(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=be(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:rn.ANIMALS_INTRODUCTION},{key:rn.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!be(t,e,"predator",120),getTargets:(e,t)=>{const n=be(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:rn.HUNT_PREY}].map(e=>({...e,condition:e.condition?QO(e.condition):void 0,getTargets:e.getTargets?JO(e.getTargets):void 0}));function VT(){return{steps:KO.map(e=>({...e,isCompleted:!1}))}}function KT(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:sn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function qO(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function ZO(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=sn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const i=yt(e);if(!i){n.isActive=!1,n.transitionState=sn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=e.tutorial.steps[n.currentStepIndex];if(!a){n.isActive=!1,n.transitionState=sn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=1/cP;switch(n.transitionState){case sn.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=s*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=sn.ACTIVE);break;case sn.ACTIVE:{const u=e.time-(n.stepStartTime||e.time)>=(a.minDisplayTime||0),f=bg[a.condition];f&&u&&f(e,i)&&(a.isCompleted=!0,n.completedSteps.includes(a.key)||n.completedSteps.push(a.key),n.transitionState=sn.FADING_OUT);break}case sn.FADING_OUT:if(n.transitionAlpha-=s*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const c=qO(e);c!==null?(n.currentStepIndex=c,n.transitionState=sn.FADING_IN):(n.isActive=!1,n.transitionState=sn.INACTIVE)}break}if(n.transitionState!==sn.FADING_OUT&&n.transitionState!==sn.INACTIVE){const c=Bg[a.getTargets||""];c?n.highlightedEntityIds=[...c(e,i)]:n.highlightedEntityIds=[],a.highlightedUIElements?n.activeUIHighlights=[...a.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function QO(e){const t=`condition_${Object.keys(bg).length+1}`;return bg[t]=e,t}function JO(e){const t=`getTargets_${Object.keys(Bg).length+1}`;return Bg[t]=e,t}function ek(){const e=mT(),t=0;for(let S=0;S<Hv;S++){const v={x:Math.random()*Xe,y:Math.random()*qe};Vl(e,v,t)}for(let S=0;S<Cv;S++){const v={x:Math.random()*Xe,y:Math.random()*qe};Ul(e,v,t)}const n=Xe/2,i=qe/2;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,T=100+Math.random()*100,I={x:n+Math.cos(v)*T,y:i+Math.sin(v)*T};Ul(e,I,t,Ko)}const a=Us(e,{x:n-25,y:i},t,"male",!0),s=Us(e,{x:n+25,y:i},t,"female",!1);s.leaderId=a.id,s.tribeInfo={tribeBadge:"",tribeColor:Fn[0]},a.aiType=Ut.TaskBased,s.aiType=Ut.TaskBased;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,T=Xe/2,I=qe/2,_={x:n+Math.cos(v)*T,y:i+Math.sin(v)*I},N=Us(e,{x:_.x,y:_.y},t,"male",!1);N.leaderId=N.id,N.tribeInfo={tribeBadge:zd[S%zd.length],tribeColor:Fn[S%Fn.length]};const R=Us(e,{x:_.x+50,y:_.y},t,"female",!1);R.leaderId=N.id,R.tribeInfo=N.tribeInfo}for(let S=0;S<AI;S++){const v={x:n+Xe*(Math.random()-Math.random()),y:i+qe*(Math.random()-Math.random())};ea(e,v,"male",void 0,void 0,Bl()),ea(e,{x:v.x+20,y:v.y},"female",void 0,void 0,Bl())}const l={x:n+Xe*(Math.random()-Math.random()),y:i+qe*(Math.random()-Math.random())};ta(e,l,"male",void 0,void 0,Fl()),ta(e,{x:l.x+20,y:l.y},"female",void 0,void 0,Fl());const c=[{id:"muteButton",action:re.ToggleMute,currentWidth:Zi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Lt},{id:"pauseButton",action:re.TogglePause,currentWidth:Zi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Lt},{id:"returnToIntroButton",action:re.ReturnToIntro,currentWidth:Zi,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:Lt}],u=VT(),f=KT(),g={time:t,entities:e,mapDimensions:{width:Xe,height:qe},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...a.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:gI,isMuted:!1,uiButtons:c,tutorial:u,tutorialState:f,debugPanel:Ye.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:Lr.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[a.id],highlightedEntityIds:[a.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:Dr,preyProcreationCooldown:Nr,predatorGestationPeriod:Mr,predatorProcreationCooldown:Or,preyHungerIncreasePerHour:Uo,predatorHungerIncreasePerHour:Ho,berryBushSpreadChance:to},soilDepletion:xv(),temperature:YI(Xe,qe),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Xe/we)*Math.ceil(qe/we)).fill(null),tasks:{}},m=Cu(g);return console.log("Game world initialized:",m),m}function tk(){const e=mT(),t=0;for(let u=0;u<Hv;u++){const f={x:Math.random()*Xe,y:Math.random()*qe};Vl(e,f,t)}for(let u=0;u<Cv;u++){const f={x:Math.random()*Xe,y:Math.random()*qe};Ul(e,f,t)}const n=Xe/2,i=qe/2;for(let u=0;u<5;u++){const f=u/5*Math.PI*2,g=100+Math.random()*100,m={x:n+Math.cos(f)*g,y:i+Math.sin(f)*g};Ul(e,m,t,Ko)}for(let u=0;u<TC;u++){const f={x:Math.random()*Xe,y:Math.random()*qe},g=Math.random()<.5?"male":"female";Us(e,f,t,g,!1)}for(let u=0;u<AI;u++){const f={x:Math.random()*Xe,y:Math.random()*qe};ea(e,f,"male",void 0,void 0,Bl()),ea(e,{x:f.x+20,y:f.y},"female",void 0,void 0,Bl())}const a={x:Math.random()*Xe,y:Math.random()*qe};ta(e,a,"male",void 0,void 0,Fl()),ta(e,{x:a.x+20,y:a.y},"female",void 0,void 0,Fl());const s=VT(),l=KT(),c={time:t,entities:e,mapDimensions:{width:Xe,height:qe},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Xe/2,y:qe/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:gI,isMuted:!0,uiButtons:[],tutorial:s,tutorialState:l,debugPanel:Ye.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:Dr,preyProcreationCooldown:Nr,predatorGestationPeriod:Mr,predatorProcreationCooldown:Or,preyHungerIncreasePerHour:Uo,predatorHungerIncreasePerHour:Ho,berryBushSpreadChance:to},soilDepletion:xv(),temperature:YI(Xe,qe),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Xe/we)*Math.ceil(qe/we)).fill(null),tasks:{}};return Cu(c)}const nk="humanProcreation",ik="human",ok="human",rk=Ze,sk=(e,t,n)=>xr(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,ak=(e,t,n)=>{var u,f,g,m;const{gameState:i}=n,a={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},s=e.gender==="male"?e:t,l=e.gender==="female"?e:t,c=(s.partnerIds||[]).length===0;if(((u=e.stateMachine)==null?void 0:u[0])!==_r&&(e.stateMachine=[_r,{partnerId:t.id,previousState:(f=e.stateMachine)==null?void 0:f[0],procreationEndTime:n.gameState.time+1}]),((g=t.stateMachine)==null?void 0:g[0])!==_r&&(t.stateMachine=[_r,{partnerId:e.id,previousState:(m=t.stateMachine)==null?void 0:m[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),c&&s.leaderId&&s.leaderId!==s.id){const S=i.entities.entities[s.leaderId];if(S){const v=Cg(s,S),T=Cg(l,S);if(!v&&!T){const I=Xd();s.leaderId=s.id,s.tribeInfo={tribeBadge:I,tribeColor:Fn[Math.floor(Math.random()*Fn.length)]},s.tribeRole=J.Leader,s.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=s.id,l.tribeInfo=s.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&s&&l){const S=Xd();s.leaderId=s.id,s.tribeInfo={tribeBadge:S,tribeColor:Fn[Math.floor(Math.random()*Fn.length)]},s.tribeRole=J.Leader,s.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=s.id,l.tribeInfo=s.tribeInfo}e.activeAction=void 0,Ge(i,Te.Procreation,a,kl),Ge(i,Te.Partnered,e.position,Ve,e.id),Ge(i,Te.Partnered,t.position,Ve,t.id),e.lastPartneredEffectTime=i.time,t.lastPartneredEffectTime=i.time,t.activeAction=void 0,Ne(n,Ae.Procreate,a)},lk={id:nk,sourceType:ik,targetType:ok,maxDistance:rk,checker:sk,perform:ak},ck={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:su,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=zo&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-zo),e.feedChildCooldownTime=C_,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Te.ChildFed,t.position,Ve,t.id),t.lastChildFedEffectTime=n.gameState.time),Ne(n,Ae.ChildFed,t.position)}},dk={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:Tn,checker:(e,t,n)=>{var g,m,S;if(((g=e.stateMachine)==null?void 0:g[0])!==Vo||e.attackTargetId!==t.id)return!1;const i=G(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=i<=jo,s=!a&&i<=Tn;if(!a&&!s||(a?((m=e.attackCooldown)==null?void 0:m.melee)||0:((S=e.attackCooldown)==null?void 0:S.ranged)||0)>0)return!1;const c=a?au:Vg,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,a=G(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),s=a>jo,l=ze(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),c=f_(rt(l),t.direction);if(Math.abs(c)<L_*Math.PI/180&&Math.random()<U_)Ge(i,Te.AttackDeflected,t.position,Ve,t.id);else{let g=s?Xg:jg;if(e.gender==="male"&&(g*=b_),e.isAdult||(g*=B_),(!t.isAdult||t.age>=zg)&&e.isAdult&&(g*=F_),s){const S=a/Kg;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+S,data:{attackerId:e.id,targetId:t.id,damage:g,pushbackForce:Zg,attackerPosition:{...e.position}}}),Ge(i,Te.StoneProjectile,e.position,S,void 0,t.position,t.id),Ne(n,Ae.Attack,e.position)}else{t.hitpoints-=g,t.movementSlowdown={modifier:cu,endTime:i.time+du},Ge(i,Te.Hit,t.position,Ve,t.id);const S=ze(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),v=Et(S,N_);t.forces.push(v),t.hitpoints<=0?Ne(n,Ae.HumanDeath,t.position):Ne(n,Ae.Attack,e.position),Ge(i,Te.Attack,e.position,Ve,e.id)}}e.attackCooldown={melee:lu,ranged:qg};const f=e.stateMachine[1];f.attackStartTime=i.time}},uk={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:Ct*2,checker:(e,t,{gameState:n})=>G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const i=G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(i===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const s=(e.radius+t.radius-i)*.05,l=rt(u_(e.position,t.position)),c=Et(l,s);e.forces.push(c),t.forces.push(Et(c,-1))}},fk={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:Ct*.6+zl*.4,checker:(e,t,{gameState:n})=>{var c;const i=(c=t.stateMachine)==null?void 0:c[0];if(i==="fallen"||i==="stump")return!1;const a=t.radius*.25,s=e.radius*.4;return G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+a},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,a=e.radius*.4,s=G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(s===0){e.forces.push({x:1,y:0});return}const l=a+i-s;if(l<=0)return;const c=l*2.5,u=rt(ze(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=Et(u,c);e.forces.push(f)}},hk={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:Ct*.6+zl*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,a=e.radius*.4;return G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,a=e.radius*.4,s=G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(s===0){e.forces.push({x:1,y:0});return}const l=a+i-s;if(l<=0)return;const c=l*2.5,u=rt(ze(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=Et(u,c);e.forces.push(f)}},gk={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:Ct*.6+zl*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,a=e.radius*.4;return G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,a=e.radius*.4,s=G(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(s===0){e.forces.push({x:1,y:0});return}const l=a+i-s;if(l<=0)return;const c=l*2.5,u=rt(ze(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=Et(u,c);e.forces.push(f)}},pk={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:Ze,checker:(e,t,n)=>{var i;return e.isAdult&&t.food.length>0&&((i=e.stateMachine)==null?void 0:i[0])===ca&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Ge(n.gameState,Te.BushClaimed,t.position,Ve),Ne(n,Ae.Gather,e.position)}},mk={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:Ze,checker:(e,t,n)=>{var i;return e.isAdult&&t.food.length>0&&((i=e.stateMachine)==null?void 0:i[0])===ca&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,Ne(n,Ae.Gather,e.position)}},yk={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:Ze,checker:(e,t,n)=>{var i,a;return e.isAdult&&((i=t.stateMachine)==null?void 0:i[0])===An&&t.wood.length>0&&((a=e.stateMachine)==null?void 0:a[0])===ca&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const i=t.wood.pop();i&&(e.heldItem=i),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[no,{enteredAt:n.gameState.time,previousState:An}]),Ne(n,Ae.Gather,e.position)}},Sk=[pk,mk,yk],vk={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:dn,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=NR,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+DR,Ge(n.gameState,Te.BushClaimed,t.position,Ve,e.id),Ne(n,Ae.Gather,e.position))}},Ik={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:Rs,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=FR;const i=ze(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Et(i,8);t.forces.push(a),e.huntCooldown=HR,t.hitpoints<=0?(Ne(n,Ae.HumanDeath,t.position),Ge(n.gameState,Te.Hit,t.position,Ve,t.id)):(Ge(n.gameState,Te.Hit,t.position,Ve,t.id),t.fleeCooldown=5,Ne(n,Ae.Attack,e.position)),Ge(n.gameState,Te.Attack,e.position,Ve,e.id)}},Tk={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:Tn,checker:(e,t,n)=>{var g,m,S;if(((g=e.stateMachine)==null?void 0:g[0])!==Vo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=G(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=i<=jo,s=!a&&i<=Tn;if(!a&&!s||(a?((m=e.attackCooldown)==null?void 0:m.melee)||0:((S=e.attackCooldown)==null?void 0:S.ranged)||0)>0)return!1;const c=a?au:Vg,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,a=G(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),s=a>jo;let l=(s?Xg:jg)*1.2;if(e.gender==="male"&&(l*=1.3),s){const u=a/Kg;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+u,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Zg,attackerPosition:{...e.position}}}),Ge(i,Te.StoneProjectile,e.position,u,void 0,t.position,t.id),Ne(n,Ae.Attack,e.position)}else{t.hitpoints-=l;const u=ze(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),f=Et(u,6);t.forces.push(f),t.hitpoints<=0?(Ne(n,Ae.HumanDeath,t.position),Ge(i,Te.Hit,t.position,Ve,t.id)):(Ge(i,Te.Hit,t.position,Ve,t.id),t.fleeCooldown=8,Ne(n,Ae.Attack,e.position)),Ge(i,Te.Attack,e.position,Ve,e.id)}e.attackCooldown={melee:lu,ranged:qg};const c=e.stateMachine[1];c.attackStartTime=i.time}},Ak={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:li,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=II;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:cu,endTime:n.gameState.time+du};const a=ze(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=Et(a,7);t.forces.push(s),e.attackCooldown=TI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-dp),Ne(n,Ae.HumanDeath,t.position),Ge(n.gameState,Te.Hit,t.position,Ve,t.id)):(Ge(n.gameState,Te.Hit,t.position,Ve,t.id),Ne(n,Ae.Attack,e.position)),Ge(n.gameState,Te.Attack,e.position,Ve,e.id)}},Ek={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:Tn,checker:(e,t,n)=>{var g,m,S;if(((g=e.stateMachine)==null?void 0:g[0])!==Vo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=G(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=i<=jo,s=!a&&i<=Tn;if(!a&&!s||(a?((m=e.attackCooldown)==null?void 0:m.melee)||0:((S=e.attackCooldown)==null?void 0:S.ranged)||0)>0)return!1;const c=a?au:Vg,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,a=G(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),s=a>jo;let l=(s?Xg:jg)*.8;e.gender==="male"&&(l*=1.2);const c=Object.values(i.entities.entities).filter(f=>f.type==="human"&&f.id!==e.id).filter(f=>{const g=f;return Math.sqrt(Math.pow(g.position.x-e.position.x,2)+Math.pow(g.position.y-e.position.y,2))<100&&g.activeAction==="attacking"&&g.attackTargetId===t.id}).length;if(c>0&&(l*=1+c*.2),s){const f=a/Kg;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+f,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Zg,attackerPosition:{...e.position}}}),Ge(i,Te.StoneProjectile,e.position,f,void 0,t.position,t.id),Ne(n,Ae.Attack,e.position)}else{t.hitpoints-=l;const f=ze(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),g=Et(f,8);t.forces.push(g),t.hitpoints<=0?(Ne(n,Ae.HumanDeath,t.position),Ge(i,Te.Hit,t.position,Ve,t.id)):(Ge(i,Te.Hit,t.position,Ve,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),Ne(n,Ae.Attack,e.position)),Ge(i,Te.Attack,e.position,Ve,e.id)}e.attackCooldown={melee:lu,ranged:qg};const u=e.stateMachine[1];u.attackStartTime=i.time}},Ck={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:dn,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Ge(n.gameState,Te.Procreation,i.position,Ve,i.id),Ne(n,Ae.Procreate,i.position)}},_k={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:Wo,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.pregnancyFatherId=e.gender==="male"?e.id:t.id,i.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Ge(n.gameState,Te.Procreation,i.position,Ve,i.id),Ne(n,Ae.Procreate,i.position)}},wk={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:da,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Yd&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-Yd),e.feedChildCooldownTime=EI,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Te.ChildFed,t.position,Ve,t.id),t.lastChildFedEffectTime=n.gameState.time),Ne(n,Ae.ChildFed,t.position)}},Rk={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:da,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Yd&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-Yd),e.feedChildCooldownTime=EI,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Te.ChildFed,t.position,Ve,t.id),t.lastChildFedEffectTime=n.gameState.time),Ne(n,Ae.ChildFed,t.position)}},Pk={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:Wo,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-dp),e.eatingCooldownTime=n.gameState.time+2,Ge(n.gameState,Te.Eating,e.position,Ve,e.id),Ne(n,Ae.Gather,e.position))}},Dk={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:li,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=II;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:cu,endTime:n.gameState.time+du};const a=ze(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=Et(a,7);t.forces.push(s),e.attackCooldown=TI,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-dp),Ne(n,Ae.HumanDeath,t.position),Ge(n.gameState,Te.Hit,t.position,Ve,t.id)):(Ge(n.gameState,Te.Hit,t.position,Ve,t.id),Ne(n,Ae.Attack,e.position)),Ge(n.gameState,Te.Attack,e.position,Ve,e.id)}},Nk={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:un,checker:(e,t,n)=>{var f,g;const i=t.buildingType===he.StorageSpot,a=t.buildingType===he.Bonfire;if(!i&&!a||((f=e.stateMachine)==null?void 0:f[0])!==Il||!t.isConstructed)return!1;const s=e.food.length>0,l=((g=e.heldItem)==null?void 0:g.type)===St.Wood;if(a&&!l||!s&&!l)return!1;const c=t.storageCapacity??0;return!(t.storedItems.length>=c||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<eD)},perform:(e,t,n)=>{var a;let i=null;if(t.buildingType===he.Bonfire?((a=e.heldItem)==null?void 0:a.type)===St.Wood&&(i=e.heldItem,e.heldItem=void 0):e.heldItem?(i=e.heldItem,e.heldItem=void 0):i=e.food.pop()??null,i&&(t.storedItems.push({item:i,positionOffset:ZI(t)}),t.buildingType===he.Bonfire)){const s=Qt(e,n.gameState);s&&s.aiBlackboard&&jI(s.aiBlackboard,t.id,"wood")}t.lastDepositTime=n.gameState.time,Ne(n,Ae.StorageDeposit,t.position)}},Mk={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:un,checker:(e,t,n)=>{var a;return!(t.buildingType!=="storageSpot"||((a=e.stateMachine)==null?void 0:a[0])!==Tl||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<tD)},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&(e.food.push(i.item),ZI(t)),t.lastRetrieveTime=n.gameState.time,Ne(n,Ae.StorageRetrieve,t.position)}},Ok={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:un,checker:(e,t,n)=>{var c,u;if(t.buildingType!=="storageSpot"||((c=e.stateMachine)==null?void 0:c[0])!==ca||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const i=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!i||!((u=i.tribeControl)!=null&&u.diplomacy)||(t.ownerId?i.tribeControl.diplomacy[t.ownerId]:void 0)!==Ft.Hostile||n.gameState.time-(t.lastStealTime??0)<nD)return!1;const l=Cn({leaderId:t.ownerId},n.gameState);for(const f of l)if(G(e.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=iD)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&e.food.push(i.item),t.lastStealTime=n.gameState.time,Ne(n,Ae.StorageSteal,t.position),Ge(n.gameState,Te.Attack,t.position,.5)}},kk={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!cn(e,t,n.gameState)||!eI(t.position,js,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,oI(t.position,js,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Ge(n.gameState,Te.BushClaimed,t.position,2,t.id)}},bk={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!cn(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Ge(n.gameState,Te.Hit,t.position,1,t.id)}},Bk={id:"supplyTransfer",sourceType:"human",targetType:"human",maxDistance:Ze,checker:(e,t)=>!(e.activeAction!=="depositing"||t.activeAction!=="retrieving"||e.leaderId!==t.leaderId||e.food.length===0||t.food.length>=t.maxFood),perform:(e,t,n)=>{var l;const i=Math.min(((l=e.activeActionPayload)==null?void 0:l.amount)||1,e.food.length,t.maxFood-t.food.length),a=e.food.splice(0,i);t.food.push(...a);const s=Qt(t,n.gameState);s&&s.aiBlackboard&&jI(s.aiBlackboard,t.id,"food"),e.activeAction="idle",e.target=void 0,e.activeActionPayload=void 0,t.activeAction="idle",t.target=void 0,Ne(n,Ae.StorageDeposit,t.position)}},Fk={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:ou,checker:(e,t,n)=>{var s;const[i]=t.stateMachine??[],a=i===Kn||i===Ln||i===di;return e.isAdult&&a&&((s=e.stateMachine)==null?void 0:s[0])===ap&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{var a;const{gameState:i}=n;if(t.stateMachine=[An,{enteredAt:i.time,previousState:(a=t.stateMachine)==null?void 0:a[0]}],!t.woodGenerated){const s=Math.min(1,t.age/Ko),l=Math.floor(oS+s*(gu-oS));t.wood=Array.from({length:l},()=>({itemType:"item",type:St.Wood,id:i.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=i.time+1,Ne(n,Ae.Gather,e.position)}},Lk=[uk,fk,hk,gk,...Sk,lk,ck,dk,Nk,Mk,Ok,kk,bk,Bk,Fk,vk,wk,Rk,Pk,Ik,Tk,Ek,Ak,Dk,Ck,_k],Uk=Object.values(Lk.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;return e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]}),e[n].interactions.push(t),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));function Hk(e){const{gameState:t}=e,n=t,{width:i,height:a}=t.mapDimensions;for(const s of Uk){const l=n.search[s.sourceType].all();for(const c of l){const u=n.search[s.targetType].byRadius(c.position,s.maxDistance);for(const f of u){if(c.id===f.id)continue;const g=G(c.position,f.position,i,a);for(const m of s.interactions)g<=m.maxDistance&&m.checker(c,f,e)&&m.perform(c,f,e)}}}}function qT(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function Gk(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),i=e.search.human.byProperty("type","human");for(let a=0;a<20;a++){let s;if(t.length>0&&a<15){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=50+Math.random()*100;s={x:Math.max(50,Math.min(Xe-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(qe-50,u.position.y+Math.sin(f)*g))}}else s={x:50+Math.random()*(Xe-100),y:50+Math.random()*(qe-100)};let l=!0;const c=100;for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){l=!1;break}if(l){for(const u of i)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){l=!1;break}}if(l)return s}return{x:Xe*.3+Math.random()*Xe*.4,y:qe*.3+Math.random()*qe*.4}}function $k(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let a=0;a<15;a++){let s;if(t.length>0&&a<10){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,g=100+Math.random()*150;s={x:Math.max(50,Math.min(Xe-50,u.position.x+Math.cos(f)*g)),y:Math.max(50,Math.min(qe-50,u.position.y+Math.sin(f)*g))}}else s={x:50+Math.random()*(Xe-100),y:50+Math.random()*(qe-100)};let l=!0;const c=150;for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){l=!1;break}if(l)return s}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Xe,y:50+Math.random()*100};case 1:return{x:Xe-150+Math.random()*100,y:Math.random()*qe};case 2:return{x:Math.random()*Xe,y:qe-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*qe}}}function xk(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let i=0;i<20;i++){const a={x:50+Math.random()*(Xe-100),y:50+Math.random()*(qe-100)};let s=!0;const l=80,c=60;for(const u of t)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<l){s=!1;break}if(s){for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){s=!1;break}}if(s)return a}return{x:Math.random()*Xe,y:Math.random()*qe}}function ZT(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let i=0;i<t;i++){const a=Gk(n),s=i%2===0?"male":"female";ea(e.entities,a,s,void 0,void 0,Bl())}}function QT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let i=0;i<t;i++){const a=$k(n),s=i%2===0?"male":"female";ta(e.entities,a,s,void 0,void 0,Fl())}}function Wk(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count();let a=!1;return n===0&&(ZT(e,6),a=!0),i===0&&(QT(e,3),a=!0),a}function Yk(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count(),a=t.search.berryBush.count();let s=!1;if(n>0&&n<5){const l=Math.max(2,Math.floor(8-n));ZT(e,l),s=!0}if(i>0&&i<2){const l=Math.max(1,Math.floor(3-i));QT(e,l),s=!0}if(a<5){console.log(` Boosting bush count from ${a} to help ecosystem`);for(let l=0;l<5;l++){const c=xk(t);Vl(e.entities,c,e.time)}s=!0}return s}const zk=1,jk=.3,Xk=.8,qS=.8,Vk=.99,Kk=.05;var JT=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.NO_ACTION=14]="NO_ACTION",e))(JT||{});const eg=Object.keys(JT).length/2;class qk{constructor(){Pe(this,"qTable",new Map);Pe(this,"epsilon",qS);Pe(this,"lastState",null);Pe(this,"lastAction",null)}discretizeState(t,n,i){const a=Math.min(4,Math.floor(t/25)),s=Math.min(4,Math.floor(n/5)),l=Math.min(4,Math.floor(i/15));return`${a}-${s}-${l}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,i){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,i)}getBestAction(t){let n=0,i=this.getQValue(t,0);for(let a=1;a<eg;a++){const s=this.getQValue(t,a);s>i&&(i=s,n=a)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*eg):this.getBestAction(t)}applyEmergencyCorrections(t,n,i,a){t<Qi*.5&&(a.ecosystem.preyGestationPeriod=Math.max(Os,a.ecosystem.preyGestationPeriod*.8),a.ecosystem.preyProcreationCooldown=Math.max(ks,a.ecosystem.preyProcreationCooldown*.8),a.ecosystem.preyHungerIncreasePerHour=Math.max(Fs,a.ecosystem.preyHungerIncreasePerHour*.9)),n<Ji*.6&&(a.ecosystem.predatorGestationPeriod=Math.max(bs,a.ecosystem.predatorGestationPeriod*.75),a.ecosystem.predatorProcreationCooldown=Math.max(Bs,a.ecosystem.predatorProcreationCooldown*.75),a.ecosystem.predatorHungerIncreasePerHour=Math.max(Ls,a.ecosystem.predatorHungerIncreasePerHour*.85)),i<eo*.5&&(a.ecosystem.berryBushSpreadChance=Math.min(hl,a.ecosystem.berryBushSpreadChance*1.2)),t>Qi*1.4&&(a.ecosystem.preyHungerIncreasePerHour=Math.min(Uo,a.ecosystem.preyHungerIncreasePerHour*1.05)),n>Ji*1.4&&(a.ecosystem.predatorHungerIncreasePerHour=Math.min(Ho,a.ecosystem.predatorHungerIncreasePerHour*1.05)),i>eo*1.4&&(a.ecosystem.berryBushSpreadChance=Math.max(to,a.ecosystem.berryBushSpreadChance*.95))}calculateReward(t,n,i){const a=Math.abs(t-Qi),s=Math.abs(n-Ji),l=Math.abs(i-eo),c=a/Qi,u=s/Ji,f=l/eo,g=c+u+f;return 100*Math.exp(-g*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(Dr,n.ecosystem.preyGestationPeriod+.2*(Dr-Os));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(Os,n.ecosystem.preyGestationPeriod-.2*(Dr-Os));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(Nr,n.ecosystem.preyProcreationCooldown+.2*(Nr-ks));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max(ks,n.ecosystem.preyProcreationCooldown-.2*(Nr-ks));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(Uo,n.ecosystem.preyHungerIncreasePerHour+.2*(Uo-Fs));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(Fs,n.ecosystem.preyHungerIncreasePerHour-.2*(Uo-Fs));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(Mr,n.ecosystem.predatorGestationPeriod+.2*(Mr-bs));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max(bs,n.ecosystem.predatorGestationPeriod-.2*(Mr-bs));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min(Or,n.ecosystem.predatorProcreationCooldown+.2*(Or-Bs));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(Bs,n.ecosystem.predatorProcreationCooldown-.2*(Or-Bs));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(Ho,n.ecosystem.predatorHungerIncreasePerHour+.2*(Ho-Ls));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(Ls,n.ecosystem.predatorHungerIncreasePerHour-.2*(Ho-Ls));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(hl,n.ecosystem.berryBushSpreadChance+.2*(hl-to));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(to,n.ecosystem.berryBushSpreadChance-.2*(hl-to));break}}updateQTable(t,n,i,a){const s=this.getQValue(t,n),l=Math.max(...Array.from({length:eg},(u,f)=>this.getQValue(a,f))),c=s+jk*(i+Xk*l-s);this.setQValue(t,n,c)}step(t){const n=t,i=n.search.prey.count(),a=n.search.predator.count(),s=n.search.berryBush.count();this.applyEmergencyCorrections(i,a,s,t);const l=this.discretizeState(i,a,s);if(this.lastState!==null&&this.lastAction!==null){const u=this.calculateReward(i,a,s);this.updateQTable(this.lastState,this.lastAction,u,l)}const c=this.chooseAction(l);this.applyAction(c,t),this.epsilon=Math.max(Kk,this.epsilon*Vk),this.lastState=l,this.lastAction=c}reset(){this.qTable.clear(),this.epsilon=qS,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let eA=new qk;function Zk(e){Wk(e),Yk(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=Os+(Dr-Os)*.3,e.ecosystem.preyProcreationCooldown=ks+(Nr-ks)*.3,e.ecosystem.preyHungerIncreasePerHour=Fs+(Uo-Fs)*.3,e.ecosystem.predatorGestationPeriod=bs+(Mr-bs)*.3,e.ecosystem.predatorProcreationCooldown=Bs+(Or-Bs)*.3,e.ecosystem.predatorHungerIncreasePerHour=Ls+(Ho-Ls)*.3,e.ecosystem.berryBushSpreadChance=to+(hl-to)*.7),eA.step(e)}function Qk(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<zk)&&(e.ecosystem.lastUpdateTime=e.time,Zk(e))}function Jk(){return eA.getStats()}function eb(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function tb(e){const{gameState:t}=e,n=t.time,i=t.scheduledEvents.filter(s=>s.scheduledTime<=n),a=t.scheduledEvents.filter(s=>s.scheduledTime>n);t.scheduledEvents=a;for(const s of i)switch(s.type){case"ranged-impact":{const l=t.entities.entities[s.data.targetId];if(!l||l.hitpoints<=0)continue;l.hitpoints-=s.data.damage,l.movementSlowdown={modifier:cu,endTime:t.time+du};const c=ze(s.data.attackerPosition,l.position,t.mapDimensions.width,t.mapDimensions.height),u=Et(c,s.data.pushbackForce);l.forces.push(u),Ge(t,Te.Hit,l.position,Ve,l.id),l.hitpoints<=0?Ne(e,Ae.HumanDeath,l.position):Ne(e,Ae.Attack,l.position);break}}}function nb(e){var s,l;const{gameState:t}=e,i=t.search.human.all(),a=new Set;for(const c of i)c.leaderId&&c.leaderId===c.id&&a.add(c.id);for(const c of a){const u=t.entities.entities[c];if(!u)continue;const f=Cn(u,t);if(f.length<vp)continue;const g=f.filter(v=>v.isAdult);if(g.length===0)continue;const m=Object.values(t.tasks).filter(v=>v.creatorEntityId===c),S=v=>m.some(T=>T.type===v);if(!S(He.HumanPlaceStorage)){const v=Wr(c,t,!0),T=op(c,t);if(v.length===0||T>dg){const _=v.length===0?Nv:$s,N=Ys(he.StorageSpot,c,t,Xi,_,u.position);N&&Ad(c,He.HumanPlaceStorage,N,t)}}if(!S(He.HumanPlaceBonfire)){const v=Gr(c,t,!0),T=Xo(c,t),_=Js(t.temperature,T,t.time,t.mapDimensions.width,t.mapDimensions.height)<qv&&v.length===0,N=v.length>0&&v.length<Math.ceil(g.length/Zv);let R;const w=f.filter(B=>Js(t.temperature,B.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<xs+5?v.every(M=>G(B.position,M.position,t.mapDimensions.width,t.mapDimensions.height)>Ws*1.5):!1);if(w.length>=3){const B=w.reduce((D,M)=>D+M.position.x,0)/w.length,O=w.reduce((D,M)=>D+M.position.y,0)/w.length;R={x:B,y:O}}if(_||N||R){const B=Ys(he.Bonfire,c,t,Xi,$s,R||u.position);B&&Ad(c,He.HumanPlaceBonfire,B,t)}}if(!S(He.HumanPlacePlantingZone)){const{ratio:v}=rp(c,t);if(v<ug){const T=Ys(he.PlantingZone,c,t,Xi,$s,u.position);T&&Ad(c,He.HumanPlacePlantingZone,T,t)}}if(!S(He.HumanPlaceBorderPost)&&(((l=(s=u.tribeControl)==null?void 0:s.armyControl)==null?void 0:l.expandBorders)??0)>=2){const T=rI(u.position,c,t);T&&Ad(c,He.HumanPlaceBorderPost,T,t)}}}function Ad(e,t,n,i){const a=`${He[t]}-${e}-${i.time.toFixed(2)}`;i.tasks[a]={id:a,type:t,creatorEntityId:e,target:n,validUntilTime:i.time+12}}const ib=1/60;function ob(e,t){const n=yt(e);n&&(e.viewportCenter=$g(e.viewportCenter,n.position,Gg*t))}function Mu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(Rp(e),e.lastAutosaveTime=n)}for(;t>0;){const n=Cu(e),i=Math.min(t,ib),a=i*(At/Rt);n.time+=a,ob(n,i),Y_(n),Qk(n),Yw(n),DP(n),z_(n),tb({gameState:n}),_M({gameState:n,deltaTime:i}),Hk({gameState:n,deltaTime:i}),Math.floor(n.time)>Math.floor(n.time-a)&&(GM(n),nb({gameState:n})),qT(n),ZO(n,i),eb(n),e=n,t-=i}return e}function tg(e,t,n){e.save();const{x:i,y:a,width:s,height:l}=t.rect,c=MI;if(e.beginPath(),e.moveTo(i+c,a),e.lineTo(i+s-c,a),e.quadraticCurveTo(i+s,a,i+s,a+c),e.lineTo(i+s,a+l-c),e.quadraticCurveTo(i+s,a+l,i+s-c,a+l),e.lineTo(i+c,a+l),e.quadraticCurveTo(i,a+l,i,a+l-c),e.lineTo(i,a+c),e.quadraticCurveTo(i,a,i+c,a),e.closePath(),e.fillStyle=t.isDisabled?OI:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*FI)+1)/2;e.strokeStyle=BI,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<jd){const f=1-u/jd;e.fillStyle=bI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=hp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?kI:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+s/2,a+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+s-4,a+l-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+s/2,a+l/2)),e.restore()}function rb(e,t,n,i){e.save(),e.font=`${lS}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const s=e.measureText(n).width,l=lS,c=s+cS*2,u=l+cS*2,f=i.x-c/2,g=e.canvas.height,m=t.y<g/2?t.y+t.height-dS:t.y-u+dS;e.fillStyle=z1,e.fillRect(f,m,c,u),e.fillStyle=j1,e.fillText(n,i.x,m+u/2+l/2),e.restore()}function sb(e,t,n){e.save();const i=yt(t),a=[{id:"fastForwardButton",action:re.FastForward,text:"FFWD [T]",currentWidth:Zi*1.3,backgroundColor:Fo,textColor:Lt,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:re.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?dd:Fo,currentWidth:t.isPaused?Zi*1.4:Zi*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:Lt},{id:"muteButton",action:re.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?dd:Fo,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:Zi,rect:{x:0,y:0,width:0,height:0},textColor:Lt},{id:"returnToIntroButton",action:re.ReturnToIntro,text:"EXIT",backgroundColor:Fo,tooltip:"Return to Main Menu [ESC]",currentWidth:Zi*.9,rect:{x:0,y:0,width:0,height:0},textColor:Lt}];if(t.uiButtons.push(...a),i){const f=_p(t,i),g=new Set(f.map(R=>R.type));let m=[{playerAction:de.Gather,buttonAction:re.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>i.isAdult===!0},{playerAction:de.Eat,buttonAction:re.CommandEat,shortcut:"F",name:"Eat"},{playerAction:de.Plant,buttonAction:re.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>i.isAdult===!0},{playerAction:de.Procreate,buttonAction:re.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>i.isAdult===!0},{playerAction:de.FeedChild,buttonAction:re.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>i.isAdult===!0},{playerAction:de.Attack,buttonAction:re.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>i.isAdult===!0&&i.leaderId===i.id},{playerAction:de.ArmyControl,buttonAction:re.OpenArmyControl,shortcut:"V",name:"Army Control",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&ki(i.id,t).length>ZP},{playerAction:de.TribeSplit,buttonAction:re.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>i.leaderId!==void 0&&i.leaderId!==i.id&&i.isAdult===!0},{playerAction:de.Build,buttonAction:re.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&ki(i.id,t).length>vp},{playerAction:de.Build,buttonAction:re.OpenRoleManager,shortcut:"U",name:"Roles",toggleKey:"roleManagement",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&mu(i,t)}];m=m.filter(R=>R.condition?R.condition():!0);const S=1,v=m.length,T=v*On+(v-1)*hr,I=S*On+(S-1)*hr,_=(n-T)/2,N=e.canvas.height-I-20;if(m.forEach((R,w)=>{const B=w%v,O=Math.floor(w/v),D=_+B*(On+hr),M=N+O*(On+hr),F=!!R.toggleKey,x=F&&t.autopilotControls.behaviors[R.toggleKey],q=!g.has(R.playerAction),z=R.playerAction===de.Build&&t.buildMenuOpen,ne=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",ie=F?`${R.name}${ne}`:R.name,Ee=x||z||R.buttonAction===re.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)?dd:Fo,le={id:`commandButton_${R.name}`,action:R.buttonAction,rect:{x:D,y:M,width:On,height:On},icon:R.buttonAction===re.OpenRoleManager?"":vu[R.playerAction],text:R.shortcut,backgroundColor:Ee,textColor:Lt,currentWidth:On,tooltip:ie,isDisabled:q,activated:x||R.buttonAction===re.CommandBuild&&z||R.buttonAction===re.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)};t.uiButtons.push(le)}),t.buildMenuOpen){const R=[{id:"buildMenu_storageSpot",action:re.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:re.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_bonfire",action:re.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:re.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:re.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"}],w=R.length,B=w*On+(w-1)*hr,O=(n-B)/2,D=N-On-hr;R.forEach((M,F)=>{const x=O+F*(On+hr),q=D,ee=M.action===re.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||M.action===re.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||M.action===re.SelectBorderPost&&t.selectedBuildingType==="borderPost"||M.action===re.SelectBonfire&&t.selectedBuildingType==="bonfire"||M.action===re.SelectRemovalTool&&t.selectedBuildingType==="removal",z={id:M.id,action:M.action,rect:{x,y:q,width:On,height:On},icon:M.icon,text:M.shortcut,backgroundColor:ee?dd:Fo,textColor:Lt,currentWidth:On,tooltip:M.name,activated:ee};t.uiButtons.push(z),tg(e,z,t.hoveredButtonId===z.id)})}}let s=n-Je;a.forEach(f=>{const g=Je,m=s-f.currentWidth;f.rect={x:m,y:g,width:f.currentWidth,height:NI},tg(e,f,t.hoveredButtonId===f.id),s-=f.currentWidth+Y1});let l=null;t.uiButtons.filter(f=>f.id.startsWith("commandButton_")||f.id.startsWith("buildMenu_")).forEach(f=>{l||(l={x:f.rect.x,y:f.rect.y,width:f.rect.width,height:f.rect.height}),l.x=Math.min(l.x,f.rect.x),l.y=Math.min(l.y,f.rect.y),l.width=Math.max(l.width,f.rect.x+f.rect.width-l.x),l.height=Math.max(l.height,f.rect.y+f.rect.height-l.y),f.id.startsWith("commandButton_")&&tg(e,f,t.hoveredButtonId===f.id)});const u=t.hoveredButtonId?t.uiButtons.find(f=>f.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&rb(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:l}}function ab(e){e.save(),e.fillStyle=tP,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=nP,e.font=`${iP}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function Fg(e,t,n,i){const a=t.x-n.width/2,s=t.y-n.height/2,l=a+e.x,c=s+e.y,u=(l%i.width+i.width)%i.width,f=(c%i.height+i.height)%i.height;return{x:u,y:f}}function ql(e,t,n,i){let a=e.x-t.x,s=e.y-t.y;return Math.abs(a)>i.width/2&&(a=a-Math.sign(a)*i.width),Math.abs(s)>i.height/2&&(s=s-Math.sign(s)*i.height),{x:a+n.width/2,y:s+n.height/2}}function Gs(e,t,n,i){const a=ql(e.position,t,n,i),l=("radius"in e?e.radius:20)+20;return a.x>=-l&&a.x<=n.width+l&&a.y>=-l&&a.y<=n.height+l}function Vn(e,t,n,i,a,...s){const l={...a.position};for(let c=-n;c<=n;c+=n)for(let u=-t;u<=t;u+=t)a.position.x=l.x+u,a.position.y=l.y+c,i(e,a,...s);a.position=l}const lb=25,cb=0,ZS=28;function tA(e,t,n,i,a,s,l,c,u,f){e.save();const{x:g,y:m}=ql(t,l,{width:c,height:u},f);e.strokeStyle=i,e.lineWidth=s,e.setLineDash(a),e.beginPath(),e.arc(g,m,n+pu,0,2*Math.PI),e.stroke(),e.restore()}function db(e,t,n,i,a,s,l){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&tA(e,m.targetEntity.position,m.targetEntity.radius,up,fp,2,i,a,s,l)}),e.font=`${Qs}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:c,y:u}=ql(n.position,i,{width:a,height:s},l);let f=0,g={};t.forEach(m=>{const S=vu[m.type];if(m.targetEntity){g[m.targetEntity.id]=(g[m.targetEntity.id]||0)+1;const v=m.targetEntity.position.x-i.x+a/2,T=m.targetEntity.position.y-i.y+s/2,I=`${S}${m.key.toUpperCase()}`,_=T-m.targetEntity.radius-pu-Qs/2-(g[m.targetEntity.id]-1)*ZS;e.fillText(I,v,_)}else{e.textAlign="left";const v=`${S}${m.key.toUpperCase()}`,T=c+lb,_=u+cb+f*ZS;e.fillText(v,T,_),f++,e.textAlign="center"}}),e.restore()}const Fe=(e,t,n,i,a,s,l)=>{s==="transparent"||i<=0||a<=0||(e.fillStyle=s,e.fillRect(Math.floor(t*l),Math.floor(n*l),Math.ceil(i*l),Math.ceil(a*l)))},QS=10,JS=10,Ei=6,zi=4,Ed=2,ub=5,Xn=4,fb=2,Kt=4,hb=2,ft=3,Es=2,Bo=0,Pl=Bo+zi-1,nn=Pl,Tt=Pl+Xn-1,gb="rgba(0, 0, 0, 0.4)",pb=4,mb=1,bp={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,i,a,s,l,c="male",u=20,f=[1,0],g=!1,m=0){const S=["dead","stunned"].includes(l),v=S?JS+4:QS,T=S?QS+4:JS+ft,I=.15,_=Math.min(i*(1-2*I)/v,a*(1-2*I)/T),N=v*_,R=T*_,w=t+(i-N)/2,B=n+(a-R)/2;e.save(),f[0]<0&&!S?(e.translate(w+N,B),e.scale(-1,1)):e.translate(w,B);const D="#D09A5A",M=u>50?"#BDBDBD":"#281808",F="#7F5C4A",x="#6B4F3A",q="#E0D8C0",ee="#A0522D",z=1-Math.max(0,Math.min(100,m))/100*.2,ne=c==="male"?1.1:.9,ie=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let Ee=ub*z*ne*ie,le=fb*z*ne*ie,te=hb*z*ie;g&&c==="female"&&(Ee*=1.5);const Y=Math.round((v-Ee)/2),X=Math.round((v-Ei)/2),V=Y-le,b=Y+Ee,W=1,se=Y+(Ee/2-W/2)-te,fe=Y+(Ee/2+W/2),Re=f[1]<-.2&&Math.abs(f[0])<.7,ge=ae=>{e.fillStyle=gb,e.beginPath();const me=v/2,$e=ae;e.ellipse(Math.floor(me*_),Math.floor($e*_),Math.max(1,Math.floor(pb*_)),Math.max(1,Math.floor(mb*_)),0,0,2*Math.PI),e.fill()},Me=(ae,me)=>{c==="male"?(Fe(e,Y,Pl+ae,Ee,Xn-Es,me,_),Fe(e,Y,Pl+Xn-Es+ae,Ee,Es,F,_)):Fe(e,Y,Pl+ae,Ee,Xn,x,_)},De=(ae,me)=>{Re?Fe(e,X,Bo+ae,Ei,zi,M,_):(Fe(e,X,Bo+ae,Ei,zi,me,_),Fe(e,X,Bo+ae,Ei,Ed,M,_),c==="female"?(Fe(e,X-1,Bo+Ed+ae,1,zi,M,_),Fe(e,X+Ei,Bo+Ed+ae,1,zi,M,_)):Fe(e,X+1,Bo+2+ae,Ei-2,zi-2,M,_))};switch(l){case"idle":{const ae=s*Math.PI*2,me=Math.sin(ae)*.5,ve=(Math.cos(ae*2)+1)*.25;ge(Tt+ft+1),Fe(e,se+me,Tt+ve,te,ft,D,_),Fe(e,fe-me,Tt+ve,te,ft,D,_),Me(ve,D),Fe(e,V,nn+ve,le,Kt,D,_),Fe(e,b,nn+ve,le,Kt,D,_),De(ve,D);break}case"walk":{const ae=s*Math.PI*2,me=Math.sin(ae)*2,ve=Math.abs(Math.cos(ae))*1;ge(Tt+ft+1),Fe(e,se+me,Tt+ve,te,ft,D,_),Fe(e,fe-me,Tt+ve,te,ft,D,_),Me(ve,D),Fe(e,V-me,nn+ve,le,Kt,D,_),Fe(e,b+me,nn+ve,le,Kt,D,_),De(ve,D);break}case"gathering":{const ae=s*Math.PI*2,me=1,$e=(Math.sin(ae)+1)/2*2,ve=me+Math.abs(Math.cos(ae))*.5;ge(Tt+ft+1),Fe(e,se,Tt+ve,te,ft-me,D,_),Fe(e,fe,Tt+ve,te,ft-me,D,_),Me(ve,D),Fe(e,V+1,nn+ve-$e,le,Kt,D,_),Fe(e,b-1,nn+ve-$e,le,Kt,D,_),De(ve,D);break}case"eat":{ge(Tt+ft+1),Fe(e,se,Tt+1,te,ft-1,D,_),Fe(e,fe,Tt+1,te,ft-1,D,_),Me(1,D);const $e=(Math.sin(s*Math.PI*4)+1)/2,ve=X+Ei/2,Qn=Bo+zi/2,tt=b+(ve-b)*$e,at=nn+1+(Qn-(nn+1))*$e;Fe(e,V,nn+1,le,Kt,D,_),Fe(e,tt,at,le,Kt,D,_),Fe(e,tt,at-1,1,1,ee,_),De(1,D);break}case"procreate":{const ae=(Math.sin(s*Math.PI*8)+1)/4,me=(Math.sin(s*Math.PI*6)+1)*.5,$e=1.5,ve=$e-me;ge(Tt+ft+1),Fe(e,se,Tt+ve,te,ft-$e,D,_),Fe(e,fe,Tt+ve,te,ft-$e,D,_),Me(ve,D),Fe(e,V,nn+ve,le,Kt,D,_),Fe(e,b,nn+ve,le,Kt,D,_),De(ve,D),e.globalAlpha=ae,Me(ve,"white"),e.globalAlpha=1;break}case"attacking":{const ae=Math.sin(s*Math.PI)*1.5,me=Math.abs(Math.sin(s*Math.PI));ge(Tt+ft+1),Fe(e,se-ae,Tt+me,te,ft,D,_),Fe(e,fe+ae*.5,Tt+me,te,ft,D,_),Me(me,D),Fe(e,V,nn+me-2,le,Kt,D,_),Fe(e,b,nn+me-2.5,le,Kt,D,_),De(me,D);break}case"defending":{ge(Tt+ft+1),Fe(e,se,Tt+1,te,ft-1,D,_),Fe(e,fe,Tt+1,te,ft-1,D,_),Me(1,D),Fe(e,V-1,nn+1-1,le,Kt,D,_),Fe(e,b+1,nn+1-1,le,Kt,D,_),De(1,D);break}case"stunned":case"dead":{const ae=l==="dead",me=ae?Math.min(1,s):0,$e=me>.5?q:D,ve=c==="male"?F:x,Qn=me>.8?"transparent":M,tt=v/2,at=T/2,fi=2;ge(T-1),Fe(e,tt-te-fi,at,te,ft,$e,_),Fe(e,tt+fi,at,te,ft,$e,_),Fe(e,tt-le-fi,at-Xn+1,le,Kt,$e,_),Fe(e,tt+fi,at-Xn+1,le,Kt,$e,_);const hn=tt-Ee/2,Hn=at-Xn/2;c==="male"?(me<.7&&Fe(e,hn,Hn+Xn-Es,Ee,Es,ve,_),Fe(e,hn,Hn,Ee,Xn-Es,$e,_)):me<.7?Fe(e,hn,Hn,Ee,Xn,ve,_):Fe(e,hn,Hn,Ee,Xn,$e,_);const hi=tt-Ei/2,gi=at-Xn/2-zi+1;if(Fe(e,hi,gi,Ei,zi,$e,_),Qn!=="transparent"&&Fe(e,hi,gi,Ei,Ed,Qn,_),ae&&me>.6){const ro="#B0A890";for(let Qo=0;Qo<3;Qo++)Fe(e,hn+1,Hn+Qo*1+1,Ee-2,.5,ro,_)}break}default:Fe(e,0,0,v,T,"magenta",_);break}e.restore()}};function yb(e,t,n,i,a){const s=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=a,e.strokeStyle=a,e.lineWidth=1.5,e.beginPath(),e.rect(s-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(s-i/2,l),e.lineTo(s-i/4,l-i/3),e.lineTo(s-i/6,l),e.moveTo(s-i/6,l),e.lineTo(s,l-i/2),e.lineTo(s+i/6,l),e.moveTo(s+i/6,l),e.lineTo(s+i/4,l-i/3),e.lineTo(s+i/2,l),e.stroke(),e.restore()}function Wl(e,t,n,i,a,s=!1,l=!1,c=!1,u=!1){i<Yg&&(n=n*.75),bp.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",a,i,[0,0],!1,0);let f,g;s?(f=B1,g=wI):l?(f=F1,g=DI):c?(f=L1,g=PI):u&&(f=U1,g=RI),f&&g&&yb(e,t,n/2,f,g)}function Sb(e,t,n,i,a,s){if(e.save(),i.length===0){e.restore();return}const l=i.length*a,c=4;let u;const f=l+(i.length-1)*c;i.length>1&&f>s?u=(s-l)/(i.length-1):u=c,i.length<=1&&(u=0);for(let g=0;g<i.length;g++){const{member:m,isPlayer:S,isHeir:v,isPartner:T,isParent:I}=i[g],_=t+g*(a+u)+a/2,N=n+a/4;Wl(e,{x:_,y:N},a,m.age,m.gender,S,v,T,I)}e.restore()}function vb(e,t,n,i,a){if(n.length===0)return;e.save();const s=Ii,l=" 00",c=" 00";e.font=`${Hh}px "Press Start 2P", Arial`;const u=e.measureText(l).width,f=e.measureText(c).width,g=Ii+jn+Ii+jn+Ii+Po+u+Ii/2+Po+f,m=n.length*cd+(n.length-1)*sS,S=a-m-Ii;e.fillStyle=G1,e.fillRect(s,S,g,m);for(let v=0;v<n.length;v++){const T=n[v],I=S+v*(cd+sS),_=I+cd/2;T.isPlayerTribe&&(e.fillStyle=H1,e.fillRect(s,I,g,cd));let N=s+Ii;if(e.font=`${jn}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillText(T.tribeBadge,N,_-jn/4),N+=jn+Ii,!T.isPlayerTribe){const R=T.diplomacyStatus===Ft.Friendly?"":"",w=`diplomacyButton_${T.leaderId}`,B={x:N-2,y:_-jn/2-2,width:jn+4,height:jn+4},O={id:w,action:re.ToggleDiplomacy,rect:B,text:"",icon:R,backgroundColor:"transparent",textColor:"white",currentWidth:jn,tooltip:`Toggle diplomacy with this tribe (Currently: ${T.diplomacyStatus})`,targetTribeId:T.leaderId};t.uiButtons.push(O),t.hoveredButtonId===w&&(e.fillStyle=hp,e.globalAlpha=.5,e.fillRect(B.x,B.y,B.width,B.height),e.globalAlpha=1),e.font=`${jn*.8}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="center",e.fillText(R,N+jn/2,_)}N+=jn+Ii,T.adultCount>0&&(Wl(e,{x:N+Po/2,y:_},Po,25,"male"),N+=Po/2,e.font=`${Hh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${T.adultCount}`,N,_),N+=e.measureText(` ${T.adultCount}`).width+Ii/2),T.childCount>0&&(Wl(e,{x:N+Po/2,y:_},Po,1,"female"),N+=Po/2,e.font=`${Hh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${T.childCount}`,N,_))}e.restore()}function Ib(e,t,n,i,a){const s=GI,l=$I,c=t+i-s-l,u=n+l;e.save(),e.lineWidth=2,e.strokeStyle=a?hP:fP,e.beginPath();const f=5;e.moveTo(c+f,u+f),e.lineTo(c+s-f,u+s-f),e.moveTo(c+s-f,u+f),e.lineTo(c+f,u+s-f),e.stroke(),e.restore()}function Tb(e,t,n,i){const{tutorialState:a,tutorial:s}=t;if(a.transitionState===sn.INACTIVE)return;const l=s.steps[a.currentStepIndex];if(!l)return;e.save(),e.globalAlpha=a.transitionAlpha;const c=oP,u=rP,f=sP,g=`${xh}px "Press Start 2P", Arial`,m=`${hS}px "Press Start 2P", Arial`,S=lP,v=hS*1.5;e.font=m;const T=l.text.split(" ");let I="";const _=[];for(let q=0;q<T.length;q++){const ee=I+T[q]+" ";e.measureText(ee).width>c-u*2&&q>0?(_.push(I),I=T[q]+" "):I=ee}_.push(I);const N=u*2+xh+u/2+_.length*v,R=(n-c)/2,w=i-N-160;e.fillStyle=aP,e.beginPath(),e.moveTo(R+f,w),e.lineTo(R+c-f,w),e.quadraticCurveTo(R+c,w,R+c,w+f),e.lineTo(R+c,w+N-f),e.quadraticCurveTo(R+c,w+N,R+c-f,w+N),e.lineTo(R+f,w+N),e.quadraticCurveTo(R,w+N,R,w+N-f),e.lineTo(R,w+f),e.quadraticCurveTo(R,w,R+f,w),e.closePath(),e.fill(),e.fillStyle=S,e.textAlign="center",e.textBaseline="top",e.font=g,e.fillText(l.title,R+c/2,w+u),e.font=m;let B=w+u+xh+u/2;for(const q of _)e.fillText(q,R+c/2,B),B+=v;const O=t.hoveredButtonId==="tutorial-dismiss";Ib(e,R,w,c,O),e.restore();const D=GI,M=$I,F=R+c-D-M,x=w+M;return{x:F,y:x,width:D,height:D}}function ng(e,t,n){e.save();const i=uP,a={x:t.x-i,y:t.y-i,width:t.width+i*2,height:t.height+i*2};e.strokeStyle=UI,e.lineWidth=HI+Math.sin(n*gp)*1.5,e.setLineDash([8,8]),e.strokeRect(a.x,a.y,a.width,a.height),e.restore()}function Ab(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const nA=10,Eb=3,ev=nA*.7;function Cb(e,t){const{position:n,food:i,maxFood:a}=t;if(e.beginPath(),e.arc(n.x,n.y,nA,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),i.length>0){const s=Math.PI*2/Math.min(i.length,a);for(let l=0;l<i.length;l++){const c=l*s,u=n.x+ev*Math.cos(c),f=n.y+ev*Math.sin(c);e.beginPath(),e.arc(u,f,Eb,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const tv=(e,t,n=70,i=50)=>{const a=e>>t&255;return`hsl(${Math.floor(a/255*360)}, ${n}%, ${i}%)`},_b=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[i,a,s]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${i}, ${a}%, ${Math.max(0,s-t)}%)`},Cd=(e,t,n,i,a,s,l,c=!1)=>{e.save(),e.translate(t,n),e.rotate(s),e.fillStyle=c?_b(l,15):l,e.beginPath(),e.roundRect(-i/2,0,i,a,i/2),e.fill(),e.restore()},ig=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),i=75;if(!n)return`hsl(0, 0%, ${i}%)`;const[,a,s,l]=n.map(Number),c=s*(1-t),u=l+(i-l)*t;return`hsl(${a}, ${c}%, ${u}%)`},iA={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,i,a,s,l,c={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=i*.15,f=t+i/2,g=n+a/2,m=i-u*2,S=a-u*2,{gender:v,age:T,direction:I,isPregnant:_,hungryLevel:N,geneCode:R}=c,w=.8+Math.min(T,10)/10*.4,B=v==="male"?1.05:.95,O=1-N/100*.3,D=m*.5*O*w*B;let M=S*.3*w*B;const F=m*.15*w*B,x=D*.2,q=S*.3,ee=tv(R,0,30,50);let z=tv(R,8,50,40);if(T>45){const ge=Math.min(1,(T-45)/15);z=ig(z,ge)}e.translate(f,g),I[0]<0&&e.scale(-1,1);const ne=Math.sin(s*Math.PI*2),ie=Math.cos(s*Math.PI*2),Ee=q+M*.2;if(l==="dead"){const ge=Math.min(s,1);e.translate(0,S*.2),e.rotate(Math.PI/2);const Me=ig(z,ge),De=ig(ee,ge);e.globalAlpha=.5+ge*.5,e.strokeStyle=Me,e.lineWidth=x*.5,e.beginPath(),e.moveTo(-D*.4,0),e.lineTo(D*.4,0),e.stroke();for(let ae=-1;ae<=1;ae+=1)e.beginPath(),e.arc(0,0,M*.4,Math.PI*.4*ae-Math.PI*.2,Math.PI*.4*ae+Math.PI*.2),e.stroke();e.fillStyle=De,e.beginPath(),e.arc(D*.5,0,F,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(D*.55,0,F*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,Ee,D*.7,D*.25,0,0,2*Math.PI),e.fill();let le=0,te=0,Y=0,X=0,V=0,b=0;switch(l){case"idle":te=ne*(S*.02),Y=ne*.05,X=-ne*.05,V=-ne*.05,b=ne*.05;break;case"walk":te=Math.abs(ie)*(S*-.04),Y=ne*.7,X=-ne*.7,V=-ne*.7,b=ne*.7;break;case"eat":le=S*.1,te=S*.05,le+=ne*(S*.02);break;case"procreate":te=S*.05;const ge=(1-ie)*-m*.05;e.translate(ge,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}_&&v==="female"&&(M*=1.6);const W=te,se=W-M*.2;Cd(e,D*-.35,se,x,q,V,z,!0),Cd(e,D*.35,se,x,q,b,z,!0),e.fillStyle=z,e.beginPath(),e.ellipse(0,W,D/2,M/2,0,0,2*Math.PI),e.fill();const fe=D*.45,Re=se+le;e.fillStyle=ee,e.beginPath(),e.arc(fe,Re,F,0,Math.PI*2),e.fill(),I[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(fe+F*.3,Re-F*.2,F*.15,0,Math.PI*2),e.fill()),Cd(e,D*-.35,se,x,q,Y,z),Cd(e,D*.35,se,x,q,X,z),e.restore()}};function wb(e,t){let[n,i,a]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),i=Math.max(0,i-t),a=Math.max(0,a-t),`rgb(${n}, ${i}, ${a})`}function Rb(e){const t=(e&16711680)>>16,n=(e&65280)>>8,i=e&255,a=`rgb(${t}, ${n}, ${i})`,s=wb(a,40),l=(e&255)%100+50,c=(e>>8&255)%100,u=(e>>16&255)%100,f=`rgb(${l}, ${c}, ${u})`,g=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:a,darkerFurColor:s,skinColor:f,eyeColor:g}}const oA={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,i,a,s,l,c={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:f,direction:g,isPregnant:m,hungryLevel:S,geneCode:v}=c;e.save();const T=i*.15,I=Math.max(1,Math.floor((i-T*2)/10)),_=g[0]<0;e.translate(t+i/2,n+a/2),_&&e.scale(-1,1);const N=Rb(v),R=.8+Math.min(f,20)/20*.4,w=u==="male"?1.05:.95,B=1-S/100*.25,O=R*w*B,D=Math.max(0,Math.min(1,(f-15)/5));e.filter=`grayscale(${D})`;const M=N.furColor,F=N.darkerFurColor,x=N.eyeColor,q="#FFFFFF",ee="#c75c5c",z="#E0E0E0",ne="#A0A0A0",ie=a/2-2*I,Ee=Math.sin(s*Math.PI*2),le=Math.abs(Ee);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,ie,I*4,I,0,0,2*Math.PI),e.fill(),e.filter="none",l==="dead"){const tt=Math.min(1,s*2);e.save(),e.translate(0,ie-I*3),e.rotate(-Math.PI/2);const at=(fi,hn,Hn,hi,gi=!1)=>{e.fillStyle=gi?ne:z,e.fillRect(fi*I,hn*I,Hn*I,hi*I)};tt<1&&(e.globalAlpha=1-tt,e.fillStyle=M,e.beginPath(),e.ellipse(0,0,I*3,I*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),tt>0&&(e.globalAlpha=tt,at(-1,-4,2,2),at(1,-3.5,1,1,!0),at(-.5,-2,1,5,!0),at(-2.5,-1,5,.5),at(-2.5,0,5,.5),at(-2.5,1,5,.5),at(-3,-2,-1,2,!0),at(3,-2,1,2),at(-3,2,-1,2,!0),at(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=M;let te=0,Y=0,X=0,V=[0,0,0,0];switch(l){case"idle":te=Ee*I*.1;break;case"walk":const tt=Math.sin(s*Math.PI*4);te=Math.abs(tt)*-I*.5,V=[tt*I,-tt*I,-tt*I,tt*I];break;case"attacking":const at=Math.sin(s*Math.PI*4);Y=I*2+at*I,X=I*2,te=I;break;case"eat":X=I*3+le*I,te=I*1.5,e.fillStyle=ee,e.fillRect(-I,ie-I,I*2,I);break;case"procreate":te=Math.sin(s*Math.PI*8)*I*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let hn=0;hn<5;hn++){const Hn=(Math.random()-.5)*I*8,hi=ie+(Math.random()-.5)*I*2;le>.5&&e.fillRect(Hn,hi,I*.5,I*.5)}break}const b=I*3*O*(m?1.3:1),W=I*5*O,se=-W/1.5,fe=ie-b-I*2.5+te;e.fillStyle=M,e.beginPath(),e.moveTo(se-I*.5,fe+b*.5),e.quadraticCurveTo(se-I*3,fe-I,se-I*2+Ee*I,fe+b+I),e.fill();const Re=I*1.2*O,ge=I*3*O,Me=I*2.5*O,De=se+W*.8,ae=se+W*.2;e.fillStyle=F,e.fillRect(ae,ie-Me,Re,Me+V[2]),e.fillRect(De,ie-ge,Re,ge+V[0]),e.fillStyle=M,e.beginPath(),e.moveTo(se,fe+b),e.lineTo(se,fe+I),e.quadraticCurveTo(se+W/2,fe,se+W,fe+I),e.lineTo(se+W,fe+b),e.fill(),e.fillStyle=M,e.fillRect(ae+I/2,ie-Me,Re,Me+V[3]),e.fillRect(De+I/2,ie-ge,Re,ge+V[1]);const me=I*3.5*O,$e=se+W-me*.3+Y,ve=fe-me*.3+X;e.fillStyle=M,e.beginPath(),e.arc($e,ve,me/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse($e+me*.4,ve+me*.2,I*1.5,I,0,0,Math.PI*2),e.fill(),g[1]>=0&&(e.fillStyle=x,e.fillRect($e+I*.5,ve-I*.5,I*.5,I*.5),l==="attacking"&&(e.fillStyle=q,e.fillRect($e+me*.5,ve+me*.4,I,I*.4))),e.fillStyle=F,e.beginPath(),e.moveTo($e-me*.4,ve-me*.3),e.lineTo($e,ve-me*.7),e.lineTo($e,ve-me*.2),e.fill(),e.restore()}},Pb=9;function Db(e,t){const{position:n,gender:i,age:a,decayProgress:s,food:l,radius:c,originalEntityType:u,geneCode:f}=t;if(e.save(),e.globalAlpha=1-s,u==="human"?bp.render(e,n.x-c,n.y-c,c*2,c*2,s,"dead",i,a,[0,0],!1,0):u==="prey"?iA.render(e,n.x-c,n.y-c,c*2,c*2,s,"dead",{gender:i,age:a,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}):u==="predator"&&oA.render(e,n.x-c,n.y-c,c*2,c*2,s,"dead",{gender:i,age:a,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}),e.restore(),l.length>0){e.save(),e.font=`${Pb}px Arial`,e.textAlign="center",e.textBaseline="middle";const g=Ct*.9,m=Math.PI/Fv*3;l.forEach((S,v)=>{const T=v*m,I=n.x+g*Math.cos(T)*Math.atan2(v,v),_=n.y+g*Math.sin(T)*Math.atan2(v,v),N=ep[S.type];e.fillText(N,I,_)}),e.restore()}}function $o(e,t,n,i,a,s,l,c){e.save(),e.fillStyle=l,e.fillRect(t,n,i,a),e.fillStyle=c,e.fillRect(t,n,i*Math.max(0,s),a),e.restore()}function Nb(e,t,n,i,a,s){if(e.save(),i.length===0){e.restore();return}const l=i.length*a;let c;l>s||l+(i.length-1)*4>s?c=(s-l)/(i.length-1):c=4,i.length===1&&(c=0);for(let u=0;u<i.length;u++){const f=ep[i[u].type];e.fillText(f,t+u*(a+c),n)}e.restore()}function Mb(e,t,n,i,a){const s=t.autopilotControls.hoveredAutopilotAction;if(!s)return;let l,c=Ct/2;const u=vu[s.action],f=lT[s.action],g=`${u} ${f}`;if("targetEntityId"in s){const m=t.entities.entities[s.targetEntityId];m&&(l=m.position,c=m.radius)}else"position"in s&&(l=s.position);if(l){tA(e,l,c,up,fp,2,n,i,a,t.mapDimensions),e.save(),e.font=`${Qs}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:S}=ql(l,n,{width:i,height:a},t.mapDimensions),v=S-c-pu-Qs/2;e.fillText(g,m,v),e.restore()}}function Ob(e,t,n,i,a){e.save();const s=(Math.sin(a*gp)+1)/2,l=n+pu+s*5;e.strokeStyle=up,e.lineWidth=2,e.setLineDash(fp),e.beginPath(),e.arc(t.x,t.y,l,0,Math.PI*2),e.stroke(),e.setLineDash([]);const c=vu[i],u=lT[i];if(c){e.font=`${Qs*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const f=t.y-l-25;e.fillText(c,t.x,f),e.font=`${Qs*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,f+25)}e.restore()}function kb(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(yt(t)&&n){let a,s=15;if("position"in n)a=n.position;else if("targetEntityId"in n){const l=t.entities.entities[n.targetEntityId];l&&(a=l.position,s=l.radius||(l.type==="building"?20:30))}if(a){const l=(c,u)=>{Ob(c,u.position,s,n.action,t.time)};Vn(e,t.mapDimensions.width,t.mapDimensions.height,l,{position:{...a}},a,s+30)}}}function nv(e,t,n,i,a,s,l=!0){const c=t.split(" ");let u="";const f=[];for(let g=0;g<c.length;g++){const m=u+c[g]+" ";e.measureText(m).width>a&&g>0?(f.push(u),u=c[g]+" "):u=m}if(f.push(u),l)for(let g=0;g<f.length;g++)e.fillText(f[g],n,i+g*s);return f.length*s}function bb(e){return 1-Math.pow(1-e,3)}function Bb(e,t,n,i){t.notificationButtonRects={dismiss:{},view:{}};const a=t.notifications.filter(l=>!l.isDismissed);if(a.length===0)return;e.save();let s=i-AP;for(const l of a){const c=n-fd-gr;e.font=`${Wh}px "Press Start 2P", Arial`;const u=c+gr,f=fd-gr*2,g=nv(e,l.message,-9999,-9999,f,Wh*1.2,!1),m=gr*2+g+Ti,S=s-m,v=Date.now()-l.creationTime,T=Math.min(v/TP,1),I=bb(T),_=i,N=_+(S-_)*I;e.fillStyle=pP,e.beginPath(),e.roundRect(c,N,fd,m,gP),e.fill(),e.fillStyle=mP,e.textBaseline="top",nv(e,l.message,u,N+gr,f,Wh*1.2,!0);const R=N+m-Ti-gr/2,w=c+fd-Ti-gr/2,B={x:w,y:R,width:Ti,height:Ti};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[l.id]=B);const O=t.hoveredButtonId===`notification-dismiss-${l.id}`;if(e.fillStyle=O?mS:yP,e.font=`${Ti}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",B.x+B.width/2,B.y+B.height/2),l.targetEntityIds||l.targetPosition||l.targetArea||l.targetRadius){const F={x:w-Ti-pS,y:R,width:Ti,height:Ti};t.notificationButtonRects&&(t.notificationButtonRects.view[l.id]=F);const x=t.hoveredButtonId===`notification-view-${l.id}`;e.fillStyle=x?mS:SP,e.font=`${Ti*(x?1.5:1.2)}px Arial`,e.fillText("",F.x+F.width/2,F.y+F.height/2)}s-=m+pS}e.restore()}function Fb(e){return e.length===0?0:e.reduce((n,i)=>n+i,0)/e.length}function og(e,t,n,i,a,s,l,c){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(i,a,s,l),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(i,a,s,l);const u=Fb(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,i+Je,a+Je+8);const f=Math.max(...n,1),g=n.map(m=>m/f*l);if(e.beginPath(),e.strokeStyle=c,e.lineWidth=2,g.length>1){e.moveTo(i,a+l-g[0]);for(let m=1;m<g.length;m++){const S=i+m/(g.length-1)*s,v=a+l-g[m];e.lineTo(S,v)}}else if(g.length===1){const m=a+l-g[0];e.moveTo(i,m),e.lineTo(i+s,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${f.toFixed(2)}ms`,i+s-Je,a+Je+8),e.restore()}function Lb(e,t,n){const{performanceMetrics:i}=t;if(!i)return;const a=280,s=240,l=n-a-Je,c=Je+nt*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(l,c,a,s),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(l,c,a,s),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=c+Je+5;const f=l+Je;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",f,u),u+=25,e.fillStyle="white",e.font="12px monospace";const g=Ub(t);e.fillText(`FPS: ${g.toFixed(1)}`,f,u),u+=20;const m=a-Je*2,S=45,v=10;og(e,"Render",rg(t,"renderTime"),f,u,m,S,"#4CAF50"),u+=S+v,og(e,"World Update",rg(t,"worldUpdateTime"),f,u,m,S,"#2196F3"),u+=S+v,og(e,"AI Update",rg(t,"aiUpdateTime"),f,u,m,S,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",l+a/2,c+s-10),e.restore()}function Ub(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(At/Rt);return t.history.filter(s=>n-s.bucketTime/(At/Rt)<1).length}function Hb(e,t){if(e.length===0)return[];const n=new Map;for(const s of e){const l=Math.floor(s.bucketTime/(At/Rt));n.set(l,(n.get(l)||0)+s[t])}return Array.from(n.keys()).sort().map(s=>n.get(s)).slice(0,-1).slice(1).reverse()}function rg(e,t){return Hb(e.performanceMetrics.history,t)}function Gb(e,t,n,i){const{debugCharacterId:a,time:s}=t,l=500,c=Math.min(i*.9,800),u=n-l-10,f=Je+nt*2;t.debugPanelRect={x:u,y:f,width:l,height:c},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(u,f,l,c),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(u,f,l,c),e.fillStyle="white",e.font="12px monospace",e.textAlign="left",e.textBaseline="top";let g=f+20;const m=u+15;if(e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Behavior Tree Debugger",m,g),g+=25,!a){e.fillStyle="#888",e.font="12px monospace",e.fillText("No character selected for debugging.",m,g),e.fillText("Click on a character to inspect behavior.",m,g+20),e.restore();return}const S=t.entities.entities[a];if(!S){e.fillStyle="#ff4444",e.font="12px monospace",e.fillText(`Character #${a} not found (might be dead).`,m,g),e.restore();return}if(!S.aiBlackboard){e.fillStyle="#ffaa44",e.font="12px monospace",e.fillText(`Character #${a} has no AI Blackboard.`,m,g),e.restore();return}e.fillStyle="white",e.font="12px monospace",e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,m,g),g+=20,$b(e,S,s,m,g,l-30,c-(g-f)-10,t),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '~' to toggle this debugger",u+l/2,f+c-10),e.restore()}function $b(e,t,n,i,a,s,l,c){var N,R;const u=t.aiBlackboard.nodeExecutionData,f=t.type==="human"?uT:t.type==="predator"?hT:t.type==="prey"?fT:null;if(!f)return;const g=((N=c.debugPanelScroll)==null?void 0:N.x)??0,m=((R=c.debugPanelScroll)==null?void 0:R.y)??0;e.save(),e.beginPath(),e.rect(i-5,a,s+10,l),e.clip(),e.translate(-g,-m),e.font=`${X1}px Arial`,e.textAlign="left",e.textBaseline="top";const S=w=>{switch(w){case A.SUCCESS:return K1;case A.FAILURE:return q1;case A.RUNNING:return Z1;case A.NOT_EVALUATED:case null:default:return Q1}};let v=0;const T=(w,B)=>{if(!w.name||!u[w.name])return B;let O=B;const D=O+$h>a+m&&O<a+l+m,M=u[w.name],F=i+(w.depth??0)*V1;let x=A.NOT_EVALUATED,q=uS,ee="";if(M){x=M.status,ee=M.debugInfo;const te=eP/Rt*At,Y=n-M.lastExecuted,X=Math.max(0,1-Y/te);q=h_(uS,J1,X),Y>Xs&&(x=A.NOT_EVALUATED)}const z=S(x),ne=` ${w.name}`+(ee?`: ${ee}`:""),ie=e.measureText(ne).width,Ee=tl+fS,le=F-i+8+ie+Ee;if(le>v&&(v=le),D&&(e.fillStyle=z,e.fillText("",F,O),e.fillStyle=q,e.fillText(ne,F+8,O),M&&M.executionHistory.length>0)){const{executionHistory:te}=M,Y=LI/Rt*At,X=n,V=X-Y,b=i+s-tl-fS;let W=b;const se=O+($h-ud)/2,fe=te.filter(ve=>ve.time<V);let Re=fe.length>0?fe[fe.length-1].status:null,ge=V;const Me=te.filter(ve=>ve.time>=V&&ve.time<=X),De=tl/Y;e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(b,se,tl,ud);for(const ve of Me){const tt=(ve.time-ge)*De;tt>0&&(e.fillStyle=S(Re),e.fillRect(W,se,tt,ud),W+=tt),Re=ve.status,ge=ve.time}n-ge>Xs&&(Re=A.NOT_EVALUATED);const me=(X-ge)*De;e.fillStyle=S(Re);const $e=b+tl-W;e.fillRect(W,se,Math.min(me,$e),ud)}if(O+=$h,w.children)for(const te of w.children)O=T(te,O);else w.child&&(O=T(w.child,O));return O},_=T(f,a)-a;c.debugPanelContentSize={width:v,height:_},e.restore()}function tu(e,t,n,i,a,s,l){e.save();const{position:c}=t;e.strokeStyle=i,e.lineWidth=a+Math.sin(l*s)*(a/2),e.setLineDash([8,8]),e.beginPath(),e.arc(c.x,c.y,n,0,2*Math.PI),e.stroke(),e.restore()}function xb(e,t,n,i){if(!t.debugCharacterId)return;const a=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!a)return;const s=Qt(a,t);if(!s||!s.aiBlackboard)return;const l=Zo(s.aiBlackboard),c=500,u=Math.min(i*.9,700),f=n-c-10,g=Je+nt*2;t.debugPanelRect={x:f,y:g,width:c,height:u},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(f,g,c,u),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(f,g,c,u),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";const m=14,S=f+15;let v=g+20;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Supply Chain Debugger",S,v),v+=25,e.fillStyle="#aaaaaa",e.font="11px monospace",e.fillText(`Tribe Leader: ${s.isPlayer?"Player":"#"+s.id}`,S,v),v+=m,e.fillText(`Current Time: ${t.time.toFixed(1)}h`,S,v),v+=20;const T=v,I=u-(T-g)-30;Wb(e,t,l,S,T,c-30,I,m),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+4' to toggle this debugger",f+c/2,g+u-10),e.restore()}function Wb(e,t,n,i,a,s,l,c){var T,I;const u=((T=t.debugPanelScroll)==null?void 0:T.x)??0,f=((I=t.debugPanelScroll)==null?void 0:I.y)??0;e.save(),e.beginPath(),e.rect(i-5,a,s+10,l),e.clip(),e.translate(-u,-f);let g=a;e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(` Active Demands (${n.length})`,i,g),g+=18,n.length===0?(e.fillStyle="#888888",e.font="11px monospace",e.fillText("No active demands",i,g),g+=c):[...n].sort((N,R)=>R.updatedAt-N.updatedAt).forEach((N,R)=>{const w=t.entities.entities[N.requesterId];let B=w?w.isPlayer?"Player":`Human #${w.id}`:`Unknown #${N.requesterId}`;w&&(B+=` (Food: ${w.food.length}), Active action: ${w.activeAction||"idle"}`);let O="None";if(N.claimedBy){const x=t.entities.entities[N.claimedBy];O=x?x.isPlayer?"Player":`Human #${x.id}`:`Unknown #${N.claimedBy}`,x&&(O+=" (Food: "+x.food.length+"), Active action: "+(x.activeAction||"idle")+")")}const D=t.time-N.updatedAt,M=g,F=c*5+10;e.fillStyle=N.claimedBy?"rgba(50, 100, 50, 0.3)":"rgba(50, 50, 50, 0.3)",e.fillRect(i-5,M-2,s,F),e.strokeStyle=N.claimedBy?"#44ff44":"#666666",e.lineWidth=1,e.strokeRect(i-5,M-2,s,F),e.fillStyle="#ffaa00",e.font="bold 12px monospace",e.fillText(`#${R+1}`,i,g),g+=c,e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Requester: ${B}`,i+10,g),g+=c,e.fillStyle="#ffff88",e.fillText(`Resource: ${N.resourceType}`,i+10,g),g+=c,e.fillStyle=N.claimedBy?"#44ff44":"#ff8844",e.fillText(`Status: ${N.claimedBy?"Claimed":"Pending"}`,i+10,g),g+=c,N.claimedBy?(e.fillStyle="#aaffaa",e.fillText(`Mover: ${O}`,i+10,g)):(e.fillStyle="#888888",e.fillText(`Mover: ${O}`,i+10,g)),g+=c,e.fillStyle="#aaaaaa",e.font="10px monospace",e.fillText(`Updated: ${D.toFixed(1)}h ago`,i+10,g),g+=c+5}),g+=10,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Statistics",i,g),g+=18;const m=n.filter(_=>!_.claimedBy).length,S=n.filter(_=>_.claimedBy).length;e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Total Demands: ${n.length}`,i,g),g+=c,e.fillStyle="#ff8844",e.fillText(`Pending: ${m}`,i,g),g+=c,e.fillStyle="#44ff44",e.fillText(`Claimed: ${S}`,i,g),g+=c;const v=g-a;t.debugPanelContentSize={width:s,height:v},e.restore()}function Yb(e,t,n){if(!n.debugCharacterId)return;const i=n.search.human.byProperty("id",n.debugCharacterId)[0];if(!i)return;const a=Qt(i,n);if(!a||!a.aiBlackboard||a.id!==t.leaderId)return;Zo(a.aiBlackboard).some(l=>l.requesterId===t.id)&&tu(e,t,t.radius+15,"#ff6644",3,2,n.time),t.tribeRole===J.Mover&&tu(e,t,t.radius+15,"#44ff44",3,2,n.time)}const zb={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"};function jb(e,t){var c;const{radius:n,position:i,activeAction:a="idle"}=t,s=((c=t.stateMachine)==null?void 0:c[0])||"N/A",l=t.isAdult?Ct+20:Ct*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${a}`,i.x,i.y-l),e.fillText(`State: ${s}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,i.x,i.y-l+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function Xb(e,t,n,i,a){e.save(),e.font=`${wl}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(i?Ct:ua)-wl-a),e.restore()}function Vb(e,t,n,i,a){const s=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=a,e.strokeStyle=a,e.lineWidth=1.5,e.beginPath(),e.rect(s-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(s-i/2,l),e.lineTo(s-i/4,l-i/3),e.lineTo(s-i/6,l),e.moveTo(s-i/6,l),e.lineTo(s,l-i/2),e.lineTo(s+i/6,l),e.moveTo(s+i/6,l),e.lineTo(s+i/4,l-i/3),e.lineTo(s+i/2,l),e.stroke(),e.restore()}function Kb(e,t,n){var c,u;const{position:i,radius:a}=t,s=i.x-Gh/2,l=i.y-a-$1;if(((c=t.stateMachine)==null?void 0:c[0])===Vo){const f=t.stateMachine[1],g=n-f.attackStartTime,m=Math.min(g/au,1);$o(e,s,l,Gh,aS,m,Go,x1)}else if((u=t.attackCooldown)!=null&&u.melee&&t.attackCooldown.melee>0){const f=1-t.attackCooldown.melee/lu;$o(e,s,l,Gh,aS,f,Go,W1)}}function qb(e,t,n=!1,i=!1,a=!1,s=!1,l=!1,c=!1,u=!1,f){var N,R;const{position:g,activeAction:m="idle"}=t,S=t.isAdult?Ct:Ct*.6,v=zb[m]||"idle";bp.render(e,g.x-S,g.y-S,S*2,S*2,t.animationProgress||0,v,t.gender,t.age,[t.direction.x,t.direction.y],t.isPregnant??!1,t.hunger),c&&(e.save(),e.strokeStyle=A1,e.lineWidth=2,e.beginPath(),e.arc(g.x,g.y,S+3,0,2*Math.PI),e.stroke(),e.restore());let T,I;if(l?(T=C1,I=DI):n?(T=E1,I=wI):a?(T=_1,I=T1):i?(T=w1,I=RI):s&&(T=R1,I=PI),T&&I&&Vb(e,g,S,T,I),(N=t.tribeInfo)!=null&&N.tribeBadge&&Xb(e,g,t.tribeInfo.tribeBadge,t.isAdult??!1,T??0),t.heldItem){const w=np[t.heldItem.type],B=(R=t.tribeInfo)!=null&&R.tribeBadge?wl:0;e.save(),e.font=`${wl}px Arial`,e.textAlign="center",e.textBaseline="middle";const O=g.y-(t.isAdult?Ct:ua)-wl-(T??0)-B;e.fillText(w,g.x,O),e.restore()}const _=u&&(f.debugCharacterId===void 0||t.id===f.debugCharacterId);Kb(e,t,f.time),_&&jb(e,t),f.debugPanel===Ye.SupplyChain&&Yb(e,t,f)}const Zb={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"};function Qb(e,t){var c;const{radius:n,position:i,activeAction:a="idle"}=t,s=((c=t.stateMachine)==null?void 0:c[0])||"N/A",l=t.isAdult?Ct+20:Ct*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${a}`,i.x,i.y-l),e.fillText(`State: ${s}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function Jb(e,t,n=!1,i){var f,g;const{position:a,activeAction:s="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,c=Zb[s]||"idle";if(iA.render(e,a.x-l,a.y-l,l*2,l*2,t.animationProgress||0,c,{gender:t.gender,age:t.age,direction:[((f=t.direction)==null?void 0:f.x)||1,((g=t.direction)==null?void 0:g.y)||0],isPregnant:t.isPregnant??!1,hungryLevel:t.hunger,geneCode:t.geneCode}),t.hitpoints<t.maxHitpoints){const m=l*1.5,S=3,v=a.x-m/2,T=a.y-l-8;e.fillStyle="#555",e.fillRect(v,T,m,S);const I=t.hitpoints/t.maxHitpoints;e.fillStyle=I>.5?"#4CAF50":I>.25?"#FFC107":"#F44336",e.fillRect(v,T,m*I,S)}n&&(i===void 0||t.id===i)&&Qb(e,t)}const eB={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"};function tB(e,t){var c;const{radius:n,position:i,activeAction:a="idle"}=t,s=((c=t.stateMachine)==null?void 0:c[0])||"N/A",l=t.isAdult?Ct+20:Ct*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${a}`,i.x,i.y-l),e.fillText(`State: ${s}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function nB(e,t,n=!1,i){var f,g;const{position:a,activeAction:s="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,c=eB[s]||"idle";if(oA.render(e,a.x-l,a.y-l,l*2,l*2,t.animationProgress||0,c,{gender:t.gender,age:t.age,direction:[((f=t.direction)==null?void 0:f.x)||1,((g=t.direction)==null?void 0:g.y)||0],isPregnant:t.isPregnant??!1,hungryLevel:t.hunger,geneCode:t.geneCode}),t.hitpoints<t.maxHitpoints){const m=l*1.5,S=3,v=a.x-m/2,T=a.y-l-8;e.fillStyle="#555",e.fillRect(v,T,m,S);const I=t.hitpoints/t.maxHitpoints;e.fillStyle=I>.5?"#4CAF50":I>.25?"#FFC107":"#F44336",e.fillRect(v,T,m*I,S)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(a.x,a.y,l+3,0,2*Math.PI),e.stroke()),n&&(i===void 0||t.id===i)&&tB(e,t)}const rA=15;function iB(e,t,n,i,a=1.5){const s=n-t.startTime,l=Math.min(s/t.duration,1),c=1-l,f=1+Math.sin(l*Math.PI*2)*(a-1),g=rA*f;e.save(),e.globalAlpha=c,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,g),0,Math.PI*2),e.fillStyle=i,e.fill(),e.restore()}function rl(e,t,n,i,a=2){const s=n-t.startTime,l=Math.min(s/t.duration,1),c=1-l,u=rA*2*l;e.save(),e.globalAlpha=c,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=i,e.lineWidth=a,e.stroke(),e.restore()}function Yi(e,t,n,i){const a=n-t.startTime,s=Math.min(a/t.duration,1),l=1-s,c=-20*s;e.save(),e.globalAlpha=l,e.font="20px Arial",e.textAlign="center",e.fillText(i,t.position.x,t.position.y+c),e.restore()}function oB(e,t,n,i){const{width:a,height:s}=i.mapDimensions;let l=t.targetPosition;if(t.targetEntityId){const I=i.entities.entities[t.targetEntityId];I&&(l=I.position)}if(!l)return;const c=n-t.startTime,u=Math.min(c/t.duration,1);let f=l.x-t.position.x,g=l.y-t.position.y;f=f-Math.round(f/a)*a,g=g-Math.round(g/s)*s;const m={x:f,y:g},S=t.position.x+m.x*u,v=t.position.y+m.y*u,T=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(S,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(S,v+T),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function sA(e,t,n,i){switch(t.type){case Te.Procreation:Yi(e,t,n,"");break;case Te.Pregnant:iB(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Te.TargetAcquired:rl(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Te.Attack:Yi(e,t,n,"");break;case Te.Partnered:Yi(e,t,n,"");break;case Te.BushClaimed:rl(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Te.BushClaimLost:rl(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Te.Eating:Yi(e,t,n,"");break;case Te.ChildFed:Yi(e,t,n,"");break;case Te.AttackDeflected:Yi(e,t,n,"");break;case Te.AttackResisted:Yi(e,t,n,"");break;case Te.Hit:Yi(e,t,n,"");break;case Te.SeizeBuildup:rl(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Te.BorderClaim:Yi(e,t,n,"");break;case Te.Seize:rl(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Te.StoneProjectile:oB(e,t,n,i);break}}const iv=8,rB=1.5,sB=.5,ov=2,aB="#5a5a5a",lB="#7e7e7e",cB="#8B0000",dB="#FF4444",uB=6;function sg(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function Lg(e,t,n,i,a,s){const l=(t+n)*2,c=Math.floor(l/iv),u=-t/2,f=t/2,g=-n/2,m=n/2;for(let S=0;S<c;S++){const v=i+S*13,T=sg(v),I=sg(v+1);let _=S*iv,N=0,R=0;_<t?(N=u+_,R=g):_<t+n?(N=f,R=g+(_-t)):_<t*2+n?(N=f-(_-(t+n)),R=m):(N=u,R=m-(_-(t*2+n)));const w=(I-.5)*ov,B=(sg(v+2)-.5)*ov;e.beginPath();const O=rB+T*sB;a?e.fillStyle=a:e.fillStyle=T>.5?s||lB:a||aB,e.ellipse(N+w,R+B,O,O*.85,I*Math.PI,0,Math.PI*2),e.fill(),a||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function fB(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:i}=t;e.save(),e.font=`${uB}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,i.forEach(a=>{const s=a.item.type,l=(ep[s]||np[s])??"?",c={x:n.x+a.positionOffset.x,y:n.y+a.positionOffset.y};e.fillText(l,c.x,c.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function hB(e,t,n){const{position:i,width:a,height:s,constructionProgress:l,destructionProgress:c,isConstructed:u,isBeingDestroyed:f,id:g}=t;let S=qo[t.buildingType].icon;t.buildingType===he.Bonfire&&u&&(S=(t.fuelLevel??0)>0?"":"");const v=yt(n),T=v&&cn(v,t,n);e.save(),e.translate(i.x,i.y),u||(e.globalAlpha=.3+l*.7),T?Lg(e,a,s,g,cB,dB):Lg(e,a,s,g),e.globalAlpha=.5,e.font=`${Math.min(a,s,30)*.5}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=4,e.fillStyle="#FFFFFF",e.fillText(S,0,0),e.shadowBlur=0,e.restore();const I=a,_=i.x-I/2,N=i.y+s/2+K_;u?f&&$o(e,_,N,I,Yy,1-c,Go,V_):$o(e,_,N,I,Yy,l,Go,X_),(t.buildingType===he.StorageSpot||t.buildingType===he.Bonfire)&&u&&fB(e,t)}function gB(e,t,n,i,a){const s=qo[n],{width:l,height:c}=s.dimensions,u=(g,m)=>{g.save(),g.translate(m.x,m.y),g.globalAlpha=j_;const S=i?"#4CAF50":"#F44336";Lg(g,l,c,9999,S),g.font=`${Math.min(l,c)*.5}px Arial`,g.textAlign="center",g.textBaseline="middle",g.fillStyle=S,g.fillText(s.icon,0,0),g.restore()},f={position:{...t},radius:Math.max(l,c)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[]};Vn(e,a.width,a.height,(g,m)=>u(g,m.position),f)}const Ns=1,pB=20,si=4,rv=8,mB="rgba(34, 85, 34, 0.25)",yB="rgba(139, 50, 50, 0.25)",zs=new Map,SB=50;function vB(e){return e.map(t=>t.id).sort((t,n)=>t-n).join(",")}function IB(){if(zs.size>SB){const e=zs.keys().next().value;e&&zs.delete(e)}}function TB(e){const t=new Map;for(const n of e){const i=n.ownerId;i&&(t.has(i)||t.set(i,[]),t.get(i).push(n))}return t}function AB(e,t,n,i){let a=0;const s=Math.max(i.width,i.height)/2;for(const l of n){const c=e-l.position.x,u=t-l.position.y,f=c*c+u*u;f>0?a+=s*s/f:a+=100}return a}function EB(e,t,n){let i=1/0,a=1/0,s=-1/0,l=-1/0;for(const c of e)i=Math.min(i,c.position.x-t.width/2),a=Math.min(a,c.position.y-t.height/2),s=Math.max(s,c.position.x+t.width/2),l=Math.max(l,c.position.y+t.height/2);return{minX:i-n,minY:a-n,maxX:s+n,maxY:l+n}}function CB(e,t,n){const i=vB(e);if(zs.has(i))return zs.get(i);const a=n.maxX-n.minX,s=n.maxY-n.minY,l=Math.ceil(a/si),c=Math.ceil(s/si),u=[],f=[];for(let S=0;S<c;S++)u[S]=new Array(l);for(let S=0;S<c;S++)for(let v=0;v<l;v++){const T=n.minX+v*si,I=n.minY+S*si,_=AB(T,I,e,t);u[S][v]=_}for(let S=1;S<c-1;S++)for(let v=1;v<l-1;v++)if(u[S][v]>=Ns&&(u[S-1][v]<Ns||u[S+1][v]<Ns||u[S][v-1]<Ns||u[S][v+1]<Ns)){const I=n.minX+v*si,_=n.minY+S*si;f.push({x:I,y:_})}const g=RB(f),m={fieldValues:u,edgePoints:f,regions:g,bounds:n};return zs.set(i,m),IB(),m}function _B(e,t,n,i,a,s){if(t.length===0)return;e.save(),e.globalAlpha=1;const{fieldValues:l,regions:c,bounds:u}=s;wB(e,l,u,i);let f=a;for(const g of c){const m=PB(g);DB(e,m,i,f),f+=1e3}e.restore()}function wB(e,t,n,i){const a=i?yB:mB;e.save(),e.fillStyle=a,e.beginPath();for(let s=0;s<t.length;s++)for(let l=0;l<t[s].length;l++)if(t[s][l]>=Ns){const c=n.minX+l*si,u=n.minY+s*si;e.rect(c,u,si,si)}e.fill(),e.restore()}function RB(e){if(e.length===0)return[];const t=si*2,n=t,i=new Map;function a(f,g){const m=Math.floor(f/n),S=Math.floor(g/n);return`${m},${S}`}for(let f=0;f<e.length;f++){const g=a(e[f].x,e[f].y);i.has(g)||i.set(g,[]),i.get(g).push(f)}function s(f,g){const m=[],S=Math.floor(f/n),v=Math.floor(g/n);for(let T=-1;T<=1;T++)for(let I=-1;I<=1;I++){const _=`${S+T},${v+I}`,N=i.get(_);N&&m.push(...N)}return m}const l=new Set,c=[],u=t*t;for(let f=0;f<e.length;f++){if(l.has(f))continue;const g=[],m=[f];for(;m.length>0;){const S=m.shift();if(l.has(S))continue;l.add(S),g.push(e[S]);const v=s(e[S].x,e[S].y);for(const T of v){if(l.has(T))continue;const I=e[T].x-e[S].x,_=e[T].y-e[S].y;I*I+_*_<=u&&m.push(T)}}g.length>0&&c.push(g)}return c}function PB(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const i=t[t.length-1];let a=0,s=1/0;for(let l=0;l<n.length;l++){const c=n[l].x-i.x,u=n[l].y-i.y,f=c*c+u*u;f<s&&(s=f,a=l)}t.push(n.splice(a,1)[0])}return t}function DB(e,t,n,i){if(t.length===0)return;let a=0,s=0;for(let l=1;l<t.length;l++){const c=t[l-1],u=t[l],f=u.x-c.x,g=u.y-c.y,m=Math.sqrt(f*f+g*g);for(a+=m;a>=rv;){a-=rv;const S=1-a/m,v=c.x+f*S,T=c.y+g*S;NB(e,v,T,n,i+s*13),s++}}}function NB(e,t,n,i,a){const s=ag(a),l=ag(a+1),c=(l-.5)*2,u=(ag(a+2)-.5)*2;e.beginPath();const f=1.5+s*.5;i?e.fillStyle=s>.5?"#FF4444":"#8B0000":e.fillStyle=s>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+c,n+u,f,f*.85,l*Math.PI,0,Math.PI*2),e.fill(),i||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function ag(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function MB(e,t,n,i){var m,S,v;const a=t;if(!((m=a.search)!=null&&m.building))return;const l=a.search.building.all().filter(T=>T.buildingType===he.PlantingZone&&T.isConstructed);if(l.length===0)return;const c=l.filter(T=>Gs(T,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(c.length===0)return;const u=qo[he.PlantingZone].dimensions,f=TB(c),g=i?t.entities.entities[i]:void 0;for(const[T,I]of f){const _=((v=(S=g==null?void 0:g.tribeControl)==null?void 0:S.diplomacy)==null?void 0:v[T])==="Hostile",N=typeof T=="number"?T:0,R=EB(I,u,pB),w=CB(I,u,R);_B(e,I,u,_,N,w)}}const OB=.001,kB=.05,bB=12;function BB(e,t,n){const{position:i,age:a,swayOffset:s}=t,[l]=t.stateMachine??[],c=Math.min(1,Math.max(.4,a/Ko)),f=l!==An&&l!==no?Math.sin(n*OB+s)*kB:0;if(e.save(),e.translate(i.x,i.y),e.scale(c,c),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=c1,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),l===no?lg(e,10,8):l===An?(e.rotate(Math.PI/2),lg(e,10,30),e.translate(0,-25),sv(e,40,20,40,15)):(e.rotate(f),lg(e,10,30),e.translate(0,-25),e.rotate(f*.5),sv(e,40,20,40,15)),e.restore(),(l===An||l===no)&&t.wood&&t.wood.length>0){e.save(),e.font=`${bB}px Arial`,e.textAlign="center",e.textBaseline="middle";const g=t.radius*1.1,m=Math.PI*2/(gu-1);t.wood.forEach((S,v)=>{const T=v===0?0:g,I=v===0?0:(v-1)*m,_=i.x+T*Math.cos(I),N=i.y+T*Math.sin(I),R=np[S.type];e.fillText(R,_,N)}),e.restore()}}function lg(e,t,n){e.fillStyle=o1,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=r1,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function sv(e,t,n,i,a){e.fillStyle=s1,av(e,t+4,n+4,i+2,a+2),e.translate(0,-2),e.fillStyle=a1,av(e,t,n,i,a),e.fillStyle=l1,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function av(e,t,n,i,a){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-i),e.lineTo(0,-i-a),e.lineTo(n/2,-i),e.lineTo(t/2,0),e.closePath(),e.fill()}let Mo=null;function FB(e,t,n,i,a){const s=PP(t.time);if(s<=0)return;Mo||(Mo=document.createElement("canvas")),(Mo.width!==i.width||Mo.height!==i.height)&&(Mo.width=i.width,Mo.height=i.height);const l=Mo.getContext("2d");if(l){l.clearRect(0,0,i.width,i.height),l.fillStyle=`rgba(0, 0, 40, ${s*.85})`,l.fillRect(0,0,i.width,i.height),l.globalCompositeOperation="destination-out";for(const c of a){const u=ql(c.position,n,i,t.mapDimensions),f=l.createRadialGradient(u.x,u.y,0,u.x,u.y,c.radius);f.addColorStop(0,`rgba(255, 255, 255, ${c.intensity})`),f.addColorStop(1,"rgba(255, 255, 255, 0)"),l.fillStyle=f,l.beginPath(),l.arc(u.x,u.y,c.radius,0,Math.PI*2),l.fill()}l.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(Mo,0,0),e.restore()}}function lv(e,t,n,i,a,s,l){for(let c=-a.height;c<=a.height;c+=a.height)for(let u=-a.width;u<=a.width;u+=a.width){const f={x:t.x+u,y:t.y+c};Gs({position:f,radius:n},s,l,a)&&e.push({position:f,radius:n,intensity:i})}}function LB(e,t,n,i,a,s=[]){const l=yt(t),c=l?En(t,l):[],u=$r(c),{width:f,height:g}=t.mapDimensions,m=[];s.forEach(_=>{m.push({position:_,radius:30,intensity:.3})}),MB(e,t,i,l==null?void 0:l.leaderId),Object.values(t.entities.entities).sort((_,N)=>n&&_.id===t.debugCharacterId&&_.id!==N.id||_.type==="building"&&N.type!=="building"?-1:_.position.y-N.position.y||_.id-N.id).filter(_=>Gs(_,i,a,t.mapDimensions)).forEach(_=>{var N,R;if(_.type==="building"){const w=_;if(w.isConstructed){const B=w.buildingType===he.Bonfire&&(w.fuelLevel??0)>0,O=B?180:60,D=B?.9:.4;lv(m,w.position,O,D,t.mapDimensions,i,a)}if(w.buildingType===he.PlantingZone&&w.isConstructed)return;Vn(e,f,g,hB,w,t,l,t.time)}else if(_.type==="berryBush")Vn(e,f,g,Cb,_,t,l,t.time);else if(_.type==="tree")Vn(e,f,g,BB,_,t.time);else if(_.type==="human"){const w=_,B=w.id===(l==null?void 0:l.id),O=c.some(q=>q.id===w.id),D=w.id===(u==null?void 0:u.id),M=l&&(w.id===l.motherId||w.id===l.fatherId),F=l&&(((N=w.partnerIds)==null?void 0:N.includes(l.id))||((R=l.partnerIds)==null?void 0:R.includes(w.id))),x=(l==null?void 0:l.attackTargetId)===w.id;lv(m,w.position,40,.3,t.mapDimensions,i,a),Vn(e,f,g,qb,w,B,M,O,F,D,x,n,t)}else _.type==="corpse"?Vn(e,f,g,Db,_):_.type==="prey"?Vn(e,f,g,Jb,_,n,t.time,t.debugCharacterId):_.type==="predator"&&Vn(e,f,g,nB,_,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(_=>Gs(_,i,a,t.mapDimensions)).forEach(_=>{Vn(e,f,g,sA,_,t.time,t)});const I=t.notifications.filter(_=>!_.isDismissed);for(const _ of I)if(_.highlightedEntityIds&&_.renderHighlights)for(const N of _.highlightedEntityIds){const R=t.entities.entities[N];R&&Gs(R,i,a,t.mapDimensions)&&Vn(e,f,g,tu,R,EP,CP,wP,_P,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const _ of t.tutorialState.highlightedEntityIds){const N=t.entities.entities[_];N&&Gs(N,i,a,t.mapDimensions)&&Vn(e,f,g,tu,N,dP,UI,HI,gp,t.time)}FB(e,t,i,a,m)}function UB(e,t,n,i,a,s){let l=null,c=null;e.textAlign="left";let u=Je+nt;const g=t.time/(At/Rt)/iu%1,m=nl[Ds.Time],S=25,v=Je+S;e.fillText(m,Je,u+Mn/2+nt/3),$o(e,v,u,Ro,Mn,g,Go,b1),u+=Mn+Wi;const T=u+fr/2,I=u+(fr-Mn)/2,_=5;Wl(e,{x:Je*2,y:T},fr,5,n.gender,!1,!1,!1);const N=Je+fr+_,R=Ro+S-(fr+_)*2;$o(e,N,I,R,Mn,Math.floor(n.age)/Dl,Go,k1),Wl(e,{x:N+R+_+fr/2,y:T},fr,Dl,n.gender,!1,!1,!1),u+=Mn+Wi*2;const w=[],B=new Set;if(w.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),B.add(n.id),i&&!B.has(i.id)&&(w.push({member:i,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),B.add(i.id)),a.forEach(ie=>{B.has(ie.id)||(w.push({member:ie,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),B.add(ie.id))}),s.forEach(ie=>{B.has(ie.id)||(w.push({member:ie,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),B.add(ie.id))}),n.motherId&&!B.has(n.motherId)){const ie=t.entities.entities[n.motherId];ie&&(w.push({member:ie,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),B.add(ie.id))}if(n.fatherId&&!B.has(n.fatherId)){const ie=t.entities.entities[n.fatherId];ie&&(w.push({member:ie,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),B.add(ie.id))}const O=nl[Ds.Family],D=10,M=Je+nt+D,F=Ro+S-(nt+D),x=u+ld/2;e.font=`${nt}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(O,Je,x);const q=u+ld/2;Sb(e,M,q,w,ld,F),u+=ld+Wi,e.textBaseline="alphabetic";const ee=nl[Ds.Hitpoints];e.fillText(ee,Je,u+Mn/2+nt/3),$o(e,v,u,Ro,Mn,n.hitpoints/n.maxHitpoints,Go,O1),u+=Mn+Wi;const z=nl[Ds.Hunger];e.fillText(z,Je,u+Mn/2+nt/3),$o(e,v,u,Ro,Mn,(ln-n.hunger)/ln,Go,M1),l={x:Je,y:u-Wi/2,width:Ro+S,height:Mn+Wi},u+=Mn+Wi,e.textBaseline="middle";const ne=nl[Ds.Food];return e.fillText(ne,Je,u+ad/2),Nb(e,v,u+ad/2,n.food,ad,Ro),c={x:Je,y:u-Wi/5,width:Ro+S,height:ad+Wi},e.textBaseline="alphabetic",{hungerBarRect:l,foodBarRect:c}}let sl=[],cv=0;const HB=36,GB=200;function $B(e,t,n,i){const a=t.search.prey.count(),s=t.search.predator.count(),l=t.search.berryBush.count();t.time-cv>=HB&&(sl.push({time:t.time,prey:a,predators:s,bushes:l}),sl.length>GB&&(sl=sl.slice(-200)),cv=t.time);const c=Xe*qe,u=a/c*1e6,f=s/c*1e6,g=l/c*1e6,m=Jk(),S=Math.floor(t.time/(24*365)),v=Math.floor(t.time%(24*365)/24),T=Math.floor(t.time%24),I=400,_=Math.min(i*.8,600),N=n-I-10,R=Je+nt*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(N,R,I,_),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(N,R,I,_),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let w=R+20;const B=14,O=N+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",O,w),w+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${S}, Day ${v}, Hour ${T}`,O,w),w+=B,e.fillText(`Map Size: ${Xe}  ${qe} pixels`,O,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",O,w),w+=18,m&&(e.fillText(`Q-Table Size: ${m.qTableSize} entries`,O,w),w+=B,e.fillText(`Exploration Rate: ${(m.explorationRate*100).toFixed(1)}%`,O,w),w+=B);const D=sl.slice(-20);D.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",O,w),w+=30,xB(e,O,w,D),w+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",O,w),w+=18,e.fillStyle="white",e.font="12px monospace";const M=(Qi/c*1e6).toFixed(2),F=(Ji/c*1e6).toFixed(2),x=(eo/c*1e6).toFixed(2);e.fillText(`Prey: ${u.toFixed(2)} (target: ${M})`,O,w),w+=B,e.fillText(`Predators: ${f.toFixed(2)} (target: ${F})`,O,w),w+=B,e.fillText(`Bushes: ${g.toFixed(2)} (target: ${x})`,O,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",O,w),w+=18,e.fillStyle="white",e.font="12px monospace";const q=Math.round(a/Qi*100),ee=Math.round(s/Ji*100),z=Math.round(l/eo*100),ne=ie=>ie<50?"#ff4444":ie<80?"#ffaa44":ie>120?"#44aaff":"#44ff44";e.fillStyle=ne(q),e.fillText(`Prey: ${a}/${Qi} (${q}%)`,O,w),w+=B,e.fillStyle=ne(ee),e.fillText(`Predators: ${s}/${Ji} (${ee}%)`,O,w),w+=B,e.fillStyle=ne(z),e.fillText(`Bushes: ${l}/${eo} (${z}%)`,O,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",O,w),w+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",O,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,O,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,O,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,O,w),w+=13,e.fillText("Predators:",O,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,O,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,O,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,O,w),w+=13,e.fillText("Bushes:",O,w),w+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,O,w),w+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",N+I/2,R+_-10),e.restore()}function xB(e,t,n,i){if(i.length<2)return;const c={prey:Math.max(...i.map(f=>f.prey),Qi),predators:Math.max(...i.map(f=>f.predators),Ji),bushes:Math.max(...i.map(f=>f.bushes),eo)};[{data:i.map(f=>f.prey),color:"#44ff44",label:"Prey",target:Qi,max:c.prey},{data:i.map(f=>f.predators),color:"#ff4444",label:"Predators",target:Ji,max:c.predators},{data:i.map(f=>f.bushes),color:"#ffaa44",label:"Bushes",target:eo,max:c.bushes}].forEach((f,g)=>{const m=t+g*115,S=n;e.fillStyle=f.color,e.font="10px monospace",e.fillText(f.label,m,S-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,S,100,30),e.beginPath(),e.strokeStyle=f.color;for(let T=0;T<f.data.length;T++){const I=m+T/(f.data.length-1)*100,_=S+30-f.data[T]/f.max*30;T===0?e.moveTo(I,_):e.lineTo(I,_)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=S+30-f.target/f.max*30;e.moveTo(m,v),e.lineTo(m+100,v),e.stroke(),e.setLineDash([])})}function WB(e,t){const n=t.search.human.byProperty("leaderId",e),i={total:n.length,children:0,males:0,females:0,old:0};for(const a of n)a.isAdult||i.children++,a.gender==="male"?i.males++:a.gender==="female"&&i.females++,a.age>=zg&&i.old++;return i}function YB(e,t){const n=t.search,s=n.building.byProperty("ownerId",e).flatMap(f=>n.berryBush.byRadius(f.position,f.radius)).reduce((f,g)=>f+g.food.length,0),u=n.building.byProperty("ownerId",e).filter(f=>f.buildingType===he.StorageSpot).reduce((f,g)=>f+(g.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:s,totalStorageFood:u,consumptionRate:0}}function zB(e,t,n){const a=t.search.human.byProperty("leaderId",e),s=t.entities.entities,l=new Map,c=new Map;for(const f of a){const g=qd(f.id,t,l);c.has(g)||c.set(g,[]),c.get(g).push(f)}const u=[];for(const[f,g]of c.entries()){const m=s[f];m&&u.push({patriarch:m,memberCount:g.length,members:g.map(S=>S.id)})}return u.sort((f,g)=>g.memberCount-f.memberCount),u.slice(0,n)}let al=[],Ci=[],dv=0;const jB=36,uv=200;function XB(e,t,n,i){var B;if(!t.debugCharacterId)return;const a=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!a)return;let s=(B=Qt(a,t))==null?void 0:B.id;if(!s)return;const l=WB(s,t),c=YB(s,t);if(t.time-dv>=jB){al.push({time:t.time,total:l.total,children:l.children,males:l.males,females:l.females,old:l.old});const O=c.totalBushFood+c.totalStorageFood;Ci.push({time:t.time,bushFood:c.totalBushFood,storageFood:c.totalStorageFood,totalFood:O}),al.length>uv&&(al=al.slice(-200)),Ci.length>uv&&(Ci=Ci.slice(-200)),dv=t.time}let u=0;if(Ci.length>=2){const O=Ci[Ci.length-1],D=Ci[Ci.length-2],M=O.time-D.time;M>0&&(u=(D.totalFood-O.totalFood)/M)}const f=400,g=Math.min(i*.9,700),m=n-f-10,S=Je+nt*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,S,f,g),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,S,f,g),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=S+20;const T=13,I=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",I,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",I,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${l.total}`,I,v),v+=T,e.fillStyle="#00ffff",e.fillText(`Children: ${l.children}`,I,v),v+=T,e.fillStyle="#4488ff",e.fillText(`Males: ${l.males}`,I,v),v+=T,e.fillStyle="#ff88ff",e.fillText(`Females: ${l.females}`,I,v),v+=T,e.fillStyle="#888888",e.fillText(`Old (${l.old})`,I,v),v+=20;const _=al.slice(-50);_.length>1&&(VB(e,I,v,_),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",I,v),v+=18;const N=c.totalBushFood+c.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${N}`,I,v),v+=T,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${c.totalBushFood}`,I,v),v+=T,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${c.totalStorageFood}`,I,v),v+=T,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,I,v),v+=20;const R=Ci.slice(-50);R.length>1&&(KB(e,I,v,R),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",I,v),v+=18;const w=zB(s,t,5);e.fillStyle="white",e.font="11px monospace",w.length===0?(e.fillText("No families found",I,v),v+=T):w.forEach((O,D)=>{const F=`${D+1}. ${O.patriarch.isPlayer?"Player":"#"+O.patriarch.id} (${O.memberCount} members, can split: ${sT(O.patriarch,t).canSplit})`;e.fillText(F,I,v),v+=T}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+f/2,S+g-10),e.restore()}function VB(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.total),color:"#ffffff",label:"Total"},{data:i.map(u=>u.children),color:"#00ffff",label:"Children"},{data:i.map(u=>u.males),color:"#4488ff",label:"Males"},{data:i.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:i.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function KB(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:i.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:i.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const g=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(g,m):e.lineTo(g,m)}e.stroke()})}function fv(e,t,n){e.save();const{x:i,y:a,width:s,height:l}=t.rect,c=MI;if(e.beginPath(),e.moveTo(i+c,a),e.lineTo(i+s-c,a),e.quadraticCurveTo(i+s,a,i+s,a+c),e.lineTo(i+s,a+l-c),e.quadraticCurveTo(i+s,a+l,i+s-c,a+l),e.lineTo(i+c,a+l),e.quadraticCurveTo(i,a+l,i,a+l-c),e.lineTo(i,a+c),e.quadraticCurveTo(i,a,i+c,a),e.closePath(),e.fillStyle=t.isDisabled?OI:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*FI)+1)/2;e.strokeStyle=BI,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<jd){const f=1-u/jd;e.fillStyle=bI,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=hp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?kI:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+s/2,a+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+s-4,a+l-2))):(e.font=`${nt*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+s/2,a+l/2)),e.restore()}function qB(e,t,n,i){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,i);const a=500,s=150,l=(n-a)/2,c=(i-s)/2;e.fillStyle=Lt,e.font=`${nt*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,c+s/3-10),e.fillText("to the main menu?",n/2,c+s/3+10);const u=Zi*1.5,f=NI,g=c+s-f-Je*2,m=20,S=u*2+m,v=l+(a-S)/2,T={id:"confirmExitYes",action:re.ConfirmExitYes,rect:{x:v,y:g,width:u,height:f},text:"Yes",backgroundColor:Fo,textColor:Lt,currentWidth:u},I=v+u+m,_={id:"confirmExitNo",action:re.ConfirmExitNo,rect:{x:I,y:g,width:u,height:f},text:"No",backgroundColor:Fo,textColor:Lt,currentWidth:u};t.uiButtons.push(T,_),fv(e,T,t.hoveredButtonId===T.id),fv(e,_,t.hoveredButtonId===_.id),e.restore()}const Oo=600,Cs=30,_i=60,$t=30,ZB="";function QB(e,t,n){const i=[];if(!n.tribeControl||!n.leaderId)return i;const{width:a,height:s}=e.canvas,l=(a-Oo)/2,c=480,u=(s-c)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(l,u,Oo,c,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Lt,e.font=`${nt*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Tribe Roles",l+Oo/2,u+Cs);const f=30,g=l+Oo-Cs-f,m=u+Cs,S=t.hoveredButtonId==="roleManager_close";e.fillStyle=S?"#ff7777":"#ff5555",e.fillRect(g,m,f,f),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",g+f/2,m+f/2),i.push({id:"roleManager_close",action:re.CloseRoleManager,rect:{x:g,y:m,width:f,height:f},text:"X",currentWidth:f,backgroundColor:"#ff5555",textColor:"#ffffff"});const T=ki(n.leaderId,t).filter(z=>z.isAdult),I={[J.Leader]:0,[J.Gatherer]:0,[J.Planter]:0,[J.Hunter]:0,[J.Mover]:0,[J.Warrior]:0};T.forEach(z=>{z.tribeRole&&I[z.tribeRole]++});const _=n.tribeControl.roleWeights,N=[{role:J.Gatherer,emoji:"",name:"Gatherer"},{role:J.Planter,emoji:"",name:"Planter"},{role:J.Hunter,emoji:"",name:"Hunter"},{role:J.Mover,emoji:"",name:"Mover"},{role:J.Warrior,emoji:"",name:"Warrior"}];let R=0;N.forEach(z=>{R+=_[z.role]||0});let w=u+Cs+70;const B=l+Cs,O=l+Oo-Cs;N.forEach(z=>{const ne=_[z.role]||0,ie=R>0?Math.round(ne/R*100):0,Ee=I[z.role]||0;e.textAlign="left",e.textBaseline="middle",e.font=`${nt*.8}px "Press Start 2P", Arial`,e.fillStyle=Lt,e.fillText(`${z.emoji} ${Ee} ${z.name}`,B,w+_i/2);const le=l+220,te=le+$t+15,X=te+200+15,V=`role_minus_${z.role}`,b=t.hoveredButtonId===V,W=ne<=0,se=W?"#555":b?"#dd6666":"#cc4444";e.fillStyle=se,e.fillRect(le,w+(_i-$t)/2,$t,$t),e.fillStyle=W?"#888":"#fff",e.textAlign="center",e.fillText("-",le+$t/2,w+_i/2+2),i.push({id:V,action:re.DecreaseRoleWeight,targetRole:z.role,rect:{x:le,y:w+(_i-$t)/2,width:$t,height:$t},text:"-",currentWidth:$t,backgroundColor:se,textColor:"#fff",isDisabled:W}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#fff";let fe=te;for(let ae=0;ae<ne;ae++)e.fillText(ZB,fe,w+_i/2+2),fe+=18;const Re=`role_plus_${z.role}`,ge=t.hoveredButtonId===Re,Me=ne>=10,De=Me?"#555":ge?"#66dd66":"#44cc44";e.fillStyle=De,e.fillRect(X,w+(_i-$t)/2,$t,$t),e.fillStyle=Me?"#888":"#fff",e.textAlign="center",e.font=`${nt*.8}px "Press Start 2P", Arial`,e.fillText("+",X+$t/2,w+_i/2+4),i.push({id:Re,action:re.IncreaseRoleWeight,targetRole:z.role,rect:{x:X,y:w+(_i-$t)/2,width:$t,height:$t},text:"+",currentWidth:$t,backgroundColor:De,textColor:"#fff",isDisabled:Me}),e.textAlign="right",e.font=`${nt*.8}px "Press Start 2P", Arial`,e.fillStyle=Lt,e.fillText(`${ie}%`,O,w+_i/2),w+=_i});const D=I[J.Leader],M=Object.values(I).reduce((z,ne)=>z+ne,0),F=T.length-M;e.textAlign="center",e.fillStyle="#aaa",e.font=`${nt*.6}px "Press Start 2P", Arial`,e.fillText(`Adults: ${T.length} | Leader: ${D} | Assigned: ${M} | Unassigned: ${F}`,l+Oo/2,w+10),e.fillText("(Adjust weights to control role distribution)",l+Oo/2,w+30);const x=t.autopilotControls.behaviors.roleManagement,q=x?" Auto-adjust: ON":" Auto-adjust: OFF",ee=x?"#4CAF50":"#888";return e.fillStyle=ee,e.font=`${nt*.6}px "Press Start 2P", Arial`,e.fillText(`${q} (Shift+U to toggle)`,l+Oo/2,w+50),e.restore(),i}const Ir=600,_s=30,wi=60,xt=30,hv=[{key:"protectHomeland",emoji:"",name:"Protect Homeland",description:"Stay inside territory and protect from enemies"},{key:"expandBorders",emoji:"",name:"Expand Borders",description:"Expand territory by placing border posts (Coming Soon)"},{key:"invadeEnemies",emoji:"",name:"Invade Enemies",description:"Attack enemies outside of our border"}];function JB(e,t,n){const i=[];if(!n.tribeControl||n.leaderId!==n.id)return i;const a=n.tribeControl.armyControl??{protectHomeland:yg,expandBorders:Sg,invadeEnemies:vg},{width:s,height:l}=e.canvas,c=(s-Ir)/2,u=350,f=(l-u)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(c,f,Ir,u,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Lt,e.font=`${nt*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Army Control",c+Ir/2,f+_s);const g=30,m=c+Ir-_s-g,S=f+_s,v=t.hoveredButtonId==="armyControl_close";e.fillStyle=v?"#ff7777":"#ff5555",e.fillRect(m,S,g,g),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",m+g/2,S+g/2),i.push({id:"armyControl_close",action:re.CloseArmyControl,rect:{x:m,y:S,width:g,height:g},text:"X",currentWidth:g,backgroundColor:"#ff5555",textColor:"#ffffff"});let T=0;hv.forEach(R=>{T+=a[R.key]||0});let I=f+_s+70;const _=c+_s,N=c+Ir-_s;return hv.forEach(R=>{const w=a[R.key]||0,B=T>0?Math.round(w/T*100):0;e.textAlign="left",e.textBaseline="middle",e.font=`${nt*.8}px "Press Start 2P", Arial`,e.fillStyle=Lt,e.fillText(`${R.emoji} ${R.name}`,_,I+wi/2);const O=c+320,D=O+xt+15,M=120,F=D+M+15,x=`army_minus_${R.key}`,q=t.hoveredButtonId===x,ee=w<=0,z=ee?"#555":q?"#dd6666":"#cc4444";e.fillStyle=z,e.fillRect(O,I+(wi-xt)/2,xt,xt),e.fillStyle=ee?"#888":"#fff",e.textAlign="center",e.fillText("-",O+xt/2,I+wi/2+2),i.push({id:x,action:re.DecreaseArmyObjective,targetArmyObjective:R.key,rect:{x:O,y:I+(wi-xt)/2,width:xt,height:xt},text:"-",currentWidth:xt,backgroundColor:z,textColor:"#fff",isDisabled:ee}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#4CAF50";const ne=M-10,ie=12,Ee=I+wi/2-ie/2;e.fillStyle="#333",e.fillRect(D,Ee,ne,ie);const le=w/10*ne;e.fillStyle="#4CAF50",e.fillRect(D,Ee,le,ie);const te=`army_plus_${R.key}`,Y=t.hoveredButtonId===te,X=w>=10,V=X?"#555":Y?"#66dd66":"#44cc44";e.fillStyle=V,e.fillRect(F,I+(wi-xt)/2,xt,xt),e.fillStyle=X?"#888":"#fff",e.textAlign="center",e.font=`${nt*.8}px "Press Start 2P", Arial`,e.fillText("+",F+xt/2,I+wi/2+4),i.push({id:te,action:re.IncreaseArmyObjective,targetArmyObjective:R.key,rect:{x:F,y:I+(wi-xt)/2,width:xt,height:xt},text:"+",currentWidth:xt,backgroundColor:V,textColor:"#fff",isDisabled:X}),e.textAlign="right",e.font=`${nt*.8}px "Press Start 2P", Arial`,e.fillStyle=Lt,e.fillText(`${B}%`,N,I+wi/2),I+=wi}),e.textAlign="center",e.fillStyle="#aaa",e.font=`${nt*.6}px "Press Start 2P", Arial`,e.fillText("Adjust priorities for warrior objectives",c+Ir/2,I+10),e.fillText("Higher values = higher priority",c+Ir/2,I+30),e.restore(),i}let gv="",pv=null;function eF(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function tF(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function _d(e,t,n,i,a,s,l){const c=((t+i)%s+s)%s,u=((n+a)%l+l)%l;return e.has(`${c},${u}`)}function nF(e,t,n,i){const a=zw(t.soilDepletion,jv);if(a.length===0)return;const{width:s,height:l}=t.mapDimensions,c=i.width/2,u=i.height/2,f=Math.ceil(s/Wt),g=Math.ceil(l/Wt),m=eF(a);m!==gv&&(gv=m,pv=tF(a));const S=pv,v=Wt*2,T=n.x-c-v,I=n.x+c+v,_=n.y-u-v,N=n.y+u+v;e.save();const R=e.globalAlpha;for(const w of a){const B=w.gridX*Wt,O=w.gridY*Wt,D=iF(B,O,s,l,T,I,_,N);for(const M of D)oF(e,M.x,M.y,w.health,w.gridX,w.gridY,S,f,g)}e.globalAlpha=R,e.restore()}function iF(e,t,n,i,a,s,l,c){const u=[],f=Wt,g=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-i},{dx:0,dy:i},{dx:-n,dy:-i},{dx:n,dy:-i},{dx:-n,dy:i},{dx:n,dy:i}];for(const m of g){const S=e+m.dx,v=t+m.dy;S+f>=a&&S<=s&&v+f>=l&&v<=c&&u.push({x:S,y:v})}return u}function oF(e,t,n,i,a,s,l,c,u){const f=Math.floor(t),g=Math.floor(n),m=Wt,S=1-i/jv,T=i<yw?jy:jy*S,I=!_d(l,a,s,0,-1,c,u),_=!_d(l,a,s,0,1,c,u),N=!_d(l,a,s,-1,0,c,u),R=!_d(l,a,s,1,0,c,u);e.globalAlpha=T,e.fillStyle=pw,e.fillRect(f,g,m,m);const w=3;e.fillStyle=mw,e.globalAlpha=T*1.2,I&&e.fillRect(f,g,m,w),_&&e.fillRect(f,g+m-w,m,w),N&&e.fillRect(f,g,w,m),R&&e.fillRect(f+m-w,g,w,m),e.globalAlpha=T*.5;const B=w+1;I&&N&&e.fillRect(f,g,B,B),I&&R&&e.fillRect(f+m-B,g,B,B),_&&N&&e.fillRect(f,g+m-B,B,B),_&&R&&e.fillRect(f+m-B,g+m-B,B,B),e.globalAlpha=1}const ll=8,cl=12,on=24;function mv(e,t,n,i,a){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-cl),e.stroke(),e.fillStyle=i,e.beginPath(),e.moveTo(t,n-cl),e.lineTo(t+ll,n-cl+ll/2),e.lineTo(t,n-cl+ll),e.closePath(),e.fill(),a&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(a,t+ll/2,n-cl+ll/2))}function rF(e,t,n,i,a){const s=Eu(t,a);let l=1;const c=new Map,u=new Map;for(const I of s){const N=I.leaderId===a?0:l++,R=Fn[N%Fn.length];c.set(I.leaderId,R),u.set(I.leaderId,I.tribeBadge||"")}const f=[],g=on*2,m=Math.floor((n.x-i.width/2-g)/on)*on,S=Math.floor((n.x+i.width/2+g)/on)*on,v=Math.floor((n.y-i.height/2-g)/on)*on,T=Math.floor((n.y+i.height/2+g)/on)*on;for(let I=v;I<=T;I+=on)for(let _=m;_<=S;_+=on){const N=xo(_,I,t),R=_+on,w=xo(R,I,t);if(N!==w){const D=N||w;if(D){const M=_+on/2,F=I;mv(e,M,F,c.get(D)||"#000",u.get(D)||""),f.push({x:M,y:F})}}const B=I+on,O=xo(_,B,t);if(N!==O){const D=N||O;if(D){const M=_,F=I+on/2;mv(e,M,F,c.get(D)||"#000",u.get(D)||""),f.push({x:M,y:F})}}}return f}const kn=12,bt=16,Ri=15;function yv(e){switch(e){case _e.Success:return"#4CAF50";case _e.Failure:return"#F44336";case _e.Running:return"#FFC107";case _e.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function sF(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function aF(e,t,n,i){var M;const{debugCharacterId:a}=t,s=500,l=Math.min(i*.9,800),c=n-s-10,u=Je+nt*2;t.debugPanelRect={x:c,y:u,width:s,height:l},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(c,u,s,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(c,u,s,l),e.fillStyle="white",e.font=`${kn}px monospace`,e.textAlign="left",e.textBaseline="top";let f=u+20;const g=c+15;if(e.fillStyle="#66ccff",e.font=`bold ${kn+2}px monospace`,e.fillText(" Task AI Debugger",g,f),f+=25,!a){e.fillStyle="#888",e.font=`${kn}px monospace`,e.fillText("No character selected for debugging.",g,f),e.fillText("Click on a character to inspect their Task AI.",g,f+20),e.restore();return}const m=t.entities.entities[a];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${kn}px monospace`,e.fillText(`Character #${a} not found or not a character.`,g,f),e.restore();return}const S=m;e.fillStyle="white",e.font=`${kn}px monospace`,e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,g,f),f+=bt*1.5,e.fillStyle="#66ccff",e.font=`bold ${kn}px monospace`,e.fillText(" Current Task",g,f),f+=bt*1.5;const v=Ag(S),T=v?t.tasks[v]:null;if(e.font=`${kn}px monospace`,T){const F=C.get(S.aiBlackboard,"lastTaskResult"),x=F!==void 0?_e[F]:"N/A";e.fillStyle="white",e.fillText(`ID: ${T.id}`,g+Ri,f),f+=bt,e.fillText(`Type: ${He[T.type]}`,g+Ri,f),f+=bt,e.fillText(`Target: ${sF(T.target)}`,g+Ri,f),f+=bt,e.fillStyle=yv(F),e.fillText(`Status: ${x}`,g+Ri,f),f+=bt}else e.fillStyle="#888",e.fillText("No active task.",g+Ri,f),f+=bt;f+=bt,e.fillStyle="#66ccff",e.font=`bold ${kn}px monospace`,e.fillText(" Recent Task History (Last 5)",g,f),f+=bt*1.5;const I=C.get(S.aiBlackboard,"taskHistory")||[];if(I.length===0)e.fillStyle="#888",e.font=`${kn}px monospace`,e.fillText("No task history yet.",g+Ri,f),f+=bt;else for(const F of I){e.fillStyle="white",e.font=`${kn}px monospace`;const x=He[F.type];e.fillText(` ${x}`,g+Ri,f);const q=_e[F.result];e.fillStyle=yv(F.result);const ee=e.measureText(` ${x} `).width;e.fillText(`(${q})`,g+Ri+ee,f),e.fillStyle="#666";const z=e.measureText(`(${q}) `).width;e.fillText(`@ ${F.completedAtTick.toFixed(1)}h`,g+Ri+ee+z,f),f+=bt}f+=bt,e.fillStyle="#66ccff",e.font=`bold ${kn}px monospace`,e.fillText(" Available Tasks",g,f),f+=bt*1.5;const _=f,N=u+l-_-30;e.save(),e.beginPath(),e.rect(c,_,s,N),e.clip();const R=((M=t.debugPanelScroll)==null?void 0:M.y)??0;e.translate(0,-R);const w=Object.values(t.tasks);let B=0;if(w.length===0)e.fillStyle="#888",e.font=`${kn}px monospace`,e.fillText("No tasks available in the world.",g+Ri,f),f+=bt;else for(const F of w){const x=Au[F.type],q=x&&x.scorer&&S.type==="human"?x.scorer(S,F,{gameState:t,deltaTime:0}):null;let ee="Unclaimed",z="#888";F.claimedByEntityId&&(F.claimedByEntityId===S.id?(ee="Claimed by this character",z="#4CAF50"):(ee=`Claimed by #${F.claimedByEntityId}`,z="#F44336")),e.font=`${kn}px monospace`,e.fillStyle=z;const ne=` Task ID: ${F.id}`;e.fillText(ne,g,f),f+=bt,e.fillStyle="white",e.fillText(`  Type: ${He[F.type]}`,g,f),f+=bt;const ie=q!==null?q.toFixed(3):"N/A";e.fillStyle=q!==null&&q>0?"#FFC107":"#888",e.fillText(`  Score: ${ie}`,g,f),f+=bt,e.fillStyle=z,e.fillText(`  Status: ${ee}`,g,f),f+=bt*1.5,B=Math.max(B,e.measureText(ne).width+30)}const O=f-_;t.debugPanelContentSize={width:B,height:O},e.restore();const D=u+l-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",c+s/2,D),e.restore()}function lF(e,t,n,i){const{debugCharacterId:a}=t;if(!a)return;const s=t.entities.entities[a];if(!s||s.type!=="human"&&s.type!=="predator"&&s.type!=="prey")return;switch(s.aiType){case Ut.TaskBased:aF(e,t,n,i);break;case Ut.BehaviorTreeBased:Gb(e,t,n,i);break}const l=500,c=n-l-10,u=Je+nt*2,f=150,g=25,m=c+l-f-15,S=u+15,v={x:m,y:S,width:f,height:g};t.uiButtons.push({id:"switch-ai-type-button",action:re.SwitchAIType,rect:v,text:"",currentWidth:f,backgroundColor:"rgba(100, 100, 100, 0.5)",textColor:"white"}),e.save(),e.fillStyle="rgba(100, 100, 100, 0.8)",e.fillRect(m,S,f,g),e.strokeStyle="#fff",e.lineWidth=1,e.strokeRect(m,S,f,g),e.fillStyle="white",e.font="10px monospace",e.textAlign="center",e.textBaseline="middle";const T=s.aiType===Ut.BehaviorTreeBased?"BT":"Task";e.fillText(`AI: ${T} (Switch)`,m+f/2,S+g/2),e.restore()}function nu(e,t,n,i,a,s=!1){var f;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!s&&t.gameOver){e.restore(),Ab(e,t);return}const l=yt(t),c=rF(e,t,n,a,l==null?void 0:l.leaderId);if(nF(e,t,n,a),LB(e,t,t.debugPanel===Ye.General,n,a,c),l&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const g=Fg(t.mousePosition,n,a,t.mapDimensions),m=Hl(g,t.selectedBuildingType,l.leaderId,t);gB(e,g,t.selectedBuildingType,m,t.mapDimensions)}const u=t.notifications.filter(g=>!g.isDismissed);for(const g of u){const m=(Math.sin(t.time*IP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=vP,g.targetArea&&e.fillRect(g.targetArea.x,g.targetArea.y,g.targetArea.width,g.targetArea.height),g.targetRadius&&(e.beginPath(),e.arc(g.targetRadius.x,g.targetRadius.y,g.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,kb(e,t),e.restore(),!s){e.fillStyle=P1,e.font=`${nt}px "Press Start 2P", Arial`,e.shadowColor=D1,e.shadowBlur=N1,t.uiButtons=[];let g=null,m=null;if(l){const T=En(t,l),I=$r(T),_=((f=l.partnerIds)==null?void 0:f.map(R=>t.entities.entities[R]).filter(R=>R!==void 0))||[],N=UB(e,t,l,I,_,T);g=N.hungerBarRect,m=N.foodBarRect}const S=Eu(t,l==null?void 0:l.leaderId);vb(e,t,S,e.canvas.width,e.canvas.height);const{commandButtonsRect:v}=sb(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,l&&(Mb(e,t,n,e.canvas.width,e.canvas.height),i.length>0&&db(e,i,l,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:T}=t.tutorialState;T.includes(Fr.HUNGER_BAR)&&g&&ng(e,g,t.time),T.includes(Fr.FOOD_BAR)&&m&&ng(e,m,t.time),T.includes(Fr.COMMAND_BUTTONS)&&v&&ng(e,v,t.time)}if(t.tutorialState.isActive){const T=Tb(e,t,e.canvas.width,e.canvas.height);T&&t.uiButtons.push({id:"tutorial-dismiss",action:re.DismissTutorial,rect:T,text:"",currentWidth:T.width,backgroundColor:"transparent",textColor:"transparent"})}switch(Bb(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case Ye.Ecosystem:$B(e,t,e.canvas.width,e.canvas.height);break;case Ye.Tribe:XB(e,t,e.canvas.width,e.canvas.height);break;case Ye.SupplyChain:xb(e,t,e.canvas.width,e.canvas.height);break;case Ye.Performance:Lb(e,t,a.width);break;case Ye.General:lF(e,t,e.canvas.width,e.canvas.height);break}if(t.roleManagerOpen&&l&&l.leaderId===l.id){const T=QB(e,t,l);t.uiButtons.push(...T)}if(t.armyControlOpen&&l&&l.leaderId===l.id){const T=JB(e,t,l);t.uiButtons.push(...T)}t.isPaused&&t.exitConfirmation!=="pending"&&ab(e),t.exitConfirmation==="pending"&&qB(e,t,e.canvas.width,e.canvas.height)}}const cF=Nt.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,dF=Nt.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,uF=Nt.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,fF=Nt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Sv=Nt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,hF=Nt.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,gF=Nt.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,wd="intro-soundtrack",vv=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=jr(),i=Be.useRef(null),a=Be.useRef(null),s=Be.useRef(tk()),l=Be.useRef(),c=Be.useRef(s.current.viewportCenter),u=Be.useRef(),f=Be.useCallback(()=>{bh(wd,2),n(),e("game")},[e,n]),g=Be.useCallback(()=>{t&&(bh(wd,2),e("game"))},[e,t]);Be.useEffect(()=>{const v=T=>{(T.key==="Enter"||T.key===" ")&&(t?g():f())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[f,g,t]),Be.useEffect(()=>(cp(Ae.SoundTrack1,{loop:!0,trackId:wd}),()=>{bh(wd,2)}),[]),Be.useEffect(()=>{const v=i.current;if(!v)return;a.current=v.getContext("2d");const T=()=>{v&&a.current&&(v.width=window.innerWidth,v.height=window.innerHeight,nu(a.current,s.current,c.current,[],{width:v.width,height:v.height},!0))};return T(),window.addEventListener("resize",T),()=>window.removeEventListener("resize",T)},[]),Be.useEffect(()=>{const v=()=>{const I=JI(s.current);if(I.length>0){const _=Math.floor(Math.random()*I.length);u.current=I[_].id}};v();const T=setInterval(v,AC);return()=>clearInterval(T)},[]);const[m,S]=XT(v=>{var _,N;if(!a.current)return;if(l.current===void 0){l.current=v;return}const T=Math.min((v-l.current)/1e3,1);s.current=Mu(s.current,T);const I=u.current?s.current.entities.entities[u.current]:void 0;if(I){const{mapDimensions:R}=s.current,{width:w,height:B}=R;let O={...I.position};const D=O.x-c.current.x;Math.abs(D)>w/2&&(D>0?O.x-=w:O.x+=w);const M=O.y-c.current.y;Math.abs(M)>B/2&&(M>0?O.y-=B:O.y+=B);let F=$g(c.current,O,Gg*T);F={x:(F.x%w+w)%w,y:(F.y%B+B)%B},c.current=F}nu(a.current,s.current,c.current,[],{width:((_=i.current)==null?void 0:_.width)||800,height:((N=i.current)==null?void 0:N.height)||600},!0),l.current=v});return Be.useEffect(()=>(S(),m),[S,m]),Le.jsxs(cF,{children:[Le.jsx(dF,{ref:i}),Le.jsxs(uF,{children:[Le.jsx(fF,{children:"Tribe2"}),Le.jsxs(hF,{children:[Le.jsx(Sv,{onClick:f,children:"New Game"}),t&&Le.jsx(Sv,{onClick:g,children:"Load Game"})]}),Le.jsxs(gF,{children:["by"," ",Le.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function pF(){console.log("Tribe game initialized with detailed 2D world state.");const e=ek();return e.ecosystem={preyGestationPeriod:Dr,preyProcreationCooldown:Nr,predatorGestationPeriod:Mr,predatorProcreationCooldown:Or,preyHungerIncreasePerHour:Uo,predatorHungerIncreasePerHour:Ho,berryBushSpreadChance:to},e.debugPanel=Ye.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const mF=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:i,playerActionHintsRef:a})=>(Be.useEffect(()=>{const s=e.current;if(!s)return;t.current=s.getContext("2d");const l=()=>{s&&t.current&&n.current&&(s.width=window.innerWidth,s.height=window.innerHeight,nu(t.current,n.current,i.current,a.current,{width:s.width,height:s.height},!1))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),Le.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),yF=(e,t,n,i=!1)=>{var l,c;let a;const s=PD(e,n);if(s){if(t.isAdult&&s.type==="berryBush"&&s.food.length>0)a={action:de.AutopilotGather,targetEntityId:s.id};else if(t.isAdult&&s.type==="corpse"&&s.food.length>0)a={action:de.AutopilotGather,targetEntityId:s.id};else if(s.type==="human"){const u=s;t.isAdult&&la(t,u,n)?a={action:de.AutopilotAttack,targetEntityId:u.id}:xr(t,u,n)?a={action:de.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(a={action:de.AutopilotFeedChild,targetEntityId:u.id})}else if(s.type==="prey")a={action:de.AutopilotAttack,targetEntityId:s.id};else if(s.type==="predator")a={action:de.AutopilotAttack,targetEntityId:s.id};else if(s.type==="building"){const u=s;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&cn(t,u,n)&&u.isConstructed?a={action:de.RemoveEnemyBuilding,targetEntityId:u.id}:a={action:de.Removal,position:s.position};else if(t.leaderId===t.id&&cn(t,u,n)&&u.isConstructed)eI(u.position,js,t.id,n).valid?a={action:de.TakeOverBuilding,targetEntityId:u.id}:a={action:de.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const f=u.ownerId===t.leaderId,g=u.storedItems.length>0,m=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(i&&u.isConstructed&&g&&t.food.length<t.maxFood)if(f)a={action:de.AutopilotRetrieve,targetEntityId:s.id};else{const S=t.leaderId?n.entities.entities[t.leaderId]:void 0;S&&((l=S.tribeControl)!=null&&l.diplomacy)?(u.ownerId&&S.tribeControl.diplomacy[u.ownerId])===Ft.Hostile?a={action:de.AutopilotGather,targetEntityId:s.id}:a={action:de.AutopilotMove,position:e}:a={action:de.AutopilotMove,position:e}}else f&&u.isConstructed?(t.food.length>0||t.heldItem)&&m?a={action:de.AutopilotDeposit,targetEntityId:s.id}:t.food.length<t.maxFood&&g?a={action:de.AutopilotRetrieve,targetEntityId:s.id}:a={action:de.AutopilotMove,position:e}:a={action:de.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(f=>f.type===fn.Berry).length>=io&&!qn(e,n,Ur)&&!Mi(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?a={action:de.AutopilotPlant,position:e}:u.buildingType===he.Bonfire&&((c=t.heldItem)==null?void 0:c.type)===St.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?a={action:de.AutopilotDeposit,targetEntityId:u.id}:a={action:de.AutopilotMove,position:e}}else if(s.type==="tree"){const u=s,[f]=u.stateMachine??[],g=f===Kn||f===Ln||f===di;t.isAdult&&!t.heldItem&&g?a={action:de.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&f===An&&u.wood.length>0?a={action:de.AutopilotGather,targetEntityId:u.id}:a={action:de.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===fn.Berry).length>=io&&(n.autopilotControls.isManuallyPlanting||Yl(e,n,t))&&!Mi(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?a={action:de.AutopilotPlant,position:e}:a={action:de.AutopilotMove,position:e};return a},SF=(e,t)=>{if(e.isPaused)return;const n=yt(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const a=e.selectedBuildingType,s=G(n.position,t,e.mapDimensions.width,e.mapDimensions.height),l=100;s<=l?Hl(t,a,n.leaderId,e,n.position,l)&&(br(t,a,n.leaderId,e),e.selectedBuildingType=null):Hl(t,a,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:de.AutopilotBuildingPlacement,position:t,buildingType:a},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const a=OM(t,e);a&&Eg(a.id,e);return}const i=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,i?(e.autopilotControls.activeAutopilotAction=i,(i.action===de.AutopilotMove||i.action===de.AutopilotGather||i.action===de.AutopilotChop)&&(e.hasPlayerMovedEver=!0),i.action===de.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:de.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},vF=(e,t)=>{var l,c,u,f,g,m,S,v;const n=e.key.toLowerCase(),i=e.ctrlKey||e.metaKey;let a=!0,s=t;if(i){switch(n){case"s":Rp(t);break;default:a=!1;break}return{newState:s,handled:a}}switch(n){case"escape":const{autopilotControls:T}=t;T.activeAutopilotAction||T.isManuallyMoving||T.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(T.activeAutopilotAction=void 0,T.isManuallyMoving=!1,T.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):s.exitConfirmation==="pending"?(s.exitConfirmation="inactive",s.isPaused=!1):(s.exitConfirmation="pending",s.isPaused=!0);break;case"u":const I=yt(t);I&&I.isAdult&&I.leaderId===I.id&&(e.shiftKey?t.autopilotControls.behaviors.roleManagement=!t.autopilotControls.behaviors.roleManagement:t.roleManagerOpen=!t.roleManagerOpen);break;case"v":{const R=yt(t);R&&R.isAdult&&R.leaderId===R.id&&(t.armyControlOpen=!t.armyControlOpen);break}case"m":t.isMuted=!t.isMuted,Al(t.masterVolume,t.isMuted);break;case"=":case"+":const _=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(_.toFixed(1)),Al(t.masterVolume,t.isMuted);break;case"-":const N=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(N.toFixed(1)),Al(t.masterVolume,t.isMuted);break;case"t":s=Mu(t,KI);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":s.debugPanel===Ye.General?(s.debugPanel=Ye.None,s.debugCharacterId=void 0):(s.debugPanel=Ye.General,s.debugCharacterId||(s.debugCharacterId=((l=yt(s))==null?void 0:l.id)??((c=Object.values(s.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:c.id)));break;case"!":if(e.shiftKey){if(s.debugPanel===Ye.Ecosystem){s.debugPanel=Ye.None;break}s.debugPanel=Ye.Ecosystem,s.debugCharacterId||(s.debugCharacterId=((u=yt(s))==null?void 0:u.id)??((f=Object.values(s.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:f.id))}else a=!1;break;case"#":if(e.shiftKey){if(s.debugPanel===Ye.Tribe){s.debugPanel=Ye.None;break}s.debugPanel=Ye.Tribe,(!s.debugCharacterId||!s.entities.entities[s.debugCharacterId])&&(s.debugCharacterId=((g=yt(s))==null?void 0:g.id)??((m=s.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:m.id))}else a=!1;break;case"$":if(e.shiftKey){if(s.debugPanel===Ye.SupplyChain){s.debugPanel=Ye.None;break}s.debugPanel=Ye.SupplyChain,(!s.debugCharacterId||!s.entities.entities[s.debugCharacterId])&&(s.debugCharacterId=((S=yt(s))==null?void 0:S.id)??((v=s.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:v.id))}else a=!1;break;case"@":if(e.shiftKey){if(s.debugPanel===Ye.Performance){s.debugPanel=Ye.None;break}s.debugPanel=Ye.Performance}else a=!1;break;case"tab":if(s.debugPanel!==Ye.General&&s.debugPanel!==Ye.Tribe&&s.debugPanel!==Ye.SupplyChain&&(s.debugPanel=Ye.General),s.debugPanel===Ye.General){const R=Object.values(s.entities.entities).filter(w=>w.type==="human"||w.type==="prey"||w.type==="predator");if(R.length>0){const w=R.sort((M,F)=>{if(M.type==="human"&&M.isPlayer)return-1;if(F.type==="human"&&F.isPlayer)return 1;if(M.type!==F.type){const x={human:0,prey:1,predator:2},q=x[M.type]??999,ee=x[F.type]??999;return q-ee}return M.id-F.id}),B=s.debugCharacterId,D=((B?w.findIndex(M=>M.id===B):-1)+1)%w.length;s.debugCharacterId=w[D].id}else s.debugCharacterId=void 0}else if(s.debugPanel===Ye.Tribe||s.debugPanel===Ye.SupplyChain){const R=s.search.human.all().filter(B=>B.leaderId===B.id);let w=R.findIndex(B=>B.id===s.debugCharacterId)+1;(w===-1||w>R.length-1)&&(w=0),s.debugCharacterId=R[w].id}else s.debugPanel=Ye.None,s.debugCharacterId=void 0;break;default:a=!1;break}return{newState:s,handled:a}},IF=(e,t,n,i,a)=>{var l;const s={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",Ne(s,Ae.ButtonClick,i.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",Ne(s,Ae.ButtonClick,i.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",Ne(s,Ae.ButtonClick,i.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",Ne(s,Ae.ButtonClick,i.position);return}else if(e==="6"){n.selectedBuildingType="removal",Ne(s,Ae.ButtonClick,i.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const c=be(i,n,"berryBush",Ze,g=>g.food.length>0&&i.food.length<i.maxFood),u=be(i,n,"corpse",Ze,g=>g.food.length>0&&i.food.length<i.maxFood);let f=null;c&&u?f=G(i.position,c.position,n.mapDimensions.width,n.mapDimensions.height)<=G(i.position,u.position,n.mapDimensions.width,n.mapDimensions.height)?c:u:f=c||u,f&&(i.activeAction="gathering",Ne(s,Ae.Gather,i.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}be(i,n,"human",Ze,u=>xr(i,u,n))&&(i.activeAction="procreating",Ne(s,Ae.Procreate,i.position))}else if(e==="f")i.food.length>0&&(i.activeAction="eating",Ne(s,Ae.Eat,i.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const c=a.find(u=>u.type===de.FeedChild);c&&c.targetEntity&&(i.activeAction="feeding",i.target=c.targetEntity.id)}else if(e==="arrowup"||e==="w")i.direction.y=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")i.direction.y=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")i.direction.x=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")i.direction.x=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const c=be(i,n,"human",Tn,u=>la(i,u,n))??be(i,n,"predator",Tn)??be(i,n,"prey",Tn);c&&(i.activeAction="attacking",i.attackTargetId=c.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(a.find(u=>u.type===de.Plant)){const u=vw(i.position,n,50,hg);u&&(i.activeAction="planting",i.target=u,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const c=be(i,n,"building",un,f=>{const g=f;return g.buildingType===he.Bonfire&&g.isConstructed&&g.storedItems.length<(g.storageCapacity||0)});if(((l=i.heldItem)==null?void 0:l.type)===St.Wood&&c){i.activeAction="depositing",i.target=c.id,Ne(s,Ae.StorageDeposit,i.position);return}const u=be(i,n,"building",un,f=>{const g=f;return g.buildingType===he.StorageSpot&&g.ownerId===i.leaderId&&g.isConstructed&&g.storageCapacity!==void 0&&g.storedItems.length<g.storageCapacity});u&&(i.activeAction="idle",i.target=u.id,Ne(s,Ae.StorageDeposit,i.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const c=be(i,n,"building",un,u=>{const f=u;return f.buildingType==="storageSpot"&&f.ownerId===i.leaderId&&f.isConstructed&&f.storedItems.length>0});c&&(i.activeAction="idle",i.target=c.id,Ne(s,Ae.StorageRetrieve,i.position))}else if(e==="k")aT(i,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,Ne(s,Ae.ButtonClick,i.position)}else if(e==="u"){if(t){n.autopilotControls.behaviors.roleManagement=!n.autopilotControls.behaviors.roleManagement;return}}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const c=be(i,n,"tree",ou,u=>u.wood&&u.wood.length>0&&!i.heldItem);c&&(i.activeAction="chopping",i.target=c.id)}},TF=(e,t,n,i)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!i.current.has("arrowup")&&!i.current.has("arrowdown")&&!i.current.has("arrowleft")&&!i.current.has("arrowright")&&!i.current.has("w")&&!i.current.has("a")&&!i.current.has("s")&&!i.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!i.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!i.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!i.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!i.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!i.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},AF=(e,t,n)=>{let a=yt(e);if(e.debugCharacterId){const s=e.entities.entities[e.debugCharacterId];s&&"position"in s&&(a=s)}if(a){const{mapDimensions:s}=e,{width:l,height:c}=s;let u={...a.position};const f=u.x-t.x;Math.abs(f)>l/2&&(f>0?u.x-=l:u.x+=l);const g=u.y-t.y;Math.abs(g)>c/2&&(g>0?u.y-=c:u.y+=c);let m=$g(t,u,Gg*n);return m={x:(m.x%l+l)%l,y:(m.y%c+c)%c},m}return e.viewportCenter};function EF(e,t){const{width:n,height:i}=e.mapDimensions;e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%i+i)%i}}const CF=(e,t,n,i)=>{var u,f;const a={gameState:n},s=yt(n);s&&Ne(a,Ae.ButtonClick,s.position);const l=n.uiButtons.find(g=>g.id===e.id);l&&(l.lastActivated=Date.now()),t&&[re.CommandGather,re.CommandPlant,re.ToggleProcreationBehavior,re.CommandBuild,re.OpenRoleManager].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:c}=n.autopilotControls;switch(e.action){case re.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case re.ConfirmExitYes:i(),n.exitConfirmation="inactive";break;case re.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case re.ToggleMute:n.isMuted=!n.isMuted,Al(n.masterVolume,n.isMuted);break;case re.TogglePause:n.isPaused=!n.isPaused;break;case re.FastForward:return Mu(n,KI);case re.DismissTutorial:n.tutorialState.isActive=!1;break;case re.CommandEat:s&&s.food.length>0&&(s.activeAction="eating");break;case re.CommandGather:t?c.gathering=!c.gathering:s&&(s.activeAction="gathering");break;case re.CommandPlant:t?c.planting=!c.planting:s&&(n.autopilotControls.isManuallyPlanting=!0);break;case re.ToggleProcreationBehavior:c.procreation=!c.procreation;break;case re.ToggleAttackBehavior:c.attack=!c.attack;break;case re.ToggleFeedChildBehavior:c.feedChildren=!c.feedChildren;break;case re.CommandTribeSplit:s&&aT(s,n);break;case re.CommandBuild:t?c.build=!c.build:n.buildMenuOpen=!n.buildMenuOpen;break;case re.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case re.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case re.SelectRemovalTool:n.selectedBuildingType="removal";break;case re.SelectBorderPost:n.selectedBuildingType="borderPost";break;case re.SelectBonfire:n.selectedBuildingType="bonfire";break;case re.ToggleDiplomacy:if(s&&s.leaderId&&e.targetTribeId){const g=s.leaderId,m=e.targetTribeId,S=n.entities.entities[m],v=(u=s.tribeControl)==null?void 0:u.diplomacy,T=(f=S==null?void 0:S.tribeControl)==null?void 0:f.diplomacy;if(v&&T){const _=(v[m]||Ft.Friendly)===Ft.Friendly?Ft.Hostile:Ft.Friendly;v[m]=_,T[g]=_}}break;case re.OpenRoleManager:t?c.roleManagement=!c.roleManagement:n.roleManagerOpen=!0;break;case re.CloseRoleManager:n.roleManagerOpen=!1;break;case re.IncreaseRoleWeight:if(s&&s.tribeControl&&e.targetRole){const g=s.tribeControl.roleWeights[e.targetRole]||0;g<10&&(s.tribeControl.roleWeights[e.targetRole]=g+1)}break;case re.DecreaseRoleWeight:if(s&&s.tribeControl&&e.targetRole){const g=s.tribeControl.roleWeights[e.targetRole]||0;g>0&&(s.tribeControl.roleWeights[e.targetRole]=g-1)}break;case re.OpenArmyControl:n.armyControlOpen=!0;break;case re.CloseArmyControl:n.armyControlOpen=!1;break;case re.IncreaseArmyObjective:if(s&&s.tribeControl&&e.targetArmyObjective){s.tribeControl.armyControl||(s.tribeControl.armyControl={protectHomeland:yg,expandBorders:Sg,invadeEnemies:vg});const g=s.tribeControl.armyControl[e.targetArmyObjective]||0;g<10&&(s.tribeControl.armyControl[e.targetArmyObjective]=g+1)}break;case re.DecreaseArmyObjective:if(s&&s.tribeControl&&e.targetArmyObjective){s.tribeControl.armyControl||(s.tribeControl.armyControl={protectHomeland:yg,expandBorders:Sg,invadeEnemies:vg});const g=s.tribeControl.armyControl[e.targetArmyObjective]||0;g>0&&(s.tribeControl.armyControl[e.targetArmyObjective]=g-1)}break;case re.SwitchAIType:if(n.debugCharacterId){const g=n.entities.entities[n.debugCharacterId];g&&(g.aiType=g.aiType===Ut.BehaviorTreeBased?Ut.TaskBased:Ut.BehaviorTreeBased)}break}return n};function _F(e,t,n){if(!e.notificationButtonRects)return!1;const i=yt(e);for(const[a,s]of Object.entries(e.notificationButtonRects.dismiss))if(t>=s.x&&t<=s.x+s.width&&n>=s.y&&n<=s.y+s.height)return W_(e,a),i&&Ne({gameState:e},Ae.ButtonClick,i.position),!0;for(const[a,s]of Object.entries(e.notificationButtonRects.view))if(t>=s.x&&t<=s.x+s.width&&n>=s.y&&n<=s.y+s.height){const l=e.notifications.find(c=>c.id===a);if(l){let c=l.targetPosition;if(!c&&l.targetEntityIds&&l.targetEntityIds.length>0){const u=e.entities.entities[l.targetEntityIds[0]];u&&(c=u.position)}return c&&EF(e,c),i&&Ne({gameState:e},Ae.ButtonClick,i.position),l.highlightedEntityIds&&(l.renderHighlights=!l.renderHighlights),!0}}return!1}function aA(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const wF=(e,t)=>{var n;if(t.debugPanel!==Ye.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(aA(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const a=t.debugPanelRect.height-60,s=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-a);return t.debugPanelScroll.y>s&&(t.debugPanelScroll.y=s),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},RF=(e,t)=>t.debugPanel!==Ye.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:aA(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Iv=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},PF=(e,t)=>{var n,i;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const a=t.debugPanelRect.width-30,s=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-a);t.debugPanelScroll.x>s&&(t.debugPanelScroll.x=s);const l=t.debugPanelRect.height-60,c=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.height)??0)-l);return t.debugPanelScroll.y>c&&(t.debugPanelScroll.y=c),{newState:t,handled:!0}}return{newState:t,handled:!1}},DF=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:i,playerActionHintsRef:a,keysPressed:s,returnToIntro:l})=>(Be.useEffect(()=>{const c=u=>{if(!e()||t.current.gameOver||!n.current)return;const f=wF(u,t.current);t.current=f.newState,f.handled};return window.addEventListener("wheel",c,{passive:!1}),()=>{window.removeEventListener("wheel",c)}},[e,n,t]),Be.useEffect(()=>{const c=f=>{if(!e()||t.current.gameOver||!n.current||!f.target||f.target!==n.current)return;const g=n.current.getBoundingClientRect(),m=f.clientX-g.left,S=f.clientY-g.top;if(_F(t.current,m,S))return;const T=t.current.uiButtons.find(N=>m>=N.rect.x&&m<=N.rect.x+N.rect.width&&S>=N.rect.y&&S<=N.rect.y+N.rect.height);if(T){t.current=CF(T,f.shiftKey,t.current,l);return}const I=RF(f,t.current);if(t.current=I.newState,I.handled)return;const _=Fg({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);SF(t.current,_)},u=f=>{if(!e()||!n.current)return;const g=Iv(f,t.current);t.current=g.newState};return window.addEventListener("mousedown",c),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",c),window.removeEventListener("mouseup",u)}},[e,n,t,i,l]),Be.useEffect(()=>{const c=u=>{if(!e()||!n.current)return;const f=PF(u,t.current);if(t.current=f.newState,f.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const I=Iv(u,t.current);t.current=I.newState}const g=n.current.getBoundingClientRect(),m=u.clientX-g.left,S=u.clientY-g.top;t.current.mousePosition={x:m,y:S};let v;if(t.current.notificationButtonRects){for(const[I,_]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=_.x&&m<=_.x+_.width&&S>=_.y&&S<=_.y+_.height){v=`notification-dismiss-${I}`;break}if(!v){for(const[I,_]of Object.entries(t.current.notificationButtonRects.view))if(m>=_.x&&m<=_.x+_.width&&S>=_.y&&S<=_.y+_.height){v=`notification-view-${I}`;break}}}if(!v)for(let I=t.current.uiButtons.length-1;I>=0;I--){const _=t.current.uiButtons[I];if(m>=_.rect.x&&m<=_.rect.x+_.rect.width&&S>=_.rect.y&&S<=_.rect.y+_.rect.height){v=_.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0;return}const T=yt(t.current);if(T){const I=Fg({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=yF(I,T,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",c),()=>{window.removeEventListener("mousemove",c)}},[e,n,t,i]),Be.useEffect(()=>{const c=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();(g===" "||g==="p"||g==="tab"||(f.ctrlKey||f.metaKey)&&(g==="s"||g==="a"))&&f.preventDefault();const m=vF(f,t.current);if(t.current=m.newState,m.handled)return;const S=yt(t.current);S&&(s.current.add(g),IF(g,f.shiftKey,t.current,S,a.current))},u=f=>{if(!e()||t.current.gameOver)return;const g=f.key.toLowerCase();s.current.delete(g);const m=yt(t.current);m&&TF(g,m,t.current,s)};return window.addEventListener("keydown",c),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",c),window.removeEventListener("keyup",u)}},[e,t,a,s,l]),null),NF=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:i,playerActionHintsRef:a,keysPressed:s,canvasRef:l,setAppState:c,appState:u})=>{const f=Be.useRef(),{returnToIntro:g}=jr(),[m,S,v]=XT(T=>{var B,O;if(!t.current||!f.current){f.current=T;return}const I=Math.min(T-f.current,1e3)/1e3,{performanceMetrics:_}=e.current;_.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const N=performance.now();e.current=Mu(e.current,I),_.currentBucket.worldUpdateTime=performance.now()-N;const R=yt(e.current);R?a.current=_p(e.current,R):a.current=[],i.current=AF(e.current,i.current,I);const w=performance.now();nu(t.current,e.current,i.current,a.current,{width:((B=l.current)==null?void 0:B.width)||800,height:((O=l.current)==null?void 0:O.height)||600},!1),_.currentBucket.renderTime=performance.now()-w,_.history.push({bucketTime:e.current.time,..._.currentBucket}),_.history.length>EC&&_.history.shift(),f.current=T,e.current.gameOver&&u!=="gameOver"&&(cp(Ae.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),c("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return Be.useEffect(()=>(S(),m),[S,m]),Le.jsx(DF,{isActive:v,gameStateRef:e,canvasRef:l,viewportCenterRef:i,playerActionHintsRef:a,debugPanelTypeRef:n,keysPressed:s,returnToIntro:g})},Tv=()=>{const{savedGameState:e,contextReady:t}=jr(),[n,i]=Be.useState(null);return Be.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),i(e)):(console.log("Initializing new game state..."),i(pF())))},[t,e]),!t||!n?Le.jsx("div",{children:"Loading..."}):Le.jsx(MF,{initialState:n})},MF=({initialState:e})=>{const t=Be.useRef(null),n=Be.useRef(null),i=Be.useRef(e),a=Be.useRef(new Set),s=Be.useRef(e.debugPanel),l=Be.useRef(e.viewportCenter),c=Be.useRef([]),{appState:u,setAppState:f}=jr();return Le.jsxs(Le.Fragment,{children:[Le.jsx(mF,{canvasRef:t,ctxRef:n,gameStateRef:i,debugPanelTypeRef:s,viewportCenterRef:l,playerActionHintsRef:c}),Le.jsx(NF,{gameStateRef:i,ctxRef:n,debugPanelTypeRef:s,viewportCenterRef:l,playerActionHintsRef:c,keysPressed:a,canvasRef:t,setAppState:f,appState:u})]})},OF=Nt.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,kF=Nt.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Rd=Nt.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,bF=Nt.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,BF=()=>{const{setAppState:e,gameOverDetails:t}=jr(),n=()=>{e("intro")};return Le.jsxs(OF,{children:[Le.jsx(kF,{children:"Game Over"}),Le.jsx(Rd,{children:"Your tribe's lineage has ended."}),t&&Le.jsxs(Le.Fragment,{children:[Le.jsxs(Rd,{children:["Generations Survived: ",t.generations]}),Le.jsxs(Rd,{children:["Cause of Extinction: ",t.cause]})]}),!t&&Le.jsx(Rd,{children:"Game details are unavailable."}),Le.jsx(bF,{onClick:n,children:"Return to Menu"})]})},FF=Nt.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,LF=Nt.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,UF=Nt.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,HF=Nt.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,GF=Nt.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,lA=Nt.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,$F=Nt(lA)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,dl=800,ul=600,xF=()=>{const{returnToIntro:e}=jr(),t=Be.useRef(null),n=Be.useRef(),i=Be.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:dl,height:ul}}),a=l=>{const c={x:dl/2,y:ul/2};let u;l===Te.StoneProjectile&&(u={x:c.x+200*(Math.random()-Math.random()),y:c.y+200*(Math.random()-Math.random())}),Ge(i.current,l,c,1,void 0,u)};Be.useEffect(()=>{const l=()=>{i.current.time+=.016,qT(i.current);const u=t.current,f=u==null?void 0:u.getContext("2d");f&&(f.clearRect(0,0,dl,ul),f.fillStyle="#2c5234",f.fillRect(0,0,dl,ul),i.current.visualEffects.forEach(g=>{sA(f,g,i.current.time,i.current)})),n.current=requestAnimationFrame(l)};return n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const s=Object.keys(Te).filter(l=>isNaN(Number(l))).map(l=>({name:l,value:Te[l]}));return Le.jsxs(FF,{children:[Le.jsxs(LF,{children:[Le.jsx(GF,{children:"Visual Effects"}),s.map(l=>Le.jsx(lA,{onClick:()=>a(l.value),children:l.name},l.name)),Le.jsx($F,{onClick:e,children:"Back to Intro"})]}),Le.jsxs(UF,{children:[Le.jsx(HF,{ref:t,width:dl,height:ul}),Le.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},WF=VO`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function YF(e,t){Be.useEffect(()=>{const n=()=>{const i=document.location.hash;t(i==="#game"?"game":i==="#effects"?"effects":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),Be.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const zF=()=>{const{appState:e,setAppState:t}=jr();YF(e,t);const n=()=>{switch(e){case"intro":return Le.jsx(vv,{});case"game":return Le.jsx(Tv,{});case"effects":return Le.jsx(xF,{});case"gameOver":return Le.jsxs(Le.Fragment,{children:[Le.jsx(Tv,{}),Le.jsx(BF,{})]});default:return Le.jsx(vv,{})}};return Le.jsxs(Le.Fragment,{children:[Le.jsx(WF,{}),n()]})},Av=document.getElementById("root");Av?dR().then(()=>{mC.createRoot(Av).render(Le.jsx(Di.StrictMode,{children:Le.jsx(XM,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:Le.jsx(zF,{})})}))}):console.error("Failed to find the root element");
