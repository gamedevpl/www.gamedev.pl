var hC=Object.defineProperty;var pC=(e,t,n)=>t in e?hC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var De=(e,t,n)=>pC(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&i(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function _v(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ph={exports:{}},nl={},Dh={exports:{}},Ye={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ry;function gC(){if(Ry)return Ye;Ry=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.iterator;function S(b){return b===null||typeof b!="object"?null:(b=m&&b[m]||b["@@iterator"],typeof b=="function"?b:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,A={};function _(b,Y,le){this.props=b,this.context=Y,this.refs=A,this.updater=le||v}_.prototype.isReactComponent={},_.prototype.setState=function(b,Y){if(typeof b!="object"&&typeof b!="function"&&b!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,b,Y,"setState")},_.prototype.forceUpdate=function(b){this.updater.enqueueForceUpdate(this,b,"forceUpdate")};function P(){}P.prototype=_.prototype;function R(b,Y,le){this.props=b,this.context=Y,this.refs=A,this.updater=le||v}var w=R.prototype=new P;w.constructor=R,I(w,_.prototype),w.isPureReactComponent=!0;var B=Array.isArray,O=Object.prototype.hasOwnProperty,N={current:null},M={key:!0,ref:!0,__self:!0,__source:!0};function F(b,Y,le){var pe,Pe={},me=null,Oe=null;if(Y!=null)for(pe in Y.ref!==void 0&&(Oe=Y.ref),Y.key!==void 0&&(me=""+Y.key),Y)O.call(Y,pe)&&!M.hasOwnProperty(pe)&&(Pe[pe]=Y[pe]);var Ne=arguments.length-2;if(Ne===1)Pe.children=le;else if(1<Ne){for(var ce=Array(Ne),Se=0;Se<Ne;Se++)ce[Se]=arguments[Se+2];Pe.children=ce}if(b&&b.defaultProps)for(pe in Ne=b.defaultProps,Ne)Pe[pe]===void 0&&(Pe[pe]=Ne[pe]);return{$$typeof:e,type:b,key:me,ref:Oe,props:Pe,_owner:N.current}}function x(b,Y){return{$$typeof:e,type:b.type,key:Y,ref:b.ref,props:b.props,_owner:b._owner}}function Z(b){return typeof b=="object"&&b!==null&&b.$$typeof===e}function te(b){var Y={"=":"=0",":":"=2"};return"$"+b.replace(/[=:]/g,function(le){return Y[le]})}var j=/\/+/g;function ie(b,Y){return typeof b=="object"&&b!==null&&b.key!=null?te(""+b.key):Y.toString(36)}function re(b,Y,le,pe,Pe){var me=typeof b;(me==="undefined"||me==="boolean")&&(b=null);var Oe=!1;if(b===null)Oe=!0;else switch(me){case"string":case"number":Oe=!0;break;case"object":switch(b.$$typeof){case e:case t:Oe=!0}}if(Oe)return Oe=b,Pe=Pe(Oe),b=pe===""?"."+ie(Oe,0):pe,B(Pe)?(le="",b!=null&&(le=b.replace(j,"$&/")+"/"),re(Pe,Y,le,"",function(Se){return Se})):Pe!=null&&(Z(Pe)&&(Pe=x(Pe,le+(!Pe.key||Oe&&Oe.key===Pe.key?"":(""+Pe.key).replace(j,"$&/")+"/")+b)),Y.push(Pe)),1;if(Oe=0,pe=pe===""?".":pe+":",B(b))for(var Ne=0;Ne<b.length;Ne++){me=b[Ne];var ce=pe+ie(me,Ne);Oe+=re(me,Y,le,ce,Pe)}else if(ce=S(b),typeof ce=="function")for(b=ce.call(b),Ne=0;!(me=b.next()).done;)me=me.value,ce=pe+ie(me,Ne++),Oe+=re(me,Y,le,ce,Pe);else if(me==="object")throw Y=String(b),Error("Objects are not valid as a React child (found: "+(Y==="[object Object]"?"object with keys {"+Object.keys(b).join(", ")+"}":Y)+"). If you meant to render a collection of children, use an array instead.");return Oe}function _e(b,Y,le){if(b==null)return b;var pe=[],Pe=0;return re(b,pe,"","",function(me){return Y.call(le,me,Pe++)}),pe}function ue(b){if(b._status===-1){var Y=b._result;Y=Y(),Y.then(function(le){(b._status===0||b._status===-1)&&(b._status=1,b._result=le)},function(le){(b._status===0||b._status===-1)&&(b._status=2,b._result=le)}),b._status===-1&&(b._status=0,b._result=Y)}if(b._status===1)return b._result.default;throw b._result}var ne={current:null},z={transition:null},V={ReactCurrentDispatcher:ne,ReactCurrentBatchConfig:z,ReactCurrentOwner:N};function K(){throw Error("act(...) is not supported in production builds of React.")}return Ye.Children={map:_e,forEach:function(b,Y,le){_e(b,function(){Y.apply(this,arguments)},le)},count:function(b){var Y=0;return _e(b,function(){Y++}),Y},toArray:function(b){return _e(b,function(Y){return Y})||[]},only:function(b){if(!Z(b))throw Error("React.Children.only expected to receive a single React element child.");return b}},Ye.Component=_,Ye.Fragment=n,Ye.Profiler=s,Ye.PureComponent=R,Ye.StrictMode=i,Ye.Suspense=u,Ye.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V,Ye.act=K,Ye.cloneElement=function(b,Y,le){if(b==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+b+".");var pe=I({},b.props),Pe=b.key,me=b.ref,Oe=b._owner;if(Y!=null){if(Y.ref!==void 0&&(me=Y.ref,Oe=N.current),Y.key!==void 0&&(Pe=""+Y.key),b.type&&b.type.defaultProps)var Ne=b.type.defaultProps;for(ce in Y)O.call(Y,ce)&&!M.hasOwnProperty(ce)&&(pe[ce]=Y[ce]===void 0&&Ne!==void 0?Ne[ce]:Y[ce])}var ce=arguments.length-2;if(ce===1)pe.children=le;else if(1<ce){Ne=Array(ce);for(var Se=0;Se<ce;Se++)Ne[Se]=arguments[Se+2];pe.children=Ne}return{$$typeof:e,type:b.type,key:Pe,ref:me,props:pe,_owner:Oe}},Ye.createContext=function(b){return b={$$typeof:l,_currentValue:b,_currentValue2:b,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},b.Provider={$$typeof:a,_context:b},b.Consumer=b},Ye.createElement=F,Ye.createFactory=function(b){var Y=F.bind(null,b);return Y.type=b,Y},Ye.createRef=function(){return{current:null}},Ye.forwardRef=function(b){return{$$typeof:c,render:b}},Ye.isValidElement=Z,Ye.lazy=function(b){return{$$typeof:p,_payload:{_status:-1,_result:b},_init:ue}},Ye.memo=function(b,Y){return{$$typeof:f,type:b,compare:Y===void 0?null:Y}},Ye.startTransition=function(b){var Y=z.transition;z.transition={};try{b()}finally{z.transition=Y}},Ye.unstable_act=K,Ye.useCallback=function(b,Y){return ne.current.useCallback(b,Y)},Ye.useContext=function(b){return ne.current.useContext(b)},Ye.useDebugValue=function(){},Ye.useDeferredValue=function(b){return ne.current.useDeferredValue(b)},Ye.useEffect=function(b,Y){return ne.current.useEffect(b,Y)},Ye.useId=function(){return ne.current.useId()},Ye.useImperativeHandle=function(b,Y,le){return ne.current.useImperativeHandle(b,Y,le)},Ye.useInsertionEffect=function(b,Y){return ne.current.useInsertionEffect(b,Y)},Ye.useLayoutEffect=function(b,Y){return ne.current.useLayoutEffect(b,Y)},Ye.useMemo=function(b,Y){return ne.current.useMemo(b,Y)},Ye.useReducer=function(b,Y,le){return ne.current.useReducer(b,Y,le)},Ye.useRef=function(b){return ne.current.useRef(b)},Ye.useState=function(b){return ne.current.useState(b)},Ye.useSyncExternalStore=function(b,Y,le){return ne.current.useSyncExternalStore(b,Y,le)},Ye.useTransition=function(){return ne.current.useTransition()},Ye.version="18.3.1",Ye}var Py;function xp(){return Py||(Py=1,Dh.exports=gC()),Dh.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dy;function mC(){if(Dy)return nl;Dy=1;var e=xp(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(c,u,f){var p,m={},S=null,v=null;f!==void 0&&(S=""+f),u.key!==void 0&&(S=""+u.key),u.ref!==void 0&&(v=u.ref);for(p in u)i.call(u,p)&&!a.hasOwnProperty(p)&&(m[p]=u[p]);if(c&&c.defaultProps)for(p in u=c.defaultProps,u)m[p]===void 0&&(m[p]=u[p]);return{$$typeof:t,type:c,key:S,ref:v,props:m,_owner:s.current}}return nl.Fragment=n,nl.jsx=l,nl.jsxs=l,nl}var Ny;function yC(){return Ny||(Ny=1,Ph.exports=mC()),Ph.exports}var Ue=yC(),Fe=xp();const Mi=_v(Fe);var dd={},Nh={exports:{}},wn={},Mh={exports:{}},Oh={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var My;function SC(){return My||(My=1,function(e){function t(z,V){var K=z.length;z.push(V);e:for(;0<K;){var b=K-1>>>1,Y=z[b];if(0<s(Y,V))z[b]=V,z[K]=Y,K=b;else break e}}function n(z){return z.length===0?null:z[0]}function i(z){if(z.length===0)return null;var V=z[0],K=z.pop();if(K!==V){z[0]=K;e:for(var b=0,Y=z.length,le=Y>>>1;b<le;){var pe=2*(b+1)-1,Pe=z[pe],me=pe+1,Oe=z[me];if(0>s(Pe,K))me<Y&&0>s(Oe,Pe)?(z[b]=Oe,z[me]=K,b=me):(z[b]=Pe,z[pe]=K,b=pe);else if(me<Y&&0>s(Oe,K))z[b]=Oe,z[me]=K,b=me;else break e}}return V}function s(z,V){var K=z.sortIndex-V.sortIndex;return K!==0?K:z.id-V.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var l=Date,c=l.now();e.unstable_now=function(){return l.now()-c}}var u=[],f=[],p=1,m=null,S=3,v=!1,I=!1,A=!1,_=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(z){for(var V=n(f);V!==null;){if(V.callback===null)i(f);else if(V.startTime<=z)i(f),V.sortIndex=V.expirationTime,t(u,V);else break;V=n(f)}}function B(z){if(A=!1,w(z),!I)if(n(u)!==null)I=!0,ue(O);else{var V=n(f);V!==null&&ne(B,V.startTime-z)}}function O(z,V){I=!1,A&&(A=!1,P(F),F=-1),v=!0;var K=S;try{for(w(V),m=n(u);m!==null&&(!(m.expirationTime>V)||z&&!te());){var b=m.callback;if(typeof b=="function"){m.callback=null,S=m.priorityLevel;var Y=b(m.expirationTime<=V);V=e.unstable_now(),typeof Y=="function"?m.callback=Y:m===n(u)&&i(u),w(V)}else i(u);m=n(u)}if(m!==null)var le=!0;else{var pe=n(f);pe!==null&&ne(B,pe.startTime-V),le=!1}return le}finally{m=null,S=K,v=!1}}var N=!1,M=null,F=-1,x=5,Z=-1;function te(){return!(e.unstable_now()-Z<x)}function j(){if(M!==null){var z=e.unstable_now();Z=z;var V=!0;try{V=M(!0,z)}finally{V?ie():(N=!1,M=null)}}else N=!1}var ie;if(typeof R=="function")ie=function(){R(j)};else if(typeof MessageChannel<"u"){var re=new MessageChannel,_e=re.port2;re.port1.onmessage=j,ie=function(){_e.postMessage(null)}}else ie=function(){_(j,0)};function ue(z){M=z,N||(N=!0,ie())}function ne(z,V){F=_(function(){z(e.unstable_now())},V)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(z){z.callback=null},e.unstable_continueExecution=function(){I||v||(I=!0,ue(O))},e.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<z?Math.floor(1e3/z):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(z){switch(S){case 1:case 2:case 3:var V=3;break;default:V=S}var K=S;S=V;try{return z()}finally{S=K}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(z,V){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var K=S;S=z;try{return V()}finally{S=K}},e.unstable_scheduleCallback=function(z,V,K){var b=e.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?b+K:b):K=b,z){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=K+Y,z={id:p++,callback:V,priorityLevel:z,startTime:K,expirationTime:Y,sortIndex:-1},K>b?(z.sortIndex=K,t(f,z),n(u)===null&&z===n(f)&&(A?(P(F),F=-1):A=!0,ne(B,K-b))):(z.sortIndex=Y,t(u,z),I||v||(I=!0,ue(O))),z},e.unstable_shouldYield=te,e.unstable_wrapCallback=function(z){var V=S;return function(){var K=S;S=V;try{return z.apply(this,arguments)}finally{S=K}}}}(Oh)),Oh}var Oy;function vC(){return Oy||(Oy=1,Mh.exports=SC()),Mh.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ky;function AC(){if(ky)return wn;ky=1;var e=xp(),t=vC();function n(o){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+o,d=1;d<arguments.length;d++)r+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+o+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,s={};function a(o,r){l(o,r),l(o+"Capture",r)}function l(o,r){for(s[o]=r,o=0;o<r.length;o++)i.add(r[o])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function S(o){return u.call(m,o)?!0:u.call(p,o)?!1:f.test(o)?m[o]=!0:(p[o]=!0,!1)}function v(o,r,d,h){if(d!==null&&d.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return h?!1:d!==null?!d.acceptsBooleans:(o=o.toLowerCase().slice(0,5),o!=="data-"&&o!=="aria-");default:return!1}}function I(o,r,d,h){if(r===null||typeof r>"u"||v(o,r,d,h))return!0;if(h)return!1;if(d!==null)switch(d.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function A(o,r,d,h,g,y,E){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=h,this.attributeNamespace=g,this.mustUseProperty=d,this.propertyName=o,this.type=r,this.sanitizeURL=y,this.removeEmptyString=E}var _={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(o){_[o]=new A(o,0,!1,o,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(o){var r=o[0];_[r]=new A(r,1,!1,o[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(o){_[o]=new A(o,2,!1,o.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(o){_[o]=new A(o,2,!1,o,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(o){_[o]=new A(o,3,!1,o.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(o){_[o]=new A(o,3,!0,o,null,!1,!1)}),["capture","download"].forEach(function(o){_[o]=new A(o,4,!1,o,null,!1,!1)}),["cols","rows","size","span"].forEach(function(o){_[o]=new A(o,6,!1,o,null,!1,!1)}),["rowSpan","start"].forEach(function(o){_[o]=new A(o,5,!1,o.toLowerCase(),null,!1,!1)});var P=/[\-:]([a-z])/g;function R(o){return o[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(o){var r=o.replace(P,R);_[r]=new A(r,1,!1,o,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(o){var r=o.replace(P,R);_[r]=new A(r,1,!1,o,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(o){var r=o.replace(P,R);_[r]=new A(r,1,!1,o,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(o){_[o]=new A(o,1,!1,o.toLowerCase(),null,!1,!1)}),_.xlinkHref=new A("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(o){_[o]=new A(o,1,!1,o.toLowerCase(),null,!0,!0)});function w(o,r,d,h){var g=_.hasOwnProperty(r)?_[r]:null;(g!==null?g.type!==0:h||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(I(r,d,g,h)&&(d=null),h||g===null?S(r)&&(d===null?o.removeAttribute(r):o.setAttribute(r,""+d)):g.mustUseProperty?o[g.propertyName]=d===null?g.type===3?!1:"":d:(r=g.attributeName,h=g.attributeNamespace,d===null?o.removeAttribute(r):(g=g.type,d=g===3||g===4&&d===!0?"":""+d,h?o.setAttributeNS(h,r,d):o.setAttribute(r,d))))}var B=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O=Symbol.for("react.element"),N=Symbol.for("react.portal"),M=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),x=Symbol.for("react.profiler"),Z=Symbol.for("react.provider"),te=Symbol.for("react.context"),j=Symbol.for("react.forward_ref"),ie=Symbol.for("react.suspense"),re=Symbol.for("react.suspense_list"),_e=Symbol.for("react.memo"),ue=Symbol.for("react.lazy"),ne=Symbol.for("react.offscreen"),z=Symbol.iterator;function V(o){return o===null||typeof o!="object"?null:(o=z&&o[z]||o["@@iterator"],typeof o=="function"?o:null)}var K=Object.assign,b;function Y(o){if(b===void 0)try{throw Error()}catch(d){var r=d.stack.trim().match(/\n( *(at )?)/);b=r&&r[1]||""}return`
`+b+o}var le=!1;function pe(o,r){if(!o||le)return"";le=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch($){var h=$}Reflect.construct(o,[],r)}else{try{r.call()}catch($){h=$}o.call(r.prototype)}else{try{throw Error()}catch($){h=$}o()}}catch($){if($&&h&&typeof $.stack=="string"){for(var g=$.stack.split(`
`),y=h.stack.split(`
`),E=g.length-1,D=y.length-1;1<=E&&0<=D&&g[E]!==y[D];)D--;for(;1<=E&&0<=D;E--,D--)if(g[E]!==y[D]){if(E!==1||D!==1)do if(E--,D--,0>D||g[E]!==y[D]){var k=`
`+g[E].replace(" at new "," at ");return o.displayName&&k.includes("<anonymous>")&&(k=k.replace("<anonymous>",o.displayName)),k}while(1<=E&&0<=D);break}}}finally{le=!1,Error.prepareStackTrace=d}return(o=o?o.displayName||o.name:"")?Y(o):""}function Pe(o){switch(o.tag){case 5:return Y(o.type);case 16:return Y("Lazy");case 13:return Y("Suspense");case 19:return Y("SuspenseList");case 0:case 2:case 15:return o=pe(o.type,!1),o;case 11:return o=pe(o.type.render,!1),o;case 1:return o=pe(o.type,!0),o;default:return""}}function me(o){if(o==null)return null;if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case M:return"Fragment";case N:return"Portal";case x:return"Profiler";case F:return"StrictMode";case ie:return"Suspense";case re:return"SuspenseList"}if(typeof o=="object")switch(o.$$typeof){case te:return(o.displayName||"Context")+".Consumer";case Z:return(o._context.displayName||"Context")+".Provider";case j:var r=o.render;return o=o.displayName,o||(o=r.displayName||r.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case _e:return r=o.displayName||null,r!==null?r:me(o.type)||"Memo";case ue:r=o._payload,o=o._init;try{return me(o(r))}catch{}}return null}function Oe(o){var r=o.type;switch(o.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return o=r.render,o=o.displayName||o.name||"",r.displayName||(o!==""?"ForwardRef("+o+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return me(r);case 8:return r===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Ne(o){switch(typeof o){case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function ce(o){var r=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function Se(o){var r=ce(o)?"checked":"value",d=Object.getOwnPropertyDescriptor(o.constructor.prototype,r),h=""+o[r];if(!o.hasOwnProperty(r)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var g=d.get,y=d.set;return Object.defineProperty(o,r,{configurable:!0,get:function(){return g.call(this)},set:function(E){h=""+E,y.call(this,E)}}),Object.defineProperty(o,r,{enumerable:d.enumerable}),{getValue:function(){return h},setValue:function(E){h=""+E},stopTracking:function(){o._valueTracker=null,delete o[r]}}}}function $e(o){o._valueTracker||(o._valueTracker=Se(o))}function Ie(o){if(!o)return!1;var r=o._valueTracker;if(!r)return!0;var d=r.getValue(),h="";return o&&(h=ce(o)?o.checked?"true":"false":o.value),o=h,o!==d?(r.setValue(o),!0):!1}function ni(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}function nt(o,r){var d=r.checked;return K({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??o._wrapperState.initialChecked})}function at(o,r){var d=r.defaultValue==null?"":r.defaultValue,h=r.checked!=null?r.checked:r.defaultChecked;d=Ne(r.value!=null?r.value:d),o._wrapperState={initialChecked:h,initialValue:d,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function gi(o,r){r=r.checked,r!=null&&w(o,"checked",r,!1)}function An(o,r){gi(o,r);var d=Ne(r.value),h=r.type;if(d!=null)h==="number"?(d===0&&o.value===""||o.value!=d)&&(o.value=""+d):o.value!==""+d&&(o.value=""+d);else if(h==="submit"||h==="reset"){o.removeAttribute("value");return}r.hasOwnProperty("value")?mi(o,r.type,d):r.hasOwnProperty("defaultValue")&&mi(o,r.type,Ne(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(o.defaultChecked=!!r.defaultChecked)}function Wn(o,r,d){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var h=r.type;if(!(h!=="submit"&&h!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+o._wrapperState.initialValue,d||r===o.value||(o.value=r),o.defaultValue=r}d=o.name,d!==""&&(o.name=""),o.defaultChecked=!!o._wrapperState.initialChecked,d!==""&&(o.name=d)}function mi(o,r,d){(r!=="number"||ni(o.ownerDocument)!==o)&&(d==null?o.defaultValue=""+o._wrapperState.initialValue:o.defaultValue!==""+d&&(o.defaultValue=""+d))}var yi=Array.isArray;function lo(o,r,d,h){if(o=o.options,r){r={};for(var g=0;g<d.length;g++)r["$"+d[g]]=!0;for(d=0;d<o.length;d++)g=r.hasOwnProperty("$"+o[d].value),o[d].selected!==g&&(o[d].selected=g),g&&h&&(o[d].defaultSelected=!0)}else{for(d=""+Ne(d),r=null,g=0;g<o.length;g++){if(o[g].value===d){o[g].selected=!0,h&&(o[g].defaultSelected=!0);return}r!==null||o[g].disabled||(r=o[g])}r!==null&&(r.selected=!0)}}function nr(o,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return K({},r,{value:void 0,defaultValue:void 0,children:""+o._wrapperState.initialValue})}function Lg(o,r){var d=r.value;if(d==null){if(d=r.children,r=r.defaultValue,d!=null){if(r!=null)throw Error(n(92));if(yi(d)){if(1<d.length)throw Error(n(93));d=d[0]}r=d}r==null&&(r=""),d=r}o._wrapperState={initialValue:Ne(d)}}function Ug(o,r){var d=Ne(r.value),h=Ne(r.defaultValue);d!=null&&(d=""+d,d!==o.value&&(o.value=d),r.defaultValue==null&&o.defaultValue!==d&&(o.defaultValue=d)),h!=null&&(o.defaultValue=""+h)}function Hg(o){var r=o.textContent;r===o._wrapperState.initialValue&&r!==""&&r!==null&&(o.value=r)}function Gg(o){switch(o){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Uu(o,r){return o==null||o==="http://www.w3.org/1999/xhtml"?Gg(r):o==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":o}var nc,$g=function(o){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,d,h,g){MSApp.execUnsafeLocalFunction(function(){return o(r,d,h,g)})}:o}(function(o,r){if(o.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in o)o.innerHTML=r;else{for(nc=nc||document.createElement("div"),nc.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=nc.firstChild;o.firstChild;)o.removeChild(o.firstChild);for(;r.firstChild;)o.appendChild(r.firstChild)}});function Sa(o,r){if(r){var d=o.firstChild;if(d&&d===o.lastChild&&d.nodeType===3){d.nodeValue=r;return}}o.textContent=r}var va={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},yT=["Webkit","ms","Moz","O"];Object.keys(va).forEach(function(o){yT.forEach(function(r){r=r+o.charAt(0).toUpperCase()+o.substring(1),va[r]=va[o]})});function xg(o,r,d){return r==null||typeof r=="boolean"||r===""?"":d||typeof r!="number"||r===0||va.hasOwnProperty(o)&&va[o]?(""+r).trim():r+"px"}function Wg(o,r){o=o.style;for(var d in r)if(r.hasOwnProperty(d)){var h=d.indexOf("--")===0,g=xg(d,r[d],h);d==="float"&&(d="cssFloat"),h?o.setProperty(d,g):o[d]=g}}var ST=K({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Hu(o,r){if(r){if(ST[o]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,o));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function Gu(o,r){if(o.indexOf("-")===-1)return typeof r.is=="string";switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var $u=null;function xu(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Wu=null,Vr=null,Kr=null;function Yg(o){if(o=$a(o)){if(typeof Wu!="function")throw Error(n(280));var r=o.stateNode;r&&(r=_c(r),Wu(o.stateNode,o.type,r))}}function zg(o){Vr?Kr?Kr.push(o):Kr=[o]:Vr=o}function jg(){if(Vr){var o=Vr,r=Kr;if(Kr=Vr=null,Yg(o),r)for(o=0;o<r.length;o++)Yg(r[o])}}function Xg(o,r){return o(r)}function Vg(){}var Yu=!1;function Kg(o,r,d){if(Yu)return o(r,d);Yu=!0;try{return Xg(o,r,d)}finally{Yu=!1,(Vr!==null||Kr!==null)&&(Vg(),jg())}}function Aa(o,r){var d=o.stateNode;if(d===null)return null;var h=_c(d);if(h===null)return null;d=h[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(h=!h.disabled)||(o=o.type,h=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!h;break e;default:o=!1}if(o)return null;if(d&&typeof d!="function")throw Error(n(231,r,typeof d));return d}var zu=!1;if(c)try{var Ia={};Object.defineProperty(Ia,"passive",{get:function(){zu=!0}}),window.addEventListener("test",Ia,Ia),window.removeEventListener("test",Ia,Ia)}catch{zu=!1}function vT(o,r,d,h,g,y,E,D,k){var $=Array.prototype.slice.call(arguments,3);try{r.apply(d,$)}catch(q){this.onError(q)}}var Ta=!1,ic=null,oc=!1,ju=null,AT={onError:function(o){Ta=!0,ic=o}};function IT(o,r,d,h,g,y,E,D,k){Ta=!1,ic=null,vT.apply(AT,arguments)}function TT(o,r,d,h,g,y,E,D,k){if(IT.apply(this,arguments),Ta){if(Ta){var $=ic;Ta=!1,ic=null}else throw Error(n(198));oc||(oc=!0,ju=$)}}function ir(o){var r=o,d=o;if(o.alternate)for(;r.return;)r=r.return;else{o=r;do r=o,(r.flags&4098)!==0&&(d=r.return),o=r.return;while(o)}return r.tag===3?d:null}function qg(o){if(o.tag===13){var r=o.memoizedState;if(r===null&&(o=o.alternate,o!==null&&(r=o.memoizedState)),r!==null)return r.dehydrated}return null}function Zg(o){if(ir(o)!==o)throw Error(n(188))}function ET(o){var r=o.alternate;if(!r){if(r=ir(o),r===null)throw Error(n(188));return r!==o?null:o}for(var d=o,h=r;;){var g=d.return;if(g===null)break;var y=g.alternate;if(y===null){if(h=g.return,h!==null){d=h;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===d)return Zg(g),o;if(y===h)return Zg(g),r;y=y.sibling}throw Error(n(188))}if(d.return!==h.return)d=g,h=y;else{for(var E=!1,D=g.child;D;){if(D===d){E=!0,d=g,h=y;break}if(D===h){E=!0,h=g,d=y;break}D=D.sibling}if(!E){for(D=y.child;D;){if(D===d){E=!0,d=y,h=g;break}if(D===h){E=!0,h=y,d=g;break}D=D.sibling}if(!E)throw Error(n(189))}}if(d.alternate!==h)throw Error(n(190))}if(d.tag!==3)throw Error(n(188));return d.stateNode.current===d?o:r}function Qg(o){return o=ET(o),o!==null?Jg(o):null}function Jg(o){if(o.tag===5||o.tag===6)return o;for(o=o.child;o!==null;){var r=Jg(o);if(r!==null)return r;o=o.sibling}return null}var em=t.unstable_scheduleCallback,tm=t.unstable_cancelCallback,CT=t.unstable_shouldYield,_T=t.unstable_requestPaint,vt=t.unstable_now,wT=t.unstable_getCurrentPriorityLevel,Xu=t.unstable_ImmediatePriority,nm=t.unstable_UserBlockingPriority,rc=t.unstable_NormalPriority,RT=t.unstable_LowPriority,im=t.unstable_IdlePriority,sc=null,Si=null;function PT(o){if(Si&&typeof Si.onCommitFiberRoot=="function")try{Si.onCommitFiberRoot(sc,o,void 0,(o.current.flags&128)===128)}catch{}}var ii=Math.clz32?Math.clz32:MT,DT=Math.log,NT=Math.LN2;function MT(o){return o>>>=0,o===0?32:31-(DT(o)/NT|0)|0}var ac=64,lc=4194304;function Ea(o){switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return o&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return o}}function cc(o,r){var d=o.pendingLanes;if(d===0)return 0;var h=0,g=o.suspendedLanes,y=o.pingedLanes,E=d&268435455;if(E!==0){var D=E&~g;D!==0?h=Ea(D):(y&=E,y!==0&&(h=Ea(y)))}else E=d&~g,E!==0?h=Ea(E):y!==0&&(h=Ea(y));if(h===0)return 0;if(r!==0&&r!==h&&(r&g)===0&&(g=h&-h,y=r&-r,g>=y||g===16&&(y&4194240)!==0))return r;if((h&4)!==0&&(h|=d&16),r=o.entangledLanes,r!==0)for(o=o.entanglements,r&=h;0<r;)d=31-ii(r),g=1<<d,h|=o[d],r&=~g;return h}function OT(o,r){switch(o){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function kT(o,r){for(var d=o.suspendedLanes,h=o.pingedLanes,g=o.expirationTimes,y=o.pendingLanes;0<y;){var E=31-ii(y),D=1<<E,k=g[E];k===-1?((D&d)===0||(D&h)!==0)&&(g[E]=OT(D,r)):k<=r&&(o.expiredLanes|=D),y&=~D}}function Vu(o){return o=o.pendingLanes&-1073741825,o!==0?o:o&1073741824?1073741824:0}function om(){var o=ac;return ac<<=1,(ac&4194240)===0&&(ac=64),o}function Ku(o){for(var r=[],d=0;31>d;d++)r.push(o);return r}function Ca(o,r,d){o.pendingLanes|=r,r!==536870912&&(o.suspendedLanes=0,o.pingedLanes=0),o=o.eventTimes,r=31-ii(r),o[r]=d}function bT(o,r){var d=o.pendingLanes&~r;o.pendingLanes=r,o.suspendedLanes=0,o.pingedLanes=0,o.expiredLanes&=r,o.mutableReadLanes&=r,o.entangledLanes&=r,r=o.entanglements;var h=o.eventTimes;for(o=o.expirationTimes;0<d;){var g=31-ii(d),y=1<<g;r[g]=0,h[g]=-1,o[g]=-1,d&=~y}}function qu(o,r){var d=o.entangledLanes|=r;for(o=o.entanglements;d;){var h=31-ii(d),g=1<<h;g&r|o[h]&r&&(o[h]|=r),d&=~g}}var tt=0;function rm(o){return o&=-o,1<o?4<o?(o&268435455)!==0?16:536870912:4:1}var sm,Zu,am,lm,cm,Qu=!1,dc=[],co=null,uo=null,fo=null,_a=new Map,wa=new Map,ho=[],BT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function dm(o,r){switch(o){case"focusin":case"focusout":co=null;break;case"dragenter":case"dragleave":uo=null;break;case"mouseover":case"mouseout":fo=null;break;case"pointerover":case"pointerout":_a.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":wa.delete(r.pointerId)}}function Ra(o,r,d,h,g,y){return o===null||o.nativeEvent!==y?(o={blockedOn:r,domEventName:d,eventSystemFlags:h,nativeEvent:y,targetContainers:[g]},r!==null&&(r=$a(r),r!==null&&Zu(r)),o):(o.eventSystemFlags|=h,r=o.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),o)}function FT(o,r,d,h,g){switch(r){case"focusin":return co=Ra(co,o,r,d,h,g),!0;case"dragenter":return uo=Ra(uo,o,r,d,h,g),!0;case"mouseover":return fo=Ra(fo,o,r,d,h,g),!0;case"pointerover":var y=g.pointerId;return _a.set(y,Ra(_a.get(y)||null,o,r,d,h,g)),!0;case"gotpointercapture":return y=g.pointerId,wa.set(y,Ra(wa.get(y)||null,o,r,d,h,g)),!0}return!1}function um(o){var r=or(o.target);if(r!==null){var d=ir(r);if(d!==null){if(r=d.tag,r===13){if(r=qg(d),r!==null){o.blockedOn=r,cm(o.priority,function(){am(d)});return}}else if(r===3&&d.stateNode.current.memoizedState.isDehydrated){o.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}o.blockedOn=null}function uc(o){if(o.blockedOn!==null)return!1;for(var r=o.targetContainers;0<r.length;){var d=ef(o.domEventName,o.eventSystemFlags,r[0],o.nativeEvent);if(d===null){d=o.nativeEvent;var h=new d.constructor(d.type,d);$u=h,d.target.dispatchEvent(h),$u=null}else return r=$a(d),r!==null&&Zu(r),o.blockedOn=d,!1;r.shift()}return!0}function fm(o,r,d){uc(o)&&d.delete(r)}function LT(){Qu=!1,co!==null&&uc(co)&&(co=null),uo!==null&&uc(uo)&&(uo=null),fo!==null&&uc(fo)&&(fo=null),_a.forEach(fm),wa.forEach(fm)}function Pa(o,r){o.blockedOn===r&&(o.blockedOn=null,Qu||(Qu=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,LT)))}function Da(o){function r(g){return Pa(g,o)}if(0<dc.length){Pa(dc[0],o);for(var d=1;d<dc.length;d++){var h=dc[d];h.blockedOn===o&&(h.blockedOn=null)}}for(co!==null&&Pa(co,o),uo!==null&&Pa(uo,o),fo!==null&&Pa(fo,o),_a.forEach(r),wa.forEach(r),d=0;d<ho.length;d++)h=ho[d],h.blockedOn===o&&(h.blockedOn=null);for(;0<ho.length&&(d=ho[0],d.blockedOn===null);)um(d),d.blockedOn===null&&ho.shift()}var qr=B.ReactCurrentBatchConfig,fc=!0;function UT(o,r,d,h){var g=tt,y=qr.transition;qr.transition=null;try{tt=1,Ju(o,r,d,h)}finally{tt=g,qr.transition=y}}function HT(o,r,d,h){var g=tt,y=qr.transition;qr.transition=null;try{tt=4,Ju(o,r,d,h)}finally{tt=g,qr.transition=y}}function Ju(o,r,d,h){if(fc){var g=ef(o,r,d,h);if(g===null)Sf(o,r,h,hc,d),dm(o,h);else if(FT(g,o,r,d,h))h.stopPropagation();else if(dm(o,h),r&4&&-1<BT.indexOf(o)){for(;g!==null;){var y=$a(g);if(y!==null&&sm(y),y=ef(o,r,d,h),y===null&&Sf(o,r,h,hc,d),y===g)break;g=y}g!==null&&h.stopPropagation()}else Sf(o,r,h,null,d)}}var hc=null;function ef(o,r,d,h){if(hc=null,o=xu(h),o=or(o),o!==null)if(r=ir(o),r===null)o=null;else if(d=r.tag,d===13){if(o=qg(r),o!==null)return o;o=null}else if(d===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;o=null}else r!==o&&(o=null);return hc=o,null}function hm(o){switch(o){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(wT()){case Xu:return 1;case nm:return 4;case rc:case RT:return 16;case im:return 536870912;default:return 16}default:return 16}}var po=null,tf=null,pc=null;function pm(){if(pc)return pc;var o,r=tf,d=r.length,h,g="value"in po?po.value:po.textContent,y=g.length;for(o=0;o<d&&r[o]===g[o];o++);var E=d-o;for(h=1;h<=E&&r[d-h]===g[y-h];h++);return pc=g.slice(o,1<h?1-h:void 0)}function gc(o){var r=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&r===13&&(o=13)):o=r,o===10&&(o=13),32<=o||o===13?o:0}function mc(){return!0}function gm(){return!1}function On(o){function r(d,h,g,y,E){this._reactName=d,this._targetInst=g,this.type=h,this.nativeEvent=y,this.target=E,this.currentTarget=null;for(var D in o)o.hasOwnProperty(D)&&(d=o[D],this[D]=d?d(y):y[D]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?mc:gm,this.isPropagationStopped=gm,this}return K(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=mc)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=mc)},persist:function(){},isPersistent:mc}),r}var Zr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},nf=On(Zr),Na=K({},Zr,{view:0,detail:0}),GT=On(Na),of,rf,Ma,yc=K({},Na,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:af,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Ma&&(Ma&&o.type==="mousemove"?(of=o.screenX-Ma.screenX,rf=o.screenY-Ma.screenY):rf=of=0,Ma=o),of)},movementY:function(o){return"movementY"in o?o.movementY:rf}}),mm=On(yc),$T=K({},yc,{dataTransfer:0}),xT=On($T),WT=K({},Na,{relatedTarget:0}),sf=On(WT),YT=K({},Zr,{animationName:0,elapsedTime:0,pseudoElement:0}),zT=On(YT),jT=K({},Zr,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),XT=On(jT),VT=K({},Zr,{data:0}),ym=On(VT),KT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},qT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ZT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function QT(o){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(o):(o=ZT[o])?!!r[o]:!1}function af(){return QT}var JT=K({},Na,{key:function(o){if(o.key){var r=KT[o.key]||o.key;if(r!=="Unidentified")return r}return o.type==="keypress"?(o=gc(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?qT[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:af,charCode:function(o){return o.type==="keypress"?gc(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?gc(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),eE=On(JT),tE=K({},yc,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Sm=On(tE),nE=K({},Na,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:af}),iE=On(nE),oE=K({},Zr,{propertyName:0,elapsedTime:0,pseudoElement:0}),rE=On(oE),sE=K({},yc,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),aE=On(sE),lE=[9,13,27,32],lf=c&&"CompositionEvent"in window,Oa=null;c&&"documentMode"in document&&(Oa=document.documentMode);var cE=c&&"TextEvent"in window&&!Oa,vm=c&&(!lf||Oa&&8<Oa&&11>=Oa),Am=" ",Im=!1;function Tm(o,r){switch(o){case"keyup":return lE.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Em(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Qr=!1;function dE(o,r){switch(o){case"compositionend":return Em(r);case"keypress":return r.which!==32?null:(Im=!0,Am);case"textInput":return o=r.data,o===Am&&Im?null:o;default:return null}}function uE(o,r){if(Qr)return o==="compositionend"||!lf&&Tm(o,r)?(o=pm(),pc=tf=po=null,Qr=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return vm&&r.locale!=="ko"?null:r.data;default:return null}}var fE={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Cm(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r==="input"?!!fE[o.type]:r==="textarea"}function _m(o,r,d,h){zg(h),r=Tc(r,"onChange"),0<r.length&&(d=new nf("onChange","change",null,d,h),o.push({event:d,listeners:r}))}var ka=null,ba=null;function hE(o){Wm(o,0)}function Sc(o){var r=is(o);if(Ie(r))return o}function pE(o,r){if(o==="change")return r}var wm=!1;if(c){var cf;if(c){var df="oninput"in document;if(!df){var Rm=document.createElement("div");Rm.setAttribute("oninput","return;"),df=typeof Rm.oninput=="function"}cf=df}else cf=!1;wm=cf&&(!document.documentMode||9<document.documentMode)}function Pm(){ka&&(ka.detachEvent("onpropertychange",Dm),ba=ka=null)}function Dm(o){if(o.propertyName==="value"&&Sc(ba)){var r=[];_m(r,ba,o,xu(o)),Kg(hE,r)}}function gE(o,r,d){o==="focusin"?(Pm(),ka=r,ba=d,ka.attachEvent("onpropertychange",Dm)):o==="focusout"&&Pm()}function mE(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Sc(ba)}function yE(o,r){if(o==="click")return Sc(r)}function SE(o,r){if(o==="input"||o==="change")return Sc(r)}function vE(o,r){return o===r&&(o!==0||1/o===1/r)||o!==o&&r!==r}var oi=typeof Object.is=="function"?Object.is:vE;function Ba(o,r){if(oi(o,r))return!0;if(typeof o!="object"||o===null||typeof r!="object"||r===null)return!1;var d=Object.keys(o),h=Object.keys(r);if(d.length!==h.length)return!1;for(h=0;h<d.length;h++){var g=d[h];if(!u.call(r,g)||!oi(o[g],r[g]))return!1}return!0}function Nm(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Mm(o,r){var d=Nm(o);o=0;for(var h;d;){if(d.nodeType===3){if(h=o+d.textContent.length,o<=r&&h>=r)return{node:d,offset:r-o};o=h}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=Nm(d)}}function Om(o,r){return o&&r?o===r?!0:o&&o.nodeType===3?!1:r&&r.nodeType===3?Om(o,r.parentNode):"contains"in o?o.contains(r):o.compareDocumentPosition?!!(o.compareDocumentPosition(r)&16):!1:!1}function km(){for(var o=window,r=ni();r instanceof o.HTMLIFrameElement;){try{var d=typeof r.contentWindow.location.href=="string"}catch{d=!1}if(d)o=r.contentWindow;else break;r=ni(o.document)}return r}function uf(o){var r=o&&o.nodeName&&o.nodeName.toLowerCase();return r&&(r==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||r==="textarea"||o.contentEditable==="true")}function AE(o){var r=km(),d=o.focusedElem,h=o.selectionRange;if(r!==d&&d&&d.ownerDocument&&Om(d.ownerDocument.documentElement,d)){if(h!==null&&uf(d)){if(r=h.start,o=h.end,o===void 0&&(o=r),"selectionStart"in d)d.selectionStart=r,d.selectionEnd=Math.min(o,d.value.length);else if(o=(r=d.ownerDocument||document)&&r.defaultView||window,o.getSelection){o=o.getSelection();var g=d.textContent.length,y=Math.min(h.start,g);h=h.end===void 0?y:Math.min(h.end,g),!o.extend&&y>h&&(g=h,h=y,y=g),g=Mm(d,y);var E=Mm(d,h);g&&E&&(o.rangeCount!==1||o.anchorNode!==g.node||o.anchorOffset!==g.offset||o.focusNode!==E.node||o.focusOffset!==E.offset)&&(r=r.createRange(),r.setStart(g.node,g.offset),o.removeAllRanges(),y>h?(o.addRange(r),o.extend(E.node,E.offset)):(r.setEnd(E.node,E.offset),o.addRange(r)))}}for(r=[],o=d;o=o.parentNode;)o.nodeType===1&&r.push({element:o,left:o.scrollLeft,top:o.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<r.length;d++)o=r[d],o.element.scrollLeft=o.left,o.element.scrollTop=o.top}}var IE=c&&"documentMode"in document&&11>=document.documentMode,Jr=null,ff=null,Fa=null,hf=!1;function bm(o,r,d){var h=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;hf||Jr==null||Jr!==ni(h)||(h=Jr,"selectionStart"in h&&uf(h)?h={start:h.selectionStart,end:h.selectionEnd}:(h=(h.ownerDocument&&h.ownerDocument.defaultView||window).getSelection(),h={anchorNode:h.anchorNode,anchorOffset:h.anchorOffset,focusNode:h.focusNode,focusOffset:h.focusOffset}),Fa&&Ba(Fa,h)||(Fa=h,h=Tc(ff,"onSelect"),0<h.length&&(r=new nf("onSelect","select",null,r,d),o.push({event:r,listeners:h}),r.target=Jr)))}function vc(o,r){var d={};return d[o.toLowerCase()]=r.toLowerCase(),d["Webkit"+o]="webkit"+r,d["Moz"+o]="moz"+r,d}var es={animationend:vc("Animation","AnimationEnd"),animationiteration:vc("Animation","AnimationIteration"),animationstart:vc("Animation","AnimationStart"),transitionend:vc("Transition","TransitionEnd")},pf={},Bm={};c&&(Bm=document.createElement("div").style,"AnimationEvent"in window||(delete es.animationend.animation,delete es.animationiteration.animation,delete es.animationstart.animation),"TransitionEvent"in window||delete es.transitionend.transition);function Ac(o){if(pf[o])return pf[o];if(!es[o])return o;var r=es[o],d;for(d in r)if(r.hasOwnProperty(d)&&d in Bm)return pf[o]=r[d];return o}var Fm=Ac("animationend"),Lm=Ac("animationiteration"),Um=Ac("animationstart"),Hm=Ac("transitionend"),Gm=new Map,$m="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function go(o,r){Gm.set(o,r),a(r,[o])}for(var gf=0;gf<$m.length;gf++){var mf=$m[gf],TE=mf.toLowerCase(),EE=mf[0].toUpperCase()+mf.slice(1);go(TE,"on"+EE)}go(Fm,"onAnimationEnd"),go(Lm,"onAnimationIteration"),go(Um,"onAnimationStart"),go("dblclick","onDoubleClick"),go("focusin","onFocus"),go("focusout","onBlur"),go(Hm,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var La="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),CE=new Set("cancel close invalid load scroll toggle".split(" ").concat(La));function xm(o,r,d){var h=o.type||"unknown-event";o.currentTarget=d,TT(h,r,void 0,o),o.currentTarget=null}function Wm(o,r){r=(r&4)!==0;for(var d=0;d<o.length;d++){var h=o[d],g=h.event;h=h.listeners;e:{var y=void 0;if(r)for(var E=h.length-1;0<=E;E--){var D=h[E],k=D.instance,$=D.currentTarget;if(D=D.listener,k!==y&&g.isPropagationStopped())break e;xm(g,D,$),y=k}else for(E=0;E<h.length;E++){if(D=h[E],k=D.instance,$=D.currentTarget,D=D.listener,k!==y&&g.isPropagationStopped())break e;xm(g,D,$),y=k}}}if(oc)throw o=ju,oc=!1,ju=null,o}function lt(o,r){var d=r[Cf];d===void 0&&(d=r[Cf]=new Set);var h=o+"__bubble";d.has(h)||(Ym(r,o,2,!1),d.add(h))}function yf(o,r,d){var h=0;r&&(h|=4),Ym(d,o,h,r)}var Ic="_reactListening"+Math.random().toString(36).slice(2);function Ua(o){if(!o[Ic]){o[Ic]=!0,i.forEach(function(d){d!=="selectionchange"&&(CE.has(d)||yf(d,!1,o),yf(d,!0,o))});var r=o.nodeType===9?o:o.ownerDocument;r===null||r[Ic]||(r[Ic]=!0,yf("selectionchange",!1,r))}}function Ym(o,r,d,h){switch(hm(r)){case 1:var g=UT;break;case 4:g=HT;break;default:g=Ju}d=g.bind(null,r,d,o),g=void 0,!zu||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),h?g!==void 0?o.addEventListener(r,d,{capture:!0,passive:g}):o.addEventListener(r,d,!0):g!==void 0?o.addEventListener(r,d,{passive:g}):o.addEventListener(r,d,!1)}function Sf(o,r,d,h,g){var y=h;if((r&1)===0&&(r&2)===0&&h!==null)e:for(;;){if(h===null)return;var E=h.tag;if(E===3||E===4){var D=h.stateNode.containerInfo;if(D===g||D.nodeType===8&&D.parentNode===g)break;if(E===4)for(E=h.return;E!==null;){var k=E.tag;if((k===3||k===4)&&(k=E.stateNode.containerInfo,k===g||k.nodeType===8&&k.parentNode===g))return;E=E.return}for(;D!==null;){if(E=or(D),E===null)return;if(k=E.tag,k===5||k===6){h=y=E;continue e}D=D.parentNode}}h=h.return}Kg(function(){var $=y,q=xu(d),Q=[];e:{var X=Gm.get(o);if(X!==void 0){var he=nf,ve=o;switch(o){case"keypress":if(gc(d)===0)break e;case"keydown":case"keyup":he=eE;break;case"focusin":ve="focus",he=sf;break;case"focusout":ve="blur",he=sf;break;case"beforeblur":case"afterblur":he=sf;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=mm;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=xT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=iE;break;case Fm:case Lm:case Um:he=zT;break;case Hm:he=rE;break;case"scroll":he=GT;break;case"wheel":he=aE;break;case"copy":case"cut":case"paste":he=XT;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=Sm}var Te=(r&4)!==0,At=!Te&&o==="scroll",H=Te?X!==null?X+"Capture":null:X;Te=[];for(var L=$,G;L!==null;){G=L;var ee=G.stateNode;if(G.tag===5&&ee!==null&&(G=ee,H!==null&&(ee=Aa(L,H),ee!=null&&Te.push(Ha(L,ee,G)))),At)break;L=L.return}0<Te.length&&(X=new he(X,ve,null,d,q),Q.push({event:X,listeners:Te}))}}if((r&7)===0){e:{if(X=o==="mouseover"||o==="pointerover",he=o==="mouseout"||o==="pointerout",X&&d!==$u&&(ve=d.relatedTarget||d.fromElement)&&(or(ve)||ve[Fi]))break e;if((he||X)&&(X=q.window===q?q:(X=q.ownerDocument)?X.defaultView||X.parentWindow:window,he?(ve=d.relatedTarget||d.toElement,he=$,ve=ve?or(ve):null,ve!==null&&(At=ir(ve),ve!==At||ve.tag!==5&&ve.tag!==6)&&(ve=null)):(he=null,ve=$),he!==ve)){if(Te=mm,ee="onMouseLeave",H="onMouseEnter",L="mouse",(o==="pointerout"||o==="pointerover")&&(Te=Sm,ee="onPointerLeave",H="onPointerEnter",L="pointer"),At=he==null?X:is(he),G=ve==null?X:is(ve),X=new Te(ee,L+"leave",he,d,q),X.target=At,X.relatedTarget=G,ee=null,or(q)===$&&(Te=new Te(H,L+"enter",ve,d,q),Te.target=G,Te.relatedTarget=At,ee=Te),At=ee,he&&ve)t:{for(Te=he,H=ve,L=0,G=Te;G;G=ts(G))L++;for(G=0,ee=H;ee;ee=ts(ee))G++;for(;0<L-G;)Te=ts(Te),L--;for(;0<G-L;)H=ts(H),G--;for(;L--;){if(Te===H||H!==null&&Te===H.alternate)break t;Te=ts(Te),H=ts(H)}Te=null}else Te=null;he!==null&&zm(Q,X,he,Te,!1),ve!==null&&At!==null&&zm(Q,At,ve,Te,!0)}}e:{if(X=$?is($):window,he=X.nodeName&&X.nodeName.toLowerCase(),he==="select"||he==="input"&&X.type==="file")var we=pE;else if(Cm(X))if(wm)we=SE;else{we=mE;var ke=gE}else(he=X.nodeName)&&he.toLowerCase()==="input"&&(X.type==="checkbox"||X.type==="radio")&&(we=yE);if(we&&(we=we(o,$))){_m(Q,we,d,q);break e}ke&&ke(o,X,$),o==="focusout"&&(ke=X._wrapperState)&&ke.controlled&&X.type==="number"&&mi(X,"number",X.value)}switch(ke=$?is($):window,o){case"focusin":(Cm(ke)||ke.contentEditable==="true")&&(Jr=ke,ff=$,Fa=null);break;case"focusout":Fa=ff=Jr=null;break;case"mousedown":hf=!0;break;case"contextmenu":case"mouseup":case"dragend":hf=!1,bm(Q,d,q);break;case"selectionchange":if(IE)break;case"keydown":case"keyup":bm(Q,d,q)}var be;if(lf)e:{switch(o){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else Qr?Tm(o,d)&&(He="onCompositionEnd"):o==="keydown"&&d.keyCode===229&&(He="onCompositionStart");He&&(vm&&d.locale!=="ko"&&(Qr||He!=="onCompositionStart"?He==="onCompositionEnd"&&Qr&&(be=pm()):(po=q,tf="value"in po?po.value:po.textContent,Qr=!0)),ke=Tc($,He),0<ke.length&&(He=new ym(He,o,null,d,q),Q.push({event:He,listeners:ke}),be?He.data=be:(be=Em(d),be!==null&&(He.data=be)))),(be=cE?dE(o,d):uE(o,d))&&($=Tc($,"onBeforeInput"),0<$.length&&(q=new ym("onBeforeInput","beforeinput",null,d,q),Q.push({event:q,listeners:$}),q.data=be))}Wm(Q,r)})}function Ha(o,r,d){return{instance:o,listener:r,currentTarget:d}}function Tc(o,r){for(var d=r+"Capture",h=[];o!==null;){var g=o,y=g.stateNode;g.tag===5&&y!==null&&(g=y,y=Aa(o,d),y!=null&&h.unshift(Ha(o,y,g)),y=Aa(o,r),y!=null&&h.push(Ha(o,y,g))),o=o.return}return h}function ts(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5);return o||null}function zm(o,r,d,h,g){for(var y=r._reactName,E=[];d!==null&&d!==h;){var D=d,k=D.alternate,$=D.stateNode;if(k!==null&&k===h)break;D.tag===5&&$!==null&&(D=$,g?(k=Aa(d,y),k!=null&&E.unshift(Ha(d,k,D))):g||(k=Aa(d,y),k!=null&&E.push(Ha(d,k,D)))),d=d.return}E.length!==0&&o.push({event:r,listeners:E})}var _E=/\r\n?/g,wE=/\u0000|\uFFFD/g;function jm(o){return(typeof o=="string"?o:""+o).replace(_E,`
`).replace(wE,"")}function Ec(o,r,d){if(r=jm(r),jm(o)!==r&&d)throw Error(n(425))}function Cc(){}var vf=null,Af=null;function If(o,r){return o==="textarea"||o==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Tf=typeof setTimeout=="function"?setTimeout:void 0,RE=typeof clearTimeout=="function"?clearTimeout:void 0,Xm=typeof Promise=="function"?Promise:void 0,PE=typeof queueMicrotask=="function"?queueMicrotask:typeof Xm<"u"?function(o){return Xm.resolve(null).then(o).catch(DE)}:Tf;function DE(o){setTimeout(function(){throw o})}function Ef(o,r){var d=r,h=0;do{var g=d.nextSibling;if(o.removeChild(d),g&&g.nodeType===8)if(d=g.data,d==="/$"){if(h===0){o.removeChild(g),Da(r);return}h--}else d!=="$"&&d!=="$?"&&d!=="$!"||h++;d=g}while(d);Da(r)}function mo(o){for(;o!=null;o=o.nextSibling){var r=o.nodeType;if(r===1||r===3)break;if(r===8){if(r=o.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return o}function Vm(o){o=o.previousSibling;for(var r=0;o;){if(o.nodeType===8){var d=o.data;if(d==="$"||d==="$!"||d==="$?"){if(r===0)return o;r--}else d==="/$"&&r++}o=o.previousSibling}return null}var ns=Math.random().toString(36).slice(2),vi="__reactFiber$"+ns,Ga="__reactProps$"+ns,Fi="__reactContainer$"+ns,Cf="__reactEvents$"+ns,NE="__reactListeners$"+ns,ME="__reactHandles$"+ns;function or(o){var r=o[vi];if(r)return r;for(var d=o.parentNode;d;){if(r=d[Fi]||d[vi]){if(d=r.alternate,r.child!==null||d!==null&&d.child!==null)for(o=Vm(o);o!==null;){if(d=o[vi])return d;o=Vm(o)}return r}o=d,d=o.parentNode}return null}function $a(o){return o=o[vi]||o[Fi],!o||o.tag!==5&&o.tag!==6&&o.tag!==13&&o.tag!==3?null:o}function is(o){if(o.tag===5||o.tag===6)return o.stateNode;throw Error(n(33))}function _c(o){return o[Ga]||null}var _f=[],os=-1;function yo(o){return{current:o}}function ct(o){0>os||(o.current=_f[os],_f[os]=null,os--)}function st(o,r){os++,_f[os]=o.current,o.current=r}var So={},Zt=yo(So),In=yo(!1),rr=So;function rs(o,r){var d=o.type.contextTypes;if(!d)return So;var h=o.stateNode;if(h&&h.__reactInternalMemoizedUnmaskedChildContext===r)return h.__reactInternalMemoizedMaskedChildContext;var g={},y;for(y in d)g[y]=r[y];return h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=r,o.__reactInternalMemoizedMaskedChildContext=g),g}function Tn(o){return o=o.childContextTypes,o!=null}function wc(){ct(In),ct(Zt)}function Km(o,r,d){if(Zt.current!==So)throw Error(n(168));st(Zt,r),st(In,d)}function qm(o,r,d){var h=o.stateNode;if(r=r.childContextTypes,typeof h.getChildContext!="function")return d;h=h.getChildContext();for(var g in h)if(!(g in r))throw Error(n(108,Oe(o)||"Unknown",g));return K({},d,h)}function Rc(o){return o=(o=o.stateNode)&&o.__reactInternalMemoizedMergedChildContext||So,rr=Zt.current,st(Zt,o),st(In,In.current),!0}function Zm(o,r,d){var h=o.stateNode;if(!h)throw Error(n(169));d?(o=qm(o,r,rr),h.__reactInternalMemoizedMergedChildContext=o,ct(In),ct(Zt),st(Zt,o)):ct(In),st(In,d)}var Li=null,Pc=!1,wf=!1;function Qm(o){Li===null?Li=[o]:Li.push(o)}function OE(o){Pc=!0,Qm(o)}function vo(){if(!wf&&Li!==null){wf=!0;var o=0,r=tt;try{var d=Li;for(tt=1;o<d.length;o++){var h=d[o];do h=h(!0);while(h!==null)}Li=null,Pc=!1}catch(g){throw Li!==null&&(Li=Li.slice(o+1)),em(Xu,vo),g}finally{tt=r,wf=!1}}return null}var ss=[],as=0,Dc=null,Nc=0,Yn=[],zn=0,sr=null,Ui=1,Hi="";function ar(o,r){ss[as++]=Nc,ss[as++]=Dc,Dc=o,Nc=r}function Jm(o,r,d){Yn[zn++]=Ui,Yn[zn++]=Hi,Yn[zn++]=sr,sr=o;var h=Ui;o=Hi;var g=32-ii(h)-1;h&=~(1<<g),d+=1;var y=32-ii(r)+g;if(30<y){var E=g-g%5;y=(h&(1<<E)-1).toString(32),h>>=E,g-=E,Ui=1<<32-ii(r)+g|d<<g|h,Hi=y+o}else Ui=1<<y|d<<g|h,Hi=o}function Rf(o){o.return!==null&&(ar(o,1),Jm(o,1,0))}function Pf(o){for(;o===Dc;)Dc=ss[--as],ss[as]=null,Nc=ss[--as],ss[as]=null;for(;o===sr;)sr=Yn[--zn],Yn[zn]=null,Hi=Yn[--zn],Yn[zn]=null,Ui=Yn[--zn],Yn[zn]=null}var kn=null,bn=null,ut=!1,ri=null;function e0(o,r){var d=Kn(5,null,null,0);d.elementType="DELETED",d.stateNode=r,d.return=o,r=o.deletions,r===null?(o.deletions=[d],o.flags|=16):r.push(d)}function t0(o,r){switch(o.tag){case 5:var d=o.type;return r=r.nodeType!==1||d.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(o.stateNode=r,kn=o,bn=mo(r.firstChild),!0):!1;case 6:return r=o.pendingProps===""||r.nodeType!==3?null:r,r!==null?(o.stateNode=r,kn=o,bn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(d=sr!==null?{id:Ui,overflow:Hi}:null,o.memoizedState={dehydrated:r,treeContext:d,retryLane:1073741824},d=Kn(18,null,null,0),d.stateNode=r,d.return=o,o.child=d,kn=o,bn=null,!0):!1;default:return!1}}function Df(o){return(o.mode&1)!==0&&(o.flags&128)===0}function Nf(o){if(ut){var r=bn;if(r){var d=r;if(!t0(o,r)){if(Df(o))throw Error(n(418));r=mo(d.nextSibling);var h=kn;r&&t0(o,r)?e0(h,d):(o.flags=o.flags&-4097|2,ut=!1,kn=o)}}else{if(Df(o))throw Error(n(418));o.flags=o.flags&-4097|2,ut=!1,kn=o}}}function n0(o){for(o=o.return;o!==null&&o.tag!==5&&o.tag!==3&&o.tag!==13;)o=o.return;kn=o}function Mc(o){if(o!==kn)return!1;if(!ut)return n0(o),ut=!0,!1;var r;if((r=o.tag!==3)&&!(r=o.tag!==5)&&(r=o.type,r=r!=="head"&&r!=="body"&&!If(o.type,o.memoizedProps)),r&&(r=bn)){if(Df(o))throw i0(),Error(n(418));for(;r;)e0(o,r),r=mo(r.nextSibling)}if(n0(o),o.tag===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,r=0;o;){if(o.nodeType===8){var d=o.data;if(d==="/$"){if(r===0){bn=mo(o.nextSibling);break e}r--}else d!=="$"&&d!=="$!"&&d!=="$?"||r++}o=o.nextSibling}bn=null}}else bn=kn?mo(o.stateNode.nextSibling):null;return!0}function i0(){for(var o=bn;o;)o=mo(o.nextSibling)}function ls(){bn=kn=null,ut=!1}function Mf(o){ri===null?ri=[o]:ri.push(o)}var kE=B.ReactCurrentBatchConfig;function xa(o,r,d){if(o=d.ref,o!==null&&typeof o!="function"&&typeof o!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(n(309));var h=d.stateNode}if(!h)throw Error(n(147,o));var g=h,y=""+o;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===y?r.ref:(r=function(E){var D=g.refs;E===null?delete D[y]:D[y]=E},r._stringRef=y,r)}if(typeof o!="string")throw Error(n(284));if(!d._owner)throw Error(n(290,o))}return o}function Oc(o,r){throw o=Object.prototype.toString.call(r),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":o))}function o0(o){var r=o._init;return r(o._payload)}function r0(o){function r(H,L){if(o){var G=H.deletions;G===null?(H.deletions=[L],H.flags|=16):G.push(L)}}function d(H,L){if(!o)return null;for(;L!==null;)r(H,L),L=L.sibling;return null}function h(H,L){for(H=new Map;L!==null;)L.key!==null?H.set(L.key,L):H.set(L.index,L),L=L.sibling;return H}function g(H,L){return H=Ro(H,L),H.index=0,H.sibling=null,H}function y(H,L,G){return H.index=G,o?(G=H.alternate,G!==null?(G=G.index,G<L?(H.flags|=2,L):G):(H.flags|=2,L)):(H.flags|=1048576,L)}function E(H){return o&&H.alternate===null&&(H.flags|=2),H}function D(H,L,G,ee){return L===null||L.tag!==6?(L=Th(G,H.mode,ee),L.return=H,L):(L=g(L,G),L.return=H,L)}function k(H,L,G,ee){var we=G.type;return we===M?q(H,L,G.props.children,ee,G.key):L!==null&&(L.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===ue&&o0(we)===L.type)?(ee=g(L,G.props),ee.ref=xa(H,L,G),ee.return=H,ee):(ee=nd(G.type,G.key,G.props,null,H.mode,ee),ee.ref=xa(H,L,G),ee.return=H,ee)}function $(H,L,G,ee){return L===null||L.tag!==4||L.stateNode.containerInfo!==G.containerInfo||L.stateNode.implementation!==G.implementation?(L=Eh(G,H.mode,ee),L.return=H,L):(L=g(L,G.children||[]),L.return=H,L)}function q(H,L,G,ee,we){return L===null||L.tag!==7?(L=gr(G,H.mode,ee,we),L.return=H,L):(L=g(L,G),L.return=H,L)}function Q(H,L,G){if(typeof L=="string"&&L!==""||typeof L=="number")return L=Th(""+L,H.mode,G),L.return=H,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case O:return G=nd(L.type,L.key,L.props,null,H.mode,G),G.ref=xa(H,null,L),G.return=H,G;case N:return L=Eh(L,H.mode,G),L.return=H,L;case ue:var ee=L._init;return Q(H,ee(L._payload),G)}if(yi(L)||V(L))return L=gr(L,H.mode,G,null),L.return=H,L;Oc(H,L)}return null}function X(H,L,G,ee){var we=L!==null?L.key:null;if(typeof G=="string"&&G!==""||typeof G=="number")return we!==null?null:D(H,L,""+G,ee);if(typeof G=="object"&&G!==null){switch(G.$$typeof){case O:return G.key===we?k(H,L,G,ee):null;case N:return G.key===we?$(H,L,G,ee):null;case ue:return we=G._init,X(H,L,we(G._payload),ee)}if(yi(G)||V(G))return we!==null?null:q(H,L,G,ee,null);Oc(H,G)}return null}function he(H,L,G,ee,we){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return H=H.get(G)||null,D(L,H,""+ee,we);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case O:return H=H.get(ee.key===null?G:ee.key)||null,k(L,H,ee,we);case N:return H=H.get(ee.key===null?G:ee.key)||null,$(L,H,ee,we);case ue:var ke=ee._init;return he(H,L,G,ke(ee._payload),we)}if(yi(ee)||V(ee))return H=H.get(G)||null,q(L,H,ee,we,null);Oc(L,ee)}return null}function ve(H,L,G,ee){for(var we=null,ke=null,be=L,He=L=0,Bt=null;be!==null&&He<G.length;He++){be.index>He?(Bt=be,be=null):Bt=be.sibling;var Ze=X(H,be,G[He],ee);if(Ze===null){be===null&&(be=Bt);break}o&&be&&Ze.alternate===null&&r(H,be),L=y(Ze,L,He),ke===null?we=Ze:ke.sibling=Ze,ke=Ze,be=Bt}if(He===G.length)return d(H,be),ut&&ar(H,He),we;if(be===null){for(;He<G.length;He++)be=Q(H,G[He],ee),be!==null&&(L=y(be,L,He),ke===null?we=be:ke.sibling=be,ke=be);return ut&&ar(H,He),we}for(be=h(H,be);He<G.length;He++)Bt=he(be,H,He,G[He],ee),Bt!==null&&(o&&Bt.alternate!==null&&be.delete(Bt.key===null?He:Bt.key),L=y(Bt,L,He),ke===null?we=Bt:ke.sibling=Bt,ke=Bt);return o&&be.forEach(function(Po){return r(H,Po)}),ut&&ar(H,He),we}function Te(H,L,G,ee){var we=V(G);if(typeof we!="function")throw Error(n(150));if(G=we.call(G),G==null)throw Error(n(151));for(var ke=we=null,be=L,He=L=0,Bt=null,Ze=G.next();be!==null&&!Ze.done;He++,Ze=G.next()){be.index>He?(Bt=be,be=null):Bt=be.sibling;var Po=X(H,be,Ze.value,ee);if(Po===null){be===null&&(be=Bt);break}o&&be&&Po.alternate===null&&r(H,be),L=y(Po,L,He),ke===null?we=Po:ke.sibling=Po,ke=Po,be=Bt}if(Ze.done)return d(H,be),ut&&ar(H,He),we;if(be===null){for(;!Ze.done;He++,Ze=G.next())Ze=Q(H,Ze.value,ee),Ze!==null&&(L=y(Ze,L,He),ke===null?we=Ze:ke.sibling=Ze,ke=Ze);return ut&&ar(H,He),we}for(be=h(H,be);!Ze.done;He++,Ze=G.next())Ze=he(be,H,He,Ze.value,ee),Ze!==null&&(o&&Ze.alternate!==null&&be.delete(Ze.key===null?He:Ze.key),L=y(Ze,L,He),ke===null?we=Ze:ke.sibling=Ze,ke=Ze);return o&&be.forEach(function(fC){return r(H,fC)}),ut&&ar(H,He),we}function At(H,L,G,ee){if(typeof G=="object"&&G!==null&&G.type===M&&G.key===null&&(G=G.props.children),typeof G=="object"&&G!==null){switch(G.$$typeof){case O:e:{for(var we=G.key,ke=L;ke!==null;){if(ke.key===we){if(we=G.type,we===M){if(ke.tag===7){d(H,ke.sibling),L=g(ke,G.props.children),L.return=H,H=L;break e}}else if(ke.elementType===we||typeof we=="object"&&we!==null&&we.$$typeof===ue&&o0(we)===ke.type){d(H,ke.sibling),L=g(ke,G.props),L.ref=xa(H,ke,G),L.return=H,H=L;break e}d(H,ke);break}else r(H,ke);ke=ke.sibling}G.type===M?(L=gr(G.props.children,H.mode,ee,G.key),L.return=H,H=L):(ee=nd(G.type,G.key,G.props,null,H.mode,ee),ee.ref=xa(H,L,G),ee.return=H,H=ee)}return E(H);case N:e:{for(ke=G.key;L!==null;){if(L.key===ke)if(L.tag===4&&L.stateNode.containerInfo===G.containerInfo&&L.stateNode.implementation===G.implementation){d(H,L.sibling),L=g(L,G.children||[]),L.return=H,H=L;break e}else{d(H,L);break}else r(H,L);L=L.sibling}L=Eh(G,H.mode,ee),L.return=H,H=L}return E(H);case ue:return ke=G._init,At(H,L,ke(G._payload),ee)}if(yi(G))return ve(H,L,G,ee);if(V(G))return Te(H,L,G,ee);Oc(H,G)}return typeof G=="string"&&G!==""||typeof G=="number"?(G=""+G,L!==null&&L.tag===6?(d(H,L.sibling),L=g(L,G),L.return=H,H=L):(d(H,L),L=Th(G,H.mode,ee),L.return=H,H=L),E(H)):d(H,L)}return At}var cs=r0(!0),s0=r0(!1),kc=yo(null),bc=null,ds=null,Of=null;function kf(){Of=ds=bc=null}function bf(o){var r=kc.current;ct(kc),o._currentValue=r}function Bf(o,r,d){for(;o!==null;){var h=o.alternate;if((o.childLanes&r)!==r?(o.childLanes|=r,h!==null&&(h.childLanes|=r)):h!==null&&(h.childLanes&r)!==r&&(h.childLanes|=r),o===d)break;o=o.return}}function us(o,r){bc=o,Of=ds=null,o=o.dependencies,o!==null&&o.firstContext!==null&&((o.lanes&r)!==0&&(En=!0),o.firstContext=null)}function jn(o){var r=o._currentValue;if(Of!==o)if(o={context:o,memoizedValue:r,next:null},ds===null){if(bc===null)throw Error(n(308));ds=o,bc.dependencies={lanes:0,firstContext:o}}else ds=ds.next=o;return r}var lr=null;function Ff(o){lr===null?lr=[o]:lr.push(o)}function a0(o,r,d,h){var g=r.interleaved;return g===null?(d.next=d,Ff(r)):(d.next=g.next,g.next=d),r.interleaved=d,Gi(o,h)}function Gi(o,r){o.lanes|=r;var d=o.alternate;for(d!==null&&(d.lanes|=r),d=o,o=o.return;o!==null;)o.childLanes|=r,d=o.alternate,d!==null&&(d.childLanes|=r),d=o,o=o.return;return d.tag===3?d.stateNode:null}var Ao=!1;function Lf(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function l0(o,r){o=o.updateQueue,r.updateQueue===o&&(r.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,effects:o.effects})}function $i(o,r){return{eventTime:o,lane:r,tag:0,payload:null,callback:null,next:null}}function Io(o,r,d){var h=o.updateQueue;if(h===null)return null;if(h=h.shared,(Ve&2)!==0){var g=h.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),h.pending=r,Gi(o,d)}return g=h.interleaved,g===null?(r.next=r,Ff(h)):(r.next=g.next,g.next=r),h.interleaved=r,Gi(o,d)}function Bc(o,r,d){if(r=r.updateQueue,r!==null&&(r=r.shared,(d&4194240)!==0)){var h=r.lanes;h&=o.pendingLanes,d|=h,r.lanes=d,qu(o,d)}}function c0(o,r){var d=o.updateQueue,h=o.alternate;if(h!==null&&(h=h.updateQueue,d===h)){var g=null,y=null;if(d=d.firstBaseUpdate,d!==null){do{var E={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};y===null?g=y=E:y=y.next=E,d=d.next}while(d!==null);y===null?g=y=r:y=y.next=r}else g=y=r;d={baseState:h.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:h.shared,effects:h.effects},o.updateQueue=d;return}o=d.lastBaseUpdate,o===null?d.firstBaseUpdate=r:o.next=r,d.lastBaseUpdate=r}function Fc(o,r,d,h){var g=o.updateQueue;Ao=!1;var y=g.firstBaseUpdate,E=g.lastBaseUpdate,D=g.shared.pending;if(D!==null){g.shared.pending=null;var k=D,$=k.next;k.next=null,E===null?y=$:E.next=$,E=k;var q=o.alternate;q!==null&&(q=q.updateQueue,D=q.lastBaseUpdate,D!==E&&(D===null?q.firstBaseUpdate=$:D.next=$,q.lastBaseUpdate=k))}if(y!==null){var Q=g.baseState;E=0,q=$=k=null,D=y;do{var X=D.lane,he=D.eventTime;if((h&X)===X){q!==null&&(q=q.next={eventTime:he,lane:0,tag:D.tag,payload:D.payload,callback:D.callback,next:null});e:{var ve=o,Te=D;switch(X=r,he=d,Te.tag){case 1:if(ve=Te.payload,typeof ve=="function"){Q=ve.call(he,Q,X);break e}Q=ve;break e;case 3:ve.flags=ve.flags&-65537|128;case 0:if(ve=Te.payload,X=typeof ve=="function"?ve.call(he,Q,X):ve,X==null)break e;Q=K({},Q,X);break e;case 2:Ao=!0}}D.callback!==null&&D.lane!==0&&(o.flags|=64,X=g.effects,X===null?g.effects=[D]:X.push(D))}else he={eventTime:he,lane:X,tag:D.tag,payload:D.payload,callback:D.callback,next:null},q===null?($=q=he,k=Q):q=q.next=he,E|=X;if(D=D.next,D===null){if(D=g.shared.pending,D===null)break;X=D,D=X.next,X.next=null,g.lastBaseUpdate=X,g.shared.pending=null}}while(!0);if(q===null&&(k=Q),g.baseState=k,g.firstBaseUpdate=$,g.lastBaseUpdate=q,r=g.shared.interleaved,r!==null){g=r;do E|=g.lane,g=g.next;while(g!==r)}else y===null&&(g.shared.lanes=0);ur|=E,o.lanes=E,o.memoizedState=Q}}function d0(o,r,d){if(o=r.effects,r.effects=null,o!==null)for(r=0;r<o.length;r++){var h=o[r],g=h.callback;if(g!==null){if(h.callback=null,h=d,typeof g!="function")throw Error(n(191,g));g.call(h)}}}var Wa={},Ai=yo(Wa),Ya=yo(Wa),za=yo(Wa);function cr(o){if(o===Wa)throw Error(n(174));return o}function Uf(o,r){switch(st(za,r),st(Ya,o),st(Ai,Wa),o=r.nodeType,o){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Uu(null,"");break;default:o=o===8?r.parentNode:r,r=o.namespaceURI||null,o=o.tagName,r=Uu(r,o)}ct(Ai),st(Ai,r)}function fs(){ct(Ai),ct(Ya),ct(za)}function u0(o){cr(za.current);var r=cr(Ai.current),d=Uu(r,o.type);r!==d&&(st(Ya,o),st(Ai,d))}function Hf(o){Ya.current===o&&(ct(Ai),ct(Ya))}var ht=yo(0);function Lc(o){for(var r=o;r!==null;){if(r.tag===13){var d=r.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Gf=[];function $f(){for(var o=0;o<Gf.length;o++)Gf[o]._workInProgressVersionPrimary=null;Gf.length=0}var Uc=B.ReactCurrentDispatcher,xf=B.ReactCurrentBatchConfig,dr=0,pt=null,Dt=null,kt=null,Hc=!1,ja=!1,Xa=0,bE=0;function Qt(){throw Error(n(321))}function Wf(o,r){if(r===null)return!1;for(var d=0;d<r.length&&d<o.length;d++)if(!oi(o[d],r[d]))return!1;return!0}function Yf(o,r,d,h,g,y){if(dr=y,pt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,Uc.current=o===null||o.memoizedState===null?UE:HE,o=d(h,g),ja){y=0;do{if(ja=!1,Xa=0,25<=y)throw Error(n(301));y+=1,kt=Dt=null,r.updateQueue=null,Uc.current=GE,o=d(h,g)}while(ja)}if(Uc.current=xc,r=Dt!==null&&Dt.next!==null,dr=0,kt=Dt=pt=null,Hc=!1,r)throw Error(n(300));return o}function zf(){var o=Xa!==0;return Xa=0,o}function Ii(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kt===null?pt.memoizedState=kt=o:kt=kt.next=o,kt}function Xn(){if(Dt===null){var o=pt.alternate;o=o!==null?o.memoizedState:null}else o=Dt.next;var r=kt===null?pt.memoizedState:kt.next;if(r!==null)kt=r,Dt=o;else{if(o===null)throw Error(n(310));Dt=o,o={memoizedState:Dt.memoizedState,baseState:Dt.baseState,baseQueue:Dt.baseQueue,queue:Dt.queue,next:null},kt===null?pt.memoizedState=kt=o:kt=kt.next=o}return kt}function Va(o,r){return typeof r=="function"?r(o):r}function jf(o){var r=Xn(),d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var h=Dt,g=h.baseQueue,y=d.pending;if(y!==null){if(g!==null){var E=g.next;g.next=y.next,y.next=E}h.baseQueue=g=y,d.pending=null}if(g!==null){y=g.next,h=h.baseState;var D=E=null,k=null,$=y;do{var q=$.lane;if((dr&q)===q)k!==null&&(k=k.next={lane:0,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null}),h=$.hasEagerState?$.eagerState:o(h,$.action);else{var Q={lane:q,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null};k===null?(D=k=Q,E=h):k=k.next=Q,pt.lanes|=q,ur|=q}$=$.next}while($!==null&&$!==y);k===null?E=h:k.next=D,oi(h,r.memoizedState)||(En=!0),r.memoizedState=h,r.baseState=E,r.baseQueue=k,d.lastRenderedState=h}if(o=d.interleaved,o!==null){g=o;do y=g.lane,pt.lanes|=y,ur|=y,g=g.next;while(g!==o)}else g===null&&(d.lanes=0);return[r.memoizedState,d.dispatch]}function Xf(o){var r=Xn(),d=r.queue;if(d===null)throw Error(n(311));d.lastRenderedReducer=o;var h=d.dispatch,g=d.pending,y=r.memoizedState;if(g!==null){d.pending=null;var E=g=g.next;do y=o(y,E.action),E=E.next;while(E!==g);oi(y,r.memoizedState)||(En=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),d.lastRenderedState=y}return[y,h]}function f0(){}function h0(o,r){var d=pt,h=Xn(),g=r(),y=!oi(h.memoizedState,g);if(y&&(h.memoizedState=g,En=!0),h=h.queue,Vf(m0.bind(null,d,h,o),[o]),h.getSnapshot!==r||y||kt!==null&&kt.memoizedState.tag&1){if(d.flags|=2048,Ka(9,g0.bind(null,d,h,g,r),void 0,null),bt===null)throw Error(n(349));(dr&30)!==0||p0(d,r,g)}return g}function p0(o,r,d){o.flags|=16384,o={getSnapshot:r,value:d},r=pt.updateQueue,r===null?(r={lastEffect:null,stores:null},pt.updateQueue=r,r.stores=[o]):(d=r.stores,d===null?r.stores=[o]:d.push(o))}function g0(o,r,d,h){r.value=d,r.getSnapshot=h,y0(r)&&S0(o)}function m0(o,r,d){return d(function(){y0(r)&&S0(o)})}function y0(o){var r=o.getSnapshot;o=o.value;try{var d=r();return!oi(o,d)}catch{return!0}}function S0(o){var r=Gi(o,1);r!==null&&ci(r,o,1,-1)}function v0(o){var r=Ii();return typeof o=="function"&&(o=o()),r.memoizedState=r.baseState=o,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Va,lastRenderedState:o},r.queue=o,o=o.dispatch=LE.bind(null,pt,o),[r.memoizedState,o]}function Ka(o,r,d,h){return o={tag:o,create:r,destroy:d,deps:h,next:null},r=pt.updateQueue,r===null?(r={lastEffect:null,stores:null},pt.updateQueue=r,r.lastEffect=o.next=o):(d=r.lastEffect,d===null?r.lastEffect=o.next=o:(h=d.next,d.next=o,o.next=h,r.lastEffect=o)),o}function A0(){return Xn().memoizedState}function Gc(o,r,d,h){var g=Ii();pt.flags|=o,g.memoizedState=Ka(1|r,d,void 0,h===void 0?null:h)}function $c(o,r,d,h){var g=Xn();h=h===void 0?null:h;var y=void 0;if(Dt!==null){var E=Dt.memoizedState;if(y=E.destroy,h!==null&&Wf(h,E.deps)){g.memoizedState=Ka(r,d,y,h);return}}pt.flags|=o,g.memoizedState=Ka(1|r,d,y,h)}function I0(o,r){return Gc(8390656,8,o,r)}function Vf(o,r){return $c(2048,8,o,r)}function T0(o,r){return $c(4,2,o,r)}function E0(o,r){return $c(4,4,o,r)}function C0(o,r){if(typeof r=="function")return o=o(),r(o),function(){r(null)};if(r!=null)return o=o(),r.current=o,function(){r.current=null}}function _0(o,r,d){return d=d!=null?d.concat([o]):null,$c(4,4,C0.bind(null,r,o),d)}function Kf(){}function w0(o,r){var d=Xn();r=r===void 0?null:r;var h=d.memoizedState;return h!==null&&r!==null&&Wf(r,h[1])?h[0]:(d.memoizedState=[o,r],o)}function R0(o,r){var d=Xn();r=r===void 0?null:r;var h=d.memoizedState;return h!==null&&r!==null&&Wf(r,h[1])?h[0]:(o=o(),d.memoizedState=[o,r],o)}function P0(o,r,d){return(dr&21)===0?(o.baseState&&(o.baseState=!1,En=!0),o.memoizedState=d):(oi(d,r)||(d=om(),pt.lanes|=d,ur|=d,o.baseState=!0),r)}function BE(o,r){var d=tt;tt=d!==0&&4>d?d:4,o(!0);var h=xf.transition;xf.transition={};try{o(!1),r()}finally{tt=d,xf.transition=h}}function D0(){return Xn().memoizedState}function FE(o,r,d){var h=_o(o);if(d={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null},N0(o))M0(r,d);else if(d=a0(o,r,d,h),d!==null){var g=dn();ci(d,o,h,g),O0(d,r,h)}}function LE(o,r,d){var h=_o(o),g={lane:h,action:d,hasEagerState:!1,eagerState:null,next:null};if(N0(o))M0(r,g);else{var y=o.alternate;if(o.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var E=r.lastRenderedState,D=y(E,d);if(g.hasEagerState=!0,g.eagerState=D,oi(D,E)){var k=r.interleaved;k===null?(g.next=g,Ff(r)):(g.next=k.next,k.next=g),r.interleaved=g;return}}catch{}finally{}d=a0(o,r,g,h),d!==null&&(g=dn(),ci(d,o,h,g),O0(d,r,h))}}function N0(o){var r=o.alternate;return o===pt||r!==null&&r===pt}function M0(o,r){ja=Hc=!0;var d=o.pending;d===null?r.next=r:(r.next=d.next,d.next=r),o.pending=r}function O0(o,r,d){if((d&4194240)!==0){var h=r.lanes;h&=o.pendingLanes,d|=h,r.lanes=d,qu(o,d)}}var xc={readContext:jn,useCallback:Qt,useContext:Qt,useEffect:Qt,useImperativeHandle:Qt,useInsertionEffect:Qt,useLayoutEffect:Qt,useMemo:Qt,useReducer:Qt,useRef:Qt,useState:Qt,useDebugValue:Qt,useDeferredValue:Qt,useTransition:Qt,useMutableSource:Qt,useSyncExternalStore:Qt,useId:Qt,unstable_isNewReconciler:!1},UE={readContext:jn,useCallback:function(o,r){return Ii().memoizedState=[o,r===void 0?null:r],o},useContext:jn,useEffect:I0,useImperativeHandle:function(o,r,d){return d=d!=null?d.concat([o]):null,Gc(4194308,4,C0.bind(null,r,o),d)},useLayoutEffect:function(o,r){return Gc(4194308,4,o,r)},useInsertionEffect:function(o,r){return Gc(4,2,o,r)},useMemo:function(o,r){var d=Ii();return r=r===void 0?null:r,o=o(),d.memoizedState=[o,r],o},useReducer:function(o,r,d){var h=Ii();return r=d!==void 0?d(r):r,h.memoizedState=h.baseState=r,o={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:r},h.queue=o,o=o.dispatch=FE.bind(null,pt,o),[h.memoizedState,o]},useRef:function(o){var r=Ii();return o={current:o},r.memoizedState=o},useState:v0,useDebugValue:Kf,useDeferredValue:function(o){return Ii().memoizedState=o},useTransition:function(){var o=v0(!1),r=o[0];return o=BE.bind(null,o[1]),Ii().memoizedState=o,[r,o]},useMutableSource:function(){},useSyncExternalStore:function(o,r,d){var h=pt,g=Ii();if(ut){if(d===void 0)throw Error(n(407));d=d()}else{if(d=r(),bt===null)throw Error(n(349));(dr&30)!==0||p0(h,r,d)}g.memoizedState=d;var y={value:d,getSnapshot:r};return g.queue=y,I0(m0.bind(null,h,y,o),[o]),h.flags|=2048,Ka(9,g0.bind(null,h,y,d,r),void 0,null),d},useId:function(){var o=Ii(),r=bt.identifierPrefix;if(ut){var d=Hi,h=Ui;d=(h&~(1<<32-ii(h)-1)).toString(32)+d,r=":"+r+"R"+d,d=Xa++,0<d&&(r+="H"+d.toString(32)),r+=":"}else d=bE++,r=":"+r+"r"+d.toString(32)+":";return o.memoizedState=r},unstable_isNewReconciler:!1},HE={readContext:jn,useCallback:w0,useContext:jn,useEffect:Vf,useImperativeHandle:_0,useInsertionEffect:T0,useLayoutEffect:E0,useMemo:R0,useReducer:jf,useRef:A0,useState:function(){return jf(Va)},useDebugValue:Kf,useDeferredValue:function(o){var r=Xn();return P0(r,Dt.memoizedState,o)},useTransition:function(){var o=jf(Va)[0],r=Xn().memoizedState;return[o,r]},useMutableSource:f0,useSyncExternalStore:h0,useId:D0,unstable_isNewReconciler:!1},GE={readContext:jn,useCallback:w0,useContext:jn,useEffect:Vf,useImperativeHandle:_0,useInsertionEffect:T0,useLayoutEffect:E0,useMemo:R0,useReducer:Xf,useRef:A0,useState:function(){return Xf(Va)},useDebugValue:Kf,useDeferredValue:function(o){var r=Xn();return Dt===null?r.memoizedState=o:P0(r,Dt.memoizedState,o)},useTransition:function(){var o=Xf(Va)[0],r=Xn().memoizedState;return[o,r]},useMutableSource:f0,useSyncExternalStore:h0,useId:D0,unstable_isNewReconciler:!1};function si(o,r){if(o&&o.defaultProps){r=K({},r),o=o.defaultProps;for(var d in o)r[d]===void 0&&(r[d]=o[d]);return r}return r}function qf(o,r,d,h){r=o.memoizedState,d=d(h,r),d=d==null?r:K({},r,d),o.memoizedState=d,o.lanes===0&&(o.updateQueue.baseState=d)}var Wc={isMounted:function(o){return(o=o._reactInternals)?ir(o)===o:!1},enqueueSetState:function(o,r,d){o=o._reactInternals;var h=dn(),g=_o(o),y=$i(h,g);y.payload=r,d!=null&&(y.callback=d),r=Io(o,y,g),r!==null&&(ci(r,o,g,h),Bc(r,o,g))},enqueueReplaceState:function(o,r,d){o=o._reactInternals;var h=dn(),g=_o(o),y=$i(h,g);y.tag=1,y.payload=r,d!=null&&(y.callback=d),r=Io(o,y,g),r!==null&&(ci(r,o,g,h),Bc(r,o,g))},enqueueForceUpdate:function(o,r){o=o._reactInternals;var d=dn(),h=_o(o),g=$i(d,h);g.tag=2,r!=null&&(g.callback=r),r=Io(o,g,h),r!==null&&(ci(r,o,h,d),Bc(r,o,h))}};function k0(o,r,d,h,g,y,E){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(h,y,E):r.prototype&&r.prototype.isPureReactComponent?!Ba(d,h)||!Ba(g,y):!0}function b0(o,r,d){var h=!1,g=So,y=r.contextType;return typeof y=="object"&&y!==null?y=jn(y):(g=Tn(r)?rr:Zt.current,h=r.contextTypes,y=(h=h!=null)?rs(o,g):So),r=new r(d,y),o.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=Wc,o.stateNode=r,r._reactInternals=o,h&&(o=o.stateNode,o.__reactInternalMemoizedUnmaskedChildContext=g,o.__reactInternalMemoizedMaskedChildContext=y),r}function B0(o,r,d,h){o=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(d,h),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(d,h),r.state!==o&&Wc.enqueueReplaceState(r,r.state,null)}function Zf(o,r,d,h){var g=o.stateNode;g.props=d,g.state=o.memoizedState,g.refs={},Lf(o);var y=r.contextType;typeof y=="object"&&y!==null?g.context=jn(y):(y=Tn(r)?rr:Zt.current,g.context=rs(o,y)),g.state=o.memoizedState,y=r.getDerivedStateFromProps,typeof y=="function"&&(qf(o,r,y,d),g.state=o.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(r=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),r!==g.state&&Wc.enqueueReplaceState(g,g.state,null),Fc(o,d,g,h),g.state=o.memoizedState),typeof g.componentDidMount=="function"&&(o.flags|=4194308)}function hs(o,r){try{var d="",h=r;do d+=Pe(h),h=h.return;while(h);var g=d}catch(y){g=`
Error generating stack: `+y.message+`
`+y.stack}return{value:o,source:r,stack:g,digest:null}}function Qf(o,r,d){return{value:o,source:null,stack:d??null,digest:r??null}}function Jf(o,r){try{console.error(r.value)}catch(d){setTimeout(function(){throw d})}}var $E=typeof WeakMap=="function"?WeakMap:Map;function F0(o,r,d){d=$i(-1,d),d.tag=3,d.payload={element:null};var h=r.value;return d.callback=function(){qc||(qc=!0,ph=h),Jf(o,r)},d}function L0(o,r,d){d=$i(-1,d),d.tag=3;var h=o.type.getDerivedStateFromError;if(typeof h=="function"){var g=r.value;d.payload=function(){return h(g)},d.callback=function(){Jf(o,r)}}var y=o.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(d.callback=function(){Jf(o,r),typeof h!="function"&&(Eo===null?Eo=new Set([this]):Eo.add(this));var E=r.stack;this.componentDidCatch(r.value,{componentStack:E!==null?E:""})}),d}function U0(o,r,d){var h=o.pingCache;if(h===null){h=o.pingCache=new $E;var g=new Set;h.set(r,g)}else g=h.get(r),g===void 0&&(g=new Set,h.set(r,g));g.has(d)||(g.add(d),o=tC.bind(null,o,r,d),r.then(o,o))}function H0(o){do{var r;if((r=o.tag===13)&&(r=o.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return o;o=o.return}while(o!==null);return null}function G0(o,r,d,h,g){return(o.mode&1)===0?(o===r?o.flags|=65536:(o.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(r=$i(-1,1),r.tag=2,Io(d,r,1))),d.lanes|=1),o):(o.flags|=65536,o.lanes=g,o)}var xE=B.ReactCurrentOwner,En=!1;function cn(o,r,d,h){r.child=o===null?s0(r,null,d,h):cs(r,o.child,d,h)}function $0(o,r,d,h,g){d=d.render;var y=r.ref;return us(r,g),h=Yf(o,r,d,h,y,g),d=zf(),o!==null&&!En?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~g,xi(o,r,g)):(ut&&d&&Rf(r),r.flags|=1,cn(o,r,h,g),r.child)}function x0(o,r,d,h,g){if(o===null){var y=d.type;return typeof y=="function"&&!Ih(y)&&y.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(r.tag=15,r.type=y,W0(o,r,y,h,g)):(o=nd(d.type,null,h,r,r.mode,g),o.ref=r.ref,o.return=r,r.child=o)}if(y=o.child,(o.lanes&g)===0){var E=y.memoizedProps;if(d=d.compare,d=d!==null?d:Ba,d(E,h)&&o.ref===r.ref)return xi(o,r,g)}return r.flags|=1,o=Ro(y,h),o.ref=r.ref,o.return=r,r.child=o}function W0(o,r,d,h,g){if(o!==null){var y=o.memoizedProps;if(Ba(y,h)&&o.ref===r.ref)if(En=!1,r.pendingProps=h=y,(o.lanes&g)!==0)(o.flags&131072)!==0&&(En=!0);else return r.lanes=o.lanes,xi(o,r,g)}return eh(o,r,d,h,g)}function Y0(o,r,d){var h=r.pendingProps,g=h.children,y=o!==null?o.memoizedState:null;if(h.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},st(gs,Bn),Bn|=d;else{if((d&1073741824)===0)return o=y!==null?y.baseLanes|d:d,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:o,cachePool:null,transitions:null},r.updateQueue=null,st(gs,Bn),Bn|=o,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},h=y!==null?y.baseLanes:d,st(gs,Bn),Bn|=h}else y!==null?(h=y.baseLanes|d,r.memoizedState=null):h=d,st(gs,Bn),Bn|=h;return cn(o,r,g,d),r.child}function z0(o,r){var d=r.ref;(o===null&&d!==null||o!==null&&o.ref!==d)&&(r.flags|=512,r.flags|=2097152)}function eh(o,r,d,h,g){var y=Tn(d)?rr:Zt.current;return y=rs(r,y),us(r,g),d=Yf(o,r,d,h,y,g),h=zf(),o!==null&&!En?(r.updateQueue=o.updateQueue,r.flags&=-2053,o.lanes&=~g,xi(o,r,g)):(ut&&h&&Rf(r),r.flags|=1,cn(o,r,d,g),r.child)}function j0(o,r,d,h,g){if(Tn(d)){var y=!0;Rc(r)}else y=!1;if(us(r,g),r.stateNode===null)zc(o,r),b0(r,d,h),Zf(r,d,h,g),h=!0;else if(o===null){var E=r.stateNode,D=r.memoizedProps;E.props=D;var k=E.context,$=d.contextType;typeof $=="object"&&$!==null?$=jn($):($=Tn(d)?rr:Zt.current,$=rs(r,$));var q=d.getDerivedStateFromProps,Q=typeof q=="function"||typeof E.getSnapshotBeforeUpdate=="function";Q||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(D!==h||k!==$)&&B0(r,E,h,$),Ao=!1;var X=r.memoizedState;E.state=X,Fc(r,h,E,g),k=r.memoizedState,D!==h||X!==k||In.current||Ao?(typeof q=="function"&&(qf(r,d,q,h),k=r.memoizedState),(D=Ao||k0(r,d,D,h,X,k,$))?(Q||typeof E.UNSAFE_componentWillMount!="function"&&typeof E.componentWillMount!="function"||(typeof E.componentWillMount=="function"&&E.componentWillMount(),typeof E.UNSAFE_componentWillMount=="function"&&E.UNSAFE_componentWillMount()),typeof E.componentDidMount=="function"&&(r.flags|=4194308)):(typeof E.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=h,r.memoizedState=k),E.props=h,E.state=k,E.context=$,h=D):(typeof E.componentDidMount=="function"&&(r.flags|=4194308),h=!1)}else{E=r.stateNode,l0(o,r),D=r.memoizedProps,$=r.type===r.elementType?D:si(r.type,D),E.props=$,Q=r.pendingProps,X=E.context,k=d.contextType,typeof k=="object"&&k!==null?k=jn(k):(k=Tn(d)?rr:Zt.current,k=rs(r,k));var he=d.getDerivedStateFromProps;(q=typeof he=="function"||typeof E.getSnapshotBeforeUpdate=="function")||typeof E.UNSAFE_componentWillReceiveProps!="function"&&typeof E.componentWillReceiveProps!="function"||(D!==Q||X!==k)&&B0(r,E,h,k),Ao=!1,X=r.memoizedState,E.state=X,Fc(r,h,E,g);var ve=r.memoizedState;D!==Q||X!==ve||In.current||Ao?(typeof he=="function"&&(qf(r,d,he,h),ve=r.memoizedState),($=Ao||k0(r,d,$,h,X,ve,k)||!1)?(q||typeof E.UNSAFE_componentWillUpdate!="function"&&typeof E.componentWillUpdate!="function"||(typeof E.componentWillUpdate=="function"&&E.componentWillUpdate(h,ve,k),typeof E.UNSAFE_componentWillUpdate=="function"&&E.UNSAFE_componentWillUpdate(h,ve,k)),typeof E.componentDidUpdate=="function"&&(r.flags|=4),typeof E.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof E.componentDidUpdate!="function"||D===o.memoizedProps&&X===o.memoizedState||(r.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||D===o.memoizedProps&&X===o.memoizedState||(r.flags|=1024),r.memoizedProps=h,r.memoizedState=ve),E.props=h,E.state=ve,E.context=k,h=$):(typeof E.componentDidUpdate!="function"||D===o.memoizedProps&&X===o.memoizedState||(r.flags|=4),typeof E.getSnapshotBeforeUpdate!="function"||D===o.memoizedProps&&X===o.memoizedState||(r.flags|=1024),h=!1)}return th(o,r,d,h,y,g)}function th(o,r,d,h,g,y){z0(o,r);var E=(r.flags&128)!==0;if(!h&&!E)return g&&Zm(r,d,!1),xi(o,r,y);h=r.stateNode,xE.current=r;var D=E&&typeof d.getDerivedStateFromError!="function"?null:h.render();return r.flags|=1,o!==null&&E?(r.child=cs(r,o.child,null,y),r.child=cs(r,null,D,y)):cn(o,r,D,y),r.memoizedState=h.state,g&&Zm(r,d,!0),r.child}function X0(o){var r=o.stateNode;r.pendingContext?Km(o,r.pendingContext,r.pendingContext!==r.context):r.context&&Km(o,r.context,!1),Uf(o,r.containerInfo)}function V0(o,r,d,h,g){return ls(),Mf(g),r.flags|=256,cn(o,r,d,h),r.child}var nh={dehydrated:null,treeContext:null,retryLane:0};function ih(o){return{baseLanes:o,cachePool:null,transitions:null}}function K0(o,r,d){var h=r.pendingProps,g=ht.current,y=!1,E=(r.flags&128)!==0,D;if((D=E)||(D=o!==null&&o.memoizedState===null?!1:(g&2)!==0),D?(y=!0,r.flags&=-129):(o===null||o.memoizedState!==null)&&(g|=1),st(ht,g&1),o===null)return Nf(r),o=r.memoizedState,o!==null&&(o=o.dehydrated,o!==null)?((r.mode&1)===0?r.lanes=1:o.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(E=h.children,o=h.fallback,y?(h=r.mode,y=r.child,E={mode:"hidden",children:E},(h&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=E):y=id(E,h,0,null),o=gr(o,h,d,null),y.return=r,o.return=r,y.sibling=o,r.child=y,r.child.memoizedState=ih(d),r.memoizedState=nh,o):oh(r,E));if(g=o.memoizedState,g!==null&&(D=g.dehydrated,D!==null))return WE(o,r,E,h,D,g,d);if(y){y=h.fallback,E=r.mode,g=o.child,D=g.sibling;var k={mode:"hidden",children:h.children};return(E&1)===0&&r.child!==g?(h=r.child,h.childLanes=0,h.pendingProps=k,r.deletions=null):(h=Ro(g,k),h.subtreeFlags=g.subtreeFlags&14680064),D!==null?y=Ro(D,y):(y=gr(y,E,d,null),y.flags|=2),y.return=r,h.return=r,h.sibling=y,r.child=h,h=y,y=r.child,E=o.child.memoizedState,E=E===null?ih(d):{baseLanes:E.baseLanes|d,cachePool:null,transitions:E.transitions},y.memoizedState=E,y.childLanes=o.childLanes&~d,r.memoizedState=nh,h}return y=o.child,o=y.sibling,h=Ro(y,{mode:"visible",children:h.children}),(r.mode&1)===0&&(h.lanes=d),h.return=r,h.sibling=null,o!==null&&(d=r.deletions,d===null?(r.deletions=[o],r.flags|=16):d.push(o)),r.child=h,r.memoizedState=null,h}function oh(o,r){return r=id({mode:"visible",children:r},o.mode,0,null),r.return=o,o.child=r}function Yc(o,r,d,h){return h!==null&&Mf(h),cs(r,o.child,null,d),o=oh(r,r.pendingProps.children),o.flags|=2,r.memoizedState=null,o}function WE(o,r,d,h,g,y,E){if(d)return r.flags&256?(r.flags&=-257,h=Qf(Error(n(422))),Yc(o,r,E,h)):r.memoizedState!==null?(r.child=o.child,r.flags|=128,null):(y=h.fallback,g=r.mode,h=id({mode:"visible",children:h.children},g,0,null),y=gr(y,g,E,null),y.flags|=2,h.return=r,y.return=r,h.sibling=y,r.child=h,(r.mode&1)!==0&&cs(r,o.child,null,E),r.child.memoizedState=ih(E),r.memoizedState=nh,y);if((r.mode&1)===0)return Yc(o,r,E,null);if(g.data==="$!"){if(h=g.nextSibling&&g.nextSibling.dataset,h)var D=h.dgst;return h=D,y=Error(n(419)),h=Qf(y,h,void 0),Yc(o,r,E,h)}if(D=(E&o.childLanes)!==0,En||D){if(h=bt,h!==null){switch(E&-E){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=(g&(h.suspendedLanes|E))!==0?0:g,g!==0&&g!==y.retryLane&&(y.retryLane=g,Gi(o,g),ci(h,o,g,-1))}return Ah(),h=Qf(Error(n(421))),Yc(o,r,E,h)}return g.data==="$?"?(r.flags|=128,r.child=o.child,r=nC.bind(null,o),g._reactRetry=r,null):(o=y.treeContext,bn=mo(g.nextSibling),kn=r,ut=!0,ri=null,o!==null&&(Yn[zn++]=Ui,Yn[zn++]=Hi,Yn[zn++]=sr,Ui=o.id,Hi=o.overflow,sr=r),r=oh(r,h.children),r.flags|=4096,r)}function q0(o,r,d){o.lanes|=r;var h=o.alternate;h!==null&&(h.lanes|=r),Bf(o.return,r,d)}function rh(o,r,d,h,g){var y=o.memoizedState;y===null?o.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:h,tail:d,tailMode:g}:(y.isBackwards=r,y.rendering=null,y.renderingStartTime=0,y.last=h,y.tail=d,y.tailMode=g)}function Z0(o,r,d){var h=r.pendingProps,g=h.revealOrder,y=h.tail;if(cn(o,r,h.children,d),h=ht.current,(h&2)!==0)h=h&1|2,r.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=r.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&q0(o,d,r);else if(o.tag===19)q0(o,d,r);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===r)break e;for(;o.sibling===null;){if(o.return===null||o.return===r)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}h&=1}if(st(ht,h),(r.mode&1)===0)r.memoizedState=null;else switch(g){case"forwards":for(d=r.child,g=null;d!==null;)o=d.alternate,o!==null&&Lc(o)===null&&(g=d),d=d.sibling;d=g,d===null?(g=r.child,r.child=null):(g=d.sibling,d.sibling=null),rh(r,!1,g,d,y);break;case"backwards":for(d=null,g=r.child,r.child=null;g!==null;){if(o=g.alternate,o!==null&&Lc(o)===null){r.child=g;break}o=g.sibling,g.sibling=d,d=g,g=o}rh(r,!0,d,null,y);break;case"together":rh(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function zc(o,r){(r.mode&1)===0&&o!==null&&(o.alternate=null,r.alternate=null,r.flags|=2)}function xi(o,r,d){if(o!==null&&(r.dependencies=o.dependencies),ur|=r.lanes,(d&r.childLanes)===0)return null;if(o!==null&&r.child!==o.child)throw Error(n(153));if(r.child!==null){for(o=r.child,d=Ro(o,o.pendingProps),r.child=d,d.return=r;o.sibling!==null;)o=o.sibling,d=d.sibling=Ro(o,o.pendingProps),d.return=r;d.sibling=null}return r.child}function YE(o,r,d){switch(r.tag){case 3:X0(r),ls();break;case 5:u0(r);break;case 1:Tn(r.type)&&Rc(r);break;case 4:Uf(r,r.stateNode.containerInfo);break;case 10:var h=r.type._context,g=r.memoizedProps.value;st(kc,h._currentValue),h._currentValue=g;break;case 13:if(h=r.memoizedState,h!==null)return h.dehydrated!==null?(st(ht,ht.current&1),r.flags|=128,null):(d&r.child.childLanes)!==0?K0(o,r,d):(st(ht,ht.current&1),o=xi(o,r,d),o!==null?o.sibling:null);st(ht,ht.current&1);break;case 19:if(h=(d&r.childLanes)!==0,(o.flags&128)!==0){if(h)return Z0(o,r,d);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),st(ht,ht.current),h)break;return null;case 22:case 23:return r.lanes=0,Y0(o,r,d)}return xi(o,r,d)}var Q0,sh,J0,ey;Q0=function(o,r){for(var d=r.child;d!==null;){if(d.tag===5||d.tag===6)o.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===r)break;for(;d.sibling===null;){if(d.return===null||d.return===r)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},sh=function(){},J0=function(o,r,d,h){var g=o.memoizedProps;if(g!==h){o=r.stateNode,cr(Ai.current);var y=null;switch(d){case"input":g=nt(o,g),h=nt(o,h),y=[];break;case"select":g=K({},g,{value:void 0}),h=K({},h,{value:void 0}),y=[];break;case"textarea":g=nr(o,g),h=nr(o,h),y=[];break;default:typeof g.onClick!="function"&&typeof h.onClick=="function"&&(o.onclick=Cc)}Hu(d,h);var E;d=null;for($ in g)if(!h.hasOwnProperty($)&&g.hasOwnProperty($)&&g[$]!=null)if($==="style"){var D=g[$];for(E in D)D.hasOwnProperty(E)&&(d||(d={}),d[E]="")}else $!=="dangerouslySetInnerHTML"&&$!=="children"&&$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(s.hasOwnProperty($)?y||(y=[]):(y=y||[]).push($,null));for($ in h){var k=h[$];if(D=g!=null?g[$]:void 0,h.hasOwnProperty($)&&k!==D&&(k!=null||D!=null))if($==="style")if(D){for(E in D)!D.hasOwnProperty(E)||k&&k.hasOwnProperty(E)||(d||(d={}),d[E]="");for(E in k)k.hasOwnProperty(E)&&D[E]!==k[E]&&(d||(d={}),d[E]=k[E])}else d||(y||(y=[]),y.push($,d)),d=k;else $==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,D=D?D.__html:void 0,k!=null&&D!==k&&(y=y||[]).push($,k)):$==="children"?typeof k!="string"&&typeof k!="number"||(y=y||[]).push($,""+k):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&(s.hasOwnProperty($)?(k!=null&&$==="onScroll"&&lt("scroll",o),y||D===k||(y=[])):(y=y||[]).push($,k))}d&&(y=y||[]).push("style",d);var $=y;(r.updateQueue=$)&&(r.flags|=4)}},ey=function(o,r,d,h){d!==h&&(r.flags|=4)};function qa(o,r){if(!ut)switch(o.tailMode){case"hidden":r=o.tail;for(var d=null;r!==null;)r.alternate!==null&&(d=r),r=r.sibling;d===null?o.tail=null:d.sibling=null;break;case"collapsed":d=o.tail;for(var h=null;d!==null;)d.alternate!==null&&(h=d),d=d.sibling;h===null?r||o.tail===null?o.tail=null:o.tail.sibling=null:h.sibling=null}}function Jt(o){var r=o.alternate!==null&&o.alternate.child===o.child,d=0,h=0;if(r)for(var g=o.child;g!==null;)d|=g.lanes|g.childLanes,h|=g.subtreeFlags&14680064,h|=g.flags&14680064,g.return=o,g=g.sibling;else for(g=o.child;g!==null;)d|=g.lanes|g.childLanes,h|=g.subtreeFlags,h|=g.flags,g.return=o,g=g.sibling;return o.subtreeFlags|=h,o.childLanes=d,r}function zE(o,r,d){var h=r.pendingProps;switch(Pf(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(r),null;case 1:return Tn(r.type)&&wc(),Jt(r),null;case 3:return h=r.stateNode,fs(),ct(In),ct(Zt),$f(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(o===null||o.child===null)&&(Mc(r)?r.flags|=4:o===null||o.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,ri!==null&&(yh(ri),ri=null))),sh(o,r),Jt(r),null;case 5:Hf(r);var g=cr(za.current);if(d=r.type,o!==null&&r.stateNode!=null)J0(o,r,d,h,g),o.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!h){if(r.stateNode===null)throw Error(n(166));return Jt(r),null}if(o=cr(Ai.current),Mc(r)){h=r.stateNode,d=r.type;var y=r.memoizedProps;switch(h[vi]=r,h[Ga]=y,o=(r.mode&1)!==0,d){case"dialog":lt("cancel",h),lt("close",h);break;case"iframe":case"object":case"embed":lt("load",h);break;case"video":case"audio":for(g=0;g<La.length;g++)lt(La[g],h);break;case"source":lt("error",h);break;case"img":case"image":case"link":lt("error",h),lt("load",h);break;case"details":lt("toggle",h);break;case"input":at(h,y),lt("invalid",h);break;case"select":h._wrapperState={wasMultiple:!!y.multiple},lt("invalid",h);break;case"textarea":Lg(h,y),lt("invalid",h)}Hu(d,y),g=null;for(var E in y)if(y.hasOwnProperty(E)){var D=y[E];E==="children"?typeof D=="string"?h.textContent!==D&&(y.suppressHydrationWarning!==!0&&Ec(h.textContent,D,o),g=["children",D]):typeof D=="number"&&h.textContent!==""+D&&(y.suppressHydrationWarning!==!0&&Ec(h.textContent,D,o),g=["children",""+D]):s.hasOwnProperty(E)&&D!=null&&E==="onScroll"&&lt("scroll",h)}switch(d){case"input":$e(h),Wn(h,y,!0);break;case"textarea":$e(h),Hg(h);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(h.onclick=Cc)}h=g,r.updateQueue=h,h!==null&&(r.flags|=4)}else{E=g.nodeType===9?g:g.ownerDocument,o==="http://www.w3.org/1999/xhtml"&&(o=Gg(d)),o==="http://www.w3.org/1999/xhtml"?d==="script"?(o=E.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild)):typeof h.is=="string"?o=E.createElement(d,{is:h.is}):(o=E.createElement(d),d==="select"&&(E=o,h.multiple?E.multiple=!0:h.size&&(E.size=h.size))):o=E.createElementNS(o,d),o[vi]=r,o[Ga]=h,Q0(o,r,!1,!1),r.stateNode=o;e:{switch(E=Gu(d,h),d){case"dialog":lt("cancel",o),lt("close",o),g=h;break;case"iframe":case"object":case"embed":lt("load",o),g=h;break;case"video":case"audio":for(g=0;g<La.length;g++)lt(La[g],o);g=h;break;case"source":lt("error",o),g=h;break;case"img":case"image":case"link":lt("error",o),lt("load",o),g=h;break;case"details":lt("toggle",o),g=h;break;case"input":at(o,h),g=nt(o,h),lt("invalid",o);break;case"option":g=h;break;case"select":o._wrapperState={wasMultiple:!!h.multiple},g=K({},h,{value:void 0}),lt("invalid",o);break;case"textarea":Lg(o,h),g=nr(o,h),lt("invalid",o);break;default:g=h}Hu(d,g),D=g;for(y in D)if(D.hasOwnProperty(y)){var k=D[y];y==="style"?Wg(o,k):y==="dangerouslySetInnerHTML"?(k=k?k.__html:void 0,k!=null&&$g(o,k)):y==="children"?typeof k=="string"?(d!=="textarea"||k!=="")&&Sa(o,k):typeof k=="number"&&Sa(o,""+k):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?k!=null&&y==="onScroll"&&lt("scroll",o):k!=null&&w(o,y,k,E))}switch(d){case"input":$e(o),Wn(o,h,!1);break;case"textarea":$e(o),Hg(o);break;case"option":h.value!=null&&o.setAttribute("value",""+Ne(h.value));break;case"select":o.multiple=!!h.multiple,y=h.value,y!=null?lo(o,!!h.multiple,y,!1):h.defaultValue!=null&&lo(o,!!h.multiple,h.defaultValue,!0);break;default:typeof g.onClick=="function"&&(o.onclick=Cc)}switch(d){case"button":case"input":case"select":case"textarea":h=!!h.autoFocus;break e;case"img":h=!0;break e;default:h=!1}}h&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Jt(r),null;case 6:if(o&&r.stateNode!=null)ey(o,r,o.memoizedProps,h);else{if(typeof h!="string"&&r.stateNode===null)throw Error(n(166));if(d=cr(za.current),cr(Ai.current),Mc(r)){if(h=r.stateNode,d=r.memoizedProps,h[vi]=r,(y=h.nodeValue!==d)&&(o=kn,o!==null))switch(o.tag){case 3:Ec(h.nodeValue,d,(o.mode&1)!==0);break;case 5:o.memoizedProps.suppressHydrationWarning!==!0&&Ec(h.nodeValue,d,(o.mode&1)!==0)}y&&(r.flags|=4)}else h=(d.nodeType===9?d:d.ownerDocument).createTextNode(h),h[vi]=r,r.stateNode=h}return Jt(r),null;case 13:if(ct(ht),h=r.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(ut&&bn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)i0(),ls(),r.flags|=98560,y=!1;else if(y=Mc(r),h!==null&&h.dehydrated!==null){if(o===null){if(!y)throw Error(n(318));if(y=r.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[vi]=r}else ls(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Jt(r),y=!1}else ri!==null&&(yh(ri),ri=null),y=!0;if(!y)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=d,r):(h=h!==null,h!==(o!==null&&o.memoizedState!==null)&&h&&(r.child.flags|=8192,(r.mode&1)!==0&&(o===null||(ht.current&1)!==0?Nt===0&&(Nt=3):Ah())),r.updateQueue!==null&&(r.flags|=4),Jt(r),null);case 4:return fs(),sh(o,r),o===null&&Ua(r.stateNode.containerInfo),Jt(r),null;case 10:return bf(r.type._context),Jt(r),null;case 17:return Tn(r.type)&&wc(),Jt(r),null;case 19:if(ct(ht),y=r.memoizedState,y===null)return Jt(r),null;if(h=(r.flags&128)!==0,E=y.rendering,E===null)if(h)qa(y,!1);else{if(Nt!==0||o!==null&&(o.flags&128)!==0)for(o=r.child;o!==null;){if(E=Lc(o),E!==null){for(r.flags|=128,qa(y,!1),h=E.updateQueue,h!==null&&(r.updateQueue=h,r.flags|=4),r.subtreeFlags=0,h=d,d=r.child;d!==null;)y=d,o=h,y.flags&=14680066,E=y.alternate,E===null?(y.childLanes=0,y.lanes=o,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=E.childLanes,y.lanes=E.lanes,y.child=E.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=E.memoizedProps,y.memoizedState=E.memoizedState,y.updateQueue=E.updateQueue,y.type=E.type,o=E.dependencies,y.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext}),d=d.sibling;return st(ht,ht.current&1|2),r.child}o=o.sibling}y.tail!==null&&vt()>ms&&(r.flags|=128,h=!0,qa(y,!1),r.lanes=4194304)}else{if(!h)if(o=Lc(E),o!==null){if(r.flags|=128,h=!0,d=o.updateQueue,d!==null&&(r.updateQueue=d,r.flags|=4),qa(y,!0),y.tail===null&&y.tailMode==="hidden"&&!E.alternate&&!ut)return Jt(r),null}else 2*vt()-y.renderingStartTime>ms&&d!==1073741824&&(r.flags|=128,h=!0,qa(y,!1),r.lanes=4194304);y.isBackwards?(E.sibling=r.child,r.child=E):(d=y.last,d!==null?d.sibling=E:r.child=E,y.last=E)}return y.tail!==null?(r=y.tail,y.rendering=r,y.tail=r.sibling,y.renderingStartTime=vt(),r.sibling=null,d=ht.current,st(ht,h?d&1|2:d&1),r):(Jt(r),null);case 22:case 23:return vh(),h=r.memoizedState!==null,o!==null&&o.memoizedState!==null!==h&&(r.flags|=8192),h&&(r.mode&1)!==0?(Bn&1073741824)!==0&&(Jt(r),r.subtreeFlags&6&&(r.flags|=8192)):Jt(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function jE(o,r){switch(Pf(r),r.tag){case 1:return Tn(r.type)&&wc(),o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 3:return fs(),ct(In),ct(Zt),$f(),o=r.flags,(o&65536)!==0&&(o&128)===0?(r.flags=o&-65537|128,r):null;case 5:return Hf(r),null;case 13:if(ct(ht),o=r.memoizedState,o!==null&&o.dehydrated!==null){if(r.alternate===null)throw Error(n(340));ls()}return o=r.flags,o&65536?(r.flags=o&-65537|128,r):null;case 19:return ct(ht),null;case 4:return fs(),null;case 10:return bf(r.type._context),null;case 22:case 23:return vh(),null;case 24:return null;default:return null}}var jc=!1,en=!1,XE=typeof WeakSet=="function"?WeakSet:Set,ye=null;function ps(o,r){var d=o.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(h){yt(o,r,h)}else d.current=null}function ah(o,r,d){try{d()}catch(h){yt(o,r,h)}}var ty=!1;function VE(o,r){if(vf=fc,o=km(),uf(o)){if("selectionStart"in o)var d={start:o.selectionStart,end:o.selectionEnd};else e:{d=(d=o.ownerDocument)&&d.defaultView||window;var h=d.getSelection&&d.getSelection();if(h&&h.rangeCount!==0){d=h.anchorNode;var g=h.anchorOffset,y=h.focusNode;h=h.focusOffset;try{d.nodeType,y.nodeType}catch{d=null;break e}var E=0,D=-1,k=-1,$=0,q=0,Q=o,X=null;t:for(;;){for(var he;Q!==d||g!==0&&Q.nodeType!==3||(D=E+g),Q!==y||h!==0&&Q.nodeType!==3||(k=E+h),Q.nodeType===3&&(E+=Q.nodeValue.length),(he=Q.firstChild)!==null;)X=Q,Q=he;for(;;){if(Q===o)break t;if(X===d&&++$===g&&(D=E),X===y&&++q===h&&(k=E),(he=Q.nextSibling)!==null)break;Q=X,X=Q.parentNode}Q=he}d=D===-1||k===-1?null:{start:D,end:k}}else d=null}d=d||{start:0,end:0}}else d=null;for(Af={focusedElem:o,selectionRange:d},fc=!1,ye=r;ye!==null;)if(r=ye,o=r.child,(r.subtreeFlags&1028)!==0&&o!==null)o.return=r,ye=o;else for(;ye!==null;){r=ye;try{var ve=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(ve!==null){var Te=ve.memoizedProps,At=ve.memoizedState,H=r.stateNode,L=H.getSnapshotBeforeUpdate(r.elementType===r.type?Te:si(r.type,Te),At);H.__reactInternalSnapshotBeforeUpdate=L}break;case 3:var G=r.stateNode.containerInfo;G.nodeType===1?G.textContent="":G.nodeType===9&&G.documentElement&&G.removeChild(G.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(ee){yt(r,r.return,ee)}if(o=r.sibling,o!==null){o.return=r.return,ye=o;break}ye=r.return}return ve=ty,ty=!1,ve}function Za(o,r,d){var h=r.updateQueue;if(h=h!==null?h.lastEffect:null,h!==null){var g=h=h.next;do{if((g.tag&o)===o){var y=g.destroy;g.destroy=void 0,y!==void 0&&ah(r,d,y)}g=g.next}while(g!==h)}}function Xc(o,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var d=r=r.next;do{if((d.tag&o)===o){var h=d.create;d.destroy=h()}d=d.next}while(d!==r)}}function lh(o){var r=o.ref;if(r!==null){var d=o.stateNode;switch(o.tag){case 5:o=d;break;default:o=d}typeof r=="function"?r(o):r.current=o}}function ny(o){var r=o.alternate;r!==null&&(o.alternate=null,ny(r)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(r=o.stateNode,r!==null&&(delete r[vi],delete r[Ga],delete r[Cf],delete r[NE],delete r[ME])),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}function iy(o){return o.tag===5||o.tag===3||o.tag===4}function oy(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||iy(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function ch(o,r,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?d.nodeType===8?d.parentNode.insertBefore(o,r):d.insertBefore(o,r):(d.nodeType===8?(r=d.parentNode,r.insertBefore(o,d)):(r=d,r.appendChild(o)),d=d._reactRootContainer,d!=null||r.onclick!==null||(r.onclick=Cc));else if(h!==4&&(o=o.child,o!==null))for(ch(o,r,d),o=o.sibling;o!==null;)ch(o,r,d),o=o.sibling}function dh(o,r,d){var h=o.tag;if(h===5||h===6)o=o.stateNode,r?d.insertBefore(o,r):d.appendChild(o);else if(h!==4&&(o=o.child,o!==null))for(dh(o,r,d),o=o.sibling;o!==null;)dh(o,r,d),o=o.sibling}var xt=null,ai=!1;function To(o,r,d){for(d=d.child;d!==null;)ry(o,r,d),d=d.sibling}function ry(o,r,d){if(Si&&typeof Si.onCommitFiberUnmount=="function")try{Si.onCommitFiberUnmount(sc,d)}catch{}switch(d.tag){case 5:en||ps(d,r);case 6:var h=xt,g=ai;xt=null,To(o,r,d),xt=h,ai=g,xt!==null&&(ai?(o=xt,d=d.stateNode,o.nodeType===8?o.parentNode.removeChild(d):o.removeChild(d)):xt.removeChild(d.stateNode));break;case 18:xt!==null&&(ai?(o=xt,d=d.stateNode,o.nodeType===8?Ef(o.parentNode,d):o.nodeType===1&&Ef(o,d),Da(o)):Ef(xt,d.stateNode));break;case 4:h=xt,g=ai,xt=d.stateNode.containerInfo,ai=!0,To(o,r,d),xt=h,ai=g;break;case 0:case 11:case 14:case 15:if(!en&&(h=d.updateQueue,h!==null&&(h=h.lastEffect,h!==null))){g=h=h.next;do{var y=g,E=y.destroy;y=y.tag,E!==void 0&&((y&2)!==0||(y&4)!==0)&&ah(d,r,E),g=g.next}while(g!==h)}To(o,r,d);break;case 1:if(!en&&(ps(d,r),h=d.stateNode,typeof h.componentWillUnmount=="function"))try{h.props=d.memoizedProps,h.state=d.memoizedState,h.componentWillUnmount()}catch(D){yt(d,r,D)}To(o,r,d);break;case 21:To(o,r,d);break;case 22:d.mode&1?(en=(h=en)||d.memoizedState!==null,To(o,r,d),en=h):To(o,r,d);break;default:To(o,r,d)}}function sy(o){var r=o.updateQueue;if(r!==null){o.updateQueue=null;var d=o.stateNode;d===null&&(d=o.stateNode=new XE),r.forEach(function(h){var g=iC.bind(null,o,h);d.has(h)||(d.add(h),h.then(g,g))})}}function li(o,r){var d=r.deletions;if(d!==null)for(var h=0;h<d.length;h++){var g=d[h];try{var y=o,E=r,D=E;e:for(;D!==null;){switch(D.tag){case 5:xt=D.stateNode,ai=!1;break e;case 3:xt=D.stateNode.containerInfo,ai=!0;break e;case 4:xt=D.stateNode.containerInfo,ai=!0;break e}D=D.return}if(xt===null)throw Error(n(160));ry(y,E,g),xt=null,ai=!1;var k=g.alternate;k!==null&&(k.return=null),g.return=null}catch($){yt(g,r,$)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)ay(r,o),r=r.sibling}function ay(o,r){var d=o.alternate,h=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:if(li(r,o),Ti(o),h&4){try{Za(3,o,o.return),Xc(3,o)}catch(Te){yt(o,o.return,Te)}try{Za(5,o,o.return)}catch(Te){yt(o,o.return,Te)}}break;case 1:li(r,o),Ti(o),h&512&&d!==null&&ps(d,d.return);break;case 5:if(li(r,o),Ti(o),h&512&&d!==null&&ps(d,d.return),o.flags&32){var g=o.stateNode;try{Sa(g,"")}catch(Te){yt(o,o.return,Te)}}if(h&4&&(g=o.stateNode,g!=null)){var y=o.memoizedProps,E=d!==null?d.memoizedProps:y,D=o.type,k=o.updateQueue;if(o.updateQueue=null,k!==null)try{D==="input"&&y.type==="radio"&&y.name!=null&&gi(g,y),Gu(D,E);var $=Gu(D,y);for(E=0;E<k.length;E+=2){var q=k[E],Q=k[E+1];q==="style"?Wg(g,Q):q==="dangerouslySetInnerHTML"?$g(g,Q):q==="children"?Sa(g,Q):w(g,q,Q,$)}switch(D){case"input":An(g,y);break;case"textarea":Ug(g,y);break;case"select":var X=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!y.multiple;var he=y.value;he!=null?lo(g,!!y.multiple,he,!1):X!==!!y.multiple&&(y.defaultValue!=null?lo(g,!!y.multiple,y.defaultValue,!0):lo(g,!!y.multiple,y.multiple?[]:"",!1))}g[Ga]=y}catch(Te){yt(o,o.return,Te)}}break;case 6:if(li(r,o),Ti(o),h&4){if(o.stateNode===null)throw Error(n(162));g=o.stateNode,y=o.memoizedProps;try{g.nodeValue=y}catch(Te){yt(o,o.return,Te)}}break;case 3:if(li(r,o),Ti(o),h&4&&d!==null&&d.memoizedState.isDehydrated)try{Da(r.containerInfo)}catch(Te){yt(o,o.return,Te)}break;case 4:li(r,o),Ti(o);break;case 13:li(r,o),Ti(o),g=o.child,g.flags&8192&&(y=g.memoizedState!==null,g.stateNode.isHidden=y,!y||g.alternate!==null&&g.alternate.memoizedState!==null||(hh=vt())),h&4&&sy(o);break;case 22:if(q=d!==null&&d.memoizedState!==null,o.mode&1?(en=($=en)||q,li(r,o),en=$):li(r,o),Ti(o),h&8192){if($=o.memoizedState!==null,(o.stateNode.isHidden=$)&&!q&&(o.mode&1)!==0)for(ye=o,q=o.child;q!==null;){for(Q=ye=q;ye!==null;){switch(X=ye,he=X.child,X.tag){case 0:case 11:case 14:case 15:Za(4,X,X.return);break;case 1:ps(X,X.return);var ve=X.stateNode;if(typeof ve.componentWillUnmount=="function"){h=X,d=X.return;try{r=h,ve.props=r.memoizedProps,ve.state=r.memoizedState,ve.componentWillUnmount()}catch(Te){yt(h,d,Te)}}break;case 5:ps(X,X.return);break;case 22:if(X.memoizedState!==null){dy(Q);continue}}he!==null?(he.return=X,ye=he):dy(Q)}q=q.sibling}e:for(q=null,Q=o;;){if(Q.tag===5){if(q===null){q=Q;try{g=Q.stateNode,$?(y=g.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(D=Q.stateNode,k=Q.memoizedProps.style,E=k!=null&&k.hasOwnProperty("display")?k.display:null,D.style.display=xg("display",E))}catch(Te){yt(o,o.return,Te)}}}else if(Q.tag===6){if(q===null)try{Q.stateNode.nodeValue=$?"":Q.memoizedProps}catch(Te){yt(o,o.return,Te)}}else if((Q.tag!==22&&Q.tag!==23||Q.memoizedState===null||Q===o)&&Q.child!==null){Q.child.return=Q,Q=Q.child;continue}if(Q===o)break e;for(;Q.sibling===null;){if(Q.return===null||Q.return===o)break e;q===Q&&(q=null),Q=Q.return}q===Q&&(q=null),Q.sibling.return=Q.return,Q=Q.sibling}}break;case 19:li(r,o),Ti(o),h&4&&sy(o);break;case 21:break;default:li(r,o),Ti(o)}}function Ti(o){var r=o.flags;if(r&2){try{e:{for(var d=o.return;d!==null;){if(iy(d)){var h=d;break e}d=d.return}throw Error(n(160))}switch(h.tag){case 5:var g=h.stateNode;h.flags&32&&(Sa(g,""),h.flags&=-33);var y=oy(o);dh(o,y,g);break;case 3:case 4:var E=h.stateNode.containerInfo,D=oy(o);ch(o,D,E);break;default:throw Error(n(161))}}catch(k){yt(o,o.return,k)}o.flags&=-3}r&4096&&(o.flags&=-4097)}function KE(o,r,d){ye=o,ly(o)}function ly(o,r,d){for(var h=(o.mode&1)!==0;ye!==null;){var g=ye,y=g.child;if(g.tag===22&&h){var E=g.memoizedState!==null||jc;if(!E){var D=g.alternate,k=D!==null&&D.memoizedState!==null||en;D=jc;var $=en;if(jc=E,(en=k)&&!$)for(ye=g;ye!==null;)E=ye,k=E.child,E.tag===22&&E.memoizedState!==null?uy(g):k!==null?(k.return=E,ye=k):uy(g);for(;y!==null;)ye=y,ly(y),y=y.sibling;ye=g,jc=D,en=$}cy(o)}else(g.subtreeFlags&8772)!==0&&y!==null?(y.return=g,ye=y):cy(o)}}function cy(o){for(;ye!==null;){var r=ye;if((r.flags&8772)!==0){var d=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:en||Xc(5,r);break;case 1:var h=r.stateNode;if(r.flags&4&&!en)if(d===null)h.componentDidMount();else{var g=r.elementType===r.type?d.memoizedProps:si(r.type,d.memoizedProps);h.componentDidUpdate(g,d.memoizedState,h.__reactInternalSnapshotBeforeUpdate)}var y=r.updateQueue;y!==null&&d0(r,y,h);break;case 3:var E=r.updateQueue;if(E!==null){if(d=null,r.child!==null)switch(r.child.tag){case 5:d=r.child.stateNode;break;case 1:d=r.child.stateNode}d0(r,E,d)}break;case 5:var D=r.stateNode;if(d===null&&r.flags&4){d=D;var k=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":k.autoFocus&&d.focus();break;case"img":k.src&&(d.src=k.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var $=r.alternate;if($!==null){var q=$.memoizedState;if(q!==null){var Q=q.dehydrated;Q!==null&&Da(Q)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}en||r.flags&512&&lh(r)}catch(X){yt(r,r.return,X)}}if(r===o){ye=null;break}if(d=r.sibling,d!==null){d.return=r.return,ye=d;break}ye=r.return}}function dy(o){for(;ye!==null;){var r=ye;if(r===o){ye=null;break}var d=r.sibling;if(d!==null){d.return=r.return,ye=d;break}ye=r.return}}function uy(o){for(;ye!==null;){var r=ye;try{switch(r.tag){case 0:case 11:case 15:var d=r.return;try{Xc(4,r)}catch(k){yt(r,d,k)}break;case 1:var h=r.stateNode;if(typeof h.componentDidMount=="function"){var g=r.return;try{h.componentDidMount()}catch(k){yt(r,g,k)}}var y=r.return;try{lh(r)}catch(k){yt(r,y,k)}break;case 5:var E=r.return;try{lh(r)}catch(k){yt(r,E,k)}}}catch(k){yt(r,r.return,k)}if(r===o){ye=null;break}var D=r.sibling;if(D!==null){D.return=r.return,ye=D;break}ye=r.return}}var qE=Math.ceil,Vc=B.ReactCurrentDispatcher,uh=B.ReactCurrentOwner,Vn=B.ReactCurrentBatchConfig,Ve=0,bt=null,_t=null,Wt=0,Bn=0,gs=yo(0),Nt=0,Qa=null,ur=0,Kc=0,fh=0,Ja=null,Cn=null,hh=0,ms=1/0,Wi=null,qc=!1,ph=null,Eo=null,Zc=!1,Co=null,Qc=0,el=0,gh=null,Jc=-1,ed=0;function dn(){return(Ve&6)!==0?vt():Jc!==-1?Jc:Jc=vt()}function _o(o){return(o.mode&1)===0?1:(Ve&2)!==0&&Wt!==0?Wt&-Wt:kE.transition!==null?(ed===0&&(ed=om()),ed):(o=tt,o!==0||(o=window.event,o=o===void 0?16:hm(o.type)),o)}function ci(o,r,d,h){if(50<el)throw el=0,gh=null,Error(n(185));Ca(o,d,h),((Ve&2)===0||o!==bt)&&(o===bt&&((Ve&2)===0&&(Kc|=d),Nt===4&&wo(o,Wt)),_n(o,h),d===1&&Ve===0&&(r.mode&1)===0&&(ms=vt()+500,Pc&&vo()))}function _n(o,r){var d=o.callbackNode;kT(o,r);var h=cc(o,o===bt?Wt:0);if(h===0)d!==null&&tm(d),o.callbackNode=null,o.callbackPriority=0;else if(r=h&-h,o.callbackPriority!==r){if(d!=null&&tm(d),r===1)o.tag===0?OE(hy.bind(null,o)):Qm(hy.bind(null,o)),PE(function(){(Ve&6)===0&&vo()}),d=null;else{switch(rm(h)){case 1:d=Xu;break;case 4:d=nm;break;case 16:d=rc;break;case 536870912:d=im;break;default:d=rc}d=Iy(d,fy.bind(null,o))}o.callbackPriority=r,o.callbackNode=d}}function fy(o,r){if(Jc=-1,ed=0,(Ve&6)!==0)throw Error(n(327));var d=o.callbackNode;if(ys()&&o.callbackNode!==d)return null;var h=cc(o,o===bt?Wt:0);if(h===0)return null;if((h&30)!==0||(h&o.expiredLanes)!==0||r)r=td(o,h);else{r=h;var g=Ve;Ve|=2;var y=gy();(bt!==o||Wt!==r)&&(Wi=null,ms=vt()+500,hr(o,r));do try{JE();break}catch(D){py(o,D)}while(!0);kf(),Vc.current=y,Ve=g,_t!==null?r=0:(bt=null,Wt=0,r=Nt)}if(r!==0){if(r===2&&(g=Vu(o),g!==0&&(h=g,r=mh(o,g))),r===1)throw d=Qa,hr(o,0),wo(o,h),_n(o,vt()),d;if(r===6)wo(o,h);else{if(g=o.current.alternate,(h&30)===0&&!ZE(g)&&(r=td(o,h),r===2&&(y=Vu(o),y!==0&&(h=y,r=mh(o,y))),r===1))throw d=Qa,hr(o,0),wo(o,h),_n(o,vt()),d;switch(o.finishedWork=g,o.finishedLanes=h,r){case 0:case 1:throw Error(n(345));case 2:pr(o,Cn,Wi);break;case 3:if(wo(o,h),(h&130023424)===h&&(r=hh+500-vt(),10<r)){if(cc(o,0)!==0)break;if(g=o.suspendedLanes,(g&h)!==h){dn(),o.pingedLanes|=o.suspendedLanes&g;break}o.timeoutHandle=Tf(pr.bind(null,o,Cn,Wi),r);break}pr(o,Cn,Wi);break;case 4:if(wo(o,h),(h&4194240)===h)break;for(r=o.eventTimes,g=-1;0<h;){var E=31-ii(h);y=1<<E,E=r[E],E>g&&(g=E),h&=~y}if(h=g,h=vt()-h,h=(120>h?120:480>h?480:1080>h?1080:1920>h?1920:3e3>h?3e3:4320>h?4320:1960*qE(h/1960))-h,10<h){o.timeoutHandle=Tf(pr.bind(null,o,Cn,Wi),h);break}pr(o,Cn,Wi);break;case 5:pr(o,Cn,Wi);break;default:throw Error(n(329))}}}return _n(o,vt()),o.callbackNode===d?fy.bind(null,o):null}function mh(o,r){var d=Ja;return o.current.memoizedState.isDehydrated&&(hr(o,r).flags|=256),o=td(o,r),o!==2&&(r=Cn,Cn=d,r!==null&&yh(r)),o}function yh(o){Cn===null?Cn=o:Cn.push.apply(Cn,o)}function ZE(o){for(var r=o;;){if(r.flags&16384){var d=r.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var h=0;h<d.length;h++){var g=d[h],y=g.getSnapshot;g=g.value;try{if(!oi(y(),g))return!1}catch{return!1}}}if(d=r.child,r.subtreeFlags&16384&&d!==null)d.return=r,r=d;else{if(r===o)break;for(;r.sibling===null;){if(r.return===null||r.return===o)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function wo(o,r){for(r&=~fh,r&=~Kc,o.suspendedLanes|=r,o.pingedLanes&=~r,o=o.expirationTimes;0<r;){var d=31-ii(r),h=1<<d;o[d]=-1,r&=~h}}function hy(o){if((Ve&6)!==0)throw Error(n(327));ys();var r=cc(o,0);if((r&1)===0)return _n(o,vt()),null;var d=td(o,r);if(o.tag!==0&&d===2){var h=Vu(o);h!==0&&(r=h,d=mh(o,h))}if(d===1)throw d=Qa,hr(o,0),wo(o,r),_n(o,vt()),d;if(d===6)throw Error(n(345));return o.finishedWork=o.current.alternate,o.finishedLanes=r,pr(o,Cn,Wi),_n(o,vt()),null}function Sh(o,r){var d=Ve;Ve|=1;try{return o(r)}finally{Ve=d,Ve===0&&(ms=vt()+500,Pc&&vo())}}function fr(o){Co!==null&&Co.tag===0&&(Ve&6)===0&&ys();var r=Ve;Ve|=1;var d=Vn.transition,h=tt;try{if(Vn.transition=null,tt=1,o)return o()}finally{tt=h,Vn.transition=d,Ve=r,(Ve&6)===0&&vo()}}function vh(){Bn=gs.current,ct(gs)}function hr(o,r){o.finishedWork=null,o.finishedLanes=0;var d=o.timeoutHandle;if(d!==-1&&(o.timeoutHandle=-1,RE(d)),_t!==null)for(d=_t.return;d!==null;){var h=d;switch(Pf(h),h.tag){case 1:h=h.type.childContextTypes,h!=null&&wc();break;case 3:fs(),ct(In),ct(Zt),$f();break;case 5:Hf(h);break;case 4:fs();break;case 13:ct(ht);break;case 19:ct(ht);break;case 10:bf(h.type._context);break;case 22:case 23:vh()}d=d.return}if(bt=o,_t=o=Ro(o.current,null),Wt=Bn=r,Nt=0,Qa=null,fh=Kc=ur=0,Cn=Ja=null,lr!==null){for(r=0;r<lr.length;r++)if(d=lr[r],h=d.interleaved,h!==null){d.interleaved=null;var g=h.next,y=d.pending;if(y!==null){var E=y.next;y.next=g,h.next=E}d.pending=h}lr=null}return o}function py(o,r){do{var d=_t;try{if(kf(),Uc.current=xc,Hc){for(var h=pt.memoizedState;h!==null;){var g=h.queue;g!==null&&(g.pending=null),h=h.next}Hc=!1}if(dr=0,kt=Dt=pt=null,ja=!1,Xa=0,uh.current=null,d===null||d.return===null){Nt=1,Qa=r,_t=null;break}e:{var y=o,E=d.return,D=d,k=r;if(r=Wt,D.flags|=32768,k!==null&&typeof k=="object"&&typeof k.then=="function"){var $=k,q=D,Q=q.tag;if((q.mode&1)===0&&(Q===0||Q===11||Q===15)){var X=q.alternate;X?(q.updateQueue=X.updateQueue,q.memoizedState=X.memoizedState,q.lanes=X.lanes):(q.updateQueue=null,q.memoizedState=null)}var he=H0(E);if(he!==null){he.flags&=-257,G0(he,E,D,y,r),he.mode&1&&U0(y,$,r),r=he,k=$;var ve=r.updateQueue;if(ve===null){var Te=new Set;Te.add(k),r.updateQueue=Te}else ve.add(k);break e}else{if((r&1)===0){U0(y,$,r),Ah();break e}k=Error(n(426))}}else if(ut&&D.mode&1){var At=H0(E);if(At!==null){(At.flags&65536)===0&&(At.flags|=256),G0(At,E,D,y,r),Mf(hs(k,D));break e}}y=k=hs(k,D),Nt!==4&&(Nt=2),Ja===null?Ja=[y]:Ja.push(y),y=E;do{switch(y.tag){case 3:y.flags|=65536,r&=-r,y.lanes|=r;var H=F0(y,k,r);c0(y,H);break e;case 1:D=k;var L=y.type,G=y.stateNode;if((y.flags&128)===0&&(typeof L.getDerivedStateFromError=="function"||G!==null&&typeof G.componentDidCatch=="function"&&(Eo===null||!Eo.has(G)))){y.flags|=65536,r&=-r,y.lanes|=r;var ee=L0(y,D,r);c0(y,ee);break e}}y=y.return}while(y!==null)}yy(d)}catch(we){r=we,_t===d&&d!==null&&(_t=d=d.return);continue}break}while(!0)}function gy(){var o=Vc.current;return Vc.current=xc,o===null?xc:o}function Ah(){(Nt===0||Nt===3||Nt===2)&&(Nt=4),bt===null||(ur&268435455)===0&&(Kc&268435455)===0||wo(bt,Wt)}function td(o,r){var d=Ve;Ve|=2;var h=gy();(bt!==o||Wt!==r)&&(Wi=null,hr(o,r));do try{QE();break}catch(g){py(o,g)}while(!0);if(kf(),Ve=d,Vc.current=h,_t!==null)throw Error(n(261));return bt=null,Wt=0,Nt}function QE(){for(;_t!==null;)my(_t)}function JE(){for(;_t!==null&&!CT();)my(_t)}function my(o){var r=Ay(o.alternate,o,Bn);o.memoizedProps=o.pendingProps,r===null?yy(o):_t=r,uh.current=null}function yy(o){var r=o;do{var d=r.alternate;if(o=r.return,(r.flags&32768)===0){if(d=zE(d,r,Bn),d!==null){_t=d;return}}else{if(d=jE(d,r),d!==null){d.flags&=32767,_t=d;return}if(o!==null)o.flags|=32768,o.subtreeFlags=0,o.deletions=null;else{Nt=6,_t=null;return}}if(r=r.sibling,r!==null){_t=r;return}_t=r=o}while(r!==null);Nt===0&&(Nt=5)}function pr(o,r,d){var h=tt,g=Vn.transition;try{Vn.transition=null,tt=1,eC(o,r,d,h)}finally{Vn.transition=g,tt=h}return null}function eC(o,r,d,h){do ys();while(Co!==null);if((Ve&6)!==0)throw Error(n(327));d=o.finishedWork;var g=o.finishedLanes;if(d===null)return null;if(o.finishedWork=null,o.finishedLanes=0,d===o.current)throw Error(n(177));o.callbackNode=null,o.callbackPriority=0;var y=d.lanes|d.childLanes;if(bT(o,y),o===bt&&(_t=bt=null,Wt=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||Zc||(Zc=!0,Iy(rc,function(){return ys(),null})),y=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||y){y=Vn.transition,Vn.transition=null;var E=tt;tt=1;var D=Ve;Ve|=4,uh.current=null,VE(o,d),ay(d,o),AE(Af),fc=!!vf,Af=vf=null,o.current=d,KE(d),_T(),Ve=D,tt=E,Vn.transition=y}else o.current=d;if(Zc&&(Zc=!1,Co=o,Qc=g),y=o.pendingLanes,y===0&&(Eo=null),PT(d.stateNode),_n(o,vt()),r!==null)for(h=o.onRecoverableError,d=0;d<r.length;d++)g=r[d],h(g.value,{componentStack:g.stack,digest:g.digest});if(qc)throw qc=!1,o=ph,ph=null,o;return(Qc&1)!==0&&o.tag!==0&&ys(),y=o.pendingLanes,(y&1)!==0?o===gh?el++:(el=0,gh=o):el=0,vo(),null}function ys(){if(Co!==null){var o=rm(Qc),r=Vn.transition,d=tt;try{if(Vn.transition=null,tt=16>o?16:o,Co===null)var h=!1;else{if(o=Co,Co=null,Qc=0,(Ve&6)!==0)throw Error(n(331));var g=Ve;for(Ve|=4,ye=o.current;ye!==null;){var y=ye,E=y.child;if((ye.flags&16)!==0){var D=y.deletions;if(D!==null){for(var k=0;k<D.length;k++){var $=D[k];for(ye=$;ye!==null;){var q=ye;switch(q.tag){case 0:case 11:case 15:Za(8,q,y)}var Q=q.child;if(Q!==null)Q.return=q,ye=Q;else for(;ye!==null;){q=ye;var X=q.sibling,he=q.return;if(ny(q),q===$){ye=null;break}if(X!==null){X.return=he,ye=X;break}ye=he}}}var ve=y.alternate;if(ve!==null){var Te=ve.child;if(Te!==null){ve.child=null;do{var At=Te.sibling;Te.sibling=null,Te=At}while(Te!==null)}}ye=y}}if((y.subtreeFlags&2064)!==0&&E!==null)E.return=y,ye=E;else e:for(;ye!==null;){if(y=ye,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:Za(9,y,y.return)}var H=y.sibling;if(H!==null){H.return=y.return,ye=H;break e}ye=y.return}}var L=o.current;for(ye=L;ye!==null;){E=ye;var G=E.child;if((E.subtreeFlags&2064)!==0&&G!==null)G.return=E,ye=G;else e:for(E=L;ye!==null;){if(D=ye,(D.flags&2048)!==0)try{switch(D.tag){case 0:case 11:case 15:Xc(9,D)}}catch(we){yt(D,D.return,we)}if(D===E){ye=null;break e}var ee=D.sibling;if(ee!==null){ee.return=D.return,ye=ee;break e}ye=D.return}}if(Ve=g,vo(),Si&&typeof Si.onPostCommitFiberRoot=="function")try{Si.onPostCommitFiberRoot(sc,o)}catch{}h=!0}return h}finally{tt=d,Vn.transition=r}}return!1}function Sy(o,r,d){r=hs(d,r),r=F0(o,r,1),o=Io(o,r,1),r=dn(),o!==null&&(Ca(o,1,r),_n(o,r))}function yt(o,r,d){if(o.tag===3)Sy(o,o,d);else for(;r!==null;){if(r.tag===3){Sy(r,o,d);break}else if(r.tag===1){var h=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof h.componentDidCatch=="function"&&(Eo===null||!Eo.has(h))){o=hs(d,o),o=L0(r,o,1),r=Io(r,o,1),o=dn(),r!==null&&(Ca(r,1,o),_n(r,o));break}}r=r.return}}function tC(o,r,d){var h=o.pingCache;h!==null&&h.delete(r),r=dn(),o.pingedLanes|=o.suspendedLanes&d,bt===o&&(Wt&d)===d&&(Nt===4||Nt===3&&(Wt&130023424)===Wt&&500>vt()-hh?hr(o,0):fh|=d),_n(o,r)}function vy(o,r){r===0&&((o.mode&1)===0?r=1:(r=lc,lc<<=1,(lc&130023424)===0&&(lc=4194304)));var d=dn();o=Gi(o,r),o!==null&&(Ca(o,r,d),_n(o,d))}function nC(o){var r=o.memoizedState,d=0;r!==null&&(d=r.retryLane),vy(o,d)}function iC(o,r){var d=0;switch(o.tag){case 13:var h=o.stateNode,g=o.memoizedState;g!==null&&(d=g.retryLane);break;case 19:h=o.stateNode;break;default:throw Error(n(314))}h!==null&&h.delete(r),vy(o,d)}var Ay;Ay=function(o,r,d){if(o!==null)if(o.memoizedProps!==r.pendingProps||In.current)En=!0;else{if((o.lanes&d)===0&&(r.flags&128)===0)return En=!1,YE(o,r,d);En=(o.flags&131072)!==0}else En=!1,ut&&(r.flags&1048576)!==0&&Jm(r,Nc,r.index);switch(r.lanes=0,r.tag){case 2:var h=r.type;zc(o,r),o=r.pendingProps;var g=rs(r,Zt.current);us(r,d),g=Yf(null,r,h,o,g,d);var y=zf();return r.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Tn(h)?(y=!0,Rc(r)):y=!1,r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,Lf(r),g.updater=Wc,r.stateNode=g,g._reactInternals=r,Zf(r,h,o,d),r=th(null,r,h,!0,y,d)):(r.tag=0,ut&&y&&Rf(r),cn(null,r,g,d),r=r.child),r;case 16:h=r.elementType;e:{switch(zc(o,r),o=r.pendingProps,g=h._init,h=g(h._payload),r.type=h,g=r.tag=rC(h),o=si(h,o),g){case 0:r=eh(null,r,h,o,d);break e;case 1:r=j0(null,r,h,o,d);break e;case 11:r=$0(null,r,h,o,d);break e;case 14:r=x0(null,r,h,si(h.type,o),d);break e}throw Error(n(306,h,""))}return r;case 0:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:si(h,g),eh(o,r,h,g,d);case 1:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:si(h,g),j0(o,r,h,g,d);case 3:e:{if(X0(r),o===null)throw Error(n(387));h=r.pendingProps,y=r.memoizedState,g=y.element,l0(o,r),Fc(r,h,null,d);var E=r.memoizedState;if(h=E.element,y.isDehydrated)if(y={element:h,isDehydrated:!1,cache:E.cache,pendingSuspenseBoundaries:E.pendingSuspenseBoundaries,transitions:E.transitions},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){g=hs(Error(n(423)),r),r=V0(o,r,h,d,g);break e}else if(h!==g){g=hs(Error(n(424)),r),r=V0(o,r,h,d,g);break e}else for(bn=mo(r.stateNode.containerInfo.firstChild),kn=r,ut=!0,ri=null,d=s0(r,null,h,d),r.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(ls(),h===g){r=xi(o,r,d);break e}cn(o,r,h,d)}r=r.child}return r;case 5:return u0(r),o===null&&Nf(r),h=r.type,g=r.pendingProps,y=o!==null?o.memoizedProps:null,E=g.children,If(h,g)?E=null:y!==null&&If(h,y)&&(r.flags|=32),z0(o,r),cn(o,r,E,d),r.child;case 6:return o===null&&Nf(r),null;case 13:return K0(o,r,d);case 4:return Uf(r,r.stateNode.containerInfo),h=r.pendingProps,o===null?r.child=cs(r,null,h,d):cn(o,r,h,d),r.child;case 11:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:si(h,g),$0(o,r,h,g,d);case 7:return cn(o,r,r.pendingProps,d),r.child;case 8:return cn(o,r,r.pendingProps.children,d),r.child;case 12:return cn(o,r,r.pendingProps.children,d),r.child;case 10:e:{if(h=r.type._context,g=r.pendingProps,y=r.memoizedProps,E=g.value,st(kc,h._currentValue),h._currentValue=E,y!==null)if(oi(y.value,E)){if(y.children===g.children&&!In.current){r=xi(o,r,d);break e}}else for(y=r.child,y!==null&&(y.return=r);y!==null;){var D=y.dependencies;if(D!==null){E=y.child;for(var k=D.firstContext;k!==null;){if(k.context===h){if(y.tag===1){k=$i(-1,d&-d),k.tag=2;var $=y.updateQueue;if($!==null){$=$.shared;var q=$.pending;q===null?k.next=k:(k.next=q.next,q.next=k),$.pending=k}}y.lanes|=d,k=y.alternate,k!==null&&(k.lanes|=d),Bf(y.return,d,r),D.lanes|=d;break}k=k.next}}else if(y.tag===10)E=y.type===r.type?null:y.child;else if(y.tag===18){if(E=y.return,E===null)throw Error(n(341));E.lanes|=d,D=E.alternate,D!==null&&(D.lanes|=d),Bf(E,d,r),E=y.sibling}else E=y.child;if(E!==null)E.return=y;else for(E=y;E!==null;){if(E===r){E=null;break}if(y=E.sibling,y!==null){y.return=E.return,E=y;break}E=E.return}y=E}cn(o,r,g.children,d),r=r.child}return r;case 9:return g=r.type,h=r.pendingProps.children,us(r,d),g=jn(g),h=h(g),r.flags|=1,cn(o,r,h,d),r.child;case 14:return h=r.type,g=si(h,r.pendingProps),g=si(h.type,g),x0(o,r,h,g,d);case 15:return W0(o,r,r.type,r.pendingProps,d);case 17:return h=r.type,g=r.pendingProps,g=r.elementType===h?g:si(h,g),zc(o,r),r.tag=1,Tn(h)?(o=!0,Rc(r)):o=!1,us(r,d),b0(r,h,g),Zf(r,h,g,d),th(null,r,h,!0,o,d);case 19:return Z0(o,r,d);case 22:return Y0(o,r,d)}throw Error(n(156,r.tag))};function Iy(o,r){return em(o,r)}function oC(o,r,d,h){this.tag=o,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=h,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Kn(o,r,d,h){return new oC(o,r,d,h)}function Ih(o){return o=o.prototype,!(!o||!o.isReactComponent)}function rC(o){if(typeof o=="function")return Ih(o)?1:0;if(o!=null){if(o=o.$$typeof,o===j)return 11;if(o===_e)return 14}return 2}function Ro(o,r){var d=o.alternate;return d===null?(d=Kn(o.tag,r,o.key,o.mode),d.elementType=o.elementType,d.type=o.type,d.stateNode=o.stateNode,d.alternate=o,o.alternate=d):(d.pendingProps=r,d.type=o.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=o.flags&14680064,d.childLanes=o.childLanes,d.lanes=o.lanes,d.child=o.child,d.memoizedProps=o.memoizedProps,d.memoizedState=o.memoizedState,d.updateQueue=o.updateQueue,r=o.dependencies,d.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},d.sibling=o.sibling,d.index=o.index,d.ref=o.ref,d}function nd(o,r,d,h,g,y){var E=2;if(h=o,typeof o=="function")Ih(o)&&(E=1);else if(typeof o=="string")E=5;else e:switch(o){case M:return gr(d.children,g,y,r);case F:E=8,g|=8;break;case x:return o=Kn(12,d,r,g|2),o.elementType=x,o.lanes=y,o;case ie:return o=Kn(13,d,r,g),o.elementType=ie,o.lanes=y,o;case re:return o=Kn(19,d,r,g),o.elementType=re,o.lanes=y,o;case ne:return id(d,g,y,r);default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case Z:E=10;break e;case te:E=9;break e;case j:E=11;break e;case _e:E=14;break e;case ue:E=16,h=null;break e}throw Error(n(130,o==null?o:typeof o,""))}return r=Kn(E,d,r,g),r.elementType=o,r.type=h,r.lanes=y,r}function gr(o,r,d,h){return o=Kn(7,o,h,r),o.lanes=d,o}function id(o,r,d,h){return o=Kn(22,o,h,r),o.elementType=ne,o.lanes=d,o.stateNode={isHidden:!1},o}function Th(o,r,d){return o=Kn(6,o,null,r),o.lanes=d,o}function Eh(o,r,d){return r=Kn(4,o.children!==null?o.children:[],o.key,r),r.lanes=d,r.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},r}function sC(o,r,d,h,g){this.tag=r,this.containerInfo=o,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ku(0),this.expirationTimes=Ku(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ku(0),this.identifierPrefix=h,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function Ch(o,r,d,h,g,y,E,D,k){return o=new sC(o,r,d,D,k),r===1?(r=1,y===!0&&(r|=8)):r=0,y=Kn(3,null,null,r),o.current=y,y.stateNode=o,y.memoizedState={element:h,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Lf(y),o}function aC(o,r,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:N,key:h==null?null:""+h,children:o,containerInfo:r,implementation:d}}function Ty(o){if(!o)return So;o=o._reactInternals;e:{if(ir(o)!==o||o.tag!==1)throw Error(n(170));var r=o;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Tn(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(o.tag===1){var d=o.type;if(Tn(d))return qm(o,d,r)}return r}function Ey(o,r,d,h,g,y,E,D,k){return o=Ch(d,h,!0,o,g,y,E,D,k),o.context=Ty(null),d=o.current,h=dn(),g=_o(d),y=$i(h,g),y.callback=r??null,Io(d,y,g),o.current.lanes=g,Ca(o,g,h),_n(o,h),o}function od(o,r,d,h){var g=r.current,y=dn(),E=_o(g);return d=Ty(d),r.context===null?r.context=d:r.pendingContext=d,r=$i(y,E),r.payload={element:o},h=h===void 0?null:h,h!==null&&(r.callback=h),o=Io(g,r,E),o!==null&&(ci(o,g,E,y),Bc(o,g,E)),E}function rd(o){if(o=o.current,!o.child)return null;switch(o.child.tag){case 5:return o.child.stateNode;default:return o.child.stateNode}}function Cy(o,r){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var d=o.retryLane;o.retryLane=d!==0&&d<r?d:r}}function _h(o,r){Cy(o,r),(o=o.alternate)&&Cy(o,r)}function lC(){return null}var _y=typeof reportError=="function"?reportError:function(o){console.error(o)};function wh(o){this._internalRoot=o}sd.prototype.render=wh.prototype.render=function(o){var r=this._internalRoot;if(r===null)throw Error(n(409));od(o,r,null,null)},sd.prototype.unmount=wh.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var r=o.containerInfo;fr(function(){od(null,o,null,null)}),r[Fi]=null}};function sd(o){this._internalRoot=o}sd.prototype.unstable_scheduleHydration=function(o){if(o){var r=lm();o={blockedOn:null,target:o,priority:r};for(var d=0;d<ho.length&&r!==0&&r<ho[d].priority;d++);ho.splice(d,0,o),d===0&&um(o)}};function Rh(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function ad(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11&&(o.nodeType!==8||o.nodeValue!==" react-mount-point-unstable "))}function wy(){}function cC(o,r,d,h,g){if(g){if(typeof h=="function"){var y=h;h=function(){var $=rd(E);y.call($)}}var E=Ey(r,h,o,0,null,!1,!1,"",wy);return o._reactRootContainer=E,o[Fi]=E.current,Ua(o.nodeType===8?o.parentNode:o),fr(),E}for(;g=o.lastChild;)o.removeChild(g);if(typeof h=="function"){var D=h;h=function(){var $=rd(k);D.call($)}}var k=Ch(o,0,!1,null,null,!1,!1,"",wy);return o._reactRootContainer=k,o[Fi]=k.current,Ua(o.nodeType===8?o.parentNode:o),fr(function(){od(r,k,d,h)}),k}function ld(o,r,d,h,g){var y=d._reactRootContainer;if(y){var E=y;if(typeof g=="function"){var D=g;g=function(){var k=rd(E);D.call(k)}}od(r,E,o,g)}else E=cC(d,r,o,g,h);return rd(E)}sm=function(o){switch(o.tag){case 3:var r=o.stateNode;if(r.current.memoizedState.isDehydrated){var d=Ea(r.pendingLanes);d!==0&&(qu(r,d|1),_n(r,vt()),(Ve&6)===0&&(ms=vt()+500,vo()))}break;case 13:fr(function(){var h=Gi(o,1);if(h!==null){var g=dn();ci(h,o,1,g)}}),_h(o,1)}},Zu=function(o){if(o.tag===13){var r=Gi(o,134217728);if(r!==null){var d=dn();ci(r,o,134217728,d)}_h(o,134217728)}},am=function(o){if(o.tag===13){var r=_o(o),d=Gi(o,r);if(d!==null){var h=dn();ci(d,o,r,h)}_h(o,r)}},lm=function(){return tt},cm=function(o,r){var d=tt;try{return tt=o,r()}finally{tt=d}},Wu=function(o,r,d){switch(r){case"input":if(An(o,d),r=d.name,d.type==="radio"&&r!=null){for(d=o;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<d.length;r++){var h=d[r];if(h!==o&&h.form===o.form){var g=_c(h);if(!g)throw Error(n(90));Ie(h),An(h,g)}}}break;case"textarea":Ug(o,d);break;case"select":r=d.value,r!=null&&lo(o,!!d.multiple,r,!1)}},Xg=Sh,Vg=fr;var dC={usingClientEntryPoint:!1,Events:[$a,is,_c,zg,jg,Sh]},tl={findFiberByHostInstance:or,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},uC={bundleType:tl.bundleType,version:tl.version,rendererPackageName:tl.rendererPackageName,rendererConfig:tl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:B.ReactCurrentDispatcher,findHostInstanceByFiber:function(o){return o=Qg(o),o===null?null:o.stateNode},findFiberByHostInstance:tl.findFiberByHostInstance||lC,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cd.isDisabled&&cd.supportsFiber)try{sc=cd.inject(uC),Si=cd}catch{}}return wn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=dC,wn.createPortal=function(o,r){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Rh(r))throw Error(n(200));return aC(o,r,null,d)},wn.createRoot=function(o,r){if(!Rh(o))throw Error(n(299));var d=!1,h="",g=_y;return r!=null&&(r.unstable_strictMode===!0&&(d=!0),r.identifierPrefix!==void 0&&(h=r.identifierPrefix),r.onRecoverableError!==void 0&&(g=r.onRecoverableError)),r=Ch(o,1,!1,null,null,d,!1,h,g),o[Fi]=r.current,Ua(o.nodeType===8?o.parentNode:o),new wh(r)},wn.findDOMNode=function(o){if(o==null)return null;if(o.nodeType===1)return o;var r=o._reactInternals;if(r===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=Qg(r),o=o===null?null:o.stateNode,o},wn.flushSync=function(o){return fr(o)},wn.hydrate=function(o,r,d){if(!ad(r))throw Error(n(200));return ld(null,o,r,!0,d)},wn.hydrateRoot=function(o,r,d){if(!Rh(o))throw Error(n(405));var h=d!=null&&d.hydratedSources||null,g=!1,y="",E=_y;if(d!=null&&(d.unstable_strictMode===!0&&(g=!0),d.identifierPrefix!==void 0&&(y=d.identifierPrefix),d.onRecoverableError!==void 0&&(E=d.onRecoverableError)),r=Ey(r,null,o,1,d??null,g,!1,y,E),o[Fi]=r.current,Ua(o),h)for(o=0;o<h.length;o++)d=h[o],g=d._getVersion,g=g(d._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[d,g]:r.mutableSourceEagerHydrationData.push(d,g);return new sd(r)},wn.render=function(o,r,d){if(!ad(r))throw Error(n(200));return ld(null,o,r,!1,d)},wn.unmountComponentAtNode=function(o){if(!ad(o))throw Error(n(40));return o._reactRootContainer?(fr(function(){ld(null,null,o,!1,function(){o._reactRootContainer=null,o[Fi]=null})}),!0):!1},wn.unstable_batchedUpdates=Sh,wn.unstable_renderSubtreeIntoContainer=function(o,r,d,h){if(!ad(d))throw Error(n(200));if(o==null||o._reactInternals===void 0)throw Error(n(38));return ld(o,r,d,!1,h)},wn.version="18.3.1-next-f1338f8080-20240426",wn}var by;function IC(){if(by)return Nh.exports;by=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Nh.exports=AC(),Nh.exports}var By;function TC(){if(By)return dd;By=1;var e=IC();return dd.createRoot=e.createRoot,dd.hydrateRoot=e.hydrateRoot,dd}var EC=TC();const CC=_v(EC);class _C{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let i=this.length++;for(;i>0;){const s=i-1>>1,a=this.values[s];if(n>=a)break;this.ids[i]=this.ids[s],this.values[i]=a,i=s}this.ids[i]=t,this.values[i]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],i=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let l=(a<<1)+1;const c=l+1;let u=this.ids[l],f=this.values[l];const p=this.values[c];if(c<this.length&&p<f&&(l=c,u=this.ids[c],f=p),f>=i)break;this.ids[a]=u,this.values[a]=f,a=l}this.ids[a]=n,this.values[a]=i}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Fy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],kh=3;class Wp{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[i,s]=new Uint8Array(t,n+0,2);if(i!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==kh)throw new Error(`Got v${a} data when expected v${kh}.`);const l=Fy[s&15];if(!l)throw new Error("Unrecognized array type.");const[c]=new Uint16Array(t,n+2,1),[u]=new Uint32Array(t,n+4,1);return new Wp(u,c,l,void 0,t,n)}constructor(t,n=16,i=Float64Array,s=ArrayBuffer,a,l=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=l;let c=t,u=c;this._levelBounds=[c*4];do c=Math.ceil(c/this.nodeSize),u+=c,this._levelBounds.push(u*4);while(c!==1);this.ArrayType=i,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const f=Fy.indexOf(this.ArrayType),p=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(f<0)throw new Error(`Unexpected typed array class: ${i}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,l+8,u*4),this._indices=new this.IndexArrayType(this.data,l+8+p,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+p+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+p,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(kh<<4)+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new _C}add(t,n,i=t,s=n){const a=this._pos>>2,l=this._boxes;return this._indices[a]=a,l[this._pos++]=t,l[this._pos++]=n,l[this._pos++]=i,l[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),i>this.maxX&&(this.maxX=i),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,i=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let l=0,c=0;l<this.numItems;l++){const u=t[c++],f=t[c++],p=t[c++],m=t[c++],S=Math.floor(a*((u+p)/2-this.minX)/n),v=Math.floor(a*((f+m)/2-this.minY)/i);s[l]=RC(S,v)}pp(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let l=0,c=0;l<this._levelBounds.length-1;l++){const u=this._levelBounds[l];for(;c<u;){const f=c;let p=t[c++],m=t[c++],S=t[c++],v=t[c++];for(let I=1;I<this.nodeSize&&c<u;I++)p=Math.min(p,t[c++]),m=Math.min(m,t[c++]),S=Math.max(S,t[c++]),v=Math.max(v,t[c++]);this._indices[this._pos>>2]=f,t[this._pos++]=p,t[this._pos++]=m,t[this._pos++]=S,t[this._pos++]=v}}}search(t,n,i,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const c=[],u=[];for(;l!==void 0;){const f=Math.min(l+this.nodeSize*4,Uy(l,this._levelBounds));for(let p=l;p<f;p+=4){if(i<this._boxes[p]||s<this._boxes[p+1]||t>this._boxes[p+2]||n>this._boxes[p+3])continue;const m=this._indices[p>>2]|0;l>=this.numItems*4?c.push(m):(a===void 0||a(m))&&u.push(m)}l=c.pop()}return u}neighbors(t,n,i=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const c=this._queue,u=[],f=s*s;e:for(;l!==void 0;){const p=Math.min(l+this.nodeSize*4,Uy(l,this._levelBounds));for(let m=l;m<p;m+=4){const S=this._indices[m>>2]|0,v=Ly(t,this._boxes[m],this._boxes[m+2]),I=Ly(n,this._boxes[m+1],this._boxes[m+3]),A=v*v+I*I;A>f||(l>=this.numItems*4?c.push(S<<1,A):(a===void 0||a(S))&&c.push((S<<1)+1,A))}for(;c.length&&c.peek()&1;)if(c.peekValue()>f||(u.push(c.pop()>>1),u.length===i))break e;l=c.length?c.pop()>>1:void 0}return c.clear(),u}}function Ly(e,t,n){return e<t?t-e:e<=n?0:e-n}function Uy(e,t){let n=0,i=t.length-1;for(;n<i;){const s=n+i>>1;t[s]>e?i=s:n=s+1}return t[n]}function pp(e,t,n,i,s,a){if(Math.floor(i/a)>=Math.floor(s/a))return;const l=e[i+s>>1];let c=i-1,u=s+1;for(;;){do c++;while(e[c]<l);do u--;while(e[u]>l);if(c>=u)break;wC(e,t,n,c,u)}pp(e,t,n,i,u,a),pp(e,t,n,u+1,s,a)}function wC(e,t,n,i,s){const a=e[i];e[i]=e[s],e[s]=a;const l=4*i,c=4*s,u=t[l],f=t[l+1],p=t[l+2],m=t[l+3];t[l]=t[c],t[l+1]=t[c+1],t[l+2]=t[c+2],t[l+3]=t[c+3],t[c]=u,t[c+1]=f,t[c+2]=p,t[c+3]=m;const S=n[i];n[i]=n[s],n[s]=S}function RC(e,t){let n=e^t,i=65535^n,s=65535^(e|t),a=e&(t^65535),l=n|i>>1,c=n>>1^n,u=s>>1^i&a>>1^s,f=n&s>>1^a>>1^a;n=l,i=c,s=u,a=f,l=n&n>>2^i&i>>2,c=n&i>>2^i&(n^i)>>2,u^=n&s>>2^i&a>>2,f^=i&s>>2^(n^i)&a>>2,n=l,i=c,s=u,a=f,l=n&n>>4^i&i>>4,c=n&i>>4^i&(n^i)>>4,u^=n&s>>4^i&a>>4,f^=i&s>>4^(n^i)&a>>4,n=l,i=c,s=u,a=f,u^=n&s>>8^i&a>>8,f^=i&s>>8^(n^i)&a>>8,n=u^u>>1,i=f^f>>1;let p=e^t,m=i|65535^(p|n);return p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|p)>>>0}function PC(e,t){return t.split(".").reduce((n,i)=>{if(n&&typeof n=="object"&&i in n)return n[i]},e)}function Do(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new Wp(e.length),i=new Map,s=new Map;for(const l of e)l.width!==void 0&&l.height!==void 0?n.add(l.position.x,l.position.y,l.position.x+l.width,l.position.y+l.height):n.add(l.position.x,l.position.y,l.position.x,l.position.y);return n.finish(),{all(){return e},byRect(l){const{width:c,height:u}=t,f=new Set,p=[];l.left<0?(p.push({left:l.left+c,right:c}),p.push({left:0,right:l.right})):l.right>c?(p.push({left:l.left,right:c}),p.push({left:0,right:l.right-c})):p.push({left:l.left,right:l.right});const m=[];l.top<0?(m.push({top:l.top+u,bottom:u}),m.push({top:0,bottom:l.bottom})):l.bottom>u?(m.push({top:l.top,bottom:u}),m.push({top:0,bottom:l.bottom-u})):m.push({top:l.top,bottom:l.bottom});for(const S of p)for(const v of m){const I=n.search(S.left,v.top,S.right,v.bottom);for(const A of I)f.add(A)}return Array.from(f).map(S=>e[S])},byRadius(l,c){const{width:u,height:f}=t,p=new Set;for(let m=-u;m<=u;m+=u)for(let S=-f;S<=f;S+=f){const v=l.x+m,I=l.y+S,A=Math.max(0,Math.min(v,u)),_=Math.max(0,Math.min(I,f));if((v-A)**2+(I-_)**2<=c**2){const R=n.neighbors(v,I,void 0,c);for(const w of R)p.add(w)}}return Array.from(p).map(m=>e[m])},byProperty(l,c){var u;if(!i.has(l)){const f=new Map;for(const p of e){const m=p[l];f.has(m)||f.set(m,[]),f.get(m).push(p)}i.set(l,f)}return((u=i.get(l))==null?void 0:u.get(c))||[]},byPropertyPath(l,c){var u;if(!s.has(l)){const f=new Map;for(const p of e){const m=PC(p,l);f.has(m)||f.set(m,[]),f.get(m).push(p)}s.set(l,f)}return((u=s.get(l))==null?void 0:u.get(c))||[]},resetPropertyCache(){i.clear(),s.clear()},count(){return e.length}}}const qs=80,$n=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],Re=20,Tt=24,Pt=10,Ke=4e3,Qe=4e3,Yp=2,DC=15,NC=5e3,Ji=100,eo=20,to=60,wv=200,MC=1e3,Zs=1,Qs=150*.6,Hy=150*.25,OC=150*.7,kC=150*.8,bC=400,Rv=800,BC=150,FC=300,LC=2,Gy=800,UC=500,HC=150*.85,GC=150,Pv=3,$C=24,Dv=600,xC=1,WC=1,YC=.5,zC=1,jC=.5,XC=2,Rs=24,Os=12,VC=24,KC=1.5,qC=150,ZC=200,QC=100,JC=.7,e_=300,t_=400,bh=600,n_=600,Nv=.15,i_=200,Ys=30*.75*1.2,Mv=20,Ov=.3,kv=.6,bv=.8,o_=1,r_=3,s_=5,a_=6,$y=.5,l_=.4,c_=.6,d_=.8,u_=2,Vi=Ke/2,xy=2,gp=.7,mp=.5,ks=10,f_=.5,zs=400,Bv=800,h_=8,Wy=5,p_=16,Fv=5,Lv=600,Ki=100,g_=100,Uv=150;function hi(e,t){return{x:e.x+t.x,y:e.y+t.y}}function m_(e,t){return{x:e.x-t.x,y:e.y-t.y}}function Et(e,t){return{x:e.x*t,y:e.y*t}}function Js(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function rt(e){const t=Js(e);return t===0?{x:0,y:0}:Et(e,1/t)}function zp(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function Yd(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,i)=>({x:n.x+i.x,y:n.y+i.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Xe(e,t,n,i){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>i/2&&(a=a-Math.sign(a)*i),{x:s,y:a}}function We(e,t,n){const i=Xe(e,t,n.width,n.height);return rt(i)}function U(e,t,n,i){const s=Xe(e,t,n,i);return Js(s)}function Hv(e,t){return e.x*t.x+e.y*t.y}function y_(e,t){const n=Hv(e,t),i=Js(e),s=Js(t);if(i===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(i*s)));return Math.acos(a)}function yp(e,t){const n=Math.cos(t),i=Math.sin(t);return{x:e.x*n-e.y*i,y:e.x*i+e.y*n}}function S_(e,t,n){const i=Math.max(0,Math.min(1,n)),s={r:parseInt(e.substring(1,3),16),g:parseInt(e.substring(3,5),16),b:parseInt(e.substring(5,7),16)},a={r:parseInt(t.substring(1,3),16),g:parseInt(t.substring(3,5),16),b:parseInt(t.substring(5,7),16)},l=Math.round(s.r+(a.r-s.r)*i),c=Math.round(s.g+(a.g-s.g)*i),u=Math.round(s.b+(a.b-s.b)*i),f=p=>("00"+p.toString(16)).slice(-2);return`#${f(l)}${f(c)}${f(u)}`}const cu=10,Ol=80,Gv=3,il=5,nn=150,jp=nn*.8,v_=nn*.2,on=nn*.8,Ko=30,$v=10,A_=10,I_=.5,je=30,Hr=je*.75,du=30,Xl=du*.75,xv=50,T_=20,E_=Ol*.8,C_=.7,kl=16,uu=40,__=24,Xp=16,w_=72/3,Yy=24,R_=1.25,P_=1.5,ea=nn*.6,fu=50,D_=1,N_=350,Vp=Ol*.65,M_=80,O_=50,k_=1,b_=128,Wv=10,zy=100,Kp=35,ro=30,hu=.5,pu=2.5,qp=20,yn=250,Zp=.4,Qp=150,Jp=6,B_=5,eg=2,gu=.5,mu=1.5,F_=1,L_=.5,U_=.5,H_=1.5,G_=.25,$_=2.5,x_=45,W_=.05,Y_=200;var Lt=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(Lt||{}),ze=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e[e.SupplyChain=5]="SupplyChain",e))(ze||{}),Gr=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(Gr||{});const zd=24,z_=24;let j_=0;function X_(){return`notification-${Date.now()}-${j_++}`}function bl(e,t){if(t.identifier){const i=e.notifications.find(s=>s.identifier===t.identifier);if(i){if(i.dismissedUntil&&e.time<i.dismissedUntil)return;i.message=t.message,i.timestamp=e.time,i.creationTime=Date.now(),i.duration=t.duration,i.targetEntityIds=t.targetEntityIds,i.highlightedEntityIds=t.highlightedEntityIds,i.targetPosition=t.targetPosition,i.targetArea=t.targetArea,i.targetRadius=t.targetRadius,i.isDismissed=!1,i.dismissedUntil=void 0;return}}const n={...t,id:X_(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function V_(e,t){const n=e.notifications.find(i=>i.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+z_))}function K_(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function q_(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const i of n.highlightedEntityIds){const s=e.entities.entities[i];s&&(s.isHighlighted=!0)}}const de={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire"},Jo={[de.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[de.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[de.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[de.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}}},Z_=.5,Q_="#FFA500",J_="#FF4500",jy=4,ew=10,tg=60;function ng(e){return Jo[e].dimensions}function tw(e){return Jo[e].constructionTimeHours}function nw(e){return Jo[e].destructionTimeHours}function iw(e,t,n,i,s){var l;(l=e.onExit)==null||l.call(e,i,t);const a=s.find(({id:c})=>c===t);return a!=null&&a.onEnter?a.onEnter(i,n):{...n,enteredAt:i.updateContext.gameState.time}}function ow(e,t){return t.find(({id:n})=>n===e)}function rw(e,t){return e!==t}function sw(e){console.warn(`No handler found for state: ${e}`)}const Tl="bushGrowing",Rr="bushFull",kd="bushSpreading",Bl="bushDying",aw=5,lw=3,cw=12,dw=940,Sp=20,Xy=90,Yv=100,so=5,uw=.5,qo=30,no=.1,ml=.9,fw=2,hw=2;var vn=(e=>(e.Berry="berry",e.Meat="meat",e))(vn||{});const ig={berry:"",meat:""};function zv(e,t){return`${e},${t}`}function jv(e){const[t,n]=e.split(",").map(Number);return{gridX:t,gridY:n}}function pw(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function Xv(){return{lastUpdateTime:0,sectors:{}}}const jt=20,jd=100,Vv=20,Kv=0,gw=20,mw=1,qv=.15,yw=.5,Sw=.01,vw=24,Aw="#6B5344",Iw="#4A3728",Vy=.85,Zv=35,Tw=30,Ky=1.25,qy=40,Bh=Math.PI/6,Qv=.5,Ew=1;function og(e,t,n,i){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,l={x:Math.cos(s)*a,y:Math.sin(s)*a},c=hi(e,l);return{x:(c.x%n+n)%n,y:(c.y%i+i)%i}}function xn(e,t,n,i){const s=t,a={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},l=[...s.search.human.byRect(a),...s.search.berryBush.byRect(a),...s.search.corpse.byRect(a)];for(const c of l){if(i!==void 0&&c.id===i)continue;if(U(e,c.position,t.mapDimensions.width,t.mapDimensions.height)<n+c.radius)return!0}return!1}function Cw(e,t,n,i,s){const a=t.mapDimensions.width,l=t.mapDimensions.height;if(!xn(e,t,i,s)&&!ki(t.soilDepletion,e,a,l))return e;const c=i;for(let u=c;u<=n;u+=c){const f=Math.ceil(2*Math.PI*u/c);for(let p=0;p<f;p++){const m=p/f*2*Math.PI,S={x:Math.cos(m)*u,y:Math.sin(m)*u},v=hi(e,S),I={x:(v.x%a+a)%a,y:(v.y%l+l)%l};if(!xn(I,t,i,s)&&!ki(t.soilDepletion,I,a,l))return I}}return null}function ao(e,t){const n=t.search.building.byProperty("ownerId",e);if(n.length>0){const a=n.map(l=>l.position);return Yd(a)}const i=Bi(e,t);if(i.length===0){const a=t.entities.entities[e];return a?a.position:{x:0,y:0}}const s=i.map(a=>a.position);return Yd(s)}function Zy(e,t){const i=[...Wl(e,t),e].map(s=>s.position);return Yd(i)}function vp(e,t,n){const i=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,l=e.y-t.position.y;return Math.abs(a)>i/2&&(a-=Math.sign(a)*i),Math.abs(l)>s/2&&(l-=Math.sign(l)*s),Math.abs(a)<=t.width/2&&Math.abs(l)<=t.height/2}var mt=(e=>(e.Wood="wood",e))(mt||{});const rg={wood:""},Zi=100,Jv=20,js=10,_w=.5,Xs=150,ww=25,Rw=.5,Mr=100,eA=25,sg=.5,tA=15,Xd=4,Pw=.75,Dw=15,Qy=8,nA=20,Nw=.5,ua=(e,t,n)=>{var c,u,f,p;if(!e||!t||e===t)return!1;const i=n.entities.entities[e],s=n.entities.entities[t],a=(u=(c=i==null?void 0:i.tribeControl)==null?void 0:c.diplomacy)==null?void 0:u[t],l=(p=(f=s==null?void 0:s.tribeControl)==null?void 0:f.diplomacy)==null?void 0:p[e];return a===Lt.Hostile||l===Lt.Hostile},fa=(e,t,n)=>e.id===t.id?!1:ua(e.leaderId,t.leaderId,n),Xt=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:ua(e.leaderId,t.ownerId,n),er=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=on||t.hunger>=on||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||fa(e,t,n))return!1;const i=e.gender==="female"?e:t;return!(i.isPregnant||i.age>uu)};function Mw(e){const t=Math.floor(e.x/Re),n=Math.floor(e.y/Re);return{x:t,y:n}}function Ow(e,t){const n=Math.ceil(t/Re),i=e%n*Re+Re/2,s=Math.floor(e/n)*Re+Re/2;return{x:i,y:s}}function kw(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(i/Re),l=Math.floor(s/Re),c=Math.ceil(t/Re);return l*c+a}function zo(e,t,n){const i=kw({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[i]||null}function iA(e,t){return t.terrainOwnership.includes(e)}function oA(e,t,n,i){var l;const s=n;return(l=s.search)!=null&&l.human?s.search.human.byRadius(e,i).some(c=>ua(t,c.leaderId,n)):!1}function bw(e,t,n,i,s=!1,a){if(s&&a&&oA(e,a,i,Uv))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:l,height:c}=i.mapDimensions,u=Math.ceil(l/Re),f=Math.ceil(c/Re),p=Math.ceil(t/Re),m=Math.floor(e.x/Re),S=Math.floor(e.y/Re);let v=!1,I=!1;for(let A=-p;A<=p;A++)for(let _=-p;_<=p;_++){const P=((m+_)%u+u)%u,R=((S+A)%f+f)%f,w=P*Re+Re/2,B=R*Re+Re/2;if(U(e,{x:w,y:B},l,c)<=t){const N=R*u+P,M=i.terrainOwnership[N];if(M===n)v=!0;else if(M!==null){if(s&&a&&ua(a,M,i))continue;I=!0}}}return I?{valid:!1,reason:"Position overlaps with another tribe's territory"}:v?{valid:!0}:iA(n,i)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function rA(e,t,n,i){if(!iA(n,i))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(oA(e,n,i,Uv))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=i.mapDimensions,l=Math.ceil(s/Re),c=Math.ceil(a/Re),u=Math.ceil(t/Re),f=Math.floor(e.x/Re),p=Math.floor(e.y/Re);let m=!1;for(let S=-u;S<=u;S++){for(let v=-u;v<=u;v++){const I=((f+v)%l+l)%l,A=((p+S)%c+c)%c,_=I*Re+Re/2,P=A*Re+Re/2;if(U(e,{x:_,y:P},s,a)<=t){const w=A*l+I;if(i.terrainOwnership[w]===n){m=!0;break}}}if(m)break}return m?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function sA(e,t,n,i=0,s=!1,a){if(i>0){const c=bw(e,i,t,n,s,a);return c.valid?{canPlace:!0}:{canPlace:!1,reason:c.reason}}const l=zo(e.x,e.y,n);return l===null||l===t?{canPlace:!0}:s&&a&&ua(a,l,n)?{canPlace:!0}:l!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function Ap(e,t,n){const i=zo(e.x,e.y,n);return i===null||i===t}function io(e,t,n){const i=zo(e.x,e.y,n);return i===null||i===t}function Bw(e,t,n,i){if(Ap(t,n,i))return t;const{width:s,height:a}=i.mapDimensions,l=Xe(e,t,s,a),c=Math.sqrt(l.x**2+l.y**2);if(c===0)return e;let u=e;const f=U(e,t,s,a),p=f/10;for(let m=p;m<=f;m+=p){const S={x:((e.x+l.x*m/c)%s+s)%s,y:((e.y+l.y*m/c)%a+a)%a};if(Ap(S,n,i))u=S;else break}return u}function aA(e,t,n,i,{allowOverwrite:s}){const{width:a,height:l}=i.mapDimensions,c=Math.ceil(a/Re),u=Math.ceil(l/Re),f=Math.ceil(t/Re),p=Math.floor(e.x/Re),m=Math.floor(e.y/Re);for(let R=-f;R<=f;R++)for(let w=-f;w<=f;w++){const B=((p+w)%c+c)%c,O=((m+R)%u+u)%u,N=B*Re+Re/2,M=O*Re+Re/2;if(U(e,{x:N,y:M},a,l)<=t){const x=O*c+B,Z=i.terrainOwnership[x];(s||Z===null||Z===n)&&(i.terrainOwnership[x]=n)}}const S=3,v=f+S+2,I=[];for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const B=((p+w)%c+c)%c,O=((m+R)%u+u)%u,N=O*c+B;if(i.terrainOwnership[N]===null){let M=!1;const F=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const x of F){let Z=!1,te=!1;for(let j=1;j<=S;j++){const ie=((B+x.x*j)%c+c)%c,_e=((O+x.y*j)%u+u)%u*c+ie;if(i.terrainOwnership[_e]===n){Z=!0;break}}if(Z)for(let j=1;j<=S;j++){const ie=((B-x.x*j)%c+c)%c,_e=((O-x.y*j)%u+u)%u*c+ie;if(i.terrainOwnership[_e]===n){te=!0;break}}if(Z&&te){M=!0;break}}M&&I.push(N)}}for(const R of I)i.terrainOwnership[R]=n;const A=250,_=new Set;for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const B=((p+w)%c+c)%c,N=((m+R)%u+u)%u*c+B;if(i.terrainOwnership[N]===null&&!_.has(N)){const M=[],F=[N];_.add(N),M.push(N);let x=!0,Z=0;for(;Z<F.length;){const te=F[Z++];if(M.length>A){x=!1;break}const j=te%c,ie=Math.floor(te/c),re=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:_e,ny:ue}of re){const ne=((j+_e)%c+c)%c,V=((ie+ue)%u+u)%u*c+ne;i.terrainOwnership[V]===null&&!_.has(V)&&(_.add(V),x&&(M.push(V),F.push(V)))}}if(x&&M.length<=A)for(const te of M)i.terrainOwnership[te]=n}}const P=[];for(let R=-v;R<=v;R++)for(let w=-v;w<=v;w++){const B=((p+w)%c+c)%c,O=((m+R)%u+u)%u,N=O*c+B;if(i.terrainOwnership[N]===null){let M=0;for(let F=-1;F<=1;F++)for(let x=-1;x<=1;x++){if(x===0&&F===0)continue;const Z=((B+x)%c+c)%c,j=((O+F)%u+u)%u*c+Z;i.terrainOwnership[j]===n&&M++}M>=5&&P.push(N)}}for(const R of P)i.terrainOwnership[R]=n}function lA(e,t,n,i){aA(e,t,n,i,{allowOverwrite:!1})}function cA(e,t,n,i){aA(e,t,n,i,{allowOverwrite:!0})}function dA(e,t,n){const{width:i,height:s}=n.mapDimensions,a=Math.ceil(i/Re),l=Math.ceil(s/Re),c=Math.floor(e.x/Re),u=Math.floor(e.y/Re),f=50;for(let p=0;p<=f;p++){const m=-p,S=p,v=-p,I=p;for(let A=v;A<=I;A++)for(let _=m;_<=S;_++){if(p>0&&_>m&&_<S&&A>v&&A<I)continue;const P=((c+_)%a+a)%a,R=((u+A)%l+l)%l,w=R*a+P;if(n.terrainOwnership[w]===t){let B=!1;const O=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:N,ny:M}of O){const F=((P+N)%a+a)%a,Z=((R+M)%l+l)%l*a+F;if(n.terrainOwnership[Z]!==t){B=!0;break}}if(B)return{x:P*Re+Re/2,y:R*Re+Re/2}}}}return null}function Vd(e,t,n){const i=e.terrainOwnership;for(let s=0;s<i.length;s++)i[s]===t&&(i[s]=n)}const rn="treeGrowing",Vt="treeFull",Sn="treeSpreading",Ht="treeFallen",oo="treeStump",$r="treeDying",Fw=500;function Lw(e,t){if(!e.leaderId)return 0;const n=Uw(e.leaderId,t),i=Hw(e.leaderId,t);return i===0?0:Math.min(1,n/i)}function Uw(e,t){const n=Dn({leaderId:e},t),i=Yr(e,t),s=n.reduce((l,c)=>l+c.food.length,0),a=i.reduce((l,c)=>{var f;const u=(f=c.storedItems)==null?void 0:f.filter(p=>p.item.type===vn.Berry||p.item.type===vn.Meat);return l+((u==null?void 0:u.length)||0)},0);return s+a}function Hw(e,t){const n=Dn({leaderId:e},t),i=Yr(e,t),s=n.reduce((l,c)=>l+c.maxFood,0),a=i.reduce((l,c)=>l+(c.storageCapacity||0),0);return s+a}function ag(e,t,n=!1){const i=Yr(e,t,n);if(i.length===0)return 0;const s=i.reduce((l,c)=>{var u;return l+(((u=c.storedItems)==null?void 0:u.length)||0)},0),a=i.reduce((l,c)=>l+(c.storageCapacity||0),0);return a===0?0:Math.min(1,s/a)}function Fl(e,t){const n=Dn({leaderId:e},t),i=0,l=t.search.building.all().filter(I=>{if(!I.ownerId)return!1;const A=t.entities.entities[I.ownerId];return A&&A.leaderId===e}).reduce((I,A)=>{if(A.isConstructed)return I;const _=Jo[A.buildingType].cost.wood||0;return I+_},0),u=xr(e,t).reduce((I,A)=>{const P=(A.maxFuelLevel||Mr)-(A.fuelLevel||0);if(P<=0)return I;const R=Math.ceil(P/eA),w=A.storedItems.filter(O=>O.item.type===mt.Wood).length,B=Math.max(0,R-w);return I+B},0),p=Yr(e,t).reduce((I,A)=>{var P;const _=(P=A.storedItems)==null?void 0:P.filter(R=>R.item.type===mt.Wood);return I+((_==null?void 0:_.length)||0)},0),m=n.reduce((I,A)=>{var _;return I+(((_=A.heldItem)==null?void 0:_.type)===mt.Wood?1:0)},0),S=p+m,v=l+u+i;return Math.max(0,v-S)}function uA(e,t){return t.search.tree.all().filter(s=>{var l;return!(((l=s.stateMachine)==null?void 0:l[0])===Ht)||s.wood.length===0?!1:io(s.position,e,t)}).reduce((s,a)=>s+a.wood.length,0)}function fA(e,t){const n=Dn({leaderId:e},t);if(n.length===0)return{count:0,ratio:0};const i=Gw(e,t);return{count:i,ratio:i/n.length}}function Gw(e,t){const n=t;return n.search.berryBush.all().filter(a=>n.search.terrainOwnership.byRadius(a.position,a.radius).some(l=>l.ownerId===e)).filter(a=>{const l=a.stateMachine&&a.stateMachine[0]==="bushDying",c=a.food.length>0,u=ki(t.soilDepletion,a.position,t.mapDimensions.width,t.mapDimensions.height);return!l&&c&&!u}).length}function Vl(e,t,n=!1){const i=typeof e=="object"?e.leaderId:e;return i?Object.values(t.entities.entities).filter(a=>a.type==="building").filter(a=>{if(a.buildingType!==de.PlantingZone||!n&&!a.isConstructed)return!1;if(a.ownerId){const l=t.entities.entities[a.ownerId];return l&&l.leaderId===i}return!1}):[]}function $w(e,t){const{width:n,height:i,position:s}=e,{width:a,height:l}=t.mapDimensions,{depletedSectors:c,totalSectorsCount:u}=SA(t.soilDepletion,s,n,i,a,l);return u===0?!0:c.length/u<.25}function lg(e){const t=qo*2,n=Math.floor(e.width/t),i=Math.floor(e.height/t);return n*i}function hA(e,t){const n=t,i=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,i).filter(l=>{const c=Math.abs(l.position.x-e.position.x),u=Math.abs(l.position.y-e.position.y);return c<=e.width/2&&u<=e.height/2}).length}function xw(e,t){if(!e.leaderId)return[];const n=Yr(e.leaderId,t),i=Dn(e,t);return n.map(s=>{var f;const a=s.storageCapacity||0,l=((f=s.storedItems)==null?void 0:f.length)||0,c=i.filter(p=>{if(p.activeAction!=="depositing")return!1;if(typeof p.target=="object"&&"x"in p.target){const m=p.target;return U(m,s.position,t.mapDimensions.width,t.mapDimensions.height)<=50}return!1}).length,u=U(e.position,s.position,t.mapDimensions.width,t.mapDimensions.height);return{storage:s,capacity:a,currentItems:l,assignedDepositors:c,distance:u}})}function pA(e,t){const n=xw(e,t);if(n.length===0)return null;const i=n.filter(s=>{const a=s.currentItems<s.capacity,l=s.distance<=Fw;return a&&l});return i.length===0?null:(i.sort((s,a)=>{const l=s.currentItems/s.capacity,c=a.currentItems/a.capacity;return Math.abs(l-c)>.1?l-c:s.assignedDepositors!==a.assignedDepositors?s.assignedDepositors-a.assignedDepositors:s.distance-a.distance}),i[0].storage)}function Ww(e,t){if(!e.leaderId)return null;const i=xr(e.leaderId,t).filter(s=>{const a=s.storageCapacity||Xd;return s.storedItems.length<a});if(i.length>0){const s=i.filter(a=>{const l=a.fuelLevel??0,c=a.maxFuelLevel??Mr;return l<c*sg});return s.length>0?(s.sort((a,l)=>{const c=a.fuelLevel??0,u=l.fuelLevel??0,f=a.maxFuelLevel??Mr,p=l.maxFuelLevel??Mr,m=c/f,S=u/p,v=m<.25,I=S<.25;return v!==I?v?-1:1:c-u}),s[0]):(i.sort((a,l)=>{const c=U(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height),u=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);return c-u}),i[0])}return pA(e,t)}function gA(e,t,n){return Dn({leaderId:e},t).filter(s=>s.activeAction===n).length}function Yr(e,t,n=!1){return Object.values(t.entities.entities).filter(s=>s.type==="building").filter(s=>{if(s.buildingType!==de.StorageSpot||!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function xr(e,t,n=!1){return Object.values(t.entities.entities).filter(s=>s.type==="building").filter(s=>{if(s.buildingType!==de.Bonfire||!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function Yw(e,t){const n=Vl(e,t);if(n.length===0)return null;const i=t.mapDimensions.width,s=t.mapDimensions.height,a=t.soilDepletion;for(const l of n){const c=lg(l);if(hA(l,t)>=c)continue;const f=20;for(let p=0;p<f;p++){const m=l.position.x+(Math.random()-.5)*l.width,S=l.position.y+(Math.random()-.5)*l.height,v={x:(m%i+i)%i,y:(S%s+s)%s};if(!ki(a,v,i,s)&&!xn(v,t,qo))return{position:v,zoneId:l.id}}}return null}function Kl(e,t,n=void 0){return n?Vl(n,t).some(l=>vp(e,l,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===de.PlantingZone&&vp(e,a,t))}function yu(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/jt),gridY:Math.floor(s/jt)}}function mA(e,t,n){const i=zv(t,n);return e.sectors[i]||(e.sectors[i]=pw()),e.sectors[i]}function cg(e,t,n){const i=zv(t,n),s=e.sectors[i];return s?s.health:jd}function ki(e,t,n,i){const{gridX:s,gridY:a}=yu(t,n,i);return cg(e,s,a)<Vv}function yA(e,t,n){return cg(e,t,n)>=Vv}function zw(e,t,n,i,s,a,l){const{gridX:c,gridY:u}=yu(t,s,a),f=mA(e,c,u),p=f.lastAffectedBy[n]||0;if(i-p<qv)return;const m=Kl(t,l)?Qv:1,S=mw*m;f.health=Math.max(Kv,f.health-S),f.lastWalkTime=i,f.lastAffectedBy[n]=i}function jw(e,t,n,i,s,a){const{gridX:l,gridY:c}=yu(t,i,s),u=mA(e,l,c),f=Kl(t,a)?Qv:1,p=gw*f;u.health=Math.max(Kv,u.health-p),u.lastPlantTime=n}function Xw(e,t,n,i,s){let a=0;for(let l=-1;l<=1;l++)for(let c=-1;c<=1;c++){if(l===0&&c===0)continue;const u=((t+l)%i+i)%i,f=((n+c)%s+s)%s;yA(e,u,f)&&a++}return a}function Vw({soilDepletion:e,time:t,mapDimensions:{width:n,height:i}}){if(t-e.lastUpdateTime<Ew)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/jt),l=Math.ceil(i/jt),c=[];for(const u of Object.keys(e.sectors)){const f=e.sectors[u],p=Math.max(f.lastWalkTime,f.lastPlantTime);if(t-p<vw)continue;const{gridX:m,gridY:S}=jv(u),v=Xw(e,m,S,a,l),I=v>0?Sw*(v/8):0,A=yw+I;f.health=Math.min(jd,f.health+A*s),f.health>=jd&&c.push(u);const _=t-qv*10;for(const P of Object.keys(f.lastAffectedBy))f.lastAffectedBy[Number(P)]<_&&delete f.lastAffectedBy[Number(P)]}for(const u of c)delete e.sectors[u]}function Kw(e,t){const n=[];for(const i of Object.keys(e.sectors)){const s=e.sectors[i];if(s.health<t){const{gridX:a,gridY:l}=jv(i);n.push({gridX:a,gridY:l,health:s.health})}}return n}function SA(e,t,n,i,s,a){const l=[],c=n/2,u=i/2,f=t.x-c,p=t.x+c,m=t.y-u,S=t.y+u,v=Math.floor(f/jt),I=Math.floor((p-.001)/jt),A=Math.floor(m/jt),_=Math.floor((S-.001)/jt),P=Math.ceil(s/jt),R=Math.ceil(a/jt);let w=0;for(let B=v;B<=I;B++)for(let O=A;O<=_;O++){w++;const N=(B%P+P)%P,M=(O%R+R)%R;yA(e,N,M)||l.push({gridX:N,gridY:M})}return{depletedSectors:l,totalSectorsCount:w}}function Jy(e,t,n,i,s){const{gridX:a,gridY:l}=yu(t,n,i),c=cg(e,a,l);return 1+(s-1)*Math.sqrt(1-c/jd)}const qw={id:Tl,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Tt/Pt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Bl,data:{...e,enteredAt:i.gameState.time}};if(!ki(i.gameState.soilDepletion,n.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)){const l=Kl(n.position,i.gameState)?hw:1;n.timeSinceLastBerryRegen+=s*l,n.timeSinceLastBerryRegen>=cw&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:vn.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:Rr,data:{...e,enteredAt:i.gameState.time,previousState:Tl}}:{nextState:Tl,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},Zw={id:Rr,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Tt/Pt);if(n.age+=s,n.age>=n.lifespan)return{nextState:Bl,data:{...e,enteredAt:i.gameState.time,previousState:Rr}};if(n.food.length<n.maxFood)return{nextState:Tl,data:{...e,enteredAt:i.gameState.time,previousState:Rr}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=Xy){n.timeSinceLastSpreadAttempt=0;const l=i.gameState.time-n.timeSinceLastHarvest>=Xy,c=Kl(n.position,i.gameState)?fw:1,u=i.gameState.ecosystem.berryBushSpreadChance*c;if(l&&Math.random()<u)return{nextState:kd,data:{...e,enteredAt:i.gameState.time,previousState:Rr}}}return{nextState:Rr,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},Qw={id:kd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i,a=i.deltaTime*(Tt/Pt);if(n.age+=a,n.age>=n.lifespan)return{nextState:Bl,data:{...e,enteredAt:s.time,previousState:kd}};const l=og(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return xn(l,s,15)||Jl(s.entities,l,s.time),{nextState:Rr,data:{...e,enteredAt:s.time,previousState:kd}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},Jw={id:Bl,update:e=>({nextState:Bl,data:e}),onEnter:(e,t)=>(jr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},eR=[qw,Zw,Qw,Jw],gt="humanIdle",_r="humanMoving",yl="humanEating",ha="humanGathering",El="humanDepositing",Cl="humanRetrieving",Dr="humanProcreating",Zo="humanAttacking",bd="humanPlanting",dg="humanChopping",tR={id:gt,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:Zo,data:{...e,enteredAt:i.gameState.time,previousState:gt,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:(n.hunger>=jp?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:i.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:_r,data:{...e,enteredAt:i.gameState.time,previousState:gt,target:n.target}}:n.activeAction==="gathering"?{nextState:ha,data:{...e,enteredAt:i.gameState.time,previousState:gt,target:n.target}}:n.activeAction==="eating"?{nextState:yl,data:{...e,enteredAt:i.gameState.time,previousState:gt}}:n.activeAction==="planting"&&n.target?{nextState:bd,data:{...e,enteredAt:i.gameState.time,previousState:gt,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:El,data:{...e,enteredAt:i.gameState.time,previousState:gt}}:n.activeAction==="retrieving"?{nextState:Cl,data:{...e,enteredAt:i.gameState.time,previousState:gt}}:n.activeAction==="chopping"&&n.target?{nextState:dg,data:{...e,enteredAt:i.gameState.time,previousState:gt,state:"chopping"}}:{nextState:gt,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function vA(e,t=1){let n=A_;return e.hunger>=jp&&(n*=I_),e.age>=E_&&(n*=C_),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const Fh=7.5;class nR{constructor(){De(this,"id",_r)}update(t,n){var S;const{entity:i,updateContext:s}=n;if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:Zo,data:{...t,enteredAt:s.gameState.time,previousState:_r,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:gt,data:{...t,enteredAt:s.gameState.time,previousState:_r}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(S=n.updateContext.gameState.entities.entities[i.target])==null?void 0:S.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*Fh*2,y:i.position.y+i.direction.y*Fh*2}),!a)return{nextState:gt,data:{...t,enteredAt:s.gameState.time,previousState:_r}};const{width:l,height:c}=s.gameState.mapDimensions,u=U(i.position,a,l,c);if(u<Fh)return{nextState:gt,data:{...t,enteredAt:s.gameState.time,previousState:_r}};const f=Xe(i.position,a,l,c),p=rt(f);if(u>qy){const v=yp(p,-Bh),I=yp(p,Bh),A=[p,v,I],_=A.map((R,w)=>{const B=hi(i.position,Et(R,qy)),O={x:(B.x%l+l)%l,y:(B.y%c+c)%c},N=Jy(s.gameState.soilDepletion,O,l,c,Ky),F=Math.cos(w===0?0:Bh);return N*F});let P=0;for(let R=1;R<_.length;R++)_[R]>_[P]&&(P=R);i.direction=A[P]}else i.direction=p;const m=Jy(s.gameState.soilDepletion,i.position,l,c,Ky);return i.acceleration=vA(i,m),{nextState:_r,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const iR=new nR,qe=1,Ll=3;function Ge(e,t,n,i,s,a,l){const c={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:i,entityId:s,targetPosition:a,targetEntityId:l};return e.visualEffects.push(c),e.nextVisualEffectId++,c.id}var Ee=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(Ee||{});const eS=600,oR=1.5,AA=.1,Lh=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,Uh=""+new URL("gather-CU75596W.mp3",import.meta.url).href,rR=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,tS=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,sR=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,aR=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,lR=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,cR=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,dR=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,uR=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Ce=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Ce||{});const fR=new Map([[0,Lh],[1,Uh],[2,rR],[3,tS],[4,sR],[5,aR],[6,lR],[12,cR],[13,dR],[7,Lh],[8,tS],[9,Uh],[10,Uh],[11,Lh],[14,uR]]);let ol,Ul;function hR(){if(!(typeof window>"u"))return Ul}function ug(){if(!(typeof window>"u"))return!ol&&typeof window.AudioContext=="function"&&(ol=new window.AudioContext,Ul=ol.createGain(),Ul.connect(ol.destination),_l(.1,!1)),ol}function _l(e,t){Ul&&(Ul.gain.value=t?0:e/10)}const IA=new Map;let ud=!1,nS=!1;async function pR(){if(nS||ud)return;const e=ug();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),ud=!0,console.log("Starting sound loading...");const t=[];fR.forEach((n,i)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{IA.set(i,a)}).catch(a=>{console.error(`Error loading sound ${Ce[i]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),nS=!0,ud=!1,console.log("All sounds loaded successfully.")}catch(n){ud=!1,console.error("An error occurred while loading sounds:",n)}}const wl=new Map;function fg(e,t){const n=ug(),i=hR();if(!n||!i||i.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=IA.get(e);if(!s){console.warn(`Sound buffer not found for type: ${Ce[e]}`);return}if(t!=null&&t.trackId&&wl.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const l=n.createGain(),c=n.createStereoPanner();let u=l;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const f=Xe(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),p=U(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(p>eS)return;const m=1-Math.pow(p/eS,oR);l.gain.value=Math.max(0,m);const S=Math.sin(f.x/p*(Math.PI/2));c.pan.value=isNaN(S)?0:S,l.connect(c),u=c}else{const f=e===Ce.GameOver?.4:e===Ce.SoundTrack1?1:.2;l.gain.value=f}a.connect(u),u.connect(i),a.start(0),t!=null&&t.trackId&&(wl.set(t.trackId,{sourceNode:a,gainNode:l}),a.onended=()=>{wl.delete(t.trackId)})}function Hh(e,t=1){const n=wl.get(e),i=ug();if(n&&i){const{sourceNode:s,gainNode:a}=n,l=i.currentTime;a.gain.setValueAtTime(a.gain.value,l),a.gain.linearRampToValueAtTime(0,l+t),s.stop(l+t),s.onended=null,wl.delete(e)}}function Me(e,t,n){const i=St(e.gameState);i&&fg(t,{position:n,listenerPosition:i.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}const gR={id:yl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:gt,data:{...e,enteredAt:i.gameState.time,previousState:yl}}:(n.food.length>0&&(!n.eatingCooldownTime||i.gameState.time>=n.eatingCooldownTime)&&n.hunger>Ko&&(n.hunger=Math.max(0,n.hunger-Ko),n.food.pop(),n.eatingCooldownTime=i.gameState.time+1,Me(i,Ce.Eat,n.position),(!n.lastEatingEffectTime||i.gameState.time-n.lastEatingEffectTime>2)&&(Ge(i.gameState,Ee.Eating,n.position,qe,n.id),n.lastEatingEffectTime=i.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:gt,data:{...e,enteredAt:i.gameState.time,previousState:yl}}:{nextState:yl,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class mR{constructor(){De(this,"id",ha)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const yR=new mR,SR={id:El,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:gt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:El}}:{nextState:El,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},vR={id:Cl,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:gt,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Cl}}:{nextState:Cl,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},AR=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),IR=(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time<(e.procreationEndTime||0))return{nextState:Dr,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<on&&a.hunger<on&&!n.procreationCooldown&&!a.procreationCooldown){const l=n.gender==="female"?n:a.gender==="female"?a:void 0,c=n.gender==="male"?n:a.gender==="male"?a:void 0;l&&c&&(l.isPregnant=!0,l.gestationTime=w_,l.pregnancyFatherId=c.id,n.procreationCooldown=Yy,a.procreationCooldown=Yy,Me(i,Ce.Procreate,l.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:gt,data:{...e,enteredAt:s.time,previousState:Dr}}},TR={id:Dr,onEnter:AR,update:IR},ER={id:Zo,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:gt,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:gt,data:{...e}};const i=U(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Xe(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=rt(s),i<=ro||i<=yn&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=vA(t.entity),{nextState:Zo,data:e}}},CR={id:bd,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(s.time-e.enteredAt>=uw){const l=n.food.filter(u=>u.type===vn.Berry).length,c=ki(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(l>=so&&!c){for(let u=0;u<so;u++){const f=n.food.findIndex(p=>p.type===vn.Berry);f>-1&&n.food.splice(f,1)}Jl(s.entities,e.plantingSpot,s.time),jw(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:gt,data:{...e,enteredAt:s.time,previousState:bd}}}return{nextState:bd,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class _R{constructor(){De(this,"id",dg)}update(t,n){const{entity:i,updateContext:s}=n;return i.activeAction!=="chopping"||i.heldItem?{nextState:gt,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const wR=new _R,RR=[tR,iR,gR,yR,SR,vR,TR,ER,CR,wR],ui="preyIdle",Go="preyMoving",Sl="preyGrazing",vl="preyProcreating",PR={id:ui,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Go,data:{...e,enteredAt:i.gameState.time,previousState:ui,target:n.target}}:n.activeAction==="grazing"?{nextState:Sl,data:{...e,enteredAt:i.gameState.time,previousState:ui}}:n.activeAction==="procreating"?{nextState:vl,data:{...e,enteredAt:i.gameState.time,previousState:ui}}:{nextState:ui,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},TA=12,DR=120,iS=50,NR=12,EA=30,MR=2,mn=50,OR=100,Rl=2,Gh=3,kR=.9,bR=1,BR=50,FR=.5,CA=20,LR=140,oS=40,UR=12,_A=40,HR=3,jo=60,fi=40,Ps=50,rS=320,wA=25,GR=60,RA=2,$R=90,xR=.7,WR=1,Pl=3,$h=15,hg=80,PA=10,Su=80,pa=40,DA=2,Kd=30,bs=20,Or=40,Bs=24,kr=48,Fs=12,br=40,Ls=20,Br=60,Us=.75,$o=2.5,Hs=.25,xo=2,NA=4;function YR(e){let t=NR;return e.isAdult||(t*=.7),e.hunger>=BR&&(t*=FR),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function zR(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,c=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),p=Math.floor((s+c)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|f<<8|p}function Hl(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const xh=10;class jR{constructor(){De(this,"id",Go)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction!=="moving")return{nextState:ui,data:{...t,enteredAt:s.gameState.time,previousState:Go}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*xh*2,y:i.position.y+i.direction.y*xh*2}),!a)return{nextState:ui,data:{...t,enteredAt:s.gameState.time,previousState:Go}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=rt(l),i.acceleration=YR(i),U(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<xh?{nextState:ui,data:{...t,enteredAt:s.gameState.time,previousState:Go}}:{nextState:Go,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const XR=new jR,VR={id:Sl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Go,data:{...e,enteredAt:i.gameState.time,previousState:Sl,target:n.target}}:n.activeAction!=="grazing"?{nextState:ui,data:{...e,enteredAt:i.gameState.time,previousState:Sl}}:{nextState:Sl,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},KR={id:vl,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="moving"?{nextState:Go,data:{...e,enteredAt:i.gameState.time,previousState:vl,target:n.target}}:n.activeAction!=="procreating"?{nextState:ui,data:{...e,enteredAt:i.gameState.time,previousState:vl}}:{nextState:vl,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},qR=[PR,XR,VR,KR],gn="predatorIdle",Fo="predatorMoving",qi="predatorAttacking",Ds="predatorProcreating",Fr="predatorEating",ZR={id:gn,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:Fr,data:{...e,enteredAt:i.gameState.time,previousState:gn,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:qi,data:{...e,enteredAt:i.gameState.time,previousState:gn,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction==="moving"?{nextState:Fo,data:{...e,enteredAt:i.gameState.time,previousState:gn,target:n.target}}:n.activeAction==="procreating"?{nextState:Ds,data:{...e,enteredAt:i.gameState.time,previousState:gn}}:{nextState:gn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function MA(e){let t=UR;return e.hunger>=$R&&(t*=xR),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function QR(e,t){const n=e>>16&255,i=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,c=t&255;let u=Math.floor((n+a)/2),f=Math.floor((i+l)/2),p=Math.floor((s+c)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(f=Math.max(0,Math.min(255,f+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|f<<8|p}function Gl(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const Wh=12;class JR{constructor(){De(this,"id",Fo)}update(t,n){var u;const{entity:i,updateContext:s}=n;if(i.activeAction==="eating")return{nextState:Fr,data:{...t,enteredAt:s.gameState.time,previousState:Fo,preyId:i.attackTargetId,eatingStartTime:s.gameState.time}};if(i.activeAction==="attacking"&&i.attackTargetId)return{nextState:qi,data:{...t,enteredAt:s.gameState.time,previousState:Fo,attackTargetId:i.attackTargetId,attackStartTime:s.gameState.time}};if(i.activeAction!=="moving")return{nextState:gn,data:{...t,enteredAt:s.gameState.time,previousState:Fo}};let a;if(typeof i.target=="object"?a=i.target:typeof i.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[i.target])==null?void 0:u.position),!a&&(i.direction.x!==0||i.direction.y!==0)&&(a={x:i.position.x+i.direction.x*Wh*2,y:i.position.y+i.direction.y*Wh*2}),!a)return{nextState:gn,data:{...t,enteredAt:s.gameState.time,previousState:Fo}};const l=Xe(i.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return i.direction=rt(l),i.acceleration=MA(i),U(i.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Wh?{nextState:gn,data:{...t,enteredAt:s.gameState.time,previousState:Fo}}:{nextState:Fo,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const e1=new JR,t1={id:qi,update:(e,t)=>{const{entity:n,updateContext:i}=t;if(n.activeAction==="eating")return{nextState:Fr,data:{...e,enteredAt:i.gameState.time,previousState:qi,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:qi}};const s=i.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:qi}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:qi}};const l=U(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height),c=Xe(n.position,s.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return n.direction=rt(c),l>fi?n.acceleration=MA(n):n.acceleration=0,{nextState:qi,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},n1={id:Ds,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction==="eating"?{nextState:Fr,data:{...e,enteredAt:i.gameState.time,previousState:Ds,preyId:n.attackTargetId,eatingStartTime:i.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:qi,data:{...e,enteredAt:i.gameState.time,previousState:Ds,attackTargetId:n.attackTargetId,attackStartTime:i.gameState.time}}:n.activeAction!=="procreating"?{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:Ds}}:{nextState:Ds,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},i1={id:Fr,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.activeAction!=="eating"?{nextState:gn,data:{...e,enteredAt:i.gameState.time,previousState:Fr}}:{nextState:Fr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},o1=[ZR,e1,t1,n1,i1],r1=24*30*10,Qo=24*5,s1=48,a1=72,ql=20,l1="#3b2016",c1="#5c3a21",d1="#376d31",u1="#76a331",f1="#a6c44a",h1="rgba(0, 0, 0, 0.25)",p1=60,g1=24*7,m1=.1,sS=1,vu=5,y1={id:rn,update:(e,t)=>{const{entity:n,updateContext:i}=t;return n.age>=n.lifespan?{nextState:$r,data:{enteredAt:i.gameState.time,previousState:rn}}:n.age>=Qo?{nextState:Vt,data:{enteredAt:i.gameState.time,previousState:rn}}:{nextState:rn,data:e}}},S1={id:Vt,update:(e,t)=>{const{entity:n,updateContext:i}=t,s=i.deltaTime*(Tt/Pt);return n.age>=n.lifespan?{nextState:$r,data:{...e,enteredAt:i.gameState.time,previousState:Vt}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=g1&&(n.timeSinceLastSpreadAttempt=0,Math.random()<m1)?{nextState:Sn,data:{...e,enteredAt:i.gameState.time,previousState:Vt}}:{nextState:Vt,data:e})}},v1={id:Sn,update:(e,t)=>{const{entity:n,updateContext:i}=t,{gameState:s}=i;if(n.age>=n.lifespan)return{nextState:$r,data:{...e,enteredAt:s.time,previousState:Sn}};const a=og(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return xn(a,s,25)||xl(s.entities,a,s.time),{nextState:Vt,data:{...e,enteredAt:s.time,previousState:Sn}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},A1={id:Ht,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=s1?{nextState:oo,data:{enteredAt:n.gameState.time,previousState:Ht}}:{nextState:Ht,data:e}}},I1={id:oo,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=a1?{nextState:$r,data:{enteredAt:n.gameState.time,previousState:oo}}:{nextState:oo,data:e}}},T1={id:$r,update:e=>({nextState:$r,data:e}),onEnter:(e,t)=>(jr(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},E1=[y1,S1,v1,A1,I1,T1],aS=[...eR,...RR,...qR,...o1,...E1];function C1(e,t,n){const i=ow(e,aS);if(!i)return sw(e),[e,t];const{nextState:s,data:a}=i.update(t,n);return rw(e,s)?[s,iw(i,s,a,n,aS)]:[s,a]}const Ct=30,ga=Ct*.6,OA="#4CAF50",kA="#FF5722",bA="#9C27B0",_1="#2196F3",BA="#FFC107",w1="#DC143C",pg="#FFFFFF",gg=[5,5],Au=5,ta=15,R1=20,P1=16,D1=10,N1=16,M1=16,qd=["","","","","","","","","",""],Dl=8,O1="#FFFFFF",it=18,et=15,k1="rgba(0, 0, 0, 0.7)",b1=4,No=150,Fn=15,Yi=10,Wo="#555",B1="#f44336",F1="#4CAF50",L1="#2196F3",U1="#FFC107",fd=16,mr=32,hd=28,H1=10,G1=8,$1=8,x1=8,qn=28,pd=40,W1="rgba(255, 215, 0, 0.7)",Y1="rgba(0, 0, 0, 0.3)",Ei=10,lS=8,Yh=11,Mo=20,zh=40,cS=5,z1=10,j1="#FFA500",X1="#808080",Qi=120,FA=30,V1=20,Ho="#2d3748",Ut="#ffffff",gd="#4a5568",LA=5,mg="#bdc9f792",UA="#272c36ff",HA="#a0aec0",Zd=300,GA="rgba(255, 255, 255, 0.5)",K1="rgba(0, 0, 0, 0.8)",q1="#FFFFFF",dS=14,uS=8,fS=-15,$A="#FFD700",xA=5,Z1=10,jh=12,Q1=10,J1="#4CAF50",eP="#F44336",tP="#FFC107",nP="rgba(255, 255, 255, 0.2)",hS="#FFFFFF",iP="#FF6B6B",oP=5,WA=30,rl=50,md=8,pS=10,rP="rgba(0, 0, 0, 0.5)",sP="#FFFFFF",aP=33,lP=400,cP=20,dP=10,uP="rgba(0, 0, 0, 0.7)",fP="#FFFFFF",Xh=20,gS=16,hP=.5,mS=5,YA="#FFD700",pP=40,yg=4,zA=3,gP=5,jA=20,XA=5,mP="#FFFFFF",yP="#FF6B6B",Ln=80,yr=10,yd=300,Sr=15,SP=8,vP="rgba(0, 0, 0, 0.8)",AP="#FFFFFF",Vh=14,yS=10,Ci=20,IP="#FF6B6B",TP="#4CAF50",SS="#FFD700",EP="rgba(255, 255, 0, 0.3)",CP=2,_P=500,wP=120,RP=45,PP="#FFD700",DP=3,NP=4;var J=(e=>(e.Leader="leader",e.Gatherer="gatherer",e.Planter="planter",e.Hunter="hunter",e.Mover="mover",e.Warrior="warrior",e))(J||{});function Sg(e,t){return`${e},${t}`}const vS=Tt*10;function VA(e){return e%vS/vS}function MP(e){const t=VA(e);return(Math.cos(t*2*Math.PI)+1)/2}function OP(e){const t=VA(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function KA(e,t,n){const i=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(i/Zi),gridY:Math.floor(s/Zi)}}function na(e,t,n,i,s){const{gridX:a,gridY:l}=KA(t,i,s),c=Sg(a,l),u=e.sectors[c],f=u?u.currentTemperature:Jv,m=(MP(n)*2-1)*Dw;return f+m}function kP(e){const{sectors:t}=e.temperature,{width:n,height:i}=e.mapDimensions,s=Math.ceil(n/Zi),a=Math.ceil(i/Zi);for(const c in t){const u=t[c];u.currentTemperature=u.baseTemperature}const l=Math.ceil(Xs/Zi);Object.values(e.entities.entities).forEach(c=>{if(c.type==="building"){const u=c;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const f=KA(u.position,n,i);for(let p=-l;p<=l;p++)for(let m=-l;m<=l;m++){const S=(f.gridX+m+s)%s,v=(f.gridY+p+a)%a,I=Sg(S,v),A=t[I];if(A){const _={x:(S+.5)*Zi,y:(v+.5)*Zi},P=U(u.position,_,n,i);if(P<Xs){const R=ww*(1-P/Xs);A.currentTemperature+=R}}}}}})}function qA(e,t){const n={},i=Math.ceil(e/Zi),s=Math.ceil(t/Zi);for(let a=0;a<s;a++)for(let l=0;l<i;l++){const c=Sg(l,a);let u=Jv;const f=a/s*10-5;u+=f,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),n[c]={baseTemperature:u,currentTemperature:u}}return{sectors:n}}function bP(e,t,n){var c;const{gameState:i}=t,s=n*(Tt/Pt);e.isAdult=e.age>=Xp;const a=na(i.temperature,e.position,i.time,i.mapDimensions.width,i.mapDimensions.height);if(a<js){const u=(js-a)*_w*s;e.hitpoints-=u}if(e.movementSlowdown&&i.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<nn){const u=1-e.hunger/nn*L_,f=F_*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+f)}if(e.hunger+=n*(il/(Tt/Pt)),e.hunger>=nn)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-Ko);else{const u=U_*s;e.hitpoints-=u}if(e.age+=n/cu,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((il*R_-il)/(Tt/Pt)),(!e.lastPregnantEffectTime||i.time-e.lastPregnantEffectTime>Ll*3)&&(Ge(i,Ee.Pregnant,e.position,Ll,e.id),e.lastPregnantEffectTime=i.time),e.gestationTime<=0&&(YM(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===ga&&(e.radius=Ct):e.hunger+=n*((il*P_-il)/(Tt/Pt)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const f=i.entities.entities[e.motherId];f&&u.push(f)}if(e.fatherId){const f=i.entities.entities[e.fatherId];f&&u.push(f)}for(const f of u)if(f.age>=Vp&&f.hunger>=M_&&U(e.position,f.position,i.mapDimensions.width,i.mapDimensions.height)<=O_){e.food.pop(),f.hunger=Math.max(0,f.hunger-Ko),e.feedParentCooldownTime=k_;break}}let l;if(e.hitpoints<=0?a<js?l="hypothermia":e.hunger>=nn?l="hunger":l="killed":e.age>=e.maxAge&&(l="oldAge"),l){if(e.leaderId===e.id){const u=Wr(Pn(i,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeRole=J.Leader,u.tribeControl=e.tribeControl??{roleWeights:{[J.Leader]:0,[J.Gatherer]:2,[J.Planter]:2,[J.Hunter]:2,[J.Mover]:2,[J.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}};const f=i;Vd(i,e.id,u.id);const p=f.search.human.byProperty("leaderId",e.id);for(const v of p)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const m=f.search.building.byProperty("ownerId",e.id);for(const v of m)v.ownerId=u.id;for(const v of tu(u,i))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const S=Du(i).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of S){const I=i.entities.entities[v.leaderId];if((c=I==null?void 0:I.tribeControl)!=null&&c.diplomacy){const A=I.tribeControl.diplomacy[e.id];A!==void 0&&(I.tribeControl.diplomacy[u.id]=A,delete I.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=Wr(Pn(i,e));u?(u.isPlayer=!0,i.generationCount++):(i.gameOver=!0,i.causeOfGameOver=l,bl(i,{identifier:"no_heir",type:Gr.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}$M(i.entities,e.position,e.gender,e.age,e.radius,e.id,i.time,e.food,e.hunger),jr(i.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function BP(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/b_);const i=Math.floor(Wv*(1-e.decayProgress));e.food.length>i&&e.food.splice(i),e.decayProgress>=1&&e.food.length<=0&&jr(t.gameState.entities,e.id)}function FP(e,t,n){const i=n*(Tt/Pt);e.age+=n/cu,e.isAdult=e.age>=Rl;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=DR){const l=NA*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};l.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,l.x)),l.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,l.y));const c=Math.random()<.5?"male":"female",u=e,f=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let p;if(f)p=zR(u.geneCode,f.geneCode);else{p=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}ia(t.gameState.entities,l,c,0,EA*.5,p,e.id,e.fatherId,e.aiType),Ge(t.gameState,Ee.Procreation,e.position,Ll,e.id),Me(t,Ce.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=i,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=TA&&(a=!0),a&&(xM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),jr(t.gameState.entities,e.id))}function LP(e,t,n){const i=n*(Tt/Pt);e.age+=n/cu,e.isAdult=e.age>=Pl;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*i;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=LR){const l=NA*i;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=i,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};l.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,l.x)),l.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,l.y));const c=Math.random()<.5?"male":"female",u=e,f=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let p;if(f)p=QR(u.geneCode,f.geneCode);else{p=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}oa(t.gameState.entities,l,c,0,_A*.6,p,e.id,e.pregnancyFatherId,e.aiType),Ge(t.gameState,Ee.Procreation,e.position,Ll,e.id),Me(t,Ce.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=i,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=i,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=i,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=i,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=CA&&(a=!0),a&&(WM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),jr(t.gameState.entities,e.id))}var Gt=(e=>(e[e.BehaviorTreeBased=0]="BehaviorTreeBased",e[e.TaskBased=1]="TaskBased",e))(Gt||{}),T=(e=>(e[e.SUCCESS=0]="SUCCESS",e[e.FAILURE=1]="FAILURE",e[e.RUNNING=2]="RUNNING",e[e.NOT_EVALUATED=3]="NOT_EVALUATED",e))(T||{});class Nn{constructor(){De(this,"name");De(this,"depth");De(this,"children");De(this,"child")}getLastStatus(t){return C.get(t.aiBlackboard,`${this.name}_lastStatus`)??3}setLastStatus(t,n){C.set(t.aiBlackboard,`${this.name}_lastStatus`,n)}getRunningChildIndex(t){return C.get(t.aiBlackboard,`${this.name}_runningChildIndex`)}setRunningChildIndex(t,n){C.set(t.aiBlackboard,`${this.name}_runningChildIndex`,n)}}const C={create(){return{data:{},nodeExecutionData:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e},recordNodeExecution({nodeExecutionData:e},t,n,i,s,a){const l=e[t]||{lastExecuted:0,status:T.FAILURE,depth:0,debugInfo:"",executionHistory:[]},c=l.executionHistory[l.executionHistory.length-1];c&&i-(c==null?void 0:c.time)>Zs&&l.executionHistory.push({time:c.time+Zs,status:T.NOT_EVALUATED}),l.executionHistory.push({time:i,status:n});const u=WA/Pt*Tt,f=i-u;l.executionHistory=l.executionHistory.filter(m=>m.time>=f);const p={...l,lastExecuted:i,status:n,depth:s,debugInfo:a};e[t]=p},getNodeExecutionData({nodeExecutionData:e}){return e},cleanupOldEntries({nodeExecutionData:e},t){const n=$C,i=[];for(const[s,a]of Object.entries(e))t-a.lastExecuted>n&&i.push(s);for(const s of i)delete e[s]}},Oi=24,Iu=2,vg=3;function $t(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}function UP(e,t){if(!e.aiBlackboard)return;const n=e.aiBlackboard.data,i=[];for(const s in n)if(s.startsWith("tribal_")){const a=n[s];a&&typeof a=="object"&&"startTime"in a&&t-a.startTime>Oi&&i.push(s)}for(const s of i)C.delete(e.aiBlackboard,s)}const Zl="tribe_logistics_demands",HP=8;function tr(e){return C.get(e,Zl)||[]}function ZA(e,t,n,i){const s=tr(e),a=s.find(l=>l.requesterId===t&&l.resourceType===n);if(a)a.updatedAt=i;else{const l={requesterId:t,resourceType:n,updatedAt:i};s.push(l)}C.set(e,Zl,s)}function GP(e,t,n,i,s){const a=tr(e),l=a.find(c=>c.requesterId===t&&c.resourceType===n);return l&&!l.claimedBy?(l.updatedAt=s,l.claimedBy=i,C.set(e,Zl,a),!0):!1}function $P(e){return tr(e).filter(n=>!n.claimedBy).sort((n,i)=>n.updatedAt-i.updatedAt)}function QA(e,t,n){let i=tr(e);i=i.filter(s=>!(s.requesterId===t&&s.resourceType===n)),C.set(e,Zl,i)}function JA(e,t,n){return tr(e).find(s=>s.requesterId===t&&s.resourceType===n)}function xP(e,t){let n=tr(e);n=n.filter(i=>t-i.updatedAt<=HP),C.set(e,Zl,n)}function Ag(e,t,n){if(e.aiBlackboard){const i=C.get(e.aiBlackboard,"lastAiUpdateTime")??0;if(t.gameState.time-i+(Math.random()-Math.random())*Zs/10>=Zs){e.aiBlackboard&&C.cleanupOldEntries(e.aiBlackboard,t.gameState.time);const s=$t(e,t.gameState);s&&s.id===e.id&&s.aiBlackboard&&(UP(s,t.gameState.time),xP(s.aiBlackboard,t.gameState.time)),n.execute(e,t,e.aiBlackboard),C.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time)}}else console.warn(`Behavior Tree AI ticked for human ${e.id}, but the tree or blackboard was missing.`),e.activeAction="idle"}const AS="Human Behavior",WP=1;class YP{constructor(){De(this,"nodeData",new Map);De(this,"pathStack",[]);De(this,"startTimeStack",[])}nodeStart(t){this.pathStack.push(t),this.startTimeStack.push(performance.now())}nodeEnd(){if(this.startTimeStack.length===0||this.pathStack.length===0){console.error("BTProfiler: nodeEnd() called without a matching nodeStart().");return}const t=performance.now(),n=this.startTimeStack.pop(),i=t-n,s=this.pathStack.join(" > "),a=this.nodeData.get(s)??{path:s,totalTime:0,callCount:0,minTime:1/0,maxTime:-1/0};a.totalTime+=i,a.callCount++,a.minTime=Math.min(a.minTime,i),a.maxTime=Math.max(a.maxTime,i),this.nodeData.set(s,a),this.pathStack.pop()}report(t={}){const{showAll:n=!1}=t,i=Array.from(this.nodeData.values());if(i.length===0){console.log("--- Behavior Tree Profiler: No data collected. ---");return}let s=i,a="--- Behavior Tree Full Report ---";if(!n){const c=this.nodeData.get(AS);if(c){const u=c.totalTime*WP/100;s=i.filter(f=>f.totalTime>u&&f.path!==AS),a="--- Behavior Tree Problem Report ---"}else console.log('BTProfiler: Root node "Human Behavior" not found. Showing full report.'),a="--- Behavior Tree Full Report (Root Not Found) ---"}const l=s.sort((c,u)=>u.totalTime-c.totalTime);console.log(a),l.length>0?console.table(l.map(c=>({Path:c.path,"Total Time (ms)":c.totalTime.toFixed(3),Calls:c.callCount,"Avg Time (ms)":(c.totalTime/c.callCount).toFixed(3),"Min Time (ms)":c.minTime.toFixed(3),"Max Time (ms)":c.maxTime.toFixed(3)}))):console.log("No significant performance problems detected."),console.log("------------------------------------")}reset(){this.nodeData.clear(),this.pathStack=[],this.startTimeStack=[]}getNodeData(t){return this.nodeData.get(t)}}const ot=new YP;function Kt(e){return Array.isArray(e)?e:[e,""]}class Ae extends Nn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{for(const a of this.children){const[l,c]=Kt(a.execute(n,i,s));if(l!==T.SUCCESS)return this.setLastStatus(n,l),this.name&&C.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,c),l}return this.setLastStatus(n,T.SUCCESS),this.name&&C.recordNodeExecution(s,this.name,T.SUCCESS,i.gameState.time,this.depth,""),T.SUCCESS}finally{this.name&&ot.nodeEnd()}}}class ln extends Nn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{const a=this.getRunningChildIndex(n)??0;for(let l=a;l<this.children.length;l++){const c=this.children[l],[u,f]=Kt(c.execute(n,i,s));if(u!==T.FAILURE){if(u===T.SUCCESS)return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,T.SUCCESS),this.name&&C.recordNodeExecution(s,this.name,T.SUCCESS,i.gameState.time,this.depth,f),T.SUCCESS;if(u===T.RUNNING)return this.setRunningChildIndex(n,l),this.setLastStatus(n,T.RUNNING),this.name&&C.recordNodeExecution(s,this.name,T.RUNNING,i.gameState.time,this.depth,f),T.RUNNING}}return this.setRunningChildIndex(n,void 0),this.setLastStatus(n,T.FAILURE),this.name&&C.recordNodeExecution(s,this.name,T.FAILURE,i.gameState.time,this.depth,""),T.FAILURE}finally{this.name&&ot.nodeEnd()}}}class IS extends Nn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.children=n,this.name=i,this.depth=s,this.children.forEach(a=>{a.depth=(this.depth??0)+1})}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{let a=!0;for(const c of this.children){const[u,f]=Kt(c.execute(n,i,s));u===T.FAILURE&&(a=!1),this.name&&C.recordNodeExecution(s,this.name,u,i.gameState.time,this.depth,f)}const l=a?T.SUCCESS:T.FAILURE;return this.setLastStatus(n,l),l}finally{this.name&&ot.nodeEnd()}}}class se extends Nn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.action=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{const[a,l]=Kt(this.action(n,i,s));return this.setLastStatus(n,a),this.name&&C.recordNodeExecution(s,this.name,a,i.gameState.time,this.depth,l),a}finally{this.name&&ot.nodeEnd()}}}class fe extends Nn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.condition=n,this.name=i,this.depth=s}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{const[a,l]=Kt(this.condition(n,i,s)),c=a?T.SUCCESS:T.FAILURE;return this.setLastStatus(n,c),this.name&&C.recordNodeExecution(s,this.name,c,i.gameState.time,this.depth,l),c}finally{this.name&&ot.nodeEnd()}}}class zP extends Nn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{const[a,l]=Kt(this.child.execute(n,i,s));let c;switch(a){case T.SUCCESS:c=T.FAILURE;break;case T.FAILURE:c=T.SUCCESS;break;case T.RUNNING:default:c=a;break}return this.setLastStatus(n,c),this.name&&C.recordNodeExecution(s,this.name,c,i.gameState.time,this.depth,l),c}finally{this.name&&ot.nodeEnd()}}}class jP extends Nn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s,this.child.depth=(this.depth??0)+1}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{const[,a]=Kt(this.child.execute(n,i,s)),l=T.SUCCESS;return this.setLastStatus(n,l),this.name&&C.recordNodeExecution(s,this.name,l,i.gameState.time,this.depth,a),l}finally{this.name&&ot.nodeEnd()}}}class Pr extends Nn{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");De(this,"startTimeKey");this.child=n,this.timeoutDurationHours=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.startTimeKey=`timeout_${this.name}_startTime`}execute(n,i,s){ot.nodeStart(this.name);try{const a=i.gameState.time;let l=C.get(s,this.startTimeKey);const[c,u]=Kt(this.child.execute(n,i,s));if(c===T.RUNNING){l===void 0&&(C.set(s,this.startTimeKey,a),l=a);const f=a-l;if(f>this.timeoutDurationHours){C.delete(s,this.startTimeKey),this.setLastStatus(n,T.FAILURE);const m=`Timed out after ${f.toFixed(2)}h.`;return C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m),this.getLastStatus(n)}this.setLastStatus(n,T.RUNNING);const p=`Running for ${f.toFixed(2)}h. ${u}`;return C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,p),this.getLastStatus(n)}return l!==void 0&&C.delete(s,this.startTimeKey),this.setLastStatus(n,c),C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{ot.nodeEnd()}}}class Gn extends Nn{constructor(n,i,s,a=0,l){super();De(this,"name");De(this,"depth");De(this,"statusKey");De(this,"timestampKey");this.child=n,this.cacheDurationHours=i,this.validityCheck=l,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.statusKey=`caching_${this.name}_status`,this.timestampKey=`caching_${this.name}_timestamp`}execute(n,i,s){ot.nodeStart(this.name);try{const a=i.gameState.time,l=C.get(s,this.statusKey),c=C.get(s,this.timestampKey);if(l!==void 0&&c!==void 0){const m=a-c>this.cacheDurationHours,S=this.validityCheck?this.validityCheck(n,i,s):!0;if(!m&&S){const v=(c+this.cacheDurationHours-a).toFixed(2),I=`Cache hit. Status: ${T[l]}. ${v}h left.`;return this.setLastStatus(n,l),C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,I),this.getLastStatus(n)}}const[u,f]=Kt(this.child.execute(n,i,s));(u===T.SUCCESS||u===T.FAILURE)&&(C.set(s,this.statusKey,u),C.set(s,this.timestampKey,a)),this.setLastStatus(n,u);const p=`Cache miss. Child returned ${T[u]}. ${f}`;return C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,p),this.getLastStatus(n)}finally{ot.nodeEnd()}}}class ma extends Nn{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");De(this,"cooldownKey");this.cooldownDurationHours=n,this.child=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.cooldownKey=`cooldown_${this.name}`}execute(n,i,s){ot.nodeStart(this.name);try{const a=i.gameState.time,l=C.get(s,this.cooldownKey);if(this.child.getLastStatus(n)===T.RUNNING){const[f,p]=Kt(this.child.execute(n,i,s));if(this.setLastStatus(n,f),this.name){const m=`Continuing running child. ${p}`;C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,m)}return this.getLastStatus(n)}if(l!==void 0&&a<l){const p=`Cooldown active, ${(l-a).toFixed(2)}h left`;return this.setLastStatus(n,T.FAILURE),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,p),this.getLastStatus(n)}const[c,u]=Kt(this.child.execute(n,i,s));return c===T.SUCCESS&&C.set(s,this.cooldownKey,a+this.cooldownDurationHours),this.setLastStatus(n,c),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),a,this.depth,u),this.getLastStatus(n)}finally{ot.nodeEnd()}}}class Rn extends Nn{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");this.child=n,this.behaviorKey=i,this.name=s,this.depth=a;const l=(c,u)=>{c.depth=u,c.children?c.children.forEach(f=>l(f,u+1)):c.child&&l(c.child,u+1)};l(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{if(n.isPlayer&&!i.gameState.autopilotControls.behaviors[this.behaviorKey]){const u=`Player autopilot for '${this.behaviorKey}' is disabled.`;return this.setLastStatus(n,T.FAILURE),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,u),this.getLastStatus(n)}const[l,c]=Kt(this.child.execute(n,i,s));return this.setLastStatus(n,l),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,c),this.getLastStatus(n)}finally{this.name&&ot.nodeEnd()}}}class XP extends Nn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,c)=>{l.depth=c,l.children?l.children.forEach(u=>a(u,c+1)):l.child&&a(l.child,c+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{if(n.isPlayer&&i.gameState.autopilotControls.isManuallyMoving)return this.setLastStatus(n,T.FAILURE),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Manual movement active, AI blocked."),this.getLastStatus(n);const[a,l]=Kt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&ot.nodeEnd()}}}class Ss extends Nn{constructor(n,i,s=0){super();De(this,"name");De(this,"depth");this.child=n,this.name=i,this.depth=s;const a=(l,c)=>{l.depth=c,l.children?l.children.forEach(u=>a(u,c+1)):l.child&&a(l.child,c+1)};a(this.child,(this.depth??0)+1)}execute(n,i,s){this.name&&ot.nodeStart(this.name);try{if(n.isPlayer)return this.setLastStatus(n,T.FAILURE),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,"Player controlled, AI blocked."),this.getLastStatus(n);const[a,l]=Kt(this.child.execute(n,i,s));return this.setLastStatus(n,a),this.name&&C.recordNodeExecution(s,this.name,this.getLastStatus(n),i.gameState.time,this.depth,l),this.getLastStatus(n)}finally{this.name&&ot.nodeEnd()}}}class bi extends Nn{constructor(n,i,s,a=0){super();De(this,"name");De(this,"depth");De(this,"registeredKey");this.child=n,this.config=i,this.name=s,this.depth=a,this.child.depth=(this.depth??0)+1,this.registeredKey=`${this.name}_registered`}execute(n,i,s){ot.nodeStart(this.name);try{const a=$t(n,i.gameState);if(!a||!a.aiBlackboard){const[I,A]=Kt(this.child.execute(n,i,s));return this.setLastStatus(n,I),C.recordNodeExecution(s,this.name,I,i.gameState.time,this.depth,`No coordination: ${A}`),I}const l=i.gameState.time,c=C.get(s,this.registeredKey)??!1,u=this.getTaskTarget(n,i,s);if(!u)return this.setLastStatus(n,T.FAILURE),C.recordNodeExecution(s,this.name,T.FAILURE,l,this.depth,"No task target found"),T.FAILURE;const f=this.getTaskKey(u);if(c){const[I,A]=Kt(this.child.execute(n,i,s));return I===T.RUNNING?(this.refreshTaskTimestamp(a.aiBlackboard,f,n.id,l),this.setLastStatus(n,I),C.recordNodeExecution(s,this.name,I,l,this.depth,`Continuing: ${A}`),I):(this.removeFromTask(a.aiBlackboard,f,n.id),C.delete(s,this.registeredKey),this.setLastStatus(n,I),C.recordNodeExecution(s,this.name,I,l,this.depth,`Completed: ${A}`),I)}if(!this.canJoinTask(a.aiBlackboard,f,n.id,l)){this.setLastStatus(n,T.FAILURE);const I=C.get(a.aiBlackboard,f),A=(I==null?void 0:I.memberIds.length)??0,_=this.config.maxCapacity??1;return C.recordNodeExecution(s,this.name,T.FAILURE,l,this.depth,`Task full: ${A}/${_}`),T.FAILURE}if(!this.registerTask(a.aiBlackboard,f,n.id,l))return this.setLastStatus(n,T.FAILURE),C.recordNodeExecution(s,this.name,T.FAILURE,l,this.depth,"Failed to register task"),T.FAILURE;C.set(s,this.registeredKey,!0);const[S,v]=Kt(this.child.execute(n,i,s));if(S===T.RUNNING){this.setLastStatus(n,S);const I=C.get(a.aiBlackboard,f),A=(I==null?void 0:I.memberIds.length)??0,_=this.config.maxCapacity??1;return C.recordNodeExecution(s,this.name,S,l,this.depth,`Started (${A}/${_}): ${v}`),S}else return this.removeFromTask(a.aiBlackboard,f,n.id),C.delete(s,this.registeredKey),this.setLastStatus(n,S),C.recordNodeExecution(s,this.name,S,l,this.depth,`Immediate result: ${v}`),S}finally{ot.nodeEnd()}}getTaskTarget(n,i,s){var l,c,u,f;if(this.config.taskType==="procreation")return((c=(l=this.config).getTargetId)==null?void 0:c.call(l,n,i,s))??null;const a=(f=(u=this.config).getTargetId)==null?void 0:f.call(u,n,i,s);return a??null}getTaskKey(n){return this.config.generateTaskKey?this.config.generateTaskKey(this.config.taskType,n):`tribal_${this.config.taskType}_${n}`}canJoinTask(n,i,s,a){const l=C.get(n,i);if(!l||a-l.startTime>Oi||l.memberIds.includes(s))return!0;const c=this.config.maxCapacity??1;return l.memberIds.length<c}registerTask(n,i,s,a){let l=C.get(n,i);return l?a-l.startTime>Oi?(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},C.set(n,i,l),!0):l.memberIds.length>=(this.config.maxCapacity??1)?!!l.memberIds.includes(s):(l.memberIds.includes(s)||(l.memberIds.push(s),C.set(n,i,l)),!0):(l={memberIds:[s],startTime:a,maxCapacity:this.config.maxCapacity??1},C.set(n,i,l),!0)}refreshTaskTimestamp(n,i,s,a){const l=C.get(n,i);l&&l.memberIds.includes(s)&&(l.startTime=a,C.set(n,i,l))}removeFromTask(n,i,s){const a=C.get(n,i);a&&(a.memberIds=a.memberIds.filter(l=>l!==s),a.memberIds.length===0?C.delete(n,i):C.set(n,i,a))}}function VP(e){return new Ae([new fe((t,n)=>{const i=t.hunger>=Qs,s=t.food.length>0,a=!t.eatingCooldownTime||n.gameState.time>=t.eatingCooldownTime;return[!!(i&&s&&a),`${Math.floor(t.hunger-Qs)}, ${t.food.length}, ${t.eatingCooldownTime?Math.floor(t.eatingCooldownTime-n.gameState.time):""}`]},"Can Eat",e+1),new se(t=>(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",T.RUNNING),"Eat",e+1)],"Eating",e)}const Kh=30,KP=.4,qP=24,eI=50,ZP=100,QP=160,JP=72,tI=10,Ig=5,eD=10,tD=15,Ip=5,Tp=5,Ep=5;function an(e,t,n){return Tu(e,n)?e.tribeRole===t:!0}function Tu(e,t){if(!e.leaderId)return!1;const n=t.entities.entities[e.leaderId];return!n||!n.tribeControl?!1:t.search.human.byProperty("leaderId",n.id).filter(s=>s.isAdult).length>=eD}function nD(e){return new Ae([new fe((n,i)=>{if(!!!n.leaderId||!Tu(n,i.gameState))return!1;const a=n.id===n.leaderId,l=an(n,J.Warrior,i.gameState)||an(n,J.Hunter,i.gameState),c=!n.isAdult&&(!n.fatherId||!i.gameState.entities.entities[n.fatherId])&&(!n.motherId||!i.gameState.entities.entities[n.motherId]);return a||l||c},"Demand eligible?",e+1),new se((n,i)=>{const s=$t(n,i.gameState);if(!s||!s.aiBlackboard)return[T.NOT_EVALUATED,"No leader for coordination"];if(n.food.length<n.maxFood*.5){ZA(s.aiBlackboard,n.id,"food",i.gameState.time);const a=JA(s.aiBlackboard,n.id,"food");if(a&&a.claimedBy){const l=i.gameState.entities.entities[a.claimedBy];if(!l||l.type!=="human")return[T.NOT_EVALUATED,"Supplier not found or invalid"];const c=U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height);return c>Y_?[T.NOT_EVALUATED,`Supplier too far (${c.toFixed(1)}px), waiting`]:c<=je?(n.activeAction="retrieving",n.target=l.id,[T.RUNNING,`Retrieving from supplier ${l.id}`]):(n.target=l.id,n.activeAction="moving",[T.RUNNING,`Moving to supplier ${l.id}, distance: ${c.toFixed(1)}`])}return[T.NOT_EVALUATED,"Waiting for supplier"]}return[T.NOT_EVALUATED,"No demand needed"]},"Create Demand",e+1)],"Demand",e)}const iD=20,qt=30,oD=.5,rD=.3,sD=2,aD=50,Tg=400,lD=25;function TS(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function cD(e,t,n=Tg){return t.search.building.byRadius(e.position,n).some(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed&&l.storageCapacity&&l.storedItems.length<l.storageCapacity})}function dD(e,t,n=Tg,i,s){return t.search.building.byRadius(e.position,n).filter(c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===e.leaderId&&u.isConstructed&&u.storedItems.filter(f=>f.item.itemType==="food").length>0}).filter(c=>{if(i){const u=`tribal_storage_${c.id}`,f=C.get(i,u);if(f&&f.memberIds.length>=vg&&(!s||!f.memberIds.includes(s)))return!1}return!0})}function uD(e,t,n=Tg){return t.search.building.byRadius(e.position,n).filter(a=>{const l=a;return l.buildingType==="storageSpot"&&l.ownerId===e.leaderId&&l.isConstructed})}function nI(e,t,n){if(t.length===0)return null;let i=null,s=1/0;for(const a of t){const l=U(e.position,a.position,n.mapDimensions.width,n.mapDimensions.height);l<s&&(s=l,i=a)}return i?{storage:i,distance:s}:null}function iI(e){const t=e.storedItems.length,n=TS(t+e.id)*2*Math.PI,i=TS(t+e.id+1)*lD;return{x:Math.cos(n)*i,y:Math.sin(n)*i}}const ES="FINDING_DEMAND",CS="RETRIEVING_FROM_STORAGE",_S="DELIVERING_TO_DEMANDER",Bd="supply_phase",Cp="supply_targetDemanderId",oI="supply_targetStorageId",Fd="supply_targetResourceType";function _i(e){e.aiBlackboard&&(C.delete(e.aiBlackboard,Bd),C.delete(e.aiBlackboard,Cp),C.delete(e.aiBlackboard,oI),C.delete(e.aiBlackboard,Fd))}function fD(e){return new se((t,n)=>{var a;if(!Tu(t,n.gameState))return _i(t),[T.FAILURE,"Tribe roles not effective"];if(!an(t,J.Mover,n.gameState))return _i(t),[T.FAILURE,"Not a Mover"];const i=$t(t,n.gameState);if(!i||!i.aiBlackboard)return _i(t),[T.FAILURE,"No leader or blackboard"];if(!t.aiBlackboard)return[T.FAILURE,"No AI blackboard"];const s=C.get(t.aiBlackboard,Bd)||ES;if(s===ES){const l=$P(i.aiBlackboard).filter(f=>f.requesterId!==t.id);if(l.length===0)return[T.FAILURE,"No unclaimed demands"];const c=l[0];return GP(i.aiBlackboard,c.requesterId,c.resourceType,t.id,n.gameState.time)?(C.set(t.aiBlackboard,Cp,c.requesterId),C.set(t.aiBlackboard,Fd,c.resourceType),C.set(t.aiBlackboard,Bd,CS),[T.RUNNING,`Claimed ${c.resourceType} demand for ${c.requesterId}, moving to retrieval phase`]):(_i(t),[T.FAILURE,"Failed to claim demand"])}if(s===CS){const l=C.get(t.aiBlackboard,Fd),c=l==="food"&&t.food.length>0,u=l==="wood"&&((a=t.heldItem)==null?void 0:a.type)===mt.Wood;if(c||u)return C.set(t.aiBlackboard,Bd,_S),[T.RUNNING,`${l} retrieved, moving to delivery phase`];const f=uD(t,n.gameState,400).filter(v=>l==="food"?v.storedItems.some(I=>I.item.itemType==="food"):l==="wood"?v.storedItems.some(I=>I.item.type===mt.Wood):!1);if(f.length===0)return[T.FAILURE,`No storage with ${l} found nearby`];const p=nI(t,f,n.gameState);if(!p)return _i(t),[T.FAILURE,"Could not find closest storage"];const{storage:m,distance:S}=p;return C.set(t.aiBlackboard,oI,m.id),S<=qt?(t.activeAction="retrieving",t.target=m.id,[T.RUNNING,`Retrieving from storage ${m.id}`]):(t.target=m.id,t.activeAction="moving",[T.RUNNING,`Moving to storage ${m.id}, distance: ${S.toFixed(1)}`])}if(s===_S){const l=C.get(t.aiBlackboard,Fd)||"food",c=C.get(t.aiBlackboard,Cp);if(!c)return _i(t),[T.FAILURE,"Demander ID not found in blackboard"];const u=JA(i.aiBlackboard,c,l);if(!u||u.claimedBy!==t.id)return _i(t),[T.FAILURE,"Demand not found"];const f=n.gameState.entities.entities[c];if(!f)return _i(t),[T.FAILURE,"Demander not found"];if(l==="food"?t.food.length===0:!t.heldItem)return _i(t),[T.SUCCESS,`Successfully delivered ${l} to ${c}`];const m=U(t.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),S=f.type==="building"&&f.buildingType===de.Bonfire?qt:je;return m<=S?(t.activeAction="depositing",l==="food"&&(t.activeActionPayload={amount:Math.min(f.maxFood/2||1,t.food.length||1)}),t.target=f.id,[T.RUNNING,`Delivering to demander ${f.id}`]):(t.target=f.id,t.activeAction="moving",[T.RUNNING,`Moving to demander ${f.id}, distance: ${m.toFixed(1)}`])}return _i(t),[T.FAILURE,"Unknown supply phase"]},"Supply",e)}function hD(e){return new Ae([new fe((t,n,i)=>{if(t.isAdult&&t.hitpoints>t.maxHitpoints*Nv||!(t.hitpoints<t.maxHitpoints*.1)&&t.isAdult&&t.hunger>HC)return!1;const a=MD(t.id,n.gameState);return a?(C.set(i,"fleeThreat",a.id),!0):!1},"Should Flee",e+1),new se((t,n,i)=>{const s=C.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;t.activeAction="moving";const l=Xe(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=rt(l),u=hi(t.position,Et(c,i_));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,T.RUNNING},"Execute Flee",e+1)],"Flee",e)}const vr="resourceSource";function pD(e){const t=new se((i,s,a)=>{const l=$t(i,s.gameState),c=l?Fl(l.id,s.gameState):0,u=i.hunger>Hy,f=Pn(s.gameState,i).filter(A=>A.hunger>ea),p=u||f.length>0,m=an(i,J.Gatherer,s.gameState),S=()=>{const A=Be(i,s.gameState,"berryBush",bh,P=>{if(P.food.length===0||i.leaderId&&!io(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${P.id}`,w=C.get(l.aiBlackboard,R);if(w&&s.gameState.time-w.startTime<=Oi&&!w.memberIds.includes(i.id))return!1}return!0}),_=Be(i,s.gameState,"corpse",bh,P=>{if(P.food.length===0||i.leaderId&&!io(P.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const R=`tribal_gather_${P.id}`,w=C.get(l.aiBlackboard,R);if(w&&s.gameState.time-w.startTime<=Oi&&!w.memberIds.includes(i.id))return!1}return!0});if(A&&_){const P=U(i.position,A.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height),R=U(i.position,_.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);return P<=R?A:_}return A||_},v=()=>Be(i,s.gameState,"tree",bh,A=>{var _;if(((_=A.stateMachine)==null?void 0:_[0])!==Ht||A.wood.length===0||i.leaderId&&!io(A.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const P=`tribal_gather_${A.id}`,R=C.get(l.aiBlackboard,P);if(R&&s.gameState.time-R.startTime<=Oi&&!R.memberIds.includes(i.id))return!1}return!0});let I=null;return p&&i.food.length<i.maxFood?I=S():c>0&&!i.heldItem?I=v():m&&(i.heldItem||(I=v()),!I&&i.food.length<i.maxFood&&(I=S())),I?(C.set(a,vr,I.id),[T.SUCCESS,`Found ${I.type}: ${I.id} at ${I.position.x.toFixed(0)},${I.position.y.toFixed(0)}`]):[T.FAILURE,"No resource found"]},"Find Closest Resource Source",e+4),n=new bi(new se((i,s,a)=>{const l=C.get(a,vr);if(!l)return[T.FAILURE,"No target in blackboard"];const c=s.gameState.entities.entities[l];return c?(c.type==="tree"&&"wood"in c?c.wood.length===0:c.food.length===0)?(C.delete(a,vr),[T.FAILURE,"Resource source is depleted"]):U(i.position,c.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Hr?(i.activeAction="gathering",i.direction={x:0,y:0},i.target=c.id,C.delete(a,vr),[T.SUCCESS,`Gathering from ${c.type}`]):(i.activeAction="moving",i.target=c.id,i.direction=We(i.position,c.position,s.gameState.mapDimensions),[T.RUNNING,`Moving to ${c.type}`]):(C.delete(a,vr),[T.FAILURE,"Resource source is invalid"])},"Move To Resource and Gather",e+3),{taskType:"gather",maxCapacity:2,getTargetId:(i,s,a)=>C.get(a,vr)??null},"Tribal Gather Task",e+3);return new Ae([new fe((i,s)=>{const a=$t(i,s.gameState),l=a?Fl(a.id,s.gameState):0,c=i.food.length<i.maxFood,u=!i.heldItem,f=i.hunger>Hy,p=Pn(s.gameState,i).filter(A=>A.hunger>ea),m=an(i,J.Gatherer,s.gameState),S=cD(i,s.gameState),v=c&&(f||p.length>0||m&&S),I=u&&(l>0||m&&S);return[(i.isAdult&&(v||I))??!1,`${f?"Hungry ":""}${p.length>0?"Children("+p.length+") ":""}${l>0?"WoodNeed("+l+") ":""}${I&&l<=0?"Wood ":""}${S?"Storage":""}`]},"Should Gather Resources",e+1),new ln([new Ae([new fe((i,s,a)=>C.has(a,vr),"Has Resource Source?",e+2),n],"Continue Gathering Action",e+2),new Ae([new Gn(t,YC,"Cache Resource Source Search",e+3),n],"Find New Resource Source and Gather",e+2)],"Perform or Start Gathering",e+1)],"Gather Resources",e)}const gD=.5;function mD(e){return new se((t,n,i)=>{const{gameState:s}=n,{width:a,height:l}=s.mapDimensions;let c=C.get(i,"wanderTarget");const u=C.get(i,"lastWanderTime")??0,f=s.time;if(!c||f-u>gD||U(t.position,c,a,l)<20){const m=og(t.position,BC,a,l);t.leaderId?Ap(m,t.leaderId,s)?c=m:c=Bw(t.position,m,t.leaderId,s):c=m,C.set(i,"wanderTarget",c),C.set(i,"lastWanderTime",f)}if(c&&U(t.position,c,a,l)>10){t.activeAction="moving",t.target=c;let S=c.x-t.position.x,v=c.y-t.position.y;return Math.abs(S)>a/2&&(S=S>0?S-a:S+a),Math.abs(v)>l/2&&(v=v>0?v-l:v+l),t.direction=rt({x:S,y:v}),T.RUNNING}return t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,T.SUCCESS},"Idle/Wander",e)}const Sd="procreationWanderStartTime",wS=(e,t,n)=>t.find(i=>er(e,i,n)),RS={taskType:"procreation",maxCapacity:2,getTargetId:(e,t,n)=>C.get(n,"procreationPartner")??null};function yD(e){const t=new fe((a,l,c)=>{const u=FS(a,l.gameState,Hr),f=wS(a,u,l.gameState);return f?(C.set(c,"procreationPartner",f.id),!0):[!1,"No immediate partner found"]},"Find Immediate Partner"),n=new bi(new se((a,l,c)=>{var p;const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=void 0,C.delete(c,"procreationPartner"),C.delete(c,Sd),(p=a.partnerIds)!=null&&p.includes(f.id)||(a.partnerIds=a.partnerIds?[...a.partnerIds,f.id]:[f.id]),T.SUCCESS):T.FAILURE},"Start Procreating"),RS,"Tribal Start Procreating",e+2),i=new fe((a,l,c)=>{const u=FS(a,l.gameState,UC),f=wS(a,u,l.gameState);return f?(C.set(c,"procreationPartner",f.id),!0):[!1,"No distant partner found"]},"Locate Distant Partner"),s=new bi(new se((a,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return[T.FAILURE,"No partner found"];if(f.isPregnant)return[T.FAILURE,"Partner is pregnant"];if(a.hunger>on)return[T.FAILURE,"Too hungry to procreate"];const p=U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);if(p<Hr)return[T.SUCCESS,"Reached partner"];if(a.leaderId&&!io(f.position,a.leaderId,l.gameState))return[T.FAILURE,"Partner out of operating range"];a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=rt(m),[T.RUNNING,`${p.toFixed(1)} units away`]},"Move Towards Partner"),RS,"Tribal Move To Partner",e+3);return new Ae([new fe(a=>!a.isAdult||a.gender==="female"&&a.isPregnant?[!1,"Not adult or pregnant"]:a.age<kl||a.gender==="female"&&a.age>uu?[!1,"Not fertile due to age or pregnancy status"]:a.hunger>=on?[!1,"Too hungry"]:!0,"Is Fertile (age, not pregnant)",e+1),new fe(a=>a.hunger<on,"Is Healthy (hunger)",e+1),new fe(a=>(a.procreationCooldown||0)<=0,"Is Ready (cooldown)",e+1),new ln([new Ae([new fe((a,l)=>{const c=DS(a.position,l.gameState,"berryBush",Gy);return[c>=LC,`Found ${c} bushes`]},"Is Environment Viable (food)",e+3),new se((a,l,c)=>(C.delete(c,Sd),T.SUCCESS),"Clear Wander Timer",e+3)],"Sufficient Food Path",e+2),new Ae([new fe((a,l)=>{const c=Pn(l.gameState,a);return Wr(c)?[!1,"Has an heir"]:!0},"Is Male Without Heir",e+3),new se((a,l,c)=>{const u=C.get(c,Sd);if(u===void 0)return C.set(c,Sd,l.gameState.time),[T.FAILURE,"Starting heirless wander timer"];const f=l.gameState.time-u;return f>=__?DS(a.position,l.gameState,"berryBush",Gy)>=1?[T.SUCCESS,`Wandered for ${f.toFixed(1)}h, minimum food found`]:[T.FAILURE,"Desperate but no food sources nearby"]:[T.FAILURE,`Wandering for heir, ${f.toFixed(1)}h elapsed`]},"Check Wander Timer",e+3)],"Heirless Desperation Path",e+2)],"Check Environment Or Desperation",e+1),new fe((a,l,c)=>{var f;const u=C.get(c,"procreationPartner");return u&&((f=u.partnerIds)!=null&&f.length)&&!u.partnerIds.includes(a.id)&&a.leaderId!==a.id&&a.leaderId&&u.partnerIds.map(p=>l.gameState.entities.entities[p]).filter(p=>!!p).some(p=>U(a.position,p.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<t_)?[!1,"Partner's primary partner is too close"]:!0},"Is Partner's Primary Partner Nearby",e+1),new ln([new Ae([t,n],"Procreate With Immediate Partner",e+2),new ma(xC,new Ae([i,s,n],"Seek Distant Partner Action",e+3),"Seek Distant Partner Cooldown",e+2)],"Find Partner And Procreate",e+1)],"Procreate",e)}const vs="attackTarget",Ar="homeCenter",qh=150;function SD(e){return new Ae([new fe((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.hitpoints>0&&U(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=qh){if(C.set(i,vs,l.id),!C.get(i,Ar)){const c=t.leaderId?ao(t.leaderId,s):Wl(t,s).length>0?Zy(t,s):t.position;C.set(i,Ar,c)}return!0}}if(!an(t,J.Warrior,s))return[!1,"Not a Warrior"];const a=Be(t,s,"human",qh,l=>l.hitpoints>0&&fa(t,l,s));if(a){C.set(i,vs,a.id);const l=t.leaderId?ao(t.leaderId,s):Wl(t,s).length>0?Zy(t,s):t.position;return C.set(i,Ar,l),!0}return C.set(i,vs,void 0),C.set(i,Ar,void 0),!1},"Find Attack Target",e+1),new se((t,n,i)=>{const s=C.get(i,vs),a=s&&n.gameState.entities.entities[s],l=C.get(i,Ar);if(!a||!l)return T.FAILURE;const{gameState:c}=n;return U(t.position,l,c.mapDimensions.width,c.mapDimensions.height)>Dv?(t.activeAction="idle",t.attackTargetId=void 0,C.set(i,vs,void 0),C.set(i,Ar,void 0),T.FAILURE):a.hitpoints<=0||U(t.position,a.position,c.mapDimensions.width,c.mapDimensions.height)>qh?(t.activeAction==="attacking"&&(t.activeAction="idle",t.attackTargetId=void 0),C.set(i,vs,void 0),C.set(i,Ar,void 0),T.SUCCESS):(t.activeAction==="attacking"&&t.attackTargetId===a.id||(t.activeAction="attacking",t.attackTargetId=a.id),T.RUNNING)},"Execute Attack",e+1)],"Attack",e)}const vD=(e,t,n)=>{const i=Pn(t.gameState,e).filter(l=>!l.isAdult);if(i.length===0)return T.FAILURE;let s=null,a=ea;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(C.set(n,"targetChild",s.id),T.SUCCESS):T.FAILURE},AD=(e,t,n)=>{const i=C.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>fu?(e.activeAction="moving",e.target=s.id,e.direction=We(e.position,s.position,t.gameState.mapDimensions),T.RUNNING):(e.activeAction="feeding",e.target=void 0,C.set(n,"targetChild",void 0),T.SUCCESS):T.FAILURE};function ID(e){return new Ae([new fe(t=>(t.isAdult&&t.food.length>0&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child",e+1),new se(vD,"Find Hungriest Child",e+1),new se(AD,"Move To Child and Feed",e+1)],"Feed Child",e)}function TD(e){return new Ae([new fe(t=>!t.isAdult&&t.hunger>=ea,"Is Hungry Child",e+1),new se((t,n,i)=>{const s=KM(t,n.gameState);if(s.length===0)return T.FAILURE;const a=Be(t,n.gameState,"human",N_,l=>s.some(c=>c.id===l.id)&&l.food.length>0);return a?(C.set(i,"targetParent",a.id),T.SUCCESS):T.FAILURE},"Find Parent With Food",e+1),new se((t,n,i)=>{const s=C.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=fu?(t.target=void 0,T.SUCCESS):(t.target=a.id,t.activeAction="moving",T.RUNNING)},"Move To Parent",e+1)],"Seek Food From Parent",e)}const Ir="plantingSpot",As="plantingZoneId",ED=50;function CD(e,t,n,i){const s=Xe(e,t,n,i);return hi(e,s)}function _D(e){const t=new se((s,a,l)=>{const c=C.get(l,Ir);if(!c)return C.delete(l,Ir),C.delete(l,As),[T.FAILURE,"Planting spot is missing"];if(ki(a.gameState.soilDepletion,c,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height))return C.delete(l,Ir),C.delete(l,As),[T.FAILURE,"Soil is depleted at planting spot"];if(xn(c,a.gameState,qo,s.id))return C.delete(l,Ir),C.delete(l,As),[T.FAILURE,"Planting spot is occupied"];const u=CD(s.position,c,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height),f=U(s.position,u,a.gameState.mapDimensions.width,a.gameState.mapDimensions.height);return f>Hr?(s.activeAction="moving",s.target=u,s.direction=We(s.position,u,a.gameState.mapDimensions),[T.RUNNING,"Moving to planting spot: "+f.toFixed(2)+" units away"]):xn(c,a.gameState,qo,s.id)?(C.delete(l,Ir),C.delete(l,As),[T.FAILURE,"Planting spot is now occupied"]):(s.activeAction="planting",s.target=c,[T.RUNNING,"Planting state initiated"])},"Move To Spot and Plant",e+4),n=new bi(t,{taskType:"plant",maxCapacity:2,proximityRadius:ED,getTargetId:(s,a,l)=>C.get(l,As)??null},"Coordinated Planting",e+3),i=new se((s,a,l)=>{const c=Yw(s,a.gameState);return c?(C.set(l,Ir,c.position),C.set(l,As,c.zoneId),[T.SUCCESS,`Found new spot at ${c.position.x.toFixed(0)}, ${c.position.y.toFixed(0)} (Zone ${c.zoneId})`]):[T.FAILURE,"No suitable planting spot found"]},"Find Optimal Planting Spot",e+3);return new Ae([new fe((s,a)=>{if(!an(s,J.Planter,a.gameState))return[!1,"Not a Planter"];const l=s.food.filter(f=>f.type===vn.Berry).length>=so,c=s.hunger<OC,u=(s.isAdult&&l&&c)??!1;return[u,u?"Can plant":`Cannot plant: adult=${s.isAdult}, berries=${s.food.filter(f=>f.type===vn.Berry).length}/${so}, hunger=${s.hunger.toFixed(0)}`]},"Can Plant",e+1),new fe((s,a)=>{if(!s.leaderId)return[!1,"No tribe"];const l=Lw(s,a.gameState),{count:c,ratio:u}=fA(s.leaderId,a.gameState);let f;return l<Ov?f=o_:l<kv?f=r_:l<bv?f=s_:f=a_,[u<f||c<=ks,`Food security: ${(l*100).toFixed(0)}%, Bush density: ${u.toFixed(1)}/${f}`]},"Needs More Bushes (Adaptive)",e+1),new fe((s,a)=>{if(!s.leaderId)return[!0,"No tribe coordination needed"];const l=Dn(s,a.gameState),c=gA(s.leaderId,a.gameState,"planting"),u=Math.max(1,Math.ceil(l.length*.3));return[c<u,`Active planters: ${c}/${u}`]},"Not Too Many Planters",e+1),new ln([new Ae([new fe((s,a,l)=>C.has(l,Ir),"Has Planting Spot?",e+2),n],"Continue Planting Action",e+2),new ma(WC,i,"Find Planting Spot Cooldown",e+2)],"Perform or Start Planting",e+1)],"Plant Bush",e)}const PS="lastDepositTime",Is="assignedStorageSpot";function wD(e){return new ln([new Ae([new fe((t,n,i)=>{var c;const s=((c=t.heldItem)==null?void 0:c.type)===mt.Wood;if(!t.isAdult)return[!1,"Not an adult"];if(!t.leaderId)return[!1,"No tribe"];let a=null,l="";if(s)a=Ww(t,n.gameState),l=`Holding wood${a?` (Target: ${a.id})`:""}`;else{if(!an(t,J.Gatherer,n.gameState)&&!an(t,J.Mover,n.gameState)&&!an(t,J.Hunter,n.gameState))return[!1,"Not a Gatherer/Mover/Hunter and not holding wood"];const u=C.get(i,PS)||0,f=n.gameState.time-u;if(f<$y)return[!1,`Cooldown: ${($y-f).toFixed(1)}h remaining`];const p=ag(t.leaderId,n.gameState);let m;p<.3?m=l_:p<.7?m=c_:m=d_;const S=t.food.length/t.maxFood;if(S<=m)return[!1,`Food ${(S*100).toFixed(0)}% < threshold ${(m*100).toFixed(0)}%`];a=pA(t,n.gameState),l=`Storage util: ${(p*100).toFixed(0)}%, Personal: ${(S*100).toFixed(0)}%`}return a?(C.set(i,Is,a.id),[!0,l]):[!1,"No available tribe storage nearby"]},"Check for Excess Food and Storage",e+1),new fe((t,n)=>{if(!t.leaderId)return[!0,"No tribe coordination needed"];const i=gA(t.leaderId,n.gameState,"depositing"),s=Dn(t,n.gameState),a=xr(t.leaderId,n.gameState).length,l=Math.max(2,Math.ceil(s.length*.4)+a);return[i<l,`Active depositors: ${i}/${l}`]},"Not Too Many Depositors",e+1),new bi(new se((t,n,i)=>{var c,u;const s=C.get(i,Is);if(!s)return[T.FAILURE,"No storage assigned"];const a=n.gameState.entities.entities[s];if(!a)return C.delete(i,Is),[T.FAILURE,"Storage entity missing"];if((((c=a.storedItems)==null?void 0:c.length)??0)>=(a.storageCapacity??0))return C.delete(i,Is),[T.FAILURE,"Storage full"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l<=qt){t.activeAction="depositing",t.target=void 0,C.set(i,PS,n.gameState.time),C.delete(i,Is);const f=((u=t.heldItem)==null?void 0:u.type)===mt.Wood;return[T.SUCCESS,f?"Depositing wood":"Depositing food"]}return t.activeAction="moving",t.target=a.position,[T.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`]},"Navigate to Storage and Deposit",e+2),{taskType:"storage",maxCapacity:vg,storageAction:"deposit",getTargetId:(t,n,i)=>C.get(i,Is)??null},"Tribal Storage Deposit Task",e+1)],"Deposit Sequence",e)],"Storage Deposit Behavior",e)}const vd="retrievalStorageId";function RD(e){return new ln([new Ae([new fe((t,n,i)=>{if(t.hunger<=Qs)return[!1,"Not hungry enough"];if(t.food.length>=t.maxFood)return[!1,"Inventory full"];const s=$t(t,n.gameState),a=dD(t,n.gameState,void 0,s==null?void 0:s.aiBlackboard,t.id),l=nI(t,a,n.gameState),c=l==null?void 0:l.storage;return c?(C.set(i,vd,c.id),[!0,`Storage with food found at distance ${l.distance.toFixed(1)}`]):[!1,"No tribe storage with food nearby"]},"Check for Hunger and Storage Food",e+1),new bi(new se((t,n,i)=>{const s=C.get(i,vd);if(!s)return[T.FAILURE,"No storage target"];const a=n.gameState.entities.entities[s];if(!a)return C.delete(i,vd),[T.FAILURE,"Storage not found"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=qt?(t.activeAction="retrieving",t.target=void 0,[T.SUCCESS,"Retrieving food"]):(t.activeAction="moving",t.target=a.position,[T.RUNNING,`Moving to storage (${l.toFixed(1)}px away)`])},"Navigate to Storage and Retrieve",e+2),{taskType:"storage",maxCapacity:vg,storageAction:"retrieve",getTargetId:(t,n,i)=>C.get(i,vd)??null},"Coordinated Storage Retrieve",e+1)],"Retrieve Sequence",e)],"Storage Retrieve Behavior",e)}const Zh="combatTarget",Qh="homeCenter";function PD(e){const t=new fe(a=>a.isAdult&&a.leaderId?a.id!==a.leaderId:!1,"Is Tribe Follower?",e+1),n=new fe(a=>a.hunger<kC&&a.hitpoints>=a.maxHitpoints*Nv,"Is Fit for Combat?",e+1),i=new se((a,l,c)=>{const{gameState:u}=l,f=u.entities.entities[a.leaderId];if(!f)return T.FAILURE;const p=oO(f,u,GC);if(p.length===0)return T.FAILURE;p.sort((m,S)=>{const v=U(a.position,m.position,u.mapDimensions.width,u.mapDimensions.height),I=U(a.position,S.position,u.mapDimensions.width,u.mapDimensions.height);return v-I});for(const m of p)if(rO(f.id,m.id,u)<Pv){C.set(c,Zh,m.id);const v=ao(f.id,u);return C.set(c,Qh,v),T.SUCCESS}return T.FAILURE},"Find Best Target",e+1),s=new se((a,l,c)=>{const u=C.get(c,Zh),f=u&&l.gameState.entities.entities[u],p=C.get(c,Qh);if(!f||!p)return T.FAILURE;const{gameState:m}=l;return U(a.position,p,m.mapDimensions.width,m.mapDimensions.height)>Dv?(a.activeAction==="attacking"&&a.attackTargetId===f.id&&(a.activeAction="idle",a.attackTargetId=void 0),C.set(c,Zh,void 0),C.set(c,Qh,void 0),T.FAILURE):((!a.lastTargetAcquiredEffectTime||l.gameState.time-a.lastTargetAcquiredEffectTime>qe*5)&&(Ge(l.gameState,Ee.TargetAcquired,a.position,qe,a.id),a.lastTargetAcquiredEffectTime=l.gameState.time),a.activeAction="attacking",a.attackTargetId=f.id,a.target=void 0,T.RUNNING)},"Attack Target",e+1);return new Ae([t,n,i,s],"Tribe Member Combat",e)}function DD(e){const t=new fe((O,N)=>!O.leaderId||O.leaderId!==O.id?[!1,"Not a tribe leader"]:Pn(N.gameState,O).length<Ig?[!1,"Leader has no children"]:[!0,"Is tribe leader"],"Is Leader",e+1),n=new se((O,N,M)=>{const F=Dn(O,N.gameState),x=F.filter(z=>z.isAdult),Z=Yr(O.leaderId,N.gameState,!0),te=Vl(O,N.gameState,!0).filter(z=>$w(z,N.gameState)),j=ag(O.leaderId,N.gameState),{count:ie,ratio:re}=fA(O.leaderId,N.gameState),_e=te.length/Math.max(1,F.length),ue=Math.ceil(x.length*(1+f_)),ne=xr(O.leaderId,N.gameState,!0);return C.set(M,"tribeAnalysis_adultCount",x.length),C.set(M,"tribeAnalysis_existingStorageSpots",Z.length),C.set(M,"tribeAnalysis_existingPlantingZones",te.length),C.set(M,"tribeAnalysis_existingBonfires",ne.length),C.set(M,"tribeAnalysis_storageUtilization",j),C.set(M,"tribeAnalysis_bushCount",ie),C.set(M,"tribeAnalysis_bushDensity",re),C.set(M,"tribeAnalysis_zoneDensity",_e),C.set(M,"tribeAnalysis_projectedAdultCount",ue),[T.SUCCESS,`Analyzed tribe: ${x.length} adults, ${Z.length} storage, ${te.length} viable planting zones, ${ne.length} bonfires`]},"Analyze Tribe",e+1),i=new Gn(n,1,"Cached Tribe Analysis",e+1),s=new fe((O,N,M)=>{const F=C.get(M,"tribeAnalysis_adultCount");return F===void 0?[!1,"No tribe analysis available"]:F<xy?[!1,`Tribe too small: ${F}/${xy} adults`]:[!0,`Tribe size sufficient: ${F} adults`]},"Has Minimum Tribe Size",e+1),a=new fe((O,N,M)=>{if(C.has(M,"buildingPlacement_storageTarget"))return[!0,"Placement already in progress"];const F=C.get(M,"tribeAnalysis_adultCount"),x=C.get(M,"tribeAnalysis_existingStorageSpots"),Z=C.get(M,"tribeAnalysis_storageUtilization"),te=C.get(M,"tribeAnalysis_projectedAdultCount");if(F===void 0||x===void 0||Z===void 0||te===void 0)return[!1,"No tribe analysis available"];const j=x===0,ie=Z*(te/Math.max(1,F));return j||Z>gp||ie>gp?[!0,j?"Bootstrap: First storage spot":`Utilization: ${(Z*100).toFixed(0)}% (projected: ${(ie*100).toFixed(0)}%)`]:[!1,`Storage adequate: ${x}, util: ${(Z*100).toFixed(0)}%`]},"Needs Storage",e+2),l=new se((O,N,M)=>{if(C.has(M,"buildingPlacement_storageTarget"))return[T.SUCCESS,"Using existing storage placement target"];const F=C.get(M,"tribeAnalysis_existingStorageSpots");if(F===void 0)return[T.FAILURE,"No tribe analysis available"];const Z=F===0?Bv:zs,te=Vs(de.StorageSpot,O.id,N.gameState,Vi,Z,O.position);return te?(C.set(M,"buildingPlacement_storageTarget",te),[T.SUCCESS,`Found storage location at (${te.x.toFixed(0)}, ${te.y.toFixed(0)})`]):[T.FAILURE,`No valid location found for storage within ${Vi}px`]},"Find Storage Location",e+2),c=new se((O,N,M)=>{const F=C.get(M,"buildingPlacement_storageTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const x=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return x<=Ki?[T.SUCCESS,`Reached storage location (${x.toFixed(0)}px away)`]:(O.activeAction="moving",O.target=F,O.direction=We(O.position,F,N.gameState.mapDimensions),[T.RUNNING,`Moving to storage location (${x.toFixed(0)}px away)`])},"Move To Storage Location",e+2),u=new se((O,N,M)=>{const F=C.get(M,"buildingPlacement_storageTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const x=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return x>Ki?[T.FAILURE,`Too far from placement location: ${x.toFixed(0)}px`]:(Xo(F,de.StorageSpot,O.id,N.gameState),C.delete(M,"buildingPlacement_storageTarget"),C.delete(M,"caching_Cached Tribe Analysis_status"),C.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[T.SUCCESS,`Placed storage at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`])},"Place Storage",e+2),f=new Ae([a,l,c,u],"Storage Sequence",e+1),p=new fe((O,N,M)=>{if(!O.leaderId)return[!1,"No tribe"];if(C.has(M,"buildingPlacement_bonfireTarget"))return[!0,"Placement already in progress"];const F=C.get(M,"tribeAnalysis_existingBonfires")||0,x=C.get(M,"tribeAnalysis_adultCount")||0,Z=ao(O.leaderId,N.gameState),te=na(N.gameState.temperature,Z,N.gameState.time,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height),j=te<tA&&F===0,ie=F>0&&F<Math.ceil(x/nA),re=Dn(O,N.gameState),_e=xr(O.leaderId,N.gameState,!0),ue=re.filter(z=>na(N.gameState.temperature,z.position,N.gameState.time,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height)<js+5?_e.every(Y=>U(z.position,Y.position,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height)>Xs*1.5):!1),ne=ue.length>=3;if(j||ie||ne){if(ne){const V=ue.reduce((K,b)=>({x:K.x+b.position.x,y:K.y+b.position.y}),{x:0,y:0});V.x/=ue.length,V.y/=ue.length,C.set(M,"buildingPlacement_coldClusterPos",V)}else C.delete(M,"buildingPlacement_coldClusterPos");let z="";return j?z=`Cold at center: ${te.toFixed(1)}C`:ie?z=`Tribe size: ${x}/${F} fires`:z=`Cold cluster: ${ue.length} members`,[!0,z]}return[!1,`Adequate heating: ${F} fires for ${x} adults`]},"Needs Bonfire",e+2),m=new se((O,N,M)=>{if(C.has(M,"buildingPlacement_bonfireTarget"))return[T.SUCCESS,"Using existing bonfire placement target"];const F=C.get(M,"buildingPlacement_coldClusterPos"),x=Vs(de.Bonfire,O.id,N.gameState,Vi,zs,F||O.position);return x?(C.set(M,"buildingPlacement_bonfireTarget",x),[T.SUCCESS,`Found bonfire location at (${x.x.toFixed(0)}, ${x.y.toFixed(0)})`]):[T.FAILURE,`No valid location found for bonfire within ${Vi}px`]},"Find Bonfire Location",e+2),S=new se((O,N,M)=>{const F=C.get(M,"buildingPlacement_bonfireTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const x=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return x<=Ki?[T.SUCCESS,`Reached bonfire location (${x.toFixed(0)}px away)`]:(O.activeAction="moving",O.target=F,O.direction=We(O.position,F,N.gameState.mapDimensions),[T.RUNNING,`Moving to bonfire location (${x.toFixed(0)}px away)`])},"Move To Bonfire Location",e+2),v=new se((O,N,M)=>{const F=C.get(M,"buildingPlacement_bonfireTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const x=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return x>Ki?[T.FAILURE,`Too far from placement location: ${x.toFixed(0)}px`]:(Xo(F,de.Bonfire,O.id,N.gameState),C.delete(M,"buildingPlacement_bonfireTarget"),C.delete(M,"caching_Cached Tribe Analysis_status"),C.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[T.SUCCESS,`Placed bonfire at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`])},"Place Bonfire",e+2),I=new Ae([p,m,S,v],"Bonfire Sequence",e+1),A=new fe((O,N,M)=>{if(C.has(M,"buildingPlacement_plantingTarget"))return[!0,"Placement already in progress"];const F=C.get(M,"tribeAnalysis_adultCount"),x=C.get(M,"tribeAnalysis_existingPlantingZones"),Z=C.get(M,"tribeAnalysis_bushDensity"),te=C.get(M,"tribeAnalysis_bushCount"),j=C.get(M,"tribeAnalysis_zoneDensity"),ie=C.get(M,"tribeAnalysis_projectedAdultCount");if(F===void 0||x===void 0||Z===void 0||te===void 0||j===void 0||ie===void 0)return[!1,"No tribe analysis available"];const re=Z*(F/Math.max(1,ie)),ue=x===0||Z<mp||re<mp||te<=ks&&x<=ks;return ue&&j>re&&(te>ks||x>ks)?[!1,`Planting zone density (${j.toFixed(2)}) exceeds projected density (${re.toFixed(2)})`]:ue?[!0,`Low bush density: ${Z.toFixed(1)}, count: ${te}/${x} (projected: ${re.toFixed(1)})`]:[!1,`Planting zones adequate: ${x}, density: ${Z.toFixed(1)}`]},"Needs Planting Zone",e+2),_=new se((O,N,M)=>{if(C.has(M,"buildingPlacement_plantingTarget"))return[T.SUCCESS,"Using existing planting zone placement target"];const F=Vs(de.PlantingZone,O.id,N.gameState,Vi,zs,O.position);return F?(C.set(M,"buildingPlacement_plantingTarget",F),[T.SUCCESS,`Found planting zone location at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`]):[T.FAILURE,`No valid location found for planting zone within ${Vi}px`]},"Find Planting Zone Location",e+2),P=new se((O,N,M)=>{const F=C.get(M,"buildingPlacement_plantingTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const x=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return x<=Ki?[T.SUCCESS,`Reached planting zone location (${x.toFixed(0)}px away)`]:(O.activeAction="moving",O.target=F,O.direction=We(O.position,F,N.gameState.mapDimensions),[T.RUNNING,`Moving to planting zone location (${x.toFixed(0)}px away)`])},"Move To Planting Zone Location",e+2),R=new se((O,N,M)=>{const F=C.get(M,"buildingPlacement_plantingTarget");if(!F)return[T.FAILURE,"No target location in blackboard"];const x=U(O.position,F,N.gameState.mapDimensions.width,N.gameState.mapDimensions.height);return x>Ki?[T.FAILURE,`Too far from placement location: ${x.toFixed(0)}px`]:(Xo(F,de.PlantingZone,O.id,N.gameState),C.delete(M,"buildingPlacement_plantingTarget"),C.delete(M,"caching_Cached Tribe Analysis_status"),C.delete(M,"caching_Cached Tribe Analysis_timestamp"),delete M.nodeExecutionData["Cached Tribe Analysis"],[T.SUCCESS,`Placed planting zone at (${F.x.toFixed(0)}, ${F.y.toFixed(0)})`])},"Place Planting Zone",e+2),w=new Ae([A,_,P,R],"Planting Zone Sequence",e+1),B=new ln([f,I,w],"Building Type Selector",e+1);return new Ae([t,i,s,B],"Leader Building Placement",e)}function Be(e,t,n,i,s){const a=t,l=i,c="position"in e&&e.id?e:null,u=c?c.position:e,f=a.search[n].byRadius(u,l);let p=null,m=l;for(const S of f){if(S.id===(c==null?void 0:c.id)||s&&!s(S))continue;const v=U(u,S.position,t.mapDimensions.width,t.mapDimensions.height);v<m&&(m=v,p=S)}return p}function ND(e,t,n,i){return t.search[n].byRadius(e,i)}function DS(e,t,n,i){return ND(e,t,n,i).length}function St(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function MD(e,t){var l;const i=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const c of i){if(c.attackTargetId!==e)continue;const u=U(c.position,((l=t.entities.entities[e])==null?void 0:l.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<a&&(s=c,a=u)}return s}function rI(e){return Object.values(e.entities.entities).filter(t=>t.type==="human")}function OD(e,t,n){const{width:i,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const l of a){const c=U(e,l.position,i,s),u=l.type==="tree"?l.radius*2:l.radius;if(c<u)return l}}function kD(e,t,n,i){const s=rI(i),a={};for(const l of s)!l.leaderId||l.leaderId===t||(a[l.leaderId]||(a[l.leaderId]={sumX:0,sumY:0,count:0}),a[l.leaderId].sumX+=l.position.x,a[l.leaderId].sumY+=l.position.y,a[l.leaderId].count++);for(const l in a){const c=a[l],u={x:c.sumX/c.count,y:c.sumY/c.count};if(U(e,u,i.mapDimensions.width,i.mapDimensions.height)<n)return!0}return!1}const Oo="takeOverBuildingTarget";function bD(e){const t=new Ae([new fe((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=C.get(s,Oo);if(a){const c=i.gameState.entities.entities[a];if(c&&c.type==="building"&&Xt(n,c,i.gameState))return[!0,`Continuing to target building ${a}`];C.delete(s,Oo)}const l=Be(n,i.gameState,"building",Lv,c=>Xt(n,c,i.gameState)&&c.isConstructed);return l?(C.set(s,Oo,l.id),[!0,`Found enemy building at distance ${U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Take Over",e+2),new se((n,i,s)=>{const a=C.get(s,Oo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Xt(n,l,i.gameState)?(C.delete(s,Oo),n.activeAction="idle",n.target=void 0,T.FAILURE):U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<je?(n.activeAction="idle",n.target=void 0,T.SUCCESS):(n.activeAction="moving",n.target=l.id,T.RUNNING)},"Move to Enemy Building",e+2),new se((n,i,s)=>{const a=C.get(s,Oo);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Xt(n,l,i.gameState)?(C.delete(s,Oo),T.FAILURE):(n.activeAction="takingOverBuilding",n.target=l.id,C.delete(s,Oo),T.SUCCESS)},"Initiate Building Takeover",e+2)],"Take Over Building Action",e+1);return new ma(Fv,t,"Take Over Building Cooldown",e)}const NS=2,BD=40,MS=3;function FD(e){const t=new fe(a=>{if(!a.isAdult)return[!1,"Not an adult"];if(a.hunger>jp)return[!1,`Too hungry (${a.hunger.toFixed(1)})`];const l=a.leaderId===a.id,c=a.tribeRole===J.Warrior;return!l&&!c?[!1,`Not a Warrior or Leader (role: ${a.tribeRole||"none"})`]:[!0,l?"Is Leader":"Is Warrior"]},"Is Warrior or Leader",e+1),n=new fe(a=>{var c,u;if(a.leaderId!==a.id)return[!0,"Warrior follows leader strategy"];const l=((u=(c=a.tribeControl)==null?void 0:c.armyControl)==null?void 0:u.expandBorders)??0;return l<NS?[!1,`Expand borders weight too low: ${l}/${NS}`]:[!0,`Expand borders weight: ${l}`]},"Has Expand Borders Weight",e+1),i=new fe((a,l)=>{if(!a.leaderId)return[!1,"No tribe leader"];const u=l.gameState.search.building.byProperty("ownerId",a.leaderId);return u.length===0?[!1,"No territory to expand"]:[!0,`Tribe has ${u.length} buildings`]},"Has Territory",e+1),s=new se((a,l,c)=>{if(!a.leaderId)return[T.FAILURE,"No leader"];const u=l.gameState,f=u.mapDimensions.width,p=u.mapDimensions.height,m=dA(a.position,a.leaderId,u);if(!m)return[T.FAILURE,"Could not find territory edge"];const S=U(a.position,m,f,p);if(S>BD)return a.activeAction="moving",a.target=m,[T.RUNNING,`Approaching territory edge (${S.toFixed(0)}px)`];const I=u.search.building.byProperty("ownerId",a.leaderId),A=Yd(I.map(F=>F.position));C.get(c,"pioneerOrbitDirection")===void 0&&C.set(c,"pioneerOrbitDirection",1);const _=Math.ceil(f/Re),P=Math.ceil(p/Re),R=Mw(a.position),w=[];for(let F=-3;F<=MS;F++)for(let x=-3;x<=MS;x++){if(x===0&&F===0)continue;const Z=((R.x+x)%_+_)%_,te=((R.y+F)%P+P)%P,j=te*_+Z,ie=u.terrainOwnership[j],re=ie!==null&&ua(a.leaderId,ie,u);if(ie!==null&&!re)continue;const _e={x:Z*Re+Re/2,y:te*Re+Re/2};sA(_e,a.leaderId,u,tg,!0,a.leaderId).canPlace&&w.push({pos:_e,gx:Z,gy:te})}if(w.length===0)return C.set(c,"pioneerOrbitDirection",-C.get(c,"pioneerOrbitDirection")),[T.RUNNING,"Blocked, reversing orbit direction"];const B=rt(Xe(A,a.position,f,p)),O=yp(B,C.get(c,"pioneerOrbitDirection")*(Math.PI/2));let N=w[0],M=-1/0;for(const F of w){let x=0;for(let ue=-1;ue<=1;ue++)for(let ne=-1;ne<=1;ne++){if(ne===0&&ue===0)continue;const z=((F.gx+ne)%_+_)%_,V=((F.gy+ue)%P+P)%P;u.terrainOwnership[V*_+z]===a.leaderId&&x++}const Z=rt(Xe(a.position,F.pos,f,p)),te=Hv(Z,O),j=U(A,F.pos,f,p),ie=U(A,a.position,f,p),re=j>ie?1:0,_e=x*2+te*1.5+re*.5;_e>M&&(M=_e,N=F)}return Xo(a.position,de.BorderPost,a.leaderId,u),a.target=N.pos,a.activeAction="moving",[T.RUNNING,"Expanding territory (cell-based)"]},"Pioneer Expansion",e+1);return new Ae([t,n,i,s],"Border Expansion",e)}const ko="removeEnemyBuildingTarget";function LD(e){const t=new Ae([new fe((n,i,s)=>{if(!n.leaderId||n.leaderId!==n.id)return[!1,"Not a tribe leader"];const a=C.get(s,ko);if(a){const c=i.gameState.entities.entities[a];if(c&&c.type==="building"&&Xt(n,c,i.gameState))return[!0,`Continuing to target building ${a}`];C.delete(s,ko)}const l=Be(n,i.gameState,"building",Lv,c=>Xt(n,c,i.gameState)&&c.isConstructed);return l?(C.set(s,ko,l.id),[!0,`Found enemy building at distance ${U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height).toFixed(0)}px`]):[!1,"No enemy buildings found within range"]},"Find Enemy Building to Destroy",e+2),new se((n,i,s)=>{const a=C.get(s,ko);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Xt(n,l,i.gameState)?(C.delete(s,ko),n.activeAction="idle",n.target=void 0,T.FAILURE):U(n.position,l.position,i.gameState.mapDimensions.width,i.gameState.mapDimensions.height)<je?(n.activeAction="idle",n.target=void 0,T.SUCCESS):(n.activeAction="moving",n.target=l.id,T.RUNNING)},"Move to Enemy Building",e+2),new se((n,i,s)=>{const a=C.get(s,ko);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];return!l||l.type!=="building"||!Xt(n,l,i.gameState)?(C.delete(s,ko),T.FAILURE):(n.activeAction="destroyingBuilding",n.target=l.id,C.delete(s,ko),T.SUCCESS)},"Initiate Building Destruction",e+2)],"Remove Enemy Building Action",e+1);return new ma(Fv,t,"Remove Enemy Building Cooldown",e)}function UD(e){return new Ae([new se((t,n,i)=>{const s=qM(t,n.gameState);return s?(C.set(i,"patriarchTarget",s.id),[T.SUCCESS,`Found patriarch: ${s.id}`]):(C.delete(i,"patriarchTarget"),[T.FAILURE,"No patriarch found"])},"Find Patriarch",e+1),new se((t,n,i)=>{const s=C.get(i,"patriarchTarget"),a=s&&n.gameState.entities.entities[s];if(!a)return[T.FAILURE,"Patriarch target missing from blackboard"];const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(l>FC){t.activeAction="moving",t.target=a.id;const c=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(c),[T.RUNNING,`Moving to patriarch at ${l.toFixed(0)}`]}return t.activeAction="idle",t.target=void 0,t.direction={x:0,y:0},[T.SUCCESS,`Arrived at patriarch at ${l.toFixed(0)}`]},"Move Towards Patriarch",e+1)],"Follow Patriarch",e)}let Jh=0;function Qd(){const e=qd[Jh];return Jh=(Jh+1)%qd.length,e}const Eg="tribeSplit_phase",Ql="tribeSplit_strategy",Cg="tribeSplit_targetPosition",Eu="tribeSplit_targetBuildingId",Cu="tribeSplit_familyIds",sI="tribeSplit_phaseStartTime",aI="tribeSplit_lastFailureTime";function lI(e,t){C.set(e,Eg,"idle"),C.delete(e,Ql),C.delete(e,Cg),C.delete(e,Eu),C.delete(e,Cu),C.set(e,aI,t)}function HD(e,t){const n=C.get(e,aI);return n?t-n>=JP:!0}function GD(e,t){const n=C.get(e,sI);return n?t-n>=QP:!1}function _g(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(wI(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!HD(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const i=t.entities.entities[e.leaderId];if(!i||i.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=Wr(Pn(t,i));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(eu(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const l=Bi(e.leaderId,t).filter(v=>v.isAdult);if(l.length<Kh)return{canSplit:!1,reason:"Tribe too small"};const u=tu(e,t).length+1,p=tu(i,t).length+1;if(u>=p&&u>Kh)return{canSplit:!0,progress:1,strategy:OS(e,t)};const m=Math.max(l.length*KP,Kh),S=u/m;if(u>=m){const v=OS(e,t);return{canSplit:!0,progress:S,strategy:v}}return{canSplit:!1,progress:S,reason:`Family too small: ${u} < ${m}`}}function OS(e,t){if(!e.leaderId)return"migration";const n=t;if(!(zo(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===de.StorageSpot&&a.isConstructed);return s.length>0&&s.find(l=>U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height)<=ZP)?"concentration":"migration"}function cI(e,t){if(!e.aiBlackboard)return!1;const n=C.get(e.aiBlackboard,Ql);if(!n)return!1;const i=tu(e,t),s=[e.id,...i.map(a=>a.id)];return C.set(e.aiBlackboard,Cu,s),n==="migration"?xD(e,t):n==="concentration"?WD(e,t):!1}function $D(e,t,n){if(xn(e,n,30))return!1;const s=zo(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function xD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,i=t.mapDimensions.height,s=Math.min(n,i)/2,a=50,l=50;for(let c=0;c<=s;c+=a){const u=c===0?1:Math.max(8,Math.ceil(2*Math.PI*c/l)),f=c===0?0:2*Math.PI/u;for(let p=0;p<u;p++){const m=p*f,S=Math.cos(m)*c,v=Math.sin(m)*c,I=e.position.x+S,A=e.position.y+v,_={x:(I%n+n)%n,y:(A%i+i)%i};if($D(_,e.leaderId,t))return C.set(e.aiBlackboard,Cg,_),!0}}return!1}function WD(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const i=t.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===de.StorageSpot&&l.isConstructed);if(i.length===0)return!1;let s=null,a=1/0;for(const l of i){const c=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);c<a&&(a=c,s=l)}return s?(C.set(e.aiBlackboard,Eu,s.id),!0):!1}function YD(e,t){var c;if(!e.aiBlackboard)return[!1,0];const n=C.get(e.aiBlackboard,Ql),i=(c=C.get(e.aiBlackboard,Cu))==null?void 0:c.filter(u=>!!t.entities.entities[u]);if(!n||!i)return[!1,0];let s;if(n==="migration"){const u=C.get(e.aiBlackboard,Cg);if(!u)return[!1,0];s=u}else if(n==="concentration"){const u=C.get(e.aiBlackboard,Eu);if(!u)return[!1,0];const f=t.entities.entities[u];if(!f)return[!1,0];s=f.position}else return[!1,0];let a=0;for(const u of i){const f=t.entities.entities[u];if(!f||f.type!=="human")continue;U(f.position,s,t.mapDimensions.width,t.mapDimensions.height)<=eI&&a++}const l=Math.ceil(i.length*.5);return[a>=l,a/l]}function dI(e,t){var u;if(!e.aiBlackboard)return!1;const n=C.get(e.aiBlackboard,Ql),i=C.get(e.aiBlackboard,Cu);if(!n||!i)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=Qd(),l=$n[Math.floor(Math.random()*$n.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:l},e.tribeRole=J.Leader,e.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=Lt.Hostile);for(const f of i){if(f===e.id)continue;const p=t.entities.entities[f];!p||p.type!=="human"||(p.leaderId=e.id,p.tribeInfo={tribeBadge:a,tribeColor:l})}if(n==="concentration"){const f=C.get(e.aiBlackboard,Eu);if(f){const p=t.entities.entities[f];p&&p.type==="building"&&(p.ownerId=e.id)}}return bl(t,{type:Gr.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:zd,targetEntityIds:[e.id],highlightedEntityIds:i}),Me({gameState:t},Ce.TribeSplit,e.position),lI(e.aiBlackboard,t.time),!0}function Al(e){return e?C.get(e,Eg)??"idle":"idle"}function Ts(e,t,n){C.set(e,Eg,t),C.set(e,sI,n)}function uI(e,t){C.set(e,Ql,t)}function zD(e,t){lI(e,t)}function jD(e,t){return GD(e,t)?(zD(e,t),!0):!1}function fI(e,t){const n=_g(e,t);return{canSplit:n.canSplit,progress:n.progress}}function hI(e,t){if(!e.aiBlackboard)return;const n=_g(e,t);!n.canSplit||!n.strategy||(uI(e.aiBlackboard,n.strategy),cI(e,t)&&dI(e,t))}function XD(e){const t=new ln([new Ae([new fe((n,i)=>{if(!n.aiBlackboard)return[!1,"No blackboard"];if(!n.leaderId||n.leaderId===n.id)return[!1,"No tribe or the leader"];if(eu(n,i.gameState).id!==n.id)return[!1,"Not patriarch"];const a=Al(n.aiBlackboard);return a!=="idle"&&jD(n.aiBlackboard,i.gameState.time)?(Ts(n.aiBlackboard,"idle",i.gameState.time),[!1,"Phase timed out, reset to idle"]):[a==="idle",`Phase: ${a}`]},"Is Idle?",e+2),new se((n,i)=>{if(!n.aiBlackboard)return T.FAILURE;const s=_g(n,i.gameState);return s.canSplit&&s.strategy?(Ts(n.aiBlackboard,"planning",i.gameState.time),uI(n.aiBlackboard,s.strategy),T.SUCCESS):[T.FAILURE,s.reason||"Cannot split"]},"Check Split Conditions",e+2)],"Check Phase",e+1),new Ae([new fe(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Al(n.aiBlackboard);return[i==="planning",`Phase: ${i}`]},"Is Planning?",e+2),new se((n,i)=>n.aiBlackboard?cI(n,i.gameState)?(Ts(n.aiBlackboard,"gathering",i.gameState.time),T.SUCCESS):(Ts(n.aiBlackboard,"idle",i.gameState.time),T.FAILURE):T.FAILURE,"Plan Split Strategy",e+2)],"Planning Phase",e+1),new Ae([new fe(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Al(n.aiBlackboard);return[i==="gathering",`Phase: ${i}`]},"Is Gathering?",e+2),new se((n,i)=>{if(!n.aiBlackboard)return T.FAILURE;const[s,a]=YD(n,i.gameState);return s?(Ts(n.aiBlackboard,"executing",i.gameState.time),T.SUCCESS):[T.RUNNING,`Progress: ${a.toFixed(2)}`]},"Wait for Family to Gather",e+2)],"Gathering Phase",e+1),new Ae([new fe(n=>{if(!n.aiBlackboard)return[!1,"No blackboard"];const i=Al(n.aiBlackboard);return[i==="executing",`Phase: ${i}`]},"Is Executing?",e+2),new se((n,i)=>n.aiBlackboard?dI(n,i.gameState)?T.SUCCESS:(Ts(n.aiBlackboard,"idle",i.gameState.time),T.FAILURE):T.FAILURE,"Execute Tribe Split",e+2)],"Execution Phase",e+1)],"Tribe Split State Machine",e+1);return new ma(qP,t,"Tribe Split Cooldown",e)}const Ad="jealousyAttackTarget";function VD(e){return new Ae([new fe((t,n,i)=>{var l,c;if(!t.isAdult)return[!1,"Not an adult"];if(t.gender!=="male")return[!1,"Not male"];const s=((c=(l=t.partnerIds)==null?void 0:l.map(u=>{var f;return(f=n.gameState.entities.entities[u])==null?void 0:f.pregnancyFatherId}))==null?void 0:c.filter(u=>!!u&&u!==t.id))??[],a=n.gameState.search.human.byRadius(t.position,qC).find(u=>s.includes(u.id));return a?t.leaderId&&a.id===t.leaderId?[!1,"Stranger is the tribe leader - no attack"]:(C.set(i,Ad,a.id),[!0,`Partner cheating with ${a.id}`]):(C.delete(i,Ad),!1)},"Check for Infidelity",e+1),new se((t,n,i)=>{const s=C.get(i,Ad),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(C.delete(i,Ad),[T.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?T.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[T.RUNNING,`Attacking ${a.id}`])},"Execute Jealousy Attack",e+1)],"Jealousy Attack",e)}const Id="defendAggressor";function KD(e){return new Ae([new fe((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];const s=nO(t,n.gameState,ZC);return s?(C.set(i,Id,s.aggressor.id),[!0,`Family member ${s.familyMember.id} attacked by ${s.aggressor.id}`]):(C.delete(i,Id),!1)},"Check Family Under Attack",e+1),new se((t,n,i)=>{const s=C.get(i,Id),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(C.delete(i,Id),[T.FAILURE,"Target invalid/dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?T.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[T.RUNNING,`Attacking aggressor ${a.id}`])},"Execute Family Defense Attack",e+1)],"Defend Family",e)}const Td="desperateAttackTarget";function qD(e){return new Ae([new fe(t=>t.hunger>QC,"Is Starving",e+1),new fe((t,n)=>{if(!t.isAdult)return[!1,"Not an adult"];const i=Be(t,n.gameState,"berryBush",je,a=>a.food.length>0),s=Be(t,n.gameState,"corpse",je,a=>a.food.length>0);return!i&&!s},"No Other Food Available",e+1),new fe((t,n,i)=>{const s=iO(t,n.gameState);return s?(C.set(i,Td,s.id),[!0,`Found weak target ${s.id}`]):(C.delete(i,Td),!1)},"Find Weak Target",e+1),new se((t,n,i)=>{const s=C.get(i,Td),a=s&&n.gameState.entities.entities[s];return!a||a.hitpoints<=0?(C.delete(i,Td),[T.FAILURE,"Target is invalid or dead"]):t.activeAction==="attacking"&&t.attackTargetId===a.id?T.RUNNING:(t.activeAction="attacking",t.attackTargetId=a.id,[T.RUNNING,`Desperately attacking ${a.id}`])},"Execute Desperate Attack",e+1)],"Desperate Attack",e)}var oe=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(oe||{});const _u={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},pI={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var Ns=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(Ns||{});const sl={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var ae=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenRoleManager="OpenRoleManager",e.CloseRoleManager="CloseRoleManager",e.IncreaseRoleWeight="IncreaseRoleWeight",e.DecreaseRoleWeight="DecreaseRoleWeight",e.OpenArmyControl="OpenArmyControl",e.CloseArmyControl="CloseArmyControl",e.IncreaseArmyObjective="IncreaseArmyObjective",e.DecreaseArmyObjective="DecreaseArmyObjective",e.SwitchAIType="SwitchAIType",e))(ae||{});function ZD(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const a=U(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),c=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?yn:ro;return a<=c?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=s.id,t.direction=We(t.position,s.position,e.mapDimensions),T.RUNNING)}function QD(e){return new Ae([new fe((t,n)=>t.isPlayer===!0&&!!n.gameState.autopilotControls.activeAutopilotAction,"Has Player Command",e+1),new se((t,n)=>{var a,l;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return T.FAILURE;switch(s.action){case oe.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=s.position;return U(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<Mv?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),T.SUCCESS):(t.activeAction="moving",t.target=c,t.direction=We(t.position,c,i.mapDimensions),T.RUNNING)}case oe.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];if(!c)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;let u=!1;if(c.type==="berryBush")u=c.food.length===0;else if(c.type==="corpse")u=c.food.length===0;else if(c.type==="tree"){const p=c;u=((a=p.stateMachine)==null?void 0:a[0])!==Ht||p.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;return u?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>Hr?(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),T.RUNNING):(t.activeAction="gathering",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS)}case oe.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];if(!c||c.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const[u]=c.stateMachine??[];return!(u===rn||u===Vt||u===Sn)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>Xl?(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),T.RUNNING):(t.activeAction="chopping",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS)}case oe.AutopilotAttack:return"targetEntityId"in s?ZD(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE);case oe.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="human"||!er(t,c,n.gameState)?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Ys?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.AutopilotPlant:{if(t.activeAction==="planting")return T.RUNNING;if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=s.position;return xn(c,i,qo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<=Ys?(t.activeAction="planting",t.target=c,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,T.RUNNING):(t.activeAction="moving",t.target=c,t.direction=We(t.position,c,i.mapDimensions),T.RUNNING)}case oe.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="human"||c.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Ys?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];if(!c||c.buildingType!==de.StorageSpot&&c.buildingType!==de.Bonfire||!c.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const u=c.storageCapacity??0;if(c.storedItems.length>=u||t.leaderId!==c.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const p=t.food.length>0,m=!!t.heldItem;if(c.buildingType===de.Bonfire){if(((l=t.heldItem)==null?void 0:l.type)!==mt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE}else if(!p&&!m)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;return U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.buildingType!==de.StorageSpot||!c.isConstructed||c.storedItems.length===0||t.leaderId!==c.ownerId||t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!Xt(t,c,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=je?(t.activeAction="takingOverBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!Xt(t,c,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=je?(t.activeAction="destroyingBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,T.SUCCESS):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),T.RUNNING)}case oe.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const c=s.position,u=s.buildingType;if(!u)return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE;const f=U(t.position,c,i.mapDimensions.width,i.mapDimensions.height),p=100;return f<=p?ra(c,u,t.leaderId,i,t.position,p)?(Xo(c,u,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",T.SUCCESS):(i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE):(t.activeAction="moving",t.target=c,t.direction=We(t.position,c,i.mapDimensions),T.RUNNING)}default:return i.autopilotControls.activeAutopilotAction=void 0,T.FAILURE}},"Execute Player Command",e+1)],"Player Command Handler",e)}function JD(e){const t=new fe(i=>i.id===i.leaderId,"Is Leader?",e+1),n=new se((i,s)=>{var f,p,m,S,v,I;const{gameState:a}=s,l=Bi(i.id,a),c=US(l),u=Du(a).filter(A=>A.leaderId!==i.id);for(const A of u){const _=Bi(A.leaderId,a),P=US(_),R=((p=(f=i.tribeControl)==null?void 0:f.diplomacy)==null?void 0:p[A.leaderId])||Lt.Friendly,w=a.entities.entities[A.leaderId];((S=(m=w==null?void 0:w.tribeControl)==null?void 0:m.diplomacy)==null?void 0:S[i.id])===Lt.Hostile||c>P*KC?R!==Lt.Hostile&&((v=i.tribeControl)!=null&&v.diplomacy)&&(i.tribeControl.diplomacy[A.leaderId]=Lt.Hostile):R!==Lt.Friendly&&((I=i.tribeControl)!=null&&I.diplomacy)&&(i.tribeControl.diplomacy[A.leaderId]=Lt.Friendly)}return T.SUCCESS},"Evaluate Diplomacy",e+2);return new Ae([t,new ma(VC,n,"Diplomacy Cooldown",e+1)],"Manage Diplomacy",e)}const al="huntTarget";function eN(e){return new Ae([new Gn(new fe((n,i,s)=>{if(!n.isAdult)return[!1,"Not an adult"];if(!n.leaderId)return[!1,"Not in a tribe"];if(!an(n,J.Hunter,i.gameState))return[!1,"Not a Hunter"];const a=Be(n.position,i.gameState,"prey",bC,l=>!(n.leaderId&&!io(l.position,n.leaderId,i.gameState)));return a?(C.set(s,al,a.id),[!0,"Found prey"]):[!1,"No suitable prey found"]},"Find Prey Target",e+2),XC,"Cache Find Prey",e+1),new bi(new Pr(new se((n,i,s)=>{if(!n.leaderId)return T.FAILURE;const a=C.get(s,al);if(!a)return T.FAILURE;const l=i.gameState.entities.entities[a];if(!l||l.hitpoints<=0)return C.delete(s,al),n.activeAction="idle",n.attackTargetId=void 0,T.SUCCESS;const{gameState:c}=i,u=ao(n.leaderId,c);return U(n.position,u,c.mapDimensions.width,c.mapDimensions.height)>Rv?(C.delete(s,al),n.activeAction="idle",n.attackTargetId=void 0,T.FAILURE):(n.activeAction="attacking",n.attackTargetId=l.id,T.RUNNING)},"Hunt Prey Action",e+3),Rs,"Hunt Prey Timeout",e+2),{taskType:"hunt",maxCapacity:Iu,getTargetId:(n,i,s)=>C.get(s,al)??null},"Tribal Hunt Task",e+1)],"Human Hunt Prey Sequence",e)}const Ed="defendTarget",ep=150;function tN(e){return new Ae([new fe((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult - children flee instead"];if(t.hitpoints<=t.maxHitpoints*.3)return[!1,"Too injured to defend"];const{gameState:s}=n;if(t.activeAction==="attacking"&&t.attackTargetId){const l=s.entities.entities[t.attackTargetId];if(l&&l.type==="predator"&&l.hitpoints>0&&U(t.position,l.position,s.mapDimensions.width,s.mapDimensions.height)<=ep)return C.set(i,Ed,l.id),[!0,"Continuing defense"]}const a=Be(t,s,"predator",ep,l=>l.hitpoints>0&&(l.isAdult||!1));if(a){const l=U(t.position,a.position,s.mapDimensions.width,s.mapDimensions.height),c=a.attackTargetId===t.id,u=l<80;if(c||u)return C.set(i,Ed,a.id),[!0,"Predator threat detected"]}return C.set(i,Ed,void 0),[!1,"No predator threat"]},"Detect Predator Threat",e+1),new se((t,n,i)=>{const s=C.get(i,Ed),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const{gameState:l}=n,c=U(t.position,a.position,l.mapDimensions.width,l.mapDimensions.height);return t.hitpoints<t.maxHitpoints*.3?T.FAILURE:a.hitpoints<=0||c>ep*1.5?(t.activeAction="idle",t.attackTargetId=void 0,T.SUCCESS):(t.activeAction="attacking",t.attackTargetId=a.id,T.RUNNING)},"Defend Against Predator",e+1)],"Human Defend Against Predator",e)}function nN(e){const t=new se((n,i)=>{if(!n.leaderId||!n.isAdult)return T.FAILURE;const s=i.gameState.entities.entities[n.leaderId];if(!s||!s.tribeControl)return T.FAILURE;if(n.id===s.id)return n.tribeRole!==J.Leader&&(n.tribeRole=J.Leader),T.SUCCESS;const l=Dn(s,i.gameState).filter(A=>A.id!==s.id),c=l.length;if(c===0)return T.SUCCESS;const u=s.tribeControl.roleWeights;let f=0;const p=[];for(const A of Object.values(J))A!==J.Leader&&(f+=u[A]||0,p.push(A));if(f===0)return n.tribeRole||(n.tribeRole=J.Gatherer),T.SUCCESS;const m={},S={},v={};for(const A of p)m[A]=0,S[A]=u[A]/f*c;for(const A of l)A.tribeRole&&A.tribeRole!==J.Leader&&(m[A.tribeRole]=(m[A.tribeRole]||0)+1);for(const A of p)v[A]=S[A]-m[A];let I=!1;if((!n.tribeRole||n.tribeRole===J.Leader||v[n.tribeRole]<-.5&&p.some(P=>v[P]>.5))&&(I=!0),I){let A=null,_=-1/0;const P=[...p].sort(()=>Math.random()-.5);for(const R of P){const w=v[R];w>_&&(_=w,A=R)}if(A)n.tribeRole=A;else{const R=Math.random()*f;let w=0;for(const B of p)if(w+=u[B],R<=w){n.tribeRole=B;break}}}return T.SUCCESS},"Assign Tribe Role",e+1);return new Gn(t,Os,"Cache Tribe Role Assignment",e)}const iN=5,oN=0,rN=10;function sN(e){return e<Ov?{[J.Leader]:0,[J.Gatherer]:7,[J.Planter]:2,[J.Hunter]:1,[J.Mover]:1,[J.Warrior]:0}:e<kv?{[J.Leader]:0,[J.Gatherer]:5,[J.Planter]:4,[J.Hunter]:2,[J.Mover]:2,[J.Warrior]:1}:e<bv?{[J.Leader]:0,[J.Gatherer]:4,[J.Planter]:3,[J.Hunter]:3,[J.Mover]:3,[J.Warrior]:2}:{[J.Leader]:0,[J.Gatherer]:3,[J.Planter]:3,[J.Hunter]:4,[J.Mover]:3,[J.Warrior]:3}}function aN(e){if(e.length===0)return 0;let t=0,n=0;for(const i of e)t+=i.food.length,n+=i.maxFood;return n===0?0:t/n}function lN(e,t){return e<t?Math.min(e+1,rN):e>t?Math.max(e-1,oN):e}function cN(e){const t=new se((n,i)=>{if(!n.leaderId||n.id!==n.leaderId||!n.tribeControl)return T.FAILURE;const s=Dn(n,i.gameState);if(s.filter(m=>m.isAdult).length<iN)return T.FAILURE;const l=aN(s),c=sN(l),u=n.tribeControl.roleWeights;let f=!1;const p=[J.Gatherer,J.Planter,J.Hunter,J.Mover,J.Warrior];for(const m of p){const S=u[m]||0,v=c[m],I=lN(S,v);I!==S&&(u[m]=I,f=!0)}if(f){const m=`Adjusted weights for food security: ${(l*100).toFixed(1)}%`;return[T.SUCCESS,m]}return T.FAILURE},"Manage Tribe Role Weights",e+1);return new Gn(t,Os,"Cache Role Management",e)}const Tr="treeTarget";function dN(e){const t=new se((i,s,a)=>{const l=$t(i,s.gameState),c=Be(i,s.gameState,"tree",n_,u=>{const[f]=u.stateMachine??[];if(!(f===rn||f===Vt||f===Sn)||i.leaderId&&!io(u.position,i.leaderId,s.gameState))return!1;if(l&&l.aiBlackboard){const m=`tribal_chop_${u.id}`,S=C.get(l.aiBlackboard,m);if(S&&s.gameState.time-S.startTime<=Oi&&!S.memberIds.includes(i.id))return!1}return!0});return c?(C.set(a,Tr,c.id),[T.SUCCESS,`Found tree: ${c.id} at ${c.position.x.toFixed(0)},${c.position.y.toFixed(0)}`]):[T.FAILURE,"No tree found"]},"Find Closest Tree",e+4),n=new bi(new se((i,s,a)=>{const l=C.get(a,Tr);if(!l)return[T.FAILURE,"No target in blackboard"];const c=s.gameState.entities.entities[l];if(!c)return C.delete(a,Tr),[T.FAILURE,"Tree no longer exists"];const[u]=c.stateMachine??[];return u===rn||u===Vt||u===Sn?U(i.position,c.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Xl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=c.id,C.delete(a,Tr),[T.SUCCESS,`Chopping tree ${c.id}`]):(i.activeAction="moving",i.target=c.id,i.direction=We(i.position,c.position,s.gameState.mapDimensions),[T.RUNNING,`Moving to tree ${c.id}`]):(C.delete(a,Tr),[T.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop",e+3),{taskType:"chop",maxCapacity:1,getTargetId:(i,s,a)=>C.get(a,Tr)??null},"Tribal Chop Task",e+3);return new Ae([new fe((i,s)=>{const a=$t(i,s.gameState);if(!a)return[!1,"No leader for coordination"];const l=Fl(a.id,s.gameState);if(l<=0)return[!1,"No wood need"];const c=uA(a.id,s.gameState);return[l>c,`Wood need: ${l}, Available on ground: ${c}`]},"Need Wood?",e+1),new fe(i=>{const s=!i.heldItem;return[(i.isAdult&&s)??!1,`${s?"Can chop":"Holding item"}`]},"Should Chop Tree",e+1),new ln([new Ae([new fe((i,s,a)=>C.has(a,Tr),"Has Tree Target?",e+2),n],"Continue Chopping Action",e+2),new Ae([new Gn(t,zC,"Cache Tree Search",e+3),n],"Find New Tree and Chop",e+2)],"Perform or Start Chopping",e+1)],"Chop Tree",e)}const Er="cleanupTreeTarget";function uN(e){const t=new se((i,s,a)=>{const l=$t(i,s.gameState),c=Vl(i,s.gameState);if(c.length===0)return[T.FAILURE,"No planting zones found"];const u=s.gameState;let f=null,p=1/0;for(const m of c){const S=Math.sqrt(m.width*m.width+m.height*m.height)/2,v=u.search.tree.byRadius(m.position,S);for(const I of v){const[A]=I.stateMachine??[];if(!(A===rn||A===Vt||A===Sn)||!vp(I.position,m,s.gameState))continue;if(l&&l.aiBlackboard){const R=`tribal_cleanup_tree_${I.id}`,w=C.get(l.aiBlackboard,R);if(w&&s.gameState.time-w.startTime<=Oi&&!w.memberIds.includes(i.id))continue}const P=U(i.position,I.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height);P<p&&(p=P,f=I)}}return f?(C.set(a,Er,f.id),[T.SUCCESS,`Found nuisance tree: ${f.id} at ${f.position.x.toFixed(0)},${f.position.y.toFixed(0)}`]):[T.FAILURE,"No nuisance trees found in planting zones"]},"Find Nuisance Tree",e+4),n=new bi(new se((i,s,a)=>{const l=C.get(a,Er);if(!l)return[T.FAILURE,"No target in blackboard"];const c=s.gameState.entities.entities[l];if(!c)return C.delete(a,Er),[T.FAILURE,"Tree no longer exists"];const[u]=c.stateMachine??[];return u===rn||u===Vt||u===Sn?U(i.position,c.position,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<Xl?(i.activeAction="chopping",i.direction={x:0,y:0},i.target=c.id,C.delete(a,Er),[T.SUCCESS,`Chopping nuisance tree ${c.id}`]):(i.activeAction="moving",i.target=c.id,i.direction=We(i.position,c.position,s.gameState.mapDimensions),[T.RUNNING,`Moving to nuisance tree ${c.id}`]):(C.delete(a,Er),[T.FAILURE,"Tree is invalid or already fallen"])},"Move To Tree and Chop (Cleanup)",e+3),{taskType:"cleanup_tree",maxCapacity:1,getTargetId:(i,s,a)=>C.get(a,Er)??null},"Tribal Cleanup Tree Task",e+3);return new Ae([new fe((i,s)=>{const a=an(i,J.Planter,s.gameState),l=an(i,J.Gatherer,s.gameState),c=!i.heldItem;return[!!(i.isAdult&&(a||l)&&c),`${c?"Planter/Gatherer role eligible":"Holding item"}`]},"Should Cleanup Zone?",e+1),new ln([new Ae([new fe((i,s,a)=>C.has(a,Er),"Has Cleanup Target?",e+2),n],"Continue Cleanup Action",e+2),new Ae([new Gn(t,jC,"Cache Cleanup Search",e+3),n],"Find New Nuisance Tree and Chop",e+2)],"Perform or Start Cleanup",e+1)],"Cleanup Planting Zones",e)}const ll="bonfireTargetId",fN=800;function hN(e){return new Ae([new fe((t,n)=>{const i=na(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<js+8;return[s,`Temp: ${i.toFixed(1)}C`+(s?" (Cold)":"")]},"Is Cold?",e+1),new se((t,n,i)=>{const s=$t(t,n.gameState),a=Be(t,n.gameState,"building",fN,l=>{if(!(l.buildingType===de.Bonfire&&l.isConstructed&&!l.isBeingDestroyed&&(l.fuelLevel??0)>0)||l.ownerId!==t.leaderId)return!1;if(s&&s.aiBlackboard){const u=`tribal_warmth_${l.id}`,f=C.get(s.aiBlackboard,u);if(f&&n.gameState.time-f.startTime<=Oi&&f.memberIds.length>=Qy&&!f.memberIds.includes(t.id))return!1}return!0});return a?(C.set(i,ll,a.id),[T.SUCCESS,`Found bonfire ${a.id}`]):(C.delete(i,ll),[T.FAILURE,"No available fueled bonfires found"])},"Find Bonfire",e+1),new bi(new se((t,n,i)=>{const s=C.get(i,ll),a=s&&n.gameState.entities.entities[s];if(!a||(a.fuelLevel??0)<=0||!a.isConstructed)return C.delete(i,ll),T.FAILURE;const l=t.id*137%360*(Math.PI/180),c=Xs*.4,u=n.gameState.mapDimensions.width,f=n.gameState.mapDimensions.height,p={x:(a.position.x+Math.cos(l)*c+u)%u,y:(a.position.y+Math.sin(l)*c+f)%f},m=U(t.position,p,u,f);return m>10?(t.activeAction="moving",t.target=p,t.direction=We(t.position,p,n.gameState.mapDimensions),[T.RUNNING,`Moving to personal warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[T.RUNNING,"Staying warm at personal spot"])},"Move to Warmth Spot",e+2),{taskType:"warmth",maxCapacity:Qy,getTargetId:(t,n,i)=>C.get(i,ll)??null},"Tribal Warmth Task",e+1)],"Gather at Bonfire Sequence",e)}function pN(e){const t=new se((n,i,s)=>{if(!n.leaderId||n.id!==n.leaderId)return[T.FAILURE,"Not a tribe leader"];const a=xr(n.id,i.gameState);let l=0;for(const c of a)if(c.isConstructed&&c.fuelLevel!==void 0){const u=c.maxFuelLevel??Mr;c.fuelLevel<u*sg&&(ZA(s,c.id,"wood",i.gameState.time),l++)}return[T.SUCCESS,`Tribe logistics: ${l} wood demands registered for bonfires`]},"Manage Tribe Logistics",e+1);return new Gn(t,Nw,"Cached Tribe Logistics",e)}function gN(e){return new Ae([new fe((t,n,i)=>{const s=Be(t,n.gameState,"predator",mn*2,()=>!0),a=Be(t,n.gameState,"human",mn*2,()=>!0);let l=null,c=1/0;if(s){const u=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<c&&(c=u,l=s)}if(a){const u=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);u<c&&(c=u,l=a)}return l&&c<mn*1.5?(C.set(i,"fleeThreat",l.id),C.set(i,"fleeDistance",c),!0):!1},"Detect Threat",e+1),new se((t,n,i)=>{const s=C.get(i,"fleeThreat"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;t.activeAction="moving";const l=Xe(a.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=rt(l),u=hi(t.position,Et(c,OR));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,t.fleeCooldown=n.gameState.time+2,T.RUNNING},"Execute Flee",e+1)],"Prey Flee",e)}function mN(e){return new Ae([new fe((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=30||t.eatingCooldownTime&&t.eatingCooldownTime>n.gameState.time)return!1;const s=Be(t,n.gameState,"berryBush",mn*10,a=>a.food.length>0);return s?U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=mn?(C.set(i,"grazingTarget",s.id),!0):(C.set(i,"grazingTarget",s.id),C.set(i,"needToMoveToTarget",!0),!0):!1},"Find Berry Bush",e+1),new se((t,n,i)=>{const s=C.get(i,"grazingTarget"),a=s&&n.gameState.entities.entities[s],l=C.get(i,"needToMoveToTarget");if(!a)return T.FAILURE;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=mn)return t.activeAction="grazing",t.target=a.id,t.direction={x:0,y:0},C.delete(i,"needToMoveToTarget"),T.RUNNING;if(l||c>mn){t.activeAction="moving",t.target=a.id;const u=We(t.position,a.position,n.gameState.mapDimensions);return t.direction=u,T.RUNNING}return T.FAILURE},"Move to Bush or Graze",e+1)],"Prey Graze",e)}function yN(e){const t=new fe((a,l,c)=>{const u=Be(a,l.gameState,"prey",mn,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Rl&&f.age<=Gh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(c,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new se((a,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},C.delete(c,"procreationPartner"),T.SUCCESS):T.FAILURE},"Start Procreating",e+2),i=new fe((a,l,c)=>{const u=Be(a,l.gameState,"prey",mn*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Rl&&f.age<=Gh&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(c,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new se((a,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return T.FAILURE;if(U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=mn)return T.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=rt(m),T.RUNNING},"Move Towards Partner",e+2);return new Ae([new fe(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=Rl&&a.age<=Gh&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new ln([new Ae([t,n],"Procreate With Immediate Partner",e+2),new Ae([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Prey Procreate",e)}const SN=(e,t,n)=>{const i=t.gameState.search.prey.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="prey");if(i.length===0)return T.FAILURE;let s=null,a=Su;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(C.set(n,"targetChild",s.id),T.SUCCESS):T.FAILURE},vN=(e,t,n)=>{const i=C.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>pa?(e.activeAction="moving",e.target=s.id,e.direction=We(e.position,s.position,t.gameState.mapDimensions),T.RUNNING):(e.activeAction="feeding",e.target=void 0,C.set(n,"targetChild",void 0),T.SUCCESS):T.FAILURE};function AN(e){return new Ae([new fe(t=>(t.isAdult&&t.gender==="female"&&t.hunger<80&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new se(SN,"Find Hungriest Prey Child",e+1),new se(vN,"Move To Child and Feed",e+1)],"Feed Prey Child",e)}function IN(e){return new Ae([new fe(t=>!t.isAdult&&t.hunger>=Su,"Is Hungry Prey Child",e+1),new se((t,n,i)=>{if(!t.motherId)return T.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(C.set(i,"targetParent",s.id),T.SUCCESS):T.FAILURE},"Find Female Parent",e+1),new se((t,n,i)=>{const s=C.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=pa?(t.target=void 0,T.SUCCESS):(t.target=a.id,t.activeAction="moving",T.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}const Cd="huntTarget";function TN(e,t,n){if(!(e!=null&&e.aiBlackboard))return!0;const i=`tribal_hunt_${t}`,s=C.get(e.aiBlackboard,i);return!s||n-s.startTime>Oi?!0:s.memberIds.length<(s.maxCapacity||Iu)}function EN(e,t,n,i){if(!(e!=null&&e.aiBlackboard))return;const s=`tribal_hunt_${n}`;let a=C.get(e.aiBlackboard,s);a||(a={memberIds:[],startTime:i,maxCapacity:Iu},C.set(e.aiBlackboard,s,a)),a.memberIds.includes(t.id)||a.memberIds.push(t.id)}function CN(e,t){if(!(e!=null&&e.aiBlackboard))return 0;const n=`tribal_hunt_${t}`,i=C.get(e.aiBlackboard,n);return(i==null?void 0:i.memberIds.length)??0}function Ld(e,t,n=new Set){if(n.has(e.id))return e;n.add(e.id);for(const i of[e.fatherId,e.pregnancyFatherId,e.motherId]){if(!i||i===e.id)continue;const s=t.entities.entities[i];if(s)return Ld(s,t,n)}return e}function _N(e){return new Ae([new fe((t,n,i)=>{if(!t.isAdult)return[!1,"Not an adult"];if(t.hunger<=50||t.huntCooldown&&t.huntCooldown>0)return!1;const s=Be(t,n.gameState,"prey",Ps*10,a=>{if(a.hitpoints<=0)return!1;const l=Ld(t,n.gameState);return!(l&&!TN(l,a.id,n.gameState.time))});if(s){const a=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Ld(t,n.gameState),c=l?CN(l,s.id):0;if(a<=Ps)return C.set(i,Cd,s.id),[!0,`Prey in range (${c} hunters)`];if(a<=Ps*10)return C.set(i,Cd,s.id),C.set(i,"needToApproach",!0),[!0,`Approaching prey (${c} hunters)`]}return!1},"Find Prey Target",e+1),new Pr(new se((t,n,i)=>{const s=C.get(i,Cd),a=s&&n.gameState.entities.entities[s],l=C.get(i,"needToApproach");if(!a||a.hitpoints<=0)return C.delete(i,Cd),C.delete(i,"needToApproach"),T.SUCCESS;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=Ps)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},C.delete(i,"needToApproach"),T.RUNNING;if(l||c>Ps){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(u),EN(Ld(t,n.gameState),t,a.id,n.gameState.time),T.RUNNING}return T.FAILURE},"Hunt or Approach Prey",e+3),10,"Hunt Timeout (10 hour)",e+2)],"Predator Hunt",e)}function wN(e){return new Ae([new fe((t,n,i)=>{const s=t.hunger>100,a=t.hitpoints<t.maxHitpoints*.5;if(!s&&!a||t.attackCooldown&&t.attackCooldown>0)return!1;const l=Be(t,n.gameState,"human",fi*2,c=>c.hitpoints>0);if(l){const c=U(t.position,l.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=fi)return C.set(i,"attackTarget",l.id),!0;if(s&&c<=fi*2)return C.set(i,"attackTarget",l.id),C.set(i,"needToApproach",!0),!0}return!1},"Find Human Target",e+1),new se((t,n,i)=>{const s=C.get(i,"attackTarget"),a=s&&n.gameState.entities.entities[s],l=C.get(i,"needToApproach");if(!a||a.hitpoints<=0)return T.FAILURE;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=fi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},C.delete(i,"needToApproach"),T.RUNNING;if(l||c>fi){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(u),T.RUNNING}return T.FAILURE},"Attack or Approach Human",e+1)],"Predator Attack Human",e)}function RN(e){const t=new fe((a,l,c)=>{const u=Be(a,l.gameState,"predator",jo,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Pl&&f.age<=$h&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(c,"procreationPartner",u.id),!0):!1},"Find Immediate Partner",e+2),n=new se((a,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];return f?(a.activeAction="procreating",a.target=f.id,a.direction={x:0,y:0},C.delete(c,"procreationPartner"),T.SUCCESS):T.FAILURE},"Start Procreating",e+2),i=new fe((a,l,c)=>{const u=Be(a,l.gameState,"predator",jo*10,f=>f.id!==a.id&&f.gender!==a.gender&&!!f.isAdult&&f.age>=Pl&&f.age<=$h&&!f.isPregnant&&(!f.procreationCooldown||f.procreationCooldown<=0)&&f.hunger<200);return u?(C.set(c,"procreationPartner",u.id),!0):!1},"Locate Distant Partner",e+2),s=new se((a,l,c)=>{const u=C.get(c,"procreationPartner"),f=u&&l.gameState.entities.entities[u];if(!f)return T.FAILURE;if(U(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height)<=jo)return T.SUCCESS;a.activeAction="moving",a.target=f.id;const m=Xe(a.position,f.position,l.gameState.mapDimensions.width,l.gameState.mapDimensions.height);return a.direction=rt(m),T.RUNNING},"Move Towards Partner",e+2);return new Ae([new fe(a=>!!(a.isAdult&&!a.isPregnant&&a.age>=Pl&&a.age<=$h&&a.hunger<200&&(!a.procreationCooldown||a.procreationCooldown<=0)),"Is Fertile and Ready",e+1),new ln([new Ae([t,n],"Procreate With Immediate Partner",e+2),new Ae([i,s],"Seek Distant Partner",e+2)],"Find Partner And Procreate",e+1)],"Predator Procreate",e)}const PN=(e,t,n)=>{const i=t.gameState.search.predator.byProperty("motherId",e.id).filter(l=>!l.isAdult&&l.type==="predator");if(i.length===0)return T.FAILURE;let s=null,a=Su;for(const l of i)l.hunger>=a&&(a=l.hunger,s=l);return s?(C.set(n,"targetChild",s.id),T.SUCCESS):T.FAILURE},DN=(e,t,n)=>{const i=C.get(n,"targetChild"),s=i&&t.gameState.entities.entities[i];return s?U(e.position,s.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height)>pa?(e.activeAction="moving",e.target=s.id,e.direction=We(e.position,s.position,t.gameState.mapDimensions),T.RUNNING):(e.activeAction="feeding",e.target=void 0,C.set(n,"targetChild",void 0),T.SUCCESS):T.FAILURE};function NN(e){return new Ae([new fe(t=>(t.isAdult&&t.gender==="female"&&t.hunger<90&&(!t.feedChildCooldownTime||t.feedChildCooldownTime<=0))??!1,"Can Feed Child (Female Only)",e+1),new se(PN,"Find Hungriest Predator Child",e+1),new se(DN,"Move To Child and Feed",e+1)],"Feed Predator Child",e)}function MN(e){return new Ae([new fe(t=>!t.isAdult&&t.hunger>=Su,"Is Hungry Predator Child",e+1),new se((t,n,i)=>{if(!t.motherId)return T.FAILURE;const s=n.gameState.entities.entities[t.motherId];return s?(C.set(i,"targetParent",s.id),T.SUCCESS):T.FAILURE},"Find Female Parent",e+1),new se((t,n,i)=>{const s=C.get(i,"targetParent"),a=s&&n.gameState.entities.entities[s];if(!a)return T.FAILURE;const l=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="idle",l<=pa?(t.target=void 0,T.SUCCESS):(t.target=a.id,t.activeAction="moving",T.RUNNING)},"Move To Female Parent",e+1)],"Seek Food From Female Parent",e)}function gI(e){return new se((t,n,i)=>{t.activeAction="idle";let s=C.get(i,"wanderTarget"),a=C.get(i,"wanderStartTime");const l=n.gameState.time;if(!s||!a||l-a>2){const c=Math.random()*2*Math.PI,u=50+Math.random()*100,f={x:Math.cos(c),y:Math.sin(c)},p=hi(t.position,Et(f,u));s={x:(p.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(p.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},C.set(i,"wanderTarget",s),C.set(i,"wanderStartTime",l)}if(s){t.target=s;let c=s.x-t.position.x,u=s.y-t.position.y;const f=n.gameState.mapDimensions.width,p=n.gameState.mapDimensions.height;Math.abs(c)>f/2&&(c=c>0?c-f:c+f),Math.abs(u)>p/2&&(u=u>0?u-p:u+p);const m=rt({x:c,y:u});t.direction=m}return T.SUCCESS},"Animal Wander",e)}function ON(e){return new Ae([new fe((t,n,i)=>{if(t.hunger>90||t.hitpoints<t.maxHitpoints*.3||t.activeAction==="grazing"||t.activeAction==="procreating")return!1;const s=Object.values(n.gameState.entities.entities),a=[];for(const l of s)if(l.type==="prey"&&l.id!==t.id){const c=l;c.hitpoints>0&&c.isAdult&&U(t.position,c.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=mn*5&&a.push(c)}if(a.length>=2){let l=0,c=0;for(const p of a)l+=p.position.x,c+=p.position.y;l/=a.length,c/=a.length;const u={x:l,y:c};if(U(t.position,u,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>mn*2)return C.set(i,"herdCenter",u),C.set(i,"herdSize",a.length),!0}return!1},"Find Herd",e+1),new se((t,n,i)=>{const s=C.get(i,"herdCenter");if(!s)return T.FAILURE;if(U(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>mn*2){t.activeAction="moving",t.target=s;const l=Xe(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(l),T.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},T.SUCCESS},"Join Herd",e+1)],"Prey Herd Behavior",e)}function kN(e){return new Ae([new fe((t,n,i)=>{if(t.hunger>100||t.hitpoints<t.maxHitpoints*.4||t.activeAction==="attacking"||t.activeAction==="procreating")return!1;const s=Be(t,n.gameState,"predator",jo*4,a=>a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==void 0&&a.fatherId===t.fatherId&&a.age>=t.age||a.hitpoints>t.hitpoints);return s&&U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>jo*2?(C.set(i,"packLeader",s.id),!0):!1},"Find Pack Leader",e+1),new se((t,n,i)=>{const s=C.get(i,"packLeader"),a=s&&n.gameState.entities.entities[s];if(!a||a.hitpoints<=0)return T.FAILURE;if(U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>jo*2){t.activeAction="moving",t.target=a.id;const c=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(c),T.RUNNING}else return t.activeAction="idle",t.direction={x:0,y:0},T.SUCCESS},"Follow Pack Leader",e+1)],"Predator Pack Behavior",e)}function bN(e){return new Ae([new fe((t,n,i)=>{if(!t.isAdult||t.hitpoints<t.maxHitpoints*.6||t.hunger>120||t.attackCooldown&&t.attackCooldown>0)return!1;const s=Be(t,n.gameState,"predator",rS,a=>!!(a.id!==t.id&&a.hitpoints>0&&a.isAdult&&t.fatherId!==a.fatherId&&t.gender===a.gender&&t.fatherId!==void 0&&a.fatherId!==void 0));if(s){const a=U(t.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(a<=fi)return C.set(i,"territorialTarget",s.id),!0;if(a<=rS)return C.set(i,"territorialTarget",s.id),C.set(i,"needToApproach",!0),!0}return!1},"Find Territorial Rival",e+1),new se((t,n,i)=>{const s=C.get(i,"territorialTarget"),a=s&&n.gameState.entities.entities[s],l=C.get(i,"needToApproach");if(!a||a.hitpoints<=0)return T.FAILURE;const c=U(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(c<=fi)return t.activeAction="attacking",t.attackTargetId=a.id,t.target=a.id,t.direction={x:0,y:0},C.delete(i,"needToApproach"),T.RUNNING;if(l||c>fi){t.activeAction="moving",t.target=a.id;const u=Xe(t.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.direction=rt(u),T.RUNNING}return T.FAILURE},"Territorial Fight or Approach",e+1)],"Predator Territorial Defense",e)}const BN="tribeSplit_strategy",FN="tribeSplit_targetPosition",LN="tribeSplit_targetBuildingId",UN="tribeSplit_familyIds";function HN(e){return new Ae([new fe((t,n)=>{const i=eu(t,n.gameState);if(!i.aiBlackboard)return[!1,"Patriarch has no blackboard"];const s=Al(i.aiBlackboard);if(s!=="gathering")return[!1,`Patriarch phase: ${s}`];const a=C.get(i.aiBlackboard,UN);return!a||!a.includes(t.id)?[!1,"Not in split family"]:[!0,"Gathering for split"]},"Should Gather for Split?",e+1),new se((t,n)=>{const i=eu(t,n.gameState),s=C.get(i.aiBlackboard,BN);let a;if(s==="migration")a=C.get(i.aiBlackboard,FN);else if(s==="concentration"){const c=C.get(i.aiBlackboard,LN);if(c){const u=n.gameState.entities.entities[c];u&&(a=u.position)}}if(!a)return T.FAILURE;const l=U(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return l<=eI?(t.activeAction="idle",t.target=void 0,T.SUCCESS):(t.activeAction="moving",t.target=a,[T.RUNNING,`Distance: ${l.toFixed(2)}`])},"Move to Split Gathering Point",e+1)],"Tribe Split Gather Behavior",e)}function GN(){const e=new ln([hD(2),KD(2),new Rn(tN(2),"attack","Gated Defend Against Predator",2),new Rn(VD(2),"attack","Gated Jealousy Attack",2),new Rn(qD(2),"attack","Gated Desperate Attack",2),QD(2),new Ss(new ln([new Gn(bD(5),Os,"Cache Take Over Building",4),new Gn(LD(5),Os,"Cache Remove Enemy Building",4)],"Building Interaction Selector",3),"Gated Leader Building Interactions",2),PD(2),new Rn(SD(3),"attack","Gated Attacking",2),hN(2),VP(2),nD(2),RD(2),new Rn(new Gn(DD(4),u_,"Cache Building Placement",3),"build","Gated Leader Building Placement",2),new Ss(new Gn(FD(4),Os,"Cache Border Post Placement",3),"Gated Border Post Placement",2),XD(2),HN(2),fD(2),new Rn(yD(3),"procreation","Gated Procreation",2),new Pr(new Rn(uN(4),"chopping","Gated Cleanup Trees",3),Rs,"Timeout Cleanup Trees",2),new Pr(new Rn(_D(4),"planting","Gated Planting",3),Rs,"Timeout Planting",2),new Rn(wD(3),"gathering","Gated Storage Deposit",2),new Rn(ID(3),"feedChildren","Gated Feed Child",2),new Pr(new Rn(pD(4),"gathering","Gated Gathering",3),Rs,"Timeout Gathering",2),new Pr(new Rn(dN(4),"chopping","Gated Chopping",3),Rs,"Timeout Chopping",2),TD(2),new Rn(eN(3),"attack","Gated Hunt Prey",2),new Ss(UD(2),"Gated Follow Patriarch",2),new Pr(new Ss(mD(2),"Gated Idle Wander",3),Rs,"Timeout Idle Wander",2)],"AI Root Selector",1),t=new IS([new zP(new jP(nN(4),"Role Assignment Success",3),"Role Assignment Gate",2),new Rn(new Gn(cN(4),Os,"Cache Role Management",3),"roleManagement","Gated Role Management",2),new Ss(JD(3),"Gated Diplomacy",2),new Ss(pN(2),"Gated Logistics Management",2)],"Non blocking",1),n=new IS([e,t],"AI Root Sequence",1);return new XP(n,"Manual Control Gate",0)}var ge=(e=>(e[e.HumanGatherBerries=0]="HumanGatherBerries",e[e.HumanGatherMeat=1]="HumanGatherMeat",e[e.HumanEat=2]="HumanEat",e[e.HumanProcreateFemale=3]="HumanProcreateFemale",e[e.HumanProcreateMale=4]="HumanProcreateMale",e[e.HumanFeedChild=5]="HumanFeedChild",e[e.HumanPlaceStorage=6]="HumanPlaceStorage",e[e.HumanPlaceBonfire=7]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=8]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=9]="HumanPlaceBorderPost",e[e.HumanPlantBush=10]="HumanPlantBush",e[e.HumanStockpile=11]="HumanStockpile",e[e.HumanFuelBonfire=12]="HumanFuelBonfire",e[e.HumanRetrieve=13]="HumanRetrieve",e[e.HumanChopTree=14]="HumanChopTree",e[e.HumanGatherWood=15]="HumanGatherWood",e[e.HumanHuntPrey=16]="HumanHuntPrey",e[e.HumanHuntPredator=17]="HumanHuntPredator",e[e.HumanPlayerCommand=18]="HumanPlayerCommand",e))(ge||{}),W=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(W||{});const ti=1,$N=500,mI=.8,xN=100,WN=5,_p="currentAiTask",yI="lastTaskResult",SI="lastTaskMessage",wp="taskHistory";function Ud({aiBlackboard:e}){return C.get(e,_p)||null}function Gs({aiBlackboard:e},t){t?C.set(e,_p,t):C.delete(e,_p)}function YN(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function zN(e,t,n,i){const s=i[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=W.Failure;const[l,c,u]=YN(a);if(C.set(e.aiBlackboard,yI,l),C.set(e.aiBlackboard,SI,c),l!==W.Running){const f=C.get(e.aiBlackboard,wp)||[];if(f.unshift({type:t.type,result:l,completedAtTick:n.gameState.time,message:c}),f.length>5&&f.pop(),C.set(e.aiBlackboard,wp,f),delete n.gameState.tasks[t.id],Gs(e,null),l===W.Success){const p=u||t.nextTask;p&&(n.gameState.tasks[p.id]=p,p.claimedByEntityId=e.id,Gs(e,p.id))}}return l}function Mn(e){return 1/(1+e/$N)}function Mt(e){const{type:t,requireAdult:n,autopilotBehavior:i,producer:s,scorer:a,executor:l}=e;return{type:t,producer:s,scorer:a?(f,p,m)=>n&&!f.isAdult||i&&f.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?null:a(f,p,m):void 0,executor:l?(f,p,m)=>n&&!p.isAdult||i&&p.isPlayer&&!m.gameState.autopilotControls.behaviors[i]?W.Failure:l(f,p,m):void 0}}const jN=Mt({type:ge.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>Qs&&e.food.length>0){const i=`eat-task-${e.id}`;n[i]={id:i,type:ge.HumanEat,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/nn,executor:(e,t)=>e.target!==t.id?W.Empty:t.hunger<Qs?W.Success:t.food.length===0?W.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",W.Running)}),XN=Mt({type:ge.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="berryBush"||i.food.length===0||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Mn(s),l=e.hunger/nn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[W.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="berryBush"||i.food.length===0||t.food.length>=t.maxFood?[W.Success,"Bush is empty"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",[W.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[W.Running,"Gathering berries"])}}),VN=Mt({type:ge.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="corpse"||i.food.length===0||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Mn(s),l=e.hunger/nn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return W.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="corpse"||i.food.length===0||t.food.length>=t.maxFood?W.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",W.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",W.Running)}}),KN=Mt({type:ge.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=kl&&e.age<=uu&&e.hunger<on&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:ge.HumanProcreateFemale,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<kl||e.hunger>=on||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="female"||i.isPregnant||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Mn(s)*mI},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="female"||t.hunger>=on?W.Failure:i.isPregnant?W.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",t.direction=We(t.position,i.position,n.gameState.mapDimensions),W.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",W.Running)}}),qN=Mt({type:ge.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=kl&&e.hunger<on&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:ge.HumanProcreateMale,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<kl||e.age>uu||e.hunger>=on||(e.procreationCooldown||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.gender!=="male"||i.hunger>=on||e.leaderId&&i.leaderId&&e.leaderId!==i.leaderId)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Mn(s)*mI},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.gender!=="male"||i.hunger>=on?W.Failure:t.isPregnant?W.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",t.direction=We(t.position,i.position,n.gameState.mapDimensions),W.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="procreating",W.Running)}}),ZN=Mt({type:ge.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=ea){const i=`feed-child-task-${e.id}`;n[i]={id:i,type:ge.HumanFeedChild,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const i=n.gameState.entities.entities[t.creatorEntityId];if(!i||i.isAdult||!(i.motherId===e.id||i.fatherId===e.id))return null;const a=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Mn(a),c=i.hunger/nn;return(l+c)/2},executor:(e,t,n)=>{const i=n.gameState.entities.entities[e.creatorEntityId];return!i||i.isAdult||t.food.length===0?W.Failure:i.hunger<ea/2?W.Success:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>fu?(t.target=i.position,t.activeAction="moving",t.direction=We(t.position,i.position,n.gameState.mapDimensions),W.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="feeding",W.Running)}});function wu(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const i=U(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Mn(i)}function Ru(e,t,n,i,s){const a=e.target;return U(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",W.Running):(Xo(a,i,t.leaderId,n.gameState),W.Success)}const QN=Mt({type:ge.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:wu,executor:(e,t,n)=>Ru(e,t,n,de.StorageSpot,Ki)}),JN=Mt({type:ge.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:wu,executor:(e,t,n)=>Ru(e,t,n,de.Bonfire,Ki)}),eM=Mt({type:ge.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:wu,executor:(e,t,n)=>Ru(e,t,n,de.PlantingZone,Ki)}),tM=Mt({type:ge.HumanPlaceBorderPost,requireAdult:!0,autopilotBehavior:"build",scorer:wu,executor:(e,t,n)=>Ru(e,t,n,de.BorderPost,g_)}),nM=Mt({type:ge.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(u=>u.type===vn.Berry).length<so)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const l=t.target,c=U(e.position,l,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Mn(c)},executor:(e,t,n)=>{if(t.food.filter(c=>c.type===vn.Berry).length<so)return t.activeAction="idle",W.Failure;const s=e.target;return U(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Hr?(t.target=s,t.activeAction="moving",W.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(c=>c.type==="berryBush"&&U(c.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<WN)?(t.activeAction="idle",W.Success):W.Running)}}),iM=Mt({type:ge.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var f;if(typeof t.target!="number")return null;const i=e.food.length>0,s=((f=e.heldItem)==null?void 0:f.type)===mt.Wood;if(!i&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==de.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const l=U(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=Mn(l),u=s?.6:e.food.length/e.maxFood*.4;return(c+u)/2},executor:(e,t,n)=>{var c;if(typeof e.target!="number")return W.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==de.StorageSpot)return W.Failure;const s=t.food.length>0,a=((c=t.heldItem)==null?void 0:c.type)===mt.Wood;return!s&&!a?W.Success:i.storedItems.length>=i.storageCapacity?W.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",W.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",W.Running)}}),oM=Mt({type:ge.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var c;if(typeof t.target!="number"||!(((c=e.heldItem)==null?void 0:c.type)===mt.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==de.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||Xd;if(s.storedItems.length>=a)return null;const l=U(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return Mn(l)},executor:(e,t,n)=>{var c;if(typeof e.target!="number")return W.Failure;const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="building"||i.buildingType!==de.Bonfire)return W.Failure;if(!(((c=t.heldItem)==null?void 0:c.type)===mt.Wood))return W.Success;const a=i.storageCapacity||Xd;return i.storedItems.length>=a?W.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",W.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="depositing",W.Running)}}),rM=Mt({type:ge.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=Qs||e.food.length>0||typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="building"||i.buildingType!==de.StorageSpot||i.ownerId!==e.leaderId||!i.storedItems.some(c=>c.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Mn(s),l=e.hunger/nn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return W.Failure;const i=n.gameState.entities.entities[e.target];return!i||i.type!=="building"||i.buildingType!==de.StorageSpot||!i.storedItems.some(a=>a.item.itemType==="food")?W.Failure:t.food.length>0?W.Success:t.food.length>=t.maxFood?W.Failure:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",W.Running):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="retrieving",W.Running)}}),sM=Mt({type:ge.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree")return null;const[s]=i.stateMachine??[];if(!(s===rn||s===Vt||s===Sn)||e.heldItem)return null;const l=$t(e,n.gameState);if(!l)return null;const c=Fl(l.id,n.gameState);if(c<=0)return null;const u=uA(l.id,n.gameState);if(u>=c)return null;const f=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),p=Mn(f),m=Math.min(1,(c-u)/10);return(p+m)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[W.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];if(!i||i.type!=="tree")return[W.Failure,"Tree not found"];const[s]=i.stateMachine??[];if(s===Ht){const c={id:`gather-wood-${t.id}-${n.gameState.time}`,type:ge.HumanGatherWood,creatorEntityId:t.id,target:i.id,validUntilTime:n.gameState.time+1};return[W.Success,"Tree fell!",c]}return s===rn||s===Vt||s===Sn?t.heldItem?[W.Failure,"Hands full"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Xl?(t.target=i.position,t.activeAction="moving",[W.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="chopping",[W.Running,"Chopping tree"]):[W.Failure,"Tree is not standing"]}}),aM=Mt({type:ge.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="tree"||i.wood.length===0)return null;const[s]=i.stateMachine??[];if(s!==Ht||e.heldItem)return null;const a=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=Mn(a),c=$t(e,n.gameState),u=c?Fl(c.id,n.gameState):0,f=Math.min(1,u/10);return(l+f)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[W.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[W.Success,"Already holding wood"];const i=n.gameState.entities.entities[e.target];return!i||i.type!=="tree"||i.wood.length===0||t.heldItem?[W.Failure,"Tree gone, empty, or human full"]:U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",[W.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=i.id,t.activeAction="gathering",[W.Running,"Gathering wood"])}}),lM=Mt({type:ge.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="prey"||i.hitpoints<=0||e.leaderId&&!an(e,J.Hunter,n.gameState)||e.leaderId&&!io(i.position,e.leaderId,n.gameState))return null;const s=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const c=ao(e.leaderId,n.gameState);if(U(e.position,c,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Rv)return null}const a=Mn(s),l=e.hunger/nn;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[W.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];return!i||i.hitpoints<=0?(t.activeAction="idle",t.attackTargetId=void 0,[W.Success,"Prey is dead"]):U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",[W.Running,"Chasing prey"]):(t.activeAction="attacking",t.attackTargetId=i.id,[W.Running,"Hunting prey"])}}),cM=Mt({type:ge.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const i=n.gameState.entities.entities[t.target];if(!i||i.type!=="predator"||i.hitpoints<=0)return null;const s=e.leaderId&&an(e,J.Warrior,n.gameState),a=e.leaderId&&an(e,J.Hunter,n.gameState);if(e.leaderId&&!s&&!a||e.leaderId&&!io(i.position,e.leaderId,n.gameState))return null;const l=U(e.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(Mn(l)+1)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[W.Failure,"Invalid target"];const i=n.gameState.entities.entities[e.target];return!i||i.hitpoints<=0?(t.activeAction="idle",t.attackTargetId=void 0,[W.Success,"Predator eliminated"]):U(t.position,i.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>je?(t.target=i.position,t.activeAction="moving",[W.Running,"Chasing predator"]):(t.activeAction="attacking",t.attackTargetId=i.id,[W.Running,"Fighting predator"])}});function dM(e,t,n,i){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,W.Failure;const a=U(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),c=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?yn:ro;return a<=c?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,W.Success):(t.activeAction="moving",t.target=s.id,t.direction=We(t.position,s.position,e.mapDimensions),W.Running)}const uM=Mt({type:ge.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const i=`player-command-${e.id}`;n[i]={id:i,type:ge.HumanPlayerCommand,creatorEntityId:e.id,validUntilTime:t.gameState.time+ti}}return n},scorer:(e,t)=>t.type===ge.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a,l;const{gameState:i}=n,s=i.autopilotControls.activeAutopilotAction;if(!s)return W.Failure;switch(s.action){case oe.AutopilotMove:{if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=s.position;return U(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<Mv?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),W.Success):(t.activeAction="moving",t.target=c,t.direction=We(t.position,c,i.mapDimensions),W.Running)}case oe.AutopilotGather:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=i.entities.entities[s.targetEntityId];if(!c)return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;let u=!1;if(c.type==="berryBush")u=c.food.length===0;else if(c.type==="corpse")u=c.food.length===0;else if(c.type==="tree"){const p=c;u=((a=p.stateMachine)==null?void 0:a[0])!==Ht||p.wood.length===0}else return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;return u?(i.autopilotControls.activeAutopilotAction=void 0,W.Failure):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>Hr?(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),W.Running):(t.activeAction="gathering",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,W.Success)}case oe.AutopilotChop:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=i.entities.entities[s.targetEntityId];if(!c||c.type!=="tree")return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const[u]=c.stateMachine??[];return!(u===rn||u===Vt||u===Sn)||t.heldItem?(i.autopilotControls.activeAutopilotAction=void 0,W.Failure):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)>Xl?(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),W.Running):(t.activeAction="chopping",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,W.Success)}case oe.AutopilotAttack:return"targetEntityId"in s?dM(i,t,s):(i.autopilotControls.activeAutopilotAction=void 0,W.Failure);case oe.AutopilotProcreate:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="human"||!er(t,c,i)?(i.autopilotControls.activeAutopilotAction=void 0,W.Failure):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Ys?(t.activeAction="procreating",i.autopilotControls.activeAutopilotAction=void 0,W.Success):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),W.Running)}case oe.AutopilotPlant:{if(t.activeAction==="planting")return W.Running;if(!("position"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=s.position;return xn(c,i,qo,t.id)?(i.autopilotControls.activeAutopilotAction=void 0,W.Failure):U(t.position,c,i.mapDimensions.width,i.mapDimensions.height)<=Ys?(t.activeAction="planting",t.target=c,i.autopilotControls.activeAutopilotAction=void 0,i.hasPlayerPlantedBush=!0,W.Running):(t.activeAction="moving",t.target=c,t.direction=We(t.position,c,i.mapDimensions),W.Running)}case oe.AutopilotFeedChild:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="human"||c.isAdult||t.food.length===0?(i.autopilotControls.activeAutopilotAction=void 0,W.Failure):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=Ys?(i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",W.Success):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),W.Running)}case oe.AutopilotDeposit:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=i.entities.entities[s.targetEntityId];if(!c||c.buildingType!==de.StorageSpot&&c.buildingType!==de.Bonfire||!c.isConstructed)return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const u=c.storageCapacity??0;if(c.storedItems.length>=u||t.leaderId!==c.ownerId)return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const p=t.food.length>0,m=!!t.heldItem;if(c.buildingType===de.Bonfire){if(((l=t.heldItem)==null?void 0:l.type)!==mt.Wood)return i.autopilotControls.activeAutopilotAction=void 0,W.Failure}else if(!p&&!m)return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;return U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="depositing",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,W.Success):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),W.Running)}case oe.AutopilotRetrieve:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=i.entities.entities[s.targetEntityId];return!c||c.buildingType!==de.StorageSpot||!c.isConstructed||c.storedItems.length===0||t.leaderId!==c.ownerId||t.food.length>=t.maxFood?(i.autopilotControls.activeAutopilotAction=void 0,W.Failure):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=qt?(t.activeAction="retrieving",t.target=void 0,i.autopilotControls.activeAutopilotAction=void 0,W.Success):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),W.Running)}case oe.TakeOverBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!Xt(t,c,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,W.Failure):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=je?(t.activeAction="takingOverBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,W.Success):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),W.Running)}case oe.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=i.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!Xt(t,c,i)||t.leaderId!==t.id?(i.autopilotControls.activeAutopilotAction=void 0,W.Failure):U(t.position,c.position,i.mapDimensions.width,i.mapDimensions.height)<=je?(t.activeAction="destroyingBuilding",t.target=c.id,i.autopilotControls.activeAutopilotAction=void 0,W.Success):(t.activeAction="moving",t.target=c.id,t.direction=We(t.position,c.position,i.mapDimensions),W.Running)}case oe.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const c=s.position,u=s.buildingType;if(!u)return i.autopilotControls.activeAutopilotAction=void 0,W.Failure;const f=U(t.position,c,i.mapDimensions.width,i.mapDimensions.height),p=100;return f<=p?ra(c,u,t.leaderId,i,t.position,p)?(Xo(c,u,t.leaderId,i),i.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",W.Success):(i.autopilotControls.activeAutopilotAction=void 0,W.Failure):(t.activeAction="moving",t.target=c,t.direction=We(t.position,c,i.mapDimensions),W.Running)}default:return i.autopilotControls.activeAutopilotAction=void 0,W.Failure}}}),Pu=[jN,XN,VN,KN,qN,ZN,QN,JN,eM,tM,nM,iM,oM,rM,sM,aM,lM,cM,uM].reduce((e,t)=>(e[t.type]=t,e),{});function fM(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const s=Ud(e);if(s){const a=t.gameState.tasks[s];a&&a.claimedByEntityId===e.id&&(a.claimedByEntityId=void 0),Gs(e,null)}return}hM(e,t);let n=Ud(e);if(n){const s=t.gameState.tasks[n];(!s||s.claimedByEntityId&&s.claimedByEntityId!==e.id)&&(Gs(e,null),n=null)}const i=pM(e,t);if(i&&i!==n){const s=t.gameState.tasks[i];if(!n||s&&s.type===ge.HumanPlayerCommand){if(n){const a=t.gameState.tasks[n];a&&a.claimedByEntityId===e.id&&(a.claimedByEntityId=void 0)}n=i,Gs(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const s=t.gameState.tasks[n];s?zN(e,s,t,Pu):Gs(e,null)}Ud(e)||(e.activeAction="idle")}function hM(e,t){for(const n of Object.values(Pu))if(n.producer){const i=n.producer(e,t);for(const[s,a]of Object.entries(i))t.gameState.tasks[s]||(t.gameState.tasks[s]=a)}}function pM(e,t){let n=null,i=-1/0;for(const s of Object.values(t.gameState.tasks)){if(s.validUntilTime<t.gameState.time){delete t.gameState.tasks[s.id];continue}if(s.claimedByEntityId&&s.claimedByEntityId!==e.id)continue;const a=Pu[s.type];if(!a||!a.scorer)continue;const l=a.scorer(e,s,t);l!==null&&l>i&&(i=l,n=s.id)}return i>0?n:null}const vI=GN();function gM(e,t){const n=performance.now();switch(e.aiType){case Gt.TaskBased:fM(e,t);break;case Gt.BehaviorTreeBased:default:Ag(e,t,vI);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}function mM(){return new ln([gN(1),AN(1),IN(1),mN(1),yN(1),ON(1),gI(1)],"Prey Behavior Root",0)}function yM(){return new ln([_N(1),wN(1),NN(1),MN(1),bN(1),RN(1),kN(1),gI(1)],"Predator Behavior Root",0)}const SM=(e,t)=>{const n={};for(let i=0;i<Iu;i++){const s=`hunt-prey-${e.id}-${i}`;n[s]={id:s,type:ge.HumanHuntPrey,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},vM=(e,t)=>{const n={};for(let i=0;i<Pv;i++){const s=`hunt-predator-${e.id}-${i}`;n[s]={id:s,type:ge.HumanHuntPredator,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},AM={[ge.HumanHuntPrey]:{type:ge.HumanHuntPrey,producer:SM},[ge.HumanHuntPredator]:{type:ge.HumanHuntPredator,producer:vM}};function Jd(e,t){for(const n of Object.values(AM))if(n&&n.producer){const i=n.type===ge.HumanHuntPrey,s=n.type===ge.HumanHuntPredator;if(i&&e.type==="prey"||s&&e.type==="predator"){const a=n.producer(e,t);for(const[l,c]of Object.entries(a))t.gameState.tasks[l]||(t.gameState.tasks[l]=c)}}}const AI=mM();function IM(e,t){switch(e.aiType){case Gt.TaskBased:Jd(e,t);break;case Gt.BehaviorTreeBased:default:Ag(e,t,AI);break}}const II=yM();function TM(e,t){switch(e.aiType){case Gt.TaskBased:Jd(e,t);break;case Gt.BehaviorTreeBased:default:Ag(e,t,II);break}}const TI=5;function EM(){return Jo[de.PlantingZone].dimensions}function kS(e,t,n){const i=e.position.x+n.width/2,a=t.position.x-n.width/2-i,l=e.position.y-n.height/2,c=e.position.y+n.height/2,u=t.position.y-n.height/2,f=t.position.y+n.height/2,p=Math.min(c,f)-Math.max(l,u);return a>=-5&&a<=TI&&p>n.height*.5}function bS(e,t,n){const i=e.position.y+n.height/2,a=t.position.y-n.height/2-i,l=e.position.x-n.width/2,c=e.position.x+n.width/2,u=t.position.x-n.width/2,f=t.position.x+n.width/2,p=Math.min(c,f)-Math.max(l,u);return a>=-5&&a<=TI&&p>n.width*.5}function CM(e){var l;const t={},n=EM(),i=e;if(!((l=i.search)!=null&&l.building))return t;const a=i.search.building.all().filter(c=>c.buildingType===de.PlantingZone&&c.isConstructed);for(const c of a)t[c.id]={top:!1,bottom:!1,left:!1,right:!1};for(let c=0;c<a.length;c++){const u=a[c];for(let f=c+1;f<a.length;f++){const p=a[f];u.ownerId===p.ownerId&&(kS(u,p,n)&&(t[u.id].right=!0,t[p.id].left=!0),kS(p,u,n)&&(t[p.id].right=!0,t[u.id].left=!0),bS(u,p,n)&&(t[u.id].bottom=!0,t[p.id].top=!0),bS(p,u,n)&&(t[p.id].bottom=!0,t[u.id].top=!0))}}return t}function $l(e){e.plantingZoneConnections=CM(e)}const _M=(e,t)=>{if(e.buildingType!==de.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,i=lg(e);if(hA(e,n)>=i)return{};const a=Object.values(n.tasks).find(p=>p.type===ge.HumanPlantBush&&p.creatorEntityId===e.id);if(a)return{[a.id]:a};const l=n.mapDimensions.width,c=n.mapDimensions.height,u=n.soilDepletion,f=10;for(let p=0;p<f;p++){const m=e.position.x+(Math.random()-.5)*e.width,S=e.position.y+(Math.random()-.5)*e.height,v={x:(m%l+l)%l,y:(S%c+c)%c};if(!ki(u,v,l,c)&&!xn(v,n,qo)){const I=`plant-bush-${e.id}-${n.time}`,A={id:I,type:ge.HumanPlantBush,creatorEntityId:e.id,target:v,validUntilTime:n.time+xN};return{[I]:A}}}return{}},wM=(e,t)=>{const n={};if(e.buildingType===de.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const i=`stockpile-${e.id}`;n[i]={id:i,type:ge.HumanStockpile,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n},RM=(e,t)=>{const n={};if(e.buildingType===de.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*sg){const i=`fuel-bonfire-${e.id}`;n[i]={id:i,type:ge.HumanFuelBonfire,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n},PM=(e,t)=>{const n={};if(e.buildingType===de.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(i=>i.item.itemType==="food")){const i=`retrieve-from-${e.id}`;n[i]={id:i,type:ge.HumanRetrieve,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n},DM={[ge.HumanPlantBush]:{type:ge.HumanPlantBush,producer:_M},[ge.HumanStockpile]:{type:ge.HumanStockpile,producer:wM},[ge.HumanFuelBonfire]:{type:ge.HumanFuelBonfire,producer:RM},[ge.HumanRetrieve]:{type:ge.HumanRetrieve,producer:PM}};function EI(e,t){for(const n of Object.values(DM))if(n&&n.producer){const i=n.producer(e,t);for(const[s,a]of Object.entries(i))t.gameState.tasks[s]||(t.gameState.tasks[s]=a)}}function NM(e,t){const{gameState:n,deltaTime:i}=t,s=i*(Tt/Pt);if(e.isBeingDestroyed){const a=nw(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){const l=e.buildingType===de.PlantingZone;jr(n.entities,e.id),l&&$l(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=tw(e.buildingType);a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1&&(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&lA(e.position,qs,e.ownerId,n),e.buildingType===de.PlantingZone&&$l(n))}if(e.buildingType===de.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*Rw,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*Pw)){const a=e.storedItems.findIndex(l=>l.item.itemType==="item"&&l.item.type===mt.Wood);a!==-1&&(e.storedItems.splice(a,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+eA))}EI(e,t)}function MM(e,t){const n=t.deltaTime*Tt/Pt;if(e.age+=n,!e.stateMachine)return;const[i]=e.stateMachine;i!==Ht&&i!==oo&&i!==$r&&(e.age>=Qo&&!e.woodGenerated&&(e.wood=Array.from({length:vu},()=>({itemType:"item",type:mt.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=ql*Math.min(1,Math.max(.4,e.age/Qo)))}const OM={type:ge.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const i=`gather-berries-${e.id}`;n[i]={id:i,type:ge.HumanGatherBerries,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n}},kM={type:ge.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===rn||i===Vt||i===Sn){const a=`chop-tree-${e.id}`;n[a]={id:a,type:ge.HumanChopTree,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n}},bM={type:ge.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[i]=e.stateMachine??[];if(i===Ht&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:ge.HumanGatherWood,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n}},BM=[OM,kM,bM].reduce((e,t)=>(e[t.type]=t,e),{});function BS(e,t){for(const n of Object.values(BM))if(n.producer){const i=n.producer(e,t);for(const[s,a]of Object.entries(i))t.gameState.tasks[s]||(t.gameState.tasks[s]=a)}}const FM={type:ge.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const i=`gather-meat-${e.id}`;n[i]={id:i,type:ge.HumanGatherMeat,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+ti}}return n}},LM=[FM].reduce((e,t)=>(e[t.type]=t,e),{});function UM(e,t){for(const n of Object.values(LM))if(n.producer){const i=n.producer(e,t);for(const[s,a]of Object.entries(i))t.gameState.tasks[s]||(t.gameState.tasks[s]=a)}}function HM(e,t){e.forces.push(Et(e.velocity,-.1));const n=Et(rt(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(i=>{t.gameState.time-i.startTime<i.duration&&i.type==="slow"&&(e.velocity=Et(e.velocity,.5))}),e.debuffs=e.debuffs.filter(i=>t.gameState.time-i.startTime<i.duration),e.velocity=hi(e.velocity,e.forces.reduce(hi,{x:0,y:0})),Js(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=hi(e.position,Et(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&Js(e.velocity)>.1&&zw(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?bP(e,t,t.deltaTime):e.type==="corpse"?(BP(e,t),UM(e,t)):e.type==="prey"?(FP(e,t,t.deltaTime),Jd(e,t)):e.type==="predator"?(LP(e,t,t.deltaTime),Jd(e,t)):e.type==="building"?(NM(e,t),EI(e,t)):e.type==="tree"?(MM(e,t),BS(e,t)):e.type==="berryBush"&&BS(e,t),e.type==="human"&&gM(e,t),e.type==="prey"?IM(e,t):e.type==="predator"&&TM(e,t),e.stateMachine&&(e.stateMachine=C1(...e.stateMachine,{entity:e,updateContext:t}))}function GM(e){const t=e.gameState.entities;Object.values(t.entities).forEach(n=>{HM(n,e)})}function CI(){return{entities:{},nextEntityId:1}}function zr(e,t,n){const i={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],...n};return e.entities[i.id]=i,i}function Jl(e,t,n){return zr(e,"berryBush",{position:t,radius:Sp,food:Array.from({length:lw},()=>({itemType:"food",type:vn.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:aw,lifespan:dw,age:0,spreadRadius:Sp,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,stateMachine:[Tl,{enteredAt:n,previousState:void 0}]})}function xl(e,t,n,i=0){const s=i>=Qo;return zr(e,"tree",{position:t,radius:ql,age:i,lifespan:r1,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:p1,stateMachine:[rn,{enteredAt:n,previousState:void 0}],wood:s?Array.from({length:vu},()=>({itemType:"item",type:mt.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function $s(e,t,n,i,s=!1,a=T_,l=xv,c,u,f=[],p,m,S=Gt.BehaviorTreeBased){const v=a>=Xp;return zr(e,"human",{position:t,radius:v?Ct:ga,hunger:l,hitpoints:zy,maxHitpoints:zy,age:a,gender:i,isPlayer:s,food:[],maxFood:$v,maxAge:Ol,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:c,fatherId:u,ancestorIds:f,stateMachine:[gt,{enteredAt:n,previousState:void 0}],leaderId:p,tribeInfo:m,aiType:S,aiBlackboard:C.create()})}function wg(e,t,n,i,s,a,l,c,u,f,p){let m,S;switch(l){case"human":m=Wv,S=on;break;case"prey":m=2,S=120;break;case"predator":m=4,S=140;break}return zr(e,"corpse",{position:t,radius:s,gender:n,age:i,originalEntityId:a,originalEntityType:l,timeOfDeath:c,decayProgress:0,geneCode:p,food:[...Array.from({length:Math.max(m*Math.max(S-f,0)/S,0)},()=>({itemType:"food",type:vn.Meat})),...u].map(I=>({...I,id:e.nextEntityId++})),stateMachine:void 0})}function $M(e,t,n,i,s,a,l,c,u){return wg(e,t,n,i,s,a,"human",l,c,u)}function xM(e,t,n,i,s,a,l,c){return wg(e,t,n,i,s,a,"prey",l,[],0,c)}function WM(e,t,n,i,s,a,l,c){return wg(e,t,n,i,s,a,"predator",l,[],0,c)}function YM(e,t,n){const i=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=i?[...i.ancestorIds||[],i.id]:[],l=[...s,...a],c=[...new Set(l)],u=c.slice(Math.max(c.length-Gv,0)),f=Math.random()<.5?"male":"female",p=hi(e.position,{x:5,y:5}),m=$s(n.gameState.entities,p,n.gameState.time,f,!1,0,xv/2,e.id,t,u,(i==null?void 0:i.leaderId)??e.leaderId,(i==null?void 0:i.tribeInfo)??e.tribeInfo,e.aiType);return Me(n,Ce.Birth,e.position),m}function jr(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function ia(e,t,n,i=MR,s=EA,a,l,c,u=Gt.BehaviorTreeBased){const f=i>=Rl,p=Date.now();return zr(e,"prey",{position:t,radius:f?Ct*.7:ga*.7,hunger:s,hitpoints:iS,maxHitpoints:iS,age:i,maxAge:TA,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:c,stateMachine:[ui,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:C.create()})}function oa(e,t,n,i=HR,s=_A,a,l,c,u=Gt.BehaviorTreeBased){const f=i>=Pl,p=Date.now();return zr(e,"predator",{position:t,radius:f?Ct*.9:ga*.9,hunger:s,hitpoints:oS,maxHitpoints:oS,age:i,maxAge:CA,gender:n,isAdult:f,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:c,stateMachine:[gn,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:C.create()})}function zM(e,t,n,i){const s=ng(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:i,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:iD,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===de.Bonfire?Mr:void 0,maxFuelLevel:n===de.Bonfire?Mr:void 0};return zr(e,"building",a)}function ra(e,t,n,i,s,a){if(n===void 0||s&&a!==void 0&&U(s,e,i.mapDimensions.width,i.mapDimensions.height)>a)return!1;const l=ng(t),c=Math.sqrt(l.width*l.width+l.height*l.height)/2;if(xn(e,i,c*.8))return!1;if(t===de.PlantingZone){const{depletedSectors:v}=SA(i.soilDepletion,e,l.width,l.height,i.mapDimensions.width,i.mapDimensions.height);if(v.length>0)return!1}const f=i.search.building.byRadius(e,c*2);for(const v of f){const I=U(e,v.position,i.mapDimensions.width,i.mapDimensions.height),A=(Math.max(l.width,l.height)+Math.max(v.width,v.height))/2;if(I<A*.9)return!1}const p=t===de.BorderPost;return!!sA(e,n,i,p?tg:qs,p,n).canPlace}function jM(e){const t=[],n=2*Math.PI/e;for(let i=0;i<e;i++){const s=i*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function Vs(e,t,n,i,s,a){const l=performance.now(),c={totalTimeMs:0,anchorsSearched:0,candidatesTested:0,canPlaceChecks:0,tribeDistanceChecks:0},u=n,f=ng(e),p=n.mapDimensions.width,m=n.mapDimensions.height,S=u.search.building.byProperty("ownerId",t),v=[];if(S.length>0){a&&v.unshift(a);const R=ao(t,n),w=[...S].sort((B,O)=>{const N=U(B.position,R,p,m),M=U(O.position,R,p,m);return N-M});v.push(...w.map(B=>B.position))}else v.push(ao(t,n));const I=Math.min(v.length,h_),A=Math.max(f.width,f.height),_=A+20,P=A/2;for(let R=0;R<I;R++){const w=v[R];c.anchorsSearched++;for(let B=_;B<=i;B+=P){const O=Math.max(8,Math.min(p_,Math.ceil(2*Math.PI*B/A))),N=jM(O);for(let M=0;M<O;M++){c.candidatesTested++;const F=N[M].cos*B,x=N[M].sin*B,Z=w.x+F,te=w.y+x,j=(Z%p+p)%p,ie=(te%m+m)%m;if(c.tribeDistanceChecks++,!kD({x:j,y:ie},t,s,n)&&(c.canPlaceChecks++,ra({x:j,y:ie},e,t,n)))return c.totalTimeMs=performance.now()-l,c.totalTimeMs>Wy&&console.log(`[BuildingPlacement] Slow search for ${e}: ${c.totalTimeMs.toFixed(2)}ms | anchors=${c.anchorsSearched}, candidates=${c.candidatesTested}, canPlace=${c.canPlaceChecks}, tribeDist=${c.tribeDistanceChecks}`),{x:j,y:ie}}}}c.totalTimeMs=performance.now()-l,c.totalTimeMs>Wy&&console.log(`[BuildingPlacement] Slow search (no valid location) for ${e}: ${c.totalTimeMs.toFixed(2)}ms | anchors=${c.anchorsSearched}, candidates=${c.candidatesTested}, canPlace=${c.canPlaceChecks}, tribeDist=${c.tribeDistanceChecks}`)}function Xo(e,t,n,i){if(t===de.BorderPost)return cA(e,tg,n,i),Ge(i,Ee.BorderClaim,e,qe,n),null;const s=zM(i.entities,e,t,n);return t===de.Bonfire&&(s.storageCapacity=Xd,s.storedItems=[]),lA(e,qs,n,i),t===de.PlantingZone&&$l(i),s}function Rp(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===de.PlantingZone&&$l(t))}function XM(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let l=e.x-a.position.x,c=e.y-a.position.y;const u=t.mapDimensions.width,f=t.mapDimensions.height;if(Math.abs(l)>u/2&&(l-=Math.sign(l)*u),Math.abs(c)>f/2&&(c-=Math.sign(c)*f),Math.abs(l)<=a.width/2&&Math.abs(c)<=a.height/2)return a}}function FS(e,t,n){return t.search.human.byRadius(e.position,n).filter(a=>{var c;return!(a.id===e.id||a.gender===e.gender||!a.isAdult||a.hunger>=on||(a.procreationCooldown||0)>0||a.gender==="female"&&a.isPregnant||(e.motherId===a.id||e.fatherId===a.id)&&((c=a.partnerIds)!=null&&c.length))}).sort((a,l)=>{const c=a.id===e.motherId||a.id===e.fatherId,u=e.id===a.motherId||e.id===a.fatherId,f=l.id===e.motherId||l.id===e.fatherId,p=e.id===l.motherId||e.id===l.fatherId;return c||u?1:f||p?-1:a.age-l.age})}function Wr(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),i=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(i),t.length>0)return t[0];if(n.sort(i),n.length>0)return n[0]}function Pn(e,t){const n=e,i=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...i,...s]}function VM(e,t,n){var s;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||e.motherId&&e.motherId===t.motherId||e.fatherId&&e.fatherId===t.fatherId||(s=e.partnerIds)!=null&&s.includes(t.id))return!0;if(e.motherId){const a=n.entities.entities[e.motherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(e.fatherId){const a=n.entities.entities[e.fatherId];if(a&&(a.motherId===t.id||a.fatherId===t.id))return!0}if(t.motherId){const a=n.entities.entities[t.motherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}if(t.fatherId){const a=n.entities.entities[t.fatherId];if(a&&(a.motherId===e.id||a.fatherId===e.id))return!0}return!1}function Pp(e,t){var a,l,c,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(l=t.partnerIds)!=null&&l.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,i=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((c=e.ancestorIds)==null?void 0:c.some(f=>t.ancestorIds.includes(f)))||((u=t.ancestorIds)==null?void 0:u.some(f=>e.ancestorIds.includes(f)));return n||i||s}function KM(e,t){const n=[];if(e.motherId){const i=t.entities.entities[e.motherId];i&&n.push(i)}if(e.fatherId){const i=t.entities.entities[e.fatherId];i&&n.push(i)}return n}function _I(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const i=t.entities.entities[n];if(i&&i.gender==="male")return i}return null}function qM(e,t){var n;if(!e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human")return i}if(e.isAdult&&e.fatherId){const i=t.entities.entities[e.fatherId];if(i&&i.type==="human"&&((n=Wr(Pn(t,i)))==null?void 0:n.id)===e.id)return i}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?_I(e,t):null}function eu(e,t){let n=e;const i=new Set;i.add(n.id);for(let s=0;s<Gv;s++){let a=null;if(n.gender==="female"&&(a=_I(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||i.has(a.id))break;n=a,i.add(n.id)}return n}function Wl(e,t){var i;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(i=e.partnerIds)==null||i.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),Pn(t,e).forEach(s=>n.add(s)),Array.from(n)}function tu(e,t){const n=new Map;function i(s){const a=Pn(t,s);for(const l of a)n.has(l.id)||(n.set(l.id,l),i(l))}return i(e),Array.from(n.values())}function Bi(e,t){return t.search.human.byProperty("leaderId",e)}function nu(e,t,n=new Map,i=new Set){var a;if(n.has(e))return n.get(e);if(i.has(e))return e;i.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const l=s.partnerIds.find(c=>{const u=t.entities.entities[c];return u&&u.gender==="male"});if(l){const c=nu(l,t,n,i);return n.set(e,c),c}}if(s.fatherId&&t.entities.entities[s.fatherId]){const l=nu(s.fatherId,t,n,i);return n.set(e,l),l}return n.set(e,e),e}function ZM(e,t){e.leaderId=e.id,e.tribeRole=J.Leader,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{roleWeights:{[J.Leader]:0,[J.Gatherer]:2,[J.Planter]:2,[J.Hunter]:2,[J.Mover]:2,[J.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}}),e.tribeInfo||(e.tribeInfo={tribeBadge:Qd(),tribeColor:$n[Math.floor(Math.random()*$n.length)]}),e.tribeControl||(e.tribeControl={roleWeights:{[J.Leader]:0,[J.Gatherer]:2,[J.Planter]:2,[J.Hunter]:2,[J.Mover]:2,[J.Warrior]:2},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}})}function QM(e,t){if(e.length===0)return null;const n=new Map,i=new Map;for(const l of e){const c=nu(l.id,t,n);i.has(c)||i.set(c,[]),i.get(c).push(l)}let s=null,a=0;for(const[l,c]of i.entries())c.length>a&&(a=c.length,s=l);return s&&t.entities.entities[s]||null}function Du(e,t){var l,c,u;const n=new Map,i=Object.values(e.entities.entities).filter(f=>f.type==="human");for(const f of i)f.leaderId&&(n.has(f.leaderId)||n.set(f.leaderId,{leaderId:f.leaderId,tribeInfo:f.tribeInfo,members:[]}),(l=n.get(f.leaderId))==null||l.members.push(f));const s=t?(u=(c=e.entities.entities[t])==null?void 0:c.tribeControl)==null?void 0:u.diplomacy:void 0,a=Array.from(n.values()).map(f=>{var v,I;const p=e.entities.entities[f.leaderId],m=f.members.filter(A=>A.isAdult).length,S=f.members.length-m;return{leaderId:f.leaderId,tribeBadge:((v=f==null?void 0:f.tribeInfo)==null?void 0:v.tribeBadge)||"",tribeColor:((I=f==null?void 0:f.tribeInfo)==null?void 0:I.tribeColor)||"",adultCount:m,childCount:S,isPlayerTribe:f.leaderId===t,leaderAge:(p==null?void 0:p.age)??0,leaderGender:(p==null?void 0:p.gender)??"male",diplomacyStatus:(s==null?void 0:s[f.leaderId??-1])??Lt.Friendly}});return a.sort((f,p)=>f.isPlayerTribe?-1:p.isPlayerTribe?1:p.adultCount+p.childCount-(f.adultCount+f.childCount)),a}function Dn(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function wI(e){var a;const t=new Set,i=e.search.human.all(),s=new Map;for(const l of i)l.leaderId&&(s.has(l.leaderId)||s.set(l.leaderId,[]),(a=s.get(l.leaderId))==null||a.push(l));for(const[l,c]of s){if(c.length===0)continue;const u=e.entities.entities[l],f=!u,p=u&&u.leaderId!==l;(f||p)&&t.add(l)}for(let l=0;l<e.terrainOwnership.length;l++){const c=e.terrainOwnership[l];c!==null&&!s.has(c)&&t.add(c)}return Array.from(t)}function JM(e,t){const n=new Map,s=t.search.human.all(),a=Wl(e,t);for(const c of a)n.set(c,3);for(const c of s)c.id===e.id||n.has(c)||Pp(e,c)&&n.set(c,2);const l=Array.from(n.keys());for(const c of l)if(c.partnerIds)for(const u of c.partnerIds){const f=t.entities.entities[u];f&&!n.has(f)&&f.id!==e.id&&n.set(f,1)}return n}function eO(e,t){const n=Bi(e,t);if(n.length===0)return null;const i=t.entities.entities[e];if(i&&i.leaderId&&i.leaderId!==i.id)return i.leaderId;const s=new Map;for(const c of n){const u=JM(c,t);for(const[f,p]of u)if(f.leaderId&&f.leaderId!==e){const m=f.leaderId,S=t.entities.entities[m];if(S&&S.leaderId===S.id){const v=s.get(m)||0;s.set(m,v+p)}}}let a=null,l=0;for(const[c,u]of s)u>l&&(l=u,a=c);return a}function LS(e,t,n){var p,m;const i=Bi(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=i.length>0?(p=i[0].tribeInfo)==null?void 0:p.tribeBadge:"?",l=s.leaderId===e||!s.leaderId;if(l){const S=n.entities.entities[e];ZM(s,S)}const c=((m=s.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const S of i)S.id!==t&&(S.leaderId=t,S.tribeInfo=s.tribeInfo,S.tribeRole=void 0);const f=n.search.building.byProperty("ownerId",e);for(const S of f)S.ownerId=t;Vd(n,e,t),bl(n,{identifier:`tribe-merge-${e}`,type:Gr.TribeMerged,message:l?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${c}!`,duration:zd,targetEntityIds:[t],highlightedEntityIds:[t,...i.map(S=>S.id)]})}function tO(e){var n;const t=wI(e);for(const i of t){const s=Bi(i,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",i);for(const f of u)Rp(f.id,e);Vd(e,i,null),bl(e,{identifier:`tribe-dissolved-${i}`,type:Gr.TribeMerged,message:"An extinct tribe has been dissolved.",duration:zd});continue}const a=QM(s,e);if(a){LS(i,a.id,e);continue}const l=eO(i,e);if(l)LS(i,l,e);else{const c=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const p of s)p.leaderId=void 0,p.tribeInfo=void 0,p.tribeRole=void 0;const f=e.search.building.byProperty("ownerId",i);for(const p of f)Rp(p.id,e);Vd(e,i,null),bl(e,{identifier:`tribe-dissolved-${i}`,type:Gr.TribeMerged,message:`Tribe ${c} has been dissolved due to lack of leadership.`,duration:zd})}}}function nO(e,t,n){const i=Wl(e,t),s=t;for(const a of i){if(U(e.position,a.position,t.mapDimensions.width,t.mapDimensions.height)>n)continue;const c=s.search.human.byProperty("attackTargetId",a.id);for(const u of c)if(u.leaderId!==e.leaderId&&U(e.position,u.position,t.mapDimensions.width,t.mapDimensions.height)<=n)return{familyMember:a,aggressor:u}}}function iO(e,t){const i=t.search.human.byRadius(e.position,e_);let s,a=1/0;for(const l of i){if(l.id===e.id||l.hitpoints<=0||l.hitpoints/l.maxHitpoints>JC||VM(e,l,t)||e.leaderId===l.leaderId&&e.leaderId)continue;const c=U(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);c<a&&(a=c,s=l)}return s}function oO(e,t,n){return t.search.human.byRadius(e.position,n).filter(s=>fa(e,s,t))}function rO(e,t,n){const i=n.search.human.byProperty("leaderId",e);let s=0;for(const a of i)a.attackTargetId===t&&s++;return s}function US(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let i=n.hitpoints;return i+=(n.maxAge-n.age)*.5,i+=n.food.length*2,t+i},0)}function Rg(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>Ko&&n.push({type:oe.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const l=Be(t,e,"berryBush",je,f=>f.food.length>0),c=Be(t,e,"corpse",je,f=>f.food.length>0);let u=null;l&&c?u=U(t.position,l.position,e.mapDimensions.width,e.mapDimensions.height)<=U(t.position,c.position,e.mapDimensions.width,e.mapDimensions.height)?l:c:u=l||c,u&&n.push({type:oe.Gather,action:"gathering",key:"e",targetEntity:u})}const i=Be(t,e,"human",je,l=>er(t,l,e));if(i&&n.push({type:oe.Procreate,action:"procreating",key:"r",targetEntity:i}),t.food.length>0&&t.isAdult){const l=Be(t,e,"human",je,c=>{const u=c;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=Ko});l&&n.push({type:oe.FeedChild,action:"feeding",key:"h",targetEntity:l})}const s=Be(t,e,"human",yn,l=>fa(t,l,e))??Be(t,e,"predator",yn)??Be(t,e,"prey",yn);if(s&&n.push({type:oe.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(l=>l.type===vn.Berry).length>=so&&n.push({type:oe.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const l=Be(t,e,"building",qt,c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});l&&n.push({type:oe.Deposit,action:"idle",key:"x",targetEntity:l})}if(t.food.length<t.maxFood&&t.isAdult){const l=Be(t,e,"building",qt,c=>{const u=c;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});l&&n.push({type:oe.Retrieve,action:"idle",key:"z",targetEntity:l})}if(((a=t.heldItem)==null?void 0:a.type)===mt.Wood){const l=Be(t,e,"building",qt,c=>{const u=c;return u.buildingType===de.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});l&&n.push({type:oe.Deposit,action:"depositing",key:"x",targetEntity:l})}if(fI(t,e).canSplit&&n.push({type:oe.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const l=Be(t,e,"tree",du,c=>c.wood&&c.wood.length>0);l&&n.push({type:oe.Chop,action:"chopping",key:"c",targetEntity:l})}return n}function Nu(e){const t=Object.values(e.entities.entities),n=[],i=[],s=[],a=[],l=[],c=[],u=[];for(const m of t)switch(m.type){case"human":n.push(m);break;case"berryBush":i.push(m);break;case"corpse":s.push(m);break;case"prey":a.push(m);break;case"predator":l.push(m);break;case"building":c.push(m);break;case"tree":u.push(m);break}const f=e.mapDimensions;return{...e,search:{human:Do(n,f),berryBush:Do(i,f),corpse:Do(s,f),prey:Do(a,f),predator:Do(l,f),building:Do(c,f),tree:Do(u,f),terrainOwnership:Do(e.terrainOwnership.map((m,S)=>m===null?null:{position:Ow(S,e.mapDimensions.width),width:Re,height:Re,ownerId:m}).filter(m=>m!==null),f)}}}var wr=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(wr||{});class sO{constructor(){De(this,"worker",null);De(this,"pendingRequests",new Map);De(this,"requestQueue",[]);De(this,"isProcessing",!1);De(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case wr.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case wr.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case wr.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,i)=>{if(!this.worker){i(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:i});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),i(s)}})}queueOperation(t){return new Promise((n,i)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){i(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),i=t,s={type:wr.SAVE_REQUEST,id:n,gameState:i};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:wr.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:wr.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const Pg=new sO;async function Dg(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,roleManagerOpen:e.roleManagerOpen,armyControlOpen:e.armyControlOpen,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks};await Pg.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function aO(){try{const e=await Pg.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=Nu(t);return $l(n),n}catch(e){return console.error("Failed to load game:",e),await RI(),null}}async function RI(){try{await Pg.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const PI=Fe.createContext(void 0),lO=({initialAppState:e,children:t})=>{const[n,i]=Fe.useState(e),[s,a]=Fe.useState(void 0),[l,c]=Fe.useState(null),[u,f]=Fe.useState(!1);Fe.useEffect(()=>{aO().then(I=>{I&&c(I),f(!0)})},[]);const p=(I,A)=>{i(I),I==="gameOver"&&A?a(A):I!=="gameOver"&&a(void 0)},m=()=>{i("intro"),a(void 0),v()},S=I=>{Dg(I),c(I)},v=()=>{RI(),c(null)};return Ue.jsx(PI.Provider,{value:{appState:n,setAppState:p,returnToIntro:m,gameOverDetails:s,contextReady:u,savedGameState:l,setSavedGameState:c,saveCurrentGame:S,clearCurrentSave:v},children:t})},Xr=()=>{const e=Fe.useContext(PI);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var sn=function(){return sn=Object.assign||function(t){for(var n,i=1,s=arguments.length;i<s;i++){n=arguments[i];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},sn.apply(this,arguments)};function Yl(e,t,n){if(n||arguments.length===2)for(var i=0,s=t.length,a;i<s;i++)(a||!(i in t))&&(a||(a=Array.prototype.slice.call(t,0,i)),a[i]=t[i]);return e.concat(a||Array.prototype.slice.call(t))}var dt="-ms-",Nl="-moz-",Je="-webkit-",DI="comm",Mu="rule",Ng="decl",cO="@import",NI="@keyframes",dO="@layer",MI=Math.abs,Mg=String.fromCharCode,Dp=Object.assign;function uO(e,t){return Ft(e,0)^45?(((t<<2^Ft(e,0))<<2^Ft(e,1))<<2^Ft(e,2))<<2^Ft(e,3):0}function OI(e){return e.trim()}function Xi(e,t){return(e=t.exec(e))?e[0]:e}function xe(e,t,n){return e.replace(t,n)}function Hd(e,t,n){return e.indexOf(t,n)}function Ft(e,t){return e.charCodeAt(t)|0}function sa(e,t,n){return e.slice(t,n)}function Ni(e){return e.length}function kI(e){return e.length}function Il(e,t){return t.push(e),e}function fO(e,t){return e.map(t).join("")}function HS(e,t){return e.filter(function(n){return!Xi(n,t)})}var Ou=1,aa=1,bI=0,ei=0,Rt=0,ya="";function ku(e,t,n,i,s,a,l,c){return{value:e,root:t,parent:n,type:i,props:s,children:a,line:Ou,column:aa,length:l,return:"",siblings:c}}function Lo(e,t){return Dp(ku("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Es(e){for(;e.root;)e=Lo(e.root,{children:[e]});Il(e,e.siblings)}function hO(){return Rt}function pO(){return Rt=ei>0?Ft(ya,--ei):0,aa--,Rt===10&&(aa=1,Ou--),Rt}function pi(){return Rt=ei<bI?Ft(ya,ei++):0,aa++,Rt===10&&(aa=1,Ou++),Rt}function Lr(){return Ft(ya,ei)}function Gd(){return ei}function bu(e,t){return sa(ya,e,t)}function Np(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function gO(e){return Ou=aa=1,bI=Ni(ya=e),ei=0,[]}function mO(e){return ya="",e}function tp(e){return OI(bu(ei-1,Mp(e===91?e+2:e===40?e+1:e)))}function yO(e){for(;(Rt=Lr())&&Rt<33;)pi();return Np(e)>2||Np(Rt)>3?"":" "}function SO(e,t){for(;--t&&pi()&&!(Rt<48||Rt>102||Rt>57&&Rt<65||Rt>70&&Rt<97););return bu(e,Gd()+(t<6&&Lr()==32&&pi()==32))}function Mp(e){for(;pi();)switch(Rt){case e:return ei;case 34:case 39:e!==34&&e!==39&&Mp(Rt);break;case 40:e===41&&Mp(e);break;case 92:pi();break}return ei}function vO(e,t){for(;pi()&&e+Rt!==57;)if(e+Rt===84&&Lr()===47)break;return"/*"+bu(t,ei-1)+"*"+Mg(e===47?e:pi())}function AO(e){for(;!Np(Lr());)pi();return bu(e,ei)}function IO(e){return mO($d("",null,null,null,[""],e=gO(e),0,[0],e))}function $d(e,t,n,i,s,a,l,c,u){for(var f=0,p=0,m=l,S=0,v=0,I=0,A=1,_=1,P=1,R=0,w="",B=s,O=a,N=i,M=w;_;)switch(I=R,R=pi()){case 40:if(I!=108&&Ft(M,m-1)==58){Hd(M+=xe(tp(R),"&","&\f"),"&\f",MI(f?c[f-1]:0))!=-1&&(P=-1);break}case 34:case 39:case 91:M+=tp(R);break;case 9:case 10:case 13:case 32:M+=yO(I);break;case 92:M+=SO(Gd()-1,7);continue;case 47:switch(Lr()){case 42:case 47:Il(TO(vO(pi(),Gd()),t,n,u),u);break;default:M+="/"}break;case 123*A:c[f++]=Ni(M)*P;case 125*A:case 59:case 0:switch(R){case 0:case 125:_=0;case 59+p:P==-1&&(M=xe(M,/\f/g,"")),v>0&&Ni(M)-m&&Il(v>32?$S(M+";",i,n,m-1,u):$S(xe(M," ","")+";",i,n,m-2,u),u);break;case 59:M+=";";default:if(Il(N=GS(M,t,n,f,p,s,c,w,B=[],O=[],m,a),a),R===123)if(p===0)$d(M,t,N,N,B,a,m,c,O);else switch(S===99&&Ft(M,3)===110?100:S){case 100:case 108:case 109:case 115:$d(e,N,N,i&&Il(GS(e,N,N,0,0,s,c,w,s,B=[],m,O),O),s,O,m,c,i?B:O);break;default:$d(M,N,N,N,[""],O,0,c,O)}}f=p=v=0,A=P=1,w=M="",m=l;break;case 58:m=1+Ni(M),v=I;default:if(A<1){if(R==123)--A;else if(R==125&&A++==0&&pO()==125)continue}switch(M+=Mg(R),R*A){case 38:P=p>0?1:(M+="\f",-1);break;case 44:c[f++]=(Ni(M)-1)*P,P=1;break;case 64:Lr()===45&&(M+=tp(pi())),S=Lr(),p=m=Ni(w=M+=AO(Gd())),R++;break;case 45:I===45&&Ni(M)==2&&(A=0)}}return a}function GS(e,t,n,i,s,a,l,c,u,f,p,m){for(var S=s-1,v=s===0?a:[""],I=kI(v),A=0,_=0,P=0;A<i;++A)for(var R=0,w=sa(e,S+1,S=MI(_=l[A])),B=e;R<I;++R)(B=OI(_>0?v[R]+" "+w:xe(w,/&\f/g,v[R])))&&(u[P++]=B);return ku(e,t,n,s===0?Mu:c,u,f,p,m)}function TO(e,t,n,i){return ku(e,t,n,DI,Mg(hO()),sa(e,2,-2),0,i)}function $S(e,t,n,i,s){return ku(e,t,n,Ng,sa(e,0,i),sa(e,i+1,-1),i,s)}function BI(e,t,n){switch(uO(e,t)){case 5103:return Je+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Je+e+e;case 4789:return Nl+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Je+e+Nl+e+dt+e+e;case 5936:switch(Ft(e,t+11)){case 114:return Je+e+dt+xe(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Je+e+dt+xe(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Je+e+dt+xe(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Je+e+dt+e+e;case 6165:return Je+e+dt+"flex-"+e+e;case 5187:return Je+e+xe(e,/(\w+).+(:[^]+)/,Je+"box-$1$2"+dt+"flex-$1$2")+e;case 5443:return Je+e+dt+"flex-item-"+xe(e,/flex-|-self/g,"")+(Xi(e,/flex-|baseline/)?"":dt+"grid-row-"+xe(e,/flex-|-self/g,""))+e;case 4675:return Je+e+dt+"flex-line-pack"+xe(e,/align-content|flex-|-self/g,"")+e;case 5548:return Je+e+dt+xe(e,"shrink","negative")+e;case 5292:return Je+e+dt+xe(e,"basis","preferred-size")+e;case 6060:return Je+"box-"+xe(e,"-grow","")+Je+e+dt+xe(e,"grow","positive")+e;case 4554:return Je+xe(e,/([^-])(transform)/g,"$1"+Je+"$2")+e;case 6187:return xe(xe(xe(e,/(zoom-|grab)/,Je+"$1"),/(image-set)/,Je+"$1"),e,"")+e;case 5495:case 3959:return xe(e,/(image-set\([^]*)/,Je+"$1$`$1");case 4968:return xe(xe(e,/(.+:)(flex-)?(.*)/,Je+"box-pack:$3"+dt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Je+e+e;case 4200:if(!Xi(e,/flex-|baseline/))return dt+"grid-column-align"+sa(e,t)+e;break;case 2592:case 3360:return dt+xe(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(i,s){return t=s,Xi(i.props,/grid-\w+-end/)})?~Hd(e+(n=n[t].value),"span",0)?e:dt+xe(e,"-start","")+e+dt+"grid-row-span:"+(~Hd(n,"span",0)?Xi(n,/\d+/):+Xi(n,/\d+/)-+Xi(e,/\d+/))+";":dt+xe(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(i){return Xi(i.props,/grid-\w+-start/)})?e:dt+xe(xe(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return xe(e,/(.+)-inline(.+)/,Je+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ni(e)-1-t>6)switch(Ft(e,t+1)){case 109:if(Ft(e,t+4)!==45)break;case 102:return xe(e,/(.+:)(.+)-([^]+)/,"$1"+Je+"$2-$3$1"+Nl+(Ft(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~Hd(e,"stretch",0)?BI(xe(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return xe(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(i,s,a,l,c,u,f){return dt+s+":"+a+f+(l?dt+s+"-span:"+(c?u:+u-+a)+f:"")+e});case 4949:if(Ft(e,t+6)===121)return xe(e,":",":"+Je)+e;break;case 6444:switch(Ft(e,Ft(e,14)===45?18:11)){case 120:return xe(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Je+(Ft(e,14)===45?"inline-":"")+"box$3$1"+Je+"$2$3$1"+dt+"$2box$3")+e;case 100:return xe(e,":",":"+dt)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return xe(e,"scroll-","scroll-snap-")+e}return e}function iu(e,t){for(var n="",i=0;i<e.length;i++)n+=t(e[i],i,e,t)||"";return n}function EO(e,t,n,i){switch(e.type){case dO:if(e.children.length)break;case cO:case Ng:return e.return=e.return||e.value;case DI:return"";case NI:return e.return=e.value+"{"+iu(e.children,i)+"}";case Mu:if(!Ni(e.value=e.props.join(",")))return""}return Ni(n=iu(e.children,i))?e.return=e.value+"{"+n+"}":""}function CO(e){var t=kI(e);return function(n,i,s,a){for(var l="",c=0;c<t;c++)l+=e[c](n,i,s,a)||"";return l}}function _O(e){return function(t){t.root||(t=t.return)&&e(t)}}function wO(e,t,n,i){if(e.length>-1&&!e.return)switch(e.type){case Ng:e.return=BI(e.value,e.length,n);return;case NI:return iu([Lo(e,{value:xe(e.value,"@","@"+Je)})],i);case Mu:if(e.length)return fO(n=e.props,function(s){switch(Xi(s,i=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Es(Lo(e,{props:[xe(s,/:(read-\w+)/,":"+Nl+"$1")]})),Es(Lo(e,{props:[s]})),Dp(e,{props:HS(n,i)});break;case"::placeholder":Es(Lo(e,{props:[xe(s,/:(plac\w+)/,":"+Je+"input-$1")]})),Es(Lo(e,{props:[xe(s,/:(plac\w+)/,":"+Nl+"$1")]})),Es(Lo(e,{props:[xe(s,/:(plac\w+)/,dt+"input-$1")]})),Es(Lo(e,{props:[s]})),Dp(e,{props:HS(n,i)});break}return""})}}var RO={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Hn={},la=typeof process<"u"&&Hn!==void 0&&(Hn.REACT_APP_SC_ATTR||Hn.SC_ATTR)||"data-styled",FI="active",LI="data-styled-version",Bu="6.1.13",Og=`/*!sc*/
`,ou=typeof window<"u"&&"HTMLElement"in window,PO=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Hn!==void 0&&Hn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Hn.REACT_APP_SC_DISABLE_SPEEDY!==""?Hn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Hn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Hn!==void 0&&Hn.SC_DISABLE_SPEEDY!==void 0&&Hn.SC_DISABLE_SPEEDY!==""&&Hn.SC_DISABLE_SPEEDY!=="false"&&Hn.SC_DISABLE_SPEEDY),DO={},Fu=Object.freeze([]),ca=Object.freeze({});function UI(e,t,n){return n===void 0&&(n=ca),e.theme!==n.theme&&e.theme||t||n.theme}var HI=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),NO=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,MO=/(^-|-$)/g;function xS(e){return e.replace(NO,"-").replace(MO,"")}var OO=/(a)(d)/gi,_d=52,WS=function(e){return String.fromCharCode(e+(e>25?39:97))};function Op(e){var t,n="";for(t=Math.abs(e);t>_d;t=t/_d|0)n=WS(t%_d)+n;return(WS(t%_d)+n).replace(OO,"$1-$2")}var np,GI=5381,xs=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},$I=function(e){return xs(GI,e)};function xI(e){return Op($I(e)>>>0)}function kO(e){return e.displayName||e.name||"Component"}function ip(e){return typeof e=="string"&&!0}var WI=typeof Symbol=="function"&&Symbol.for,YI=WI?Symbol.for("react.memo"):60115,bO=WI?Symbol.for("react.forward_ref"):60112,BO={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},FO={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},zI={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},LO=((np={})[bO]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},np[YI]=zI,np);function YS(e){return("type"in(t=e)&&t.type.$$typeof)===YI?zI:"$$typeof"in e?LO[e.$$typeof]:BO;var t}var UO=Object.defineProperty,HO=Object.getOwnPropertyNames,zS=Object.getOwnPropertySymbols,GO=Object.getOwnPropertyDescriptor,$O=Object.getPrototypeOf,jS=Object.prototype;function jI(e,t,n){if(typeof t!="string"){if(jS){var i=$O(t);i&&i!==jS&&jI(e,i,n)}var s=HO(t);zS&&(s=s.concat(zS(t)));for(var a=YS(e),l=YS(t),c=0;c<s.length;++c){var u=s[c];if(!(u in FO||n&&n[u]||l&&u in l||a&&u in a)){var f=GO(t,u);try{UO(e,u,f)}catch{}}}}return e}function da(e){return typeof e=="function"}function kg(e){return typeof e=="object"&&"styledComponentId"in e}function Nr(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function kp(e,t){if(e.length===0)return"";for(var n=e[0],i=1;i<e.length;i++)n+=e[i];return n}function zl(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function bp(e,t,n){if(n===void 0&&(n=!1),!n&&!zl(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var i=0;i<t.length;i++)e[i]=bp(e[i],t[i]);else if(zl(t))for(var i in t)e[i]=bp(e[i],t[i]);return e}function bg(e,t){Object.defineProperty(e,"toString",{value:t})}function ec(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var xO=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,i=0;i<t;i++)n+=this.groupSizes[i];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var i=this.groupSizes,s=i.length,a=s;t>=a;)if((a<<=1)<0)throw ec(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(i),this.length=a;for(var l=s;l<a;l++)this.groupSizes[l]=0}for(var c=this.indexOfGroup(t+1),u=(l=0,n.length);l<u;l++)this.tag.insertRule(c,n[l])&&(this.groupSizes[t]++,c++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],i=this.indexOfGroup(t),s=i+n;this.groupSizes[t]=0;for(var a=i;a<s;a++)this.tag.deleteRule(i)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var i=this.groupSizes[t],s=this.indexOfGroup(t),a=s+i,l=s;l<a;l++)n+="".concat(this.tag.getRule(l)).concat(Og);return n},e}(),xd=new Map,ru=new Map,Wd=1,wd=function(e){if(xd.has(e))return xd.get(e);for(;ru.has(Wd);)Wd++;var t=Wd++;return xd.set(e,t),ru.set(t,e),t},WO=function(e,t){Wd=t+1,xd.set(e,t),ru.set(t,e)},YO="style[".concat(la,"][").concat(LI,'="').concat(Bu,'"]'),zO=new RegExp("^".concat(la,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),jO=function(e,t,n){for(var i,s=n.split(","),a=0,l=s.length;a<l;a++)(i=s[a])&&e.registerName(t,i)},XO=function(e,t){for(var n,i=((n=t.textContent)!==null&&n!==void 0?n:"").split(Og),s=[],a=0,l=i.length;a<l;a++){var c=i[a].trim();if(c){var u=c.match(zO);if(u){var f=0|parseInt(u[1],10),p=u[2];f!==0&&(WO(p,f),jO(e,p,u[3]),e.getTag().insertRules(f,s)),s.length=0}else s.push(c)}}},XS=function(e){for(var t=document.querySelectorAll(YO),n=0,i=t.length;n<i;n++){var s=t[n];s&&s.getAttribute(la)!==FI&&(XO(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function VO(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var XI=function(e){var t=document.head,n=e||t,i=document.createElement("style"),s=function(c){var u=Array.from(c.querySelectorAll("style[".concat(la,"]")));return u[u.length-1]}(n),a=s!==void 0?s.nextSibling:null;i.setAttribute(la,FI),i.setAttribute(LI,Bu);var l=VO();return l&&i.setAttribute("nonce",l),n.insertBefore(i,a),i},KO=function(){function e(t){this.element=XI(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var i=document.styleSheets,s=0,a=i.length;s<a;s++){var l=i[s];if(l.ownerNode===n)return l}throw ec(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),qO=function(){function e(t){this.element=XI(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var i=document.createTextNode(n);return this.element.insertBefore(i,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),ZO=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),VS=ou,QO={isServer:!ou,useCSSOMInjection:!PO},su=function(){function e(t,n,i){t===void 0&&(t=ca),n===void 0&&(n={});var s=this;this.options=sn(sn({},QO),t),this.gs=n,this.names=new Map(i),this.server=!!t.isServer,!this.server&&ou&&VS&&(VS=!1,XS(this)),bg(this,function(){return function(a){for(var l=a.getTag(),c=l.length,u="",f=function(m){var S=function(P){return ru.get(P)}(m);if(S===void 0)return"continue";var v=a.names.get(S),I=l.getGroup(m);if(v===void 0||!v.size||I.length===0)return"continue";var A="".concat(la,".g").concat(m,'[id="').concat(S,'"]'),_="";v!==void 0&&v.forEach(function(P){P.length>0&&(_+="".concat(P,","))}),u+="".concat(I).concat(A,'{content:"').concat(_,'"}').concat(Og)},p=0;p<c;p++)f(p);return u}(s)})}return e.registerId=function(t){return wd(t)},e.prototype.rehydrate=function(){!this.server&&ou&&XS(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(sn(sn({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var i=n.useCSSOMInjection,s=n.target;return n.isServer?new ZO(s):i?new KO(s):new qO(s)}(this.options),new xO(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(wd(t),this.names.has(t))this.names.get(t).add(n);else{var i=new Set;i.add(n),this.names.set(t,i)}},e.prototype.insertRules=function(t,n,i){this.registerName(t,n),this.getTag().insertRules(wd(t),i)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(wd(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),JO=/&/g,ek=/^\s*\/\/.*$/gm;function VI(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(i){return"".concat(t," ").concat(i)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=VI(n.children,t)),n})}function tk(e){var t,n,i,s=ca,a=s.options,l=a===void 0?ca:a,c=s.plugins,u=c===void 0?Fu:c,f=function(S,v,I){return I.startsWith(n)&&I.endsWith(n)&&I.replaceAll(n,"").length>0?".".concat(t):S},p=u.slice();p.push(function(S){S.type===Mu&&S.value.includes("&")&&(S.props[0]=S.props[0].replace(JO,n).replace(i,f))}),l.prefix&&p.push(wO),p.push(EO);var m=function(S,v,I,A){v===void 0&&(v=""),I===void 0&&(I=""),A===void 0&&(A="&"),t=A,n=v,i=new RegExp("\\".concat(n,"\\b"),"g");var _=S.replace(ek,""),P=IO(I||v?"".concat(I," ").concat(v," { ").concat(_," }"):_);l.namespace&&(P=VI(P,l.namespace));var R=[];return iu(P,CO(p.concat(_O(function(w){return R.push(w)})))),R};return m.hash=u.length?u.reduce(function(S,v){return v.name||ec(15),xs(S,v.name)},GI).toString():"",m}var nk=new su,Bp=tk(),KI=Mi.createContext({shouldForwardProp:void 0,styleSheet:nk,stylis:Bp});KI.Consumer;Mi.createContext(void 0);function Fp(){return Fe.useContext(KI)}var ik=function(){function e(t,n){var i=this;this.inject=function(s,a){a===void 0&&(a=Bp);var l=i.name+a.hash;s.hasNameForId(i.id,l)||s.insertRules(i.id,l,a(i.rules,l,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,bg(this,function(){throw ec(12,String(i.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Bp),this.name+t.hash},e}(),ok=function(e){return e>="A"&&e<="Z"};function KS(e){for(var t="",n=0;n<e.length;n++){var i=e[n];if(n===1&&i==="-"&&e[0]==="-")return e;ok(i)?t+="-"+i.toLowerCase():t+=i}return t.startsWith("ms-")?"-"+t:t}var qI=function(e){return e==null||e===!1||e===""},ZI=function(e){var t,n,i=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!qI(a)&&(Array.isArray(a)&&a.isCss||da(a)?i.push("".concat(KS(s),":"),a,";"):zl(a)?i.push.apply(i,Yl(Yl(["".concat(s," {")],ZI(a),!1),["}"],!1)):i.push("".concat(KS(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in RO||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return i};function Vo(e,t,n,i){if(qI(e))return[];if(kg(e))return[".".concat(e.styledComponentId)];if(da(e)){if(!da(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return Vo(s,t,n,i)}var a;return e instanceof ik?n?(e.inject(n,i),[e.getName(i)]):[e]:zl(e)?ZI(e):Array.isArray(e)?Array.prototype.concat.apply(Fu,e.map(function(l){return Vo(l,t,n,i)})):[e.toString()]}function QI(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(da(n)&&!kg(n))return!1}return!0}var rk=$I(Bu),sk=function(){function e(t,n,i){this.rules=t,this.staticRulesId="",this.isStatic=(i===void 0||i.isStatic)&&QI(t),this.componentId=n,this.baseHash=xs(rk,n),this.baseStyle=i,su.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,i){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,i):"";if(this.isStatic&&!i.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=Nr(s,this.staticRulesId);else{var a=kp(Vo(this.rules,t,n,i)),l=Op(xs(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,l)){var c=i(a,".".concat(l),void 0,this.componentId);n.insertRules(this.componentId,l,c)}s=Nr(s,l),this.staticRulesId=l}else{for(var u=xs(this.baseHash,i.hash),f="",p=0;p<this.rules.length;p++){var m=this.rules[p];if(typeof m=="string")f+=m;else if(m){var S=kp(Vo(m,t,n,i));u=xs(u,S+p),f+=S}}if(f){var v=Op(u>>>0);n.hasNameForId(this.componentId,v)||n.insertRules(this.componentId,v,i(f,".".concat(v),void 0,this.componentId)),s=Nr(s,v)}}return s},e}(),Bg=Mi.createContext(void 0);Bg.Consumer;var op={};function ak(e,t,n){var i=kg(e),s=e,a=!ip(e),l=t.attrs,c=l===void 0?Fu:l,u=t.componentId,f=u===void 0?function(B,O){var N=typeof B!="string"?"sc":xS(B);op[N]=(op[N]||0)+1;var M="".concat(N,"-").concat(xI(Bu+N+op[N]));return O?"".concat(O,"-").concat(M):M}(t.displayName,t.parentComponentId):u,p=t.displayName,m=p===void 0?function(B){return ip(B)?"styled.".concat(B):"Styled(".concat(kO(B),")")}(e):p,S=t.displayName&&t.componentId?"".concat(xS(t.displayName),"-").concat(t.componentId):t.componentId||f,v=i&&s.attrs?s.attrs.concat(c).filter(Boolean):c,I=t.shouldForwardProp;if(i&&s.shouldForwardProp){var A=s.shouldForwardProp;if(t.shouldForwardProp){var _=t.shouldForwardProp;I=function(B,O){return A(B,O)&&_(B,O)}}else I=A}var P=new sk(n,S,i?s.componentStyle:void 0);function R(B,O){return function(N,M,F){var x=N.attrs,Z=N.componentStyle,te=N.defaultProps,j=N.foldedComponentIds,ie=N.styledComponentId,re=N.target,_e=Mi.useContext(Bg),ue=Fp(),ne=N.shouldForwardProp||ue.shouldForwardProp,z=UI(M,_e,te)||ca,V=function(Pe,me,Oe){for(var Ne,ce=sn(sn({},me),{className:void 0,theme:Oe}),Se=0;Se<Pe.length;Se+=1){var $e=da(Ne=Pe[Se])?Ne(ce):Ne;for(var Ie in $e)ce[Ie]=Ie==="className"?Nr(ce[Ie],$e[Ie]):Ie==="style"?sn(sn({},ce[Ie]),$e[Ie]):$e[Ie]}return me.className&&(ce.className=Nr(ce.className,me.className)),ce}(x,M,z),K=V.as||re,b={};for(var Y in V)V[Y]===void 0||Y[0]==="$"||Y==="as"||Y==="theme"&&V.theme===z||(Y==="forwardedAs"?b.as=V.forwardedAs:ne&&!ne(Y,K)||(b[Y]=V[Y]));var le=function(Pe,me){var Oe=Fp(),Ne=Pe.generateAndInjectStyles(me,Oe.styleSheet,Oe.stylis);return Ne}(Z,V),pe=Nr(j,ie);return le&&(pe+=" "+le),V.className&&(pe+=" "+V.className),b[ip(K)&&!HI.has(K)?"class":"className"]=pe,b.ref=F,Fe.createElement(K,b)}(w,B,O)}R.displayName=m;var w=Mi.forwardRef(R);return w.attrs=v,w.componentStyle=P,w.displayName=m,w.shouldForwardProp=I,w.foldedComponentIds=i?Nr(s.foldedComponentIds,s.styledComponentId):"",w.styledComponentId=S,w.target=i?s.target:e,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(B){this._foldedDefaultProps=i?function(O){for(var N=[],M=1;M<arguments.length;M++)N[M-1]=arguments[M];for(var F=0,x=N;F<x.length;F++)bp(O,x[F],!0);return O}({},s.defaultProps,B):B}}),bg(w,function(){return".".concat(w.styledComponentId)}),a&&jI(w,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function qS(e,t){for(var n=[e[0]],i=0,s=t.length;i<s;i+=1)n.push(t[i],e[i+1]);return n}var ZS=function(e){return Object.assign(e,{isCss:!0})};function JI(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(da(e)||zl(e))return ZS(Vo(qS(Fu,Yl([e],t,!0))));var i=e;return t.length===0&&i.length===1&&typeof i[0]=="string"?Vo(i):ZS(Vo(qS(i,t)))}function Lp(e,t,n){if(n===void 0&&(n=ca),!t)throw ec(1,t);var i=function(s){for(var a=[],l=1;l<arguments.length;l++)a[l-1]=arguments[l];return e(t,n,JI.apply(void 0,Yl([s],a,!1)))};return i.attrs=function(s){return Lp(e,t,sn(sn({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},i.withConfig=function(s){return Lp(e,t,sn(sn({},n),s))},i}var eT=function(e){return Lp(ak,e)},Ot=eT;HI.forEach(function(e){Ot[e]=eT(e)});var lk=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=QI(t),su.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,i,s){var a=s(kp(Vo(this.rules,n,i,s)),""),l=this.componentId+t;i.insertRules(l,l,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,i,s){t>2&&su.registerId(this.componentId+t),this.removeStyles(t,i),this.createStyles(t,n,i,s)},e}();function ck(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=JI.apply(void 0,Yl([e],t,!1)),s="sc-global-".concat(xI(JSON.stringify(i))),a=new lk(i,s),l=function(u){var f=Fp(),p=Mi.useContext(Bg),m=Mi.useRef(f.styleSheet.allocateGSInstance(s)).current;return f.styleSheet.server&&c(m,u,f.styleSheet,p,f.stylis),Mi.useLayoutEffect(function(){if(!f.styleSheet.server)return c(m,u,f.styleSheet,p,f.stylis),function(){return a.removeStyles(m,f.styleSheet)}},[m,u,f.styleSheet,p,f.stylis]),null};function c(u,f,p,m,S){if(a.isStatic)a.renderStyles(u,DO,p,S);else{var v=sn(sn({},f),{theme:UI(f,m,l.defaultProps)});a.renderStyles(u,v,p,S)}}return Mi.memo(l)}function tT(e,t){var n=Fe.useRef(null),i=Fe.useRef(!1),s=Fe.useRef(e);s.current=e;var a=Fe.useCallback(function(c){i.current&&(s.current(c),n.current=requestAnimationFrame(a))},[]),l=Fe.useMemo(function(){return[function(){i.current&&(i.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){i.current||(i.current=!0,n.current=requestAnimationFrame(a))},function(){return i.current}]},[]);return Fe.useEffect(function(){return l[0]},[]),l}var hn=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(hn||{}),Ur=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(Ur||{}),pn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(pn||{});const Up={},Hp={},dk=[{key:hn.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:hn.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>v_,isCompleted:!1,minDisplayTime:mS,highlightedUIElements:[Ur.HUNGER_BAR]},{key:hn.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!Be(t,e,"berryBush",je*5,i=>i.food.length>0),getTargets:(e,t)=>{const n=[];for(const i of Object.values(e.entities.entities))i.type==="berryBush"&&i.food.length>0&&U(t.position,i.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(i);return n.map(i=>i.id)},isCompleted:!1,minDisplayTime:mS},{key:hn.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=Be(t,e,"berryBush",je,i=>i.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:hn.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[Ur.FOOD_BAR]},{key:hn.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>Pn(e,t).length>0,getTargets:(e,t)=>{const n=Be(t,e,"human",je,i=>er(t,i,e));return n?[n.id]:[]},isCompleted:!1},{key:hn.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>Rg(e,t).some(i=>i.type===oe.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:hn.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[Ur.COMMAND_BUTTONS],isCompleted:!1},{key:hn.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:hn.AUTOPILOT},{key:hn.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=Be(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=Be(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:hn.ANIMALS_INTRODUCTION},{key:hn.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!Be(t,e,"predator",120),getTargets:(e,t)=>{const n=Be(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:hn.HUNT_PREY}].map(e=>({...e,condition:e.condition?hk(e.condition):void 0,getTargets:e.getTargets?pk(e.getTargets):void 0}));function nT(){return{steps:dk.map(e=>({...e,isCompleted:!1}))}}function iT(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:pn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function uk(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function fk(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const i=St(e);if(!i){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=pn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/hP;switch(n.transitionState){case pn.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=pn.ACTIVE);break;case pn.ACTIVE:{const u=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),f=Up[s.condition];f&&u&&f(e,i)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=pn.FADING_OUT);break}case pn.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const c=uk(e);c!==null?(n.currentStepIndex=c,n.transitionState=pn.FADING_IN):(n.isActive=!1,n.transitionState=pn.INACTIVE)}break}if(n.transitionState!==pn.FADING_OUT&&n.transitionState!==pn.INACTIVE){const c=Hp[s.getTargets||""];c?n.highlightedEntityIds=[...c(e,i)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function hk(e){const t=`condition_${Object.keys(Up).length+1}`;return Up[t]=e,t}function pk(e){const t=`getTargets_${Object.keys(Hp).length+1}`;return Hp[t]=e,t}function gk(){const e=CI(),t=0;for(let S=0;S<Yv;S++){const v={x:Math.random()*Ke,y:Math.random()*Qe};Jl(e,v,t)}for(let S=0;S<wv;S++){const v={x:Math.random()*Ke,y:Math.random()*Qe};xl(e,v,t)}const n=Ke/2,i=Qe/2;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,I=100+Math.random()*100,A={x:n+Math.cos(v)*I,y:i+Math.sin(v)*I};xl(e,A,t,Qo)}const s=$s(e,{x:n-25,y:i},t,"male",!0),a=$s(e,{x:n+25,y:i},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:$n[0]},s.aiType=Gt.TaskBased,a.aiType=Gt.TaskBased;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,I=Ke/2,A=Qe/2,_={x:n+Math.cos(v)*I,y:i+Math.sin(v)*A},P=$s(e,{x:_.x,y:_.y},t,"male",!1);P.leaderId=P.id,P.tribeInfo={tribeBadge:qd[S%qd.length],tribeColor:$n[S%$n.length]};const R=$s(e,{x:_.x+50,y:_.y},t,"female",!1);R.leaderId=P.id,R.tribeInfo=P.tribeInfo}for(let S=0;S<PA;S++){const v={x:n+Ke*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};ia(e,v,"male",void 0,void 0,Hl()),ia(e,{x:v.x+20,y:v.y},"female",void 0,void 0,Hl())}const l={x:n+Ke*(Math.random()-Math.random()),y:i+Qe*(Math.random()-Math.random())};oa(e,l,"male",void 0,void 0,Gl()),oa(e,{x:l.x+20,y:l.y},"female",void 0,void 0,Gl());const c=[{id:"muteButton",action:ae.ToggleMute,currentWidth:Qi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Ut},{id:"pauseButton",action:ae.TogglePause,currentWidth:Qi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Ut},{id:"returnToIntroButton",action:ae.ReturnToIntro,currentWidth:Qi,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:Ut}],u=nT(),f=iT(),p={time:t,entities:e,mapDimensions:{width:Ke,height:Qe},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:AA,isMuted:!1,uiButtons:c,tutorial:u,tutorialState:f,debugPanel:ze.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:Gr.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:Or,preyProcreationCooldown:kr,predatorGestationPeriod:br,predatorProcreationCooldown:Br,preyHungerIncreasePerHour:$o,predatorHungerIncreasePerHour:xo,berryBushSpreadChance:no},soilDepletion:Xv(),temperature:qA(Ke,Qe),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ke/Re)*Math.ceil(Qe/Re)).fill(null),tasks:{}},m=Nu(p);return console.log("Game world initialized:",m),m}function mk(){const e=CI(),t=0;for(let u=0;u<Yv;u++){const f={x:Math.random()*Ke,y:Math.random()*Qe};Jl(e,f,t)}for(let u=0;u<wv;u++){const f={x:Math.random()*Ke,y:Math.random()*Qe};xl(e,f,t)}const n=Ke/2,i=Qe/2;for(let u=0;u<5;u++){const f=u/5*Math.PI*2,p=100+Math.random()*100,m={x:n+Math.cos(f)*p,y:i+Math.sin(f)*p};xl(e,m,t,Qo)}for(let u=0;u<DC;u++){const f={x:Math.random()*Ke,y:Math.random()*Qe},p=Math.random()<.5?"male":"female";$s(e,f,t,p,!1)}for(let u=0;u<PA;u++){const f={x:Math.random()*Ke,y:Math.random()*Qe};ia(e,f,"male",void 0,void 0,Hl()),ia(e,{x:f.x+20,y:f.y},"female",void 0,void 0,Hl())}const s={x:Math.random()*Ke,y:Math.random()*Qe};oa(e,s,"male",void 0,void 0,Gl()),oa(e,{x:s.x+20,y:s.y},"female",void 0,void 0,Gl());const a=nT(),l=iT(),c={time:t,entities:e,mapDimensions:{width:Ke,height:Qe},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:Ke/2,y:Qe/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,roleManagement:!0,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,roleManagerOpen:!1,armyControlOpen:!1,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:AA,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:l,debugPanel:ze.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:Or,preyProcreationCooldown:kr,predatorGestationPeriod:br,predatorProcreationCooldown:Br,preyHungerIncreasePerHour:$o,predatorHungerIncreasePerHour:xo,berryBushSpreadChance:no},soilDepletion:Xv(),temperature:qA(Ke,Qe),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(Ke/Re)*Math.ceil(Qe/Re)).fill(null),tasks:{}};return Nu(c)}const yk="humanProcreation",Sk="human",vk="human",Ak=je,Ik=(e,t,n)=>er(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,Tk=(e,t,n)=>{var u,f,p,m;const{gameState:i}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,l=e.gender==="female"?e:t,c=(a.partnerIds||[]).length===0;if(((u=e.stateMachine)==null?void 0:u[0])!==Dr&&(e.stateMachine=[Dr,{partnerId:t.id,previousState:(f=e.stateMachine)==null?void 0:f[0],procreationEndTime:n.gameState.time+1}]),((p=t.stateMachine)==null?void 0:p[0])!==Dr&&(t.stateMachine=[Dr,{partnerId:e.id,previousState:(m=t.stateMachine)==null?void 0:m[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),c&&a.leaderId&&a.leaderId!==a.id){const S=i.entities.entities[a.leaderId];if(S){const v=Pp(a,S),I=Pp(l,S);if(!v&&!I){const A=Qd();a.leaderId=a.id,a.tribeInfo={tribeBadge:A,tribeColor:$n[Math.floor(Math.random()*$n.length)]},a.tribeRole=J.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&l){const S=Qd();a.leaderId=a.id,a.tribeInfo={tribeBadge:S,tribeColor:$n[Math.floor(Math.random()*$n.length)]},a.tribeRole=J.Leader,a.tribeControl={roleWeights:{gatherer:1,planter:1,hunter:1,mover:1,warrior:1,leader:0},diplomacy:{},armyControl:{protectHomeland:5,expandBorders:5,invadeEnemies:5}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}e.activeAction=void 0,Ge(i,Ee.Procreation,s,Ll),Ge(i,Ee.Partnered,e.position,qe,e.id),Ge(i,Ee.Partnered,t.position,qe,t.id),e.lastPartneredEffectTime=i.time,t.lastPartneredEffectTime=i.time,t.activeAction=void 0,Me(n,Ce.Procreate,s)},Ek={id:yk,sourceType:Sk,targetType:vk,maxDistance:Ak,checker:Ik,perform:Tk},Ck={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:fu,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Ko&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-Ko),e.feedChildCooldownTime=D_,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ee.ChildFed,t.position,qe,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,Ce.ChildFed,t.position)}},_k={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:yn,checker:(e,t,n)=>{var p,m,S;if(((p=e.stateMachine)==null?void 0:p[0])!==Zo||e.attackTargetId!==t.id)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=ro,a=!s&&i<=yn;if(!s&&!a||(s?((m=e.attackCooldown)==null?void 0:m.melee)||0:((S=e.attackCooldown)==null?void 0:S.ranged)||0)>0)return!1;const c=s?hu:Zp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>ro,l=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),c=y_(rt(l),t.direction);if(Math.abs(c)<x_*Math.PI/180&&Math.random()<W_)Ge(i,Ee.AttackDeflected,t.position,qe,t.id);else{let p=a?qp:Kp;if(e.gender==="male"&&(p*=H_),e.isAdult||(p*=G_),(!t.isAdult||t.age>=Vp)&&e.isAdult&&(p*=$_),a){const S=s/Qp;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+S,data:{attackerId:e.id,targetId:t.id,damage:p,pushbackForce:eg,attackerPosition:{...e.position}}}),Ge(i,Ee.StoneProjectile,e.position,S,void 0,t.position,t.id),Me(n,Ce.Attack,e.position)}else{t.hitpoints-=p,t.movementSlowdown={modifier:gu,endTime:i.time+mu},Ge(i,Ee.Hit,t.position,qe,t.id);const S=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),v=Et(S,B_);t.forces.push(v),t.hitpoints<=0?Me(n,Ce.HumanDeath,t.position):Me(n,Ce.Attack,e.position),Ge(i,Ee.Attack,e.position,qe,e.id)}}e.attackCooldown={melee:pu,ranged:Jp};const f=e.stateMachine[1];f.attackStartTime=i.time}},wk={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:Ct*2,checker:(e,t,{gameState:n})=>U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const i=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(i===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const a=(e.radius+t.radius-i)*.05,l=rt(m_(e.position,t.position)),c=Et(l,a);e.forces.push(c),t.forces.push(Et(c,-1))}},Rk={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:Ct*.6+ql*.4,checker:(e,t,{gameState:n})=>{var c;const i=(c=t.stateMachine)==null?void 0:c[0];if(i==="fallen"||i==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const c=l*2.5,u=rt(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=Et(u,c);e.forces.push(f)}},Pk={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:Ct*.6+ql*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const c=l*2.5,u=rt(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=Et(u,c);e.forces.push(f)}},Dk={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:Ct*.6+ql*.4,checker:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4;return U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+i},perform:(e,t,{gameState:n})=>{const i=t.radius*.25,s=e.radius*.4,a=U(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+i-a;if(l<=0)return;const c=l*2.5,u=rt(Xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),f=Et(u,c);e.forces.push(f)}},Nk={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:je,checker:(e,t,n)=>{var i;return e.isAdult&&t.food.length>0&&((i=e.stateMachine)==null?void 0:i[0])===ha&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Ge(n.gameState,Ee.BushClaimed,t.position,qe),Me(n,Ce.Gather,e.position)}},Mk={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:je,checker:(e,t,n)=>{var i;return e.isAdult&&t.food.length>0&&((i=e.stateMachine)==null?void 0:i[0])===ha&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const i=t.food.pop();i&&e.food.push(i),e.gatheringCooldownTime=n.gameState.time+1,Me(n,Ce.Gather,e.position)}},Ok={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:je,checker:(e,t,n)=>{var i,s;return e.isAdult&&((i=t.stateMachine)==null?void 0:i[0])===Ht&&t.wood.length>0&&((s=e.stateMachine)==null?void 0:s[0])===ha&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const i=t.wood.pop();i&&(e.heldItem=i),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[oo,{enteredAt:n.gameState.time,previousState:Ht}]),Me(n,Ce.Gather,e.position)}},kk=[Nk,Mk,Ok],bk={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:mn,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=bR,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+kR,Ge(n.gameState,Ee.BushClaimed,t.position,qe,e.id),Me(n,Ce.Gather,e.position))}},Bk={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:Ps,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=GR;const i=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=Et(i,8);t.forces.push(s),e.huntCooldown=WR,t.hitpoints<=0?(Me(n,Ce.HumanDeath,t.position),Ge(n.gameState,Ee.Hit,t.position,qe,t.id)):(Ge(n.gameState,Ee.Hit,t.position,qe,t.id),t.fleeCooldown=5,Me(n,Ce.Attack,e.position)),Ge(n.gameState,Ee.Attack,e.position,qe,e.id)}},Fk={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:yn,checker:(e,t,n)=>{var p,m,S;if(((p=e.stateMachine)==null?void 0:p[0])!==Zo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=ro,a=!s&&i<=yn;if(!s&&!a||(s?((m=e.attackCooldown)==null?void 0:m.melee)||0:((S=e.attackCooldown)==null?void 0:S.ranged)||0)>0)return!1;const c=s?hu:Zp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>ro;let l=(a?qp:Kp)*1.2;if(e.gender==="male"&&(l*=1.3),a){const u=s/Qp;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+u,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:eg,attackerPosition:{...e.position}}}),Ge(i,Ee.StoneProjectile,e.position,u,void 0,t.position,t.id),Me(n,Ce.Attack,e.position)}else{t.hitpoints-=l;const u=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),f=Et(u,6);t.forces.push(f),t.hitpoints<=0?(Me(n,Ce.HumanDeath,t.position),Ge(i,Ee.Hit,t.position,qe,t.id)):(Ge(i,Ee.Hit,t.position,qe,t.id),t.fleeCooldown=8,Me(n,Ce.Attack,e.position)),Ge(i,Ee.Attack,e.position,qe,e.id)}e.attackCooldown={melee:pu,ranged:Jp};const c=e.stateMachine[1];c.attackStartTime=i.time}},Lk={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:fi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=wA;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:gu,endTime:n.gameState.time+mu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Et(s,7);t.forces.push(a),e.attackCooldown=RA,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-hg),Me(n,Ce.HumanDeath,t.position),Ge(n.gameState,Ee.Hit,t.position,qe,t.id)):(Ge(n.gameState,Ee.Hit,t.position,qe,t.id),Me(n,Ce.Attack,e.position)),Ge(n.gameState,Ee.Attack,e.position,qe,e.id)}},Uk={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:yn,checker:(e,t,n)=>{var p,m,S;if(((p=e.stateMachine)==null?void 0:p[0])!==Zo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const i=U(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=i<=ro,a=!s&&i<=yn;if(!s&&!a||(s?((m=e.attackCooldown)==null?void 0:m.melee)||0:((S=e.attackCooldown)==null?void 0:S.ranged)||0)>0)return!1;const c=s?hu:Zp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=c},perform:(e,t,n)=>{const{gameState:i}=n,s=U(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),a=s>ro;let l=(a?qp:Kp)*.8;e.gender==="male"&&(l*=1.2);const c=Object.values(i.entities.entities).filter(f=>f.type==="human"&&f.id!==e.id).filter(f=>{const p=f;return Math.sqrt(Math.pow(p.position.x-e.position.x,2)+Math.pow(p.position.y-e.position.y,2))<100&&p.activeAction==="attacking"&&p.attackTargetId===t.id}).length;if(c>0&&(l*=1+c*.2),a){const f=s/Qp;i.scheduledEvents.push({id:i.nextScheduledEventId++,type:"ranged-impact",scheduledTime:i.time+f,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:eg,attackerPosition:{...e.position}}}),Ge(i,Ee.StoneProjectile,e.position,f,void 0,t.position,t.id),Me(n,Ce.Attack,e.position)}else{t.hitpoints-=l;const f=Xe(e.position,t.position,i.mapDimensions.width,i.mapDimensions.height),p=Et(f,8);t.forces.push(p),t.hitpoints<=0?(Me(n,Ce.HumanDeath,t.position),Ge(i,Ee.Hit,t.position,qe,t.id)):(Ge(i,Ee.Hit,t.position,qe,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),Me(n,Ce.Attack,e.position)),Ge(i,Ee.Attack,e.position,qe,e.id)}e.attackCooldown={melee:pu,ranged:Jp};const u=e.stateMachine[1];u.attackStartTime=i.time}},Hk={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:mn,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Ge(n.gameState,Ee.Procreation,i.position,qe,i.id),Me(n,Ce.Procreate,i.position)}},Gk={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:jo,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const i=e.gender==="female"?e:t;i.isPregnant=!0,i.pregnancyFatherId=e.gender==="male"?e.id:t.id,i.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Ge(n.gameState,Ee.Procreation,i.position,qe,i.id),Me(n,Ce.Procreate,i.position)}},$k={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:pa,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Kd&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-Kd),e.feedChildCooldownTime=DA,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ee.ChildFed,t.position,qe,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,Ce.ChildFed,t.position)}},xk={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:pa,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Kd&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-Kd),e.feedChildCooldownTime=DA,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Ge(n.gameState,Ee.ChildFed,t.position,qe,t.id),t.lastChildFedEffectTime=n.gameState.time),Me(n,Ce.ChildFed,t.position)}},Wk={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:jo,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-hg),e.eatingCooldownTime=n.gameState.time+2,Ge(n.gameState,Ee.Eating,e.position,qe,e.id),Me(n,Ce.Gather,e.position))}},Yk={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:fi,checker:(e,t,n)=>{var i;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((i=n.gameState.entities.entities[t.attackTargetId])==null?void 0:i.type)==="predator"))},perform:(e,t,n)=>{let i=wA;e.hunger>120&&(i*=1.3),t.hitpoints-=i,t.movementSlowdown={modifier:gu,endTime:n.gameState.time+mu};const s=Xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=Et(s,7);t.forces.push(a),e.attackCooldown=RA,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-hg),Me(n,Ce.HumanDeath,t.position),Ge(n.gameState,Ee.Hit,t.position,qe,t.id)):(Ge(n.gameState,Ee.Hit,t.position,qe,t.id),Me(n,Ce.Attack,e.position)),Ge(n.gameState,Ee.Attack,e.position,qe,e.id)}},zk={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>{var f,p;const i=t.buildingType===de.StorageSpot,s=t.buildingType===de.Bonfire;if(!i&&!s||((f=e.stateMachine)==null?void 0:f[0])!==El||!t.isConstructed)return!1;const a=e.food.length>0,l=((p=e.heldItem)==null?void 0:p.type)===mt.Wood;if(s&&!l||!a&&!l)return!1;const c=t.storageCapacity??0;return!(t.storedItems.length>=c||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<oD)},perform:(e,t,n)=>{var s;let i=null;if(t.buildingType===de.Bonfire?((s=e.heldItem)==null?void 0:s.type)===mt.Wood&&(i=e.heldItem,e.heldItem=void 0):e.heldItem?(i=e.heldItem,e.heldItem=void 0):i=e.food.pop()??null,i&&(t.storedItems.push({item:i,positionOffset:iI(t)}),t.buildingType===de.Bonfire)){const a=$t(e,n.gameState);a&&a.aiBlackboard&&QA(a.aiBlackboard,t.id,"wood")}t.lastDepositTime=n.gameState.time,Me(n,Ce.StorageDeposit,t.position)}},jk={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>{var s;return!(t.buildingType!=="storageSpot"||((s=e.stateMachine)==null?void 0:s[0])!==Cl||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<rD)},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&(e.food.push(i.item),iI(t)),t.lastRetrieveTime=n.gameState.time,Me(n,Ce.StorageRetrieve,t.position)}},Xk={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:qt,checker:(e,t,n)=>{var c,u;if(t.buildingType!=="storageSpot"||((c=e.stateMachine)==null?void 0:c[0])!==ha||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const i=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!i||!((u=i.tribeControl)!=null&&u.diplomacy)||(t.ownerId?i.tribeControl.diplomacy[t.ownerId]:void 0)!==Lt.Hostile||n.gameState.time-(t.lastStealTime??0)<sD)return!1;const l=Dn({leaderId:t.ownerId},n.gameState);for(const f of l)if(U(e.position,f.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=aD)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const i=t.storedItems.pop();(i==null?void 0:i.item.itemType)==="food"&&e.food.push(i.item),t.lastStealTime=n.gameState.time,Me(n,Ce.StorageSteal,t.position),Ge(n.gameState,Ee.Attack,t.position,.5)}},Vk={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!Xt(e,t,n.gameState)||!rA(t.position,qs,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,cA(t.position,qs,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Ge(n.gameState,Ee.BushClaimed,t.position,2,t.id)}},Kk={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!Xt(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Ge(n.gameState,Ee.Hit,t.position,1,t.id)}},qk={id:"supplyTransfer",sourceType:"human",targetType:"human",maxDistance:je,checker:(e,t)=>!(e.activeAction!=="depositing"||t.activeAction!=="retrieving"||e.leaderId!==t.leaderId||e.food.length===0||t.food.length>=t.maxFood),perform:(e,t,n)=>{var l;const i=Math.min(((l=e.activeActionPayload)==null?void 0:l.amount)||1,e.food.length,t.maxFood-t.food.length),s=e.food.splice(0,i);t.food.push(...s);const a=$t(t,n.gameState);a&&a.aiBlackboard&&QA(a.aiBlackboard,t.id,"food"),e.activeAction="idle",e.target=void 0,e.activeActionPayload=void 0,t.activeAction="idle",t.target=void 0,Me(n,Ce.StorageDeposit,t.position)}},Zk={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:du,checker:(e,t,n)=>{var a;const[i]=t.stateMachine??[],s=i===rn||i===Vt||i===Sn;return e.isAdult&&s&&((a=e.stateMachine)==null?void 0:a[0])===dg&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{var s;const{gameState:i}=n;if(t.stateMachine=[Ht,{enteredAt:i.time,previousState:(s=t.stateMachine)==null?void 0:s[0]}],!t.woodGenerated){const a=Math.min(1,t.age/Qo),l=Math.floor(sS+a*(vu-sS));t.wood=Array.from({length:l},()=>({itemType:"item",type:mt.Wood,id:i.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=i.time+1,Me(n,Ce.Gather,e.position)}},Qk=[wk,Rk,Pk,Dk,...kk,Ek,Ck,_k,zk,jk,Xk,Vk,Kk,qk,Zk,bk,$k,xk,Wk,Bk,Fk,Uk,Lk,Yk,Hk,Gk],Jk=Object.values(Qk.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;return e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]}),e[n].interactions.push(t),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));function eb(e){const{gameState:t}=e,n=t,{width:i,height:s}=t.mapDimensions;for(const a of Jk){const l=n.search[a.sourceType].all();for(const c of l){const u=n.search[a.targetType].byRadius(c.position,a.maxDistance);for(const f of u){if(c.id===f.id)continue;const p=U(c.position,f.position,i,s);for(const m of a.interactions)p<=m.maxDistance&&m.checker(c,f,e)&&m.perform(c,f,e)}}}}function oT(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function tb(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),i=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,p=50+Math.random()*100;a={x:Math.max(50,Math.min(Ke-50,u.position.x+Math.cos(f)*p)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*p))}}else a={x:50+Math.random()*(Ke-100),y:50+Math.random()*(Qe-100)};let l=!0;const c=100;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){l=!1;break}if(l){for(const u of i)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){l=!1;break}}if(l)return a}return{x:Ke*.3+Math.random()*Ke*.4,y:Qe*.3+Math.random()*Qe*.4}}function nb(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],f=Math.random()*2*Math.PI,p=100+Math.random()*150;a={x:Math.max(50,Math.min(Ke-50,u.position.x+Math.cos(f)*p)),y:Math.max(50,Math.min(Qe-50,u.position.y+Math.sin(f)*p))}}else a={x:50+Math.random()*(Ke-100),y:50+Math.random()*(Qe-100)};let l=!0;const c=150;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<c){l=!1;break}if(l)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*Ke,y:50+Math.random()*100};case 1:return{x:Ke-150+Math.random()*100,y:Math.random()*Qe};case 2:return{x:Math.random()*Ke,y:Qe-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Qe}}}function ib(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let i=0;i<20;i++){const s={x:50+Math.random()*(Ke-100),y:50+Math.random()*(Qe-100)};let a=!0;const l=80,c=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<l){a=!1;break}if(a){for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){a=!1;break}}if(a)return s}return{x:Math.random()*Ke,y:Math.random()*Qe}}function rT(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=tb(n),a=i%2===0?"male":"female";ia(e.entities,s,a,void 0,void 0,Hl())}}function sT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let i=0;i<t;i++){const s=nb(n),a=i%2===0?"male":"female";oa(e.entities,s,a,void 0,void 0,Gl())}}function ob(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count();let s=!1;return n===0&&(rT(e,6),s=!0),i===0&&(sT(e,3),s=!0),s}function rb(e){const t=e,n=t.search.prey.count(),i=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const l=Math.max(2,Math.floor(8-n));rT(e,l),a=!0}if(i>0&&i<2){const l=Math.max(1,Math.floor(3-i));sT(e,l),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let l=0;l<5;l++){const c=ib(t);Jl(e.entities,c,e.time)}a=!0}return a}const sb=1,ab=.3,lb=.8,QS=.8,cb=.99,db=.05;var aT=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.NO_ACTION=14]="NO_ACTION",e))(aT||{});const rp=Object.keys(aT).length/2;class ub{constructor(){De(this,"qTable",new Map);De(this,"epsilon",QS);De(this,"lastState",null);De(this,"lastAction",null)}discretizeState(t,n,i){const s=Math.min(4,Math.floor(t/25)),a=Math.min(4,Math.floor(n/5)),l=Math.min(4,Math.floor(i/15));return`${s}-${a}-${l}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,i){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,i)}getBestAction(t){let n=0,i=this.getQValue(t,0);for(let s=1;s<rp;s++){const a=this.getQValue(t,s);a>i&&(i=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*rp):this.getBestAction(t)}applyEmergencyCorrections(t,n,i,s){t<Ji*.5&&(s.ecosystem.preyGestationPeriod=Math.max(bs,s.ecosystem.preyGestationPeriod*.8),s.ecosystem.preyProcreationCooldown=Math.max(Bs,s.ecosystem.preyProcreationCooldown*.8),s.ecosystem.preyHungerIncreasePerHour=Math.max(Us,s.ecosystem.preyHungerIncreasePerHour*.9)),n<eo*.6&&(s.ecosystem.predatorGestationPeriod=Math.max(Fs,s.ecosystem.predatorGestationPeriod*.75),s.ecosystem.predatorProcreationCooldown=Math.max(Ls,s.ecosystem.predatorProcreationCooldown*.75),s.ecosystem.predatorHungerIncreasePerHour=Math.max(Hs,s.ecosystem.predatorHungerIncreasePerHour*.85)),i<to*.5&&(s.ecosystem.berryBushSpreadChance=Math.min(ml,s.ecosystem.berryBushSpreadChance*1.2)),t>Ji*1.4&&(s.ecosystem.preyHungerIncreasePerHour=Math.min($o,s.ecosystem.preyHungerIncreasePerHour*1.05)),n>eo*1.4&&(s.ecosystem.predatorHungerIncreasePerHour=Math.min(xo,s.ecosystem.predatorHungerIncreasePerHour*1.05)),i>to*1.4&&(s.ecosystem.berryBushSpreadChance=Math.max(no,s.ecosystem.berryBushSpreadChance*.95))}calculateReward(t,n,i){const s=Math.abs(t-Ji),a=Math.abs(n-eo),l=Math.abs(i-to),c=s/Ji,u=a/eo,f=l/to,p=c+u+f;return 100*Math.exp(-p*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(Or,n.ecosystem.preyGestationPeriod+.2*(Or-bs));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(bs,n.ecosystem.preyGestationPeriod-.2*(Or-bs));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(kr,n.ecosystem.preyProcreationCooldown+.2*(kr-Bs));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max(Bs,n.ecosystem.preyProcreationCooldown-.2*(kr-Bs));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min($o,n.ecosystem.preyHungerIncreasePerHour+.2*($o-Us));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(Us,n.ecosystem.preyHungerIncreasePerHour-.2*($o-Us));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(br,n.ecosystem.predatorGestationPeriod+.2*(br-Fs));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max(Fs,n.ecosystem.predatorGestationPeriod-.2*(br-Fs));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min(Br,n.ecosystem.predatorProcreationCooldown+.2*(Br-Ls));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(Ls,n.ecosystem.predatorProcreationCooldown-.2*(Br-Ls));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(xo,n.ecosystem.predatorHungerIncreasePerHour+.2*(xo-Hs));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(Hs,n.ecosystem.predatorHungerIncreasePerHour-.2*(xo-Hs));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(ml,n.ecosystem.berryBushSpreadChance+.2*(ml-no));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(no,n.ecosystem.berryBushSpreadChance-.2*(ml-no));break}}updateQTable(t,n,i,s){const a=this.getQValue(t,n),l=Math.max(...Array.from({length:rp},(u,f)=>this.getQValue(s,f))),c=a+ab*(i+lb*l-a);this.setQValue(t,n,c)}step(t){const n=t,i=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count();this.applyEmergencyCorrections(i,s,a,t);const l=this.discretizeState(i,s,a);if(this.lastState!==null&&this.lastAction!==null){const u=this.calculateReward(i,s,a);this.updateQTable(this.lastState,this.lastAction,u,l)}const c=this.chooseAction(l);this.applyAction(c,t),this.epsilon=Math.max(db,this.epsilon*cb),this.lastState=l,this.lastAction=c}reset(){this.qTable.clear(),this.epsilon=QS,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let lT=new ub;function fb(e){ob(e),rb(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=bs+(Or-bs)*.3,e.ecosystem.preyProcreationCooldown=Bs+(kr-Bs)*.3,e.ecosystem.preyHungerIncreasePerHour=Us+($o-Us)*.3,e.ecosystem.predatorGestationPeriod=Fs+(br-Fs)*.3,e.ecosystem.predatorProcreationCooldown=Ls+(Br-Ls)*.3,e.ecosystem.predatorHungerIncreasePerHour=Hs+(xo-Hs)*.3,e.ecosystem.berryBushSpreadChance=no+(ml-no)*.7),lT.step(e)}function hb(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<sb)&&(e.ecosystem.lastUpdateTime=e.time,fb(e))}function pb(){return lT.getStats()}function gb(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function mb(e){const{gameState:t}=e,n=t.time,i=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of i)switch(a.type){case"ranged-impact":{const l=t.entities.entities[a.data.targetId];if(!l||l.hitpoints<=0)continue;l.hitpoints-=a.data.damage,l.movementSlowdown={modifier:gu,endTime:t.time+mu};const c=Xe(a.data.attackerPosition,l.position,t.mapDimensions.width,t.mapDimensions.height),u=Et(c,a.data.pushbackForce);l.forces.push(u),Ge(t,Ee.Hit,l.position,qe,l.id),l.hitpoints<=0?Me(e,Ce.HumanDeath,l.position):Me(e,Ce.Attack,l.position);break}}}function yb(e){var a,l;const{gameState:t}=e,i=t.search.human.all(),s=new Set;for(const c of i)c.leaderId&&c.leaderId===c.id&&s.add(c.id);for(const c of s){const u=t.entities.entities[c];if(!u)continue;const f=Dn(u,t);if(f.length<Ig)continue;const p=f.filter(v=>v.isAdult);if(p.length===0)continue;const m=Object.values(t.tasks).filter(v=>v.creatorEntityId===c),S=v=>m.some(I=>I.type===v);if(!S(ge.HumanPlaceStorage)){const v=Yr(c,t,!0),I=ag(c,t,!0);if(v.length===0||I>gp){const _=v.length===0?Bv:zs,P=Vs(de.StorageSpot,c,t,Vi,_,u.position);P&&Rd(c,ge.HumanPlaceStorage,P,t)}}if(!S(ge.HumanPlaceBonfire)){const v=xr(c,t,!0),I=ao(c,t),_=na(t.temperature,I,t.time,t.mapDimensions.width,t.mapDimensions.height)<tA&&v.length===0,P=v.length>0&&v.length<Math.ceil(p.length/nA);let R;const w=f.filter(B=>na(t.temperature,B.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<js+5?v.every(M=>U(B.position,M.position,t.mapDimensions.width,t.mapDimensions.height)>Xs*1.5):!1);if(w.length>=3){const B=w.reduce((N,M)=>N+M.position.x,0)/w.length,O=w.reduce((N,M)=>N+M.position.y,0)/w.length;R={x:B,y:O}}if(_||P||R){const B=Vs(de.Bonfire,c,t,Vi,zs,R||u.position);B&&Rd(c,ge.HumanPlaceBonfire,B,t)}}if(!S(ge.HumanPlacePlantingZone)){const I=Vl(c,t,!0).reduce((_,P)=>_+lg(P),0),A=Math.max(ks,p.length*mp);if(I<A){const _=Vs(de.PlantingZone,c,t,Vi,zs,u.position);_&&Rd(c,ge.HumanPlacePlantingZone,_,t)}}if(!S(ge.HumanPlaceBorderPost)&&(((l=(a=u.tribeControl)==null?void 0:a.armyControl)==null?void 0:l.expandBorders)??0)>=2){const I=dA(u.position,c,t);I&&Rd(c,ge.HumanPlaceBorderPost,I,t)}}}function Rd(e,t,n,i){const s=`${ge[t]}-${e}-${i.time.toFixed(2)}`;i.tasks[s]={id:s,type:t,creatorEntityId:e,target:n,validUntilTime:i.time+12}}const Sb=1/60;function vb(e,t){const n=St(e);n&&(e.viewportCenter=zp(e.viewportCenter,n.position,Yp*t))}function Lu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(Dg(e),e.lastAutosaveTime=n)}for(;t>0;){const n=Nu(e),i=Math.min(t,Sb),s=i*(Tt/Pt);n.time+=s,vb(n,i),K_(n),hb(n),Vw(n),kP(n),q_(n),mb({gameState:n}),GM({gameState:n,deltaTime:i}),eb({gameState:n,deltaTime:i}),Math.floor(n.time)>Math.floor(n.time-s)&&(tO(n),yb({gameState:n})),oT(n),fk(n,i),gb(n),e=n,t-=i}return e}function sp(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,c=LA;if(e.beginPath(),e.moveTo(i+c,s),e.lineTo(i+a-c,s),e.quadraticCurveTo(i+a,s,i+a,s+c),e.lineTo(i+a,s+l-c),e.quadraticCurveTo(i+a,s+l,i+a-c,s+l),e.lineTo(i+c,s+l),e.quadraticCurveTo(i,s+l,i,s+l-c),e.lineTo(i,s+c),e.quadraticCurveTo(i,s,i+c,s),e.closePath(),e.fillStyle=t.isDisabled?UA:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*xA)+1)/2;e.strokeStyle=$A,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<Zd){const f=1-u/Zd;e.fillStyle=GA,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=mg,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?HA:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function Ab(e,t,n,i){e.save(),e.font=`${dS}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,l=dS,c=a+uS*2,u=l+uS*2,f=i.x-c/2,p=e.canvas.height,m=t.y<p/2?t.y+t.height-fS:t.y-u+fS;e.fillStyle=K1,e.fillRect(f,m,c,u),e.fillStyle=q1,e.fillText(n,i.x,m+u/2+l/2),e.restore()}function Ib(e,t,n){e.save();const i=St(t),s=[{id:"fastForwardButton",action:ae.FastForward,text:"FFWD [T]",currentWidth:Qi*1.3,backgroundColor:Ho,textColor:Ut,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:ae.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?gd:Ho,currentWidth:t.isPaused?Qi*1.4:Qi*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:Ut},{id:"muteButton",action:ae.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?gd:Ho,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:Qi,rect:{x:0,y:0,width:0,height:0},textColor:Ut},{id:"returnToIntroButton",action:ae.ReturnToIntro,text:"EXIT",backgroundColor:Ho,tooltip:"Return to Main Menu [ESC]",currentWidth:Qi*.9,rect:{x:0,y:0,width:0,height:0},textColor:Ut}];if(t.uiButtons.push(...s),i){const f=Rg(t,i),p=new Set(f.map(R=>R.type));let m=[{playerAction:oe.Gather,buttonAction:ae.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>i.isAdult===!0},{playerAction:oe.Eat,buttonAction:ae.CommandEat,shortcut:"F",name:"Eat"},{playerAction:oe.Plant,buttonAction:ae.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>i.isAdult===!0},{playerAction:oe.Procreate,buttonAction:ae.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>i.isAdult===!0},{playerAction:oe.FeedChild,buttonAction:ae.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>i.isAdult===!0},{playerAction:oe.Attack,buttonAction:ae.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>i.isAdult===!0&&i.leaderId===i.id},{playerAction:oe.ArmyControl,buttonAction:ae.OpenArmyControl,shortcut:"V",name:"Army Control",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Bi(i.id,t).length>tD},{playerAction:oe.TribeSplit,buttonAction:ae.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>i.leaderId!==void 0&&i.leaderId!==i.id&&i.isAdult===!0},{playerAction:oe.Build,buttonAction:ae.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Bi(i.id,t).length>Ig},{playerAction:oe.Build,buttonAction:ae.OpenRoleManager,shortcut:"U",name:"Roles",toggleKey:"roleManagement",condition:()=>i.isAdult===!0&&i.leaderId===i.id&&Tu(i,t)}];m=m.filter(R=>R.condition?R.condition():!0);const S=1,v=m.length,I=v*Ln+(v-1)*yr,A=S*Ln+(S-1)*yr,_=(n-I)/2,P=e.canvas.height-A-20;if(m.forEach((R,w)=>{const B=w%v,O=Math.floor(w/v),N=_+B*(Ln+yr),M=P+O*(Ln+yr),F=!!R.toggleKey,x=F&&t.autopilotControls.behaviors[R.toggleKey],Z=!p.has(R.playerAction),j=R.playerAction===oe.Build&&t.buildMenuOpen,ie=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",re=F?`${R.name}${ie}`:R.name,_e=x||j||R.buttonAction===ae.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)?gd:Ho,ue={id:`commandButton_${R.name}`,action:R.buttonAction,rect:{x:N,y:M,width:Ln,height:Ln},icon:R.buttonAction===ae.OpenRoleManager?"":_u[R.playerAction],text:R.shortcut,backgroundColor:_e,textColor:Ut,currentWidth:Ln,tooltip:re,isDisabled:Z,activated:x||R.buttonAction===ae.CommandBuild&&j||R.buttonAction===ae.OpenRoleManager&&(t.roleManagerOpen||t.autopilotControls.behaviors.roleManagement)};t.uiButtons.push(ue)}),t.buildMenuOpen){const R=[{id:"buildMenu_storageSpot",action:ae.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:ae.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_bonfire",action:ae.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:ae.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:ae.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"}],w=R.length,B=w*Ln+(w-1)*yr,O=(n-B)/2,N=P-Ln-yr;R.forEach((M,F)=>{const x=O+F*(Ln+yr),Z=N,te=M.action===ae.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||M.action===ae.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||M.action===ae.SelectBorderPost&&t.selectedBuildingType==="borderPost"||M.action===ae.SelectBonfire&&t.selectedBuildingType==="bonfire"||M.action===ae.SelectRemovalTool&&t.selectedBuildingType==="removal",j={id:M.id,action:M.action,rect:{x,y:Z,width:Ln,height:Ln},icon:M.icon,text:M.shortcut,backgroundColor:te?gd:Ho,textColor:Ut,currentWidth:Ln,tooltip:M.name,activated:te};t.uiButtons.push(j),sp(e,j,t.hoveredButtonId===j.id)})}}let a=n-et;s.forEach(f=>{const p=et,m=a-f.currentWidth;f.rect={x:m,y:p,width:f.currentWidth,height:FA},sp(e,f,t.hoveredButtonId===f.id),a-=f.currentWidth+V1});let l=null;t.uiButtons.filter(f=>f.id.startsWith("commandButton_")||f.id.startsWith("buildMenu_")).forEach(f=>{l||(l={x:f.rect.x,y:f.rect.y,width:f.rect.width,height:f.rect.height}),l.x=Math.min(l.x,f.rect.x),l.y=Math.min(l.y,f.rect.y),l.width=Math.max(l.width,f.rect.x+f.rect.width-l.x),l.height=Math.max(l.height,f.rect.y+f.rect.height-l.y),f.id.startsWith("commandButton_")&&sp(e,f,t.hoveredButtonId===f.id)});const u=t.hoveredButtonId?t.uiButtons.find(f=>f.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&Ab(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:l}}function Tb(e){e.save(),e.fillStyle=rP,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=sP,e.font=`${aP}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function Gp(e,t,n,i){const s=t.x-n.width/2,a=t.y-n.height/2,l=s+e.x,c=a+e.y,u=(l%i.width+i.width)%i.width,f=(c%i.height+i.height)%i.height;return{x:u,y:f}}function tc(e,t,n,i){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>i.width/2&&(s=s-Math.sign(s)*i.width),Math.abs(a)>i.height/2&&(a=a-Math.sign(a)*i.height),{x:s+n.width/2,y:a+n.height/2}}function Ws(e,t,n,i){const s=tc(e.position,t,n,i),l=("radius"in e?e.radius:20)+20;return s.x>=-l&&s.x<=n.width+l&&s.y>=-l&&s.y<=n.height+l}function Jn(e,t,n,i,s,...a){const l={...s.position};for(let c=-n;c<=n;c+=n)for(let u=-t;u<=t;u+=t)s.position.x=l.x+u,s.position.y=l.y+c,i(e,s,...a);s.position=l}const Eb=25,Cb=0,JS=28;function cT(e,t,n,i,s,a,l,c,u,f){e.save();const{x:p,y:m}=tc(t,l,{width:c,height:u},f);e.strokeStyle=i,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(p,m,n+Au,0,2*Math.PI),e.stroke(),e.restore()}function _b(e,t,n,i,s,a,l){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&cT(e,m.targetEntity.position,m.targetEntity.radius,pg,gg,2,i,s,a,l)}),e.font=`${ta}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:c,y:u}=tc(n.position,i,{width:s,height:a},l);let f=0,p={};t.forEach(m=>{const S=_u[m.type];if(m.targetEntity){p[m.targetEntity.id]=(p[m.targetEntity.id]||0)+1;const v=m.targetEntity.position.x-i.x+s/2,I=m.targetEntity.position.y-i.y+a/2,A=`${S}${m.key.toUpperCase()}`,_=I-m.targetEntity.radius-Au-ta/2-(p[m.targetEntity.id]-1)*JS;e.fillText(A,v,_)}else{e.textAlign="left";const v=`${S}${m.key.toUpperCase()}`,I=c+Eb,_=u+Cb+f*JS;e.fillText(v,I,_),f++,e.textAlign="center"}}),e.restore()}const Le=(e,t,n,i,s,a,l)=>{a==="transparent"||i<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*l),Math.floor(n*l),Math.ceil(i*l),Math.ceil(s*l)))},ev=10,tv=10,wi=6,ji=4,Pd=2,wb=5,Qn=4,Rb=2,tn=4,Pb=2,ft=3,Cs=2,Uo=0,Ml=Uo+ji-1,un=Ml,It=Ml+Qn-1,Db="rgba(0, 0, 0, 0.4)",Nb=4,Mb=1,Fg={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,i,s,a,l,c="male",u=20,f=[1,0],p=!1,m=0){const S=["dead","stunned"].includes(l),v=S?tv+4:ev,I=S?ev+4:tv+ft,A=.15,_=Math.min(i*(1-2*A)/v,s*(1-2*A)/I),P=v*_,R=I*_,w=t+(i-P)/2,B=n+(s-R)/2;e.save(),f[0]<0&&!S?(e.translate(w+P,B),e.scale(-1,1)):e.translate(w,B);const N="#D09A5A",M=u>50?"#BDBDBD":"#281808",F="#7F5C4A",x="#6B4F3A",Z="#E0D8C0",te="#A0522D",j=1-Math.max(0,Math.min(100,m))/100*.2,ie=c==="male"?1.1:.9,re=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let _e=wb*j*ie*re,ue=Rb*j*ie*re,ne=Pb*j*re;p&&c==="female"&&(_e*=1.5);const z=Math.round((v-_e)/2),V=Math.round((v-wi)/2),K=z-ue,b=z+_e,Y=1,le=z+(_e/2-Y/2)-ne,pe=z+(_e/2+Y/2),Pe=f[1]<-.2&&Math.abs(f[0])<.7,me=ce=>{e.fillStyle=Db,e.beginPath();const Se=v/2,$e=ce;e.ellipse(Math.floor(Se*_),Math.floor($e*_),Math.max(1,Math.floor(Nb*_)),Math.max(1,Math.floor(Mb*_)),0,0,2*Math.PI),e.fill()},Oe=(ce,Se)=>{c==="male"?(Le(e,z,Ml+ce,_e,Qn-Cs,Se,_),Le(e,z,Ml+Qn-Cs+ce,_e,Cs,F,_)):Le(e,z,Ml+ce,_e,Qn,x,_)},Ne=(ce,Se)=>{Pe?Le(e,V,Uo+ce,wi,ji,M,_):(Le(e,V,Uo+ce,wi,ji,Se,_),Le(e,V,Uo+ce,wi,Pd,M,_),c==="female"?(Le(e,V-1,Uo+Pd+ce,1,ji,M,_),Le(e,V+wi,Uo+Pd+ce,1,ji,M,_)):Le(e,V+1,Uo+2+ce,wi-2,ji-2,M,_))};switch(l){case"idle":{const ce=a*Math.PI*2,Se=Math.sin(ce)*.5,Ie=(Math.cos(ce*2)+1)*.25;me(It+ft+1),Le(e,le+Se,It+Ie,ne,ft,N,_),Le(e,pe-Se,It+Ie,ne,ft,N,_),Oe(Ie,N),Le(e,K,un+Ie,ue,tn,N,_),Le(e,b,un+Ie,ue,tn,N,_),Ne(Ie,N);break}case"walk":{const ce=a*Math.PI*2,Se=Math.sin(ce)*2,Ie=Math.abs(Math.cos(ce))*1;me(It+ft+1),Le(e,le+Se,It+Ie,ne,ft,N,_),Le(e,pe-Se,It+Ie,ne,ft,N,_),Oe(Ie,N),Le(e,K-Se,un+Ie,ue,tn,N,_),Le(e,b+Se,un+Ie,ue,tn,N,_),Ne(Ie,N);break}case"gathering":{const ce=a*Math.PI*2,Se=1,$e=(Math.sin(ce)+1)/2*2,Ie=Se+Math.abs(Math.cos(ce))*.5;me(It+ft+1),Le(e,le,It+Ie,ne,ft-Se,N,_),Le(e,pe,It+Ie,ne,ft-Se,N,_),Oe(Ie,N),Le(e,K+1,un+Ie-$e,ue,tn,N,_),Le(e,b-1,un+Ie-$e,ue,tn,N,_),Ne(Ie,N);break}case"eat":{me(It+ft+1),Le(e,le,It+1,ne,ft-1,N,_),Le(e,pe,It+1,ne,ft-1,N,_),Oe(1,N);const $e=(Math.sin(a*Math.PI*4)+1)/2,Ie=V+wi/2,ni=Uo+ji/2,nt=b+(Ie-b)*$e,at=un+1+(ni-(un+1))*$e;Le(e,K,un+1,ue,tn,N,_),Le(e,nt,at,ue,tn,N,_),Le(e,nt,at-1,1,1,te,_),Ne(1,N);break}case"procreate":{const ce=(Math.sin(a*Math.PI*8)+1)/4,Se=(Math.sin(a*Math.PI*6)+1)*.5,$e=1.5,Ie=$e-Se;me(It+ft+1),Le(e,le,It+Ie,ne,ft-$e,N,_),Le(e,pe,It+Ie,ne,ft-$e,N,_),Oe(Ie,N),Le(e,K,un+Ie,ue,tn,N,_),Le(e,b,un+Ie,ue,tn,N,_),Ne(Ie,N),e.globalAlpha=ce,Oe(Ie,"white"),e.globalAlpha=1;break}case"attacking":{const ce=Math.sin(a*Math.PI)*1.5,Se=Math.abs(Math.sin(a*Math.PI));me(It+ft+1),Le(e,le-ce,It+Se,ne,ft,N,_),Le(e,pe+ce*.5,It+Se,ne,ft,N,_),Oe(Se,N),Le(e,K,un+Se-2,ue,tn,N,_),Le(e,b,un+Se-2.5,ue,tn,N,_),Ne(Se,N);break}case"defending":{me(It+ft+1),Le(e,le,It+1,ne,ft-1,N,_),Le(e,pe,It+1,ne,ft-1,N,_),Oe(1,N),Le(e,K-1,un+1-1,ue,tn,N,_),Le(e,b+1,un+1-1,ue,tn,N,_),Ne(1,N);break}case"stunned":case"dead":{const ce=l==="dead",Se=ce?Math.min(1,a):0,$e=Se>.5?Z:N,Ie=c==="male"?F:x,ni=Se>.8?"transparent":M,nt=v/2,at=I/2,gi=2;me(I-1),Le(e,nt-ne-gi,at,ne,ft,$e,_),Le(e,nt+gi,at,ne,ft,$e,_),Le(e,nt-ue-gi,at-Qn+1,ue,tn,$e,_),Le(e,nt+gi,at-Qn+1,ue,tn,$e,_);const An=nt-_e/2,Wn=at-Qn/2;c==="male"?(Se<.7&&Le(e,An,Wn+Qn-Cs,_e,Cs,Ie,_),Le(e,An,Wn,_e,Qn-Cs,$e,_)):Se<.7?Le(e,An,Wn,_e,Qn,Ie,_):Le(e,An,Wn,_e,Qn,$e,_);const mi=nt-wi/2,yi=at-Qn/2-ji+1;if(Le(e,mi,yi,wi,ji,$e,_),ni!=="transparent"&&Le(e,mi,yi,wi,Pd,ni,_),ce&&Se>.6){const lo="#B0A890";for(let nr=0;nr<3;nr++)Le(e,An+1,Wn+nr*1+1,_e-2,.5,lo,_)}break}default:Le(e,0,0,v,I,"magenta",_);break}e.restore()}};function Ob(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function jl(e,t,n,i,s,a=!1,l=!1,c=!1,u=!1){i<Xp&&(n=n*.75),Fg.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,i,[0,0],!1,0);let f,p;a?(f=H1,p=OA):l?(f=G1,p=BA):c?(f=$1,p=bA):u&&(f=x1,p=kA),f&&p&&Ob(e,t,n/2,f,p)}function kb(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s,c=4;let u;const f=l+(i.length-1)*c;i.length>1&&f>a?u=(a-l)/(i.length-1):u=c,i.length<=1&&(u=0);for(let p=0;p<i.length;p++){const{member:m,isPlayer:S,isHeir:v,isPartner:I,isParent:A}=i[p],_=t+p*(s+u)+s/2,P=n+s/4;jl(e,{x:_,y:P},s,m.age,m.gender,S,v,I,A)}e.restore()}function bb(e,t,n,i,s){if(n.length===0)return;e.save();const a=Ei,l=" 00",c=" 00";e.font=`${Yh}px "Press Start 2P", Arial`;const u=e.measureText(l).width,f=e.measureText(c).width,p=Ei+qn+Ei+qn+Ei+Mo+u+Ei/2+Mo+f,m=n.length*pd+(n.length-1)*lS,S=s-m-Ei;e.fillStyle=Y1,e.fillRect(a,S,p,m);for(let v=0;v<n.length;v++){const I=n[v],A=S+v*(pd+lS),_=A+pd/2;I.isPlayerTribe&&(e.fillStyle=W1,e.fillRect(a,A,p,pd));let P=a+Ei;if(e.font=`${qn}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillText(I.tribeBadge,P,_-qn/4),P+=qn+Ei,!I.isPlayerTribe){const R=I.diplomacyStatus===Lt.Friendly?"":"",w=`diplomacyButton_${I.leaderId}`,B={x:P-2,y:_-qn/2-2,width:qn+4,height:qn+4},O={id:w,action:ae.ToggleDiplomacy,rect:B,text:"",icon:R,backgroundColor:"transparent",textColor:"white",currentWidth:qn,tooltip:`Toggle diplomacy with this tribe (Currently: ${I.diplomacyStatus})`,targetTribeId:I.leaderId};t.uiButtons.push(O),t.hoveredButtonId===w&&(e.fillStyle=mg,e.globalAlpha=.5,e.fillRect(B.x,B.y,B.width,B.height),e.globalAlpha=1),e.font=`${qn*.8}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="center",e.fillText(R,P+qn/2,_)}P+=qn+Ei,I.adultCount>0&&(jl(e,{x:P+Mo/2,y:_},Mo,25,"male"),P+=Mo/2,e.font=`${Yh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${I.adultCount}`,P,_),P+=e.measureText(` ${I.adultCount}`).width+Ei/2),I.childCount>0&&(jl(e,{x:P+Mo/2,y:_},Mo,1,"female"),P+=Mo/2,e.font=`${Yh}px "Press Start 2P", Arial`,e.fillStyle="white",e.textBaseline="middle",e.textAlign="left",e.fillText(` ${I.childCount}`,P,_))}e.restore()}function Bb(e,t,n,i,s){const a=jA,l=XA,c=t+i-a-l,u=n+l;e.save(),e.lineWidth=2,e.strokeStyle=s?yP:mP,e.beginPath();const f=5;e.moveTo(c+f,u+f),e.lineTo(c+a-f,u+a-f),e.moveTo(c+a-f,u+f),e.lineTo(c+f,u+a-f),e.stroke(),e.restore()}function Fb(e,t,n,i){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===pn.INACTIVE)return;const l=a.steps[s.currentStepIndex];if(!l)return;e.save(),e.globalAlpha=s.transitionAlpha;const c=lP,u=cP,f=dP,p=`${Xh}px "Press Start 2P", Arial`,m=`${gS}px "Press Start 2P", Arial`,S=fP,v=gS*1.5;e.font=m;const I=l.text.split(" ");let A="";const _=[];for(let Z=0;Z<I.length;Z++){const te=A+I[Z]+" ";e.measureText(te).width>c-u*2&&Z>0?(_.push(A),A=I[Z]+" "):A=te}_.push(A);const P=u*2+Xh+u/2+_.length*v,R=(n-c)/2,w=i-P-160;e.fillStyle=uP,e.beginPath(),e.moveTo(R+f,w),e.lineTo(R+c-f,w),e.quadraticCurveTo(R+c,w,R+c,w+f),e.lineTo(R+c,w+P-f),e.quadraticCurveTo(R+c,w+P,R+c-f,w+P),e.lineTo(R+f,w+P),e.quadraticCurveTo(R,w+P,R,w+P-f),e.lineTo(R,w+f),e.quadraticCurveTo(R,w,R+f,w),e.closePath(),e.fill(),e.fillStyle=S,e.textAlign="center",e.textBaseline="top",e.font=p,e.fillText(l.title,R+c/2,w+u),e.font=m;let B=w+u+Xh+u/2;for(const Z of _)e.fillText(Z,R+c/2,B),B+=v;const O=t.hoveredButtonId==="tutorial-dismiss";Bb(e,R,w,c,O),e.restore();const N=jA,M=XA,F=R+c-N-M,x=w+M;return{x:F,y:x,width:N,height:N}}function ap(e,t,n){e.save();const i=gP,s={x:t.x-i,y:t.y-i,width:t.width+i*2,height:t.height+i*2};e.strokeStyle=YA,e.lineWidth=zA+Math.sin(n*yg)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function Lb(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const dT=10,Ub=3,nv=dT*.7;function Hb(e,t){const{position:n,food:i,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,dT,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),i.length>0){const a=Math.PI*2/Math.min(i.length,s);for(let l=0;l<i.length;l++){const c=l*a,u=n.x+nv*Math.cos(c),f=n.y+nv*Math.sin(c);e.beginPath(),e.arc(u,f,Ub,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const iv=(e,t,n=70,i=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${i}%)`},Gb=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[i,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${i}, ${s}%, ${Math.max(0,a-t)}%)`},Dd=(e,t,n,i,s,a,l,c=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=c?Gb(l,15):l,e.beginPath(),e.roundRect(-i/2,0,i,s,i/2),e.fill(),e.restore()},lp=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),i=75;if(!n)return`hsl(0, 0%, ${i}%)`;const[,s,a,l]=n.map(Number),c=a*(1-t),u=l+(i-l)*t;return`hsl(${s}, ${c}%, ${u}%)`},uT={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,i,s,a,l,c={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=i*.15,f=t+i/2,p=n+s/2,m=i-u*2,S=s-u*2,{gender:v,age:I,direction:A,isPregnant:_,hungryLevel:P,geneCode:R}=c,w=.8+Math.min(I,10)/10*.4,B=v==="male"?1.05:.95,O=1-P/100*.3,N=m*.5*O*w*B;let M=S*.3*w*B;const F=m*.15*w*B,x=N*.2,Z=S*.3,te=iv(R,0,30,50);let j=iv(R,8,50,40);if(I>45){const me=Math.min(1,(I-45)/15);j=lp(j,me)}e.translate(f,p),A[0]<0&&e.scale(-1,1);const ie=Math.sin(a*Math.PI*2),re=Math.cos(a*Math.PI*2),_e=Z+M*.2;if(l==="dead"){const me=Math.min(a,1);e.translate(0,S*.2),e.rotate(Math.PI/2);const Oe=lp(j,me),Ne=lp(te,me);e.globalAlpha=.5+me*.5,e.strokeStyle=Oe,e.lineWidth=x*.5,e.beginPath(),e.moveTo(-N*.4,0),e.lineTo(N*.4,0),e.stroke();for(let ce=-1;ce<=1;ce+=1)e.beginPath(),e.arc(0,0,M*.4,Math.PI*.4*ce-Math.PI*.2,Math.PI*.4*ce+Math.PI*.2),e.stroke();e.fillStyle=Ne,e.beginPath(),e.arc(N*.5,0,F,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(N*.55,0,F*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,_e,N*.7,N*.25,0,0,2*Math.PI),e.fill();let ue=0,ne=0,z=0,V=0,K=0,b=0;switch(l){case"idle":ne=ie*(S*.02),z=ie*.05,V=-ie*.05,K=-ie*.05,b=ie*.05;break;case"walk":ne=Math.abs(re)*(S*-.04),z=ie*.7,V=-ie*.7,K=-ie*.7,b=ie*.7;break;case"eat":ue=S*.1,ne=S*.05,ue+=ie*(S*.02);break;case"procreate":ne=S*.05;const me=(1-re)*-m*.05;e.translate(me,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}_&&v==="female"&&(M*=1.6);const Y=ne,le=Y-M*.2;Dd(e,N*-.35,le,x,Z,K,j,!0),Dd(e,N*.35,le,x,Z,b,j,!0),e.fillStyle=j,e.beginPath(),e.ellipse(0,Y,N/2,M/2,0,0,2*Math.PI),e.fill();const pe=N*.45,Pe=le+ue;e.fillStyle=te,e.beginPath(),e.arc(pe,Pe,F,0,Math.PI*2),e.fill(),A[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(pe+F*.3,Pe-F*.2,F*.15,0,Math.PI*2),e.fill()),Dd(e,N*-.35,le,x,Z,z,j),Dd(e,N*.35,le,x,Z,V,j),e.restore()}};function $b(e,t){let[n,i,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),i=Math.max(0,i-t),s=Math.max(0,s-t),`rgb(${n}, ${i}, ${s})`}function xb(e){const t=(e&16711680)>>16,n=(e&65280)>>8,i=e&255,s=`rgb(${t}, ${n}, ${i})`,a=$b(s,40),l=(e&255)%100+50,c=(e>>8&255)%100,u=(e>>16&255)%100,f=`rgb(${l}, ${c}, ${u})`,p=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:f,eyeColor:p}}const fT={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,i,s,a,l,c={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:f,direction:p,isPregnant:m,hungryLevel:S,geneCode:v}=c;e.save();const I=i*.15,A=Math.max(1,Math.floor((i-I*2)/10)),_=p[0]<0;e.translate(t+i/2,n+s/2),_&&e.scale(-1,1);const P=xb(v),R=.8+Math.min(f,20)/20*.4,w=u==="male"?1.05:.95,B=1-S/100*.25,O=R*w*B,N=Math.max(0,Math.min(1,(f-15)/5));e.filter=`grayscale(${N})`;const M=P.furColor,F=P.darkerFurColor,x=P.eyeColor,Z="#FFFFFF",te="#c75c5c",j="#E0E0E0",ie="#A0A0A0",re=s/2-2*A,_e=Math.sin(a*Math.PI*2),ue=Math.abs(_e);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,re,A*4,A,0,0,2*Math.PI),e.fill(),e.filter="none",l==="dead"){const nt=Math.min(1,a*2);e.save(),e.translate(0,re-A*3),e.rotate(-Math.PI/2);const at=(gi,An,Wn,mi,yi=!1)=>{e.fillStyle=yi?ie:j,e.fillRect(gi*A,An*A,Wn*A,mi*A)};nt<1&&(e.globalAlpha=1-nt,e.fillStyle=M,e.beginPath(),e.ellipse(0,0,A*3,A*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),nt>0&&(e.globalAlpha=nt,at(-1,-4,2,2),at(1,-3.5,1,1,!0),at(-.5,-2,1,5,!0),at(-2.5,-1,5,.5),at(-2.5,0,5,.5),at(-2.5,1,5,.5),at(-3,-2,-1,2,!0),at(3,-2,1,2),at(-3,2,-1,2,!0),at(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=M;let ne=0,z=0,V=0,K=[0,0,0,0];switch(l){case"idle":ne=_e*A*.1;break;case"walk":const nt=Math.sin(a*Math.PI*4);ne=Math.abs(nt)*-A*.5,K=[nt*A,-nt*A,-nt*A,nt*A];break;case"attacking":const at=Math.sin(a*Math.PI*4);z=A*2+at*A,V=A*2,ne=A;break;case"eat":V=A*3+ue*A,ne=A*1.5,e.fillStyle=te,e.fillRect(-A,re-A,A*2,A);break;case"procreate":ne=Math.sin(a*Math.PI*8)*A*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let An=0;An<5;An++){const Wn=(Math.random()-.5)*A*8,mi=re+(Math.random()-.5)*A*2;ue>.5&&e.fillRect(Wn,mi,A*.5,A*.5)}break}const b=A*3*O*(m?1.3:1),Y=A*5*O,le=-Y/1.5,pe=re-b-A*2.5+ne;e.fillStyle=M,e.beginPath(),e.moveTo(le-A*.5,pe+b*.5),e.quadraticCurveTo(le-A*3,pe-A,le-A*2+_e*A,pe+b+A),e.fill();const Pe=A*1.2*O,me=A*3*O,Oe=A*2.5*O,Ne=le+Y*.8,ce=le+Y*.2;e.fillStyle=F,e.fillRect(ce,re-Oe,Pe,Oe+K[2]),e.fillRect(Ne,re-me,Pe,me+K[0]),e.fillStyle=M,e.beginPath(),e.moveTo(le,pe+b),e.lineTo(le,pe+A),e.quadraticCurveTo(le+Y/2,pe,le+Y,pe+A),e.lineTo(le+Y,pe+b),e.fill(),e.fillStyle=M,e.fillRect(ce+A/2,re-Oe,Pe,Oe+K[3]),e.fillRect(Ne+A/2,re-me,Pe,me+K[1]);const Se=A*3.5*O,$e=le+Y-Se*.3+z,Ie=pe-Se*.3+V;e.fillStyle=M,e.beginPath(),e.arc($e,Ie,Se/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse($e+Se*.4,Ie+Se*.2,A*1.5,A,0,0,Math.PI*2),e.fill(),p[1]>=0&&(e.fillStyle=x,e.fillRect($e+A*.5,Ie-A*.5,A*.5,A*.5),l==="attacking"&&(e.fillStyle=Z,e.fillRect($e+Se*.5,Ie+Se*.4,A,A*.4))),e.fillStyle=F,e.beginPath(),e.moveTo($e-Se*.4,Ie-Se*.3),e.lineTo($e,Ie-Se*.7),e.lineTo($e,Ie-Se*.2),e.fill(),e.restore()}},Wb=9;function Yb(e,t){const{position:n,gender:i,age:s,decayProgress:a,food:l,radius:c,originalEntityType:u,geneCode:f}=t;if(e.save(),e.globalAlpha=1-a,u==="human"?Fg.render(e,n.x-c,n.y-c,c*2,c*2,a,"dead",i,s,[0,0],!1,0):u==="prey"?uT.render(e,n.x-c,n.y-c,c*2,c*2,a,"dead",{gender:i,age:s,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}):u==="predator"&&fT.render(e,n.x-c,n.y-c,c*2,c*2,a,"dead",{gender:i,age:s,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:f||8405024}),e.restore(),l.length>0){e.save(),e.font=`${Wb}px Arial`,e.textAlign="center",e.textBaseline="middle";const p=Ct*.9,m=Math.PI/$v*3;l.forEach((S,v)=>{const I=v*m,A=n.x+p*Math.cos(I)*Math.atan2(v,v),_=n.y+p*Math.sin(I)*Math.atan2(v,v),P=ig[S.type];e.fillText(P,A,_)}),e.restore()}}function Yo(e,t,n,i,s,a,l,c){e.save(),e.fillStyle=l,e.fillRect(t,n,i,s),e.fillStyle=c,e.fillRect(t,n,i*Math.max(0,a),s),e.restore()}function zb(e,t,n,i,s,a){if(e.save(),i.length===0){e.restore();return}const l=i.length*s;let c;l>a||l+(i.length-1)*4>a?c=(a-l)/(i.length-1):c=4,i.length===1&&(c=0);for(let u=0;u<i.length;u++){const f=ig[i[u].type];e.fillText(f,t+u*(s+c),n)}e.restore()}function jb(e,t,n,i,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let l,c=Ct/2;const u=_u[a.action],f=pI[a.action],p=`${u} ${f}`;if("targetEntityId"in a){const m=t.entities.entities[a.targetEntityId];m&&(l=m.position,c=m.radius)}else"position"in a&&(l=a.position);if(l){cT(e,l,c,pg,gg,2,n,i,s,t.mapDimensions),e.save(),e.font=`${ta}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:S}=tc(l,n,{width:i,height:s},t.mapDimensions),v=S-c-Au-ta/2;e.fillText(p,m,v),e.restore()}}function Xb(e,t,n,i,s){e.save();const a=(Math.sin(s*yg)+1)/2,l=n+Au+a*5;e.strokeStyle=pg,e.lineWidth=2,e.setLineDash(gg),e.beginPath(),e.arc(t.x,t.y,l,0,Math.PI*2),e.stroke(),e.setLineDash([]);const c=_u[i],u=pI[i];if(c){e.font=`${ta*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const f=t.y-l-25;e.fillText(c,t.x,f),e.font=`${ta*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,f+25)}e.restore()}function Vb(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(St(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const l=t.entities.entities[n.targetEntityId];l&&(s=l.position,a=l.radius||(l.type==="building"?20:30))}if(s){const l=(c,u)=>{Xb(c,u.position,a,n.action,t.time)};Jn(e,t.mapDimensions.width,t.mapDimensions.height,l,{position:{...s}},s,a+30)}}}function ov(e,t,n,i,s,a,l=!0){const c=t.split(" ");let u="";const f=[];for(let p=0;p<c.length;p++){const m=u+c[p]+" ";e.measureText(m).width>s&&p>0?(f.push(u),u=c[p]+" "):u=m}if(f.push(u),l)for(let p=0;p<f.length;p++)e.fillText(f[p],n,i+p*a);return f.length*a}function Kb(e){return 1-Math.pow(1-e,3)}function qb(e,t,n,i){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(l=>!l.isDismissed);if(s.length===0)return;e.save();let a=i-wP;for(const l of s){const c=n-yd-Sr;e.font=`${Vh}px "Press Start 2P", Arial`;const u=c+Sr,f=yd-Sr*2,p=ov(e,l.message,-9999,-9999,f,Vh*1.2,!1),m=Sr*2+p+Ci,S=a-m,v=Date.now()-l.creationTime,I=Math.min(v/_P,1),A=Kb(I),_=i,P=_+(S-_)*A;e.fillStyle=vP,e.beginPath(),e.roundRect(c,P,yd,m,SP),e.fill(),e.fillStyle=AP,e.textBaseline="top",ov(e,l.message,u,P+Sr,f,Vh*1.2,!0);const R=P+m-Ci-Sr/2,w=c+yd-Ci-Sr/2,B={x:w,y:R,width:Ci,height:Ci};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[l.id]=B);const O=t.hoveredButtonId===`notification-dismiss-${l.id}`;if(e.fillStyle=O?SS:IP,e.font=`${Ci}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",B.x+B.width/2,B.y+B.height/2),l.targetEntityIds||l.targetPosition||l.targetArea||l.targetRadius){const F={x:w-Ci-yS,y:R,width:Ci,height:Ci};t.notificationButtonRects&&(t.notificationButtonRects.view[l.id]=F);const x=t.hoveredButtonId===`notification-view-${l.id}`;e.fillStyle=x?SS:TP,e.font=`${Ci*(x?1.5:1.2)}px Arial`,e.fillText("",F.x+F.width/2,F.y+F.height/2)}a-=m+yS}e.restore()}function Zb(e){return e.length===0?0:e.reduce((n,i)=>n+i,0)/e.length}function cp(e,t,n,i,s,a,l,c){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(i,s,a,l),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(i,s,a,l);const u=Zb(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,i+et,s+et+8);const f=Math.max(...n,1),p=n.map(m=>m/f*l);if(e.beginPath(),e.strokeStyle=c,e.lineWidth=2,p.length>1){e.moveTo(i,s+l-p[0]);for(let m=1;m<p.length;m++){const S=i+m/(p.length-1)*a,v=s+l-p[m];e.lineTo(S,v)}}else if(p.length===1){const m=s+l-p[0];e.moveTo(i,m),e.lineTo(i+a,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${f.toFixed(2)}ms`,i+a-et,s+et+8),e.restore()}function Qb(e,t,n){const{performanceMetrics:i}=t;if(!i)return;const s=280,a=240,l=n-s-et,c=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(l,c,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(l,c,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=c+et+5;const f=l+et;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",f,u),u+=25,e.fillStyle="white",e.font="12px monospace";const p=Jb(t);e.fillText(`FPS: ${p.toFixed(1)}`,f,u),u+=20;const m=s-et*2,S=45,v=10;cp(e,"Render",dp(t,"renderTime"),f,u,m,S,"#4CAF50"),u+=S+v,cp(e,"World Update",dp(t,"worldUpdateTime"),f,u,m,S,"#2196F3"),u+=S+v,cp(e,"AI Update",dp(t,"aiUpdateTime"),f,u,m,S,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",l+s/2,c+a-10),e.restore()}function Jb(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(Tt/Pt);return t.history.filter(a=>n-a.bucketTime/(Tt/Pt)<1).length}function eB(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const l=Math.floor(a.bucketTime/(Tt/Pt));n.set(l,(n.get(l)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function dp(e,t){return eB(e.performanceMetrics.history,t)}function tB(e,t,n,i){const{debugCharacterId:s,time:a}=t,l=500,c=Math.min(i*.9,800),u=n-l-10,f=et+it*2;t.debugPanelRect={x:u,y:f,width:l,height:c},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(u,f,l,c),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(u,f,l,c),e.fillStyle="white",e.font="12px monospace",e.textAlign="left",e.textBaseline="top";let p=f+20;const m=u+15;if(e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Behavior Tree Debugger",m,p),p+=25,!s){e.fillStyle="#888",e.font="12px monospace",e.fillText("No character selected for debugging.",m,p),e.fillText("Click on a character to inspect behavior.",m,p+20),e.restore();return}const S=t.entities.entities[s];if(!S){e.fillStyle="#ff4444",e.font="12px monospace",e.fillText(`Character #${s} not found (might be dead).`,m,p),e.restore();return}if(!S.aiBlackboard){e.fillStyle="#ffaa44",e.font="12px monospace",e.fillText(`Character #${s} has no AI Blackboard.`,m,p),e.restore();return}e.fillStyle="white",e.font="12px monospace",e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,m,p),p+=20,nB(e,S,a,m,p,l-30,c-(p-f)-10,t),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '~' to toggle this debugger",u+l/2,f+c-10),e.restore()}function nB(e,t,n,i,s,a,l,c){var P,R;const u=t.aiBlackboard.nodeExecutionData,f=t.type==="human"?vI:t.type==="predator"?II:t.type==="prey"?AI:null;if(!f)return;const p=((P=c.debugPanelScroll)==null?void 0:P.x)??0,m=((R=c.debugPanelScroll)==null?void 0:R.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-p,-m),e.font=`${Z1}px Arial`,e.textAlign="left",e.textBaseline="top";const S=w=>{switch(w){case T.SUCCESS:return J1;case T.FAILURE:return eP;case T.RUNNING:return tP;case T.NOT_EVALUATED:case null:default:return nP}};let v=0;const I=(w,B)=>{if(!w.name||!u[w.name])return B;let O=B;const N=O+jh>s+m&&O<s+l+m,M=u[w.name],F=i+(w.depth??0)*Q1;let x=T.NOT_EVALUATED,Z=hS,te="";if(M){x=M.status,te=M.debugInfo;const ne=oP/Pt*Tt,z=n-M.lastExecuted,V=Math.max(0,1-z/ne);Z=S_(hS,iP,V),z>Zs&&(x=T.NOT_EVALUATED)}const j=S(x),ie=` ${w.name}`+(te?`: ${te}`:""),re=e.measureText(ie).width,_e=rl+pS,ue=F-i+8+re+_e;if(ue>v&&(v=ue),N&&(e.fillStyle=j,e.fillText("",F,O),e.fillStyle=Z,e.fillText(ie,F+8,O),M&&M.executionHistory.length>0)){const{executionHistory:ne}=M,z=WA/Pt*Tt,V=n,K=V-z,b=i+a-rl-pS;let Y=b;const le=O+(jh-md)/2,pe=ne.filter(Ie=>Ie.time<K);let Pe=pe.length>0?pe[pe.length-1].status:null,me=K;const Oe=ne.filter(Ie=>Ie.time>=K&&Ie.time<=V),Ne=rl/z;e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(b,le,rl,md);for(const Ie of Oe){const nt=(Ie.time-me)*Ne;nt>0&&(e.fillStyle=S(Pe),e.fillRect(Y,le,nt,md),Y+=nt),Pe=Ie.status,me=Ie.time}n-me>Zs&&(Pe=T.NOT_EVALUATED);const Se=(V-me)*Ne;e.fillStyle=S(Pe);const $e=b+rl-Y;e.fillRect(Y,le,Math.min(Se,$e),md)}if(O+=jh,w.children)for(const ne of w.children)O=I(ne,O);else w.child&&(O=I(w.child,O));return O},_=I(f,s)-s;c.debugPanelContentSize={width:v,height:_},e.restore()}function au(e,t,n,i,s,a,l){e.save();const{position:c}=t;e.strokeStyle=i,e.lineWidth=s+Math.sin(l*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(c.x,c.y,n,0,2*Math.PI),e.stroke(),e.restore()}function iB(e,t,n,i){if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;const a=$t(s,t);if(!a||!a.aiBlackboard)return;const l=tr(a.aiBlackboard),c=500,u=Math.min(i*.9,700),f=n-c-10,p=et+it*2;t.debugPanelRect={x:f,y:p,width:c,height:u},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(f,p,c,u),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(f,p,c,u),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";const m=14,S=f+15;let v=p+20;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Supply Chain Debugger",S,v),v+=25,e.fillStyle="#aaaaaa",e.font="11px monospace",e.fillText(`Tribe Leader: ${a.isPlayer?"Player":"#"+a.id}`,S,v),v+=m,e.fillText(`Current Time: ${t.time.toFixed(1)}h`,S,v),v+=20;const I=v,A=u-(I-p)-30;oB(e,t,l,S,I,c-30,A,m),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+4' to toggle this debugger",f+c/2,p+u-10),e.restore()}function oB(e,t,n,i,s,a,l,c){var I,A;const u=((I=t.debugPanelScroll)==null?void 0:I.x)??0,f=((A=t.debugPanelScroll)==null?void 0:A.y)??0;e.save(),e.beginPath(),e.rect(i-5,s,a+10,l),e.clip(),e.translate(-u,-f);let p=s;e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(` Active Demands (${n.length})`,i,p),p+=18,n.length===0?(e.fillStyle="#888888",e.font="11px monospace",e.fillText("No active demands",i,p),p+=c):[...n].sort((P,R)=>R.updatedAt-P.updatedAt).forEach((P,R)=>{const w=t.entities.entities[P.requesterId];let B=w?w.isPlayer?"Player":`Human #${w.id}`:`Unknown #${P.requesterId}`;w&&(B+=` (Food: ${w.food.length}), Active action: ${w.activeAction||"idle"}`);let O="None";if(P.claimedBy){const x=t.entities.entities[P.claimedBy];O=x?x.isPlayer?"Player":`Human #${x.id}`:`Unknown #${P.claimedBy}`,x&&(O+=" (Food: "+x.food.length+"), Active action: "+(x.activeAction||"idle")+")")}const N=t.time-P.updatedAt,M=p,F=c*5+10;e.fillStyle=P.claimedBy?"rgba(50, 100, 50, 0.3)":"rgba(50, 50, 50, 0.3)",e.fillRect(i-5,M-2,a,F),e.strokeStyle=P.claimedBy?"#44ff44":"#666666",e.lineWidth=1,e.strokeRect(i-5,M-2,a,F),e.fillStyle="#ffaa00",e.font="bold 12px monospace",e.fillText(`#${R+1}`,i,p),p+=c,e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Requester: ${B}`,i+10,p),p+=c,e.fillStyle="#ffff88",e.fillText(`Resource: ${P.resourceType}`,i+10,p),p+=c,e.fillStyle=P.claimedBy?"#44ff44":"#ff8844",e.fillText(`Status: ${P.claimedBy?"Claimed":"Pending"}`,i+10,p),p+=c,P.claimedBy?(e.fillStyle="#aaffaa",e.fillText(`Mover: ${O}`,i+10,p)):(e.fillStyle="#888888",e.fillText(`Mover: ${O}`,i+10,p)),p+=c,e.fillStyle="#aaaaaa",e.font="10px monospace",e.fillText(`Updated: ${N.toFixed(1)}h ago`,i+10,p),p+=c+5}),p+=10,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Statistics",i,p),p+=18;const m=n.filter(_=>!_.claimedBy).length,S=n.filter(_=>_.claimedBy).length;e.fillStyle="#ffffff",e.font="11px monospace",e.fillText(`Total Demands: ${n.length}`,i,p),p+=c,e.fillStyle="#ff8844",e.fillText(`Pending: ${m}`,i,p),p+=c,e.fillStyle="#44ff44",e.fillText(`Claimed: ${S}`,i,p),p+=c;const v=p-s;t.debugPanelContentSize={width:a,height:v},e.restore()}function rB(e,t,n){if(!n.debugCharacterId)return;const i=n.search.human.byProperty("id",n.debugCharacterId)[0];if(!i)return;const s=$t(i,n);if(!s||!s.aiBlackboard||s.id!==t.leaderId)return;tr(s.aiBlackboard).some(l=>l.requesterId===t.id)&&au(e,t,t.radius+15,"#ff6644",3,2,n.time),t.tribeRole===J.Mover&&au(e,t,t.radius+15,"#44ff44",3,2,n.time)}const sB={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"};function aB(e,t){var c;const{radius:n,position:i,activeAction:s="idle"}=t,a=((c=t.stateMachine)==null?void 0:c[0])||"N/A",l=t.isAdult?Ct+20:Ct*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,i.x,i.y-l+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function lB(e,t,n,i,s){e.save(),e.font=`${Dl}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(i?Ct:ga)-Dl-s),e.restore()}function cB(e,t,n,i,s){const a=t.x,l=t.y-n-i/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-i/2,l,i,i/2),e.fill(),e.beginPath(),e.moveTo(a-i/2,l),e.lineTo(a-i/4,l-i/3),e.lineTo(a-i/6,l),e.moveTo(a-i/6,l),e.lineTo(a,l-i/2),e.lineTo(a+i/6,l),e.moveTo(a+i/6,l),e.lineTo(a+i/4,l-i/3),e.lineTo(a+i/2,l),e.stroke(),e.restore()}function dB(e,t,n){var c,u;const{position:i,radius:s}=t,a=i.x-zh/2,l=i.y-s-z1;if(((c=t.stateMachine)==null?void 0:c[0])===Zo){const f=t.stateMachine[1],p=n-f.attackStartTime,m=Math.min(p/hu,1);Yo(e,a,l,zh,cS,m,Wo,j1)}else if((u=t.attackCooldown)!=null&&u.melee&&t.attackCooldown.melee>0){const f=1-t.attackCooldown.melee/pu;Yo(e,a,l,zh,cS,f,Wo,X1)}}function uB(e,t,n=!1,i=!1,s=!1,a=!1,l=!1,c=!1,u=!1,f){var P,R;const{position:p,activeAction:m="idle"}=t,S=t.isAdult?Ct:Ct*.6,v=sB[m]||"idle";Fg.render(e,p.x-S,p.y-S,S*2,S*2,t.animationProgress||0,v,t.gender,t.age,[t.direction.x,t.direction.y],t.isPregnant??!1,t.hunger),c&&(e.save(),e.strokeStyle=w1,e.lineWidth=2,e.beginPath(),e.arc(p.x,p.y,S+3,0,2*Math.PI),e.stroke(),e.restore());let I,A;if(l?(I=P1,A=BA):n?(I=R1,A=OA):s?(I=D1,A=_1):i?(I=N1,A=kA):a&&(I=M1,A=bA),I&&A&&cB(e,p,S,I,A),(P=t.tribeInfo)!=null&&P.tribeBadge&&lB(e,p,t.tribeInfo.tribeBadge,t.isAdult??!1,I??0),t.heldItem){const w=rg[t.heldItem.type],B=(R=t.tribeInfo)!=null&&R.tribeBadge?Dl:0;e.save(),e.font=`${Dl}px Arial`,e.textAlign="center",e.textBaseline="middle";const O=p.y-(t.isAdult?Ct:ga)-Dl-(I??0)-B;e.fillText(w,p.x,O),e.restore()}const _=u&&(f.debugCharacterId===void 0||t.id===f.debugCharacterId);dB(e,t,f.time),_&&aB(e,t),f.debugPanel===ze.SupplyChain&&rB(e,t,f)}const fB={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"};function hB(e,t){var c;const{radius:n,position:i,activeAction:s="idle"}=t,a=((c=t.stateMachine)==null?void 0:c[0])||"N/A",l=t.isAdult?Ct+20:Ct*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function pB(e,t,n=!1,i){var f,p;const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,c=fB[a]||"idle";if(uT.render(e,s.x-l,s.y-l,l*2,l*2,t.animationProgress||0,c,{gender:t.gender,age:t.age,direction:[((f=t.direction)==null?void 0:f.x)||1,((p=t.direction)==null?void 0:p.y)||0],isPregnant:t.isPregnant??!1,hungryLevel:t.hunger,geneCode:t.geneCode}),t.hitpoints<t.maxHitpoints){const m=l*1.5,S=3,v=s.x-m/2,I=s.y-l-8;e.fillStyle="#555",e.fillRect(v,I,m,S);const A=t.hitpoints/t.maxHitpoints;e.fillStyle=A>.5?"#4CAF50":A>.25?"#FFC107":"#F44336",e.fillRect(v,I,m*A,S)}n&&(i===void 0||t.id===i)&&hB(e,t)}const gB={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"};function mB(e,t){var c;const{radius:n,position:i,activeAction:s="idle"}=t,a=((c=t.stateMachine)==null?void 0:c[0])||"N/A",l=t.isAdult?Ct+20:Ct*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,i.x,i.y-l),e.fillText(`State: ${a}`,i.x,i.y-l+10),e.fillText(`HP: ${t.hitpoints}`,i.x,i.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,i.x,i.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,i.x,i.y-l+40),e.restore(),e.beginPath(),e.arc(i.x,i.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function yB(e,t,n=!1,i){var f,p;const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,c=gB[a]||"idle";if(fT.render(e,s.x-l,s.y-l,l*2,l*2,t.animationProgress||0,c,{gender:t.gender,age:t.age,direction:[((f=t.direction)==null?void 0:f.x)||1,((p=t.direction)==null?void 0:p.y)||0],isPregnant:t.isPregnant??!1,hungryLevel:t.hunger,geneCode:t.geneCode}),t.hitpoints<t.maxHitpoints){const m=l*1.5,S=3,v=s.x-m/2,I=s.y-l-8;e.fillStyle="#555",e.fillRect(v,I,m,S);const A=t.hitpoints/t.maxHitpoints;e.fillStyle=A>.5?"#4CAF50":A>.25?"#FFC107":"#F44336",e.fillRect(v,I,m*A,S)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,l+3,0,2*Math.PI),e.stroke()),n&&(i===void 0||t.id===i)&&mB(e,t)}const hT=15;function SB(e,t,n,i,s=1.5){const a=n-t.startTime,l=Math.min(a/t.duration,1),c=1-l,f=1+Math.sin(l*Math.PI*2)*(s-1),p=hT*f;e.save(),e.globalAlpha=c,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,p),0,Math.PI*2),e.fillStyle=i,e.fill(),e.restore()}function cl(e,t,n,i,s=2){const a=n-t.startTime,l=Math.min(a/t.duration,1),c=1-l,u=hT*2*l;e.save(),e.globalAlpha=c,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=i,e.lineWidth=s,e.stroke(),e.restore()}function zi(e,t,n,i){const s=n-t.startTime,a=Math.min(s/t.duration,1),l=1-a,c=-20*a;e.save(),e.globalAlpha=l,e.font="20px Arial",e.textAlign="center",e.fillText(i,t.position.x,t.position.y+c),e.restore()}function vB(e,t,n,i){const{width:s,height:a}=i.mapDimensions;let l=t.targetPosition;if(t.targetEntityId){const A=i.entities.entities[t.targetEntityId];A&&(l=A.position)}if(!l)return;const c=n-t.startTime,u=Math.min(c/t.duration,1);let f=l.x-t.position.x,p=l.y-t.position.y;f=f-Math.round(f/s)*s,p=p-Math.round(p/a)*a;const m={x:f,y:p},S=t.position.x+m.x*u,v=t.position.y+m.y*u,I=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(S,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(S,v+I),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function pT(e,t,n,i){switch(t.type){case Ee.Procreation:zi(e,t,n,"");break;case Ee.Pregnant:SB(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Ee.TargetAcquired:cl(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Ee.Attack:zi(e,t,n,"");break;case Ee.Partnered:zi(e,t,n,"");break;case Ee.BushClaimed:cl(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Ee.BushClaimLost:cl(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Ee.Eating:zi(e,t,n,"");break;case Ee.ChildFed:zi(e,t,n,"");break;case Ee.AttackDeflected:zi(e,t,n,"");break;case Ee.AttackResisted:zi(e,t,n,"");break;case Ee.Hit:zi(e,t,n,"");break;case Ee.SeizeBuildup:cl(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Ee.BorderClaim:zi(e,t,n,"");break;case Ee.Seize:cl(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Ee.StoneProjectile:vB(e,t,n,i);break}}const rv=8,AB=1.5,IB=.5,sv=2,TB="#5a5a5a",EB="#7e7e7e",CB="#8B0000",_B="#FF4444",wB=6;function up(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function $p(e,t,n,i,s,a){const l=(t+n)*2,c=Math.floor(l/rv),u=-t/2,f=t/2,p=-n/2,m=n/2;for(let S=0;S<c;S++){const v=i+S*13,I=up(v),A=up(v+1);let _=S*rv,P=0,R=0;_<t?(P=u+_,R=p):_<t+n?(P=f,R=p+(_-t)):_<t*2+n?(P=f-(_-(t+n)),R=m):(P=u,R=m-(_-(t*2+n)));const w=(A-.5)*sv,B=(up(v+2)-.5)*sv;e.beginPath();const O=AB+I*IB;s?e.fillStyle=s:e.fillStyle=I>.5?a||EB:s||TB,e.ellipse(P+w,R+B,O,O*.85,A*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function RB(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:i}=t;e.save(),e.font=`${wB}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,i.forEach(s=>{const a=s.item.type,l=(ig[a]||rg[a])??"?",c={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(l,c.x,c.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function PB(e,t,n){const{position:i,width:s,height:a,constructionProgress:l,destructionProgress:c,isConstructed:u,isBeingDestroyed:f,id:p}=t;let S=Jo[t.buildingType].icon;t.buildingType===de.Bonfire&&u&&(S=(t.fuelLevel??0)>0?"":"");const v=St(n),I=v&&Xt(v,t,n);e.save(),e.translate(i.x,i.y),u||(e.globalAlpha=.3+l*.7),I?$p(e,s,a,p,CB,_B):$p(e,s,a,p),e.globalAlpha=.5,e.font=`${Math.min(s,a,30)*.5}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=4,e.fillStyle="#FFFFFF",e.fillText(S,0,0),e.shadowBlur=0,e.restore();const A=s,_=i.x-A/2,P=i.y+a/2+ew;u?f&&Yo(e,_,P,A,jy,1-c,Wo,J_):Yo(e,_,P,A,jy,l,Wo,Q_),(t.buildingType===de.StorageSpot||t.buildingType===de.Bonfire)&&u&&RB(e,t)}function DB(e,t,n,i,s){const a=Jo[n],{width:l,height:c}=a.dimensions,u=(p,m)=>{p.save(),p.translate(m.x,m.y),p.globalAlpha=Z_;const S=i?"#4CAF50":"#F44336";$p(p,l,c,9999,S),p.font=`${Math.min(l,c)*.5}px Arial`,p.textAlign="center",p.textBaseline="middle",p.fillStyle=S,p.fillText(a.icon,0,0),p.restore()},f={position:{...t},radius:Math.max(l,c)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[]};Jn(e,s.width,s.height,(p,m)=>u(p,m.position),f)}const Ms=1,NB=20,di=4,av=8,MB="rgba(34, 85, 34, 0.25)",OB="rgba(139, 50, 50, 0.25)",Ks=new Map,kB=50;function bB(e){return e.map(t=>t.id).sort((t,n)=>t-n).join(",")}function BB(){if(Ks.size>kB){const e=Ks.keys().next().value;e&&Ks.delete(e)}}function FB(e){const t=new Map;for(const n of e){const i=n.ownerId;i&&(t.has(i)||t.set(i,[]),t.get(i).push(n))}return t}function LB(e,t,n,i){let s=0;const a=Math.max(i.width,i.height)/2;for(const l of n){const c=e-l.position.x,u=t-l.position.y,f=c*c+u*u;f>0?s+=a*a/f:s+=100}return s}function UB(e,t,n){let i=1/0,s=1/0,a=-1/0,l=-1/0;for(const c of e)i=Math.min(i,c.position.x-t.width/2),s=Math.min(s,c.position.y-t.height/2),a=Math.max(a,c.position.x+t.width/2),l=Math.max(l,c.position.y+t.height/2);return{minX:i-n,minY:s-n,maxX:a+n,maxY:l+n}}function HB(e,t,n){const i=bB(e);if(Ks.has(i))return Ks.get(i);const s=n.maxX-n.minX,a=n.maxY-n.minY,l=Math.ceil(s/di),c=Math.ceil(a/di),u=[],f=[];for(let S=0;S<c;S++)u[S]=new Array(l);for(let S=0;S<c;S++)for(let v=0;v<l;v++){const I=n.minX+v*di,A=n.minY+S*di,_=LB(I,A,e,t);u[S][v]=_}for(let S=1;S<c-1;S++)for(let v=1;v<l-1;v++)if(u[S][v]>=Ms&&(u[S-1][v]<Ms||u[S+1][v]<Ms||u[S][v-1]<Ms||u[S][v+1]<Ms)){const A=n.minX+v*di,_=n.minY+S*di;f.push({x:A,y:_})}const p=xB(f),m={fieldValues:u,edgePoints:f,regions:p,bounds:n};return Ks.set(i,m),BB(),m}function GB(e,t,n,i,s,a){if(t.length===0)return;e.save(),e.globalAlpha=1;const{fieldValues:l,regions:c,bounds:u}=a;$B(e,l,u,i);let f=s;for(const p of c){const m=WB(p);YB(e,m,i,f),f+=1e3}e.restore()}function $B(e,t,n,i){const s=i?OB:MB;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++)if(t[a][l]>=Ms){const c=n.minX+l*di,u=n.minY+a*di;e.rect(c,u,di,di)}e.fill(),e.restore()}function xB(e){if(e.length===0)return[];const t=di*2,n=t,i=new Map;function s(f,p){const m=Math.floor(f/n),S=Math.floor(p/n);return`${m},${S}`}for(let f=0;f<e.length;f++){const p=s(e[f].x,e[f].y);i.has(p)||i.set(p,[]),i.get(p).push(f)}function a(f,p){const m=[],S=Math.floor(f/n),v=Math.floor(p/n);for(let I=-1;I<=1;I++)for(let A=-1;A<=1;A++){const _=`${S+I},${v+A}`,P=i.get(_);P&&m.push(...P)}return m}const l=new Set,c=[],u=t*t;for(let f=0;f<e.length;f++){if(l.has(f))continue;const p=[],m=[f];for(;m.length>0;){const S=m.shift();if(l.has(S))continue;l.add(S),p.push(e[S]);const v=a(e[S].x,e[S].y);for(const I of v){if(l.has(I))continue;const A=e[I].x-e[S].x,_=e[I].y-e[S].y;A*A+_*_<=u&&m.push(I)}}p.length>0&&c.push(p)}return c}function WB(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const i=t[t.length-1];let s=0,a=1/0;for(let l=0;l<n.length;l++){const c=n[l].x-i.x,u=n[l].y-i.y,f=c*c+u*u;f<a&&(a=f,s=l)}t.push(n.splice(s,1)[0])}return t}function YB(e,t,n,i){if(t.length===0)return;let s=0,a=0;for(let l=1;l<t.length;l++){const c=t[l-1],u=t[l],f=u.x-c.x,p=u.y-c.y,m=Math.sqrt(f*f+p*p);for(s+=m;s>=av;){s-=av;const S=1-s/m,v=c.x+f*S,I=c.y+p*S;zB(e,v,I,n,i+a*13),a++}}}function zB(e,t,n,i,s){const a=fp(s),l=fp(s+1),c=(l-.5)*2,u=(fp(s+2)-.5)*2;e.beginPath();const f=1.5+a*.5;i?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+c,n+u,f,f*.85,l*Math.PI,0,Math.PI*2),e.fill(),i||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function fp(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function jB(e,t,n,i){var m,S,v;const s=t;if(!((m=s.search)!=null&&m.building))return;const l=s.search.building.all().filter(I=>I.buildingType===de.PlantingZone&&I.isConstructed);if(l.length===0)return;const c=l.filter(I=>Ws(I,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(c.length===0)return;const u=Jo[de.PlantingZone].dimensions,f=FB(c),p=i?t.entities.entities[i]:void 0;for(const[I,A]of f){const _=((v=(S=p==null?void 0:p.tribeControl)==null?void 0:S.diplomacy)==null?void 0:v[I])==="Hostile",P=typeof I=="number"?I:0,R=UB(A,u,NB),w=HB(A,u,R);GB(e,A,u,_,P,w)}}const XB=.001,VB=.05,KB=12;function qB(e,t,n){const{position:i,age:s,swayOffset:a}=t,[l]=t.stateMachine??[],c=Math.min(1,Math.max(.4,s/Qo)),f=l!==Ht&&l!==oo?Math.sin(n*XB+a)*VB:0;if(e.save(),e.translate(i.x,i.y),e.scale(c,c),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=h1,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),l===oo?hp(e,10,8):l===Ht?(e.rotate(Math.PI/2),hp(e,10,30),e.translate(0,-25),lv(e,40,20,40,15)):(e.rotate(f),hp(e,10,30),e.translate(0,-25),e.rotate(f*.5),lv(e,40,20,40,15)),e.restore(),(l===Ht||l===oo)&&t.wood&&t.wood.length>0){e.save(),e.font=`${KB}px Arial`,e.textAlign="center",e.textBaseline="middle";const p=t.radius*1.1,m=Math.PI*2/(vu-1);t.wood.forEach((S,v)=>{const I=v===0?0:p,A=v===0?0:(v-1)*m,_=i.x+I*Math.cos(A),P=i.y+I*Math.sin(A),R=rg[S.type];e.fillText(R,_,P)}),e.restore()}}function hp(e,t,n){e.fillStyle=l1,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=c1,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function lv(e,t,n,i,s){e.fillStyle=d1,cv(e,t+4,n+4,i+2,s+2),e.translate(0,-2),e.fillStyle=u1,cv(e,t,n,i,s),e.fillStyle=f1,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function cv(e,t,n,i,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-i),e.lineTo(0,-i-s),e.lineTo(n/2,-i),e.lineTo(t/2,0),e.closePath(),e.fill()}let bo=null;function ZB(e,t,n,i,s){const a=OP(t.time);if(a<=0)return;bo||(bo=document.createElement("canvas")),(bo.width!==i.width||bo.height!==i.height)&&(bo.width=i.width,bo.height=i.height);const l=bo.getContext("2d");if(l){l.clearRect(0,0,i.width,i.height),l.fillStyle=`rgba(0, 0, 40, ${a*.85})`,l.fillRect(0,0,i.width,i.height),l.globalCompositeOperation="destination-out";for(const c of s){const u=tc(c.position,n,i,t.mapDimensions),f=l.createRadialGradient(u.x,u.y,0,u.x,u.y,c.radius);f.addColorStop(0,`rgba(255, 255, 255, ${c.intensity})`),f.addColorStop(1,"rgba(255, 255, 255, 0)"),l.fillStyle=f,l.beginPath(),l.arc(u.x,u.y,c.radius,0,Math.PI*2),l.fill()}l.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(bo,0,0),e.restore()}}function dv(e,t,n,i,s,a,l){for(let c=-s.height;c<=s.height;c+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const f={x:t.x+u,y:t.y+c};Ws({position:f,radius:n},a,l,s)&&e.push({position:f,radius:n,intensity:i})}}function QB(e,t,n,i,s,a=[]){const l=St(t),c=l?Pn(t,l):[],u=Wr(c),{width:f,height:p}=t.mapDimensions,m=[];a.forEach(_=>{m.push({position:_,radius:30,intensity:.3})}),jB(e,t,i,l==null?void 0:l.leaderId),Object.values(t.entities.entities).sort((_,P)=>n&&_.id===t.debugCharacterId&&_.id!==P.id||_.type==="building"&&P.type!=="building"?-1:_.position.y-P.position.y||_.id-P.id).filter(_=>Ws(_,i,s,t.mapDimensions)).forEach(_=>{var P,R;if(_.type==="building"){const w=_;if(w.isConstructed){const B=w.buildingType===de.Bonfire&&(w.fuelLevel??0)>0,O=B?180:60,N=B?.9:.4;dv(m,w.position,O,N,t.mapDimensions,i,s)}if(w.buildingType===de.PlantingZone&&w.isConstructed)return;Jn(e,f,p,PB,w,t,l,t.time)}else if(_.type==="berryBush")Jn(e,f,p,Hb,_,t,l,t.time);else if(_.type==="tree")Jn(e,f,p,qB,_,t.time);else if(_.type==="human"){const w=_,B=w.id===(l==null?void 0:l.id),O=c.some(Z=>Z.id===w.id),N=w.id===(u==null?void 0:u.id),M=l&&(w.id===l.motherId||w.id===l.fatherId),F=l&&(((P=w.partnerIds)==null?void 0:P.includes(l.id))||((R=l.partnerIds)==null?void 0:R.includes(w.id))),x=(l==null?void 0:l.attackTargetId)===w.id;dv(m,w.position,40,.3,t.mapDimensions,i,s),Jn(e,f,p,uB,w,B,M,O,F,N,x,n,t)}else _.type==="corpse"?Jn(e,f,p,Yb,_):_.type==="prey"?Jn(e,f,p,pB,_,n,t.time,t.debugCharacterId):_.type==="predator"&&Jn(e,f,p,yB,_,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(_=>Ws(_,i,s,t.mapDimensions)).forEach(_=>{Jn(e,f,p,pT,_,t.time,t)});const A=t.notifications.filter(_=>!_.isDismissed);for(const _ of A)if(_.highlightedEntityIds&&_.renderHighlights)for(const P of _.highlightedEntityIds){const R=t.entities.entities[P];R&&Ws(R,i,s,t.mapDimensions)&&Jn(e,f,p,au,R,RP,PP,NP,DP,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const _ of t.tutorialState.highlightedEntityIds){const P=t.entities.entities[_];P&&Ws(P,i,s,t.mapDimensions)&&Jn(e,f,p,au,P,pP,YA,zA,yg,t.time)}ZB(e,t,i,s,m)}function JB(e,t,n,i,s,a){let l=null,c=null;e.textAlign="left";let u=et+it;const p=t.time/(Tt/Pt)/cu%1,m=sl[Ns.Time],S=25,v=et+S;e.fillText(m,et,u+Fn/2+it/3),Yo(e,v,u,No,Fn,p,Wo,U1),u+=Fn+Yi;const I=u+mr/2,A=u+(mr-Fn)/2,_=5;jl(e,{x:et*2,y:I},mr,5,n.gender,!1,!1,!1);const P=et+mr+_,R=No+S-(mr+_)*2;Yo(e,P,A,R,Fn,Math.floor(n.age)/Ol,Wo,L1),jl(e,{x:P+R+_+mr/2,y:I},mr,Ol,n.gender,!1,!1,!1),u+=Fn+Yi*2;const w=[],B=new Set;if(w.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),B.add(n.id),i&&!B.has(i.id)&&(w.push({member:i,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),B.add(i.id)),s.forEach(re=>{B.has(re.id)||(w.push({member:re,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),B.add(re.id))}),a.forEach(re=>{B.has(re.id)||(w.push({member:re,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),B.add(re.id))}),n.motherId&&!B.has(n.motherId)){const re=t.entities.entities[n.motherId];re&&(w.push({member:re,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),B.add(re.id))}if(n.fatherId&&!B.has(n.fatherId)){const re=t.entities.entities[n.fatherId];re&&(w.push({member:re,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),B.add(re.id))}const O=sl[Ns.Family],N=10,M=et+it+N,F=No+S-(it+N),x=u+hd/2;e.font=`${it}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(O,et,x);const Z=u+hd/2;kb(e,M,Z,w,hd,F),u+=hd+Yi,e.textBaseline="alphabetic";const te=sl[Ns.Hitpoints];e.fillText(te,et,u+Fn/2+it/3),Yo(e,v,u,No,Fn,n.hitpoints/n.maxHitpoints,Wo,F1),u+=Fn+Yi;const j=sl[Ns.Hunger];e.fillText(j,et,u+Fn/2+it/3),Yo(e,v,u,No,Fn,(nn-n.hunger)/nn,Wo,B1),l={x:et,y:u-Yi/2,width:No+S,height:Fn+Yi},u+=Fn+Yi,e.textBaseline="middle";const ie=sl[Ns.Food];return e.fillText(ie,et,u+fd/2),zb(e,v,u+fd/2,n.food,fd,No),c={x:et,y:u-Yi/5,width:No+S,height:fd+Yi},e.textBaseline="alphabetic",{hungerBarRect:l,foodBarRect:c}}let dl=[],uv=0;const eF=36,tF=200;function nF(e,t,n,i){const s=t.search.prey.count(),a=t.search.predator.count(),l=t.search.berryBush.count();t.time-uv>=eF&&(dl.push({time:t.time,prey:s,predators:a,bushes:l}),dl.length>tF&&(dl=dl.slice(-200)),uv=t.time);const c=Ke*Qe,u=s/c*1e6,f=a/c*1e6,p=l/c*1e6,m=pb(),S=Math.floor(t.time/(24*365)),v=Math.floor(t.time%(24*365)/24),I=Math.floor(t.time%24),A=400,_=Math.min(i*.8,600),P=n-A-10,R=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(P,R,A,_),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(P,R,A,_),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let w=R+20;const B=14,O=P+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",O,w),w+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${S}, Day ${v}, Hour ${I}`,O,w),w+=B,e.fillText(`Map Size: ${Ke}  ${Qe} pixels`,O,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",O,w),w+=18,m&&(e.fillText(`Q-Table Size: ${m.qTableSize} entries`,O,w),w+=B,e.fillText(`Exploration Rate: ${(m.explorationRate*100).toFixed(1)}%`,O,w),w+=B);const N=dl.slice(-20);N.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",O,w),w+=30,iF(e,O,w,N),w+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",O,w),w+=18,e.fillStyle="white",e.font="12px monospace";const M=(Ji/c*1e6).toFixed(2),F=(eo/c*1e6).toFixed(2),x=(to/c*1e6).toFixed(2);e.fillText(`Prey: ${u.toFixed(2)} (target: ${M})`,O,w),w+=B,e.fillText(`Predators: ${f.toFixed(2)} (target: ${F})`,O,w),w+=B,e.fillText(`Bushes: ${p.toFixed(2)} (target: ${x})`,O,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",O,w),w+=18,e.fillStyle="white",e.font="12px monospace";const Z=Math.round(s/Ji*100),te=Math.round(a/eo*100),j=Math.round(l/to*100),ie=re=>re<50?"#ff4444":re<80?"#ffaa44":re>120?"#44aaff":"#44ff44";e.fillStyle=ie(Z),e.fillText(`Prey: ${s}/${Ji} (${Z}%)`,O,w),w+=B,e.fillStyle=ie(te),e.fillText(`Predators: ${a}/${eo} (${te}%)`,O,w),w+=B,e.fillStyle=ie(j),e.fillText(`Bushes: ${l}/${to} (${j}%)`,O,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",O,w),w+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",O,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,O,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,O,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,O,w),w+=13,e.fillText("Predators:",O,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,O,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,O,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,O,w),w+=13,e.fillText("Bushes:",O,w),w+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,O,w),w+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",P+A/2,R+_-10),e.restore()}function iF(e,t,n,i){if(i.length<2)return;const c={prey:Math.max(...i.map(f=>f.prey),Ji),predators:Math.max(...i.map(f=>f.predators),eo),bushes:Math.max(...i.map(f=>f.bushes),to)};[{data:i.map(f=>f.prey),color:"#44ff44",label:"Prey",target:Ji,max:c.prey},{data:i.map(f=>f.predators),color:"#ff4444",label:"Predators",target:eo,max:c.predators},{data:i.map(f=>f.bushes),color:"#ffaa44",label:"Bushes",target:to,max:c.bushes}].forEach((f,p)=>{const m=t+p*115,S=n;e.fillStyle=f.color,e.font="10px monospace",e.fillText(f.label,m,S-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,S,100,30),e.beginPath(),e.strokeStyle=f.color;for(let I=0;I<f.data.length;I++){const A=m+I/(f.data.length-1)*100,_=S+30-f.data[I]/f.max*30;I===0?e.moveTo(A,_):e.lineTo(A,_)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=S+30-f.target/f.max*30;e.moveTo(m,v),e.lineTo(m+100,v),e.stroke(),e.setLineDash([])})}function oF(e,t){const n=t.search.human.byProperty("leaderId",e),i={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||i.children++,s.gender==="male"?i.males++:s.gender==="female"&&i.females++,s.age>=Vp&&i.old++;return i}function rF(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(f=>n.berryBush.byRadius(f.position,f.radius)).reduce((f,p)=>f+p.food.length,0),u=n.building.byProperty("ownerId",e).filter(f=>f.buildingType===de.StorageSpot).reduce((f,p)=>f+(p.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:u,consumptionRate:0}}function sF(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,l=new Map,c=new Map;for(const f of s){const p=nu(f.id,t,l);c.has(p)||c.set(p,[]),c.get(p).push(f)}const u=[];for(const[f,p]of c.entries()){const m=a[f];m&&u.push({patriarch:m,memberCount:p.length,members:p.map(S=>S.id)})}return u.sort((f,p)=>p.memberCount-f.memberCount),u.slice(0,n)}let ul=[],Ri=[],fv=0;const aF=36,hv=200;function lF(e,t,n,i){var B;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(B=$t(s,t))==null?void 0:B.id;if(!a)return;const l=oF(a,t),c=rF(a,t);if(t.time-fv>=aF){ul.push({time:t.time,total:l.total,children:l.children,males:l.males,females:l.females,old:l.old});const O=c.totalBushFood+c.totalStorageFood;Ri.push({time:t.time,bushFood:c.totalBushFood,storageFood:c.totalStorageFood,totalFood:O}),ul.length>hv&&(ul=ul.slice(-200)),Ri.length>hv&&(Ri=Ri.slice(-200)),fv=t.time}let u=0;if(Ri.length>=2){const O=Ri[Ri.length-1],N=Ri[Ri.length-2],M=O.time-N.time;M>0&&(u=(N.totalFood-O.totalFood)/M)}const f=400,p=Math.min(i*.9,700),m=n-f-10,S=et+it*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,S,f,p),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,S,f,p),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=S+20;const I=13,A=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",A,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",A,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${l.total}`,A,v),v+=I,e.fillStyle="#00ffff",e.fillText(`Children: ${l.children}`,A,v),v+=I,e.fillStyle="#4488ff",e.fillText(`Males: ${l.males}`,A,v),v+=I,e.fillStyle="#ff88ff",e.fillText(`Females: ${l.females}`,A,v),v+=I,e.fillStyle="#888888",e.fillText(`Old (${l.old})`,A,v),v+=20;const _=ul.slice(-50);_.length>1&&(cF(e,A,v,_),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",A,v),v+=18;const P=c.totalBushFood+c.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${P}`,A,v),v+=I,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${c.totalBushFood}`,A,v),v+=I,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${c.totalStorageFood}`,A,v),v+=I,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,A,v),v+=20;const R=Ri.slice(-50);R.length>1&&(dF(e,A,v,R),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",A,v),v+=18;const w=sF(a,t,5);e.fillStyle="white",e.font="11px monospace",w.length===0?(e.fillText("No families found",A,v),v+=I):w.forEach((O,N)=>{const F=`${N+1}. ${O.patriarch.isPlayer?"Player":"#"+O.patriarch.id} (${O.memberCount} members, can split: ${fI(O.patriarch,t).canSplit})`;e.fillText(F,A,v),v+=I}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+f/2,S+p-10),e.restore()}function cF(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.total),color:"#ffffff",label:"Total"},{data:i.map(u=>u.children),color:"#00ffff",label:"Children"},{data:i.map(u=>u.males),color:"#4488ff",label:"Males"},{data:i.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:i.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const p=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function dF(e,t,n,i){if(i.length<2)return;const l=Math.max(...i.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:i.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:i.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:i.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let f=0;f<u.data.length;f++){const p=t+f/(u.data.length-1)*350,m=n+80-u.data[f]/l*80;f===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function pv(e,t,n){e.save();const{x:i,y:s,width:a,height:l}=t.rect,c=LA;if(e.beginPath(),e.moveTo(i+c,s),e.lineTo(i+a-c,s),e.quadraticCurveTo(i+a,s,i+a,s+c),e.lineTo(i+a,s+l-c),e.quadraticCurveTo(i+a,s+l,i+a-c,s+l),e.lineTo(i+c,s+l),e.quadraticCurveTo(i,s+l,i,s+l-c),e.lineTo(i,s+c),e.quadraticCurveTo(i,s,i+c,s),e.closePath(),e.fillStyle=t.isDisabled?UA:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*xA)+1)/2;e.strokeStyle=$A,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<Zd){const f=1-u/Zd;e.fillStyle=GA,e.globalAlpha=f,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=mg,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?HA:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,i+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,i+a-4,s+l-2))):(e.font=`${it*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,i+a/2,s+l/2)),e.restore()}function uF(e,t,n,i){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,i);const s=500,a=150,l=(n-s)/2,c=(i-a)/2;e.fillStyle=Ut,e.font=`${it*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,c+a/3-10),e.fillText("to the main menu?",n/2,c+a/3+10);const u=Qi*1.5,f=FA,p=c+a-f-et*2,m=20,S=u*2+m,v=l+(s-S)/2,I={id:"confirmExitYes",action:ae.ConfirmExitYes,rect:{x:v,y:p,width:u,height:f},text:"Yes",backgroundColor:Ho,textColor:Ut,currentWidth:u},A=v+u+m,_={id:"confirmExitNo",action:ae.ConfirmExitNo,rect:{x:A,y:p,width:u,height:f},text:"No",backgroundColor:Ho,textColor:Ut,currentWidth:u};t.uiButtons.push(I,_),pv(e,I,t.hoveredButtonId===I.id),pv(e,_,t.hoveredButtonId===_.id),e.restore()}const Bo=600,_s=30,Pi=60,Yt=30,fF="";function hF(e,t,n){const i=[];if(!n.tribeControl||!n.leaderId)return i;const{width:s,height:a}=e.canvas,l=(s-Bo)/2,c=480,u=(a-c)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(l,u,Bo,c,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Ut,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Tribe Roles",l+Bo/2,u+_s);const f=30,p=l+Bo-_s-f,m=u+_s,S=t.hoveredButtonId==="roleManager_close";e.fillStyle=S?"#ff7777":"#ff5555",e.fillRect(p,m,f,f),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",p+f/2,m+f/2),i.push({id:"roleManager_close",action:ae.CloseRoleManager,rect:{x:p,y:m,width:f,height:f},text:"X",currentWidth:f,backgroundColor:"#ff5555",textColor:"#ffffff"});const I=Bi(n.leaderId,t).filter(j=>j.isAdult),A={[J.Leader]:0,[J.Gatherer]:0,[J.Planter]:0,[J.Hunter]:0,[J.Mover]:0,[J.Warrior]:0};I.forEach(j=>{j.tribeRole&&A[j.tribeRole]++});const _=n.tribeControl.roleWeights,P=[{role:J.Gatherer,emoji:"",name:"Gatherer"},{role:J.Planter,emoji:"",name:"Planter"},{role:J.Hunter,emoji:"",name:"Hunter"},{role:J.Mover,emoji:"",name:"Mover"},{role:J.Warrior,emoji:"",name:"Warrior"}];let R=0;P.forEach(j=>{R+=_[j.role]||0});let w=u+_s+70;const B=l+_s,O=l+Bo-_s;P.forEach(j=>{const ie=_[j.role]||0,re=R>0?Math.round(ie/R*100):0,_e=A[j.role]||0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ut,e.fillText(`${j.emoji} ${_e} ${j.name}`,B,w+Pi/2);const ue=l+220,ne=ue+Yt+15,V=ne+200+15,K=`role_minus_${j.role}`,b=t.hoveredButtonId===K,Y=ie<=0,le=Y?"#555":b?"#dd6666":"#cc4444";e.fillStyle=le,e.fillRect(ue,w+(Pi-Yt)/2,Yt,Yt),e.fillStyle=Y?"#888":"#fff",e.textAlign="center",e.fillText("-",ue+Yt/2,w+Pi/2+2),i.push({id:K,action:ae.DecreaseRoleWeight,targetRole:j.role,rect:{x:ue,y:w+(Pi-Yt)/2,width:Yt,height:Yt},text:"-",currentWidth:Yt,backgroundColor:le,textColor:"#fff",isDisabled:Y}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#fff";let pe=ne;for(let ce=0;ce<ie;ce++)e.fillText(fF,pe,w+Pi/2+2),pe+=18;const Pe=`role_plus_${j.role}`,me=t.hoveredButtonId===Pe,Oe=ie>=10,Ne=Oe?"#555":me?"#66dd66":"#44cc44";e.fillStyle=Ne,e.fillRect(V,w+(Pi-Yt)/2,Yt,Yt),e.fillStyle=Oe?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",V+Yt/2,w+Pi/2+4),i.push({id:Pe,action:ae.IncreaseRoleWeight,targetRole:j.role,rect:{x:V,y:w+(Pi-Yt)/2,width:Yt,height:Yt},text:"+",currentWidth:Yt,backgroundColor:Ne,textColor:"#fff",isDisabled:Oe}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ut,e.fillText(`${re}%`,O,w+Pi/2),w+=Pi});const N=A[J.Leader],M=Object.values(A).reduce((j,ie)=>j+ie,0),F=I.length-M;e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`Adults: ${I.length} | Leader: ${N} | Assigned: ${M} | Unassigned: ${F}`,l+Bo/2,w+10),e.fillText("(Adjust weights to control role distribution)",l+Bo/2,w+30);const x=t.autopilotControls.behaviors.roleManagement,Z=x?" Auto-adjust: ON":" Auto-adjust: OFF",te=x?"#4CAF50":"#888";return e.fillStyle=te,e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText(`${Z} (Shift+U to toggle)`,l+Bo/2,w+50),e.restore(),i}const Cr=600,ws=30,Di=60,zt=30,gv=[{key:"protectHomeland",emoji:"",name:"Protect Homeland",description:"Stay inside territory and protect from enemies"},{key:"expandBorders",emoji:"",name:"Expand Borders",description:"Expand territory by placing border posts (Coming Soon)"},{key:"invadeEnemies",emoji:"",name:"Invade Enemies",description:"Attack enemies outside of our border"}];function pF(e,t,n){const i=[];if(!n.tribeControl||n.leaderId!==n.id)return i;const s=n.tribeControl.armyControl??{protectHomeland:Ip,expandBorders:Tp,invadeEnemies:Ep},{width:a,height:l}=e.canvas,c=(a-Cr)/2,u=350,f=(l-u)/2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.beginPath(),e.roundRect(c,f,Cr,u,10),e.fill(),e.strokeStyle="#444",e.lineWidth=2,e.stroke(),e.fillStyle=Ut,e.font=`${it*1.2}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="top",e.fillText("Army Control",c+Cr/2,f+ws);const p=30,m=c+Cr-ws-p,S=f+ws,v=t.hoveredButtonId==="armyControl_close";e.fillStyle=v?"#ff7777":"#ff5555",e.fillRect(m,S,p,p),e.fillStyle="#ffffff",e.font="20px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText("X",m+p/2,S+p/2),i.push({id:"armyControl_close",action:ae.CloseArmyControl,rect:{x:m,y:S,width:p,height:p},text:"X",currentWidth:p,backgroundColor:"#ff5555",textColor:"#ffffff"});let I=0;gv.forEach(R=>{I+=s[R.key]||0});let A=f+ws+70;const _=c+ws,P=c+Cr-ws;return gv.forEach(R=>{const w=s[R.key]||0,B=I>0?Math.round(w/I*100):0;e.textAlign="left",e.textBaseline="middle",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ut,e.fillText(`${R.emoji} ${R.name}`,_,A+Di/2);const O=c+320,N=O+zt+15,M=120,F=N+M+15,x=`army_minus_${R.key}`,Z=t.hoveredButtonId===x,te=w<=0,j=te?"#555":Z?"#dd6666":"#cc4444";e.fillStyle=j,e.fillRect(O,A+(Di-zt)/2,zt,zt),e.fillStyle=te?"#888":"#fff",e.textAlign="center",e.fillText("-",O+zt/2,A+Di/2+2),i.push({id:x,action:ae.DecreaseArmyObjective,targetArmyObjective:R.key,rect:{x:O,y:A+(Di-zt)/2,width:zt,height:zt},text:"-",currentWidth:zt,backgroundColor:j,textColor:"#fff",isDisabled:te}),e.textAlign="left",e.font="16px Arial",e.fillStyle="#4CAF50";const ie=M-10,re=12,_e=A+Di/2-re/2;e.fillStyle="#333",e.fillRect(N,_e,ie,re);const ue=w/10*ie;e.fillStyle="#4CAF50",e.fillRect(N,_e,ue,re);const ne=`army_plus_${R.key}`,z=t.hoveredButtonId===ne,V=w>=10,K=V?"#555":z?"#66dd66":"#44cc44";e.fillStyle=K,e.fillRect(F,A+(Di-zt)/2,zt,zt),e.fillStyle=V?"#888":"#fff",e.textAlign="center",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillText("+",F+zt/2,A+Di/2+4),i.push({id:ne,action:ae.IncreaseArmyObjective,targetArmyObjective:R.key,rect:{x:F,y:A+(Di-zt)/2,width:zt,height:zt},text:"+",currentWidth:zt,backgroundColor:K,textColor:"#fff",isDisabled:V}),e.textAlign="right",e.font=`${it*.8}px "Press Start 2P", Arial`,e.fillStyle=Ut,e.fillText(`${B}%`,P,A+Di/2),A+=Di}),e.textAlign="center",e.fillStyle="#aaa",e.font=`${it*.6}px "Press Start 2P", Arial`,e.fillText("Adjust priorities for warrior objectives",c+Cr/2,A+10),e.fillText("Higher values = higher priority",c+Cr/2,A+30),e.restore(),i}let mv="",yv=null;function gF(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function mF(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function Nd(e,t,n,i,s,a,l){const c=((t+i)%a+a)%a,u=((n+s)%l+l)%l;return e.has(`${c},${u}`)}function yF(e,t,n,i){const s=Kw(t.soilDepletion,Zv);if(s.length===0)return;const{width:a,height:l}=t.mapDimensions,c=i.width/2,u=i.height/2,f=Math.ceil(a/jt),p=Math.ceil(l/jt),m=gF(s);m!==mv&&(mv=m,yv=mF(s));const S=yv,v=jt*2,I=n.x-c-v,A=n.x+c+v,_=n.y-u-v,P=n.y+u+v;e.save();const R=e.globalAlpha;for(const w of s){const B=w.gridX*jt,O=w.gridY*jt,N=SF(B,O,a,l,I,A,_,P);for(const M of N)vF(e,M.x,M.y,w.health,w.gridX,w.gridY,S,f,p)}e.globalAlpha=R,e.restore()}function SF(e,t,n,i,s,a,l,c){const u=[],f=jt,p=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-i},{dx:0,dy:i},{dx:-n,dy:-i},{dx:n,dy:-i},{dx:-n,dy:i},{dx:n,dy:i}];for(const m of p){const S=e+m.dx,v=t+m.dy;S+f>=s&&S<=a&&v+f>=l&&v<=c&&u.push({x:S,y:v})}return u}function vF(e,t,n,i,s,a,l,c,u){const f=Math.floor(t),p=Math.floor(n),m=jt,S=1-i/Zv,I=i<Tw?Vy:Vy*S,A=!Nd(l,s,a,0,-1,c,u),_=!Nd(l,s,a,0,1,c,u),P=!Nd(l,s,a,-1,0,c,u),R=!Nd(l,s,a,1,0,c,u);e.globalAlpha=I,e.fillStyle=Aw,e.fillRect(f,p,m,m);const w=3;e.fillStyle=Iw,e.globalAlpha=I*1.2,A&&e.fillRect(f,p,m,w),_&&e.fillRect(f,p+m-w,m,w),P&&e.fillRect(f,p,w,m),R&&e.fillRect(f+m-w,p,w,m),e.globalAlpha=I*.5;const B=w+1;A&&P&&e.fillRect(f,p,B,B),A&&R&&e.fillRect(f+m-B,p,B,B),_&&P&&e.fillRect(f,p+m-B,B,B),_&&R&&e.fillRect(f+m-B,p+m-B,B,B),e.globalAlpha=1}const fl=8,hl=12,fn=24;function Sv(e,t,n,i,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-hl),e.stroke(),e.fillStyle=i,e.beginPath(),e.moveTo(t,n-hl),e.lineTo(t+fl,n-hl+fl/2),e.lineTo(t,n-hl+fl),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+fl/2,n-hl+fl/2))}function AF(e,t,n,i,s){const a=Du(t,s);let l=1;const c=new Map,u=new Map;for(const A of a){const P=A.leaderId===s?0:l++,R=$n[P%$n.length];c.set(A.leaderId,R),u.set(A.leaderId,A.tribeBadge||"")}const f=[],p=fn*2,m=Math.floor((n.x-i.width/2-p)/fn)*fn,S=Math.floor((n.x+i.width/2+p)/fn)*fn,v=Math.floor((n.y-i.height/2-p)/fn)*fn,I=Math.floor((n.y+i.height/2+p)/fn)*fn;for(let A=v;A<=I;A+=fn)for(let _=m;_<=S;_+=fn){const P=zo(_,A,t),R=_+fn,w=zo(R,A,t);if(P!==w){const N=P||w;if(N){const M=_+fn/2,F=A;Sv(e,M,F,c.get(N)||"#000",u.get(N)||""),f.push({x:M,y:F})}}const B=A+fn,O=zo(_,B,t);if(P!==O){const N=P||O;if(N){const M=_,F=A+fn/2;Sv(e,M,F,c.get(N)||"#000",u.get(N)||""),f.push({x:M,y:F})}}}return f}const Un=12,wt=16,Zn=15;function vv(e){switch(e){case W.Success:return"#4CAF50";case W.Failure:return"#F44336";case W.Running:return"#FFC107";case W.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function IF(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function TF(e,t,n,i){var M;const{debugCharacterId:s}=t,a=500,l=Math.min(i*.9,800),c=n-a-10,u=et+it*2;t.debugPanelRect={x:c,y:u,width:a,height:l},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(c,u,a,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(c,u,a,l),e.fillStyle="white",e.font=`${Un}px monospace`,e.textAlign="left",e.textBaseline="top";let f=u+20;const p=c+15;if(e.fillStyle="#66ccff",e.font=`bold ${Un+2}px monospace`,e.fillText(" Task AI Debugger",p,f),f+=25,!s){e.fillStyle="#888",e.font=`${Un}px monospace`,e.fillText("No character selected for debugging.",p,f),e.fillText("Click on a character to inspect their Task AI.",p,f+20),e.restore();return}const m=t.entities.entities[s];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${Un}px monospace`,e.fillText(`Character #${s} not found or not a character.`,p,f),e.restore();return}const S=m;e.fillStyle="white",e.font=`${Un}px monospace`,e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,p,f),f+=wt*1.5,e.fillStyle="#66ccff",e.font=`bold ${Un}px monospace`,e.fillText(" Current Task",p,f),f+=wt*1.5;const v=Ud(S),I=v?t.tasks[v]:null;if(e.font=`${Un}px monospace`,I){const F=C.get(S.aiBlackboard,yI),x=C.get(S.aiBlackboard,SI),Z=F!==void 0?W[F]:"N/A";e.fillStyle="white",e.fillText(`ID: ${I.id}`,p+Zn,f),f+=wt,e.fillText(`Type: ${ge[I.type]}`,p+Zn,f),f+=wt,e.fillText(`Target: ${IF(I.target)}`,p+Zn,f),f+=wt,e.fillStyle=vv(F),e.fillText(`Status: ${Z}`,p+Zn,f),f+=wt,x&&(e.fillStyle="#aaa",e.fillText(`Message: ${x}`,p+Zn,f),f+=wt)}else e.fillStyle="#888",e.fillText("No active task.",p+Zn,f),f+=wt;f+=wt,e.fillStyle="#66ccff",e.font=`bold ${Un}px monospace`,e.fillText(" Recent Task History (Last 5)",p,f),f+=wt*1.5;const A=C.get(S.aiBlackboard,wp)||[];if(A.length===0)e.fillStyle="#888",e.font=`${Un}px monospace`,e.fillText("No task history yet.",p+Zn,f),f+=wt;else for(const F of A){e.fillStyle="white",e.font=`${Un}px monospace`;const x=ge[F.type];e.fillText(` ${x}`,p+Zn,f);const Z=W[F.result];e.fillStyle=vv(F.result);const te=e.measureText(` ${x} `).width;e.fillText(`(${Z})`,p+Zn+te,f),e.fillStyle="#666";const j=e.measureText(`(${Z}) `).width;e.fillText(`@ ${F.completedAtTick.toFixed(1)}h`,p+Zn+te+j,f),f+=wt,F.message&&(e.fillStyle="#888",e.fillText(`   ${F.message}`,p+Zn,f),f+=wt)}f+=wt,e.fillStyle="#66ccff",e.font=`bold ${Un}px monospace`,e.fillText(" Available Tasks",p,f),f+=wt*1.5;const _=f,P=u+l-_-30;e.save(),e.beginPath(),e.rect(c,_,a,P),e.clip();const R=((M=t.debugPanelScroll)==null?void 0:M.y)??0;e.translate(0,-R);const w=Object.values(t.tasks);let B=0;if(w.length===0)e.fillStyle="#888",e.font=`${Un}px monospace`,e.fillText("No tasks available in the world.",p+Zn,f),f+=wt;else for(const F of w){const x=Pu[F.type],Z=x&&x.scorer&&S.type==="human"?x.scorer(S,F,{gameState:t,deltaTime:0}):null;let te="Unclaimed",j="#888";F.claimedByEntityId&&(F.claimedByEntityId===S.id?(te="Claimed by this character",j="#4CAF50"):(te=`Claimed by #${F.claimedByEntityId}`,j="#F44336")),e.font=`${Un}px monospace`,e.fillStyle=j;const ie=` Task ID: ${F.id}`;e.fillText(ie,p,f),f+=wt,e.fillStyle="white",e.fillText(`  Type: ${ge[F.type]}`,p,f),f+=wt;const re=Z!==null?Z.toFixed(3):"N/A";e.fillStyle=Z!==null&&Z>0?"#FFC107":"#888",e.fillText(`  Score: ${re}`,p,f),f+=wt,e.fillStyle=j,e.fillText(`  Status: ${te}`,p,f),f+=wt*1.5,B=Math.max(B,e.measureText(ie).width+30)}const O=f-_;t.debugPanelContentSize={width:B,height:O},e.restore();const N=u+l-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",c+a/2,N),e.restore()}function EF(e,t,n,i){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey")return;switch(a.aiType){case Gt.TaskBased:TF(e,t,n,i);break;case Gt.BehaviorTreeBased:tB(e,t,n,i);break}const l=500,c=n-l-10,u=et+it*2,f=150,p=25,m=c+l-f-15,S=u+15,v={x:m,y:S,width:f,height:p};t.uiButtons.push({id:"switch-ai-type-button",action:ae.SwitchAIType,rect:v,text:"",currentWidth:f,backgroundColor:"rgba(100, 100, 100, 0.5)",textColor:"white"}),e.save(),e.fillStyle="rgba(100, 100, 100, 0.8)",e.fillRect(m,S,f,p),e.strokeStyle="#fff",e.lineWidth=1,e.strokeRect(m,S,f,p),e.fillStyle="white",e.font="10px monospace",e.textAlign="center",e.textBaseline="middle";const I=a.aiType===Gt.BehaviorTreeBased?"BT":"Task";e.fillText(`AI: ${I} (Switch)`,m+f/2,S+p/2),e.restore()}function lu(e,t,n,i,s,a=!1){var f;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),Lb(e,t);return}const l=St(t),c=AF(e,t,n,s,l==null?void 0:l.leaderId);if(yF(e,t,n,s),QB(e,t,t.debugPanel===ze.General,n,s,c),l&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const p=Gp(t.mousePosition,n,s,t.mapDimensions),m=ra(p,t.selectedBuildingType,l.leaderId,t);DB(e,p,t.selectedBuildingType,m,t.mapDimensions)}const u=t.notifications.filter(p=>!p.isDismissed);for(const p of u){const m=(Math.sin(t.time*CP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=EP,p.targetArea&&e.fillRect(p.targetArea.x,p.targetArea.y,p.targetArea.width,p.targetArea.height),p.targetRadius&&(e.beginPath(),e.arc(p.targetRadius.x,p.targetRadius.y,p.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,Vb(e,t),e.restore(),!a){e.fillStyle=O1,e.font=`${it}px "Press Start 2P", Arial`,e.shadowColor=k1,e.shadowBlur=b1,t.uiButtons=[];let p=null,m=null;if(l){const I=Pn(t,l),A=Wr(I),_=((f=l.partnerIds)==null?void 0:f.map(R=>t.entities.entities[R]).filter(R=>R!==void 0))||[],P=JB(e,t,l,A,_,I);p=P.hungerBarRect,m=P.foodBarRect}const S=Du(t,l==null?void 0:l.leaderId);bb(e,t,S,e.canvas.width,e.canvas.height);const{commandButtonsRect:v}=Ib(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,l&&(jb(e,t,n,e.canvas.width,e.canvas.height),i.length>0&&_b(e,i,l,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:I}=t.tutorialState;I.includes(Ur.HUNGER_BAR)&&p&&ap(e,p,t.time),I.includes(Ur.FOOD_BAR)&&m&&ap(e,m,t.time),I.includes(Ur.COMMAND_BUTTONS)&&v&&ap(e,v,t.time)}if(t.tutorialState.isActive){const I=Fb(e,t,e.canvas.width,e.canvas.height);I&&t.uiButtons.push({id:"tutorial-dismiss",action:ae.DismissTutorial,rect:I,text:"",currentWidth:I.width,backgroundColor:"transparent",textColor:"transparent"})}switch(qb(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case ze.Ecosystem:nF(e,t,e.canvas.width,e.canvas.height);break;case ze.Tribe:lF(e,t,e.canvas.width,e.canvas.height);break;case ze.SupplyChain:iB(e,t,e.canvas.width,e.canvas.height);break;case ze.Performance:Qb(e,t,s.width);break;case ze.General:EF(e,t,e.canvas.width,e.canvas.height);break}if(t.roleManagerOpen&&l&&l.leaderId===l.id){const I=hF(e,t,l);t.uiButtons.push(...I)}if(t.armyControlOpen&&l&&l.leaderId===l.id){const I=pF(e,t,l);t.uiButtons.push(...I)}t.isPaused&&t.exitConfirmation!=="pending"&&Tb(e),t.exitConfirmation==="pending"&&uF(e,t,e.canvas.width,e.canvas.height)}}const CF=Ot.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,_F=Ot.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,wF=Ot.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,RF=Ot.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Av=Ot.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,PF=Ot.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,DF=Ot.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,Md="intro-soundtrack",Iv=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=Xr(),i=Fe.useRef(null),s=Fe.useRef(null),a=Fe.useRef(mk()),l=Fe.useRef(),c=Fe.useRef(a.current.viewportCenter),u=Fe.useRef(),f=Fe.useCallback(()=>{Hh(Md,2),n(),e("game")},[e,n]),p=Fe.useCallback(()=>{t&&(Hh(Md,2),e("game"))},[e,t]);Fe.useEffect(()=>{const v=I=>{(I.key==="Enter"||I.key===" ")&&(t?p():f())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[f,p,t]),Fe.useEffect(()=>(fg(Ce.SoundTrack1,{loop:!0,trackId:Md}),()=>{Hh(Md,2)}),[]),Fe.useEffect(()=>{const v=i.current;if(!v)return;s.current=v.getContext("2d");const I=()=>{v&&s.current&&(v.width=window.innerWidth,v.height=window.innerHeight,lu(s.current,a.current,c.current,[],{width:v.width,height:v.height},!0))};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]),Fe.useEffect(()=>{const v=()=>{const A=rI(a.current);if(A.length>0){const _=Math.floor(Math.random()*A.length);u.current=A[_].id}};v();const I=setInterval(v,NC);return()=>clearInterval(I)},[]);const[m,S]=tT(v=>{var _,P;if(!s.current)return;if(l.current===void 0){l.current=v;return}const I=Math.min((v-l.current)/1e3,1);a.current=Lu(a.current,I);const A=u.current?a.current.entities.entities[u.current]:void 0;if(A){const{mapDimensions:R}=a.current,{width:w,height:B}=R;let O={...A.position};const N=O.x-c.current.x;Math.abs(N)>w/2&&(N>0?O.x-=w:O.x+=w);const M=O.y-c.current.y;Math.abs(M)>B/2&&(M>0?O.y-=B:O.y+=B);let F=zp(c.current,O,Yp*I);F={x:(F.x%w+w)%w,y:(F.y%B+B)%B},c.current=F}lu(s.current,a.current,c.current,[],{width:((_=i.current)==null?void 0:_.width)||800,height:((P=i.current)==null?void 0:P.height)||600},!0),l.current=v});return Fe.useEffect(()=>(S(),m),[S,m]),Ue.jsxs(CF,{children:[Ue.jsx(_F,{ref:i}),Ue.jsxs(wF,{children:[Ue.jsx(RF,{children:"Tribe2"}),Ue.jsxs(PF,{children:[Ue.jsx(Av,{onClick:f,children:"New Game"}),t&&Ue.jsx(Av,{onClick:p,children:"Load Game"})]}),Ue.jsxs(DF,{children:["by"," ",Ue.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function NF(){console.log("Tribe game initialized with detailed 2D world state.");const e=gk();return e.ecosystem={preyGestationPeriod:Or,preyProcreationCooldown:kr,predatorGestationPeriod:br,predatorProcreationCooldown:Br,preyHungerIncreasePerHour:$o,predatorHungerIncreasePerHour:xo,berryBushSpreadChance:no},e.debugPanel=ze.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const MF=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:i,playerActionHintsRef:s})=>(Fe.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const l=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,lu(t.current,n.current,i.current,s.current,{width:a.width,height:a.height},!1))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),Ue.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),OF=(e,t,n,i=!1)=>{var l,c;let s;const a=OD(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:oe.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:oe.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const u=a;t.isAdult&&fa(t,u,n)?s={action:oe.AutopilotAttack,targetEntityId:u.id}:er(t,u,n)?s={action:oe.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:oe.AutopilotFeedChild,targetEntityId:u.id})}else if(a.type==="prey")s={action:oe.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:oe.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const u=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&Xt(t,u,n)&&u.isConstructed?s={action:oe.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:oe.Removal,position:a.position};else if(t.leaderId===t.id&&Xt(t,u,n)&&u.isConstructed)rA(u.position,qs,t.id,n).valid?s={action:oe.TakeOverBuilding,targetEntityId:u.id}:s={action:oe.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const f=u.ownerId===t.leaderId,p=u.storedItems.length>0,m=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(i&&u.isConstructed&&p&&t.food.length<t.maxFood)if(f)s={action:oe.AutopilotRetrieve,targetEntityId:a.id};else{const S=t.leaderId?n.entities.entities[t.leaderId]:void 0;S&&((l=S.tribeControl)!=null&&l.diplomacy)?(u.ownerId&&S.tribeControl.diplomacy[u.ownerId])===Lt.Hostile?s={action:oe.AutopilotGather,targetEntityId:a.id}:s={action:oe.AutopilotMove,position:e}:s={action:oe.AutopilotMove,position:e}}else f&&u.isConstructed?(t.food.length>0||t.heldItem)&&m?s={action:oe.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&p?s={action:oe.AutopilotRetrieve,targetEntityId:a.id}:s={action:oe.AutopilotMove,position:e}:s={action:oe.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(f=>f.type===vn.Berry).length>=so&&!xn(e,n,qo)&&!ki(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:oe.AutopilotPlant,position:e}:u.buildingType===de.Bonfire&&((c=t.heldItem)==null?void 0:c.type)===mt.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:oe.AutopilotDeposit,targetEntityId:u.id}:s={action:oe.AutopilotMove,position:e}}else if(a.type==="tree"){const u=a,[f]=u.stateMachine??[],p=f===rn||f===Vt||f===Sn;t.isAdult&&!t.heldItem&&p?s={action:oe.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&f===Ht&&u.wood.length>0?s={action:oe.AutopilotGather,targetEntityId:u.id}:s={action:oe.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===vn.Berry).length>=so&&(n.autopilotControls.isManuallyPlanting||Kl(e,n,t))&&!ki(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:oe.AutopilotPlant,position:e}:s={action:oe.AutopilotMove,position:e};return s},kF=(e,t)=>{if(e.isPaused)return;const n=St(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=U(n.position,t,e.mapDimensions.width,e.mapDimensions.height),l=100;a<=l?ra(t,s,n.leaderId,e,n.position,l)&&(Xo(t,s,n.leaderId,e),e.selectedBuildingType=null):ra(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:oe.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=XM(t,e);s&&Rp(s.id,e);return}const i=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,i?(e.autopilotControls.activeAutopilotAction=i,(i.action===oe.AutopilotMove||i.action===oe.AutopilotGather||i.action===oe.AutopilotChop)&&(e.hasPlayerMovedEver=!0),i.action===oe.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:oe.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},bF=(e,t)=>{var l,c,u,f,p,m,S,v;const n=e.key.toLowerCase(),i=e.ctrlKey||e.metaKey;let s=!0,a=t;if(i){switch(n){case"s":Dg(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:I}=t;I.activeAutopilotAction||I.isManuallyMoving||I.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(I.activeAutopilotAction=void 0,I.isManuallyMoving=!1,I.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"u":const A=St(t);A&&A.isAdult&&A.leaderId===A.id&&(e.shiftKey?t.autopilotControls.behaviors.roleManagement=!t.autopilotControls.behaviors.roleManagement:t.roleManagerOpen=!t.roleManagerOpen);break;case"v":{const R=St(t);R&&R.isAdult&&R.leaderId===R.id&&(t.armyControlOpen=!t.armyControlOpen);break}case"m":t.isMuted=!t.isMuted,_l(t.masterVolume,t.isMuted);break;case"=":case"+":const _=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(_.toFixed(1)),_l(t.masterVolume,t.isMuted);break;case"-":const P=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(P.toFixed(1)),_l(t.masterVolume,t.isMuted);break;case"t":a=Lu(t,tI);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===ze.General?(a.debugPanel=ze.None,a.debugCharacterId=void 0):(a.debugPanel=ze.General,a.debugCharacterId||(a.debugCharacterId=((l=St(a))==null?void 0:l.id)??((c=Object.values(a.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:c.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===ze.Ecosystem){a.debugPanel=ze.None;break}a.debugPanel=ze.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((u=St(a))==null?void 0:u.id)??((f=Object.values(a.entities.entities).find(R=>R.type==="human"||R.type==="prey"||R.type==="predator"))==null?void 0:f.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===ze.Tribe){a.debugPanel=ze.None;break}a.debugPanel=ze.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((p=St(a))==null?void 0:p.id)??((m=a.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:m.id))}else s=!1;break;case"$":if(e.shiftKey){if(a.debugPanel===ze.SupplyChain){a.debugPanel=ze.None;break}a.debugPanel=ze.SupplyChain,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((S=St(a))==null?void 0:S.id)??((v=a.search.human.all().find(R=>R.leaderId===R.id))==null?void 0:v.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===ze.Performance){a.debugPanel=ze.None;break}a.debugPanel=ze.Performance}else s=!1;break;case"tab":if(a.debugPanel!==ze.General&&a.debugPanel!==ze.Tribe&&a.debugPanel!==ze.SupplyChain&&(a.debugPanel=ze.General),a.debugPanel===ze.General){const R=Object.values(a.entities.entities).filter(w=>w.type==="human"||w.type==="prey"||w.type==="predator");if(R.length>0){const w=R.sort((M,F)=>{if(M.type==="human"&&M.isPlayer)return-1;if(F.type==="human"&&F.isPlayer)return 1;if(M.type!==F.type){const x={human:0,prey:1,predator:2},Z=x[M.type]??999,te=x[F.type]??999;return Z-te}return M.id-F.id}),B=a.debugCharacterId,N=((B?w.findIndex(M=>M.id===B):-1)+1)%w.length;a.debugCharacterId=w[N].id}else a.debugCharacterId=void 0}else if(a.debugPanel===ze.Tribe||a.debugPanel===ze.SupplyChain){const R=a.search.human.all().filter(B=>B.leaderId===B.id);let w=R.findIndex(B=>B.id===a.debugCharacterId)+1;(w===-1||w>R.length-1)&&(w=0),a.debugCharacterId=R[w].id}else a.debugPanel=ze.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},BF=(e,t,n,i,s)=>{var l;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",Me(a,Ce.ButtonClick,i.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",Me(a,Ce.ButtonClick,i.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",Me(a,Ce.ButtonClick,i.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",Me(a,Ce.ButtonClick,i.position);return}else if(e==="6"){n.selectedBuildingType="removal",Me(a,Ce.ButtonClick,i.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const c=Be(i,n,"berryBush",je,p=>p.food.length>0&&i.food.length<i.maxFood),u=Be(i,n,"corpse",je,p=>p.food.length>0&&i.food.length<i.maxFood);let f=null;c&&u?f=U(i.position,c.position,n.mapDimensions.width,n.mapDimensions.height)<=U(i.position,u.position,n.mapDimensions.width,n.mapDimensions.height)?c:u:f=c||u,f&&(i.activeAction="gathering",Me(a,Ce.Gather,i.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}Be(i,n,"human",je,u=>er(i,u,n))&&(i.activeAction="procreating",Me(a,Ce.Procreate,i.position))}else if(e==="f")i.food.length>0&&(i.activeAction="eating",Me(a,Ce.Eat,i.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const c=s.find(u=>u.type===oe.FeedChild);c&&c.targetEntity&&(i.activeAction="feeding",i.target=c.targetEntity.id)}else if(e==="arrowup"||e==="w")i.direction.y=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")i.direction.y=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")i.direction.x=-1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")i.direction.x=1,i.activeAction="moving",i.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const c=Be(i,n,"human",yn,u=>fa(i,u,n))??Be(i,n,"predator",yn)??Be(i,n,"prey",yn);c&&(i.activeAction="attacking",i.attackTargetId=c.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===oe.Plant)){const u=Cw(i.position,n,50,Sp);u&&(i.activeAction="planting",i.target=u,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const c=Be(i,n,"building",qt,f=>{const p=f;return p.buildingType===de.Bonfire&&p.isConstructed&&p.storedItems.length<(p.storageCapacity||0)});if(((l=i.heldItem)==null?void 0:l.type)===mt.Wood&&c){i.activeAction="depositing",i.target=c.id,Me(a,Ce.StorageDeposit,i.position);return}const u=Be(i,n,"building",qt,f=>{const p=f;return p.buildingType===de.StorageSpot&&p.ownerId===i.leaderId&&p.isConstructed&&p.storageCapacity!==void 0&&p.storedItems.length<p.storageCapacity});u&&(i.activeAction="idle",i.target=u.id,Me(a,Ce.StorageDeposit,i.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const c=Be(i,n,"building",qt,u=>{const f=u;return f.buildingType==="storageSpot"&&f.ownerId===i.leaderId&&f.isConstructed&&f.storedItems.length>0});c&&(i.activeAction="idle",i.target=c.id,Me(a,Ce.StorageRetrieve,i.position))}else if(e==="k")hI(i,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,Me(a,Ce.ButtonClick,i.position)}else if(e==="u"){if(t){n.autopilotControls.behaviors.roleManagement=!n.autopilotControls.behaviors.roleManagement;return}}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const c=Be(i,n,"tree",du,u=>u.wood&&u.wood.length>0&&!i.heldItem);c&&(i.activeAction="chopping",i.target=c.id)}},FF=(e,t,n,i)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!i.current.has("arrowup")&&!i.current.has("arrowdown")&&!i.current.has("arrowleft")&&!i.current.has("arrowright")&&!i.current.has("w")&&!i.current.has("a")&&!i.current.has("s")&&!i.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!i.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!i.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!i.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!i.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!i.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},LF=(e,t,n)=>{let s=St(e);if(e.debugCharacterId){const a=e.entities.entities[e.debugCharacterId];a&&"position"in a&&(s=a)}if(s){const{mapDimensions:a}=e,{width:l,height:c}=a;let u={...s.position};const f=u.x-t.x;Math.abs(f)>l/2&&(f>0?u.x-=l:u.x+=l);const p=u.y-t.y;Math.abs(p)>c/2&&(p>0?u.y-=c:u.y+=c);let m=zp(t,u,Yp*n);return m={x:(m.x%l+l)%l,y:(m.y%c+c)%c},m}return e.viewportCenter};function UF(e,t){const{width:n,height:i}=e.mapDimensions;e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%i+i)%i}}const HF=(e,t,n,i)=>{var u,f;const s={gameState:n},a=St(n);a&&Me(s,Ce.ButtonClick,a.position);const l=n.uiButtons.find(p=>p.id===e.id);l&&(l.lastActivated=Date.now()),t&&[ae.CommandGather,ae.CommandPlant,ae.ToggleProcreationBehavior,ae.CommandBuild,ae.OpenRoleManager].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:c}=n.autopilotControls;switch(e.action){case ae.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case ae.ConfirmExitYes:i(),n.exitConfirmation="inactive";break;case ae.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case ae.ToggleMute:n.isMuted=!n.isMuted,_l(n.masterVolume,n.isMuted);break;case ae.TogglePause:n.isPaused=!n.isPaused;break;case ae.FastForward:return Lu(n,tI);case ae.DismissTutorial:n.tutorialState.isActive=!1;break;case ae.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case ae.CommandGather:t?c.gathering=!c.gathering:a&&(a.activeAction="gathering");break;case ae.CommandPlant:t?c.planting=!c.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case ae.ToggleProcreationBehavior:c.procreation=!c.procreation;break;case ae.ToggleAttackBehavior:c.attack=!c.attack;break;case ae.ToggleFeedChildBehavior:c.feedChildren=!c.feedChildren;break;case ae.CommandTribeSplit:a&&hI(a,n);break;case ae.CommandBuild:t?c.build=!c.build:n.buildMenuOpen=!n.buildMenuOpen;break;case ae.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case ae.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case ae.SelectRemovalTool:n.selectedBuildingType="removal";break;case ae.SelectBorderPost:n.selectedBuildingType="borderPost";break;case ae.SelectBonfire:n.selectedBuildingType="bonfire";break;case ae.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const p=a.leaderId,m=e.targetTribeId,S=n.entities.entities[m],v=(u=a.tribeControl)==null?void 0:u.diplomacy,I=(f=S==null?void 0:S.tribeControl)==null?void 0:f.diplomacy;if(v&&I){const _=(v[m]||Lt.Friendly)===Lt.Friendly?Lt.Hostile:Lt.Friendly;v[m]=_,I[p]=_}}break;case ae.OpenRoleManager:t?c.roleManagement=!c.roleManagement:n.roleManagerOpen=!0;break;case ae.CloseRoleManager:n.roleManagerOpen=!1;break;case ae.IncreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const p=a.tribeControl.roleWeights[e.targetRole]||0;p<10&&(a.tribeControl.roleWeights[e.targetRole]=p+1)}break;case ae.DecreaseRoleWeight:if(a&&a.tribeControl&&e.targetRole){const p=a.tribeControl.roleWeights[e.targetRole]||0;p>0&&(a.tribeControl.roleWeights[e.targetRole]=p-1)}break;case ae.OpenArmyControl:n.armyControlOpen=!0;break;case ae.CloseArmyControl:n.armyControlOpen=!1;break;case ae.IncreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Ip,expandBorders:Tp,invadeEnemies:Ep});const p=a.tribeControl.armyControl[e.targetArmyObjective]||0;p<10&&(a.tribeControl.armyControl[e.targetArmyObjective]=p+1)}break;case ae.DecreaseArmyObjective:if(a&&a.tribeControl&&e.targetArmyObjective){a.tribeControl.armyControl||(a.tribeControl.armyControl={protectHomeland:Ip,expandBorders:Tp,invadeEnemies:Ep});const p=a.tribeControl.armyControl[e.targetArmyObjective]||0;p>0&&(a.tribeControl.armyControl[e.targetArmyObjective]=p-1)}break;case ae.SwitchAIType:if(n.debugCharacterId){const p=n.entities.entities[n.debugCharacterId];p&&(p.aiType=p.aiType===Gt.BehaviorTreeBased?Gt.TaskBased:Gt.BehaviorTreeBased)}break}return n};function GF(e,t,n){if(!e.notificationButtonRects)return!1;const i=St(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return V_(e,s),i&&Me({gameState:e},Ce.ButtonClick,i.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const l=e.notifications.find(c=>c.id===s);if(l){let c=l.targetPosition;if(!c&&l.targetEntityIds&&l.targetEntityIds.length>0){const u=e.entities.entities[l.targetEntityIds[0]];u&&(c=u.position)}return c&&UF(e,c),i&&Me({gameState:e},Ce.ButtonClick,i.position),l.highlightedEntityIds&&(l.renderHighlights=!l.renderHighlights),!0}}return!1}function gT(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const $F=(e,t)=>{var n;if(t.debugPanel!==ze.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(gT(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},xF=(e,t)=>t.debugPanel!==ze.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:gT(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Tv=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},WF=(e,t)=>{var n,i;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const l=t.debugPanelRect.height-60,c=Math.max(0,(((i=t.debugPanelContentSize)==null?void 0:i.height)??0)-l);return t.debugPanelScroll.y>c&&(t.debugPanelScroll.y=c),{newState:t,handled:!0}}return{newState:t,handled:!1}},YF=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,returnToIntro:l})=>(Fe.useEffect(()=>{const c=u=>{if(!e()||t.current.gameOver||!n.current)return;const f=$F(u,t.current);t.current=f.newState,f.handled};return window.addEventListener("wheel",c,{passive:!1}),()=>{window.removeEventListener("wheel",c)}},[e,n,t]),Fe.useEffect(()=>{const c=f=>{if(!e()||t.current.gameOver||!n.current||!f.target||f.target!==n.current)return;const p=n.current.getBoundingClientRect(),m=f.clientX-p.left,S=f.clientY-p.top;if(GF(t.current,m,S))return;const I=t.current.uiButtons.find(P=>m>=P.rect.x&&m<=P.rect.x+P.rect.width&&S>=P.rect.y&&S<=P.rect.y+P.rect.height);if(I){t.current=HF(I,f.shiftKey,t.current,l);return}const A=xF(f,t.current);if(t.current=A.newState,A.handled)return;const _=Gp({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);kF(t.current,_)},u=f=>{if(!e()||!n.current)return;const p=Tv(f,t.current);t.current=p.newState};return window.addEventListener("mousedown",c),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",c),window.removeEventListener("mouseup",u)}},[e,n,t,i,l]),Fe.useEffect(()=>{const c=u=>{if(!e()||!n.current)return;const f=WF(u,t.current);if(t.current=f.newState,f.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const A=Tv(u,t.current);t.current=A.newState}const p=n.current.getBoundingClientRect(),m=u.clientX-p.left,S=u.clientY-p.top;t.current.mousePosition={x:m,y:S};let v;if(t.current.notificationButtonRects){for(const[A,_]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=_.x&&m<=_.x+_.width&&S>=_.y&&S<=_.y+_.height){v=`notification-dismiss-${A}`;break}if(!v){for(const[A,_]of Object.entries(t.current.notificationButtonRects.view))if(m>=_.x&&m<=_.x+_.width&&S>=_.y&&S<=_.y+_.height){v=`notification-view-${A}`;break}}}if(!v)for(let A=t.current.uiButtons.length-1;A>=0;A--){const _=t.current.uiButtons[A];if(m>=_.rect.x&&m<=_.rect.x+_.rect.width&&S>=_.rect.y&&S<=_.rect.y+_.rect.height){v=_.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0;return}const I=St(t.current);if(I){const A=Gp({x:m,y:S},i.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=OF(A,I,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",c),()=>{window.removeEventListener("mousemove",c)}},[e,n,t,i]),Fe.useEffect(()=>{const c=f=>{if(!e()||t.current.gameOver)return;const p=f.key.toLowerCase();(p===" "||p==="p"||p==="tab"||(f.ctrlKey||f.metaKey)&&(p==="s"||p==="a"))&&f.preventDefault();const m=bF(f,t.current);if(t.current=m.newState,m.handled)return;const S=St(t.current);S&&(a.current.add(p),BF(p,f.shiftKey,t.current,S,s.current))},u=f=>{if(!e()||t.current.gameOver)return;const p=f.key.toLowerCase();a.current.delete(p);const m=St(t.current);m&&FF(p,m,t.current,a)};return window.addEventListener("keydown",c),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",c),window.removeEventListener("keyup",u)}},[e,t,s,a,l]),null),zF=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:i,playerActionHintsRef:s,keysPressed:a,canvasRef:l,setAppState:c,appState:u})=>{const f=Fe.useRef(),{returnToIntro:p}=Xr(),[m,S,v]=tT(I=>{var B,O;if(!t.current||!f.current){f.current=I;return}const A=Math.min(I-f.current,1e3)/1e3,{performanceMetrics:_}=e.current;_.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const P=performance.now();e.current=Lu(e.current,A),_.currentBucket.worldUpdateTime=performance.now()-P;const R=St(e.current);R?s.current=Rg(e.current,R):s.current=[],i.current=LF(e.current,i.current,A);const w=performance.now();lu(t.current,e.current,i.current,s.current,{width:((B=l.current)==null?void 0:B.width)||800,height:((O=l.current)==null?void 0:O.height)||600},!1),_.currentBucket.renderTime=performance.now()-w,_.history.push({bucketTime:e.current.time,..._.currentBucket}),_.history.length>MC&&_.history.shift(),f.current=I,e.current.gameOver&&u!=="gameOver"&&(fg(Ce.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),c("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))});return Fe.useEffect(()=>(S(),m),[S,m]),Ue.jsx(YF,{isActive:v,gameStateRef:e,canvasRef:l,viewportCenterRef:i,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:p})},Ev=()=>{const{savedGameState:e,contextReady:t}=Xr(),[n,i]=Fe.useState(null);return Fe.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),i(e)):(console.log("Initializing new game state..."),i(NF())))},[t,e]),!t||!n?Ue.jsx("div",{children:"Loading..."}):Ue.jsx(jF,{initialState:n})},jF=({initialState:e})=>{const t=Fe.useRef(null),n=Fe.useRef(null),i=Fe.useRef(e),s=Fe.useRef(new Set),a=Fe.useRef(e.debugPanel),l=Fe.useRef(e.viewportCenter),c=Fe.useRef([]),{appState:u,setAppState:f}=Xr();return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(MF,{canvasRef:t,ctxRef:n,gameStateRef:i,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:c}),Ue.jsx(zF,{gameStateRef:i,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:c,keysPressed:s,canvasRef:t,setAppState:f,appState:u})]})},XF=Ot.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,VF=Ot.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Od=Ot.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,KF=Ot.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,qF=()=>{const{setAppState:e,gameOverDetails:t}=Xr(),n=()=>{e("intro")};return Ue.jsxs(XF,{children:[Ue.jsx(VF,{children:"Game Over"}),Ue.jsx(Od,{children:"Your tribe's lineage has ended."}),t&&Ue.jsxs(Ue.Fragment,{children:[Ue.jsxs(Od,{children:["Generations Survived: ",t.generations]}),Ue.jsxs(Od,{children:["Cause of Extinction: ",t.cause]})]}),!t&&Ue.jsx(Od,{children:"Game details are unavailable."}),Ue.jsx(KF,{onClick:n,children:"Return to Menu"})]})},ZF=Ot.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,QF=Ot.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,JF=Ot.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,eL=Ot.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,tL=Ot.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,mT=Ot.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,nL=Ot(mT)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,pl=800,gl=600,iL=()=>{const{returnToIntro:e}=Xr(),t=Fe.useRef(null),n=Fe.useRef(),i=Fe.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:pl,height:gl}}),s=l=>{const c={x:pl/2,y:gl/2};let u;l===Ee.StoneProjectile&&(u={x:c.x+200*(Math.random()-Math.random()),y:c.y+200*(Math.random()-Math.random())}),Ge(i.current,l,c,1,void 0,u)};Fe.useEffect(()=>{const l=()=>{i.current.time+=.016,oT(i.current);const u=t.current,f=u==null?void 0:u.getContext("2d");f&&(f.clearRect(0,0,pl,gl),f.fillStyle="#2c5234",f.fillRect(0,0,pl,gl),i.current.visualEffects.forEach(p=>{pT(f,p,i.current.time,i.current)})),n.current=requestAnimationFrame(l)};return n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(Ee).filter(l=>isNaN(Number(l))).map(l=>({name:l,value:Ee[l]}));return Ue.jsxs(ZF,{children:[Ue.jsxs(QF,{children:[Ue.jsx(tL,{children:"Visual Effects"}),a.map(l=>Ue.jsx(mT,{onClick:()=>s(l.value),children:l.name},l.name)),Ue.jsx(nL,{onClick:e,children:"Back to Intro"})]}),Ue.jsxs(JF,{children:[Ue.jsx(eL,{ref:t,width:pl,height:gl}),Ue.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},oL=ck`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function rL(e,t){Fe.useEffect(()=>{const n=()=>{const i=document.location.hash;t(i==="#game"?"game":i==="#effects"?"effects":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),Fe.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const sL=()=>{const{appState:e,setAppState:t}=Xr();rL(e,t);const n=()=>{switch(e){case"intro":return Ue.jsx(Iv,{});case"game":return Ue.jsx(Ev,{});case"effects":return Ue.jsx(iL,{});case"gameOver":return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(Ev,{}),Ue.jsx(qF,{})]});default:return Ue.jsx(Iv,{})}};return Ue.jsxs(Ue.Fragment,{children:[Ue.jsx(oL,{}),n()]})},Cv=document.getElementById("root");Cv?pR().then(()=>{CC.createRoot(Cv).render(Ue.jsx(Mi.StrictMode,{children:Ue.jsx(lO,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":"intro",children:Ue.jsx(sL,{})})}))}):console.error("Failed to find the root element");
