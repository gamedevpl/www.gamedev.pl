var iw=Object.defineProperty;var ow=(e,t,n)=>t in e?iw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Gt=(e,t,n)=>ow(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&o(c)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function Cv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Uf={exports:{}},Sa={},Gf={exports:{}},Ge={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var k0;function rw(){if(k0)return Ge;k0=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),c=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.iterator;function S(D){return D===null||typeof D!="object"?null:(D=m&&D[m]||D["@@iterator"],typeof D=="function"?D:null)}var v={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,T={};function w(D,z,he){this.props=D,this.context=z,this.refs=T,this.updater=he||v}w.prototype.isReactComponent={},w.prototype.setState=function(D,z){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,z,"setState")},w.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function E(){}E.prototype=w.prototype;function C(D,z,he){this.props=D,this.context=z,this.refs=T,this.updater=he||v}var _=C.prototype=new E;_.constructor=C,A(_,w.prototype),_.isPureReactComponent=!0;var M=Array.isArray,P=Object.prototype.hasOwnProperty,k={current:null},R={key:!0,ref:!0,__self:!0,__source:!0};function H(D,z,he){var me,de={},le=null,ge=null;if(z!=null)for(me in z.ref!==void 0&&(ge=z.ref),z.key!==void 0&&(le=""+z.key),z)P.call(z,me)&&!R.hasOwnProperty(me)&&(de[me]=z[me]);var x=arguments.length-2;if(x===1)de.children=he;else if(1<x){for(var ce=Array(x),pe=0;pe<x;pe++)ce[pe]=arguments[pe+2];de.children=ce}if(D&&D.defaultProps)for(me in x=D.defaultProps,x)de[me]===void 0&&(de[me]=x[me]);return{$$typeof:e,type:D,key:le,ref:ge,props:de,_owner:k.current}}function G(D,z){return{$$typeof:e,type:D.type,key:z,ref:D.ref,props:D.props,_owner:D._owner}}function F(D){return typeof D=="object"&&D!==null&&D.$$typeof===e}function Y(D){var z={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(he){return z[he]})}var Z=/\/+/g;function W(D,z){return typeof D=="object"&&D!==null&&D.key!=null?Y(""+D.key):z.toString(36)}function j(D,z,he,me,de){var le=typeof D;(le==="undefined"||le==="boolean")&&(D=null);var ge=!1;if(D===null)ge=!0;else switch(le){case"string":case"number":ge=!0;break;case"object":switch(D.$$typeof){case e:case t:ge=!0}}if(ge)return ge=D,de=de(ge),D=me===""?"."+W(ge,0):me,M(de)?(he="",D!=null&&(he=D.replace(Z,"$&/")+"/"),j(de,z,he,"",function(pe){return pe})):de!=null&&(F(de)&&(de=G(de,he+(!de.key||ge&&ge.key===de.key?"":(""+de.key).replace(Z,"$&/")+"/")+D)),z.push(de)),1;if(ge=0,me=me===""?".":me+":",M(D))for(var x=0;x<D.length;x++){le=D[x];var ce=me+W(le,x);ge+=j(le,z,he,ce,de)}else if(ce=S(D),typeof ce=="function")for(D=ce.call(D),x=0;!(le=D.next()).done;)le=le.value,ce=me+W(le,x++),ge+=j(le,z,he,ce,de);else if(le==="object")throw z=String(D),Error("Objects are not valid as a React child (found: "+(z==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":z)+"). If you meant to render a collection of children, use an array instead.");return ge}function ee(D,z,he){if(D==null)return D;var me=[],de=0;return j(D,me,"","",function(le){return z.call(he,le,de++)}),me}function se(D){if(D._status===-1){var z=D._result;z=z(),z.then(function(he){(D._status===0||D._status===-1)&&(D._status=1,D._result=he)},function(he){(D._status===0||D._status===-1)&&(D._status=2,D._result=he)}),D._status===-1&&(D._status=0,D._result=z)}if(D._status===1)return D._result.default;throw D._result}var ae={current:null},Q={transition:null},re={ReactCurrentDispatcher:ae,ReactCurrentBatchConfig:Q,ReactCurrentOwner:k};function ne(){throw Error("act(...) is not supported in production builds of React.")}return Ge.Children={map:ee,forEach:function(D,z,he){ee(D,function(){z.apply(this,arguments)},he)},count:function(D){var z=0;return ee(D,function(){z++}),z},toArray:function(D){return ee(D,function(z){return z})||[]},only:function(D){if(!F(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},Ge.Component=w,Ge.Fragment=n,Ge.Profiler=s,Ge.PureComponent=C,Ge.StrictMode=o,Ge.Suspense=u,Ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=re,Ge.act=ne,Ge.cloneElement=function(D,z,he){if(D==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+D+".");var me=A({},D.props),de=D.key,le=D.ref,ge=D._owner;if(z!=null){if(z.ref!==void 0&&(le=z.ref,ge=k.current),z.key!==void 0&&(de=""+z.key),D.type&&D.type.defaultProps)var x=D.type.defaultProps;for(ce in z)P.call(z,ce)&&!R.hasOwnProperty(ce)&&(me[ce]=z[ce]===void 0&&x!==void 0?x[ce]:z[ce])}var ce=arguments.length-2;if(ce===1)me.children=he;else if(1<ce){x=Array(ce);for(var pe=0;pe<ce;pe++)x[pe]=arguments[pe+2];me.children=x}return{$$typeof:e,type:D.type,key:de,ref:le,props:me,_owner:ge}},Ge.createContext=function(D){return D={$$typeof:c,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},D.Provider={$$typeof:a,_context:D},D.Consumer=D},Ge.createElement=H,Ge.createFactory=function(D){var z=H.bind(null,D);return z.type=D,z},Ge.createRef=function(){return{current:null}},Ge.forwardRef=function(D){return{$$typeof:d,render:D}},Ge.isValidElement=F,Ge.lazy=function(D){return{$$typeof:p,_payload:{_status:-1,_result:D},_init:se}},Ge.memo=function(D,z){return{$$typeof:h,type:D,compare:z===void 0?null:z}},Ge.startTransition=function(D){var z=Q.transition;Q.transition={};try{D()}finally{Q.transition=z}},Ge.unstable_act=ne,Ge.useCallback=function(D,z){return ae.current.useCallback(D,z)},Ge.useContext=function(D){return ae.current.useContext(D)},Ge.useDebugValue=function(){},Ge.useDeferredValue=function(D){return ae.current.useDeferredValue(D)},Ge.useEffect=function(D,z){return ae.current.useEffect(D,z)},Ge.useId=function(){return ae.current.useId()},Ge.useImperativeHandle=function(D,z,he){return ae.current.useImperativeHandle(D,z,he)},Ge.useInsertionEffect=function(D,z){return ae.current.useInsertionEffect(D,z)},Ge.useLayoutEffect=function(D,z){return ae.current.useLayoutEffect(D,z)},Ge.useMemo=function(D,z){return ae.current.useMemo(D,z)},Ge.useReducer=function(D,z,he){return ae.current.useReducer(D,z,he)},Ge.useRef=function(D){return ae.current.useRef(D)},Ge.useState=function(D){return ae.current.useState(D)},Ge.useSyncExternalStore=function(D,z,he){return ae.current.useSyncExternalStore(D,z,he)},Ge.useTransition=function(){return ae.current.useTransition()},Ge.version="18.3.1",Ge}var M0;function Xh(){return M0||(M0=1,Gf.exports=rw()),Gf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b0;function sw(){if(b0)return Sa;b0=1;var e=Xh(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function c(d,u,h){var p,m={},S=null,v=null;h!==void 0&&(S=""+h),u.key!==void 0&&(S=""+u.key),u.ref!==void 0&&(v=u.ref);for(p in u)o.call(u,p)&&!a.hasOwnProperty(p)&&(m[p]=u[p]);if(d&&d.defaultProps)for(p in u=d.defaultProps,u)m[p]===void 0&&(m[p]=u[p]);return{$$typeof:t,type:d,key:S,ref:v,props:m,_owner:s.current}}return Sa.Fragment=n,Sa.jsx=c,Sa.jsxs=c,Sa}var D0;function aw(){return D0||(D0=1,Uf.exports=sw()),Uf.exports}var X=aw(),te=Xh();const Ii=Cv(te);var Dc={},$f={exports:{}},Sn={},Wf={exports:{}},Yf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O0;function lw(){return O0||(O0=1,function(e){function t(Q,re){var ne=Q.length;Q.push(re);e:for(;0<ne;){var D=ne-1>>>1,z=Q[D];if(0<s(z,re))Q[D]=re,Q[ne]=z,ne=D;else break e}}function n(Q){return Q.length===0?null:Q[0]}function o(Q){if(Q.length===0)return null;var re=Q[0],ne=Q.pop();if(ne!==re){Q[0]=ne;e:for(var D=0,z=Q.length,he=z>>>1;D<he;){var me=2*(D+1)-1,de=Q[me],le=me+1,ge=Q[le];if(0>s(de,ne))le<z&&0>s(ge,de)?(Q[D]=ge,Q[le]=ne,D=le):(Q[D]=de,Q[me]=ne,D=me);else if(le<z&&0>s(ge,ne))Q[D]=ge,Q[le]=ne,D=le;else break e}}return re}function s(Q,re){var ne=Q.sortIndex-re.sortIndex;return ne!==0?ne:Q.id-re.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var c=Date,d=c.now();e.unstable_now=function(){return c.now()-d}}var u=[],h=[],p=1,m=null,S=3,v=!1,A=!1,T=!1,w=typeof setTimeout=="function"?setTimeout:null,E=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(Q){for(var re=n(h);re!==null;){if(re.callback===null)o(h);else if(re.startTime<=Q)o(h),re.sortIndex=re.expirationTime,t(u,re);else break;re=n(h)}}function M(Q){if(T=!1,_(Q),!A)if(n(u)!==null)A=!0,se(P);else{var re=n(h);re!==null&&ae(M,re.startTime-Q)}}function P(Q,re){A=!1,T&&(T=!1,E(H),H=-1),v=!0;var ne=S;try{for(_(re),m=n(u);m!==null&&(!(m.expirationTime>re)||Q&&!Y());){var D=m.callback;if(typeof D=="function"){m.callback=null,S=m.priorityLevel;var z=D(m.expirationTime<=re);re=e.unstable_now(),typeof z=="function"?m.callback=z:m===n(u)&&o(u),_(re)}else o(u);m=n(u)}if(m!==null)var he=!0;else{var me=n(h);me!==null&&ae(M,me.startTime-re),he=!1}return he}finally{m=null,S=ne,v=!1}}var k=!1,R=null,H=-1,G=5,F=-1;function Y(){return!(e.unstable_now()-F<G)}function Z(){if(R!==null){var Q=e.unstable_now();F=Q;var re=!0;try{re=R(!0,Q)}finally{re?W():(k=!1,R=null)}}else k=!1}var W;if(typeof C=="function")W=function(){C(Z)};else if(typeof MessageChannel<"u"){var j=new MessageChannel,ee=j.port2;j.port1.onmessage=Z,W=function(){ee.postMessage(null)}}else W=function(){w(Z,0)};function se(Q){R=Q,k||(k=!0,W())}function ae(Q,re){H=w(function(){Q(e.unstable_now())},re)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(Q){Q.callback=null},e.unstable_continueExecution=function(){A||v||(A=!0,se(P))},e.unstable_forceFrameRate=function(Q){0>Q||125<Q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<Q?Math.floor(1e3/Q):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return n(u)},e.unstable_next=function(Q){switch(S){case 1:case 2:case 3:var re=3;break;default:re=S}var ne=S;S=re;try{return Q()}finally{S=ne}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(Q,re){switch(Q){case 1:case 2:case 3:case 4:case 5:break;default:Q=3}var ne=S;S=Q;try{return re()}finally{S=ne}},e.unstable_scheduleCallback=function(Q,re,ne){var D=e.unstable_now();switch(typeof ne=="object"&&ne!==null?(ne=ne.delay,ne=typeof ne=="number"&&0<ne?D+ne:D):ne=D,Q){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=ne+z,Q={id:p++,callback:re,priorityLevel:Q,startTime:ne,expirationTime:z,sortIndex:-1},ne>D?(Q.sortIndex=ne,t(h,Q),n(u)===null&&Q===n(h)&&(T?(E(H),H=-1):T=!0,ae(M,ne-D))):(Q.sortIndex=z,t(u,Q),A||v||(A=!0,se(P))),Q},e.unstable_shouldYield=Y,e.unstable_wrapCallback=function(Q){var re=S;return function(){var ne=S;S=re;try{return Q.apply(this,arguments)}finally{S=ne}}}}(Yf)),Yf}var N0;function cw(){return N0||(N0=1,Wf.exports=lw()),Wf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B0;function uw(){if(B0)return Sn;B0=1;var e=Xh(),t=cw();function n(i){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+i,l=1;l<arguments.length;l++)r+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+i+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function a(i,r){c(i,r),c(i+"Capture",r)}function c(i,r){for(s[i]=r,i=0;i<r.length;i++)o.add(r[i])}var d=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function S(i){return u.call(m,i)?!0:u.call(p,i)?!1:h.test(i)?m[i]=!0:(p[i]=!0,!1)}function v(i,r,l,f){if(l!==null&&l.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return f?!1:l!==null?!l.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function A(i,r,l,f){if(r===null||typeof r>"u"||v(i,r,l,f))return!0;if(f)return!1;if(l!==null)switch(l.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function T(i,r,l,f,g,y,I){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=f,this.attributeNamespace=g,this.mustUseProperty=l,this.propertyName=i,this.type=r,this.sanitizeURL=y,this.removeEmptyString=I}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){w[i]=new T(i,0,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var r=i[0];w[r]=new T(r,1,!1,i[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){w[i]=new T(i,2,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){w[i]=new T(i,2,!1,i,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){w[i]=new T(i,3,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){w[i]=new T(i,3,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){w[i]=new T(i,4,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){w[i]=new T(i,6,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){w[i]=new T(i,5,!1,i.toLowerCase(),null,!1,!1)});var E=/[\-:]([a-z])/g;function C(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var r=i.replace(E,C);w[r]=new T(r,1,!1,i,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var r=i.replace(E,C);w[r]=new T(r,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var r=i.replace(E,C);w[r]=new T(r,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){w[i]=new T(i,1,!1,i.toLowerCase(),null,!1,!1)}),w.xlinkHref=new T("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){w[i]=new T(i,1,!1,i.toLowerCase(),null,!0,!0)});function _(i,r,l,f){var g=w.hasOwnProperty(r)?w[r]:null;(g!==null?g.type!==0:f||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(A(r,l,g,f)&&(l=null),f||g===null?S(r)&&(l===null?i.removeAttribute(r):i.setAttribute(r,""+l)):g.mustUseProperty?i[g.propertyName]=l===null?g.type===3?!1:"":l:(r=g.attributeName,f=g.attributeNamespace,l===null?i.removeAttribute(r):(g=g.type,l=g===3||g===4&&l===!0?"":""+l,f?i.setAttributeNS(f,r,l):i.setAttribute(r,l))))}var M=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,P=Symbol.for("react.element"),k=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),H=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),F=Symbol.for("react.provider"),Y=Symbol.for("react.context"),Z=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),j=Symbol.for("react.suspense_list"),ee=Symbol.for("react.memo"),se=Symbol.for("react.lazy"),ae=Symbol.for("react.offscreen"),Q=Symbol.iterator;function re(i){return i===null||typeof i!="object"?null:(i=Q&&i[Q]||i["@@iterator"],typeof i=="function"?i:null)}var ne=Object.assign,D;function z(i){if(D===void 0)try{throw Error()}catch(l){var r=l.stack.trim().match(/\n( *(at )?)/);D=r&&r[1]||""}return`
`+D+i}var he=!1;function me(i,r){if(!i||he)return"";he=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch($){var f=$}Reflect.construct(i,[],r)}else{try{r.call()}catch($){f=$}i.call(r.prototype)}else{try{throw Error()}catch($){f=$}i()}}catch($){if($&&f&&typeof $.stack=="string"){for(var g=$.stack.split(`
`),y=f.stack.split(`
`),I=g.length-1,b=y.length-1;1<=I&&0<=b&&g[I]!==y[b];)b--;for(;1<=I&&0<=b;I--,b--)if(g[I]!==y[b]){if(I!==1||b!==1)do if(I--,b--,0>b||g[I]!==y[b]){var O=`
`+g[I].replace(" at new "," at ");return i.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",i.displayName)),O}while(1<=I&&0<=b);break}}}finally{he=!1,Error.prepareStackTrace=l}return(i=i?i.displayName||i.name:"")?z(i):""}function de(i){switch(i.tag){case 5:return z(i.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return i=me(i.type,!1),i;case 11:return i=me(i.type.render,!1),i;case 1:return i=me(i.type,!0),i;default:return""}}function le(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case R:return"Fragment";case k:return"Portal";case G:return"Profiler";case H:return"StrictMode";case W:return"Suspense";case j:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Y:return(i.displayName||"Context")+".Consumer";case F:return(i._context.displayName||"Context")+".Provider";case Z:var r=i.render;return i=i.displayName,i||(i=r.displayName||r.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case ee:return r=i.displayName||null,r!==null?r:le(i.type)||"Memo";case se:r=i._payload,i=i._init;try{return le(i(r))}catch{}}return null}function ge(i){var r=i.type;switch(i.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=r.render,i=i.displayName||i.name||"",r.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return le(r);case 8:return r===H?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function x(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function ce(i){var r=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function pe(i){var r=ce(i)?"checked":"value",l=Object.getOwnPropertyDescriptor(i.constructor.prototype,r),f=""+i[r];if(!i.hasOwnProperty(r)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var g=l.get,y=l.set;return Object.defineProperty(i,r,{configurable:!0,get:function(){return g.call(this)},set:function(I){f=""+I,y.call(this,I)}}),Object.defineProperty(i,r,{enumerable:l.enumerable}),{getValue:function(){return f},setValue:function(I){f=""+I},stopTracking:function(){i._valueTracker=null,delete i[r]}}}}function we(i){i._valueTracker||(i._valueTracker=pe(i))}function K(i){if(!i)return!1;var r=i._valueTracker;if(!r)return!0;var l=r.getValue(),f="";return i&&(f=ce(i)?i.checked?"true":"false":i.value),i=f,i!==l?(r.setValue(i),!0):!1}function $e(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function xe(i,r){var l=r.checked;return ne({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??i._wrapperState.initialChecked})}function He(i,r){var l=r.defaultValue==null?"":r.defaultValue,f=r.checked!=null?r.checked:r.defaultChecked;l=x(r.value!=null?r.value:l),i._wrapperState={initialChecked:f,initialValue:l,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function ct(i,r){r=r.checked,r!=null&&_(i,"checked",r,!1)}function Ct(i,r){ct(i,r);var l=x(r.value),f=r.type;if(l!=null)f==="number"?(l===0&&i.value===""||i.value!=l)&&(i.value=""+l):i.value!==""+l&&(i.value=""+l);else if(f==="submit"||f==="reset"){i.removeAttribute("value");return}r.hasOwnProperty("value")?it(i,r.type,l):r.hasOwnProperty("defaultValue")&&it(i,r.type,x(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(i.defaultChecked=!!r.defaultChecked)}function At(i,r,l){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var f=r.type;if(!(f!=="submit"&&f!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+i._wrapperState.initialValue,l||r===i.value||(i.value=r),i.defaultValue=r}l=i.name,l!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,l!==""&&(i.name=l)}function it(i,r,l){(r!=="number"||$e(i.ownerDocument)!==i)&&(l==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+l&&(i.defaultValue=""+l))}var Xt=Array.isArray;function wn(i,r,l,f){if(i=i.options,r){r={};for(var g=0;g<l.length;g++)r["$"+l[g]]=!0;for(l=0;l<i.length;l++)g=r.hasOwnProperty("$"+i[l].value),i[l].selected!==g&&(i[l].selected=g),g&&f&&(i[l].defaultSelected=!0)}else{for(l=""+x(l),r=null,g=0;g<i.length;g++){if(i[g].value===l){i[g].selected=!0,f&&(i[g].defaultSelected=!0);return}r!==null||i[g].disabled||(r=i[g])}r!==null&&(r.selected=!0)}}function eo(i,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return ne({},r,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Ds(i,r){var l=r.value;if(l==null){if(l=r.children,r=r.defaultValue,l!=null){if(r!=null)throw Error(n(92));if(Xt(l)){if(1<l.length)throw Error(n(93));l=l[0]}r=l}r==null&&(r=""),l=r}i._wrapperState={initialValue:x(l)}}function Os(i,r){var l=x(r.value),f=x(r.defaultValue);l!=null&&(l=""+l,l!==i.value&&(i.value=l),r.defaultValue==null&&i.defaultValue!==l&&(i.defaultValue=l)),f!=null&&(i.defaultValue=""+f)}function Ns(i){var r=i.textContent;r===i._wrapperState.initialValue&&r!==""&&r!==null&&(i.value=r)}function Uo(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zu(i,r){return i==null||i==="http://www.w3.org/1999/xhtml"?Uo(r):i==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var El,Wp=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,l,f,g){MSApp.execUnsafeLocalFunction(function(){return i(r,l,f,g)})}:i}(function(i,r){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=r;else{for(El=El||document.createElement("div"),El.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=El.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;r.firstChild;)i.appendChild(r.firstChild)}});function Bs(i,r){if(r){var l=i.firstChild;if(l&&l===i.lastChild&&l.nodeType===3){l.nodeValue=r;return}}i.textContent=r}var Hs={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},aI=["Webkit","ms","Moz","O"];Object.keys(Hs).forEach(function(i){aI.forEach(function(r){r=r+i.charAt(0).toUpperCase()+i.substring(1),Hs[r]=Hs[i]})});function Yp(i,r,l){return r==null||typeof r=="boolean"||r===""?"":l||typeof r!="number"||r===0||Hs.hasOwnProperty(i)&&Hs[i]?(""+r).trim():r+"px"}function zp(i,r){i=i.style;for(var l in r)if(r.hasOwnProperty(l)){var f=l.indexOf("--")===0,g=Yp(l,r[l],f);l==="float"&&(l="cssFloat"),f?i.setProperty(l,g):i[l]=g}}var lI=ne({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ku(i,r){if(r){if(lI[i]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,i));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function Qu(i,r){if(i.indexOf("-")===-1)return typeof r.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ju=null;function ed(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var td=null,Rr=null,kr=null;function jp(i){if(i=oa(i)){if(typeof td!="function")throw Error(n(280));var r=i.stateNode;r&&(r=Xl(r),td(i.stateNode,i.type,r))}}function Xp(i){Rr?kr?kr.push(i):kr=[i]:Rr=i}function Vp(){if(Rr){var i=Rr,r=kr;if(kr=Rr=null,jp(i),r)for(i=0;i<r.length;i++)jp(r[i])}}function qp(i,r){return i(r)}function Zp(){}var nd=!1;function Kp(i,r,l){if(nd)return i(r,l);nd=!0;try{return qp(i,r,l)}finally{nd=!1,(Rr!==null||kr!==null)&&(Zp(),Vp())}}function Fs(i,r){var l=i.stateNode;if(l===null)return null;var f=Xl(l);if(f===null)return null;l=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(l&&typeof l!="function")throw Error(n(231,r,typeof l));return l}var id=!1;if(d)try{var Ls={};Object.defineProperty(Ls,"passive",{get:function(){id=!0}}),window.addEventListener("test",Ls,Ls),window.removeEventListener("test",Ls,Ls)}catch{id=!1}function cI(i,r,l,f,g,y,I,b,O){var $=Array.prototype.slice.call(arguments,3);try{r.apply(l,$)}catch(oe){this.onError(oe)}}var xs=!1,Cl=null,Pl=!1,od=null,uI={onError:function(i){xs=!0,Cl=i}};function dI(i,r,l,f,g,y,I,b,O){xs=!1,Cl=null,cI.apply(uI,arguments)}function fI(i,r,l,f,g,y,I,b,O){if(dI.apply(this,arguments),xs){if(xs){var $=Cl;xs=!1,Cl=null}else throw Error(n(198));Pl||(Pl=!0,od=$)}}function Go(i){var r=i,l=i;if(i.alternate)for(;r.return;)r=r.return;else{i=r;do r=i,(r.flags&4098)!==0&&(l=r.return),i=r.return;while(i)}return r.tag===3?l:null}function Qp(i){if(i.tag===13){var r=i.memoizedState;if(r===null&&(i=i.alternate,i!==null&&(r=i.memoizedState)),r!==null)return r.dehydrated}return null}function Jp(i){if(Go(i)!==i)throw Error(n(188))}function hI(i){var r=i.alternate;if(!r){if(r=Go(i),r===null)throw Error(n(188));return r!==i?null:i}for(var l=i,f=r;;){var g=l.return;if(g===null)break;var y=g.alternate;if(y===null){if(f=g.return,f!==null){l=f;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===l)return Jp(g),i;if(y===f)return Jp(g),r;y=y.sibling}throw Error(n(188))}if(l.return!==f.return)l=g,f=y;else{for(var I=!1,b=g.child;b;){if(b===l){I=!0,l=g,f=y;break}if(b===f){I=!0,f=g,l=y;break}b=b.sibling}if(!I){for(b=y.child;b;){if(b===l){I=!0,l=y,f=g;break}if(b===f){I=!0,f=y,l=g;break}b=b.sibling}if(!I)throw Error(n(189))}}if(l.alternate!==f)throw Error(n(190))}if(l.tag!==3)throw Error(n(188));return l.stateNode.current===l?i:r}function eg(i){return i=hI(i),i!==null?tg(i):null}function tg(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var r=tg(i);if(r!==null)return r;i=i.sibling}return null}var ng=t.unstable_scheduleCallback,ig=t.unstable_cancelCallback,pI=t.unstable_shouldYield,gI=t.unstable_requestPaint,vt=t.unstable_now,mI=t.unstable_getCurrentPriorityLevel,rd=t.unstable_ImmediatePriority,og=t.unstable_UserBlockingPriority,_l=t.unstable_NormalPriority,yI=t.unstable_LowPriority,rg=t.unstable_IdlePriority,Rl=null,di=null;function vI(i){if(di&&typeof di.onCommitFiberRoot=="function")try{di.onCommitFiberRoot(Rl,i,void 0,(i.current.flags&128)===128)}catch{}}var qn=Math.clz32?Math.clz32:II,SI=Math.log,TI=Math.LN2;function II(i){return i>>>=0,i===0?32:31-(SI(i)/TI|0)|0}var kl=64,Ml=4194304;function Us(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function bl(i,r){var l=i.pendingLanes;if(l===0)return 0;var f=0,g=i.suspendedLanes,y=i.pingedLanes,I=l&268435455;if(I!==0){var b=I&~g;b!==0?f=Us(b):(y&=I,y!==0&&(f=Us(y)))}else I=l&~g,I!==0?f=Us(I):y!==0&&(f=Us(y));if(f===0)return 0;if(r!==0&&r!==f&&(r&g)===0&&(g=f&-f,y=r&-r,g>=y||g===16&&(y&4194240)!==0))return r;if((f&4)!==0&&(f|=l&16),r=i.entangledLanes,r!==0)for(i=i.entanglements,r&=f;0<r;)l=31-qn(r),g=1<<l,f|=i[l],r&=~g;return f}function AI(i,r){switch(i){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wI(i,r){for(var l=i.suspendedLanes,f=i.pingedLanes,g=i.expirationTimes,y=i.pendingLanes;0<y;){var I=31-qn(y),b=1<<I,O=g[I];O===-1?((b&l)===0||(b&f)!==0)&&(g[I]=AI(b,r)):O<=r&&(i.expiredLanes|=b),y&=~b}}function sd(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function sg(){var i=kl;return kl<<=1,(kl&4194240)===0&&(kl=64),i}function ad(i){for(var r=[],l=0;31>l;l++)r.push(i);return r}function Gs(i,r,l){i.pendingLanes|=r,r!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,r=31-qn(r),i[r]=l}function EI(i,r){var l=i.pendingLanes&~r;i.pendingLanes=r,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=r,i.mutableReadLanes&=r,i.entangledLanes&=r,r=i.entanglements;var f=i.eventTimes;for(i=i.expirationTimes;0<l;){var g=31-qn(l),y=1<<g;r[g]=0,f[g]=-1,i[g]=-1,l&=~y}}function ld(i,r){var l=i.entangledLanes|=r;for(i=i.entanglements;l;){var f=31-qn(l),g=1<<f;g&r|i[f]&r&&(i[f]|=r),l&=~g}}var Ze=0;function ag(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var lg,cd,cg,ug,dg,ud=!1,Dl=[],to=null,no=null,io=null,$s=new Map,Ws=new Map,oo=[],CI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function fg(i,r){switch(i){case"focusin":case"focusout":to=null;break;case"dragenter":case"dragleave":no=null;break;case"mouseover":case"mouseout":io=null;break;case"pointerover":case"pointerout":$s.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ws.delete(r.pointerId)}}function Ys(i,r,l,f,g,y){return i===null||i.nativeEvent!==y?(i={blockedOn:r,domEventName:l,eventSystemFlags:f,nativeEvent:y,targetContainers:[g]},r!==null&&(r=oa(r),r!==null&&cd(r)),i):(i.eventSystemFlags|=f,r=i.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),i)}function PI(i,r,l,f,g){switch(r){case"focusin":return to=Ys(to,i,r,l,f,g),!0;case"dragenter":return no=Ys(no,i,r,l,f,g),!0;case"mouseover":return io=Ys(io,i,r,l,f,g),!0;case"pointerover":var y=g.pointerId;return $s.set(y,Ys($s.get(y)||null,i,r,l,f,g)),!0;case"gotpointercapture":return y=g.pointerId,Ws.set(y,Ys(Ws.get(y)||null,i,r,l,f,g)),!0}return!1}function hg(i){var r=$o(i.target);if(r!==null){var l=Go(r);if(l!==null){if(r=l.tag,r===13){if(r=Qp(l),r!==null){i.blockedOn=r,dg(i.priority,function(){cg(l)});return}}else if(r===3&&l.stateNode.current.memoizedState.isDehydrated){i.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Ol(i){if(i.blockedOn!==null)return!1;for(var r=i.targetContainers;0<r.length;){var l=fd(i.domEventName,i.eventSystemFlags,r[0],i.nativeEvent);if(l===null){l=i.nativeEvent;var f=new l.constructor(l.type,l);Ju=f,l.target.dispatchEvent(f),Ju=null}else return r=oa(l),r!==null&&cd(r),i.blockedOn=l,!1;r.shift()}return!0}function pg(i,r,l){Ol(i)&&l.delete(r)}function _I(){ud=!1,to!==null&&Ol(to)&&(to=null),no!==null&&Ol(no)&&(no=null),io!==null&&Ol(io)&&(io=null),$s.forEach(pg),Ws.forEach(pg)}function zs(i,r){i.blockedOn===r&&(i.blockedOn=null,ud||(ud=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,_I)))}function js(i){function r(g){return zs(g,i)}if(0<Dl.length){zs(Dl[0],i);for(var l=1;l<Dl.length;l++){var f=Dl[l];f.blockedOn===i&&(f.blockedOn=null)}}for(to!==null&&zs(to,i),no!==null&&zs(no,i),io!==null&&zs(io,i),$s.forEach(r),Ws.forEach(r),l=0;l<oo.length;l++)f=oo[l],f.blockedOn===i&&(f.blockedOn=null);for(;0<oo.length&&(l=oo[0],l.blockedOn===null);)hg(l),l.blockedOn===null&&oo.shift()}var Mr=M.ReactCurrentBatchConfig,Nl=!0;function RI(i,r,l,f){var g=Ze,y=Mr.transition;Mr.transition=null;try{Ze=1,dd(i,r,l,f)}finally{Ze=g,Mr.transition=y}}function kI(i,r,l,f){var g=Ze,y=Mr.transition;Mr.transition=null;try{Ze=4,dd(i,r,l,f)}finally{Ze=g,Mr.transition=y}}function dd(i,r,l,f){if(Nl){var g=fd(i,r,l,f);if(g===null)kd(i,r,f,Bl,l),fg(i,f);else if(PI(g,i,r,l,f))f.stopPropagation();else if(fg(i,f),r&4&&-1<CI.indexOf(i)){for(;g!==null;){var y=oa(g);if(y!==null&&lg(y),y=fd(i,r,l,f),y===null&&kd(i,r,f,Bl,l),y===g)break;g=y}g!==null&&f.stopPropagation()}else kd(i,r,f,null,l)}}var Bl=null;function fd(i,r,l,f){if(Bl=null,i=ed(f),i=$o(i),i!==null)if(r=Go(i),r===null)i=null;else if(l=r.tag,l===13){if(i=Qp(r),i!==null)return i;i=null}else if(l===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;i=null}else r!==i&&(i=null);return Bl=i,null}function gg(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(mI()){case rd:return 1;case og:return 4;case _l:case yI:return 16;case rg:return 536870912;default:return 16}default:return 16}}var ro=null,hd=null,Hl=null;function mg(){if(Hl)return Hl;var i,r=hd,l=r.length,f,g="value"in ro?ro.value:ro.textContent,y=g.length;for(i=0;i<l&&r[i]===g[i];i++);var I=l-i;for(f=1;f<=I&&r[l-f]===g[y-f];f++);return Hl=g.slice(i,1<f?1-f:void 0)}function Fl(i){var r=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&r===13&&(i=13)):i=r,i===10&&(i=13),32<=i||i===13?i:0}function Ll(){return!0}function yg(){return!1}function En(i){function r(l,f,g,y,I){this._reactName=l,this._targetInst=g,this.type=f,this.nativeEvent=y,this.target=I,this.currentTarget=null;for(var b in i)i.hasOwnProperty(b)&&(l=i[b],this[b]=l?l(y):y[b]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Ll:yg,this.isPropagationStopped=yg,this}return ne(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Ll)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Ll)},persist:function(){},isPersistent:Ll}),r}var br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pd=En(br),Xs=ne({},br,{view:0,detail:0}),MI=En(Xs),gd,md,Vs,xl=ne({},Xs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:vd,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Vs&&(Vs&&i.type==="mousemove"?(gd=i.screenX-Vs.screenX,md=i.screenY-Vs.screenY):md=gd=0,Vs=i),gd)},movementY:function(i){return"movementY"in i?i.movementY:md}}),vg=En(xl),bI=ne({},xl,{dataTransfer:0}),DI=En(bI),OI=ne({},Xs,{relatedTarget:0}),yd=En(OI),NI=ne({},br,{animationName:0,elapsedTime:0,pseudoElement:0}),BI=En(NI),HI=ne({},br,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),FI=En(HI),LI=ne({},br,{data:0}),Sg=En(LI),xI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},UI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},GI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function $I(i){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(i):(i=GI[i])?!!r[i]:!1}function vd(){return $I}var WI=ne({},Xs,{key:function(i){if(i.key){var r=xI[i.key]||i.key;if(r!=="Unidentified")return r}return i.type==="keypress"?(i=Fl(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?UI[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:vd,charCode:function(i){return i.type==="keypress"?Fl(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Fl(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),YI=En(WI),zI=ne({},xl,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Tg=En(zI),jI=ne({},Xs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:vd}),XI=En(jI),VI=ne({},br,{propertyName:0,elapsedTime:0,pseudoElement:0}),qI=En(VI),ZI=ne({},xl,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),KI=En(ZI),QI=[9,13,27,32],Sd=d&&"CompositionEvent"in window,qs=null;d&&"documentMode"in document&&(qs=document.documentMode);var JI=d&&"TextEvent"in window&&!qs,Ig=d&&(!Sd||qs&&8<qs&&11>=qs),Ag=" ",wg=!1;function Eg(i,r){switch(i){case"keyup":return QI.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Cg(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Dr=!1;function eA(i,r){switch(i){case"compositionend":return Cg(r);case"keypress":return r.which!==32?null:(wg=!0,Ag);case"textInput":return i=r.data,i===Ag&&wg?null:i;default:return null}}function tA(i,r){if(Dr)return i==="compositionend"||!Sd&&Eg(i,r)?(i=mg(),Hl=hd=ro=null,Dr=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return Ig&&r.locale!=="ko"?null:r.data;default:return null}}var nA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Pg(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r==="input"?!!nA[i.type]:r==="textarea"}function _g(i,r,l,f){Xp(f),r=Yl(r,"onChange"),0<r.length&&(l=new pd("onChange","change",null,l,f),i.push({event:l,listeners:r}))}var Zs=null,Ks=null;function iA(i){zg(i,0)}function Ul(i){var r=Fr(i);if(K(r))return i}function oA(i,r){if(i==="change")return r}var Rg=!1;if(d){var Td;if(d){var Id="oninput"in document;if(!Id){var kg=document.createElement("div");kg.setAttribute("oninput","return;"),Id=typeof kg.oninput=="function"}Td=Id}else Td=!1;Rg=Td&&(!document.documentMode||9<document.documentMode)}function Mg(){Zs&&(Zs.detachEvent("onpropertychange",bg),Ks=Zs=null)}function bg(i){if(i.propertyName==="value"&&Ul(Ks)){var r=[];_g(r,Ks,i,ed(i)),Kp(iA,r)}}function rA(i,r,l){i==="focusin"?(Mg(),Zs=r,Ks=l,Zs.attachEvent("onpropertychange",bg)):i==="focusout"&&Mg()}function sA(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Ul(Ks)}function aA(i,r){if(i==="click")return Ul(r)}function lA(i,r){if(i==="input"||i==="change")return Ul(r)}function cA(i,r){return i===r&&(i!==0||1/i===1/r)||i!==i&&r!==r}var Zn=typeof Object.is=="function"?Object.is:cA;function Qs(i,r){if(Zn(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;var l=Object.keys(i),f=Object.keys(r);if(l.length!==f.length)return!1;for(f=0;f<l.length;f++){var g=l[f];if(!u.call(r,g)||!Zn(i[g],r[g]))return!1}return!0}function Dg(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Og(i,r){var l=Dg(i);i=0;for(var f;l;){if(l.nodeType===3){if(f=i+l.textContent.length,i<=r&&f>=r)return{node:l,offset:r-i};i=f}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=Dg(l)}}function Ng(i,r){return i&&r?i===r?!0:i&&i.nodeType===3?!1:r&&r.nodeType===3?Ng(i,r.parentNode):"contains"in i?i.contains(r):i.compareDocumentPosition?!!(i.compareDocumentPosition(r)&16):!1:!1}function Bg(){for(var i=window,r=$e();r instanceof i.HTMLIFrameElement;){try{var l=typeof r.contentWindow.location.href=="string"}catch{l=!1}if(l)i=r.contentWindow;else break;r=$e(i.document)}return r}function Ad(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r&&(r==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||r==="textarea"||i.contentEditable==="true")}function uA(i){var r=Bg(),l=i.focusedElem,f=i.selectionRange;if(r!==l&&l&&l.ownerDocument&&Ng(l.ownerDocument.documentElement,l)){if(f!==null&&Ad(l)){if(r=f.start,i=f.end,i===void 0&&(i=r),"selectionStart"in l)l.selectionStart=r,l.selectionEnd=Math.min(i,l.value.length);else if(i=(r=l.ownerDocument||document)&&r.defaultView||window,i.getSelection){i=i.getSelection();var g=l.textContent.length,y=Math.min(f.start,g);f=f.end===void 0?y:Math.min(f.end,g),!i.extend&&y>f&&(g=f,f=y,y=g),g=Og(l,y);var I=Og(l,f);g&&I&&(i.rangeCount!==1||i.anchorNode!==g.node||i.anchorOffset!==g.offset||i.focusNode!==I.node||i.focusOffset!==I.offset)&&(r=r.createRange(),r.setStart(g.node,g.offset),i.removeAllRanges(),y>f?(i.addRange(r),i.extend(I.node,I.offset)):(r.setEnd(I.node,I.offset),i.addRange(r)))}}for(r=[],i=l;i=i.parentNode;)i.nodeType===1&&r.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<r.length;l++)i=r[l],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var dA=d&&"documentMode"in document&&11>=document.documentMode,Or=null,wd=null,Js=null,Ed=!1;function Hg(i,r,l){var f=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Ed||Or==null||Or!==$e(f)||(f=Or,"selectionStart"in f&&Ad(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),Js&&Qs(Js,f)||(Js=f,f=Yl(wd,"onSelect"),0<f.length&&(r=new pd("onSelect","select",null,r,l),i.push({event:r,listeners:f}),r.target=Or)))}function Gl(i,r){var l={};return l[i.toLowerCase()]=r.toLowerCase(),l["Webkit"+i]="webkit"+r,l["Moz"+i]="moz"+r,l}var Nr={animationend:Gl("Animation","AnimationEnd"),animationiteration:Gl("Animation","AnimationIteration"),animationstart:Gl("Animation","AnimationStart"),transitionend:Gl("Transition","TransitionEnd")},Cd={},Fg={};d&&(Fg=document.createElement("div").style,"AnimationEvent"in window||(delete Nr.animationend.animation,delete Nr.animationiteration.animation,delete Nr.animationstart.animation),"TransitionEvent"in window||delete Nr.transitionend.transition);function $l(i){if(Cd[i])return Cd[i];if(!Nr[i])return i;var r=Nr[i],l;for(l in r)if(r.hasOwnProperty(l)&&l in Fg)return Cd[i]=r[l];return i}var Lg=$l("animationend"),xg=$l("animationiteration"),Ug=$l("animationstart"),Gg=$l("transitionend"),$g=new Map,Wg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function so(i,r){$g.set(i,r),a(r,[i])}for(var Pd=0;Pd<Wg.length;Pd++){var _d=Wg[Pd],fA=_d.toLowerCase(),hA=_d[0].toUpperCase()+_d.slice(1);so(fA,"on"+hA)}so(Lg,"onAnimationEnd"),so(xg,"onAnimationIteration"),so(Ug,"onAnimationStart"),so("dblclick","onDoubleClick"),so("focusin","onFocus"),so("focusout","onBlur"),so(Gg,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ea="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),pA=new Set("cancel close invalid load scroll toggle".split(" ").concat(ea));function Yg(i,r,l){var f=i.type||"unknown-event";i.currentTarget=l,fI(f,r,void 0,i),i.currentTarget=null}function zg(i,r){r=(r&4)!==0;for(var l=0;l<i.length;l++){var f=i[l],g=f.event;f=f.listeners;e:{var y=void 0;if(r)for(var I=f.length-1;0<=I;I--){var b=f[I],O=b.instance,$=b.currentTarget;if(b=b.listener,O!==y&&g.isPropagationStopped())break e;Yg(g,b,$),y=O}else for(I=0;I<f.length;I++){if(b=f[I],O=b.instance,$=b.currentTarget,b=b.listener,O!==y&&g.isPropagationStopped())break e;Yg(g,b,$),y=O}}}if(Pl)throw i=od,Pl=!1,od=null,i}function ot(i,r){var l=r[Bd];l===void 0&&(l=r[Bd]=new Set);var f=i+"__bubble";l.has(f)||(jg(r,i,2,!1),l.add(f))}function Rd(i,r,l){var f=0;r&&(f|=4),jg(l,i,f,r)}var Wl="_reactListening"+Math.random().toString(36).slice(2);function ta(i){if(!i[Wl]){i[Wl]=!0,o.forEach(function(l){l!=="selectionchange"&&(pA.has(l)||Rd(l,!1,i),Rd(l,!0,i))});var r=i.nodeType===9?i:i.ownerDocument;r===null||r[Wl]||(r[Wl]=!0,Rd("selectionchange",!1,r))}}function jg(i,r,l,f){switch(gg(r)){case 1:var g=RI;break;case 4:g=kI;break;default:g=dd}l=g.bind(null,r,l,i),g=void 0,!id||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),f?g!==void 0?i.addEventListener(r,l,{capture:!0,passive:g}):i.addEventListener(r,l,!0):g!==void 0?i.addEventListener(r,l,{passive:g}):i.addEventListener(r,l,!1)}function kd(i,r,l,f,g){var y=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var I=f.tag;if(I===3||I===4){var b=f.stateNode.containerInfo;if(b===g||b.nodeType===8&&b.parentNode===g)break;if(I===4)for(I=f.return;I!==null;){var O=I.tag;if((O===3||O===4)&&(O=I.stateNode.containerInfo,O===g||O.nodeType===8&&O.parentNode===g))return;I=I.return}for(;b!==null;){if(I=$o(b),I===null)return;if(O=I.tag,O===5||O===6){f=y=I;continue e}b=b.parentNode}}f=f.return}Kp(function(){var $=y,oe=ed(l),ue=[];e:{var ie=$g.get(i);if(ie!==void 0){var ye=pd,Ee=i;switch(i){case"keypress":if(Fl(l)===0)break e;case"keydown":case"keyup":ye=YI;break;case"focusin":Ee="focus",ye=yd;break;case"focusout":Ee="blur",ye=yd;break;case"beforeblur":case"afterblur":ye=yd;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ye=vg;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ye=DI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ye=XI;break;case Lg:case xg:case Ug:ye=BI;break;case Gg:ye=qI;break;case"scroll":ye=MI;break;case"wheel":ye=KI;break;case"copy":case"cut":case"paste":ye=FI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ye=Tg}var Ce=(r&4)!==0,St=!Ce&&i==="scroll",L=Ce?ie!==null?ie+"Capture":null:ie;Ce=[];for(var B=$,U;B!==null;){U=B;var fe=U.stateNode;if(U.tag===5&&fe!==null&&(U=fe,L!==null&&(fe=Fs(B,L),fe!=null&&Ce.push(na(B,fe,U)))),St)break;B=B.return}0<Ce.length&&(ie=new ye(ie,Ee,null,l,oe),ue.push({event:ie,listeners:Ce}))}}if((r&7)===0){e:{if(ie=i==="mouseover"||i==="pointerover",ye=i==="mouseout"||i==="pointerout",ie&&l!==Ju&&(Ee=l.relatedTarget||l.fromElement)&&($o(Ee)||Ee[Pi]))break e;if((ye||ie)&&(ie=oe.window===oe?oe:(ie=oe.ownerDocument)?ie.defaultView||ie.parentWindow:window,ye?(Ee=l.relatedTarget||l.toElement,ye=$,Ee=Ee?$o(Ee):null,Ee!==null&&(St=Go(Ee),Ee!==St||Ee.tag!==5&&Ee.tag!==6)&&(Ee=null)):(ye=null,Ee=$),ye!==Ee)){if(Ce=vg,fe="onMouseLeave",L="onMouseEnter",B="mouse",(i==="pointerout"||i==="pointerover")&&(Ce=Tg,fe="onPointerLeave",L="onPointerEnter",B="pointer"),St=ye==null?ie:Fr(ye),U=Ee==null?ie:Fr(Ee),ie=new Ce(fe,B+"leave",ye,l,oe),ie.target=St,ie.relatedTarget=U,fe=null,$o(oe)===$&&(Ce=new Ce(L,B+"enter",Ee,l,oe),Ce.target=U,Ce.relatedTarget=St,fe=Ce),St=fe,ye&&Ee)t:{for(Ce=ye,L=Ee,B=0,U=Ce;U;U=Br(U))B++;for(U=0,fe=L;fe;fe=Br(fe))U++;for(;0<B-U;)Ce=Br(Ce),B--;for(;0<U-B;)L=Br(L),U--;for(;B--;){if(Ce===L||L!==null&&Ce===L.alternate)break t;Ce=Br(Ce),L=Br(L)}Ce=null}else Ce=null;ye!==null&&Xg(ue,ie,ye,Ce,!1),Ee!==null&&St!==null&&Xg(ue,St,Ee,Ce,!0)}}e:{if(ie=$?Fr($):window,ye=ie.nodeName&&ie.nodeName.toLowerCase(),ye==="select"||ye==="input"&&ie.type==="file")var Re=oA;else if(Pg(ie))if(Rg)Re=lA;else{Re=sA;var Me=rA}else(ye=ie.nodeName)&&ye.toLowerCase()==="input"&&(ie.type==="checkbox"||ie.type==="radio")&&(Re=aA);if(Re&&(Re=Re(i,$))){_g(ue,Re,l,oe);break e}Me&&Me(i,ie,$),i==="focusout"&&(Me=ie._wrapperState)&&Me.controlled&&ie.type==="number"&&it(ie,"number",ie.value)}switch(Me=$?Fr($):window,i){case"focusin":(Pg(Me)||Me.contentEditable==="true")&&(Or=Me,wd=$,Js=null);break;case"focusout":Js=wd=Or=null;break;case"mousedown":Ed=!0;break;case"contextmenu":case"mouseup":case"dragend":Ed=!1,Hg(ue,l,oe);break;case"selectionchange":if(dA)break;case"keydown":case"keyup":Hg(ue,l,oe)}var be;if(Sd)e:{switch(i){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else Dr?Eg(i,l)&&(Be="onCompositionEnd"):i==="keydown"&&l.keyCode===229&&(Be="onCompositionStart");Be&&(Ig&&l.locale!=="ko"&&(Dr||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&Dr&&(be=mg()):(ro=oe,hd="value"in ro?ro.value:ro.textContent,Dr=!0)),Me=Yl($,Be),0<Me.length&&(Be=new Sg(Be,i,null,l,oe),ue.push({event:Be,listeners:Me}),be?Be.data=be:(be=Cg(l),be!==null&&(Be.data=be)))),(be=JI?eA(i,l):tA(i,l))&&($=Yl($,"onBeforeInput"),0<$.length&&(oe=new Sg("onBeforeInput","beforeinput",null,l,oe),ue.push({event:oe,listeners:$}),oe.data=be))}zg(ue,r)})}function na(i,r,l){return{instance:i,listener:r,currentTarget:l}}function Yl(i,r){for(var l=r+"Capture",f=[];i!==null;){var g=i,y=g.stateNode;g.tag===5&&y!==null&&(g=y,y=Fs(i,l),y!=null&&f.unshift(na(i,y,g)),y=Fs(i,r),y!=null&&f.push(na(i,y,g))),i=i.return}return f}function Br(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Xg(i,r,l,f,g){for(var y=r._reactName,I=[];l!==null&&l!==f;){var b=l,O=b.alternate,$=b.stateNode;if(O!==null&&O===f)break;b.tag===5&&$!==null&&(b=$,g?(O=Fs(l,y),O!=null&&I.unshift(na(l,O,b))):g||(O=Fs(l,y),O!=null&&I.push(na(l,O,b)))),l=l.return}I.length!==0&&i.push({event:r,listeners:I})}var gA=/\r\n?/g,mA=/\u0000|\uFFFD/g;function Vg(i){return(typeof i=="string"?i:""+i).replace(gA,`
`).replace(mA,"")}function zl(i,r,l){if(r=Vg(r),Vg(i)!==r&&l)throw Error(n(425))}function jl(){}var Md=null,bd=null;function Dd(i,r){return i==="textarea"||i==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Od=typeof setTimeout=="function"?setTimeout:void 0,yA=typeof clearTimeout=="function"?clearTimeout:void 0,qg=typeof Promise=="function"?Promise:void 0,vA=typeof queueMicrotask=="function"?queueMicrotask:typeof qg<"u"?function(i){return qg.resolve(null).then(i).catch(SA)}:Od;function SA(i){setTimeout(function(){throw i})}function Nd(i,r){var l=r,f=0;do{var g=l.nextSibling;if(i.removeChild(l),g&&g.nodeType===8)if(l=g.data,l==="/$"){if(f===0){i.removeChild(g),js(r);return}f--}else l!=="$"&&l!=="$?"&&l!=="$!"||f++;l=g}while(l);js(r)}function ao(i){for(;i!=null;i=i.nextSibling){var r=i.nodeType;if(r===1||r===3)break;if(r===8){if(r=i.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return i}function Zg(i){i=i.previousSibling;for(var r=0;i;){if(i.nodeType===8){var l=i.data;if(l==="$"||l==="$!"||l==="$?"){if(r===0)return i;r--}else l==="/$"&&r++}i=i.previousSibling}return null}var Hr=Math.random().toString(36).slice(2),fi="__reactFiber$"+Hr,ia="__reactProps$"+Hr,Pi="__reactContainer$"+Hr,Bd="__reactEvents$"+Hr,TA="__reactListeners$"+Hr,IA="__reactHandles$"+Hr;function $o(i){var r=i[fi];if(r)return r;for(var l=i.parentNode;l;){if(r=l[Pi]||l[fi]){if(l=r.alternate,r.child!==null||l!==null&&l.child!==null)for(i=Zg(i);i!==null;){if(l=i[fi])return l;i=Zg(i)}return r}i=l,l=i.parentNode}return null}function oa(i){return i=i[fi]||i[Pi],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Fr(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(n(33))}function Xl(i){return i[ia]||null}var Hd=[],Lr=-1;function lo(i){return{current:i}}function rt(i){0>Lr||(i.current=Hd[Lr],Hd[Lr]=null,Lr--)}function nt(i,r){Lr++,Hd[Lr]=i.current,i.current=r}var co={},Vt=lo(co),pn=lo(!1),Wo=co;function xr(i,r){var l=i.type.contextTypes;if(!l)return co;var f=i.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===r)return f.__reactInternalMemoizedMaskedChildContext;var g={},y;for(y in l)g[y]=r[y];return f&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=g),g}function gn(i){return i=i.childContextTypes,i!=null}function Vl(){rt(pn),rt(Vt)}function Kg(i,r,l){if(Vt.current!==co)throw Error(n(168));nt(Vt,r),nt(pn,l)}function Qg(i,r,l){var f=i.stateNode;if(r=r.childContextTypes,typeof f.getChildContext!="function")return l;f=f.getChildContext();for(var g in f)if(!(g in r))throw Error(n(108,ge(i)||"Unknown",g));return ne({},l,f)}function ql(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||co,Wo=Vt.current,nt(Vt,i),nt(pn,pn.current),!0}function Jg(i,r,l){var f=i.stateNode;if(!f)throw Error(n(169));l?(i=Qg(i,r,Wo),f.__reactInternalMemoizedMergedChildContext=i,rt(pn),rt(Vt),nt(Vt,i)):rt(pn),nt(pn,l)}var _i=null,Zl=!1,Fd=!1;function em(i){_i===null?_i=[i]:_i.push(i)}function AA(i){Zl=!0,em(i)}function uo(){if(!Fd&&_i!==null){Fd=!0;var i=0,r=Ze;try{var l=_i;for(Ze=1;i<l.length;i++){var f=l[i];do f=f(!0);while(f!==null)}_i=null,Zl=!1}catch(g){throw _i!==null&&(_i=_i.slice(i+1)),ng(rd,uo),g}finally{Ze=r,Fd=!1}}return null}var Ur=[],Gr=0,Kl=null,Ql=0,Nn=[],Bn=0,Yo=null,Ri=1,ki="";function zo(i,r){Ur[Gr++]=Ql,Ur[Gr++]=Kl,Kl=i,Ql=r}function tm(i,r,l){Nn[Bn++]=Ri,Nn[Bn++]=ki,Nn[Bn++]=Yo,Yo=i;var f=Ri;i=ki;var g=32-qn(f)-1;f&=~(1<<g),l+=1;var y=32-qn(r)+g;if(30<y){var I=g-g%5;y=(f&(1<<I)-1).toString(32),f>>=I,g-=I,Ri=1<<32-qn(r)+g|l<<g|f,ki=y+i}else Ri=1<<y|l<<g|f,ki=i}function Ld(i){i.return!==null&&(zo(i,1),tm(i,1,0))}function xd(i){for(;i===Kl;)Kl=Ur[--Gr],Ur[Gr]=null,Ql=Ur[--Gr],Ur[Gr]=null;for(;i===Yo;)Yo=Nn[--Bn],Nn[Bn]=null,ki=Nn[--Bn],Nn[Bn]=null,Ri=Nn[--Bn],Nn[Bn]=null}var Cn=null,Pn=null,ut=!1,Kn=null;function nm(i,r){var l=xn(5,null,null,0);l.elementType="DELETED",l.stateNode=r,l.return=i,r=i.deletions,r===null?(i.deletions=[l],i.flags|=16):r.push(l)}function im(i,r){switch(i.tag){case 5:var l=i.type;return r=r.nodeType!==1||l.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(i.stateNode=r,Cn=i,Pn=ao(r.firstChild),!0):!1;case 6:return r=i.pendingProps===""||r.nodeType!==3?null:r,r!==null?(i.stateNode=r,Cn=i,Pn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(l=Yo!==null?{id:Ri,overflow:ki}:null,i.memoizedState={dehydrated:r,treeContext:l,retryLane:1073741824},l=xn(18,null,null,0),l.stateNode=r,l.return=i,i.child=l,Cn=i,Pn=null,!0):!1;default:return!1}}function Ud(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Gd(i){if(ut){var r=Pn;if(r){var l=r;if(!im(i,r)){if(Ud(i))throw Error(n(418));r=ao(l.nextSibling);var f=Cn;r&&im(i,r)?nm(f,l):(i.flags=i.flags&-4097|2,ut=!1,Cn=i)}}else{if(Ud(i))throw Error(n(418));i.flags=i.flags&-4097|2,ut=!1,Cn=i}}}function om(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Cn=i}function Jl(i){if(i!==Cn)return!1;if(!ut)return om(i),ut=!0,!1;var r;if((r=i.tag!==3)&&!(r=i.tag!==5)&&(r=i.type,r=r!=="head"&&r!=="body"&&!Dd(i.type,i.memoizedProps)),r&&(r=Pn)){if(Ud(i))throw rm(),Error(n(418));for(;r;)nm(i,r),r=ao(r.nextSibling)}if(om(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));e:{for(i=i.nextSibling,r=0;i;){if(i.nodeType===8){var l=i.data;if(l==="/$"){if(r===0){Pn=ao(i.nextSibling);break e}r--}else l!=="$"&&l!=="$!"&&l!=="$?"||r++}i=i.nextSibling}Pn=null}}else Pn=Cn?ao(i.stateNode.nextSibling):null;return!0}function rm(){for(var i=Pn;i;)i=ao(i.nextSibling)}function $r(){Pn=Cn=null,ut=!1}function $d(i){Kn===null?Kn=[i]:Kn.push(i)}var wA=M.ReactCurrentBatchConfig;function ra(i,r,l){if(i=l.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(n(309));var f=l.stateNode}if(!f)throw Error(n(147,i));var g=f,y=""+i;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===y?r.ref:(r=function(I){var b=g.refs;I===null?delete b[y]:b[y]=I},r._stringRef=y,r)}if(typeof i!="string")throw Error(n(284));if(!l._owner)throw Error(n(290,i))}return i}function ec(i,r){throw i=Object.prototype.toString.call(r),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i))}function sm(i){var r=i._init;return r(i._payload)}function am(i){function r(L,B){if(i){var U=L.deletions;U===null?(L.deletions=[B],L.flags|=16):U.push(B)}}function l(L,B){if(!i)return null;for(;B!==null;)r(L,B),B=B.sibling;return null}function f(L,B){for(L=new Map;B!==null;)B.key!==null?L.set(B.key,B):L.set(B.index,B),B=B.sibling;return L}function g(L,B){return L=So(L,B),L.index=0,L.sibling=null,L}function y(L,B,U){return L.index=U,i?(U=L.alternate,U!==null?(U=U.index,U<B?(L.flags|=2,B):U):(L.flags|=2,B)):(L.flags|=1048576,B)}function I(L){return i&&L.alternate===null&&(L.flags|=2),L}function b(L,B,U,fe){return B===null||B.tag!==6?(B=Nf(U,L.mode,fe),B.return=L,B):(B=g(B,U),B.return=L,B)}function O(L,B,U,fe){var Re=U.type;return Re===R?oe(L,B,U.props.children,fe,U.key):B!==null&&(B.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===se&&sm(Re)===B.type)?(fe=g(B,U.props),fe.ref=ra(L,B,U),fe.return=L,fe):(fe=Ec(U.type,U.key,U.props,null,L.mode,fe),fe.ref=ra(L,B,U),fe.return=L,fe)}function $(L,B,U,fe){return B===null||B.tag!==4||B.stateNode.containerInfo!==U.containerInfo||B.stateNode.implementation!==U.implementation?(B=Bf(U,L.mode,fe),B.return=L,B):(B=g(B,U.children||[]),B.return=L,B)}function oe(L,B,U,fe,Re){return B===null||B.tag!==7?(B=Jo(U,L.mode,fe,Re),B.return=L,B):(B=g(B,U),B.return=L,B)}function ue(L,B,U){if(typeof B=="string"&&B!==""||typeof B=="number")return B=Nf(""+B,L.mode,U),B.return=L,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case P:return U=Ec(B.type,B.key,B.props,null,L.mode,U),U.ref=ra(L,null,B),U.return=L,U;case k:return B=Bf(B,L.mode,U),B.return=L,B;case se:var fe=B._init;return ue(L,fe(B._payload),U)}if(Xt(B)||re(B))return B=Jo(B,L.mode,U,null),B.return=L,B;ec(L,B)}return null}function ie(L,B,U,fe){var Re=B!==null?B.key:null;if(typeof U=="string"&&U!==""||typeof U=="number")return Re!==null?null:b(L,B,""+U,fe);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case P:return U.key===Re?O(L,B,U,fe):null;case k:return U.key===Re?$(L,B,U,fe):null;case se:return Re=U._init,ie(L,B,Re(U._payload),fe)}if(Xt(U)||re(U))return Re!==null?null:oe(L,B,U,fe,null);ec(L,U)}return null}function ye(L,B,U,fe,Re){if(typeof fe=="string"&&fe!==""||typeof fe=="number")return L=L.get(U)||null,b(B,L,""+fe,Re);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case P:return L=L.get(fe.key===null?U:fe.key)||null,O(B,L,fe,Re);case k:return L=L.get(fe.key===null?U:fe.key)||null,$(B,L,fe,Re);case se:var Me=fe._init;return ye(L,B,U,Me(fe._payload),Re)}if(Xt(fe)||re(fe))return L=L.get(U)||null,oe(B,L,fe,Re,null);ec(B,fe)}return null}function Ee(L,B,U,fe){for(var Re=null,Me=null,be=B,Be=B=0,Bt=null;be!==null&&Be<U.length;Be++){be.index>Be?(Bt=be,be=null):Bt=be.sibling;var je=ie(L,be,U[Be],fe);if(je===null){be===null&&(be=Bt);break}i&&be&&je.alternate===null&&r(L,be),B=y(je,B,Be),Me===null?Re=je:Me.sibling=je,Me=je,be=Bt}if(Be===U.length)return l(L,be),ut&&zo(L,Be),Re;if(be===null){for(;Be<U.length;Be++)be=ue(L,U[Be],fe),be!==null&&(B=y(be,B,Be),Me===null?Re=be:Me.sibling=be,Me=be);return ut&&zo(L,Be),Re}for(be=f(L,be);Be<U.length;Be++)Bt=ye(be,L,Be,U[Be],fe),Bt!==null&&(i&&Bt.alternate!==null&&be.delete(Bt.key===null?Be:Bt.key),B=y(Bt,B,Be),Me===null?Re=Bt:Me.sibling=Bt,Me=Bt);return i&&be.forEach(function(To){return r(L,To)}),ut&&zo(L,Be),Re}function Ce(L,B,U,fe){var Re=re(U);if(typeof Re!="function")throw Error(n(150));if(U=Re.call(U),U==null)throw Error(n(151));for(var Me=Re=null,be=B,Be=B=0,Bt=null,je=U.next();be!==null&&!je.done;Be++,je=U.next()){be.index>Be?(Bt=be,be=null):Bt=be.sibling;var To=ie(L,be,je.value,fe);if(To===null){be===null&&(be=Bt);break}i&&be&&To.alternate===null&&r(L,be),B=y(To,B,Be),Me===null?Re=To:Me.sibling=To,Me=To,be=Bt}if(je.done)return l(L,be),ut&&zo(L,Be),Re;if(be===null){for(;!je.done;Be++,je=U.next())je=ue(L,je.value,fe),je!==null&&(B=y(je,B,Be),Me===null?Re=je:Me.sibling=je,Me=je);return ut&&zo(L,Be),Re}for(be=f(L,be);!je.done;Be++,je=U.next())je=ye(be,L,Be,je.value,fe),je!==null&&(i&&je.alternate!==null&&be.delete(je.key===null?Be:je.key),B=y(je,B,Be),Me===null?Re=je:Me.sibling=je,Me=je);return i&&be.forEach(function(nw){return r(L,nw)}),ut&&zo(L,Be),Re}function St(L,B,U,fe){if(typeof U=="object"&&U!==null&&U.type===R&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case P:e:{for(var Re=U.key,Me=B;Me!==null;){if(Me.key===Re){if(Re=U.type,Re===R){if(Me.tag===7){l(L,Me.sibling),B=g(Me,U.props.children),B.return=L,L=B;break e}}else if(Me.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===se&&sm(Re)===Me.type){l(L,Me.sibling),B=g(Me,U.props),B.ref=ra(L,Me,U),B.return=L,L=B;break e}l(L,Me);break}else r(L,Me);Me=Me.sibling}U.type===R?(B=Jo(U.props.children,L.mode,fe,U.key),B.return=L,L=B):(fe=Ec(U.type,U.key,U.props,null,L.mode,fe),fe.ref=ra(L,B,U),fe.return=L,L=fe)}return I(L);case k:e:{for(Me=U.key;B!==null;){if(B.key===Me)if(B.tag===4&&B.stateNode.containerInfo===U.containerInfo&&B.stateNode.implementation===U.implementation){l(L,B.sibling),B=g(B,U.children||[]),B.return=L,L=B;break e}else{l(L,B);break}else r(L,B);B=B.sibling}B=Bf(U,L.mode,fe),B.return=L,L=B}return I(L);case se:return Me=U._init,St(L,B,Me(U._payload),fe)}if(Xt(U))return Ee(L,B,U,fe);if(re(U))return Ce(L,B,U,fe);ec(L,U)}return typeof U=="string"&&U!==""||typeof U=="number"?(U=""+U,B!==null&&B.tag===6?(l(L,B.sibling),B=g(B,U),B.return=L,L=B):(l(L,B),B=Nf(U,L.mode,fe),B.return=L,L=B),I(L)):l(L,B)}return St}var Wr=am(!0),lm=am(!1),tc=lo(null),nc=null,Yr=null,Wd=null;function Yd(){Wd=Yr=nc=null}function zd(i){var r=tc.current;rt(tc),i._currentValue=r}function jd(i,r,l){for(;i!==null;){var f=i.alternate;if((i.childLanes&r)!==r?(i.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),i===l)break;i=i.return}}function zr(i,r){nc=i,Wd=Yr=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&r)!==0&&(mn=!0),i.firstContext=null)}function Hn(i){var r=i._currentValue;if(Wd!==i)if(i={context:i,memoizedValue:r,next:null},Yr===null){if(nc===null)throw Error(n(308));Yr=i,nc.dependencies={lanes:0,firstContext:i}}else Yr=Yr.next=i;return r}var jo=null;function Xd(i){jo===null?jo=[i]:jo.push(i)}function cm(i,r,l,f){var g=r.interleaved;return g===null?(l.next=l,Xd(r)):(l.next=g.next,g.next=l),r.interleaved=l,Mi(i,f)}function Mi(i,r){i.lanes|=r;var l=i.alternate;for(l!==null&&(l.lanes|=r),l=i,i=i.return;i!==null;)i.childLanes|=r,l=i.alternate,l!==null&&(l.childLanes|=r),l=i,i=i.return;return l.tag===3?l.stateNode:null}var fo=!1;function Vd(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function um(i,r){i=i.updateQueue,r.updateQueue===i&&(r.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function bi(i,r){return{eventTime:i,lane:r,tag:0,payload:null,callback:null,next:null}}function ho(i,r,l){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,(ze&2)!==0){var g=f.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),f.pending=r,Mi(i,l)}return g=f.interleaved,g===null?(r.next=r,Xd(f)):(r.next=g.next,g.next=r),f.interleaved=r,Mi(i,l)}function ic(i,r,l){if(r=r.updateQueue,r!==null&&(r=r.shared,(l&4194240)!==0)){var f=r.lanes;f&=i.pendingLanes,l|=f,r.lanes=l,ld(i,l)}}function dm(i,r){var l=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,l===f)){var g=null,y=null;if(l=l.firstBaseUpdate,l!==null){do{var I={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};y===null?g=y=I:y=y.next=I,l=l.next}while(l!==null);y===null?g=y=r:y=y.next=r}else g=y=r;l={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:f.shared,effects:f.effects},i.updateQueue=l;return}i=l.lastBaseUpdate,i===null?l.firstBaseUpdate=r:i.next=r,l.lastBaseUpdate=r}function oc(i,r,l,f){var g=i.updateQueue;fo=!1;var y=g.firstBaseUpdate,I=g.lastBaseUpdate,b=g.shared.pending;if(b!==null){g.shared.pending=null;var O=b,$=O.next;O.next=null,I===null?y=$:I.next=$,I=O;var oe=i.alternate;oe!==null&&(oe=oe.updateQueue,b=oe.lastBaseUpdate,b!==I&&(b===null?oe.firstBaseUpdate=$:b.next=$,oe.lastBaseUpdate=O))}if(y!==null){var ue=g.baseState;I=0,oe=$=O=null,b=y;do{var ie=b.lane,ye=b.eventTime;if((f&ie)===ie){oe!==null&&(oe=oe.next={eventTime:ye,lane:0,tag:b.tag,payload:b.payload,callback:b.callback,next:null});e:{var Ee=i,Ce=b;switch(ie=r,ye=l,Ce.tag){case 1:if(Ee=Ce.payload,typeof Ee=="function"){ue=Ee.call(ye,ue,ie);break e}ue=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=Ce.payload,ie=typeof Ee=="function"?Ee.call(ye,ue,ie):Ee,ie==null)break e;ue=ne({},ue,ie);break e;case 2:fo=!0}}b.callback!==null&&b.lane!==0&&(i.flags|=64,ie=g.effects,ie===null?g.effects=[b]:ie.push(b))}else ye={eventTime:ye,lane:ie,tag:b.tag,payload:b.payload,callback:b.callback,next:null},oe===null?($=oe=ye,O=ue):oe=oe.next=ye,I|=ie;if(b=b.next,b===null){if(b=g.shared.pending,b===null)break;ie=b,b=ie.next,ie.next=null,g.lastBaseUpdate=ie,g.shared.pending=null}}while(!0);if(oe===null&&(O=ue),g.baseState=O,g.firstBaseUpdate=$,g.lastBaseUpdate=oe,r=g.shared.interleaved,r!==null){g=r;do I|=g.lane,g=g.next;while(g!==r)}else y===null&&(g.shared.lanes=0);qo|=I,i.lanes=I,i.memoizedState=ue}}function fm(i,r,l){if(i=r.effects,r.effects=null,i!==null)for(r=0;r<i.length;r++){var f=i[r],g=f.callback;if(g!==null){if(f.callback=null,f=l,typeof g!="function")throw Error(n(191,g));g.call(f)}}}var sa={},hi=lo(sa),aa=lo(sa),la=lo(sa);function Xo(i){if(i===sa)throw Error(n(174));return i}function qd(i,r){switch(nt(la,r),nt(aa,i),nt(hi,sa),i=r.nodeType,i){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Zu(null,"");break;default:i=i===8?r.parentNode:r,r=i.namespaceURI||null,i=i.tagName,r=Zu(r,i)}rt(hi),nt(hi,r)}function jr(){rt(hi),rt(aa),rt(la)}function hm(i){Xo(la.current);var r=Xo(hi.current),l=Zu(r,i.type);r!==l&&(nt(aa,i),nt(hi,l))}function Zd(i){aa.current===i&&(rt(hi),rt(aa))}var pt=lo(0);function rc(i){for(var r=i;r!==null;){if(r.tag===13){var l=r.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Kd=[];function Qd(){for(var i=0;i<Kd.length;i++)Kd[i]._workInProgressVersionPrimary=null;Kd.length=0}var sc=M.ReactCurrentDispatcher,Jd=M.ReactCurrentBatchConfig,Vo=0,gt=null,Pt=null,Ot=null,ac=!1,ca=!1,ua=0,EA=0;function qt(){throw Error(n(321))}function ef(i,r){if(r===null)return!1;for(var l=0;l<r.length&&l<i.length;l++)if(!Zn(i[l],r[l]))return!1;return!0}function tf(i,r,l,f,g,y){if(Vo=y,gt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,sc.current=i===null||i.memoizedState===null?RA:kA,i=l(f,g),ca){y=0;do{if(ca=!1,ua=0,25<=y)throw Error(n(301));y+=1,Ot=Pt=null,r.updateQueue=null,sc.current=MA,i=l(f,g)}while(ca)}if(sc.current=uc,r=Pt!==null&&Pt.next!==null,Vo=0,Ot=Pt=gt=null,ac=!1,r)throw Error(n(300));return i}function nf(){var i=ua!==0;return ua=0,i}function pi(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ot===null?gt.memoizedState=Ot=i:Ot=Ot.next=i,Ot}function Fn(){if(Pt===null){var i=gt.alternate;i=i!==null?i.memoizedState:null}else i=Pt.next;var r=Ot===null?gt.memoizedState:Ot.next;if(r!==null)Ot=r,Pt=i;else{if(i===null)throw Error(n(310));Pt=i,i={memoizedState:Pt.memoizedState,baseState:Pt.baseState,baseQueue:Pt.baseQueue,queue:Pt.queue,next:null},Ot===null?gt.memoizedState=Ot=i:Ot=Ot.next=i}return Ot}function da(i,r){return typeof r=="function"?r(i):r}function of(i){var r=Fn(),l=r.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=i;var f=Pt,g=f.baseQueue,y=l.pending;if(y!==null){if(g!==null){var I=g.next;g.next=y.next,y.next=I}f.baseQueue=g=y,l.pending=null}if(g!==null){y=g.next,f=f.baseState;var b=I=null,O=null,$=y;do{var oe=$.lane;if((Vo&oe)===oe)O!==null&&(O=O.next={lane:0,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null}),f=$.hasEagerState?$.eagerState:i(f,$.action);else{var ue={lane:oe,action:$.action,hasEagerState:$.hasEagerState,eagerState:$.eagerState,next:null};O===null?(b=O=ue,I=f):O=O.next=ue,gt.lanes|=oe,qo|=oe}$=$.next}while($!==null&&$!==y);O===null?I=f:O.next=b,Zn(f,r.memoizedState)||(mn=!0),r.memoizedState=f,r.baseState=I,r.baseQueue=O,l.lastRenderedState=f}if(i=l.interleaved,i!==null){g=i;do y=g.lane,gt.lanes|=y,qo|=y,g=g.next;while(g!==i)}else g===null&&(l.lanes=0);return[r.memoizedState,l.dispatch]}function rf(i){var r=Fn(),l=r.queue;if(l===null)throw Error(n(311));l.lastRenderedReducer=i;var f=l.dispatch,g=l.pending,y=r.memoizedState;if(g!==null){l.pending=null;var I=g=g.next;do y=i(y,I.action),I=I.next;while(I!==g);Zn(y,r.memoizedState)||(mn=!0),r.memoizedState=y,r.baseQueue===null&&(r.baseState=y),l.lastRenderedState=y}return[y,f]}function pm(){}function gm(i,r){var l=gt,f=Fn(),g=r(),y=!Zn(f.memoizedState,g);if(y&&(f.memoizedState=g,mn=!0),f=f.queue,sf(vm.bind(null,l,f,i),[i]),f.getSnapshot!==r||y||Ot!==null&&Ot.memoizedState.tag&1){if(l.flags|=2048,fa(9,ym.bind(null,l,f,g,r),void 0,null),Nt===null)throw Error(n(349));(Vo&30)!==0||mm(l,r,g)}return g}function mm(i,r,l){i.flags|=16384,i={getSnapshot:r,value:l},r=gt.updateQueue,r===null?(r={lastEffect:null,stores:null},gt.updateQueue=r,r.stores=[i]):(l=r.stores,l===null?r.stores=[i]:l.push(i))}function ym(i,r,l,f){r.value=l,r.getSnapshot=f,Sm(r)&&Tm(i)}function vm(i,r,l){return l(function(){Sm(r)&&Tm(i)})}function Sm(i){var r=i.getSnapshot;i=i.value;try{var l=r();return!Zn(i,l)}catch{return!0}}function Tm(i){var r=Mi(i,1);r!==null&&ti(r,i,1,-1)}function Im(i){var r=pi();return typeof i=="function"&&(i=i()),r.memoizedState=r.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:da,lastRenderedState:i},r.queue=i,i=i.dispatch=_A.bind(null,gt,i),[r.memoizedState,i]}function fa(i,r,l,f){return i={tag:i,create:r,destroy:l,deps:f,next:null},r=gt.updateQueue,r===null?(r={lastEffect:null,stores:null},gt.updateQueue=r,r.lastEffect=i.next=i):(l=r.lastEffect,l===null?r.lastEffect=i.next=i:(f=l.next,l.next=i,i.next=f,r.lastEffect=i)),i}function Am(){return Fn().memoizedState}function lc(i,r,l,f){var g=pi();gt.flags|=i,g.memoizedState=fa(1|r,l,void 0,f===void 0?null:f)}function cc(i,r,l,f){var g=Fn();f=f===void 0?null:f;var y=void 0;if(Pt!==null){var I=Pt.memoizedState;if(y=I.destroy,f!==null&&ef(f,I.deps)){g.memoizedState=fa(r,l,y,f);return}}gt.flags|=i,g.memoizedState=fa(1|r,l,y,f)}function wm(i,r){return lc(8390656,8,i,r)}function sf(i,r){return cc(2048,8,i,r)}function Em(i,r){return cc(4,2,i,r)}function Cm(i,r){return cc(4,4,i,r)}function Pm(i,r){if(typeof r=="function")return i=i(),r(i),function(){r(null)};if(r!=null)return i=i(),r.current=i,function(){r.current=null}}function _m(i,r,l){return l=l!=null?l.concat([i]):null,cc(4,4,Pm.bind(null,r,i),l)}function af(){}function Rm(i,r){var l=Fn();r=r===void 0?null:r;var f=l.memoizedState;return f!==null&&r!==null&&ef(r,f[1])?f[0]:(l.memoizedState=[i,r],i)}function km(i,r){var l=Fn();r=r===void 0?null:r;var f=l.memoizedState;return f!==null&&r!==null&&ef(r,f[1])?f[0]:(i=i(),l.memoizedState=[i,r],i)}function Mm(i,r,l){return(Vo&21)===0?(i.baseState&&(i.baseState=!1,mn=!0),i.memoizedState=l):(Zn(l,r)||(l=sg(),gt.lanes|=l,qo|=l,i.baseState=!0),r)}function CA(i,r){var l=Ze;Ze=l!==0&&4>l?l:4,i(!0);var f=Jd.transition;Jd.transition={};try{i(!1),r()}finally{Ze=l,Jd.transition=f}}function bm(){return Fn().memoizedState}function PA(i,r,l){var f=yo(i);if(l={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null},Dm(i))Om(r,l);else if(l=cm(i,r,l,f),l!==null){var g=rn();ti(l,i,f,g),Nm(l,r,f)}}function _A(i,r,l){var f=yo(i),g={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null};if(Dm(i))Om(r,g);else{var y=i.alternate;if(i.lanes===0&&(y===null||y.lanes===0)&&(y=r.lastRenderedReducer,y!==null))try{var I=r.lastRenderedState,b=y(I,l);if(g.hasEagerState=!0,g.eagerState=b,Zn(b,I)){var O=r.interleaved;O===null?(g.next=g,Xd(r)):(g.next=O.next,O.next=g),r.interleaved=g;return}}catch{}finally{}l=cm(i,r,g,f),l!==null&&(g=rn(),ti(l,i,f,g),Nm(l,r,f))}}function Dm(i){var r=i.alternate;return i===gt||r!==null&&r===gt}function Om(i,r){ca=ac=!0;var l=i.pending;l===null?r.next=r:(r.next=l.next,l.next=r),i.pending=r}function Nm(i,r,l){if((l&4194240)!==0){var f=r.lanes;f&=i.pendingLanes,l|=f,r.lanes=l,ld(i,l)}}var uc={readContext:Hn,useCallback:qt,useContext:qt,useEffect:qt,useImperativeHandle:qt,useInsertionEffect:qt,useLayoutEffect:qt,useMemo:qt,useReducer:qt,useRef:qt,useState:qt,useDebugValue:qt,useDeferredValue:qt,useTransition:qt,useMutableSource:qt,useSyncExternalStore:qt,useId:qt,unstable_isNewReconciler:!1},RA={readContext:Hn,useCallback:function(i,r){return pi().memoizedState=[i,r===void 0?null:r],i},useContext:Hn,useEffect:wm,useImperativeHandle:function(i,r,l){return l=l!=null?l.concat([i]):null,lc(4194308,4,Pm.bind(null,r,i),l)},useLayoutEffect:function(i,r){return lc(4194308,4,i,r)},useInsertionEffect:function(i,r){return lc(4,2,i,r)},useMemo:function(i,r){var l=pi();return r=r===void 0?null:r,i=i(),l.memoizedState=[i,r],i},useReducer:function(i,r,l){var f=pi();return r=l!==void 0?l(r):r,f.memoizedState=f.baseState=r,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:r},f.queue=i,i=i.dispatch=PA.bind(null,gt,i),[f.memoizedState,i]},useRef:function(i){var r=pi();return i={current:i},r.memoizedState=i},useState:Im,useDebugValue:af,useDeferredValue:function(i){return pi().memoizedState=i},useTransition:function(){var i=Im(!1),r=i[0];return i=CA.bind(null,i[1]),pi().memoizedState=i,[r,i]},useMutableSource:function(){},useSyncExternalStore:function(i,r,l){var f=gt,g=pi();if(ut){if(l===void 0)throw Error(n(407));l=l()}else{if(l=r(),Nt===null)throw Error(n(349));(Vo&30)!==0||mm(f,r,l)}g.memoizedState=l;var y={value:l,getSnapshot:r};return g.queue=y,wm(vm.bind(null,f,y,i),[i]),f.flags|=2048,fa(9,ym.bind(null,f,y,l,r),void 0,null),l},useId:function(){var i=pi(),r=Nt.identifierPrefix;if(ut){var l=ki,f=Ri;l=(f&~(1<<32-qn(f)-1)).toString(32)+l,r=":"+r+"R"+l,l=ua++,0<l&&(r+="H"+l.toString(32)),r+=":"}else l=EA++,r=":"+r+"r"+l.toString(32)+":";return i.memoizedState=r},unstable_isNewReconciler:!1},kA={readContext:Hn,useCallback:Rm,useContext:Hn,useEffect:sf,useImperativeHandle:_m,useInsertionEffect:Em,useLayoutEffect:Cm,useMemo:km,useReducer:of,useRef:Am,useState:function(){return of(da)},useDebugValue:af,useDeferredValue:function(i){var r=Fn();return Mm(r,Pt.memoizedState,i)},useTransition:function(){var i=of(da)[0],r=Fn().memoizedState;return[i,r]},useMutableSource:pm,useSyncExternalStore:gm,useId:bm,unstable_isNewReconciler:!1},MA={readContext:Hn,useCallback:Rm,useContext:Hn,useEffect:sf,useImperativeHandle:_m,useInsertionEffect:Em,useLayoutEffect:Cm,useMemo:km,useReducer:rf,useRef:Am,useState:function(){return rf(da)},useDebugValue:af,useDeferredValue:function(i){var r=Fn();return Pt===null?r.memoizedState=i:Mm(r,Pt.memoizedState,i)},useTransition:function(){var i=rf(da)[0],r=Fn().memoizedState;return[i,r]},useMutableSource:pm,useSyncExternalStore:gm,useId:bm,unstable_isNewReconciler:!1};function Qn(i,r){if(i&&i.defaultProps){r=ne({},r),i=i.defaultProps;for(var l in i)r[l]===void 0&&(r[l]=i[l]);return r}return r}function lf(i,r,l,f){r=i.memoizedState,l=l(f,r),l=l==null?r:ne({},r,l),i.memoizedState=l,i.lanes===0&&(i.updateQueue.baseState=l)}var dc={isMounted:function(i){return(i=i._reactInternals)?Go(i)===i:!1},enqueueSetState:function(i,r,l){i=i._reactInternals;var f=rn(),g=yo(i),y=bi(f,g);y.payload=r,l!=null&&(y.callback=l),r=ho(i,y,g),r!==null&&(ti(r,i,g,f),ic(r,i,g))},enqueueReplaceState:function(i,r,l){i=i._reactInternals;var f=rn(),g=yo(i),y=bi(f,g);y.tag=1,y.payload=r,l!=null&&(y.callback=l),r=ho(i,y,g),r!==null&&(ti(r,i,g,f),ic(r,i,g))},enqueueForceUpdate:function(i,r){i=i._reactInternals;var l=rn(),f=yo(i),g=bi(l,f);g.tag=2,r!=null&&(g.callback=r),r=ho(i,g,f),r!==null&&(ti(r,i,f,l),ic(r,i,f))}};function Bm(i,r,l,f,g,y,I){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,y,I):r.prototype&&r.prototype.isPureReactComponent?!Qs(l,f)||!Qs(g,y):!0}function Hm(i,r,l){var f=!1,g=co,y=r.contextType;return typeof y=="object"&&y!==null?y=Hn(y):(g=gn(r)?Wo:Vt.current,f=r.contextTypes,y=(f=f!=null)?xr(i,g):co),r=new r(l,y),i.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=dc,i.stateNode=r,r._reactInternals=i,f&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=g,i.__reactInternalMemoizedMaskedChildContext=y),r}function Fm(i,r,l,f){i=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(l,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(l,f),r.state!==i&&dc.enqueueReplaceState(r,r.state,null)}function cf(i,r,l,f){var g=i.stateNode;g.props=l,g.state=i.memoizedState,g.refs={},Vd(i);var y=r.contextType;typeof y=="object"&&y!==null?g.context=Hn(y):(y=gn(r)?Wo:Vt.current,g.context=xr(i,y)),g.state=i.memoizedState,y=r.getDerivedStateFromProps,typeof y=="function"&&(lf(i,r,y,l),g.state=i.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(r=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),r!==g.state&&dc.enqueueReplaceState(g,g.state,null),oc(i,l,g,f),g.state=i.memoizedState),typeof g.componentDidMount=="function"&&(i.flags|=4194308)}function Xr(i,r){try{var l="",f=r;do l+=de(f),f=f.return;while(f);var g=l}catch(y){g=`
Error generating stack: `+y.message+`
`+y.stack}return{value:i,source:r,stack:g,digest:null}}function uf(i,r,l){return{value:i,source:null,stack:l??null,digest:r??null}}function df(i,r){try{console.error(r.value)}catch(l){setTimeout(function(){throw l})}}var bA=typeof WeakMap=="function"?WeakMap:Map;function Lm(i,r,l){l=bi(-1,l),l.tag=3,l.payload={element:null};var f=r.value;return l.callback=function(){vc||(vc=!0,Pf=f),df(i,r)},l}function xm(i,r,l){l=bi(-1,l),l.tag=3;var f=i.type.getDerivedStateFromError;if(typeof f=="function"){var g=r.value;l.payload=function(){return f(g)},l.callback=function(){df(i,r)}}var y=i.stateNode;return y!==null&&typeof y.componentDidCatch=="function"&&(l.callback=function(){df(i,r),typeof f!="function"&&(go===null?go=new Set([this]):go.add(this));var I=r.stack;this.componentDidCatch(r.value,{componentStack:I!==null?I:""})}),l}function Um(i,r,l){var f=i.pingCache;if(f===null){f=i.pingCache=new bA;var g=new Set;f.set(r,g)}else g=f.get(r),g===void 0&&(g=new Set,f.set(r,g));g.has(l)||(g.add(l),i=zA.bind(null,i,r,l),r.then(i,i))}function Gm(i){do{var r;if((r=i.tag===13)&&(r=i.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return i;i=i.return}while(i!==null);return null}function $m(i,r,l,f,g){return(i.mode&1)===0?(i===r?i.flags|=65536:(i.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(r=bi(-1,1),r.tag=2,ho(l,r,1))),l.lanes|=1),i):(i.flags|=65536,i.lanes=g,i)}var DA=M.ReactCurrentOwner,mn=!1;function on(i,r,l,f){r.child=i===null?lm(r,null,l,f):Wr(r,i.child,l,f)}function Wm(i,r,l,f,g){l=l.render;var y=r.ref;return zr(r,g),f=tf(i,r,l,f,y,g),l=nf(),i!==null&&!mn?(r.updateQueue=i.updateQueue,r.flags&=-2053,i.lanes&=~g,Di(i,r,g)):(ut&&l&&Ld(r),r.flags|=1,on(i,r,f,g),r.child)}function Ym(i,r,l,f,g){if(i===null){var y=l.type;return typeof y=="function"&&!Of(y)&&y.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(r.tag=15,r.type=y,zm(i,r,y,f,g)):(i=Ec(l.type,null,f,r,r.mode,g),i.ref=r.ref,i.return=r,r.child=i)}if(y=i.child,(i.lanes&g)===0){var I=y.memoizedProps;if(l=l.compare,l=l!==null?l:Qs,l(I,f)&&i.ref===r.ref)return Di(i,r,g)}return r.flags|=1,i=So(y,f),i.ref=r.ref,i.return=r,r.child=i}function zm(i,r,l,f,g){if(i!==null){var y=i.memoizedProps;if(Qs(y,f)&&i.ref===r.ref)if(mn=!1,r.pendingProps=f=y,(i.lanes&g)!==0)(i.flags&131072)!==0&&(mn=!0);else return r.lanes=i.lanes,Di(i,r,g)}return ff(i,r,l,f,g)}function jm(i,r,l){var f=r.pendingProps,g=f.children,y=i!==null?i.memoizedState:null;if(f.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},nt(qr,_n),_n|=l;else{if((l&1073741824)===0)return i=y!==null?y.baseLanes|l:l,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:i,cachePool:null,transitions:null},r.updateQueue=null,nt(qr,_n),_n|=i,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=y!==null?y.baseLanes:l,nt(qr,_n),_n|=f}else y!==null?(f=y.baseLanes|l,r.memoizedState=null):f=l,nt(qr,_n),_n|=f;return on(i,r,g,l),r.child}function Xm(i,r){var l=r.ref;(i===null&&l!==null||i!==null&&i.ref!==l)&&(r.flags|=512,r.flags|=2097152)}function ff(i,r,l,f,g){var y=gn(l)?Wo:Vt.current;return y=xr(r,y),zr(r,g),l=tf(i,r,l,f,y,g),f=nf(),i!==null&&!mn?(r.updateQueue=i.updateQueue,r.flags&=-2053,i.lanes&=~g,Di(i,r,g)):(ut&&f&&Ld(r),r.flags|=1,on(i,r,l,g),r.child)}function Vm(i,r,l,f,g){if(gn(l)){var y=!0;ql(r)}else y=!1;if(zr(r,g),r.stateNode===null)hc(i,r),Hm(r,l,f),cf(r,l,f,g),f=!0;else if(i===null){var I=r.stateNode,b=r.memoizedProps;I.props=b;var O=I.context,$=l.contextType;typeof $=="object"&&$!==null?$=Hn($):($=gn(l)?Wo:Vt.current,$=xr(r,$));var oe=l.getDerivedStateFromProps,ue=typeof oe=="function"||typeof I.getSnapshotBeforeUpdate=="function";ue||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(b!==f||O!==$)&&Fm(r,I,f,$),fo=!1;var ie=r.memoizedState;I.state=ie,oc(r,f,I,g),O=r.memoizedState,b!==f||ie!==O||pn.current||fo?(typeof oe=="function"&&(lf(r,l,oe,f),O=r.memoizedState),(b=fo||Bm(r,l,b,f,ie,O,$))?(ue||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount()),typeof I.componentDidMount=="function"&&(r.flags|=4194308)):(typeof I.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=O),I.props=f,I.state=O,I.context=$,f=b):(typeof I.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{I=r.stateNode,um(i,r),b=r.memoizedProps,$=r.type===r.elementType?b:Qn(r.type,b),I.props=$,ue=r.pendingProps,ie=I.context,O=l.contextType,typeof O=="object"&&O!==null?O=Hn(O):(O=gn(l)?Wo:Vt.current,O=xr(r,O));var ye=l.getDerivedStateFromProps;(oe=typeof ye=="function"||typeof I.getSnapshotBeforeUpdate=="function")||typeof I.UNSAFE_componentWillReceiveProps!="function"&&typeof I.componentWillReceiveProps!="function"||(b!==ue||ie!==O)&&Fm(r,I,f,O),fo=!1,ie=r.memoizedState,I.state=ie,oc(r,f,I,g);var Ee=r.memoizedState;b!==ue||ie!==Ee||pn.current||fo?(typeof ye=="function"&&(lf(r,l,ye,f),Ee=r.memoizedState),($=fo||Bm(r,l,$,f,ie,Ee,O)||!1)?(oe||typeof I.UNSAFE_componentWillUpdate!="function"&&typeof I.componentWillUpdate!="function"||(typeof I.componentWillUpdate=="function"&&I.componentWillUpdate(f,Ee,O),typeof I.UNSAFE_componentWillUpdate=="function"&&I.UNSAFE_componentWillUpdate(f,Ee,O)),typeof I.componentDidUpdate=="function"&&(r.flags|=4),typeof I.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof I.componentDidUpdate!="function"||b===i.memoizedProps&&ie===i.memoizedState||(r.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||b===i.memoizedProps&&ie===i.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=Ee),I.props=f,I.state=Ee,I.context=O,f=$):(typeof I.componentDidUpdate!="function"||b===i.memoizedProps&&ie===i.memoizedState||(r.flags|=4),typeof I.getSnapshotBeforeUpdate!="function"||b===i.memoizedProps&&ie===i.memoizedState||(r.flags|=1024),f=!1)}return hf(i,r,l,f,y,g)}function hf(i,r,l,f,g,y){Xm(i,r);var I=(r.flags&128)!==0;if(!f&&!I)return g&&Jg(r,l,!1),Di(i,r,y);f=r.stateNode,DA.current=r;var b=I&&typeof l.getDerivedStateFromError!="function"?null:f.render();return r.flags|=1,i!==null&&I?(r.child=Wr(r,i.child,null,y),r.child=Wr(r,null,b,y)):on(i,r,b,y),r.memoizedState=f.state,g&&Jg(r,l,!0),r.child}function qm(i){var r=i.stateNode;r.pendingContext?Kg(i,r.pendingContext,r.pendingContext!==r.context):r.context&&Kg(i,r.context,!1),qd(i,r.containerInfo)}function Zm(i,r,l,f,g){return $r(),$d(g),r.flags|=256,on(i,r,l,f),r.child}var pf={dehydrated:null,treeContext:null,retryLane:0};function gf(i){return{baseLanes:i,cachePool:null,transitions:null}}function Km(i,r,l){var f=r.pendingProps,g=pt.current,y=!1,I=(r.flags&128)!==0,b;if((b=I)||(b=i!==null&&i.memoizedState===null?!1:(g&2)!==0),b?(y=!0,r.flags&=-129):(i===null||i.memoizedState!==null)&&(g|=1),nt(pt,g&1),i===null)return Gd(r),i=r.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((r.mode&1)===0?r.lanes=1:i.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(I=f.children,i=f.fallback,y?(f=r.mode,y=r.child,I={mode:"hidden",children:I},(f&1)===0&&y!==null?(y.childLanes=0,y.pendingProps=I):y=Cc(I,f,0,null),i=Jo(i,f,l,null),y.return=r,i.return=r,y.sibling=i,r.child=y,r.child.memoizedState=gf(l),r.memoizedState=pf,i):mf(r,I));if(g=i.memoizedState,g!==null&&(b=g.dehydrated,b!==null))return OA(i,r,I,f,b,g,l);if(y){y=f.fallback,I=r.mode,g=i.child,b=g.sibling;var O={mode:"hidden",children:f.children};return(I&1)===0&&r.child!==g?(f=r.child,f.childLanes=0,f.pendingProps=O,r.deletions=null):(f=So(g,O),f.subtreeFlags=g.subtreeFlags&14680064),b!==null?y=So(b,y):(y=Jo(y,I,l,null),y.flags|=2),y.return=r,f.return=r,f.sibling=y,r.child=f,f=y,y=r.child,I=i.child.memoizedState,I=I===null?gf(l):{baseLanes:I.baseLanes|l,cachePool:null,transitions:I.transitions},y.memoizedState=I,y.childLanes=i.childLanes&~l,r.memoizedState=pf,f}return y=i.child,i=y.sibling,f=So(y,{mode:"visible",children:f.children}),(r.mode&1)===0&&(f.lanes=l),f.return=r,f.sibling=null,i!==null&&(l=r.deletions,l===null?(r.deletions=[i],r.flags|=16):l.push(i)),r.child=f,r.memoizedState=null,f}function mf(i,r){return r=Cc({mode:"visible",children:r},i.mode,0,null),r.return=i,i.child=r}function fc(i,r,l,f){return f!==null&&$d(f),Wr(r,i.child,null,l),i=mf(r,r.pendingProps.children),i.flags|=2,r.memoizedState=null,i}function OA(i,r,l,f,g,y,I){if(l)return r.flags&256?(r.flags&=-257,f=uf(Error(n(422))),fc(i,r,I,f)):r.memoizedState!==null?(r.child=i.child,r.flags|=128,null):(y=f.fallback,g=r.mode,f=Cc({mode:"visible",children:f.children},g,0,null),y=Jo(y,g,I,null),y.flags|=2,f.return=r,y.return=r,f.sibling=y,r.child=f,(r.mode&1)!==0&&Wr(r,i.child,null,I),r.child.memoizedState=gf(I),r.memoizedState=pf,y);if((r.mode&1)===0)return fc(i,r,I,null);if(g.data==="$!"){if(f=g.nextSibling&&g.nextSibling.dataset,f)var b=f.dgst;return f=b,y=Error(n(419)),f=uf(y,f,void 0),fc(i,r,I,f)}if(b=(I&i.childLanes)!==0,mn||b){if(f=Nt,f!==null){switch(I&-I){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=(g&(f.suspendedLanes|I))!==0?0:g,g!==0&&g!==y.retryLane&&(y.retryLane=g,Mi(i,g),ti(f,i,g,-1))}return Df(),f=uf(Error(n(421))),fc(i,r,I,f)}return g.data==="$?"?(r.flags|=128,r.child=i.child,r=jA.bind(null,i),g._reactRetry=r,null):(i=y.treeContext,Pn=ao(g.nextSibling),Cn=r,ut=!0,Kn=null,i!==null&&(Nn[Bn++]=Ri,Nn[Bn++]=ki,Nn[Bn++]=Yo,Ri=i.id,ki=i.overflow,Yo=r),r=mf(r,f.children),r.flags|=4096,r)}function Qm(i,r,l){i.lanes|=r;var f=i.alternate;f!==null&&(f.lanes|=r),jd(i.return,r,l)}function yf(i,r,l,f,g){var y=i.memoizedState;y===null?i.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:l,tailMode:g}:(y.isBackwards=r,y.rendering=null,y.renderingStartTime=0,y.last=f,y.tail=l,y.tailMode=g)}function Jm(i,r,l){var f=r.pendingProps,g=f.revealOrder,y=f.tail;if(on(i,r,f.children,l),f=pt.current,(f&2)!==0)f=f&1|2,r.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=r.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&Qm(i,l,r);else if(i.tag===19)Qm(i,l,r);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break e;for(;i.sibling===null;){if(i.return===null||i.return===r)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}f&=1}if(nt(pt,f),(r.mode&1)===0)r.memoizedState=null;else switch(g){case"forwards":for(l=r.child,g=null;l!==null;)i=l.alternate,i!==null&&rc(i)===null&&(g=l),l=l.sibling;l=g,l===null?(g=r.child,r.child=null):(g=l.sibling,l.sibling=null),yf(r,!1,g,l,y);break;case"backwards":for(l=null,g=r.child,r.child=null;g!==null;){if(i=g.alternate,i!==null&&rc(i)===null){r.child=g;break}i=g.sibling,g.sibling=l,l=g,g=i}yf(r,!0,l,null,y);break;case"together":yf(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function hc(i,r){(r.mode&1)===0&&i!==null&&(i.alternate=null,r.alternate=null,r.flags|=2)}function Di(i,r,l){if(i!==null&&(r.dependencies=i.dependencies),qo|=r.lanes,(l&r.childLanes)===0)return null;if(i!==null&&r.child!==i.child)throw Error(n(153));if(r.child!==null){for(i=r.child,l=So(i,i.pendingProps),r.child=l,l.return=r;i.sibling!==null;)i=i.sibling,l=l.sibling=So(i,i.pendingProps),l.return=r;l.sibling=null}return r.child}function NA(i,r,l){switch(r.tag){case 3:qm(r),$r();break;case 5:hm(r);break;case 1:gn(r.type)&&ql(r);break;case 4:qd(r,r.stateNode.containerInfo);break;case 10:var f=r.type._context,g=r.memoizedProps.value;nt(tc,f._currentValue),f._currentValue=g;break;case 13:if(f=r.memoizedState,f!==null)return f.dehydrated!==null?(nt(pt,pt.current&1),r.flags|=128,null):(l&r.child.childLanes)!==0?Km(i,r,l):(nt(pt,pt.current&1),i=Di(i,r,l),i!==null?i.sibling:null);nt(pt,pt.current&1);break;case 19:if(f=(l&r.childLanes)!==0,(i.flags&128)!==0){if(f)return Jm(i,r,l);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),nt(pt,pt.current),f)break;return null;case 22:case 23:return r.lanes=0,jm(i,r,l)}return Di(i,r,l)}var e0,vf,t0,n0;e0=function(i,r){for(var l=r.child;l!==null;){if(l.tag===5||l.tag===6)i.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===r)break;for(;l.sibling===null;){if(l.return===null||l.return===r)return;l=l.return}l.sibling.return=l.return,l=l.sibling}},vf=function(){},t0=function(i,r,l,f){var g=i.memoizedProps;if(g!==f){i=r.stateNode,Xo(hi.current);var y=null;switch(l){case"input":g=xe(i,g),f=xe(i,f),y=[];break;case"select":g=ne({},g,{value:void 0}),f=ne({},f,{value:void 0}),y=[];break;case"textarea":g=eo(i,g),f=eo(i,f),y=[];break;default:typeof g.onClick!="function"&&typeof f.onClick=="function"&&(i.onclick=jl)}Ku(l,f);var I;l=null;for($ in g)if(!f.hasOwnProperty($)&&g.hasOwnProperty($)&&g[$]!=null)if($==="style"){var b=g[$];for(I in b)b.hasOwnProperty(I)&&(l||(l={}),l[I]="")}else $!=="dangerouslySetInnerHTML"&&$!=="children"&&$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(s.hasOwnProperty($)?y||(y=[]):(y=y||[]).push($,null));for($ in f){var O=f[$];if(b=g!=null?g[$]:void 0,f.hasOwnProperty($)&&O!==b&&(O!=null||b!=null))if($==="style")if(b){for(I in b)!b.hasOwnProperty(I)||O&&O.hasOwnProperty(I)||(l||(l={}),l[I]="");for(I in O)O.hasOwnProperty(I)&&b[I]!==O[I]&&(l||(l={}),l[I]=O[I])}else l||(y||(y=[]),y.push($,l)),l=O;else $==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,b=b?b.__html:void 0,O!=null&&b!==O&&(y=y||[]).push($,O)):$==="children"?typeof O!="string"&&typeof O!="number"||(y=y||[]).push($,""+O):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&(s.hasOwnProperty($)?(O!=null&&$==="onScroll"&&ot("scroll",i),y||b===O||(y=[])):(y=y||[]).push($,O))}l&&(y=y||[]).push("style",l);var $=y;(r.updateQueue=$)&&(r.flags|=4)}},n0=function(i,r,l,f){l!==f&&(r.flags|=4)};function ha(i,r){if(!ut)switch(i.tailMode){case"hidden":r=i.tail;for(var l=null;r!==null;)r.alternate!==null&&(l=r),r=r.sibling;l===null?i.tail=null:l.sibling=null;break;case"collapsed":l=i.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?r||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function Zt(i){var r=i.alternate!==null&&i.alternate.child===i.child,l=0,f=0;if(r)for(var g=i.child;g!==null;)l|=g.lanes|g.childLanes,f|=g.subtreeFlags&14680064,f|=g.flags&14680064,g.return=i,g=g.sibling;else for(g=i.child;g!==null;)l|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=i,g=g.sibling;return i.subtreeFlags|=f,i.childLanes=l,r}function BA(i,r,l){var f=r.pendingProps;switch(xd(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Zt(r),null;case 1:return gn(r.type)&&Vl(),Zt(r),null;case 3:return f=r.stateNode,jr(),rt(pn),rt(Vt),Qd(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(i===null||i.child===null)&&(Jl(r)?r.flags|=4:i===null||i.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Kn!==null&&(kf(Kn),Kn=null))),vf(i,r),Zt(r),null;case 5:Zd(r);var g=Xo(la.current);if(l=r.type,i!==null&&r.stateNode!=null)t0(i,r,l,f,g),i.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!f){if(r.stateNode===null)throw Error(n(166));return Zt(r),null}if(i=Xo(hi.current),Jl(r)){f=r.stateNode,l=r.type;var y=r.memoizedProps;switch(f[fi]=r,f[ia]=y,i=(r.mode&1)!==0,l){case"dialog":ot("cancel",f),ot("close",f);break;case"iframe":case"object":case"embed":ot("load",f);break;case"video":case"audio":for(g=0;g<ea.length;g++)ot(ea[g],f);break;case"source":ot("error",f);break;case"img":case"image":case"link":ot("error",f),ot("load",f);break;case"details":ot("toggle",f);break;case"input":He(f,y),ot("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!y.multiple},ot("invalid",f);break;case"textarea":Ds(f,y),ot("invalid",f)}Ku(l,y),g=null;for(var I in y)if(y.hasOwnProperty(I)){var b=y[I];I==="children"?typeof b=="string"?f.textContent!==b&&(y.suppressHydrationWarning!==!0&&zl(f.textContent,b,i),g=["children",b]):typeof b=="number"&&f.textContent!==""+b&&(y.suppressHydrationWarning!==!0&&zl(f.textContent,b,i),g=["children",""+b]):s.hasOwnProperty(I)&&b!=null&&I==="onScroll"&&ot("scroll",f)}switch(l){case"input":we(f),At(f,y,!0);break;case"textarea":we(f),Ns(f);break;case"select":case"option":break;default:typeof y.onClick=="function"&&(f.onclick=jl)}f=g,r.updateQueue=f,f!==null&&(r.flags|=4)}else{I=g.nodeType===9?g:g.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=Uo(l)),i==="http://www.w3.org/1999/xhtml"?l==="script"?(i=I.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof f.is=="string"?i=I.createElement(l,{is:f.is}):(i=I.createElement(l),l==="select"&&(I=i,f.multiple?I.multiple=!0:f.size&&(I.size=f.size))):i=I.createElementNS(i,l),i[fi]=r,i[ia]=f,e0(i,r,!1,!1),r.stateNode=i;e:{switch(I=Qu(l,f),l){case"dialog":ot("cancel",i),ot("close",i),g=f;break;case"iframe":case"object":case"embed":ot("load",i),g=f;break;case"video":case"audio":for(g=0;g<ea.length;g++)ot(ea[g],i);g=f;break;case"source":ot("error",i),g=f;break;case"img":case"image":case"link":ot("error",i),ot("load",i),g=f;break;case"details":ot("toggle",i),g=f;break;case"input":He(i,f),g=xe(i,f),ot("invalid",i);break;case"option":g=f;break;case"select":i._wrapperState={wasMultiple:!!f.multiple},g=ne({},f,{value:void 0}),ot("invalid",i);break;case"textarea":Ds(i,f),g=eo(i,f),ot("invalid",i);break;default:g=f}Ku(l,g),b=g;for(y in b)if(b.hasOwnProperty(y)){var O=b[y];y==="style"?zp(i,O):y==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&Wp(i,O)):y==="children"?typeof O=="string"?(l!=="textarea"||O!=="")&&Bs(i,O):typeof O=="number"&&Bs(i,""+O):y!=="suppressContentEditableWarning"&&y!=="suppressHydrationWarning"&&y!=="autoFocus"&&(s.hasOwnProperty(y)?O!=null&&y==="onScroll"&&ot("scroll",i):O!=null&&_(i,y,O,I))}switch(l){case"input":we(i),At(i,f,!1);break;case"textarea":we(i),Ns(i);break;case"option":f.value!=null&&i.setAttribute("value",""+x(f.value));break;case"select":i.multiple=!!f.multiple,y=f.value,y!=null?wn(i,!!f.multiple,y,!1):f.defaultValue!=null&&wn(i,!!f.multiple,f.defaultValue,!0);break;default:typeof g.onClick=="function"&&(i.onclick=jl)}switch(l){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Zt(r),null;case 6:if(i&&r.stateNode!=null)n0(i,r,i.memoizedProps,f);else{if(typeof f!="string"&&r.stateNode===null)throw Error(n(166));if(l=Xo(la.current),Xo(hi.current),Jl(r)){if(f=r.stateNode,l=r.memoizedProps,f[fi]=r,(y=f.nodeValue!==l)&&(i=Cn,i!==null))switch(i.tag){case 3:zl(f.nodeValue,l,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&zl(f.nodeValue,l,(i.mode&1)!==0)}y&&(r.flags|=4)}else f=(l.nodeType===9?l:l.ownerDocument).createTextNode(f),f[fi]=r,r.stateNode=f}return Zt(r),null;case 13:if(rt(pt),f=r.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(ut&&Pn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)rm(),$r(),r.flags|=98560,y=!1;else if(y=Jl(r),f!==null&&f.dehydrated!==null){if(i===null){if(!y)throw Error(n(318));if(y=r.memoizedState,y=y!==null?y.dehydrated:null,!y)throw Error(n(317));y[fi]=r}else $r(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Zt(r),y=!1}else Kn!==null&&(kf(Kn),Kn=null),y=!0;if(!y)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=l,r):(f=f!==null,f!==(i!==null&&i.memoizedState!==null)&&f&&(r.child.flags|=8192,(r.mode&1)!==0&&(i===null||(pt.current&1)!==0?_t===0&&(_t=3):Df())),r.updateQueue!==null&&(r.flags|=4),Zt(r),null);case 4:return jr(),vf(i,r),i===null&&ta(r.stateNode.containerInfo),Zt(r),null;case 10:return zd(r.type._context),Zt(r),null;case 17:return gn(r.type)&&Vl(),Zt(r),null;case 19:if(rt(pt),y=r.memoizedState,y===null)return Zt(r),null;if(f=(r.flags&128)!==0,I=y.rendering,I===null)if(f)ha(y,!1);else{if(_t!==0||i!==null&&(i.flags&128)!==0)for(i=r.child;i!==null;){if(I=rc(i),I!==null){for(r.flags|=128,ha(y,!1),f=I.updateQueue,f!==null&&(r.updateQueue=f,r.flags|=4),r.subtreeFlags=0,f=l,l=r.child;l!==null;)y=l,i=f,y.flags&=14680066,I=y.alternate,I===null?(y.childLanes=0,y.lanes=i,y.child=null,y.subtreeFlags=0,y.memoizedProps=null,y.memoizedState=null,y.updateQueue=null,y.dependencies=null,y.stateNode=null):(y.childLanes=I.childLanes,y.lanes=I.lanes,y.child=I.child,y.subtreeFlags=0,y.deletions=null,y.memoizedProps=I.memoizedProps,y.memoizedState=I.memoizedState,y.updateQueue=I.updateQueue,y.type=I.type,i=I.dependencies,y.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),l=l.sibling;return nt(pt,pt.current&1|2),r.child}i=i.sibling}y.tail!==null&&vt()>Zr&&(r.flags|=128,f=!0,ha(y,!1),r.lanes=4194304)}else{if(!f)if(i=rc(I),i!==null){if(r.flags|=128,f=!0,l=i.updateQueue,l!==null&&(r.updateQueue=l,r.flags|=4),ha(y,!0),y.tail===null&&y.tailMode==="hidden"&&!I.alternate&&!ut)return Zt(r),null}else 2*vt()-y.renderingStartTime>Zr&&l!==1073741824&&(r.flags|=128,f=!0,ha(y,!1),r.lanes=4194304);y.isBackwards?(I.sibling=r.child,r.child=I):(l=y.last,l!==null?l.sibling=I:r.child=I,y.last=I)}return y.tail!==null?(r=y.tail,y.rendering=r,y.tail=r.sibling,y.renderingStartTime=vt(),r.sibling=null,l=pt.current,nt(pt,f?l&1|2:l&1),r):(Zt(r),null);case 22:case 23:return bf(),f=r.memoizedState!==null,i!==null&&i.memoizedState!==null!==f&&(r.flags|=8192),f&&(r.mode&1)!==0?(_n&1073741824)!==0&&(Zt(r),r.subtreeFlags&6&&(r.flags|=8192)):Zt(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function HA(i,r){switch(xd(r),r.tag){case 1:return gn(r.type)&&Vl(),i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 3:return jr(),rt(pn),rt(Vt),Qd(),i=r.flags,(i&65536)!==0&&(i&128)===0?(r.flags=i&-65537|128,r):null;case 5:return Zd(r),null;case 13:if(rt(pt),i=r.memoizedState,i!==null&&i.dehydrated!==null){if(r.alternate===null)throw Error(n(340));$r()}return i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 19:return rt(pt),null;case 4:return jr(),null;case 10:return zd(r.type._context),null;case 22:case 23:return bf(),null;case 24:return null;default:return null}}var pc=!1,Kt=!1,FA=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function Vr(i,r){var l=i.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(f){yt(i,r,f)}else l.current=null}function Sf(i,r,l){try{l()}catch(f){yt(i,r,f)}}var i0=!1;function LA(i,r){if(Md=Nl,i=Bg(),Ad(i)){if("selectionStart"in i)var l={start:i.selectionStart,end:i.selectionEnd};else e:{l=(l=i.ownerDocument)&&l.defaultView||window;var f=l.getSelection&&l.getSelection();if(f&&f.rangeCount!==0){l=f.anchorNode;var g=f.anchorOffset,y=f.focusNode;f=f.focusOffset;try{l.nodeType,y.nodeType}catch{l=null;break e}var I=0,b=-1,O=-1,$=0,oe=0,ue=i,ie=null;t:for(;;){for(var ye;ue!==l||g!==0&&ue.nodeType!==3||(b=I+g),ue!==y||f!==0&&ue.nodeType!==3||(O=I+f),ue.nodeType===3&&(I+=ue.nodeValue.length),(ye=ue.firstChild)!==null;)ie=ue,ue=ye;for(;;){if(ue===i)break t;if(ie===l&&++$===g&&(b=I),ie===y&&++oe===f&&(O=I),(ye=ue.nextSibling)!==null)break;ue=ie,ie=ue.parentNode}ue=ye}l=b===-1||O===-1?null:{start:b,end:O}}else l=null}l=l||{start:0,end:0}}else l=null;for(bd={focusedElem:i,selectionRange:l},Nl=!1,Ie=r;Ie!==null;)if(r=Ie,i=r.child,(r.subtreeFlags&1028)!==0&&i!==null)i.return=r,Ie=i;else for(;Ie!==null;){r=Ie;try{var Ee=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(Ee!==null){var Ce=Ee.memoizedProps,St=Ee.memoizedState,L=r.stateNode,B=L.getSnapshotBeforeUpdate(r.elementType===r.type?Ce:Qn(r.type,Ce),St);L.__reactInternalSnapshotBeforeUpdate=B}break;case 3:var U=r.stateNode.containerInfo;U.nodeType===1?U.textContent="":U.nodeType===9&&U.documentElement&&U.removeChild(U.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(fe){yt(r,r.return,fe)}if(i=r.sibling,i!==null){i.return=r.return,Ie=i;break}Ie=r.return}return Ee=i0,i0=!1,Ee}function pa(i,r,l){var f=r.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var g=f=f.next;do{if((g.tag&i)===i){var y=g.destroy;g.destroy=void 0,y!==void 0&&Sf(r,l,y)}g=g.next}while(g!==f)}}function gc(i,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var l=r=r.next;do{if((l.tag&i)===i){var f=l.create;l.destroy=f()}l=l.next}while(l!==r)}}function Tf(i){var r=i.ref;if(r!==null){var l=i.stateNode;switch(i.tag){case 5:i=l;break;default:i=l}typeof r=="function"?r(i):r.current=i}}function o0(i){var r=i.alternate;r!==null&&(i.alternate=null,o0(r)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(r=i.stateNode,r!==null&&(delete r[fi],delete r[ia],delete r[Bd],delete r[TA],delete r[IA])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function r0(i){return i.tag===5||i.tag===3||i.tag===4}function s0(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||r0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function If(i,r,l){var f=i.tag;if(f===5||f===6)i=i.stateNode,r?l.nodeType===8?l.parentNode.insertBefore(i,r):l.insertBefore(i,r):(l.nodeType===8?(r=l.parentNode,r.insertBefore(i,l)):(r=l,r.appendChild(i)),l=l._reactRootContainer,l!=null||r.onclick!==null||(r.onclick=jl));else if(f!==4&&(i=i.child,i!==null))for(If(i,r,l),i=i.sibling;i!==null;)If(i,r,l),i=i.sibling}function Af(i,r,l){var f=i.tag;if(f===5||f===6)i=i.stateNode,r?l.insertBefore(i,r):l.appendChild(i);else if(f!==4&&(i=i.child,i!==null))for(Af(i,r,l),i=i.sibling;i!==null;)Af(i,r,l),i=i.sibling}var xt=null,Jn=!1;function po(i,r,l){for(l=l.child;l!==null;)a0(i,r,l),l=l.sibling}function a0(i,r,l){if(di&&typeof di.onCommitFiberUnmount=="function")try{di.onCommitFiberUnmount(Rl,l)}catch{}switch(l.tag){case 5:Kt||Vr(l,r);case 6:var f=xt,g=Jn;xt=null,po(i,r,l),xt=f,Jn=g,xt!==null&&(Jn?(i=xt,l=l.stateNode,i.nodeType===8?i.parentNode.removeChild(l):i.removeChild(l)):xt.removeChild(l.stateNode));break;case 18:xt!==null&&(Jn?(i=xt,l=l.stateNode,i.nodeType===8?Nd(i.parentNode,l):i.nodeType===1&&Nd(i,l),js(i)):Nd(xt,l.stateNode));break;case 4:f=xt,g=Jn,xt=l.stateNode.containerInfo,Jn=!0,po(i,r,l),xt=f,Jn=g;break;case 0:case 11:case 14:case 15:if(!Kt&&(f=l.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){g=f=f.next;do{var y=g,I=y.destroy;y=y.tag,I!==void 0&&((y&2)!==0||(y&4)!==0)&&Sf(l,r,I),g=g.next}while(g!==f)}po(i,r,l);break;case 1:if(!Kt&&(Vr(l,r),f=l.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=l.memoizedProps,f.state=l.memoizedState,f.componentWillUnmount()}catch(b){yt(l,r,b)}po(i,r,l);break;case 21:po(i,r,l);break;case 22:l.mode&1?(Kt=(f=Kt)||l.memoizedState!==null,po(i,r,l),Kt=f):po(i,r,l);break;default:po(i,r,l)}}function l0(i){var r=i.updateQueue;if(r!==null){i.updateQueue=null;var l=i.stateNode;l===null&&(l=i.stateNode=new FA),r.forEach(function(f){var g=XA.bind(null,i,f);l.has(f)||(l.add(f),f.then(g,g))})}}function ei(i,r){var l=r.deletions;if(l!==null)for(var f=0;f<l.length;f++){var g=l[f];try{var y=i,I=r,b=I;e:for(;b!==null;){switch(b.tag){case 5:xt=b.stateNode,Jn=!1;break e;case 3:xt=b.stateNode.containerInfo,Jn=!0;break e;case 4:xt=b.stateNode.containerInfo,Jn=!0;break e}b=b.return}if(xt===null)throw Error(n(160));a0(y,I,g),xt=null,Jn=!1;var O=g.alternate;O!==null&&(O.return=null),g.return=null}catch($){yt(g,r,$)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)c0(r,i),r=r.sibling}function c0(i,r){var l=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(ei(r,i),gi(i),f&4){try{pa(3,i,i.return),gc(3,i)}catch(Ce){yt(i,i.return,Ce)}try{pa(5,i,i.return)}catch(Ce){yt(i,i.return,Ce)}}break;case 1:ei(r,i),gi(i),f&512&&l!==null&&Vr(l,l.return);break;case 5:if(ei(r,i),gi(i),f&512&&l!==null&&Vr(l,l.return),i.flags&32){var g=i.stateNode;try{Bs(g,"")}catch(Ce){yt(i,i.return,Ce)}}if(f&4&&(g=i.stateNode,g!=null)){var y=i.memoizedProps,I=l!==null?l.memoizedProps:y,b=i.type,O=i.updateQueue;if(i.updateQueue=null,O!==null)try{b==="input"&&y.type==="radio"&&y.name!=null&&ct(g,y),Qu(b,I);var $=Qu(b,y);for(I=0;I<O.length;I+=2){var oe=O[I],ue=O[I+1];oe==="style"?zp(g,ue):oe==="dangerouslySetInnerHTML"?Wp(g,ue):oe==="children"?Bs(g,ue):_(g,oe,ue,$)}switch(b){case"input":Ct(g,y);break;case"textarea":Os(g,y);break;case"select":var ie=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!y.multiple;var ye=y.value;ye!=null?wn(g,!!y.multiple,ye,!1):ie!==!!y.multiple&&(y.defaultValue!=null?wn(g,!!y.multiple,y.defaultValue,!0):wn(g,!!y.multiple,y.multiple?[]:"",!1))}g[ia]=y}catch(Ce){yt(i,i.return,Ce)}}break;case 6:if(ei(r,i),gi(i),f&4){if(i.stateNode===null)throw Error(n(162));g=i.stateNode,y=i.memoizedProps;try{g.nodeValue=y}catch(Ce){yt(i,i.return,Ce)}}break;case 3:if(ei(r,i),gi(i),f&4&&l!==null&&l.memoizedState.isDehydrated)try{js(r.containerInfo)}catch(Ce){yt(i,i.return,Ce)}break;case 4:ei(r,i),gi(i);break;case 13:ei(r,i),gi(i),g=i.child,g.flags&8192&&(y=g.memoizedState!==null,g.stateNode.isHidden=y,!y||g.alternate!==null&&g.alternate.memoizedState!==null||(Cf=vt())),f&4&&l0(i);break;case 22:if(oe=l!==null&&l.memoizedState!==null,i.mode&1?(Kt=($=Kt)||oe,ei(r,i),Kt=$):ei(r,i),gi(i),f&8192){if($=i.memoizedState!==null,(i.stateNode.isHidden=$)&&!oe&&(i.mode&1)!==0)for(Ie=i,oe=i.child;oe!==null;){for(ue=Ie=oe;Ie!==null;){switch(ie=Ie,ye=ie.child,ie.tag){case 0:case 11:case 14:case 15:pa(4,ie,ie.return);break;case 1:Vr(ie,ie.return);var Ee=ie.stateNode;if(typeof Ee.componentWillUnmount=="function"){f=ie,l=ie.return;try{r=f,Ee.props=r.memoizedProps,Ee.state=r.memoizedState,Ee.componentWillUnmount()}catch(Ce){yt(f,l,Ce)}}break;case 5:Vr(ie,ie.return);break;case 22:if(ie.memoizedState!==null){f0(ue);continue}}ye!==null?(ye.return=ie,Ie=ye):f0(ue)}oe=oe.sibling}e:for(oe=null,ue=i;;){if(ue.tag===5){if(oe===null){oe=ue;try{g=ue.stateNode,$?(y=g.style,typeof y.setProperty=="function"?y.setProperty("display","none","important"):y.display="none"):(b=ue.stateNode,O=ue.memoizedProps.style,I=O!=null&&O.hasOwnProperty("display")?O.display:null,b.style.display=Yp("display",I))}catch(Ce){yt(i,i.return,Ce)}}}else if(ue.tag===6){if(oe===null)try{ue.stateNode.nodeValue=$?"":ue.memoizedProps}catch(Ce){yt(i,i.return,Ce)}}else if((ue.tag!==22&&ue.tag!==23||ue.memoizedState===null||ue===i)&&ue.child!==null){ue.child.return=ue,ue=ue.child;continue}if(ue===i)break e;for(;ue.sibling===null;){if(ue.return===null||ue.return===i)break e;oe===ue&&(oe=null),ue=ue.return}oe===ue&&(oe=null),ue.sibling.return=ue.return,ue=ue.sibling}}break;case 19:ei(r,i),gi(i),f&4&&l0(i);break;case 21:break;default:ei(r,i),gi(i)}}function gi(i){var r=i.flags;if(r&2){try{e:{for(var l=i.return;l!==null;){if(r0(l)){var f=l;break e}l=l.return}throw Error(n(160))}switch(f.tag){case 5:var g=f.stateNode;f.flags&32&&(Bs(g,""),f.flags&=-33);var y=s0(i);Af(i,y,g);break;case 3:case 4:var I=f.stateNode.containerInfo,b=s0(i);If(i,b,I);break;default:throw Error(n(161))}}catch(O){yt(i,i.return,O)}i.flags&=-3}r&4096&&(i.flags&=-4097)}function xA(i,r,l){Ie=i,u0(i)}function u0(i,r,l){for(var f=(i.mode&1)!==0;Ie!==null;){var g=Ie,y=g.child;if(g.tag===22&&f){var I=g.memoizedState!==null||pc;if(!I){var b=g.alternate,O=b!==null&&b.memoizedState!==null||Kt;b=pc;var $=Kt;if(pc=I,(Kt=O)&&!$)for(Ie=g;Ie!==null;)I=Ie,O=I.child,I.tag===22&&I.memoizedState!==null?h0(g):O!==null?(O.return=I,Ie=O):h0(g);for(;y!==null;)Ie=y,u0(y),y=y.sibling;Ie=g,pc=b,Kt=$}d0(i)}else(g.subtreeFlags&8772)!==0&&y!==null?(y.return=g,Ie=y):d0(i)}}function d0(i){for(;Ie!==null;){var r=Ie;if((r.flags&8772)!==0){var l=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:Kt||gc(5,r);break;case 1:var f=r.stateNode;if(r.flags&4&&!Kt)if(l===null)f.componentDidMount();else{var g=r.elementType===r.type?l.memoizedProps:Qn(r.type,l.memoizedProps);f.componentDidUpdate(g,l.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var y=r.updateQueue;y!==null&&fm(r,y,f);break;case 3:var I=r.updateQueue;if(I!==null){if(l=null,r.child!==null)switch(r.child.tag){case 5:l=r.child.stateNode;break;case 1:l=r.child.stateNode}fm(r,I,l)}break;case 5:var b=r.stateNode;if(l===null&&r.flags&4){l=b;var O=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&l.focus();break;case"img":O.src&&(l.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var $=r.alternate;if($!==null){var oe=$.memoizedState;if(oe!==null){var ue=oe.dehydrated;ue!==null&&js(ue)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Kt||r.flags&512&&Tf(r)}catch(ie){yt(r,r.return,ie)}}if(r===i){Ie=null;break}if(l=r.sibling,l!==null){l.return=r.return,Ie=l;break}Ie=r.return}}function f0(i){for(;Ie!==null;){var r=Ie;if(r===i){Ie=null;break}var l=r.sibling;if(l!==null){l.return=r.return,Ie=l;break}Ie=r.return}}function h0(i){for(;Ie!==null;){var r=Ie;try{switch(r.tag){case 0:case 11:case 15:var l=r.return;try{gc(4,r)}catch(O){yt(r,l,O)}break;case 1:var f=r.stateNode;if(typeof f.componentDidMount=="function"){var g=r.return;try{f.componentDidMount()}catch(O){yt(r,g,O)}}var y=r.return;try{Tf(r)}catch(O){yt(r,y,O)}break;case 5:var I=r.return;try{Tf(r)}catch(O){yt(r,I,O)}}}catch(O){yt(r,r.return,O)}if(r===i){Ie=null;break}var b=r.sibling;if(b!==null){b.return=r.return,Ie=b;break}Ie=r.return}}var UA=Math.ceil,mc=M.ReactCurrentDispatcher,wf=M.ReactCurrentOwner,Ln=M.ReactCurrentBatchConfig,ze=0,Nt=null,wt=null,Ut=0,_n=0,qr=lo(0),_t=0,ga=null,qo=0,yc=0,Ef=0,ma=null,yn=null,Cf=0,Zr=1/0,Oi=null,vc=!1,Pf=null,go=null,Sc=!1,mo=null,Tc=0,ya=0,_f=null,Ic=-1,Ac=0;function rn(){return(ze&6)!==0?vt():Ic!==-1?Ic:Ic=vt()}function yo(i){return(i.mode&1)===0?1:(ze&2)!==0&&Ut!==0?Ut&-Ut:wA.transition!==null?(Ac===0&&(Ac=sg()),Ac):(i=Ze,i!==0||(i=window.event,i=i===void 0?16:gg(i.type)),i)}function ti(i,r,l,f){if(50<ya)throw ya=0,_f=null,Error(n(185));Gs(i,l,f),((ze&2)===0||i!==Nt)&&(i===Nt&&((ze&2)===0&&(yc|=l),_t===4&&vo(i,Ut)),vn(i,f),l===1&&ze===0&&(r.mode&1)===0&&(Zr=vt()+500,Zl&&uo()))}function vn(i,r){var l=i.callbackNode;wI(i,r);var f=bl(i,i===Nt?Ut:0);if(f===0)l!==null&&ig(l),i.callbackNode=null,i.callbackPriority=0;else if(r=f&-f,i.callbackPriority!==r){if(l!=null&&ig(l),r===1)i.tag===0?AA(g0.bind(null,i)):em(g0.bind(null,i)),vA(function(){(ze&6)===0&&uo()}),l=null;else{switch(ag(f)){case 1:l=rd;break;case 4:l=og;break;case 16:l=_l;break;case 536870912:l=rg;break;default:l=_l}l=w0(l,p0.bind(null,i))}i.callbackPriority=r,i.callbackNode=l}}function p0(i,r){if(Ic=-1,Ac=0,(ze&6)!==0)throw Error(n(327));var l=i.callbackNode;if(Kr()&&i.callbackNode!==l)return null;var f=bl(i,i===Nt?Ut:0);if(f===0)return null;if((f&30)!==0||(f&i.expiredLanes)!==0||r)r=wc(i,f);else{r=f;var g=ze;ze|=2;var y=y0();(Nt!==i||Ut!==r)&&(Oi=null,Zr=vt()+500,Ko(i,r));do try{WA();break}catch(b){m0(i,b)}while(!0);Yd(),mc.current=y,ze=g,wt!==null?r=0:(Nt=null,Ut=0,r=_t)}if(r!==0){if(r===2&&(g=sd(i),g!==0&&(f=g,r=Rf(i,g))),r===1)throw l=ga,Ko(i,0),vo(i,f),vn(i,vt()),l;if(r===6)vo(i,f);else{if(g=i.current.alternate,(f&30)===0&&!GA(g)&&(r=wc(i,f),r===2&&(y=sd(i),y!==0&&(f=y,r=Rf(i,y))),r===1))throw l=ga,Ko(i,0),vo(i,f),vn(i,vt()),l;switch(i.finishedWork=g,i.finishedLanes=f,r){case 0:case 1:throw Error(n(345));case 2:Qo(i,yn,Oi);break;case 3:if(vo(i,f),(f&130023424)===f&&(r=Cf+500-vt(),10<r)){if(bl(i,0)!==0)break;if(g=i.suspendedLanes,(g&f)!==f){rn(),i.pingedLanes|=i.suspendedLanes&g;break}i.timeoutHandle=Od(Qo.bind(null,i,yn,Oi),r);break}Qo(i,yn,Oi);break;case 4:if(vo(i,f),(f&4194240)===f)break;for(r=i.eventTimes,g=-1;0<f;){var I=31-qn(f);y=1<<I,I=r[I],I>g&&(g=I),f&=~y}if(f=g,f=vt()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*UA(f/1960))-f,10<f){i.timeoutHandle=Od(Qo.bind(null,i,yn,Oi),f);break}Qo(i,yn,Oi);break;case 5:Qo(i,yn,Oi);break;default:throw Error(n(329))}}}return vn(i,vt()),i.callbackNode===l?p0.bind(null,i):null}function Rf(i,r){var l=ma;return i.current.memoizedState.isDehydrated&&(Ko(i,r).flags|=256),i=wc(i,r),i!==2&&(r=yn,yn=l,r!==null&&kf(r)),i}function kf(i){yn===null?yn=i:yn.push.apply(yn,i)}function GA(i){for(var r=i;;){if(r.flags&16384){var l=r.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var f=0;f<l.length;f++){var g=l[f],y=g.getSnapshot;g=g.value;try{if(!Zn(y(),g))return!1}catch{return!1}}}if(l=r.child,r.subtreeFlags&16384&&l!==null)l.return=r,r=l;else{if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function vo(i,r){for(r&=~Ef,r&=~yc,i.suspendedLanes|=r,i.pingedLanes&=~r,i=i.expirationTimes;0<r;){var l=31-qn(r),f=1<<l;i[l]=-1,r&=~f}}function g0(i){if((ze&6)!==0)throw Error(n(327));Kr();var r=bl(i,0);if((r&1)===0)return vn(i,vt()),null;var l=wc(i,r);if(i.tag!==0&&l===2){var f=sd(i);f!==0&&(r=f,l=Rf(i,f))}if(l===1)throw l=ga,Ko(i,0),vo(i,r),vn(i,vt()),l;if(l===6)throw Error(n(345));return i.finishedWork=i.current.alternate,i.finishedLanes=r,Qo(i,yn,Oi),vn(i,vt()),null}function Mf(i,r){var l=ze;ze|=1;try{return i(r)}finally{ze=l,ze===0&&(Zr=vt()+500,Zl&&uo())}}function Zo(i){mo!==null&&mo.tag===0&&(ze&6)===0&&Kr();var r=ze;ze|=1;var l=Ln.transition,f=Ze;try{if(Ln.transition=null,Ze=1,i)return i()}finally{Ze=f,Ln.transition=l,ze=r,(ze&6)===0&&uo()}}function bf(){_n=qr.current,rt(qr)}function Ko(i,r){i.finishedWork=null,i.finishedLanes=0;var l=i.timeoutHandle;if(l!==-1&&(i.timeoutHandle=-1,yA(l)),wt!==null)for(l=wt.return;l!==null;){var f=l;switch(xd(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&Vl();break;case 3:jr(),rt(pn),rt(Vt),Qd();break;case 5:Zd(f);break;case 4:jr();break;case 13:rt(pt);break;case 19:rt(pt);break;case 10:zd(f.type._context);break;case 22:case 23:bf()}l=l.return}if(Nt=i,wt=i=So(i.current,null),Ut=_n=r,_t=0,ga=null,Ef=yc=qo=0,yn=ma=null,jo!==null){for(r=0;r<jo.length;r++)if(l=jo[r],f=l.interleaved,f!==null){l.interleaved=null;var g=f.next,y=l.pending;if(y!==null){var I=y.next;y.next=g,f.next=I}l.pending=f}jo=null}return i}function m0(i,r){do{var l=wt;try{if(Yd(),sc.current=uc,ac){for(var f=gt.memoizedState;f!==null;){var g=f.queue;g!==null&&(g.pending=null),f=f.next}ac=!1}if(Vo=0,Ot=Pt=gt=null,ca=!1,ua=0,wf.current=null,l===null||l.return===null){_t=1,ga=r,wt=null;break}e:{var y=i,I=l.return,b=l,O=r;if(r=Ut,b.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var $=O,oe=b,ue=oe.tag;if((oe.mode&1)===0&&(ue===0||ue===11||ue===15)){var ie=oe.alternate;ie?(oe.updateQueue=ie.updateQueue,oe.memoizedState=ie.memoizedState,oe.lanes=ie.lanes):(oe.updateQueue=null,oe.memoizedState=null)}var ye=Gm(I);if(ye!==null){ye.flags&=-257,$m(ye,I,b,y,r),ye.mode&1&&Um(y,$,r),r=ye,O=$;var Ee=r.updateQueue;if(Ee===null){var Ce=new Set;Ce.add(O),r.updateQueue=Ce}else Ee.add(O);break e}else{if((r&1)===0){Um(y,$,r),Df();break e}O=Error(n(426))}}else if(ut&&b.mode&1){var St=Gm(I);if(St!==null){(St.flags&65536)===0&&(St.flags|=256),$m(St,I,b,y,r),$d(Xr(O,b));break e}}y=O=Xr(O,b),_t!==4&&(_t=2),ma===null?ma=[y]:ma.push(y),y=I;do{switch(y.tag){case 3:y.flags|=65536,r&=-r,y.lanes|=r;var L=Lm(y,O,r);dm(y,L);break e;case 1:b=O;var B=y.type,U=y.stateNode;if((y.flags&128)===0&&(typeof B.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(go===null||!go.has(U)))){y.flags|=65536,r&=-r,y.lanes|=r;var fe=xm(y,b,r);dm(y,fe);break e}}y=y.return}while(y!==null)}S0(l)}catch(Re){r=Re,wt===l&&l!==null&&(wt=l=l.return);continue}break}while(!0)}function y0(){var i=mc.current;return mc.current=uc,i===null?uc:i}function Df(){(_t===0||_t===3||_t===2)&&(_t=4),Nt===null||(qo&268435455)===0&&(yc&268435455)===0||vo(Nt,Ut)}function wc(i,r){var l=ze;ze|=2;var f=y0();(Nt!==i||Ut!==r)&&(Oi=null,Ko(i,r));do try{$A();break}catch(g){m0(i,g)}while(!0);if(Yd(),ze=l,mc.current=f,wt!==null)throw Error(n(261));return Nt=null,Ut=0,_t}function $A(){for(;wt!==null;)v0(wt)}function WA(){for(;wt!==null&&!pI();)v0(wt)}function v0(i){var r=A0(i.alternate,i,_n);i.memoizedProps=i.pendingProps,r===null?S0(i):wt=r,wf.current=null}function S0(i){var r=i;do{var l=r.alternate;if(i=r.return,(r.flags&32768)===0){if(l=BA(l,r,_n),l!==null){wt=l;return}}else{if(l=HA(l,r),l!==null){l.flags&=32767,wt=l;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{_t=6,wt=null;return}}if(r=r.sibling,r!==null){wt=r;return}wt=r=i}while(r!==null);_t===0&&(_t=5)}function Qo(i,r,l){var f=Ze,g=Ln.transition;try{Ln.transition=null,Ze=1,YA(i,r,l,f)}finally{Ln.transition=g,Ze=f}return null}function YA(i,r,l,f){do Kr();while(mo!==null);if((ze&6)!==0)throw Error(n(327));l=i.finishedWork;var g=i.finishedLanes;if(l===null)return null;if(i.finishedWork=null,i.finishedLanes=0,l===i.current)throw Error(n(177));i.callbackNode=null,i.callbackPriority=0;var y=l.lanes|l.childLanes;if(EI(i,y),i===Nt&&(wt=Nt=null,Ut=0),(l.subtreeFlags&2064)===0&&(l.flags&2064)===0||Sc||(Sc=!0,w0(_l,function(){return Kr(),null})),y=(l.flags&15990)!==0,(l.subtreeFlags&15990)!==0||y){y=Ln.transition,Ln.transition=null;var I=Ze;Ze=1;var b=ze;ze|=4,wf.current=null,LA(i,l),c0(l,i),uA(bd),Nl=!!Md,bd=Md=null,i.current=l,xA(l),gI(),ze=b,Ze=I,Ln.transition=y}else i.current=l;if(Sc&&(Sc=!1,mo=i,Tc=g),y=i.pendingLanes,y===0&&(go=null),vI(l.stateNode),vn(i,vt()),r!==null)for(f=i.onRecoverableError,l=0;l<r.length;l++)g=r[l],f(g.value,{componentStack:g.stack,digest:g.digest});if(vc)throw vc=!1,i=Pf,Pf=null,i;return(Tc&1)!==0&&i.tag!==0&&Kr(),y=i.pendingLanes,(y&1)!==0?i===_f?ya++:(ya=0,_f=i):ya=0,uo(),null}function Kr(){if(mo!==null){var i=ag(Tc),r=Ln.transition,l=Ze;try{if(Ln.transition=null,Ze=16>i?16:i,mo===null)var f=!1;else{if(i=mo,mo=null,Tc=0,(ze&6)!==0)throw Error(n(331));var g=ze;for(ze|=4,Ie=i.current;Ie!==null;){var y=Ie,I=y.child;if((Ie.flags&16)!==0){var b=y.deletions;if(b!==null){for(var O=0;O<b.length;O++){var $=b[O];for(Ie=$;Ie!==null;){var oe=Ie;switch(oe.tag){case 0:case 11:case 15:pa(8,oe,y)}var ue=oe.child;if(ue!==null)ue.return=oe,Ie=ue;else for(;Ie!==null;){oe=Ie;var ie=oe.sibling,ye=oe.return;if(o0(oe),oe===$){Ie=null;break}if(ie!==null){ie.return=ye,Ie=ie;break}Ie=ye}}}var Ee=y.alternate;if(Ee!==null){var Ce=Ee.child;if(Ce!==null){Ee.child=null;do{var St=Ce.sibling;Ce.sibling=null,Ce=St}while(Ce!==null)}}Ie=y}}if((y.subtreeFlags&2064)!==0&&I!==null)I.return=y,Ie=I;else e:for(;Ie!==null;){if(y=Ie,(y.flags&2048)!==0)switch(y.tag){case 0:case 11:case 15:pa(9,y,y.return)}var L=y.sibling;if(L!==null){L.return=y.return,Ie=L;break e}Ie=y.return}}var B=i.current;for(Ie=B;Ie!==null;){I=Ie;var U=I.child;if((I.subtreeFlags&2064)!==0&&U!==null)U.return=I,Ie=U;else e:for(I=B;Ie!==null;){if(b=Ie,(b.flags&2048)!==0)try{switch(b.tag){case 0:case 11:case 15:gc(9,b)}}catch(Re){yt(b,b.return,Re)}if(b===I){Ie=null;break e}var fe=b.sibling;if(fe!==null){fe.return=b.return,Ie=fe;break e}Ie=b.return}}if(ze=g,uo(),di&&typeof di.onPostCommitFiberRoot=="function")try{di.onPostCommitFiberRoot(Rl,i)}catch{}f=!0}return f}finally{Ze=l,Ln.transition=r}}return!1}function T0(i,r,l){r=Xr(l,r),r=Lm(i,r,1),i=ho(i,r,1),r=rn(),i!==null&&(Gs(i,1,r),vn(i,r))}function yt(i,r,l){if(i.tag===3)T0(i,i,l);else for(;r!==null;){if(r.tag===3){T0(r,i,l);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(go===null||!go.has(f))){i=Xr(l,i),i=xm(r,i,1),r=ho(r,i,1),i=rn(),r!==null&&(Gs(r,1,i),vn(r,i));break}}r=r.return}}function zA(i,r,l){var f=i.pingCache;f!==null&&f.delete(r),r=rn(),i.pingedLanes|=i.suspendedLanes&l,Nt===i&&(Ut&l)===l&&(_t===4||_t===3&&(Ut&130023424)===Ut&&500>vt()-Cf?Ko(i,0):Ef|=l),vn(i,r)}function I0(i,r){r===0&&((i.mode&1)===0?r=1:(r=Ml,Ml<<=1,(Ml&130023424)===0&&(Ml=4194304)));var l=rn();i=Mi(i,r),i!==null&&(Gs(i,r,l),vn(i,l))}function jA(i){var r=i.memoizedState,l=0;r!==null&&(l=r.retryLane),I0(i,l)}function XA(i,r){var l=0;switch(i.tag){case 13:var f=i.stateNode,g=i.memoizedState;g!==null&&(l=g.retryLane);break;case 19:f=i.stateNode;break;default:throw Error(n(314))}f!==null&&f.delete(r),I0(i,l)}var A0;A0=function(i,r,l){if(i!==null)if(i.memoizedProps!==r.pendingProps||pn.current)mn=!0;else{if((i.lanes&l)===0&&(r.flags&128)===0)return mn=!1,NA(i,r,l);mn=(i.flags&131072)!==0}else mn=!1,ut&&(r.flags&1048576)!==0&&tm(r,Ql,r.index);switch(r.lanes=0,r.tag){case 2:var f=r.type;hc(i,r),i=r.pendingProps;var g=xr(r,Vt.current);zr(r,l),g=tf(null,r,f,i,g,l);var y=nf();return r.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,gn(f)?(y=!0,ql(r)):y=!1,r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,Vd(r),g.updater=dc,r.stateNode=g,g._reactInternals=r,cf(r,f,i,l),r=hf(null,r,f,!0,y,l)):(r.tag=0,ut&&y&&Ld(r),on(null,r,g,l),r=r.child),r;case 16:f=r.elementType;e:{switch(hc(i,r),i=r.pendingProps,g=f._init,f=g(f._payload),r.type=f,g=r.tag=qA(f),i=Qn(f,i),g){case 0:r=ff(null,r,f,i,l);break e;case 1:r=Vm(null,r,f,i,l);break e;case 11:r=Wm(null,r,f,i,l);break e;case 14:r=Ym(null,r,f,Qn(f.type,i),l);break e}throw Error(n(306,f,""))}return r;case 0:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:Qn(f,g),ff(i,r,f,g,l);case 1:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:Qn(f,g),Vm(i,r,f,g,l);case 3:e:{if(qm(r),i===null)throw Error(n(387));f=r.pendingProps,y=r.memoizedState,g=y.element,um(i,r),oc(r,f,null,l);var I=r.memoizedState;if(f=I.element,y.isDehydrated)if(y={element:f,isDehydrated:!1,cache:I.cache,pendingSuspenseBoundaries:I.pendingSuspenseBoundaries,transitions:I.transitions},r.updateQueue.baseState=y,r.memoizedState=y,r.flags&256){g=Xr(Error(n(423)),r),r=Zm(i,r,f,l,g);break e}else if(f!==g){g=Xr(Error(n(424)),r),r=Zm(i,r,f,l,g);break e}else for(Pn=ao(r.stateNode.containerInfo.firstChild),Cn=r,ut=!0,Kn=null,l=lm(r,null,f,l),r.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if($r(),f===g){r=Di(i,r,l);break e}on(i,r,f,l)}r=r.child}return r;case 5:return hm(r),i===null&&Gd(r),f=r.type,g=r.pendingProps,y=i!==null?i.memoizedProps:null,I=g.children,Dd(f,g)?I=null:y!==null&&Dd(f,y)&&(r.flags|=32),Xm(i,r),on(i,r,I,l),r.child;case 6:return i===null&&Gd(r),null;case 13:return Km(i,r,l);case 4:return qd(r,r.stateNode.containerInfo),f=r.pendingProps,i===null?r.child=Wr(r,null,f,l):on(i,r,f,l),r.child;case 11:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:Qn(f,g),Wm(i,r,f,g,l);case 7:return on(i,r,r.pendingProps,l),r.child;case 8:return on(i,r,r.pendingProps.children,l),r.child;case 12:return on(i,r,r.pendingProps.children,l),r.child;case 10:e:{if(f=r.type._context,g=r.pendingProps,y=r.memoizedProps,I=g.value,nt(tc,f._currentValue),f._currentValue=I,y!==null)if(Zn(y.value,I)){if(y.children===g.children&&!pn.current){r=Di(i,r,l);break e}}else for(y=r.child,y!==null&&(y.return=r);y!==null;){var b=y.dependencies;if(b!==null){I=y.child;for(var O=b.firstContext;O!==null;){if(O.context===f){if(y.tag===1){O=bi(-1,l&-l),O.tag=2;var $=y.updateQueue;if($!==null){$=$.shared;var oe=$.pending;oe===null?O.next=O:(O.next=oe.next,oe.next=O),$.pending=O}}y.lanes|=l,O=y.alternate,O!==null&&(O.lanes|=l),jd(y.return,l,r),b.lanes|=l;break}O=O.next}}else if(y.tag===10)I=y.type===r.type?null:y.child;else if(y.tag===18){if(I=y.return,I===null)throw Error(n(341));I.lanes|=l,b=I.alternate,b!==null&&(b.lanes|=l),jd(I,l,r),I=y.sibling}else I=y.child;if(I!==null)I.return=y;else for(I=y;I!==null;){if(I===r){I=null;break}if(y=I.sibling,y!==null){y.return=I.return,I=y;break}I=I.return}y=I}on(i,r,g.children,l),r=r.child}return r;case 9:return g=r.type,f=r.pendingProps.children,zr(r,l),g=Hn(g),f=f(g),r.flags|=1,on(i,r,f,l),r.child;case 14:return f=r.type,g=Qn(f,r.pendingProps),g=Qn(f.type,g),Ym(i,r,f,g,l);case 15:return zm(i,r,r.type,r.pendingProps,l);case 17:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:Qn(f,g),hc(i,r),r.tag=1,gn(f)?(i=!0,ql(r)):i=!1,zr(r,l),Hm(r,f,g),cf(r,f,g,l),hf(null,r,f,!0,i,l);case 19:return Jm(i,r,l);case 22:return jm(i,r,l)}throw Error(n(156,r.tag))};function w0(i,r){return ng(i,r)}function VA(i,r,l,f){this.tag=i,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function xn(i,r,l,f){return new VA(i,r,l,f)}function Of(i){return i=i.prototype,!(!i||!i.isReactComponent)}function qA(i){if(typeof i=="function")return Of(i)?1:0;if(i!=null){if(i=i.$$typeof,i===Z)return 11;if(i===ee)return 14}return 2}function So(i,r){var l=i.alternate;return l===null?(l=xn(i.tag,r,i.key,i.mode),l.elementType=i.elementType,l.type=i.type,l.stateNode=i.stateNode,l.alternate=i,i.alternate=l):(l.pendingProps=r,l.type=i.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=i.flags&14680064,l.childLanes=i.childLanes,l.lanes=i.lanes,l.child=i.child,l.memoizedProps=i.memoizedProps,l.memoizedState=i.memoizedState,l.updateQueue=i.updateQueue,r=i.dependencies,l.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},l.sibling=i.sibling,l.index=i.index,l.ref=i.ref,l}function Ec(i,r,l,f,g,y){var I=2;if(f=i,typeof i=="function")Of(i)&&(I=1);else if(typeof i=="string")I=5;else e:switch(i){case R:return Jo(l.children,g,y,r);case H:I=8,g|=8;break;case G:return i=xn(12,l,r,g|2),i.elementType=G,i.lanes=y,i;case W:return i=xn(13,l,r,g),i.elementType=W,i.lanes=y,i;case j:return i=xn(19,l,r,g),i.elementType=j,i.lanes=y,i;case ae:return Cc(l,g,y,r);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case F:I=10;break e;case Y:I=9;break e;case Z:I=11;break e;case ee:I=14;break e;case se:I=16,f=null;break e}throw Error(n(130,i==null?i:typeof i,""))}return r=xn(I,l,r,g),r.elementType=i,r.type=f,r.lanes=y,r}function Jo(i,r,l,f){return i=xn(7,i,f,r),i.lanes=l,i}function Cc(i,r,l,f){return i=xn(22,i,f,r),i.elementType=ae,i.lanes=l,i.stateNode={isHidden:!1},i}function Nf(i,r,l){return i=xn(6,i,null,r),i.lanes=l,i}function Bf(i,r,l){return r=xn(4,i.children!==null?i.children:[],i.key,r),r.lanes=l,r.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},r}function ZA(i,r,l,f,g){this.tag=r,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ad(0),this.expirationTimes=ad(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ad(0),this.identifierPrefix=f,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function Hf(i,r,l,f,g,y,I,b,O){return i=new ZA(i,r,l,b,O),r===1?(r=1,y===!0&&(r|=8)):r=0,y=xn(3,null,null,r),i.current=y,y.stateNode=i,y.memoizedState={element:f,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},Vd(y),i}function KA(i,r,l){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:k,key:f==null?null:""+f,children:i,containerInfo:r,implementation:l}}function E0(i){if(!i)return co;i=i._reactInternals;e:{if(Go(i)!==i||i.tag!==1)throw Error(n(170));var r=i;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(gn(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(i.tag===1){var l=i.type;if(gn(l))return Qg(i,l,r)}return r}function C0(i,r,l,f,g,y,I,b,O){return i=Hf(l,f,!0,i,g,y,I,b,O),i.context=E0(null),l=i.current,f=rn(),g=yo(l),y=bi(f,g),y.callback=r??null,ho(l,y,g),i.current.lanes=g,Gs(i,g,f),vn(i,f),i}function Pc(i,r,l,f){var g=r.current,y=rn(),I=yo(g);return l=E0(l),r.context===null?r.context=l:r.pendingContext=l,r=bi(y,I),r.payload={element:i},f=f===void 0?null:f,f!==null&&(r.callback=f),i=ho(g,r,I),i!==null&&(ti(i,g,I,y),ic(i,g,I)),I}function _c(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function P0(i,r){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var l=i.retryLane;i.retryLane=l!==0&&l<r?l:r}}function Ff(i,r){P0(i,r),(i=i.alternate)&&P0(i,r)}function QA(){return null}var _0=typeof reportError=="function"?reportError:function(i){console.error(i)};function Lf(i){this._internalRoot=i}Rc.prototype.render=Lf.prototype.render=function(i){var r=this._internalRoot;if(r===null)throw Error(n(409));Pc(i,r,null,null)},Rc.prototype.unmount=Lf.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var r=i.containerInfo;Zo(function(){Pc(null,i,null,null)}),r[Pi]=null}};function Rc(i){this._internalRoot=i}Rc.prototype.unstable_scheduleHydration=function(i){if(i){var r=ug();i={blockedOn:null,target:i,priority:r};for(var l=0;l<oo.length&&r!==0&&r<oo[l].priority;l++);oo.splice(l,0,i),l===0&&hg(i)}};function xf(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function kc(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function R0(){}function JA(i,r,l,f,g){if(g){if(typeof f=="function"){var y=f;f=function(){var $=_c(I);y.call($)}}var I=C0(r,f,i,0,null,!1,!1,"",R0);return i._reactRootContainer=I,i[Pi]=I.current,ta(i.nodeType===8?i.parentNode:i),Zo(),I}for(;g=i.lastChild;)i.removeChild(g);if(typeof f=="function"){var b=f;f=function(){var $=_c(O);b.call($)}}var O=Hf(i,0,!1,null,null,!1,!1,"",R0);return i._reactRootContainer=O,i[Pi]=O.current,ta(i.nodeType===8?i.parentNode:i),Zo(function(){Pc(r,O,l,f)}),O}function Mc(i,r,l,f,g){var y=l._reactRootContainer;if(y){var I=y;if(typeof g=="function"){var b=g;g=function(){var O=_c(I);b.call(O)}}Pc(r,I,i,g)}else I=JA(l,r,i,g,f);return _c(I)}lg=function(i){switch(i.tag){case 3:var r=i.stateNode;if(r.current.memoizedState.isDehydrated){var l=Us(r.pendingLanes);l!==0&&(ld(r,l|1),vn(r,vt()),(ze&6)===0&&(Zr=vt()+500,uo()))}break;case 13:Zo(function(){var f=Mi(i,1);if(f!==null){var g=rn();ti(f,i,1,g)}}),Ff(i,1)}},cd=function(i){if(i.tag===13){var r=Mi(i,134217728);if(r!==null){var l=rn();ti(r,i,134217728,l)}Ff(i,134217728)}},cg=function(i){if(i.tag===13){var r=yo(i),l=Mi(i,r);if(l!==null){var f=rn();ti(l,i,r,f)}Ff(i,r)}},ug=function(){return Ze},dg=function(i,r){var l=Ze;try{return Ze=i,r()}finally{Ze=l}},td=function(i,r,l){switch(r){case"input":if(Ct(i,l),r=l.name,l.type==="radio"&&r!=null){for(l=i;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<l.length;r++){var f=l[r];if(f!==i&&f.form===i.form){var g=Xl(f);if(!g)throw Error(n(90));K(f),Ct(f,g)}}}break;case"textarea":Os(i,l);break;case"select":r=l.value,r!=null&&wn(i,!!l.multiple,r,!1)}},qp=Mf,Zp=Zo;var ew={usingClientEntryPoint:!1,Events:[oa,Fr,Xl,Xp,Vp,Mf]},va={findFiberByHostInstance:$o,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tw={bundleType:va.bundleType,version:va.version,rendererPackageName:va.rendererPackageName,rendererConfig:va.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:M.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=eg(i),i===null?null:i.stateNode},findFiberByHostInstance:va.findFiberByHostInstance||QA,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bc.isDisabled&&bc.supportsFiber)try{Rl=bc.inject(tw),di=bc}catch{}}return Sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ew,Sn.createPortal=function(i,r){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!xf(r))throw Error(n(200));return KA(i,r,null,l)},Sn.createRoot=function(i,r){if(!xf(i))throw Error(n(299));var l=!1,f="",g=_0;return r!=null&&(r.unstable_strictMode===!0&&(l=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(g=r.onRecoverableError)),r=Hf(i,1,!1,null,null,l,!1,f,g),i[Pi]=r.current,ta(i.nodeType===8?i.parentNode:i),new Lf(r)},Sn.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var r=i._reactInternals;if(r===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=eg(r),i=i===null?null:i.stateNode,i},Sn.flushSync=function(i){return Zo(i)},Sn.hydrate=function(i,r,l){if(!kc(r))throw Error(n(200));return Mc(null,i,r,!0,l)},Sn.hydrateRoot=function(i,r,l){if(!xf(i))throw Error(n(405));var f=l!=null&&l.hydratedSources||null,g=!1,y="",I=_0;if(l!=null&&(l.unstable_strictMode===!0&&(g=!0),l.identifierPrefix!==void 0&&(y=l.identifierPrefix),l.onRecoverableError!==void 0&&(I=l.onRecoverableError)),r=C0(r,null,i,1,l??null,g,!1,y,I),i[Pi]=r.current,ta(i),f)for(i=0;i<f.length;i++)l=f[i],g=l._getVersion,g=g(l._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[l,g]:r.mutableSourceEagerHydrationData.push(l,g);return new Rc(r)},Sn.render=function(i,r,l){if(!kc(r))throw Error(n(200));return Mc(null,i,r,!1,l)},Sn.unmountComponentAtNode=function(i){if(!kc(i))throw Error(n(40));return i._reactRootContainer?(Zo(function(){Mc(null,null,i,!1,function(){i._reactRootContainer=null,i[Pi]=null})}),!0):!1},Sn.unstable_batchedUpdates=Mf,Sn.unstable_renderSubtreeIntoContainer=function(i,r,l,f){if(!kc(l))throw Error(n(200));if(i==null||i._reactInternals===void 0)throw Error(n(38));return Mc(i,r,l,!1,f)},Sn.version="18.3.1-next-f1338f8080-20240426",Sn}var H0;function dw(){if(H0)return $f.exports;H0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),$f.exports=uw(),$f.exports}var F0;function fw(){if(F0)return Dc;F0=1;var e=dw();return Dc.createRoot=e.createRoot,Dc.hydrateRoot=e.hydrateRoot,Dc}var hw=fw();const pw=Cv(hw);class gw{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let o=this.length++;for(;o>0;){const s=o-1>>1,a=this.values[s];if(n>=a)break;this.ids[o]=this.ids[s],this.values[o]=a,o=s}this.ids[o]=t,this.values[o]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],o=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let c=(a<<1)+1;const d=c+1;let u=this.ids[c],h=this.values[c];const p=this.values[d];if(d<this.length&&p<h&&(c=d,u=this.ids[d],h=p),h>=o)break;this.ids[a]=u,this.values[a]=h,a=c}this.ids[a]=n,this.values[a]=o}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const L0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],zf=3;class Vh{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[o,s]=new Uint8Array(t,n+0,2);if(o!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==zf)throw new Error(`Got v${a} data when expected v${zf}.`);const c=L0[s&15];if(!c)throw new Error("Unrecognized array type.");const[d]=new Uint16Array(t,n+2,1),[u]=new Uint32Array(t,n+4,1);return new Vh(u,d,c,void 0,t,n)}constructor(t,n=16,o=Float64Array,s=ArrayBuffer,a,c=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=c;let d=t,u=d;this._levelBounds=[d*4];do d=Math.ceil(d/this.nodeSize),u+=d,this._levelBounds.push(u*4);while(d!==1);this.ArrayType=o,this.IndexArrayType=u<16384?Uint16Array:Uint32Array;const h=L0.indexOf(this.ArrayType),p=u*4*this.ArrayType.BYTES_PER_ELEMENT;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,c+8,u*4),this._indices=new this.IndexArrayType(this.data,c+8+p,u),this._pos=u*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+p+u*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,u*4),this._indices=new this.IndexArrayType(this.data,8+p,u),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(zf<<4)+h]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new gw}add(t,n,o=t,s=n){const a=this._pos>>2,c=this._boxes;return this._indices[a]=a,c[this._pos++]=t,c[this._pos++]=n,c[this._pos++]=o,c[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),o>this.maxX&&(this.maxX=o),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,o=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let c=0,d=0;c<this.numItems;c++){const u=t[d++],h=t[d++],p=t[d++],m=t[d++],S=Math.floor(a*((u+p)/2-this.minX)/n),v=Math.floor(a*((h+m)/2-this.minY)/o);s[c]=yw(S,v)}wh(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let c=0,d=0;c<this._levelBounds.length-1;c++){const u=this._levelBounds[c];for(;d<u;){const h=d;let p=t[d++],m=t[d++],S=t[d++],v=t[d++];for(let A=1;A<this.nodeSize&&d<u;A++)p=Math.min(p,t[d++]),m=Math.min(m,t[d++]),S=Math.max(S,t[d++]),v=Math.max(v,t[d++]);this._indices[this._pos>>2]=h,t[this._pos++]=p,t[this._pos++]=m,t[this._pos++]=S,t[this._pos++]=v}}}search(t,n,o,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let c=this._boxes.length-4;const d=[],u=[];for(;c!==void 0;){const h=Math.min(c+this.nodeSize*4,U0(c,this._levelBounds));for(let p=c;p<h;p+=4){if(o<this._boxes[p]||s<this._boxes[p+1]||t>this._boxes[p+2]||n>this._boxes[p+3])continue;const m=this._indices[p>>2]|0;c>=this.numItems*4?d.push(m):(a===void 0||a(m))&&u.push(m)}c=d.pop()}return u}neighbors(t,n,o=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let c=this._boxes.length-4;const d=this._queue,u=[],h=s*s;e:for(;c!==void 0;){const p=Math.min(c+this.nodeSize*4,U0(c,this._levelBounds));for(let m=c;m<p;m+=4){const S=this._indices[m>>2]|0,v=x0(t,this._boxes[m],this._boxes[m+2]),A=x0(n,this._boxes[m+1],this._boxes[m+3]),T=v*v+A*A;T>h||(c>=this.numItems*4?d.push(S<<1,T):(a===void 0||a(S))&&d.push((S<<1)+1,T))}for(;d.length&&d.peek()&1;)if(d.peekValue()>h||(u.push(d.pop()>>1),u.length===o))break e;c=d.length?d.pop()>>1:void 0}return d.clear(),u}}function x0(e,t,n){return e<t?t-e:e<=n?0:e-n}function U0(e,t){let n=0,o=t.length-1;for(;n<o;){const s=n+o>>1;t[s]>e?o=s:n=s+1}return t[n]}function wh(e,t,n,o,s,a){if(Math.floor(o/a)>=Math.floor(s/a))return;const c=e[o+s>>1];let d=o-1,u=s+1;for(;;){do d++;while(e[d]<c);do u--;while(e[u]>c);if(d>=u)break;mw(e,t,n,d,u)}wh(e,t,n,o,u,a),wh(e,t,n,u+1,s,a)}function mw(e,t,n,o,s){const a=e[o];e[o]=e[s],e[s]=a;const c=4*o,d=4*s,u=t[c],h=t[c+1],p=t[c+2],m=t[c+3];t[c]=t[d],t[c+1]=t[d+1],t[c+2]=t[d+2],t[c+3]=t[d+3],t[d]=u,t[d+1]=h,t[d+2]=p,t[d+3]=m;const S=n[o];n[o]=n[s],n[s]=S}function yw(e,t){let n=e^t,o=65535^n,s=65535^(e|t),a=e&(t^65535),c=n|o>>1,d=n>>1^n,u=s>>1^o&a>>1^s,h=n&s>>1^a>>1^a;n=c,o=d,s=u,a=h,c=n&n>>2^o&o>>2,d=n&o>>2^o&(n^o)>>2,u^=n&s>>2^o&a>>2,h^=o&s>>2^(n^o)&a>>2,n=c,o=d,s=u,a=h,c=n&n>>4^o&o>>4,d=n&o>>4^o&(n^o)>>4,u^=n&s>>4^o&a>>4,h^=o&s>>4^(n^o)&a>>4,n=c,o=d,s=u,a=h,u^=n&s>>8^o&a>>8,h^=o&s>>8^(n^o)&a>>8,n=u^u>>1,o=h^h>>1;let p=e^t,m=o|65535^(p|n);return p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|p)>>>0}function jn(e,t){return{x:e.x+t.x,y:e.y+t.y}}function qh(e,t){return{x:e.x-t.x,y:e.y-t.y}}function lt(e,t){return{x:e.x*t,y:e.y*t}}function Oo(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function mt(e){const t=Oo(e);return t===0?{x:0,y:0}:lt(e,1/t)}function Xn(e,t){return Oo(qh(e,t))}function ou(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function G0(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,o)=>({x:n.x+o.x,y:n.y+o.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function Le(e,t,n,o){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>o/2&&(a=a-Math.sign(a)*o),{x:s,y:a}}function $t(e,t,n){const o=Le(e,t,n.width,n.height);return mt(o)}function J(e,t,n,o){const s=Le(e,t,n,o);return Oo(s)}function zt(e,t,n,o){const s=Le(e,t,n,o);return s.x*s.x+s.y*s.y}function vw(e,t){return e.x*t.x+e.y*t.y}function Sw(e,t){const n=vw(e,t),o=Oo(e),s=Oo(t);if(o===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(o*s)));return Math.acos(a)}function ru(e,t){const n=Math.cos(t),o=Math.sin(t);return{x:e.x*n-e.y*o,y:e.x*o+e.y*n}}function Tw(e,t){return t.split(".").reduce((n,o)=>{if(n&&typeof n=="object"&&o in n)return n[o]},e)}function Hi(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],at:()=>{},byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new Vh(e.length),o=new Map,s=new Map;let a=0;const c=new Uint32Array(e.length);for(let u=0;u<e.length;u++){const h=e[u];h.width!==void 0&&h.height!==void 0?n.add(h.position.x,h.position.y,h.position.x+h.width,h.position.y+h.height):n.add(h.position.x,h.position.y,h.position.x,h.position.y)}return n.finish(),{all(){return e},byRect(u){const{width:h,height:p}=t,m=[];a++;const S=[];u.left<0?(S.push({left:u.left+h,right:h}),S.push({left:0,right:u.right})):u.right>h?(S.push({left:u.left,right:h}),S.push({left:0,right:u.right-h})):S.push({left:u.left,right:u.right});const v=[];u.top<0?(v.push({top:u.top+p,bottom:p}),v.push({top:0,bottom:u.bottom})):u.bottom>p?(v.push({top:u.top,bottom:p}),v.push({top:0,bottom:u.bottom-p})):v.push({top:u.top,bottom:u.bottom});for(let A=0;A<S.length;A++){const T=S[A];for(let w=0;w<v.length;w++){const E=v[w],C=n.search(T.left,E.top,T.right,E.bottom);for(let _=0;_<C.length;_++){const M=C[_];c[M]!==a&&(c[M]=a,m.push(e[M]))}}}return m},byRadius(u,h){const{width:p,height:m}=t,S=[];a++;const v=h*h,A=u.x-h,T=u.x+h,w=u.y-h,E=u.y+h,C=[];A<0?(C.push({left:A+p,right:p}),C.push({left:0,right:T})):T>p?(C.push({left:A,right:p}),C.push({left:0,right:T-p})):C.push({left:A,right:T});const _=[];w<0?(_.push({top:w+m,bottom:m}),_.push({top:0,bottom:E})):E>m?(_.push({top:w,bottom:m}),_.push({top:0,bottom:E-m})):_.push({top:w,bottom:E});for(let M=0;M<C.length;M++){const P=C[M];for(let k=0;k<_.length;k++){const R=_[k],H=n.search(P.left,R.top,P.right,R.bottom);for(let G=0;G<H.length;G++){const F=H[G];if(c[F]!==a){c[F]=a;const Y=e[F];zt(u,Y.position,p,m)<=v&&S.push(Y)}}}}return S},at(u,h){return this.byRadius(u,h)[0]},byProperty(u,h){var p;if(!o.has(u)){const m=new Map;for(let S=0;S<e.length;S++){const v=e[S],A=v[u];m.has(A)||m.set(A,[]),m.get(A).push(v)}o.set(u,m)}return((p=o.get(u))==null?void 0:p.get(h))||[]},byPropertyPath(u,h){var p;if(!s.has(u)){const m=new Map;for(let S=0;S<e.length;S++){const v=e[S],A=Tw(v,u);m.has(A)||m.set(A,[]),m.get(A).push(v)}s.set(u,m)}return((p=s.get(u))==null?void 0:p.get(h))||[]},resetPropertyCache(){o.clear(),s.clear()},count(){return e.length}}}function hl(e){var m,S;const t=e.entities.entities,n=[],o=[],s=[],a=[],c=[],d=[],u=[];for(const v in t){const A=t[v];switch(A.type){case"human":n.push(A);break;case"berryBush":o.push(A);break;case"corpse":s.push(A);break;case"prey":a.push(A);break;case"predator":c.push(A);break;case"building":d.push(A);break;case"tree":u.push(A);break}}const h=e.mapDimensions;return{...e,search:{human:Hi(n,h),berryBush:Hi(o,h),corpse:Hi(s,h),prey:Hi(a,h),predator:Hi(c,h),building:Hi(d,h),tree:Hi(u,h),tasks:((m=e.search)==null?void 0:m.tasks)??Hi([],h)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((S=e.cache)==null?void 0:S.tribeCenters)??{}}}}function Iw(e){const t=[];for(const n in e.tasks)t.push(e.tasks[n]);e.search.tasks=Hi(t,e.mapDimensions)}const q={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire",Palisade:"palisade",Gate:"gate"},It={[q.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[q.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[q.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[q.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}},[q.Palisade]:{name:"Palisade",description:"A defensive wall segment that blocks movement.",icon:"",dimensions:{width:20,height:20},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:1}},[q.Gate]:{name:"Gate",description:"A gate that allows passage for tribe members.",icon:"",dimensions:{width:20,height:20},constructionTimeHours:.4,destructionTimeHours:.2,cost:{wood:3}}},Aw=.5,ww="#FFA500",Ew="#FF4500",$0=4,Cw=10,Eu=60;function Zh(e){return It[e].dimensions}function Pw(e){return It[e].constructionTimeHours}function _w(e){return It[e].destructionTimeHours}const Pv=5;function Rw(){return It[q.PlantingZone].dimensions}function W0(e,t,n){const o=e.position.x+n.width/2,a=t.position.x-n.width/2-o,c=e.position.y-n.height/2,d=e.position.y+n.height/2,u=t.position.y-n.height/2,h=t.position.y+n.height/2,p=Math.min(d,h)-Math.max(c,u);return a>=-5&&a<=Pv&&p>n.height*.5}function Y0(e,t,n){const o=e.position.y+n.height/2,a=t.position.y-n.height/2-o,c=e.position.x-n.width/2,d=e.position.x+n.width/2,u=t.position.x-n.width/2,h=t.position.x+n.width/2,p=Math.min(d,h)-Math.max(c,u);return a>=-5&&a<=Pv&&p>n.width*.5}function kw(e){var c;const t={},n=Rw(),o=e;if(!((c=o.search)!=null&&c.building))return t;const a=o.search.building.all().filter(d=>d.buildingType===q.PlantingZone&&d.isConstructed);for(const d of a)t[d.id]={top:!1,bottom:!1,left:!1,right:!1};for(let d=0;d<a.length;d++){const u=a[d];for(let h=d+1;h<a.length;h++){const p=a[h];u.ownerId===p.ownerId&&(W0(u,p,n)&&(t[u.id].right=!0,t[p.id].left=!0),W0(p,u,n)&&(t[p.id].right=!0,t[u.id].left=!0),Y0(u,p,n)&&(t[u.id].bottom=!0,t[p.id].top=!0),Y0(p,u,n)&&(t[p.id].bottom=!0,t[u.id].top=!0))}}return t}function Ja(e){e.plantingZoneConnections=kw(e)}var ir=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(ir||{});class Mw{constructor(){Gt(this,"worker",null);Gt(this,"pendingRequests",new Map);Gt(this,"requestQueue",[]);Gt(this,"isProcessing",!1);Gt(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case ir.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case ir.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case ir.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,o)=>{if(!this.worker){o(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:o});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),o(s)}})}queueOperation(t){return new Promise((n,o)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){o(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),o=t,s={type:ir.SAVE_REQUEST,id:n,gameState:o};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:ir.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:ir.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const Kh=new Mw;async function Qh(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,tribeModalOpen:e.tribeModalOpen,cameraFollowingPlayer:e.cameraFollowingPlayer,cameraZoom:e.cameraZoom,isDraggingMinimap:e.isDraggingMinimap,minimapDragDistance:e.minimapDragDistance,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks,navigationGrid:e.navigationGrid,pathfindingQueue:e.pathfindingQueue,isDraggingViewport:e.isDraggingViewport,viewportDragButton:e.viewportDragButton,viewportDragDistance:e.viewportDragDistance};await Kh.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function bw(){try{const e=await Kh.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=hl(t);return Ja(n),n}catch(e){return console.error("Failed to load game:",e),await _v(),null}}async function _v(){try{await Kh.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const Rv=te.createContext(void 0),Dw=({initialAppState:e,children:t})=>{const[n,o]=te.useState(e),[s,a]=te.useState(void 0),[c,d]=te.useState(null),[u,h]=te.useState(!1);te.useEffect(()=>{bw().then(A=>{A&&d(A),h(!0)})},[]);const p=(A,T)=>{o(A),A==="gameOver"&&T?a(T):A!=="gameOver"&&a(void 0)},m=()=>{o("intro"),a(void 0),v()},S=A=>{Qh(A),d(A)},v=()=>{_v(),d(null)};return X.jsx(Rv.Provider,{value:{appState:n,setAppState:p,returnToIntro:m,gameOverDetails:s,contextReady:u,savedGameState:c,setSavedGameState:d,saveCurrentGame:S,clearCurrentSave:v},children:t})},Ci=()=>{const e=te.useContext(Rv);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var en=function(){return en=Object.assign||function(t){for(var n,o=1,s=arguments.length;o<s;o++){n=arguments[o];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},en.apply(this,arguments)};function el(e,t,n){if(n||arguments.length===2)for(var o=0,s=t.length,a;o<s;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))}var at="-ms-",Ga="-moz-",Ve="-webkit-",kv="comm",Cu="rule",Jh="decl",Ow="@import",Mv="@keyframes",Nw="@layer",bv=Math.abs,ep=String.fromCharCode,Eh=Object.assign;function Bw(e,t){return Ht(e,0)^45?(((t<<2^Ht(e,0))<<2^Ht(e,1))<<2^Ht(e,2))<<2^Ht(e,3):0}function Dv(e){return e.trim()}function Li(e,t){return(e=t.exec(e))?e[0]:e}function Ue(e,t,n){return e.replace(t,n)}function qc(e,t,n){return e.indexOf(t,n)}function Ht(e,t){return e.charCodeAt(t)|0}function hs(e,t,n){return e.slice(t,n)}function Ti(e){return e.length}function Ov(e){return e.length}function Na(e,t){return t.push(e),e}function Hw(e,t){return e.map(t).join("")}function z0(e,t){return e.filter(function(n){return!Li(n,t)})}var Pu=1,ps=1,Nv=0,Vn=0,Et=0,_s="";function _u(e,t,n,o,s,a,c,d){return{value:e,root:t,parent:n,type:o,props:s,children:a,line:Pu,column:ps,length:c,return:"",siblings:d}}function Eo(e,t){return Eh(_u("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Qr(e){for(;e.root;)e=Eo(e.root,{children:[e]});Na(e,e.siblings)}function Fw(){return Et}function Lw(){return Et=Vn>0?Ht(_s,--Vn):0,ps--,Et===10&&(ps=1,Pu--),Et}function si(){return Et=Vn<Nv?Ht(_s,Vn++):0,ps++,Et===10&&(ps=1,Pu++),Et}function lr(){return Ht(_s,Vn)}function Zc(){return Vn}function Ru(e,t){return hs(_s,e,t)}function Ch(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function xw(e){return Pu=ps=1,Nv=Ti(_s=e),Vn=0,[]}function Uw(e){return _s="",e}function jf(e){return Dv(Ru(Vn-1,Ph(e===91?e+2:e===40?e+1:e)))}function Gw(e){for(;(Et=lr())&&Et<33;)si();return Ch(e)>2||Ch(Et)>3?"":" "}function $w(e,t){for(;--t&&si()&&!(Et<48||Et>102||Et>57&&Et<65||Et>70&&Et<97););return Ru(e,Zc()+(t<6&&lr()==32&&si()==32))}function Ph(e){for(;si();)switch(Et){case e:return Vn;case 34:case 39:e!==34&&e!==39&&Ph(Et);break;case 40:e===41&&Ph(e);break;case 92:si();break}return Vn}function Ww(e,t){for(;si()&&e+Et!==57;)if(e+Et===84&&lr()===47)break;return"/*"+Ru(t,Vn-1)+"*"+ep(e===47?e:si())}function Yw(e){for(;!Ch(lr());)si();return Ru(e,Vn)}function zw(e){return Uw(Kc("",null,null,null,[""],e=xw(e),0,[0],e))}function Kc(e,t,n,o,s,a,c,d,u){for(var h=0,p=0,m=c,S=0,v=0,A=0,T=1,w=1,E=1,C=0,_="",M=s,P=a,k=o,R=_;w;)switch(A=C,C=si()){case 40:if(A!=108&&Ht(R,m-1)==58){qc(R+=Ue(jf(C),"&","&\f"),"&\f",bv(h?d[h-1]:0))!=-1&&(E=-1);break}case 34:case 39:case 91:R+=jf(C);break;case 9:case 10:case 13:case 32:R+=Gw(A);break;case 92:R+=$w(Zc()-1,7);continue;case 47:switch(lr()){case 42:case 47:Na(jw(Ww(si(),Zc()),t,n,u),u);break;default:R+="/"}break;case 123*T:d[h++]=Ti(R)*E;case 125*T:case 59:case 0:switch(C){case 0:case 125:w=0;case 59+p:E==-1&&(R=Ue(R,/\f/g,"")),v>0&&Ti(R)-m&&Na(v>32?X0(R+";",o,n,m-1,u):X0(Ue(R," ","")+";",o,n,m-2,u),u);break;case 59:R+=";";default:if(Na(k=j0(R,t,n,h,p,s,d,_,M=[],P=[],m,a),a),C===123)if(p===0)Kc(R,t,k,k,M,a,m,d,P);else switch(S===99&&Ht(R,3)===110?100:S){case 100:case 108:case 109:case 115:Kc(e,k,k,o&&Na(j0(e,k,k,0,0,s,d,_,s,M=[],m,P),P),s,P,m,d,o?M:P);break;default:Kc(R,k,k,k,[""],P,0,d,P)}}h=p=v=0,T=E=1,_=R="",m=c;break;case 58:m=1+Ti(R),v=A;default:if(T<1){if(C==123)--T;else if(C==125&&T++==0&&Lw()==125)continue}switch(R+=ep(C),C*T){case 38:E=p>0?1:(R+="\f",-1);break;case 44:d[h++]=(Ti(R)-1)*E,E=1;break;case 64:lr()===45&&(R+=jf(si())),S=lr(),p=m=Ti(_=R+=Yw(Zc())),C++;break;case 45:A===45&&Ti(R)==2&&(T=0)}}return a}function j0(e,t,n,o,s,a,c,d,u,h,p,m){for(var S=s-1,v=s===0?a:[""],A=Ov(v),T=0,w=0,E=0;T<o;++T)for(var C=0,_=hs(e,S+1,S=bv(w=c[T])),M=e;C<A;++C)(M=Dv(w>0?v[C]+" "+_:Ue(_,/&\f/g,v[C])))&&(u[E++]=M);return _u(e,t,n,s===0?Cu:d,u,h,p,m)}function jw(e,t,n,o){return _u(e,t,n,kv,ep(Fw()),hs(e,2,-2),0,o)}function X0(e,t,n,o,s){return _u(e,t,n,Jh,hs(e,0,o),hs(e,o+1,-1),o,s)}function Bv(e,t,n){switch(Bw(e,t)){case 5103:return Ve+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ve+e+e;case 4789:return Ga+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Ve+e+Ga+e+at+e+e;case 5936:switch(Ht(e,t+11)){case 114:return Ve+e+at+Ue(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Ve+e+at+Ue(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Ve+e+at+Ue(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Ve+e+at+e+e;case 6165:return Ve+e+at+"flex-"+e+e;case 5187:return Ve+e+Ue(e,/(\w+).+(:[^]+)/,Ve+"box-$1$2"+at+"flex-$1$2")+e;case 5443:return Ve+e+at+"flex-item-"+Ue(e,/flex-|-self/g,"")+(Li(e,/flex-|baseline/)?"":at+"grid-row-"+Ue(e,/flex-|-self/g,""))+e;case 4675:return Ve+e+at+"flex-line-pack"+Ue(e,/align-content|flex-|-self/g,"")+e;case 5548:return Ve+e+at+Ue(e,"shrink","negative")+e;case 5292:return Ve+e+at+Ue(e,"basis","preferred-size")+e;case 6060:return Ve+"box-"+Ue(e,"-grow","")+Ve+e+at+Ue(e,"grow","positive")+e;case 4554:return Ve+Ue(e,/([^-])(transform)/g,"$1"+Ve+"$2")+e;case 6187:return Ue(Ue(Ue(e,/(zoom-|grab)/,Ve+"$1"),/(image-set)/,Ve+"$1"),e,"")+e;case 5495:case 3959:return Ue(e,/(image-set\([^]*)/,Ve+"$1$`$1");case 4968:return Ue(Ue(e,/(.+:)(flex-)?(.*)/,Ve+"box-pack:$3"+at+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ve+e+e;case 4200:if(!Li(e,/flex-|baseline/))return at+"grid-column-align"+hs(e,t)+e;break;case 2592:case 3360:return at+Ue(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(o,s){return t=s,Li(o.props,/grid-\w+-end/)})?~qc(e+(n=n[t].value),"span",0)?e:at+Ue(e,"-start","")+e+at+"grid-row-span:"+(~qc(n,"span",0)?Li(n,/\d+/):+Li(n,/\d+/)-+Li(e,/\d+/))+";":at+Ue(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(o){return Li(o.props,/grid-\w+-start/)})?e:at+Ue(Ue(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return Ue(e,/(.+)-inline(.+)/,Ve+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ti(e)-1-t>6)switch(Ht(e,t+1)){case 109:if(Ht(e,t+4)!==45)break;case 102:return Ue(e,/(.+:)(.+)-([^]+)/,"$1"+Ve+"$2-$3$1"+Ga+(Ht(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~qc(e,"stretch",0)?Bv(Ue(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return Ue(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(o,s,a,c,d,u,h){return at+s+":"+a+h+(c?at+s+"-span:"+(d?u:+u-+a)+h:"")+e});case 4949:if(Ht(e,t+6)===121)return Ue(e,":",":"+Ve)+e;break;case 6444:switch(Ht(e,Ht(e,14)===45?18:11)){case 120:return Ue(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Ve+(Ht(e,14)===45?"inline-":"")+"box$3$1"+Ve+"$2$3$1"+at+"$2box$3")+e;case 100:return Ue(e,":",":"+at)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Ue(e,"scroll-","scroll-snap-")+e}return e}function su(e,t){for(var n="",o=0;o<e.length;o++)n+=t(e[o],o,e,t)||"";return n}function Xw(e,t,n,o){switch(e.type){case Nw:if(e.children.length)break;case Ow:case Jh:return e.return=e.return||e.value;case kv:return"";case Mv:return e.return=e.value+"{"+su(e.children,o)+"}";case Cu:if(!Ti(e.value=e.props.join(",")))return""}return Ti(n=su(e.children,o))?e.return=e.value+"{"+n+"}":""}function Vw(e){var t=Ov(e);return function(n,o,s,a){for(var c="",d=0;d<t;d++)c+=e[d](n,o,s,a)||"";return c}}function qw(e){return function(t){t.root||(t=t.return)&&e(t)}}function Zw(e,t,n,o){if(e.length>-1&&!e.return)switch(e.type){case Jh:e.return=Bv(e.value,e.length,n);return;case Mv:return su([Eo(e,{value:Ue(e.value,"@","@"+Ve)})],o);case Cu:if(e.length)return Hw(n=e.props,function(s){switch(Li(s,o=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Qr(Eo(e,{props:[Ue(s,/:(read-\w+)/,":"+Ga+"$1")]})),Qr(Eo(e,{props:[s]})),Eh(e,{props:z0(n,o)});break;case"::placeholder":Qr(Eo(e,{props:[Ue(s,/:(plac\w+)/,":"+Ve+"input-$1")]})),Qr(Eo(e,{props:[Ue(s,/:(plac\w+)/,":"+Ga+"$1")]})),Qr(Eo(e,{props:[Ue(s,/:(plac\w+)/,at+"input-$1")]})),Qr(Eo(e,{props:[s]})),Eh(e,{props:z0(n,o)});break}return""})}}var Kw={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Mn={},gs=typeof process<"u"&&Mn!==void 0&&(Mn.REACT_APP_SC_ATTR||Mn.SC_ATTR)||"data-styled",Hv="active",Fv="data-styled-version",ku="6.1.13",tp=`/*!sc*/
`,au=typeof window<"u"&&"HTMLElement"in window,Qw=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Mn!==void 0&&Mn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Mn.REACT_APP_SC_DISABLE_SPEEDY!==""?Mn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Mn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Mn!==void 0&&Mn.SC_DISABLE_SPEEDY!==void 0&&Mn.SC_DISABLE_SPEEDY!==""&&Mn.SC_DISABLE_SPEEDY!=="false"&&Mn.SC_DISABLE_SPEEDY),Jw={},Mu=Object.freeze([]),ms=Object.freeze({});function Lv(e,t,n){return n===void 0&&(n=ms),e.theme!==n.theme&&e.theme||t||n.theme}var xv=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),e1=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,t1=/(^-|-$)/g;function V0(e){return e.replace(e1,"-").replace(t1,"")}var n1=/(a)(d)/gi,Oc=52,q0=function(e){return String.fromCharCode(e+(e>25?39:97))};function _h(e){var t,n="";for(t=Math.abs(e);t>Oc;t=t/Oc|0)n=q0(t%Oc)+n;return(q0(t%Oc)+n).replace(n1,"$1-$2")}var Xf,Uv=5381,os=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},Gv=function(e){return os(Uv,e)};function $v(e){return _h(Gv(e)>>>0)}function i1(e){return e.displayName||e.name||"Component"}function Vf(e){return typeof e=="string"&&!0}var Wv=typeof Symbol=="function"&&Symbol.for,Yv=Wv?Symbol.for("react.memo"):60115,o1=Wv?Symbol.for("react.forward_ref"):60112,r1={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},s1={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},zv={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},a1=((Xf={})[o1]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},Xf[Yv]=zv,Xf);function Z0(e){return("type"in(t=e)&&t.type.$$typeof)===Yv?zv:"$$typeof"in e?a1[e.$$typeof]:r1;var t}var l1=Object.defineProperty,c1=Object.getOwnPropertyNames,K0=Object.getOwnPropertySymbols,u1=Object.getOwnPropertyDescriptor,d1=Object.getPrototypeOf,Q0=Object.prototype;function jv(e,t,n){if(typeof t!="string"){if(Q0){var o=d1(t);o&&o!==Q0&&jv(e,o,n)}var s=c1(t);K0&&(s=s.concat(K0(t)));for(var a=Z0(e),c=Z0(t),d=0;d<s.length;++d){var u=s[d];if(!(u in s1||n&&n[u]||c&&u in c||a&&u in a)){var h=u1(t,u);try{l1(e,u,h)}catch{}}}}return e}function ys(e){return typeof e=="function"}function np(e){return typeof e=="object"&&"styledComponentId"in e}function rr(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function Rh(e,t){if(e.length===0)return"";for(var n=e[0],o=1;o<e.length;o++)n+=e[o];return n}function tl(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function kh(e,t,n){if(n===void 0&&(n=!1),!n&&!tl(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var o=0;o<t.length;o++)e[o]=kh(e[o],t[o]);else if(tl(t))for(var o in t)e[o]=kh(e[o],t[o]);return e}function ip(e,t){Object.defineProperty(e,"toString",{value:t})}function pl(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var f1=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,o=0;o<t;o++)n+=this.groupSizes[o];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var o=this.groupSizes,s=o.length,a=s;t>=a;)if((a<<=1)<0)throw pl(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(o),this.length=a;for(var c=s;c<a;c++)this.groupSizes[c]=0}for(var d=this.indexOfGroup(t+1),u=(c=0,n.length);c<u;c++)this.tag.insertRule(d,n[c])&&(this.groupSizes[t]++,d++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],o=this.indexOfGroup(t),s=o+n;this.groupSizes[t]=0;for(var a=o;a<s;a++)this.tag.deleteRule(o)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var o=this.groupSizes[t],s=this.indexOfGroup(t),a=s+o,c=s;c<a;c++)n+="".concat(this.tag.getRule(c)).concat(tp);return n},e}(),Qc=new Map,lu=new Map,Jc=1,Nc=function(e){if(Qc.has(e))return Qc.get(e);for(;lu.has(Jc);)Jc++;var t=Jc++;return Qc.set(e,t),lu.set(t,e),t},h1=function(e,t){Jc=t+1,Qc.set(e,t),lu.set(t,e)},p1="style[".concat(gs,"][").concat(Fv,'="').concat(ku,'"]'),g1=new RegExp("^".concat(gs,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),m1=function(e,t,n){for(var o,s=n.split(","),a=0,c=s.length;a<c;a++)(o=s[a])&&e.registerName(t,o)},y1=function(e,t){for(var n,o=((n=t.textContent)!==null&&n!==void 0?n:"").split(tp),s=[],a=0,c=o.length;a<c;a++){var d=o[a].trim();if(d){var u=d.match(g1);if(u){var h=0|parseInt(u[1],10),p=u[2];h!==0&&(h1(p,h),m1(e,p,u[3]),e.getTag().insertRules(h,s)),s.length=0}else s.push(d)}}},J0=function(e){for(var t=document.querySelectorAll(p1),n=0,o=t.length;n<o;n++){var s=t[n];s&&s.getAttribute(gs)!==Hv&&(y1(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function v1(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var Xv=function(e){var t=document.head,n=e||t,o=document.createElement("style"),s=function(d){var u=Array.from(d.querySelectorAll("style[".concat(gs,"]")));return u[u.length-1]}(n),a=s!==void 0?s.nextSibling:null;o.setAttribute(gs,Hv),o.setAttribute(Fv,ku);var c=v1();return c&&o.setAttribute("nonce",c),n.insertBefore(o,a),o},S1=function(){function e(t){this.element=Xv(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var o=document.styleSheets,s=0,a=o.length;s<a;s++){var c=o[s];if(c.ownerNode===n)return c}throw pl(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),T1=function(){function e(t){this.element=Xv(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var o=document.createTextNode(n);return this.element.insertBefore(o,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),I1=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),ey=au,A1={isServer:!au,useCSSOMInjection:!Qw},cu=function(){function e(t,n,o){t===void 0&&(t=ms),n===void 0&&(n={});var s=this;this.options=en(en({},A1),t),this.gs=n,this.names=new Map(o),this.server=!!t.isServer,!this.server&&au&&ey&&(ey=!1,J0(this)),ip(this,function(){return function(a){for(var c=a.getTag(),d=c.length,u="",h=function(m){var S=function(E){return lu.get(E)}(m);if(S===void 0)return"continue";var v=a.names.get(S),A=c.getGroup(m);if(v===void 0||!v.size||A.length===0)return"continue";var T="".concat(gs,".g").concat(m,'[id="').concat(S,'"]'),w="";v!==void 0&&v.forEach(function(E){E.length>0&&(w+="".concat(E,","))}),u+="".concat(A).concat(T,'{content:"').concat(w,'"}').concat(tp)},p=0;p<d;p++)h(p);return u}(s)})}return e.registerId=function(t){return Nc(t)},e.prototype.rehydrate=function(){!this.server&&au&&J0(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(en(en({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var o=n.useCSSOMInjection,s=n.target;return n.isServer?new I1(s):o?new S1(s):new T1(s)}(this.options),new f1(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(Nc(t),this.names.has(t))this.names.get(t).add(n);else{var o=new Set;o.add(n),this.names.set(t,o)}},e.prototype.insertRules=function(t,n,o){this.registerName(t,n),this.getTag().insertRules(Nc(t),o)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(Nc(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),w1=/&/g,E1=/^\s*\/\/.*$/gm;function Vv(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(o){return"".concat(t," ").concat(o)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=Vv(n.children,t)),n})}function C1(e){var t,n,o,s=ms,a=s.options,c=a===void 0?ms:a,d=s.plugins,u=d===void 0?Mu:d,h=function(S,v,A){return A.startsWith(n)&&A.endsWith(n)&&A.replaceAll(n,"").length>0?".".concat(t):S},p=u.slice();p.push(function(S){S.type===Cu&&S.value.includes("&")&&(S.props[0]=S.props[0].replace(w1,n).replace(o,h))}),c.prefix&&p.push(Zw),p.push(Xw);var m=function(S,v,A,T){v===void 0&&(v=""),A===void 0&&(A=""),T===void 0&&(T="&"),t=T,n=v,o=new RegExp("\\".concat(n,"\\b"),"g");var w=S.replace(E1,""),E=zw(A||v?"".concat(A," ").concat(v," { ").concat(w," }"):w);c.namespace&&(E=Vv(E,c.namespace));var C=[];return su(E,Vw(p.concat(qw(function(_){return C.push(_)})))),C};return m.hash=u.length?u.reduce(function(S,v){return v.name||pl(15),os(S,v.name)},Uv).toString():"",m}var P1=new cu,Mh=C1(),qv=Ii.createContext({shouldForwardProp:void 0,styleSheet:P1,stylis:Mh});qv.Consumer;Ii.createContext(void 0);function bh(){return te.useContext(qv)}var _1=function(){function e(t,n){var o=this;this.inject=function(s,a){a===void 0&&(a=Mh);var c=o.name+a.hash;s.hasNameForId(o.id,c)||s.insertRules(o.id,c,a(o.rules,c,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,ip(this,function(){throw pl(12,String(o.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Mh),this.name+t.hash},e}(),R1=function(e){return e>="A"&&e<="Z"};function ty(e){for(var t="",n=0;n<e.length;n++){var o=e[n];if(n===1&&o==="-"&&e[0]==="-")return e;R1(o)?t+="-"+o.toLowerCase():t+=o}return t.startsWith("ms-")?"-"+t:t}var Zv=function(e){return e==null||e===!1||e===""},Kv=function(e){var t,n,o=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!Zv(a)&&(Array.isArray(a)&&a.isCss||ys(a)?o.push("".concat(ty(s),":"),a,";"):tl(a)?o.push.apply(o,el(el(["".concat(s," {")],Kv(a),!1),["}"],!1)):o.push("".concat(ty(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in Kw||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return o};function Do(e,t,n,o){if(Zv(e))return[];if(np(e))return[".".concat(e.styledComponentId)];if(ys(e)){if(!ys(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return Do(s,t,n,o)}var a;return e instanceof _1?n?(e.inject(n,o),[e.getName(o)]):[e]:tl(e)?Kv(e):Array.isArray(e)?Array.prototype.concat.apply(Mu,e.map(function(c){return Do(c,t,n,o)})):[e.toString()]}function Qv(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(ys(n)&&!np(n))return!1}return!0}var k1=Gv(ku),M1=function(){function e(t,n,o){this.rules=t,this.staticRulesId="",this.isStatic=(o===void 0||o.isStatic)&&Qv(t),this.componentId=n,this.baseHash=os(k1,n),this.baseStyle=o,cu.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,o){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,o):"";if(this.isStatic&&!o.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=rr(s,this.staticRulesId);else{var a=Rh(Do(this.rules,t,n,o)),c=_h(os(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,c)){var d=o(a,".".concat(c),void 0,this.componentId);n.insertRules(this.componentId,c,d)}s=rr(s,c),this.staticRulesId=c}else{for(var u=os(this.baseHash,o.hash),h="",p=0;p<this.rules.length;p++){var m=this.rules[p];if(typeof m=="string")h+=m;else if(m){var S=Rh(Do(m,t,n,o));u=os(u,S+p),h+=S}}if(h){var v=_h(u>>>0);n.hasNameForId(this.componentId,v)||n.insertRules(this.componentId,v,o(h,".".concat(v),void 0,this.componentId)),s=rr(s,v)}}return s},e}(),op=Ii.createContext(void 0);op.Consumer;var qf={};function b1(e,t,n){var o=np(e),s=e,a=!Vf(e),c=t.attrs,d=c===void 0?Mu:c,u=t.componentId,h=u===void 0?function(M,P){var k=typeof M!="string"?"sc":V0(M);qf[k]=(qf[k]||0)+1;var R="".concat(k,"-").concat($v(ku+k+qf[k]));return P?"".concat(P,"-").concat(R):R}(t.displayName,t.parentComponentId):u,p=t.displayName,m=p===void 0?function(M){return Vf(M)?"styled.".concat(M):"Styled(".concat(i1(M),")")}(e):p,S=t.displayName&&t.componentId?"".concat(V0(t.displayName),"-").concat(t.componentId):t.componentId||h,v=o&&s.attrs?s.attrs.concat(d).filter(Boolean):d,A=t.shouldForwardProp;if(o&&s.shouldForwardProp){var T=s.shouldForwardProp;if(t.shouldForwardProp){var w=t.shouldForwardProp;A=function(M,P){return T(M,P)&&w(M,P)}}else A=T}var E=new M1(n,S,o?s.componentStyle:void 0);function C(M,P){return function(k,R,H){var G=k.attrs,F=k.componentStyle,Y=k.defaultProps,Z=k.foldedComponentIds,W=k.styledComponentId,j=k.target,ee=Ii.useContext(op),se=bh(),ae=k.shouldForwardProp||se.shouldForwardProp,Q=Lv(R,ee,Y)||ms,re=function(de,le,ge){for(var x,ce=en(en({},le),{className:void 0,theme:ge}),pe=0;pe<de.length;pe+=1){var we=ys(x=de[pe])?x(ce):x;for(var K in we)ce[K]=K==="className"?rr(ce[K],we[K]):K==="style"?en(en({},ce[K]),we[K]):we[K]}return le.className&&(ce.className=rr(ce.className,le.className)),ce}(G,R,Q),ne=re.as||j,D={};for(var z in re)re[z]===void 0||z[0]==="$"||z==="as"||z==="theme"&&re.theme===Q||(z==="forwardedAs"?D.as=re.forwardedAs:ae&&!ae(z,ne)||(D[z]=re[z]));var he=function(de,le){var ge=bh(),x=de.generateAndInjectStyles(le,ge.styleSheet,ge.stylis);return x}(F,re),me=rr(Z,W);return he&&(me+=" "+he),re.className&&(me+=" "+re.className),D[Vf(ne)&&!xv.has(ne)?"class":"className"]=me,D.ref=H,te.createElement(ne,D)}(_,M,P)}C.displayName=m;var _=Ii.forwardRef(C);return _.attrs=v,_.componentStyle=E,_.displayName=m,_.shouldForwardProp=A,_.foldedComponentIds=o?rr(s.foldedComponentIds,s.styledComponentId):"",_.styledComponentId=S,_.target=o?s.target:e,Object.defineProperty(_,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(M){this._foldedDefaultProps=o?function(P){for(var k=[],R=1;R<arguments.length;R++)k[R-1]=arguments[R];for(var H=0,G=k;H<G.length;H++)kh(P,G[H],!0);return P}({},s.defaultProps,M):M}}),ip(_,function(){return".".concat(_.styledComponentId)}),a&&jv(_,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),_}function ny(e,t){for(var n=[e[0]],o=0,s=t.length;o<s;o+=1)n.push(t[o],e[o+1]);return n}var iy=function(e){return Object.assign(e,{isCss:!0})};function Jv(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(ys(e)||tl(e))return iy(Do(ny(Mu,el([e],t,!0))));var o=e;return t.length===0&&o.length===1&&typeof o[0]=="string"?Do(o):iy(Do(ny(o,t)))}function Dh(e,t,n){if(n===void 0&&(n=ms),!t)throw pl(1,t);var o=function(s){for(var a=[],c=1;c<arguments.length;c++)a[c-1]=arguments[c];return e(t,n,Jv.apply(void 0,el([s],a,!1)))};return o.attrs=function(s){return Dh(e,t,en(en({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},o.withConfig=function(s){return Dh(e,t,en(en({},n),s))},o}var eS=function(e){return Dh(b1,e)},Ne=eS;xv.forEach(function(e){Ne[e]=eS(e)});var D1=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=Qv(t),cu.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,o,s){var a=s(Rh(Do(this.rules,n,o,s)),""),c=this.componentId+t;o.insertRules(c,c,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,o,s){t>2&&cu.registerId(this.componentId+t),this.removeStyles(t,o),this.createStyles(t,n,o,s)},e}();function O1(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=Jv.apply(void 0,el([e],t,!1)),s="sc-global-".concat($v(JSON.stringify(o))),a=new D1(o,s),c=function(u){var h=bh(),p=Ii.useContext(op),m=Ii.useRef(h.styleSheet.allocateGSInstance(s)).current;return h.styleSheet.server&&d(m,u,h.styleSheet,p,h.stylis),Ii.useLayoutEffect(function(){if(!h.styleSheet.server)return d(m,u,h.styleSheet,p,h.stylis),function(){return a.removeStyles(m,h.styleSheet)}},[m,u,h.styleSheet,p,h.stylis]),null};function d(u,h,p,m,S){if(a.isStatic)a.renderStyles(u,Jw,p,S);else{var v=en(en({},h),{theme:Lv(h,m,c.defaultProps)});a.renderStyles(u,v,p,S)}}return Ii.memo(c)}function rp(e,t){t===void 0&&(t=!0);var n=te.useRef(null),o=te.useRef(!1),s=te.useRef(e);s.current=e;var a=te.useCallback(function(d){o.current&&(s.current(d),n.current=requestAnimationFrame(a))},[]),c=te.useMemo(function(){return[function(){o.current&&(o.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){o.current||(o.current=!0,n.current=requestAnimationFrame(a))},function(){return o.current}]},[]);return te.useEffect(function(){return t&&c[1](),c[0]},[]),c}function N1(e,t,n,o,s){var c;(c=e.onExit)==null||c.call(e,o,t);const a=s.find(({id:d})=>d===t);return a!=null&&a.onEnter?a.onEnter(o,n):{...n,enteredAt:o.updateContext.gameState.time}}function B1(e,t){return t.find(({id:n})=>n===e)}function H1(e,t){return e!==t}function F1(e){e&&console.warn(`No handler found for state: ${e}`)}const $a="bushGrowing",or="bushFull",eu="bushSpreading",nl="bushDying",Mt=24,Ft=10,We=4e3,Ye=4e3,uu=5,L1=15,x1=5e3,Wi=100,Yi=20,zi=60,ji=200,tS=200,U1=1e3,G1=5,$1=3,W1=12,Y1=940,Oh=20,oy=90,nS=100,mr=5,z1=.5,bu=30,Xi=.1,Ba=.9,j1=2,X1=2;var ui=(e=>(e.Berry="berry",e.Meat="meat",e))(ui||{});const sp={berry:"",meat:""};function iS(e,t){return e+t*65536}function oS(e){return{gridX:e%65536,gridY:Math.floor(e/65536)}}function V1(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function ap(){return{lastUpdateTime:0,sectors:{}}}const Wt=20,du=100,rS=20,sS=0,q1=20,Z1=1,aS=.15,K1=.5,Q1=.01,J1=24,eE="#6B5344",tE="#4A3728",ry=.85,lS=35,nE=30,sy=1.25,Nh=40,Wa=Math.PI/6,cS=.5,iE=1,Du=10,il=80,uS=3,Ta=5,tn=150,dS=tn*.8,oE=tn*.2,Yn=tn*.8,No=30,fS=10,rE=10,sE=.5,Qe=30,hS=Qe*.75,Ou=30,pS=Ou*.75,gS=50,aE=20,lE=il*.8,cE=.7,fu=16,lp=40,cp=16,uE=72/3,ay=24,dE=1.25,fE=1.5,ly=tn*.6,mS=50,hE=1,up=il*.65,pE=80,gE=50,mE=1,yE=128,yS=10,cy=100,dp=35,Bo=30,Nu=.5,gl=2.5,fp=20,An=250,hp=.4,pp=150,gp=6,vE=5,mp=2,Bu=.5,Hu=1.5,SE=1,TE=.5,IE=.5,AE=1.5,wE=.25,EE=2.5,CE=45,PE=.05;var Rt=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(Rt||{}),qe=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e))(qe||{}),yr=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(yr||{});const hu=24,_E=24;let RE=0;function kE(){return`notification-${Date.now()}-${RE++}`}function ol(e,t){if(t.identifier){const o=e.notifications.find(s=>s.identifier===t.identifier);if(o){if(o.dismissedUntil&&e.time<o.dismissedUntil)return;o.message=t.message,o.timestamp=e.time,o.creationTime=Date.now(),o.duration=t.duration,o.targetEntityIds=t.targetEntityIds,o.highlightedEntityIds=t.highlightedEntityIds,o.targetPosition=t.targetPosition,o.targetArea=t.targetArea,o.targetRadius=t.targetRadius,o.isDismissed=!1,o.dismissedUntil=void 0;return}}const n={...t,id:kE(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function ME(e,t){const n=e.notifications.find(o=>o.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+_E))}function bE(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function DE(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const o of n.highlightedEntityIds){const s=e.entities.entities[o];s&&(s.isHighlighted=!0)}}function vS(e,t,n,o){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,c={x:Math.cos(s)*a,y:Math.sin(s)*a},d=jn(e,c);return{x:(d.x%n+n)%n,y:(d.y%o+o)%o}}function Zi(e,t,n,o){const s=t,{width:a,height:c}=t.mapDimensions,d={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},u=h=>{for(let p=0;p<h.length;p++){const m=h[p];if(o!==void 0&&m.id===o)continue;const S=zt(e,m.position,a,c),v=n+m.radius;if(S<v*v)return!0}return!1};return u(s.search.human.byRect(d))||u(s.search.berryBush.byRect(d))||u(s.search.corpse.byRect(d))}function OE(e,t,n,o,s){const a=t.mapDimensions.width,c=t.mapDimensions.height;if(!Zi(e,t,o,s)&&!Ir(t.soilDepletion,e,a,c))return e;const d=o;for(let u=d;u<=n;u+=d){const h=Math.ceil(2*Math.PI*u/d);for(let p=0;p<h;p++){const m=p/h*2*Math.PI,S={x:Math.cos(m)*u,y:Math.sin(m)*u},v=jn(e,S),A={x:(v.x%a+a)%a,y:(v.y%c+c)%c};if(!Zi(A,t,o,s)&&!Ir(t.soilDepletion,A,a,c))return A}}return null}function ai(e,t){var c,d;const n=t;if((d=(c=n.cache)==null?void 0:c.tribeCenters)!=null&&d[e])return n.cache.tribeCenters[e];const o=t.search.building.byProperty("ownerId",e);if(o.length>0){const u=o.map(h=>h.position);return n.cache.tribeCenters[e]=G0(u)}const s=Ho(e,t);if(s.length===0){const u=t.entities.entities[e];return n.cache.tribeCenters[e]=u?u.position:{x:0,y:0}}const a=s.map(u=>u.position);return n.cache.tribeCenters[e]=G0(a)}function uy(e,t,n){const o=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,c=e.y-t.position.y;return Math.abs(a)>o/2&&(a-=Math.sign(a)*o),Math.abs(c)>s/2&&(c-=Math.sign(c)*s),Math.abs(a)<=t.width/2&&Math.abs(c)<=t.height/2}const Ki=80,Yt=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],Ae=20,Ji=(e,t,n)=>{var d,u,h,p;if(!e||!t||e===t)return!1;const o=n.entities.entities[e],s=n.entities.entities[t],a=(u=(d=o==null?void 0:o.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[t],c=(p=(h=s==null?void 0:s.tribeControl)==null?void 0:h.diplomacy)==null?void 0:p[e];return a===Rt.Hostile||c===Rt.Hostile},ml=(e,t,n)=>e.id===t.id?!1:Ji(e.leaderId,t.leaderId,n),vr=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:Ji(e.leaderId,t.ownerId,n),Rs=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=Yn||t.hunger>=Yn||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||ml(e,t,n))return!1;const o=e.gender==="female"?e:t;return!(o.isPregnant||o.age>lp)},dy=1,Bh=150*.6,NE=800,BE=3,fy=24,HE=1.5,hy=.15,py=200,Zf=30*.75*1.2,FE=20,Kf=800,LE=.7,xE=.5,UE=10,Qf=400,GE=800,$E=8,WE=16,yl=100,YE=100,SS=150,gy=600,my=250,zE=.5,jE=.7,XE=300,VE=150;function qE(e){const t=Math.floor(e.x/Ae),n=Math.floor(e.y/Ae);return{x:t,y:n}}function Hh(e,t){const n=Math.ceil(t/Ae),o=e%n*Ae+Ae/2,s=Math.floor(e/n)*Ae+Ae/2;return{x:o,y:s}}function ZE(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(o/Ae),c=Math.floor(s/Ae),d=Math.ceil(t/Ae);return c*d+a}function li(e,t,n){const o=ZE({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[o]||null}function yp(e,t){return t.terrainOwnership.includes(e)}function TS(e,t,n,o){var c;const s=n;return(c=s.search)!=null&&c.human?s.search.human.byRadius(e,o).some(d=>Ji(t,d.leaderId,n)):!1}function KE(e,t,n,o,s=!1,a){if(s&&a&&TS(e,a,o,SS))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:c,height:d}=o.mapDimensions,u=Math.ceil(c/Ae),h=Math.ceil(d/Ae),p=Math.ceil(t/Ae),m=t*t,S=Math.floor(e.x/Ae),v=Math.floor(e.y/Ae);let A=!1,T=!1;for(let w=-p;w<=p;w++)for(let E=-p;E<=p;E++){const C=((S+E)%u+u)%u,_=((v+w)%h+h)%h,M=C*Ae+Ae/2,P=_*Ae+Ae/2;if(zt(e,{x:M,y:P},c,d)<=m){const R=_*u+C,H=o.terrainOwnership[R];if(H===n)A=!0;else if(H!==null){if(s&&a&&Ji(a,H,o))continue;T=!0}}}return T?{valid:!1,reason:"Position overlaps with another tribe's territory"}:A?{valid:!0}:yp(n,o)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function IS(e,t,n,o){if(!yp(n,o))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(TS(e,n,o,SS))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=o.mapDimensions,c=Math.ceil(s/Ae),d=Math.ceil(a/Ae),u=Math.ceil(t/Ae),h=t*t,p=Math.floor(e.x/Ae),m=Math.floor(e.y/Ae);let S=!1;for(let v=-u;v<=u;v++){for(let A=-u;A<=u;A++){const T=((p+A)%c+c)%c,w=((m+v)%d+d)%d,E=T*Ae+Ae/2,C=w*Ae+Ae/2;if(zt(e,{x:E,y:C},s,a)<=h){const M=w*c+T;if(o.terrainOwnership[M]===n){S=!0;break}}}if(S)break}return S?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function QE(e,t,n,o=0,s=!1,a){if(o>0){const d=KE(e,o,t,n,s,a);return d.valid?{canPlace:!0}:{canPlace:!1,reason:d.reason}}const c=li(e.x,e.y,n);return c===null||c===t?{canPlace:!0}:s&&a&&Ji(a,c,n)?{canPlace:!0}:c!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function Cr(e,t,n){const o=li(e.x,e.y,n);return o===null||o===t||!Ji(t,o,n)}function AS(e,t,n,o,{allowOverwrite:s}){const{width:a,height:c}=o.mapDimensions,d=Math.ceil(a/Ae),u=Math.ceil(c/Ae),h=Math.ceil(t/Ae),p=Math.floor(e.x/Ae),m=Math.floor(e.y/Ae);for(let C=-h;C<=h;C++)for(let _=-h;_<=h;_++){const M=((p+_)%d+d)%d,P=((m+C)%u+u)%u,k=M*Ae+Ae/2,R=P*Ae+Ae/2;if(J(e,{x:k,y:R},a,c)<=t){const G=P*d+M,F=o.terrainOwnership[G];(s||F===null||F===n)&&(o.terrainOwnership[G]=n)}}const S=3,v=h+S+2,A=[];for(let C=-v;C<=v;C++)for(let _=-v;_<=v;_++){const M=((p+_)%d+d)%d,P=((m+C)%u+u)%u,k=P*d+M;if(o.terrainOwnership[k]===null){let R=!1;const H=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const G of H){let F=!1,Y=!1;for(let Z=1;Z<=S;Z++){const W=((M+G.x*Z)%d+d)%d,ee=((P+G.y*Z)%u+u)%u*d+W;if(o.terrainOwnership[ee]===n){F=!0;break}}if(F)for(let Z=1;Z<=S;Z++){const W=((M-G.x*Z)%d+d)%d,ee=((P-G.y*Z)%u+u)%u*d+W;if(o.terrainOwnership[ee]===n){Y=!0;break}}if(F&&Y){R=!0;break}}R&&A.push(k)}}for(const C of A)o.terrainOwnership[C]=n;const T=250,w=new Set;for(let C=-v;C<=v;C++)for(let _=-v;_<=v;_++){const M=((p+_)%d+d)%d,k=((m+C)%u+u)%u*d+M;if(o.terrainOwnership[k]===null&&!w.has(k)){const R=[],H=[k];w.add(k),R.push(k);let G=!0,F=0;for(;F<H.length;){const Y=H[F++];if(R.length>T){G=!1;break}const Z=Y%d,W=Math.floor(Y/d),j=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:ee,ny:se}of j){const ae=((Z+ee)%d+d)%d,re=((W+se)%u+u)%u*d+ae;o.terrainOwnership[re]===null&&!w.has(re)&&(w.add(re),G&&(R.push(re),H.push(re)))}}if(G&&R.length<=T)for(const Y of R)o.terrainOwnership[Y]=n}}const E=[];for(let C=-v;C<=v;C++)for(let _=-v;_<=v;_++){const M=((p+_)%d+d)%d,P=((m+C)%u+u)%u,k=P*d+M;if(o.terrainOwnership[k]===null){let R=0;for(let H=-1;H<=1;H++)for(let G=-1;G<=1;G++){if(G===0&&H===0)continue;const F=((M+G)%d+d)%d,Z=((P+H)%u+u)%u*d+F;o.terrainOwnership[Z]===n&&R++}R>=5&&E.push(k)}}for(const C of E)o.terrainOwnership[C]=n}function rl(e,t,n,o){AS(e,t,n,o,{allowOverwrite:!1})}function wS(e,t,n,o){AS(e,t,n,o,{allowOverwrite:!0})}function pu(e,t,n){const o=e.terrainOwnership;for(let s=0;s<o.length;s++)o[s]===t&&(o[s]=n)}function Ke(e,t,n,o,s){const a=t,c=o,d="position"in e&&e.id?e:null,u=d?d.position:e,h=a.search[n].byRadius(u,c);let p=null,m=c;for(const S of h){if(S.id===(d==null?void 0:d.id)||s&&!s(S))continue;const v=J(u,S.position,t.mapDimensions.width,t.mapDimensions.height);v<m&&(m=v,p=S)}return p}function bt(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function JE(e,t){var c;const o=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const d of o){if(d.attackTargetId!==e)continue;const u=J(d.position,((c=t.entities.entities[e])==null?void 0:c.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);u<a&&(s=d,a=u)}return s}function ES(e){return e.search.human.all()}function eC(e,t,n){const{width:o,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const c of a){const d=J(e,c.position,o,s),u=c.type==="tree"?c.radius*2:c.radius;if(d<u)return c}}function tC(e,t,n,o,s){const{width:a,height:c}=o.mapDimensions,d=n*n;if(s){for(let S=0;S<s.length;S++)if(zt(e,s[S],a,c)<d)return!0;return!1}const u=ES(o),h=new Set;for(let S=0;S<u.length;S++){const v=u[S];v.leaderId&&v.leaderId!==t&&h.add(v.leaderId)}const p=h.values();let m=p.next();for(;!m.done;){const S=m.value,v=ai(S,o);if(zt(e,v,a,c)<d)return!0;m=p.next()}return!1}var Pe=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(Pe||{});function Fe(e,t,n,o,s,a,c){const d={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:o,entityId:s,targetPosition:a,targetEntityId:c};return e.visualEffects.push(d),e.nextVisualEffectId++,d.id}const Xe=1,sl=3,Gi=100,CS=20,cr=10,nC=.5,Ya=150,iC=25,oC=.5,Fh=100,PS=25,rC=.5,sC=15,Lh=4,aC=.75,lC=15,cC=8,uC=20;function Sr(e,t,n,o,s,a){if(n===void 0)return!1;const{width:c,height:d}=o.mapDimensions;if(s&&a!==void 0&&zt(s,e,c,d)>a*a)return!1;const u=Zh(t),h=Math.sqrt(u.width*u.width+u.height*u.height)/2;if(Zi(e,o,h*.8))return!1;if(t===q.PlantingZone){const{depletedSectors:T}=qS(o.soilDepletion,e,u.width,u.height,c,d);if(T.length>0)return!1}const m=o.search.building.byRadius(e,h*2);for(const T of m){const w=zt(e,T.position,c,d),E=(Math.max(u.width,u.height)+Math.max(T.width,T.height))/2;if(w<E*E*.81)return!1}const S=t===q.BorderPost;return!!QE(e,n,o,S?Eu:Ki,S,n).canPlace}function dC(e){const t=[],n=2*Math.PI/e;for(let o=0;o<e;o++){const s=o*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function tu(e,t,n,o,s,a,c){const d=performance.now(),u=n,h=Zh(e),p=n.mapDimensions.width,m=n.mapDimensions.height,S=u.search.building.byProperty("ownerId",t),v=[];if(S.length>0){a&&v.unshift(a);const C=ai(t,n),_=[...S].sort((M,P)=>{const k=zt(M.position,C,p,m),R=zt(P.position,C,p,m);return k-R});v.push(..._.map(M=>M.position))}else v.push(ai(t,n));const A=Math.min(v.length,$E),T=Math.max(h.width,h.height),w=T+20,E=T/2;for(let C=0;C<A;C++){const _=v[C];for(let M=w;M<=o;M+=E){const P=Math.max(8,Math.min(WE,Math.ceil(2*Math.PI*M/T))),k=dC(P);for(let R=0;R<P;R++){const H=k[R].cos*M,G=k[R].sin*M,F=_.x+H,Y=_.y+G,Z=(F%p+p)%p,W=(Y%m+m)%m;if(!tC({x:Z,y:W},t,s,n,c)&&Sr({x:Z,y:W},e,t,n))return performance.now()-d,{x:Z,y:W}}}}performance.now()-d}function vp(e,t,n,o){if(t===q.BorderPost)return wS(e,Eu,n,o),Fe(o,Pe.BorderClaim,e,Xe,n),null;const s=LT(o.entities,e,t,n);return t===q.Bonfire&&(s.storageCapacity=Lh,s.storedItems=[]),rl(e,Ki,n,o),t===q.PlantingZone&&Ja(o),s}function xh(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===q.PlantingZone&&Ja(t))}function fC(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let c=e.x-a.position.x,d=e.y-a.position.y;const u=t.mapDimensions.width,h=t.mapDimensions.height;if(Math.abs(c)>u/2&&(c-=Math.sign(c)*u),Math.abs(d)>h/2&&(d-=Math.sign(d)*h),Math.abs(c)<=a.width/2&&Math.abs(d)<=a.height/2)return a}}const ht=30,ks=ht*.6,_S="#4CAF50",RS="#FF5722",kS="#9C27B0",hC="#2196F3",MS="#FFC107",pC="#DC143C",Sp="#FFFFFF",Tp=[5,5],Fu=5,vs=15,gC=20,mC=16,yC=10,vC=16,SC=16,gu=["","","","","","","","","",""],za=8,TC="#FFFFFF",In=18,Je=15,IC="rgba(0, 0, 0, 0.7)",AC=4,Io=150,Rn=15,Ni=10,Ro="#555",wC="#f44336",EC="#4CAF50",CC="#2196F3",PC="#FFC107",Bc=16,xi=32,Hc=28,_C=10,RC=8,kC=8,MC=8,er=28,Ia=40,Aa=10,yy=8,bC=11,Jf=40,vy=5,DC=10,OC="#FFA500",NC="#808080",$i=120,bS=30,BC=20,On="#2d3748",kt="#ffffff",Ha="#4a5568",DS=5,Ip="#bdc9f792",OS="#272c36ff",NS="#a0aec0",mu=300,BS="rgba(255, 255, 255, 0.5)",HC="rgba(0, 0, 0, 0.8)",FC="#FFFFFF",Sy=14,Ty=8,Iy=-15,HS="#FFD700",FS=5,LC="rgba(0, 0, 0, 0.5)",xC="#FFFFFF",UC=33,GC=400,$C=20,WC=10,YC="rgba(0, 0, 0, 0.7)",zC="#FFFFFF",eh=20,Ay=16,jC=.5,wy=5,LS="#FFD700",XC=40,Ap=4,xS=3,VC=5,US=20,GS=5,qC="#FFFFFF",ZC="#FF6B6B",kn=80,tr=10,Fc=300,nr=15,KC=8,QC="rgba(0, 0, 0, 0.8)",JC="#FFFFFF",th=14,Ey=10,mi=20,eP="#FF6B6B",tP="#4CAF50",Cy="#FFD700",nP="rgba(255, 255, 0, 0.3)",iP=2,oP=500,rP=120,sP=45,aP="#FFD700",lP=3,cP=4,nh=225,Py=20,uP="#666",dP="#1a2a3a";let ih=0;function yu(){const e=gu[ih];return ih=(ih+1)%gu.length,e}function Ss(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),o=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(o),t.length>0)return t[0];if(n.sort(o),n.length>0)return n[0]}function Qi(e,t){const n=e,o=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...o,...s]}function Uh(e,t){var a,c,d,u;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(c=t.partnerIds)!=null&&c.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,o=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((d=e.ancestorIds)==null?void 0:d.some(h=>t.ancestorIds.includes(h)))||((u=t.ancestorIds)==null?void 0:u.some(h=>e.ancestorIds.includes(h)));return n||o||s}function $S(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const o=t.entities.entities[n];if(o&&o.gender==="male")return o}return null}function _y(e,t){var n;if(!e.isAdult){if(e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human")return o}if(e.motherId){const o=t.entities.entities[e.motherId];if(o&&o.type==="human")return o}}if(e.isAdult&&e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human"&&((n=Ss(Qi(t,o)))==null?void 0:n.id)===e.id)return o}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?$S(e,t):null}function fP(e,t){let n=e;const o=new Set;o.add(n.id);for(let s=0;s<uS;s++){let a=null;if(n.gender==="female"&&(a=$S(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||o.has(a.id))break;n=a,o.add(n.id)}return n}function hP(e,t){var o;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(o=e.partnerIds)==null||o.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),Qi(t,e).forEach(s=>n.add(s)),Array.from(n)}function vu(e,t){const n=new Map;function o(s){const a=Qi(t,s);for(const c of a)n.has(c.id)||(n.set(c.id,c),o(c))}return o(e),Array.from(n.values())}function Ho(e,t){return t.search.human.byProperty("leaderId",e)}function Su(e,t,n=new Map,o=new Set){var a;if(n.has(e))return n.get(e);if(o.has(e))return e;o.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const c=s.partnerIds.find(d=>{const u=t.entities.entities[d];return u&&u.gender==="male"});if(c){const d=Su(c,t,n,o);return n.set(e,d),d}}if(s.fatherId&&t.entities.entities[s.fatherId]){const c=Su(s.fatherId,t,n,o);return n.set(e,c),c}return n.set(e,e),e}function pP(e,t){e.leaderId=e.id,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{diplomacy:{}}),e.tribeInfo||(e.tribeInfo={tribeBadge:yu(),tribeColor:Yt[Math.floor(Math.random()*Yt.length)]}),e.tribeControl||(e.tribeControl={diplomacy:{}})}function gP(e,t){if(e.length===0)return null;const n=new Map,o=new Map;for(const c of e){const d=Su(c.id,t,n);o.has(d)||o.set(d,[]),o.get(d).push(c)}let s=null,a=0;for(const[c,d]of o.entries())d.length>a&&(a=d.length,s=c);return s&&t.entities.entities[s]||null}function Lu(e,t){var p,m,S;const n=new Map;for(let v=0;v<e.terrainOwnership.length;v++){const A=e.terrainOwnership[v];A!==null&&(n.has(A)||n.set(A,[]),n.get(A).push(v))}const{width:o,height:s}=e.mapDimensions,a=Math.ceil(o/Ae),c=new Map,d=Object.values(e.entities.entities).filter(v=>v.type==="human");for(const v of d)v.leaderId&&(c.has(v.leaderId)||c.set(v.leaderId,{leaderId:v.leaderId,tribeInfo:v.tribeInfo,members:[]}),(p=c.get(v.leaderId))==null||p.members.push(v));const u=t?(S=(m=e.entities.entities[t])==null?void 0:m.tribeControl)==null?void 0:S.diplomacy:void 0,h=Array.from(c.values()).map(v=>{var _,M;const A=e.entities.entities[v.leaderId],T=v.members.filter(P=>P.isAdult).length,w=v.members.length-T,E=n.get(v.leaderId)||[];let C=A==null?void 0:A.position;if(E.length>0){const P=E[0],k=P%a*Ae,R=Math.floor(P/a)*Ae,H={x:k,y:R};let G=0,F=0;for(const W of E){const j=W%a*Ae,ee=Math.floor(W/a)*Ae,se=Le(H,{x:j,y:ee},o,s);G+=se.x,F+=se.y}const Y=G/E.length,Z=F/E.length;C={x:((H.x+Y)%o+o)%o,y:((H.y+Z)%s+s)%s}}return{leaderId:v.leaderId,tribeBadge:((_=v==null?void 0:v.tribeInfo)==null?void 0:_.tribeBadge)||"",tribeColor:((M=v==null?void 0:v.tribeInfo)==null?void 0:M.tribeColor)||"",adultCount:T,childCount:w,isPlayerTribe:v.leaderId===t,leaderAge:(A==null?void 0:A.age)??0,leaderGender:(A==null?void 0:A.gender)??"male",diplomacyStatus:(u==null?void 0:u[v.leaderId??-1])??Rt.Friendly,territoryCenter:C}});return h.sort((v,A)=>v.isPlayerTribe?-1:A.isPlayerTribe?1:A.adultCount+A.childCount-(v.adultCount+v.childCount)),h}function WS(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function YS(e){var a;const t=new Set,o=e.search.human.all(),s=new Map;for(const c of o)c.leaderId&&(s.has(c.leaderId)||s.set(c.leaderId,[]),(a=s.get(c.leaderId))==null||a.push(c));for(const[c,d]of s){if(d.length===0)continue;const u=e.entities.entities[c],h=!u,p=u&&u.leaderId!==c;(h||p)&&t.add(c)}for(let c=0;c<e.terrainOwnership.length;c++){const d=e.terrainOwnership[c];d!==null&&!s.has(d)&&t.add(d)}return Array.from(t)}function mP(e,t){const n=new Map,s=t.search.human.all(),a=hP(e,t);for(const d of a)n.set(d,3);for(const d of s)d.id===e.id||n.has(d)||Uh(e,d)&&n.set(d,2);const c=Array.from(n.keys());for(const d of c)if(d.partnerIds)for(const u of d.partnerIds){const h=t.entities.entities[u];h&&!n.has(h)&&h.id!==e.id&&n.set(h,1)}return n}function yP(e,t){const n=Ho(e,t);if(n.length===0)return null;const o=t.entities.entities[e];if(o&&o.leaderId&&o.leaderId!==o.id)return o.leaderId;const s=new Map;for(const d of n){const u=mP(d,t);for(const[h,p]of u)if(h.leaderId&&h.leaderId!==e){const m=h.leaderId,S=t.entities.entities[m];if(S&&S.leaderId===S.id){const v=s.get(m)||0;s.set(m,v+p)}}}let a=null,c=0;for(const[d,u]of s)u>c&&(c=u,a=d);return a}function Ry(e,t,n){var p,m;const o=Ho(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=o.length>0?(p=o[0].tribeInfo)==null?void 0:p.tribeBadge:"?",c=s.leaderId===e||!s.leaderId;if(c){const S=n.entities.entities[e];pP(s,S)}const d=((m=s.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const S of o)S.id!==t&&(S.leaderId=t,S.tribeInfo=s.tribeInfo);const h=n.search.building.byProperty("ownerId",e);for(const S of h)S.ownerId=t;pu(n,e,t),ol(n,{identifier:`tribe-merge-${e}`,type:yr.TribeMerged,message:c?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${d}!`,duration:hu,targetEntityIds:[t],highlightedEntityIds:[t,...o.map(S=>S.id)]})}function vP(e){var n;const t=YS(e);for(const o of t){const s=Ho(o,e);if(s.length===0){const u=e.search.building.byProperty("ownerId",o);for(const h of u)xh(h.id,e);pu(e,o,null),ol(e,{identifier:`tribe-dissolved-${o}`,type:yr.TribeMerged,message:"An extinct tribe has been dissolved.",duration:hu});continue}const a=gP(s,e);if(a){Ry(o,a.id,e);continue}const c=yP(o,e);if(c)Ry(o,c,e);else{const d=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const p of s)p.leaderId=void 0,p.tribeInfo=void 0;const h=e.search.building.byProperty("ownerId",o);for(const p of h)xh(p.id,e);pu(e,o,null),ol(e,{identifier:`tribe-dissolved-${o}`,type:yr.TribeMerged,message:`Tribe ${d} has been dissolved due to lack of leadership.`,duration:hu})}}}var Lt=(e=>(e.Wood="wood",e))(Lt||{});const wp={wood:""},oi="treeGrowing",zn="treeFull",Ai="treeSpreading",jt="treeFallen",wi="treeStump",Tr="treeDying";function zS(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const n=WS({leaderId:e},t),o=0,c=t.search.building.byProperty("ownerId",e).reduce((A,T)=>{if(T.isConstructed)return A;const w=It[T.buildingType].cost.wood||0;return A+w},0),u=EP(e,t).reduce((A,T)=>{const E=(T.maxFuelLevel||Fh)-(T.fuelLevel||0);if(E<=0)return A;const C=Math.ceil(E/PS),_=T.storedItems.filter(P=>P.item.type===Lt.Wood).length,M=Math.max(0,C-_);return A+M},0),p=wP(e,t).reduce((A,T)=>{var E;const w=(E=T.storedItems)==null?void 0:E.filter(C=>C.item.type===Lt.Wood);return A+((w==null?void 0:w.length)||0)},0),m=n.reduce((A,T)=>{var w;return A+(((w=T.heldItem)==null?void 0:w.type)===Lt.Wood?1:0)},0),S=p+m,v=c+u+o;return t.cache.tribeWoodNeeds[e]=Math.max(0,v-S),t.cache.tribeWoodNeeds[e]}function SP(e,t){const n=t;if(e&&n.cache.tribeAvailableWoodOnGround[e]!==void 0)return n.cache.tribeAvailableWoodOnGround[e];const o=n.search.tree.all().filter(s=>!(s.stateMachine[0]===jt)||s.wood.length===0?!1:Cr(s.position,e,t));return n.cache.tribeAvailableWoodOnGround[e]=o.reduce((s,a)=>s+a.wood.length,0),n.cache.tribeAvailableWoodOnGround[e]}function TP(e,t,n=!1){const o=typeof e=="object"?e.leaderId:e;return o?t.search.building.byProperty("buildingType",q.PlantingZone).filter(a=>{if(!n&&!a.isConstructed)return!1;if(a.ownerId){const c=t.entities.entities[a.ownerId];return c&&c.leaderId===o}return!1}):[]}function IP(e,t){const{width:n,height:o,position:s}=e,{width:a,height:c}=t.mapDimensions,{depletedSectors:d,totalSectorsCount:u}=qS(t.soilDepletion,s,n,o,a,c);return u===0?!0:d.length/u<.25}function jS(e){const t=bu*2,n=Math.floor(e.width/t),o=Math.floor(e.height/t);return n*o}function AP(e,t){const n=t,o=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,o).filter(c=>{const d=Math.abs(c.position.x-e.position.x),u=Math.abs(c.position.y-e.position.y);return d<=e.width/2&&u<=e.height/2}).length}function wP(e,t,n=!1){return t.search.building.byProperty("buildingType",q.StorageSpot).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function EP(e,t,n=!1){return t.search.building.byProperty("buildingType",q.Bonfire).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function vl(e,t,n=void 0){return n?TP(n,t).some(c=>uy(e,c,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===q.PlantingZone&&uy(e,a,t))}function xu(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(o/Wt),gridY:Math.floor(s/Wt)}}function XS(e,t,n){const o=iS(t,n);return e.sectors[o]||(e.sectors[o]=V1()),e.sectors[o]}function Ep(e,t,n){const o=iS(t,n),s=e.sectors[o];return s?s.health:du}function Ir(e,t,n,o){const{gridX:s,gridY:a}=xu(t,n,o);return Ep(e,s,a)<rS}function VS(e,t,n){return Ep(e,t,n)>=rS}function CP(e,t,n,o,s,a,c){const{gridX:d,gridY:u}=xu(t,s,a),h=XS(e,d,u),p=h.lastAffectedBy[n]||0;if(o-p<aS)return;const m=vl(t,c)?cS:1,S=Z1*m;h.health=Math.max(sS,h.health-S),h.lastWalkTime=o,h.lastAffectedBy[n]=o}function PP(e,t,n,o,s,a){const{gridX:c,gridY:d}=xu(t,o,s),u=XS(e,c,d),h=vl(t,a)?cS:1,p=q1*h;u.health=Math.max(sS,u.health-p),u.lastPlantTime=n}function _P(e,t,n,o,s){let a=0;for(let c=-1;c<=1;c++)for(let d=-1;d<=1;d++){if(c===0&&d===0)continue;const u=((t+c)%o+o)%o,h=((n+d)%s+s)%s;VS(e,u,h)&&a++}return a}function RP({soilDepletion:e,time:t,mapDimensions:{width:n,height:o}}){if(t-e.lastUpdateTime<iE)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/Wt),c=Math.ceil(o/Wt),d=[];for(const u of Object.keys(e.sectors)){const h=Number(u),p=e.sectors[h],m=Math.max(p.lastWalkTime,p.lastPlantTime);if(t-m<J1)continue;const{gridX:S,gridY:v}=oS(h),A=_P(e,S,v,a,c),T=A>0?Q1*(A/8):0,w=K1+T;p.health=Math.min(du,p.health+w*s),p.health>=du&&d.push(h);const E=t-aS*10;for(const C of Object.keys(p.lastAffectedBy)){const _=Number(C);p.lastAffectedBy[_]<E&&delete p.lastAffectedBy[_]}}for(const u of d)delete e.sectors[u]}function kP(e,t){const n=[];for(const o of Object.keys(e.sectors)){const s=Number(o),a=e.sectors[s];if(a.health<t){const{gridX:c,gridY:d}=oS(s);n.push({gridX:c,gridY:d,health:a.health})}}return n}function qS(e,t,n,o,s,a){const c=[],d=n/2,u=o/2,h=t.x-d,p=t.x+d,m=t.y-u,S=t.y+u,v=Math.floor(h/Wt),A=Math.floor((p-.001)/Wt),T=Math.floor(m/Wt),w=Math.floor((S-.001)/Wt),E=Math.ceil(s/Wt),C=Math.ceil(a/Wt);let _=0;for(let M=v;M<=A;M++)for(let P=T;P<=w;P++){_++;const k=(M%E+E)%E,R=(P%C+C)%C;VS(e,k,R)||c.push({gridX:k,gridY:R})}return{depletedSectors:c,totalSectorsCount:_}}function ky(e,t,n,o,s){const{gridX:a,gridY:c}=xu(t,n,o),d=Ep(e,a,c);return 1+(s-1)*Math.sqrt(1-d/du)}const MP={id:$a,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Mt/Ft);if(n.age+=s,n.age>=n.lifespan)return{nextState:nl,data:{...e,enteredAt:o.gameState.time}};if(!Ir(o.gameState.soilDepletion,n.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height)){const c=vl(n.position,o.gameState)?X1:1;n.timeSinceLastBerryRegen+=s*c,n.timeSinceLastBerryRegen>=W1&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:ui.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:or,data:{...e,enteredAt:o.gameState.time,previousState:$a}}:{nextState:$a,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},bP={id:or,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Mt/Ft);if(n.age+=s,n.age>=n.lifespan)return{nextState:nl,data:{...e,enteredAt:o.gameState.time,previousState:or}};if(n.food.length<n.maxFood)return{nextState:$a,data:{...e,enteredAt:o.gameState.time,previousState:or}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=oy){n.timeSinceLastSpreadAttempt=0;const c=o.gameState.time-n.timeSinceLastHarvest>=oy,d=vl(n.position,o.gameState)?j1:1,u=o.gameState.ecosystem.berryBushSpreadChance*d;if(c&&Math.random()<u)return{nextState:eu,data:{...e,enteredAt:o.gameState.time,previousState:or}}}return{nextState:or,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function My(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let o=n.hitpoints;return o+=(n.maxAge-n.age)*.5,o+=n.food.length*2,t+o},0)}var ve=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(ve||{});const Uu={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},ZS={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var es=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(es||{});const wa={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var Te=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectPalisade="SelectPalisade",e.SelectGate="SelectGate",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenTribeModal="OpenTribeModal",e.RecenterCamera="RecenterCamera",e.CloseTribeModal="CloseTribeModal",e))(Te||{});const oh=30,DP=.4,OP=100,NP=72,KS=10,QS=2,by=600,BP=1.5,JS=.1,rh=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,sh=""+new URL("gather-CU75596W.mp3",import.meta.url).href,HP=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,Dy=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,FP=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,LP=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,xP=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,UP=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,GP=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,$P=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var _e=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(_e||{});const WP=new Map([[0,rh],[1,sh],[2,HP],[3,Dy],[4,FP],[5,LP],[6,xP],[12,UP],[13,GP],[7,rh],[8,Dy],[9,sh],[10,sh],[11,rh],[14,$P]]);let Ea,al;function YP(){if(!(typeof window>"u"))return al}function Cp(){if(!(typeof window>"u"))return!Ea&&typeof window.AudioContext=="function"&&(Ea=new window.AudioContext,al=Ea.createGain(),al.connect(Ea.destination),ja(.1,!1)),Ea}function ja(e,t){al&&(al.gain.value=t?0:e/10)}const eT=new Map;let Lc=!1,Oy=!1;async function zP(){if(Oy||Lc)return;const e=Cp();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),Lc=!0,console.log("Starting sound loading...");const t=[];WP.forEach((n,o)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{eT.set(o,a)}).catch(a=>{console.error(`Error loading sound ${_e[o]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),Oy=!0,Lc=!1,console.log("All sounds loaded successfully.")}catch(n){Lc=!1,console.error("An error occurred while loading sounds:",n)}}const Xa=new Map;function Pp(e,t){const n=Cp(),o=YP();if(!n||!o||o.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=eT.get(e);if(!s){console.warn(`Sound buffer not found for type: ${_e[e]}`);return}if(t!=null&&t.trackId&&Xa.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const c=n.createGain(),d=n.createStereoPanner();let u=c;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const h=Le(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),p=J(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(p>by)return;const m=1-Math.pow(p/by,BP);c.gain.value=Math.max(0,m);const S=Math.sin(h.x/p*(Math.PI/2));d.pan.value=isNaN(S)?0:S,c.connect(d),u=d}else{const h=e===_e.GameOver?.4:e===_e.SoundTrack1?1:.2;c.gain.value=h}a.connect(u),u.connect(o),a.start(0),t!=null&&t.trackId&&(Xa.set(t.trackId,{sourceNode:a,gainNode:c}),a.onended=()=>{Xa.delete(t.trackId)})}function ah(e,t=1){const n=Xa.get(e),o=Cp();if(n&&o){const{sourceNode:s,gainNode:a}=n,c=o.currentTime;a.gain.setValueAtTime(a.gain.value,c),a.gain.linearRampToValueAtTime(0,c+t),s.stop(c+t),s.onended=null,Xa.delete(e)}}function ke(e,t,n){const o=bt(e.gameState);o&&Pp(t,{position:n,listenerPosition:o.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}const Oe={create(){return{data:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e}},jP="tribeSplit_phase",Gu="tribeSplit_strategy",tT="tribeSplit_targetPosition",_p="tribeSplit_targetBuildingId",Rp="tribeSplit_familyIds",nT="tribeSplit_lastFailureTime";function XP(e,t){Oe.set(e,jP,"idle"),Oe.delete(e,Gu),Oe.delete(e,tT),Oe.delete(e,_p),Oe.delete(e,Rp),Oe.set(e,nT,t)}function VP(e,t){const n=Oe.get(e,nT);return n?t-n>=NP:!0}function iT(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(YS(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!VP(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const o=t.entities.entities[e.leaderId];if(!o||o.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=Ss(Qi(t,o));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(fP(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const c=Ho(e.leaderId,t).filter(v=>v.isAdult);if(c.length<oh)return{canSplit:!1,reason:"Tribe too small"};const u=vu(e,t).length+1,p=vu(o,t).length+1;if(u>=p&&u>oh)return{canSplit:!0,progress:1,strategy:Ny(e,t)};const m=Math.max(c.length*DP,oh),S=u/m;if(u>=m){const v=Ny(e,t);return{canSplit:!0,progress:S,strategy:v}}return{canSplit:!1,progress:S,reason:`Family too small: ${u} < ${m}`}}function Ny(e,t){if(!e.leaderId)return"migration";const n=t;if(!(li(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===q.StorageSpot&&a.isConstructed);return s.length>0&&s.find(c=>J(e.position,c.position,t.mapDimensions.width,t.mapDimensions.height)<=OP)?"concentration":"migration"}function qP(e,t){if(!e.aiBlackboard)return!1;const n=Oe.get(e.aiBlackboard,Gu);if(!n)return!1;const o=vu(e,t),s=[e.id,...o.map(a=>a.id)];return Oe.set(e.aiBlackboard,Rp,s),n==="migration"?KP(e,t):n==="concentration"?QP(e,t):!1}function ZP(e,t,n){if(Zi(e,n,30))return!1;const s=li(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function KP(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,o=t.mapDimensions.height,s=Math.min(n,o)/2,a=50,c=50;for(let d=0;d<=s;d+=a){const u=d===0?1:Math.max(8,Math.ceil(2*Math.PI*d/c)),h=d===0?0:2*Math.PI/u;for(let p=0;p<u;p++){const m=p*h,S=Math.cos(m)*d,v=Math.sin(m)*d,A=e.position.x+S,T=e.position.y+v,w={x:(A%n+n)%n,y:(T%o+o)%o};if(ZP(w,e.leaderId,t))return Oe.set(e.aiBlackboard,tT,w),!0}}return!1}function QP(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const o=t.search.building.byProperty("ownerId",e.leaderId).filter(c=>c.buildingType===q.StorageSpot&&c.isConstructed);if(o.length===0)return!1;let s=null,a=1/0;for(const c of o){const d=J(e.position,c.position,t.mapDimensions.width,t.mapDimensions.height);d<a&&(a=d,s=c)}return s?(Oe.set(e.aiBlackboard,_p,s.id),!0):!1}function JP(e,t){var u;if(!e.aiBlackboard)return!1;const n=Oe.get(e.aiBlackboard,Gu),o=Oe.get(e.aiBlackboard,Rp);if(!n||!o)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=yu(),c=Yt[Math.floor(Math.random()*Yt.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:c},e.tribeControl={diplomacy:{}},s&&((u=s.tribeControl)!=null&&u.diplomacy)&&(s.tribeControl.diplomacy[e.id]=Rt.Hostile);for(const h of o){if(h===e.id)continue;const p=t.entities.entities[h];!p||p.type!=="human"||(p.leaderId=e.id,p.tribeInfo={tribeBadge:a,tribeColor:c})}if(n==="concentration"){const h=Oe.get(e.aiBlackboard,_p);if(h){const p=t.entities.entities[h];p&&p.type==="building"&&(p.ownerId=e.id)}}return ol(t,{type:yr.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:hu,targetEntityIds:[e.id],highlightedEntityIds:o}),ke({gameState:t},_e.TribeSplit,e.position),XP(e.aiBlackboard,t.time),!0}function e_(e,t){Oe.set(e,Gu,t)}function oT(e,t){const n=iT(e,t);return{canSplit:n.canSplit,progress:n.progress}}function rT(e,t){if(!e.aiBlackboard)return;const n=iT(e,t);!n.canSplit||!n.strategy||(e_(e.aiBlackboard,n.strategy),qP(e,t)&&JP(e,t))}const t_=20,ci=30,n_=.5,i_=.3,o_=2,r_=50;function kp(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>No&&n.push({type:ve.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const c=Ke(t,e,"berryBush",Qe,h=>h.food.length>0),d=Ke(t,e,"corpse",Qe,h=>h.food.length>0);let u=null;c&&d?u=J(t.position,c.position,e.mapDimensions.width,e.mapDimensions.height)<=J(t.position,d.position,e.mapDimensions.width,e.mapDimensions.height)?c:d:u=c||d,u&&n.push({type:ve.Gather,action:"gathering",key:"e",targetEntity:u})}const o=Ke(t,e,"human",Qe,c=>Rs(t,c,e));if(o&&n.push({type:ve.Procreate,action:"procreating",key:"r",targetEntity:o}),t.food.length>0&&t.isAdult){const c=Ke(t,e,"human",Qe,d=>{const u=d;return!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&u.hunger>=No});c&&n.push({type:ve.FeedChild,action:"feeding",key:"h",targetEntity:c})}const s=Ke(t,e,"human",An,c=>ml(t,c,e))??Ke(t,e,"predator",An)??Ke(t,e,"prey",An);if(s&&n.push({type:ve.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(c=>c.type===ui.Berry).length>=mr&&n.push({type:ve.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const c=Ke(t,e,"building",ci,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0&&u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity});c&&n.push({type:ve.Deposit,action:"idle",key:"x",targetEntity:c})}if(t.food.length<t.maxFood&&t.isAdult){const c=Ke(t,e,"building",ci,d=>{const u=d;return u.buildingType==="storageSpot"&&u.ownerId===t.leaderId&&u.isConstructed&&u.storedItems.length>0});c&&n.push({type:ve.Retrieve,action:"idle",key:"z",targetEntity:c})}if(((a=t.heldItem)==null?void 0:a.type)===Lt.Wood){const c=Ke(t,e,"building",ci,d=>{const u=d;return u.buildingType===q.Bonfire&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)});c&&n.push({type:ve.Deposit,action:"depositing",key:"x",targetEntity:c})}if(oT(t,e).canSplit&&n.push({type:ve.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const c=Ke(t,e,"tree",Ou,d=>d.wood&&d.wood.length>0);c&&n.push({type:ve.Chop,action:"chopping",key:"c",targetEntity:c})}return n}const s_={id:eu,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o,a=o.deltaTime*(Mt/Ft);if(n.age+=a,n.age>=n.lifespan)return{nextState:nl,data:{...e,enteredAt:s.time,previousState:eu}};const c=vS(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Zi(c,s,15)||Il(s.entities,c,s.time),{nextState:or,data:{...e,enteredAt:s.time,previousState:eu}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},a_={id:nl,update:e=>({nextState:nl,data:e}),onEnter:(e,t)=>(Ei(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},l_=[MP,bP,s_,a_],ft="humanIdle",Si="humanMoving",Fa="humanEating",Ms="humanGathering",Va="humanDepositing",qa="humanRetrieving",sr="humanProcreating",Fo="humanAttacking",nu="humanPlanting",Mp="humanChopping",c_={id:ft,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:Fo,data:{...e,enteredAt:o.gameState.time,previousState:ft,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:(n.hunger>=dS?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:o.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:Si,data:{...e,enteredAt:o.gameState.time,previousState:ft,target:n.target}}:n.activeAction==="gathering"?{nextState:Ms,data:{...e,enteredAt:o.gameState.time,previousState:ft,target:n.target}}:n.activeAction==="eating"?{nextState:Fa,data:{...e,enteredAt:o.gameState.time,previousState:ft}}:n.activeAction==="planting"&&n.target?{nextState:nu,data:{...e,enteredAt:o.gameState.time,previousState:ft,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:Va,data:{...e,enteredAt:o.gameState.time,previousState:ft}}:n.activeAction==="retrieving"?{nextState:qa,data:{...e,enteredAt:o.gameState.time,previousState:ft}}:n.activeAction==="chopping"&&n.target?{nextState:Mp,data:{...e,enteredAt:o.gameState.time,previousState:ft,state:"chopping"}}:{nextState:ft,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function sT(e,t=1){let n=rE;return e.hunger>=dS&&(n*=sE),e.age>=lE&&(n*=cE),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const Se=10,Ts=ht,u_=100;function bp(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(o/Se),c=Math.floor(s/Se),d=Math.ceil(t/Se);return c*d+a}function ll(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{x:Math.floor(o/Se),y:Math.floor(s/Se)}}function $u(e,t){const n=Math.ceil(e/Se),o=Math.ceil(t/Se),s=n*o;return{obstacleCount:new Uint16Array(s),gateRefCount:{},paddingCount:new Uint16Array(s),gatePaddingRefCount:{}}}function Ar(e,t,n,o=!0){var s,a,c;if(o){const d=e.obstacleCount[t]+e.paddingCount[t];if(d===0)return!0;if(n!==void 0){const u=(((s=e.gateRefCount[n])==null?void 0:s[t])||0)+(((a=e.gatePaddingRefCount[n])==null?void 0:a[t])||0);return d===u}return!1}else{const d=e.obstacleCount[t];if(d===0)return!0;if(n!==void 0){const u=((c=e.gateRefCount[n])==null?void 0:c[t])||0;return d===u}return!1}}function Is(e,t,n,o,s=null,a=0){const{width:c,height:d}=e.mapDimensions,u=Math.ceil(c/Se),h=Math.ceil(d/Se),p=n+a,m=Math.ceil(p/Se),S=ll(t,c,d),v=e.navigationGrid,A=v.obstacleCount.length;s!==null&&(v.gateRefCount[s]||(v.gateRefCount[s]=new Uint16Array(A)),v.gatePaddingRefCount[s]||(v.gatePaddingRefCount[s]=new Uint16Array(A)));for(let T=-m;T<=m;T++)for(let w=-m;w<=m;w++){const E=(S.x+w+u)%u,C=(S.y+T+h)%h,_=E*Se+Se/2,M=C*Se+Se/2,P=J(t,{x:_,y:M},c,d);if(P<=p){const k=C*u+E,R=P<=n,H=a>0&&!R?Math.max(1,Math.floor(u_*(1-(P-n)/a))):1;o?R?(v.obstacleCount[k]++,s!==null&&v.gateRefCount[s][k]++):(v.paddingCount[k]+=H,s!==null&&(v.gatePaddingRefCount[s][k]+=H)):R?(v.obstacleCount[k]>0&&v.obstacleCount[k]--,s!==null&&v.gateRefCount[s]&&v.gateRefCount[s][k]>0&&v.gateRefCount[s][k]--):(v.paddingCount[k]>=H?v.paddingCount[k]-=H:v.paddingCount[k]=0,s!==null&&v.gatePaddingRefCount[s]&&v.gatePaddingRefCount[s][k]>=H?v.gatePaddingRefCount[s][k]-=H:s!==null&&v.gatePaddingRefCount[s]&&(v.gatePaddingRefCount[s][k]=0))}}}function Ca(e,t,n,o){const{width:s,height:a}=e.mapDimensions,c=Le(t,n,s,a),d=Math.sqrt(c.x*c.x+c.y*c.y);if(d<.001)return!1;const u=Math.ceil(d/(Se/2)),h=c.x/u,p=c.y/u,m=c.x/d,v=-(c.y/d),A=m,T=o.radius*.85,w=e.navigationGrid;for(let E=0;E<=u;E++){const C={x:t.x+h*E,y:t.y+p*E},_=[C,{x:C.x+v*T,y:C.y+A*T},{x:C.x-v*T,y:C.y-A*T},{x:C.x+v*T*.5,y:C.y+A*T*.5},{x:C.x-v*T*.5,y:C.y-A*T*.5}];for(const M of _){const P=bp(M,s,a);if(!Ar(w,P,o.leaderId,!1))return!0}}return!1}function d_(e,t,n,o,s){const a=ll(t,n,o),c=Math.ceil(n/Se),d=Math.ceil(o/Se);for(let u=0;u<20;u++)for(let h=-u;h<=u;h++)for(let p=-u;p<=u;p++){if(u>0&&Math.abs(p)!==u&&Math.abs(h)!==u)continue;const m=(a.x+p+c)%c,S=(a.y+h+d)%d,v=S*c+m;if(Ar(e,v,s,!0))return{x:m*Se+Se/2,y:S*Se+Se/2}}return t}function aT(e,t,n,o){var M;const{width:s,height:a}=e.mapDimensions,c=Math.ceil(s/Se),d=Math.ceil(a/Se),u=e.navigationGrid,h=bp(n,s,a);let p=n;Ar(u,h,o.leaderId,!1)||(p=d_(u,n,s,a,o.leaderId));const m=ll(t,s,a),S=ll(p,s,a);if(m.x===S.x&&m.y===S.y)return{path:[p],iterations:0};const v=[m.y*c+m.x],A=new Map,T=new Map,w=new Map,E=m.y*c+m.x;T.set(E,0),w.set(E,By(m,S,c,d));const C=5e3;let _=0;for(;v.length>0&&_<C;){_++;let P=v[0],k=w.get(P)??1/0,R=0;for(let F=1;F<v.length;F++){const Y=w.get(v[F])??1/0;Y<k&&(k=Y,P=v[F],R=F)}const H=P%c,G=Math.floor(P/c);if(H===S.x&&G===S.y)return{path:f_(A,P,c,p),iterations:_};v.splice(R,1);for(let F=-1;F<=1;F++)for(let Y=-1;Y<=1;Y++){if(Y===0&&F===0)continue;const Z=(H+Y+c)%c,W=(G+F+d)%d,j=W*c+Z;if(!Ar(u,j,o.leaderId,!1))continue;let ee=Y!==0&&F!==0?1.414:1;const se=u.paddingCount[j],ae=o.leaderId!==void 0&&((M=u.gatePaddingRefCount[o.leaderId])==null?void 0:M[j])||0,Q=Math.max(0,se-ae);Q>0&&(ee+=5+Q*.5);const re=(T.get(P)??0)+ee;re<(T.get(j)??1/0)&&(A.set(j,P),T.set(j,re),w.set(j,re+By({x:Z,y:W},S,c,d)),v.includes(j)||v.push(j))}}return{path:null,iterations:_}}function By(e,t,n,o){let s=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);s>n/2&&(s=n-s),a>o/2&&(a=o-a);const c=1;return c*(s+a)+(1.414-2*c)*Math.min(s,a)}function f_(e,t,n,o){const s=[o];let a=t;const c=new Set;for(;e.has(a)&&!c.has(a);)c.add(a),a=e.get(a),s.unshift({x:a%n*Se+Se/2,y:Math.floor(a/n)*Se+Se/2});return s.shift(),s}const xc=10,h_=.2,Hy=15;class p_{constructor(){Gt(this,"id",Si)}update(t,n){var T;const{entity:o,updateContext:s}=n;if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:Fo,data:{...t,enteredAt:s.gameState.time,previousState:Si,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:ft,data:{...t,enteredAt:s.gameState.time,previousState:Si}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(T=n.updateContext.gameState.entities.entities[o.target])==null?void 0:T.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*xc*2,y:o.position.y+o.direction.y*xc*2}),!a)return{nextState:ft,data:{...t,enteredAt:s.gameState.time,previousState:Si}};const{width:c,height:d}=s.gameState.mapDimensions;if(J(o.position,a,c,d)<xc)return{nextState:ft,data:{...t,enteredAt:s.gameState.time,previousState:Si}};const h=Ca(s.gameState,o.position,a,o);if(o.path&&o.pathTarget&&J(o.pathTarget,a,c,d)>40&&(o.path=void 0,o.pathTarget=void 0),h&&!o.path)return s.gameState.pathfindingQueue.includes(o.id)||s.gameState.pathfindingQueue.push(o.id),o.acceleration=0,{nextState:Si,data:t};let p=a;if(o.path&&o.path.length>0){const w=s.gameState.time;if(w-(t.lastPruneTime??0)>h_)if(t.lastPruneTime=w,!Ca(s.gameState,o.position,a,o))o.path=[a];else{const C=Math.min(o.path.length-1,Hy);for(let _=C;_>0;_--){const M=o.path[_];if(!Ca(s.gameState,o.position,M,o)){o.path.splice(0,_);break}}}if(o.path.length===0?p=a:p=o.path[0],Ca(s.gameState,o.position,p,o)){let C=!1;const _=Math.min(o.path.length-1,Hy);for(let M=1;M<=_;M++)if(!Ca(s.gameState,o.position,o.path[M],o)){o.path.splice(0,M),p=o.path[0],C=!0;break}if(!C)return o.path=void 0,o.pathTarget=void 0,o.acceleration=0,{nextState:Si,data:t}}J(o.position,p,c,d)<xc&&(o.path.shift(),o.path.length>0?p=o.path[0]:p=a)}const m=Le(o.position,p,c,d),S=J(o.position,p,c,d),v=mt(m);if(S>Nh){const w=ru(v,-Wa),E=ru(v,Wa),C=[v,w,E],_=C.map((P,k)=>{const R=jn(o.position,lt(P,Nh)),H={x:(R.x%c+c)%c,y:(R.y%d+d)%d},G=ky(s.gameState.soilDepletion,H,c,d,sy),Y=Math.cos(k===0?0:Wa);return G*Y});let M=0;for(let P=1;P<_.length;P++)_[P]>_[M]&&(M=P);o.direction=C[M]}else o.direction=v;const A=ky(s.gameState.soilDepletion,o.position,c,d,sy);return o.acceleration=sT(o,A),{nextState:Si,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const g_=new p_,m_={id:Fa,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction!=="eating"?{nextState:ft,data:{...e,enteredAt:o.gameState.time,previousState:Fa}}:(n.food.length>0&&(!n.eatingCooldownTime||o.gameState.time>=n.eatingCooldownTime)&&n.hunger>No&&(n.hunger=Math.max(0,n.hunger-No),n.food.pop(),n.eatingCooldownTime=o.gameState.time+1,ke(o,_e.Eat,n.position),(!n.lastEatingEffectTime||o.gameState.time-n.lastEatingEffectTime>2)&&(Fe(o.gameState,Pe.Eating,n.position,Xe,n.id),n.lastEatingEffectTime=o.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:ft,data:{...e,enteredAt:o.gameState.time,previousState:Fa}}:{nextState:Fa,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class y_{constructor(){Gt(this,"id",Ms)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const v_=new y_,S_={id:Va,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:ft,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Va}}:{nextState:Va,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},T_={id:qa,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:ft,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:qa}}:{nextState:qa,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},I_=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),A_=(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(s.time<(e.procreationEndTime||0))return{nextState:sr,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<Yn&&a.hunger<Yn&&!n.procreationCooldown&&!a.procreationCooldown){const c=n.gender==="female"?n:a.gender==="female"?a:void 0,d=n.gender==="male"?n:a.gender==="male"?a:void 0;c&&d&&(c.isPregnant=!0,c.gestationTime=uE,c.pregnancyFatherId=d.id,n.procreationCooldown=ay,a.procreationCooldown=ay,ke(o,_e.Procreate,c.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:ft,data:{...e,enteredAt:s.time,previousState:sr}}},w_={id:sr,onEnter:I_,update:A_},E_={id:Fo,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:ft,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:ft,data:{...e}};const o=J(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=Le(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=mt(s),o<=Bo||o<=An&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=sT(t.entity),{nextState:Fo,data:e}}},C_={id:nu,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(s.time-e.enteredAt>=z1){const c=n.food.filter(u=>u.type===ui.Berry).length,d=Ir(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(c>=mr&&!d){for(let u=0;u<mr;u++){const h=n.food.findIndex(p=>p.type===ui.Berry);h>-1&&n.food.splice(h,1)}Il(s.entities,e.plantingSpot,s.time),PP(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:ft,data:{...e,enteredAt:s.time,previousState:nu}}}return{nextState:nu,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class P_{constructor(){Gt(this,"id",Mp)}update(t,n){const{entity:o,updateContext:s}=n;return o.activeAction!=="chopping"||o.heldItem?{nextState:ft,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const __=new P_,R_=[c_,g_,m_,v_,S_,T_,w_,E_,C_,__],ii="preyIdle",_o="preyMoving",La="preyGrazing",xa="preyProcreating",k_={id:ii,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:_o,data:{...e,enteredAt:o.gameState.time,previousState:ii,target:n.target}}:n.activeAction==="grazing"?{nextState:La,data:{...e,enteredAt:o.gameState.time,previousState:ii}}:n.activeAction==="procreating"?{nextState:xa,data:{...e,enteredAt:o.gameState.time,previousState:ii}}:{nextState:ii,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},lT=12,Wu=120,Fy=50,M_=12,cT=30,b_=2,As=50,D_=100,uT=2,O_=.9,N_=1,B_=50,H_=.5,dT=20,Yu=140,Ly=40,F_=12,fT=40,L_=3,ws=60,Pr=40,x_=50,hT=320,pT=25,U_=60,gT=2,G_=90,$_=.7,W_=1,mT=3,Dp=80,yT=10,zu=80,vT=40,ST=2,Tu=30,rs=20,ur=40,ss=24,dr=48,as=12,fr=40,ls=20,hr=60,cs=.75,ko=2.5,us=.25,Mo=2,TT=4;function Y_(e){let t=M_;return e.isAdult||(t*=.7),e.hunger>=B_&&(t*=H_),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function z_(e,t){const n=e>>16&255,o=e>>8&255,s=e&255,a=t>>16&255,c=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),h=Math.floor((o+c)/2),p=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|h<<8|p}function cl(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const lh=10;class j_{constructor(){Gt(this,"id",_o)}update(t,n){var u;const{entity:o,updateContext:s}=n;if(o.activeAction!=="moving")return{nextState:ii,data:{...t,enteredAt:s.gameState.time,previousState:_o}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[o.target])==null?void 0:u.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*lh*2,y:o.position.y+o.direction.y*lh*2}),!a)return{nextState:ii,data:{...t,enteredAt:s.gameState.time,previousState:_o}};const c=Le(o.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return o.direction=mt(c),o.acceleration=Y_(o),J(o.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<lh?{nextState:ii,data:{...t,enteredAt:s.gameState.time,previousState:_o}}:{nextState:_o,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const X_=new j_,V_={id:La,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:_o,data:{...e,enteredAt:o.gameState.time,previousState:La,target:n.target}}:n.activeAction!=="grazing"?{nextState:ii,data:{...e,enteredAt:o.gameState.time,previousState:La}}:{nextState:La,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},q_={id:xa,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:_o,data:{...e,enteredAt:o.gameState.time,previousState:xa,target:n.target}}:n.activeAction!=="procreating"?{nextState:ii,data:{...e,enteredAt:o.gameState.time,previousState:xa}}:{nextState:xa,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},Z_=[k_,X_,V_,q_],hn="predatorIdle",Co="predatorMoving",Ui="predatorAttacking",ts="predatorProcreating",pr="predatorEating",K_={id:hn,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="eating"?{nextState:pr,data:{...e,enteredAt:o.gameState.time,previousState:hn,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:Ui,data:{...e,enteredAt:o.gameState.time,previousState:hn,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:n.activeAction==="moving"?{nextState:Co,data:{...e,enteredAt:o.gameState.time,previousState:hn,target:n.target}}:n.activeAction==="procreating"?{nextState:ts,data:{...e,enteredAt:o.gameState.time,previousState:hn}}:{nextState:hn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function IT(e){let t=F_;return e.hunger>=G_&&(t*=$_),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function Q_(e,t){const n=e>>16&255,o=e>>8&255,s=e&255,a=t>>16&255,c=t>>8&255,d=t&255;let u=Math.floor((n+a)/2),h=Math.floor((o+c)/2),p=Math.floor((s+d)/2);return Math.random()<.05&&(u=Math.max(0,Math.min(255,u+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),u<<16|h<<8|p}function ul(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const ch=12;class J_{constructor(){Gt(this,"id",Co)}update(t,n){var u;const{entity:o,updateContext:s}=n;if(o.activeAction==="eating")return{nextState:pr,data:{...t,enteredAt:s.gameState.time,previousState:Co,preyId:o.attackTargetId,eatingStartTime:s.gameState.time}};if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:Ui,data:{...t,enteredAt:s.gameState.time,previousState:Co,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:hn,data:{...t,enteredAt:s.gameState.time,previousState:Co}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(u=n.updateContext.gameState.entities.entities[o.target])==null?void 0:u.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*ch*2,y:o.position.y+o.direction.y*ch*2}),!a)return{nextState:hn,data:{...t,enteredAt:s.gameState.time,previousState:Co}};const c=Le(o.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return o.direction=mt(c),o.acceleration=IT(o),J(o.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<ch?{nextState:hn,data:{...t,enteredAt:s.gameState.time,previousState:Co}}:{nextState:Co,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const eR=new J_,tR={id:Ui,update:(e,t)=>{const{entity:n,updateContext:o}=t;if(n.activeAction==="eating")return{nextState:pr,data:{...e,enteredAt:o.gameState.time,previousState:Ui,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:Ui}};const s=o.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:Ui}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:Ui}};const c=J(n.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height),d=Le(n.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height);return n.direction=mt(d),c>Pr?n.acceleration=IT(n):n.acceleration=0,{nextState:Ui,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},nR={id:ts,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="eating"?{nextState:pr,data:{...e,enteredAt:o.gameState.time,previousState:ts,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:Ui,data:{...e,enteredAt:o.gameState.time,previousState:ts,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:n.activeAction!=="procreating"?{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:ts}}:{nextState:ts,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},iR={id:pr,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction!=="eating"?{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:pr}}:{nextState:pr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},oR=[K_,eR,tR,nR,iR],rR=24*30*10,Lo=24*5,sR=48,aR=72,wr=20,lR="#3b2016",cR="#5c3a21",uR="#376d31",dR="#76a331",fR="#a6c44a",hR="rgba(0, 0, 0, 0.25)",pR=60,gR=24*7,Vi=.01,Ua=.5,xy=1,ju=5,mR={id:oi,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.age>=n.lifespan?{nextState:Tr,data:{enteredAt:o.gameState.time,previousState:oi}}:n.age>=Lo?{nextState:zn,data:{enteredAt:o.gameState.time,previousState:oi}}:{nextState:oi,data:e}}},yR={id:zn,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Mt/Ft);return n.age>=n.lifespan?{nextState:Tr,data:{...e,enteredAt:o.gameState.time,previousState:zn}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=gR&&(n.timeSinceLastSpreadAttempt=0,Math.random()<o.gameState.ecosystem.treeSpreadChance)?{nextState:Ai,data:{...e,enteredAt:o.gameState.time,previousState:zn}}:{nextState:zn,data:e})}},vR={id:Ai,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(n.age>=n.lifespan)return{nextState:Tr,data:{...e,enteredAt:s.time,previousState:Ai}};const a=vS(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Zi(a,s,25)||Es(s.entities,a,s.time),{nextState:zn,data:{...e,enteredAt:s.time,previousState:Ai}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},SR={id:jt,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=sR?{nextState:wi,data:{enteredAt:n.gameState.time,previousState:jt}}:{nextState:jt,data:e}}},TR={id:wi,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=aR?{nextState:Tr,data:{enteredAt:n.gameState.time,previousState:wi}}:{nextState:wi,data:e}}},IR={id:Tr,update:e=>({nextState:Tr,data:e}),onEnter:(e,t)=>(Ei(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},AR=[mR,yR,vR,SR,TR,IR],Uy=[...l_,...R_,...Z_,...oR,...AR];function wR(e,t,n){const o=B1(e,Uy);if(!o)return F1(e),[e,t];const{nextState:s,data:a}=o.update(t,n);return H1(e,s)?[s,N1(o,s,a,n,Uy)]:[s,a]}function Op(e,t){return`${e},${t}`}const Gy=Mt*10;function AT(e){return e%Gy/Gy}function wT(e){const t=AT(e);return(Math.cos(t*2*Math.PI)+1)/2}function ER(e){const t=AT(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function ET(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(o/Gi),gridY:Math.floor(s/Gi)}}function dl(e,t,n,o,s){const{gridX:a,gridY:c}=ET(t,o,s),d=Op(a,c),u=e.sectors[d],h=u?u.currentTemperature:CS,m=(wT(n)*2-1)*lC;return h+m}function CR(e){const{sectors:t}=e.temperature,{width:n,height:o}=e.mapDimensions,s=Math.ceil(n/Gi),a=Math.ceil(o/Gi);for(const d in t){const u=t[d];u.currentTemperature=u.baseTemperature}const c=Math.ceil(Ya/Gi);Object.values(e.entities.entities).forEach(d=>{if(d.type==="building"){const u=d;if(u.buildingType==="bonfire"&&u.isConstructed&&u.fuelLevel>0){const h=ET(u.position,n,o);for(let p=-c;p<=c;p++)for(let m=-c;m<=c;m++){const S=(h.gridX+m+s)%s,v=(h.gridY+p+a)%a,A=Op(S,v),T=t[A];if(T){const w={x:(S+.5)*Gi,y:(v+.5)*Gi},E=J(u.position,w,n,o);if(E<Ya){const C=iC*(1-E/Ya);T.currentTemperature+=C}}}}}})}function CT(e,t){const n={},o=Math.ceil(e/Gi),s=Math.ceil(t/Gi);for(let a=0;a<s;a++)for(let c=0;c<o;c++){const d=Op(c,a);let u=CS;const h=a/s*10-5;u+=h,u+=Math.random()*4-2,Math.random()<.05&&(u-=10),n[d]={baseTemperature:u,currentTemperature:u}}return{sectors:n}}function PR(e,t,n){var d;const{gameState:o}=t,s=n*(Mt/Ft);e.isAdult=e.age>=cp;const a=dl(o.temperature,e.position,o.time,o.mapDimensions.width,o.mapDimensions.height);if(a<cr){const u=(cr-a)*nC*s;e.hitpoints-=u}if(e.movementSlowdown&&o.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<tn){const u=1-e.hunger/tn*TE,h=SE*u*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+h)}if(e.hunger+=n*(Ta/(Mt/Ft)),e.hunger>=tn)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-No);else{const u=IE*s;e.hitpoints-=u}if(e.age+=n/Du,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((Ta*dE-Ta)/(Mt/Ft)),(!e.lastPregnantEffectTime||o.time-e.lastPregnantEffectTime>sl*3)&&(Fe(o,Pe.Pregnant,e.position,sl,e.id),e.lastPregnantEffectTime=o.time),e.gestationTime<=0&&(BM(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===ks&&(e.radius=ht):e.hunger+=n*((Ta*fE-Ta)/(Mt/Ft)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const u=[];if(e.motherId){const h=o.entities.entities[e.motherId];h&&u.push(h)}if(e.fatherId){const h=o.entities.entities[e.fatherId];h&&u.push(h)}for(const h of u)if(h.age>=up&&h.hunger>=pE&&J(e.position,h.position,o.mapDimensions.width,o.mapDimensions.height)<=gE){e.food.pop(),h.hunger=Math.max(0,h.hunger-No),e.feedParentCooldownTime=mE;break}}let c;if(e.hitpoints<=0?a<cr?c="hypothermia":e.hunger>=tn?c="hunger":c="killed":e.age>=e.maxAge&&(c="oldAge"),c){if(e.leaderId===e.id){const u=Ss(Qi(o,e));if(u){u.leaderId=u.id,u.tribeInfo=e.tribeInfo,u.tribeControl=e.tribeControl??{diplomacy:{}};const h=o;pu(o,e.id,u.id);const p=h.search.human.byProperty("leaderId",e.id);for(const v of p)v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const m=h.search.building.byProperty("ownerId",e.id);for(const v of m)v.ownerId=u.id;for(const v of vu(u,o))v.leaderId=u.id,v.tribeInfo=u.tribeInfo;const S=Lu(o).filter(v=>v.leaderId!==u.id&&v.leaderId!==e.id);for(const v of S){const A=o.entities.entities[v.leaderId];if((d=A==null?void 0:A.tribeControl)!=null&&d.diplomacy){const T=A.tribeControl.diplomacy[e.id];T!==void 0&&(A.tribeControl.diplomacy[u.id]=T,delete A.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const u=Ss(Qi(o,e));u?(u.isPlayer=!0,o.generationCount++):(o.gameOver=!0,o.causeOfGameOver=c,ol(o,{identifier:"no_heir",type:yr.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}DM(o.entities,e.position,e.gender,e.age,e.radius,e.id,o.time,e.food,e.hunger),Ei(o.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function _R(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/yE);const o=Math.floor(yS*(1-e.decayProgress));e.food.length>o&&e.food.splice(o),e.decayProgress>=1&&e.food.length<=0&&Ei(t.gameState.entities,e.id)}function RR(e,t,n){const o=n*(Mt/Ft);e.age+=n/Du,e.isAdult=e.age>=uT;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=Wu){const c=TT*o;e.hitpoints-=c}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const c={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};c.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,c.x)),c.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,c.y));const d=Math.random()<.5?"male":"female",u=e,h=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let p;if(h)p=z_(u.geneCode,h.geneCode);else{p=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}Cs(t.gameState.entities,c,d,0,cT*.5,p,e.id,e.fatherId,e.aiType),Fe(t.gameState,Pe.Procreation,e.position,sl,e.id),ke(t,_e.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=o,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=lT&&(a=!0),a&&(OM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Ei(t.gameState.entities,e.id))}function kR(e,t,n){const o=n*(Mt/Ft);e.age+=n/Du,e.isAdult=e.age>=mT;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=Yu){const c=TT*o;e.hitpoints-=c}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const c={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};c.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,c.x)),c.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,c.y));const d=Math.random()<.5?"male":"female",u=e,h=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let p;if(h)p=Q_(u.geneCode,h.geneCode);else{p=u.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}Ps(t.gameState.entities,c,d,0,fT*.6,p,e.id,e.pregnancyFatherId,e.aiType),Fe(t.gameState,Pe.Procreation,e.position,sl,e.id),ke(t,_e.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=o,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=o,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=dT&&(a=!0),a&&(NM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Ei(t.gameState.entities,e.id))}var xo=(e=>(e[e.TaskBased=0]="TaskBased",e))(xo||{}),V=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e[e.HumanDiplomacy=25]="HumanDiplomacy",e[e.HumanPlacePalisade=26]="HumanPlacePalisade",e[e.HumanPlaceGate=27]="HumanPlaceGate",e[e.HumanAttackBuilding=28]="HumanAttackBuilding",e[e.AnimalFlee=29]="AnimalFlee",e[e.AnimalGraze=30]="AnimalGraze",e[e.AnimalHunt=31]="AnimalHunt",e[e.AnimalAttack=32]="AnimalAttack",e[e.AnimalProcreate=33]="AnimalProcreate",e[e.AnimalWander=34]="AnimalWander",e[e.AnimalFeedChild=35]="AnimalFeedChild",e[e.AnimalSeekFoodFromParent=36]="AnimalSeekFoodFromParent",e[e.AnimalHerd=37]="AnimalHerd",e[e.AnimalTerritorial=38]="AnimalTerritorial",e[e.AnimalPack=39]="AnimalPack",e))(V||{}),N=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(N||{});const Dt=3,MR=250,PT=.8,bR=100,DR=5,Gh="currentAiTask",_T="lastTaskResult",RT="lastTaskMessage",$h="taskHistory";function Iu({aiBlackboard:e}){return Oe.get(e,Gh)||null}function qi({aiBlackboard:e},t){t?Oe.set(e,Gh,t):Oe.delete(e,Gh)}function OR(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function NR(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function kT(e,t,n,o){const s=t.type===V.Wait?BR:o[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=N.Failure;const[c,d,u]=NR(a);if(Oe.set(e.aiBlackboard,_T,c),Oe.set(e.aiBlackboard,RT,d),c!==N.Running){const h=Oe.get(e.aiBlackboard,$h)||[];if(h.unshift({type:t.type,result:c,completedAtTick:n.gameState.time,message:d}),h.length>5&&h.pop(),Oe.set(e.aiBlackboard,$h,h),delete n.gameState.tasks[t.id],qi(e,null),c===N.Success){const p=u||t.nextTask;p&&(n.gameState.tasks[p.id]=p,p.claimedByEntityId=e.id,qi(e,p.id))}}return c}function et(e){return 1/(1+e/MR)}function Sl(e,t,n){for(let o=0;o<n.length;o++){const s=n[o];if(!s.producer)continue;const a=s.producer(e,t);for(const c in a){const d=a[c],u=t.gameState.tasks[c];t.gameState.tasks[c]=d,u&&(t.gameState.tasks[c].claimedByEntityId=u.claimedByEntityId)}}}const Uc=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:V.Wait,creatorEntityId:e.id,validUntilTime:t+Dt}),BR={type:V.Wait,executor:(e,t,n)=>n.gameState.time>=e.validUntilTime-1?[N.Success,"Wait complete"]:[N.Running,"Waiting"]};function tt(e){const{type:t,requireAdult:n,autopilotBehavior:o,producer:s,scorer:a,executor:c}=e;return{type:t,producer:s,scorer:a?(h,p,m)=>n&&!h.isAdult||o&&h.isPlayer&&!m.gameState.autopilotControls.behaviors[o]?null:a(h,p,m):void 0,executor:c?(h,p,m)=>n&&!p.isAdult||o&&p.isPlayer&&!m.gameState.autopilotControls.behaviors[o]?N.Failure:m.gameState.autopilotControls.activeAutopilotAction&&h.type!==V.HumanPlayerCommand&&p.isPlayer?[N.Failure,"Autopilot action active",{id:`player-command-${p.id}`,type:V.HumanPlayerCommand,position:p.position,creatorEntityId:p.id,validUntilTime:m.gameState.time+Dt}]:c(h,p,m):void 0}}const HR=tt({type:V.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>Bh&&e.food.length>0){const o=`eat-task-${e.id}`;n[o]={id:o,type:V.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/tn,executor:(e,t)=>e.target!==t.id?N.Empty:t.hunger<Bh?N.Success:t.food.length===0?N.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",N.Running)}),FR=tt({type:V.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="berryBush"||o.food.length===0||e.leaderId&&!Cr(o.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=et(s),c=e.hunger/tn;return(a+c)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];return!o||o.type!=="berryBush"||o.food.length===0||t.food.length>=t.maxFood?[N.Success,"Bush is empty"]:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",[N.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[N.Running,"Gathering berries"])}}),LR=tt({type:V.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="corpse"||o.food.length===0||e.leaderId&&!Cr(o.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=et(s),c=e.hunger/tn;return(a+c)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.type!=="corpse"||o.food.length===0||t.food.length>=t.maxFood?N.Success:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",N.Running)}}),xR=tt({type:V.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=fu&&e.age<=lp&&e.hunger<Yn&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:V.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<fu||e.hunger>=Yn||(e.procreationCooldown||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="female"||o.isPregnant||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(s)*PT},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="female"||t.hunger>=Yn?N.Failure:o.isPregnant?N.Success:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",t.direction=$t(t.position,o.position,n.gameState.mapDimensions),N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",N.Running)}}),UR=tt({type:V.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=fu&&e.hunger<Yn&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:V.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<fu||e.age>lp||e.hunger>=Yn||(e.procreationCooldown||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="male"||o.hunger>=Yn||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(s)*PT},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="male"||o.hunger>=Yn?N.Failure:t.isPregnant?N.Success:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",t.direction=$t(t.position,o.position,n.gameState.mapDimensions),N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",N.Running)}}),GR=tt({type:V.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=ly){const o=`feed-child-task-${e.id}`;n[o]={id:o,type:V.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.isAdult||!(o.motherId===e.id||o.fatherId===e.id))return null;const a=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=et(a),d=o.hunger/tn;return(c+d)/2},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.isAdult||t.food.length===0?N.Failure:o.hunger<ly/2?N.Success:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>mS?(t.target=o.position,t.activeAction="moving",t.direction=$t(t.position,o.position,n.gameState.mapDimensions),N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="feeding",N.Running)}});function Tl(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const o=J(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(o)}function $R(e,t,n){if(e.leaderId!==t.creatorEntityId||!e.leaderId)return null;const o=t.target;if(!o)return null;const{width:s,height:a}=n.gameState.mapDimensions,c=J(e.position,o,s,a),d=et(c)*.5,u=ai(e.leaderId,n.gameState),h=J(u,o,s,a),p=Math.max(0,1-h/800)*.25,m=Math.ceil(s/Ae),S=Math.ceil(a/Ae),v=qE(o);let A=0;for(let w=-1;w<=1;w++)for(let E=-1;E<=1;E++){if(E===0&&w===0)continue;const C=((v.x+E)%m+m)%m,_=((v.y+w)%S+S)%S;n.gameState.terrainOwnership[_*m+C]===e.leaderId&&A++}const T=A/8*.25;return d+p+T}function bs(e,t,n,o,s){const a=e.target;return J(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",N.Running):(vp(a,o,t.leaderId,n.gameState),N.Success)}const WR=tt({type:V.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:Tl,executor:(e,t,n)=>bs(e,t,n,q.StorageSpot,yl)}),YR=tt({type:V.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:Tl,executor:(e,t,n)=>bs(e,t,n,q.Bonfire,yl)}),zR=tt({type:V.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:Tl,executor:(e,t,n)=>bs(e,t,n,q.PlantingZone,yl)}),jR=tt({type:V.HumanPlaceBorderPost,scorer:$R,requireAdult:!0,autopilotBehavior:"build",executor:(e,t,n)=>bs(e,t,n,q.BorderPost,YE)}),XR=tt({type:V.HumanPlacePalisade,requireAdult:!0,autopilotBehavior:"build",scorer:Tl,executor:(e,t,n)=>bs(e,t,n,q.Palisade,yl)}),VR=tt({type:V.HumanPlaceGate,requireAdult:!0,autopilotBehavior:"build",scorer:Tl,executor:(e,t,n)=>bs(e,t,n,q.Gate,yl)}),qR=tt({type:V.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(u=>u.type===ui.Berry).length<mr)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const c=t.target,d=J(e.position,c,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(d)},executor:(e,t,n)=>{if(t.food.filter(d=>d.type===ui.Berry).length<mr)return t.activeAction="idle",N.Failure;const s=e.target;return J(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>hS?(t.target=s,t.activeAction="moving",N.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(d=>d.type==="berryBush"&&J(d.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<DR)?(t.activeAction="idle",N.Success):N.Running)}}),ZR=tt({type:V.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var h;if(typeof t.target!="number")return null;const o=e.food.length>0,s=((h=e.heldItem)==null?void 0:h.type)===Lt.Wood;if(!o&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==q.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const c=J(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),d=et(c),u=s?.6:e.food.length/e.maxFood*.4;return(d+u)/2},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==q.StorageSpot)return N.Failure;const s=t.food.length>0,a=((d=t.heldItem)==null?void 0:d.type)===Lt.Wood;return!s&&!a?N.Success:o.storedItems.length>=o.storageCapacity?N.Failure:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",N.Running)}}),KR=tt({type:V.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var d;if(typeof t.target!="number"||!(((d=e.heldItem)==null?void 0:d.type)===Lt.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==q.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||Lh;if(s.storedItems.length>=a)return null;const c=J(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(c)},executor:(e,t,n)=>{var d;if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==q.Bonfire)return N.Failure;if(!(((d=t.heldItem)==null?void 0:d.type)===Lt.Wood))return N.Success;const a=o.storageCapacity||Lh;return o.storedItems.length>=a?N.Failure:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",N.Running)}}),QR=tt({type:V.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=Bh||e.food.length>0||typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="building"||o.buildingType!==q.StorageSpot||o.ownerId!==e.leaderId||!o.storedItems.some(u=>u.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=et(s),c=e.hunger/tn,d=1-e.food.length/e.maxFood;return(a+c+d)/3},executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.type!=="building"||o.buildingType!==q.StorageSpot||!o.storedItems.some(a=>a.item.itemType==="food")?N.Failure:t.food.length>0?N.Success:t.food.length>=t.maxFood?N.Failure:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="retrieving",N.Running)}}),JR=2;function Np(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}const ek=tt({type:V.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="tree")return null;const[s]=o.stateMachine??[];if(!(s===oi||s===zn||s===Ai)||e.leaderId&&!Cr(o.position,e.leaderId,n.gameState)||e.heldItem||e.food.length===0)return null;const c=Np(e,n.gameState);if(!c)return null;const d=zS(c.id,n.gameState);if(d<=0)return null;const u=SP(c.id,n.gameState);if(u>=d)return null;const h=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),p=et(h),m=Math.min(1,(d-u)/10);return(p+m)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="tree")return[N.Failure,"Tree not found"];const[s]=o.stateMachine??[];if(s===jt){const d={id:`gather-wood-${t.id}-${n.gameState.time}`,type:V.HumanGatherWood,position:o.position,creatorEntityId:t.id,target:o.id,validUntilTime:n.gameState.time+1};return[N.Success,"Tree fell!",d]}return s===oi||s===zn||s===Ai?t.heldItem?[N.Failure,"Hands full"]:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>pS?(t.target=o.position,t.activeAction="moving",[N.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="chopping",[N.Running,"Chopping tree"]):[N.Failure,"Tree is not standing"]}}),tk=tt({type:V.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="tree"||o.wood.length===0)return null;const[s]=o.stateMachine??[];if(s!==jt||e.leaderId&&!Cr(o.position,e.leaderId,n.gameState)||e.heldItem)return null;const a=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=et(a),d=Np(e,n.gameState),u=d?zS(d.id,n.gameState):0,h=Math.min(1,u/10);return(c+h)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[N.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[N.Success,"Already holding wood"];const o=n.gameState.entities.entities[e.target];return!o||o.type!=="tree"||o.wood.length===0||t.heldItem?[N.Failure,"Tree gone, empty, or human full"]:J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",[N.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[N.Running,"Gathering wood"])}}),nk=tt({type:V.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="prey"||o.hitpoints<=0||e.leaderId&&!Cr(o.position,e.leaderId,n.gameState))return null;const s=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const d=ai(e.leaderId,n.gameState);if(J(e.position,d,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>NE)return null}const a=et(s),c=e.hunger/tn;return(a+c)/2*.6},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[N.Success,"Prey is dead"];const s=J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Qe?[N.Running,"Chasing prey"]:[N.Running,"Attacking prey"]}}),ik=tt({type:V.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="predator"||o.hitpoints<=0||e.leaderId&&!Cr(o.position,e.leaderId,n.gameState))return null;const s=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(et(s)+.3)/1.3},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[N.Failure,"Too injured to continue"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[N.Success,"Predator eliminated"];const s=J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Qe?[N.Running,"Chasing predator"]:[N.Running,"Fighting predator"]}});function ok(e,t,n,o){var u;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,N.Failure;const a=J(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),d=(((u=t.attackCooldown)==null?void 0:u.ranged)??0)<=0?An:Bo;return a<=d?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,N.Success):(t.activeAction="moving",t.target=s.id,t.direction=$t(t.position,s.position,e.mapDimensions),N.Running)}const rk=tt({type:V.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const o=`player-command-${e.id}`;n[o]={id:o,type:V.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+Dt}}return n},scorer:(e,t)=>t.type===V.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a;const{gameState:o}=n,s=o.autopilotControls.activeAutopilotAction;if(!s)return[N.Failure,"No active autopilot action"];switch(s.action){case ve.AutopilotMove:{if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,N.Failure;const c=s.position;return J(t.position,c,o.mapDimensions.width,o.mapDimensions.height)<FE?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[N.Success,"Reached target position"]):(t.activeAction="moving",t.target=c,t.direction=$t(t.position,c,o.mapDimensions),[N.Running,"Moving to target"])}case ve.AutopilotGather:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Target entity not found"];let d=!1;if(c.type==="berryBush")d=c.food.length===0;else if(c.type==="corpse")d=c.food.length===0;else if(c.type==="tree"){const h=c;d=h.stateMachine[0]!==jt||h.wood.length===0}else return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target type"];return d?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Target is depleted"]):J(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)>hS?(t.activeAction="moving",t.target=c.id,t.direction=$t(t.position,c.position,o.mapDimensions),[N.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"At target, gathering",Uc(t,o.time)])}case ve.AutopilotChop:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.type!=="tree")return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target entity"];const[d]=c.stateMachine??[];return!(d===oi||d===zn||d===Ai)||t.heldItem?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Tree is not standing or human is holding an item"]):J(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)>pS?(t.activeAction="moving",t.target=c.id,t.direction=$t(t.position,c.position,o.mapDimensions),[N.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"At tree, chopping",Uc(t,o.time)])}case ve.AutopilotAttack:return"targetEntityId"in s?ok(o,t,s):(o.autopilotControls.activeAutopilotAction=void 0,N.Failure);case ve.AutopilotProcreate:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.type!=="human"||!Rs(t,c,o))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target for procreation"];const d=J(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height);return c.isPregnant||t.isPregnant?t.gender==="male"&&c.pregnancyFatherId!==t.id?[N.Failure,"Target is pregnant by another"]:[N.Success,"Procreation conditions met"]:d<=Zf?(t.activeAction="procreating",o.autopilotControls.activeAutopilotAction=void 0,[N.Running,"Procreating"]):(t.activeAction="moving",t.target=c.id,t.direction=$t(t.position,c.position,o.mapDimensions),[N.Running,"Moving to procreation target"])}case ve.AutopilotPlant:{if(t.activeAction==="planting")return[N.Running,"Planting"];if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No position specified"];const c=s.position;return Zi(c,o,bu,t.id)?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Position is occupied"]):J(t.position,c,o.mapDimensions.width,o.mapDimensions.height)<=Zf?(t.activeAction="planting",t.target=c,o.autopilotControls.activeAutopilotAction=void 0,o.hasPlayerPlantedBush=!0,[N.Running,"Planting"]):(t.activeAction="moving",t.target=c,t.direction=$t(t.position,c,o.mapDimensions),[N.Running,"Moving to planting target"])}case ve.AutopilotFeedChild:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="human"||c.isAdult||t.food.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target for feeding child"]):J(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Zf?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[N.Success,"Feeding child"]):(t.activeAction="moving",t.target=c.id,t.direction=$t(t.position,c.position,o.mapDimensions),[N.Running,"Moving to feeding target"])}case ve.AutopilotDeposit:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];if(!c||c.buildingType!==q.StorageSpot&&c.buildingType!==q.Bonfire||!c.isConstructed)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"];const d=c.storageCapacity??0;if(c.storedItems.length>=d)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Storage is full"];if(t.leaderId!==c.ownerId)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Human does not belong to the same tribe as the building"];const h=t.food.length>0,p=!!t.heldItem;if(c.buildingType===q.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==Lt.Wood)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Bonfires only accept wood"]}else if(!h&&!p)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No items to deposit"];return J(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=ci?(t.activeAction="depositing",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Depositing items",Uc(t,o.time)]):(t.activeAction="moving",t.target=c.id,t.direction=$t(t.position,c.position,o.mapDimensions),[N.Running,"Moving to deposit target"])}case ve.AutopilotRetrieve:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.buildingType!==q.StorageSpot||!c.isConstructed||c.storedItems.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"]):t.leaderId!==c.ownerId?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Storage is full"]):J(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=ci?(t.activeAction="retrieving",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Retrieving items",Uc(t,o.time)]):(t.activeAction="moving",t.target=c.id,t.direction=$t(t.position,c.position,o.mapDimensions),[N.Running,"Moving to retrieve target"])}case ve.TakeOverBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!vr(t,c,o)?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Only leaders can take over buildings"]):J(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Qe?(t.activeAction="takingOverBuilding",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Taking over building"]):(t.activeAction="moving",t.target=c.id,t.direction=$t(t.position,c.position,o.mapDimensions),[N.Running,"Moving to takeover target"])}case ve.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const c=o.entities.entities[s.targetEntityId];return!c||c.type!=="building"||!vr(t,c,o)?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Only leaders can remove enemy buildings"]):J(t.position,c.position,o.mapDimensions.width,o.mapDimensions.height)<=Qe?(t.activeAction="destroyingBuilding",t.target=c.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=c.id,t.direction=$t(t.position,c.position,o.mapDimensions),[N.Running,"Moving to removal target"])}case ve.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return o.autopilotControls.activeAutopilotAction=void 0,N.Failure;const c=s.position,d=s.buildingType;if(!d)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No building type specified"];const u=J(t.position,c,o.mapDimensions.width,o.mapDimensions.height),h=100;return u<=h?Sr(c,d,t.leaderId,o,t.position,h)?(vp(c,d,t.leaderId,o),o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[N.Success,"Building placed"]):(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=c,t.direction=$t(t.position,c,o.mapDimensions),[N.Running,"Moving to placement target"])}default:return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Unknown or unhandled action"]}}}),sk=tt({type:V.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:n}=t,o={},s=li(e.position.x,e.position.y,n),a=s!==null&&s!==e.leaderId&&Ji(e.leaderId,s,n),c=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(a||c){const d=`attack-human-${e.id}`;o[d]={id:d,type:V.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:n.time+Dt}}return o},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="human"||o.hitpoints<=0||o.id===e.id||o.leaderId===e.leaderId)return null;const{gameState:s}=n,a=ml(e,o,s),c=li(o.position.x,o.position.y,s)===e.leaderId,d=o.activeAction==="attacking"&&o.attackTargetId!==void 0;if(!a&&!d)return null;let u=.5;const h=J(e.position,o.position,s.mapDimensions.width,s.mapDimensions.height),p=et(h);return c&&a&&(u+=.1),(p+u)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[N.Success,"Target eliminated"];const s=J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Qe?[N.Running,"Chasing human target"]:[N.Running,"Fighting human target"]}}),ak=tt({type:V.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,n)=>{if(typeof t.target!="number"||wT(n.gameState.time)>.5)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.buildingType!==q.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0||e.leaderId!==o.ownerId)return null;const s=dl(n.gameState.temperature,e.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=cr+5;if(s>=a)return null;const c=(a-s)/15,d=(1-e.hitpoints/e.maxHitpoints)*.8,u=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),h=et(u);let p=(c+d+h)/2;return e.hitpoints/e.maxHitpoints<.2&&s<cr&&(p=Math.max(p,1.2)),p},executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.buildingType!==q.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0)return N.Failure;const s=dl(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=cr+5;if(s>=a)return t.activeAction="idle",[N.Success,"Comfortable temperature reached"];const c=t.id*137%360*(Math.PI/180),d=Ya*.4,u=n.gameState.mapDimensions.width,h=n.gameState.mapDimensions.height,p={x:(o.position.x+Math.cos(c)*d+u)%u,y:(o.position.y+Math.sin(c)*d+h)%h},m=J(t.position,p,u,h);return m>10?(t.activeAction="moving",t.target=p,t.direction=$t(t.position,p,n.gameState.mapDimensions),[N.Running,`Moving to warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[N.Running,"Staying warm at bonfire"])}}),lk=tt({type:V.HumanFlee,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hitpoints<e.maxHitpoints*hy){const o=JE(e.id,t.gameState);if(o){const s=`flee-task-${e.id}`;n[s]={id:s,type:V.HumanFlee,position:e.position,creatorEntityId:e.id,target:o.id,validUntilTime:t.gameState.time+Dt}}}return n},scorer:(e,t,n)=>typeof t.target!="number"||!n.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*hy?.9:null,executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o)return t.activeAction="idle",t.attackTargetId=void 0,N.Success;if(J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>py)return t.activeAction="idle",t.target=void 0,N.Success;t.activeAction="moving",t.attackTargetId=void 0;const a=Le(o.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),c=mt(a),d=jn(t.position,lt(c,py));return t.target={x:(d.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(d.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=c,N.Running}}),ck=tt({type:V.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,o={};if(!e.leaderId||e.id===e.leaderId)return o;const s=ai(e.leaderId,n),a=`stay-near-tribe-${e.id}`;return o[a]={id:a,type:V.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:n.time+Dt},o},scorer:(e,t,n)=>{if(!e.leaderId||e.id===e.leaderId)return null;const o=ai(e.leaderId,n.gameState),s=J(e.position,o,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=gy)return null;const a=s-gy;return Math.min(.95,.5+a/1e3*zE)},executor:(e,t,n)=>{if(!t.leaderId)return N.Failure;const o=ai(t.leaderId,n.gameState),s=J(t.position,o,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<XE?(t.activeAction="idle",t.target=void 0,N.Success):(t.activeAction="moving",t.target=o,[N.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),uk=tt({type:V.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,o={};if(e.isAdult)return o;const s=_y(e,n);if(!s)return o;const a=`stay-near-parent-${e.id}`;return o[a]={id:a,type:V.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:n.time+Dt},o},scorer:(e,t,n)=>{if(e.isAdult)return null;const o=_y(e,n.gameState);if(!o||o.id!==t.target||e.leaderId&&yp(e.leaderId,n.gameState)&&li(o.position.x,o.position.y,n.gameState)!==e.leaderId)return null;const s=J(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=my)return null;const a=s-my;return Math.min(.98,.6+a/500*jE)},executor:(e,t,n)=>{if(typeof e.target!="number")return t.activeAction="idle",N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="human")return t.activeAction="idle",t.target=void 0,N.Failure;const s=J(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<=VE?(t.activeAction="idle",t.target=void 0,N.Success):(t.activeAction="moving",t.target=o.id,t.direction=$t(t.position,o.position,n.gameState.mapDimensions),[N.Running,`Returning to parent (${Math.round(s)}px away)`])}}),dk=tt({type:V.HumanDiplomacy,requireAdult:!0,scorer:(e,t)=>e.id===e.leaderId&&t.creatorEntityId===e.id?1:null,executor:(e,t,n)=>{var d,u,h,p,m,S;const{gameState:o}=n,s=Ho(t.id,o),a=My(s),c=Lu(o).filter(v=>v.leaderId!==t.id);for(const v of c){const A=Ho(v.leaderId,o),T=My(A),w=((u=(d=t.tribeControl)==null?void 0:d.diplomacy)==null?void 0:u[v.leaderId])||Rt.Friendly,E=o.entities.entities[v.leaderId];((p=(h=E==null?void 0:E.tribeControl)==null?void 0:h.diplomacy)==null?void 0:p[t.id])===Rt.Hostile||a>T*HE?w!==Rt.Hostile&&((m=t.tribeControl)!=null&&m.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=Rt.Hostile):w!==Rt.Friendly&&((S=t.tribeControl)!=null&&S.diplomacy)&&(t.tribeControl.diplomacy[v.leaderId]=Rt.Friendly)}return t.aiBlackboard&&Oe.set(t.aiBlackboard,"lastDiplomacyCheckTime",o.time),N.Success}}),fk={type:V.HumanAttackBuilding,executor:(e,t,n)=>{const{gameState:o}=n,s=e.target;return o.entities.entities[s]?(t.activeAction="attacking",t.attackTargetId=s,N.Running):N.Success}},Xu=[HR,FR,LR,xR,UR,GR,WR,YR,zR,jR,XR,VR,qR,ZR,KR,QR,ek,tk,nk,ik,rk,sk,ak,lk,ck,uk,dk,fk].reduce((e,t)=>(e[t.type]=t,e),{}),hk=Object.values(Xu);function pk(e,t){Sl(e,t,hk)}function gk(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const o=Iu(e);if(o){const s=t.gameState.tasks[o];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),qi(e,null)}return}let n=Iu(e);if(n){const o=t.gameState.tasks[n];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(qi(e,null),n=null)}if(!n){const o=mk(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];n=o,qi(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const o=t.gameState.tasks[n];o?kT(e,o,t,Xu):qi(e,null)}}function mk(e,t){let n=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const c=Xu[a.type];if(!c||!c.scorer)continue;const d=c.scorer(e,a,t);d!==null&&d>o&&(o=d,n=a.id)}return o>0?n:null}function yk(e,t){const n=performance.now();switch(e.aiType){case xo.TaskBased:default:gk(e,t);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}const vk=(e,t)=>{const n={};for(let o=0;o<JR;o++){const s=`hunt-prey-${e.id}-${o}`;n[s]={id:s,type:V.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},Sk=(e,t)=>{const n={};if(e.hitpoints<=0)return n;const o=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((o==null?void 0:o.type)==="human"))return n;for(let a=0;a<BE;a++){const c=`hunt-predator-${e.id}-${a}`;n[c]={id:c,type:V.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},Au=D_*1.5,Tk=(e,t)=>{const n={},o=t.gameState,s=[...o.search.human.byRadius(e.position,Au),...o.search.predator.byRadius(e.position,Au)].filter(u=>{if(u.id===e.id)return!1;if(e.type==="prey")return u.type==="human"||u.type==="predator";if(e.type==="predator"){if(u.type==="human")return!0;if(u.type==="predator")return u.geneCode!==e.geneCode}return!1});if(s.length===0)return n;let a=s[0],c=Xn(e.position,a.position);for(let u=1;u<s.length;u++){const h=Xn(e.position,s[u].position);h<c&&(c=h,a=s[u])}const d=`animal-flee-${e.id}-${a.id}`;return n[d]={id:d,type:V.AnimalFlee,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1},n},Ik=(e,t,n)=>{const o=n.gameState.entities.entities[t.target];if(!o)return null;const s=Xn(e.position,o.position);return s>Au?null:et(s)*.95},Ak=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];if(!o)return N.Failure;if(Xn(t.position,o.position)>Au*1.2)return N.Success;const a=mt(qh(t.position,o.position)),c=jn(t.position,lt(a,100));return t.activeAction="moving",t.target=c,N.Running},wk={type:V.AnimalFlee,producer:Tk,scorer:Ik,executor:Ak},MT=600,Ek=(e,t)=>{if(e.type!=="prey")return{};const n={},s=t.gameState.search.berryBush.byRadius(e.position,MT).filter(a=>a.food.length>0);for(const a of s){const c=`animal-graze-${e.id}-${a.id}`;n[c]={id:c,type:V.AnimalGraze,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},Ck=(e,t,n)=>{if(e.type!=="prey")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.food.length===0)return null;const s=Xn(e.position,o.position);if(s>MT)return null;const a=et(s),c=Math.max(0,e.hunger/Wu);return e.hunger<20&&s>100?null:a*c*.65},Pk=(e,t,n)=>{if(t.type!=="prey")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.food.length===0||(t.activeAction="grazing",t.target=o.id,t.hunger<5)?N.Success:N.Running},_k={type:V.AnimalGraze,producer:Ek,scorer:Ck,executor:Pk},bT=800,Rk=(e,t)=>{if(e.type!=="predator")return{};const n={},s=t.gameState.search.prey.byRadius(e.position,bT).filter(a=>a.type==="prey");for(const a of s){const c=`animal-hunt-${e.id}-${a.id}`;n[c]={id:c,type:V.AnimalHunt,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},kk=(e,t,n)=>{if(e.type!=="predator")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.hitpoints<=0)return null;const s=Xn(e.position,o.position);if(s>bT)return null;const a=et(s),c=Math.max(0,e.hunger/Yu);return e.hunger<30&&s>200?null:a*c*.8},Mk=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.hitpoints<=0||(t.activeAction="attacking",t.target=o.id,t.hunger<10)?N.Success:N.Running},bk={type:V.AnimalHunt,producer:Rk,scorer:kk,executor:Mk},DT=500,Dk=(e,t)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,DT).filter(a=>{if(a.id===e.id||a.type!==e.type)return!1;const c=a;return c.isAdult&&c.gender!==e.gender&&(!c.procreationCooldown||c.procreationCooldown<=0)&&!c.isPregnant});for(const a of s){const c=`animal-procreate-${e.id}-${a.id}`;n[c]={id:c,type:V.AnimalProcreate,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},Ok=(e,t,n)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return null;const o=n.gameState.entities.entities[t.target];if(!o||!o.isAdult||o.gender===e.gender||o.procreationCooldown&&o.procreationCooldown>0||o.isPregnant)return null;const s=Xn(e.position,o.position);return s>DT?null:et(s)*.6},Nk=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||o.isPregnant||o.procreationCooldown&&o.procreationCooldown>0?N.Failure:(t.activeAction="procreating",t.target=o.id,t.isPregnant||t.procreationCooldown&&t.procreationCooldown>0?N.Success:N.Running)},Bk={type:V.AnimalProcreate,producer:Dk,scorer:Ok,executor:Nk},Hk=200,Fk=(e,t)=>{const n=`animal-wander-${e.id}`,o=Math.random()*Math.PI*2,s=Math.random()*Hk,a={x:e.position.x+Math.cos(o)*s,y:e.position.y+Math.sin(o)*s};a.x=Math.max(0,Math.min(t.gameState.mapDimensions.width,a.x)),a.y=Math.max(0,Math.min(t.gameState.mapDimensions.height,a.y));const c={};return c[n]={id:n,type:V.AnimalWander,position:a,creatorEntityId:e.id,validUntilTime:t.gameState.time+5},c},Lk=()=>.1,xk=(e,t)=>Xn(t.position,e.position)<10?(t.activeAction="idle",N.Success):(t.activeAction="moving",t.target=e.position,N.Running),Uk={type:V.AnimalWander,producer:Fk,scorer:Lk,executor:xk},Gk=(e,t)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,600).filter(a=>{if(a.type!==e.type)return!1;const c=a;return c.motherId===e.id&&c.hunger>=zu});for(const a of s){const c=`animal-feed-child-${e.id}-${a.id}`;n[c]={id:c,type:V.AnimalFeedChild,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},$k=(e,t,n)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.motherId!==e.id)return null;const s=Xn(e.position,o.position),a=et(s),c=e.type==="prey"?Wu:Yu,d=Math.max(0,o.hunger/c);return a*d*.9},Wk=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||o.hunger<zu/2?N.Success:Xn(t.position,o.position)<30?(t.activeAction="feeding",N.Running):(t.activeAction="moving",t.target=o.id,N.Running)},Yk={type:V.AnimalFeedChild,producer:Gk,scorer:$k,executor:Wk},zk=(e,t)=>{if(e.isAdult||e.hunger<zu||!e.motherId)return{};const n=t.gameState.entities.entities[e.motherId];if(!n)return{};const o={},s=`animal-seek-food-${e.id}-${n.id}`;return o[s]={id:s,type:V.AnimalSeekFoodFromParent,position:n.position,creatorEntityId:e.id,target:n.id,validUntilTime:t.gameState.time+1},o},jk=(e,t,n)=>{if(e.isAdult||!e.motherId)return null;const o=n.gameState.entities.entities[e.motherId];if(!o)return null;const s=Xn(e.position,o.position),a=et(s),c=e.type==="prey"?Wu:Yu,d=Math.max(0,e.hunger/c);return a*d*.85},Xk=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||t.hunger<zu/2?N.Success:(Xn(t.position,o.position)<30||(t.activeAction="moving",t.target=o.id),N.Running)},Vk={type:V.AnimalSeekFoodFromParent,producer:zk,scorer:jk,executor:Xk},qk=(e,t)=>{if(e.type!=="prey")return{};if(e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return{};const n={},o=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,c=o.search.prey.byRadius(e.position,As*5),d=[];for(const u of c)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&d.push(u);if(d.length>=2){let u=0,h=0;for(const S of d)u+=S.position.x,h+=S.position.y;u/=d.length,h/=d.length;const p={x:u,y:h};if(J(e.position,p,s,a)>As*2){const S=`animal-herd-${e.id}`;n[S]={id:S,type:V.AnimalHerd,position:p,creatorEntityId:e.id,target:p,validUntilTime:t.gameState.time+1}}}return n},Zk=(e,t,n)=>{if(e.type!=="prey"||e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return null;const o=t.target,{width:s,height:a}=n.gameState.mapDimensions,c=J(e.position,o,s,a);return c<=As*2?null:et(c)*.4},Kk=(e,t,n)=>{if(t.type!=="prey")return N.Failure;const o=e.target,{width:s,height:a}=n.gameState.mapDimensions;if(J(t.position,o,s,a)<=As*2)return t.activeAction="idle",t.direction={x:0,y:0},N.Success;t.activeAction="moving",t.target=o;const d=Le(t.position,o,s,a);return t.direction=mt(d),N.Running},Qk={type:V.AnimalHerd,producer:qk,scorer:Zk,executor:Kk},Jk=(e,t)=>{if(e.type!=="predator")return{};const n=e.hunger>100,o=e.hitpoints<e.maxHitpoints*.5;if(!n&&!o)return{};if(e.attackCooldown&&e.attackCooldown>0)return{};const s={},c=t.gameState.search.human.byRadius(e.position,Pr*2);let d=null,u=1/0;for(const h of c)if(h.hitpoints>0){const p=J(e.position,h.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);p<u&&(u=p,d=h)}if(d){const h=`animal-attack-human-${e.id}-${d.id}`;s[h]={id:h,type:V.AnimalAttack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return s},eM=(e,t,n)=>{if(e.type!=="predator")return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const a=J(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>Pr*2.5?null:et(a)*.75},tM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return N.Success;const{width:a,height:c}=n.gameState.mapDimensions;if(J(t.position,s.position,a,c)<=Pr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},N.Running;{t.activeAction="moving",t.target=s.id;const u=Le(t.position,s.position,a,c);return t.direction=mt(u),N.Running}},nM={type:V.AnimalAttack,producer:Jk,scorer:eM,executor:tM},iM=(e,t)=>{if(e.type!=="predator")return{};if(!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120||e.attackCooldown&&e.attackCooldown>0)return{};const n={},s=t.gameState.search.predator.byRadius(e.position,hT);let a=null,c=1/0;for(const d of s)if(d.id!==e.id&&d.hitpoints>0&&d.isAdult&&e.fatherId!==d.fatherId&&e.gender===d.gender&&e.fatherId!==void 0&&d.fatherId!==void 0){const u=J(e.position,d.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);u<c&&(c=u,a=d)}if(a){const d=`animal-territorial-${e.id}-${a.id}`;n[d]={id:d,type:V.AnimalTerritorial,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},oM=(e,t,n)=>{if(e.type!=="predator"||!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120)return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const a=J(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>hT*1.2?null:et(a)*.7},rM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return N.Success;const{width:a,height:c}=n.gameState.mapDimensions;if(J(t.position,s.position,a,c)<=Pr)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},N.Running;{t.activeAction="moving",t.target=s.id;const u=Le(t.position,s.position,a,c);return t.direction=mt(u),N.Running}},sM={type:V.AnimalTerritorial,producer:iM,scorer:oM,executor:rM},aM=(e,t)=>{if(e.type!=="predator")return{};if(e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return{};if(e.fatherId===void 0)return{};const n={},o=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,c=o.search.predator.byRadius(e.position,ws*4);let d=null;for(const u of c)u.id!==e.id&&u.hitpoints>0&&u.isAdult&&u.fatherId===e.fatherId&&(u.age>=e.age||u.hitpoints>e.hitpoints)&&(!d||u.age>d.age)&&(d=u);if(d&&J(e.position,d.position,s,a)>ws*2){const h=`animal-pack-follow-${e.id}-${d.id}`;n[h]={id:h,type:V.AnimalPack,position:d.position,creatorEntityId:e.id,target:d.id,validUntilTime:t.gameState.time+1}}return n},lM=(e,t,n)=>{if(e.type!=="predator"||e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const{width:a,height:c}=n.gameState.mapDimensions,d=J(e.position,s.position,a,c);return d<=ws*2?null:et(d)*.35},cM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return N.Success;const{width:a,height:c}=n.gameState.mapDimensions;if(J(t.position,s.position,a,c)<=ws*2)return t.activeAction="idle",t.direction={x:0,y:0},N.Success;t.activeAction="moving",t.target=s.id;const u=Le(t.position,s.position,a,c);return t.direction=mt(u),N.Running},uM={type:V.AnimalPack,producer:aM,scorer:lM,executor:cM},nn={};nn[V.HumanHuntPrey]={type:V.HumanHuntPrey,producer:vk};nn[V.HumanHuntPredator]={type:V.HumanHuntPredator,producer:Sk};nn[V.AnimalFlee]=wk;nn[V.AnimalGraze]=_k;nn[V.AnimalHunt]=bk;nn[V.AnimalAttack]=nM;nn[V.AnimalProcreate]=Bk;nn[V.AnimalWander]=Uk;nn[V.AnimalFeedChild]=Yk;nn[V.AnimalSeekFoodFromParent]=Vk;nn[V.AnimalHerd]=Qk;nn[V.AnimalTerritorial]=sM;nn[V.AnimalPack]=uM;function $y(e,t){Sl(e,t,Object.values(nn))}function OT(e,t){let n=Iu(e);if(n){const o=t.gameState.tasks[n];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(qi(e,null),n=null)}if(!n){const o=dM(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];n=o,qi(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const o=t.gameState.tasks[n];o?kT(e,o,t,nn):qi(e,null)}}function dM(e,t){let n=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,1e3);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const c=nn[a.type];if(!c||!c.scorer)continue;const d=c.scorer(e,a,t);d!==null&&d>o&&(o=d,n=a.id)}return o>0?n:null}function fM(e,t){OT(e,t)}function hM(e,t){OT(e,t)}const pM=(e,t)=>{if(e.buildingType!==q.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,o=jS(e);if(AP(e,n)>=o)return{};const a=n.search.tasks.byProperty("creatorEntityId",e.id).find(p=>p.type===V.HumanPlantBush);if(a)return{[a.id]:a};const c=n.mapDimensions.width,d=n.mapDimensions.height,u=n.soilDepletion,h=10;for(let p=0;p<h;p++){const m=e.position.x+(Math.random()-.5)*e.width,S=e.position.y+(Math.random()-.5)*e.height,v={x:(m%c+c)%c,y:(S%d+d)%d};if(!Ir(u,v,c,d)&&!Zi(v,n,bu)){const A=`plant-bush-${e.id}`,T={id:A,type:V.HumanPlantBush,position:v,creatorEntityId:e.id,target:v,validUntilTime:n.time+bR};return{[A]:T}}}return{}},gM=(e,t)=>{const n={};if(e.buildingType===q.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const o=`stockpile-${e.id}`;n[o]={id:o,type:V.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n},mM=(e,t)=>{const n={};if(e.buildingType===q.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*rC){const o=`fuel-bonfire-${e.id}`;n[o]={id:o,type:V.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n},yM=(e,t)=>{const n={};if(e.buildingType===q.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let o=0;o<cC;o++){const s=`seek-warmth-${e.id}-${o}`;n[s]={id:s,type:V.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n},vM=(e,t)=>{const n={};if(e.buildingType===q.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(o=>o.item.itemType==="food")){const o=`retrieve-from-${e.id}`;n[o]={id:o,type:V.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n},SM={[V.HumanPlantBush]:{type:V.HumanPlantBush,producer:pM},[V.HumanStockpile]:{type:V.HumanStockpile,producer:gM},[V.HumanFuelBonfire]:{type:V.HumanFuelBonfire,producer:mM},[V.HumanSeekWarmth]:{type:V.HumanSeekWarmth,producer:yM},[V.HumanRetrieve]:{type:V.HumanRetrieve,producer:vM}};function NT(e,t){Sl(e,t,Object.values(SM))}function TM(e,t){const{gameState:n,deltaTime:o}=t,s=o*(Mt/Ft);if(e.isBeingDestroyed){const a=_w(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){if(e.buildingType===q.Palisade||e.buildingType===q.Gate){const d=e.buildingType===q.Gate?e.ownerId??null:null;Is(n,e.position,e.radius,!1,d,Ts)}const c=e.buildingType===q.PlantingZone;Ei(n.entities,e.id),c&&Ja(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=Pw(e.buildingType);if(a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1){if(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&rl(e.position,Ki,e.ownerId,n),e.buildingType===q.Palisade||e.buildingType===q.Gate){const c=e.buildingType===q.Gate?e.ownerId??null:null;Is(n,e.position,e.radius,!0,c,Ts)}e.buildingType===q.PlantingZone&&Ja(n)}}if(e.buildingType===q.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*oC,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*aC)){const a=e.storedItems.findIndex(c=>c.item.itemType==="item"&&c.item.type===Lt.Wood);a!==-1&&(e.storedItems.splice(a,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+PS))}NT(e,t)}function IM(e,t){const n=t.deltaTime*Mt/Ft;if(e.age+=n,!e.stateMachine)return;const[o]=e.stateMachine,s=e.stateMachine[1];(o===jt||o===wi)&&s.enteredAt>=t.gameState.time-n&&Is(t.gameState,e.position,e.radius,!1,null,Ts),o!==jt&&o!==wi&&o!==Tr&&(e.age>=Lo&&!e.woodGenerated&&(e.wood=Array.from({length:ju},()=>({itemType:"item",type:Lt.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=wr*Math.min(1,Math.max(.4,e.age/Lo)))}const AM={type:V.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const o=`gather-berries-${e.id}`;n[o]={id:o,type:V.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n}},wM={type:V.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[o]=e.stateMachine??[];if(o===oi||o===zn||o===Ai){const a=`chop-tree-${e.id}`;n[a]={id:a,type:V.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n}},EM={type:V.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[o]=e.stateMachine??[];if(o===jt&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:V.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n}},CM=[AM,wM,EM].reduce((e,t)=>(e[t.type]=t,e),{});function Wy(e,t){Sl(e,t,Object.values(CM))}const PM={type:V.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const o=`gather-meat-${e.id}`;n[o]={id:o,type:V.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Dt}}return n}},_M=[PM].reduce((e,t)=>(e[t.type]=t,e),{});function RM(e,t){Sl(e,t,Object.values(_M))}var iu=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(iu||{});function uh(e,t,n){switch(n){case 0:kM(e,t);break;case 1:MM(e,t);break;case 2:bM(e,t);break}}function kM(e,t){e.forces.push(lt(e.velocity,-.1));const n=lt(mt(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(o=>{t.gameState.time-o.startTime<o.duration&&o.type==="slow"&&(e.velocity=lt(e.velocity,.5))}),e.debuffs=e.debuffs.filter(o=>t.gameState.time-o.startTime<o.duration),e.velocity=jn(e.velocity,e.forces.reduce(jn,{x:0,y:0})),Oo(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=jn(e.position,lt(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&Oo(e.velocity)>.1&&CP(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?PR(e,t,t.deltaTime):e.type==="corpse"?_R(e,t):e.type==="prey"?RR(e,t,t.deltaTime):e.type==="predator"?kR(e,t,t.deltaTime):e.type==="building"?TM(e,t):e.type==="tree"?IM(e,t):e.type,e.stateMachine&&(e.stateMachine=wR(...e.stateMachine,{entity:e,updateContext:t}))}function MM(e,t){BT(e,t)&&(e.type==="human"?pk(e,t):e.type==="corpse"?RM(e,t):e.type==="prey"||e.type==="predator"?$y(e,t):e.type==="building"?NT(e,t):(e.type==="tree"||e.type==="berryBush")&&Wy(e,t))}function bM(e,t){BT(e,t)&&(e.type==="human"?yk(e,t):e.type==="corpse"||(e.type==="prey"?fM(e,t):e.type==="predator"?hM(e,t):e.type==="building"||e.type==="tree"||e.type),Oe.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function BT(e,t){const n=Oe.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-n+(Math.random()-Math.random())*dy/10>dy}function HT(e){const t=e.gameState.entities.entities;for(const n in t)uh(t[n],e,iu.Physics);for(const n in t)uh(t[n],e,iu.PrepareAI);Iw(e.gameState);for(const n in t)uh(t[n],e,iu.ExecuteAI)}function FT(){return{entities:{},nextEntityId:1}}function _r(e,t,n){const o={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:Oe.create(),...n};return e.entities[o.id]=o,o}function Il(e,t,n){return _r(e,"berryBush",{position:t,radius:Oh,food:Array.from({length:$1},()=>({itemType:"food",type:ui.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:G1,lifespan:Y1,age:0,spreadRadius:Oh,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:Oe.create(),stateMachine:[$a,{enteredAt:n,previousState:void 0}]})}function Es(e,t,n,o=0){const s=o>=Lo;return _r(e,"tree",{position:t,radius:wr,age:o,lifespan:rR,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:pR,stateMachine:[oi,{enteredAt:n,previousState:void 0}],aiBlackboard:Oe.create(),wood:s?Array.from({length:ju},()=>({itemType:"item",type:Lt.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function ar(e,t,n,o,s=!1,a=aE,c=gS,d,u,h=[],p,m,S=xo.TaskBased){const v=a>=cp;return _r(e,"human",{position:t,radius:v?ht:ks,hunger:c,hitpoints:cy,maxHitpoints:cy,age:a,gender:o,isPlayer:s,food:[],maxFood:fS,maxAge:il,isAdult:v,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:d,fatherId:u,ancestorIds:h,stateMachine:[ft,{enteredAt:n,previousState:void 0}],leaderId:p,tribeInfo:m,aiType:S,aiBlackboard:Oe.create()})}function Bp(e,t,n,o,s,a,c,d,u,h,p){let m,S;switch(c){case"human":m=yS,S=Yn;break;case"prey":m=2,S=120;break;case"predator":m=4,S=140;break}return _r(e,"corpse",{position:t,radius:s,gender:n,age:o,originalEntityId:a,originalEntityType:c,timeOfDeath:d,decayProgress:0,geneCode:p,food:[...Array.from({length:Math.max(m*Math.max(S-h,0)/S,0)},()=>({itemType:"food",type:ui.Meat})),...u].map(A=>({...A,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:Oe.create()})}function DM(e,t,n,o,s,a,c,d,u){return Bp(e,t,n,o,s,a,"human",c,d,u)}function OM(e,t,n,o,s,a,c,d){return Bp(e,t,n,o,s,a,"prey",c,[],0,d)}function NM(e,t,n,o,s,a,c,d){return Bp(e,t,n,o,s,a,"predator",c,[],0,d)}function BM(e,t,n){const o=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=o?[...o.ancestorIds||[],o.id]:[],c=[...s,...a],d=[...new Set(c)],u=d.slice(Math.max(d.length-uS,0)),h=Math.random()<.5?"male":"female",p=jn(e.position,{x:5,y:5}),m=ar(n.gameState.entities,p,n.gameState.time,h,!1,0,gS/2,e.id,t,u,(o==null?void 0:o.leaderId)??e.leaderId,(o==null?void 0:o.tribeInfo)??e.tribeInfo,e.aiType);return ke(n,_e.Birth,e.position),m}function Ei(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function Cs(e,t,n,o=b_,s=cT,a,c,d,u=xo.TaskBased){const h=o>=uT,p=Date.now();return _r(e,"prey",{position:t,radius:h?ht*.7:ks*.7,hunger:s,hitpoints:Fy,maxHitpoints:Fy,age:o,maxAge:lT,gender:n,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:c,fatherId:d,stateMachine:[ii,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:Oe.create()})}function Ps(e,t,n,o=L_,s=fT,a,c,d,u=xo.TaskBased){const h=o>=mT,p=Date.now();return _r(e,"predator",{position:t,radius:h?ht*.9:ks*.9,hunger:s,hitpoints:Ly,maxHitpoints:Ly,age:o,maxAge:dT,gender:n,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:c,fatherId:d,stateMachine:[hn,{enteredAt:p,previousState:void 0}],aiType:u,aiBlackboard:Oe.create()})}function LT(e,t,n,o){const s=Zh(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:o,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:t_,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===q.Bonfire?Fh:void 0,maxFuelLevel:n===q.Bonfire?Fh:void 0,aiBlackboard:Oe.create(),stateMachine:["",{enteredAt:0}]};return _r(e,"building",a)}var un=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(un||{}),gr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(gr||{}),Jt=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(Jt||{});const Wh={},Yh={},HM=[{key:un.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:un.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>oE,isCompleted:!1,minDisplayTime:wy,highlightedUIElements:[gr.HUNGER_BAR]},{key:un.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!Ke(t,e,"berryBush",Qe*5,o=>o.food.length>0),getTargets:(e,t)=>{const n=[];for(const o of Object.values(e.entities.entities))o.type==="berryBush"&&o.food.length>0&&J(t.position,o.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(o);return n.map(o=>o.id)},isCompleted:!1,minDisplayTime:wy},{key:un.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=Ke(t,e,"berryBush",Qe,o=>o.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:un.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[gr.FOOD_BAR]},{key:un.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>Qi(e,t).length>0,getTargets:(e,t)=>{const n=Ke(t,e,"human",Qe,o=>Rs(t,o,e));return n?[n.id]:[]},isCompleted:!1},{key:un.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>kp(e,t).some(o=>o.type===ve.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:un.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[gr.COMMAND_BUTTONS],isCompleted:!1},{key:un.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:un.AUTOPILOT},{key:un.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=Ke(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=Ke(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:un.ANIMALS_INTRODUCTION},{key:un.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!Ke(t,e,"predator",120),getTargets:(e,t)=>{const n=Ke(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:un.HUNT_PREY}].map(e=>({...e,condition:e.condition?xM(e.condition):void 0,getTargets:e.getTargets?UM(e.getTargets):void 0}));function xT(){return{steps:HM.map(e=>({...e,isCompleted:!1}))}}function UT(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:Jt.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function FM(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function LM(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=Jt.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const o=bt(e);if(!o){n.isActive=!1,n.transitionState=Jt.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=Jt.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/jC;switch(n.transitionState){case Jt.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=Jt.ACTIVE);break;case Jt.ACTIVE:{const u=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),h=Wh[s.condition];h&&u&&h(e,o)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=Jt.FADING_OUT);break}case Jt.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const d=FM(e);d!==null?(n.currentStepIndex=d,n.transitionState=Jt.FADING_IN):(n.isActive=!1,n.transitionState=Jt.INACTIVE)}break}if(n.transitionState!==Jt.FADING_OUT&&n.transitionState!==Jt.INACTIVE){const d=Yh[s.getTargets||""];d?n.highlightedEntityIds=[...d(e,o)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function xM(e){const t=`condition_${Object.keys(Wh).length+1}`;return Wh[t]=e,t}function UM(e){const t=`getTargets_${Object.keys(Yh).length+1}`;return Yh[t]=e,t}function GM(){const e=FT(),t=0;for(let S=0;S<nS;S++){const v={x:Math.random()*We,y:Math.random()*Ye};Il(e,v,t)}for(let S=0;S<tS;S++){const v={x:Math.random()*We,y:Math.random()*Ye};Es(e,v,t)}const n=We/2,o=Ye/2;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,A=100+Math.random()*100,T={x:n+Math.cos(v)*A,y:o+Math.sin(v)*A};Es(e,T,t,Lo)}const s=ar(e,{x:n-25,y:o},t,"male",!0),a=ar(e,{x:n+25,y:o},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:Yt[0]},s.aiType=xo.TaskBased,a.aiType=xo.TaskBased;for(let S=0;S<5;S++){const v=S/5*Math.PI*2,A=We/2,T=Ye/2,w={x:n+Math.cos(v)*A,y:o+Math.sin(v)*T},E=ar(e,{x:w.x,y:w.y},t,"male",!1);E.leaderId=E.id,E.tribeInfo={tribeBadge:gu[S%gu.length],tribeColor:Yt[S%Yt.length]};const C=ar(e,{x:w.x+50,y:w.y},t,"female",!1);C.leaderId=E.id,C.tribeInfo=E.tribeInfo}for(let S=0;S<yT;S++){const v={x:n+We*(Math.random()-Math.random()),y:o+Ye*(Math.random()-Math.random())};Cs(e,v,"male",void 0,void 0,cl()),Cs(e,{x:v.x+20,y:v.y},"female",void 0,void 0,cl())}const c={x:n+We*(Math.random()-Math.random()),y:o+Ye*(Math.random()-Math.random())};Ps(e,c,"male",void 0,void 0,ul()),Ps(e,{x:c.x+20,y:c.y},"female",void 0,void 0,ul());const d=[{id:"muteButton",action:Te.ToggleMute,currentWidth:$i,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:kt},{id:"pauseButton",action:Te.TogglePause,currentWidth:$i,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:kt},{id:"returnToIntroButton",action:Te.ReturnToIntro,currentWidth:$i,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:kt}],u=xT(),h=UT(),p={time:t,entities:e,mapDimensions:{width:We,height:Ye},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:JS,isMuted:!1,uiButtons:d,tutorial:u,tutorialState:h,debugPanel:qe.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:yr.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:ur,preyProcreationCooldown:dr,predatorGestationPeriod:fr,predatorProcreationCooldown:hr,preyHungerIncreasePerHour:ko,predatorHungerIncreasePerHour:Mo,berryBushSpreadChance:Xi,treeSpreadChance:Vi},soilDepletion:ap(),temperature:CT(We,Ye),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(We/Ae)*Math.ceil(Ye/Ae)).fill(null),navigationGrid:$u(We,Ye),pathfindingQueue:[],tasks:{}};Object.values(p.entities.entities).forEach(S=>{S.type==="tree"&&Is(p,S.position,S.radius,!0,null,Ts)});const m=hl(p);return console.log("Game world initialized:",m),m}function $M(){const e=FT(),t=0;for(let u=0;u<nS;u++){const h={x:Math.random()*We,y:Math.random()*Ye};Il(e,h,t)}for(let u=0;u<tS;u++){const h={x:Math.random()*We,y:Math.random()*Ye};Es(e,h,t)}const n=We/2,o=Ye/2;for(let u=0;u<5;u++){const h=u/5*Math.PI*2,p=100+Math.random()*100,m={x:n+Math.cos(h)*p,y:o+Math.sin(h)*p};Es(e,m,t,Lo)}for(let u=0;u<L1;u++){const h={x:Math.random()*We,y:Math.random()*Ye},p=Math.random()<.5?"male":"female";ar(e,h,t,p,!1)}for(let u=0;u<yT;u++){const h={x:Math.random()*We,y:Math.random()*Ye};Cs(e,h,"male",void 0,void 0,cl()),Cs(e,{x:h.x+20,y:h.y},"female",void 0,void 0,cl())}const s={x:Math.random()*We,y:Math.random()*Ye};Ps(e,s,"male",void 0,void 0,ul()),Ps(e,{x:s.x+20,y:s.y},"female",void 0,void 0,ul());const a=xT(),c=UT(),d={time:t,entities:e,mapDimensions:{width:We,height:Ye},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:We/2,y:Ye/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:JS,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:c,debugPanel:qe.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:ur,preyProcreationCooldown:dr,predatorGestationPeriod:fr,predatorProcreationCooldown:hr,preyHungerIncreasePerHour:ko,predatorHungerIncreasePerHour:Mo,berryBushSpreadChance:Xi,treeSpreadChance:Vi},soilDepletion:ap(),temperature:CT(We,Ye),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(We/Ae)*Math.ceil(Ye/Ae)).fill(null),navigationGrid:$u(We,Ye),pathfindingQueue:[],tasks:{}};return Object.values(d.entities.entities).forEach(u=>{u.type==="tree"&&Is(d,u.position,u.radius,!0,null,Ts)}),hl(d)}const WM="humanProcreation",YM="human",zM="human",jM=Qe,XM=(e,t,n)=>Rs(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,VM=(e,t,n)=>{const{gameState:o}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,c=e.gender==="female"?e:t,d=(a.partnerIds||[]).length===0;if(e.stateMachine[0]!==sr&&(e.stateMachine=[sr,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:n.gameState.time+1}]),t.stateMachine[0]!==sr&&(t.stateMachine=[sr,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),d&&a.leaderId&&a.leaderId!==a.id){const u=o.entities.entities[a.leaderId];if(u){const h=Uh(a,u),p=Uh(c,u);if(!h&&!p){const m=yu();a.leaderId=a.id,a.tribeInfo={tribeBadge:m,tribeColor:Yt[Math.floor(Math.random()*Yt.length)]},a.tribeControl={diplomacy:{}},c.leaderId=a.id,c.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&c){const u=yu();a.leaderId=a.id,a.tribeInfo={tribeBadge:u,tribeColor:Yt[Math.floor(Math.random()*Yt.length)]},a.tribeControl={diplomacy:{}},c.leaderId=a.id,c.tribeInfo=a.tribeInfo}e.activeAction=void 0,Fe(o,Pe.Procreation,s,sl),Fe(o,Pe.Partnered,e.position,Xe,e.id),Fe(o,Pe.Partnered,t.position,Xe,t.id),e.lastPartneredEffectTime=o.time,t.lastPartneredEffectTime=o.time,t.activeAction=void 0,ke(n,_e.Procreate,s)},qM={id:WM,sourceType:YM,targetType:zM,maxDistance:jM,checker:XM,perform:VM},ZM={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:mS,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=No&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-No),e.feedChildCooldownTime=hE,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Fe(n.gameState,Pe.ChildFed,t.position,Xe,t.id),t.lastChildFedEffectTime=n.gameState.time),ke(n,_e.ChildFed,t.position)}},KM={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:An,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==Fo||e.attackTargetId!==t.id)return!1;const o=J(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=Bo,a=!s&&o<=An;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?Nu:hp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:o}=n,s=J(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>Bo,c=Le(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),d=Sw(mt(c),t.direction);if(Math.abs(d)<CE*Math.PI/180&&Math.random()<PE)Fe(o,Pe.AttackDeflected,t.position,Xe,t.id);else{let p=a?fp:dp;if(e.gender==="male"&&(p*=AE),e.isAdult||(p*=wE),(!t.isAdult||t.age>=up)&&e.isAdult&&(p*=EE),a){const S=s/pp;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+S,data:{attackerId:e.id,targetId:t.id,damage:p,pushbackForce:mp,attackerPosition:{...e.position}}}),Fe(o,Pe.StoneProjectile,e.position,S,void 0,t.position,t.id),ke(n,_e.Attack,e.position)}else{t.hitpoints-=p,t.movementSlowdown={modifier:Bu,endTime:o.time+Hu},Fe(o,Pe.Hit,t.position,Xe,t.id);const S=Le(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),v=lt(S,vE);t.forces.push(v),t.hitpoints<=0?ke(n,_e.HumanDeath,t.position):ke(n,_e.Attack,e.position),Fe(o,Pe.Attack,e.position,Xe,e.id)}}e.attackCooldown={melee:gl,ranged:gp};const h=e.stateMachine[1];h.attackStartTime=o.time}},QM={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:ht*2,checker:(e,t,{gameState:n})=>J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const o=J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(o===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const a=(e.radius+t.radius-o)*.05,c=mt(qh(e.position,t.position)),d=lt(c,a);e.forces.push(d),t.forces.push(lt(d,-1))}},JM={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:ht*.6+wr*.4,checker:(e,t,{gameState:n})=>{const o=t.stateMachine[0];if(o==="fallen"||o==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=s+o-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=lt(u,d);e.forces.push(h)}},eb={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:ht*.6+wr*.4,checker:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4;return J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+o},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=s+o-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=lt(u,d);e.forces.push(h)}},tb={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:ht*.6+wr*.4,checker:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4;return J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+o},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=s+o-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=lt(u,d);e.forces.push(h)}},nb={id:"human-building-collision",sourceType:"human",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==q.Palisade&&t.buildingType!==q.Gate||!t.isConstructed||t.buildingType===q.Gate&&e.leaderId===t.ownerId)return!1;const o=e.radius*.25,s=t.radius;return J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.25,s=t.radius,a=J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=o+s-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=lt(u,d);e.forces.push(h)}},ib={id:"prey-building-collision",sourceType:"prey",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==q.Palisade&&t.buildingType!==q.Gate||!t.isConstructed)return!1;const o=e.radius*.4,s=t.radius;return J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.4,s=t.radius,a=J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=o+s-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=lt(u,d);e.forces.push(h)}},ob={id:"predator-building-collision",sourceType:"predator",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==q.Palisade&&t.buildingType!==q.Gate||!t.isConstructed)return!1;const o=e.radius*.4,s=t.radius;return J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.4,s=t.radius,a=J(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const c=o+s-a;if(c<=0)return;const d=c*2.5,u=mt(Le(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=lt(u,d);e.forces.push(h)}},rb={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:Qe,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Ms&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Fe(n.gameState,Pe.BushClaimed,t.position,Xe),ke(n,_e.Gather,e.position)}},sb={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:Qe,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Ms&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=n.gameState.time+1,ke(n,_e.Gather,e.position)}},ab={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:Qe,checker:(e,t,n)=>e.isAdult&&t.stateMachine[0]===jt&&t.wood.length>0&&e.stateMachine[0]===Ms&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.wood.pop();o&&(e.heldItem=o),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[wi,{enteredAt:n.gameState.time,previousState:jt}]),ke(n,_e.Gather,e.position)}},lb=[rb,sb,ab],cb={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:As,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=N_,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+O_,Fe(n.gameState,Pe.BushClaimed,t.position,Xe,e.id),ke(n,_e.Gather,e.position))}},ub={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:x_,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=U_;const o=Le(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=lt(o,8);t.forces.push(s),e.huntCooldown=W_,t.hitpoints<=0?(ke(n,_e.HumanDeath,t.position),Fe(n.gameState,Pe.Hit,t.position,Xe,t.id)):(Fe(n.gameState,Pe.Hit,t.position,Xe,t.id),t.fleeCooldown=5,ke(n,_e.Attack,e.position)),Fe(n.gameState,Pe.Attack,e.position,Xe,e.id)}},db={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:An,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==Fo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=J(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=Bo,a=!s&&o<=An;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?Nu:hp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:o}=n,s=J(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>Bo;let c=(a?fp:dp)*1.2;if(e.gender==="male"&&(c*=1.3),a){const u=s/pp;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+u,data:{attackerId:e.id,targetId:t.id,damage:c,pushbackForce:mp,attackerPosition:{...e.position}}}),Fe(o,Pe.StoneProjectile,e.position,u,void 0,t.position,t.id),ke(n,_e.Attack,e.position)}else{t.hitpoints-=c;const u=Le(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),h=lt(u,6);t.forces.push(h),t.hitpoints<=0?(ke(n,_e.HumanDeath,t.position),Fe(o,Pe.Hit,t.position,Xe,t.id)):(Fe(o,Pe.Hit,t.position,Xe,t.id),t.fleeCooldown=8,ke(n,_e.Attack,e.position)),Fe(o,Pe.Attack,e.position,Xe,e.id)}e.attackCooldown={melee:gl,ranged:gp};const d=e.stateMachine[1];d.attackStartTime=o.time}},fb={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:Pr,checker:(e,t,n)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=n.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,n)=>{let o=pT;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:Bu,endTime:n.gameState.time+Hu};const s=Le(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=lt(s,7);t.forces.push(a),e.attackCooldown=gT,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Dp),ke(n,_e.HumanDeath,t.position),Fe(n.gameState,Pe.Hit,t.position,Xe,t.id)):(Fe(n.gameState,Pe.Hit,t.position,Xe,t.id),ke(n,_e.Attack,e.position)),Fe(n.gameState,Pe.Attack,e.position,Xe,e.id)}},hb={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:An,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==Fo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=J(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=Bo,a=!s&&o<=An;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const d=s?Nu:hp,u=e.stateMachine[1];return n.gameState.time-u.attackStartTime>=d},perform:(e,t,n)=>{const{gameState:o}=n,s=J(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>Bo;let c=(a?fp:dp)*.8;e.gender==="male"&&(c*=1.2);const d=Object.values(o.entities.entities).filter(h=>h.type==="human"&&h.id!==e.id).filter(h=>{const p=h;return Math.sqrt(Math.pow(p.position.x-e.position.x,2)+Math.pow(p.position.y-e.position.y,2))<100&&p.activeAction==="attacking"&&p.attackTargetId===t.id}).length;if(d>0&&(c*=1+d*.2),a){const h=s/pp;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+h,data:{attackerId:e.id,targetId:t.id,damage:c,pushbackForce:mp,attackerPosition:{...e.position}}}),Fe(o,Pe.StoneProjectile,e.position,h,void 0,t.position,t.id),ke(n,_e.Attack,e.position)}else{t.hitpoints-=c;const h=Le(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),p=lt(h,8);t.forces.push(p),t.hitpoints<=0?(ke(n,_e.HumanDeath,t.position),Fe(o,Pe.Hit,t.position,Xe,t.id)):(Fe(o,Pe.Hit,t.position,Xe,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),ke(n,_e.Attack,e.position)),Fe(o,Pe.Attack,e.position,Xe,e.id)}e.attackCooldown={melee:gl,ranged:gp};const u=e.stateMachine[1];u.attackStartTime=o.time}},pb={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:As,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Fe(n.gameState,Pe.Procreation,o.position,Xe,o.id),ke(n,_e.Procreate,o.position)}},gb={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:ws,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.pregnancyFatherId=e.gender==="male"?e.id:t.id,o.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Fe(n.gameState,Pe.Procreation,o.position,Xe,o.id),ke(n,_e.Procreate,o.position)}},mb={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:vT,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Tu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-Tu),e.feedChildCooldownTime=ST,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Fe(n.gameState,Pe.ChildFed,t.position,Xe,t.id),t.lastChildFedEffectTime=n.gameState.time),ke(n,_e.ChildFed,t.position)}},yb={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:vT,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Tu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-Tu),e.feedChildCooldownTime=ST,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Fe(n.gameState,Pe.ChildFed,t.position,Xe,t.id),t.lastChildFedEffectTime=n.gameState.time),ke(n,_e.ChildFed,t.position)}},vb={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:ws,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-Dp),e.eatingCooldownTime=n.gameState.time+2,Fe(n.gameState,Pe.Eating,e.position,Xe,e.id),ke(n,_e.Gather,e.position))}},Sb={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:Pr,checker:(e,t,n)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=n.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,n)=>{let o=pT;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:Bu,endTime:n.gameState.time+Hu};const s=Le(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=lt(s,7);t.forces.push(a),e.attackCooldown=gT,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Dp),ke(n,_e.HumanDeath,t.position),Fe(n.gameState,Pe.Hit,t.position,Xe,t.id)):(Fe(n.gameState,Pe.Hit,t.position,Xe,t.id),ke(n,_e.Attack,e.position)),Fe(n.gameState,Pe.Attack,e.position,Xe,e.id)}},Tb=25;function Yy(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function GT(e){const t=e.storedItems.length,n=Yy(t+e.id)*2*Math.PI,o=Yy(t+e.id+1)*Tb;return{x:Math.cos(n)*o,y:Math.sin(n)*o}}const Ib={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:ci,checker:(e,t,n)=>{var h;const o=t.buildingType===q.StorageSpot,s=t.buildingType===q.Bonfire;if(!o&&!s||e.stateMachine[0]!==Va||!t.isConstructed)return!1;const a=e.food.length>0,c=((h=e.heldItem)==null?void 0:h.type)===Lt.Wood;if(s&&!c||!a&&!c)return!1;const d=t.storageCapacity??0;return!(t.storedItems.length>=d||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<n_)},perform:(e,t,n)=>{var s;let o=null;t.buildingType===q.Bonfire?((s=e.heldItem)==null?void 0:s.type)===Lt.Wood&&(o=e.heldItem,e.heldItem=void 0):e.heldItem?(o=e.heldItem,e.heldItem=void 0):o=e.food.pop()??null,o&&t.storedItems.push({item:o,positionOffset:GT(t)}),t.lastDepositTime=n.gameState.time,ke(n,_e.StorageDeposit,t.position)}},Ab={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:ci,checker:(e,t,n)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==qa||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<i_),perform:(e,t,n)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&(e.food.push(o.item),GT(t)),t.lastRetrieveTime=n.gameState.time,ke(n,_e.StorageRetrieve,t.position)}},wb={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:ci,checker:(e,t,n)=>{var d;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Ms||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const o=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!o||!((d=o.tribeControl)!=null&&d.diplomacy)||(t.ownerId?o.tribeControl.diplomacy[t.ownerId]:void 0)!==Rt.Hostile||n.gameState.time-(t.lastStealTime??0)<o_)return!1;const c=WS({leaderId:t.ownerId},n.gameState);for(const u of c)if(J(e.position,u.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=r_)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&e.food.push(o.item),t.lastStealTime=n.gameState.time,ke(n,_e.StorageSteal,t.position),Fe(n.gameState,Pe.Attack,t.position,.5)}},Eb={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!vr(e,t,n.gameState)||!IS(t.position,Ki,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,wS(t.position,Ki,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Fe(n.gameState,Pe.BushClaimed,t.position,2,t.id)}},Cb={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!vr(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Fe(n.gameState,Pe.Hit,t.position,1,t.id)}},Pb={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:Ou,checker:(e,t,n)=>{const[o]=t.stateMachine??[],s=o===oi||o===zn||o===Ai;return e.isAdult&&s&&e.stateMachine[0]===Mp&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const{gameState:o}=n;if(t.stateMachine=[jt,{enteredAt:o.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/Lo),a=Math.floor(xy+s*(ju-xy));t.wood=Array.from({length:a},()=>({itemType:"item",type:Lt.Wood,id:o.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=o.time+1,ke(n,_e.Gather,e.position)}},_b={id:"human-attack-building",sourceType:"human",targetType:"building",maxDistance:40,checker:(e,t,n)=>{const{gameState:o}=n;return!(t.buildingType!==q.Palisade&&t.buildingType!==q.Gate||!t.ownerId||t.ownerId===e.leaderId||e.attackCooldown&&e.attackCooldown.melee>o.time)},perform:(e,t,n)=>{const{gameState:o}=n;t.isBeingDestroyed=!0;const s=.1;t.destructionProgress=Math.min(1,t.destructionProgress+s),e.attackCooldown||(e.attackCooldown={melee:0,ranged:0}),e.attackCooldown.melee=o.time+gl,Fe(o,Pe.Hit,t.position,.5,e.id,void 0,t.id)}},Rb=[QM,JM,eb,tb,nb,ib,ob,...lb,qM,ZM,KM,Ib,Ab,wb,Eb,Cb,Pb,_b,cb,mb,yb,vb,ub,db,hb,fb,Sb,pb,gb],zy=Object.values(Rb.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const o={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[n].interactions.push(o),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));let jy=0;function $T(e){const{gameState:t}=e,n=t,{width:o,height:s}=t.mapDimensions;jy++;const a=jy%2===0;for(let c=0;c<zy.length;c++){const d=zy[c],u=n.search[d.sourceType].all();for(let h=0;h<u.length;h++){const p=u[h],m=n.search[d.targetType].byRadius(p.position,d.maxDistance);for(let S=0;S<m.length;S++){const v=m[S];if(p.id===v.id)continue;const A=zt(p.position,v.position,o,s);for(let T=0;T<d.interactions.length;T++){const w=d.interactions[T];!w.isCollision&&a||A<=w.maxDistanceSq&&w.checker(p,v,e)&&w.perform(p,v,e)}}}}}function Hp(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function kb(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),o=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const u=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,p=50+Math.random()*100;a={x:Math.max(50,Math.min(We-50,u.position.x+Math.cos(h)*p)),y:Math.max(50,Math.min(Ye-50,u.position.y+Math.sin(h)*p))}}else a={x:50+Math.random()*(We-100),y:50+Math.random()*(Ye-100)};let c=!0;const d=100;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){c=!1;break}if(c){for(const u of o)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){c=!1;break}}if(c)return a}return{x:We*.3+Math.random()*We*.4,y:Ye*.3+Math.random()*Ye*.4}}function Mb(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const u=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,p=100+Math.random()*150;a={x:Math.max(50,Math.min(We-50,u.position.x+Math.cos(h)*p)),y:Math.max(50,Math.min(Ye-50,u.position.y+Math.sin(h)*p))}}else a={x:50+Math.random()*(We-100),y:50+Math.random()*(Ye-100)};let c=!0;const d=150;for(const u of n)if(Math.sqrt((a.x-u.position.x)**2+(a.y-u.position.y)**2)<d){c=!1;break}if(c)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*We,y:50+Math.random()*100};case 1:return{x:We-150+Math.random()*100,y:Math.random()*Ye};case 2:return{x:Math.random()*We,y:Ye-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Ye}}}function bb(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let o=0;o<20;o++){const s={x:50+Math.random()*(We-100),y:50+Math.random()*(Ye-100)};let a=!0;const c=80,d=60;for(const u of t)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<c){a=!1;break}if(a){for(const u of n)if(Math.sqrt((s.x-u.position.x)**2+(s.y-u.position.y)**2)<d){a=!1;break}}if(a)return s}return{x:Math.random()*We,y:Math.random()*Ye}}function WT(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let o=0;o<t;o++){const s=kb(n),a=o%2===0?"male":"female";Cs(e.entities,s,a,void 0,void 0,cl())}}function YT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let o=0;o<t;o++){const s=Mb(n),a=o%2===0?"male":"female";Ps(e.entities,s,a,void 0,void 0,ul())}}function Db(e){const t=e,n=t.search.prey.count(),o=t.search.predator.count();let s=!1;return n===0&&(WT(e,6),s=!0),o===0&&(YT(e,3),s=!0),s}function Ob(e){const t=e,n=t.search.prey.count(),o=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const c=Math.max(2,Math.floor(8-n));WT(e,c),a=!0}if(o>0&&o<2){const c=Math.max(1,Math.floor(3-o));YT(e,c),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let c=0;c<5;c++){const d=bb(t);Il(e.entities,d,e.time)}a=!0}return a}const Nb=1,Bb=.3,Hb=.8,Xy=.8,Fb=.99,Lb=.05;var zT=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.INCREASE_TREE_SPREAD=14]="INCREASE_TREE_SPREAD",e[e.DECREASE_TREE_SPREAD=15]="DECREASE_TREE_SPREAD",e[e.NO_ACTION=16]="NO_ACTION",e))(zT||{});const dh=Object.keys(zT).length/2;class xb{constructor(){Gt(this,"qTable",new Map);Gt(this,"epsilon",Xy);Gt(this,"lastState",null);Gt(this,"lastAction",null)}discretizeState(t,n,o,s){const a=Math.min(4,Math.floor(t/25)),c=Math.min(4,Math.floor(n/5)),d=Math.min(4,Math.floor(o/15)),u=Math.min(4,Math.floor(s/50));return`${a}-${c}-${d}-${u}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,o){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,o)}getBestAction(t){let n=0,o=this.getQValue(t,0);for(let s=1;s<dh;s++){const a=this.getQValue(t,s);a>o&&(o=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*dh):this.getBestAction(t)}applyEmergencyCorrections(t,n,o,s,a){t<Wi*.5&&(a.ecosystem.preyGestationPeriod=Math.max(rs,a.ecosystem.preyGestationPeriod*.8),a.ecosystem.preyProcreationCooldown=Math.max(ss,a.ecosystem.preyProcreationCooldown*.8),a.ecosystem.preyHungerIncreasePerHour=Math.max(cs,a.ecosystem.preyHungerIncreasePerHour*.9)),n<Yi*.6&&(a.ecosystem.predatorGestationPeriod=Math.max(as,a.ecosystem.predatorGestationPeriod*.75),a.ecosystem.predatorProcreationCooldown=Math.max(ls,a.ecosystem.predatorProcreationCooldown*.75),a.ecosystem.predatorHungerIncreasePerHour=Math.max(us,a.ecosystem.predatorHungerIncreasePerHour*.85)),o<zi*.5&&(a.ecosystem.berryBushSpreadChance=Math.min(Ba,a.ecosystem.berryBushSpreadChance*1.2)),s<ji*.5&&(a.ecosystem.treeSpreadChance=Math.min(Ua,a.ecosystem.treeSpreadChance*1.2)),t>Wi*1.4&&(a.ecosystem.preyHungerIncreasePerHour=Math.min(ko,a.ecosystem.preyHungerIncreasePerHour*1.05)),n>Yi*1.4&&(a.ecosystem.predatorHungerIncreasePerHour=Math.min(Mo,a.ecosystem.predatorHungerIncreasePerHour*1.05)),o>zi*1.4&&(a.ecosystem.berryBushSpreadChance=Math.max(Xi,a.ecosystem.berryBushSpreadChance*.95)),s>ji*1.4&&(a.ecosystem.treeSpreadChance=Math.max(Vi,a.ecosystem.treeSpreadChance*.95))}calculateReward(t,n,o,s){const a=Math.abs(t-Wi),c=Math.abs(n-Yi),d=Math.abs(o-zi),u=Math.abs(s-ji),h=a/Wi,p=c/Yi,m=d/zi,S=u/ji,v=h+p+m+S;return 100*Math.exp(-v*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(ur,n.ecosystem.preyGestationPeriod+.2*(ur-rs));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(rs,n.ecosystem.preyGestationPeriod-.2*(ur-rs));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(dr,n.ecosystem.preyProcreationCooldown+.2*(dr-ss));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max(ss,n.ecosystem.preyProcreationCooldown-.2*(dr-ss));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(ko,n.ecosystem.preyHungerIncreasePerHour+.2*(ko-cs));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(cs,n.ecosystem.preyHungerIncreasePerHour-.2*(ko-cs));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(fr,n.ecosystem.predatorGestationPeriod+.2*(fr-as));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max(as,n.ecosystem.predatorGestationPeriod-.2*(fr-as));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min(hr,n.ecosystem.predatorProcreationCooldown+.2*(hr-ls));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(ls,n.ecosystem.predatorProcreationCooldown-.2*(hr-ls));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(Mo,n.ecosystem.predatorHungerIncreasePerHour+.2*(Mo-us));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(us,n.ecosystem.predatorHungerIncreasePerHour-.2*(Mo-us));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(Ba,n.ecosystem.berryBushSpreadChance+.2*(Ba-Xi));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(Xi,n.ecosystem.berryBushSpreadChance-.2*(Ba-Xi));break;case 14:n.ecosystem.treeSpreadChance=Math.min(Ua,n.ecosystem.treeSpreadChance+.2*(Ua-Vi));break;case 15:n.ecosystem.treeSpreadChance=Math.max(Vi,n.ecosystem.treeSpreadChance-.2*(Ua-Vi));break}}updateQTable(t,n,o,s){const a=this.getQValue(t,n),c=Math.max(...Array.from({length:dh},(u,h)=>this.getQValue(s,h))),d=a+Bb*(o+Hb*c-a);this.setQValue(t,n,d)}step(t){const n=t,o=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count(),c=n.search.tree.count();this.applyEmergencyCorrections(o,s,a,c,t);const d=this.discretizeState(o,s,a,c);if(this.lastState!==null&&this.lastAction!==null){const h=this.calculateReward(o,s,a,c);this.updateQTable(this.lastState,this.lastAction,h,d)}const u=this.chooseAction(d);this.applyAction(u,t),this.epsilon=Math.max(Lb,this.epsilon*Fb),this.lastState=d,this.lastAction=u}reset(){this.qTable.clear(),this.epsilon=Xy,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let jT=new xb;function Ub(e){Db(e),Ob(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=rs+(ur-rs)*.3,e.ecosystem.preyProcreationCooldown=ss+(dr-ss)*.3,e.ecosystem.preyHungerIncreasePerHour=cs+(ko-cs)*.3,e.ecosystem.predatorGestationPeriod=as+(fr-as)*.3,e.ecosystem.predatorProcreationCooldown=ls+(hr-ls)*.3,e.ecosystem.predatorHungerIncreasePerHour=us+(Mo-us)*.3,e.ecosystem.berryBushSpreadChance=Xi+(Ba-Xi)*.7,e.ecosystem.treeSpreadChance=Vi+(Ua-Vi)*.2),jT.step(e)}function Gb(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<Nb)&&(e.ecosystem.lastUpdateTime=e.time,Ub(e))}function $b(){return jT.getStats()}function Wb(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function Yb(e){const{gameState:t}=e,n=t.time,o=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of o)switch(a.type){case"ranged-impact":{const c=t.entities.entities[a.data.targetId];if(!c||c.hitpoints<=0)continue;c.hitpoints-=a.data.damage,c.movementSlowdown={modifier:Bu,endTime:t.time+Hu};const d=Le(a.data.attackerPosition,c.position,t.mapDimensions.width,t.mapDimensions.height),u=lt(d,a.data.pushbackForce);c.forces.push(u),Fe(t,Pe.Hit,c.position,Xe,c.id),c.hitpoints<=0?ke(e,_e.HumanDeath,c.position):ke(e,_e.Attack,c.position);break}}}const XT="ownedIndices",Vy="frontierScanIndex",Za="frontierCandidates";function zb(e){const{gameState:t}=e,n=t,s=n.search.human.all().filter(h=>h.leaderId===h.id),{width:a,height:c}=t.mapDimensions,d=Math.ceil(a/Ae),u=Math.ceil(c/Ae);for(const h of s){if(!h.aiBlackboard)continue;const p=Oe.get(h.aiBlackboard,XT)||[];if(p.length===0)continue;let m=Oe.get(h.aiBlackboard,Vy)||0;const S=Oe.get(h.aiBlackboard,Za)||{},v=ai(h.id,t),A=20;for(let w=0;w<A;w++){m>=p.length&&(m=0);const E=p[m];m=(m+1)%p.length;const C=E%d,_=Math.floor(E/d),M=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:P,dy:k}of M){const R=(C+P+d)%d,H=(_+k+u)%u,G=H*d+R,F=t.terrainOwnership[G],Y=F!==null&&Ji(h.id,F,t);if(F===null||Y){let Z=0;for(const{dx:z,dy:he}of M){const me=(R+z+d)%d,de=(H+he+u)%u;t.terrainOwnership[de*d+me]===h.id&&Z++}const W=Z*20,j=Hh(G,a),ee=n.search.berryBush.byRadius(j,100),se=n.search.tree.byRadius(j,100),ae=ee.length*10+se.length*5,Q=Y?50:0,ne=J(j,v,a,c)/100*5,D=W+ae+Q-ne;S[G.toString()]={score:D,fromIdx:E,lastSeenTime:t.time}}}}const T=Object.entries(S).sort((w,E)=>E[1].score-w[1].score);if(T.length>50){const w={};for(let E=0;E<50;E++){const[C,_]=T[E];w[C]=_}Oe.set(h.aiBlackboard,Za,w)}else Oe.set(h.aiBlackboard,Za,S);Oe.set(h.aiBlackboard,Vy,m)}}function jb(e,t,n){const o=[],s=new Set,a=150*150;for(let c=0;c<e.length;c++){if(s.has(c))continue;const d=[e[c]];s.add(c);const u=[e[c]];for(;u.length>0;){const h=u.shift();for(let p=0;p<e.length;p++){if(s.has(p))continue;zt(h.position,e[p].position,t,n)<a&&(s.add(p),d.push(e[p]),u.push(e[p]))}}o.push(d)}return o}function Xb(e,t,n){const{gameState:o}=n,s=o,{width:a,height:c}=o.mapDimensions,d=Math.ceil(a/Se),u=Math.ceil(c/Se),h=t.filter(m=>m.buildingType===q.Bonfire||m.buildingType===q.StorageSpot),p=jb(h,a,c);for(const m of p){if(m.length===0)continue;const S=m[0].position,v=ll(S,a,c);let A=0,T=0,w=0,E=0;for(const W of m){const j=Le(S,W.position,a,c),ee=Math.round(j.x/Se),se=Math.round(j.y/Se);A=Math.min(A,ee),T=Math.max(T,ee),w=Math.min(w,se),E=Math.max(E,se)}const C=12,_=A-C,M=T+C,P=w-C,k=E+C,R=[],H=(W,j)=>{const ee=(v.x+W+d)%d,se=(v.y+j+u)%u;R.push({x:ee*Se+Se/2,y:se*Se+Se/2})};for(let W=_;W<=M;W++)H(W,P);for(let W=P+1;W<=k;W++)H(M,W);for(let W=M-1;W>=_;W--)H(W,k);for(let W=k-1;W>P;W--)H(_,W);const G=ai(e,o);let F=0,Y=1/0;for(let W=0;W<R.length;W++){const j=zt(R[W],G,a,c);j<Y&&(Y=j,F=W)}const Z=[...R.slice(F),...R.slice(0,F)];for(let W=0;W<Z.length;W++){const j=Z[W],ee=`${Math.floor(j.x)}-${Math.floor(j.y)}`;if(s.search.building.at(j,Se/2)||Object.values(o.tasks).find(z=>(z.type===V.HumanPlacePalisade||z.type===V.HumanPlaceGate)&&zt(z.position,j,a,c)<5*5))continue;const Q=s.search.tree.byRadius(j,Se/2);if(Q.length>0){const z=Q[0],he=`Chop-Gord-${z.id}`;o.tasks[he]||(o.tasks[he]={id:he,type:V.HumanChopTree,position:z.position,creatorEntityId:e,target:z.id,validUntilTime:o.time+12});continue}const ne=W%20===0||W%20===1?V.HumanPlaceGate:V.HumanPlacePalisade,D=`${V[ne]}-${e}-${ee}`;o.tasks[D]={id:D,type:ne,position:j,creatorEntityId:e,target:j,validUntilTime:o.time+24}}}}function Vb(e){var m;const{gameState:t}=e,n=t,o=n.search.human.all(),s=new Map,a=new Set;for(let S=0;S<o.length;S++){const v=o[S];v.leaderId&&(s.has(v.leaderId)||s.set(v.leaderId,[]),s.get(v.leaderId).push(v),v.leaderId===v.id&&a.add(v.id))}const c=Object.values(t.tasks),d=new Map;for(let S=0;S<c.length;S++){const v=c[S];v.creatorEntityId&&(d.has(v.creatorEntityId)||d.set(v.creatorEntityId,[]),d.get(v.creatorEntityId).push(v))}const u=n.search.building.all(),h=new Map;for(let S=0;S<u.length;S++){const v=u[S];if(v.ownerId){const A=t.entities.entities[v.ownerId],T=A==null?void 0:A.leaderId;T&&(h.has(T)||h.set(T,[]),h.get(T).push(v))}}const p=new Map;for(const S of a)p.set(S,ai(S,t));for(const S of a){const v=t.entities.entities[S];if(!v)continue;const A=[];for(let Y=0;Y<t.terrainOwnership.length;Y++)t.terrainOwnership[Y]===S&&A.push(Y);Oe.set(v.aiBlackboard,XT,A);const T=s.get(S)||[];if(T.length<QS)continue;const w=T.filter(Y=>Y.isAdult);if(w.length===0)continue;const E=d.get(S)||[],C=Y=>E.some(Z=>Z.type===Y),_=h.get(S)||[];Xb(S,_,e);const M=[];for(const[Y,Z]of p.entries())Y!==S&&M.push(Z);if(!C(V.HumanPlaceStorage)){const Y=_.filter(se=>se.buildingType===q.StorageSpot);let Z=0,W=0;for(let se=0;se<Y.length;se++){const ae=Y[se];Z+=((m=ae.storedItems)==null?void 0:m.length)||0,W+=ae.storageCapacity||0}const j=W>0?Z/W:0;if(Y.length===0||j>LE){const se=Y.length===0?GE:Qf,ae=tu(q.StorageSpot,S,t,Kf,se,v.position,M);ae&&Gc(S,V.HumanPlaceStorage,ae,t)}}if(!C(V.HumanPlaceBonfire)){const Y=_.filter(Q=>Q.buildingType===q.Bonfire),Z=p.get(S),j=dl(t.temperature,Z,t.time,t.mapDimensions.width,t.mapDimensions.height)<sC&&Y.length===0,ee=Y.length>0&&Y.length<Math.ceil(w.length/uC);let se;const ae=T.filter(Q=>dl(t.temperature,Q.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<cr+5?Y.every(D=>J(Q.position,D.position,t.mapDimensions.width,t.mapDimensions.height)>Ya*1.5):!1);if(ae.length>=3){const Q=ae.reduce((ne,D)=>ne+D.position.x,0)/ae.length,re=ae.reduce((ne,D)=>ne+D.position.y,0)/ae.length;se={x:Q,y:re}}if(j||ee||se){const Q=tu(q.Bonfire,S,t,Kf,Qf,se||v.position,M);Q&&Gc(S,V.HumanPlaceBonfire,Q,t)}}if(!C(V.HumanPlacePlantingZone)){const Z=_.filter(j=>j.buildingType===q.PlantingZone&&IP(j,t)).reduce((j,ee)=>j+jS(ee),0),W=Math.max(UE,w.length*xE);if(Z<W){const j=tu(q.PlantingZone,S,t,Kf,Qf,v.position,M);j&&Gc(S,V.HumanPlacePlantingZone,j,t)}}const P=Oe.get(v.aiBlackboard,Za)||{},{width:k,height:R}=t.mapDimensions,H=_.filter(Y=>Y.buildingType===q.BorderPost),G=E.filter(Y=>Y.type===V.HumanPlaceBorderPost);for(const Y in P){const Z=parseInt(Y,10),W=t.terrainOwnership[Z],j=W!==null&&Ji(v.id,W,t);if(W===S||W!==null&&!j){delete P[Y];continue}const ee=Hh(Z,k);(H.some(ae=>zt(ee,ae.position,k,R)<100*100)||G.some(ae=>zt(ee,ae.position,k,R)<100*100))&&delete P[Y]}Oe.set(v.aiBlackboard,Za,P);const F=3;if(G.length<F){const Y=Object.entries(P).map(([ee,se])=>({idx:parseInt(ee,10),...se})).sort((ee,se)=>se.score-ee.score),Z=[];for(const ee of Y){if(Z.length>=F-G.length)break;const se=Hh(ee.idx,k);Z.every(Q=>zt(se,Q,k,R)>100*100)&&Z.push(se)}const W=new Set(G.map(ee=>{const se=ee.id.split("-");return parseInt(se[se.length-1],10)}).filter(ee=>!isNaN(ee))),j=[];for(let ee=0;ee<F;ee++)W.has(ee)||j.push(ee);for(let ee=0;ee<Z.length;ee++)Gc(S,V.HumanPlaceBorderPost,Z[ee],t,j[ee])}}}function Gc(e,t,n,o,s=0){const a=`${V[t]}-${e}-${s}`;o.tasks[a]={id:a,position:n,type:t,creatorEntityId:e,target:n,validUntilTime:o.time+12}}function qb(e){const{gameState:t}=e,s=t.search.human.all().filter(a=>a.leaderId===a.id);for(const a of s){if(!a.aiBlackboard)continue;const c=`diplomacy-${a.id}`;if(t.tasks[c])continue;const d=Oe.get(a.aiBlackboard,"lastDiplomacyCheckTime")??-1/0;if(t.time-d<fy)continue;const u={id:c,type:V.HumanDiplomacy,position:a.position,creatorEntityId:a.id,validUntilTime:t.time+fy};t.tasks[c]=u}}function VT(e){var o;const n=e.pathfindingQueue.splice(0,10);for(const s of n){const a=e.entities.entities[s];if(a&&a.type==="human"&&a.target){let c;if(typeof a.target=="object"?c=a.target:c=(o=e.entities.entities[a.target])==null?void 0:o.position,c){const{path:d}=aT(e,a.position,c,a);if(d)a.path=d,a.pathTarget={...c};else{const{width:u,height:h}=e.mapDimensions,p=Le(a.position,c,u,h),m=Math.sqrt(p.x*p.x+p.y*p.y);if(m<.001)continue;const S=Math.ceil(m/(Se/2)),v=p.x/S,A=p.y/S,T=p.x/m,E=-(p.y/m),C=T,_=a.radius;let M=!1;for(let P=0;P<=Math.min(S,40);P++){const k={x:a.position.x+v*P,y:a.position.y+A*P},R=[k,{x:k.x+E*_,y:k.y+C*_},{x:k.x-E*_,y:k.y-C*_},{x:k.x+E*_*.5,y:k.y+C*_*.5},{x:k.x-E*_*.5,y:k.y-C*_*.5}];for(const H of R){const G=bp(H,u,h);if(!Ar(e.navigationGrid,G,a.leaderId,!1)){const F=e.search.building.at(H,Se*1.5);if(F&&(F.buildingType===q.Palisade||F.buildingType===q.Gate)&&F.ownerId!==a.leaderId){const Y=`Breach-${a.id}`;e.tasks[Y]||(e.tasks[Y]={id:Y,type:V.HumanAttackBuilding,position:F.position,creatorEntityId:a.id,target:F.id,validUntilTime:e.time+.5,claimedByEntityId:a.id}),M=!0;break}}}if(M)break}}}}}}const Zb=1/60;function Kb(e,t){if(!e.cameraFollowingPlayer)return;const n=bt(e);n&&(e.viewportCenter=ou(e.viewportCenter,n.position,uu*t))}function Vu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(Qh(e),e.lastAutosaveTime=n)}for(;t>0;){const n=hl(e),o=Math.min(t,Zb),s=o*(Mt/Ft);n.time+=s,Kb(n,o),bE(n),OR(n),Gb(n),RP(n),CR(n),DE(n),Yb({gameState:n}),HT({gameState:n,deltaTime:o}),$T({gameState:n,deltaTime:o}),zb({gameState:n}),VT(n),Math.floor(n.time)>Math.floor(n.time-s)&&(vP(n),Vb({gameState:n}),qb({gameState:n})),Hp(n),LM(n,o),Wb(n),e=n,t-=o}return e}function fh(e,t,n){e.save();const{x:o,y:s,width:a,height:c}=t.rect,d=DS;if(e.beginPath(),e.moveTo(o+d,s),e.lineTo(o+a-d,s),e.quadraticCurveTo(o+a,s,o+a,s+d),e.lineTo(o+a,s+c-d),e.quadraticCurveTo(o+a,s+c,o+a-d,s+c),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),e.lineTo(o,s+d),e.quadraticCurveTo(o,s,o+d,s),e.closePath(),e.fillStyle=t.isDisabled?OS:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*FS)+1)/2;e.strokeStyle=HS,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<mu){const h=1-u/mu;e.fillStyle=BS,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Ip,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?NS:t.textColor,t.icon?(e.font=`${c*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+a/2,s+c/2),t.text&&(e.font=`${c*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+a-4,s+c-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+a/2,s+c/2)),e.restore()}function Qb(e,t,n,o){e.save(),e.font=`${Sy}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,c=Sy,d=a+Ty*2,u=c+Ty*2,h=o.x-d/2,p=e.canvas.height,m=t.y<p/2?t.y+t.height-Iy:t.y-u+Iy;e.fillStyle=HC,e.fillRect(h,m,d,u),e.fillStyle=FC,e.fillText(n,o.x,m+u/2+c/2),e.restore()}function Jb(e,t,n){e.save();const o=bt(t),s=[{id:"fastForwardButton",action:Te.FastForward,text:"FFWD [T]",currentWidth:$i*1.3,backgroundColor:On,textColor:kt,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:Te.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?Ha:On,currentWidth:t.isPaused?$i*1.4:$i*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:kt},{id:"muteButton",action:Te.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?Ha:On,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:$i,rect:{x:0,y:0,width:0,height:0},textColor:kt},{id:"returnToIntroButton",action:Te.ReturnToIntro,text:"EXIT",backgroundColor:On,tooltip:"Return to Main Menu [ESC]",currentWidth:$i*.9,rect:{x:0,y:0,width:0,height:0},textColor:kt}];if(t.uiButtons.push(...s),o){const h=kp(t,o),p=new Set(h.map(C=>C.type));let m=[{playerAction:ve.Gather,buttonAction:Te.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>o.isAdult===!0},{playerAction:ve.Eat,buttonAction:Te.CommandEat,shortcut:"F",name:"Eat"},{playerAction:ve.Plant,buttonAction:Te.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>o.isAdult===!0},{playerAction:ve.Procreate,buttonAction:Te.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>o.isAdult===!0},{playerAction:ve.FeedChild,buttonAction:Te.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>o.isAdult===!0},{playerAction:ve.Attack,buttonAction:Te.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>o.isAdult===!0&&o.leaderId===o.id},{playerAction:ve.TribeSplit,buttonAction:Te.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>o.leaderId!==void 0&&o.leaderId!==o.id&&o.isAdult===!0},{playerAction:ve.Build,buttonAction:Te.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>o.isAdult===!0&&o.leaderId===o.id&&Ho(o.id,t).length>QS}];m=m.filter(C=>C.condition?C.condition():!0);const S=1,v=m.length,A=v*kn+(v-1)*tr,T=S*kn+(S-1)*tr,w=(n-A)/2,E=e.canvas.height-T-20;if(m.forEach((C,_)=>{const M=_%v,P=Math.floor(_/v),k=w+M*(kn+tr),R=E+P*(kn+tr),H=!!C.toggleKey,G=H&&t.autopilotControls.behaviors[C.toggleKey],F=!p.has(C.playerAction),Z=C.playerAction===ve.Build&&t.buildMenuOpen,W=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",j=H?`${C.name}${W}`:C.name,ee=G||Z?Ha:On,se={id:`commandButton_${C.name}`,action:C.buttonAction,rect:{x:k,y:R,width:kn,height:kn},icon:Uu[C.playerAction],text:C.shortcut,backgroundColor:ee,textColor:kt,currentWidth:kn,tooltip:j,isDisabled:F,activated:G||C.buttonAction===Te.CommandBuild&&Z};t.uiButtons.push(se)}),t.buildMenuOpen){const C=[{id:"buildMenu_storageSpot",action:Te.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:Te.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_palisade",action:Te.SelectPalisade,icon:"",shortcut:"3",name:"Palisade"},{id:"buildMenu_bonfire",action:Te.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:Te.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:Te.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"},{id:"buildMenu_gate",action:Te.SelectGate,icon:"",shortcut:"7",name:"Gate"}],_=C.length,M=_*kn+(_-1)*tr,P=(n-M)/2,k=E-kn-tr;C.forEach((R,H)=>{const G=P+H*(kn+tr),F=k,Y=R.action===Te.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||R.action===Te.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||R.action===Te.SelectPalisade&&t.selectedBuildingType==="palisade"||R.action===Te.SelectBorderPost&&t.selectedBuildingType==="borderPost"||R.action===Te.SelectBonfire&&t.selectedBuildingType==="bonfire"||R.action===Te.SelectRemovalTool&&t.selectedBuildingType==="removal"||R.action===Te.SelectGate&&t.selectedBuildingType==="gate",Z={id:R.id,action:R.action,rect:{x:G,y:F,width:kn,height:kn},icon:R.icon,text:R.shortcut,backgroundColor:Y?Ha:On,textColor:kt,currentWidth:kn,tooltip:R.name,activated:Y};t.uiButtons.push(Z),fh(e,Z,t.hoveredButtonId===Z.id)})}}let a=n-Je;s.forEach(h=>{const p=Je,m=a-h.currentWidth;h.rect={x:m,y:p,width:h.currentWidth,height:bS},fh(e,h,t.hoveredButtonId===h.id),a-=h.currentWidth+BC});let c=null;t.uiButtons.filter(h=>h.id.startsWith("commandButton_")||h.id.startsWith("buildMenu_")).forEach(h=>{c||(c={x:h.rect.x,y:h.rect.y,width:h.rect.width,height:h.rect.height}),c.x=Math.min(c.x,h.rect.x),c.y=Math.min(c.y,h.rect.y),c.width=Math.max(c.width,h.rect.x+h.rect.width-c.x),c.height=Math.max(c.height,h.rect.y+h.rect.height-c.y),h.id.startsWith("commandButton_")&&fh(e,h,t.hoveredButtonId===h.id)});const u=t.hoveredButtonId?t.uiButtons.find(h=>h.id===t.hoveredButtonId):void 0;return u&&u.tooltip&&t.mousePosition&&Qb(e,u.rect,u.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:c}}function eD(e){e.save(),e.fillStyle=LC,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=xC,e.font=`${UC}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function zh(e,t,n,o){const s=t.x-n.width/2,a=t.y-n.height/2,c=s+e.x,d=a+e.y,u=(c%o.width+o.width)%o.width,h=(d%o.height+o.height)%o.height;return{x:u,y:h}}function Al(e,t,n,o){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>o.width/2&&(s=s-Math.sign(s)*o.width),Math.abs(a)>o.height/2&&(a=a-Math.sign(a)*o.height),{x:s+n.width/2,y:a+n.height/2}}function Ka(e,t,n,o){const s=Al(e.position,t,n,o),c=("radius"in e?e.radius:20)+20;return s.x>=-c&&s.x<=n.width+c&&s.y>=-c&&s.y<=n.height+c}function Gn(e,t,n,o,s,...a){const c={...s.position};for(let d=-n;d<=n;d+=n)for(let u=-t;u<=t;u+=t)s.position.x=c.x+u,s.position.y=c.y+d,o(e,s,...a);s.position=c}function qT(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const o=n.getContext("2d");if(!o)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:n,ctx:o}}function ri(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function Er(e,t){return Math.round(e*t)/t}function Fp(e,t=8){const o=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(o/(Math.PI*2)*t)%t}function Lp(e,t=8){const n=e/t*Math.PI*2;return[Math.cos(n),Math.sin(n)]}const tD=25,nD=0,qy=28;function ZT(e,t,n,o,s,a,c,d,u,h){e.save();const{x:p,y:m}=Al(t,c,{width:d,height:u},h);e.strokeStyle=o,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(p,m,n+Fu,0,2*Math.PI),e.stroke(),e.restore()}function iD(e,t,n,o,s,a,c){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&ZT(e,m.targetEntity.position,m.targetEntity.radius,Sp,Tp,2,o,s,a,c)}),e.font=`${vs}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:d,y:u}=Al(n.position,o,{width:s,height:a},c);let h=0,p={};t.forEach(m=>{const S=Uu[m.type];if(m.targetEntity){p[m.targetEntity.id]=(p[m.targetEntity.id]||0)+1;const v=m.targetEntity.position.x-o.x+s/2,A=m.targetEntity.position.y-o.y+a/2,T=`${S}${m.key.toUpperCase()}`,w=A-m.targetEntity.radius-Fu-vs/2-(p[m.targetEntity.id]-1)*qy;e.fillText(T,v,w)}else{e.textAlign="left";const v=`${S}${m.key.toUpperCase()}`,A=d+tD,w=u+nD+h*qy;e.fillText(v,A,w),h++,e.textAlign="center"}}),e.restore()}function oD(e,t,n,o,s,a,c){const h=nh+8+30,p={x:Py,y:a-Py-h,width:nh,height:nh};t.minimapRect=p,e.save(),e.fillStyle=dP,e.fillRect(p.x,p.y,p.width,p.height),e.strokeStyle=uP,e.lineWidth=2,e.strokeRect(p.x,p.y,p.width,p.height);const{width:m,height:S}=t.mapDimensions,v=Math.ceil(m/Ae),A=Math.ceil(S/Ae),T=new Map;o.forEach((le,ge)=>{const x=le.isPlayerTribe?0:ge%(Yt.length-1)+1;T.set(le.leaderId,Yt[x])});const w=p.width/v,E=p.height/A,C=p.x+p.width/2,_=p.y+p.height/2,M=v>400?4:v>200?2:1;for(let le=0;le<A;le+=M)for(let ge=0;ge<v;ge+=M){const x=le*v+ge,ce=t.terrainOwnership[x];if(ce!==null){const pe=(ge+.5)*Ae,we=(le+.5)*Ae,K=Le(n,{x:pe,y:we},m,S),$e=C+K.x/m*p.width,xe=_+K.y/S*p.height,He=t.hoveredMinimapTribeId===ce;if(e.fillStyle=T.get(ce)||"#888",He){const ct=(Math.sin(t.time*5)+1)/2;e.globalAlpha=.6+ct*.4}else e.globalAlpha=.8;e.fillRect($e-w*M/2,xe-E*M/2,w*M,E*M)}}e.globalAlpha=1,e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip();for(const le of o){if(!le.territoryCenter)continue;const ge=Le(n,le.territoryCenter,m,S),x=C+ge.x/m*p.width,ce=_+ge.y/S*p.height;e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="white",e.fillText(le.tribeBadge,x,ce),le.isPlayerTribe&&(e.strokeStyle="gold",e.lineWidth=1,e.beginPath(),e.arc(x,ce,10,0,Math.PI*2),e.stroke())}e.restore();const P=s/c,k=a/c,R=P/m*p.width,H=k/S*p.height;e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.strokeRect(C-R/2,_-H/2,R,H),e.restore(),e.restore();const G=p.y+p.height+8,F=p.x,Y=G,Z="recenter_camera_btn",W={id:Z,action:Te.RecenterCamera,rect:{x:F,y:Y,width:30,height:30},text:"",currentWidth:30,backgroundColor:t.cameraFollowingPlayer?Ha:On,textColor:kt,tooltip:"Lock camera to player"};t.uiButtons.push(W),e.fillStyle=t.hoveredButtonId===Z?"#4a5568":W.backgroundColor,e.fillRect(F,Y,30,30),e.strokeStyle="#666",e.strokeRect(F,Y,30,30);const j=F+30/2,ee=Y+30/2,se=30*.35;e.strokeStyle=kt,e.lineWidth=2,e.beginPath(),e.arc(j,ee,se,0,Math.PI*2),e.stroke();const ae=se*.6;e.beginPath(),e.moveTo(j-ae,ee),e.lineTo(j+ae,ee),e.moveTo(j,ee-ae),e.lineTo(j,ee+ae),e.stroke(),e.fillStyle=kt,e.beginPath(),e.arc(j,ee,2,0,Math.PI*2),e.fill();const Q="open_tribe_modal_btn",re=`Tribes (${o.length})`;e.font='10px "Press Start 2P", Arial';const ne=e.measureText(re),D=Math.max(30,ne.width+16),z=30,he=F+30+8,me=G,de={id:Q,action:Te.OpenTribeModal,rect:{x:he,y:me,width:D,height:z},text:re,currentWidth:D,backgroundColor:On,textColor:kt,tooltip:"View all tribes and diplomacy"};t.uiButtons.push(de),e.fillStyle=t.hoveredButtonId===Q?"#4a5568":On,e.fillRect(he,me,D,z),e.strokeStyle="#666",e.strokeRect(he,me,D,z),e.fillStyle=kt,e.textAlign="center",e.textBaseline="middle",e.fillText(re,he+D/2,me+z/2)}const De=(e,t,n,o,s,a,c)=>{a==="transparent"||o<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*c),Math.floor(n*c),Math.ceil(o*c),Math.ceil(s*c)))},Zy=10,Ky=10,yi=6,Fi=4,$c=2,rD=5,Un=4,sD=2,Qt=4,aD=2,dt=3,Jr=2,Po=0,Qa=Po+Fi-1,sn=Qa,Tt=Qa+Un-1,lD="rgba(0, 0, 0, 0.4)",cD=4,uD=1,xp={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,o,s,a,c,d="male",u=20,h=[1,0],p=!1,m=0){const S=["dead","stunned"].includes(c),v=S?Ky+4:Zy,A=S?Zy+4:Ky+dt,T=.15,w=Math.min(o*(1-2*T)/v,s*(1-2*T)/A),E=v*w,C=A*w,_=t+(o-E)/2,M=n+(s-C)/2;e.save(),h[0]<0&&!S?(e.translate(_+E,M),e.scale(-1,1)):e.translate(_,M);const k="#D09A5A",R=u>50?"#BDBDBD":"#281808",H="#7F5C4A",G="#6B4F3A",F="#E0D8C0",Y="#A0522D",Z=1-Math.max(0,Math.min(100,m))/100*.2,W=d==="male"?1.1:.9,j=.8+(Math.max(1,Math.min(u,60))-1)/59*.2;let ee=rD*Z*W*j,se=sD*Z*W*j,ae=aD*Z*j;p&&d==="female"&&(ee*=1.5);const Q=Math.round((v-ee)/2),re=Math.round((v-yi)/2),ne=Q-se,D=Q+ee,z=1,he=Q+(ee/2-z/2)-ae,me=Q+(ee/2+z/2),de=h[1]<-.2&&Math.abs(h[0])<.7,le=ce=>{e.fillStyle=lD,e.beginPath();const pe=v/2,we=ce;e.ellipse(Math.floor(pe*w),Math.floor(we*w),Math.max(1,Math.floor(cD*w)),Math.max(1,Math.floor(uD*w)),0,0,2*Math.PI),e.fill()},ge=(ce,pe)=>{d==="male"?(De(e,Q,Qa+ce,ee,Un-Jr,pe,w),De(e,Q,Qa+Un-Jr+ce,ee,Jr,H,w)):De(e,Q,Qa+ce,ee,Un,G,w)},x=(ce,pe)=>{de?De(e,re,Po+ce,yi,Fi,R,w):(De(e,re,Po+ce,yi,Fi,pe,w),De(e,re,Po+ce,yi,$c,R,w),d==="female"?(De(e,re-1,Po+$c+ce,1,Fi,R,w),De(e,re+yi,Po+$c+ce,1,Fi,R,w)):De(e,re+1,Po+2+ce,yi-2,Fi-2,R,w))};switch(c){case"idle":{const ce=a*Math.PI*2,pe=Math.sin(ce)*.5,K=(Math.cos(ce*2)+1)*.25;le(Tt+dt+1),De(e,he+pe,Tt+K,ae,dt,k,w),De(e,me-pe,Tt+K,ae,dt,k,w),ge(K,k),De(e,ne,sn+K,se,Qt,k,w),De(e,D,sn+K,se,Qt,k,w),x(K,k);break}case"walk":{const ce=a*Math.PI*2,pe=Math.sin(ce)*2,K=Math.abs(Math.cos(ce))*1;le(Tt+dt+1),De(e,he+pe,Tt+K,ae,dt,k,w),De(e,me-pe,Tt+K,ae,dt,k,w),ge(K,k),De(e,ne-pe,sn+K,se,Qt,k,w),De(e,D+pe,sn+K,se,Qt,k,w),x(K,k);break}case"gathering":{const ce=a*Math.PI*2,pe=1,we=(Math.sin(ce)+1)/2*2,K=pe+Math.abs(Math.cos(ce))*.5;le(Tt+dt+1),De(e,he,Tt+K,ae,dt-pe,k,w),De(e,me,Tt+K,ae,dt-pe,k,w),ge(K,k),De(e,ne+1,sn+K-we,se,Qt,k,w),De(e,D-1,sn+K-we,se,Qt,k,w),x(K,k);break}case"eat":{le(Tt+dt+1),De(e,he,Tt+1,ae,dt-1,k,w),De(e,me,Tt+1,ae,dt-1,k,w),ge(1,k);const we=(Math.sin(a*Math.PI*4)+1)/2,K=re+yi/2,$e=Po+Fi/2,xe=D+(K-D)*we,He=sn+1+($e-(sn+1))*we;De(e,ne,sn+1,se,Qt,k,w),De(e,xe,He,se,Qt,k,w),De(e,xe,He-1,1,1,Y,w),x(1,k);break}case"procreate":{const ce=(Math.sin(a*Math.PI*8)+1)/4,pe=(Math.sin(a*Math.PI*6)+1)*.5,we=1.5,K=we-pe;le(Tt+dt+1),De(e,he,Tt+K,ae,dt-we,k,w),De(e,me,Tt+K,ae,dt-we,k,w),ge(K,k),De(e,ne,sn+K,se,Qt,k,w),De(e,D,sn+K,se,Qt,k,w),x(K,k),e.globalAlpha=ce,ge(K,"white"),e.globalAlpha=1;break}case"attacking":{const ce=Math.sin(a*Math.PI)*1.5,pe=Math.abs(Math.sin(a*Math.PI));le(Tt+dt+1),De(e,he-ce,Tt+pe,ae,dt,k,w),De(e,me+ce*.5,Tt+pe,ae,dt,k,w),ge(pe,k),De(e,ne,sn+pe-2,se,Qt,k,w),De(e,D,sn+pe-2.5,se,Qt,k,w),x(pe,k);break}case"defending":{le(Tt+dt+1),De(e,he,Tt+1,ae,dt-1,k,w),De(e,me,Tt+1,ae,dt-1,k,w),ge(1,k),De(e,ne-1,sn+1-1,se,Qt,k,w),De(e,D+1,sn+1-1,se,Qt,k,w),x(1,k);break}case"stunned":case"dead":{const ce=c==="dead",pe=ce?Math.min(1,a):0,we=pe>.5?F:k,K=d==="male"?H:G,$e=pe>.8?"transparent":R,xe=v/2,He=A/2,ct=2;le(A-1),De(e,xe-ae-ct,He,ae,dt,we,w),De(e,xe+ct,He,ae,dt,we,w),De(e,xe-se-ct,He-Un+1,se,Qt,we,w),De(e,xe+ct,He-Un+1,se,Qt,we,w);const Ct=xe-ee/2,At=He-Un/2;d==="male"?(pe<.7&&De(e,Ct,At+Un-Jr,ee,Jr,K,w),De(e,Ct,At,ee,Un-Jr,we,w)):pe<.7?De(e,Ct,At,ee,Un,K,w):De(e,Ct,At,ee,Un,we,w);const it=xe-yi/2,Xt=He-Un/2-Fi+1;if(De(e,it,Xt,yi,Fi,we,w),$e!=="transparent"&&De(e,it,Xt,yi,$c,$e,w),ce&&pe>.6){const wn="#B0A890";for(let eo=0;eo<3;eo++)De(e,Ct+1,At+eo*1+1,ee-2,.5,wn,w)}break}default:De(e,0,0,v,A,"magenta",w);break}e.restore()}};function dD(e,t,n,o,s){const a=t.x,c=t.y-n-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-o/2,c,o,o/2),e.fill(),e.beginPath(),e.moveTo(a-o/2,c),e.lineTo(a-o/4,c-o/3),e.lineTo(a-o/6,c),e.moveTo(a-o/6,c),e.lineTo(a,c-o/2),e.lineTo(a+o/6,c),e.moveTo(a+o/6,c),e.lineTo(a+o/4,c-o/3),e.lineTo(a+o/2,c),e.stroke(),e.restore()}function fl(e,t,n,o,s,a=!1,c=!1,d=!1,u=!1){o<cp&&(n=n*.75),xp.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,o,[0,0],!1,0);let h,p;a?(h=_C,p=_S):c?(h=RC,p=MS):d?(h=kC,p=kS):u&&(h=MC,p=RS),h&&p&&dD(e,t,n/2,h,p)}function fD(e,t,n,o,s,a){if(e.save(),o.length===0){e.restore();return}const c=o.length*s,d=4;let u;const h=c+(o.length-1)*d;o.length>1&&h>a?u=(a-c)/(o.length-1):u=d,o.length<=1&&(u=0);for(let p=0;p<o.length;p++){const{member:m,isPlayer:S,isHeir:v,isPartner:A,isParent:T}=o[p],w=t+p*(s+u)+s/2,E=n+s/4;fl(e,{x:w,y:E},s,m.age,m.gender,S,v,A,T)}e.restore()}function hD(e,t,n,o,s){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,o,s);const a=500,c=Math.min(s*.8,n.length*(Ia+yy)+120),d=(o-a)/2,u=(s-c)/2;e.fillStyle="#2d3748",e.strokeStyle="#4a5568",e.lineWidth=4,e.fillRect(d,u,a,c),e.strokeRect(d,u,a,c),e.fillStyle="#fff",e.font='20px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="top",e.fillText("WORLD TRIBES",o/2,u+30);const h=u+80,p=a-Aa*4,m=d+Aa*2;for(let C=0;C<n.length;C++){const _=n[C],M=h+C*(Ia+yy);if(M+Ia>u+c-60)break;const P=M+Ia/2;_.isPlayerTribe&&(e.fillStyle="rgba(255, 215, 0, 0.2)",e.fillRect(m,M,p,Ia));let k=m+Aa;if(e.font=`${er}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillStyle="white",e.fillText(_.tribeBadge,k,P),k+=er+Aa*2,_.isPlayerTribe)e.fillStyle="#aaa",e.font='10px "Press Start 2P", Arial',e.textAlign="left",e.fillText("(YOU)",k,P);else{const R=_.diplomacyStatus===Rt.Friendly?"":"",H=`modal_diplomacy_${_.leaderId}`,G={x:k,y:P-er/2,width:er*1.5,height:er},F={id:H,action:Te.ToggleDiplomacy,rect:G,text:"",icon:R,backgroundColor:"transparent",textColor:"white",currentWidth:G.width,tooltip:`Set status to ${_.diplomacyStatus===Rt.Friendly?"Hostile":"Friendly"}`,targetTribeId:_.leaderId};t.uiButtons.push(F),t.hoveredButtonId===H&&(e.fillStyle=Ip,e.fillRect(G.x,G.y,G.width,G.height)),e.font=`${er*.8}px Arial`,e.textAlign="center",e.fillText(R,G.x+G.width/2,P)}k+=er*2+Aa,fl(e,{x:k+10,y:P},xi*.6,25,"male"),e.fillStyle="white",e.font=`${bC}px "Press Start 2P"`,e.fillText(`${_.adultCount}`,k+30,P),k+=80,fl(e,{x:k+10,y:P},xi*.6,5,"female"),e.fillText(`${_.childCount}`,k+30,P)}const S=120,v=40,A=o/2-S/2,T=u+c-60,w="close_tribe_modal_btn",E={id:w,action:Te.CloseTribeModal,rect:{x:A,y:T,width:S,height:v},text:"CLOSE",currentWidth:S,backgroundColor:On,textColor:kt};t.uiButtons.push(E),e.fillStyle=t.hoveredButtonId===w?"#4a5568":On,e.fillRect(A,T,S,v),e.strokeStyle="#fff",e.strokeRect(A,T,S,v),e.fillStyle=kt,e.font='12px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="middle",e.fillText("CLOSE",o/2,T+v/2),e.restore()}function pD(e,t,n,o,s){const a=US,c=GS,d=t+o-a-c,u=n+c;e.save(),e.lineWidth=2,e.strokeStyle=s?ZC:qC,e.beginPath();const h=5;e.moveTo(d+h,u+h),e.lineTo(d+a-h,u+a-h),e.moveTo(d+a-h,u+h),e.lineTo(d+h,u+a-h),e.stroke(),e.restore()}function gD(e,t,n,o){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===Jt.INACTIVE)return;const c=a.steps[s.currentStepIndex];if(!c)return;e.save(),e.globalAlpha=s.transitionAlpha;const d=GC,u=$C,h=WC,p=`${eh}px "Press Start 2P", Arial`,m=`${Ay}px "Press Start 2P", Arial`,S=zC,v=Ay*1.5;e.font=m;const A=c.text.split(" ");let T="";const w=[];for(let F=0;F<A.length;F++){const Y=T+A[F]+" ";e.measureText(Y).width>d-u*2&&F>0?(w.push(T),T=A[F]+" "):T=Y}w.push(T);const E=u*2+eh+u/2+w.length*v,C=(n-d)/2,_=o-E-160;e.fillStyle=YC,e.beginPath(),e.moveTo(C+h,_),e.lineTo(C+d-h,_),e.quadraticCurveTo(C+d,_,C+d,_+h),e.lineTo(C+d,_+E-h),e.quadraticCurveTo(C+d,_+E,C+d-h,_+E),e.lineTo(C+h,_+E),e.quadraticCurveTo(C,_+E,C,_+E-h),e.lineTo(C,_+h),e.quadraticCurveTo(C,_,C+h,_),e.closePath(),e.fill(),e.fillStyle=S,e.textAlign="center",e.textBaseline="top",e.font=p,e.fillText(c.title,C+d/2,_+u),e.font=m;let M=_+u+eh+u/2;for(const F of w)e.fillText(F,C+d/2,M),M+=v;const P=t.hoveredButtonId==="tutorial-dismiss";pD(e,C,_,d,P),e.restore();const k=US,R=GS,H=C+d-k-R,G=_+R;return{x:H,y:G,width:k,height:k}}function hh(e,t,n){e.save();const o=VC,s={x:t.x-o,y:t.y-o,width:t.width+o*2,height:t.height+o*2};e.strokeStyle=LS,e.lineWidth=xS+Math.sin(n*Ap)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function mD(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const KT=10,yD=3,Qy=KT*.7;function vD(e,t){const{position:n,food:o,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,KT,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),o.length>0){const a=Math.PI*2/Math.min(o.length,s);for(let c=0;c<o.length;c++){const d=c*a,u=n.x+Qy*Math.cos(d),h=n.y+Qy*Math.sin(d);e.beginPath(),e.arc(u,h,yD,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const Jy=(e,t,n=70,o=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${o}%)`},SD=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[o,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${o}, ${s}%, ${Math.max(0,a-t)}%)`},Wc=(e,t,n,o,s,a,c,d=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=d?SD(c,15):c,e.beginPath(),e.roundRect(-o/2,0,o,s,o/2),e.fill(),e.restore()},ph=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),o=75;if(!n)return`hsl(0, 0%, ${o}%)`;const[,s,a,c]=n.map(Number),d=a*(1-t),u=c+(o-c)*t;return`hsl(${s}, ${d}%, ${u}%)`},QT={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,o,s,a,c,d={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const u=o*.15,h=t+o/2,p=n+s/2,m=o-u*2,S=s-u*2,{gender:v,age:A,direction:T,isPregnant:w,hungryLevel:E,geneCode:C}=d,_=.8+Math.min(A,10)/10*.4,M=v==="male"?1.05:.95,P=1-E/100*.3,k=m*.5*P*_*M;let R=S*.3*_*M;const H=m*.15*_*M,G=k*.2,F=S*.3,Y=Jy(C,0,30,50);let Z=Jy(C,8,50,40);if(A>45){const le=Math.min(1,(A-45)/15);Z=ph(Z,le)}e.translate(h,p),T[0]<0&&e.scale(-1,1);const W=Math.sin(a*Math.PI*2),j=Math.cos(a*Math.PI*2),ee=F+R*.2;if(c==="dead"){const le=Math.min(a,1);e.translate(0,S*.2),e.rotate(Math.PI/2);const ge=ph(Z,le),x=ph(Y,le);e.globalAlpha=.5+le*.5,e.strokeStyle=ge,e.lineWidth=G*.5,e.beginPath(),e.moveTo(-k*.4,0),e.lineTo(k*.4,0),e.stroke();for(let ce=-1;ce<=1;ce+=1)e.beginPath(),e.arc(0,0,R*.4,Math.PI*.4*ce-Math.PI*.2,Math.PI*.4*ce+Math.PI*.2),e.stroke();e.fillStyle=x,e.beginPath(),e.arc(k*.5,0,H,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(k*.55,0,H*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,ee,k*.7,k*.25,0,0,2*Math.PI),e.fill();let se=0,ae=0,Q=0,re=0,ne=0,D=0;switch(c){case"idle":ae=W*(S*.02),Q=W*.05,re=-W*.05,ne=-W*.05,D=W*.05;break;case"walk":ae=Math.abs(j)*(S*-.04),Q=W*.7,re=-W*.7,ne=-W*.7,D=W*.7;break;case"eat":se=S*.1,ae=S*.05,se+=W*(S*.02);break;case"procreate":ae=S*.05;const le=(1-j)*-m*.05;e.translate(le,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}w&&v==="female"&&(R*=1.6);const z=ae,he=z-R*.2;Wc(e,k*-.35,he,G,F,ne,Z,!0),Wc(e,k*.35,he,G,F,D,Z,!0),e.fillStyle=Z,e.beginPath(),e.ellipse(0,z,k/2,R/2,0,0,2*Math.PI),e.fill();const me=k*.45,de=he+se;e.fillStyle=Y,e.beginPath(),e.arc(me,de,H,0,Math.PI*2),e.fill(),T[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(me+H*.3,de-H*.2,H*.15,0,Math.PI*2),e.fill()),Wc(e,k*-.35,he,G,F,Q,Z),Wc(e,k*.35,he,G,F,re,Z),e.restore()}};function TD(e,t){let[n,o,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),o=Math.max(0,o-t),s=Math.max(0,s-t),`rgb(${n}, ${o}, ${s})`}function ID(e){const t=(e&16711680)>>16,n=(e&65280)>>8,o=e&255,s=`rgb(${t}, ${n}, ${o})`,a=TD(s,40),c=(e&255)%100+50,d=(e>>8&255)%100,u=(e>>16&255)%100,h=`rgb(${c}, ${d}, ${u})`,p=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:h,eyeColor:p}}const JT={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,o,s,a,c,d={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:u,age:h,direction:p,isPregnant:m,hungryLevel:S,geneCode:v}=d;e.save();const A=o*.15,T=Math.max(1,Math.floor((o-A*2)/10)),w=p[0]<0;e.translate(t+o/2,n+s/2),w&&e.scale(-1,1);const E=ID(v),C=.8+Math.min(h,20)/20*.4,_=u==="male"?1.05:.95,M=1-S/100*.25,P=C*_*M,k=Math.max(0,Math.min(1,(h-15)/5));e.filter=`grayscale(${k})`;const R=E.furColor,H=E.darkerFurColor,G=E.eyeColor,F="#FFFFFF",Y="#c75c5c",Z="#E0E0E0",W="#A0A0A0",j=s/2-2*T,ee=Math.sin(a*Math.PI*2),se=Math.abs(ee);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,j,T*4,T,0,0,2*Math.PI),e.fill(),e.filter="none",c==="dead"){const xe=Math.min(1,a*2);e.save(),e.translate(0,j-T*3),e.rotate(-Math.PI/2);const He=(ct,Ct,At,it,Xt=!1)=>{e.fillStyle=Xt?W:Z,e.fillRect(ct*T,Ct*T,At*T,it*T)};xe<1&&(e.globalAlpha=1-xe,e.fillStyle=R,e.beginPath(),e.ellipse(0,0,T*3,T*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),xe>0&&(e.globalAlpha=xe,He(-1,-4,2,2),He(1,-3.5,1,1,!0),He(-.5,-2,1,5,!0),He(-2.5,-1,5,.5),He(-2.5,0,5,.5),He(-2.5,1,5,.5),He(-3,-2,-1,2,!0),He(3,-2,1,2),He(-3,2,-1,2,!0),He(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=R;let ae=0,Q=0,re=0,ne=[0,0,0,0];switch(c){case"idle":ae=ee*T*.1;break;case"walk":const xe=Math.sin(a*Math.PI*4);ae=Math.abs(xe)*-T*.5,ne=[xe*T,-xe*T,-xe*T,xe*T];break;case"attacking":const He=Math.sin(a*Math.PI*4);Q=T*2+He*T,re=T*2,ae=T;break;case"eat":re=T*3+se*T,ae=T*1.5,e.fillStyle=Y,e.fillRect(-T,j-T,T*2,T);break;case"procreate":ae=Math.sin(a*Math.PI*8)*T*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let Ct=0;Ct<5;Ct++){const At=(Math.random()-.5)*T*8,it=j+(Math.random()-.5)*T*2;se>.5&&e.fillRect(At,it,T*.5,T*.5)}break}const D=T*3*P*(m?1.3:1),z=T*5*P,he=-z/1.5,me=j-D-T*2.5+ae;e.fillStyle=R,e.beginPath(),e.moveTo(he-T*.5,me+D*.5),e.quadraticCurveTo(he-T*3,me-T,he-T*2+ee*T,me+D+T),e.fill();const de=T*1.2*P,le=T*3*P,ge=T*2.5*P,x=he+z*.8,ce=he+z*.2;e.fillStyle=H,e.fillRect(ce,j-ge,de,ge+ne[2]),e.fillRect(x,j-le,de,le+ne[0]),e.fillStyle=R,e.beginPath(),e.moveTo(he,me+D),e.lineTo(he,me+T),e.quadraticCurveTo(he+z/2,me,he+z,me+T),e.lineTo(he+z,me+D),e.fill(),e.fillStyle=R,e.fillRect(ce+T/2,j-ge,de,ge+ne[3]),e.fillRect(x+T/2,j-le,de,le+ne[1]);const pe=T*3.5*P,we=he+z-pe*.3+Q,K=me-pe*.3+re;e.fillStyle=R,e.beginPath(),e.arc(we,K,pe/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(we+pe*.4,K+pe*.2,T*1.5,T,0,0,Math.PI*2),e.fill(),p[1]>=0&&(e.fillStyle=G,e.fillRect(we+T*.5,K-T*.5,T*.5,T*.5),c==="attacking"&&(e.fillStyle=F,e.fillRect(we+pe*.5,K+pe*.4,T,T*.4))),e.fillStyle=H,e.beginPath(),e.moveTo(we-pe*.4,K-pe*.3),e.lineTo(we,K-pe*.7),e.lineTo(we,K-pe*.2),e.fill(),e.restore()}};class wl{constructor(t=200){Gt(this,"cache",new Map);Gt(this,"maxSize");this.maxSize=t}getOrRender(t,n,o,s){const a=this.cache.get(t);if(a)return this.cache.delete(t),this.cache.set(t,a),a;const{canvas:c,ctx:d}=qT(n,o);if(s(d),this.cache.size>=this.maxSize){const u=this.cache.keys().next().value;u!==void 0&&this.cache.delete(u)}return this.cache.set(t,c),c}clear(){this.cache.clear()}}const AD=9,wD=new wl(200);function ED(e,t){const{position:n,gender:o,age:s,decayProgress:a,food:c,radius:d,originalEntityType:u,geneCode:h}=t,p=Er(a,20),m=Math.floor(s),S=`${u}_${o}_${m}_${p}_${d}_${h||0}`,v=Math.ceil(d*2)+4,A=wD.getOrRender(S,v,v,T=>{T.translate(v/2,v/2),u==="human"?xp.render(T,-v/2+2,-v/2+2,v-4,v-4,p,"dead",o,m,[0,0],!1,0):u==="prey"?QT.render(T,-v/2+2,-v/2+2,v-4,v-4,p,"dead",{gender:o,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024}):u==="predator"&&JT.render(T,-v/2+2,-v/2+2,v-4,v-4,p,"dead",{gender:o,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024})});if(e.save(),e.globalAlpha=1-a,e.drawImage(A,n.x-A.width/2,n.y-A.height/2),e.restore(),c.length>0){e.save(),e.font=`${AD}px Arial`,e.textAlign="center",e.textBaseline="middle";const T=ht*.9,w=Math.PI/fS*3;c.forEach((E,C)=>{const _=C*w,M=n.x+T*Math.cos(_)*Math.atan2(C,C),P=n.y+T*Math.sin(_)*Math.atan2(C,C),k=sp[E.type];e.fillText(k,M,P)}),e.restore()}}function bo(e,t,n,o,s,a,c,d){e.save(),e.fillStyle=c,e.fillRect(t,n,o,s),e.fillStyle=d,e.fillRect(t,n,o*Math.max(0,a),s),e.restore()}function CD(e,t,n,o,s,a){if(e.save(),o.length===0){e.restore();return}const c=o.length*s;let d;c>a||c+(o.length-1)*4>a?d=(a-c)/(o.length-1):d=4,o.length===1&&(d=0);for(let u=0;u<o.length;u++){const h=sp[o[u].type];e.fillText(h,t+u*(s+d),n)}e.restore()}function PD(e,t,n,o,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let c,d=ht/2;const u=Uu[a.action],h=ZS[a.action],p=`${u} ${h}`;if("targetEntityId"in a){const m=t.entities.entities[a.targetEntityId];m&&(c=m.position,d=m.radius)}else"position"in a&&(c=a.position);if(c){ZT(e,c,d,Sp,Tp,2,n,o,s,t.mapDimensions),e.save(),e.font=`${vs}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:S}=Al(c,n,{width:o,height:s},t.mapDimensions),v=S-d-Fu-vs/2;e.fillText(p,m,v),e.restore()}}function _D(e,t,n,o,s){e.save();const a=(Math.sin(s*Ap)+1)/2,c=n+Fu+a*5;e.strokeStyle=Sp,e.lineWidth=2,e.setLineDash(Tp),e.beginPath(),e.arc(t.x,t.y,c,0,Math.PI*2),e.stroke(),e.setLineDash([]);const d=Uu[o],u=ZS[o];if(d){e.font=`${vs*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const h=t.y-c-25;e.fillText(d,t.x,h),e.font=`${vs*.8}px "Press Start 2P", Arial`,e.fillText(u,t.x,h+25)}e.restore()}function RD(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(bt(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const c=t.entities.entities[n.targetEntityId];c&&(s=c.position,a=c.radius||(c.type==="building"?20:30))}if(s){const c=(d,u)=>{_D(d,u.position,a,n.action,t.time)};Gn(e,t.mapDimensions.width,t.mapDimensions.height,c,{position:{...s}},s,a+30)}}}function ev(e,t,n,o,s,a,c=!0){const d=t.split(" ");let u="";const h=[];for(let p=0;p<d.length;p++){const m=u+d[p]+" ";e.measureText(m).width>s&&p>0?(h.push(u),u=d[p]+" "):u=m}if(h.push(u),c)for(let p=0;p<h.length;p++)e.fillText(h[p],n,o+p*a);return h.length*a}function kD(e){return 1-Math.pow(1-e,3)}function MD(e,t,n,o){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(c=>!c.isDismissed);if(s.length===0)return;e.save();let a=o-rP;for(const c of s){const d=n-Fc-nr;e.font=`${th}px "Press Start 2P", Arial`;const u=d+nr,h=Fc-nr*2,p=ev(e,c.message,-9999,-9999,h,th*1.2,!1),m=nr*2+p+mi,S=a-m,v=Date.now()-c.creationTime,A=Math.min(v/oP,1),T=kD(A),w=o,E=w+(S-w)*T;e.fillStyle=QC,e.beginPath(),e.roundRect(d,E,Fc,m,KC),e.fill(),e.fillStyle=JC,e.textBaseline="top",ev(e,c.message,u,E+nr,h,th*1.2,!0);const C=E+m-mi-nr/2,_=d+Fc-mi-nr/2,M={x:_,y:C,width:mi,height:mi};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[c.id]=M);const P=t.hoveredButtonId===`notification-dismiss-${c.id}`;if(e.fillStyle=P?Cy:eP,e.font=`${mi}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",M.x+M.width/2,M.y+M.height/2),c.targetEntityIds||c.targetPosition||c.targetArea||c.targetRadius){const H={x:_-mi-Ey,y:C,width:mi,height:mi};t.notificationButtonRects&&(t.notificationButtonRects.view[c.id]=H);const G=t.hoveredButtonId===`notification-view-${c.id}`;e.fillStyle=G?Cy:tP,e.font=`${mi*(G?1.5:1.2)}px Arial`,e.fillText("",H.x+H.width/2,H.y+H.height/2)}a-=m+Ey}e.restore()}function bD(e){return e.length===0?0:e.reduce((n,o)=>n+o,0)/e.length}function gh(e,t,n,o,s,a,c,d){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(o,s,a,c),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(o,s,a,c);const u=bD(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${u.toFixed(2)}ms`,o+Je,s+Je+8);const h=Math.max(...n,1),p=n.map(m=>m/h*c);if(e.beginPath(),e.strokeStyle=d,e.lineWidth=2,p.length>1){e.moveTo(o,s+c-p[0]);for(let m=1;m<p.length;m++){const S=o+m/(p.length-1)*a,v=s+c-p[m];e.lineTo(S,v)}}else if(p.length===1){const m=s+c-p[0];e.moveTo(o,m),e.lineTo(o+a,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${h.toFixed(2)}ms`,o+a-Je,s+Je+8),e.restore()}function DD(e,t,n){const{performanceMetrics:o}=t;if(!o)return;const s=280,a=240,c=n-s-Je,d=Je+In*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(c,d,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(c,d,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let u=d+Je+5;const h=c+Je;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",h,u),u+=25,e.fillStyle="white",e.font="12px monospace";const p=OD(t);e.fillText(`FPS: ${p.toFixed(1)}`,h,u),u+=20;const m=s-Je*2,S=45,v=10;gh(e,"Render",mh(t,"renderTime"),h,u,m,S,"#4CAF50"),u+=S+v,gh(e,"World Update",mh(t,"worldUpdateTime"),h,u,m,S,"#2196F3"),u+=S+v,gh(e,"AI Update",mh(t,"aiUpdateTime"),h,u,m,S,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",c+s/2,d+a-10),e.restore()}function OD(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(Mt/Ft);return t.history.filter(a=>n-a.bucketTime/(Mt/Ft)<1).length}function ND(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const c=Math.floor(a.bucketTime/(Mt/Ft));n.set(c,(n.get(c)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function mh(e,t){return ND(e.performanceMetrics.history,t)}const BD={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"},HD=new wl(1e4);function FD(e,t,n){if(!t.path||t.path.length===0)return;const{width:o,height:s}=n.mapDimensions;e.save(),e.setLineDash([5,5]),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=2;let a={...t.position};e.beginPath(),e.moveTo(a.x,a.y);for(const d of t.path){const u=Le(a,d,o,s),h={x:a.x+u.x,y:a.y+u.y};e.lineTo(h.x,h.y),a=h}if(t.pathTarget){const d=Le(a,t.pathTarget,o,s),u={x:a.x+d.x,y:a.y+d.y};e.lineTo(u.x,u.y),a=u}e.stroke(),e.setLineDash([]),e.fillStyle="rgba(255, 255, 255, 0.3)";let c={...t.position};for(const d of t.path){const u=Le(c,d,o,s),h={x:c.x+u.x,y:c.y+u.y};e.beginPath(),e.arc(h.x,h.y,2,0,Math.PI*2),e.fill(),c=h}if(t.pathTarget){const d=Le(c,t.pathTarget,o,s),u={x:c.x+d.x,y:c.y+d.y};e.fillStyle="rgba(255, 255, 0, 0.8)",e.beginPath(),e.arc(u.x,u.y,4,0,Math.PI*2),e.fill()}e.restore()}function LD(e,t,n){var u;const{radius:o,position:s,activeAction:a="idle"}=t,c=t.stateMachine[0]||"N/A",d=t.isAdult?ht+20:ht*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${a}`,s.x,s.y-d),e.fillText(`State: ${c}`,s.x,s.y-d+10),e.fillText(`Path: ${((u=t.path)==null?void 0:u.length)||0} waypoints`,s.x,s.y-d+50),e.fillText(`HP: ${t.hitpoints}`,s.x,s.y-d+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,s.x,s.y-d+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,s.x,s.y-d+40),e.restore(),e.beginPath(),e.arc(s.x,s.y,o,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",n.debugCharacterId===t.id&&FD(e,t,n),e.lineWidth=1,e.stroke(),e.closePath()}function xD(e,t,n,o,s){e.save(),e.font=`${za}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(o?ht:ks)-za-s),e.restore()}function UD(e,t,n,o,s){const a=t.x,c=t.y-n-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-o/2,c,o,o/2),e.fill(),e.beginPath(),e.moveTo(a-o/2,c),e.lineTo(a-o/4,c-o/3),e.lineTo(a-o/6,c),e.moveTo(a-o/6,c),e.lineTo(a,c-o/2),e.lineTo(a+o/6,c),e.moveTo(a+o/6,c),e.lineTo(a+o/4,c-o/3),e.lineTo(a+o/2,c),e.stroke(),e.restore()}function GD(e,t,n){var d;const{position:o,radius:s}=t,a=o.x-Jf/2,c=o.y-s-DC;if(t.stateMachine[0]===Fo){const u=t.stateMachine[1],h=n-u.attackStartTime,p=Math.min(h/Nu,1);bo(e,a,c,Jf,vy,p,Ro,OC)}else if((d=t.attackCooldown)!=null&&d.melee&&t.attackCooldown.melee>0){const u=1-t.attackCooldown.melee/gl;bo(e,a,c,Jf,vy,u,Ro,NC)}}function $D(e,t,n=!1,o=!1,s=!1,a=!1,c=!1,d=!1,u=!1,h){var H,G;const{position:p,activeAction:m="idle"}=t,S=t.isAdult?ht:ht*.6,v=BD[m]||"idle",A=Er(t.animationProgress||0,12),T=Fp(t.direction,8),w=Math.floor(t.age),E=Er(t.hunger/100,5)*100,C=`${v}_${t.gender}_${w}_${T}_${A}_${t.isPregnant??!1}_${E}_${S}`,_=Math.ceil(S*2)+4,M=HD.getOrRender(C,_,_,F=>{F.translate(_/2,_/2);const Y=Lp(T,8);xp.render(F,-_/2+2,-_/2+2,_-4,_-4,A,v,t.gender,w,Y,t.isPregnant??!1,E)});e.drawImage(M,p.x-M.width/2,p.y-M.height/2),d&&(e.save(),e.strokeStyle=pC,e.lineWidth=2,e.beginPath(),e.arc(p.x,p.y,S+3,0,2*Math.PI),e.stroke(),e.restore());let P,k;if(c?(P=mC,k=MS):n?(P=gC,k=_S):s?(P=yC,k=hC):o?(P=vC,k=RS):a&&(P=SC,k=kS),P&&k&&UD(e,p,S,P,k),(H=t.tribeInfo)!=null&&H.tribeBadge&&xD(e,p,t.tribeInfo.tribeBadge,t.isAdult??!1,P??0),t.heldItem){const F=wp[t.heldItem.type],Y=(G=t.tribeInfo)!=null&&G.tribeBadge?za:0;e.save(),e.font=`${za}px Arial`,e.textAlign="center",e.textBaseline="middle";const Z=p.y-(t.isAdult?ht:ks)-za-(P??0)-Y;e.fillText(F,p.x,Z),e.restore()}const R=u&&(h.debugCharacterId===void 0||t.id===h.debugCharacterId);GD(e,t,h.time),R&&LD(e,t,h)}const WD={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},YD=new wl(200);function zD(e,t){const{radius:n,position:o,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",c=t.isAdult?ht+20:ht*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${a}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-c+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function jD(e,t,n=!1,o){const{position:s,activeAction:a="idle"}=t,c=t.isAdult?t.radius:t.radius*.6,d=WD[a]||"idle",u=Er(t.animationProgress||0,12),h=Fp(t.direction||{x:1,y:0},8),p=Math.floor(t.age),m=Er(t.hunger/100,5)*100,S=`${d}_${p}_${h}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${c}`,v=Math.ceil(c*2)+4,A=YD.getOrRender(S,v,v,w=>{w.translate(v/2,v/2);const E=Lp(h,8);QT.render(w,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:p,direction:E,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(A,s.x-A.width/2,s.y-A.height/2),t.hitpoints<t.maxHitpoints){const w=c*1.5,E=3,C=s.x-w/2,_=s.y-c-8;e.fillStyle="#555",e.fillRect(C,_,w,E);const M=t.hitpoints/t.maxHitpoints;e.fillStyle=M>.5?"#4CAF50":M>.25?"#FFC107":"#F44336",e.fillRect(C,_,w*M,E)}n&&(o===void 0||t.id===o)&&zD(e,t)}const XD={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},VD=new wl(200);function qD(e,t){const{radius:n,position:o,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",c=t.isAdult?ht+20:ht*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-c),e.fillText(`State: ${a}`,o.x,o.y-c+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-c+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-c+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-c+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function ZD(e,t,n=!1,o){const{position:s,activeAction:a="idle"}=t,c=t.isAdult?t.radius:t.radius*.6,d=XD[a]||"idle",u=Er(t.animationProgress||0,12),h=Fp(t.direction||{x:1,y:0},8),p=Math.floor(t.age),m=Er(t.hunger/100,5)*100,S=`${d}_${p}_${h}_${u}_${t.isPregnant??!1}_${m}_${t.geneCode}_${c}`,v=Math.ceil(c*2)+4,A=VD.getOrRender(S,v,v,w=>{w.translate(v/2,v/2);const E=Lp(h,8);JT.render(w,-v/2+2,-v/2+2,v-4,v-4,u,d,{gender:t.gender,age:p,direction:E,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(A,s.x-A.width/2,s.y-A.height/2),t.hitpoints<t.maxHitpoints){const w=c*1.5,E=3,C=s.x-w/2,_=s.y-c-8;e.fillStyle="#555",e.fillRect(C,_,w,E);const M=t.hitpoints/t.maxHitpoints;e.fillStyle=M>.5?"#4CAF50":M>.25?"#FFC107":"#F44336",e.fillRect(C,_,w*M,E)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,c+3,0,2*Math.PI),e.stroke()),n&&(o===void 0||t.id===o)&&qD(e,t)}const eI=15;function KD(e,t,n,o,s=1.5){const a=n-t.startTime,c=Math.min(a/t.duration,1),d=1-c,h=1+Math.sin(c*Math.PI*2)*(s-1),p=eI*h;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,p),0,Math.PI*2),e.fillStyle=o,e.fill(),e.restore()}function Pa(e,t,n,o,s=2){const a=n-t.startTime,c=Math.min(a/t.duration,1),d=1-c,u=eI*2*c;e.save(),e.globalAlpha=d,e.beginPath(),e.arc(t.position.x,t.position.y,u,0,Math.PI*2),e.strokeStyle=o,e.lineWidth=s,e.stroke(),e.restore()}function Bi(e,t,n,o){const s=n-t.startTime,a=Math.min(s/t.duration,1),c=1-a,d=-20*a;e.save(),e.globalAlpha=c,e.font="20px Arial",e.textAlign="center",e.fillText(o,t.position.x,t.position.y+d),e.restore()}function QD(e,t,n,o){const{width:s,height:a}=o.mapDimensions;let c=t.targetPosition;if(t.targetEntityId){const T=o.entities.entities[t.targetEntityId];T&&(c=T.position)}if(!c)return;const d=n-t.startTime,u=Math.min(d/t.duration,1);let h=c.x-t.position.x,p=c.y-t.position.y;h=h-Math.round(h/s)*s,p=p-Math.round(p/a)*a;const m={x:h,y:p},S=t.position.x+m.x*u,v=t.position.y+m.y*u,A=-Math.sin(u*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(S,v,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(S,v+A),e.rotate(u*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function tI(e,t,n,o){switch(t.type){case Pe.Procreation:Bi(e,t,n,"");break;case Pe.Pregnant:KD(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Pe.TargetAcquired:Pa(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Pe.Attack:Bi(e,t,n,"");break;case Pe.Partnered:Bi(e,t,n,"");break;case Pe.BushClaimed:Pa(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Pe.BushClaimLost:Pa(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Pe.Eating:Bi(e,t,n,"");break;case Pe.ChildFed:Bi(e,t,n,"");break;case Pe.AttackDeflected:Bi(e,t,n,"");break;case Pe.AttackResisted:Bi(e,t,n,"");break;case Pe.Hit:Bi(e,t,n,"");break;case Pe.SeizeBuildup:Pa(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Pe.BorderClaim:Bi(e,t,n,"");break;case Pe.Seize:Pa(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Pe.StoneProjectile:QD(e,t,n,o);break}}function tv(e,t,n,o,s,a,c){e.save();const{position:d}=t;e.strokeStyle=o,e.lineWidth=s+Math.sin(c*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(d.x,d.y,n,0,2*Math.PI),e.stroke(),e.restore()}const nv=8,JD=1.5,eO=.5,iv=2,tO="#5a5a5a",nO="#7e7e7e",iO="#8B0000",oO="#FF4444",rO=6,ds="#8B4513",sO="#A0522D",aO="rgba(40, 40, 40, 0.7)",lO=new wl(1e3),ov=20,qu={top:!1,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};function cO(e,t,n=!1,o=!0,s=qu){if(n)return`ghost_${e.buildingType}_${o}`;const a=e,c=a.buildingType===q.Bonfire&&(a.fuelLevel??0)>0,d=s,u=`${d.top}${d.right}${d.bottom}${d.left}${d.topRight}${d.bottomRight}${d.bottomLeft}${d.topLeft}`;return`${a.id}_${a.buildingType}_${a.width}_${a.height}_${t}_${a.isConstructed}_${c}_${u}`}function nI(e,t,n=!1,o=!0,s=qu){const a=cO(e,t,n,o,s),{width:c,height:d,id:u,buildingType:h}=e,p=c+ov*2,m=d+ov*2;return lO.getOrRender(a,p,m,S=>{const v=It[h],A="isConstructed"in e?e.isConstructed:!0;if(S.translate(p/2,m/2),n){const T=o?"#4CAF50":"#F44336";h===q.Palisade||h===q.Gate?uO(S,c,d,T):yh(S,c,d,9999,T),S.font=`${Math.min(c,d)*.5}px Arial`,S.textAlign="center",S.textBaseline="middle",S.fillStyle=T,S.fillText(v.icon,0,0)}else{const T=e;let w=v.icon,E="#FFFFFF";T.ownerId!==void 0&&T.ownerId!==null&&(E=Yt[T.ownerId%Yt.length]),h===q.Palisade?dO(S,c,d,u,E,s):h===q.Gate?fO(S,c,d,E,s):(T.buildingType===q.Bonfire&&A&&(w=(T.fuelLevel??0)>0?"":""),t?yh(S,c,d,u,iO,oO):yh(S,c,d,u),S.globalAlpha=.5,S.font=`${Math.min(c,d,30)*.5}px Arial`,S.textAlign="center",S.textBaseline="middle",S.shadowColor="rgba(0,0,0,0.5)",S.shadowBlur=4,S.fillStyle="#FFFFFF",S.fillText(w,0,0))}})}function uO(e,t,n,o){e.fillStyle=o,e.fillRect(-t/2,-n/2,t,n),e.strokeStyle="rgba(0,0,0,0.2)",e.strokeRect(-t/2,-n/2,t,n)}function dO(e,t,n,o,s,a){const c=t/2,d=n/2,u=n/4;e.fillStyle=ds,a.right&&e.fillRect(0,-u/2,c,u),a.left&&e.fillRect(-c,-u/2,c,u),a.bottom&&e.fillRect(-u/2,0,u,d),a.top&&e.fillRect(-u/2,-d,u,d),e.lineWidth=u,e.strokeStyle=ds,e.lineCap="round";const h=(m,S)=>{e.beginPath(),e.moveTo(0,0),e.lineTo(m,S),e.stroke()};a.topRight&&h(c,-d),a.bottomRight&&h(c,d),a.bottomLeft&&h(-c,d),a.topLeft&&h(-c,-d);const p=t/2;e.fillStyle=ds,e.fillRect(-p/2,-d,p,n),e.fillStyle=sO,e.fillRect(-p/4,-d,p/2,n),a.top||(e.fillStyle=ds,e.beginPath(),e.moveTo(-p/2,-d),e.lineTo(0,-d-5),e.lineTo(p/2,-d),e.fill()),e.fillStyle=s,e.fillRect(-p/2,-n/8,p,n/4),e.strokeStyle="rgba(0,0,0,0.1)",e.lineWidth=1;for(let m=0;m<3;m++){const S=(ri(o+m)-.5)*p;e.beginPath(),e.moveTo(S,-d),e.lineTo(S,d),e.stroke()}}function fO(e,t,n,o,s){(s.top||s.bottom)&&e.rotate(Math.PI/2);const a=t/4,c=t/2,d=n/2;e.fillStyle=ds,e.fillRect(-c,-d,a,n),e.fillRect(c-a,-d,a,n),e.fillStyle="#5D2906",e.fillRect(-c,-d,t,a),e.fillStyle=ds;const u=(t-a*2)/2;e.fillRect(-c+a+1,-d+a+1,u-2,n-a-2),e.fillRect(1,-d+a+1,u-2,n-a-2),e.strokeStyle="rgba(0,0,0,0.1)",e.lineWidth=1;for(let h=-1;h<=1;h+=2){const p=h*(u/2);e.beginPath(),e.moveTo(p,-d+a),e.lineTo(p,d),e.stroke()}e.fillStyle=o,e.beginPath(),e.arc(0,a/2,4,0,Math.PI*2),e.fill(),e.fillStyle="#C0C0C0",e.fillRect(-2,a/2-1,1,2),e.fillRect(1,a/2-1,1,2)}function hO(e,t,n,o,s){if(o<=0)return;e.save(),e.strokeStyle=aO,e.lineWidth=1,e.lineCap="round";const a=Math.floor(o*10)+1;for(let c=0;c<a;c++){const d=s+c*17;let u=(ri(d)-.5)*t,h=(ri(d+1)-.5)*n;e.beginPath(),e.moveTo(u,h);const p=5+ri(d+2)*10,m=ri(d+3)*Math.PI*2;for(let S=0;S<3;S++)u+=Math.cos(m)*(p/3),h+=Math.sin(m)*(p/3),e.lineTo(u,h);e.stroke()}e.restore()}function yh(e,t,n,o,s,a){const c=(t+n)*2,d=Math.floor(c/nv),u=-t/2,h=t/2,p=-n/2,m=n/2;for(let S=0;S<d;S++){const v=o+S*13,A=ri(v),T=ri(v+1);let w=S*nv,E=0,C=0;w<t?(E=u+w,C=p):w<t+n?(E=h,C=p+(w-t)):w<t*2+n?(E=h-(w-(t+n)),C=m):(E=u,C=m-(w-(t*2+n)));const _=(T-.5)*iv,M=(ri(v+2)-.5)*iv;e.beginPath();const P=JD+A*eO;s?e.fillStyle=s:e.fillStyle=A>.5?a||nO:s||tO,e.ellipse(E+_,C+M,P,P*.85,T*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function pO(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:o}=t;e.save(),e.font=`${rO}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,o.forEach(s=>{const a=s.item.type,c=(sp[a]||wp[a])??"?",d={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(c,d.x,d.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function Up(e,t,n){const{position:o,width:s,height:a,constructionProgress:c,destructionProgress:d,isConstructed:u,isBeingDestroyed:h,buildingType:p,ownerId:m,id:S}=t,v=bt(n),A=!!(v&&vr(v,t,n));let T={...qu};if(p===q.Palisade||p===q.Gate){const{width:M,height:P}=n.mapDimensions,k=n.search.building.byRadius(o,Se*1.5);for(const R of k)if(R.id!==S&&(R.buildingType===q.Palisade||R.buildingType===q.Gate)&&R.ownerId===m){const H=Le(o,R.position,M,P),G=Se*.5,F=H.x>G,Y=H.x<-5,Z=H.y>G,W=H.y<-5,j=Math.abs(H.x),ee=Math.abs(H.y);j>G&&ee<G?(F&&(T.right=!0),Y&&(T.left=!0)):ee>G&&j<G?(Z&&(T.bottom=!0),W&&(T.top=!0)):j>G&&ee>G&&(F&&W&&(T.topRight=!0),F&&Z&&(T.bottomRight=!0),Y&&Z&&(T.bottomLeft=!0),Y&&W&&(T.topLeft=!0))}}const w=nI(t,A,!1,!0,T);e.save(),u||(e.globalAlpha=.3+c*.7),e.drawImage(w,o.x-w.width/2,o.y-w.height/2),h&&u&&(e.translate(o.x,o.y),hO(e,s,a,d,S)),e.restore();const E=s,C=o.x-E/2,_=o.y+a/2+Cw;u?h&&bo(e,C,_,E,$0,1-d,Ro,Ew):bo(e,C,_,E,$0,c,Ro,ww),(t.buildingType===q.StorageSpot||t.buildingType===q.Bonfire)&&u&&pO(e,t)}function Gp(e,t,n,o,s){const a=It[n],{width:c,height:d}=a.dimensions,u=nI({buildingType:n,width:c,height:d,id:9999},!1,!0,o,qu),h=(m,S)=>{m.save(),m.globalAlpha=Aw,m.drawImage(u,S.x-u.width/2,S.y-u.height/2),m.restore()},p={position:{...t},radius:Math.max(c,d)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Oe.create()};Gn(e,s.width,s.height,(m,S)=>h(m,S.position),p)}const ns=1,gO=20,ni=4,rv=8,mO="rgba(34, 85, 34, 0.25)",yO="rgba(139, 50, 50, 0.25)",fs=new Map,vO=50;function SO(e,t){return e.map(n=>n.id).sort((n,o)=>n-o).join(",")+`_${t}`}function TO(){if(fs.size>vO){const e=fs.keys().next().value;e&&fs.delete(e)}}function IO(e){const t=new Map;for(const n of e){const o=n.ownerId;o&&(t.has(o)||t.set(o,[]),t.get(o).push(n))}return t}function AO(e,t,n,o){let s=0;const a=Math.max(o.width,o.height)/2;for(const c of n){const d=e-c.position.x,u=t-c.position.y,h=d*d+u*u;h>0?s+=a*a/h:s+=100}return s}function wO(e,t,n){let o=1/0,s=1/0,a=-1/0,c=-1/0;for(const d of e)o=Math.min(o,d.position.x-t.width/2),s=Math.min(s,d.position.y-t.height/2),a=Math.max(a,d.position.x+t.width/2),c=Math.max(c,d.position.y+t.height/2);return{minX:o-n,minY:s-n,maxX:a+n,maxY:c+n}}function EO(e,t,n,o){const s=SO(e,o);if(fs.has(s))return fs.get(s);const a=n.maxX-n.minX,c=n.maxY-n.minY,d=Math.ceil(a/ni),u=Math.ceil(c/ni),h=[],p=[];for(let v=0;v<u;v++)h[v]=new Array(d);for(let v=0;v<u;v++)for(let A=0;A<d;A++){const T=n.minX+A*ni,w=n.minY+v*ni,E=AO(T,w,e,t);h[v][A]=E}for(let v=1;v<u-1;v++)for(let A=1;A<d-1;A++)if(h[v][A]>=ns&&(h[v-1][A]<ns||h[v+1][A]<ns||h[v][A-1]<ns||h[v][A+1]<ns)){const w=n.minX+A*ni,E=n.minY+v*ni;p.push({x:w,y:E})}const m=_O(p),S={fieldValues:h,edgePoints:p,regions:m,bounds:n};return fs.set(s,S),TO(),S}function CO(e,t,n,o,s,a){if(t.length===0)return;const{bounds:c}=a,d=10;if(!a.canvas){const u=c.maxX-c.minX+d*2,h=c.maxY-c.minY+d*2,{canvas:p,ctx:m}=qT(u,h);m.translate(-c.minX+d,-c.minY+d);const{fieldValues:S,regions:v}=a;PO(m,S,c,o);let A=s;for(const T of v){const w=RO(T);kO(m,w,o,A),A+=1e3}a.canvas=p}e.save(),e.globalAlpha=1,e.drawImage(a.canvas,c.minX-d,c.minY-d),e.restore()}function PO(e,t,n,o){const s=o?yO:mO;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let c=0;c<t[a].length;c++)if(t[a][c]>=ns){const d=n.minX+c*ni,u=n.minY+a*ni;e.rect(d,u,ni,ni)}e.fill(),e.restore()}function _O(e){if(e.length===0)return[];const t=ni*2,n=t,o=new Map;function s(h,p){const m=Math.floor(h/n),S=Math.floor(p/n);return`${m},${S}`}for(let h=0;h<e.length;h++){const p=s(e[h].x,e[h].y);o.has(p)||o.set(p,[]),o.get(p).push(h)}function a(h,p){const m=[],S=Math.floor(h/n),v=Math.floor(p/n);for(let A=-1;A<=1;A++)for(let T=-1;T<=1;T++){const w=`${S+A},${v+T}`,E=o.get(w);E&&m.push(...E)}return m}const c=new Set,d=[],u=t*t;for(let h=0;h<e.length;h++){if(c.has(h))continue;const p=[],m=[h];for(;m.length>0;){const S=m.shift();if(c.has(S))continue;c.add(S),p.push(e[S]);const v=a(e[S].x,e[S].y);for(const A of v){if(c.has(A))continue;const T=e[A].x-e[S].x,w=e[A].y-e[S].y;T*T+w*w<=u&&m.push(A)}}p.length>0&&d.push(p)}return d}function RO(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const o=t[t.length-1];let s=0,a=1/0;for(let c=0;c<n.length;c++){const d=n[c].x-o.x,u=n[c].y-o.y,h=d*d+u*u;h<a&&(a=h,s=c)}t.push(n.splice(s,1)[0])}return t}function kO(e,t,n,o){if(t.length===0)return;let s=0,a=0;for(let c=1;c<t.length;c++){const d=t[c-1],u=t[c],h=u.x-d.x,p=u.y-d.y,m=Math.sqrt(h*h+p*p);for(s+=m;s>=rv;){s-=rv;const S=1-s/m,v=d.x+h*S,A=d.y+p*S;MO(e,v,A,n,o+a*13),a++}}}function MO(e,t,n,o,s){const a=ri(s),c=ri(s+1),d=(c-.5)*2,u=(ri(s+2)-.5)*2;e.beginPath();const h=1.5+a*.5;o?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+d,n+u,h,h*.85,c*Math.PI,0,Math.PI*2),e.fill(),o||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function iI(e,t,n,o){var m,S,v;const s=t;if(!((m=s.search)!=null&&m.building))return;const c=s.search.building.all().filter(A=>A.buildingType===q.PlantingZone&&A.isConstructed);if(c.length===0)return;const d=c.filter(A=>Ka(A,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(d.length===0)return;const u=It[q.PlantingZone].dimensions,h=IO(d),p=o?t.entities.entities[o]:void 0;for(const[A,T]of h){const w=((v=(S=p==null?void 0:p.tribeControl)==null?void 0:S.diplomacy)==null?void 0:v[A])==="Hostile",E=typeof A=="number"?A:0,C=wO(T,u,gO),_=EO(T,u,C,w);CO(e,T,u,w,E,_)}}const bO=.001,DO=.05,OO=12;function NO(e,t,n){const{position:o,age:s,swayOffset:a}=t,[c]=t.stateMachine??[],d=Math.min(1,Math.max(.4,s/Lo)),h=c!==jt&&c!==wi?Math.sin(n*bO+a)*DO:0;if(e.save(),e.translate(o.x,o.y),e.scale(d,d),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=hR,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),c===wi?vh(e,10,8):c===jt?(e.rotate(Math.PI/2),vh(e,10,30),e.translate(0,-25),sv(e,40,20,40,15)):(e.rotate(h),vh(e,10,30),e.translate(0,-25),e.rotate(h*.5),sv(e,40,20,40,15)),e.restore(),(c===jt||c===wi)&&t.wood&&t.wood.length>0){e.save(),e.font=`${OO}px Arial`,e.textAlign="center",e.textBaseline="middle";const p=t.radius*1.1,m=Math.PI*2/(ju-1);t.wood.forEach((S,v)=>{const A=v===0?0:p,T=v===0?0:(v-1)*m,w=o.x+A*Math.cos(T),E=o.y+A*Math.sin(T),C=wp[S.type];e.fillText(C,w,E)}),e.restore()}}function vh(e,t,n){e.fillStyle=lR,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=cR,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function sv(e,t,n,o,s){e.fillStyle=uR,av(e,t+4,n+4,o+2,s+2),e.translate(0,-2),e.fillStyle=dR,av(e,t,n,o,s),e.fillStyle=fR,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function av(e,t,n,o,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-o),e.lineTo(0,-o-s),e.lineTo(n/2,-o),e.lineTo(t/2,0),e.closePath(),e.fill()}const Yc=200;let Ao=null;function BO(e,t,n,o,s){const a=ER(t.time);if(a<=0)return;Ao||(Ao=document.createElement("canvas")),(Ao.width!==o.width||Ao.height!==o.height)&&(Ao.width=o.width,Ao.height=o.height);const c=Ao.getContext("2d");if(c){c.clearRect(0,0,o.width,o.height),c.fillStyle=`rgba(0, 0, 40, ${a*.85})`,c.fillRect(0,0,o.width,o.height),c.globalCompositeOperation="destination-out";for(const d of s){const u=Al(d.position,n,o,t.mapDimensions),h=c.createRadialGradient(u.x,u.y,0,u.x,u.y,d.radius);h.addColorStop(0,`rgba(255, 255, 255, ${d.intensity})`),h.addColorStop(1,"rgba(255, 255, 255, 0)"),c.fillStyle=h,c.beginPath(),c.arc(u.x,u.y,d.radius,0,Math.PI*2),c.fill()}c.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(Ao,0,0),e.restore()}}function lv(e,t,n,o,s,a,c){for(let d=-s.height;d<=s.height;d+=s.height)for(let u=-s.width;u<=s.width;u+=s.width){const h={x:t.x+u,y:t.y+d};Ka({position:h,radius:n},a,c,s)&&e.push({position:h,radius:n,intensity:o})}}function HO(e,t,n,o,s,a=[]){const c=bt(t),d=c?Qi(t,c):[],u=Ss(d),{width:h,height:p}=t.mapDimensions,m=[];a.forEach(E=>{m.push({position:E,radius:30,intensity:.3})}),iI(e,t,o,c==null?void 0:c.leaderId);const S=t,v={left:o.x-s.width/2-Yc,top:o.y-s.height/2-Yc,right:o.x+s.width/2+Yc,bottom:o.y+s.height/2+Yc};[...S.search.human.byRect(v),...S.search.building.byRect(v),...S.search.berryBush.byRect(v),...S.search.tree.byRect(v),...S.search.corpse.byRect(v),...S.search.prey.byRect(v),...S.search.predator.byRect(v)].sort((E,C)=>n&&E.id===t.debugCharacterId&&E.id!==C.id||E.type==="building"&&C.type!=="building"||E.position.y<C.position.y?-1:E.position.y>C.position.y?1:E.id-C.id).forEach(E=>{var C,_;if(E.type==="building"){const M=E;if(M.isConstructed){const P=M.buildingType===q.Bonfire&&(M.fuelLevel??0)>0,k=P?180:60,R=P?.9:.4;lv(m,M.position,k,R,t.mapDimensions,o,s)}if(M.buildingType===q.PlantingZone&&M.isConstructed)return;Gn(e,h,p,Up,M,t,c,t.time)}else if(E.type==="berryBush")Gn(e,h,p,vD,E,t,c,t.time);else if(E.type==="tree")Gn(e,h,p,NO,E,t.time);else if(E.type==="human"){const M=E,P=M.id===(c==null?void 0:c.id),k=d.some(Y=>Y.id===M.id),R=M.id===(u==null?void 0:u.id),H=c&&(M.id===c.motherId||M.id===c.fatherId),G=c&&(((C=M.partnerIds)==null?void 0:C.includes(c.id))||((_=c.partnerIds)==null?void 0:_.includes(M.id))),F=(c==null?void 0:c.attackTargetId)===M.id;lv(m,M.position,40,.3,t.mapDimensions,o,s),Gn(e,h,p,$D,M,P,H,k,G,R,F,n,t)}else E.type==="corpse"?Gn(e,h,p,ED,E):E.type==="prey"?Gn(e,h,p,jD,E,n,t.time,t.debugCharacterId):E.type==="predator"&&Gn(e,h,p,ZD,E,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(E=>Ka(E,o,s,t.mapDimensions)).forEach(E=>{Gn(e,h,p,tI,E,t.time,t)});const w=t.notifications.filter(E=>!E.isDismissed);for(const E of w)if(E.highlightedEntityIds&&E.renderHighlights)for(const C of E.highlightedEntityIds){const _=t.entities.entities[C];_&&Ka(_,o,s,t.mapDimensions)&&Gn(e,h,p,tv,_,sP,aP,cP,lP,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const E of t.tutorialState.highlightedEntityIds){const C=t.entities.entities[E];C&&Ka(C,o,s,t.mapDimensions)&&Gn(e,h,p,tv,C,XC,LS,xS,Ap,t.time)}BO(e,t,o,s,m)}function FO(e,t,n,o,s,a){let c=null,d=null;e.textAlign="left";let u=Je+In;const p=t.time/(Mt/Ft)/Du%1,m=wa[es.Time],S=25,v=Je+S;e.fillText(m,Je,u+Rn/2+In/3),bo(e,v,u,Io,Rn,p,Ro,PC),u+=Rn+Ni;const A=u+xi/2,T=u+(xi-Rn)/2,w=5;fl(e,{x:Je*2,y:A},xi,5,n.gender,!1,!1,!1);const E=Je+xi+w,C=Io+S-(xi+w)*2;bo(e,E,T,C,Rn,Math.floor(n.age)/il,Ro,CC),fl(e,{x:E+C+w+xi/2,y:A},xi,il,n.gender,!1,!1,!1),u+=Rn+Ni*2;const _=[],M=new Set;if(_.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),M.add(n.id),o&&!M.has(o.id)&&(_.push({member:o,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),M.add(o.id)),s.forEach(j=>{M.has(j.id)||(_.push({member:j,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),M.add(j.id))}),a.forEach(j=>{M.has(j.id)||(_.push({member:j,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),M.add(j.id))}),n.motherId&&!M.has(n.motherId)){const j=t.entities.entities[n.motherId];j&&(_.push({member:j,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),M.add(j.id))}if(n.fatherId&&!M.has(n.fatherId)){const j=t.entities.entities[n.fatherId];j&&(_.push({member:j,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),M.add(j.id))}const P=wa[es.Family],k=10,R=Je+In+k,H=Io+S-(In+k),G=u+Hc/2;e.font=`${In}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(P,Je,G);const F=u+Hc/2;fD(e,R,F,_,Hc,H),u+=Hc+Ni,e.textBaseline="alphabetic";const Y=wa[es.Hitpoints];e.fillText(Y,Je,u+Rn/2+In/3),bo(e,v,u,Io,Rn,n.hitpoints/n.maxHitpoints,Ro,EC),u+=Rn+Ni;const Z=wa[es.Hunger];e.fillText(Z,Je,u+Rn/2+In/3),bo(e,v,u,Io,Rn,(tn-n.hunger)/tn,Ro,wC),c={x:Je,y:u-Ni/2,width:Io+S,height:Rn+Ni},u+=Rn+Ni,e.textBaseline="middle";const W=wa[es.Food];return e.fillText(W,Je,u+Bc/2),CD(e,v,u+Bc/2,n.food,Bc,Io),d={x:Je,y:u-Ni/5,width:Io+S,height:Bc+Ni},e.textBaseline="alphabetic",{hungerBarRect:c,foodBarRect:d}}let _a=[],cv=0;const LO=36,xO=200;function UO(e,t,n,o){const s=t.search.prey.count(),a=t.search.predator.count(),c=t.search.berryBush.count(),d=t.search.tree.count();t.time-cv>=LO&&(_a.push({time:t.time,prey:s,predators:a,bushes:c,trees:d}),_a.length>xO&&(_a=_a.slice(-200)),cv=t.time);const u=We*Ye,h=s/u*1e6,p=a/u*1e6,m=c/u*1e6,S=d/u*1e6,v=$b(),A=Math.floor(t.time/(24*365)),T=Math.floor(t.time%(24*365)/24),w=Math.floor(t.time%24),E=400,C=Math.min(o*.8,600),_=n-E-10,M=Je+In*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(_,M,E,C),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(_,M,E,C),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let P=M+20;const k=14,R=_+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",R,P),P+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${A}, Day ${T}, Hour ${w}`,R,P),P+=k,e.fillText(`Map Size: ${We}  ${Ye} pixels`,R,P),P+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",R,P),P+=18,v&&(e.fillText(`Q-Table Size: ${v.qTableSize} entries`,R,P),P+=k,e.fillText(`Exploration Rate: ${(v.explorationRate*100).toFixed(1)}%`,R,P),P+=k);const H=_a.slice(-20);H.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",R,P),P+=30,GO(e,R,P,H),P+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",R,P),P+=18,e.fillStyle="white",e.font="12px monospace";const G=(Wi/u*1e6).toFixed(2),F=(Yi/u*1e6).toFixed(2),Y=(zi/u*1e6).toFixed(2),Z=(ji/u*1e6).toFixed(2);e.fillText(`Prey: ${h.toFixed(2)} (target: ${G})`,R,P),P+=k,e.fillText(`Predators: ${p.toFixed(2)} (target: ${F})`,R,P),P+=k,e.fillText(`Bushes: ${m.toFixed(2)} (target: ${Y})`,R,P),P+=k,e.fillText(`Trees: ${S.toFixed(2)} (target: ${Z})`,R,P),P+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",R,P),P+=18,e.fillStyle="white",e.font="12px monospace";const W=Math.round(s/Wi*100),j=Math.round(a/Yi*100),ee=Math.round(c/zi*100),se=Math.round(d/ji*100),ae=Q=>Q<50?"#ff4444":Q<80?"#ffaa44":Q>120?"#44aaff":"#44ff44";e.fillStyle=ae(W),e.fillText(`Prey: ${s}/${Wi} (${W}%)`,R,P),P+=k,e.fillStyle=ae(j),e.fillText(`Predators: ${a}/${Yi} (${j}%)`,R,P),P+=k,e.fillStyle=ae(se),e.fillText(`Trees: ${d}/${ji} (${se}%)`,R,P),P+=k,e.fillStyle=ae(ee),e.fillText(`Bushes: ${c}/${zi} (${ee}%)`,R,P),P+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",R,P),P+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",R,P),P+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,R,P),P+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,R,P),P+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,R,P),P+=13,e.fillText("Predators:",R,P),P+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,R,P),P+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,R,P),P+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,R,P),P+=13,e.fillText("Bushes:",R,P),P+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,R,P),P+=15,e.fillText("Trees:",R,P),P+=13,e.fillText(` Spread Chance: ${(t.ecosystem.treeSpreadChance*100).toFixed(1)}%`,R,P),P+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",_+E/2,M+C-10),e.restore()}function GO(e,t,n,o){if(o.length<2)return;const d={prey:Math.max(...o.map(h=>h.prey),Wi),predators:Math.max(...o.map(h=>h.predators),Yi),bushes:Math.max(...o.map(h=>h.bushes),zi),trees:Math.max(...o.map(h=>h.trees),ji)};[{data:o.map(h=>h.prey),color:"#44ff44",label:"Prey",target:Wi,max:d.prey},{data:o.map(h=>h.predators),color:"#ff4444",label:"Predators",target:Yi,max:d.predators},{data:o.map(h=>h.trees),color:"#76a331",label:"Trees",target:ji,max:d.trees},{data:o.map(h=>h.bushes),color:"#ffaa44",label:"Bushes",target:zi,max:d.bushes}].forEach((h,p)=>{const m=t+p%2*115,S=n+Math.floor(p/2)*55;e.fillStyle=h.color,e.font="10px monospace",e.textAlign="left",e.fillText(h.label,m,S-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,S,100,30),e.beginPath(),e.strokeStyle=h.color;for(let A=0;A<h.data.length;A++){const T=m+A/(h.data.length-1)*100,w=S+30-h.data[A]/h.max*30;A===0?e.moveTo(T,w):e.lineTo(T,w)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const v=S+30-h.target/h.max*30;e.moveTo(m,v),e.lineTo(m+100,v),e.stroke(),e.setLineDash([])})}function $O(e,t){const n=t.search.human.byProperty("leaderId",e),o={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||o.children++,s.gender==="male"?o.males++:s.gender==="female"&&o.females++,s.age>=up&&o.old++;return o}function WO(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(h=>n.berryBush.byRadius(h.position,h.radius)).reduce((h,p)=>h+p.food.length,0),u=n.building.byProperty("ownerId",e).filter(h=>h.buildingType===q.StorageSpot).reduce((h,p)=>h+(p.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:u,consumptionRate:0}}function YO(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,c=new Map,d=new Map;for(const h of s){const p=Su(h.id,t,c);d.has(p)||d.set(p,[]),d.get(p).push(h)}const u=[];for(const[h,p]of d.entries()){const m=a[h];m&&u.push({patriarch:m,memberCount:p.length,members:p.map(S=>S.id)})}return u.sort((h,p)=>p.memberCount-h.memberCount),u.slice(0,n)}let Ra=[],vi=[],uv=0;const zO=36,dv=200;function jO(e,t,n,o){var M;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(M=Np(s,t))==null?void 0:M.id;if(!a)return;const c=$O(a,t),d=WO(a,t);if(t.time-uv>=zO){Ra.push({time:t.time,total:c.total,children:c.children,males:c.males,females:c.females,old:c.old});const P=d.totalBushFood+d.totalStorageFood;vi.push({time:t.time,bushFood:d.totalBushFood,storageFood:d.totalStorageFood,totalFood:P}),Ra.length>dv&&(Ra=Ra.slice(-200)),vi.length>dv&&(vi=vi.slice(-200)),uv=t.time}let u=0;if(vi.length>=2){const P=vi[vi.length-1],k=vi[vi.length-2],R=P.time-k.time;R>0&&(u=(k.totalFood-P.totalFood)/R)}const h=400,p=Math.min(o*.9,700),m=n-h-10,S=Je+In*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,S,h,p),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,S,h,p),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let v=S+20;const A=13,T=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",T,v),v+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",T,v),v+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${c.total}`,T,v),v+=A,e.fillStyle="#00ffff",e.fillText(`Children: ${c.children}`,T,v),v+=A,e.fillStyle="#4488ff",e.fillText(`Males: ${c.males}`,T,v),v+=A,e.fillStyle="#ff88ff",e.fillText(`Females: ${c.females}`,T,v),v+=A,e.fillStyle="#888888",e.fillText(`Old (${c.old})`,T,v),v+=20;const w=Ra.slice(-50);w.length>1&&(XO(e,T,v,w),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",T,v),v+=18;const E=d.totalBushFood+d.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${E}`,T,v),v+=A,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${d.totalBushFood}`,T,v),v+=A,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${d.totalStorageFood}`,T,v),v+=A,e.fillStyle="#ff4444",e.fillText(`Consumption: ${u.toFixed(2)}/hour`,T,v),v+=20;const C=vi.slice(-50);C.length>1&&(VO(e,T,v,C),v+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",T,v),v+=18;const _=YO(a,t,5);e.fillStyle="white",e.font="11px monospace",_.length===0?(e.fillText("No families found",T,v),v+=A):_.forEach((P,k)=>{const H=`${k+1}. ${P.patriarch.isPlayer?"Player":"#"+P.patriarch.id} (${P.memberCount} members, can split: ${oT(P.patriarch,t).canSplit})`;e.fillText(H,T,v),v+=A}),v+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+h/2,S+p-10),e.restore()}function XO(e,t,n,o){if(o.length<2)return;const c=Math.max(...o.map(u=>Math.max(u.total,u.children,u.males,u.females,u.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:o.map(u=>u.total),color:"#ffffff",label:"Total"},{data:o.map(u=>u.children),color:"#00ffff",label:"Children"},{data:o.map(u=>u.males),color:"#4488ff",label:"Males"},{data:o.map(u=>u.females),color:"#ff88ff",label:"Females"},{data:o.map(u=>u.old),color:"#888888",label:"Old"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let h=0;h<u.data.length;h++){const p=t+h/(u.data.length-1)*350,m=n+80-u.data[h]/c*80;h===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function VO(e,t,n,o){if(o.length<2)return;const c=Math.max(...o.map(u=>Math.max(u.totalFood,u.bushFood,u.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:o.map(u=>u.totalFood),color:"#ffff00",label:"Total"},{data:o.map(u=>u.bushFood),color:"#44ff44",label:"Bush"},{data:o.map(u=>u.storageFood),color:"#ffaa44",label:"Storage"}].forEach(u=>{e.beginPath(),e.strokeStyle=u.color,e.lineWidth=2;for(let h=0;h<u.data.length;h++){const p=t+h/(u.data.length-1)*350,m=n+80-u.data[h]/c*80;h===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function fv(e,t,n){e.save();const{x:o,y:s,width:a,height:c}=t.rect,d=DS;if(e.beginPath(),e.moveTo(o+d,s),e.lineTo(o+a-d,s),e.quadraticCurveTo(o+a,s,o+a,s+d),e.lineTo(o+a,s+c-d),e.quadraticCurveTo(o+a,s+c,o+a-d,s+c),e.lineTo(o+d,s+c),e.quadraticCurveTo(o,s+c,o,s+c-d),e.lineTo(o,s+d),e.quadraticCurveTo(o,s,o+d,s),e.closePath(),e.fillStyle=t.isDisabled?OS:t.backgroundColor,e.fill(),t.activated){e.save();const u=(Math.sin(Date.now()/1e3*FS)+1)/2;e.strokeStyle=HS,e.lineWidth=2+u*2,e.globalAlpha=.7+u*.3,e.stroke(),e.restore()}if(t.lastActivated){const u=Date.now()-t.lastActivated;if(u<mu){const h=1-u/mu;e.fillStyle=BS,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=Ip,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?NS:t.textColor,t.icon?(e.font=`${c*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+a/2,s+c/2),t.text&&(e.font=`${c*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+a-4,s+c-2))):(e.font=`${In*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+a/2,s+c/2)),e.restore()}function qO(e,t,n,o){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,o);const s=500,a=150,c=(n-s)/2,d=(o-a)/2;e.fillStyle=kt,e.font=`${In*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,d+a/3-10),e.fillText("to the main menu?",n/2,d+a/3+10);const u=$i*1.5,h=bS,p=d+a-h-Je*2,m=20,S=u*2+m,v=c+(s-S)/2,A={id:"confirmExitYes",action:Te.ConfirmExitYes,rect:{x:v,y:p,width:u,height:h},text:"Yes",backgroundColor:On,textColor:kt,currentWidth:u},T=v+u+m,w={id:"confirmExitNo",action:Te.ConfirmExitNo,rect:{x:T,y:p,width:u,height:h},text:"No",backgroundColor:On,textColor:kt,currentWidth:u};t.uiButtons.push(A,w),fv(e,A,t.hoveredButtonId===A.id),fv(e,w,t.hoveredButtonId===w.id),e.restore()}let hv="",pv=null;function ZO(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function KO(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function zc(e,t,n,o,s,a,c){const d=((t+o)%a+a)%a,u=((n+s)%c+c)%c;return e.has(`${d},${u}`)}function QO(e,t,n,o){const s=kP(t.soilDepletion,lS);if(s.length===0)return;const{width:a,height:c}=t.mapDimensions,d=o.width/2,u=o.height/2,h=Math.ceil(a/Wt),p=Math.ceil(c/Wt),m=ZO(s);m!==hv&&(hv=m,pv=KO(s));const S=pv,v=Wt*2,A=n.x-d-v,T=n.x+d+v,w=n.y-u-v,E=n.y+u+v;e.save();const C=e.globalAlpha;for(const _ of s){const M=_.gridX*Wt,P=_.gridY*Wt,k=JO(M,P,a,c,A,T,w,E);for(const R of k)eN(e,R.x,R.y,_.health,_.gridX,_.gridY,S,h,p)}e.globalAlpha=C,e.restore()}function JO(e,t,n,o,s,a,c,d){const u=[],h=Wt,p=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-o},{dx:0,dy:o},{dx:-n,dy:-o},{dx:n,dy:-o},{dx:-n,dy:o},{dx:n,dy:o}];for(const m of p){const S=e+m.dx,v=t+m.dy;S+h>=s&&S<=a&&v+h>=c&&v<=d&&u.push({x:S,y:v})}return u}function eN(e,t,n,o,s,a,c,d,u){const h=Math.floor(t),p=Math.floor(n),m=Wt,S=1-o/lS,A=o<nE?ry:ry*S,T=!zc(c,s,a,0,-1,d,u),w=!zc(c,s,a,0,1,d,u),E=!zc(c,s,a,-1,0,d,u),C=!zc(c,s,a,1,0,d,u);e.globalAlpha=A,e.fillStyle=eE,e.fillRect(h,p,m,m);const _=3;e.fillStyle=tE,e.globalAlpha=A*1.2,T&&e.fillRect(h,p,m,_),w&&e.fillRect(h,p+m-_,m,_),E&&e.fillRect(h,p,_,m),C&&e.fillRect(h+m-_,p,_,m),e.globalAlpha=A*.5;const M=_+1;T&&E&&e.fillRect(h,p,M,M),T&&C&&e.fillRect(h+m-M,p,M,M),w&&E&&e.fillRect(h,p+m-M,M,M),w&&C&&e.fillRect(h+m-M,p+m-M,M,M),e.globalAlpha=1}const ka=8,Ma=12,an=24;function gv(e,t,n,o,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-Ma),e.stroke(),e.fillStyle=o,e.beginPath(),e.moveTo(t,n-Ma),e.lineTo(t+ka,n-Ma+ka/2),e.lineTo(t,n-Ma+ka),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+ka/2,n-Ma+ka/2))}function $p(e,t,n,o,s){const a=Lu(t,s);let c=1;const d=new Map,u=new Map;for(const T of a){const E=T.leaderId===s?0:c++,C=Yt[E%Yt.length];d.set(T.leaderId,C),u.set(T.leaderId,T.tribeBadge||"")}const h=[],p=an*2,m=Math.floor((n.x-o.width/2-p)/an)*an,S=Math.floor((n.x+o.width/2+p)/an)*an,v=Math.floor((n.y-o.height/2-p)/an)*an,A=Math.floor((n.y+o.height/2+p)/an)*an;for(let T=v;T<=A;T+=an)for(let w=m;w<=S;w+=an){const E=li(w,T,t),C=w+an,_=li(C,T,t);if(E!==_){const k=E||_;if(k){const R=w+an/2,H=T;gv(e,R,H,d.get(k)||"#000",u.get(k)||""),h.push({x:R,y:H})}}const M=T+an,P=li(w,M,t);if(E!==P){const k=E||P;if(k){const R=w,H=T+an/2;gv(e,R,H,d.get(k)||"#000",u.get(k)||""),h.push({x:R,y:H})}}}return h}const ln=12,st=16,cn=15;function mv(e){switch(e){case N.Success:return"#4CAF50";case N.Failure:return"#F44336";case N.Running:return"#FFC107";case N.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function Sh(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function tN(e,t,n,o){var R,H;const{debugCharacterId:s}=t,a=500,c=Math.min(o*.9,800),d=n-a-10,u=Je+In*2;t.debugPanelRect={x:d,y:u,width:a,height:c},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(d,u,a,c),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(d,u,a,c),e.fillStyle="white",e.font=`${ln}px monospace`,e.textAlign="left",e.textBaseline="top";let h=u+20;const p=d+15;if(e.fillStyle="#66ccff",e.font=`bold ${ln+2}px monospace`,e.fillText(" Task AI Debugger",p,h),h+=25,!s){e.fillStyle="#888",e.font=`${ln}px monospace`,e.fillText("No character selected for debugging.",p,h),e.fillText("Click on a character to inspect their Task AI.",p,h+20),e.restore();return}const m=t.entities.entities[s];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${ln}px monospace`,e.fillText(`Character #${s} not found or not a character.`,p,h),e.restore();return}const S=m;e.fillStyle="white",e.font=`${ln}px monospace`,e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,p,h),h+=st*1.5,e.fillStyle="#66ccff",e.font=`bold ${ln}px monospace`,e.fillText(" Current Task",p,h),h+=st*1.5;const v=Iu(S),A=v?t.tasks[v]:null;if(e.font=`${ln}px monospace`,A){const G=Oe.get(S.aiBlackboard,_T),F=Oe.get(S.aiBlackboard,RT),Y=G!==void 0?N[G]:"N/A";e.fillStyle="white",e.fillText(`ID: ${A.id}`,p+cn,h),h+=st,e.fillText(`Type: ${V[A.type]}`,p+cn,h),h+=st,e.fillText(`Target: ${Sh(A.target)}`,p+cn,h),h+=st,e.fillStyle=mv(G),e.fillText(`Status: ${Y}`,p+cn,h),h+=st,F&&(e.fillStyle="#aaa",e.fillText(`Message: ${F}`,p+cn,h),h+=st)}else e.fillStyle="#888",e.fillText("No active task.",p+cn,h),h+=st;if(h+=st,S.type==="human"){const G=S;e.fillStyle="#66ccff",e.font=`bold ${ln}px monospace`,e.fillText(" Pathfinding",p,h),h+=st*1.5,e.font=`${ln}px monospace`,e.fillStyle="white",e.fillText(`Waypoints: ${((R=G.path)==null?void 0:R.length)||0}`,p+cn,h),h+=st,G.pathTarget&&(e.fillText(`Target: ${Sh(G.pathTarget)}`,p+cn,h),h+=st),G.path&&G.path.length>0&&(e.fillText(`Next: ${Sh(G.path[0])}`,p+cn,h),h+=st),h+=st}e.fillStyle="#66ccff",e.font=`bold ${ln}px monospace`,e.fillText(" Recent Task History (Last 5)",p,h),h+=st*1.5;const T=Oe.get(S.aiBlackboard,$h)||[];if(T.length===0)e.fillStyle="#888",e.font=`${ln}px monospace`,e.fillText("No task history yet.",p+cn,h),h+=st;else for(const G of T){e.fillStyle="white",e.font=`${ln}px monospace`;const F=V[G.type];e.fillText(` ${F}`,p+cn,h);const Y=N[G.result];e.fillStyle=mv(G.result);const Z=e.measureText(` ${F} `).width;e.fillText(`(${Y})`,p+cn+Z,h),e.fillStyle="#666";const W=e.measureText(`(${Y}) `).width;e.fillText(`@ ${G.completedAtTick.toFixed(1)}h`,p+cn+Z+W,h),h+=st,G.message&&(e.fillStyle="#888",e.fillText(`   ${G.message}`,p+cn,h),h+=st)}h+=st,e.fillStyle="#66ccff",e.font=`bold ${ln}px monospace`,e.fillText(" Available Tasks",p,h),h+=st*1.5;const w=h,E=u+c-w-30;e.save(),e.beginPath(),e.rect(d,w,a,E),e.clip();const C=((H=t.debugPanelScroll)==null?void 0:H.y)??0;e.translate(0,-C);const _=t.search.tasks.byRadius(m.position,800);let M=0;if(_.length===0)e.fillStyle="#888",e.font=`${ln}px monospace`,e.fillText("No tasks available in the world.",p+cn,h),h+=st;else{const G=_.map(F=>{const Y=Xu[F.type];return{task:F,score:Y&&Y.scorer&&S.type==="human"?Y.scorer(S,F,{gameState:t,deltaTime:0}):null}});G.sort((F,Y)=>{const Z=F.score!==null?F.score:-1/0;return(Y.score!==null?Y.score:-1/0)-Z});for(const{task:F,score:Y}of G){let Z="Unclaimed",W="#888";F.claimedByEntityId&&(F.claimedByEntityId===S.id?(Z="Claimed by this character",W="#4CAF50"):(Z=`Claimed by #${F.claimedByEntityId}`,W="#F44336")),e.font=`${ln}px monospace`,e.fillStyle=W;const j=` Task ID: ${F.id}`;e.fillText(j,p,h),h+=st,e.fillStyle="white",e.fillText(`  Type: ${V[F.type]}`,p,h),h+=st;const ee=Y!==null?Y.toFixed(3):"N/A";e.fillStyle=Y!==null&&Y>0?"#FFC107":"#888",e.fillText(`  Score: ${ee}`,p,h),h+=st,e.fillStyle=W,e.fillText(`  Status: ${Z}`,p,h),h+=st*1.5,M=Math.max(M,e.measureText(j).width+30)}}const P=h-w;t.debugPanelContentSize={width:M,height:P},e.restore();const k=u+c-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",d+a/2,k),e.restore()}function nN(e,t,n,o){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey"))switch(a.aiType){case xo.TaskBased:default:tN(e,t,n,o);break}}function wu(e,t,n,o,s,a=!1){var h;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),mD(e,t);return}const c=bt(t),d=$p(e,t,n,s,c==null?void 0:c.leaderId);if(QO(e,t,n,s),HO(e,t,t.debugPanel===qe.General,n,s,d),c&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const p=zh(t.mousePosition,n,s,t.mapDimensions),m=Sr(p,t.selectedBuildingType,c.leaderId,t);Gp(e,p,t.selectedBuildingType,m,t.mapDimensions)}const u=t.notifications.filter(p=>!p.isDismissed);for(const p of u){const m=(Math.sin(t.time*iP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=nP,p.targetArea&&e.fillRect(p.targetArea.x,p.targetArea.y,p.targetArea.width,p.targetArea.height),p.targetRadius&&(e.beginPath(),e.arc(p.targetRadius.x,p.targetRadius.y,p.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,RD(e,t),e.restore(),!a){e.fillStyle=TC,e.font=`${In}px "Press Start 2P", Arial`,e.shadowColor=IC,e.shadowBlur=AC,t.uiButtons=[];let p=null,m=null;if(c){const A=Qi(t,c),T=Ss(A),w=((h=c.partnerIds)==null?void 0:h.map(C=>t.entities.entities[C]).filter(C=>C!==void 0))||[],E=FO(e,t,c,T,w,A);p=E.hungerBarRect,m=E.foodBarRect}const S=Lu(t,c==null?void 0:c.leaderId);oD(e,t,n,S,e.canvas.width,e.canvas.height,t.cameraZoom);const{commandButtonsRect:v}=Jb(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,c&&(PD(e,t,n,e.canvas.width,e.canvas.height),o.length>0&&iD(e,o,c,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:A}=t.tutorialState;A.includes(gr.HUNGER_BAR)&&p&&hh(e,p,t.time),A.includes(gr.FOOD_BAR)&&m&&hh(e,m,t.time),A.includes(gr.COMMAND_BUTTONS)&&v&&hh(e,v,t.time)}if(t.tutorialState.isActive){const A=gD(e,t,e.canvas.width,e.canvas.height);A&&t.uiButtons.push({id:"tutorial-dismiss",action:Te.DismissTutorial,rect:A,text:"",currentWidth:A.width,backgroundColor:"transparent",textColor:"transparent"})}switch(MD(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case qe.Ecosystem:UO(e,t,e.canvas.width,e.canvas.height);break;case qe.Tribe:jO(e,t,e.canvas.width,e.canvas.height);break;case qe.Performance:DD(e,t,s.width);break;case qe.General:nN(e,t,e.canvas.width,e.canvas.height);break}t.tribeModalOpen&&hD(e,t,S,e.canvas.width,e.canvas.height),t.isPaused&&t.exitConfirmation!=="pending"&&eD(e),t.exitConfirmation==="pending"&&qO(e,t,e.canvas.width,e.canvas.height)}}const iN=Ne.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,oN=Ne.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,rN=Ne.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,sN=Ne.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,yv=Ne.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,aN=Ne.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,lN=Ne.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,jc="intro-soundtrack",vv=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=Ci(),o=te.useRef(null),s=te.useRef(null),a=te.useRef($M()),c=te.useRef(),d=te.useRef(a.current.viewportCenter),u=te.useRef(),h=te.useCallback(()=>{ah(jc,2),n(),e("game")},[e,n]),p=te.useCallback(()=>{t&&(ah(jc,2),e("game"))},[e,t]);te.useEffect(()=>{const v=A=>{(A.key==="Enter"||A.key===" ")&&(t?p():h())};return window.addEventListener("keydown",v),()=>{window.removeEventListener("keydown",v)}},[h,p,t]),te.useEffect(()=>(Pp(_e.SoundTrack1,{loop:!0,trackId:jc}),()=>{ah(jc,2)}),[]),te.useEffect(()=>{const v=o.current;if(!v)return;s.current=v.getContext("2d");const A=()=>{v&&s.current&&(v.width=window.innerWidth,v.height=window.innerHeight,wu(s.current,a.current,d.current,[],{width:v.width,height:v.height},!0))};return A(),window.addEventListener("resize",A),()=>window.removeEventListener("resize",A)},[]),te.useEffect(()=>{const v=()=>{const T=ES(a.current);if(T.length>0){const w=Math.floor(Math.random()*T.length);u.current=T[w].id}};v();const A=setInterval(v,x1);return()=>clearInterval(A)},[]);const[m,S]=rp(v=>{var w,E;if(!s.current)return;if(c.current===void 0){c.current=v;return}const A=Math.min((v-c.current)/1e3,1);a.current=Vu(a.current,A);const T=u.current?a.current.entities.entities[u.current]:void 0;if(T){const{mapDimensions:C}=a.current,{width:_,height:M}=C;let P={...T.position};const k=P.x-d.current.x;Math.abs(k)>_/2&&(k>0?P.x-=_:P.x+=_);const R=P.y-d.current.y;Math.abs(R)>M/2&&(R>0?P.y-=M:P.y+=M);let H=ou(d.current,P,uu*A);H={x:(H.x%_+_)%_,y:(H.y%M+M)%M},d.current=H}wu(s.current,a.current,d.current,[],{width:((w=o.current)==null?void 0:w.width)||800,height:((E=o.current)==null?void 0:E.height)||600},!0),c.current=v},!1);return te.useEffect(()=>(S(),m),[S,m]),X.jsxs(iN,{children:[X.jsx(oN,{ref:o}),X.jsxs(rN,{children:[X.jsx(sN,{children:"Tribe2"}),X.jsxs(aN,{children:[X.jsx(yv,{onClick:h,children:"New Game"}),t&&X.jsx(yv,{onClick:p,children:"Load Game"})]}),X.jsxs(lN,{children:["by"," ",X.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function cN(){console.log("Tribe game initialized with detailed 2D world state.");const e=GM();return e.ecosystem={preyGestationPeriod:ur,preyProcreationCooldown:dr,predatorGestationPeriod:fr,predatorProcreationCooldown:hr,preyHungerIncreasePerHour:ko,predatorHungerIncreasePerHour:Mo,berryBushSpreadChance:Xi,treeSpreadChance:Vi},e.debugPanel=qe.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const uN=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:o,playerActionHintsRef:s})=>(te.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const c=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,wu(t.current,n.current,o.current,s.current,{width:a.width,height:a.height},!1))};return c(),window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]),X.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),dN=(e,t,n,o=!1)=>{var c,d;let s;const a=eC(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:ve.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:ve.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const u=a;t.isAdult&&ml(t,u,n)?s={action:ve.AutopilotAttack,targetEntityId:u.id}:Rs(t,u,n)?s={action:ve.AutopilotProcreate,targetEntityId:u.id}:t.food.length>0&&!u.isAdult&&(u.motherId===t.id||u.fatherId===t.id)&&(s={action:ve.AutopilotFeedChild,targetEntityId:u.id})}else if(a.type==="prey")s={action:ve.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:ve.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const u=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&vr(t,u,n)&&u.isConstructed?s={action:ve.RemoveEnemyBuilding,targetEntityId:u.id}:s={action:ve.Removal,position:a.position};else if(t.leaderId===t.id&&vr(t,u,n)&&u.isConstructed)IS(u.position,Ki,t.id,n).valid?s={action:ve.TakeOverBuilding,targetEntityId:u.id}:s={action:ve.AutopilotMove,position:e};else if(u.buildingType==="storageSpot"){const h=u.ownerId===t.leaderId,p=u.storedItems.length>0,m=u.storageCapacity!==void 0&&u.storedItems.length<u.storageCapacity;if(o&&u.isConstructed&&p&&t.food.length<t.maxFood)if(h)s={action:ve.AutopilotRetrieve,targetEntityId:a.id};else{const S=t.leaderId?n.entities.entities[t.leaderId]:void 0;S&&((c=S.tribeControl)!=null&&c.diplomacy)?(u.ownerId&&S.tribeControl.diplomacy[u.ownerId])===Rt.Hostile?s={action:ve.AutopilotGather,targetEntityId:a.id}:s={action:ve.AutopilotMove,position:e}:s={action:ve.AutopilotMove,position:e}}else h&&u.isConstructed?(t.food.length>0||t.heldItem)&&m?s={action:ve.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&p?s={action:ve.AutopilotRetrieve,targetEntityId:a.id}:s={action:ve.AutopilotMove,position:e}:s={action:ve.AutopilotMove,position:e}}else u.buildingType==="plantingZone"&&t.food.filter(h=>h.type===ui.Berry).length>=mr&&!Zi(e,n,bu)&&!Ir(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:ve.AutopilotPlant,position:e}:u.buildingType===q.Bonfire&&((d=t.heldItem)==null?void 0:d.type)===Lt.Wood&&u.isConstructed&&u.storedItems.length<(u.storageCapacity||0)?s={action:ve.AutopilotDeposit,targetEntityId:u.id}:s={action:ve.AutopilotMove,position:e}}else if(a.type==="tree"){const u=a,[h]=u.stateMachine??[],p=h===oi||h===zn||h===Ai;t.isAdult&&!t.heldItem&&p?s={action:ve.AutopilotChop,targetEntityId:u.id}:t.isAdult&&!t.heldItem&&h===jt&&u.wood.length>0?s={action:ve.AutopilotGather,targetEntityId:u.id}:s={action:ve.AutopilotMove,position:e}}}else t.food.filter(u=>u.type===ui.Berry).length>=mr&&(n.autopilotControls.isManuallyPlanting||vl(e,n,t))&&!Ir(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:ve.AutopilotPlant,position:e}:s={action:ve.AutopilotMove,position:e};return s},fN=(e,t)=>{if(e.isPaused)return;const n=bt(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=J(n.position,t,e.mapDimensions.width,e.mapDimensions.height),c=100;a<=c?Sr(t,s,n.leaderId,e,n.position,c)&&(vp(t,s,n.leaderId,e),e.selectedBuildingType=null):Sr(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:ve.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=fC(t,e);s&&xh(s.id,e);return}const o=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,o?(e.autopilotControls.activeAutopilotAction=o,(o.action===ve.AutopilotMove||o.action===ve.AutopilotGather||o.action===ve.AutopilotChop)&&(e.hasPlayerMovedEver=!0),o.action===ve.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:ve.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},hN=(e,t)=>{var c,d,u,h,p,m;const n=e.key.toLowerCase(),o=e.ctrlKey||e.metaKey;let s=!0,a=t;if(o){switch(n){case"s":Qh(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:S}=t;S.activeAutopilotAction||S.isManuallyMoving||S.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(S.activeAutopilotAction=void 0,S.isManuallyMoving=!1,S.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"m":t.isMuted=!t.isMuted,ja(t.masterVolume,t.isMuted);break;case"=":case"+":const v=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(v.toFixed(1)),ja(t.masterVolume,t.isMuted);break;case"-":const A=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(A.toFixed(1)),ja(t.masterVolume,t.isMuted);break;case"t":a=Vu(t,KS);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===qe.General?(a.debugPanel=qe.None,a.debugCharacterId=void 0):(a.debugPanel=qe.General,a.debugCharacterId||(a.debugCharacterId=((c=bt(a))==null?void 0:c.id)??((d=Object.values(a.entities.entities).find(T=>T.type==="human"||T.type==="prey"||T.type==="predator"))==null?void 0:d.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===qe.Ecosystem){a.debugPanel=qe.None;break}a.debugPanel=qe.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((u=bt(a))==null?void 0:u.id)??((h=Object.values(a.entities.entities).find(T=>T.type==="human"||T.type==="prey"||T.type==="predator"))==null?void 0:h.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===qe.Tribe){a.debugPanel=qe.None;break}a.debugPanel=qe.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((p=bt(a))==null?void 0:p.id)??((m=a.search.human.all().find(T=>T.leaderId===T.id))==null?void 0:m.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===qe.Performance){a.debugPanel=qe.None;break}a.debugPanel=qe.Performance}else s=!1;break;case"tab":if(a.debugPanel!==qe.General&&a.debugPanel!==qe.Tribe&&(a.debugPanel=qe.General),a.debugPanel===qe.General){const T=Object.values(a.entities.entities).filter(w=>w.type==="human"||w.type==="prey"||w.type==="predator");if(T.length>0){const w=T.sort((M,P)=>{if(M.type==="human"&&M.isPlayer)return-1;if(P.type==="human"&&P.isPlayer)return 1;if(M.type!==P.type){const k={human:0,prey:1,predator:2},R=k[M.type]??999,H=k[P.type]??999;return R-H}return M.id-P.id}),E=a.debugCharacterId,_=((E?w.findIndex(M=>M.id===E):-1)+1)%w.length;a.debugCharacterId=w[_].id}else a.debugCharacterId=void 0}else if(a.debugPanel===qe.Tribe){const T=a.search.human.all().filter(E=>E.leaderId===E.id);let w=T.findIndex(E=>E.id===a.debugCharacterId)+1;(w===-1||w>T.length-1)&&(w=0),a.debugCharacterId=T[w].id}else a.debugPanel=qe.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},pN=(e,t,n,o,s)=>{var c;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",ke(a,_e.ButtonClick,o.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",ke(a,_e.ButtonClick,o.position);return}else if(e==="3"){n.selectedBuildingType="palisade",ke(a,_e.ButtonClick,o.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",ke(a,_e.ButtonClick,o.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",ke(a,_e.ButtonClick,o.position);return}else if(e==="6"){n.selectedBuildingType="removal",ke(a,_e.ButtonClick,o.position);return}else if(e==="7"){n.selectedBuildingType="gate",ke(a,_e.ButtonClick,o.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=Ke(o,n,"berryBush",Qe,p=>p.food.length>0&&o.food.length<o.maxFood),u=Ke(o,n,"corpse",Qe,p=>p.food.length>0&&o.food.length<o.maxFood);let h=null;d&&u?h=J(o.position,d.position,n.mapDimensions.width,n.mapDimensions.height)<=J(o.position,u.position,n.mapDimensions.width,n.mapDimensions.height)?d:u:h=d||u,h&&(o.activeAction="gathering",ke(a,_e.Gather,o.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}Ke(o,n,"human",Qe,u=>Rs(o,u,n))&&(o.activeAction="procreating",ke(a,_e.Procreate,o.position))}else if(e==="f")o.food.length>0&&(o.activeAction="eating",ke(a,_e.Eat,o.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=s.find(u=>u.type===ve.FeedChild);d&&d.targetEntity&&(o.activeAction="feeding",o.target=d.targetEntity.id)}else if(e==="arrowup"||e==="w")o.direction.y=-1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")o.direction.y=1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")o.direction.x=-1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")o.direction.x=1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const d=Ke(o,n,"human",An,u=>ml(o,u,n))??Ke(o,n,"predator",An)??Ke(o,n,"prey",An);d&&(o.activeAction="attacking",o.attackTargetId=d.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(u=>u.type===ve.Plant)){const u=OE(o.position,n,50,Oh);u&&(o.activeAction="planting",o.target=u,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const d=Ke(o,n,"building",ci,h=>{const p=h;return p.buildingType===q.Bonfire&&p.isConstructed&&p.storedItems.length<(p.storageCapacity||0)});if(((c=o.heldItem)==null?void 0:c.type)===Lt.Wood&&d){o.activeAction="depositing",o.target=d.id,ke(a,_e.StorageDeposit,o.position);return}const u=Ke(o,n,"building",ci,h=>{const p=h;return p.buildingType===q.StorageSpot&&p.ownerId===o.leaderId&&p.isConstructed&&p.storageCapacity!==void 0&&p.storedItems.length<p.storageCapacity});u&&(o.activeAction="idle",o.target=u.id,ke(a,_e.StorageDeposit,o.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const d=Ke(o,n,"building",ci,u=>{const h=u;return h.buildingType==="storageSpot"&&h.ownerId===o.leaderId&&h.isConstructed&&h.storedItems.length>0});d&&(o.activeAction="idle",o.target=d.id,ke(a,_e.StorageRetrieve,o.position))}else if(e==="k")rT(o,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,ke(a,_e.ButtonClick,o.position)}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const d=Ke(o,n,"tree",Ou,u=>u.wood&&u.wood.length>0&&!o.heldItem);d&&(o.activeAction="chopping",o.target=d.id)}},gN=(e,t,n,o)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!o.current.has("arrowup")&&!o.current.has("arrowdown")&&!o.current.has("arrowleft")&&!o.current.has("arrowright")&&!o.current.has("w")&&!o.current.has("a")&&!o.current.has("s")&&!o.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!o.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!o.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!o.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!o.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!o.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},mN=(e,t,n)=>{const{mapDimensions:o}=e,{width:s,height:a}=o;if(!e.cameraFollowingPlayer){if(e.cameraTargetPosition){const u=Le(t,e.cameraTargetPosition,s,a);if(Oo(u)<1){const S=e.cameraTargetPosition;return e.cameraTargetPosition=void 0,S}const p=jn(t,u);let m=ou(t,p,uu*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return t}let d=bt(e);if(e.debugCharacterId){const u=e.entities.entities[e.debugCharacterId];u&&"position"in u&&(d=u)}if(d){let u={...d.position};const h=u.x-t.x;Math.abs(h)>s/2&&(h>0?u.x-=s:u.x+=s);const p=u.y-t.y;Math.abs(p)>a/2&&(p>0?u.y-=a:u.y+=a);let m=ou(t,u,uu*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return e.viewportCenter};function yN(e,t){const{width:n,height:o}=e.mapDimensions;e.cameraTargetPosition=void 0,e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%o+o)%o}}const vN=(e,t,n,o)=>{var u,h;const s={gameState:n},a=bt(n);a&&ke(s,_e.ButtonClick,a.position);const c=n.uiButtons.find(p=>p.id===e.id);c&&(c.lastActivated=Date.now()),t&&[Te.CommandGather,Te.CommandPlant,Te.ToggleProcreationBehavior,Te.CommandBuild].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:d}=n.autopilotControls;switch(e.action){case Te.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case Te.ConfirmExitYes:o(),n.exitConfirmation="inactive";break;case Te.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case Te.ToggleMute:n.isMuted=!n.isMuted,ja(n.masterVolume,n.isMuted);break;case Te.TogglePause:n.isPaused=!n.isPaused;break;case Te.FastForward:return Vu(n,KS);case Te.DismissTutorial:n.tutorialState.isActive=!1;break;case Te.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case Te.CommandGather:t?d.gathering=!d.gathering:a&&(a.activeAction="gathering");break;case Te.CommandPlant:t?d.planting=!d.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case Te.ToggleProcreationBehavior:d.procreation=!d.procreation;break;case Te.ToggleAttackBehavior:d.attack=!d.attack;break;case Te.ToggleFeedChildBehavior:d.feedChildren=!d.feedChildren;break;case Te.CommandTribeSplit:a&&rT(a,n);break;case Te.CommandBuild:t?d.build=!d.build:n.buildMenuOpen=!n.buildMenuOpen;break;case Te.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case Te.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case Te.SelectRemovalTool:n.selectedBuildingType="removal";break;case Te.SelectBorderPost:n.selectedBuildingType="borderPost";break;case Te.SelectBonfire:n.selectedBuildingType="bonfire";break;case Te.SelectPalisade:n.selectedBuildingType="palisade";break;case Te.SelectGate:n.selectedBuildingType="gate";break;case Te.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const p=a.leaderId,m=e.targetTribeId,S=n.entities.entities[m],v=(u=a.tribeControl)==null?void 0:u.diplomacy,A=(h=S==null?void 0:S.tribeControl)==null?void 0:h.diplomacy;if(v&&A){const w=(v[m]||Rt.Friendly)===Rt.Friendly?Rt.Hostile:Rt.Friendly;v[m]=w,A[p]=w}}break;case Te.OpenTribeModal:n.tribeModalOpen=!0;break;case Te.RecenterCamera:n.cameraFollowingPlayer=!0;break;case Te.CloseTribeModal:n.tribeModalOpen=!1;break}return n};function SN(e,t,n){if(!e.notificationButtonRects)return!1;const o=bt(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return ME(e,s),o&&ke({gameState:e},_e.ButtonClick,o.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const c=e.notifications.find(d=>d.id===s);if(c){let d=c.targetPosition;if(!d&&c.targetEntityIds&&c.targetEntityIds.length>0){const u=e.entities.entities[c.targetEntityIds[0]];u&&(d=u.position)}return d&&yN(e,d),o&&ke({gameState:e},_e.ButtonClick,o.position),c.highlightedEntityIds&&(c.renderHighlights=!c.renderHighlights),!0}}return!1}function oI(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const TN=(e,t)=>{var n;if(t.debugPanel!==qe.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(oI(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},IN=(e,t)=>t.debugPanel!==qe.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:oI(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Sv=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},AN=(e,t)=>{var n,o;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const c=t.debugPanelRect.height-60,d=Math.max(0,(((o=t.debugPanelContentSize)==null?void 0:o.height)??0)-c);return t.debugPanelScroll.y>d&&(t.debugPanelScroll.y=d),{newState:t,handled:!0}}return{newState:t,handled:!1}};function wN(e,t,n){if(!n.minimapRect)return;const{x:o,y:s,width:a,height:c}=n.minimapRect;e>=o&&e<=o+a&&t>=s&&t<=s+c&&(n.isDraggingMinimap=!0,n.minimapDragDistance=0)}function EN(e,t,n,o){n.isDraggingMinimap&&(n.isDraggingMinimap=!1,n.minimapDragDistance<5&&PN(e,t,n,o,!1))}function CN(e,t,n,o,s){if(!n.minimapRect){n.hoveredMinimapTribeId=null;return}if(n.isDraggingMinimap){if(o){n.minimapDragDistance+=Math.sqrt(o.x*o.x+o.y*o.y),n.cameraFollowingPlayer=!1,n.cameraTargetPosition=void 0;const{width:c,height:d}=n.mapDimensions,{width:u,height:h}=n.minimapRect,p=o.x/u*c,m=o.y/h*d,S=n.viewportCenter.x-p,v=n.viewportCenter.y-m,A={x:(S%c+c)%c,y:(v%d+d)%d};n.viewportCenter=A,s&&(s.current=A)}return}const a=rI(e,t,n.minimapRect,n);a?n.hoveredMinimapTribeId=li(a.x,a.y,n):n.hoveredMinimapTribeId=null}function PN(e,t,n,o,s=!1){if(!n.minimapRect)return;const a=rI(e,t,n.minimapRect,n);a&&(n.cameraFollowingPlayer=!1,s?(n.viewportCenter=a,n.cameraTargetPosition=void 0,o&&(o.current=a)):n.cameraTargetPosition=a)}function _N(e,t,n,o,s){if(!o.minimapRect)return!1;const{x:a,y:c,width:d,height:u}=o.minimapRect;if(t>=a&&t<=a+d&&n>=c&&n<=c+u){o.cameraFollowingPlayer=!1,o.cameraTargetPosition=void 0;const{width:h,height:p}=o.mapDimensions,m=e.deltaX/d*h,S=e.deltaY/u*p,v=o.viewportCenter.x+m,A=o.viewportCenter.y+S,T={x:(v%h+h)%h,y:(A%p+p)%p};return o.viewportCenter=T,s&&(s.current=T),!0}return!1}function rI(e,t,n,o){const s=e-n.x,a=t-n.y;if(s<0||s>n.width||a<0||a>n.height)return null;const{width:c,height:d}=o.mapDimensions,u=n.width/2,h=n.height/2,p=s-u,m=a-h,S=p/n.width*c,v=m/n.height*d,A=o.viewportCenter.x+S,T=o.viewportCenter.y+v;return{x:(A%c+c)%c,y:(T%d+d)%d}}function RN(e,t,n){t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,a=t.viewportCenter.x+e.deltaX,c=t.viewportCenter.y+e.deltaY,d={x:(a%o+o)%o,y:(c%s+s)%s};return t.viewportCenter=d,n.current=d,!0}function kN(e,t){(e.button===1||e.button===2)&&(t.isDraggingViewport=!0,t.viewportDragButton=e.button,t.viewportDragDistance=0)}function MN(e,t,n){if(t.isDraggingViewport){t.viewportDragDistance+=Math.sqrt(e.movementX*e.movementX+e.movementY*e.movementY),t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,a=t.viewportCenter.x-e.movementX,c=t.viewportCenter.y-e.movementY,d={x:(a%o+o)%o,y:(c%s+s)%s};t.viewportCenter=d,n.current=d}}function bN(e,t){t.isDraggingViewport&&e.button===t.viewportDragButton&&(t.isDraggingViewport=!1,t.viewportDragButton=null)}const DN=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:a,returnToIntro:c})=>(te.useEffect(()=>{const d=u=>{if(!e()||t.current.gameOver||!n.current)return;const h=n.current.getBoundingClientRect(),p=u.clientX-h.left,m=u.clientY-h.top;if(_N(u,p,m,t.current,o)){u.preventDefault();return}const S=TN(u,t.current);t.current=S.newState,!S.handled&&RN(u,t.current,o)&&u.preventDefault()};return window.addEventListener("wheel",d,{passive:!1}),()=>{window.removeEventListener("wheel",d)}},[e,n,t,o]),te.useEffect(()=>{const d=h=>{if(!e()||t.current.gameOver||!n.current||!h.target||h.target!==n.current)return;const p=n.current.getBoundingClientRect(),m=h.clientX-p.left,S=h.clientY-p.top;if(SN(t.current,m,S))return;const A=t.current.uiButtons.find(C=>m>=C.rect.x&&m<=C.rect.x+C.rect.width&&S>=C.rect.y&&S<=C.rect.y+C.rect.height);if(A){t.current=vN(A,h.shiftKey,t.current,c);return}const T=t.current.minimapRect;if(T&&m>=T.x&&m<=T.x+T.width&&S>=T.y&&S<=T.y+T.height){wN(m,S,t.current);return}const w=IN(h,t.current);if(t.current=w.newState,w.handled)return;kN(h,t.current);const E=zh({x:m,y:S},o.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);fN(t.current,E)},u=h=>{if(!e()||!n.current)return;const p=n.current.getBoundingClientRect(),m=h.clientX-p.left,S=h.clientY-p.top;EN(m,S,t.current,o),bN(h,t.current);const v=Sv(h,t.current);t.current=v.newState};return window.addEventListener("mousedown",d),window.addEventListener("mouseup",u),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("mouseup",u)}},[e,n,t,o,c]),te.useEffect(()=>{const d=u=>{if(!e()||!n.current)return;const h=AN(u,t.current);if(t.current=h.newState,h.handled)return;if(t.current.isDraggingDebugPanel&&(u.buttons&1)===0){const E=Sv(u,t.current);t.current=E.newState}const p=n.current.getBoundingClientRect(),m=u.clientX-p.left,S=u.clientY-p.top;MN(u,t.current,o),t.current.mousePosition={x:m,y:S};let v;if(t.current.notificationButtonRects){for(const[E,C]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=C.x&&m<=C.x+C.width&&S>=C.y&&S<=C.y+C.height){v=`notification-dismiss-${E}`;break}if(!v){for(const[E,C]of Object.entries(t.current.notificationButtonRects.view))if(m>=C.x&&m<=C.x+C.width&&S>=C.y&&S<=C.y+C.height){v=`notification-view-${E}`;break}}}if(!v)for(let E=t.current.uiButtons.length-1;E>=0;E--){const C=t.current.uiButtons[E];if(m>=C.rect.x&&m<=C.rect.x+C.rect.width&&S>=C.rect.y&&S<=C.rect.y+C.rect.height){v=C.id;break}}if(t.current.hoveredButtonId=v,v){t.current.autopilotControls.hoveredAutopilotAction=void 0,t.current.hoveredMinimapTribeId=null;return}const A=t.current.minimapRect,T=t.current.isDraggingMinimap;if(A&&m>=A.x&&m<=A.x+A.width&&S>=A.y&&S<=A.y+A.height||T){CN(m,S,t.current,{x:u.movementX,y:u.movementY},o),t.current.autopilotControls.hoveredAutopilotAction=void 0;return}else t.current.hoveredMinimapTribeId=null;const w=bt(t.current);if(w){const E=zh({x:m,y:S},o.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=dN(E,w,t.current,u.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",d),()=>{window.removeEventListener("mousemove",d)}},[e,n,t,o]),te.useEffect(()=>{const d=h=>{if(!e()||t.current.gameOver)return;const p=h.key.toLowerCase();(p===" "||p==="p"||p==="tab"||(h.ctrlKey||h.metaKey)&&(p==="s"||p==="a"))&&h.preventDefault();const m=hN(h,t.current);if(t.current=m.newState,m.handled)return;const S=bt(t.current);S&&(a.current.add(p),pN(p,h.shiftKey,t.current,S,s.current))},u=h=>{if(!e()||t.current.gameOver)return;const p=h.key.toLowerCase();a.current.delete(p);const m=bt(t.current);m&&gN(p,m,t.current,a)};return window.addEventListener("keydown",d),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",d),window.removeEventListener("keyup",u)}},[e,t,s,a,c]),te.useEffect(()=>{const d=n.current;if(!d)return;const u=h=>{e()&&h.preventDefault()};return d.addEventListener("contextmenu",u),()=>{d.removeEventListener("contextmenu",u)}},[n,e]),null),ON=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:a,canvasRef:c,setAppState:d,appState:u})=>{const h=te.useRef(),{returnToIntro:p}=Ci(),[m,S,v]=rp(A=>{var M,P;if(!t.current||!h.current){h.current=A;return}const T=Math.min(A-h.current,1e3)/1e3,{performanceMetrics:w}=e.current;w.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const E=performance.now();e.current=Vu(e.current,T),w.currentBucket.worldUpdateTime=performance.now()-E;const C=bt(e.current);C?s.current=kp(e.current,C):s.current=[],(e.current.viewportCenter.x!==o.current.x||e.current.viewportCenter.y!==o.current.y)&&(o.current=e.current.viewportCenter),o.current=mN(e.current,o.current,T),e.current.viewportCenter=o.current;const _=performance.now();wu(t.current,e.current,o.current,s.current,{width:((M=c.current)==null?void 0:M.width)||800,height:((P=c.current)==null?void 0:P.height)||600},!1),w.currentBucket.renderTime=performance.now()-_,w.history.push({bucketTime:e.current.time,...w.currentBucket}),w.history.length>U1&&w.history.shift(),h.current=A,e.current.gameOver&&u!=="gameOver"&&(Pp(_e.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),d("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))},!1);return te.useEffect(()=>(S(),m),[S,m]),X.jsx(DN,{isActive:v,gameStateRef:e,canvasRef:c,viewportCenterRef:o,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:p})},Tv=()=>{const{savedGameState:e,contextReady:t}=Ci(),[n,o]=te.useState(null);return te.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),o(e)):(console.log("Initializing new game state..."),o(cN())))},[t,e]),!t||!n?X.jsx("div",{children:"Loading..."}):X.jsx(NN,{initialState:n})},NN=({initialState:e})=>{const t=te.useRef(null),n=te.useRef(null),o=te.useRef(e),s=te.useRef(new Set),a=te.useRef(e.debugPanel),c=te.useRef(e.viewportCenter),d=te.useRef([]),{appState:u,setAppState:h}=Ci();return X.jsxs(X.Fragment,{children:[X.jsx(uN,{canvasRef:t,ctxRef:n,gameStateRef:o,debugPanelTypeRef:a,viewportCenterRef:c,playerActionHintsRef:d}),X.jsx(ON,{gameStateRef:o,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:c,playerActionHintsRef:d,keysPressed:s,canvasRef:t,setAppState:h,appState:u})]})},BN=Ne.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,HN=Ne.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Xc=Ne.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,FN=Ne.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,LN=()=>{const{setAppState:e,gameOverDetails:t}=Ci(),n=()=>{e("intro")};return X.jsxs(BN,{children:[X.jsx(HN,{children:"Game Over"}),X.jsx(Xc,{children:"Your tribe's lineage has ended."}),t&&X.jsxs(X.Fragment,{children:[X.jsxs(Xc,{children:["Generations Survived: ",t.generations]}),X.jsxs(Xc,{children:["Cause of Extinction: ",t.cause]})]}),!t&&X.jsx(Xc,{children:"Game details are unavailable."}),X.jsx(FN,{onClick:n,children:"Return to Menu"})]})},xN=Ne.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,UN=Ne.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,GN=Ne.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,$N=Ne.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,WN=Ne.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,sI=Ne.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,YN=Ne(sI)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,ba=800,Da=600,zN=()=>{const{returnToIntro:e}=Ci(),t=te.useRef(null),n=te.useRef(),o=te.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:ba,height:Da}}),s=c=>{const d={x:ba/2,y:Da/2};let u;c===Pe.StoneProjectile&&(u={x:d.x+200*(Math.random()-Math.random()),y:d.y+200*(Math.random()-Math.random())}),Fe(o.current,c,d,1,void 0,u)};te.useEffect(()=>{const c=()=>{o.current.time+=.016,Hp(o.current);const u=t.current,h=u==null?void 0:u.getContext("2d");h&&(h.clearRect(0,0,ba,Da),h.fillStyle="#2c5234",h.fillRect(0,0,ba,Da),o.current.visualEffects.forEach(p=>{tI(h,p,o.current.time,o.current)})),n.current=requestAnimationFrame(c)};return n.current=requestAnimationFrame(c),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(Pe).filter(c=>isNaN(Number(c))).map(c=>({name:c,value:Pe[c]}));return X.jsxs(xN,{children:[X.jsxs(UN,{children:[X.jsx(WN,{children:"Visual Effects"}),a.map(c=>X.jsx(sI,{onClick:()=>s(c.value),children:c.name},c.name)),X.jsx(YN,{onClick:e,children:"Back to Intro"})]}),X.jsxs(GN,{children:[X.jsx($N,{ref:t,width:ba,height:Da}),X.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},jN=Ne.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,XN=Ne.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,VN=Ne.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,qN=Ne.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,ZN=Ne.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,Iv=Ne.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,jh=Ne.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,KN=Ne(jh)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,QN=Ne.label`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  cursor: pointer;

  input {
    margin-right: 8px;
  }
`,$n=800,Wn=600,JN=(e,t)=>{const n=e.reduce((s,a)=>(s[a.id]=a,s),{});n[1]={id:1,type:"human",leaderId:1,isPlayer:!0,tribeInfo:{tribeBadge:"",tribeColor:"#4CAF50"},position:{x:0,y:0},radius:10,isAdult:!0,gender:"male",age:25},n[2]={id:2,type:"human",leaderId:2,isPlayer:!1,tribeInfo:{tribeBadge:"",tribeColor:"#F44336"},position:{x:0,y:0},radius:10,isAdult:!0,gender:"male",age:30,tribeControl:{diplomacy:{1:"Hostile"}}};const o={time:0,mapDimensions:{width:$n,height:Wn},entities:{entities:n},terrainOwnership:t,notifications:[],visualEffects:[],tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[]},plantingZoneConnections:{}};return o.search={building:{all:()=>e,byRadius:(s,a)=>e.filter(c=>J(s,c.position,$n,Wn)<=a),byRect:()=>e,byProperty:(s,a)=>e.filter(c=>c[s]===a)},human:{all:()=>[n[1],n[2]],byProperty:(s,a)=>Object.values(n).filter(c=>c.type==="human"&&c[s]===a),byRadius:()=>[],byRect:()=>Object.values(n).filter(s=>s.type==="human")},berryBush:{byRect:()=>[],all:()=>[]},tree:{byRect:()=>[],all:()=>[]},corpse:{byRect:()=>[],all:()=>[]},prey:{byRect:()=>[],all:()=>[]},predator:{byRect:()=>[],all:()=>[]},tasks:{byRect:()=>[],all:()=>[]}},o},e2=(e,t,n,o)=>{const s=It[t];return{id:e,type:"building",buildingType:t,position:n,ownerId:o,constructionProgress:1,destructionProgress:0,isConstructed:!0,isBeingDestroyed:!1,width:s.dimensions.width,height:s.dimensions.height,storedItems:[],storageCapacity:10,radius:Math.max(s.dimensions.width,s.dimensions.height)/2,direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Oe.create()}},t2=()=>{const{returnToIntro:e}=Ci(),t=te.useRef(null),n=te.useRef(),[o,s]=te.useState(q.Palisade),[a,c]=te.useState(!1),[d,u]=te.useState([]),[h,p]=te.useState(null),[m,S]=te.useState(10),[v,A]=te.useState(new Array(Math.ceil($n/Ae)*Math.ceil(Wn/Ae)).fill(null)),T=te.useCallback((_,M)=>{const P=Se;return{x:Math.round(_/P)*P,y:Math.round(M/P)*P}},[]),w=te.useCallback(_=>{const M=t.current;if(!M)return;const P=M.getBoundingClientRect(),k=_.clientX-P.left,R=_.clientY-P.top,H=T(k,R);if(!d.some(F=>Math.abs(F.position.x-H.x)<5&&Math.abs(F.position.y-H.y)<5)){const F=a?2:1,Y=e2(m,o,H,F),Z=[...v],W={mapDimensions:{width:$n,height:Wn},terrainOwnership:Z},j=o===q.BorderPost?Eu:Ki;rl(H,j,F,W),A(Z),o!==q.BorderPost&&u(ee=>[...ee,Y]),S(ee=>ee+1)}},[o,a,m,T,d,v]),E=te.useCallback(_=>{const M=t.current;if(!M)return;const P=M.getBoundingClientRect(),k=_.clientX-P.left,R=_.clientY-P.top;p(T(k,R))},[T]),C=te.useCallback(()=>{u([]),S(10),A(new Array(Math.ceil($n/Ae)*Math.ceil(Wn/Ae)).fill(null))},[]);return te.useEffect(()=>{const _=()=>{const M=t.current,P=M==null?void 0:M.getContext("2d");if(!P)return;const k={x:$n/2,y:Wn/2},R=JN(d,v);P.fillStyle="#2c5234",P.fillRect(0,0,$n,Wn),$p(P,R,k,{width:$n,height:Wn},1),iI(P,R,k,1),P.strokeStyle="rgba(255,255,255,0.05)",P.lineWidth=1;for(let H=0;H<=$n;H+=Se)P.beginPath(),P.moveTo(H,0),P.lineTo(H,Wn),P.stroke();for(let H=0;H<=Wn;H+=Se)P.beginPath(),P.moveTo(0,H),P.lineTo($n,H),P.stroke();for(const H of d)H.buildingType!==q.PlantingZone&&Up(P,H,R);h&&Gp(P,h,o,!0,{width:$n,height:Wn}),n.current=requestAnimationFrame(_)};return n.current=requestAnimationFrame(_),()=>{n.current&&cancelAnimationFrame(n.current)}},[d,h,o,v]),X.jsxs(jN,{children:[X.jsxs(XN,{children:[X.jsx(ZN,{children:"Building Test"}),X.jsx(Iv,{children:"Settings"}),X.jsxs(QN,{children:[X.jsx("input",{type:"checkbox",checked:a,onChange:_=>c(_.target.checked)}),"Show as Hostile"]}),X.jsx(Iv,{children:"Building Type"}),Object.values(q).map(_=>X.jsxs(jh,{onClick:()=>s(_),style:{backgroundColor:o===_?"#666":"#444",borderLeft:o===_?"3px solid #4CAF50":"none"},children:[It[_].icon," ",It[_].name]},_)),X.jsx(jh,{onClick:C,style:{backgroundColor:"#a33",marginTop:"20px",textAlign:"center"},children:" Clear All"}),X.jsx(KN,{onClick:e,children:"Back to Intro"})]}),X.jsxs(VN,{children:[X.jsx(qN,{ref:t,width:$n,height:Wn,onClick:w,onMouseMove:E,onMouseLeave:()=>p(null),style:{cursor:"crosshair"}}),X.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Click to place buildings. Test palisade connectivity by placing them adjacent to each other."})]})]})},n2=Ne.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,i2=Ne.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,o2=Ne.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,r2=Ne.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,s2=Ne.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,Oa=Ne.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,Tn=Ne.button`
  background-color: ${e=>e.active?"#666":"#444"};
  color: white;
  border: ${e=>e.active?"2px solid #4CAF50":"none"};
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: center;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`,Av=Ne.div`
  display: flex;
  flex-direction: column;
  margin-bottom: 15px;

  label {
    font-size: 0.8rem;
    color: #aaa;
    margin-bottom: 5px;
  }
`,a2=Ne(Tn)`
  background-color: #833;
  margin-top: auto;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,wo=Ne.p`
  font-size: 0.9rem;
  color: #888;
  margin: 5px 0;
`,bn=800,Dn=600,l2=()=>{const e=Math.ceil(bn/Ae)*Math.ceil(Dn/Ae);return{time:0,mapDimensions:{width:bn,height:Dn},entities:{entities:{},nextEntityId:2},navigationGrid:$u(bn,Dn),soilDepletion:ap(),temperature:{sectors:{}},pathfindingQueue:[],notifications:[],visualEffects:[],nextVisualEffectId:1,tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[],currentStepIndex:0,completedSteps:[],transitionAlpha:0,transitionState:Jt.INACTIVE,stepStartTime:null},plantingZoneConnections:{},terrainOwnership:new Array(e).fill(null),performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!1,build:!1,chopping:!1},isManuallyMoving:!1},ecosystem:{lastUpdateTime:0,preyGestationPeriod:24,preyProcreationCooldown:48,predatorGestationPeriod:36,predatorProcreationCooldown:72,preyHungerIncreasePerHour:.1,predatorHungerIncreasePerHour:.1,berryBushSpreadChance:.01,treeSpreadChance:.005},tasks:{},scheduledEvents:[],nextScheduledEventId:1,generationCount:1,gameOver:!1,viewportCenter:{x:bn/2,y:Dn/2},isPaused:!1,exitConfirmation:"inactive",buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!1,cameraZoom:1,masterVolume:1,isMuted:!1,uiButtons:[],tutorial:{steps:[]},lastAutosaveTime:Date.now(),autosaveIntervalSeconds:0,debugPanel:qe.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null}},c2=()=>{var me;const{returnToIntro:e}=Ci(),t=te.useRef(null),[n]=te.useState(l2()),[o,s]=te.useState(null),[a,c]=te.useState(null),[d,u]=te.useState(null),[h,p]=te.useState(0),[m,S]=te.useState("tree"),[v,A]=te.useState(null),[T,w]=te.useState(1),[E,C]=te.useState(1),[_,M]=te.useState([]),[P,k]=te.useState(null),[R,H]=te.useState(null),[G,F]=te.useState(!1),[Y,Z]=te.useState(1),[W,j]=te.useState(Ts),ee=te.useRef(0),se=te.useCallback((de,le)=>({x:Math.round(de/Se)*Se,y:Math.round(le/Se)*Se}),[]);te.useEffect(()=>{n.navigationGrid=$u(bn,Dn),n.entities.entities={},n.entities.nextEntityId=100;for(const de of _){let le;if(de.type==="tree")le=wr;else{const ce=It[de.type].dimensions;le=Math.max(ce.width,ce.height)/2}const ge=de.type===q.Gate?de.ownerId??null:null;if((de.type===q.Palisade||de.type===q.Gate||de.type==="tree")&&Is(n,de.pos,le,!0,ge,W),de.type==="tree")Es(n.entities,de.pos,n.time,100);else{const ce=LT(n.entities,de.pos,de.type,de.ownerId||0);ce.isConstructed=!0}}if(o&&a){const de={leaderId:E},{path:le,iterations:ge}=aT(n,o,a,de);u(le),p(ge)}},[_,W,o,a,E,n]);const ae=te.useCallback(de=>{const le=t.current;if(!le)return;const ge=le.getBoundingClientRect(),x=de.clientX-ge.left,ce=de.clientY-ge.top,pe=se(x,ce);if(m==="start")s(pe);else if(m==="end")c(pe);else if(m==="palisadeLine")if(!P)k(pe);else{const we=J(P,pe,bn,Dn),K=Le(P,pe,bn,Dn),$e=mt(K),xe=Math.ceil(we/20),He=[];for(let ct=0;ct<=xe;ct++){const Ct=jn(P,lt($e,ct*20)),At=se(Ct.x,Ct.y);!_.some(it=>it.pos.x===At.x&&it.pos.y===At.y)&&!He.some(it=>it.pos.x===At.x&&it.pos.y===At.y)&&He.push({pos:At,type:q.Palisade,ownerId:null})}M(ct=>[...ct,...He]),k(null)}else{const we=_.findIndex(K=>K.pos.x===pe.x&&K.pos.y===pe.y);if(we!==-1){const K=_[we];m!==K.type&&(m==="tree"||Object.values(q).includes(m))?M($e=>{const xe=[...$e];return xe[we]={pos:pe,type:m,ownerId:m===q.Gate?T:null},xe}):M($e=>$e.filter((xe,He)=>He!==we))}else M(K=>[...K,{pos:pe,type:m,ownerId:m===q.Gate?T:null}])}},[m,se,T,_,P]),Q=()=>{if(o&&a){R&&Ei(n.entities,R.id);const de=ar(n.entities,o,n.time,"male",!1,25,0,void 0,void 0,[],E,{tribeBadge:"",tribeColor:"#4A90E2"});de.target=a,de.activeAction="moving",de.stateMachine=[Si,{enteredAt:n.time}],n.pathfindingQueue.includes(de.id)||n.pathfindingQueue.push(de.id),H(de),F(!0)}},re=()=>{R&&Ei(n.entities,R.id),H(null),F(!1)},[ne,D]=rp(de=>{if(ee.current===0){ee.current=de;return}const le=(de-ee.current)/1e3;if(ee.current=de,!G||!R)return;n.entities.entities[R.id]||(n.entities.entities[R.id]=R);let ge=le*Y;const x=1/60;let ce=n;for(;ge>0;){const we=hl(ce),K=Math.min(ge,x),$e=K*(Mt/Ft);we.time+=$e,HT({gameState:we,deltaTime:K}),$T({gameState:we,deltaTime:K}),VT(we),Hp(we),ce=we,ge-=K}ce!==n&&Object.assign(n,ce);const pe=n.entities.entities[R.id];pe&&H({...pe})});te.useEffect(()=>(D(),()=>ne()),[D,ne]);const z=te.useCallback(de=>{const le=t.current;if(!le)return;const ge=le.getBoundingClientRect(),x=de.clientX-ge.left,ce=de.clientY-ge.top;A(se(x,ce))},[se]),he=te.useCallback(()=>{s(null),c(null),u(null),p(0),R&&Ei(n.entities,R.id),H(null),F(!1),M([]),k(null),n.pathfindingQueue=[]},[n,R]);return te.useEffect(()=>{const le=requestAnimationFrame(()=>{const ge=t.current,x=ge==null?void 0:ge.getContext("2d");if(!x)return;x.fillStyle="#2c5234",x.fillRect(0,0,bn,Dn),x.strokeStyle="rgba(255,255,255,0.05)",x.lineWidth=1;for(let K=0;K<=bn;K+=Se)x.beginPath(),x.moveTo(K,0),x.lineTo(K,Dn),x.stroke();for(let K=0;K<=Dn;K+=Se)x.beginPath(),x.moveTo(0,K),x.lineTo(bn,K),x.stroke();const ce=Math.ceil(bn/Se),pe=Math.ceil(Dn/Se);for(let K=0;K<pe;K++)for(let $e=0;$e<ce;$e++){const xe=K*ce+$e,He=!Ar(n.navigationGrid,xe,E,!1),ct=!Ar(n.navigationGrid,xe,E,!0);He?(x.fillStyle="rgba(244, 67, 54, 0.5)",x.fillRect($e*Se,K*Se,Se,Se)):ct?(x.fillStyle="rgba(33, 150, 243, 0.3)",x.fillRect($e*Se,K*Se,Se,Se)):n.navigationGrid.obstacleCount[xe]>0&&(x.fillStyle="rgba(76, 175, 80, 0.3)",x.fillRect($e*Se,K*Se,Se,Se))}x.font="16px Arial",x.textAlign="center",x.textBaseline="middle";for(const K of _){let $e="";K.type==="tree"?$e="":$e=It[K.type].icon,$e&&x.fillText($e,K.pos.x,K.pos.y)}const we=(R==null?void 0:R.path)||d;if(we&&we.length>1){x.strokeStyle=R?"rgba(0, 255, 0, 0.3)":"#00FF00",x.setLineDash(R?[5,5]:[]),x.lineWidth=2,x.beginPath(),x.moveTo(we[0].x,we[0].y);for(let K=1;K<we.length;K++)x.lineTo(we[K].x,we[K].y);x.stroke(),x.setLineDash([]),x.fillStyle="#00FF00";for(const K of we)x.beginPath(),x.arc(K.x,K.y,2,0,Math.PI*2),x.fill()}if(o&&(x.fillStyle="#00FF00",x.beginPath(),x.arc(o.x,o.y,8,0,Math.PI*2),x.fill(),x.fillStyle="white",x.font="10px Arial",x.fillText("START",o.x,o.y-12)),a&&(x.fillStyle="#FF0000",x.beginPath(),x.arc(a.x,a.y,8,0,Math.PI*2),x.fill(),x.fillStyle="white",x.font="10px Arial",x.fillText("END",a.x,a.y-12)),R){const{position:K,direction:$e,path:xe}=R;x.fillStyle="#4A90E2",x.beginPath(),x.arc(K.x,K.y,ht/3,0,Math.PI*2),x.fill(),x.strokeStyle="white",x.stroke(),x.strokeStyle="white",x.lineWidth=2,x.beginPath(),x.moveTo(K.x,K.y),x.lineTo(K.x+$e.x*20,K.y+$e.y*20),x.stroke();const He=xe&&xe.length>0?xe[0]:null;if(He){x.strokeStyle="#FFEB3B",x.setLineDash([2,2]),x.beginPath(),x.moveTo(K.x,K.y),x.lineTo(He.x,He.y),x.stroke(),x.setLineDash([]),x.fillStyle="#FFEB3B",x.beginPath(),x.arc(He.x,He.y,4,0,Math.PI*2),x.fill();const it=Le(K,He,bn,Dn),Xt=Math.sqrt(it.x*it.x+it.y*it.y);if(Xt>.001){const wn=it.x/Xt,Ds=-(it.y/Xt),Os=wn,Ns=ht;x.strokeStyle="rgba(255, 255, 255, 0.2)",x.lineWidth=1,[Ns,-30,Ns*.5,-15].forEach(Uo=>{x.beginPath(),x.moveTo(K.x+Ds*Uo,K.y+Os*Uo),x.lineTo(He.x+Ds*Uo,He.y+Os*Uo),x.stroke()})}}const ct=mt($e),Ct=ru(ct,-Wa),At=ru(ct,Wa);[ct,Ct,At].forEach((it,Xt)=>{const wn=jn(K,lt(it,Nh));x.strokeStyle=Xt===0?"rgba(255,255,255,0.5)":"rgba(255,255,255,0.2)",x.beginPath(),x.moveTo(K.x,K.y),x.lineTo(wn.x,wn.y),x.stroke()})}if(P&&v&&(x.strokeStyle="rgba(255, 255, 255, 0.5)",x.setLineDash([5,5]),x.beginPath(),x.moveTo(P.x,P.y),x.lineTo(v.x,v.y),x.stroke(),x.setLineDash([])),v){let K="";m==="tree"?K="":m==="start"?K="":m==="end"?K="":m==="palisadeLine"?K=It[q.Palisade].icon:Object.values(q).includes(m)&&(K=It[m].icon),K&&(x.globalAlpha=.5,x.fillText(K,v.x,v.y),x.globalAlpha=1)}});return()=>cancelAnimationFrame(le)},[n,o,a,d,v,m,R,_,E,P]),X.jsxs(n2,{children:[X.jsxs(i2,{children:[X.jsx(s2,{children:"Navigation Debug"}),X.jsx(Oa,{children:"Placement Mode"}),X.jsx(Tn,{active:m==="start",onClick:()=>{S("start"),k(null)},children:" Start Point"}),X.jsx(Tn,{active:m==="end",onClick:()=>{S("end"),k(null)},children:" End Point"}),X.jsxs(Tn,{active:m==="tree",onClick:()=>{S("tree"),k(null)},children:[" Tree (Radius ",wr,")"]}),Object.entries(It).map(([de,le])=>X.jsxs(Tn,{active:m===de,onClick:()=>{S(de),k(null)},children:[le.icon," ",le.name," (",le.dimensions.width,"x",le.dimensions.height,")"]},de)),X.jsx(Tn,{active:m==="palisadeLine",onClick:()=>{S("palisadeLine"),k(null)},children:" Palisade Line"}),X.jsx(Oa,{children:"Gate Ownership"}),X.jsx(Tn,{active:T===1,onClick:()=>w(1),children:" Player (ID: 1)"}),X.jsx(Tn,{active:T===2,onClick:()=>w(2),children:" Enemy (ID: 2)"}),X.jsx(Oa,{children:"Human Tribe"}),X.jsx(Tn,{active:E===1,onClick:()=>C(1),children:" Player (ID: 1)"}),X.jsx(Tn,{active:E===2,onClick:()=>C(2),children:" Enemy (ID: 2)"}),X.jsx(Oa,{children:"Simulation"}),X.jsx(Tn,{onClick:Q,disabled:!o||!a,children:" Spawn Human"}),X.jsx(Tn,{onClick:()=>F(!G),active:G,children:G?" Pause":" Play"}),X.jsx(Tn,{onClick:re,style:{backgroundColor:"#555"},children:" Reset Human"}),X.jsxs(Av,{children:[X.jsxs("label",{children:["Sim Speed: ",Y.toFixed(1),"x"]}),X.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.1",value:Y,onChange:de=>Z(parseFloat(de.target.value))})]}),X.jsxs(Av,{children:[X.jsxs("label",{children:["Obstacle Padding: ",W,"px"]}),X.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:W,onChange:de=>j(parseInt(de.target.value))})]}),X.jsx(Oa,{children:"Info"}),X.jsxs(wo,{children:["Grid: ",Se,"px"]}),X.jsxs(wo,{children:["Path Nodes: ",((me=R==null?void 0:R.path)==null?void 0:me.length)||(d==null?void 0:d.length)||0]}),X.jsxs(wo,{children:["A* Iterations: ",h]}),X.jsxs(wo,{children:["Action: ",(R==null?void 0:R.activeAction)||"idle"]}),X.jsxs(wo,{children:["Accel: ",(R==null?void 0:R.acceleration.toFixed(2))||"0.00"]}),X.jsxs(wo,{children:["Status:"," ",(R==null?void 0:R.activeAction)==="moving"&&R.acceleration===0?" STUCK":(R==null?void 0:R.activeAction)==="idle"||(R==null?void 0:R.stateMachine[0])===ft?" REACHED":R?" Moving":" Idle"]}),X.jsx(wo,{style:{fontSize:"0.75rem",color:"#666",marginTop:"10px"},children:"Note: Click any tool on an existing object to replace or remove it. Use Palisade Line for multi-segment walls."}),X.jsx(Tn,{onClick:he,style:{backgroundColor:"#a33",marginTop:"20px"},children:" Clear All"}),X.jsx(a2,{onClick:e,children:"Back to Intro"})]}),X.jsxs(o2,{children:[X.jsx(r2,{ref:t,width:bn,height:Dn,onClick:ae,onMouseMove:z,onMouseLeave:()=>A(null),style:{cursor:"crosshair"}}),X.jsx(wo,{style:{marginTop:"10px",textAlign:"center"},children:"Place Trees and Buildings to test pathfinding. Only Palisades and Gates physically block movement. Adjust padding to see how it affects real game navigation logic."})]})]})},u2=Ne.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,d2=Ne.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,f2=Ne.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,h2=Ne.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,p2=Ne.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,Vc=Ne.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,is=Ne.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,g2=Ne(is)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,Th=Ne.label`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  cursor: pointer;

  input {
    margin-right: 8px;
  }
`,Ih=Ne.p`
  font-size: 0.85rem;
  color: #888;
  margin: 5px 0;
`,dn=800,fn=600,Ah=(e,t)=>{const n=e.reduce((s,a)=>(s[a.id]=a,s),{});n[1]={id:1,type:"human",leaderId:1,isPlayer:!0,tribeInfo:{tribeBadge:"",tribeColor:"#4CAF50"},position:{x:dn/2,y:fn/2},radius:10,isAdult:!0,gender:"male",age:25};const o={time:0,mapDimensions:{width:dn,height:fn},entities:{entities:n},terrainOwnership:t,notifications:[],visualEffects:[],tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[]},plantingZoneConnections:{}};return o.search={building:{all:()=>e,byRadius:(s,a)=>e.filter(c=>J(s,c.position,dn,fn)<=a),byRect:()=>e,byProperty:(s,a)=>e.filter(c=>c[s]===a)},human:{all:()=>[n[1]],byProperty:()=>[],byRadius:()=>[],byRect:()=>[n[1]]},berryBush:{byRect:()=>[],all:()=>[]},tree:{byRect:()=>[],all:()=>[]},corpse:{byRect:()=>[],all:()=>[]},prey:{byRect:()=>[],all:()=>[]},predator:{byRect:()=>[],all:()=>[]},tasks:{byRect:()=>[],all:()=>[]}},o},wv=(e,t,n,o)=>{const s=It[t];return{id:e,type:"building",buildingType:t,position:n,ownerId:o,constructionProgress:1,destructionProgress:0,isConstructed:!0,isBeingDestroyed:!1,width:s.dimensions.width,height:s.dimensions.height,storedItems:[],storageCapacity:10,radius:Math.max(s.dimensions.width,s.dimensions.height)/2,direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Oe.create()}},m2=()=>{const{returnToIntro:e}=Ci(),t=te.useRef(null),n=te.useRef(),[o,s]=te.useState(q.Palisade),[a,c]=te.useState([]),[d,u]=te.useState(null),[h,p]=te.useState(10),[m,S]=te.useState(!0),[v,A]=te.useState(!1),[T,w]=te.useState(!0),[E,C]=te.useState(new Array(Math.ceil(dn/Ae)*Math.ceil(fn/Ae)).fill(null)),_=te.useCallback((H,G)=>{const F=Se;return{x:Math.round(H/F)*F,y:Math.round(G/F)*F}},[]),M=te.useCallback(H=>{const G=t.current;if(!G)return;const F=G.getBoundingClientRect(),Y=H.clientX-F.left,Z=H.clientY-F.top,W=_(Y,Z),j=Ah(a,E);if(!Sr(W,o,1,j))return;const ee=wv(h,o,W,1),se=[...E],ae={mapDimensions:{width:dn,height:fn},terrainOwnership:se},Q=o===q.BorderPost?Eu:Ki;rl(W,Q,1,ae),C(se),o!==q.BorderPost&&c(re=>[...re,ee]),p(re=>re+1)},[o,h,_,a,E]),P=te.useCallback(H=>{const G=t.current;if(!G)return;const F=G.getBoundingClientRect(),Y=H.clientX-F.left,Z=H.clientY-F.top;u(_(Y,Z))},[_]),k=te.useCallback(()=>{c([]),p(10),C(new Array(Math.ceil(dn/Ae)*Math.ceil(fn/Ae)).fill(null))},[]),R=te.useCallback(()=>{const H=Ah(a,E),G={x:dn/2,y:fn/2},F=tu(o,1,H,200,100,G);if(F){const Y=wv(h,o,F,1),Z=[...E];rl(F,Ki,1,{mapDimensions:{width:dn,height:fn},terrainOwnership:Z}),C(Z),c(j=>[...j,Y]),p(j=>j+1)}},[a,E,o,h]);return te.useEffect(()=>{const H=()=>{const G=t.current,F=G==null?void 0:G.getContext("2d");if(!F)return;const Y={x:dn/2,y:fn/2},Z=Ah(a,E);if(F.fillStyle="#2c5234",F.fillRect(0,0,dn,fn),m&&$p(F,Z,Y,{width:dn,height:fn},1),v){F.strokeStyle="rgba(255,255,255,0.05)",F.lineWidth=1;for(let W=0;W<=dn;W+=Se)F.beginPath(),F.moveTo(W,0),F.lineTo(W,fn),F.stroke();for(let W=0;W<=fn;W+=Se)F.beginPath(),F.moveTo(0,W),F.lineTo(dn,W),F.stroke()}for(const W of a)Up(F,W,Z);if(d){const W=Sr(d,o,1,Z);Gp(F,d,o,T?W:!0,{width:dn,height:fn}),T&&(F.save(),F.font="12px Arial",F.fillStyle=W?"#00FF00":"#FF0000",F.fillText(W?" Valid placement":" Invalid placement",d.x+15,d.y-15),F.restore())}n.current=requestAnimationFrame(H)};return n.current=requestAnimationFrame(H),()=>{n.current&&cancelAnimationFrame(n.current)}},[a,d,o,E,m,v,T]),X.jsxs(u2,{children:[X.jsxs(d2,{children:[X.jsx(p2,{children:"Palisade Placement"}),X.jsx(Vc,{children:"Building Type"}),X.jsxs(is,{onClick:()=>s(q.Palisade),style:{backgroundColor:o===q.Palisade?"#666":"#444",borderLeft:o===q.Palisade?"3px solid #4CAF50":"none"},children:[It[q.Palisade].icon," Palisade"]}),X.jsxs(is,{onClick:()=>s(q.Gate),style:{backgroundColor:o===q.Gate?"#666":"#444",borderLeft:o===q.Gate?"3px solid #4CAF50":"none"},children:[It[q.Gate].icon," Gate"]}),X.jsxs(is,{onClick:()=>s(q.BorderPost),style:{backgroundColor:o===q.BorderPost?"#666":"#444",borderLeft:o===q.BorderPost?"3px solid #4CAF50":"none"},children:[It[q.BorderPost].icon," Border Post"]}),X.jsx(Vc,{children:"Visualization"}),X.jsxs(Th,{children:[X.jsx("input",{type:"checkbox",checked:m,onChange:H=>S(H.target.checked)}),"Show Territory"]}),X.jsxs(Th,{children:[X.jsx("input",{type:"checkbox",checked:v,onChange:H=>A(H.target.checked)}),"Show Navigation Grid"]}),X.jsxs(Th,{children:[X.jsx("input",{type:"checkbox",checked:T,onChange:H=>w(H.target.checked)}),"Show Valid Placement"]}),X.jsx(Vc,{children:"Info"}),X.jsxs(Ih,{children:["Buildings placed: ",a.length]}),X.jsxs(Ih,{children:["Grid size: ",Se,"px"]}),X.jsxs(Ih,{children:["Territory resolution: ",Ae,"px"]}),X.jsx(Vc,{children:"Actions"}),X.jsx(is,{onClick:R,style:{backgroundColor:"#2a5",textAlign:"center"},children:" Auto-Place Adjacent"}),X.jsx(is,{onClick:k,style:{backgroundColor:"#a33",textAlign:"center"},children:" Clear All"}),X.jsx(g2,{onClick:e,children:"Back to Intro"})]}),X.jsxs(f2,{children:[X.jsx(h2,{ref:t,width:dn,height:fn,onClick:M,onMouseMove:P,onMouseLeave:()=>u(null),style:{cursor:"crosshair"}}),X.jsxs("p",{style:{marginTop:"20px",color:"#888",maxWidth:"600px",textAlign:"center"},children:["Click to manually place ",It[o].name.toLowerCase(),'s, or use "Auto-Place Adjacent" to test the findAdjacentBuildingPlacement algorithm. Territory shows where buildings can be placed.']})]})]})},y2=O1`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function v2(e,t){te.useEffect(()=>{const n=()=>{const o=document.location.hash;t(o==="#game"?"game":o==="#effects"?"effects":o==="#buildings"?"buildings":o==="#navigation"?"navigation":o==="#palisadePlacement"?"palisadePlacement":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),te.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const S2=()=>{const{appState:e,setAppState:t}=Ci();v2(e,t);const n=()=>{switch(e){case"intro":return X.jsx(vv,{});case"game":return X.jsx(Tv,{});case"effects":return X.jsx(zN,{});case"buildings":return X.jsx(t2,{});case"navigation":return X.jsx(c2,{});case"palisadePlacement":return X.jsx(m2,{});case"gameOver":return X.jsxs(X.Fragment,{children:[X.jsx(Tv,{}),X.jsx(LN,{})]});default:return X.jsx(vv,{})}};return X.jsxs(X.Fragment,{children:[X.jsx(y2,{}),n()]})},Ev=document.getElementById("root");Ev?zP().then(()=>{pw.createRoot(Ev).render(X.jsx(Ii.StrictMode,{children:X.jsx(Dw,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":document.location.hash==="#navigation"?"navigation":document.location.hash==="#palisadePlacement"?"palisadePlacement":document.location.hash==="#buildings"?"buildings":"intro",children:X.jsx(S2,{})})}))}):console.error("Failed to find the root element");
