var m1=Object.defineProperty;var y1=(e,t,n)=>t in e?m1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var Yt=(e,t,n)=>y1(e,typeof t!="symbol"?t+"":t,n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function o(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function Mv(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $f={exports:{}},Aa={},Wf={exports:{}},Ge={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var D0;function v1(){if(D0)return Ge;D0=1;var e=Symbol.for("react.element"),t=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),m=Symbol.iterator;function S(D){return D===null||typeof D!="object"?null:(D=m&&D[m]||D["@@iterator"],typeof D=="function"?D:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},I=Object.assign,T={};function E(D,G,J){this.props=D,this.context=G,this.refs=T,this.updater=J||y}E.prototype.isReactComponent={},E.prototype.setState=function(D,G){if(typeof D!="object"&&typeof D!="function"&&D!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,D,G,"setState")},E.prototype.forceUpdate=function(D){this.updater.enqueueForceUpdate(this,D,"forceUpdate")};function P(){}P.prototype=E.prototype;function C(D,G,J){this.props=D,this.context=G,this.refs=T,this.updater=J||y}var _=C.prototype=new P;_.constructor=C,I(_,E.prototype),_.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,M={current:null},R={key:!0,ref:!0,__self:!0,__source:!0};function H(D,G,J){var pe,ne={},se=null,ge=null;if(G!=null)for(pe in G.ref!==void 0&&(ge=G.ref),G.key!==void 0&&(se=""+G.key),G)w.call(G,pe)&&!R.hasOwnProperty(pe)&&(ne[pe]=G[pe]);var L=arguments.length-2;if(L===1)ne.children=J;else if(1<L){for(var ce=Array(L),ye=0;ye<L;ye++)ce[ye]=arguments[ye+2];ne.children=ce}if(D&&D.defaultProps)for(pe in L=D.defaultProps,L)ne[pe]===void 0&&(ne[pe]=L[pe]);return{$$typeof:e,type:D,key:se,ref:ge,props:ne,_owner:M.current}}function j(D,G){return{$$typeof:e,type:D.type,key:G,ref:D.ref,props:D.props,_owner:D._owner}}function $(D){return typeof D=="object"&&D!==null&&D.$$typeof===e}function V(D){var G={"=":"=0",":":"=2"};return"$"+D.replace(/[=:]/g,function(J){return G[J]})}var ee=/\/+/g;function ue(D,G){return typeof D=="object"&&D!==null&&D.key!=null?V(""+D.key):G.toString(36)}function oe(D,G,J,pe,ne){var se=typeof D;(se==="undefined"||se==="boolean")&&(D=null);var ge=!1;if(D===null)ge=!0;else switch(se){case"string":case"number":ge=!0;break;case"object":switch(D.$$typeof){case e:case t:ge=!0}}if(ge)return ge=D,ne=ne(ge),D=pe===""?"."+ue(ge,0):pe,k(ne)?(J="",D!=null&&(J=D.replace(ee,"$&/")+"/"),oe(ne,G,J,"",function(ye){return ye})):ne!=null&&($(ne)&&(ne=j(ne,J+(!ne.key||ge&&ge.key===ne.key?"":(""+ne.key).replace(ee,"$&/")+"/")+D)),G.push(ne)),1;if(ge=0,pe=pe===""?".":pe+":",k(D))for(var L=0;L<D.length;L++){se=D[L];var ce=pe+ue(se,L);ge+=oe(se,G,J,ce,ne)}else if(ce=S(D),typeof ce=="function")for(D=ce.call(D),L=0;!(se=D.next()).done;)se=se.value,ce=pe+ue(se,L++),ge+=oe(se,G,J,ce,ne);else if(se==="object")throw G=String(D),Error("Objects are not valid as a React child (found: "+(G==="[object Object]"?"object with keys {"+Object.keys(D).join(", ")+"}":G)+"). If you meant to render a collection of children, use an array instead.");return ge}function re(D,G,J){if(D==null)return D;var pe=[],ne=0;return oe(D,pe,"","",function(se){return G.call(J,se,ne++)}),pe}function fe(D){if(D._status===-1){var G=D._result;G=G(),G.then(function(J){(D._status===0||D._status===-1)&&(D._status=1,D._result=J)},function(J){(D._status===0||D._status===-1)&&(D._status=2,D._result=J)}),D._status===-1&&(D._status=0,D._result=G)}if(D._status===1)return D._result.default;throw D._result}var ie={current:null},W={transition:null},te={ReactCurrentDispatcher:ie,ReactCurrentBatchConfig:W,ReactCurrentOwner:M};function x(){throw Error("act(...) is not supported in production builds of React.")}return Ge.Children={map:re,forEach:function(D,G,J){re(D,function(){G.apply(this,arguments)},J)},count:function(D){var G=0;return re(D,function(){G++}),G},toArray:function(D){return re(D,function(G){return G})||[]},only:function(D){if(!$(D))throw Error("React.Children.only expected to receive a single React element child.");return D}},Ge.Component=E,Ge.Fragment=n,Ge.Profiler=s,Ge.PureComponent=C,Ge.StrictMode=o,Ge.Suspense=d,Ge.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=te,Ge.act=x,Ge.cloneElement=function(D,G,J){if(D==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+D+".");var pe=I({},D.props),ne=D.key,se=D.ref,ge=D._owner;if(G!=null){if(G.ref!==void 0&&(se=G.ref,ge=M.current),G.key!==void 0&&(ne=""+G.key),D.type&&D.type.defaultProps)var L=D.type.defaultProps;for(ce in G)w.call(G,ce)&&!R.hasOwnProperty(ce)&&(pe[ce]=G[ce]===void 0&&L!==void 0?L[ce]:G[ce])}var ce=arguments.length-2;if(ce===1)pe.children=J;else if(1<ce){L=Array(ce);for(var ye=0;ye<ce;ye++)L[ye]=arguments[ye+2];pe.children=L}return{$$typeof:e,type:D.type,key:ne,ref:se,props:pe,_owner:ge}},Ge.createContext=function(D){return D={$$typeof:l,_currentValue:D,_currentValue2:D,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},D.Provider={$$typeof:a,_context:D},D.Consumer=D},Ge.createElement=H,Ge.createFactory=function(D){var G=H.bind(null,D);return G.type=D,G},Ge.createRef=function(){return{current:null}},Ge.forwardRef=function(D){return{$$typeof:u,render:D}},Ge.isValidElement=$,Ge.lazy=function(D){return{$$typeof:p,_payload:{_status:-1,_result:D},_init:fe}},Ge.memo=function(D,G){return{$$typeof:h,type:D,compare:G===void 0?null:G}},Ge.startTransition=function(D){var G=W.transition;W.transition={};try{D()}finally{W.transition=G}},Ge.unstable_act=x,Ge.useCallback=function(D,G){return ie.current.useCallback(D,G)},Ge.useContext=function(D){return ie.current.useContext(D)},Ge.useDebugValue=function(){},Ge.useDeferredValue=function(D){return ie.current.useDeferredValue(D)},Ge.useEffect=function(D,G){return ie.current.useEffect(D,G)},Ge.useId=function(){return ie.current.useId()},Ge.useImperativeHandle=function(D,G,J){return ie.current.useImperativeHandle(D,G,J)},Ge.useInsertionEffect=function(D,G){return ie.current.useInsertionEffect(D,G)},Ge.useLayoutEffect=function(D,G){return ie.current.useLayoutEffect(D,G)},Ge.useMemo=function(D,G){return ie.current.useMemo(D,G)},Ge.useReducer=function(D,G,J){return ie.current.useReducer(D,G,J)},Ge.useRef=function(D){return ie.current.useRef(D)},Ge.useState=function(D){return ie.current.useState(D)},Ge.useSyncExternalStore=function(D,G,J){return ie.current.useSyncExternalStore(D,G,J)},Ge.useTransition=function(){return ie.current.useTransition()},Ge.version="18.3.1",Ge}var O0;function Zh(){return O0||(O0=1,Wf.exports=v1()),Wf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var N0;function S1(){if(N0)return Aa;N0=1;var e=Zh(),t=Symbol.for("react.element"),n=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(u,d,h){var p,m={},S=null,y=null;h!==void 0&&(S=""+h),d.key!==void 0&&(S=""+d.key),d.ref!==void 0&&(y=d.ref);for(p in d)o.call(d,p)&&!a.hasOwnProperty(p)&&(m[p]=d[p]);if(u&&u.defaultProps)for(p in d=u.defaultProps,d)m[p]===void 0&&(m[p]=d[p]);return{$$typeof:t,type:u,key:S,ref:y,props:m,_owner:s.current}}return Aa.Fragment=n,Aa.jsx=l,Aa.jsxs=l,Aa}var B0;function T1(){return B0||(B0=1,$f.exports=S1()),$f.exports}var z=T1(),Q=Zh();const Ii=Mv(Q);var Oc={},Yf={exports:{}},Sn={},jf={exports:{}},zf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H0;function I1(){return H0||(H0=1,function(e){function t(W,te){var x=W.length;W.push(te);e:for(;0<x;){var D=x-1>>>1,G=W[D];if(0<s(G,te))W[D]=te,W[x]=G,x=D;else break e}}function n(W){return W.length===0?null:W[0]}function o(W){if(W.length===0)return null;var te=W[0],x=W.pop();if(x!==te){W[0]=x;e:for(var D=0,G=W.length,J=G>>>1;D<J;){var pe=2*(D+1)-1,ne=W[pe],se=pe+1,ge=W[se];if(0>s(ne,x))se<G&&0>s(ge,ne)?(W[D]=ge,W[se]=x,D=se):(W[D]=ne,W[pe]=x,D=pe);else if(se<G&&0>s(ge,x))W[D]=ge,W[se]=x,D=se;else break e}}return te}function s(W,te){var x=W.sortIndex-te.sortIndex;return x!==0?x:W.id-te.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;e.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();e.unstable_now=function(){return l.now()-u}}var d=[],h=[],p=1,m=null,S=3,y=!1,I=!1,T=!1,E=typeof setTimeout=="function"?setTimeout:null,P=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function _(W){for(var te=n(h);te!==null;){if(te.callback===null)o(h);else if(te.startTime<=W)o(h),te.sortIndex=te.expirationTime,t(d,te);else break;te=n(h)}}function k(W){if(T=!1,_(W),!I)if(n(d)!==null)I=!0,fe(w);else{var te=n(h);te!==null&&ie(k,te.startTime-W)}}function w(W,te){I=!1,T&&(T=!1,P(H),H=-1),y=!0;var x=S;try{for(_(te),m=n(d);m!==null&&(!(m.expirationTime>te)||W&&!V());){var D=m.callback;if(typeof D=="function"){m.callback=null,S=m.priorityLevel;var G=D(m.expirationTime<=te);te=e.unstable_now(),typeof G=="function"?m.callback=G:m===n(d)&&o(d),_(te)}else o(d);m=n(d)}if(m!==null)var J=!0;else{var pe=n(h);pe!==null&&ie(k,pe.startTime-te),J=!1}return J}finally{m=null,S=x,y=!1}}var M=!1,R=null,H=-1,j=5,$=-1;function V(){return!(e.unstable_now()-$<j)}function ee(){if(R!==null){var W=e.unstable_now();$=W;var te=!0;try{te=R(!0,W)}finally{te?ue():(M=!1,R=null)}}else M=!1}var ue;if(typeof C=="function")ue=function(){C(ee)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,re=oe.port2;oe.port1.onmessage=ee,ue=function(){re.postMessage(null)}}else ue=function(){E(ee,0)};function fe(W){R=W,M||(M=!0,ue())}function ie(W,te){H=E(function(){W(e.unstable_now())},te)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(W){W.callback=null},e.unstable_continueExecution=function(){I||y||(I=!0,fe(w))},e.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):j=0<W?Math.floor(1e3/W):5},e.unstable_getCurrentPriorityLevel=function(){return S},e.unstable_getFirstCallbackNode=function(){return n(d)},e.unstable_next=function(W){switch(S){case 1:case 2:case 3:var te=3;break;default:te=S}var x=S;S=te;try{return W()}finally{S=x}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(W,te){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var x=S;S=W;try{return te()}finally{S=x}},e.unstable_scheduleCallback=function(W,te,x){var D=e.unstable_now();switch(typeof x=="object"&&x!==null?(x=x.delay,x=typeof x=="number"&&0<x?D+x:D):x=D,W){case 1:var G=-1;break;case 2:G=250;break;case 5:G=1073741823;break;case 4:G=1e4;break;default:G=5e3}return G=x+G,W={id:p++,callback:te,priorityLevel:W,startTime:x,expirationTime:G,sortIndex:-1},x>D?(W.sortIndex=x,t(h,W),n(d)===null&&W===n(h)&&(T?(P(H),H=-1):T=!0,ie(k,x-D))):(W.sortIndex=G,t(d,W),I||y||(I=!0,fe(w))),W},e.unstable_shouldYield=V,e.unstable_wrapCallback=function(W){var te=S;return function(){var x=S;S=te;try{return W.apply(this,arguments)}finally{S=x}}}}(zf)),zf}var F0;function A1(){return F0||(F0=1,jf.exports=I1()),jf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var x0;function E1(){if(x0)return Sn;x0=1;var e=Zh(),t=A1();function n(i){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+i,c=1;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+i+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function a(i,r){l(i,r),l(i+"Capture",r)}function l(i,r){for(s[i]=r,i=0;i<r.length;i++)o.add(r[i])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},m={};function S(i){return d.call(m,i)?!0:d.call(p,i)?!1:h.test(i)?m[i]=!0:(p[i]=!0,!1)}function y(i,r,c,f){if(c!==null&&c.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return f?!1:c!==null?!c.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function I(i,r,c,f){if(r===null||typeof r>"u"||y(i,r,c,f))return!0;if(f)return!1;if(c!==null)switch(c.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function T(i,r,c,f,g,v,A){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=f,this.attributeNamespace=g,this.mustUseProperty=c,this.propertyName=i,this.type=r,this.sanitizeURL=v,this.removeEmptyString=A}var E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){E[i]=new T(i,0,!1,i,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var r=i[0];E[r]=new T(r,1,!1,i[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(i){E[i]=new T(i,2,!1,i.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){E[i]=new T(i,2,!1,i,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){E[i]=new T(i,3,!1,i.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(i){E[i]=new T(i,3,!0,i,null,!1,!1)}),["capture","download"].forEach(function(i){E[i]=new T(i,4,!1,i,null,!1,!1)}),["cols","rows","size","span"].forEach(function(i){E[i]=new T(i,6,!1,i,null,!1,!1)}),["rowSpan","start"].forEach(function(i){E[i]=new T(i,5,!1,i.toLowerCase(),null,!1,!1)});var P=/[\-:]([a-z])/g;function C(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var r=i.replace(P,C);E[r]=new T(r,1,!1,i,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var r=i.replace(P,C);E[r]=new T(r,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(i){var r=i.replace(P,C);E[r]=new T(r,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(i){E[i]=new T(i,1,!1,i.toLowerCase(),null,!1,!1)}),E.xlinkHref=new T("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(i){E[i]=new T(i,1,!1,i.toLowerCase(),null,!0,!0)});function _(i,r,c,f){var g=E.hasOwnProperty(r)?E[r]:null;(g!==null?g.type!==0:f||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(I(r,c,g,f)&&(c=null),f||g===null?S(r)&&(c===null?i.removeAttribute(r):i.setAttribute(r,""+c)):g.mustUseProperty?i[g.propertyName]=c===null?g.type===3?!1:"":c:(r=g.attributeName,f=g.attributeNamespace,c===null?i.removeAttribute(r):(g=g.type,c=g===3||g===4&&c===!0?"":""+c,f?i.setAttributeNS(f,r,c):i.setAttribute(r,c))))}var k=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=Symbol.for("react.element"),M=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),H=Symbol.for("react.strict_mode"),j=Symbol.for("react.profiler"),$=Symbol.for("react.provider"),V=Symbol.for("react.context"),ee=Symbol.for("react.forward_ref"),ue=Symbol.for("react.suspense"),oe=Symbol.for("react.suspense_list"),re=Symbol.for("react.memo"),fe=Symbol.for("react.lazy"),ie=Symbol.for("react.offscreen"),W=Symbol.iterator;function te(i){return i===null||typeof i!="object"?null:(i=W&&i[W]||i["@@iterator"],typeof i=="function"?i:null)}var x=Object.assign,D;function G(i){if(D===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);D=r&&r[1]||""}return`
`+D+i}var J=!1;function pe(i,r){if(!i||J)return"";J=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(Y){var f=Y}Reflect.construct(i,[],r)}else{try{r.call()}catch(Y){f=Y}i.call(r.prototype)}else{try{throw Error()}catch(Y){f=Y}i()}}catch(Y){if(Y&&f&&typeof Y.stack=="string"){for(var g=Y.stack.split(`
`),v=f.stack.split(`
`),A=g.length-1,b=v.length-1;1<=A&&0<=b&&g[A]!==v[b];)b--;for(;1<=A&&0<=b;A--,b--)if(g[A]!==v[b]){if(A!==1||b!==1)do if(A--,b--,0>b||g[A]!==v[b]){var O=`
`+g[A].replace(" at new "," at ");return i.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",i.displayName)),O}while(1<=A&&0<=b);break}}}finally{J=!1,Error.prepareStackTrace=c}return(i=i?i.displayName||i.name:"")?G(i):""}function ne(i){switch(i.tag){case 5:return G(i.type);case 16:return G("Lazy");case 13:return G("Suspense");case 19:return G("SuspenseList");case 0:case 2:case 15:return i=pe(i.type,!1),i;case 11:return i=pe(i.type.render,!1),i;case 1:return i=pe(i.type,!0),i;default:return""}}function se(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case R:return"Fragment";case M:return"Portal";case j:return"Profiler";case H:return"StrictMode";case ue:return"Suspense";case oe:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case V:return(i.displayName||"Context")+".Consumer";case $:return(i._context.displayName||"Context")+".Provider";case ee:var r=i.render;return i=i.displayName,i||(i=r.displayName||r.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case re:return r=i.displayName||null,r!==null?r:se(i.type)||"Memo";case fe:r=i._payload,i=i._init;try{return se(i(r))}catch{}}return null}function ge(i){var r=i.type;switch(i.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=r.render,i=i.displayName||i.name||"",r.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return se(r);case 8:return r===H?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function L(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function ce(i){var r=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function ye(i){var r=ce(i)?"checked":"value",c=Object.getOwnPropertyDescriptor(i.constructor.prototype,r),f=""+i[r];if(!i.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var g=c.get,v=c.set;return Object.defineProperty(i,r,{configurable:!0,get:function(){return g.call(this)},set:function(A){f=""+A,v.call(this,A)}}),Object.defineProperty(i,r,{enumerable:c.enumerable}),{getValue:function(){return f},setValue:function(A){f=""+A},stopTracking:function(){i._valueTracker=null,delete i[r]}}}}function Ae(i){i._valueTracker||(i._valueTracker=ye(i))}function Z(i){if(!i)return!1;var r=i._valueTracker;if(!r)return!0;var c=r.getValue(),f="";return i&&(f=ce(i)?i.checked?"true":"false":i.value),i=f,i!==c?(r.setValue(i),!0):!1}function $e(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function Le(i,r){var c=r.checked;return x({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??i._wrapperState.initialChecked})}function He(i,r){var c=r.defaultValue==null?"":r.defaultValue,f=r.checked!=null?r.checked:r.defaultChecked;c=L(r.value!=null?r.value:c),i._wrapperState={initialChecked:f,initialValue:c,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function it(i,r){r=r.checked,r!=null&&_(i,"checked",r,!1)}function St(i,r){it(i,r);var c=L(r.value),f=r.type;if(c!=null)f==="number"?(c===0&&i.value===""||i.value!=c)&&(i.value=""+c):i.value!==""+c&&(i.value=""+c);else if(f==="submit"||f==="reset"){i.removeAttribute("value");return}r.hasOwnProperty("value")?ot(i,r.type,c):r.hasOwnProperty("defaultValue")&&ot(i,r.type,L(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(i.defaultChecked=!!r.defaultChecked)}function Et(i,r,c){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var f=r.type;if(!(f!=="submit"&&f!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+i._wrapperState.initialValue,c||r===i.value||(i.value=r),i.defaultValue=r}c=i.name,c!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,c!==""&&(i.name=c)}function ot(i,r,c){(r!=="number"||$e(i.ownerDocument)!==i)&&(c==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+c&&(i.defaultValue=""+c))}var qt=Array.isArray;function En(i,r,c,f){if(i=i.options,r){r={};for(var g=0;g<c.length;g++)r["$"+c[g]]=!0;for(c=0;c<i.length;c++)g=r.hasOwnProperty("$"+i[c].value),i[c].selected!==g&&(i[c].selected=g),g&&f&&(i[c].defaultSelected=!0)}else{for(c=""+L(c),r=null,g=0;g<i.length;g++){if(i[g].value===c){i[g].selected=!0,f&&(i[g].defaultSelected=!0);return}r!==null||i[g].disabled||(r=i[g])}r!==null&&(r.selected=!0)}}function to(i,r){if(r.dangerouslySetInnerHTML!=null)throw Error(n(91));return x({},r,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function Bs(i,r){var c=r.value;if(c==null){if(c=r.children,r=r.defaultValue,c!=null){if(r!=null)throw Error(n(92));if(qt(c)){if(1<c.length)throw Error(n(93));c=c[0]}r=c}r==null&&(r=""),c=r}i._wrapperState={initialValue:L(c)}}function Hs(i,r){var c=L(r.value),f=L(r.defaultValue);c!=null&&(c=""+c,c!==i.value&&(i.value=c),r.defaultValue==null&&i.defaultValue!==c&&(i.defaultValue=c)),f!=null&&(i.defaultValue=""+f)}function Fs(i){var r=i.textContent;r===i._wrapperState.initialValue&&r!==""&&r!==null&&(i.value=r)}function $o(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Qu(i,r){return i==null||i==="http://www.w3.org/1999/xhtml"?$o(r):i==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var Cl,zp=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,c,f,g){MSApp.execUnsafeLocalFunction(function(){return i(r,c,f,g)})}:i}(function(i,r){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=r;else{for(Cl=Cl||document.createElement("div"),Cl.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=Cl.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;r.firstChild;)i.appendChild(r.firstChild)}});function xs(i,r){if(r){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=r;return}}i.textContent=r}var Ls={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},TI=["Webkit","ms","Moz","O"];Object.keys(Ls).forEach(function(i){TI.forEach(function(r){r=r+i.charAt(0).toUpperCase()+i.substring(1),Ls[r]=Ls[i]})});function Xp(i,r,c){return r==null||typeof r=="boolean"||r===""?"":c||typeof r!="number"||r===0||Ls.hasOwnProperty(i)&&Ls[i]?(""+r).trim():r+"px"}function Vp(i,r){i=i.style;for(var c in r)if(r.hasOwnProperty(c)){var f=c.indexOf("--")===0,g=Xp(c,r[c],f);c==="float"&&(c="cssFloat"),f?i.setProperty(c,g):i[c]=g}}var II=x({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ju(i,r){if(r){if(II[i]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error(n(137,i));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error(n(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error(n(61))}if(r.style!=null&&typeof r.style!="object")throw Error(n(62))}}function ed(i,r){if(i.indexOf("-")===-1)return typeof r.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var td=null;function nd(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var id=null,kr=null,Mr=null;function qp(i){if(i=aa(i)){if(typeof id!="function")throw Error(n(280));var r=i.stateNode;r&&(r=Vl(r),id(i.stateNode,i.type,r))}}function Zp(i){kr?Mr?Mr.push(i):Mr=[i]:kr=i}function Kp(){if(kr){var i=kr,r=Mr;if(Mr=kr=null,qp(i),r)for(i=0;i<r.length;i++)qp(r[i])}}function Qp(i,r){return i(r)}function Jp(){}var od=!1;function eg(i,r,c){if(od)return i(r,c);od=!0;try{return Qp(i,r,c)}finally{od=!1,(kr!==null||Mr!==null)&&(Jp(),Kp())}}function Us(i,r){var c=i.stateNode;if(c===null)return null;var f=Vl(c);if(f===null)return null;c=f[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(i=i.type,f=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!f;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(n(231,r,typeof c));return c}var rd=!1;if(u)try{var Gs={};Object.defineProperty(Gs,"passive",{get:function(){rd=!0}}),window.addEventListener("test",Gs,Gs),window.removeEventListener("test",Gs,Gs)}catch{rd=!1}function AI(i,r,c,f,g,v,A,b,O){var Y=Array.prototype.slice.call(arguments,3);try{r.apply(c,Y)}catch(le){this.onError(le)}}var $s=!1,Pl=null,_l=!1,sd=null,EI={onError:function(i){$s=!0,Pl=i}};function wI(i,r,c,f,g,v,A,b,O){$s=!1,Pl=null,AI.apply(EI,arguments)}function CI(i,r,c,f,g,v,A,b,O){if(wI.apply(this,arguments),$s){if($s){var Y=Pl;$s=!1,Pl=null}else throw Error(n(198));_l||(_l=!0,sd=Y)}}function Wo(i){var r=i,c=i;if(i.alternate)for(;r.return;)r=r.return;else{i=r;do r=i,(r.flags&4098)!==0&&(c=r.return),i=r.return;while(i)}return r.tag===3?c:null}function tg(i){if(i.tag===13){var r=i.memoizedState;if(r===null&&(i=i.alternate,i!==null&&(r=i.memoizedState)),r!==null)return r.dehydrated}return null}function ng(i){if(Wo(i)!==i)throw Error(n(188))}function PI(i){var r=i.alternate;if(!r){if(r=Wo(i),r===null)throw Error(n(188));return r!==i?null:i}for(var c=i,f=r;;){var g=c.return;if(g===null)break;var v=g.alternate;if(v===null){if(f=g.return,f!==null){c=f;continue}break}if(g.child===v.child){for(v=g.child;v;){if(v===c)return ng(g),i;if(v===f)return ng(g),r;v=v.sibling}throw Error(n(188))}if(c.return!==f.return)c=g,f=v;else{for(var A=!1,b=g.child;b;){if(b===c){A=!0,c=g,f=v;break}if(b===f){A=!0,f=g,c=v;break}b=b.sibling}if(!A){for(b=v.child;b;){if(b===c){A=!0,c=v,f=g;break}if(b===f){A=!0,f=v,c=g;break}b=b.sibling}if(!A)throw Error(n(189))}}if(c.alternate!==f)throw Error(n(190))}if(c.tag!==3)throw Error(n(188));return c.stateNode.current===c?i:r}function ig(i){return i=PI(i),i!==null?og(i):null}function og(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var r=og(i);if(r!==null)return r;i=i.sibling}return null}var rg=t.unstable_scheduleCallback,sg=t.unstable_cancelCallback,_I=t.unstable_shouldYield,RI=t.unstable_requestPaint,Tt=t.unstable_now,kI=t.unstable_getCurrentPriorityLevel,ad=t.unstable_ImmediatePriority,ag=t.unstable_UserBlockingPriority,Rl=t.unstable_NormalPriority,MI=t.unstable_LowPriority,lg=t.unstable_IdlePriority,kl=null,di=null;function bI(i){if(di&&typeof di.onCommitFiberRoot=="function")try{di.onCommitFiberRoot(kl,i,void 0,(i.current.flags&128)===128)}catch{}}var Zn=Math.clz32?Math.clz32:NI,DI=Math.log,OI=Math.LN2;function NI(i){return i>>>=0,i===0?32:31-(DI(i)/OI|0)|0}var Ml=64,bl=4194304;function Ws(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Dl(i,r){var c=i.pendingLanes;if(c===0)return 0;var f=0,g=i.suspendedLanes,v=i.pingedLanes,A=c&268435455;if(A!==0){var b=A&~g;b!==0?f=Ws(b):(v&=A,v!==0&&(f=Ws(v)))}else A=c&~g,A!==0?f=Ws(A):v!==0&&(f=Ws(v));if(f===0)return 0;if(r!==0&&r!==f&&(r&g)===0&&(g=f&-f,v=r&-r,g>=v||g===16&&(v&4194240)!==0))return r;if((f&4)!==0&&(f|=c&16),r=i.entangledLanes,r!==0)for(i=i.entanglements,r&=f;0<r;)c=31-Zn(r),g=1<<c,f|=i[c],r&=~g;return f}function BI(i,r){switch(i){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function HI(i,r){for(var c=i.suspendedLanes,f=i.pingedLanes,g=i.expirationTimes,v=i.pendingLanes;0<v;){var A=31-Zn(v),b=1<<A,O=g[A];O===-1?((b&c)===0||(b&f)!==0)&&(g[A]=BI(b,r)):O<=r&&(i.expiredLanes|=b),v&=~b}}function ld(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function cg(){var i=Ml;return Ml<<=1,(Ml&4194240)===0&&(Ml=64),i}function cd(i){for(var r=[],c=0;31>c;c++)r.push(i);return r}function Ys(i,r,c){i.pendingLanes|=r,r!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,r=31-Zn(r),i[r]=c}function FI(i,r){var c=i.pendingLanes&~r;i.pendingLanes=r,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=r,i.mutableReadLanes&=r,i.entangledLanes&=r,r=i.entanglements;var f=i.eventTimes;for(i=i.expirationTimes;0<c;){var g=31-Zn(c),v=1<<g;r[g]=0,f[g]=-1,i[g]=-1,c&=~v}}function ud(i,r){var c=i.entangledLanes|=r;for(i=i.entanglements;c;){var f=31-Zn(c),g=1<<f;g&r|i[f]&r&&(i[f]|=r),c&=~g}}var Ze=0;function ug(i){return i&=-i,1<i?4<i?(i&268435455)!==0?16:536870912:4:1}var dg,dd,fg,hg,pg,fd=!1,Ol=[],no=null,io=null,oo=null,js=new Map,zs=new Map,ro=[],xI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function gg(i,r){switch(i){case"focusin":case"focusout":no=null;break;case"dragenter":case"dragleave":io=null;break;case"mouseover":case"mouseout":oo=null;break;case"pointerover":case"pointerout":js.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":zs.delete(r.pointerId)}}function Xs(i,r,c,f,g,v){return i===null||i.nativeEvent!==v?(i={blockedOn:r,domEventName:c,eventSystemFlags:f,nativeEvent:v,targetContainers:[g]},r!==null&&(r=aa(r),r!==null&&dd(r)),i):(i.eventSystemFlags|=f,r=i.targetContainers,g!==null&&r.indexOf(g)===-1&&r.push(g),i)}function LI(i,r,c,f,g){switch(r){case"focusin":return no=Xs(no,i,r,c,f,g),!0;case"dragenter":return io=Xs(io,i,r,c,f,g),!0;case"mouseover":return oo=Xs(oo,i,r,c,f,g),!0;case"pointerover":var v=g.pointerId;return js.set(v,Xs(js.get(v)||null,i,r,c,f,g)),!0;case"gotpointercapture":return v=g.pointerId,zs.set(v,Xs(zs.get(v)||null,i,r,c,f,g)),!0}return!1}function mg(i){var r=Yo(i.target);if(r!==null){var c=Wo(r);if(c!==null){if(r=c.tag,r===13){if(r=tg(c),r!==null){i.blockedOn=r,pg(i.priority,function(){fg(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function Nl(i){if(i.blockedOn!==null)return!1;for(var r=i.targetContainers;0<r.length;){var c=pd(i.domEventName,i.eventSystemFlags,r[0],i.nativeEvent);if(c===null){c=i.nativeEvent;var f=new c.constructor(c.type,c);td=f,c.target.dispatchEvent(f),td=null}else return r=aa(c),r!==null&&dd(r),i.blockedOn=c,!1;r.shift()}return!0}function yg(i,r,c){Nl(i)&&c.delete(r)}function UI(){fd=!1,no!==null&&Nl(no)&&(no=null),io!==null&&Nl(io)&&(io=null),oo!==null&&Nl(oo)&&(oo=null),js.forEach(yg),zs.forEach(yg)}function Vs(i,r){i.blockedOn===r&&(i.blockedOn=null,fd||(fd=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,UI)))}function qs(i){function r(g){return Vs(g,i)}if(0<Ol.length){Vs(Ol[0],i);for(var c=1;c<Ol.length;c++){var f=Ol[c];f.blockedOn===i&&(f.blockedOn=null)}}for(no!==null&&Vs(no,i),io!==null&&Vs(io,i),oo!==null&&Vs(oo,i),js.forEach(r),zs.forEach(r),c=0;c<ro.length;c++)f=ro[c],f.blockedOn===i&&(f.blockedOn=null);for(;0<ro.length&&(c=ro[0],c.blockedOn===null);)mg(c),c.blockedOn===null&&ro.shift()}var br=k.ReactCurrentBatchConfig,Bl=!0;function GI(i,r,c,f){var g=Ze,v=br.transition;br.transition=null;try{Ze=1,hd(i,r,c,f)}finally{Ze=g,br.transition=v}}function $I(i,r,c,f){var g=Ze,v=br.transition;br.transition=null;try{Ze=4,hd(i,r,c,f)}finally{Ze=g,br.transition=v}}function hd(i,r,c,f){if(Bl){var g=pd(i,r,c,f);if(g===null)bd(i,r,f,Hl,c),gg(i,f);else if(LI(g,i,r,c,f))f.stopPropagation();else if(gg(i,f),r&4&&-1<xI.indexOf(i)){for(;g!==null;){var v=aa(g);if(v!==null&&dg(v),v=pd(i,r,c,f),v===null&&bd(i,r,f,Hl,c),v===g)break;g=v}g!==null&&f.stopPropagation()}else bd(i,r,f,null,c)}}var Hl=null;function pd(i,r,c,f){if(Hl=null,i=nd(f),i=Yo(i),i!==null)if(r=Wo(i),r===null)i=null;else if(c=r.tag,c===13){if(i=tg(r),i!==null)return i;i=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;i=null}else r!==i&&(i=null);return Hl=i,null}function vg(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(kI()){case ad:return 1;case ag:return 4;case Rl:case MI:return 16;case lg:return 536870912;default:return 16}default:return 16}}var so=null,gd=null,Fl=null;function Sg(){if(Fl)return Fl;var i,r=gd,c=r.length,f,g="value"in so?so.value:so.textContent,v=g.length;for(i=0;i<c&&r[i]===g[i];i++);var A=c-i;for(f=1;f<=A&&r[c-f]===g[v-f];f++);return Fl=g.slice(i,1<f?1-f:void 0)}function xl(i){var r=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&r===13&&(i=13)):i=r,i===10&&(i=13),32<=i||i===13?i:0}function Ll(){return!0}function Tg(){return!1}function wn(i){function r(c,f,g,v,A){this._reactName=c,this._targetInst=g,this.type=f,this.nativeEvent=v,this.target=A,this.currentTarget=null;for(var b in i)i.hasOwnProperty(b)&&(c=i[b],this[b]=c?c(v):v[b]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Ll:Tg,this.isPropagationStopped=Tg,this}return x(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Ll)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Ll)},persist:function(){},isPersistent:Ll}),r}var Dr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},md=wn(Dr),Zs=x({},Dr,{view:0,detail:0}),WI=wn(Zs),yd,vd,Ks,Ul=x({},Zs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Td,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Ks&&(Ks&&i.type==="mousemove"?(yd=i.screenX-Ks.screenX,vd=i.screenY-Ks.screenY):vd=yd=0,Ks=i),yd)},movementY:function(i){return"movementY"in i?i.movementY:vd}}),Ig=wn(Ul),YI=x({},Ul,{dataTransfer:0}),jI=wn(YI),zI=x({},Zs,{relatedTarget:0}),Sd=wn(zI),XI=x({},Dr,{animationName:0,elapsedTime:0,pseudoElement:0}),VI=wn(XI),qI=x({},Dr,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),ZI=wn(qI),KI=x({},Dr,{data:0}),Ag=wn(KI),QI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},JI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},eA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tA(i){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(i):(i=eA[i])?!!r[i]:!1}function Td(){return tA}var nA=x({},Zs,{key:function(i){if(i.key){var r=QI[i.key]||i.key;if(r!=="Unidentified")return r}return i.type==="keypress"?(i=xl(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?JI[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Td,charCode:function(i){return i.type==="keypress"?xl(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?xl(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),iA=wn(nA),oA=x({},Ul,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Eg=wn(oA),rA=x({},Zs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Td}),sA=wn(rA),aA=x({},Dr,{propertyName:0,elapsedTime:0,pseudoElement:0}),lA=wn(aA),cA=x({},Ul,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),uA=wn(cA),dA=[9,13,27,32],Id=u&&"CompositionEvent"in window,Qs=null;u&&"documentMode"in document&&(Qs=document.documentMode);var fA=u&&"TextEvent"in window&&!Qs,wg=u&&(!Id||Qs&&8<Qs&&11>=Qs),Cg=" ",Pg=!1;function _g(i,r){switch(i){case"keyup":return dA.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Rg(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Or=!1;function hA(i,r){switch(i){case"compositionend":return Rg(r);case"keypress":return r.which!==32?null:(Pg=!0,Cg);case"textInput":return i=r.data,i===Cg&&Pg?null:i;default:return null}}function pA(i,r){if(Or)return i==="compositionend"||!Id&&_g(i,r)?(i=Sg(),Fl=gd=so=null,Or=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return wg&&r.locale!=="ko"?null:r.data;default:return null}}var gA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kg(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r==="input"?!!gA[i.type]:r==="textarea"}function Mg(i,r,c,f){Zp(f),r=jl(r,"onChange"),0<r.length&&(c=new md("onChange","change",null,c,f),i.push({event:c,listeners:r}))}var Js=null,ea=null;function mA(i){Vg(i,0)}function Gl(i){var r=xr(i);if(Z(r))return i}function yA(i,r){if(i==="change")return r}var bg=!1;if(u){var Ad;if(u){var Ed="oninput"in document;if(!Ed){var Dg=document.createElement("div");Dg.setAttribute("oninput","return;"),Ed=typeof Dg.oninput=="function"}Ad=Ed}else Ad=!1;bg=Ad&&(!document.documentMode||9<document.documentMode)}function Og(){Js&&(Js.detachEvent("onpropertychange",Ng),ea=Js=null)}function Ng(i){if(i.propertyName==="value"&&Gl(ea)){var r=[];Mg(r,ea,i,nd(i)),eg(mA,r)}}function vA(i,r,c){i==="focusin"?(Og(),Js=r,ea=c,Js.attachEvent("onpropertychange",Ng)):i==="focusout"&&Og()}function SA(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return Gl(ea)}function TA(i,r){if(i==="click")return Gl(r)}function IA(i,r){if(i==="input"||i==="change")return Gl(r)}function AA(i,r){return i===r&&(i!==0||1/i===1/r)||i!==i&&r!==r}var Kn=typeof Object.is=="function"?Object.is:AA;function ta(i,r){if(Kn(i,r))return!0;if(typeof i!="object"||i===null||typeof r!="object"||r===null)return!1;var c=Object.keys(i),f=Object.keys(r);if(c.length!==f.length)return!1;for(f=0;f<c.length;f++){var g=c[f];if(!d.call(r,g)||!Kn(i[g],r[g]))return!1}return!0}function Bg(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function Hg(i,r){var c=Bg(i);i=0;for(var f;c;){if(c.nodeType===3){if(f=i+c.textContent.length,i<=r&&f>=r)return{node:c,offset:r-i};i=f}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Bg(c)}}function Fg(i,r){return i&&r?i===r?!0:i&&i.nodeType===3?!1:r&&r.nodeType===3?Fg(i,r.parentNode):"contains"in i?i.contains(r):i.compareDocumentPosition?!!(i.compareDocumentPosition(r)&16):!1:!1}function xg(){for(var i=window,r=$e();r instanceof i.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)i=r.contentWindow;else break;r=$e(i.document)}return r}function wd(i){var r=i&&i.nodeName&&i.nodeName.toLowerCase();return r&&(r==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||r==="textarea"||i.contentEditable==="true")}function EA(i){var r=xg(),c=i.focusedElem,f=i.selectionRange;if(r!==c&&c&&c.ownerDocument&&Fg(c.ownerDocument.documentElement,c)){if(f!==null&&wd(c)){if(r=f.start,i=f.end,i===void 0&&(i=r),"selectionStart"in c)c.selectionStart=r,c.selectionEnd=Math.min(i,c.value.length);else if(i=(r=c.ownerDocument||document)&&r.defaultView||window,i.getSelection){i=i.getSelection();var g=c.textContent.length,v=Math.min(f.start,g);f=f.end===void 0?v:Math.min(f.end,g),!i.extend&&v>f&&(g=f,f=v,v=g),g=Hg(c,v);var A=Hg(c,f);g&&A&&(i.rangeCount!==1||i.anchorNode!==g.node||i.anchorOffset!==g.offset||i.focusNode!==A.node||i.focusOffset!==A.offset)&&(r=r.createRange(),r.setStart(g.node,g.offset),i.removeAllRanges(),v>f?(i.addRange(r),i.extend(A.node,A.offset)):(r.setEnd(A.node,A.offset),i.addRange(r)))}}for(r=[],i=c;i=i.parentNode;)i.nodeType===1&&r.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<r.length;c++)i=r[c],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var wA=u&&"documentMode"in document&&11>=document.documentMode,Nr=null,Cd=null,na=null,Pd=!1;function Lg(i,r,c){var f=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Pd||Nr==null||Nr!==$e(f)||(f=Nr,"selectionStart"in f&&wd(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),na&&ta(na,f)||(na=f,f=jl(Cd,"onSelect"),0<f.length&&(r=new md("onSelect","select",null,r,c),i.push({event:r,listeners:f}),r.target=Nr)))}function $l(i,r){var c={};return c[i.toLowerCase()]=r.toLowerCase(),c["Webkit"+i]="webkit"+r,c["Moz"+i]="moz"+r,c}var Br={animationend:$l("Animation","AnimationEnd"),animationiteration:$l("Animation","AnimationIteration"),animationstart:$l("Animation","AnimationStart"),transitionend:$l("Transition","TransitionEnd")},_d={},Ug={};u&&(Ug=document.createElement("div").style,"AnimationEvent"in window||(delete Br.animationend.animation,delete Br.animationiteration.animation,delete Br.animationstart.animation),"TransitionEvent"in window||delete Br.transitionend.transition);function Wl(i){if(_d[i])return _d[i];if(!Br[i])return i;var r=Br[i],c;for(c in r)if(r.hasOwnProperty(c)&&c in Ug)return _d[i]=r[c];return i}var Gg=Wl("animationend"),$g=Wl("animationiteration"),Wg=Wl("animationstart"),Yg=Wl("transitionend"),jg=new Map,zg="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ao(i,r){jg.set(i,r),a(r,[i])}for(var Rd=0;Rd<zg.length;Rd++){var kd=zg[Rd],CA=kd.toLowerCase(),PA=kd[0].toUpperCase()+kd.slice(1);ao(CA,"on"+PA)}ao(Gg,"onAnimationEnd"),ao($g,"onAnimationIteration"),ao(Wg,"onAnimationStart"),ao("dblclick","onDoubleClick"),ao("focusin","onFocus"),ao("focusout","onBlur"),ao(Yg,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ia="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_A=new Set("cancel close invalid load scroll toggle".split(" ").concat(ia));function Xg(i,r,c){var f=i.type||"unknown-event";i.currentTarget=c,CI(f,r,void 0,i),i.currentTarget=null}function Vg(i,r){r=(r&4)!==0;for(var c=0;c<i.length;c++){var f=i[c],g=f.event;f=f.listeners;e:{var v=void 0;if(r)for(var A=f.length-1;0<=A;A--){var b=f[A],O=b.instance,Y=b.currentTarget;if(b=b.listener,O!==v&&g.isPropagationStopped())break e;Xg(g,b,Y),v=O}else for(A=0;A<f.length;A++){if(b=f[A],O=b.instance,Y=b.currentTarget,b=b.listener,O!==v&&g.isPropagationStopped())break e;Xg(g,b,Y),v=O}}}if(_l)throw i=sd,_l=!1,sd=null,i}function rt(i,r){var c=r[Fd];c===void 0&&(c=r[Fd]=new Set);var f=i+"__bubble";c.has(f)||(qg(r,i,2,!1),c.add(f))}function Md(i,r,c){var f=0;r&&(f|=4),qg(c,i,f,r)}var Yl="_reactListening"+Math.random().toString(36).slice(2);function oa(i){if(!i[Yl]){i[Yl]=!0,o.forEach(function(c){c!=="selectionchange"&&(_A.has(c)||Md(c,!1,i),Md(c,!0,i))});var r=i.nodeType===9?i:i.ownerDocument;r===null||r[Yl]||(r[Yl]=!0,Md("selectionchange",!1,r))}}function qg(i,r,c,f){switch(vg(r)){case 1:var g=GI;break;case 4:g=$I;break;default:g=hd}c=g.bind(null,r,c,i),g=void 0,!rd||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(g=!0),f?g!==void 0?i.addEventListener(r,c,{capture:!0,passive:g}):i.addEventListener(r,c,!0):g!==void 0?i.addEventListener(r,c,{passive:g}):i.addEventListener(r,c,!1)}function bd(i,r,c,f,g){var v=f;if((r&1)===0&&(r&2)===0&&f!==null)e:for(;;){if(f===null)return;var A=f.tag;if(A===3||A===4){var b=f.stateNode.containerInfo;if(b===g||b.nodeType===8&&b.parentNode===g)break;if(A===4)for(A=f.return;A!==null;){var O=A.tag;if((O===3||O===4)&&(O=A.stateNode.containerInfo,O===g||O.nodeType===8&&O.parentNode===g))return;A=A.return}for(;b!==null;){if(A=Yo(b),A===null)return;if(O=A.tag,O===5||O===6){f=v=A;continue e}b=b.parentNode}}f=f.return}eg(function(){var Y=v,le=nd(c),de=[];e:{var ae=jg.get(i);if(ae!==void 0){var ve=md,Ee=i;switch(i){case"keypress":if(xl(c)===0)break e;case"keydown":case"keyup":ve=iA;break;case"focusin":Ee="focus",ve=Sd;break;case"focusout":Ee="blur",ve=Sd;break;case"beforeblur":case"afterblur":ve=Sd;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ve=Ig;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ve=jI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ve=sA;break;case Gg:case $g:case Wg:ve=VI;break;case Yg:ve=lA;break;case"scroll":ve=WI;break;case"wheel":ve=uA;break;case"copy":case"cut":case"paste":ve=ZI;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ve=Eg}var we=(r&4)!==0,It=!we&&i==="scroll",F=we?ae!==null?ae+"Capture":null:ae;we=[];for(var B=Y,U;B!==null;){U=B;var he=U.stateNode;if(U.tag===5&&he!==null&&(U=he,F!==null&&(he=Us(B,F),he!=null&&we.push(ra(B,he,U)))),It)break;B=B.return}0<we.length&&(ae=new ve(ae,Ee,null,c,le),de.push({event:ae,listeners:we}))}}if((r&7)===0){e:{if(ae=i==="mouseover"||i==="pointerover",ve=i==="mouseout"||i==="pointerout",ae&&c!==td&&(Ee=c.relatedTarget||c.fromElement)&&(Yo(Ee)||Ee[_i]))break e;if((ve||ae)&&(ae=le.window===le?le:(ae=le.ownerDocument)?ae.defaultView||ae.parentWindow:window,ve?(Ee=c.relatedTarget||c.toElement,ve=Y,Ee=Ee?Yo(Ee):null,Ee!==null&&(It=Wo(Ee),Ee!==It||Ee.tag!==5&&Ee.tag!==6)&&(Ee=null)):(ve=null,Ee=Y),ve!==Ee)){if(we=Ig,he="onMouseLeave",F="onMouseEnter",B="mouse",(i==="pointerout"||i==="pointerover")&&(we=Eg,he="onPointerLeave",F="onPointerEnter",B="pointer"),It=ve==null?ae:xr(ve),U=Ee==null?ae:xr(Ee),ae=new we(he,B+"leave",ve,c,le),ae.target=It,ae.relatedTarget=U,he=null,Yo(le)===Y&&(we=new we(F,B+"enter",Ee,c,le),we.target=U,we.relatedTarget=It,he=we),It=he,ve&&Ee)t:{for(we=ve,F=Ee,B=0,U=we;U;U=Hr(U))B++;for(U=0,he=F;he;he=Hr(he))U++;for(;0<B-U;)we=Hr(we),B--;for(;0<U-B;)F=Hr(F),U--;for(;B--;){if(we===F||F!==null&&we===F.alternate)break t;we=Hr(we),F=Hr(F)}we=null}else we=null;ve!==null&&Zg(de,ae,ve,we,!1),Ee!==null&&It!==null&&Zg(de,It,Ee,we,!0)}}e:{if(ae=Y?xr(Y):window,ve=ae.nodeName&&ae.nodeName.toLowerCase(),ve==="select"||ve==="input"&&ae.type==="file")var Re=yA;else if(kg(ae))if(bg)Re=IA;else{Re=SA;var Me=vA}else(ve=ae.nodeName)&&ve.toLowerCase()==="input"&&(ae.type==="checkbox"||ae.type==="radio")&&(Re=TA);if(Re&&(Re=Re(i,Y))){Mg(de,Re,c,le);break e}Me&&Me(i,ae,Y),i==="focusout"&&(Me=ae._wrapperState)&&Me.controlled&&ae.type==="number"&&ot(ae,"number",ae.value)}switch(Me=Y?xr(Y):window,i){case"focusin":(kg(Me)||Me.contentEditable==="true")&&(Nr=Me,Cd=Y,na=null);break;case"focusout":na=Cd=Nr=null;break;case"mousedown":Pd=!0;break;case"contextmenu":case"mouseup":case"dragend":Pd=!1,Lg(de,c,le);break;case"selectionchange":if(wA)break;case"keydown":case"keyup":Lg(de,c,le)}var be;if(Id)e:{switch(i){case"compositionstart":var Be="onCompositionStart";break e;case"compositionend":Be="onCompositionEnd";break e;case"compositionupdate":Be="onCompositionUpdate";break e}Be=void 0}else Or?_g(i,c)&&(Be="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(Be="onCompositionStart");Be&&(wg&&c.locale!=="ko"&&(Or||Be!=="onCompositionStart"?Be==="onCompositionEnd"&&Or&&(be=Sg()):(so=le,gd="value"in so?so.value:so.textContent,Or=!0)),Me=jl(Y,Be),0<Me.length&&(Be=new Ag(Be,i,null,c,le),de.push({event:Be,listeners:Me}),be?Be.data=be:(be=Rg(c),be!==null&&(Be.data=be)))),(be=fA?hA(i,c):pA(i,c))&&(Y=jl(Y,"onBeforeInput"),0<Y.length&&(le=new Ag("onBeforeInput","beforeinput",null,c,le),de.push({event:le,listeners:Y}),le.data=be))}Vg(de,r)})}function ra(i,r,c){return{instance:i,listener:r,currentTarget:c}}function jl(i,r){for(var c=r+"Capture",f=[];i!==null;){var g=i,v=g.stateNode;g.tag===5&&v!==null&&(g=v,v=Us(i,c),v!=null&&f.unshift(ra(i,v,g)),v=Us(i,r),v!=null&&f.push(ra(i,v,g))),i=i.return}return f}function Hr(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function Zg(i,r,c,f,g){for(var v=r._reactName,A=[];c!==null&&c!==f;){var b=c,O=b.alternate,Y=b.stateNode;if(O!==null&&O===f)break;b.tag===5&&Y!==null&&(b=Y,g?(O=Us(c,v),O!=null&&A.unshift(ra(c,O,b))):g||(O=Us(c,v),O!=null&&A.push(ra(c,O,b)))),c=c.return}A.length!==0&&i.push({event:r,listeners:A})}var RA=/\r\n?/g,kA=/\u0000|\uFFFD/g;function Kg(i){return(typeof i=="string"?i:""+i).replace(RA,`
`).replace(kA,"")}function zl(i,r,c){if(r=Kg(r),Kg(i)!==r&&c)throw Error(n(425))}function Xl(){}var Dd=null,Od=null;function Nd(i,r){return i==="textarea"||i==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var Bd=typeof setTimeout=="function"?setTimeout:void 0,MA=typeof clearTimeout=="function"?clearTimeout:void 0,Qg=typeof Promise=="function"?Promise:void 0,bA=typeof queueMicrotask=="function"?queueMicrotask:typeof Qg<"u"?function(i){return Qg.resolve(null).then(i).catch(DA)}:Bd;function DA(i){setTimeout(function(){throw i})}function Hd(i,r){var c=r,f=0;do{var g=c.nextSibling;if(i.removeChild(c),g&&g.nodeType===8)if(c=g.data,c==="/$"){if(f===0){i.removeChild(g),qs(r);return}f--}else c!=="$"&&c!=="$?"&&c!=="$!"||f++;c=g}while(c);qs(r)}function lo(i){for(;i!=null;i=i.nextSibling){var r=i.nodeType;if(r===1||r===3)break;if(r===8){if(r=i.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return i}function Jg(i){i=i.previousSibling;for(var r=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"){if(r===0)return i;r--}else c==="/$"&&r++}i=i.previousSibling}return null}var Fr=Math.random().toString(36).slice(2),fi="__reactFiber$"+Fr,sa="__reactProps$"+Fr,_i="__reactContainer$"+Fr,Fd="__reactEvents$"+Fr,OA="__reactListeners$"+Fr,NA="__reactHandles$"+Fr;function Yo(i){var r=i[fi];if(r)return r;for(var c=i.parentNode;c;){if(r=c[_i]||c[fi]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(i=Jg(i);i!==null;){if(c=i[fi])return c;i=Jg(i)}return r}i=c,c=i.parentNode}return null}function aa(i){return i=i[fi]||i[_i],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function xr(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(n(33))}function Vl(i){return i[sa]||null}var xd=[],Lr=-1;function co(i){return{current:i}}function st(i){0>Lr||(i.current=xd[Lr],xd[Lr]=null,Lr--)}function nt(i,r){Lr++,xd[Lr]=i.current,i.current=r}var uo={},Zt=co(uo),pn=co(!1),jo=uo;function Ur(i,r){var c=i.type.contextTypes;if(!c)return uo;var f=i.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===r)return f.__reactInternalMemoizedMaskedChildContext;var g={},v;for(v in c)g[v]=r[v];return f&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=r,i.__reactInternalMemoizedMaskedChildContext=g),g}function gn(i){return i=i.childContextTypes,i!=null}function ql(){st(pn),st(Zt)}function em(i,r,c){if(Zt.current!==uo)throw Error(n(168));nt(Zt,r),nt(pn,c)}function tm(i,r,c){var f=i.stateNode;if(r=r.childContextTypes,typeof f.getChildContext!="function")return c;f=f.getChildContext();for(var g in f)if(!(g in r))throw Error(n(108,ge(i)||"Unknown",g));return x({},c,f)}function Zl(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||uo,jo=Zt.current,nt(Zt,i),nt(pn,pn.current),!0}function nm(i,r,c){var f=i.stateNode;if(!f)throw Error(n(169));c?(i=tm(i,r,jo),f.__reactInternalMemoizedMergedChildContext=i,st(pn),st(Zt),nt(Zt,i)):st(pn),nt(pn,c)}var Ri=null,Kl=!1,Ld=!1;function im(i){Ri===null?Ri=[i]:Ri.push(i)}function BA(i){Kl=!0,im(i)}function fo(){if(!Ld&&Ri!==null){Ld=!0;var i=0,r=Ze;try{var c=Ri;for(Ze=1;i<c.length;i++){var f=c[i];do f=f(!0);while(f!==null)}Ri=null,Kl=!1}catch(g){throw Ri!==null&&(Ri=Ri.slice(i+1)),rg(ad,fo),g}finally{Ze=r,Ld=!1}}return null}var Gr=[],$r=0,Ql=null,Jl=0,Bn=[],Hn=0,zo=null,ki=1,Mi="";function Xo(i,r){Gr[$r++]=Jl,Gr[$r++]=Ql,Ql=i,Jl=r}function om(i,r,c){Bn[Hn++]=ki,Bn[Hn++]=Mi,Bn[Hn++]=zo,zo=i;var f=ki;i=Mi;var g=32-Zn(f)-1;f&=~(1<<g),c+=1;var v=32-Zn(r)+g;if(30<v){var A=g-g%5;v=(f&(1<<A)-1).toString(32),f>>=A,g-=A,ki=1<<32-Zn(r)+g|c<<g|f,Mi=v+i}else ki=1<<v|c<<g|f,Mi=i}function Ud(i){i.return!==null&&(Xo(i,1),om(i,1,0))}function Gd(i){for(;i===Ql;)Ql=Gr[--$r],Gr[$r]=null,Jl=Gr[--$r],Gr[$r]=null;for(;i===zo;)zo=Bn[--Hn],Bn[Hn]=null,Mi=Bn[--Hn],Bn[Hn]=null,ki=Bn[--Hn],Bn[Hn]=null}var Cn=null,Pn=null,dt=!1,Qn=null;function rm(i,r){var c=Un(5,null,null,0);c.elementType="DELETED",c.stateNode=r,c.return=i,r=i.deletions,r===null?(i.deletions=[c],i.flags|=16):r.push(c)}function sm(i,r){switch(i.tag){case 5:var c=i.type;return r=r.nodeType!==1||c.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(i.stateNode=r,Cn=i,Pn=lo(r.firstChild),!0):!1;case 6:return r=i.pendingProps===""||r.nodeType!==3?null:r,r!==null?(i.stateNode=r,Cn=i,Pn=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(c=zo!==null?{id:ki,overflow:Mi}:null,i.memoizedState={dehydrated:r,treeContext:c,retryLane:1073741824},c=Un(18,null,null,0),c.stateNode=r,c.return=i,i.child=c,Cn=i,Pn=null,!0):!1;default:return!1}}function $d(i){return(i.mode&1)!==0&&(i.flags&128)===0}function Wd(i){if(dt){var r=Pn;if(r){var c=r;if(!sm(i,r)){if($d(i))throw Error(n(418));r=lo(c.nextSibling);var f=Cn;r&&sm(i,r)?rm(f,c):(i.flags=i.flags&-4097|2,dt=!1,Cn=i)}}else{if($d(i))throw Error(n(418));i.flags=i.flags&-4097|2,dt=!1,Cn=i}}}function am(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;Cn=i}function ec(i){if(i!==Cn)return!1;if(!dt)return am(i),dt=!0,!1;var r;if((r=i.tag!==3)&&!(r=i.tag!==5)&&(r=i.type,r=r!=="head"&&r!=="body"&&!Nd(i.type,i.memoizedProps)),r&&(r=Pn)){if($d(i))throw lm(),Error(n(418));for(;r;)rm(i,r),r=lo(r.nextSibling)}if(am(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(n(317));e:{for(i=i.nextSibling,r=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"){if(r===0){Pn=lo(i.nextSibling);break e}r--}else c!=="$"&&c!=="$!"&&c!=="$?"||r++}i=i.nextSibling}Pn=null}}else Pn=Cn?lo(i.stateNode.nextSibling):null;return!0}function lm(){for(var i=Pn;i;)i=lo(i.nextSibling)}function Wr(){Pn=Cn=null,dt=!1}function Yd(i){Qn===null?Qn=[i]:Qn.push(i)}var HA=k.ReactCurrentBatchConfig;function la(i,r,c){if(i=c.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(n(309));var f=c.stateNode}if(!f)throw Error(n(147,i));var g=f,v=""+i;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===v?r.ref:(r=function(A){var b=g.refs;A===null?delete b[v]:b[v]=A},r._stringRef=v,r)}if(typeof i!="string")throw Error(n(284));if(!c._owner)throw Error(n(290,i))}return i}function tc(i,r){throw i=Object.prototype.toString.call(r),Error(n(31,i==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":i))}function cm(i){var r=i._init;return r(i._payload)}function um(i){function r(F,B){if(i){var U=F.deletions;U===null?(F.deletions=[B],F.flags|=16):U.push(B)}}function c(F,B){if(!i)return null;for(;B!==null;)r(F,B),B=B.sibling;return null}function f(F,B){for(F=new Map;B!==null;)B.key!==null?F.set(B.key,B):F.set(B.index,B),B=B.sibling;return F}function g(F,B){return F=To(F,B),F.index=0,F.sibling=null,F}function v(F,B,U){return F.index=U,i?(U=F.alternate,U!==null?(U=U.index,U<B?(F.flags|=2,B):U):(F.flags|=2,B)):(F.flags|=1048576,B)}function A(F){return i&&F.alternate===null&&(F.flags|=2),F}function b(F,B,U,he){return B===null||B.tag!==6?(B=Hf(U,F.mode,he),B.return=F,B):(B=g(B,U),B.return=F,B)}function O(F,B,U,he){var Re=U.type;return Re===R?le(F,B,U.props.children,he,U.key):B!==null&&(B.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===fe&&cm(Re)===B.type)?(he=g(B,U.props),he.ref=la(F,B,U),he.return=F,he):(he=Cc(U.type,U.key,U.props,null,F.mode,he),he.ref=la(F,B,U),he.return=F,he)}function Y(F,B,U,he){return B===null||B.tag!==4||B.stateNode.containerInfo!==U.containerInfo||B.stateNode.implementation!==U.implementation?(B=Ff(U,F.mode,he),B.return=F,B):(B=g(B,U.children||[]),B.return=F,B)}function le(F,B,U,he,Re){return B===null||B.tag!==7?(B=tr(U,F.mode,he,Re),B.return=F,B):(B=g(B,U),B.return=F,B)}function de(F,B,U){if(typeof B=="string"&&B!==""||typeof B=="number")return B=Hf(""+B,F.mode,U),B.return=F,B;if(typeof B=="object"&&B!==null){switch(B.$$typeof){case w:return U=Cc(B.type,B.key,B.props,null,F.mode,U),U.ref=la(F,null,B),U.return=F,U;case M:return B=Ff(B,F.mode,U),B.return=F,B;case fe:var he=B._init;return de(F,he(B._payload),U)}if(qt(B)||te(B))return B=tr(B,F.mode,U,null),B.return=F,B;tc(F,B)}return null}function ae(F,B,U,he){var Re=B!==null?B.key:null;if(typeof U=="string"&&U!==""||typeof U=="number")return Re!==null?null:b(F,B,""+U,he);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case w:return U.key===Re?O(F,B,U,he):null;case M:return U.key===Re?Y(F,B,U,he):null;case fe:return Re=U._init,ae(F,B,Re(U._payload),he)}if(qt(U)||te(U))return Re!==null?null:le(F,B,U,he,null);tc(F,U)}return null}function ve(F,B,U,he,Re){if(typeof he=="string"&&he!==""||typeof he=="number")return F=F.get(U)||null,b(B,F,""+he,Re);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case w:return F=F.get(he.key===null?U:he.key)||null,O(B,F,he,Re);case M:return F=F.get(he.key===null?U:he.key)||null,Y(B,F,he,Re);case fe:var Me=he._init;return ve(F,B,U,Me(he._payload),Re)}if(qt(he)||te(he))return F=F.get(U)||null,le(B,F,he,Re,null);tc(B,he)}return null}function Ee(F,B,U,he){for(var Re=null,Me=null,be=B,Be=B=0,xt=null;be!==null&&Be<U.length;Be++){be.index>Be?(xt=be,be=null):xt=be.sibling;var ze=ae(F,be,U[Be],he);if(ze===null){be===null&&(be=xt);break}i&&be&&ze.alternate===null&&r(F,be),B=v(ze,B,Be),Me===null?Re=ze:Me.sibling=ze,Me=ze,be=xt}if(Be===U.length)return c(F,be),dt&&Xo(F,Be),Re;if(be===null){for(;Be<U.length;Be++)be=de(F,U[Be],he),be!==null&&(B=v(be,B,Be),Me===null?Re=be:Me.sibling=be,Me=be);return dt&&Xo(F,Be),Re}for(be=f(F,be);Be<U.length;Be++)xt=ve(be,F,Be,U[Be],he),xt!==null&&(i&&xt.alternate!==null&&be.delete(xt.key===null?Be:xt.key),B=v(xt,B,Be),Me===null?Re=xt:Me.sibling=xt,Me=xt);return i&&be.forEach(function(Io){return r(F,Io)}),dt&&Xo(F,Be),Re}function we(F,B,U,he){var Re=te(U);if(typeof Re!="function")throw Error(n(150));if(U=Re.call(U),U==null)throw Error(n(151));for(var Me=Re=null,be=B,Be=B=0,xt=null,ze=U.next();be!==null&&!ze.done;Be++,ze=U.next()){be.index>Be?(xt=be,be=null):xt=be.sibling;var Io=ae(F,be,ze.value,he);if(Io===null){be===null&&(be=xt);break}i&&be&&Io.alternate===null&&r(F,be),B=v(Io,B,Be),Me===null?Re=Io:Me.sibling=Io,Me=Io,be=xt}if(ze.done)return c(F,be),dt&&Xo(F,Be),Re;if(be===null){for(;!ze.done;Be++,ze=U.next())ze=de(F,ze.value,he),ze!==null&&(B=v(ze,B,Be),Me===null?Re=ze:Me.sibling=ze,Me=ze);return dt&&Xo(F,Be),Re}for(be=f(F,be);!ze.done;Be++,ze=U.next())ze=ve(be,F,Be,ze.value,he),ze!==null&&(i&&ze.alternate!==null&&be.delete(ze.key===null?Be:ze.key),B=v(ze,B,Be),Me===null?Re=ze:Me.sibling=ze,Me=ze);return i&&be.forEach(function(g1){return r(F,g1)}),dt&&Xo(F,Be),Re}function It(F,B,U,he){if(typeof U=="object"&&U!==null&&U.type===R&&U.key===null&&(U=U.props.children),typeof U=="object"&&U!==null){switch(U.$$typeof){case w:e:{for(var Re=U.key,Me=B;Me!==null;){if(Me.key===Re){if(Re=U.type,Re===R){if(Me.tag===7){c(F,Me.sibling),B=g(Me,U.props.children),B.return=F,F=B;break e}}else if(Me.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===fe&&cm(Re)===Me.type){c(F,Me.sibling),B=g(Me,U.props),B.ref=la(F,Me,U),B.return=F,F=B;break e}c(F,Me);break}else r(F,Me);Me=Me.sibling}U.type===R?(B=tr(U.props.children,F.mode,he,U.key),B.return=F,F=B):(he=Cc(U.type,U.key,U.props,null,F.mode,he),he.ref=la(F,B,U),he.return=F,F=he)}return A(F);case M:e:{for(Me=U.key;B!==null;){if(B.key===Me)if(B.tag===4&&B.stateNode.containerInfo===U.containerInfo&&B.stateNode.implementation===U.implementation){c(F,B.sibling),B=g(B,U.children||[]),B.return=F,F=B;break e}else{c(F,B);break}else r(F,B);B=B.sibling}B=Ff(U,F.mode,he),B.return=F,F=B}return A(F);case fe:return Me=U._init,It(F,B,Me(U._payload),he)}if(qt(U))return Ee(F,B,U,he);if(te(U))return we(F,B,U,he);tc(F,U)}return typeof U=="string"&&U!==""||typeof U=="number"?(U=""+U,B!==null&&B.tag===6?(c(F,B.sibling),B=g(B,U),B.return=F,F=B):(c(F,B),B=Hf(U,F.mode,he),B.return=F,F=B),A(F)):c(F,B)}return It}var Yr=um(!0),dm=um(!1),nc=co(null),ic=null,jr=null,jd=null;function zd(){jd=jr=ic=null}function Xd(i){var r=nc.current;st(nc),i._currentValue=r}function Vd(i,r,c){for(;i!==null;){var f=i.alternate;if((i.childLanes&r)!==r?(i.childLanes|=r,f!==null&&(f.childLanes|=r)):f!==null&&(f.childLanes&r)!==r&&(f.childLanes|=r),i===c)break;i=i.return}}function zr(i,r){ic=i,jd=jr=null,i=i.dependencies,i!==null&&i.firstContext!==null&&((i.lanes&r)!==0&&(mn=!0),i.firstContext=null)}function Fn(i){var r=i._currentValue;if(jd!==i)if(i={context:i,memoizedValue:r,next:null},jr===null){if(ic===null)throw Error(n(308));jr=i,ic.dependencies={lanes:0,firstContext:i}}else jr=jr.next=i;return r}var Vo=null;function qd(i){Vo===null?Vo=[i]:Vo.push(i)}function fm(i,r,c,f){var g=r.interleaved;return g===null?(c.next=c,qd(r)):(c.next=g.next,g.next=c),r.interleaved=c,bi(i,f)}function bi(i,r){i.lanes|=r;var c=i.alternate;for(c!==null&&(c.lanes|=r),c=i,i=i.return;i!==null;)i.childLanes|=r,c=i.alternate,c!==null&&(c.childLanes|=r),c=i,i=i.return;return c.tag===3?c.stateNode:null}var ho=!1;function Zd(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hm(i,r){i=i.updateQueue,r.updateQueue===i&&(r.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Di(i,r){return{eventTime:i,lane:r,tag:0,payload:null,callback:null,next:null}}function po(i,r,c){var f=i.updateQueue;if(f===null)return null;if(f=f.shared,(je&2)!==0){var g=f.pending;return g===null?r.next=r:(r.next=g.next,g.next=r),f.pending=r,bi(i,c)}return g=f.interleaved,g===null?(r.next=r,qd(f)):(r.next=g.next,g.next=r),f.interleaved=r,bi(i,c)}function oc(i,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194240)!==0)){var f=r.lanes;f&=i.pendingLanes,c|=f,r.lanes=c,ud(i,c)}}function pm(i,r){var c=i.updateQueue,f=i.alternate;if(f!==null&&(f=f.updateQueue,c===f)){var g=null,v=null;if(c=c.firstBaseUpdate,c!==null){do{var A={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};v===null?g=v=A:v=v.next=A,c=c.next}while(c!==null);v===null?g=v=r:v=v.next=r}else g=v=r;c={baseState:f.baseState,firstBaseUpdate:g,lastBaseUpdate:v,shared:f.shared,effects:f.effects},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=r:i.next=r,c.lastBaseUpdate=r}function rc(i,r,c,f){var g=i.updateQueue;ho=!1;var v=g.firstBaseUpdate,A=g.lastBaseUpdate,b=g.shared.pending;if(b!==null){g.shared.pending=null;var O=b,Y=O.next;O.next=null,A===null?v=Y:A.next=Y,A=O;var le=i.alternate;le!==null&&(le=le.updateQueue,b=le.lastBaseUpdate,b!==A&&(b===null?le.firstBaseUpdate=Y:b.next=Y,le.lastBaseUpdate=O))}if(v!==null){var de=g.baseState;A=0,le=Y=O=null,b=v;do{var ae=b.lane,ve=b.eventTime;if((f&ae)===ae){le!==null&&(le=le.next={eventTime:ve,lane:0,tag:b.tag,payload:b.payload,callback:b.callback,next:null});e:{var Ee=i,we=b;switch(ae=r,ve=c,we.tag){case 1:if(Ee=we.payload,typeof Ee=="function"){de=Ee.call(ve,de,ae);break e}de=Ee;break e;case 3:Ee.flags=Ee.flags&-65537|128;case 0:if(Ee=we.payload,ae=typeof Ee=="function"?Ee.call(ve,de,ae):Ee,ae==null)break e;de=x({},de,ae);break e;case 2:ho=!0}}b.callback!==null&&b.lane!==0&&(i.flags|=64,ae=g.effects,ae===null?g.effects=[b]:ae.push(b))}else ve={eventTime:ve,lane:ae,tag:b.tag,payload:b.payload,callback:b.callback,next:null},le===null?(Y=le=ve,O=de):le=le.next=ve,A|=ae;if(b=b.next,b===null){if(b=g.shared.pending,b===null)break;ae=b,b=ae.next,ae.next=null,g.lastBaseUpdate=ae,g.shared.pending=null}}while(!0);if(le===null&&(O=de),g.baseState=O,g.firstBaseUpdate=Y,g.lastBaseUpdate=le,r=g.shared.interleaved,r!==null){g=r;do A|=g.lane,g=g.next;while(g!==r)}else v===null&&(g.shared.lanes=0);Ko|=A,i.lanes=A,i.memoizedState=de}}function gm(i,r,c){if(i=r.effects,r.effects=null,i!==null)for(r=0;r<i.length;r++){var f=i[r],g=f.callback;if(g!==null){if(f.callback=null,f=c,typeof g!="function")throw Error(n(191,g));g.call(f)}}}var ca={},hi=co(ca),ua=co(ca),da=co(ca);function qo(i){if(i===ca)throw Error(n(174));return i}function Kd(i,r){switch(nt(da,r),nt(ua,i),nt(hi,ca),i=r.nodeType,i){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:Qu(null,"");break;default:i=i===8?r.parentNode:r,r=i.namespaceURI||null,i=i.tagName,r=Qu(r,i)}st(hi),nt(hi,r)}function Xr(){st(hi),st(ua),st(da)}function mm(i){qo(da.current);var r=qo(hi.current),c=Qu(r,i.type);r!==c&&(nt(ua,i),nt(hi,c))}function Qd(i){ua.current===i&&(st(hi),st(ua))}var pt=co(0);function sc(i){for(var r=i;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if((r.flags&128)!==0)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Jd=[];function ef(){for(var i=0;i<Jd.length;i++)Jd[i]._workInProgressVersionPrimary=null;Jd.length=0}var ac=k.ReactCurrentDispatcher,tf=k.ReactCurrentBatchConfig,Zo=0,gt=null,kt=null,Ht=null,lc=!1,fa=!1,ha=0,FA=0;function Kt(){throw Error(n(321))}function nf(i,r){if(r===null)return!1;for(var c=0;c<r.length&&c<i.length;c++)if(!Kn(i[c],r[c]))return!1;return!0}function of(i,r,c,f,g,v){if(Zo=v,gt=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,ac.current=i===null||i.memoizedState===null?GA:$A,i=c(f,g),fa){v=0;do{if(fa=!1,ha=0,25<=v)throw Error(n(301));v+=1,Ht=kt=null,r.updateQueue=null,ac.current=WA,i=c(f,g)}while(fa)}if(ac.current=dc,r=kt!==null&&kt.next!==null,Zo=0,Ht=kt=gt=null,lc=!1,r)throw Error(n(300));return i}function rf(){var i=ha!==0;return ha=0,i}function pi(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ht===null?gt.memoizedState=Ht=i:Ht=Ht.next=i,Ht}function xn(){if(kt===null){var i=gt.alternate;i=i!==null?i.memoizedState:null}else i=kt.next;var r=Ht===null?gt.memoizedState:Ht.next;if(r!==null)Ht=r,kt=i;else{if(i===null)throw Error(n(310));kt=i,i={memoizedState:kt.memoizedState,baseState:kt.baseState,baseQueue:kt.baseQueue,queue:kt.queue,next:null},Ht===null?gt.memoizedState=Ht=i:Ht=Ht.next=i}return Ht}function pa(i,r){return typeof r=="function"?r(i):r}function sf(i){var r=xn(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=i;var f=kt,g=f.baseQueue,v=c.pending;if(v!==null){if(g!==null){var A=g.next;g.next=v.next,v.next=A}f.baseQueue=g=v,c.pending=null}if(g!==null){v=g.next,f=f.baseState;var b=A=null,O=null,Y=v;do{var le=Y.lane;if((Zo&le)===le)O!==null&&(O=O.next={lane:0,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),f=Y.hasEagerState?Y.eagerState:i(f,Y.action);else{var de={lane:le,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null};O===null?(b=O=de,A=f):O=O.next=de,gt.lanes|=le,Ko|=le}Y=Y.next}while(Y!==null&&Y!==v);O===null?A=f:O.next=b,Kn(f,r.memoizedState)||(mn=!0),r.memoizedState=f,r.baseState=A,r.baseQueue=O,c.lastRenderedState=f}if(i=c.interleaved,i!==null){g=i;do v=g.lane,gt.lanes|=v,Ko|=v,g=g.next;while(g!==i)}else g===null&&(c.lanes=0);return[r.memoizedState,c.dispatch]}function af(i){var r=xn(),c=r.queue;if(c===null)throw Error(n(311));c.lastRenderedReducer=i;var f=c.dispatch,g=c.pending,v=r.memoizedState;if(g!==null){c.pending=null;var A=g=g.next;do v=i(v,A.action),A=A.next;while(A!==g);Kn(v,r.memoizedState)||(mn=!0),r.memoizedState=v,r.baseQueue===null&&(r.baseState=v),c.lastRenderedState=v}return[v,f]}function ym(){}function vm(i,r){var c=gt,f=xn(),g=r(),v=!Kn(f.memoizedState,g);if(v&&(f.memoizedState=g,mn=!0),f=f.queue,lf(Im.bind(null,c,f,i),[i]),f.getSnapshot!==r||v||Ht!==null&&Ht.memoizedState.tag&1){if(c.flags|=2048,ga(9,Tm.bind(null,c,f,g,r),void 0,null),Ft===null)throw Error(n(349));(Zo&30)!==0||Sm(c,r,g)}return g}function Sm(i,r,c){i.flags|=16384,i={getSnapshot:r,value:c},r=gt.updateQueue,r===null?(r={lastEffect:null,stores:null},gt.updateQueue=r,r.stores=[i]):(c=r.stores,c===null?r.stores=[i]:c.push(i))}function Tm(i,r,c,f){r.value=c,r.getSnapshot=f,Am(r)&&Em(i)}function Im(i,r,c){return c(function(){Am(r)&&Em(i)})}function Am(i){var r=i.getSnapshot;i=i.value;try{var c=r();return!Kn(i,c)}catch{return!0}}function Em(i){var r=bi(i,1);r!==null&&ni(r,i,1,-1)}function wm(i){var r=pi();return typeof i=="function"&&(i=i()),r.memoizedState=r.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:pa,lastRenderedState:i},r.queue=i,i=i.dispatch=UA.bind(null,gt,i),[r.memoizedState,i]}function ga(i,r,c,f){return i={tag:i,create:r,destroy:c,deps:f,next:null},r=gt.updateQueue,r===null?(r={lastEffect:null,stores:null},gt.updateQueue=r,r.lastEffect=i.next=i):(c=r.lastEffect,c===null?r.lastEffect=i.next=i:(f=c.next,c.next=i,i.next=f,r.lastEffect=i)),i}function Cm(){return xn().memoizedState}function cc(i,r,c,f){var g=pi();gt.flags|=i,g.memoizedState=ga(1|r,c,void 0,f===void 0?null:f)}function uc(i,r,c,f){var g=xn();f=f===void 0?null:f;var v=void 0;if(kt!==null){var A=kt.memoizedState;if(v=A.destroy,f!==null&&nf(f,A.deps)){g.memoizedState=ga(r,c,v,f);return}}gt.flags|=i,g.memoizedState=ga(1|r,c,v,f)}function Pm(i,r){return cc(8390656,8,i,r)}function lf(i,r){return uc(2048,8,i,r)}function _m(i,r){return uc(4,2,i,r)}function Rm(i,r){return uc(4,4,i,r)}function km(i,r){if(typeof r=="function")return i=i(),r(i),function(){r(null)};if(r!=null)return i=i(),r.current=i,function(){r.current=null}}function Mm(i,r,c){return c=c!=null?c.concat([i]):null,uc(4,4,km.bind(null,r,i),c)}function cf(){}function bm(i,r){var c=xn();r=r===void 0?null:r;var f=c.memoizedState;return f!==null&&r!==null&&nf(r,f[1])?f[0]:(c.memoizedState=[i,r],i)}function Dm(i,r){var c=xn();r=r===void 0?null:r;var f=c.memoizedState;return f!==null&&r!==null&&nf(r,f[1])?f[0]:(i=i(),c.memoizedState=[i,r],i)}function Om(i,r,c){return(Zo&21)===0?(i.baseState&&(i.baseState=!1,mn=!0),i.memoizedState=c):(Kn(c,r)||(c=cg(),gt.lanes|=c,Ko|=c,i.baseState=!0),r)}function xA(i,r){var c=Ze;Ze=c!==0&&4>c?c:4,i(!0);var f=tf.transition;tf.transition={};try{i(!1),r()}finally{Ze=c,tf.transition=f}}function Nm(){return xn().memoizedState}function LA(i,r,c){var f=vo(i);if(c={lane:f,action:c,hasEagerState:!1,eagerState:null,next:null},Bm(i))Hm(r,c);else if(c=fm(i,r,c,f),c!==null){var g=an();ni(c,i,f,g),Fm(c,r,f)}}function UA(i,r,c){var f=vo(i),g={lane:f,action:c,hasEagerState:!1,eagerState:null,next:null};if(Bm(i))Hm(r,g);else{var v=i.alternate;if(i.lanes===0&&(v===null||v.lanes===0)&&(v=r.lastRenderedReducer,v!==null))try{var A=r.lastRenderedState,b=v(A,c);if(g.hasEagerState=!0,g.eagerState=b,Kn(b,A)){var O=r.interleaved;O===null?(g.next=g,qd(r)):(g.next=O.next,O.next=g),r.interleaved=g;return}}catch{}finally{}c=fm(i,r,g,f),c!==null&&(g=an(),ni(c,i,f,g),Fm(c,r,f))}}function Bm(i){var r=i.alternate;return i===gt||r!==null&&r===gt}function Hm(i,r){fa=lc=!0;var c=i.pending;c===null?r.next=r:(r.next=c.next,c.next=r),i.pending=r}function Fm(i,r,c){if((c&4194240)!==0){var f=r.lanes;f&=i.pendingLanes,c|=f,r.lanes=c,ud(i,c)}}var dc={readContext:Fn,useCallback:Kt,useContext:Kt,useEffect:Kt,useImperativeHandle:Kt,useInsertionEffect:Kt,useLayoutEffect:Kt,useMemo:Kt,useReducer:Kt,useRef:Kt,useState:Kt,useDebugValue:Kt,useDeferredValue:Kt,useTransition:Kt,useMutableSource:Kt,useSyncExternalStore:Kt,useId:Kt,unstable_isNewReconciler:!1},GA={readContext:Fn,useCallback:function(i,r){return pi().memoizedState=[i,r===void 0?null:r],i},useContext:Fn,useEffect:Pm,useImperativeHandle:function(i,r,c){return c=c!=null?c.concat([i]):null,cc(4194308,4,km.bind(null,r,i),c)},useLayoutEffect:function(i,r){return cc(4194308,4,i,r)},useInsertionEffect:function(i,r){return cc(4,2,i,r)},useMemo:function(i,r){var c=pi();return r=r===void 0?null:r,i=i(),c.memoizedState=[i,r],i},useReducer:function(i,r,c){var f=pi();return r=c!==void 0?c(r):r,f.memoizedState=f.baseState=r,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:r},f.queue=i,i=i.dispatch=LA.bind(null,gt,i),[f.memoizedState,i]},useRef:function(i){var r=pi();return i={current:i},r.memoizedState=i},useState:wm,useDebugValue:cf,useDeferredValue:function(i){return pi().memoizedState=i},useTransition:function(){var i=wm(!1),r=i[0];return i=xA.bind(null,i[1]),pi().memoizedState=i,[r,i]},useMutableSource:function(){},useSyncExternalStore:function(i,r,c){var f=gt,g=pi();if(dt){if(c===void 0)throw Error(n(407));c=c()}else{if(c=r(),Ft===null)throw Error(n(349));(Zo&30)!==0||Sm(f,r,c)}g.memoizedState=c;var v={value:c,getSnapshot:r};return g.queue=v,Pm(Im.bind(null,f,v,i),[i]),f.flags|=2048,ga(9,Tm.bind(null,f,v,c,r),void 0,null),c},useId:function(){var i=pi(),r=Ft.identifierPrefix;if(dt){var c=Mi,f=ki;c=(f&~(1<<32-Zn(f)-1)).toString(32)+c,r=":"+r+"R"+c,c=ha++,0<c&&(r+="H"+c.toString(32)),r+=":"}else c=FA++,r=":"+r+"r"+c.toString(32)+":";return i.memoizedState=r},unstable_isNewReconciler:!1},$A={readContext:Fn,useCallback:bm,useContext:Fn,useEffect:lf,useImperativeHandle:Mm,useInsertionEffect:_m,useLayoutEffect:Rm,useMemo:Dm,useReducer:sf,useRef:Cm,useState:function(){return sf(pa)},useDebugValue:cf,useDeferredValue:function(i){var r=xn();return Om(r,kt.memoizedState,i)},useTransition:function(){var i=sf(pa)[0],r=xn().memoizedState;return[i,r]},useMutableSource:ym,useSyncExternalStore:vm,useId:Nm,unstable_isNewReconciler:!1},WA={readContext:Fn,useCallback:bm,useContext:Fn,useEffect:lf,useImperativeHandle:Mm,useInsertionEffect:_m,useLayoutEffect:Rm,useMemo:Dm,useReducer:af,useRef:Cm,useState:function(){return af(pa)},useDebugValue:cf,useDeferredValue:function(i){var r=xn();return kt===null?r.memoizedState=i:Om(r,kt.memoizedState,i)},useTransition:function(){var i=af(pa)[0],r=xn().memoizedState;return[i,r]},useMutableSource:ym,useSyncExternalStore:vm,useId:Nm,unstable_isNewReconciler:!1};function Jn(i,r){if(i&&i.defaultProps){r=x({},r),i=i.defaultProps;for(var c in i)r[c]===void 0&&(r[c]=i[c]);return r}return r}function uf(i,r,c,f){r=i.memoizedState,c=c(f,r),c=c==null?r:x({},r,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var fc={isMounted:function(i){return(i=i._reactInternals)?Wo(i)===i:!1},enqueueSetState:function(i,r,c){i=i._reactInternals;var f=an(),g=vo(i),v=Di(f,g);v.payload=r,c!=null&&(v.callback=c),r=po(i,v,g),r!==null&&(ni(r,i,g,f),oc(r,i,g))},enqueueReplaceState:function(i,r,c){i=i._reactInternals;var f=an(),g=vo(i),v=Di(f,g);v.tag=1,v.payload=r,c!=null&&(v.callback=c),r=po(i,v,g),r!==null&&(ni(r,i,g,f),oc(r,i,g))},enqueueForceUpdate:function(i,r){i=i._reactInternals;var c=an(),f=vo(i),g=Di(c,f);g.tag=2,r!=null&&(g.callback=r),r=po(i,g,f),r!==null&&(ni(r,i,f,c),oc(r,i,f))}};function xm(i,r,c,f,g,v,A){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(f,v,A):r.prototype&&r.prototype.isPureReactComponent?!ta(c,f)||!ta(g,v):!0}function Lm(i,r,c){var f=!1,g=uo,v=r.contextType;return typeof v=="object"&&v!==null?v=Fn(v):(g=gn(r)?jo:Zt.current,f=r.contextTypes,v=(f=f!=null)?Ur(i,g):uo),r=new r(c,v),i.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=fc,i.stateNode=r,r._reactInternals=i,f&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=g,i.__reactInternalMemoizedMaskedChildContext=v),r}function Um(i,r,c,f){i=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,f),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,f),r.state!==i&&fc.enqueueReplaceState(r,r.state,null)}function df(i,r,c,f){var g=i.stateNode;g.props=c,g.state=i.memoizedState,g.refs={},Zd(i);var v=r.contextType;typeof v=="object"&&v!==null?g.context=Fn(v):(v=gn(r)?jo:Zt.current,g.context=Ur(i,v)),g.state=i.memoizedState,v=r.getDerivedStateFromProps,typeof v=="function"&&(uf(i,r,v,c),g.state=i.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof g.getSnapshotBeforeUpdate=="function"||typeof g.UNSAFE_componentWillMount!="function"&&typeof g.componentWillMount!="function"||(r=g.state,typeof g.componentWillMount=="function"&&g.componentWillMount(),typeof g.UNSAFE_componentWillMount=="function"&&g.UNSAFE_componentWillMount(),r!==g.state&&fc.enqueueReplaceState(g,g.state,null),rc(i,c,g,f),g.state=i.memoizedState),typeof g.componentDidMount=="function"&&(i.flags|=4194308)}function Vr(i,r){try{var c="",f=r;do c+=ne(f),f=f.return;while(f);var g=c}catch(v){g=`
Error generating stack: `+v.message+`
`+v.stack}return{value:i,source:r,stack:g,digest:null}}function ff(i,r,c){return{value:i,source:null,stack:c??null,digest:r??null}}function hf(i,r){try{console.error(r.value)}catch(c){setTimeout(function(){throw c})}}var YA=typeof WeakMap=="function"?WeakMap:Map;function Gm(i,r,c){c=Di(-1,c),c.tag=3,c.payload={element:null};var f=r.value;return c.callback=function(){Sc||(Sc=!0,Rf=f),hf(i,r)},c}function $m(i,r,c){c=Di(-1,c),c.tag=3;var f=i.type.getDerivedStateFromError;if(typeof f=="function"){var g=r.value;c.payload=function(){return f(g)},c.callback=function(){hf(i,r)}}var v=i.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(c.callback=function(){hf(i,r),typeof f!="function"&&(mo===null?mo=new Set([this]):mo.add(this));var A=r.stack;this.componentDidCatch(r.value,{componentStack:A!==null?A:""})}),c}function Wm(i,r,c){var f=i.pingCache;if(f===null){f=i.pingCache=new YA;var g=new Set;f.set(r,g)}else g=f.get(r),g===void 0&&(g=new Set,f.set(r,g));g.has(c)||(g.add(c),i=o1.bind(null,i,r,c),r.then(i,i))}function Ym(i){do{var r;if((r=i.tag===13)&&(r=i.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return i;i=i.return}while(i!==null);return null}function jm(i,r,c,f,g){return(i.mode&1)===0?(i===r?i.flags|=65536:(i.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(r=Di(-1,1),r.tag=2,po(c,r,1))),c.lanes|=1),i):(i.flags|=65536,i.lanes=g,i)}var jA=k.ReactCurrentOwner,mn=!1;function sn(i,r,c,f){r.child=i===null?dm(r,null,c,f):Yr(r,i.child,c,f)}function zm(i,r,c,f,g){c=c.render;var v=r.ref;return zr(r,g),f=of(i,r,c,f,v,g),c=rf(),i!==null&&!mn?(r.updateQueue=i.updateQueue,r.flags&=-2053,i.lanes&=~g,Oi(i,r,g)):(dt&&c&&Ud(r),r.flags|=1,sn(i,r,f,g),r.child)}function Xm(i,r,c,f,g){if(i===null){var v=c.type;return typeof v=="function"&&!Bf(v)&&v.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(r.tag=15,r.type=v,Vm(i,r,v,f,g)):(i=Cc(c.type,null,f,r,r.mode,g),i.ref=r.ref,i.return=r,r.child=i)}if(v=i.child,(i.lanes&g)===0){var A=v.memoizedProps;if(c=c.compare,c=c!==null?c:ta,c(A,f)&&i.ref===r.ref)return Oi(i,r,g)}return r.flags|=1,i=To(v,f),i.ref=r.ref,i.return=r,r.child=i}function Vm(i,r,c,f,g){if(i!==null){var v=i.memoizedProps;if(ta(v,f)&&i.ref===r.ref)if(mn=!1,r.pendingProps=f=v,(i.lanes&g)!==0)(i.flags&131072)!==0&&(mn=!0);else return r.lanes=i.lanes,Oi(i,r,g)}return pf(i,r,c,f,g)}function qm(i,r,c){var f=r.pendingProps,g=f.children,v=i!==null?i.memoizedState:null;if(f.mode==="hidden")if((r.mode&1)===0)r.memoizedState={baseLanes:0,cachePool:null,transitions:null},nt(Zr,_n),_n|=c;else{if((c&1073741824)===0)return i=v!==null?v.baseLanes|c:c,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:i,cachePool:null,transitions:null},r.updateQueue=null,nt(Zr,_n),_n|=i,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=v!==null?v.baseLanes:c,nt(Zr,_n),_n|=f}else v!==null?(f=v.baseLanes|c,r.memoizedState=null):f=c,nt(Zr,_n),_n|=f;return sn(i,r,g,c),r.child}function Zm(i,r){var c=r.ref;(i===null&&c!==null||i!==null&&i.ref!==c)&&(r.flags|=512,r.flags|=2097152)}function pf(i,r,c,f,g){var v=gn(c)?jo:Zt.current;return v=Ur(r,v),zr(r,g),c=of(i,r,c,f,v,g),f=rf(),i!==null&&!mn?(r.updateQueue=i.updateQueue,r.flags&=-2053,i.lanes&=~g,Oi(i,r,g)):(dt&&f&&Ud(r),r.flags|=1,sn(i,r,c,g),r.child)}function Km(i,r,c,f,g){if(gn(c)){var v=!0;Zl(r)}else v=!1;if(zr(r,g),r.stateNode===null)pc(i,r),Lm(r,c,f),df(r,c,f,g),f=!0;else if(i===null){var A=r.stateNode,b=r.memoizedProps;A.props=b;var O=A.context,Y=c.contextType;typeof Y=="object"&&Y!==null?Y=Fn(Y):(Y=gn(c)?jo:Zt.current,Y=Ur(r,Y));var le=c.getDerivedStateFromProps,de=typeof le=="function"||typeof A.getSnapshotBeforeUpdate=="function";de||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(b!==f||O!==Y)&&Um(r,A,f,Y),ho=!1;var ae=r.memoizedState;A.state=ae,rc(r,f,A,g),O=r.memoizedState,b!==f||ae!==O||pn.current||ho?(typeof le=="function"&&(uf(r,c,le,f),O=r.memoizedState),(b=ho||xm(r,c,b,f,ae,O,Y))?(de||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount()),typeof A.componentDidMount=="function"&&(r.flags|=4194308)):(typeof A.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=f,r.memoizedState=O),A.props=f,A.state=O,A.context=Y,f=b):(typeof A.componentDidMount=="function"&&(r.flags|=4194308),f=!1)}else{A=r.stateNode,hm(i,r),b=r.memoizedProps,Y=r.type===r.elementType?b:Jn(r.type,b),A.props=Y,de=r.pendingProps,ae=A.context,O=c.contextType,typeof O=="object"&&O!==null?O=Fn(O):(O=gn(c)?jo:Zt.current,O=Ur(r,O));var ve=c.getDerivedStateFromProps;(le=typeof ve=="function"||typeof A.getSnapshotBeforeUpdate=="function")||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(b!==de||ae!==O)&&Um(r,A,f,O),ho=!1,ae=r.memoizedState,A.state=ae,rc(r,f,A,g);var Ee=r.memoizedState;b!==de||ae!==Ee||pn.current||ho?(typeof ve=="function"&&(uf(r,c,ve,f),Ee=r.memoizedState),(Y=ho||xm(r,c,Y,f,ae,Ee,O)||!1)?(le||typeof A.UNSAFE_componentWillUpdate!="function"&&typeof A.componentWillUpdate!="function"||(typeof A.componentWillUpdate=="function"&&A.componentWillUpdate(f,Ee,O),typeof A.UNSAFE_componentWillUpdate=="function"&&A.UNSAFE_componentWillUpdate(f,Ee,O)),typeof A.componentDidUpdate=="function"&&(r.flags|=4),typeof A.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof A.componentDidUpdate!="function"||b===i.memoizedProps&&ae===i.memoizedState||(r.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||b===i.memoizedProps&&ae===i.memoizedState||(r.flags|=1024),r.memoizedProps=f,r.memoizedState=Ee),A.props=f,A.state=Ee,A.context=O,f=Y):(typeof A.componentDidUpdate!="function"||b===i.memoizedProps&&ae===i.memoizedState||(r.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||b===i.memoizedProps&&ae===i.memoizedState||(r.flags|=1024),f=!1)}return gf(i,r,c,f,v,g)}function gf(i,r,c,f,g,v){Zm(i,r);var A=(r.flags&128)!==0;if(!f&&!A)return g&&nm(r,c,!1),Oi(i,r,v);f=r.stateNode,jA.current=r;var b=A&&typeof c.getDerivedStateFromError!="function"?null:f.render();return r.flags|=1,i!==null&&A?(r.child=Yr(r,i.child,null,v),r.child=Yr(r,null,b,v)):sn(i,r,b,v),r.memoizedState=f.state,g&&nm(r,c,!0),r.child}function Qm(i){var r=i.stateNode;r.pendingContext?em(i,r.pendingContext,r.pendingContext!==r.context):r.context&&em(i,r.context,!1),Kd(i,r.containerInfo)}function Jm(i,r,c,f,g){return Wr(),Yd(g),r.flags|=256,sn(i,r,c,f),r.child}var mf={dehydrated:null,treeContext:null,retryLane:0};function yf(i){return{baseLanes:i,cachePool:null,transitions:null}}function e0(i,r,c){var f=r.pendingProps,g=pt.current,v=!1,A=(r.flags&128)!==0,b;if((b=A)||(b=i!==null&&i.memoizedState===null?!1:(g&2)!==0),b?(v=!0,r.flags&=-129):(i===null||i.memoizedState!==null)&&(g|=1),nt(pt,g&1),i===null)return Wd(r),i=r.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?((r.mode&1)===0?r.lanes=1:i.data==="$!"?r.lanes=8:r.lanes=1073741824,null):(A=f.children,i=f.fallback,v?(f=r.mode,v=r.child,A={mode:"hidden",children:A},(f&1)===0&&v!==null?(v.childLanes=0,v.pendingProps=A):v=Pc(A,f,0,null),i=tr(i,f,c,null),v.return=r,i.return=r,v.sibling=i,r.child=v,r.child.memoizedState=yf(c),r.memoizedState=mf,i):vf(r,A));if(g=i.memoizedState,g!==null&&(b=g.dehydrated,b!==null))return zA(i,r,A,f,b,g,c);if(v){v=f.fallback,A=r.mode,g=i.child,b=g.sibling;var O={mode:"hidden",children:f.children};return(A&1)===0&&r.child!==g?(f=r.child,f.childLanes=0,f.pendingProps=O,r.deletions=null):(f=To(g,O),f.subtreeFlags=g.subtreeFlags&14680064),b!==null?v=To(b,v):(v=tr(v,A,c,null),v.flags|=2),v.return=r,f.return=r,f.sibling=v,r.child=f,f=v,v=r.child,A=i.child.memoizedState,A=A===null?yf(c):{baseLanes:A.baseLanes|c,cachePool:null,transitions:A.transitions},v.memoizedState=A,v.childLanes=i.childLanes&~c,r.memoizedState=mf,f}return v=i.child,i=v.sibling,f=To(v,{mode:"visible",children:f.children}),(r.mode&1)===0&&(f.lanes=c),f.return=r,f.sibling=null,i!==null&&(c=r.deletions,c===null?(r.deletions=[i],r.flags|=16):c.push(i)),r.child=f,r.memoizedState=null,f}function vf(i,r){return r=Pc({mode:"visible",children:r},i.mode,0,null),r.return=i,i.child=r}function hc(i,r,c,f){return f!==null&&Yd(f),Yr(r,i.child,null,c),i=vf(r,r.pendingProps.children),i.flags|=2,r.memoizedState=null,i}function zA(i,r,c,f,g,v,A){if(c)return r.flags&256?(r.flags&=-257,f=ff(Error(n(422))),hc(i,r,A,f)):r.memoizedState!==null?(r.child=i.child,r.flags|=128,null):(v=f.fallback,g=r.mode,f=Pc({mode:"visible",children:f.children},g,0,null),v=tr(v,g,A,null),v.flags|=2,f.return=r,v.return=r,f.sibling=v,r.child=f,(r.mode&1)!==0&&Yr(r,i.child,null,A),r.child.memoizedState=yf(A),r.memoizedState=mf,v);if((r.mode&1)===0)return hc(i,r,A,null);if(g.data==="$!"){if(f=g.nextSibling&&g.nextSibling.dataset,f)var b=f.dgst;return f=b,v=Error(n(419)),f=ff(v,f,void 0),hc(i,r,A,f)}if(b=(A&i.childLanes)!==0,mn||b){if(f=Ft,f!==null){switch(A&-A){case 4:g=2;break;case 16:g=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:g=32;break;case 536870912:g=268435456;break;default:g=0}g=(g&(f.suspendedLanes|A))!==0?0:g,g!==0&&g!==v.retryLane&&(v.retryLane=g,bi(i,g),ni(f,i,g,-1))}return Nf(),f=ff(Error(n(421))),hc(i,r,A,f)}return g.data==="$?"?(r.flags|=128,r.child=i.child,r=r1.bind(null,i),g._reactRetry=r,null):(i=v.treeContext,Pn=lo(g.nextSibling),Cn=r,dt=!0,Qn=null,i!==null&&(Bn[Hn++]=ki,Bn[Hn++]=Mi,Bn[Hn++]=zo,ki=i.id,Mi=i.overflow,zo=r),r=vf(r,f.children),r.flags|=4096,r)}function t0(i,r,c){i.lanes|=r;var f=i.alternate;f!==null&&(f.lanes|=r),Vd(i.return,r,c)}function Sf(i,r,c,f,g){var v=i.memoizedState;v===null?i.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:f,tail:c,tailMode:g}:(v.isBackwards=r,v.rendering=null,v.renderingStartTime=0,v.last=f,v.tail=c,v.tailMode=g)}function n0(i,r,c){var f=r.pendingProps,g=f.revealOrder,v=f.tail;if(sn(i,r,f.children,c),f=pt.current,(f&2)!==0)f=f&1|2,r.flags|=128;else{if(i!==null&&(i.flags&128)!==0)e:for(i=r.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&t0(i,c,r);else if(i.tag===19)t0(i,c,r);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===r)break e;for(;i.sibling===null;){if(i.return===null||i.return===r)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}f&=1}if(nt(pt,f),(r.mode&1)===0)r.memoizedState=null;else switch(g){case"forwards":for(c=r.child,g=null;c!==null;)i=c.alternate,i!==null&&sc(i)===null&&(g=c),c=c.sibling;c=g,c===null?(g=r.child,r.child=null):(g=c.sibling,c.sibling=null),Sf(r,!1,g,c,v);break;case"backwards":for(c=null,g=r.child,r.child=null;g!==null;){if(i=g.alternate,i!==null&&sc(i)===null){r.child=g;break}i=g.sibling,g.sibling=c,c=g,g=i}Sf(r,!0,c,null,v);break;case"together":Sf(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function pc(i,r){(r.mode&1)===0&&i!==null&&(i.alternate=null,r.alternate=null,r.flags|=2)}function Oi(i,r,c){if(i!==null&&(r.dependencies=i.dependencies),Ko|=r.lanes,(c&r.childLanes)===0)return null;if(i!==null&&r.child!==i.child)throw Error(n(153));if(r.child!==null){for(i=r.child,c=To(i,i.pendingProps),r.child=c,c.return=r;i.sibling!==null;)i=i.sibling,c=c.sibling=To(i,i.pendingProps),c.return=r;c.sibling=null}return r.child}function XA(i,r,c){switch(r.tag){case 3:Qm(r),Wr();break;case 5:mm(r);break;case 1:gn(r.type)&&Zl(r);break;case 4:Kd(r,r.stateNode.containerInfo);break;case 10:var f=r.type._context,g=r.memoizedProps.value;nt(nc,f._currentValue),f._currentValue=g;break;case 13:if(f=r.memoizedState,f!==null)return f.dehydrated!==null?(nt(pt,pt.current&1),r.flags|=128,null):(c&r.child.childLanes)!==0?e0(i,r,c):(nt(pt,pt.current&1),i=Oi(i,r,c),i!==null?i.sibling:null);nt(pt,pt.current&1);break;case 19:if(f=(c&r.childLanes)!==0,(i.flags&128)!==0){if(f)return n0(i,r,c);r.flags|=128}if(g=r.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),nt(pt,pt.current),f)break;return null;case 22:case 23:return r.lanes=0,qm(i,r,c)}return Oi(i,r,c)}var i0,Tf,o0,r0;i0=function(i,r){for(var c=r.child;c!==null;){if(c.tag===5||c.tag===6)i.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===r)break;for(;c.sibling===null;){if(c.return===null||c.return===r)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},Tf=function(){},o0=function(i,r,c,f){var g=i.memoizedProps;if(g!==f){i=r.stateNode,qo(hi.current);var v=null;switch(c){case"input":g=Le(i,g),f=Le(i,f),v=[];break;case"select":g=x({},g,{value:void 0}),f=x({},f,{value:void 0}),v=[];break;case"textarea":g=to(i,g),f=to(i,f),v=[];break;default:typeof g.onClick!="function"&&typeof f.onClick=="function"&&(i.onclick=Xl)}Ju(c,f);var A;c=null;for(Y in g)if(!f.hasOwnProperty(Y)&&g.hasOwnProperty(Y)&&g[Y]!=null)if(Y==="style"){var b=g[Y];for(A in b)b.hasOwnProperty(A)&&(c||(c={}),c[A]="")}else Y!=="dangerouslySetInnerHTML"&&Y!=="children"&&Y!=="suppressContentEditableWarning"&&Y!=="suppressHydrationWarning"&&Y!=="autoFocus"&&(s.hasOwnProperty(Y)?v||(v=[]):(v=v||[]).push(Y,null));for(Y in f){var O=f[Y];if(b=g!=null?g[Y]:void 0,f.hasOwnProperty(Y)&&O!==b&&(O!=null||b!=null))if(Y==="style")if(b){for(A in b)!b.hasOwnProperty(A)||O&&O.hasOwnProperty(A)||(c||(c={}),c[A]="");for(A in O)O.hasOwnProperty(A)&&b[A]!==O[A]&&(c||(c={}),c[A]=O[A])}else c||(v||(v=[]),v.push(Y,c)),c=O;else Y==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,b=b?b.__html:void 0,O!=null&&b!==O&&(v=v||[]).push(Y,O)):Y==="children"?typeof O!="string"&&typeof O!="number"||(v=v||[]).push(Y,""+O):Y!=="suppressContentEditableWarning"&&Y!=="suppressHydrationWarning"&&(s.hasOwnProperty(Y)?(O!=null&&Y==="onScroll"&&rt("scroll",i),v||b===O||(v=[])):(v=v||[]).push(Y,O))}c&&(v=v||[]).push("style",c);var Y=v;(r.updateQueue=Y)&&(r.flags|=4)}},r0=function(i,r,c,f){c!==f&&(r.flags|=4)};function ma(i,r){if(!dt)switch(i.tailMode){case"hidden":r=i.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var f=null;c!==null;)c.alternate!==null&&(f=c),c=c.sibling;f===null?r||i.tail===null?i.tail=null:i.tail.sibling=null:f.sibling=null}}function Qt(i){var r=i.alternate!==null&&i.alternate.child===i.child,c=0,f=0;if(r)for(var g=i.child;g!==null;)c|=g.lanes|g.childLanes,f|=g.subtreeFlags&14680064,f|=g.flags&14680064,g.return=i,g=g.sibling;else for(g=i.child;g!==null;)c|=g.lanes|g.childLanes,f|=g.subtreeFlags,f|=g.flags,g.return=i,g=g.sibling;return i.subtreeFlags|=f,i.childLanes=c,r}function VA(i,r,c){var f=r.pendingProps;switch(Gd(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qt(r),null;case 1:return gn(r.type)&&ql(),Qt(r),null;case 3:return f=r.stateNode,Xr(),st(pn),st(Zt),ef(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(i===null||i.child===null)&&(ec(r)?r.flags|=4:i===null||i.memoizedState.isDehydrated&&(r.flags&256)===0||(r.flags|=1024,Qn!==null&&(bf(Qn),Qn=null))),Tf(i,r),Qt(r),null;case 5:Qd(r);var g=qo(da.current);if(c=r.type,i!==null&&r.stateNode!=null)o0(i,r,c,f,g),i.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!f){if(r.stateNode===null)throw Error(n(166));return Qt(r),null}if(i=qo(hi.current),ec(r)){f=r.stateNode,c=r.type;var v=r.memoizedProps;switch(f[fi]=r,f[sa]=v,i=(r.mode&1)!==0,c){case"dialog":rt("cancel",f),rt("close",f);break;case"iframe":case"object":case"embed":rt("load",f);break;case"video":case"audio":for(g=0;g<ia.length;g++)rt(ia[g],f);break;case"source":rt("error",f);break;case"img":case"image":case"link":rt("error",f),rt("load",f);break;case"details":rt("toggle",f);break;case"input":He(f,v),rt("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!v.multiple},rt("invalid",f);break;case"textarea":Bs(f,v),rt("invalid",f)}Ju(c,v),g=null;for(var A in v)if(v.hasOwnProperty(A)){var b=v[A];A==="children"?typeof b=="string"?f.textContent!==b&&(v.suppressHydrationWarning!==!0&&zl(f.textContent,b,i),g=["children",b]):typeof b=="number"&&f.textContent!==""+b&&(v.suppressHydrationWarning!==!0&&zl(f.textContent,b,i),g=["children",""+b]):s.hasOwnProperty(A)&&b!=null&&A==="onScroll"&&rt("scroll",f)}switch(c){case"input":Ae(f),Et(f,v,!0);break;case"textarea":Ae(f),Fs(f);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(f.onclick=Xl)}f=g,r.updateQueue=f,f!==null&&(r.flags|=4)}else{A=g.nodeType===9?g:g.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=$o(c)),i==="http://www.w3.org/1999/xhtml"?c==="script"?(i=A.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof f.is=="string"?i=A.createElement(c,{is:f.is}):(i=A.createElement(c),c==="select"&&(A=i,f.multiple?A.multiple=!0:f.size&&(A.size=f.size))):i=A.createElementNS(i,c),i[fi]=r,i[sa]=f,i0(i,r,!1,!1),r.stateNode=i;e:{switch(A=ed(c,f),c){case"dialog":rt("cancel",i),rt("close",i),g=f;break;case"iframe":case"object":case"embed":rt("load",i),g=f;break;case"video":case"audio":for(g=0;g<ia.length;g++)rt(ia[g],i);g=f;break;case"source":rt("error",i),g=f;break;case"img":case"image":case"link":rt("error",i),rt("load",i),g=f;break;case"details":rt("toggle",i),g=f;break;case"input":He(i,f),g=Le(i,f),rt("invalid",i);break;case"option":g=f;break;case"select":i._wrapperState={wasMultiple:!!f.multiple},g=x({},f,{value:void 0}),rt("invalid",i);break;case"textarea":Bs(i,f),g=to(i,f),rt("invalid",i);break;default:g=f}Ju(c,g),b=g;for(v in b)if(b.hasOwnProperty(v)){var O=b[v];v==="style"?Vp(i,O):v==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&zp(i,O)):v==="children"?typeof O=="string"?(c!=="textarea"||O!=="")&&xs(i,O):typeof O=="number"&&xs(i,""+O):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(s.hasOwnProperty(v)?O!=null&&v==="onScroll"&&rt("scroll",i):O!=null&&_(i,v,O,A))}switch(c){case"input":Ae(i),Et(i,f,!1);break;case"textarea":Ae(i),Fs(i);break;case"option":f.value!=null&&i.setAttribute("value",""+L(f.value));break;case"select":i.multiple=!!f.multiple,v=f.value,v!=null?En(i,!!f.multiple,v,!1):f.defaultValue!=null&&En(i,!!f.multiple,f.defaultValue,!0);break;default:typeof g.onClick=="function"&&(i.onclick=Xl)}switch(c){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Qt(r),null;case 6:if(i&&r.stateNode!=null)r0(i,r,i.memoizedProps,f);else{if(typeof f!="string"&&r.stateNode===null)throw Error(n(166));if(c=qo(da.current),qo(hi.current),ec(r)){if(f=r.stateNode,c=r.memoizedProps,f[fi]=r,(v=f.nodeValue!==c)&&(i=Cn,i!==null))switch(i.tag){case 3:zl(f.nodeValue,c,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&zl(f.nodeValue,c,(i.mode&1)!==0)}v&&(r.flags|=4)}else f=(c.nodeType===9?c:c.ownerDocument).createTextNode(f),f[fi]=r,r.stateNode=f}return Qt(r),null;case 13:if(st(pt),f=r.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(dt&&Pn!==null&&(r.mode&1)!==0&&(r.flags&128)===0)lm(),Wr(),r.flags|=98560,v=!1;else if(v=ec(r),f!==null&&f.dehydrated!==null){if(i===null){if(!v)throw Error(n(318));if(v=r.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(n(317));v[fi]=r}else Wr(),(r.flags&128)===0&&(r.memoizedState=null),r.flags|=4;Qt(r),v=!1}else Qn!==null&&(bf(Qn),Qn=null),v=!0;if(!v)return r.flags&65536?r:null}return(r.flags&128)!==0?(r.lanes=c,r):(f=f!==null,f!==(i!==null&&i.memoizedState!==null)&&f&&(r.child.flags|=8192,(r.mode&1)!==0&&(i===null||(pt.current&1)!==0?Mt===0&&(Mt=3):Nf())),r.updateQueue!==null&&(r.flags|=4),Qt(r),null);case 4:return Xr(),Tf(i,r),i===null&&oa(r.stateNode.containerInfo),Qt(r),null;case 10:return Xd(r.type._context),Qt(r),null;case 17:return gn(r.type)&&ql(),Qt(r),null;case 19:if(st(pt),v=r.memoizedState,v===null)return Qt(r),null;if(f=(r.flags&128)!==0,A=v.rendering,A===null)if(f)ma(v,!1);else{if(Mt!==0||i!==null&&(i.flags&128)!==0)for(i=r.child;i!==null;){if(A=sc(i),A!==null){for(r.flags|=128,ma(v,!1),f=A.updateQueue,f!==null&&(r.updateQueue=f,r.flags|=4),r.subtreeFlags=0,f=c,c=r.child;c!==null;)v=c,i=f,v.flags&=14680066,A=v.alternate,A===null?(v.childLanes=0,v.lanes=i,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=A.childLanes,v.lanes=A.lanes,v.child=A.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=A.memoizedProps,v.memoizedState=A.memoizedState,v.updateQueue=A.updateQueue,v.type=A.type,i=A.dependencies,v.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),c=c.sibling;return nt(pt,pt.current&1|2),r.child}i=i.sibling}v.tail!==null&&Tt()>Kr&&(r.flags|=128,f=!0,ma(v,!1),r.lanes=4194304)}else{if(!f)if(i=sc(A),i!==null){if(r.flags|=128,f=!0,c=i.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),ma(v,!0),v.tail===null&&v.tailMode==="hidden"&&!A.alternate&&!dt)return Qt(r),null}else 2*Tt()-v.renderingStartTime>Kr&&c!==1073741824&&(r.flags|=128,f=!0,ma(v,!1),r.lanes=4194304);v.isBackwards?(A.sibling=r.child,r.child=A):(c=v.last,c!==null?c.sibling=A:r.child=A,v.last=A)}return v.tail!==null?(r=v.tail,v.rendering=r,v.tail=r.sibling,v.renderingStartTime=Tt(),r.sibling=null,c=pt.current,nt(pt,f?c&1|2:c&1),r):(Qt(r),null);case 22:case 23:return Of(),f=r.memoizedState!==null,i!==null&&i.memoizedState!==null!==f&&(r.flags|=8192),f&&(r.mode&1)!==0?(_n&1073741824)!==0&&(Qt(r),r.subtreeFlags&6&&(r.flags|=8192)):Qt(r),null;case 24:return null;case 25:return null}throw Error(n(156,r.tag))}function qA(i,r){switch(Gd(r),r.tag){case 1:return gn(r.type)&&ql(),i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 3:return Xr(),st(pn),st(Zt),ef(),i=r.flags,(i&65536)!==0&&(i&128)===0?(r.flags=i&-65537|128,r):null;case 5:return Qd(r),null;case 13:if(st(pt),i=r.memoizedState,i!==null&&i.dehydrated!==null){if(r.alternate===null)throw Error(n(340));Wr()}return i=r.flags,i&65536?(r.flags=i&-65537|128,r):null;case 19:return st(pt),null;case 4:return Xr(),null;case 10:return Xd(r.type._context),null;case 22:case 23:return Of(),null;case 24:return null;default:return null}}var gc=!1,Jt=!1,ZA=typeof WeakSet=="function"?WeakSet:Set,Ie=null;function qr(i,r){var c=i.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(f){vt(i,r,f)}else c.current=null}function If(i,r,c){try{c()}catch(f){vt(i,r,f)}}var s0=!1;function KA(i,r){if(Dd=Bl,i=xg(),wd(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var f=c.getSelection&&c.getSelection();if(f&&f.rangeCount!==0){c=f.anchorNode;var g=f.anchorOffset,v=f.focusNode;f=f.focusOffset;try{c.nodeType,v.nodeType}catch{c=null;break e}var A=0,b=-1,O=-1,Y=0,le=0,de=i,ae=null;t:for(;;){for(var ve;de!==c||g!==0&&de.nodeType!==3||(b=A+g),de!==v||f!==0&&de.nodeType!==3||(O=A+f),de.nodeType===3&&(A+=de.nodeValue.length),(ve=de.firstChild)!==null;)ae=de,de=ve;for(;;){if(de===i)break t;if(ae===c&&++Y===g&&(b=A),ae===v&&++le===f&&(O=A),(ve=de.nextSibling)!==null)break;de=ae,ae=de.parentNode}de=ve}c=b===-1||O===-1?null:{start:b,end:O}}else c=null}c=c||{start:0,end:0}}else c=null;for(Od={focusedElem:i,selectionRange:c},Bl=!1,Ie=r;Ie!==null;)if(r=Ie,i=r.child,(r.subtreeFlags&1028)!==0&&i!==null)i.return=r,Ie=i;else for(;Ie!==null;){r=Ie;try{var Ee=r.alternate;if((r.flags&1024)!==0)switch(r.tag){case 0:case 11:case 15:break;case 1:if(Ee!==null){var we=Ee.memoizedProps,It=Ee.memoizedState,F=r.stateNode,B=F.getSnapshotBeforeUpdate(r.elementType===r.type?we:Jn(r.type,we),It);F.__reactInternalSnapshotBeforeUpdate=B}break;case 3:var U=r.stateNode.containerInfo;U.nodeType===1?U.textContent="":U.nodeType===9&&U.documentElement&&U.removeChild(U.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(n(163))}}catch(he){vt(r,r.return,he)}if(i=r.sibling,i!==null){i.return=r.return,Ie=i;break}Ie=r.return}return Ee=s0,s0=!1,Ee}function ya(i,r,c){var f=r.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var g=f=f.next;do{if((g.tag&i)===i){var v=g.destroy;g.destroy=void 0,v!==void 0&&If(r,c,v)}g=g.next}while(g!==f)}}function mc(i,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var c=r=r.next;do{if((c.tag&i)===i){var f=c.create;c.destroy=f()}c=c.next}while(c!==r)}}function Af(i){var r=i.ref;if(r!==null){var c=i.stateNode;switch(i.tag){case 5:i=c;break;default:i=c}typeof r=="function"?r(i):r.current=i}}function a0(i){var r=i.alternate;r!==null&&(i.alternate=null,a0(r)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(r=i.stateNode,r!==null&&(delete r[fi],delete r[sa],delete r[Fd],delete r[OA],delete r[NA])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function l0(i){return i.tag===5||i.tag===3||i.tag===4}function c0(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||l0(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Ef(i,r,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,r?c.nodeType===8?c.parentNode.insertBefore(i,r):c.insertBefore(i,r):(c.nodeType===8?(r=c.parentNode,r.insertBefore(i,c)):(r=c,r.appendChild(i)),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=Xl));else if(f!==4&&(i=i.child,i!==null))for(Ef(i,r,c),i=i.sibling;i!==null;)Ef(i,r,c),i=i.sibling}function wf(i,r,c){var f=i.tag;if(f===5||f===6)i=i.stateNode,r?c.insertBefore(i,r):c.appendChild(i);else if(f!==4&&(i=i.child,i!==null))for(wf(i,r,c),i=i.sibling;i!==null;)wf(i,r,c),i=i.sibling}var $t=null,ei=!1;function go(i,r,c){for(c=c.child;c!==null;)u0(i,r,c),c=c.sibling}function u0(i,r,c){if(di&&typeof di.onCommitFiberUnmount=="function")try{di.onCommitFiberUnmount(kl,c)}catch{}switch(c.tag){case 5:Jt||qr(c,r);case 6:var f=$t,g=ei;$t=null,go(i,r,c),$t=f,ei=g,$t!==null&&(ei?(i=$t,c=c.stateNode,i.nodeType===8?i.parentNode.removeChild(c):i.removeChild(c)):$t.removeChild(c.stateNode));break;case 18:$t!==null&&(ei?(i=$t,c=c.stateNode,i.nodeType===8?Hd(i.parentNode,c):i.nodeType===1&&Hd(i,c),qs(i)):Hd($t,c.stateNode));break;case 4:f=$t,g=ei,$t=c.stateNode.containerInfo,ei=!0,go(i,r,c),$t=f,ei=g;break;case 0:case 11:case 14:case 15:if(!Jt&&(f=c.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){g=f=f.next;do{var v=g,A=v.destroy;v=v.tag,A!==void 0&&((v&2)!==0||(v&4)!==0)&&If(c,r,A),g=g.next}while(g!==f)}go(i,r,c);break;case 1:if(!Jt&&(qr(c,r),f=c.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=c.memoizedProps,f.state=c.memoizedState,f.componentWillUnmount()}catch(b){vt(c,r,b)}go(i,r,c);break;case 21:go(i,r,c);break;case 22:c.mode&1?(Jt=(f=Jt)||c.memoizedState!==null,go(i,r,c),Jt=f):go(i,r,c);break;default:go(i,r,c)}}function d0(i){var r=i.updateQueue;if(r!==null){i.updateQueue=null;var c=i.stateNode;c===null&&(c=i.stateNode=new ZA),r.forEach(function(f){var g=s1.bind(null,i,f);c.has(f)||(c.add(f),f.then(g,g))})}}function ti(i,r){var c=r.deletions;if(c!==null)for(var f=0;f<c.length;f++){var g=c[f];try{var v=i,A=r,b=A;e:for(;b!==null;){switch(b.tag){case 5:$t=b.stateNode,ei=!1;break e;case 3:$t=b.stateNode.containerInfo,ei=!0;break e;case 4:$t=b.stateNode.containerInfo,ei=!0;break e}b=b.return}if($t===null)throw Error(n(160));u0(v,A,g),$t=null,ei=!1;var O=g.alternate;O!==null&&(O.return=null),g.return=null}catch(Y){vt(g,r,Y)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)f0(r,i),r=r.sibling}function f0(i,r){var c=i.alternate,f=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(ti(r,i),gi(i),f&4){try{ya(3,i,i.return),mc(3,i)}catch(we){vt(i,i.return,we)}try{ya(5,i,i.return)}catch(we){vt(i,i.return,we)}}break;case 1:ti(r,i),gi(i),f&512&&c!==null&&qr(c,c.return);break;case 5:if(ti(r,i),gi(i),f&512&&c!==null&&qr(c,c.return),i.flags&32){var g=i.stateNode;try{xs(g,"")}catch(we){vt(i,i.return,we)}}if(f&4&&(g=i.stateNode,g!=null)){var v=i.memoizedProps,A=c!==null?c.memoizedProps:v,b=i.type,O=i.updateQueue;if(i.updateQueue=null,O!==null)try{b==="input"&&v.type==="radio"&&v.name!=null&&it(g,v),ed(b,A);var Y=ed(b,v);for(A=0;A<O.length;A+=2){var le=O[A],de=O[A+1];le==="style"?Vp(g,de):le==="dangerouslySetInnerHTML"?zp(g,de):le==="children"?xs(g,de):_(g,le,de,Y)}switch(b){case"input":St(g,v);break;case"textarea":Hs(g,v);break;case"select":var ae=g._wrapperState.wasMultiple;g._wrapperState.wasMultiple=!!v.multiple;var ve=v.value;ve!=null?En(g,!!v.multiple,ve,!1):ae!==!!v.multiple&&(v.defaultValue!=null?En(g,!!v.multiple,v.defaultValue,!0):En(g,!!v.multiple,v.multiple?[]:"",!1))}g[sa]=v}catch(we){vt(i,i.return,we)}}break;case 6:if(ti(r,i),gi(i),f&4){if(i.stateNode===null)throw Error(n(162));g=i.stateNode,v=i.memoizedProps;try{g.nodeValue=v}catch(we){vt(i,i.return,we)}}break;case 3:if(ti(r,i),gi(i),f&4&&c!==null&&c.memoizedState.isDehydrated)try{qs(r.containerInfo)}catch(we){vt(i,i.return,we)}break;case 4:ti(r,i),gi(i);break;case 13:ti(r,i),gi(i),g=i.child,g.flags&8192&&(v=g.memoizedState!==null,g.stateNode.isHidden=v,!v||g.alternate!==null&&g.alternate.memoizedState!==null||(_f=Tt())),f&4&&d0(i);break;case 22:if(le=c!==null&&c.memoizedState!==null,i.mode&1?(Jt=(Y=Jt)||le,ti(r,i),Jt=Y):ti(r,i),gi(i),f&8192){if(Y=i.memoizedState!==null,(i.stateNode.isHidden=Y)&&!le&&(i.mode&1)!==0)for(Ie=i,le=i.child;le!==null;){for(de=Ie=le;Ie!==null;){switch(ae=Ie,ve=ae.child,ae.tag){case 0:case 11:case 14:case 15:ya(4,ae,ae.return);break;case 1:qr(ae,ae.return);var Ee=ae.stateNode;if(typeof Ee.componentWillUnmount=="function"){f=ae,c=ae.return;try{r=f,Ee.props=r.memoizedProps,Ee.state=r.memoizedState,Ee.componentWillUnmount()}catch(we){vt(f,c,we)}}break;case 5:qr(ae,ae.return);break;case 22:if(ae.memoizedState!==null){g0(de);continue}}ve!==null?(ve.return=ae,Ie=ve):g0(de)}le=le.sibling}e:for(le=null,de=i;;){if(de.tag===5){if(le===null){le=de;try{g=de.stateNode,Y?(v=g.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(b=de.stateNode,O=de.memoizedProps.style,A=O!=null&&O.hasOwnProperty("display")?O.display:null,b.style.display=Xp("display",A))}catch(we){vt(i,i.return,we)}}}else if(de.tag===6){if(le===null)try{de.stateNode.nodeValue=Y?"":de.memoizedProps}catch(we){vt(i,i.return,we)}}else if((de.tag!==22&&de.tag!==23||de.memoizedState===null||de===i)&&de.child!==null){de.child.return=de,de=de.child;continue}if(de===i)break e;for(;de.sibling===null;){if(de.return===null||de.return===i)break e;le===de&&(le=null),de=de.return}le===de&&(le=null),de.sibling.return=de.return,de=de.sibling}}break;case 19:ti(r,i),gi(i),f&4&&d0(i);break;case 21:break;default:ti(r,i),gi(i)}}function gi(i){var r=i.flags;if(r&2){try{e:{for(var c=i.return;c!==null;){if(l0(c)){var f=c;break e}c=c.return}throw Error(n(160))}switch(f.tag){case 5:var g=f.stateNode;f.flags&32&&(xs(g,""),f.flags&=-33);var v=c0(i);wf(i,v,g);break;case 3:case 4:var A=f.stateNode.containerInfo,b=c0(i);Ef(i,b,A);break;default:throw Error(n(161))}}catch(O){vt(i,i.return,O)}i.flags&=-3}r&4096&&(i.flags&=-4097)}function QA(i,r,c){Ie=i,h0(i)}function h0(i,r,c){for(var f=(i.mode&1)!==0;Ie!==null;){var g=Ie,v=g.child;if(g.tag===22&&f){var A=g.memoizedState!==null||gc;if(!A){var b=g.alternate,O=b!==null&&b.memoizedState!==null||Jt;b=gc;var Y=Jt;if(gc=A,(Jt=O)&&!Y)for(Ie=g;Ie!==null;)A=Ie,O=A.child,A.tag===22&&A.memoizedState!==null?m0(g):O!==null?(O.return=A,Ie=O):m0(g);for(;v!==null;)Ie=v,h0(v),v=v.sibling;Ie=g,gc=b,Jt=Y}p0(i)}else(g.subtreeFlags&8772)!==0&&v!==null?(v.return=g,Ie=v):p0(i)}}function p0(i){for(;Ie!==null;){var r=Ie;if((r.flags&8772)!==0){var c=r.alternate;try{if((r.flags&8772)!==0)switch(r.tag){case 0:case 11:case 15:Jt||mc(5,r);break;case 1:var f=r.stateNode;if(r.flags&4&&!Jt)if(c===null)f.componentDidMount();else{var g=r.elementType===r.type?c.memoizedProps:Jn(r.type,c.memoizedProps);f.componentDidUpdate(g,c.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var v=r.updateQueue;v!==null&&gm(r,v,f);break;case 3:var A=r.updateQueue;if(A!==null){if(c=null,r.child!==null)switch(r.child.tag){case 5:c=r.child.stateNode;break;case 1:c=r.child.stateNode}gm(r,A,c)}break;case 5:var b=r.stateNode;if(c===null&&r.flags&4){c=b;var O=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&c.focus();break;case"img":O.src&&(c.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var Y=r.alternate;if(Y!==null){var le=Y.memoizedState;if(le!==null){var de=le.dehydrated;de!==null&&qs(de)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(n(163))}Jt||r.flags&512&&Af(r)}catch(ae){vt(r,r.return,ae)}}if(r===i){Ie=null;break}if(c=r.sibling,c!==null){c.return=r.return,Ie=c;break}Ie=r.return}}function g0(i){for(;Ie!==null;){var r=Ie;if(r===i){Ie=null;break}var c=r.sibling;if(c!==null){c.return=r.return,Ie=c;break}Ie=r.return}}function m0(i){for(;Ie!==null;){var r=Ie;try{switch(r.tag){case 0:case 11:case 15:var c=r.return;try{mc(4,r)}catch(O){vt(r,c,O)}break;case 1:var f=r.stateNode;if(typeof f.componentDidMount=="function"){var g=r.return;try{f.componentDidMount()}catch(O){vt(r,g,O)}}var v=r.return;try{Af(r)}catch(O){vt(r,v,O)}break;case 5:var A=r.return;try{Af(r)}catch(O){vt(r,A,O)}}}catch(O){vt(r,r.return,O)}if(r===i){Ie=null;break}var b=r.sibling;if(b!==null){b.return=r.return,Ie=b;break}Ie=r.return}}var JA=Math.ceil,yc=k.ReactCurrentDispatcher,Cf=k.ReactCurrentOwner,Ln=k.ReactCurrentBatchConfig,je=0,Ft=null,wt=null,Wt=0,_n=0,Zr=co(0),Mt=0,va=null,Ko=0,vc=0,Pf=0,Sa=null,yn=null,_f=0,Kr=1/0,Ni=null,Sc=!1,Rf=null,mo=null,Tc=!1,yo=null,Ic=0,Ta=0,kf=null,Ac=-1,Ec=0;function an(){return(je&6)!==0?Tt():Ac!==-1?Ac:Ac=Tt()}function vo(i){return(i.mode&1)===0?1:(je&2)!==0&&Wt!==0?Wt&-Wt:HA.transition!==null?(Ec===0&&(Ec=cg()),Ec):(i=Ze,i!==0||(i=window.event,i=i===void 0?16:vg(i.type)),i)}function ni(i,r,c,f){if(50<Ta)throw Ta=0,kf=null,Error(n(185));Ys(i,c,f),((je&2)===0||i!==Ft)&&(i===Ft&&((je&2)===0&&(vc|=c),Mt===4&&So(i,Wt)),vn(i,f),c===1&&je===0&&(r.mode&1)===0&&(Kr=Tt()+500,Kl&&fo()))}function vn(i,r){var c=i.callbackNode;HI(i,r);var f=Dl(i,i===Ft?Wt:0);if(f===0)c!==null&&sg(c),i.callbackNode=null,i.callbackPriority=0;else if(r=f&-f,i.callbackPriority!==r){if(c!=null&&sg(c),r===1)i.tag===0?BA(v0.bind(null,i)):im(v0.bind(null,i)),bA(function(){(je&6)===0&&fo()}),c=null;else{switch(ug(f)){case 1:c=ad;break;case 4:c=ag;break;case 16:c=Rl;break;case 536870912:c=lg;break;default:c=Rl}c=P0(c,y0.bind(null,i))}i.callbackPriority=r,i.callbackNode=c}}function y0(i,r){if(Ac=-1,Ec=0,(je&6)!==0)throw Error(n(327));var c=i.callbackNode;if(Qr()&&i.callbackNode!==c)return null;var f=Dl(i,i===Ft?Wt:0);if(f===0)return null;if((f&30)!==0||(f&i.expiredLanes)!==0||r)r=wc(i,f);else{r=f;var g=je;je|=2;var v=T0();(Ft!==i||Wt!==r)&&(Ni=null,Kr=Tt()+500,Jo(i,r));do try{n1();break}catch(b){S0(i,b)}while(!0);zd(),yc.current=v,je=g,wt!==null?r=0:(Ft=null,Wt=0,r=Mt)}if(r!==0){if(r===2&&(g=ld(i),g!==0&&(f=g,r=Mf(i,g))),r===1)throw c=va,Jo(i,0),So(i,f),vn(i,Tt()),c;if(r===6)So(i,f);else{if(g=i.current.alternate,(f&30)===0&&!e1(g)&&(r=wc(i,f),r===2&&(v=ld(i),v!==0&&(f=v,r=Mf(i,v))),r===1))throw c=va,Jo(i,0),So(i,f),vn(i,Tt()),c;switch(i.finishedWork=g,i.finishedLanes=f,r){case 0:case 1:throw Error(n(345));case 2:er(i,yn,Ni);break;case 3:if(So(i,f),(f&130023424)===f&&(r=_f+500-Tt(),10<r)){if(Dl(i,0)!==0)break;if(g=i.suspendedLanes,(g&f)!==f){an(),i.pingedLanes|=i.suspendedLanes&g;break}i.timeoutHandle=Bd(er.bind(null,i,yn,Ni),r);break}er(i,yn,Ni);break;case 4:if(So(i,f),(f&4194240)===f)break;for(r=i.eventTimes,g=-1;0<f;){var A=31-Zn(f);v=1<<A,A=r[A],A>g&&(g=A),f&=~v}if(f=g,f=Tt()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*JA(f/1960))-f,10<f){i.timeoutHandle=Bd(er.bind(null,i,yn,Ni),f);break}er(i,yn,Ni);break;case 5:er(i,yn,Ni);break;default:throw Error(n(329))}}}return vn(i,Tt()),i.callbackNode===c?y0.bind(null,i):null}function Mf(i,r){var c=Sa;return i.current.memoizedState.isDehydrated&&(Jo(i,r).flags|=256),i=wc(i,r),i!==2&&(r=yn,yn=c,r!==null&&bf(r)),i}function bf(i){yn===null?yn=i:yn.push.apply(yn,i)}function e1(i){for(var r=i;;){if(r.flags&16384){var c=r.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var f=0;f<c.length;f++){var g=c[f],v=g.getSnapshot;g=g.value;try{if(!Kn(v(),g))return!1}catch{return!1}}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===i)break;for(;r.sibling===null;){if(r.return===null||r.return===i)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function So(i,r){for(r&=~Pf,r&=~vc,i.suspendedLanes|=r,i.pingedLanes&=~r,i=i.expirationTimes;0<r;){var c=31-Zn(r),f=1<<c;i[c]=-1,r&=~f}}function v0(i){if((je&6)!==0)throw Error(n(327));Qr();var r=Dl(i,0);if((r&1)===0)return vn(i,Tt()),null;var c=wc(i,r);if(i.tag!==0&&c===2){var f=ld(i);f!==0&&(r=f,c=Mf(i,f))}if(c===1)throw c=va,Jo(i,0),So(i,r),vn(i,Tt()),c;if(c===6)throw Error(n(345));return i.finishedWork=i.current.alternate,i.finishedLanes=r,er(i,yn,Ni),vn(i,Tt()),null}function Df(i,r){var c=je;je|=1;try{return i(r)}finally{je=c,je===0&&(Kr=Tt()+500,Kl&&fo())}}function Qo(i){yo!==null&&yo.tag===0&&(je&6)===0&&Qr();var r=je;je|=1;var c=Ln.transition,f=Ze;try{if(Ln.transition=null,Ze=1,i)return i()}finally{Ze=f,Ln.transition=c,je=r,(je&6)===0&&fo()}}function Of(){_n=Zr.current,st(Zr)}function Jo(i,r){i.finishedWork=null,i.finishedLanes=0;var c=i.timeoutHandle;if(c!==-1&&(i.timeoutHandle=-1,MA(c)),wt!==null)for(c=wt.return;c!==null;){var f=c;switch(Gd(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&ql();break;case 3:Xr(),st(pn),st(Zt),ef();break;case 5:Qd(f);break;case 4:Xr();break;case 13:st(pt);break;case 19:st(pt);break;case 10:Xd(f.type._context);break;case 22:case 23:Of()}c=c.return}if(Ft=i,wt=i=To(i.current,null),Wt=_n=r,Mt=0,va=null,Pf=vc=Ko=0,yn=Sa=null,Vo!==null){for(r=0;r<Vo.length;r++)if(c=Vo[r],f=c.interleaved,f!==null){c.interleaved=null;var g=f.next,v=c.pending;if(v!==null){var A=v.next;v.next=g,f.next=A}c.pending=f}Vo=null}return i}function S0(i,r){do{var c=wt;try{if(zd(),ac.current=dc,lc){for(var f=gt.memoizedState;f!==null;){var g=f.queue;g!==null&&(g.pending=null),f=f.next}lc=!1}if(Zo=0,Ht=kt=gt=null,fa=!1,ha=0,Cf.current=null,c===null||c.return===null){Mt=1,va=r,wt=null;break}e:{var v=i,A=c.return,b=c,O=r;if(r=Wt,b.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var Y=O,le=b,de=le.tag;if((le.mode&1)===0&&(de===0||de===11||de===15)){var ae=le.alternate;ae?(le.updateQueue=ae.updateQueue,le.memoizedState=ae.memoizedState,le.lanes=ae.lanes):(le.updateQueue=null,le.memoizedState=null)}var ve=Ym(A);if(ve!==null){ve.flags&=-257,jm(ve,A,b,v,r),ve.mode&1&&Wm(v,Y,r),r=ve,O=Y;var Ee=r.updateQueue;if(Ee===null){var we=new Set;we.add(O),r.updateQueue=we}else Ee.add(O);break e}else{if((r&1)===0){Wm(v,Y,r),Nf();break e}O=Error(n(426))}}else if(dt&&b.mode&1){var It=Ym(A);if(It!==null){(It.flags&65536)===0&&(It.flags|=256),jm(It,A,b,v,r),Yd(Vr(O,b));break e}}v=O=Vr(O,b),Mt!==4&&(Mt=2),Sa===null?Sa=[v]:Sa.push(v),v=A;do{switch(v.tag){case 3:v.flags|=65536,r&=-r,v.lanes|=r;var F=Gm(v,O,r);pm(v,F);break e;case 1:b=O;var B=v.type,U=v.stateNode;if((v.flags&128)===0&&(typeof B.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(mo===null||!mo.has(U)))){v.flags|=65536,r&=-r,v.lanes|=r;var he=$m(v,b,r);pm(v,he);break e}}v=v.return}while(v!==null)}A0(c)}catch(Re){r=Re,wt===c&&c!==null&&(wt=c=c.return);continue}break}while(!0)}function T0(){var i=yc.current;return yc.current=dc,i===null?dc:i}function Nf(){(Mt===0||Mt===3||Mt===2)&&(Mt=4),Ft===null||(Ko&268435455)===0&&(vc&268435455)===0||So(Ft,Wt)}function wc(i,r){var c=je;je|=2;var f=T0();(Ft!==i||Wt!==r)&&(Ni=null,Jo(i,r));do try{t1();break}catch(g){S0(i,g)}while(!0);if(zd(),je=c,yc.current=f,wt!==null)throw Error(n(261));return Ft=null,Wt=0,Mt}function t1(){for(;wt!==null;)I0(wt)}function n1(){for(;wt!==null&&!_I();)I0(wt)}function I0(i){var r=C0(i.alternate,i,_n);i.memoizedProps=i.pendingProps,r===null?A0(i):wt=r,Cf.current=null}function A0(i){var r=i;do{var c=r.alternate;if(i=r.return,(r.flags&32768)===0){if(c=VA(c,r,_n),c!==null){wt=c;return}}else{if(c=qA(c,r),c!==null){c.flags&=32767,wt=c;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Mt=6,wt=null;return}}if(r=r.sibling,r!==null){wt=r;return}wt=r=i}while(r!==null);Mt===0&&(Mt=5)}function er(i,r,c){var f=Ze,g=Ln.transition;try{Ln.transition=null,Ze=1,i1(i,r,c,f)}finally{Ln.transition=g,Ze=f}return null}function i1(i,r,c,f){do Qr();while(yo!==null);if((je&6)!==0)throw Error(n(327));c=i.finishedWork;var g=i.finishedLanes;if(c===null)return null;if(i.finishedWork=null,i.finishedLanes=0,c===i.current)throw Error(n(177));i.callbackNode=null,i.callbackPriority=0;var v=c.lanes|c.childLanes;if(FI(i,v),i===Ft&&(wt=Ft=null,Wt=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||Tc||(Tc=!0,P0(Rl,function(){return Qr(),null})),v=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||v){v=Ln.transition,Ln.transition=null;var A=Ze;Ze=1;var b=je;je|=4,Cf.current=null,KA(i,c),f0(c,i),EA(Od),Bl=!!Dd,Od=Dd=null,i.current=c,QA(c),RI(),je=b,Ze=A,Ln.transition=v}else i.current=c;if(Tc&&(Tc=!1,yo=i,Ic=g),v=i.pendingLanes,v===0&&(mo=null),bI(c.stateNode),vn(i,Tt()),r!==null)for(f=i.onRecoverableError,c=0;c<r.length;c++)g=r[c],f(g.value,{componentStack:g.stack,digest:g.digest});if(Sc)throw Sc=!1,i=Rf,Rf=null,i;return(Ic&1)!==0&&i.tag!==0&&Qr(),v=i.pendingLanes,(v&1)!==0?i===kf?Ta++:(Ta=0,kf=i):Ta=0,fo(),null}function Qr(){if(yo!==null){var i=ug(Ic),r=Ln.transition,c=Ze;try{if(Ln.transition=null,Ze=16>i?16:i,yo===null)var f=!1;else{if(i=yo,yo=null,Ic=0,(je&6)!==0)throw Error(n(331));var g=je;for(je|=4,Ie=i.current;Ie!==null;){var v=Ie,A=v.child;if((Ie.flags&16)!==0){var b=v.deletions;if(b!==null){for(var O=0;O<b.length;O++){var Y=b[O];for(Ie=Y;Ie!==null;){var le=Ie;switch(le.tag){case 0:case 11:case 15:ya(8,le,v)}var de=le.child;if(de!==null)de.return=le,Ie=de;else for(;Ie!==null;){le=Ie;var ae=le.sibling,ve=le.return;if(a0(le),le===Y){Ie=null;break}if(ae!==null){ae.return=ve,Ie=ae;break}Ie=ve}}}var Ee=v.alternate;if(Ee!==null){var we=Ee.child;if(we!==null){Ee.child=null;do{var It=we.sibling;we.sibling=null,we=It}while(we!==null)}}Ie=v}}if((v.subtreeFlags&2064)!==0&&A!==null)A.return=v,Ie=A;else e:for(;Ie!==null;){if(v=Ie,(v.flags&2048)!==0)switch(v.tag){case 0:case 11:case 15:ya(9,v,v.return)}var F=v.sibling;if(F!==null){F.return=v.return,Ie=F;break e}Ie=v.return}}var B=i.current;for(Ie=B;Ie!==null;){A=Ie;var U=A.child;if((A.subtreeFlags&2064)!==0&&U!==null)U.return=A,Ie=U;else e:for(A=B;Ie!==null;){if(b=Ie,(b.flags&2048)!==0)try{switch(b.tag){case 0:case 11:case 15:mc(9,b)}}catch(Re){vt(b,b.return,Re)}if(b===A){Ie=null;break e}var he=b.sibling;if(he!==null){he.return=b.return,Ie=he;break e}Ie=b.return}}if(je=g,fo(),di&&typeof di.onPostCommitFiberRoot=="function")try{di.onPostCommitFiberRoot(kl,i)}catch{}f=!0}return f}finally{Ze=c,Ln.transition=r}}return!1}function E0(i,r,c){r=Vr(c,r),r=Gm(i,r,1),i=po(i,r,1),r=an(),i!==null&&(Ys(i,1,r),vn(i,r))}function vt(i,r,c){if(i.tag===3)E0(i,i,c);else for(;r!==null;){if(r.tag===3){E0(r,i,c);break}else if(r.tag===1){var f=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(mo===null||!mo.has(f))){i=Vr(c,i),i=$m(r,i,1),r=po(r,i,1),i=an(),r!==null&&(Ys(r,1,i),vn(r,i));break}}r=r.return}}function o1(i,r,c){var f=i.pingCache;f!==null&&f.delete(r),r=an(),i.pingedLanes|=i.suspendedLanes&c,Ft===i&&(Wt&c)===c&&(Mt===4||Mt===3&&(Wt&130023424)===Wt&&500>Tt()-_f?Jo(i,0):Pf|=c),vn(i,r)}function w0(i,r){r===0&&((i.mode&1)===0?r=1:(r=bl,bl<<=1,(bl&130023424)===0&&(bl=4194304)));var c=an();i=bi(i,r),i!==null&&(Ys(i,r,c),vn(i,c))}function r1(i){var r=i.memoizedState,c=0;r!==null&&(c=r.retryLane),w0(i,c)}function s1(i,r){var c=0;switch(i.tag){case 13:var f=i.stateNode,g=i.memoizedState;g!==null&&(c=g.retryLane);break;case 19:f=i.stateNode;break;default:throw Error(n(314))}f!==null&&f.delete(r),w0(i,c)}var C0;C0=function(i,r,c){if(i!==null)if(i.memoizedProps!==r.pendingProps||pn.current)mn=!0;else{if((i.lanes&c)===0&&(r.flags&128)===0)return mn=!1,XA(i,r,c);mn=(i.flags&131072)!==0}else mn=!1,dt&&(r.flags&1048576)!==0&&om(r,Jl,r.index);switch(r.lanes=0,r.tag){case 2:var f=r.type;pc(i,r),i=r.pendingProps;var g=Ur(r,Zt.current);zr(r,c),g=of(null,r,f,i,g,c);var v=rf();return r.flags|=1,typeof g=="object"&&g!==null&&typeof g.render=="function"&&g.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,gn(f)?(v=!0,Zl(r)):v=!1,r.memoizedState=g.state!==null&&g.state!==void 0?g.state:null,Zd(r),g.updater=fc,r.stateNode=g,g._reactInternals=r,df(r,f,i,c),r=gf(null,r,f,!0,v,c)):(r.tag=0,dt&&v&&Ud(r),sn(null,r,g,c),r=r.child),r;case 16:f=r.elementType;e:{switch(pc(i,r),i=r.pendingProps,g=f._init,f=g(f._payload),r.type=f,g=r.tag=l1(f),i=Jn(f,i),g){case 0:r=pf(null,r,f,i,c);break e;case 1:r=Km(null,r,f,i,c);break e;case 11:r=zm(null,r,f,i,c);break e;case 14:r=Xm(null,r,f,Jn(f.type,i),c);break e}throw Error(n(306,f,""))}return r;case 0:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:Jn(f,g),pf(i,r,f,g,c);case 1:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:Jn(f,g),Km(i,r,f,g,c);case 3:e:{if(Qm(r),i===null)throw Error(n(387));f=r.pendingProps,v=r.memoizedState,g=v.element,hm(i,r),rc(r,f,null,c);var A=r.memoizedState;if(f=A.element,v.isDehydrated)if(v={element:f,isDehydrated:!1,cache:A.cache,pendingSuspenseBoundaries:A.pendingSuspenseBoundaries,transitions:A.transitions},r.updateQueue.baseState=v,r.memoizedState=v,r.flags&256){g=Vr(Error(n(423)),r),r=Jm(i,r,f,c,g);break e}else if(f!==g){g=Vr(Error(n(424)),r),r=Jm(i,r,f,c,g);break e}else for(Pn=lo(r.stateNode.containerInfo.firstChild),Cn=r,dt=!0,Qn=null,c=dm(r,null,f,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Wr(),f===g){r=Oi(i,r,c);break e}sn(i,r,f,c)}r=r.child}return r;case 5:return mm(r),i===null&&Wd(r),f=r.type,g=r.pendingProps,v=i!==null?i.memoizedProps:null,A=g.children,Nd(f,g)?A=null:v!==null&&Nd(f,v)&&(r.flags|=32),Zm(i,r),sn(i,r,A,c),r.child;case 6:return i===null&&Wd(r),null;case 13:return e0(i,r,c);case 4:return Kd(r,r.stateNode.containerInfo),f=r.pendingProps,i===null?r.child=Yr(r,null,f,c):sn(i,r,f,c),r.child;case 11:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:Jn(f,g),zm(i,r,f,g,c);case 7:return sn(i,r,r.pendingProps,c),r.child;case 8:return sn(i,r,r.pendingProps.children,c),r.child;case 12:return sn(i,r,r.pendingProps.children,c),r.child;case 10:e:{if(f=r.type._context,g=r.pendingProps,v=r.memoizedProps,A=g.value,nt(nc,f._currentValue),f._currentValue=A,v!==null)if(Kn(v.value,A)){if(v.children===g.children&&!pn.current){r=Oi(i,r,c);break e}}else for(v=r.child,v!==null&&(v.return=r);v!==null;){var b=v.dependencies;if(b!==null){A=v.child;for(var O=b.firstContext;O!==null;){if(O.context===f){if(v.tag===1){O=Di(-1,c&-c),O.tag=2;var Y=v.updateQueue;if(Y!==null){Y=Y.shared;var le=Y.pending;le===null?O.next=O:(O.next=le.next,le.next=O),Y.pending=O}}v.lanes|=c,O=v.alternate,O!==null&&(O.lanes|=c),Vd(v.return,c,r),b.lanes|=c;break}O=O.next}}else if(v.tag===10)A=v.type===r.type?null:v.child;else if(v.tag===18){if(A=v.return,A===null)throw Error(n(341));A.lanes|=c,b=A.alternate,b!==null&&(b.lanes|=c),Vd(A,c,r),A=v.sibling}else A=v.child;if(A!==null)A.return=v;else for(A=v;A!==null;){if(A===r){A=null;break}if(v=A.sibling,v!==null){v.return=A.return,A=v;break}A=A.return}v=A}sn(i,r,g.children,c),r=r.child}return r;case 9:return g=r.type,f=r.pendingProps.children,zr(r,c),g=Fn(g),f=f(g),r.flags|=1,sn(i,r,f,c),r.child;case 14:return f=r.type,g=Jn(f,r.pendingProps),g=Jn(f.type,g),Xm(i,r,f,g,c);case 15:return Vm(i,r,r.type,r.pendingProps,c);case 17:return f=r.type,g=r.pendingProps,g=r.elementType===f?g:Jn(f,g),pc(i,r),r.tag=1,gn(f)?(i=!0,Zl(r)):i=!1,zr(r,c),Lm(r,f,g),df(r,f,g,c),gf(null,r,f,!0,i,c);case 19:return n0(i,r,c);case 22:return qm(i,r,c)}throw Error(n(156,r.tag))};function P0(i,r){return rg(i,r)}function a1(i,r,c,f){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Un(i,r,c,f){return new a1(i,r,c,f)}function Bf(i){return i=i.prototype,!(!i||!i.isReactComponent)}function l1(i){if(typeof i=="function")return Bf(i)?1:0;if(i!=null){if(i=i.$$typeof,i===ee)return 11;if(i===re)return 14}return 2}function To(i,r){var c=i.alternate;return c===null?(c=Un(i.tag,r,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=r,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&14680064,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,r=i.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c}function Cc(i,r,c,f,g,v){var A=2;if(f=i,typeof i=="function")Bf(i)&&(A=1);else if(typeof i=="string")A=5;else e:switch(i){case R:return tr(c.children,g,v,r);case H:A=8,g|=8;break;case j:return i=Un(12,c,r,g|2),i.elementType=j,i.lanes=v,i;case ue:return i=Un(13,c,r,g),i.elementType=ue,i.lanes=v,i;case oe:return i=Un(19,c,r,g),i.elementType=oe,i.lanes=v,i;case ie:return Pc(c,g,v,r);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case $:A=10;break e;case V:A=9;break e;case ee:A=11;break e;case re:A=14;break e;case fe:A=16,f=null;break e}throw Error(n(130,i==null?i:typeof i,""))}return r=Un(A,c,r,g),r.elementType=i,r.type=f,r.lanes=v,r}function tr(i,r,c,f){return i=Un(7,i,f,r),i.lanes=c,i}function Pc(i,r,c,f){return i=Un(22,i,f,r),i.elementType=ie,i.lanes=c,i.stateNode={isHidden:!1},i}function Hf(i,r,c){return i=Un(6,i,null,r),i.lanes=c,i}function Ff(i,r,c){return r=Un(4,i.children!==null?i.children:[],i.key,r),r.lanes=c,r.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},r}function c1(i,r,c,f,g){this.tag=r,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cd(0),this.expirationTimes=cd(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cd(0),this.identifierPrefix=f,this.onRecoverableError=g,this.mutableSourceEagerHydrationData=null}function xf(i,r,c,f,g,v,A,b,O){return i=new c1(i,r,c,b,O),r===1?(r=1,v===!0&&(r|=8)):r=0,v=Un(3,null,null,r),i.current=v,v.stateNode=i,v.memoizedState={element:f,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},Zd(v),i}function u1(i,r,c){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:M,key:f==null?null:""+f,children:i,containerInfo:r,implementation:c}}function _0(i){if(!i)return uo;i=i._reactInternals;e:{if(Wo(i)!==i||i.tag!==1)throw Error(n(170));var r=i;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(gn(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error(n(171))}if(i.tag===1){var c=i.type;if(gn(c))return tm(i,c,r)}return r}function R0(i,r,c,f,g,v,A,b,O){return i=xf(c,f,!0,i,g,v,A,b,O),i.context=_0(null),c=i.current,f=an(),g=vo(c),v=Di(f,g),v.callback=r??null,po(c,v,g),i.current.lanes=g,Ys(i,g,f),vn(i,f),i}function _c(i,r,c,f){var g=r.current,v=an(),A=vo(g);return c=_0(c),r.context===null?r.context=c:r.pendingContext=c,r=Di(v,A),r.payload={element:i},f=f===void 0?null:f,f!==null&&(r.callback=f),i=po(g,r,A),i!==null&&(ni(i,g,A,v),oc(i,g,A)),A}function Rc(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function k0(i,r){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<r?c:r}}function Lf(i,r){k0(i,r),(i=i.alternate)&&k0(i,r)}function d1(){return null}var M0=typeof reportError=="function"?reportError:function(i){console.error(i)};function Uf(i){this._internalRoot=i}kc.prototype.render=Uf.prototype.render=function(i){var r=this._internalRoot;if(r===null)throw Error(n(409));_c(i,r,null,null)},kc.prototype.unmount=Uf.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var r=i.containerInfo;Qo(function(){_c(null,i,null,null)}),r[_i]=null}};function kc(i){this._internalRoot=i}kc.prototype.unstable_scheduleHydration=function(i){if(i){var r=hg();i={blockedOn:null,target:i,priority:r};for(var c=0;c<ro.length&&r!==0&&r<ro[c].priority;c++);ro.splice(c,0,i),c===0&&mg(i)}};function Gf(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Mc(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function b0(){}function f1(i,r,c,f,g){if(g){if(typeof f=="function"){var v=f;f=function(){var Y=Rc(A);v.call(Y)}}var A=R0(r,f,i,0,null,!1,!1,"",b0);return i._reactRootContainer=A,i[_i]=A.current,oa(i.nodeType===8?i.parentNode:i),Qo(),A}for(;g=i.lastChild;)i.removeChild(g);if(typeof f=="function"){var b=f;f=function(){var Y=Rc(O);b.call(Y)}}var O=xf(i,0,!1,null,null,!1,!1,"",b0);return i._reactRootContainer=O,i[_i]=O.current,oa(i.nodeType===8?i.parentNode:i),Qo(function(){_c(r,O,c,f)}),O}function bc(i,r,c,f,g){var v=c._reactRootContainer;if(v){var A=v;if(typeof g=="function"){var b=g;g=function(){var O=Rc(A);b.call(O)}}_c(r,A,i,g)}else A=f1(c,r,i,g,f);return Rc(A)}dg=function(i){switch(i.tag){case 3:var r=i.stateNode;if(r.current.memoizedState.isDehydrated){var c=Ws(r.pendingLanes);c!==0&&(ud(r,c|1),vn(r,Tt()),(je&6)===0&&(Kr=Tt()+500,fo()))}break;case 13:Qo(function(){var f=bi(i,1);if(f!==null){var g=an();ni(f,i,1,g)}}),Lf(i,1)}},dd=function(i){if(i.tag===13){var r=bi(i,134217728);if(r!==null){var c=an();ni(r,i,134217728,c)}Lf(i,134217728)}},fg=function(i){if(i.tag===13){var r=vo(i),c=bi(i,r);if(c!==null){var f=an();ni(c,i,r,f)}Lf(i,r)}},hg=function(){return Ze},pg=function(i,r){var c=Ze;try{return Ze=i,r()}finally{Ze=c}},id=function(i,r,c){switch(r){case"input":if(St(i,c),r=c.name,c.type==="radio"&&r!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<c.length;r++){var f=c[r];if(f!==i&&f.form===i.form){var g=Vl(f);if(!g)throw Error(n(90));Z(f),St(f,g)}}}break;case"textarea":Hs(i,c);break;case"select":r=c.value,r!=null&&En(i,!!c.multiple,r,!1)}},Qp=Df,Jp=Qo;var h1={usingClientEntryPoint:!1,Events:[aa,xr,Vl,Zp,Kp,Df]},Ia={findFiberByHostInstance:Yo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},p1={bundleType:Ia.bundleType,version:Ia.version,rendererPackageName:Ia.rendererPackageName,rendererConfig:Ia.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=ig(i),i===null?null:i.stateNode},findFiberByHostInstance:Ia.findFiberByHostInstance||d1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Dc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Dc.isDisabled&&Dc.supportsFiber)try{kl=Dc.inject(p1),di=Dc}catch{}}return Sn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=h1,Sn.createPortal=function(i,r){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Gf(r))throw Error(n(200));return u1(i,r,null,c)},Sn.createRoot=function(i,r){if(!Gf(i))throw Error(n(299));var c=!1,f="",g=M0;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(f=r.identifierPrefix),r.onRecoverableError!==void 0&&(g=r.onRecoverableError)),r=xf(i,1,!1,null,null,c,!1,f,g),i[_i]=r.current,oa(i.nodeType===8?i.parentNode:i),new Uf(r)},Sn.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var r=i._reactInternals;if(r===void 0)throw typeof i.render=="function"?Error(n(188)):(i=Object.keys(i).join(","),Error(n(268,i)));return i=ig(r),i=i===null?null:i.stateNode,i},Sn.flushSync=function(i){return Qo(i)},Sn.hydrate=function(i,r,c){if(!Mc(r))throw Error(n(200));return bc(null,i,r,!0,c)},Sn.hydrateRoot=function(i,r,c){if(!Gf(i))throw Error(n(405));var f=c!=null&&c.hydratedSources||null,g=!1,v="",A=M0;if(c!=null&&(c.unstable_strictMode===!0&&(g=!0),c.identifierPrefix!==void 0&&(v=c.identifierPrefix),c.onRecoverableError!==void 0&&(A=c.onRecoverableError)),r=R0(r,null,i,1,c??null,g,!1,v,A),i[_i]=r.current,oa(i),f)for(i=0;i<f.length;i++)c=f[i],g=c._getVersion,g=g(c._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[c,g]:r.mutableSourceEagerHydrationData.push(c,g);return new kc(r)},Sn.render=function(i,r,c){if(!Mc(r))throw Error(n(200));return bc(null,i,r,!1,c)},Sn.unmountComponentAtNode=function(i){if(!Mc(i))throw Error(n(40));return i._reactRootContainer?(Qo(function(){bc(null,null,i,!1,function(){i._reactRootContainer=null,i[_i]=null})}),!0):!1},Sn.unstable_batchedUpdates=Df,Sn.unstable_renderSubtreeIntoContainer=function(i,r,c,f){if(!Mc(c))throw Error(n(200));if(i==null||i._reactInternals===void 0)throw Error(n(38));return bc(i,r,c,!1,f)},Sn.version="18.3.1-next-f1338f8080-20240426",Sn}var L0;function w1(){if(L0)return Yf.exports;L0=1;function e(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}return e(),Yf.exports=E1(),Yf.exports}var U0;function C1(){if(U0)return Oc;U0=1;var e=w1();return Oc.createRoot=e.createRoot,Oc.hydrateRoot=e.hydrateRoot,Oc}var P1=C1();const _1=Mv(P1);class R1{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(t,n){let o=this.length++;for(;o>0;){const s=o-1>>1,a=this.values[s];if(n>=a)break;this.ids[o]=this.ids[s],this.values[o]=a,o=s}this.ids[o]=t,this.values[o]=n}pop(){if(this.length===0)return;const t=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],o=this.values[0]=this.values[this.length],s=this.length>>1;let a=0;for(;a<s;){let l=(a<<1)+1;const u=l+1;let d=this.ids[l],h=this.values[l];const p=this.values[u];if(u<this.length&&p<h&&(l=u,d=this.ids[u],h=p),h>=o)break;this.ids[a]=d,this.values[a]=h,a=l}this.ids[a]=n,this.values[a]=o}return t}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const G0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Xf=3;class Kh{static from(t,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!t||t.byteLength===void 0||t.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[o,s]=new Uint8Array(t,n+0,2);if(o!==251)throw new Error("Data does not appear to be in a Flatbush format.");const a=s>>4;if(a!==Xf)throw new Error(`Got v${a} data when expected v${Xf}.`);const l=G0[s&15];if(!l)throw new Error("Unrecognized array type.");const[u]=new Uint16Array(t,n+2,1),[d]=new Uint32Array(t,n+4,1);return new Kh(d,u,l,void 0,t,n)}constructor(t,n=16,o=Float64Array,s=ArrayBuffer,a,l=0){if(t===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(t)||t<=0)throw new Error(`Unexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=l;let u=t,d=u;this._levelBounds=[u*4];do u=Math.ceil(u/this.nodeSize),d+=u,this._levelBounds.push(d*4);while(u!==1);this.ArrayType=o,this.IndexArrayType=d<16384?Uint16Array:Uint32Array;const h=G0.indexOf(this.ArrayType),p=d*4*this.ArrayType.BYTES_PER_ELEMENT;if(h<0)throw new Error(`Unexpected typed array class: ${o}.`);a&&a.byteLength!==void 0&&!a.buffer?(this.data=a,this._boxes=new this.ArrayType(this.data,l+8,d*4),this._indices=new this.IndexArrayType(this.data,l+8+p,d),this._pos=d*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new s(8+p+d*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,d*4),this._indices=new this.IndexArrayType(this.data,8+p,d),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Xf<<4)+h]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t),this._queue=new R1}add(t,n,o=t,s=n){const a=this._pos>>2,l=this._boxes;return this._indices[a]=a,l[this._pos++]=t,l[this._pos++]=n,l[this._pos++]=o,l[this._pos++]=s,t<this.minX&&(this.minX=t),n<this.minY&&(this.minY=n),o>this.maxX&&(this.maxX=o),s>this.maxY&&(this.maxY=s),a}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const t=this._boxes;if(this.numItems<=this.nodeSize){t[this._pos++]=this.minX,t[this._pos++]=this.minY,t[this._pos++]=this.maxX,t[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,o=this.maxY-this.minY||1,s=new Uint32Array(this.numItems),a=65535;for(let l=0,u=0;l<this.numItems;l++){const d=t[u++],h=t[u++],p=t[u++],m=t[u++],S=Math.floor(a*((d+p)/2-this.minX)/n),y=Math.floor(a*((h+m)/2-this.minY)/o);s[l]=M1(S,y)}Ph(s,t,this._indices,0,this.numItems-1,this.nodeSize);for(let l=0,u=0;l<this._levelBounds.length-1;l++){const d=this._levelBounds[l];for(;u<d;){const h=u;let p=t[u++],m=t[u++],S=t[u++],y=t[u++];for(let I=1;I<this.nodeSize&&u<d;I++)p=Math.min(p,t[u++]),m=Math.min(m,t[u++]),S=Math.max(S,t[u++]),y=Math.max(y,t[u++]);this._indices[this._pos>>2]=h,t[this._pos++]=p,t[this._pos++]=m,t[this._pos++]=S,t[this._pos++]=y}}}search(t,n,o,s,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const u=[],d=[];for(;l!==void 0;){const h=Math.min(l+this.nodeSize*4,W0(l,this._levelBounds));for(let p=l;p<h;p+=4){if(o<this._boxes[p]||s<this._boxes[p+1]||t>this._boxes[p+2]||n>this._boxes[p+3])continue;const m=this._indices[p>>2]|0;l>=this.numItems*4?u.push(m):(a===void 0||a(m))&&d.push(m)}l=u.pop()}return d}neighbors(t,n,o=1/0,s=1/0,a){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let l=this._boxes.length-4;const u=this._queue,d=[],h=s*s;e:for(;l!==void 0;){const p=Math.min(l+this.nodeSize*4,W0(l,this._levelBounds));for(let m=l;m<p;m+=4){const S=this._indices[m>>2]|0,y=$0(t,this._boxes[m],this._boxes[m+2]),I=$0(n,this._boxes[m+1],this._boxes[m+3]),T=y*y+I*I;T>h||(l>=this.numItems*4?u.push(S<<1,T):(a===void 0||a(S))&&u.push((S<<1)+1,T))}for(;u.length&&u.peek()&1;)if(u.peekValue()>h||(d.push(u.pop()>>1),d.length===o))break e;l=u.length?u.pop()>>1:void 0}return u.clear(),d}}function $0(e,t,n){return e<t?t-e:e<=n?0:e-n}function W0(e,t){let n=0,o=t.length-1;for(;n<o;){const s=n+o>>1;t[s]>e?o=s:n=s+1}return t[n]}function Ph(e,t,n,o,s,a){if(Math.floor(o/a)>=Math.floor(s/a))return;const l=e[o+s>>1];let u=o-1,d=s+1;for(;;){do u++;while(e[u]<l);do d--;while(e[d]>l);if(u>=d)break;k1(e,t,n,u,d)}Ph(e,t,n,o,d,a),Ph(e,t,n,d+1,s,a)}function k1(e,t,n,o,s){const a=e[o];e[o]=e[s],e[s]=a;const l=4*o,u=4*s,d=t[l],h=t[l+1],p=t[l+2],m=t[l+3];t[l]=t[u],t[l+1]=t[u+1],t[l+2]=t[u+2],t[l+3]=t[u+3],t[u]=d,t[u+1]=h,t[u+2]=p,t[u+3]=m;const S=n[o];n[o]=n[s],n[s]=S}function M1(e,t){let n=e^t,o=65535^n,s=65535^(e|t),a=e&(t^65535),l=n|o>>1,u=n>>1^n,d=s>>1^o&a>>1^s,h=n&s>>1^a>>1^a;n=l,o=u,s=d,a=h,l=n&n>>2^o&o>>2,u=n&o>>2^o&(n^o)>>2,d^=n&s>>2^o&a>>2,h^=o&s>>2^(n^o)&a>>2,n=l,o=u,s=d,a=h,l=n&n>>4^o&o>>4,u=n&o>>4^o&(n^o)>>4,d^=n&s>>4^o&a>>4,h^=o&s>>4^(n^o)&a>>4,n=l,o=u,s=d,a=h,d^=n&s>>8^o&a>>8,h^=o&s>>8^(n^o)&a>>8,n=d^d>>1,o=h^h>>1;let p=e^t,m=o|65535^(p|n);return p=(p|p<<8)&16711935,p=(p|p<<4)&252645135,p=(p|p<<2)&858993459,p=(p|p<<1)&1431655765,m=(m|m<<8)&16711935,m=(m|m<<4)&252645135,m=(m|m<<2)&858993459,m=(m|m<<1)&1431655765,(m<<1|p)>>>0}function Xn(e,t){return{x:e.x+t.x,y:e.y+t.y}}function Qh(e,t){return{x:e.x-t.x,y:e.y-t.y}}function ct(e,t){return{x:e.x*t,y:e.y*t}}function Bo(e){return Math.sqrt(e.x*e.x+e.y*e.y)}function yt(e){const t=Bo(e);return t===0?{x:0,y:0}:ct(e,1/t)}function Vn(e,t){return Bo(Qh(e,t))}function ou(e,t,n){return{x:e.x+(t.x-e.x)*n,y:e.y+(t.y-e.y)*n}}function Y0(e){if(e.length===0)return{x:0,y:0};const t=e.reduce((n,o)=>({x:n.x+o.x,y:n.y+o.y}),{x:0,y:0});return{x:t.x/e.length,y:t.y/e.length}}function xe(e,t,n,o){let s=t.x-e.x,a=t.y-e.y;return Math.abs(s)>n/2&&(s=s-Math.sign(s)*n),Math.abs(a)>o/2&&(a=a-Math.sign(a)*o),{x:s,y:a}}function jt(e,t,n){const o=xe(e,t,n.width,n.height);return yt(o)}function K(e,t,n,o){const s=xe(e,t,n,o);return Bo(s)}function Rt(e,t,n,o){const s=xe(e,t,n,o);return s.x*s.x+s.y*s.y}function b1(e,t){return e.x*t.x+e.y*t.y}function D1(e,t){const n=b1(e,t),o=Bo(e),s=Bo(t);if(o===0||s===0)return 0;const a=Math.max(-1,Math.min(1,n/(o*s)));return Math.acos(a)}function ru(e,t){const n=Math.cos(t),o=Math.sin(t);return{x:e.x*n-e.y*o,y:e.x*o+e.y*n}}function O1(e,t){return t.split(".").reduce((n,o)=>{if(n&&typeof n=="object"&&o in n)return n[o]},e)}function Fi(e,t){if(e.length===0)return{all:()=>[],byRect:()=>[],byRadius:()=>[],at:()=>{},byProperty:()=>[],byPropertyPath:()=>[],resetPropertyCache:()=>{},count:()=>0};const n=new Kh(e.length),o=new Map,s=new Map;let a=0;const l=new Uint32Array(e.length);for(let d=0;d<e.length;d++){const h=e[d];h.width!==void 0&&h.height!==void 0?n.add(h.position.x,h.position.y,h.position.x+h.width,h.position.y+h.height):n.add(h.position.x,h.position.y,h.position.x,h.position.y)}return n.finish(),{all(){return e},byRect(d){const{width:h,height:p}=t,m=[];a++;const S=[];d.left<0?(S.push({left:d.left+h,right:h}),S.push({left:0,right:d.right})):d.right>h?(S.push({left:d.left,right:h}),S.push({left:0,right:d.right-h})):S.push({left:d.left,right:d.right});const y=[];d.top<0?(y.push({top:d.top+p,bottom:p}),y.push({top:0,bottom:d.bottom})):d.bottom>p?(y.push({top:d.top,bottom:p}),y.push({top:0,bottom:d.bottom-p})):y.push({top:d.top,bottom:d.bottom});for(let I=0;I<S.length;I++){const T=S[I];for(let E=0;E<y.length;E++){const P=y[E],C=n.search(T.left,P.top,T.right,P.bottom);for(let _=0;_<C.length;_++){const k=C[_];l[k]!==a&&(l[k]=a,m.push(e[k]))}}}return m},byRadius(d,h){const{width:p,height:m}=t,S=[];a++;const y=h*h,I=d.x-h,T=d.x+h,E=d.y-h,P=d.y+h,C=[];I<0?(C.push({left:I+p,right:p}),C.push({left:0,right:T})):T>p?(C.push({left:I,right:p}),C.push({left:0,right:T-p})):C.push({left:I,right:T});const _=[];E<0?(_.push({top:E+m,bottom:m}),_.push({top:0,bottom:P})):P>m?(_.push({top:E,bottom:m}),_.push({top:0,bottom:P-m})):_.push({top:E,bottom:P});for(let k=0;k<C.length;k++){const w=C[k];for(let M=0;M<_.length;M++){const R=_[M],H=n.search(w.left,R.top,w.right,R.bottom);for(let j=0;j<H.length;j++){const $=H[j];if(l[$]!==a){l[$]=a;const V=e[$];Rt(d,V.position,p,m)<=y&&S.push(V)}}}}return S},at(d,h){return this.byRadius(d,h)[0]},byProperty(d,h){var p;if(!o.has(d)){const m=new Map;for(let S=0;S<e.length;S++){const y=e[S],I=y[d];m.has(I)||m.set(I,[]),m.get(I).push(y)}o.set(d,m)}return((p=o.get(d))==null?void 0:p.get(h))||[]},byPropertyPath(d,h){var p;if(!s.has(d)){const m=new Map;for(let S=0;S<e.length;S++){const y=e[S],I=O1(y,d);m.has(I)||m.set(I,[]),m.get(I).push(y)}s.set(d,m)}return((p=s.get(d))==null?void 0:p.get(h))||[]},resetPropertyCache(){o.clear(),s.clear()},count(){return e.length}}}function pl(e){var m,S;const t=e.entities.entities,n=[],o=[],s=[],a=[],l=[],u=[],d=[];for(const y in t){const I=t[y];switch(I.type){case"human":n.push(I);break;case"berryBush":o.push(I);break;case"corpse":s.push(I);break;case"prey":a.push(I);break;case"predator":l.push(I);break;case"building":u.push(I);break;case"tree":d.push(I);break}}const h=e.mapDimensions;return{...e,search:{human:Fi(n,h),berryBush:Fi(o,h),corpse:Fi(s,h),prey:Fi(a,h),predator:Fi(l,h),building:Fi(u,h),tree:Fi(d,h),tasks:((m=e.search)==null?void 0:m.tasks)??Fi([],h)},cache:{distances:{},tribeWoodNeeds:{},tribeAvailableWoodOnGround:{},tribeCenters:((S=e.cache)==null?void 0:S.tribeCenters)??{}}}}function N1(e){const t=[];for(const n in e.tasks)t.push(e.tasks[n]);e.search.tasks=Fi(t,e.mapDimensions)}const X={StorageSpot:"storageSpot",PlantingZone:"plantingZone",BorderPost:"borderPost",Bonfire:"bonfire",Palisade:"palisade",Gate:"gate"},mt={[X.StorageSpot]:{name:"Storage Spot",description:"A designated area for storing excess food.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[X.PlantingZone]:{name:"Planting Zone",description:"An area marked for agricultural use.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.1,destructionTimeHours:.1,cost:{}},[X.BorderPost]:{name:"Border Post",description:"A territorial marker that expands tribe borders",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:2}},[X.Bonfire]:{name:"Bonfire",description:"A shared tribe building that provides warmth.",icon:"",dimensions:{width:40,height:40},constructionTimeHours:.5,destructionTimeHours:.2,cost:{wood:5}},[X.Palisade]:{name:"Palisade",description:"A defensive wall segment that blocks movement.",icon:"",dimensions:{width:20,height:20},constructionTimeHours:.2,destructionTimeHours:.1,cost:{wood:1}},[X.Gate]:{name:"Gate",description:"A gate that allows passage for tribe members.",icon:"",dimensions:{width:60,height:60},constructionTimeHours:.4,destructionTimeHours:.2,cost:{wood:3}}},B1=.5,H1="#FFA500",F1="#FF4500",j0=4,x1=10,Pu=60;function Jh(e){return mt[e].dimensions}function L1(e){return mt[e].constructionTimeHours}function U1(e){return mt[e].destructionTimeHours}const bv=5;function G1(){return mt[X.PlantingZone].dimensions}function z0(e,t,n){const o=e.position.x+n.width/2,a=t.position.x-n.width/2-o,l=e.position.y-n.height/2,u=e.position.y+n.height/2,d=t.position.y-n.height/2,h=t.position.y+n.height/2,p=Math.min(u,h)-Math.max(l,d);return a>=-5&&a<=bv&&p>n.height*.5}function X0(e,t,n){const o=e.position.y+n.height/2,a=t.position.y-n.height/2-o,l=e.position.x-n.width/2,u=e.position.x+n.width/2,d=t.position.x-n.width/2,h=t.position.x+n.width/2,p=Math.min(u,h)-Math.max(l,d);return a>=-5&&a<=bv&&p>n.width*.5}function $1(e){var l;const t={},n=G1(),o=e;if(!((l=o.search)!=null&&l.building))return t;const a=o.search.building.all().filter(u=>u.buildingType===X.PlantingZone&&u.isConstructed);for(const u of a)t[u.id]={top:!1,bottom:!1,left:!1,right:!1};for(let u=0;u<a.length;u++){const d=a[u];for(let h=u+1;h<a.length;h++){const p=a[h];d.ownerId===p.ownerId&&(z0(d,p,n)&&(t[d.id].right=!0,t[p.id].left=!0),z0(p,d,n)&&(t[p.id].right=!0,t[d.id].left=!0),X0(d,p,n)&&(t[d.id].bottom=!0,t[p.id].top=!0),X0(p,d,n)&&(t[p.id].bottom=!0,t[d.id].top=!0))}}return t}function nl(e){e.plantingZoneConnections=$1(e)}var rr=(e=>(e.SAVE_REQUEST="SAVE_REQUEST",e.SAVE_RESPONSE="SAVE_RESPONSE",e.LOAD_REQUEST="LOAD_REQUEST",e.LOAD_RESPONSE="LOAD_RESPONSE",e.CLEAR_REQUEST="CLEAR_REQUEST",e.CLEAR_RESPONSE="CLEAR_RESPONSE",e))(rr||{});class W1{constructor(){Yt(this,"worker",null);Yt(this,"pendingRequests",new Map);Yt(this,"requestQueue",[]);Yt(this,"isProcessing",!1);Yt(this,"nextRequestId",0);this.initializeWorker()}initializeWorker(){try{this.worker=new Worker(new URL(""+new URL("persistence-worker-DlQCmfqn.js",import.meta.url).href,import.meta.url),{type:"module"}),this.worker.onmessage=t=>{this.handleWorkerMessage(t.data)},this.worker.onerror=t=>{console.error("[WorkerManager] Worker error:",t),this.pendingRequests.forEach(({reject:n})=>{n(new Error("Worker encountered an error"))}),this.pendingRequests.clear()},console.log("[WorkerManager] Persistence worker initialized.")}catch(t){console.error("[WorkerManager] Failed to initialize worker:",t),this.worker=null}}handleWorkerMessage(t){const n=this.pendingRequests.get(t.id);if(!n){console.warn("[WorkerManager] Received response for unknown request:",t.id);return}switch(this.pendingRequests.delete(t.id),t.type){case rr.SAVE_RESPONSE:this.handleSaveResponse(t,n);break;case rr.LOAD_RESPONSE:this.handleLoadResponse(t,n);break;case rr.CLEAR_RESPONSE:this.handleClearResponse(t,n);break;default:console.error("[WorkerManager] Unknown response type:",t),n.reject(new Error("Unknown response type"));break}}handleSaveResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Save failed"))}handleLoadResponse(t,n){t.success?n.resolve(t.gameState):n.reject(new Error(t.error||"Load failed"))}handleClearResponse(t,n){t.success?n.resolve():n.reject(new Error(t.error||"Clear failed"))}generateRequestId(){return`req_${this.nextRequestId++}_${Date.now()}`}sendMessage(t){return new Promise((n,o)=>{if(!this.worker){o(new Error("Worker not initialized"));return}this.pendingRequests.set(t.id,{resolve:n,reject:o});try{this.worker.postMessage(t)}catch(s){this.pendingRequests.delete(t.id),o(s)}})}queueOperation(t){return new Promise((n,o)=>{this.requestQueue.push(async()=>{try{const s=await t();n(s)}catch(s){o(s)}}),this.isProcessing||this.processQueue()})}async processQueue(){if(!(this.isProcessing||this.requestQueue.length===0)){for(this.isProcessing=!0;this.requestQueue.length>0;){const t=this.requestQueue.shift();if(t)try{await t()}catch(n){console.error("[WorkerManager] Error processing queued operation:",n)}}this.isProcessing=!1}}saveGame(t){return this.queueOperation(async()=>{const n=this.generateRequestId(),o=t,s={type:rr.SAVE_REQUEST,id:n,gameState:o};await this.sendMessage(s)})}loadGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:rr.LOAD_REQUEST,id:t};return await this.sendMessage(n)??null})}clearSavedGame(){return this.queueOperation(async()=>{const t=this.generateRequestId(),n={type:rr.CLEAR_REQUEST,id:t};await this.sendMessage(n)})}}const ep=new W1;async function tp(e){try{const t={time:e.time,entities:e.entities,visualEffects:e.visualEffects,nextVisualEffectId:e.nextVisualEffectId,scheduledEvents:e.scheduledEvents,nextScheduledEventId:e.nextScheduledEventId,mapDimensions:e.mapDimensions,generationCount:e.generationCount,gameOver:e.gameOver,viewportCenter:e.viewportCenter,isPaused:e.isPaused,exitConfirmation:e.exitConfirmation,autopilotControls:e.autopilotControls,buildMenuOpen:e.buildMenuOpen,tribeModalOpen:e.tribeModalOpen,cameraFollowingPlayer:e.cameraFollowingPlayer,cameraZoom:e.cameraZoom,isDraggingMinimap:e.isDraggingMinimap,minimapDragDistance:e.minimapDragDistance,selectedBuildingType:e.selectedBuildingType,selectedBuildingForRemoval:e.selectedBuildingForRemoval,hasPlayerMovedEver:e.hasPlayerMovedEver,hasPlayerPlantedBush:e.hasPlayerPlantedBush,hasPlayerEnabledAutopilot:e.hasPlayerEnabledAutopilot,masterVolume:e.masterVolume,isMuted:e.isMuted,uiButtons:e.uiButtons,tutorial:e.tutorial,tutorialState:e.tutorialState,notifications:e.notifications,ecosystem:e.ecosystem,soilDepletion:e.soilDepletion,debugPanel:e.debugPanel,debugPanelScroll:e.debugPanelScroll,isDraggingDebugPanel:e.isDraggingDebugPanel,performanceMetrics:e.performanceMetrics,lastAutosaveTime:e.lastAutosaveTime,plantingZoneConnections:e.plantingZoneConnections,terrainOwnership:e.terrainOwnership,temperature:e.temperature,tasks:e.tasks,navigationGrid:e.navigationGrid,pathfindingQueue:e.pathfindingQueue,isDraggingViewport:e.isDraggingViewport,viewportDragButton:e.viewportDragButton,viewportDragDistance:e.viewportDragDistance};await ep.saveGame(t)}catch(t){throw console.error("Failed to save game:",t),t}}async function Y1(){try{const e=await ep.loadGame();if(!e)return null;console.log("Game loaded successfully.");const t=e;t.plantingZoneConnections||(t.plantingZoneConnections={});const n=pl(t);return nl(n),n}catch(e){return console.error("Failed to load game:",e),await Dv(),null}}async function Dv(){try{await ep.clearSavedGame()}catch(e){console.error("Failed to clear saved game:",e)}}const Ov=Q.createContext(void 0),j1=({initialAppState:e,children:t})=>{const[n,o]=Q.useState(e),[s,a]=Q.useState(void 0),[l,u]=Q.useState(null),[d,h]=Q.useState(!1);Q.useEffect(()=>{Y1().then(I=>{I&&u(I),h(!0)})},[]);const p=(I,T)=>{o(I),I==="gameOver"&&T?a(T):I!=="gameOver"&&a(void 0)},m=()=>{o("intro"),a(void 0),y()},S=I=>{tp(I),u(I)},y=()=>{Dv(),u(null)};return z.jsx(Ov.Provider,{value:{appState:n,setAppState:p,returnToIntro:m,gameOverDetails:s,contextReady:d,savedGameState:l,setSavedGameState:u,saveCurrentGame:S,clearCurrentSave:y},children:t})},Pi=()=>{const e=Q.useContext(Ov);if(e===void 0)throw new Error("useGameContext must be used within a GameProvider");return e};var nn=function(){return nn=Object.assign||function(t){for(var n,o=1,s=arguments.length;o<s;o++){n=arguments[o];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},nn.apply(this,arguments)};function il(e,t,n){if(n||arguments.length===2)for(var o=0,s=t.length,a;o<s;o++)(a||!(o in t))&&(a||(a=Array.prototype.slice.call(t,0,o)),a[o]=t[o]);return e.concat(a||Array.prototype.slice.call(t))}var lt="-ms-",Ya="-moz-",Ve="-webkit-",Nv="comm",_u="rule",np="decl",z1="@import",Bv="@keyframes",X1="@layer",Hv=Math.abs,ip=String.fromCharCode,_h=Object.assign;function V1(e,t){return Lt(e,0)^45?(((t<<2^Lt(e,0))<<2^Lt(e,1))<<2^Lt(e,2))<<2^Lt(e,3):0}function Fv(e){return e.trim()}function Ui(e,t){return(e=t.exec(e))?e[0]:e}function Ue(e,t,n){return e.replace(t,n)}function qc(e,t,n){return e.indexOf(t,n)}function Lt(e,t){return e.charCodeAt(t)|0}function gs(e,t,n){return e.slice(t,n)}function Ti(e){return e.length}function xv(e){return e.length}function Fa(e,t){return t.push(e),e}function q1(e,t){return e.map(t).join("")}function V0(e,t){return e.filter(function(n){return!Ui(n,t)})}var Ru=1,ms=1,Lv=0,qn=0,_t=0,Ms="";function ku(e,t,n,o,s,a,l,u){return{value:e,root:t,parent:n,type:o,props:s,children:a,line:Ru,column:ms,length:l,return:"",siblings:u}}function Po(e,t){return _h(ku("",null,null,"",null,null,0,e.siblings),e,{length:-e.length},t)}function Jr(e){for(;e.root;)e=Po(e.root,{children:[e]});Fa(e,e.siblings)}function Z1(){return _t}function K1(){return _t=qn>0?Lt(Ms,--qn):0,ms--,_t===10&&(ms=1,Ru--),_t}function ai(){return _t=qn<Lv?Lt(Ms,qn++):0,ms++,_t===10&&(ms=1,Ru++),_t}function ur(){return Lt(Ms,qn)}function Zc(){return qn}function Mu(e,t){return gs(Ms,e,t)}function Rh(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Q1(e){return Ru=ms=1,Lv=Ti(Ms=e),qn=0,[]}function J1(e){return Ms="",e}function Vf(e){return Fv(Mu(qn-1,kh(e===91?e+2:e===40?e+1:e)))}function eE(e){for(;(_t=ur())&&_t<33;)ai();return Rh(e)>2||Rh(_t)>3?"":" "}function tE(e,t){for(;--t&&ai()&&!(_t<48||_t>102||_t>57&&_t<65||_t>70&&_t<97););return Mu(e,Zc()+(t<6&&ur()==32&&ai()==32))}function kh(e){for(;ai();)switch(_t){case e:return qn;case 34:case 39:e!==34&&e!==39&&kh(_t);break;case 40:e===41&&kh(e);break;case 92:ai();break}return qn}function nE(e,t){for(;ai()&&e+_t!==57;)if(e+_t===84&&ur()===47)break;return"/*"+Mu(t,qn-1)+"*"+ip(e===47?e:ai())}function iE(e){for(;!Rh(ur());)ai();return Mu(e,qn)}function oE(e){return J1(Kc("",null,null,null,[""],e=Q1(e),0,[0],e))}function Kc(e,t,n,o,s,a,l,u,d){for(var h=0,p=0,m=l,S=0,y=0,I=0,T=1,E=1,P=1,C=0,_="",k=s,w=a,M=o,R=_;E;)switch(I=C,C=ai()){case 40:if(I!=108&&Lt(R,m-1)==58){qc(R+=Ue(Vf(C),"&","&\f"),"&\f",Hv(h?u[h-1]:0))!=-1&&(P=-1);break}case 34:case 39:case 91:R+=Vf(C);break;case 9:case 10:case 13:case 32:R+=eE(I);break;case 92:R+=tE(Zc()-1,7);continue;case 47:switch(ur()){case 42:case 47:Fa(rE(nE(ai(),Zc()),t,n,d),d);break;default:R+="/"}break;case 123*T:u[h++]=Ti(R)*P;case 125*T:case 59:case 0:switch(C){case 0:case 125:E=0;case 59+p:P==-1&&(R=Ue(R,/\f/g,"")),y>0&&Ti(R)-m&&Fa(y>32?Z0(R+";",o,n,m-1,d):Z0(Ue(R," ","")+";",o,n,m-2,d),d);break;case 59:R+=";";default:if(Fa(M=q0(R,t,n,h,p,s,u,_,k=[],w=[],m,a),a),C===123)if(p===0)Kc(R,t,M,M,k,a,m,u,w);else switch(S===99&&Lt(R,3)===110?100:S){case 100:case 108:case 109:case 115:Kc(e,M,M,o&&Fa(q0(e,M,M,0,0,s,u,_,s,k=[],m,w),w),s,w,m,u,o?k:w);break;default:Kc(R,M,M,M,[""],w,0,u,w)}}h=p=y=0,T=P=1,_=R="",m=l;break;case 58:m=1+Ti(R),y=I;default:if(T<1){if(C==123)--T;else if(C==125&&T++==0&&K1()==125)continue}switch(R+=ip(C),C*T){case 38:P=p>0?1:(R+="\f",-1);break;case 44:u[h++]=(Ti(R)-1)*P,P=1;break;case 64:ur()===45&&(R+=Vf(ai())),S=ur(),p=m=Ti(_=R+=iE(Zc())),C++;break;case 45:I===45&&Ti(R)==2&&(T=0)}}return a}function q0(e,t,n,o,s,a,l,u,d,h,p,m){for(var S=s-1,y=s===0?a:[""],I=xv(y),T=0,E=0,P=0;T<o;++T)for(var C=0,_=gs(e,S+1,S=Hv(E=l[T])),k=e;C<I;++C)(k=Fv(E>0?y[C]+" "+_:Ue(_,/&\f/g,y[C])))&&(d[P++]=k);return ku(e,t,n,s===0?_u:u,d,h,p,m)}function rE(e,t,n,o){return ku(e,t,n,Nv,ip(Z1()),gs(e,2,-2),0,o)}function Z0(e,t,n,o,s){return ku(e,t,n,np,gs(e,0,o),gs(e,o+1,-1),o,s)}function Uv(e,t,n){switch(V1(e,t)){case 5103:return Ve+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Ve+e+e;case 4789:return Ya+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Ve+e+Ya+e+lt+e+e;case 5936:switch(Lt(e,t+11)){case 114:return Ve+e+lt+Ue(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Ve+e+lt+Ue(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Ve+e+lt+Ue(e,/[svh]\w+-[tblr]{2}/,"lr")+e}case 6828:case 4268:case 2903:return Ve+e+lt+e+e;case 6165:return Ve+e+lt+"flex-"+e+e;case 5187:return Ve+e+Ue(e,/(\w+).+(:[^]+)/,Ve+"box-$1$2"+lt+"flex-$1$2")+e;case 5443:return Ve+e+lt+"flex-item-"+Ue(e,/flex-|-self/g,"")+(Ui(e,/flex-|baseline/)?"":lt+"grid-row-"+Ue(e,/flex-|-self/g,""))+e;case 4675:return Ve+e+lt+"flex-line-pack"+Ue(e,/align-content|flex-|-self/g,"")+e;case 5548:return Ve+e+lt+Ue(e,"shrink","negative")+e;case 5292:return Ve+e+lt+Ue(e,"basis","preferred-size")+e;case 6060:return Ve+"box-"+Ue(e,"-grow","")+Ve+e+lt+Ue(e,"grow","positive")+e;case 4554:return Ve+Ue(e,/([^-])(transform)/g,"$1"+Ve+"$2")+e;case 6187:return Ue(Ue(Ue(e,/(zoom-|grab)/,Ve+"$1"),/(image-set)/,Ve+"$1"),e,"")+e;case 5495:case 3959:return Ue(e,/(image-set\([^]*)/,Ve+"$1$`$1");case 4968:return Ue(Ue(e,/(.+:)(flex-)?(.*)/,Ve+"box-pack:$3"+lt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Ve+e+e;case 4200:if(!Ui(e,/flex-|baseline/))return lt+"grid-column-align"+gs(e,t)+e;break;case 2592:case 3360:return lt+Ue(e,"template-","")+e;case 4384:case 3616:return n&&n.some(function(o,s){return t=s,Ui(o.props,/grid-\w+-end/)})?~qc(e+(n=n[t].value),"span",0)?e:lt+Ue(e,"-start","")+e+lt+"grid-row-span:"+(~qc(n,"span",0)?Ui(n,/\d+/):+Ui(n,/\d+/)-+Ui(e,/\d+/))+";":lt+Ue(e,"-start","")+e;case 4896:case 4128:return n&&n.some(function(o){return Ui(o.props,/grid-\w+-start/)})?e:lt+Ue(Ue(e,"-end","-span"),"span ","")+e;case 4095:case 3583:case 4068:case 2532:return Ue(e,/(.+)-inline(.+)/,Ve+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ti(e)-1-t>6)switch(Lt(e,t+1)){case 109:if(Lt(e,t+4)!==45)break;case 102:return Ue(e,/(.+:)(.+)-([^]+)/,"$1"+Ve+"$2-$3$1"+Ya+(Lt(e,t+3)==108?"$3":"$2-$3"))+e;case 115:return~qc(e,"stretch",0)?Uv(Ue(e,"stretch","fill-available"),t,n)+e:e}break;case 5152:case 5920:return Ue(e,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(o,s,a,l,u,d,h){return lt+s+":"+a+h+(l?lt+s+"-span:"+(u?d:+d-+a)+h:"")+e});case 4949:if(Lt(e,t+6)===121)return Ue(e,":",":"+Ve)+e;break;case 6444:switch(Lt(e,Lt(e,14)===45?18:11)){case 120:return Ue(e,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+Ve+(Lt(e,14)===45?"inline-":"")+"box$3$1"+Ve+"$2$3$1"+lt+"$2box$3")+e;case 100:return Ue(e,":",":"+lt)+e}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Ue(e,"scroll-","scroll-snap-")+e}return e}function su(e,t){for(var n="",o=0;o<e.length;o++)n+=t(e[o],o,e,t)||"";return n}function sE(e,t,n,o){switch(e.type){case X1:if(e.children.length)break;case z1:case np:return e.return=e.return||e.value;case Nv:return"";case Bv:return e.return=e.value+"{"+su(e.children,o)+"}";case _u:if(!Ti(e.value=e.props.join(",")))return""}return Ti(n=su(e.children,o))?e.return=e.value+"{"+n+"}":""}function aE(e){var t=xv(e);return function(n,o,s,a){for(var l="",u=0;u<t;u++)l+=e[u](n,o,s,a)||"";return l}}function lE(e){return function(t){t.root||(t=t.return)&&e(t)}}function cE(e,t,n,o){if(e.length>-1&&!e.return)switch(e.type){case np:e.return=Uv(e.value,e.length,n);return;case Bv:return su([Po(e,{value:Ue(e.value,"@","@"+Ve)})],o);case _u:if(e.length)return q1(n=e.props,function(s){switch(Ui(s,o=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Jr(Po(e,{props:[Ue(s,/:(read-\w+)/,":"+Ya+"$1")]})),Jr(Po(e,{props:[s]})),_h(e,{props:V0(n,o)});break;case"::placeholder":Jr(Po(e,{props:[Ue(s,/:(plac\w+)/,":"+Ve+"input-$1")]})),Jr(Po(e,{props:[Ue(s,/:(plac\w+)/,":"+Ya+"$1")]})),Jr(Po(e,{props:[Ue(s,/:(plac\w+)/,lt+"input-$1")]})),Jr(Po(e,{props:[s]})),_h(e,{props:V0(n,o)});break}return""})}}var uE={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Mn={},ys=typeof process<"u"&&Mn!==void 0&&(Mn.REACT_APP_SC_ATTR||Mn.SC_ATTR)||"data-styled",Gv="active",$v="data-styled-version",bu="6.1.13",op=`/*!sc*/
`,au=typeof window<"u"&&"HTMLElement"in window,dE=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Mn!==void 0&&Mn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Mn.REACT_APP_SC_DISABLE_SPEEDY!==""?Mn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Mn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Mn!==void 0&&Mn.SC_DISABLE_SPEEDY!==void 0&&Mn.SC_DISABLE_SPEEDY!==""&&Mn.SC_DISABLE_SPEEDY!=="false"&&Mn.SC_DISABLE_SPEEDY),fE={},Du=Object.freeze([]),vs=Object.freeze({});function Wv(e,t,n){return n===void 0&&(n=vs),e.theme!==n.theme&&e.theme||t||n.theme}var Yv=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),hE=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,pE=/(^-|-$)/g;function K0(e){return e.replace(hE,"-").replace(pE,"")}var gE=/(a)(d)/gi,Nc=52,Q0=function(e){return String.fromCharCode(e+(e>25?39:97))};function Mh(e){var t,n="";for(t=Math.abs(e);t>Nc;t=t/Nc|0)n=Q0(t%Nc)+n;return(Q0(t%Nc)+n).replace(gE,"$1-$2")}var qf,jv=5381,rs=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},zv=function(e){return rs(jv,e)};function Xv(e){return Mh(zv(e)>>>0)}function mE(e){return e.displayName||e.name||"Component"}function Zf(e){return typeof e=="string"&&!0}var Vv=typeof Symbol=="function"&&Symbol.for,qv=Vv?Symbol.for("react.memo"):60115,yE=Vv?Symbol.for("react.forward_ref"):60112,vE={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},SE={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},Zv={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},TE=((qf={})[yE]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},qf[qv]=Zv,qf);function J0(e){return("type"in(t=e)&&t.type.$$typeof)===qv?Zv:"$$typeof"in e?TE[e.$$typeof]:vE;var t}var IE=Object.defineProperty,AE=Object.getOwnPropertyNames,ey=Object.getOwnPropertySymbols,EE=Object.getOwnPropertyDescriptor,wE=Object.getPrototypeOf,ty=Object.prototype;function Kv(e,t,n){if(typeof t!="string"){if(ty){var o=wE(t);o&&o!==ty&&Kv(e,o,n)}var s=AE(t);ey&&(s=s.concat(ey(t)));for(var a=J0(e),l=J0(t),u=0;u<s.length;++u){var d=s[u];if(!(d in SE||n&&n[d]||l&&d in l||a&&d in a)){var h=EE(t,d);try{IE(e,d,h)}catch{}}}}return e}function Ss(e){return typeof e=="function"}function rp(e){return typeof e=="object"&&"styledComponentId"in e}function ar(e,t){return e&&t?"".concat(e," ").concat(t):e||t||""}function bh(e,t){if(e.length===0)return"";for(var n=e[0],o=1;o<e.length;o++)n+=e[o];return n}function ol(e){return e!==null&&typeof e=="object"&&e.constructor.name===Object.name&&!("props"in e&&e.$$typeof)}function Dh(e,t,n){if(n===void 0&&(n=!1),!n&&!ol(e)&&!Array.isArray(e))return t;if(Array.isArray(t))for(var o=0;o<t.length;o++)e[o]=Dh(e[o],t[o]);else if(ol(t))for(var o in t)e[o]=Dh(e[o],t[o]);return e}function sp(e,t){Object.defineProperty(e,"toString",{value:t})}function gl(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(e," for more information.").concat(t.length>0?" Args: ".concat(t.join(", ")):""))}var CE=function(){function e(t){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=t}return e.prototype.indexOfGroup=function(t){for(var n=0,o=0;o<t;o++)n+=this.groupSizes[o];return n},e.prototype.insertRules=function(t,n){if(t>=this.groupSizes.length){for(var o=this.groupSizes,s=o.length,a=s;t>=a;)if((a<<=1)<0)throw gl(16,"".concat(t));this.groupSizes=new Uint32Array(a),this.groupSizes.set(o),this.length=a;for(var l=s;l<a;l++)this.groupSizes[l]=0}for(var u=this.indexOfGroup(t+1),d=(l=0,n.length);l<d;l++)this.tag.insertRule(u,n[l])&&(this.groupSizes[t]++,u++)},e.prototype.clearGroup=function(t){if(t<this.length){var n=this.groupSizes[t],o=this.indexOfGroup(t),s=o+n;this.groupSizes[t]=0;for(var a=o;a<s;a++)this.tag.deleteRule(o)}},e.prototype.getGroup=function(t){var n="";if(t>=this.length||this.groupSizes[t]===0)return n;for(var o=this.groupSizes[t],s=this.indexOfGroup(t),a=s+o,l=s;l<a;l++)n+="".concat(this.tag.getRule(l)).concat(op);return n},e}(),Qc=new Map,lu=new Map,Jc=1,Bc=function(e){if(Qc.has(e))return Qc.get(e);for(;lu.has(Jc);)Jc++;var t=Jc++;return Qc.set(e,t),lu.set(t,e),t},PE=function(e,t){Jc=t+1,Qc.set(e,t),lu.set(t,e)},_E="style[".concat(ys,"][").concat($v,'="').concat(bu,'"]'),RE=new RegExp("^".concat(ys,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),kE=function(e,t,n){for(var o,s=n.split(","),a=0,l=s.length;a<l;a++)(o=s[a])&&e.registerName(t,o)},ME=function(e,t){for(var n,o=((n=t.textContent)!==null&&n!==void 0?n:"").split(op),s=[],a=0,l=o.length;a<l;a++){var u=o[a].trim();if(u){var d=u.match(RE);if(d){var h=0|parseInt(d[1],10),p=d[2];h!==0&&(PE(p,h),kE(e,p,d[3]),e.getTag().insertRules(h,s)),s.length=0}else s.push(u)}}},ny=function(e){for(var t=document.querySelectorAll(_E),n=0,o=t.length;n<o;n++){var s=t[n];s&&s.getAttribute(ys)!==Gv&&(ME(e,s),s.parentNode&&s.parentNode.removeChild(s))}};function bE(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var Qv=function(e){var t=document.head,n=e||t,o=document.createElement("style"),s=function(u){var d=Array.from(u.querySelectorAll("style[".concat(ys,"]")));return d[d.length-1]}(n),a=s!==void 0?s.nextSibling:null;o.setAttribute(ys,Gv),o.setAttribute($v,bu);var l=bE();return l&&o.setAttribute("nonce",l),n.insertBefore(o,a),o},DE=function(){function e(t){this.element=Qv(t),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var o=document.styleSheets,s=0,a=o.length;s<a;s++){var l=o[s];if(l.ownerNode===n)return l}throw gl(17)}(this.element),this.length=0}return e.prototype.insertRule=function(t,n){try{return this.sheet.insertRule(n,t),this.length++,!0}catch{return!1}},e.prototype.deleteRule=function(t){this.sheet.deleteRule(t),this.length--},e.prototype.getRule=function(t){var n=this.sheet.cssRules[t];return n&&n.cssText?n.cssText:""},e}(),OE=function(){function e(t){this.element=Qv(t),this.nodes=this.element.childNodes,this.length=0}return e.prototype.insertRule=function(t,n){if(t<=this.length&&t>=0){var o=document.createTextNode(n);return this.element.insertBefore(o,this.nodes[t]||null),this.length++,!0}return!1},e.prototype.deleteRule=function(t){this.element.removeChild(this.nodes[t]),this.length--},e.prototype.getRule=function(t){return t<this.length?this.nodes[t].textContent:""},e}(),NE=function(){function e(t){this.rules=[],this.length=0}return e.prototype.insertRule=function(t,n){return t<=this.length&&(this.rules.splice(t,0,n),this.length++,!0)},e.prototype.deleteRule=function(t){this.rules.splice(t,1),this.length--},e.prototype.getRule=function(t){return t<this.length?this.rules[t]:""},e}(),iy=au,BE={isServer:!au,useCSSOMInjection:!dE},cu=function(){function e(t,n,o){t===void 0&&(t=vs),n===void 0&&(n={});var s=this;this.options=nn(nn({},BE),t),this.gs=n,this.names=new Map(o),this.server=!!t.isServer,!this.server&&au&&iy&&(iy=!1,ny(this)),sp(this,function(){return function(a){for(var l=a.getTag(),u=l.length,d="",h=function(m){var S=function(P){return lu.get(P)}(m);if(S===void 0)return"continue";var y=a.names.get(S),I=l.getGroup(m);if(y===void 0||!y.size||I.length===0)return"continue";var T="".concat(ys,".g").concat(m,'[id="').concat(S,'"]'),E="";y!==void 0&&y.forEach(function(P){P.length>0&&(E+="".concat(P,","))}),d+="".concat(I).concat(T,'{content:"').concat(E,'"}').concat(op)},p=0;p<u;p++)h(p);return d}(s)})}return e.registerId=function(t){return Bc(t)},e.prototype.rehydrate=function(){!this.server&&au&&ny(this)},e.prototype.reconstructWithOptions=function(t,n){return n===void 0&&(n=!0),new e(nn(nn({},this.options),t),this.gs,n&&this.names||void 0)},e.prototype.allocateGSInstance=function(t){return this.gs[t]=(this.gs[t]||0)+1},e.prototype.getTag=function(){return this.tag||(this.tag=(t=function(n){var o=n.useCSSOMInjection,s=n.target;return n.isServer?new NE(s):o?new DE(s):new OE(s)}(this.options),new CE(t)));var t},e.prototype.hasNameForId=function(t,n){return this.names.has(t)&&this.names.get(t).has(n)},e.prototype.registerName=function(t,n){if(Bc(t),this.names.has(t))this.names.get(t).add(n);else{var o=new Set;o.add(n),this.names.set(t,o)}},e.prototype.insertRules=function(t,n,o){this.registerName(t,n),this.getTag().insertRules(Bc(t),o)},e.prototype.clearNames=function(t){this.names.has(t)&&this.names.get(t).clear()},e.prototype.clearRules=function(t){this.getTag().clearGroup(Bc(t)),this.clearNames(t)},e.prototype.clearTag=function(){this.tag=void 0},e}(),HE=/&/g,FE=/^\s*\/\/.*$/gm;function Jv(e,t){return e.map(function(n){return n.type==="rule"&&(n.value="".concat(t," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(t," ")),n.props=n.props.map(function(o){return"".concat(t," ").concat(o)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=Jv(n.children,t)),n})}function xE(e){var t,n,o,s=vs,a=s.options,l=a===void 0?vs:a,u=s.plugins,d=u===void 0?Du:u,h=function(S,y,I){return I.startsWith(n)&&I.endsWith(n)&&I.replaceAll(n,"").length>0?".".concat(t):S},p=d.slice();p.push(function(S){S.type===_u&&S.value.includes("&")&&(S.props[0]=S.props[0].replace(HE,n).replace(o,h))}),l.prefix&&p.push(cE),p.push(sE);var m=function(S,y,I,T){y===void 0&&(y=""),I===void 0&&(I=""),T===void 0&&(T="&"),t=T,n=y,o=new RegExp("\\".concat(n,"\\b"),"g");var E=S.replace(FE,""),P=oE(I||y?"".concat(I," ").concat(y," { ").concat(E," }"):E);l.namespace&&(P=Jv(P,l.namespace));var C=[];return su(P,aE(p.concat(lE(function(_){return C.push(_)})))),C};return m.hash=d.length?d.reduce(function(S,y){return y.name||gl(15),rs(S,y.name)},jv).toString():"",m}var LE=new cu,Oh=xE(),eS=Ii.createContext({shouldForwardProp:void 0,styleSheet:LE,stylis:Oh});eS.Consumer;Ii.createContext(void 0);function Nh(){return Q.useContext(eS)}var UE=function(){function e(t,n){var o=this;this.inject=function(s,a){a===void 0&&(a=Oh);var l=o.name+a.hash;s.hasNameForId(o.id,l)||s.insertRules(o.id,l,a(o.rules,l,"@keyframes"))},this.name=t,this.id="sc-keyframes-".concat(t),this.rules=n,sp(this,function(){throw gl(12,String(o.name))})}return e.prototype.getName=function(t){return t===void 0&&(t=Oh),this.name+t.hash},e}(),GE=function(e){return e>="A"&&e<="Z"};function oy(e){for(var t="",n=0;n<e.length;n++){var o=e[n];if(n===1&&o==="-"&&e[0]==="-")return e;GE(o)?t+="-"+o.toLowerCase():t+=o}return t.startsWith("ms-")?"-"+t:t}var tS=function(e){return e==null||e===!1||e===""},nS=function(e){var t,n,o=[];for(var s in e){var a=e[s];e.hasOwnProperty(s)&&!tS(a)&&(Array.isArray(a)&&a.isCss||Ss(a)?o.push("".concat(oy(s),":"),a,";"):ol(a)?o.push.apply(o,il(il(["".concat(s," {")],nS(a),!1),["}"],!1)):o.push("".concat(oy(s),": ").concat((t=s,(n=a)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||t in uE||t.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return o};function No(e,t,n,o){if(tS(e))return[];if(rp(e))return[".".concat(e.styledComponentId)];if(Ss(e)){if(!Ss(a=e)||a.prototype&&a.prototype.isReactComponent||!t)return[e];var s=e(t);return No(s,t,n,o)}var a;return e instanceof UE?n?(e.inject(n,o),[e.getName(o)]):[e]:ol(e)?nS(e):Array.isArray(e)?Array.prototype.concat.apply(Du,e.map(function(l){return No(l,t,n,o)})):[e.toString()]}function iS(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(Ss(n)&&!rp(n))return!1}return!0}var $E=zv(bu),WE=function(){function e(t,n,o){this.rules=t,this.staticRulesId="",this.isStatic=(o===void 0||o.isStatic)&&iS(t),this.componentId=n,this.baseHash=rs($E,n),this.baseStyle=o,cu.registerId(n)}return e.prototype.generateAndInjectStyles=function(t,n,o){var s=this.baseStyle?this.baseStyle.generateAndInjectStyles(t,n,o):"";if(this.isStatic&&!o.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))s=ar(s,this.staticRulesId);else{var a=bh(No(this.rules,t,n,o)),l=Mh(rs(this.baseHash,a)>>>0);if(!n.hasNameForId(this.componentId,l)){var u=o(a,".".concat(l),void 0,this.componentId);n.insertRules(this.componentId,l,u)}s=ar(s,l),this.staticRulesId=l}else{for(var d=rs(this.baseHash,o.hash),h="",p=0;p<this.rules.length;p++){var m=this.rules[p];if(typeof m=="string")h+=m;else if(m){var S=bh(No(m,t,n,o));d=rs(d,S+p),h+=S}}if(h){var y=Mh(d>>>0);n.hasNameForId(this.componentId,y)||n.insertRules(this.componentId,y,o(h,".".concat(y),void 0,this.componentId)),s=ar(s,y)}}return s},e}(),ap=Ii.createContext(void 0);ap.Consumer;var Kf={};function YE(e,t,n){var o=rp(e),s=e,a=!Zf(e),l=t.attrs,u=l===void 0?Du:l,d=t.componentId,h=d===void 0?function(k,w){var M=typeof k!="string"?"sc":K0(k);Kf[M]=(Kf[M]||0)+1;var R="".concat(M,"-").concat(Xv(bu+M+Kf[M]));return w?"".concat(w,"-").concat(R):R}(t.displayName,t.parentComponentId):d,p=t.displayName,m=p===void 0?function(k){return Zf(k)?"styled.".concat(k):"Styled(".concat(mE(k),")")}(e):p,S=t.displayName&&t.componentId?"".concat(K0(t.displayName),"-").concat(t.componentId):t.componentId||h,y=o&&s.attrs?s.attrs.concat(u).filter(Boolean):u,I=t.shouldForwardProp;if(o&&s.shouldForwardProp){var T=s.shouldForwardProp;if(t.shouldForwardProp){var E=t.shouldForwardProp;I=function(k,w){return T(k,w)&&E(k,w)}}else I=T}var P=new WE(n,S,o?s.componentStyle:void 0);function C(k,w){return function(M,R,H){var j=M.attrs,$=M.componentStyle,V=M.defaultProps,ee=M.foldedComponentIds,ue=M.styledComponentId,oe=M.target,re=Ii.useContext(ap),fe=Nh(),ie=M.shouldForwardProp||fe.shouldForwardProp,W=Wv(R,re,V)||vs,te=function(ne,se,ge){for(var L,ce=nn(nn({},se),{className:void 0,theme:ge}),ye=0;ye<ne.length;ye+=1){var Ae=Ss(L=ne[ye])?L(ce):L;for(var Z in Ae)ce[Z]=Z==="className"?ar(ce[Z],Ae[Z]):Z==="style"?nn(nn({},ce[Z]),Ae[Z]):Ae[Z]}return se.className&&(ce.className=ar(ce.className,se.className)),ce}(j,R,W),x=te.as||oe,D={};for(var G in te)te[G]===void 0||G[0]==="$"||G==="as"||G==="theme"&&te.theme===W||(G==="forwardedAs"?D.as=te.forwardedAs:ie&&!ie(G,x)||(D[G]=te[G]));var J=function(ne,se){var ge=Nh(),L=ne.generateAndInjectStyles(se,ge.styleSheet,ge.stylis);return L}($,te),pe=ar(ee,ue);return J&&(pe+=" "+J),te.className&&(pe+=" "+te.className),D[Zf(x)&&!Yv.has(x)?"class":"className"]=pe,D.ref=H,Q.createElement(x,D)}(_,k,w)}C.displayName=m;var _=Ii.forwardRef(C);return _.attrs=y,_.componentStyle=P,_.displayName=m,_.shouldForwardProp=I,_.foldedComponentIds=o?ar(s.foldedComponentIds,s.styledComponentId):"",_.styledComponentId=S,_.target=o?s.target:e,Object.defineProperty(_,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(k){this._foldedDefaultProps=o?function(w){for(var M=[],R=1;R<arguments.length;R++)M[R-1]=arguments[R];for(var H=0,j=M;H<j.length;H++)Dh(w,j[H],!0);return w}({},s.defaultProps,k):k}}),sp(_,function(){return".".concat(_.styledComponentId)}),a&&Kv(_,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),_}function ry(e,t){for(var n=[e[0]],o=0,s=t.length;o<s;o+=1)n.push(t[o],e[o+1]);return n}var sy=function(e){return Object.assign(e,{isCss:!0})};function oS(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Ss(e)||ol(e))return sy(No(ry(Du,il([e],t,!0))));var o=e;return t.length===0&&o.length===1&&typeof o[0]=="string"?No(o):sy(No(ry(o,t)))}function Bh(e,t,n){if(n===void 0&&(n=vs),!t)throw gl(1,t);var o=function(s){for(var a=[],l=1;l<arguments.length;l++)a[l-1]=arguments[l];return e(t,n,oS.apply(void 0,il([s],a,!1)))};return o.attrs=function(s){return Bh(e,t,nn(nn({},n),{attrs:Array.prototype.concat(n.attrs,s).filter(Boolean)}))},o.withConfig=function(s){return Bh(e,t,nn(nn({},n),s))},o}var rS=function(e){return Bh(YE,e)},Ne=rS;Yv.forEach(function(e){Ne[e]=rS(e)});var jE=function(){function e(t,n){this.rules=t,this.componentId=n,this.isStatic=iS(t),cu.registerId(this.componentId+1)}return e.prototype.createStyles=function(t,n,o,s){var a=s(bh(No(this.rules,n,o,s)),""),l=this.componentId+t;o.insertRules(l,l,a)},e.prototype.removeStyles=function(t,n){n.clearRules(this.componentId+t)},e.prototype.renderStyles=function(t,n,o,s){t>2&&cu.registerId(this.componentId+t),this.removeStyles(t,o),this.createStyles(t,n,o,s)},e}();function zE(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=oS.apply(void 0,il([e],t,!1)),s="sc-global-".concat(Xv(JSON.stringify(o))),a=new jE(o,s),l=function(d){var h=Nh(),p=Ii.useContext(ap),m=Ii.useRef(h.styleSheet.allocateGSInstance(s)).current;return h.styleSheet.server&&u(m,d,h.styleSheet,p,h.stylis),Ii.useLayoutEffect(function(){if(!h.styleSheet.server)return u(m,d,h.styleSheet,p,h.stylis),function(){return a.removeStyles(m,h.styleSheet)}},[m,d,h.styleSheet,p,h.stylis]),null};function u(d,h,p,m,S){if(a.isStatic)a.renderStyles(d,fE,p,S);else{var y=nn(nn({},h),{theme:Wv(h,m,l.defaultProps)});a.renderStyles(d,y,p,S)}}return Ii.memo(l)}function lp(e,t){t===void 0&&(t=!0);var n=Q.useRef(null),o=Q.useRef(!1),s=Q.useRef(e);s.current=e;var a=Q.useCallback(function(u){o.current&&(s.current(u),n.current=requestAnimationFrame(a))},[]),l=Q.useMemo(function(){return[function(){o.current&&(o.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){o.current||(o.current=!0,n.current=requestAnimationFrame(a))},function(){return o.current}]},[]);return Q.useEffect(function(){return t&&l[1](),l[0]},[]),l}function XE(e,t,n,o,s){var l;(l=e.onExit)==null||l.call(e,o,t);const a=s.find(({id:u})=>u===t);return a!=null&&a.onEnter?a.onEnter(o,n):{...n,enteredAt:o.updateContext.gameState.time}}function VE(e,t){return t.find(({id:n})=>n===e)}function qE(e,t){return e!==t}function ZE(e){e&&console.warn(`No handler found for state: ${e}`)}const ja="bushGrowing",sr="bushFull",eu="bushSpreading",rl="bushDying",Ot=24,Ut=10,We=4e3,Ye=4e3,uu=5,KE=15,QE=5e3,ji=100,zi=20,Xi=60,Vi=200,sS=200,JE=1e3,ew=5,tw=3,nw=12,iw=940,Hh=20,ay=90,aS=100,vr=5,ow=.5,Ou=30,qi=.1,xa=.9,rw=2,sw=2;var ui=(e=>(e.Berry="berry",e.Meat="meat",e))(ui||{});const cp={berry:"",meat:""};function lS(e,t){return e+t*65536}function cS(e){return{gridX:e%65536,gridY:Math.floor(e/65536)}}function aw(){return{health:100,lastWalkTime:0,lastPlantTime:0,lastAffectedBy:{}}}function up(){return{lastUpdateTime:0,sectors:{}}}const zt=20,du=100,uS=20,dS=0,lw=20,cw=1,fS=.15,uw=.5,dw=.01,fw=24,hw="#6B5344",pw="#4A3728",ly=.85,hS=35,gw=30,cy=1.25,Fh=40,za=Math.PI/6,pS=.5,mw=1,Nu=10,sl=80,gS=3,Ea=5,on=150,mS=on*.8,yw=on*.2,jn=on*.8,Ho=30,yS=10,vw=10,Sw=.5,Qe=30,vS=Qe*.75,Bu=30,SS=Bu*.75,TS=50,Tw=20,Iw=sl*.8,Aw=.7,fu=16,dp=40,fp=16,Ew=72/3,uy=24,ww=1.25,Cw=1.5,dy=on*.6,IS=50,Pw=1,hp=sl*.65,_w=80,Rw=50,kw=1,Mw=128,AS=10,fy=100,pp=35,Fo=30,Hu=.5,ml=2.5,gp=20,An=250,mp=.4,yp=150,vp=6,bw=5,Sp=2,Fu=.5,xu=1.5,Dw=1,Ow=.5,Nw=.5,Bw=1.5,Hw=.25,Fw=2.5,xw=45,Lw=.05;var bt=(e=>(e.Friendly="Friendly",e.Hostile="Hostile",e))(bt||{}),qe=(e=>(e[e.None=0]="None",e[e.General=1]="General",e[e.Performance=2]="Performance",e[e.Ecosystem=3]="Ecosystem",e[e.Tribe=4]="Tribe",e))(qe||{}),Sr=(e=>(e.Hello="HELLO",e.NewTribeFormed="NEW_TRIBE_FORMED",e.TribeMerged="TRIBE_MERGED",e.NoHeir="NO_HEIR",e))(Sr||{});const hu=24,Uw=24;let Gw=0;function $w(){return`notification-${Date.now()}-${Gw++}`}function al(e,t){if(t.identifier){const o=e.notifications.find(s=>s.identifier===t.identifier);if(o){if(o.dismissedUntil&&e.time<o.dismissedUntil)return;o.message=t.message,o.timestamp=e.time,o.creationTime=Date.now(),o.duration=t.duration,o.targetEntityIds=t.targetEntityIds,o.highlightedEntityIds=t.highlightedEntityIds,o.targetPosition=t.targetPosition,o.targetArea=t.targetArea,o.targetRadius=t.targetRadius,o.isDismissed=!1,o.dismissedUntil=void 0;return}}const n={...t,id:$w(),timestamp:e.time,creationTime:Date.now(),isDismissed:!1};e.notifications.push(n)}function Ww(e,t){const n=e.notifications.find(o=>o.id===t);n&&(n.isDismissed=!0,n.identifier&&(n.dismissedUntil=e.time+Uw))}function Yw(e){const t=e.time;e.notifications=e.notifications.filter(n=>n.duration===0?!0:!(t-n.timestamp>n.duration))}function jw(e){for(const n of Object.values(e.entities.entities))n.isHighlighted=!1;const t=e.notifications.filter(n=>!n.isDismissed);for(const n of t)if(n.highlightedEntityIds)for(const o of n.highlightedEntityIds){const s=e.entities.entities[o];s&&(s.isHighlighted=!0)}}function ES(e,t,n,o){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random())*t,l={x:Math.cos(s)*a,y:Math.sin(s)*a},u=Xn(e,l);return{x:(u.x%n+n)%n,y:(u.y%o+o)%o}}function Qi(e,t,n,o){const s=t,{width:a,height:l}=t.mapDimensions,u={left:e.x-n,top:e.y-n,right:e.x+n,bottom:e.y+n},d=h=>{for(let p=0;p<h.length;p++){const m=h[p];if(o!==void 0&&m.id===o)continue;const S=Rt(e,m.position,a,l),y=n+m.radius;if(S<y*y)return!0}return!1};return d(s.search.human.byRect(u))||d(s.search.berryBush.byRect(u))||d(s.search.corpse.byRect(u))}function zw(e,t,n,o,s){const a=t.mapDimensions.width,l=t.mapDimensions.height;if(!Qi(e,t,o,s)&&!Er(t.soilDepletion,e,a,l))return e;const u=o;for(let d=u;d<=n;d+=u){const h=Math.ceil(2*Math.PI*d/u);for(let p=0;p<h;p++){const m=p/h*2*Math.PI,S={x:Math.cos(m)*d,y:Math.sin(m)*d},y=Xn(e,S),I={x:(y.x%a+a)%a,y:(y.y%l+l)%l};if(!Qi(I,t,o,s)&&!Er(t.soilDepletion,I,a,l))return I}}return null}function li(e,t){var l,u;const n=t;if((u=(l=n.cache)==null?void 0:l.tribeCenters)!=null&&u[e])return n.cache.tribeCenters[e];const o=t.search.building.byProperty("ownerId",e);if(o.length>0){const d=o.map(h=>h.position);return n.cache.tribeCenters[e]=Y0(d)}const s=xo(e,t);if(s.length===0){const d=t.entities.entities[e];return n.cache.tribeCenters[e]=d?d.position:{x:0,y:0}}const a=s.map(d=>d.position);return n.cache.tribeCenters[e]=Y0(a)}function hy(e,t,n){const o=n.mapDimensions.width,s=n.mapDimensions.height;let a=e.x-t.position.x,l=e.y-t.position.y;return Math.abs(a)>o/2&&(a-=Math.sign(a)*o),Math.abs(l)>s/2&&(l-=Math.sign(l)*s),Math.abs(a)<=t.width/2&&Math.abs(l)<=t.height/2}const Ai=80,Xt=["#4CAF50","#F44336","#2196F3","#FF9800","#9C27B0","#00BCD4","#FFEB3B","#795548"],_e=20,eo=(e,t,n)=>{var u,d,h,p;if(!e||!t||e===t)return!1;const o=n.entities.entities[e],s=n.entities.entities[t],a=(d=(u=o==null?void 0:o.tribeControl)==null?void 0:u.diplomacy)==null?void 0:d[t],l=(p=(h=s==null?void 0:s.tribeControl)==null?void 0:h.diplomacy)==null?void 0:p[e];return a===bt.Hostile||l===bt.Hostile},yl=(e,t,n)=>e.id===t.id?!1:eo(e.leaderId,t.leaderId,n),Tr=(e,t,n)=>!e.leaderId||!t.ownerId||t.ownerId===e.leaderId?!1:eo(e.leaderId,t.ownerId,n),bs=(e,t,n)=>{if(e.id===t.id||e.gender===t.gender||!e.isAdult||!t.isAdult||e.hunger>=jn||t.hunger>=jn||(e.procreationCooldown||0)>0||(t.procreationCooldown||0)>0||yl(e,t,n))return!1;const o=e.gender==="female"?e:t;return!(o.isPregnant||o.age>dp)},py=1,xh=150*.6,Xw=800,Vw=3,gy=24,qw=1.5,my=.15,yy=200,Qf=30*.75*1.2,Zw=20,Jf=800,Kw=.7,Qw=.5,Jw=10,eh=400,eC=800,tC=8,nC=16,vl=100,iC=100,wS=150,vy=600,Sy=250,oC=.5,rC=.7,sC=300,aC=150;function lC(e){const t=Math.floor(e.x/_e),n=Math.floor(e.y/_e);return{x:t,y:n}}function Lh(e,t){const n=Math.ceil(t/_e),o=e%n*_e+_e/2,s=Math.floor(e/n)*_e+_e/2;return{x:o,y:s}}function cC(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(o/_e),l=Math.floor(s/_e),u=Math.ceil(t/_e);return l*u+a}function Nn(e,t,n){const o=cC({x:e,y:t},n.mapDimensions.width,n.mapDimensions.height);return n.terrainOwnership[o]||null}function Tp(e,t){return t.terrainOwnership.includes(e)}function CS(e,t,n,o){var l;const s=n;return(l=s.search)!=null&&l.human?s.search.human.byRadius(e,o).some(u=>eo(t,u.leaderId,n)):!1}function uC(e,t,n,o,s=!1,a){if(s&&a&&CS(e,a,o,wS))return{valid:!1,reason:"Cannot expand into hostile territory while enemies are nearby"};const{width:l,height:u}=o.mapDimensions,d=Math.ceil(l/_e),h=Math.ceil(u/_e),p=Math.ceil(t/_e),m=t*t,S=Math.floor(e.x/_e),y=Math.floor(e.y/_e);let I=!1,T=!1;for(let E=-p;E<=p;E++)for(let P=-p;P<=p;P++){const C=((S+P)%d+d)%d,_=((y+E)%h+h)%h,k=C*_e+_e/2,w=_*_e+_e/2;if(Rt(e,{x:k,y:w},l,u)<=m){const R=_*d+C,H=o.terrainOwnership[R];if(H===n)I=!0;else if(H!==null){if(s&&a&&eo(a,H,o))continue;T=!0}}}return T?{valid:!1,reason:"Position overlaps with another tribe's territory"}:I?{valid:!0}:Tp(n,o)?{valid:!1,reason:"Territory must be contiguous with existing territory"}:{valid:!0}}function PS(e,t,n,o){if(!Tp(n,o))return{valid:!1,reason:"Tribe must have territory before taking over buildings"};if(CS(e,n,o,wS))return{valid:!1,reason:"Cannot take over building while enemies are nearby"};const{width:s,height:a}=o.mapDimensions,l=Math.ceil(s/_e),u=Math.ceil(a/_e),d=Math.ceil(t/_e),h=t*t,p=Math.floor(e.x/_e),m=Math.floor(e.y/_e);let S=!1;for(let y=-d;y<=d;y++){for(let I=-d;I<=d;I++){const T=((p+I)%l+l)%l,E=((m+y)%u+u)%u,P=T*_e+_e/2,C=E*_e+_e/2;if(Rt(e,{x:P,y:C},s,a)<=h){const k=E*l+T;if(o.terrainOwnership[k]===n){S=!0;break}}}if(S)break}return S?{valid:!0}:{valid:!1,reason:"Building must be adjacent to your existing territory"}}function dC(e,t,n,o=0,s=!1,a){if(o>0){const u=uC(e,o,t,n,s,a);return u.valid?{canPlace:!0}:{canPlace:!1,reason:u.reason}}const l=Nn(e.x,e.y,n);return l===null||l===t?{canPlace:!0}:s&&a&&eo(a,l,n)?{canPlace:!0}:l!==t?{canPlace:!1,reason:"Position is inside another tribe's territory"}:{canPlace:!0}}function Pr(e,t,n){const o=Nn(e.x,e.y,n);return o===null||o===t||!eo(t,o,n)}function _S(e,t,n,o,{allowOverwrite:s}){const{width:a,height:l}=o.mapDimensions,u=Math.ceil(a/_e),d=Math.ceil(l/_e),h=Math.ceil(t/_e),p=Math.floor(e.x/_e),m=Math.floor(e.y/_e);for(let C=-h;C<=h;C++)for(let _=-h;_<=h;_++){const k=((p+_)%u+u)%u,w=((m+C)%d+d)%d,M=k*_e+_e/2,R=w*_e+_e/2;if(K(e,{x:M,y:R},a,l)<=t){const j=w*u+k,$=o.terrainOwnership[j];(s||$===null||$===n)&&(o.terrainOwnership[j]=n)}}const S=3,y=h+S+2,I=[];for(let C=-y;C<=y;C++)for(let _=-y;_<=y;_++){const k=((p+_)%u+u)%u,w=((m+C)%d+d)%d,M=w*u+k;if(o.terrainOwnership[M]===null){let R=!1;const H=[{x:1,y:0},{x:0,y:1},{x:1,y:1},{x:1,y:-1}];for(const j of H){let $=!1,V=!1;for(let ee=1;ee<=S;ee++){const ue=((k+j.x*ee)%u+u)%u,re=((w+j.y*ee)%d+d)%d*u+ue;if(o.terrainOwnership[re]===n){$=!0;break}}if($)for(let ee=1;ee<=S;ee++){const ue=((k-j.x*ee)%u+u)%u,re=((w-j.y*ee)%d+d)%d*u+ue;if(o.terrainOwnership[re]===n){V=!0;break}}if($&&V){R=!0;break}}R&&I.push(M)}}for(const C of I)o.terrainOwnership[C]=n;const T=250,E=new Set;for(let C=-y;C<=y;C++)for(let _=-y;_<=y;_++){const k=((p+_)%u+u)%u,M=((m+C)%d+d)%d*u+k;if(o.terrainOwnership[M]===null&&!E.has(M)){const R=[],H=[M];E.add(M),R.push(M);let j=!0,$=0;for(;$<H.length;){const V=H[$++];if(R.length>T){j=!1;break}const ee=V%u,ue=Math.floor(V/u),oe=[{nx:0,ny:-1},{nx:1,ny:0},{nx:0,ny:1},{nx:-1,ny:0}];for(const{nx:re,ny:fe}of oe){const ie=((ee+re)%u+u)%u,te=((ue+fe)%d+d)%d*u+ie;o.terrainOwnership[te]===null&&!E.has(te)&&(E.add(te),j&&(R.push(te),H.push(te)))}}if(j&&R.length<=T)for(const V of R)o.terrainOwnership[V]=n}}const P=[];for(let C=-y;C<=y;C++)for(let _=-y;_<=y;_++){const k=((p+_)%u+u)%u,w=((m+C)%d+d)%d,M=w*u+k;if(o.terrainOwnership[M]===null){let R=0;for(let H=-1;H<=1;H++)for(let j=-1;j<=1;j++){if(j===0&&H===0)continue;const $=((k+j)%u+u)%u,ee=((w+H)%d+d)%d*u+$;o.terrainOwnership[ee]===n&&R++}R>=5&&P.push(M)}}for(const C of P)o.terrainOwnership[C]=n}function hs(e,t,n,o){_S(e,t,n,o,{allowOverwrite:!1})}function RS(e,t,n,o){_S(e,t,n,o,{allowOverwrite:!0})}function pu(e,t,n){const o=e.terrainOwnership;for(let s=0;s<o.length;s++)o[s]===t&&(o[s]=n)}function Ke(e,t,n,o,s){const a=t,l=o,u="position"in e&&e.id?e:null,d=u?u.position:e,h=a.search[n].byRadius(d,l);let p=null,m=l;for(const S of h){if(S.id===(u==null?void 0:u.id)||s&&!s(S))continue;const y=K(d,S.position,t.mapDimensions.width,t.mapDimensions.height);y<m&&(m=y,p=S)}return p}function Nt(e){const n=e.search.human.byProperty("isPlayer",!0);return n.length>0?n[0]:void 0}function fC(e,t){var l;const o=t.search.human.byProperty("activeAction","attacking");let s=null,a=1/0;for(const u of o){if(u.attackTargetId!==e)continue;const d=K(u.position,((l=t.entities.entities[e])==null?void 0:l.position)||{x:0,y:0},t.mapDimensions.width,t.mapDimensions.height);d<a&&(s=u,a=d)}return s}function kS(e){return e.search.human.all()}function hC(e,t,n){const{width:o,height:s}=t.mapDimensions,a=Object.values(t.entities.entities).reverse();for(const l of a){const u=K(e,l.position,o,s),d=l.type==="tree"?l.radius*2:l.radius;if(u<d)return l}}function pC(e,t,n,o,s){const{width:a,height:l}=o.mapDimensions,u=n*n;if(s){for(let S=0;S<s.length;S++)if(Rt(e,s[S],a,l)<u)return!0;return!1}const d=kS(o),h=new Set;for(let S=0;S<d.length;S++){const y=d[S];y.leaderId&&y.leaderId!==t&&h.add(y.leaderId)}const p=h.values();let m=p.next();for(;!m.done;){const S=m.value,y=li(S,o);if(Rt(e,y,a,l)<u)return!0;m=p.next()}return!1}var Ce=(e=>(e[e.Procreation=0]="Procreation",e[e.Pregnant=1]="Pregnant",e[e.TargetAcquired=2]="TargetAcquired",e[e.Attack=3]="Attack",e[e.Partnered=4]="Partnered",e[e.BushClaimed=5]="BushClaimed",e[e.BushClaimLost=6]="BushClaimLost",e[e.Eating=7]="Eating",e[e.ChildFed=8]="ChildFed",e[e.AttackDeflected=9]="AttackDeflected",e[e.AttackResisted=10]="AttackResisted",e[e.Hit=11]="Hit",e[e.SeizeBuildup=12]="SeizeBuildup",e[e.Seize=13]="Seize",e[e.AutopilotMoveTarget=14]="AutopilotMoveTarget",e[e.BorderClaim=15]="BorderClaim",e[e.StoneProjectile=16]="StoneProjectile",e))(Ce||{});function Fe(e,t,n,o,s,a,l){const u={id:e.nextVisualEffectId,type:t,position:n,startTime:e.time,duration:o,entityId:s,targetPosition:a,targetEntityId:l};return e.visualEffects.push(u),e.nextVisualEffectId++,u.id}const Xe=1,ll=3,Wi=100,MS=20,dr=10,gC=.5,Xa=150,mC=25,yC=.5,Uh=100,bS=25,vC=.5,SC=15,Gh=4,TC=.75,IC=15,AC=8,EC=20;function Ir(e,t,n,o,s,a){if(n===void 0)return!1;const{width:l,height:u}=o.mapDimensions;if(s&&a!==void 0&&Rt(s,e,l,u)>a*a)return!1;const d=Jh(t),h=Math.sqrt(d.width*d.width+d.height*d.height)/2;if(Qi(e,o,h*.8))return!1;if(t===X.PlantingZone){const{depletedSectors:T}=eT(o.soilDepletion,e,d.width,d.height,l,u);if(T.length>0)return!1}const m=o.search.building.byRadius(e,h*2);for(const T of m){const E=Rt(e,T.position,l,u),P=(Math.max(d.width,d.height)+Math.max(T.width,T.height))/2;if(E<P*P*.81)return!1}const S=t===X.BorderPost;return!!dC(e,n,o,S?Pu:Ai,S,n).canPlace}function wC(e){const t=[],n=2*Math.PI/e;for(let o=0;o<e;o++){const s=o*n;t.push({cos:Math.cos(s),sin:Math.sin(s)})}return t}function tu(e,t,n,o,s,a,l){const u=performance.now(),d=n,h=Jh(e),p=n.mapDimensions.width,m=n.mapDimensions.height,S=d.search.building.byProperty("ownerId",t),y=[];if(S.length>0){a&&y.unshift(a);const C=li(t,n),_=[...S].sort((k,w)=>{const M=Rt(k.position,C,p,m),R=Rt(w.position,C,p,m);return M-R});y.push(..._.map(k=>k.position))}else y.push(li(t,n));const I=Math.min(y.length,tC),T=Math.max(h.width,h.height),E=T+20,P=T/2;for(let C=0;C<I;C++){const _=y[C];for(let k=E;k<=o;k+=P){const w=Math.max(8,Math.min(nC,Math.ceil(2*Math.PI*k/T))),M=wC(w);for(let R=0;R<w;R++){const H=M[R].cos*k,j=M[R].sin*k,$=_.x+H,V=_.y+j,ee=($%p+p)%p,ue=(V%m+m)%m;if(!pC({x:ee,y:ue},t,s,n,l)&&Ir({x:ee,y:ue},e,t,n))return performance.now()-u,{x:ee,y:ue}}}}performance.now()-u}function Ip(e,t,n,o){if(t===X.BorderPost)return RS(e,Pu,n,o),Fe(o,Ce.BorderClaim,e,Xe,n),null;const s=YT(o.entities,e,t,n);return t===X.Bonfire&&(s.storageCapacity=Gh,s.storedItems=[]),hs(e,Ai,n,o),t===X.PlantingZone&&nl(o),s}function $h(e,t){const n=t.entities.entities[e];n&&n.type==="building"&&!n.isBeingDestroyed&&(n.isBeingDestroyed=!0,n.destructionProgress=0,n.buildingType===X.PlantingZone&&nl(t))}function CC(e,t){const s=t.search.building.byRadius(e,100);for(const a of s){let l=e.x-a.position.x,u=e.y-a.position.y;const d=t.mapDimensions.width,h=t.mapDimensions.height;if(Math.abs(l)>d/2&&(l-=Math.sign(l)*d),Math.abs(u)>h/2&&(u-=Math.sign(u)*h),Math.abs(l)<=a.width/2&&Math.abs(u)<=a.height/2)return a}}const ut=30,Ds=ut*.6,DS="#4CAF50",OS="#FF5722",NS="#9C27B0",PC="#2196F3",BS="#FFC107",_C="#DC143C",Ap="#FFFFFF",Ep=[5,5],Lu=5,Ts=15,RC=20,kC=16,MC=10,bC=16,DC=16,gu=["","","","","","","","","",""],Va=8,OC="#FFFFFF",In=18,Je=15,NC="rgba(0, 0, 0, 0.7)",BC=4,Ao=150,Rn=15,Bi=10,Mo="#555",HC="#f44336",FC="#4CAF50",xC="#2196F3",LC="#FFC107",Hc=16,Gi=32,Fc=28,UC=10,GC=8,$C=8,WC=8,nr=28,wa=40,Ca=10,Ty=8,YC=11,th=40,Iy=5,jC=10,zC="#FFA500",XC="#808080",Yi=120,HS=30,VC=20,On="#2d3748",Dt="#ffffff",La="#4a5568",FS=5,wp="#bdc9f792",xS="#272c36ff",LS="#a0aec0",mu=300,US="rgba(255, 255, 255, 0.5)",qC="rgba(0, 0, 0, 0.8)",ZC="#FFFFFF",Ay=14,Ey=8,wy=-15,GS="#FFD700",$S=5,KC="rgba(0, 0, 0, 0.5)",QC="#FFFFFF",JC=33,eP=400,tP=20,nP=10,iP="rgba(0, 0, 0, 0.7)",oP="#FFFFFF",nh=20,Cy=16,rP=.5,Py=5,WS="#FFD700",sP=40,Cp=4,YS=3,aP=5,jS=20,zS=5,lP="#FFFFFF",cP="#FF6B6B",kn=80,ir=10,xc=300,or=15,uP=8,dP="rgba(0, 0, 0, 0.8)",fP="#FFFFFF",ih=14,_y=10,mi=20,hP="#FF6B6B",pP="#4CAF50",Ry="#FFD700",gP="rgba(255, 255, 0, 0.3)",mP=2,yP=500,vP=120,SP=45,TP="#FFD700",IP=3,AP=4,oh=225,ky=20,EP="#666",wP="#1a2a3a";let rh=0;function yu(){const e=gu[rh];return rh=(rh+1)%gu.length,e}function Is(e){if(e.length===0)return;const t=e.filter(s=>s.gender==="male"),n=e.filter(s=>s.gender==="female"),o=(s,a)=>s.age!==a.age?a.age-s.age:s.id-a.id;if(t.sort(o),t.length>0)return t[0];if(n.sort(o),n.length>0)return n[0]}function Ji(e,t){const n=e,o=n.search.human.byProperty("motherId",t.id),s=n.search.human.byProperty("fatherId",t.id);return[...o,...s]}function Wh(e,t){var a,l,u,d;if(e.id===t.id||e.motherId===t.id||e.fatherId===t.id||t.motherId===e.id||t.fatherId===e.id||(a=e.partnerIds)!=null&&a.includes(t.id)||(l=t.partnerIds)!=null&&l.includes(e.id))return!0;if(e.fatherId===void 0&&e.motherId===void 0||t.fatherId===void 0&&t.motherId===void 0)return!1;const n=e.motherId===t.motherId||e.fatherId===t.fatherId,o=t.motherId===e.motherId||t.fatherId===e.fatherId,s=((u=e.ancestorIds)==null?void 0:u.some(h=>t.ancestorIds.includes(h)))||((d=t.ancestorIds)==null?void 0:d.some(h=>e.ancestorIds.includes(h)));return n||o||s}function XS(e,t){if(e.gender!=="female"||!e.partnerIds||e.partnerIds.length===0)return null;for(const n of e.partnerIds){const o=t.entities.entities[n];if(o&&o.gender==="male")return o}return null}function My(e,t){var n;if(!e.isAdult){if(e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human")return o}if(e.motherId){const o=t.entities.entities[e.motherId];if(o&&o.type==="human")return o}}if(e.isAdult&&e.fatherId){const o=t.entities.entities[e.fatherId];if(o&&o.type==="human"&&((n=Is(Ji(t,o)))==null?void 0:n.id)===e.id)return o}return e.isAdult&&e.gender==="female"&&e.partnerIds&&e.partnerIds.length>0?XS(e,t):null}function CP(e,t){let n=e;const o=new Set;o.add(n.id);for(let s=0;s<gS;s++){let a=null;if(n.gender==="female"&&(a=XS(n,t)),!a&&n.fatherId&&(a=t.entities.entities[n.fatherId]||null),!a||o.has(a.id))break;n=a,o.add(n.id)}return n}function PP(e,t){var o;const n=new Set;if(e.motherId){const s=t.entities.entities[e.motherId];s&&n.add(s)}if(e.fatherId){const s=t.entities.entities[e.fatherId];s&&n.add(s)}return(o=e.partnerIds)==null||o.forEach(s=>{const a=t.entities.entities[s];a&&n.add(a)}),Ji(t,e).forEach(s=>n.add(s)),Array.from(n)}function vu(e,t){const n=new Map;function o(s){const a=Ji(t,s);for(const l of a)n.has(l.id)||(n.set(l.id,l),o(l))}return o(e),Array.from(n.values())}function xo(e,t){return t.search.human.byProperty("leaderId",e)}function Su(e,t,n=new Map,o=new Set){var a;if(n.has(e))return n.get(e);if(o.has(e))return e;o.add(e);const s=t.entities.entities[e];if(!s)return e;if(s.gender==="female"&&((a=s.partnerIds)!=null&&a.length)){const l=s.partnerIds.find(u=>{const d=t.entities.entities[u];return d&&d.gender==="male"});if(l){const u=Su(l,t,n,o);return n.set(e,u),u}}if(s.fatherId&&t.entities.entities[s.fatherId]){const l=Su(s.fatherId,t,n,o);return n.set(e,l),l}return n.set(e,e),e}function _P(e,t){e.leaderId=e.id,t&&(e.tribeInfo=t.tribeInfo,e.tribeControl=t.tribeControl??{diplomacy:{}}),e.tribeInfo||(e.tribeInfo={tribeBadge:yu(),tribeColor:Xt[Math.floor(Math.random()*Xt.length)]}),e.tribeControl||(e.tribeControl={diplomacy:{}})}function RP(e,t){if(e.length===0)return null;const n=new Map,o=new Map;for(const l of e){const u=Su(l.id,t,n);o.has(u)||o.set(u,[]),o.get(u).push(l)}let s=null,a=0;for(const[l,u]of o.entries())u.length>a&&(a=u.length,s=l);return s&&t.entities.entities[s]||null}function Uu(e,t){var p,m,S;const n=new Map;for(let y=0;y<e.terrainOwnership.length;y++){const I=e.terrainOwnership[y];I!==null&&(n.has(I)||n.set(I,[]),n.get(I).push(y))}const{width:o,height:s}=e.mapDimensions,a=Math.ceil(o/_e),l=new Map,u=Object.values(e.entities.entities).filter(y=>y.type==="human");for(const y of u)y.leaderId&&(l.has(y.leaderId)||l.set(y.leaderId,{leaderId:y.leaderId,tribeInfo:y.tribeInfo,members:[]}),(p=l.get(y.leaderId))==null||p.members.push(y));const d=t?(S=(m=e.entities.entities[t])==null?void 0:m.tribeControl)==null?void 0:S.diplomacy:void 0,h=Array.from(l.values()).map(y=>{var _,k;const I=e.entities.entities[y.leaderId],T=y.members.filter(w=>w.isAdult).length,E=y.members.length-T,P=n.get(y.leaderId)||[];let C=I==null?void 0:I.position;if(P.length>0){const w=P[0],M=w%a*_e,R=Math.floor(w/a)*_e,H={x:M,y:R};let j=0,$=0;for(const ue of P){const oe=ue%a*_e,re=Math.floor(ue/a)*_e,fe=xe(H,{x:oe,y:re},o,s);j+=fe.x,$+=fe.y}const V=j/P.length,ee=$/P.length;C={x:((H.x+V)%o+o)%o,y:((H.y+ee)%s+s)%s}}return{leaderId:y.leaderId,tribeBadge:((_=y==null?void 0:y.tribeInfo)==null?void 0:_.tribeBadge)||"",tribeColor:((k=y==null?void 0:y.tribeInfo)==null?void 0:k.tribeColor)||"",adultCount:T,childCount:E,isPlayerTribe:y.leaderId===t,leaderAge:(I==null?void 0:I.age)??0,leaderGender:(I==null?void 0:I.gender)??"male",diplomacyStatus:(d==null?void 0:d[y.leaderId??-1])??bt.Friendly,territoryCenter:C}});return h.sort((y,I)=>y.isPlayerTribe?-1:I.isPlayerTribe?1:I.adultCount+I.childCount-(y.adultCount+y.childCount)),h}function VS(e,t){return e.leaderId?t.search.human.byProperty("leaderId",e.leaderId):[]}function qS(e){var a;const t=new Set,o=e.search.human.all(),s=new Map;for(const l of o)l.leaderId&&(s.has(l.leaderId)||s.set(l.leaderId,[]),(a=s.get(l.leaderId))==null||a.push(l));for(const[l,u]of s){if(u.length===0)continue;const d=e.entities.entities[l],h=!d,p=d&&d.leaderId!==l;(h||p)&&t.add(l)}for(let l=0;l<e.terrainOwnership.length;l++){const u=e.terrainOwnership[l];u!==null&&!s.has(u)&&t.add(u)}return Array.from(t)}function kP(e,t){const n=new Map,s=t.search.human.all(),a=PP(e,t);for(const u of a)n.set(u,3);for(const u of s)u.id===e.id||n.has(u)||Wh(e,u)&&n.set(u,2);const l=Array.from(n.keys());for(const u of l)if(u.partnerIds)for(const d of u.partnerIds){const h=t.entities.entities[d];h&&!n.has(h)&&h.id!==e.id&&n.set(h,1)}return n}function MP(e,t){const n=xo(e,t);if(n.length===0)return null;const o=t.entities.entities[e];if(o&&o.leaderId&&o.leaderId!==o.id)return o.leaderId;const s=new Map;for(const u of n){const d=kP(u,t);for(const[h,p]of d)if(h.leaderId&&h.leaderId!==e){const m=h.leaderId,S=t.entities.entities[m];if(S&&S.leaderId===S.id){const y=s.get(m)||0;s.set(m,y+p)}}}let a=null,l=0;for(const[u,d]of s)d>l&&(l=d,a=u);return a}function by(e,t,n){var p,m;const o=xo(e,n);let s=n.entities.entities[t];if(!s||(s.leaderId&&n.entities.entities[s.leaderId]&&(t=s.leaderId,s=n.entities.entities[t]),!s))return;const a=o.length>0?(p=o[0].tribeInfo)==null?void 0:p.tribeBadge:"?",l=s.leaderId===e||!s.leaderId;if(l){const S=n.entities.entities[e];_P(s,S)}const u=((m=s.tribeInfo)==null?void 0:m.tribeBadge)??"?";for(const S of o)S.id!==t&&(S.leaderId=t,S.tribeInfo=s.tribeInfo);const h=n.search.building.byProperty("ownerId",e);for(const S of h)S.ownerId=t;pu(n,e,t),al(n,{identifier:`tribe-merge-${e}`,type:Sr.TribeMerged,message:l?`Tribe ${a} has a new leader!`:`Tribe ${a} has merged into Tribe ${u}!`,duration:hu,targetEntityIds:[t],highlightedEntityIds:[t,...o.map(S=>S.id)]})}function bP(e){var n;const t=qS(e);for(const o of t){const s=xo(o,e);if(s.length===0){const d=e.search.building.byProperty("ownerId",o);for(const h of d)$h(h.id,e);pu(e,o,null),al(e,{identifier:`tribe-dissolved-${o}`,type:Sr.TribeMerged,message:"An extinct tribe has been dissolved.",duration:hu});continue}const a=RP(s,e);if(a){by(o,a.id,e);continue}const l=MP(o,e);if(l)by(o,l,e);else{const u=s.length>0?(n=s[0].tribeInfo)==null?void 0:n.tribeBadge:"?";for(const p of s)p.leaderId=void 0,p.tribeInfo=void 0;const h=e.search.building.byProperty("ownerId",o);for(const p of h)$h(p.id,e);pu(e,o,null),al(e,{identifier:`tribe-dissolved-${o}`,type:Sr.TribeMerged,message:`Tribe ${u} has been dissolved due to lack of leadership.`,duration:hu})}}}var Gt=(e=>(e.Wood="wood",e))(Gt||{});const Pp={wood:""},ri="treeGrowing",zn="treeFull",Ei="treeSpreading",Vt="treeFallen",wi="treeStump",Ar="treeDying";function ZS(e,t){if(e&&t.cache.tribeWoodNeeds[e]!==void 0)return t.cache.tribeWoodNeeds[e];const n=VS({leaderId:e},t),o=0,l=t.search.building.byProperty("ownerId",e).reduce((I,T)=>{if(T.isConstructed)return I;const E=mt[T.buildingType].cost.wood||0;return I+E},0),d=FP(e,t).reduce((I,T)=>{const P=(T.maxFuelLevel||Uh)-(T.fuelLevel||0);if(P<=0)return I;const C=Math.ceil(P/bS),_=T.storedItems.filter(w=>w.item.type===Gt.Wood).length,k=Math.max(0,C-_);return I+k},0),p=HP(e,t).reduce((I,T)=>{var P;const E=(P=T.storedItems)==null?void 0:P.filter(C=>C.item.type===Gt.Wood);return I+((E==null?void 0:E.length)||0)},0),m=n.reduce((I,T)=>{var E;return I+(((E=T.heldItem)==null?void 0:E.type)===Gt.Wood?1:0)},0),S=p+m,y=l+d+o;return t.cache.tribeWoodNeeds[e]=Math.max(0,y-S),t.cache.tribeWoodNeeds[e]}function DP(e,t){const n=t;if(e&&n.cache.tribeAvailableWoodOnGround[e]!==void 0)return n.cache.tribeAvailableWoodOnGround[e];const o=n.search.tree.all().filter(s=>!(s.stateMachine[0]===Vt)||s.wood.length===0?!1:Pr(s.position,e,t));return n.cache.tribeAvailableWoodOnGround[e]=o.reduce((s,a)=>s+a.wood.length,0),n.cache.tribeAvailableWoodOnGround[e]}function OP(e,t,n=!1){const o=typeof e=="object"?e.leaderId:e;return o?t.search.building.byProperty("buildingType",X.PlantingZone).filter(a=>{if(!n&&!a.isConstructed)return!1;if(a.ownerId){const l=t.entities.entities[a.ownerId];return l&&l.leaderId===o}return!1}):[]}function NP(e,t){const{width:n,height:o,position:s}=e,{width:a,height:l}=t.mapDimensions,{depletedSectors:u,totalSectorsCount:d}=eT(t.soilDepletion,s,n,o,a,l);return d===0?!0:u.length/d<.25}function KS(e){const t=Ou*2,n=Math.floor(e.width/t),o=Math.floor(e.height/t);return n*o}function BP(e,t){const n=t,o=Math.max(e.width,e.height);return n.search.berryBush.byRadius(e.position,o).filter(l=>{const u=Math.abs(l.position.x-e.position.x),d=Math.abs(l.position.y-e.position.y);return u<=e.width/2&&d<=e.height/2}).length}function HP(e,t,n=!1){return t.search.building.byProperty("buildingType",X.StorageSpot).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function FP(e,t,n=!1){return t.search.building.byProperty("buildingType",X.Bonfire).filter(s=>{if(!n&&!s.isConstructed)return!1;if(s.ownerId){const a=t.entities.entities[s.ownerId];return a&&a.leaderId===e}return!1})}function Sl(e,t,n=void 0){return n?OP(n,t).some(l=>hy(e,l,t)):t.search.building.byRadius(e,60).some(a=>a.buildingType===X.PlantingZone&&hy(e,a,t))}function Gu(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(o/zt),gridY:Math.floor(s/zt)}}function QS(e,t,n){const o=lS(t,n);return e.sectors[o]||(e.sectors[o]=aw()),e.sectors[o]}function _p(e,t,n){const o=lS(t,n),s=e.sectors[o];return s?s.health:du}function Er(e,t,n,o){const{gridX:s,gridY:a}=Gu(t,n,o);return _p(e,s,a)<uS}function JS(e,t,n){return _p(e,t,n)>=uS}function xP(e,t,n,o,s,a,l){const{gridX:u,gridY:d}=Gu(t,s,a),h=QS(e,u,d),p=h.lastAffectedBy[n]||0;if(o-p<fS)return;const m=Sl(t,l)?pS:1,S=cw*m;h.health=Math.max(dS,h.health-S),h.lastWalkTime=o,h.lastAffectedBy[n]=o}function LP(e,t,n,o,s,a){const{gridX:l,gridY:u}=Gu(t,o,s),d=QS(e,l,u),h=Sl(t,a)?pS:1,p=lw*h;d.health=Math.max(dS,d.health-p),d.lastPlantTime=n}function UP(e,t,n,o,s){let a=0;for(let l=-1;l<=1;l++)for(let u=-1;u<=1;u++){if(l===0&&u===0)continue;const d=((t+l)%o+o)%o,h=((n+u)%s+s)%s;JS(e,d,h)&&a++}return a}function GP({soilDepletion:e,time:t,mapDimensions:{width:n,height:o}}){if(t-e.lastUpdateTime<mw)return;const s=t-e.lastUpdateTime;e.lastUpdateTime=t;const a=Math.ceil(n/zt),l=Math.ceil(o/zt),u=[];for(const d of Object.keys(e.sectors)){const h=Number(d),p=e.sectors[h],m=Math.max(p.lastWalkTime,p.lastPlantTime);if(t-m<fw)continue;const{gridX:S,gridY:y}=cS(h),I=UP(e,S,y,a,l),T=I>0?dw*(I/8):0,E=uw+T;p.health=Math.min(du,p.health+E*s),p.health>=du&&u.push(h);const P=t-fS*10;for(const C of Object.keys(p.lastAffectedBy)){const _=Number(C);p.lastAffectedBy[_]<P&&delete p.lastAffectedBy[_]}}for(const d of u)delete e.sectors[d]}function $P(e,t){const n=[];for(const o of Object.keys(e.sectors)){const s=Number(o),a=e.sectors[s];if(a.health<t){const{gridX:l,gridY:u}=cS(s);n.push({gridX:l,gridY:u,health:a.health})}}return n}function eT(e,t,n,o,s,a){const l=[],u=n/2,d=o/2,h=t.x-u,p=t.x+u,m=t.y-d,S=t.y+d,y=Math.floor(h/zt),I=Math.floor((p-.001)/zt),T=Math.floor(m/zt),E=Math.floor((S-.001)/zt),P=Math.ceil(s/zt),C=Math.ceil(a/zt);let _=0;for(let k=y;k<=I;k++)for(let w=T;w<=E;w++){_++;const M=(k%P+P)%P,R=(w%C+C)%C;JS(e,M,R)||l.push({gridX:M,gridY:R})}return{depletedSectors:l,totalSectorsCount:_}}function Dy(e,t,n,o,s){const{gridX:a,gridY:l}=Gu(t,n,o),u=_p(e,a,l);return 1+(s-1)*Math.sqrt(1-u/du)}const WP={id:ja,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Ot/Ut);if(n.age+=s,n.age>=n.lifespan)return{nextState:rl,data:{...e,enteredAt:o.gameState.time}};if(!Er(o.gameState.soilDepletion,n.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height)){const l=Sl(n.position,o.gameState)?sw:1;n.timeSinceLastBerryRegen+=s*l,n.timeSinceLastBerryRegen>=nw&&n.food.length<n.maxFood&&(n.food.push({itemType:"food",type:ui.Berry}),n.timeSinceLastBerryRegen=0)}return n.food.length>=n.maxFood?{nextState:sr,data:{...e,enteredAt:o.gameState.time,previousState:ja}}:{nextState:ja,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},YP={id:sr,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Ot/Ut);if(n.age+=s,n.age>=n.lifespan)return{nextState:rl,data:{...e,enteredAt:o.gameState.time,previousState:sr}};if(n.food.length<n.maxFood)return{nextState:ja,data:{...e,enteredAt:o.gameState.time,previousState:sr}};if(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=ay){n.timeSinceLastSpreadAttempt=0;const l=o.gameState.time-n.timeSinceLastHarvest>=ay,u=Sl(n.position,o.gameState)?rw:1,d=o.gameState.ecosystem.berryBushSpreadChance*u;if(l&&Math.random()<d)return{nextState:eu,data:{...e,enteredAt:o.gameState.time,previousState:sr}}}return{nextState:sr,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})};function Oy(e){return e.filter(t=>t.isAdult).reduce((t,n)=>{let o=n.hitpoints;return o+=(n.maxAge-n.age)*.5,o+=n.food.length*2,t+o},0)}var Se=(e=>(e.Gather="Gather",e.Eat="Eat",e.Procreate="Procreate",e.Attack="Attack",e.Plant="Plant",e.TribeSplit="TribeSplit",e.FeedChild="FeedChild",e.HuntPrey="HuntPrey",e.DefendAgainstPredator="DefendAgainstPredator",e.Build="Build",e.Removal="Removal",e.Deposit="Deposit",e.Retrieve="Retrieve",e.TakeOverBuilding="TakeOverBuilding",e.RemoveEnemyBuilding="RemoveEnemyBuilding",e.ArmyControl="ArmyControl",e.Chop="Chop",e.AutopilotMove="AutopilotMove",e.AutopilotGather="AutopilotGather",e.AutopilotAttack="AutopilotAttack",e.AutopilotProcreate="AutopilotProcreate",e.AutopilotPlant="AutopilotPlant",e.AutopilotFeedChild="AutopilotFeedChild",e.AutopilotDeposit="AutopilotDeposit",e.AutopilotRetrieve="AutopilotRetrieve",e.AutopilotBuildingPlacement="AutopilotBuildingPlacement",e.AutopilotChop="AutopilotChop",e))(Se||{});const $u={Gather:"",Eat:"",Procreate:"",Attack:"",Plant:"",TribeSplit:"",FeedChild:"",HuntPrey:"",DefendAgainstPredator:"",Build:"",Removal:"",Deposit:"",Retrieve:"",TakeOverBuilding:"",RemoveEnemyBuilding:"",ArmyControl:"",Chop:"",AutopilotMove:"",AutopilotGather:"",AutopilotAttack:"",AutopilotProcreate:"",AutopilotPlant:"",AutopilotFeedChild:"",AutopilotDeposit:"",AutopilotRetrieve:"",AutopilotBuildingPlacement:"",AutopilotChop:""},tT={Gather:"Gather",Eat:"Eat",Procreate:"Procreate",Attack:"Attack",Plant:"Plant",TribeSplit:"Split Tribe",FeedChild:"Feed Child",HuntPrey:"Hunt Prey",DefendAgainstPredator:"Defend",Build:"Build",Removal:"Remove",Deposit:"Deposit",Retrieve:"Retrieve",TakeOverBuilding:"Take Over",RemoveEnemyBuilding:"Destroy Enemy Building",ArmyControl:"Army Control",Chop:"Chop Tree",AutopilotMove:"Walk",AutopilotGather:"Gather",AutopilotAttack:"Attack",AutopilotProcreate:"Procreate",AutopilotPlant:"Plant",AutopilotFeedChild:"Feed",AutopilotDeposit:"Deposit",AutopilotRetrieve:"Retrieve",AutopilotBuildingPlacement:"Build",AutopilotChop:"Chop"};var ns=(e=>(e.Time="Time",e.Hunger="Hunger",e.Hitpoints="Hitpoints",e.Food="Food",e.Autopilot="Autopilot",e.Muted="Muted",e.Family="Family",e.Tribes="Tribes",e))(ns||{});const Pa={Time:"",Hunger:"",Hitpoints:"",Food:"",Autopilot:"",Muted:"",Family:"",Tribes:""};var Te=(e=>(e.ToggleMute="ToggleMute",e.TogglePause="TogglePause",e.FastForward="FastForward",e.DismissTutorial="DismissTutorial",e.ReturnToIntro="ReturnToIntro",e.ConfirmExitYes="ConfirmExitYes",e.ConfirmExitNo="ConfirmExitNo",e.CommandEat="CommandEat",e.CommandPlant="CommandPlant",e.CommandGather="CommandGather",e.CommandTribeSplit="CommandTribeSplit",e.CommandBuild="CommandBuild",e.SelectStorageSpot="SelectStorageSpot",e.SelectPlantingZone="SelectPlantingZone",e.SelectBorderPost="SelectBorderPost",e.SelectBonfire="SelectBonfire",e.SelectPalisade="SelectPalisade",e.SelectGate="SelectGate",e.SelectRemovalTool="SelectRemovalTool",e.ToggleProcreationBehavior="ToggleProcreationBehavior",e.ToggleAttackBehavior="ToggleAttackBehavior",e.ToggleFeedChildBehavior="ToggleFeedChildBehavior",e.TogglePlantingBehavior="TogglePlantingBehavior",e.ToggleGatheringBehavior="ToggleGatheringBehavior",e.ToggleChoppingBehavior="ToggleChoppingBehavior",e.ToggleDiplomacy="ToggleDiplomacy",e.OpenTribeModal="OpenTribeModal",e.RecenterCamera="RecenterCamera",e.CloseTribeModal="CloseTribeModal",e))(Te||{});const sh=30,jP=.4,zP=100,XP=72,nT=10,iT=2,Ny=600,VP=1.5,oT=.1,ah=""+new URL("attack-D4MA8VWK.mp3",import.meta.url).href,lh=""+new URL("gather-CU75596W.mp3",import.meta.url).href,qP=""+new URL("eat-DCjHq2QD.mp3",import.meta.url).href,By=""+new URL("procreate-CfE4r5Cp.mp3",import.meta.url).href,ZP=""+new URL("birth-Cbd67GHT.mp3",import.meta.url).href,KP=""+new URL("child-fed-DzEPuMid.mp3",import.meta.url).href,QP=""+new URL("human-death-B6HFLXES.mp3",import.meta.url).href,JP=""+new URL("game-over-C5dqkyER.mp3",import.meta.url).href,e_=""+new URL("button-click-DomLUeaU.mp3",import.meta.url).href,t_=""+new URL("soundtrack-1-BdlYUGye.mp3",import.meta.url).href;var Pe=(e=>(e[e.Attack=0]="Attack",e[e.Gather=1]="Gather",e[e.Eat=2]="Eat",e[e.Procreate=3]="Procreate",e[e.Birth=4]="Birth",e[e.ChildFed=5]="ChildFed",e[e.HumanDeath=6]="HumanDeath",e[e.Seize=7]="Seize",e[e.TribeSplit=8]="TribeSplit",e[e.StorageDeposit=9]="StorageDeposit",e[e.StorageRetrieve=10]="StorageRetrieve",e[e.StorageSteal=11]="StorageSteal",e[e.GameOver=12]="GameOver",e[e.ButtonClick=13]="ButtonClick",e[e.SoundTrack1=14]="SoundTrack1",e))(Pe||{});const n_=new Map([[0,ah],[1,lh],[2,qP],[3,By],[4,ZP],[5,KP],[6,QP],[12,JP],[13,e_],[7,ah],[8,By],[9,lh],[10,lh],[11,ah],[14,t_]]);let _a,cl;function i_(){if(!(typeof window>"u"))return cl}function Rp(){if(!(typeof window>"u"))return!_a&&typeof window.AudioContext=="function"&&(_a=new window.AudioContext,cl=_a.createGain(),cl.connect(_a.destination),qa(.1,!1)),_a}function qa(e,t){cl&&(cl.gain.value=t?0:e/10)}const rT=new Map;let Lc=!1,Hy=!1;async function o_(){if(Hy||Lc)return;const e=Rp();if(!e){console.error("AudioContext not supported. Cannot load sounds.");return}e.state==="suspended"&&e.resume(),Lc=!0,console.log("Starting sound loading...");const t=[];n_.forEach((n,o)=>{const s=fetch(n).then(a=>{if(!a.ok)throw new Error(`Failed to fetch sound: ${n}`);return a.arrayBuffer()}).then(a=>e.decodeAudioData(a)).then(a=>{rT.set(o,a)}).catch(a=>{console.error(`Error loading sound ${Pe[o]} from ${n}:`,a)});t.push(s)});try{await Promise.all(t),Hy=!0,Lc=!1,console.log("All sounds loaded successfully.")}catch(n){Lc=!1,console.error("An error occurred while loading sounds:",n)}}const Za=new Map;function kp(e,t){const n=Rp(),o=i_();if(!n||!o||o.gain.value===0&&(t==null?void 0:t.trackId)===void 0)return;n.state==="suspended"&&n.resume();const s=rT.get(e);if(!s){console.warn(`Sound buffer not found for type: ${Pe[e]}`);return}if(t!=null&&t.trackId&&Za.has(t.trackId))return;const a=n.createBufferSource();a.buffer=s,a.loop=(t==null?void 0:t.loop)??!1;const l=n.createGain(),u=n.createStereoPanner();let d=l;if(t!=null&&t.position&&(t!=null&&t.listenerPosition)&&(t!=null&&t.worldDimensions)){const h=xe(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height),p=K(t.listenerPosition,t.position,t.worldDimensions.width,t.worldDimensions.height);if(p>Ny)return;const m=1-Math.pow(p/Ny,VP);l.gain.value=Math.max(0,m);const S=Math.sin(h.x/p*(Math.PI/2));u.pan.value=isNaN(S)?0:S,l.connect(u),d=u}else{const h=e===Pe.GameOver?.4:e===Pe.SoundTrack1?1:.2;l.gain.value=h}a.connect(d),d.connect(o),a.start(0),t!=null&&t.trackId&&(Za.set(t.trackId,{sourceNode:a,gainNode:l}),a.onended=()=>{Za.delete(t.trackId)})}function ch(e,t=1){const n=Za.get(e),o=Rp();if(n&&o){const{sourceNode:s,gainNode:a}=n,l=o.currentTime;a.gain.setValueAtTime(a.gain.value,l),a.gain.linearRampToValueAtTime(0,l+t),s.stop(l+t),s.onended=null,Za.delete(e)}}function ke(e,t,n){const o=Nt(e.gameState);o&&kp(t,{position:n,listenerPosition:o.position,worldDimensions:e.gameState.mapDimensions,masterVolume:e.gameState.masterVolume,isMuted:e.gameState.isMuted})}const Oe={create(){return{data:{}}},set({data:e},t,n){e[t]=n},get(e,t){return e==null?void 0:e.data[t]},delete({data:e},t){delete e[t]},has({data:e},t){return t in e}},r_="tribeSplit_phase",Wu="tribeSplit_strategy",sT="tribeSplit_targetPosition",Mp="tribeSplit_targetBuildingId",bp="tribeSplit_familyIds",aT="tribeSplit_lastFailureTime";function s_(e,t){Oe.set(e,r_,"idle"),Oe.delete(e,Wu),Oe.delete(e,sT),Oe.delete(e,Mp),Oe.delete(e,bp),Oe.set(e,aT,t)}function a_(e,t){const n=Oe.get(e,aT);return n?t-n>=XP:!0}function lT(e,t){if(!e.isAdult||e.gender!=="male"||e.leaderId===e.id||!e.leaderId)return{canSplit:!1,reason:"Not eligible to split"};if(qS(t).includes(e.leaderId))return{canSplit:!1,reason:"Tribe is being merged"};if(!e.aiBlackboard)return{canSplit:!1,reason:"No blackboard available"};if(!a_(e.aiBlackboard,t.time))return{canSplit:!1,reason:"Cooldown after previous failure"};const o=t.entities.entities[e.leaderId];if(!o||o.type!=="human")return{canSplit:!1,reason:"Leader not found"};const s=Is(Ji(t,o));if(s&&s.id===e.id)return{canSplit:!1,reason:"Heir cannot split"};if(CP(e,t).id!==e.id)return{canSplit:!1,reason:"Not family patriarch"};const l=xo(e.leaderId,t).filter(y=>y.isAdult);if(l.length<sh)return{canSplit:!1,reason:"Tribe too small"};const d=vu(e,t).length+1,p=vu(o,t).length+1;if(d>=p&&d>sh)return{canSplit:!0,progress:1,strategy:Fy(e,t)};const m=Math.max(l.length*jP,sh),S=d/m;if(d>=m){const y=Fy(e,t);return{canSplit:!0,progress:S,strategy:y}}return{canSplit:!1,progress:S,reason:`Family too small: ${d} < ${m}`}}function Fy(e,t){if(!e.leaderId)return"migration";const n=t;if(!(Nn(e.position.x,e.position.y,t)===e.leaderId))return"migration";const s=n.search.building.byProperty("ownerId",e.leaderId).filter(a=>a.buildingType===X.StorageSpot&&a.isConstructed);return s.length>0&&s.find(l=>K(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height)<=zP)?"concentration":"migration"}function l_(e,t){if(!e.aiBlackboard)return!1;const n=Oe.get(e.aiBlackboard,Wu);if(!n)return!1;const o=vu(e,t),s=[e.id,...o.map(a=>a.id)];return Oe.set(e.aiBlackboard,bp,s),n==="migration"?u_(e,t):n==="concentration"?d_(e,t):!1}function c_(e,t,n){if(Qi(e,n,30))return!1;const s=Nn(e.x,e.y,n);return!(s===t||s!==null&&s!==t)}function u_(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const n=t.mapDimensions.width,o=t.mapDimensions.height,s=Math.min(n,o)/2,a=50,l=50;for(let u=0;u<=s;u+=a){const d=u===0?1:Math.max(8,Math.ceil(2*Math.PI*u/l)),h=u===0?0:2*Math.PI/d;for(let p=0;p<d;p++){const m=p*h,S=Math.cos(m)*u,y=Math.sin(m)*u,I=e.position.x+S,T=e.position.y+y,E={x:(I%n+n)%n,y:(T%o+o)%o};if(c_(E,e.leaderId,t))return Oe.set(e.aiBlackboard,sT,E),!0}}return!1}function d_(e,t){if(!e.aiBlackboard||!e.leaderId)return!1;const o=t.search.building.byProperty("ownerId",e.leaderId).filter(l=>l.buildingType===X.StorageSpot&&l.isConstructed);if(o.length===0)return!1;let s=null,a=1/0;for(const l of o){const u=K(e.position,l.position,t.mapDimensions.width,t.mapDimensions.height);u<a&&(a=u,s=l)}return s?(Oe.set(e.aiBlackboard,Mp,s.id),!0):!1}function f_(e,t){var d;if(!e.aiBlackboard)return!1;const n=Oe.get(e.aiBlackboard,Wu),o=Oe.get(e.aiBlackboard,bp);if(!n||!o)return!1;const s=e.leaderId?t.entities.entities[e.leaderId]:void 0,a=yu(),l=Xt[Math.floor(Math.random()*Xt.length)];e.leaderId=e.id,e.tribeInfo={tribeBadge:a,tribeColor:l},e.tribeControl={diplomacy:{}},s&&((d=s.tribeControl)!=null&&d.diplomacy)&&(s.tribeControl.diplomacy[e.id]=bt.Hostile);for(const h of o){if(h===e.id)continue;const p=t.entities.entities[h];!p||p.type!=="human"||(p.leaderId=e.id,p.tribeInfo={tribeBadge:a,tribeColor:l})}if(n==="concentration"){const h=Oe.get(e.aiBlackboard,Mp);if(h){const p=t.entities.entities[h];p&&p.type==="building"&&(p.ownerId=e.id)}}return al(t,{type:Sr.NewTribeFormed,message:`A new tribe has formed via ${n}! ${a}`,duration:hu,targetEntityIds:[e.id],highlightedEntityIds:o}),ke({gameState:t},Pe.TribeSplit,e.position),s_(e.aiBlackboard,t.time),!0}function h_(e,t){Oe.set(e,Wu,t)}function cT(e,t){const n=lT(e,t);return{canSplit:n.canSplit,progress:n.progress}}function uT(e,t){if(!e.aiBlackboard)return;const n=lT(e,t);!n.canSplit||!n.strategy||(h_(e.aiBlackboard,n.strategy),l_(e,t)&&f_(e,t))}const p_=20,ci=30,g_=.5,m_=.3,y_=2,v_=50;function Dp(e,t){var a;const n=[];if(t.food.length>0&&t.hunger>Ho&&n.push({type:Se.Eat,action:"eating",key:"f"}),t.food.length<t.maxFood){const l=Ke(t,e,"berryBush",Qe,h=>h.food.length>0),u=Ke(t,e,"corpse",Qe,h=>h.food.length>0);let d=null;l&&u?d=K(t.position,l.position,e.mapDimensions.width,e.mapDimensions.height)<=K(t.position,u.position,e.mapDimensions.width,e.mapDimensions.height)?l:u:d=l||u,d&&n.push({type:Se.Gather,action:"gathering",key:"e",targetEntity:d})}const o=Ke(t,e,"human",Qe,l=>bs(t,l,e));if(o&&n.push({type:Se.Procreate,action:"procreating",key:"r",targetEntity:o}),t.food.length>0&&t.isAdult){const l=Ke(t,e,"human",Qe,u=>{const d=u;return!d.isAdult&&(d.motherId===t.id||d.fatherId===t.id)&&d.hunger>=Ho});l&&n.push({type:Se.FeedChild,action:"feeding",key:"h",targetEntity:l})}const s=Ke(t,e,"human",An,l=>yl(t,l,e))??Ke(t,e,"predator",An)??Ke(t,e,"prey",An);if(s&&n.push({type:Se.Attack,action:"attacking",key:"q",targetEntity:s}),t.food.filter(l=>l.type===ui.Berry).length>=vr&&n.push({type:Se.Plant,action:"planting",key:"b"}),t.food.length>0&&t.isAdult){const l=Ke(t,e,"building",ci,u=>{const d=u;return d.buildingType==="storageSpot"&&d.ownerId===t.leaderId&&d.isConstructed&&d.storedItems.length>0&&d.storageCapacity!==void 0&&d.storedItems.length<d.storageCapacity});l&&n.push({type:Se.Deposit,action:"idle",key:"x",targetEntity:l})}if(t.food.length<t.maxFood&&t.isAdult){const l=Ke(t,e,"building",ci,u=>{const d=u;return d.buildingType==="storageSpot"&&d.ownerId===t.leaderId&&d.isConstructed&&d.storedItems.length>0});l&&n.push({type:Se.Retrieve,action:"idle",key:"z",targetEntity:l})}if(((a=t.heldItem)==null?void 0:a.type)===Gt.Wood){const l=Ke(t,e,"building",ci,u=>{const d=u;return d.buildingType===X.Bonfire&&d.isConstructed&&d.storedItems.length<(d.storageCapacity||0)});l&&n.push({type:Se.Deposit,action:"depositing",key:"x",targetEntity:l})}if(cT(t,e).canSplit&&n.push({type:Se.TribeSplit,action:"idle",key:"k"}),!t.heldItem){const l=Ke(t,e,"tree",Bu,u=>u.wood&&u.wood.length>0);l&&n.push({type:Se.Chop,action:"chopping",key:"c",targetEntity:l})}return n}const S_={id:eu,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o,a=o.deltaTime*(Ot/Ut);if(n.age+=a,n.age>=n.lifespan)return{nextState:rl,data:{...e,enteredAt:s.time,previousState:eu}};const l=ES(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Qi(l,s,15)||Al(s.entities,l,s.time),{nextState:sr,data:{...e,enteredAt:s.time,previousState:eu}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},T_={id:rl,update:e=>({nextState:rl,data:e}),onEnter:(e,t)=>(Ci(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},I_=[WP,YP,S_,T_],ht="humanIdle",Si="humanMoving",Ua="humanEating",Os="humanGathering",Ka="humanDepositing",Qa="humanRetrieving",lr="humanProcreating",Lo="humanAttacking",nu="humanPlanting",Op="humanChopping",A_={id:ht,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="attacking"&&n.attackTargetId?{nextState:Lo,data:{...e,enteredAt:o.gameState.time,previousState:ht,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:(n.hunger>=mS?(n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.debuffs.push({type:"slow",startTime:o.gameState.time,duration:.1})):n.debuffs=n.debuffs.filter(s=>s.type!=="slow"),n.activeAction==="moving"?{nextState:Si,data:{...e,enteredAt:o.gameState.time,previousState:ht,target:n.target}}:n.activeAction==="gathering"?{nextState:Os,data:{...e,enteredAt:o.gameState.time,previousState:ht,target:n.target}}:n.activeAction==="eating"?{nextState:Ua,data:{...e,enteredAt:o.gameState.time,previousState:ht}}:n.activeAction==="planting"&&n.target?{nextState:nu,data:{...e,enteredAt:o.gameState.time,previousState:ht,plantingSpot:n.target}}:n.activeAction==="depositing"?{nextState:Ka,data:{...e,enteredAt:o.gameState.time,previousState:ht}}:n.activeAction==="retrieving"?{nextState:Qa,data:{...e,enteredAt:o.gameState.time,previousState:ht}}:n.activeAction==="chopping"&&n.target?{nextState:Op,data:{...e,enteredAt:o.gameState.time,previousState:ht,state:"chopping"}}:{nextState:ht,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function dT(e,t=1){let n=vw;return e.hunger>=mS&&(n*=Sw),e.age>=Iw&&(n*=Aw),e.movementSlowdown&&(n*=e.movementSlowdown.modifier),n*=t,n}const me=10,As=ut,fT=100,E_=0,uh=1,xy=2,Ly=new Map;function w_(e){let t=Ly.get(e);return t||(t={gScore:new Float32Array(e),fScore:new Float32Array(e),cameFrom:new Int32Array(e),heap:new Int32Array(e),nodeStatus:new Uint8Array(e)},Ly.set(e,t)),t}function C_(e,t,n){for(;n>0;){const o=n-1>>1;if(t[e[n]]>=t[e[o]])break;const s=e[n];e[n]=e[o],e[o]=s,n=o}}function P_(e,t,n,o){for(;o<t;){const s=(o<<1)+1,a=(o<<1)+2;let l=o;if(s<t&&n[e[s]]<n[e[l]]&&(l=s),a<t&&n[e[a]]<n[e[l]]&&(l=a),l===o)break;const u=e[o];e[o]=e[l],e[l]=u,o=l}}function Uy(e,t,n,o){return e[t]=o,C_(e,n,t),t+1}function __(e,t,n){const o=e[0];return e[0]=e[t-1],P_(e,t-1,n,0),{nodeIdx:o,newSize:t-1}}function Np(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n,a=Math.floor(o/me),l=Math.floor(s/me),u=Math.ceil(t/me);return l*u+a}function Tu(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{x:Math.floor(o/me),y:Math.floor(s/me)}}function Yu(e,t){const n=Math.ceil(e/me),o=Math.ceil(t/me),s=n*o;return{obstacleCount:new Uint16Array(s),gateRefCount:{},paddingCount:new Uint16Array(s),gatePaddingRefCount:{}}}function Es(e,t,n,o=!0){var s,a,l;if(o){const u=e.obstacleCount[t]+e.paddingCount[t];if(u===0)return!0;if(n!==void 0){const d=(((s=e.gateRefCount[n])==null?void 0:s[t])||0)+(((a=e.gatePaddingRefCount[n])==null?void 0:a[t])||0);return u===d}return!1}else{const u=e.obstacleCount[t];if(u===0)return!0;if(n!==void 0){const d=((l=e.gateRefCount[n])==null?void 0:l[t])||0;return u===d}return!1}}function ws(e,t,n,o,s=null,a=0){const{width:l,height:u}=e.mapDimensions,d=Math.ceil(l/me),h=Math.ceil(u/me),p=n+a,m=Math.ceil(p/me),S=Tu(t,l,u),y=e.navigationGrid,I=y.obstacleCount.length;s!==null&&(y.gateRefCount[s]||(y.gateRefCount[s]=new Uint16Array(I)),y.gatePaddingRefCount[s]||(y.gatePaddingRefCount[s]=new Uint16Array(I)));for(let T=-m;T<=m;T++)for(let E=-m;E<=m;E++){const P=(S.x+E+d)%d,C=(S.y+T+h)%h,_=P*me+me/2,k=C*me+me/2,w=K(t,{x:_,y:k},l,u);if(w<=p){const M=C*d+P,R=w<=n,H=a>0&&!R?Math.max(1,Math.floor(fT*(1-(w-n)/a))):1;o?R?(y.obstacleCount[M]++,s!==null&&y.gateRefCount[s][M]++):(y.paddingCount[M]+=H,s!==null&&(y.gatePaddingRefCount[s][M]+=H)):R?(y.obstacleCount[M]>0&&y.obstacleCount[M]--,s!==null&&y.gateRefCount[s]&&y.gateRefCount[s][M]>0&&y.gateRefCount[s][M]--):(y.paddingCount[M]>=H?y.paddingCount[M]-=H:y.paddingCount[M]=0,s!==null&&y.gatePaddingRefCount[s]&&y.gatePaddingRefCount[s][M]>=H?y.gatePaddingRefCount[s][M]-=H:s!==null&&y.gatePaddingRefCount[s]&&(y.gatePaddingRefCount[s][M]=0))}}}function Ra(e,t,n,o){const{width:s,height:a}=e.mapDimensions,l=xe(t,n,s,a),u=Math.sqrt(l.x*l.x+l.y*l.y);if(u<.001)return!1;const d=Math.ceil(u/(me/2)),h=l.x/d,p=l.y/d,m=l.x/u,y=-(l.y/u),I=m,T=o.radius*.5,E=e.navigationGrid;for(let P=0;P<=d;P++){const C={x:t.x+h*P,y:t.y+p*P},_=[C,{x:C.x+y*T,y:C.y+I*T},{x:C.x-y*T,y:C.y-I*T},{x:C.x+y*T*.5,y:C.y+I*T*.5},{x:C.x-y*T*.5,y:C.y-I*T*.5}];for(const k of _){const w=Np(k,s,a);if(!Es(E,w,o.leaderId,!1))return!0}}return!1}function R_(e,t,n,o,s,a=!0){const l=Tu(t,n,o),u=Math.ceil(n/me),d=Math.ceil(o/me);for(let h=0;h<20;h++)for(let p=-h;p<=h;p++)for(let m=-h;m<=h;m++){if(h>0&&Math.abs(m)!==h&&Math.abs(p)!==h)continue;const S=(l.x+m+u)%u,y=(l.y+p+d)%d,I=y*u+S;if(Es(e,I,s,a))return{x:S*me+me/2,y:y*me+me/2}}return t}function hT(e,t,n,o){var H;const{width:s,height:a}=e.mapDimensions,l=Math.ceil(s/me),u=Math.ceil(a/me),d=l*u,h=e.navigationGrid,p=Np(n,s,a);let m=n;Es(h,p,o.leaderId,!1)||(m=R_(h,n,s,a,o.leaderId,!1));const S=Tu(t,s,a),y=Tu(m,s,a);if(S.x===y.x&&S.y===y.y)return{path:[m],iterations:0};const I=w_(d),{gScore:T,fScore:E,cameFrom:P,heap:C,nodeStatus:_}=I;T.fill(1/0),E.fill(1/0),P.fill(-1),_.fill(E_);const k=S.y*l+S.x;T[k]=0,E[k]=Gy(S,y,l,u);let w=0;w=Uy(C,w,E,k),_[k]=uh;const M=5e3;let R=0;for(;w>0&&R<M;){R++;const j=__(C,w,E),$=j.nodeIdx;w=j.newSize;const V=$%l,ee=Math.floor($/l);if(_[$]=xy,V===y.x&&ee===y.y)return{path:k_(P,$,l,m),iterations:R};for(let ue=-1;ue<=1;ue++)for(let oe=-1;oe<=1;oe++){if(oe===0&&ue===0)continue;const re=(V+oe+l)%l,fe=(ee+ue+u)%u,ie=fe*l+re;if(_[ie]===xy||!Es(h,ie,o.leaderId,!1))continue;let W=oe!==0&&ue!==0?1.414:1;const te=h.paddingCount[ie],x=o.leaderId!==void 0&&((H=h.gatePaddingRefCount[o.leaderId])==null?void 0:H[ie])||0,D=Math.max(0,te-x);D>0&&(W+=10+D*1.5);const G=T[$]+W;G<T[ie]&&(P[ie]=$,T[ie]=G,E[ie]=G+Gy({x:re,y:fe},y,l,u),_[ie]!==uh&&(w=Uy(C,w,E,ie),_[ie]=uh))}}return{path:null,iterations:R}}function Gy(e,t,n,o){let s=Math.abs(e.x-t.x),a=Math.abs(e.y-t.y);s>n/2&&(s=n-s),a>o/2&&(a=o-a);const l=1;return l*(s+a)+(1.414-2*l)*Math.min(s,a)}function k_(e,t,n,o){const s=[o];let a=t;const l=new Set;for(;e[a]!==-1&&!l.has(a);)l.add(a),a=e[a],s.unshift({x:a%n*me+me/2,y:Math.floor(a/n)*me+me/2});return s.length>1&&s.shift(),s}const Uc=10,M_=.2,$y=15;class b_{constructor(){Yt(this,"id",Si)}update(t,n){var T;const{entity:o,updateContext:s}=n;if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:Lo,data:{...t,enteredAt:s.gameState.time,previousState:Si,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:ht,data:{...t,enteredAt:s.gameState.time,previousState:Si}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(T=n.updateContext.gameState.entities.entities[o.target])==null?void 0:T.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*Uc*2,y:o.position.y+o.direction.y*Uc*2}),!a)return{nextState:ht,data:{...t,enteredAt:s.gameState.time,previousState:Si}};const{width:l,height:u}=s.gameState.mapDimensions;if(K(o.position,a,l,u)<Uc)return{nextState:ht,data:{...t,enteredAt:s.gameState.time,previousState:Si}};const h=Ra(s.gameState,o.position,a,o);if(o.path&&o.pathTarget&&K(o.pathTarget,a,l,u)>40&&(o.path=void 0,o.pathTarget=void 0),h&&!o.path)return s.gameState.pathfindingQueue.includes(o.id)||s.gameState.pathfindingQueue.push(o.id),o.acceleration=0,{nextState:Si,data:t};let p=a;if(o.path&&o.path.length>0){const E=s.gameState.time;if(E-(t.lastPruneTime??0)>M_)if(t.lastPruneTime=E,!Ra(s.gameState,o.position,a,o))o.path=[a];else{const C=Math.min(o.path.length-1,$y);for(let _=C;_>0;_--){const k=o.path[_];if(!Ra(s.gameState,o.position,k,o)){o.path.splice(0,_);break}}}if(o.path.length===0?p=a:p=o.path[0],Ra(s.gameState,o.position,p,o)){let C=!1;const _=Math.min(o.path.length-1,$y);for(let k=1;k<=_;k++)if(!Ra(s.gameState,o.position,o.path[k],o)){o.path.splice(0,k),p=o.path[0],C=!0;break}if(!C)return o.path=void 0,o.pathTarget=void 0,o.acceleration=0,{nextState:Si,data:t}}K(o.position,p,l,u)<Uc&&(o.path.shift(),o.path.length>0?p=o.path[0]:p=a)}const m=xe(o.position,p,l,u),S=K(o.position,p,l,u),y=yt(m);if(S>Fh){const E=ru(y,-za),P=ru(y,za),C=[y,E,P],_=C.map((w,M)=>{const R=Xn(o.position,ct(w,Fh)),H={x:(R.x%l+l)%l,y:(R.y%u+u)%u},j=Dy(s.gameState.soilDepletion,H,l,u,cy),V=Math.cos(M===0?0:za);return j*V});let k=0;for(let w=1;w<_.length;w++)_[w]>_[k]&&(k=w);o.direction=C[k]}else o.direction=y;const I=Dy(s.gameState.soilDepletion,o.position,l,u,cy);return o.acceleration=dT(o,I),{nextState:Si,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}}const D_=new b_,O_={id:Ua,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction!=="eating"?{nextState:ht,data:{...e,enteredAt:o.gameState.time,previousState:Ua}}:(n.food.length>0&&(!n.eatingCooldownTime||o.gameState.time>=n.eatingCooldownTime)&&n.hunger>Ho&&(n.hunger=Math.max(0,n.hunger-Ho),n.food.pop(),n.eatingCooldownTime=o.gameState.time+1,ke(o,Pe.Eat,n.position),(!n.lastEatingEffectTime||o.gameState.time-n.lastEatingEffectTime>2)&&(Fe(o.gameState,Ce.Eating,n.position,Xe,n.id),n.lastEatingEffectTime=o.gameState.time)),n.hunger<=0||n.food.length<=0?{nextState:ht,data:{...e,enteredAt:o.gameState.time,previousState:Ua}}:{nextState:Ua,data:e})},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class N_{constructor(){Yt(this,"id",Os)}update(t,n){return n.entity.activeAction!=="gathering"?{nextState:"humanIdle",data:{...t,enteredAt:n.updateContext.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const B_=new N_,H_={id:Ka,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="depositing"?{nextState:ht,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Ka}}:{nextState:Ka,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="depositing",t},onExit:e=>{const{entity:t}=e;t.activeAction==="depositing"&&(t.activeAction="idle")}},F_={id:Qa,update:(e,t)=>{const{entity:n}=t;return n.activeAction!=="retrieving"?{nextState:ht,data:{...e,enteredAt:t.updateContext.gameState.time,previousState:Qa}}:{nextState:Qa,data:e}},onEnter:(e,t)=>{const{entity:n}=e;return n.activeAction="retrieving",t},onExit:e=>{const{entity:t}=e;t.activeAction==="retrieving"&&(t.activeAction="idle")}},x_=(e,t)=>(t.procreationEndTime=e.updateContext.gameState.time+(t.duration||2),t),L_=(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(s.time<(e.procreationEndTime||0))return{nextState:lr,data:e};const a=s.entities.entities[e.partnerId];if(a&&a.type==="human"&&!a.isPregnant&&n.hunger<jn&&a.hunger<jn&&!n.procreationCooldown&&!a.procreationCooldown){const l=n.gender==="female"?n:a.gender==="female"?a:void 0,u=n.gender==="male"?n:a.gender==="male"?a:void 0;l&&u&&(l.isPregnant=!0,l.gestationTime=Ew,l.pregnancyFatherId=u.id,n.procreationCooldown=uy,a.procreationCooldown=uy,ke(o,Pe.Procreate,l.position))}return n.activeAction="idle",a&&(a.activeAction="idle"),{nextState:ht,data:{...e,enteredAt:s.time,previousState:lr}}},U_={id:lr,onEnter:x_,update:L_},G_={id:Lo,onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time,attackStartTime:e.updateContext.gameState.time}),update:(e,t)=>{var a;if(t.entity.activeAction!=="attacking"||!t.entity.attackTargetId)return t.entity.activeAction="idle",{nextState:ht,data:{...e}};const n=t.updateContext.gameState.entities.entities[t.entity.attackTargetId];if(!n)return t.entity.activeAction="idle",{nextState:ht,data:{...e}};const o=K(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height),s=xe(t.entity.position,n.position,t.updateContext.gameState.mapDimensions.width,t.updateContext.gameState.mapDimensions.height);return t.entity.direction=yt(s),o<=Fo||o<=An&&(((a=t.entity.attackCooldown)==null?void 0:a.ranged)??0)<=0?t.entity.acceleration=0:t.entity.acceleration=dT(t.entity),{nextState:Lo,data:e}}},$_={id:nu,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(s.time-e.enteredAt>=ow){const l=n.food.filter(d=>d.type===ui.Berry).length,u=Er(s.soilDepletion,e.plantingSpot,s.mapDimensions.width,s.mapDimensions.height);if(l>=vr&&!u){for(let d=0;d<vr;d++){const h=n.food.findIndex(p=>p.type===ui.Berry);h>-1&&n.food.splice(h,1)}Al(s.entities,e.plantingSpot,s.time),LP(s.soilDepletion,e.plantingSpot,s.time,s.mapDimensions.width,s.mapDimensions.height,s)}return n.activeAction="idle",{nextState:ht,data:{...e,enteredAt:s.time,previousState:nu}}}return{nextState:nu,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};class W_{constructor(){Yt(this,"id",Op)}update(t,n){const{entity:o,updateContext:s}=n;return o.activeAction!=="chopping"||o.heldItem?{nextState:ht,data:{...t,enteredAt:s.gameState.time,previousState:this.id}}:{nextState:this.id,data:t}}}const Y_=new W_,j_=[A_,D_,O_,B_,H_,F_,U_,G_,$_,Y_],oi="preyIdle",ko="preyMoving",Ga="preyGrazing",$a="preyProcreating",z_={id:oi,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:ko,data:{...e,enteredAt:o.gameState.time,previousState:oi,target:n.target}}:n.activeAction==="grazing"?{nextState:Ga,data:{...e,enteredAt:o.gameState.time,previousState:oi}}:n.activeAction==="procreating"?{nextState:$a,data:{...e,enteredAt:o.gameState.time,previousState:oi}}:{nextState:oi,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},pT=12,ju=120,Wy=50,X_=12,gT=30,V_=2,Cs=50,q_=100,mT=2,Z_=.9,K_=1,Q_=50,J_=.5,yT=20,zu=140,Yy=40,eR=12,vT=40,tR=3,Ps=60,_r=40,nR=50,ST=320,TT=25,iR=60,IT=2,oR=90,rR=.7,sR=1,AT=3,Bp=80,ET=10,Xu=80,wT=40,CT=2,Iu=30,ss=20,fr=40,as=24,hr=48,ls=12,pr=40,cs=20,gr=60,us=.75,bo=2.5,ds=.25,Do=2,PT=4;function aR(e){let t=X_;return e.isAdult||(t*=.7),e.hunger>=Q_&&(t*=J_),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function lR(e,t){const n=e>>16&255,o=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,u=t&255;let d=Math.floor((n+a)/2),h=Math.floor((o+l)/2),p=Math.floor((s+u)/2);return Math.random()<.05&&(d=Math.max(0,Math.min(255,d+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),d<<16|h<<8|p}function ul(){const e=Math.floor(Math.random()*100)+100,t=Math.floor(Math.random()*80)+60,n=Math.floor(Math.random()*60)+20;return e<<16|t<<8|n}const dh=10;class cR{constructor(){Yt(this,"id",ko)}update(t,n){var d;const{entity:o,updateContext:s}=n;if(o.activeAction!=="moving")return{nextState:oi,data:{...t,enteredAt:s.gameState.time,previousState:ko}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(d=n.updateContext.gameState.entities.entities[o.target])==null?void 0:d.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*dh*2,y:o.position.y+o.direction.y*dh*2}),!a)return{nextState:oi,data:{...t,enteredAt:s.gameState.time,previousState:ko}};const l=xe(o.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return o.direction=yt(l),o.acceleration=aR(o),K(o.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<dh?{nextState:oi,data:{...t,enteredAt:s.gameState.time,previousState:ko}}:{nextState:ko,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const uR=new cR,dR={id:Ga,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:ko,data:{...e,enteredAt:o.gameState.time,previousState:Ga,target:n.target}}:n.activeAction!=="grazing"?{nextState:oi,data:{...e,enteredAt:o.gameState.time,previousState:Ga}}:{nextState:Ga,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},fR={id:$a,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="moving"?{nextState:ko,data:{...e,enteredAt:o.gameState.time,previousState:$a,target:n.target}}:n.activeAction!=="procreating"?{nextState:oi,data:{...e,enteredAt:o.gameState.time,previousState:$a}}:{nextState:$a,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},hR=[z_,uR,dR,fR],hn="predatorIdle",_o="predatorMoving",$i="predatorAttacking",is="predatorProcreating",mr="predatorEating",pR={id:hn,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="eating"?{nextState:mr,data:{...e,enteredAt:o.gameState.time,previousState:hn,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:$i,data:{...e,enteredAt:o.gameState.time,previousState:hn,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:n.activeAction==="moving"?{nextState:_o,data:{...e,enteredAt:o.gameState.time,previousState:hn,target:n.target}}:n.activeAction==="procreating"?{nextState:is,data:{...e,enteredAt:o.gameState.time,previousState:hn}}:{nextState:hn,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})};function _T(e){let t=eR;return e.hunger>=oR&&(t*=rR),e.isAdult||(t*=.7),e.movementSlowdown&&(t*=e.movementSlowdown.modifier),t}function gR(e,t){const n=e>>16&255,o=e>>8&255,s=e&255,a=t>>16&255,l=t>>8&255,u=t&255;let d=Math.floor((n+a)/2),h=Math.floor((o+l)/2),p=Math.floor((s+u)/2);return Math.random()<.05&&(d=Math.max(0,Math.min(255,d+(Math.random()-.5)*60))),Math.random()<.05&&(h=Math.max(0,Math.min(255,h+(Math.random()-.5)*60))),Math.random()<.05&&(p=Math.max(0,Math.min(255,p+(Math.random()-.5)*60))),d<<16|h<<8|p}function dl(){const e=Math.floor(Math.random()*60)+60,t=Math.floor(Math.random()*50)+40,n=Math.floor(Math.random()*40)+20;return e<<16|t<<8|n}const fh=12;class mR{constructor(){Yt(this,"id",_o)}update(t,n){var d;const{entity:o,updateContext:s}=n;if(o.activeAction==="eating")return{nextState:mr,data:{...t,enteredAt:s.gameState.time,previousState:_o,preyId:o.attackTargetId,eatingStartTime:s.gameState.time}};if(o.activeAction==="attacking"&&o.attackTargetId)return{nextState:$i,data:{...t,enteredAt:s.gameState.time,previousState:_o,attackTargetId:o.attackTargetId,attackStartTime:s.gameState.time}};if(o.activeAction!=="moving")return{nextState:hn,data:{...t,enteredAt:s.gameState.time,previousState:_o}};let a;if(typeof o.target=="object"?a=o.target:typeof o.target=="number"&&(a=(d=n.updateContext.gameState.entities.entities[o.target])==null?void 0:d.position),!a&&(o.direction.x!==0||o.direction.y!==0)&&(a={x:o.position.x+o.direction.x*fh*2,y:o.position.y+o.direction.y*fh*2}),!a)return{nextState:hn,data:{...t,enteredAt:s.gameState.time,previousState:_o}};const l=xe(o.position,a,n.updateContext.gameState.mapDimensions.width,n.updateContext.gameState.mapDimensions.height);return o.direction=yt(l),o.acceleration=_T(o),K(o.position,a,s.gameState.mapDimensions.width,s.gameState.mapDimensions.height)<fh?{nextState:hn,data:{...t,enteredAt:s.gameState.time,previousState:_o}}:{nextState:_o,data:t}}onExit(t){const{entity:n}=t;n.acceleration=0}onEnter(t,n){return{...n,enteredAt:t.updateContext.gameState.time}}}const yR=new mR,vR={id:$i,update:(e,t)=>{const{entity:n,updateContext:o}=t;if(n.activeAction==="eating")return{nextState:mr,data:{...e,enteredAt:o.gameState.time,previousState:$i,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}};if(n.activeAction!=="attacking"||!n.attackTargetId)return n.activeAction="idle",{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:$i}};const s=o.gameState.entities.entities[n.attackTargetId];if(!s)return n.activeAction="idle",{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:$i}};if(s.type==="prey"&&s.hitpoints<=0||s.type==="predator"&&s.hitpoints<=0||s.type==="human"&&s.hitpoints<=0)return n.activeAction="idle",{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:$i}};const l=K(n.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height),u=xe(n.position,s.position,o.gameState.mapDimensions.width,o.gameState.mapDimensions.height);return n.direction=yt(u),l>_r?n.acceleration=_T(n):n.acceleration=0,{nextState:$i,data:e}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},SR={id:is,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction==="eating"?{nextState:mr,data:{...e,enteredAt:o.gameState.time,previousState:is,preyId:n.attackTargetId,eatingStartTime:o.gameState.time}}:n.activeAction==="attacking"&&n.attackTargetId?{nextState:$i,data:{...e,enteredAt:o.gameState.time,previousState:is,attackTargetId:n.attackTargetId,attackStartTime:o.gameState.time}}:n.activeAction!=="procreating"?{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:is}}:{nextState:is,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},TR={id:mr,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.activeAction!=="eating"?{nextState:hn,data:{...e,enteredAt:o.gameState.time,previousState:mr}}:{nextState:mr,data:e}},onEnter:(e,t)=>(e.entity.acceleration=0,e.entity.velocity={x:0,y:0},{...t,enteredAt:e.updateContext.gameState.time})},IR=[pR,yR,vR,SR,TR],AR=24*30*10,Uo=24*5,ER=48,wR=72,wr=20,CR="#3b2016",PR="#5c3a21",_R="#376d31",RR="#76a331",kR="#a6c44a",MR="rgba(0, 0, 0, 0.25)",bR=60,DR=24*7,Zi=.01,Wa=.5,jy=1,Vu=5,OR={id:ri,update:(e,t)=>{const{entity:n,updateContext:o}=t;return n.age>=n.lifespan?{nextState:Ar,data:{enteredAt:o.gameState.time,previousState:ri}}:n.age>=Uo?{nextState:zn,data:{enteredAt:o.gameState.time,previousState:ri}}:{nextState:ri,data:e}}},NR={id:zn,update:(e,t)=>{const{entity:n,updateContext:o}=t,s=o.deltaTime*(Ot/Ut);return n.age>=n.lifespan?{nextState:Ar,data:{...e,enteredAt:o.gameState.time,previousState:zn}}:(n.timeSinceLastSpreadAttempt+=s,n.timeSinceLastSpreadAttempt>=DR&&(n.timeSinceLastSpreadAttempt=0,Math.random()<o.gameState.ecosystem.treeSpreadChance)?{nextState:Ei,data:{...e,enteredAt:o.gameState.time,previousState:zn}}:{nextState:zn,data:e})}},BR={id:Ei,update:(e,t)=>{const{entity:n,updateContext:o}=t,{gameState:s}=o;if(n.age>=n.lifespan)return{nextState:Ar,data:{...e,enteredAt:s.time,previousState:Ei}};const a=ES(n.position,n.spreadRadius,s.mapDimensions.width,s.mapDimensions.height);return Qi(a,s,25)||_s(s.entities,a,s.time),{nextState:zn,data:{...e,enteredAt:s.time,previousState:Ei}}},onEnter:(e,t)=>({...t,enteredAt:e.updateContext.gameState.time})},HR={id:Vt,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=ER?{nextState:wi,data:{enteredAt:n.gameState.time,previousState:Vt}}:{nextState:Vt,data:e}}},FR={id:wi,update:(e,t)=>{const{updateContext:n}=t;return n.gameState.time-e.enteredAt>=wR?{nextState:Ar,data:{enteredAt:n.gameState.time,previousState:wi}}:{nextState:wi,data:e}}},xR={id:Ar,update:e=>({nextState:Ar,data:e}),onEnter:(e,t)=>(Ci(e.updateContext.gameState.entities,e.entity.id),{...t,enteredAt:e.updateContext.gameState.time})},LR=[OR,NR,BR,HR,FR,xR],zy=[...I_,...j_,...hR,...IR,...LR];function UR(e,t,n){const o=VE(e,zy);if(!o)return ZE(e),[e,t];const{nextState:s,data:a}=o.update(t,n);return qE(e,s)?[s,XE(o,s,a,n,zy)]:[s,a]}function Hp(e,t){return`${e},${t}`}const Xy=Ot*10;function RT(e){return e%Xy/Xy}function kT(e){const t=RT(e);return(Math.cos(t*2*Math.PI)+1)/2}function GR(e){const t=RT(e);return Math.pow(Math.max(0,-Math.cos(t*2*Math.PI)),.5)}function MT(e,t,n){const o=(e.x%t+t)%t,s=(e.y%n+n)%n;return{gridX:Math.floor(o/Wi),gridY:Math.floor(s/Wi)}}function fl(e,t,n,o,s){const{gridX:a,gridY:l}=MT(t,o,s),u=Hp(a,l),d=e.sectors[u],h=d?d.currentTemperature:MS,m=(kT(n)*2-1)*IC;return h+m}function $R(e){const{sectors:t}=e.temperature,{width:n,height:o}=e.mapDimensions,s=Math.ceil(n/Wi),a=Math.ceil(o/Wi);for(const u in t){const d=t[u];d.currentTemperature=d.baseTemperature}const l=Math.ceil(Xa/Wi);Object.values(e.entities.entities).forEach(u=>{if(u.type==="building"){const d=u;if(d.buildingType==="bonfire"&&d.isConstructed&&d.fuelLevel>0){const h=MT(d.position,n,o);for(let p=-l;p<=l;p++)for(let m=-l;m<=l;m++){const S=(h.gridX+m+s)%s,y=(h.gridY+p+a)%a,I=Hp(S,y),T=t[I];if(T){const E={x:(S+.5)*Wi,y:(y+.5)*Wi},P=K(d.position,E,n,o);if(P<Xa){const C=mC*(1-P/Xa);T.currentTemperature+=C}}}}}})}function bT(e,t){const n={},o=Math.ceil(e/Wi),s=Math.ceil(t/Wi);for(let a=0;a<s;a++)for(let l=0;l<o;l++){const u=Hp(l,a);let d=MS;const h=a/s*10-5;d+=h,d+=Math.random()*4-2,Math.random()<.05&&(d-=10),n[u]={baseTemperature:d,currentTemperature:d}}return{sectors:n}}function WR(e,t,n){var u;const{gameState:o}=t,s=n*(Ot/Ut);e.isAdult=e.age>=fp;const a=fl(o.temperature,e.position,o.time,o.mapDimensions.width,o.mapDimensions.height);if(a<dr){const d=(dr-a)*gC*s;e.hitpoints-=d}if(e.movementSlowdown&&o.time>e.movementSlowdown.endTime&&(e.movementSlowdown=void 0),e.hitpoints<e.maxHitpoints&&e.hunger<on){const d=1-e.hunger/on*Ow,h=Dw*d*s;e.hitpoints=Math.min(e.maxHitpoints,e.hitpoints+h)}if(e.hunger+=n*(Ea/(Ot/Ut)),e.hunger>=on)if(e.food.length>0&&e.isAdult)e.food.pop(),e.hunger=Math.max(0,e.hunger-Ho);else{const d=Nw*s;e.hitpoints-=d}if(e.age+=n/Nu,e.gender==="female"&&e.isPregnant&&e.gestationTime&&(e.gestationTime-=s,e.hunger+=n*((Ea*ww-Ea)/(Ot/Ut)),(!e.lastPregnantEffectTime||o.time-e.lastPregnantEffectTime>ll*3)&&(Fe(o,Ce.Pregnant,e.position,ll,e.id),e.lastPregnantEffectTime=o.time),e.gestationTime<=0&&(QM(e,e.pregnancyFatherId,t),e.isPregnant=!1,e.gestationTime=0,e.pregnancyFatherId=void 0)),e.procreationCooldown&&(e.procreationCooldown-=s,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&(e.attackCooldown.melee-=s,e.attackCooldown.melee<0&&(e.attackCooldown.melee=0),e.attackCooldown.ranged-=s,e.attackCooldown.ranged<0&&(e.attackCooldown.ranged=0)),e.feedParentCooldownTime&&(e.feedParentCooldownTime-=s,e.feedParentCooldownTime<0&&(e.feedParentCooldownTime=0)),e.feedChildCooldownTime&&(e.feedChildCooldownTime-=s,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0)),e.isAdult?e.radius===Ds&&(e.radius=ut):e.hunger+=n*((Ea*Cw-Ea)/(Ot/Ut)),e.isAdult&&e.food.length>0&&(!e.feedParentCooldownTime||e.feedParentCooldownTime<=0)){const d=[];if(e.motherId){const h=o.entities.entities[e.motherId];h&&d.push(h)}if(e.fatherId){const h=o.entities.entities[e.fatherId];h&&d.push(h)}for(const h of d)if(h.age>=hp&&h.hunger>=_w&&K(e.position,h.position,o.mapDimensions.width,o.mapDimensions.height)<=Rw){e.food.pop(),h.hunger=Math.max(0,h.hunger-Ho),e.feedParentCooldownTime=kw;break}}let l;if(e.hitpoints<=0?a<dr?l="hypothermia":e.hunger>=on?l="hunger":l="killed":e.age>=e.maxAge&&(l="oldAge"),l){if(e.leaderId===e.id){const d=Is(Ji(o,e));if(d){d.leaderId=d.id,d.tribeInfo=e.tribeInfo,d.tribeControl=e.tribeControl??{diplomacy:{}};const h=o;pu(o,e.id,d.id);const p=h.search.human.byProperty("leaderId",e.id);for(const y of p)y.leaderId=d.id,y.tribeInfo=d.tribeInfo;const m=h.search.building.byProperty("ownerId",e.id);for(const y of m)y.ownerId=d.id;for(const y of vu(d,o))y.leaderId=d.id,y.tribeInfo=d.tribeInfo;const S=Uu(o).filter(y=>y.leaderId!==d.id&&y.leaderId!==e.id);for(const y of S){const I=o.entities.entities[y.leaderId];if((u=I==null?void 0:I.tribeControl)!=null&&u.diplomacy){const T=I.tribeControl.diplomacy[e.id];T!==void 0&&(I.tribeControl.diplomacy[d.id]=T,delete I.tribeControl.diplomacy[e.id])}}}}if(e.isPlayer){const d=Is(Ji(o,e));d?(d.isPlayer=!0,o.generationCount++):(o.gameOver=!0,o.causeOfGameOver=l,al(o,{identifier:"no_heir",type:Sr.NoHeir,message:"Your lineage has ended. You have no heir.",duration:0}))}qM(o.entities,e.position,e.gender,e.age,e.radius,e.id,o.time,e.food,e.hunger),Ci(o.entities,e.id);return}e.animationProgress===void 0&&(e.animationProgress=0),e.animationSpeed===void 0&&(e.animationSpeed=1),e.animationProgress+=n*e.animationSpeed,e.animationProgress>=1&&(e.animationProgress=0)}function YR(e,t){const n=t.gameState.time-e.timeOfDeath;e.decayProgress=Math.min(1,n/Mw);const o=Math.floor(AS*(1-e.decayProgress));e.food.length>o&&e.food.splice(o),e.decayProgress>=1&&e.food.length<=0&&Ci(t.gameState.entities,e.id)}function jR(e,t,n){const o=n*(Ot/Ut);e.age+=n/Nu,e.isAdult=e.age>=mT;let s=t.gameState.ecosystem.preyHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.2),e.hunger+=s,e.hunger>=ju){const l=PT*o;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*40,y:e.position.y+(Math.random()-.5)*40};l.x=Math.max(20,Math.min(t.gameState.mapDimensions.width-20,l.x)),l.y=Math.max(20,Math.min(t.gameState.mapDimensions.height-20,l.y));const u=Math.random()<.5?"male":"female",d=e,h=e.fatherId?t.gameState.entities.entities[e.fatherId]:void 0;let p;if(h)p=lR(d.geneCode,h.geneCode);else{p=d.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}Rs(t.gameState.entities,l,u,0,gT*.5,p,e.id,e.fatherId,e.aiType),Fe(t.gameState,Ce.Procreation,e.position,ll,e.id),ke(t,Pe.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.preyProcreationCooldown,e.fatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.eatingCooldownTime&&e.eatingCooldownTime>t.gameState.time||(e.eatingCooldownTime=void 0),e.fleeCooldown&&e.fleeCooldown>0&&(e.fleeCooldown-=o,e.fleeCooldown<0&&(e.fleeCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=pT&&(a=!0),a&&(ZM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Ci(t.gameState.entities,e.id))}function zR(e,t,n){const o=n*(Ot/Ut);e.age+=n/Nu,e.isAdult=e.age>=AT;let s=t.gameState.ecosystem.predatorHungerIncreasePerHour*o;if(e.isPregnant&&(s*=1.3),e.hunger+=s,e.hunger>=zu){const l=PT*o;e.hitpoints-=l}if(e.isPregnant&&e.gestationTime!==void 0&&(e.gestationTime-=o,e.gestationTime<=0)){const l={x:e.position.x+(Math.random()-.5)*50,y:e.position.y+(Math.random()-.5)*50};l.x=Math.max(25,Math.min(t.gameState.mapDimensions.width-25,l.x)),l.y=Math.max(25,Math.min(t.gameState.mapDimensions.height-25,l.y));const u=Math.random()<.5?"male":"female",d=e,h=e.pregnancyFatherId?t.gameState.entities.entities[e.pregnancyFatherId]:void 0;let p;if(h)p=gR(d.geneCode,h.geneCode);else{p=d.geneCode;const m=Math.floor((Math.random()-.5)*4096);p=Math.max(0,Math.min(16777215,p+m))}ks(t.gameState.entities,l,u,0,vT*.6,p,e.id,e.pregnancyFatherId,e.aiType),Fe(t.gameState,Ce.Procreation,e.position,ll,e.id),ke(t,Pe.Birth,e.position),e.isPregnant=!1,e.gestationTime=0,e.procreationCooldown=t.gameState.ecosystem.predatorProcreationCooldown,e.pregnancyFatherId=void 0}e.procreationCooldown&&e.procreationCooldown>0&&(e.procreationCooldown-=o,e.procreationCooldown<0&&(e.procreationCooldown=0)),e.attackCooldown&&e.attackCooldown>0&&(e.attackCooldown-=o,e.attackCooldown<0&&(e.attackCooldown=0)),e.huntCooldown&&e.huntCooldown>0&&(e.huntCooldown-=o,e.huntCooldown<0&&(e.huntCooldown=0)),e.feedChildCooldownTime&&e.feedChildCooldownTime>0&&(e.feedChildCooldownTime-=o,e.feedChildCooldownTime<0&&(e.feedChildCooldownTime=0));let a=!1;e.hitpoints<=0&&(a=!0),e.age>=yT&&(a=!0),a&&(KM(t.gameState.entities,e.position,e.gender,e.age,e.radius,e.id,t.gameState.time,e.geneCode),Ci(t.gameState.entities,e.id))}var Go=(e=>(e[e.TaskBased=0]="TaskBased",e))(Go||{}),q=(e=>(e[e.Wait=0]="Wait",e[e.HumanGatherBerries=1]="HumanGatherBerries",e[e.HumanGatherMeat=2]="HumanGatherMeat",e[e.HumanEat=3]="HumanEat",e[e.HumanProcreateFemale=4]="HumanProcreateFemale",e[e.HumanProcreateMale=5]="HumanProcreateMale",e[e.HumanFeedChild=6]="HumanFeedChild",e[e.HumanPlaceStorage=7]="HumanPlaceStorage",e[e.HumanPlaceBonfire=8]="HumanPlaceBonfire",e[e.HumanPlacePlantingZone=9]="HumanPlacePlantingZone",e[e.HumanPlaceBorderPost=10]="HumanPlaceBorderPost",e[e.HumanPlantBush=11]="HumanPlantBush",e[e.HumanStockpile=12]="HumanStockpile",e[e.HumanFuelBonfire=13]="HumanFuelBonfire",e[e.HumanRetrieve=14]="HumanRetrieve",e[e.HumanChopTree=15]="HumanChopTree",e[e.HumanGatherWood=16]="HumanGatherWood",e[e.HumanHuntPrey=17]="HumanHuntPrey",e[e.HumanHuntPredator=18]="HumanHuntPredator",e[e.HumanPlayerCommand=19]="HumanPlayerCommand",e[e.HumanAttackHuman=20]="HumanAttackHuman",e[e.HumanSeekWarmth=21]="HumanSeekWarmth",e[e.HumanFlee=22]="HumanFlee",e[e.HumanStayNearTribe=23]="HumanStayNearTribe",e[e.HumanStayNearParent=24]="HumanStayNearParent",e[e.HumanDiplomacy=25]="HumanDiplomacy",e[e.HumanPlacePalisade=26]="HumanPlacePalisade",e[e.HumanPlaceGate=27]="HumanPlaceGate",e[e.HumanAttackBuilding=28]="HumanAttackBuilding",e[e.AnimalFlee=29]="AnimalFlee",e[e.AnimalGraze=30]="AnimalGraze",e[e.AnimalHunt=31]="AnimalHunt",e[e.AnimalAttack=32]="AnimalAttack",e[e.AnimalProcreate=33]="AnimalProcreate",e[e.AnimalWander=34]="AnimalWander",e[e.AnimalFeedChild=35]="AnimalFeedChild",e[e.AnimalSeekFoodFromParent=36]="AnimalSeekFoodFromParent",e[e.AnimalHerd=37]="AnimalHerd",e[e.AnimalTerritorial=38]="AnimalTerritorial",e[e.AnimalPack=39]="AnimalPack",e))(q||{}),N=(e=>(e[e.Running=0]="Running",e[e.Success=1]="Success",e[e.Failure=2]="Failure",e[e.Empty=3]="Empty",e))(N||{});const Bt=3,XR=250,DT=.8,VR=100,qR=5,Yh="currentAiTask",OT="lastTaskResult",NT="lastTaskMessage",jh="taskHistory";function Au({aiBlackboard:e}){return Oe.get(e,Yh)||null}function Ki({aiBlackboard:e},t){t?Oe.set(e,Yh,t):Oe.delete(e,Yh)}function ZR(e){for(const t in e.tasks)e.tasks[t].validUntilTime<e.time&&delete e.tasks[t]}function KR(e){return Array.isArray(e)?[e[0],e[1]??"",e[2]]:[e,"",void 0]}function BT(e,t,n,o){const s=t.type===q.Wait?QR:o[t.type];let a;s&&s.executor?a=s.executor(t,e,n):a=N.Failure;const[l,u,d]=KR(a);if(Oe.set(e.aiBlackboard,OT,l),Oe.set(e.aiBlackboard,NT,u),l!==N.Running){const h=Oe.get(e.aiBlackboard,jh)||[];if(h.unshift({type:t.type,result:l,completedAtTick:n.gameState.time,message:u}),h.length>5&&h.pop(),Oe.set(e.aiBlackboard,jh,h),delete n.gameState.tasks[t.id],Ki(e,null),l===N.Success){const p=d||t.nextTask;p&&(n.gameState.tasks[p.id]=p,p.claimedByEntityId=e.id,Ki(e,p.id))}}return l}function et(e){return 1/(1+e/XR)}function Tl(e,t,n){for(let o=0;o<n.length;o++){const s=n[o];if(!s.producer)continue;const a=s.producer(e,t);for(const l in a){const u=a[l],d=t.gameState.tasks[l];t.gameState.tasks[l]=u,d&&(t.gameState.tasks[l].claimedByEntityId=d.claimedByEntityId)}}}const Gc=(e,t)=>({id:`wait-${e.id}`,position:e.position,type:q.Wait,creatorEntityId:e.id,validUntilTime:t+Bt}),QR={type:q.Wait,executor:(e,t,n)=>n.gameState.time>=e.validUntilTime-1?[N.Success,"Wait complete"]:[N.Running,"Waiting"]};function tt(e){const{type:t,requireAdult:n,autopilotBehavior:o,producer:s,scorer:a,executor:l}=e;return{type:t,producer:s,scorer:a?(h,p,m)=>n&&!h.isAdult||o&&h.isPlayer&&!m.gameState.autopilotControls.behaviors[o]?null:a(h,p,m):void 0,executor:l?(h,p,m)=>n&&!p.isAdult||o&&p.isPlayer&&!m.gameState.autopilotControls.behaviors[o]?N.Failure:m.gameState.autopilotControls.activeAutopilotAction&&h.type!==q.HumanPlayerCommand&&p.isPlayer?[N.Failure,"Autopilot action active",{id:`player-command-${p.id}`,type:q.HumanPlayerCommand,position:p.position,creatorEntityId:p.id,validUntilTime:m.gameState.time+Bt}]:l(h,p,m):void 0}}const JR=tt({type:q.HumanEat,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hunger>xh&&e.food.length>0){const o=`eat-task-${e.id}`;n[o]={id:o,type:q.HumanEat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t)=>t.target!==e.id||e.food.length===0?null:e.hunger/on,executor:(e,t)=>e.target!==t.id?N.Empty:t.hunger<xh?N.Success:t.food.length===0?N.Failure:(t.direction={x:0,y:0},t.target=void 0,t.activeAction="eating",N.Running)}),ek=tt({type:q.HumanGatherBerries,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="berryBush"||o.food.length===0||e.leaderId&&!Pr(o.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=et(s),l=e.hunger/on;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];return!o||o.type!=="berryBush"||o.food.length===0||t.food.length>=t.maxFood?[N.Success,"Bush is empty"]:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",[N.Running,"Moving to bush"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[N.Running,"Gathering berries"])}}),tk=tt({type:q.HumanGatherMeat,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="corpse"||o.food.length===0||e.leaderId&&!Pr(o.position,e.leaderId,n.gameState)||e.food.length>=e.maxFood)return null;const s=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=et(s),l=e.hunger/on;return(a+l)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.type!=="corpse"||o.food.length===0||t.food.length>=t.maxFood?N.Success:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",N.Running)}}),nk=tt({type:q.HumanProcreateFemale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="female"&&!e.isPregnant&&e.age>=fu&&e.age<=dp&&e.hunger<jn&&(e.procreationCooldown||0)<=0){const s=`procreate-female-task-${e.id}`;n[s]={id:s,type:q.HumanProcreateFemale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="male"||e.age<fu||e.hunger>=jn||(e.procreationCooldown||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="female"||o.isPregnant||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(s)*DT},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="female"||t.hunger>=jn?N.Failure:o.isPregnant?N.Success:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",t.direction=jt(t.position,o.position,n.gameState.mapDimensions),N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",N.Running)}}),ik=tt({type:q.HumanProcreateMale,requireAdult:!0,autopilotBehavior:"procreation",producer:(e,t)=>{const n={};if(e.gender==="male"&&e.age>=fu&&e.hunger<jn&&(e.procreationCooldown||0)<=0){const s=`procreate-male-task-${e.id}`;n[s]={id:s,type:q.HumanProcreateMale,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t,n)=>{if(e.gender!=="female"||e.isPregnant||e.age<fu||e.age>dp||e.hunger>=jn||(e.procreationCooldown||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.gender!=="male"||o.hunger>=jn||e.leaderId&&o.leaderId&&e.leaderId!==o.leaderId)return null;const s=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(s)*DT},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.gender!=="male"||o.hunger>=jn?N.Failure:t.isPregnant?N.Success:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",t.direction=jt(t.position,o.position,n.gameState.mapDimensions),N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="procreating",N.Running)}}),ok=tt({type:q.HumanFeedChild,requireAdult:!0,autopilotBehavior:"feedChildren",producer:(e,t)=>{const n={};if(!e.isAdult&&e.hunger>=dy){const o=`feed-child-task-${e.id}`;n[o]={id:o,type:q.HumanFeedChild,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t,n)=>{if(e.food.length===0||(e.feedChildCooldownTime||0)>0)return null;const o=n.gameState.entities.entities[t.creatorEntityId];if(!o||o.isAdult||!(o.motherId===e.id||o.fatherId===e.id))return null;const a=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=et(a),u=o.hunger/on;return(l+u)/2},executor:(e,t,n)=>{const o=n.gameState.entities.entities[e.creatorEntityId];return!o||o.isAdult||t.food.length===0?N.Failure:o.hunger<dy/2?N.Success:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>IS?(t.target=o.position,t.activeAction="moving",t.direction=jt(t.position,o.position,n.gameState.mapDimensions),N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="feeding",N.Running)}});function Il(e,t,n){if(e.leaderId!==t.creatorEntityId||!t.target||typeof t.target!="object"||!("x"in t.target))return null;const o=K(e.position,t.target,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(o)}function rk(e,t,n){if(e.leaderId!==t.creatorEntityId||!e.leaderId)return null;const o=t.target;if(!o)return null;const{width:s,height:a}=n.gameState.mapDimensions,l=K(e.position,o,s,a),u=et(l)*.5,d=li(e.leaderId,n.gameState),h=K(d,o,s,a),p=Math.max(0,1-h/800)*.25,m=Math.ceil(s/_e),S=Math.ceil(a/_e),y=lC(o);let I=0;for(let E=-1;E<=1;E++)for(let P=-1;P<=1;P++){if(P===0&&E===0)continue;const C=((y.x+P)%m+m)%m,_=((y.y+E)%S+S)%S;n.gameState.terrainOwnership[_*m+C]===e.leaderId&&I++}const T=I/8*.25;return u+p+T}function Ns(e,t,n,o,s){const a=e.target;return K(t.position,a,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>s?(t.target=a,t.activeAction="moving",N.Running):(Ip(a,o,t.leaderId,n.gameState),N.Success)}const sk=tt({type:q.HumanPlaceStorage,requireAdult:!0,autopilotBehavior:"build",scorer:Il,executor:(e,t,n)=>Ns(e,t,n,X.StorageSpot,vl)}),ak=tt({type:q.HumanPlaceBonfire,requireAdult:!0,autopilotBehavior:"build",scorer:Il,executor:(e,t,n)=>Ns(e,t,n,X.Bonfire,vl)}),lk=tt({type:q.HumanPlacePlantingZone,requireAdult:!0,autopilotBehavior:"build",scorer:Il,executor:(e,t,n)=>Ns(e,t,n,X.PlantingZone,vl)}),ck=tt({type:q.HumanPlaceBorderPost,scorer:rk,requireAdult:!0,autopilotBehavior:"build",executor:(e,t,n)=>Ns(e,t,n,X.BorderPost,iC)}),uk=tt({type:q.HumanPlacePalisade,requireAdult:!0,autopilotBehavior:"build",scorer:Il,executor:(e,t,n)=>Ns(e,t,n,X.Palisade,vl)}),dk=tt({type:q.HumanPlaceGate,requireAdult:!0,autopilotBehavior:"build",scorer:Il,executor:(e,t,n)=>Ns(e,t,n,X.Gate,vl)}),fk=tt({type:q.HumanPlantBush,requireAdult:!0,autopilotBehavior:"planting",scorer:(e,t,n)=>{if(e.food.filter(d=>d.type===ui.Berry).length<vr)return null;const s=n.gameState.entities.entities[t.creatorEntityId];if(!s||s.type!=="building"||!s.ownerId)return null;const a=n.gameState.entities.entities[s.ownerId];if(!a||a.leaderId!==e.leaderId)return null;const l=t.target,u=K(e.position,l,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(u)},executor:(e,t,n)=>{if(t.food.filter(u=>u.type===ui.Berry).length<vr)return t.activeAction="idle",N.Failure;const s=e.target;return K(t.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>vS?(t.target=s,t.activeAction="moving",N.Running):(t.activeAction!=="planting"&&(t.activeAction="planting",t.target=s),Object.values(n.gameState.entities.entities).find(u=>u.type==="berryBush"&&K(u.position,s,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<qR)?(t.activeAction="idle",N.Success):N.Running)}}),hk=tt({type:q.HumanStockpile,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var h;if(typeof t.target!="number")return null;const o=e.food.length>0,s=((h=e.heldItem)==null?void 0:h.type)===Gt.Wood;if(!o&&!s)return null;const a=n.gameState.entities.entities[t.target];if(!a||a.type!=="building"||a.buildingType!==X.StorageSpot||e.leaderId!==a.ownerId||a.storedItems.length>=a.storageCapacity)return null;const l=K(e.position,a.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),u=et(l),d=s?.6:e.food.length/e.maxFood*.4;return(u+d)/2},executor:(e,t,n)=>{var u;if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==X.StorageSpot)return N.Failure;const s=t.food.length>0,a=((u=t.heldItem)==null?void 0:u.type)===Gt.Wood;return!s&&!a?N.Success:o.storedItems.length>=o.storageCapacity?N.Failure:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",N.Running)}}),pk=tt({type:q.HumanFuelBonfire,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{var u;if(typeof t.target!="number"||!(((u=e.heldItem)==null?void 0:u.type)===Gt.Wood))return null;const s=n.gameState.entities.entities[t.target];if(!s||s.type!=="building"||s.buildingType!==X.Bonfire||e.leaderId!==s.ownerId)return null;const a=s.storageCapacity||Gh;if(s.storedItems.length>=a)return null;const l=K(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return et(l)},executor:(e,t,n)=>{var u;if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="building"||o.buildingType!==X.Bonfire)return N.Failure;if(!(((u=t.heldItem)==null?void 0:u.type)===Gt.Wood))return N.Success;const a=o.storageCapacity||Gh;return o.storedItems.length>=a?N.Failure:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="depositing",N.Running)}}),gk=tt({type:q.HumanRetrieve,requireAdult:!1,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(e.hunger<=xh||e.food.length>0||typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="building"||o.buildingType!==X.StorageSpot||o.ownerId!==e.leaderId||!o.storedItems.some(d=>d.item.itemType==="food")||e.food.length>=e.maxFood)return null;const s=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=et(s),l=e.hunger/on,u=1-e.food.length/e.maxFood;return(a+l+u)/3},executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.type!=="building"||o.buildingType!==X.StorageSpot||!o.storedItems.some(a=>a.item.itemType==="food")?N.Failure:t.food.length>0?N.Success:t.food.length>=t.maxFood?N.Failure:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",N.Running):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="retrieving",N.Running)}}),mk=2;function Fp(e,t){if(e.leaderId){const n=t.entities.entities[e.leaderId];if(n&&n.aiBlackboard)return n}if(e.isAdult&&e.aiBlackboard)return e;if(!e.isAdult&&e.fatherId){const n=t.entities.entities[e.fatherId];if(n&&n.aiBlackboard)return n}return null}const yk=tt({type:q.HumanChopTree,requireAdult:!0,autopilotBehavior:"chopping",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="tree")return null;const[s]=o.stateMachine??[];if(!(s===ri||s===zn||s===Ei)||e.leaderId&&!Pr(o.position,e.leaderId,n.gameState)||e.heldItem||e.food.length===0)return null;const l=Fp(e,n.gameState);if(!l)return null;const u=ZS(l.id,n.gameState);if(u<=0)return null;const d=DP(l.id,n.gameState);if(d>=u)return null;const h=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),p=et(h),m=Math.min(1,(u-d)/10);return(p+m)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="tree")return[N.Failure,"Tree not found"];const[s]=o.stateMachine??[];if(s===Vt){const u={id:`gather-wood-${t.id}-${n.gameState.time}`,type:q.HumanGatherWood,position:o.position,creatorEntityId:t.id,target:o.id,validUntilTime:n.gameState.time+1};return[N.Success,"Tree fell!",u]}return s===ri||s===zn||s===Ei?t.heldItem?[N.Failure,"Hands full"]:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>SS?(t.target=o.position,t.activeAction="moving",[N.Running,"Moving to tree"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="chopping",[N.Running,"Chopping tree"]):[N.Failure,"Tree is not standing"]}}),vk=tt({type:q.HumanGatherWood,requireAdult:!0,autopilotBehavior:"gathering",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="tree"||o.wood.length===0)return null;const[s]=o.stateMachine??[];if(s!==Vt||e.leaderId&&!Pr(o.position,e.leaderId,n.gameState)||e.heldItem)return null;const a=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=et(a),u=Fp(e,n.gameState),d=u?ZS(u.id,n.gameState):0,h=Math.min(1,d/10);return(l+h)/2},executor:(e,t,n)=>{var a;if(typeof e.target!="number")return[N.Failure,"Invalid target"];if(((a=t.heldItem)==null?void 0:a.type)==="wood")return[N.Success,"Already holding wood"];const o=n.gameState.entities.entities[e.target];return!o||o.type!=="tree"||o.wood.length===0||t.heldItem?[N.Failure,"Tree gone, empty, or human full"]:K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Qe?(t.target=o.position,t.activeAction="moving",[N.Running,"Moving to wood"]):(t.direction={x:0,y:0},t.target=o.id,t.activeAction="gathering",[N.Running,"Gathering wood"])}}),Sk=tt({type:q.HumanHuntPrey,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="prey"||o.hitpoints<=0||e.leaderId&&!Pr(o.position,e.leaderId,n.gameState))return null;const s=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(e.leaderId){const u=li(e.leaderId,n.gameState);if(K(e.position,u,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>Xw)return null}const a=et(s),l=e.hunger/on;return(a+l)/2*.6},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[N.Success,"Prey is dead"];const s=K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Qe?[N.Running,"Chasing prey"]:[N.Running,"Attacking prey"]}}),Tk=tt({type:q.HumanHuntPredator,requireAdult:!0,autopilotBehavior:"attack",scorer:(e,t,n)=>{if(typeof t.target!="number"||e.hitpoints<e.maxHitpoints*.3)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="predator"||o.hitpoints<=0||e.leaderId&&!Pr(o.position,e.leaderId,n.gameState))return null;const s=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return(et(s)+.3)/1.3},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];if(t.hitpoints<t.maxHitpoints*.2)return t.activeAction="idle",t.attackTargetId=void 0,[N.Failure,"Too injured to continue"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[N.Success,"Predator eliminated"];const s=K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Qe?[N.Running,"Chasing predator"]:[N.Running,"Fighting predator"]}});function Ik(e,t,n,o){var d;const s=e.entities.entities[n.targetEntityId];if(!s||!("hitpoints"in s)||s.hitpoints<=0)return e.autopilotControls.activeAutopilotAction=void 0,N.Failure;const a=K(t.position,s.position,e.mapDimensions.width,e.mapDimensions.height),u=(((d=t.attackCooldown)==null?void 0:d.ranged)??0)<=0?An:Fo;return a<=u?(t.activeAction="attacking",t.attackTargetId=s.id,e.autopilotControls.activeAutopilotAction=void 0,N.Success):(t.activeAction="moving",t.target=s.id,t.direction=jt(t.position,s.position,e.mapDimensions),N.Running)}const Ak=tt({type:q.HumanPlayerCommand,producer:(e,t)=>{const n={};if(e.isPlayer&&t.gameState.autopilotControls.activeAutopilotAction){const o=`player-command-${e.id}`;n[o]={id:o,type:q.HumanPlayerCommand,position:e.position,creatorEntityId:e.id,validUntilTime:t.gameState.time+Bt}}return n},scorer:(e,t)=>t.type===q.HumanPlayerCommand&&e.isPlayer?1e3:null,executor:(e,t,n)=>{var a;const{gameState:o}=n,s=o.autopilotControls.activeAutopilotAction;if(!s)return[N.Failure,"No active autopilot action"];switch(s.action){case Se.AutopilotMove:{if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,N.Failure;const l=s.position;return K(t.position,l,o.mapDimensions.width,o.mapDimensions.height)<Zw?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction==="moving"&&(t.activeAction="idle",t.target=void 0),[N.Success,"Reached target position"]):(t.activeAction="moving",t.target=l,t.direction=jt(t.position,l,o.mapDimensions),[N.Running,"Moving to target"])}case Se.AutopilotGather:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];if(!l)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Target entity not found"];let u=!1;if(l.type==="berryBush")u=l.food.length===0;else if(l.type==="corpse")u=l.food.length===0;else if(l.type==="tree"){const h=l;u=h.stateMachine[0]!==Vt||h.wood.length===0}else return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target type"];return u?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Target is depleted"]):K(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)>vS?(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[N.Running,"Moving to gather target"]):(t.activeAction="gathering",t.target=l.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"At target, gathering",Gc(t,o.time)])}case Se.AutopilotChop:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];if(!l||l.type!=="tree")return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target entity"];const[u]=l.stateMachine??[];return!(u===ri||u===zn||u===Ei)||t.heldItem?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Tree is not standing or human is holding an item"]):K(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)>SS?(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[N.Running,"Moving to tree"]):(t.activeAction="chopping",t.target=l.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"At tree, chopping",Gc(t,o.time)])}case Se.AutopilotAttack:return"targetEntityId"in s?Ik(o,t,s):(o.autopilotControls.activeAutopilotAction=void 0,N.Failure);case Se.AutopilotProcreate:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];if(!l||l.type!=="human"||!bs(t,l,o))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target for procreation"];const u=K(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height);return l.isPregnant||t.isPregnant?t.gender==="male"&&l.pregnancyFatherId!==t.id?[N.Failure,"Target is pregnant by another"]:[N.Success,"Procreation conditions met"]:u<=Qf?(t.activeAction="procreating",o.autopilotControls.activeAutopilotAction=void 0,[N.Running,"Procreating"]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[N.Running,"Moving to procreation target"])}case Se.AutopilotPlant:{if(t.activeAction==="planting")return[N.Running,"Planting"];if(!("position"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No position specified"];const l=s.position;return Qi(l,o,Ou,t.id)?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Position is occupied"]):K(t.position,l,o.mapDimensions.width,o.mapDimensions.height)<=Qf?(t.activeAction="planting",t.target=l,o.autopilotControls.activeAutopilotAction=void 0,o.hasPlayerPlantedBush=!0,[N.Running,"Planting"]):(t.activeAction="moving",t.target=l,t.direction=jt(t.position,l,o.mapDimensions),[N.Running,"Moving to planting target"])}case Se.AutopilotFeedChild:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];return!l||l.type!=="human"||l.isAdult||t.food.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target for feeding child"]):K(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=Qf?(o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="feeding",[N.Success,"Feeding child"]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[N.Running,"Moving to feeding target"])}case Se.AutopilotDeposit:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];if(!l||l.buildingType!==X.StorageSpot&&l.buildingType!==X.Bonfire||!l.isConstructed)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"];const u=l.storageCapacity??0;if(l.storedItems.length>=u)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Storage is full"];if(t.leaderId!==l.ownerId)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Human does not belong to the same tribe as the building"];const h=t.food.length>0,p=!!t.heldItem;if(l.buildingType===X.Bonfire){if(((a=t.heldItem)==null?void 0:a.type)!==Gt.Wood)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Bonfires only accept wood"]}else if(!h&&!p)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No items to deposit"];return K(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=ci?(t.activeAction="depositing",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Depositing items",Gc(t,o.time)]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[N.Running,"Moving to deposit target"])}case Se.AutopilotRetrieve:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];return!l||l.buildingType!==X.StorageSpot||!l.isConstructed||l.storedItems.length===0?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"]):t.leaderId!==l.ownerId?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Human does not belong to the same tribe as the building"]):t.food.length>=t.maxFood?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Storage is full"]):K(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=ci?(t.activeAction="retrieving",t.target=void 0,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Retrieving items",Gc(t,o.time)]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[N.Running,"Moving to retrieve target"])}case Se.TakeOverBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Tr(t,l,o)?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Only leaders can take over buildings"]):K(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=Qe?(t.activeAction="takingOverBuilding",t.target=l.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Taking over building"]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[N.Running,"Moving to takeover target"])}case Se.RemoveEnemyBuilding:{if(!("targetEntityId"in s))return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No target entity ID"];const l=o.entities.entities[s.targetEntityId];return!l||l.type!=="building"||!Tr(t,l,o)?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Invalid target building"]):t.leaderId!==t.id?(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Only leaders can remove enemy buildings"]):K(t.position,l.position,o.mapDimensions.width,o.mapDimensions.height)<=Qe?(t.activeAction="destroyingBuilding",t.target=l.id,o.autopilotControls.activeAutopilotAction=void 0,[N.Success,"Removing enemy building"]):(t.activeAction="moving",t.target=l.id,t.direction=jt(t.position,l.position,o.mapDimensions),[N.Running,"Moving to removal target"])}case Se.AutopilotBuildingPlacement:{if(!("position"in s)||!("buildingType"in s))return o.autopilotControls.activeAutopilotAction=void 0,N.Failure;const l=s.position,u=s.buildingType;if(!u)return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"No building type specified"];const d=K(t.position,l,o.mapDimensions.width,o.mapDimensions.height),h=100;return d<=h?Ir(l,u,t.leaderId,o,t.position,h)?(Ip(l,u,t.leaderId,o),o.autopilotControls.activeAutopilotAction=void 0,t.activeAction="idle",[N.Success,"Building placed"]):(o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Cannot place building at this location"]):(t.activeAction="moving",t.target=l,t.direction=jt(t.position,l,o.mapDimensions),[N.Running,"Moving to placement target"])}default:return o.autopilotControls.activeAutopilotAction=void 0,[N.Failure,"Unknown or unhandled action"]}}}),Ek=tt({type:q.HumanAttackHuman,requireAdult:!0,autopilotBehavior:"attack",producer:(e,t)=>{const{gameState:n}=t,o={},s=Nn(e.position.x,e.position.y,n),a=s!==null&&s!==e.leaderId&&eo(e.leaderId,s,n),l=e.activeAction==="attacking"&&e.attackTargetId!==void 0;if(a||l){const u=`attack-human-${e.id}`;o[u]={id:u,type:q.HumanAttackHuman,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:n.time+Bt}}return o},scorer:(e,t,n)=>{if(typeof t.target!="number")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.type!=="human"||o.hitpoints<=0||o.id===e.id||o.leaderId===e.leaderId)return null;const{gameState:s}=n,a=yl(e,o,s),l=Nn(o.position.x,o.position.y,s)===e.leaderId,u=o.activeAction==="attacking"&&o.attackTargetId!==void 0;if(!a&&!u)return null;let d=.5;const h=K(e.position,o.position,s.mapDimensions.width,s.mapDimensions.height),p=et(h);return l&&a&&(d+=.1),(p+d)/2},executor:(e,t,n)=>{if(typeof e.target!="number")return[N.Failure,"Invalid target"];const o=n.gameState.entities.entities[e.target];if(!o||o.hitpoints<=0)return t.activeAction="idle",t.attackTargetId=void 0,[N.Success,"Target eliminated"];const s=K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return t.activeAction="attacking",t.attackTargetId=o.id,s>Qe?[N.Running,"Chasing human target"]:[N.Running,"Fighting human target"]}}),wk=tt({type:q.HumanSeekWarmth,requireAdult:!1,scorer:(e,t,n)=>{if(typeof t.target!="number"||kT(n.gameState.time)>.5)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.buildingType!==X.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0||e.leaderId!==o.ownerId)return null;const s=fl(n.gameState.temperature,e.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=dr+5;if(s>=a)return null;const l=(a-s)/15,u=(1-e.hitpoints/e.maxHitpoints)*.8,d=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),h=et(d);let p=(l+u+h)/2;return e.hitpoints/e.maxHitpoints<.2&&s<dr&&(p=Math.max(p,1.2)),p},executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.buildingType!==X.Bonfire||!o.isConstructed||(o.fuelLevel??0)<=0)return N.Failure;const s=fl(n.gameState.temperature,t.position,n.gameState.time,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=dr+5;if(s>=a)return t.activeAction="idle",[N.Success,"Comfortable temperature reached"];const l=t.id*137%360*(Math.PI/180),u=Xa*.4,d=n.gameState.mapDimensions.width,h=n.gameState.mapDimensions.height,p={x:(o.position.x+Math.cos(l)*u+d)%d,y:(o.position.y+Math.sin(l)*u+h)%h},m=K(t.position,p,d,h);return m>10?(t.activeAction="moving",t.target=p,t.direction=jt(t.position,p,n.gameState.mapDimensions),[N.Running,`Moving to warmth spot (${m.toFixed(0)}px away)`]):(t.activeAction="idle",t.direction={x:0,y:0},t.target=void 0,[N.Running,"Staying warm at bonfire"])}}),Ck=tt({type:q.HumanFlee,requireAdult:!1,producer:(e,t)=>{const n={};if(e.hitpoints<e.maxHitpoints*my){const o=fC(e.id,t.gameState);if(o){const s=`flee-task-${e.id}`;n[s]={id:s,type:q.HumanFlee,position:e.position,creatorEntityId:e.id,target:o.id,validUntilTime:t.gameState.time+Bt}}}return n},scorer:(e,t,n)=>typeof t.target!="number"||!n.gameState.entities.entities[t.target]?null:e.hitpoints<e.maxHitpoints*my?.9:null,executor:(e,t,n)=>{if(typeof e.target!="number")return N.Failure;const o=n.gameState.entities.entities[e.target];if(!o)return t.activeAction="idle",t.attackTargetId=void 0,N.Success;if(K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)>yy)return t.activeAction="idle",t.target=void 0,N.Success;t.activeAction="moving",t.attackTargetId=void 0;const a=xe(o.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),l=yt(a),u=Xn(t.position,ct(l,yy));return t.target={x:(u.x%n.gameState.mapDimensions.width+n.gameState.mapDimensions.width)%n.gameState.mapDimensions.width,y:(u.y%n.gameState.mapDimensions.height+n.gameState.mapDimensions.height)%n.gameState.mapDimensions.height},t.direction=l,N.Running}}),Pk=tt({type:q.HumanStayNearTribe,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,o={};if(!e.leaderId||e.id===e.leaderId)return o;const s=li(e.leaderId,n),a=`stay-near-tribe-${e.id}`;return o[a]={id:a,type:q.HumanStayNearTribe,position:e.position,creatorEntityId:e.id,target:s,validUntilTime:n.time+Bt},o},scorer:(e,t,n)=>{if(!e.leaderId||e.id===e.leaderId)return null;const o=li(e.leaderId,n.gameState),s=K(e.position,o,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=vy)return null;const a=s-vy;return Math.min(.95,.5+a/1e3*oC)},executor:(e,t,n)=>{if(!t.leaderId)return N.Failure;const o=li(t.leaderId,n.gameState),s=K(t.position,o,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<sC?(t.activeAction="idle",t.target=void 0,N.Success):(t.activeAction="moving",t.target=o,[N.Running,`Returning to tribe center (${Math.round(s)}px away)`])}}),_k=tt({type:q.HumanStayNearParent,requireAdult:!1,producer:(e,t)=>{const{gameState:n}=t,o={};if(e.isAdult)return o;const s=My(e,n);if(!s)return o;const a=`stay-near-parent-${e.id}`;return o[a]={id:a,type:q.HumanStayNearParent,position:e.position,creatorEntityId:e.id,target:s.id,validUntilTime:n.time+Bt},o},scorer:(e,t,n)=>{if(e.isAdult)return null;const o=My(e,n.gameState);if(!o||o.id!==t.target||e.leaderId&&Tp(e.leaderId,n.gameState)&&Nn(o.position.x,o.position.y,n.gameState)!==e.leaderId)return null;const s=K(e.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);if(s<=Sy)return null;const a=s-Sy;return Math.min(.98,.6+a/500*rC)},executor:(e,t,n)=>{if(typeof e.target!="number")return t.activeAction="idle",N.Failure;const o=n.gameState.entities.entities[e.target];if(!o||o.type!=="human")return t.activeAction="idle",t.target=void 0,N.Failure;const s=K(t.position,o.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return s<=aC?(t.activeAction="idle",t.target=void 0,N.Success):(t.activeAction="moving",t.target=o.id,t.direction=jt(t.position,o.position,n.gameState.mapDimensions),[N.Running,`Returning to parent (${Math.round(s)}px away)`])}}),Rk=tt({type:q.HumanDiplomacy,requireAdult:!0,scorer:(e,t)=>e.id===e.leaderId&&t.creatorEntityId===e.id?1:null,executor:(e,t,n)=>{var u,d,h,p,m,S;const{gameState:o}=n,s=xo(t.id,o),a=Oy(s),l=Uu(o).filter(y=>y.leaderId!==t.id);for(const y of l){const I=xo(y.leaderId,o),T=Oy(I),E=((d=(u=t.tribeControl)==null?void 0:u.diplomacy)==null?void 0:d[y.leaderId])||bt.Friendly,P=o.entities.entities[y.leaderId];((p=(h=P==null?void 0:P.tribeControl)==null?void 0:h.diplomacy)==null?void 0:p[t.id])===bt.Hostile||a>T*qw?E!==bt.Hostile&&((m=t.tribeControl)!=null&&m.diplomacy)&&(t.tribeControl.diplomacy[y.leaderId]=bt.Hostile):E!==bt.Friendly&&((S=t.tribeControl)!=null&&S.diplomacy)&&(t.tribeControl.diplomacy[y.leaderId]=bt.Friendly)}return t.aiBlackboard&&Oe.set(t.aiBlackboard,"lastDiplomacyCheckTime",o.time),N.Success}}),kk={type:q.HumanAttackBuilding,executor:(e,t,n)=>{const{gameState:o}=n,s=e.target;return o.entities.entities[s]?(t.activeAction="attacking",t.attackTargetId=s,N.Running):N.Success}},qu=[JR,ek,tk,nk,ik,ok,sk,ak,lk,ck,uk,dk,fk,hk,pk,gk,yk,vk,Sk,Tk,Ak,Ek,wk,Ck,Pk,_k,Rk,kk].reduce((e,t)=>(e[t.type]=t,e),{}),Mk=Object.values(qu);function bk(e,t){Tl(e,t,Mk)}function Dk(e,t){if(e.isPlayer&&t.gameState.autopilotControls.isManuallyMoving){const o=Au(e);if(o){const s=t.gameState.tasks[o];s&&s.claimedByEntityId===e.id&&(s.claimedByEntityId=void 0),Ki(e,null)}return}let n=Au(e);if(n){const o=t.gameState.tasks[n];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(Ki(e,null),n=null)}if(!n){const o=Ok(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];n=o,Ki(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const o=t.gameState.tasks[n];o?BT(e,o,t,qu):Ki(e,null)}}function Ok(e,t){let n=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,800);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=qu[a.type];if(!l||!l.scorer)continue;const u=l.scorer(e,a,t);u!==null&&u>o&&(o=u,n=a.id)}return o>0?n:null}function Nk(e,t){const n=performance.now();switch(e.aiType){case Go.TaskBased:default:Dk(e,t);break}t.gameState.performanceMetrics.currentBucket.aiUpdateTime+=performance.now()-n}const Bk=(e,t)=>{const n={};for(let o=0;o<mk;o++){const s=`hunt-prey-${e.id}-${o}`;n[s]={id:s,type:q.HumanHuntPrey,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},Hk=(e,t)=>{const n={};if(e.hitpoints<=0)return n;const o=e.attackTargetId?t.gameState.entities.entities[e.attackTargetId]:void 0;if(!((o==null?void 0:o.type)==="human"))return n;for(let a=0;a<Vw;a++){const l=`hunt-predator-${e.id}-${a}`;n[l]={id:l,type:q.HumanHuntPredator,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+1}}return n},Eu=q_*1.5,Fk=(e,t)=>{const n={},o=t.gameState,s=[...o.search.human.byRadius(e.position,Eu),...o.search.predator.byRadius(e.position,Eu)].filter(d=>{if(d.id===e.id)return!1;if(e.type==="prey")return d.type==="human"||d.type==="predator";if(e.type==="predator"){if(d.type==="human")return!0;if(d.type==="predator")return d.geneCode!==e.geneCode}return!1});if(s.length===0)return n;let a=s[0],l=Vn(e.position,a.position);for(let d=1;d<s.length;d++){const h=Vn(e.position,s[d].position);h<l&&(l=h,a=s[d])}const u=`animal-flee-${e.id}-${a.id}`;return n[u]={id:u,type:q.AnimalFlee,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1},n},xk=(e,t,n)=>{const o=n.gameState.entities.entities[t.target];if(!o)return null;const s=Vn(e.position,o.position);return s>Eu?null:et(s)*.95},Lk=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];if(!o)return N.Failure;if(Vn(t.position,o.position)>Eu*1.2)return N.Success;const a=yt(Qh(t.position,o.position)),l=Xn(t.position,ct(a,100));return t.activeAction="moving",t.target=l,N.Running},Uk={type:q.AnimalFlee,producer:Fk,scorer:xk,executor:Lk},HT=600,Gk=(e,t)=>{if(e.type!=="prey")return{};const n={},s=t.gameState.search.berryBush.byRadius(e.position,HT).filter(a=>a.food.length>0);for(const a of s){const l=`animal-graze-${e.id}-${a.id}`;n[l]={id:l,type:q.AnimalGraze,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},$k=(e,t,n)=>{if(e.type!=="prey")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.food.length===0)return null;const s=Vn(e.position,o.position);if(s>HT)return null;const a=et(s),l=Math.max(0,e.hunger/ju);return e.hunger<20&&s>100?null:a*l*.65},Wk=(e,t,n)=>{if(t.type!=="prey")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.food.length===0||(t.activeAction="grazing",t.target=o.id,t.hunger<5)?N.Success:N.Running},Yk={type:q.AnimalGraze,producer:Gk,scorer:$k,executor:Wk},FT=800,jk=(e,t)=>{if(e.type!=="predator")return{};const n={},s=t.gameState.search.prey.byRadius(e.position,FT).filter(a=>a.type==="prey");for(const a of s){const l=`animal-hunt-${e.id}-${a.id}`;n[l]={id:l,type:q.AnimalHunt,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},zk=(e,t,n)=>{if(e.type!=="predator")return null;const o=n.gameState.entities.entities[t.target];if(!o||o.hitpoints<=0)return null;const s=Vn(e.position,o.position);if(s>FT)return null;const a=et(s),l=Math.max(0,e.hunger/zu);return e.hunger<30&&s>200?null:a*l*.8},Xk=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=n.gameState.entities.entities[e.target];return!o||o.hitpoints<=0||(t.activeAction="attacking",t.target=o.id,t.hunger<10)?N.Success:N.Running},Vk={type:q.AnimalHunt,producer:jk,scorer:zk,executor:Xk},xT=500,qk=(e,t)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,xT).filter(a=>{if(a.id===e.id||a.type!==e.type)return!1;const l=a;return l.isAdult&&l.gender!==e.gender&&(!l.procreationCooldown||l.procreationCooldown<=0)&&!l.isPregnant});for(const a of s){const l=`animal-procreate-${e.id}-${a.id}`;n[l]={id:l,type:q.AnimalProcreate,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},Zk=(e,t,n)=>{if(!e.isAdult||e.procreationCooldown&&e.procreationCooldown>0||e.isPregnant)return null;const o=n.gameState.entities.entities[t.target];if(!o||!o.isAdult||o.gender===e.gender||o.procreationCooldown&&o.procreationCooldown>0||o.isPregnant)return null;const s=Vn(e.position,o.position);return s>xT?null:et(s)*.6},Kk=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||o.isPregnant||o.procreationCooldown&&o.procreationCooldown>0?N.Failure:(t.activeAction="procreating",t.target=o.id,t.isPregnant||t.procreationCooldown&&t.procreationCooldown>0?N.Success:N.Running)},Qk={type:q.AnimalProcreate,producer:qk,scorer:Zk,executor:Kk},Jk=200,eM=(e,t)=>{const n=`animal-wander-${e.id}`,o=Math.random()*Math.PI*2,s=Math.random()*Jk,a={x:e.position.x+Math.cos(o)*s,y:e.position.y+Math.sin(o)*s};a.x=Math.max(0,Math.min(t.gameState.mapDimensions.width,a.x)),a.y=Math.max(0,Math.min(t.gameState.mapDimensions.height,a.y));const l={};return l[n]={id:n,type:q.AnimalWander,position:a,creatorEntityId:e.id,validUntilTime:t.gameState.time+5},l},tM=()=>.1,nM=(e,t)=>Vn(t.position,e.position)<10?(t.activeAction="idle",N.Success):(t.activeAction="moving",t.target=e.position,N.Running),iM={type:q.AnimalWander,producer:eM,scorer:tM,executor:nM},oM=(e,t)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return{};const n={},s=t.gameState.search[e.type].byRadius(e.position,600).filter(a=>{if(a.type!==e.type)return!1;const l=a;return l.motherId===e.id&&l.hunger>=Xu});for(const a of s){const l=`animal-feed-child-${e.id}-${a.id}`;n[l]={id:l,type:q.AnimalFeedChild,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},rM=(e,t,n)=>{if(e.gender!=="female"||!e.isAdult||e.feedChildCooldownTime&&e.feedChildCooldownTime>0)return null;const o=n.gameState.entities.entities[t.target];if(!o||o.motherId!==e.id)return null;const s=Vn(e.position,o.position),a=et(s),l=e.type==="prey"?ju:zu,u=Math.max(0,o.hunger/l);return a*u*.9},sM=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||o.hunger<Xu/2?N.Success:Vn(t.position,o.position)<30?(t.activeAction="feeding",N.Running):(t.activeAction="moving",t.target=o.id,N.Running)},aM={type:q.AnimalFeedChild,producer:oM,scorer:rM,executor:sM},lM=(e,t)=>{if(e.isAdult||e.hunger<Xu||!e.motherId)return{};const n=t.gameState.entities.entities[e.motherId];if(!n)return{};const o={},s=`animal-seek-food-${e.id}-${n.id}`;return o[s]={id:s,type:q.AnimalSeekFoodFromParent,position:n.position,creatorEntityId:e.id,target:n.id,validUntilTime:t.gameState.time+1},o},cM=(e,t,n)=>{if(e.isAdult||!e.motherId)return null;const o=n.gameState.entities.entities[e.motherId];if(!o)return null;const s=Vn(e.position,o.position),a=et(s),l=e.type==="prey"?ju:zu,u=Math.max(0,e.hunger/l);return a*u*.85},uM=(e,t,n)=>{const o=n.gameState.entities.entities[e.target];return!o||t.hunger<Xu/2?N.Success:(Vn(t.position,o.position)<30||(t.activeAction="moving",t.target=o.id),N.Running)},dM={type:q.AnimalSeekFoodFromParent,producer:lM,scorer:cM,executor:uM},fM=(e,t)=>{if(e.type!=="prey")return{};if(e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return{};const n={},o=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,l=o.search.prey.byRadius(e.position,Cs*5),u=[];for(const d of l)d.id!==e.id&&d.hitpoints>0&&d.isAdult&&u.push(d);if(u.length>=2){let d=0,h=0;for(const S of u)d+=S.position.x,h+=S.position.y;d/=u.length,h/=u.length;const p={x:d,y:h};if(K(e.position,p,s,a)>Cs*2){const S=`animal-herd-${e.id}`;n[S]={id:S,type:q.AnimalHerd,position:p,creatorEntityId:e.id,target:p,validUntilTime:t.gameState.time+1}}}return n},hM=(e,t,n)=>{if(e.type!=="prey"||e.hunger>90||e.hitpoints<e.maxHitpoints*.3||e.activeAction==="grazing"||e.activeAction==="procreating")return null;const o=t.target,{width:s,height:a}=n.gameState.mapDimensions,l=K(e.position,o,s,a);return l<=Cs*2?null:et(l)*.4},pM=(e,t,n)=>{if(t.type!=="prey")return N.Failure;const o=e.target,{width:s,height:a}=n.gameState.mapDimensions;if(K(t.position,o,s,a)<=Cs*2)return t.activeAction="idle",t.direction={x:0,y:0},N.Success;t.activeAction="moving",t.target=o;const u=xe(t.position,o,s,a);return t.direction=yt(u),N.Running},gM={type:q.AnimalHerd,producer:fM,scorer:hM,executor:pM},mM=(e,t)=>{if(e.type!=="predator")return{};const n=e.hunger>100,o=e.hitpoints<e.maxHitpoints*.5;if(!n&&!o)return{};if(e.attackCooldown&&e.attackCooldown>0)return{};const s={},l=t.gameState.search.human.byRadius(e.position,_r*2);let u=null,d=1/0;for(const h of l)if(h.hitpoints>0){const p=K(e.position,h.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);p<d&&(d=p,u=h)}if(u){const h=`animal-attack-human-${e.id}-${u.id}`;s[h]={id:h,type:q.AnimalAttack,position:u.position,creatorEntityId:e.id,target:u.id,validUntilTime:t.gameState.time+1}}return s},yM=(e,t,n)=>{if(e.type!=="predator")return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const a=K(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>_r*2.5?null:et(a)*.75},vM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return N.Success;const{width:a,height:l}=n.gameState.mapDimensions;if(K(t.position,s.position,a,l)<=_r)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},N.Running;{t.activeAction="moving",t.target=s.id;const d=xe(t.position,s.position,a,l);return t.direction=yt(d),N.Running}},SM={type:q.AnimalAttack,producer:mM,scorer:yM,executor:vM},TM=(e,t)=>{if(e.type!=="predator")return{};if(!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120||e.attackCooldown&&e.attackCooldown>0)return{};const n={},s=t.gameState.search.predator.byRadius(e.position,ST);let a=null,l=1/0;for(const u of s)if(u.id!==e.id&&u.hitpoints>0&&u.isAdult&&e.fatherId!==u.fatherId&&e.gender===u.gender&&e.fatherId!==void 0&&u.fatherId!==void 0){const d=K(e.position,u.position,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height);d<l&&(l=d,a=u)}if(a){const u=`animal-territorial-${e.id}-${a.id}`;n[u]={id:u,type:q.AnimalTerritorial,position:a.position,creatorEntityId:e.id,target:a.id,validUntilTime:t.gameState.time+1}}return n},IM=(e,t,n)=>{if(e.type!=="predator"||!e.isAdult||e.hitpoints<e.maxHitpoints*.6||e.hunger>120)return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const a=K(e.position,s.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height);return a>ST*1.2?null:et(a)*.7},AM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return N.Success;const{width:a,height:l}=n.gameState.mapDimensions;if(K(t.position,s.position,a,l)<=_r)return t.activeAction="attacking",t.attackTargetId=s.id,t.target=s.id,t.direction={x:0,y:0},N.Running;{t.activeAction="moving",t.target=s.id;const d=xe(t.position,s.position,a,l);return t.direction=yt(d),N.Running}},EM={type:q.AnimalTerritorial,producer:TM,scorer:IM,executor:AM},wM=(e,t)=>{if(e.type!=="predator")return{};if(e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return{};if(e.fatherId===void 0)return{};const n={},o=t.gameState,{width:s,height:a}=t.gameState.mapDimensions,l=o.search.predator.byRadius(e.position,Ps*4);let u=null;for(const d of l)d.id!==e.id&&d.hitpoints>0&&d.isAdult&&d.fatherId===e.fatherId&&(d.age>=e.age||d.hitpoints>e.hitpoints)&&(!u||d.age>u.age)&&(u=d);if(u&&K(e.position,u.position,s,a)>Ps*2){const h=`animal-pack-follow-${e.id}-${u.id}`;n[h]={id:h,type:q.AnimalPack,position:u.position,creatorEntityId:e.id,target:u.id,validUntilTime:t.gameState.time+1}}return n},CM=(e,t,n)=>{if(e.type!=="predator"||e.hunger>100||e.hitpoints<e.maxHitpoints*.4||e.activeAction==="attacking"||e.activeAction==="procreating")return null;const o=t.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return null;const{width:a,height:l}=n.gameState.mapDimensions,u=K(e.position,s.position,a,l);return u<=Ps*2?null:et(u)*.35},PM=(e,t,n)=>{if(t.type!=="predator")return N.Failure;const o=e.target,s=n.gameState.entities.entities[o];if(!s||s.hitpoints<=0)return N.Success;const{width:a,height:l}=n.gameState.mapDimensions;if(K(t.position,s.position,a,l)<=Ps*2)return t.activeAction="idle",t.direction={x:0,y:0},N.Success;t.activeAction="moving",t.target=s.id;const d=xe(t.position,s.position,a,l);return t.direction=yt(d),N.Running},_M={type:q.AnimalPack,producer:wM,scorer:CM,executor:PM},rn={};rn[q.HumanHuntPrey]={type:q.HumanHuntPrey,producer:Bk};rn[q.HumanHuntPredator]={type:q.HumanHuntPredator,producer:Hk};rn[q.AnimalFlee]=Uk;rn[q.AnimalGraze]=Yk;rn[q.AnimalHunt]=Vk;rn[q.AnimalAttack]=SM;rn[q.AnimalProcreate]=Qk;rn[q.AnimalWander]=iM;rn[q.AnimalFeedChild]=aM;rn[q.AnimalSeekFoodFromParent]=dM;rn[q.AnimalHerd]=gM;rn[q.AnimalTerritorial]=EM;rn[q.AnimalPack]=_M;function Vy(e,t){Tl(e,t,Object.values(rn))}function LT(e,t){let n=Au(e);if(n){const o=t.gameState.tasks[n];(!o||o.claimedByEntityId&&o.claimedByEntityId!==e.id)&&(Ki(e,null),n=null)}if(!n){const o=RM(e,t);if(o&&t.gameState.tasks[o]){const s=t.gameState.tasks[o];n=o,Ki(e,n),s&&(s.claimedByEntityId=e.id)}}if(n){const o=t.gameState.tasks[n];o?BT(e,o,t,rn):Ki(e,null)}}function RM(e,t){let n=null,o=-1/0;const s=t.gameState.search.tasks.byRadius(e.position,1e3);for(let a of s){if(!a||a.claimedByEntityId&&a.claimedByEntityId!==e.id)continue;const l=rn[a.type];if(!l||!l.scorer)continue;const u=l.scorer(e,a,t);u!==null&&u>o&&(o=u,n=a.id)}return o>0?n:null}function kM(e,t){LT(e,t)}function MM(e,t){LT(e,t)}const bM=(e,t)=>{if(e.buildingType!==X.PlantingZone||!e.isConstructed)return{};const{gameState:n}=t,o=KS(e);if(BP(e,n)>=o)return{};const a=n.search.tasks.byProperty("creatorEntityId",e.id).find(p=>p.type===q.HumanPlantBush);if(a)return{[a.id]:a};const l=n.mapDimensions.width,u=n.mapDimensions.height,d=n.soilDepletion,h=10;for(let p=0;p<h;p++){const m=e.position.x+(Math.random()-.5)*e.width,S=e.position.y+(Math.random()-.5)*e.height,y={x:(m%l+l)%l,y:(S%u+u)%u};if(!Er(d,y,l,u)&&!Qi(y,n,Ou)){const I=`plant-bush-${e.id}`,T={id:I,type:q.HumanPlantBush,position:y,creatorEntityId:e.id,target:y,validUntilTime:n.time+VR};return{[I]:T}}}return{}},DM=(e,t)=>{const n={};if(e.buildingType===X.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.length<e.storageCapacity){const o=`stockpile-${e.id}`;n[o]={id:o,type:q.HumanStockpile,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},OM=(e,t)=>{const n={};if(e.buildingType===X.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&e.maxFuelLevel!==void 0&&e.fuelLevel<e.maxFuelLevel*vC){const o=`fuel-bonfire-${e.id}`;n[o]={id:o,type:q.HumanFuelBonfire,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},NM=(e,t)=>{const n={};if(e.buildingType===X.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&(e.fuelLevel??0)>0)for(let o=0;o<AC;o++){const s=`seek-warmth-${e.id}-${o}`;n[s]={id:s,type:q.HumanSeekWarmth,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},BM=(e,t)=>{const n={};if(e.buildingType===X.StorageSpot&&e.isConstructed&&!e.isBeingDestroyed&&e.storedItems.some(o=>o.item.itemType==="food")){const o=`retrieve-from-${e.id}`;n[o]={id:o,type:q.HumanRetrieve,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n},HM={[q.HumanPlantBush]:{type:q.HumanPlantBush,producer:bM},[q.HumanStockpile]:{type:q.HumanStockpile,producer:DM},[q.HumanFuelBonfire]:{type:q.HumanFuelBonfire,producer:OM},[q.HumanSeekWarmth]:{type:q.HumanSeekWarmth,producer:NM},[q.HumanRetrieve]:{type:q.HumanRetrieve,producer:BM}};function UT(e,t){Tl(e,t,Object.values(HM))}function FM(e,t){const{gameState:n,deltaTime:o}=t,s=o*(Ot/Ut);if(e.isBeingDestroyed){const a=U1(e.buildingType);if(a>0?e.destructionProgress+=s/a:e.destructionProgress=1,e.destructionProgress>=1){if(e.buildingType===X.Palisade||e.buildingType===X.Gate){const u=e.buildingType===X.Gate?e.ownerId??null:null;ws(n,e.position,e.radius,!1,u,As)}const l=e.buildingType===X.PlantingZone;Ci(n.entities,e.id),l&&nl(n);return}}if(!e.isConstructed&&!e.isBeingDestroyed){const a=L1(e.buildingType);if(a>0?e.constructionProgress+=s/a:e.constructionProgress=1,e.constructionProgress>=1){if(e.constructionProgress=1,e.isConstructed=!0,e.ownerId&&hs(e.position,Ai,e.ownerId,n),e.buildingType===X.Palisade||e.buildingType===X.Gate){const l=e.buildingType===X.Gate?e.ownerId??null:null;ws(n,e.position,e.radius,!0,l,As)}e.buildingType===X.PlantingZone&&nl(n)}}if(e.buildingType===X.Bonfire&&e.isConstructed&&!e.isBeingDestroyed&&e.fuelLevel!==void 0&&(e.fuelLevel-=s*yC,e.fuelLevel<0&&(e.fuelLevel=0),e.fuelLevel<(e.maxFuelLevel||0)*TC)){const a=e.storedItems.findIndex(l=>l.item.itemType==="item"&&l.item.type===Gt.Wood);a!==-1&&(e.storedItems.splice(a,1),e.fuelLevel=Math.min(e.maxFuelLevel||0,e.fuelLevel+bS))}UT(e,t)}function xM(e,t){const n=t.deltaTime*Ot/Ut;if(e.age+=n,!e.stateMachine)return;const[o]=e.stateMachine,s=e.stateMachine[1];(o===Vt||o===wi)&&s.enteredAt>=t.gameState.time-n&&ws(t.gameState,e.position,e.radius,!1,null,As),o!==Vt&&o!==wi&&o!==Ar&&(e.age>=Uo&&!e.woodGenerated&&(e.wood=Array.from({length:Vu},()=>({itemType:"item",type:Gt.Wood,id:t.gameState.entities.nextEntityId++})),e.woodGenerated=!0),e.radius=wr*Math.min(1,Math.max(.4,e.age/Uo)))}const LM={type:q.HumanGatherBerries,producer:(e,t)=>{const n={};if(e.type!=="berryBush")return n;if(e.food.length>0){const o=`gather-berries-${e.id}`;n[o]={id:o,type:q.HumanGatherBerries,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},UM={type:q.HumanChopTree,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[o]=e.stateMachine??[];if(o===ri||o===zn||o===Ei){const a=`chop-tree-${e.id}`;n[a]={id:a,type:q.HumanChopTree,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},GM={type:q.HumanGatherWood,producer:(e,t)=>{const n={};if(e.type!=="tree")return n;const[o]=e.stateMachine??[];if(o===Vt&&e.wood.length>0){const a=`gather-wood-${e.id}`;n[a]={id:a,type:q.HumanGatherWood,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},$M=[LM,UM,GM].reduce((e,t)=>(e[t.type]=t,e),{});function qy(e,t){Tl(e,t,Object.values($M))}const WM={type:q.HumanGatherMeat,producer:(e,t)=>{const n={};if(e.food.length>0){const o=`gather-meat-${e.id}`;n[o]={id:o,type:q.HumanGatherMeat,position:e.position,creatorEntityId:e.id,target:e.id,validUntilTime:t.gameState.time+Bt}}return n}},YM=[WM].reduce((e,t)=>(e[t.type]=t,e),{});function jM(e,t){Tl(e,t,Object.values(YM))}var iu=(e=>(e[e.Physics=0]="Physics",e[e.PrepareAI=1]="PrepareAI",e[e.ExecuteAI=2]="ExecuteAI",e))(iu||{});function hh(e,t,n){switch(n){case 0:zM(e,t);break;case 1:XM(e,t);break;case 2:VM(e,t);break}}function zM(e,t){e.forces.push(ct(e.velocity,-.1));const n=ct(yt(e.direction),e.acceleration);e.forces.push(n),e.debuffs.forEach(o=>{t.gameState.time-o.startTime<o.duration&&o.type==="slow"&&(e.velocity=ct(e.velocity,.5))}),e.debuffs=e.debuffs.filter(o=>t.gameState.time-o.startTime<o.duration),e.velocity=Xn(e.velocity,e.forces.reduce(Xn,{x:0,y:0})),Bo(e.velocity)<.001&&(e.velocity={x:0,y:0}),e.position=Xn(e.position,ct(e.velocity,t.deltaTime)),e.position.x=(e.position.x%t.gameState.mapDimensions.width+t.gameState.mapDimensions.width)%t.gameState.mapDimensions.width,e.position.y=(e.position.y%t.gameState.mapDimensions.height+t.gameState.mapDimensions.height)%t.gameState.mapDimensions.height,e.forces=[],e.type==="human"&&Bo(e.velocity)>.1&&xP(t.gameState.soilDepletion,e.position,e.id,t.gameState.time,t.gameState.mapDimensions.width,t.gameState.mapDimensions.height,t.gameState),e.type==="human"?WR(e,t,t.deltaTime):e.type==="corpse"?YR(e,t):e.type==="prey"?jR(e,t,t.deltaTime):e.type==="predator"?zR(e,t,t.deltaTime):e.type==="building"?FM(e,t):e.type==="tree"?xM(e,t):e.type,e.stateMachine&&(e.stateMachine=UR(...e.stateMachine,{entity:e,updateContext:t}))}function XM(e,t){GT(e,t)&&(e.type==="human"?bk(e,t):e.type==="corpse"?jM(e,t):e.type==="prey"||e.type==="predator"?Vy(e,t):e.type==="building"?UT(e,t):(e.type==="tree"||e.type==="berryBush")&&qy(e,t))}function VM(e,t){GT(e,t)&&(e.type==="human"?Nk(e,t):e.type==="corpse"||(e.type==="prey"?kM(e,t):e.type==="predator"?MM(e,t):e.type==="building"||e.type==="tree"||e.type),Oe.set(e.aiBlackboard,"lastAiUpdateTime",t.gameState.time))}function GT(e,t){const n=Oe.get(e.aiBlackboard,"lastAiUpdateTime")??0;return t.gameState.time-n+(Math.random()-Math.random())*py/10>py}function $T(e){const t=e.gameState.entities.entities;for(const n in t)hh(t[n],e,iu.Physics);for(const n in t)hh(t[n],e,iu.PrepareAI);N1(e.gameState);for(const n in t)hh(t[n],e,iu.ExecuteAI)}function WT(){return{entities:{},nextEntityId:1}}function Rr(e,t,n){const o={id:e.nextEntityId++,type:t,velocity:{x:0,y:0},direction:{x:0,y:0},acceleration:0,forces:[],debuffs:[],stateMachine:[],aiBlackboard:Oe.create(),...n};return e.entities[o.id]=o,o}function Al(e,t,n){return Rr(e,"berryBush",{position:t,radius:Hh,food:Array.from({length:tw},()=>({itemType:"food",type:ui.Berry})).map(s=>({...s,id:e.nextEntityId++})),maxFood:ew,lifespan:iw,age:0,spreadRadius:Hh,timeSinceLastBerryRegen:0,timeSinceLastSpreadAttempt:0,timeSinceLastHarvest:0,aiBlackboard:Oe.create(),stateMachine:[ja,{enteredAt:n,previousState:void 0}]})}function _s(e,t,n,o=0){const s=o>=Uo;return Rr(e,"tree",{position:t,radius:wr,age:o,lifespan:AR,swayOffset:Math.random()*Math.PI*2,variant:Math.floor(Math.random()*3),timeSinceLastSpreadAttempt:0,spreadRadius:bR,stateMachine:[ri,{enteredAt:n,previousState:void 0}],aiBlackboard:Oe.create(),wood:s?Array.from({length:Vu},()=>({itemType:"item",type:Gt.Wood,id:e.nextEntityId++})):[],woodGenerated:s})}function cr(e,t,n,o,s=!1,a=Tw,l=TS,u,d,h=[],p,m,S=Go.TaskBased){const y=a>=fp;return Rr(e,"human",{position:t,radius:y?ut:Ds,hunger:l,hitpoints:fy,maxHitpoints:fy,age:a,gender:o,isPlayer:s,food:[],maxFood:yS,maxAge:sl,isAdult:y,isPregnant:!1,gestationTime:0,procreationCooldown:0,attackCooldown:{melee:0,ranged:0},motherId:u,fatherId:d,ancestorIds:h,stateMachine:[ht,{enteredAt:n,previousState:void 0}],leaderId:p,tribeInfo:m,aiType:S,aiBlackboard:Oe.create()})}function xp(e,t,n,o,s,a,l,u,d,h,p){let m,S;switch(l){case"human":m=AS,S=jn;break;case"prey":m=2,S=120;break;case"predator":m=4,S=140;break}return Rr(e,"corpse",{position:t,radius:s,gender:n,age:o,originalEntityId:a,originalEntityType:l,timeOfDeath:u,decayProgress:0,geneCode:p,food:[...Array.from({length:Math.max(m*Math.max(S-h,0)/S,0)},()=>({itemType:"food",type:ui.Meat})),...d].map(I=>({...I,id:e.nextEntityId++})),stateMachine:void 0,aiBlackboard:Oe.create()})}function qM(e,t,n,o,s,a,l,u,d){return xp(e,t,n,o,s,a,"human",l,u,d)}function ZM(e,t,n,o,s,a,l,u){return xp(e,t,n,o,s,a,"prey",l,[],0,u)}function KM(e,t,n,o,s,a,l,u){return xp(e,t,n,o,s,a,"predator",l,[],0,u)}function QM(e,t,n){const o=t?n.gameState.entities.entities[t]:void 0,s=[...e.ancestorIds||[],e.id],a=o?[...o.ancestorIds||[],o.id]:[],l=[...s,...a],u=[...new Set(l)],d=u.slice(Math.max(u.length-gS,0)),h=Math.random()<.5?"male":"female",p=Xn(e.position,{x:5,y:5}),m=cr(n.gameState.entities,p,n.gameState.time,h,!1,0,TS/2,e.id,t,d,(o==null?void 0:o.leaderId)??e.leaderId,(o==null?void 0:o.tribeInfo)??e.tribeInfo,e.aiType);return ke(n,Pe.Birth,e.position),m}function Ci(e,t){return e.entities[t]?(delete e.entities[t],!0):!1}function Rs(e,t,n,o=V_,s=gT,a,l,u,d=Go.TaskBased){const h=o>=mT,p=Date.now();return Rr(e,"prey",{position:t,radius:h?ut*.7:Ds*.7,hunger:s,hitpoints:Wy,maxHitpoints:Wy,age:o,maxAge:pT,gender:n,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:u,stateMachine:[oi,{enteredAt:p,previousState:void 0}],aiType:d,aiBlackboard:Oe.create()})}function ks(e,t,n,o=tR,s=vT,a,l,u,d=Go.TaskBased){const h=o>=AT,p=Date.now();return Rr(e,"predator",{position:t,radius:h?ut*.9:Ds*.9,hunger:s,hitpoints:Yy,maxHitpoints:Yy,age:o,maxAge:yT,gender:n,isAdult:h,isPregnant:!1,gestationTime:0,procreationCooldown:0,geneCode:a,motherId:l,fatherId:u,stateMachine:[hn,{enteredAt:p,previousState:void 0}],aiType:d,aiBlackboard:Oe.create()})}function YT(e,t,n,o){const s=Jh(n),a={position:t,radius:Math.max(s.width,s.height)/2,buildingType:n,ownerId:o,width:s.width,height:s.height,constructionProgress:0,destructionProgress:0,isConstructed:!1,isBeingDestroyed:!1,storedItems:[],storageCapacity:p_,lastDepositTime:0,lastRetrieveTime:0,lastStealTime:0,fuelLevel:n===X.Bonfire?Uh:void 0,maxFuelLevel:n===X.Bonfire?Uh:void 0,aiBlackboard:Oe.create(),stateMachine:["",{enteredAt:0}]};return Rr(e,"building",a)}var fn=(e=>(e.MOVE="MOVE",e.HUNGER="HUNGER",e.EAT="EAT",e.FIND_BUSH="FIND_BUSH",e.GATHER="GATHER",e.PROCREATE="PROCREATE",e.PLANT_BUSH="PLANT_BUSH",e.AUTOPILOT="AUTOPILOT",e.ANIMALS_INTRODUCTION="ANIMALS_INTRODUCTION",e.HUNT_PREY="HUNT_PREY",e.DEFEND_FROM_PREDATORS="DEFEND_FROM_PREDATORS",e))(fn||{}),yr=(e=>(e.HUNGER_BAR="HUNGER_BAR",e.FOOD_BAR="FOOD_BAR",e.COMMAND_BUTTONS="COMMAND_BUTTONS",e))(yr||{}),tn=(e=>(e[e.FADING_IN=0]="FADING_IN",e[e.ACTIVE=1]="ACTIVE",e[e.FADING_OUT=2]="FADING_OUT",e[e.INACTIVE=3]="INACTIVE",e))(tn||{});const zh={},Xh={},JM=[{key:fn.MOVE,title:"Movement",text:"Use WASD or Arrow Keys to move your character around the world.",condition:e=>e.hasPlayerMovedEver||e.hasPlayerEnabledAutopilot>2,isCompleted:!1},{key:fn.HUNGER,title:"Hunger",text:"Your character gets hungry over time. Watch the hunger bar!",condition:(e,t)=>t.hunger>yw,isCompleted:!1,minDisplayTime:Py,highlightedUIElements:[yr.HUNGER_BAR]},{key:fn.FIND_BUSH,title:"Find Food",text:"Look for berry bushes. They are your primary source of food.",condition:(e,t)=>!!Ke(t,e,"berryBush",Qe*5,o=>o.food.length>0),getTargets:(e,t)=>{const n=[];for(const o of Object.values(e.entities.entities))o.type==="berryBush"&&o.food.length>0&&K(t.position,o.position,e.mapDimensions.width,e.mapDimensions.height)<500&&n.push(o);return n.map(o=>o.id)},isCompleted:!1,minDisplayTime:Py},{key:fn.GATHER,title:"Gather Berries",text:"Get close to a bush and press 'E' to gather berries.",condition:(e,t)=>t.food.length>0,getTargets:(e,t)=>{const n=Ke(t,e,"berryBush",Qe,o=>o.food.length>0);return n?[n.id]:[]},isCompleted:!1},{key:fn.EAT,title:"Eat",text:"When you are hungry and have food, press 'F' to eat.",condition:(e,t)=>t.activeAction==="eating",isCompleted:!1,highlightedUIElements:[yr.FOOD_BAR]},{key:fn.PROCREATE,title:"Procreate",text:"Find a mate and press 'R' to start a family. This is how you continue your lineage.",condition:(e,t)=>Ji(e,t).length>0,getTargets:(e,t)=>{const n=Ke(t,e,"human",Qe,o=>bs(t,o,e));return n?[n.id]:[]},isCompleted:!1},{key:fn.PLANT_BUSH,title:"Farming",text:"You can plant new berry bushes. Carry some berries and press 'B' to plant.",condition:(e,t)=>Dp(e,t).some(o=>o.type===Se.Plant)||e.hasPlayerPlantedBush===!0,isCompleted:!1},{key:fn.AUTOPILOT,title:"Autopilot!",text:"You can turn autopilot for specific actions, press Shift and click on the action button to enable it.",condition:e=>e.hasPlayerEnabledAutopilot>2,highlightedUIElements:[yr.COMMAND_BUTTONS],isCompleted:!1},{key:fn.ANIMALS_INTRODUCTION,title:"Wild Animals!",text:"Your world now has wild animals! Prey provide meat when hunted, but beware of predators that may attack.",condition:e=>Object.values(e.entities.entities).some(n=>n.type==="prey"||n.type==="predator"),isCompleted:!1,dependsOn:fn.AUTOPILOT},{key:fn.HUNT_PREY,title:"Hunt for Meat",text:"Click on prey animals to hunt them for meat. Hunting provides more food than gathering berries!",condition:(e,t)=>{const n=Ke(t,e,"prey",150);return t.hunger>40&&!!n},getTargets:(e,t)=>{const n=Ke(t,e,"prey",150);return n?[n.id]:[]},isCompleted:!1,dependsOn:fn.ANIMALS_INTRODUCTION},{key:fn.DEFEND_FROM_PREDATORS,title:"Predators",text:"Predators may attack when hungry! Click on them to fight back. Fighting together with family is more effective.",condition:(e,t)=>!!Ke(t,e,"predator",120),getTargets:(e,t)=>{const n=Ke(t,e,"predator",120);return n?[n.id]:[]},isCompleted:!1,dependsOn:fn.HUNT_PREY}].map(e=>({...e,condition:e.condition?nb(e.condition):void 0,getTargets:e.getTargets?ib(e.getTargets):void 0}));function jT(){return{steps:JM.map(e=>({...e,isCompleted:!1}))}}function zT(){return{currentStepIndex:0,completedSteps:[],isActive:!0,transitionState:tn.FADING_IN,transitionAlpha:0,highlightedEntityIds:[],stepStartTime:null,activeUIHighlights:[]}}function eb(e){for(let t=0;t<e.tutorial.steps.length;t++){const n=e.tutorial.steps[t];if(!n.isCompleted)if(n.dependsOn){if(e.tutorialState.completedSteps.includes(n.dependsOn))return t}else return t}return null}function tb(e,t){const n=e.tutorialState;if(!n.isActive){n.transitionState=tn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const o=Nt(e);if(!o){n.isActive=!1,n.transitionState=tn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const s=e.tutorial.steps[n.currentStepIndex];if(!s){n.isActive=!1,n.transitionState=tn.INACTIVE,n.highlightedEntityIds=[],n.activeUIHighlights=[];return}const a=1/rP;switch(n.transitionState){case tn.FADING_IN:n.stepStartTime===null&&(n.stepStartTime=e.time),n.transitionAlpha+=a*t,n.transitionAlpha>=1&&(n.transitionAlpha=1,n.transitionState=tn.ACTIVE);break;case tn.ACTIVE:{const d=e.time-(n.stepStartTime||e.time)>=(s.minDisplayTime||0),h=zh[s.condition];h&&d&&h(e,o)&&(s.isCompleted=!0,n.completedSteps.includes(s.key)||n.completedSteps.push(s.key),n.transitionState=tn.FADING_OUT);break}case tn.FADING_OUT:if(n.transitionAlpha-=a*t,n.transitionAlpha<=0){n.transitionAlpha=0,n.stepStartTime=null;const u=eb(e);u!==null?(n.currentStepIndex=u,n.transitionState=tn.FADING_IN):(n.isActive=!1,n.transitionState=tn.INACTIVE)}break}if(n.transitionState!==tn.FADING_OUT&&n.transitionState!==tn.INACTIVE){const u=Xh[s.getTargets||""];u?n.highlightedEntityIds=[...u(e,o)]:n.highlightedEntityIds=[],s.highlightedUIElements?n.activeUIHighlights=[...s.highlightedUIElements]:n.activeUIHighlights=[]}else n.highlightedEntityIds=[],n.activeUIHighlights=[]}function nb(e){const t=`condition_${Object.keys(zh).length+1}`;return zh[t]=e,t}function ib(e){const t=`getTargets_${Object.keys(Xh).length+1}`;return Xh[t]=e,t}function ob(){const e=WT(),t=0;for(let S=0;S<aS;S++){const y={x:Math.random()*We,y:Math.random()*Ye};Al(e,y,t)}for(let S=0;S<sS;S++){const y={x:Math.random()*We,y:Math.random()*Ye};_s(e,y,t)}const n=We/2,o=Ye/2;for(let S=0;S<5;S++){const y=S/5*Math.PI*2,I=100+Math.random()*100,T={x:n+Math.cos(y)*I,y:o+Math.sin(y)*I};_s(e,T,t,Uo)}const s=cr(e,{x:n-25,y:o},t,"male",!0),a=cr(e,{x:n+25,y:o},t,"female",!1);a.leaderId=s.id,a.tribeInfo={tribeBadge:"",tribeColor:Xt[0]},s.aiType=Go.TaskBased,a.aiType=Go.TaskBased;for(let S=0;S<5;S++){const y=S/5*Math.PI*2,I=We/2,T=Ye/2,E={x:n+Math.cos(y)*I,y:o+Math.sin(y)*T},P=cr(e,{x:E.x,y:E.y},t,"male",!1);P.leaderId=P.id,P.tribeInfo={tribeBadge:gu[S%gu.length],tribeColor:Xt[S%Xt.length]};const C=cr(e,{x:E.x+50,y:E.y},t,"female",!1);C.leaderId=P.id,C.tribeInfo=P.tribeInfo}for(let S=0;S<ET;S++){const y={x:n+We*(Math.random()-Math.random()),y:o+Ye*(Math.random()-Math.random())};Rs(e,y,"male",void 0,void 0,ul()),Rs(e,{x:y.x+20,y:y.y},"female",void 0,void 0,ul())}const l={x:n+We*(Math.random()-Math.random()),y:o+Ye*(Math.random()-Math.random())};ks(e,l,"male",void 0,void 0,dl()),ks(e,{x:l.x+20,y:l.y},"female",void 0,void 0,dl());const u=[{id:"muteButton",action:Te.ToggleMute,currentWidth:Yi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Dt},{id:"pauseButton",action:Te.TogglePause,currentWidth:Yi,rect:{x:0,y:0,width:0,height:0},text:"",backgroundColor:"",textColor:Dt},{id:"returnToIntroButton",action:Te.ReturnToIntro,currentWidth:Yi,rect:{x:0,y:0,width:0,height:0},text:"EXIT",backgroundColor:"",textColor:Dt}],d=jT(),h=zT(),p={time:t,entities:e,mapDimensions:{width:We,height:Ye},generationCount:1,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{...s.position},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:oT,isMuted:!1,uiButtons:u,tutorial:d,tutorialState:h,debugPanel:qe.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[{id:"welcome",type:Sr.Hello,message:"Welcome to the game!",duration:50,targetEntityIds:[s.id],highlightedEntityIds:[s.id],timestamp:0,isDismissed:!1,creationTime:Date.now()}],ecosystem:{preyGestationPeriod:fr,preyProcreationCooldown:hr,predatorGestationPeriod:pr,predatorProcreationCooldown:gr,preyHungerIncreasePerHour:bo,predatorHungerIncreasePerHour:Do,berryBushSpreadChance:qi,treeSpreadChance:Zi},soilDepletion:up(),temperature:bT(We,Ye),autosaveIntervalSeconds:5,lastAutosaveTime:Date.now(),plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(We/_e)*Math.ceil(Ye/_e)).fill(null),navigationGrid:Yu(We,Ye),pathfindingQueue:[],tasks:{}};Object.values(p.entities.entities).forEach(S=>{S.type==="tree"&&ws(p,S.position,S.radius,!0,null,As)});const m=pl(p);return console.log("Game world initialized:",m),m}function rb(){const e=WT(),t=0;for(let d=0;d<aS;d++){const h={x:Math.random()*We,y:Math.random()*Ye};Al(e,h,t)}for(let d=0;d<sS;d++){const h={x:Math.random()*We,y:Math.random()*Ye};_s(e,h,t)}const n=We/2,o=Ye/2;for(let d=0;d<5;d++){const h=d/5*Math.PI*2,p=100+Math.random()*100,m={x:n+Math.cos(h)*p,y:o+Math.sin(h)*p};_s(e,m,t,Uo)}for(let d=0;d<KE;d++){const h={x:Math.random()*We,y:Math.random()*Ye},p=Math.random()<.5?"male":"female";cr(e,h,t,p,!1)}for(let d=0;d<ET;d++){const h={x:Math.random()*We,y:Math.random()*Ye};Rs(e,h,"male",void 0,void 0,ul()),Rs(e,{x:h.x+20,y:h.y},"female",void 0,void 0,ul())}const s={x:Math.random()*We,y:Math.random()*Ye};ks(e,s,"male",void 0,void 0,dl()),ks(e,{x:s.x+20,y:s.y},"female",void 0,void 0,dl());const a=jT(),l=zT(),u={time:t,entities:e,mapDimensions:{width:We,height:Ye},generationCount:0,gameOver:!1,visualEffects:[],nextVisualEffectId:0,scheduledEvents:[],nextScheduledEventId:1,viewportCenter:{x:We/2,y:Ye/2},isPaused:!1,exitConfirmation:"inactive",autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!0,build:!1,chopping:!1},hoveredAutopilotAction:void 0,activeAutopilotAction:void 0,isManuallyMoving:!1},buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!0,cameraZoom:1,hoveredMinimapTribeId:null,minimapRect:{x:0,y:0,width:0,height:0},isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,masterVolume:oT,isMuted:!0,uiButtons:[],tutorial:a,tutorialState:l,debugPanel:qe.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},hoveredButtonId:void 0,mousePosition:{x:0,y:0},notifications:[],ecosystem:{preyGestationPeriod:fr,preyProcreationCooldown:hr,predatorGestationPeriod:pr,predatorProcreationCooldown:gr,preyHungerIncreasePerHour:bo,predatorHungerIncreasePerHour:Do,berryBushSpreadChance:qi,treeSpreadChance:Zi},soilDepletion:up(),temperature:bT(We,Ye),lastAutosaveTime:0,plantingZoneConnections:{},terrainOwnership:new Array(Math.ceil(We/_e)*Math.ceil(Ye/_e)).fill(null),navigationGrid:Yu(We,Ye),pathfindingQueue:[],tasks:{}};return Object.values(u.entities.entities).forEach(d=>{d.type==="tree"&&ws(u,d.position,d.radius,!0,null,As)}),pl(u)}const sb="humanProcreation",ab="human",lb="human",cb=Qe,ub=(e,t,n)=>bs(e,t,n.gameState)?e.gender==="male"?e.activeAction==="procreating":e.activeAction==="procreating"&&t.activeAction==="procreating":!1,db=(e,t,n)=>{const{gameState:o}=n,s={x:(e.position.x+t.position.x)/2,y:(e.position.y+t.position.y)/2},a=e.gender==="male"?e:t,l=e.gender==="female"?e:t,u=(a.partnerIds||[]).length===0;if(e.stateMachine[0]!==lr&&(e.stateMachine=[lr,{partnerId:t.id,previousState:e.stateMachine[0],procreationEndTime:n.gameState.time+1}]),t.stateMachine[0]!==lr&&(t.stateMachine=[lr,{partnerId:e.id,previousState:t.stateMachine[0],procreationEndTime:n.gameState.time+1}]),e.partnerIds||(e.partnerIds=[]),e.partnerIds.includes(t.id)||e.partnerIds.push(t.id),t.partnerIds||(t.partnerIds=[]),t.partnerIds.includes(e.id)||t.partnerIds.push(e.id),u&&a.leaderId&&a.leaderId!==a.id){const d=o.entities.entities[a.leaderId];if(d){const h=Wh(a,d),p=Wh(l,d);if(!h&&!p){const m=yu();a.leaderId=a.id,a.tribeInfo={tribeBadge:m,tribeColor:Xt[Math.floor(Math.random()*Xt.length)]},a.tribeControl={diplomacy:{}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}}}else if(!e.leaderId&&!t.leaderId&&a&&l){const d=yu();a.leaderId=a.id,a.tribeInfo={tribeBadge:d,tribeColor:Xt[Math.floor(Math.random()*Xt.length)]},a.tribeControl={diplomacy:{}},l.leaderId=a.id,l.tribeInfo=a.tribeInfo}e.activeAction=void 0,Fe(o,Ce.Procreation,s,ll),Fe(o,Ce.Partnered,e.position,Xe,e.id),Fe(o,Ce.Partnered,t.position,Xe,t.id),e.lastPartneredEffectTime=o.time,t.lastPartneredEffectTime=o.time,t.activeAction=void 0,ke(n,Pe.Procreate,s)},fb={id:sb,sourceType:ab,targetType:lb,maxDistance:cb,checker:ub,perform:db},hb={id:"humanChildFeeding",sourceType:"human",targetType:"human",maxDistance:IS,checker:(e,t)=>e.isAdult===!0&&e.food.length>0&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Ho&&e.activeAction==="feeding",perform:(e,t,n)=>{e.food.pop(),t.hunger=Math.max(0,t.hunger-Ho),e.feedChildCooldownTime=Pw,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Fe(n.gameState,Ce.ChildFed,t.position,Xe,t.id),t.lastChildFedEffectTime=n.gameState.time),ke(n,Pe.ChildFed,t.position)}},pb={id:"human-attack",sourceType:"human",targetType:"human",maxDistance:An,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==Lo||e.attackTargetId!==t.id)return!1;const o=K(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=Fo,a=!s&&o<=An;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const u=s?Hu:mp,d=e.stateMachine[1];return n.gameState.time-d.attackStartTime>=u},perform:(e,t,n)=>{const{gameState:o}=n,s=K(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>Fo,l=xe(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),u=D1(yt(l),t.direction);if(Math.abs(u)<xw*Math.PI/180&&Math.random()<Lw)Fe(o,Ce.AttackDeflected,t.position,Xe,t.id);else{let p=a?gp:pp;if(e.gender==="male"&&(p*=Bw),e.isAdult||(p*=Hw),(!t.isAdult||t.age>=hp)&&e.isAdult&&(p*=Fw),a){const S=s/yp;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+S,data:{attackerId:e.id,targetId:t.id,damage:p,pushbackForce:Sp,attackerPosition:{...e.position}}}),Fe(o,Ce.StoneProjectile,e.position,S,void 0,t.position,t.id),ke(n,Pe.Attack,e.position)}else{t.hitpoints-=p,t.movementSlowdown={modifier:Fu,endTime:o.time+xu},Fe(o,Ce.Hit,t.position,Xe,t.id);const S=xe(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),y=ct(S,bw);t.forces.push(y),t.hitpoints<=0?ke(n,Pe.HumanDeath,t.position):ke(n,Pe.Attack,e.position),Fe(o,Ce.Attack,e.position,Xe,e.id)}}e.attackCooldown={melee:ml,ranged:vp};const h=e.stateMachine[1];h.attackStartTime=o.time}},gb={id:"human-collision",sourceType:"human",targetType:"human",maxDistance:ut*2,checker:(e,t,{gameState:n})=>K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<(e.radius+t.radius)/3,perform:(e,t,{gameState:n})=>{const o=K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(o===0){e.forces.push({x:.1,y:0}),t.forces.push({x:-.1,y:0});return}const a=(e.radius+t.radius-o)*.05,l=yt(Qh(e.position,t.position)),u=ct(l,a);e.forces.push(u),t.forces.push(ct(u,-1))}},mb={id:"human-tree-collision",sourceType:"human",targetType:"tree",maxDistance:ut*.6+wr*.4,checker:(e,t,{gameState:n})=>{const o=t.stateMachine[0];if(o==="fallen"||o==="stump")return!1;const s=t.radius*.25,a=e.radius*.4;return K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<a+s},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+o-a;if(l<=0)return;const u=l*2.5,d=yt(xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ct(d,u);e.forces.push(h)}},yb={id:"prey-tree-collision",sourceType:"prey",targetType:"tree",maxDistance:ut*.6+wr*.4,checker:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4;return K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+o},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+o-a;if(l<=0)return;const u=l*2.5,d=yt(xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ct(d,u);e.forces.push(h)}},vb={id:"predator-tree-collision",sourceType:"predator",targetType:"tree",maxDistance:ut*.6+wr*.4,checker:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4;return K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<s+o},perform:(e,t,{gameState:n})=>{const o=t.radius*.25,s=e.radius*.4,a=K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=s+o-a;if(l<=0)return;const u=l*2.5,d=yt(xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ct(d,u);e.forces.push(h)}},Sb={id:"human-building-collision",sourceType:"human",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==X.Palisade&&t.buildingType!==X.Gate||!t.isConstructed||t.buildingType===X.Gate&&e.leaderId===t.ownerId)return!1;const o=e.radius*.25,s=t.radius;return K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.25,s=t.radius,a=K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=o+s-a;if(l<=0)return;const u=l*2.5,d=yt(xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ct(d,u);e.forces.push(h)}},Tb={id:"prey-building-collision",sourceType:"prey",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==X.Palisade&&t.buildingType!==X.Gate||!t.isConstructed)return!1;const o=e.radius*.4,s=t.radius;return K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.4,s=t.radius,a=K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=o+s-a;if(l<=0)return;const u=l*2.5,d=yt(xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ct(d,u);e.forces.push(h)}},Ib={id:"predator-building-collision",sourceType:"predator",targetType:"building",maxDistance:50,checker:(e,t,{gameState:n})=>{if(t.buildingType!==X.Palisade&&t.buildingType!==X.Gate||!t.isConstructed)return!1;const o=e.radius*.4,s=t.radius;return K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height)<o+s},perform:(e,t,{gameState:n})=>{const o=e.radius*.4,s=t.radius,a=K(e.position,t.position,n.mapDimensions.width,n.mapDimensions.height);if(a===0){e.forces.push({x:1,y:0});return}const l=o+s-a;if(l<=0)return;const u=l*2.5,d=yt(xe(t.position,e.position,n.mapDimensions.width,n.mapDimensions.height)),h=ct(d,u);e.forces.push(h)}},Ab={id:"humanBerryBushGather",sourceType:"human",targetType:"berryBush",maxDistance:Qe,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Os&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=n.gameState.time+1,t.timeSinceLastHarvest=n.gameState.time,Fe(n.gameState,Ce.BushClaimed,t.position,Xe),ke(n,Pe.Gather,e.position)}},Eb={id:"corpseGather",sourceType:"human",targetType:"corpse",maxDistance:Qe,checker:(e,t,n)=>e.isAdult&&t.food.length>0&&e.stateMachine[0]===Os&&e.food.length<e.maxFood&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.food.pop();o&&e.food.push(o),e.gatheringCooldownTime=n.gameState.time+1,ke(n,Pe.Gather,e.position)}},wb={id:"humanGatherWood",sourceType:"human",targetType:"tree",maxDistance:Qe,checker:(e,t,n)=>e.isAdult&&t.stateMachine[0]===Vt&&t.wood.length>0&&e.stateMachine[0]===Os&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1,perform:(e,t,n)=>{const o=t.wood.pop();o&&(e.heldItem=o),e.gatheringCooldownTime=n.gameState.time+1,t.wood.length===0&&(t.stateMachine=[wi,{enteredAt:n.gameState.time,previousState:Vt}]),ke(n,Pe.Gather,e.position)}},Cb=[Ab,Eb,wb],Pb={id:"prey-eat-berry-bush",sourceType:"prey",targetType:"berryBush",maxDistance:Cs,checker:(e,t,n)=>!!(e.isAdult&&t.food.length>0&&e.hunger>30&&(!e.eatingCooldownTime||e.eatingCooldownTime<n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-25),t.lifespan-=K_,t.timeSinceLastHarvest=n.gameState.time,e.eatingCooldownTime=n.gameState.time+Z_,Fe(n.gameState,Ce.BushClaimed,t.position,Xe,e.id),ke(n,Pe.Gather,e.position))}},_b={id:"predator-hunt-prey",sourceType:"predator",targetType:"prey",maxDistance:nR,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>50&&(!e.huntCooldown||e.huntCooldown<=0)&&t.hitpoints>0),perform:(e,t,n)=>{t.hitpoints-=iR;const o=xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=ct(o,8);t.forces.push(s),e.huntCooldown=sR,t.hitpoints<=0?(ke(n,Pe.HumanDeath,t.position),Fe(n.gameState,Ce.Hit,t.position,Xe,t.id)):(Fe(n.gameState,Ce.Hit,t.position,Xe,t.id),t.fleeCooldown=5,ke(n,Pe.Attack,e.position)),Fe(n.gameState,Ce.Attack,e.position,Xe,e.id)}},Rb={id:"human-hunt-prey",sourceType:"human",targetType:"prey",maxDistance:An,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==Lo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=K(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=Fo,a=!s&&o<=An;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const u=s?Hu:mp,d=e.stateMachine[1];return n.gameState.time-d.attackStartTime>=u},perform:(e,t,n)=>{const{gameState:o}=n,s=K(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>Fo;let l=(a?gp:pp)*1.2;if(e.gender==="male"&&(l*=1.3),a){const d=s/yp;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+d,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Sp,attackerPosition:{...e.position}}}),Fe(o,Ce.StoneProjectile,e.position,d,void 0,t.position,t.id),ke(n,Pe.Attack,e.position)}else{t.hitpoints-=l;const d=xe(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),h=ct(d,6);t.forces.push(h),t.hitpoints<=0?(ke(n,Pe.HumanDeath,t.position),Fe(o,Ce.Hit,t.position,Xe,t.id)):(Fe(o,Ce.Hit,t.position,Xe,t.id),t.fleeCooldown=8,ke(n,Pe.Attack,e.position)),Fe(o,Ce.Attack,e.position,Xe,e.id)}e.attackCooldown={melee:ml,ranged:vp};const u=e.stateMachine[1];u.attackStartTime=o.time}},kb={id:"predator-attack-human",sourceType:"predator",targetType:"human",maxDistance:_r,checker:(e,t,n)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=n.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,n)=>{let o=TT;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:Fu,endTime:n.gameState.time+xu};const s=xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=ct(s,7);t.forces.push(a),e.attackCooldown=IT,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Bp),ke(n,Pe.HumanDeath,t.position),Fe(n.gameState,Ce.Hit,t.position,Xe,t.id)):(Fe(n.gameState,Ce.Hit,t.position,Xe,t.id),ke(n,Pe.Attack,e.position)),Fe(n.gameState,Ce.Attack,e.position,Xe,e.id)}},Mb={id:"human-attack-predator",sourceType:"human",targetType:"predator",maxDistance:An,checker:(e,t,n)=>{var p,m;if(e.stateMachine[0]!==Lo||e.attackTargetId!==t.id||t.hitpoints<=0||!e.isAdult)return!1;const o=K(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),s=o<=Fo,a=!s&&o<=An;if(!s&&!a||(s?((p=e.attackCooldown)==null?void 0:p.melee)||0:((m=e.attackCooldown)==null?void 0:m.ranged)||0)>0)return!1;const u=s?Hu:mp,d=e.stateMachine[1];return n.gameState.time-d.attackStartTime>=u},perform:(e,t,n)=>{const{gameState:o}=n,s=K(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),a=s>Fo;let l=(a?gp:pp)*.8;e.gender==="male"&&(l*=1.2);const u=Object.values(o.entities.entities).filter(h=>h.type==="human"&&h.id!==e.id).filter(h=>{const p=h;return Math.sqrt(Math.pow(p.position.x-e.position.x,2)+Math.pow(p.position.y-e.position.y,2))<100&&p.activeAction==="attacking"&&p.attackTargetId===t.id}).length;if(u>0&&(l*=1+u*.2),a){const h=s/yp;o.scheduledEvents.push({id:o.nextScheduledEventId++,type:"ranged-impact",scheduledTime:o.time+h,data:{attackerId:e.id,targetId:t.id,damage:l,pushbackForce:Sp,attackerPosition:{...e.position}}}),Fe(o,Ce.StoneProjectile,e.position,h,void 0,t.position,t.id),ke(n,Pe.Attack,e.position)}else{t.hitpoints-=l;const h=xe(e.position,t.position,o.mapDimensions.width,o.mapDimensions.height),p=ct(h,8);t.forces.push(p),t.hitpoints<=0?(ke(n,Pe.HumanDeath,t.position),Fe(o,Ce.Hit,t.position,Xe,t.id)):(Fe(o,Ce.Hit,t.position,Xe,t.id),t.hitpoints<t.maxHitpoints*.3&&(t.hunger+=20),ke(n,Pe.Attack,e.position)),Fe(o,Ce.Attack,e.position,Xe,e.id)}e.attackCooldown={melee:ml,ranged:vp};const d=e.stateMachine[1];d.attackStartTime=o.time}},bb={id:"prey-procreation",sourceType:"prey",targetType:"prey",maxDistance:Cs,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.gestationTime=n.gameState.ecosystem.preyGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.preyProcreationCooldown,Fe(n.gameState,Ce.Procreation,o.position,Xe,o.id),ke(n,Pe.Procreate,o.position)}},Db={id:"predator-procreation",sourceType:"predator",targetType:"predator",maxDistance:Ps,checker:(e,t,n)=>!!(e.isAdult&&t.isAdult&&e.gender!==t.gender&&e.id!==t.id&&!e.isPregnant&&!t.isPregnant&&e.hunger<200&&t.hunger<200&&(!e.procreationCooldown||e.procreationCooldown<=0)&&(!t.procreationCooldown||t.procreationCooldown<=0)),perform:(e,t,n)=>{const o=e.gender==="female"?e:t;o.isPregnant=!0,o.pregnancyFatherId=e.gender==="male"?e.id:t.id,o.gestationTime=n.gameState.ecosystem.predatorGestationPeriod,e.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,t.procreationCooldown=n.gameState.ecosystem.predatorProcreationCooldown,Fe(n.gameState,Ce.Procreation,o.position,Xe,o.id),ke(n,Pe.Procreate,o.position)}},Ob={id:"preyChildFeeding",sourceType:"prey",targetType:"prey",maxDistance:wT,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<80&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Iu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(120,e.hunger+10),t.hunger=Math.max(0,t.hunger-Iu),e.feedChildCooldownTime=CT,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Fe(n.gameState,Ce.ChildFed,t.position,Xe,t.id),t.lastChildFedEffectTime=n.gameState.time),ke(n,Pe.ChildFed,t.position)}},Nb={id:"predatorChildFeeding",sourceType:"predator",targetType:"predator",maxDistance:wT,checker:(e,t)=>e.isAdult===!0&&e.gender==="female"&&e.hunger<90&&(!e.feedChildCooldownTime||e.feedChildCooldownTime<=0)&&t.isAdult===!1&&(t.motherId===e.id||t.fatherId===e.id)&&t.hunger>=Iu&&e.activeAction==="feeding",perform:(e,t,n)=>{e.hunger=Math.min(140,e.hunger+15),t.hunger=Math.max(0,t.hunger-Iu),e.feedChildCooldownTime=CT,(!t.lastChildFedEffectTime||n.gameState.time-t.lastChildFedEffectTime>2)&&(Fe(n.gameState,Ce.ChildFed,t.position,Xe,t.id),t.lastChildFedEffectTime=n.gameState.time),ke(n,Pe.ChildFed,t.position)}},Bb={id:"predator-eat-corpse",sourceType:"predator",targetType:"corpse",maxDistance:Ps,checker:(e,t,n)=>!!(e.isAdult&&e.hunger>30&&t.food.length>0&&(!e.eatingCooldownTime||e.eatingCooldownTime<=n.gameState.time)),perform:(e,t,n)=>{t.food.pop()&&(e.hunger=Math.max(0,e.hunger-Bp),e.eatingCooldownTime=n.gameState.time+2,Fe(n.gameState,Ce.Eating,e.position,Xe,e.id),ke(n,Pe.Gather,e.position))}},Hb={id:"predator-attack-rival",sourceType:"predator",targetType:"predator",maxDistance:_r,checker:(e,t,n)=>{var o;return!!(e.isAdult&&(!e.attackCooldown||e.attackCooldown<=0)&&t.hitpoints>0&&(e.hunger>100||t.attackTargetId===e.id||t.attackTargetId&&((o=n.gameState.entities.entities[t.attackTargetId])==null?void 0:o.type)==="predator"))},perform:(e,t,n)=>{let o=TT;e.hunger>120&&(o*=1.3),t.hitpoints-=o,t.movementSlowdown={modifier:Fu,endTime:n.gameState.time+xu};const s=xe(e.position,t.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height),a=ct(s,7);t.forces.push(a),e.attackCooldown=IT,t.hitpoints<=0?(e.hunger=Math.max(0,e.hunger-Bp),ke(n,Pe.HumanDeath,t.position),Fe(n.gameState,Ce.Hit,t.position,Xe,t.id)):(Fe(n.gameState,Ce.Hit,t.position,Xe,t.id),ke(n,Pe.Attack,e.position)),Fe(n.gameState,Ce.Attack,e.position,Xe,e.id)}},Fb=25;function Zy(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function XT(e){const t=e.storedItems.length,n=Zy(t+e.id)*2*Math.PI,o=Zy(t+e.id+1)*Fb;return{x:Math.cos(n)*o,y:Math.sin(n)*o}}const xb={id:"storageDeposit",sourceType:"human",targetType:"building",maxDistance:ci,checker:(e,t,n)=>{var h;const o=t.buildingType===X.StorageSpot,s=t.buildingType===X.Bonfire;if(!o&&!s||e.stateMachine[0]!==Ka||!t.isConstructed)return!1;const a=e.food.length>0,l=((h=e.heldItem)==null?void 0:h.type)===Gt.Wood;if(s&&!l||!a&&!l)return!1;const u=t.storageCapacity??0;return!(t.storedItems.length>=u||e.leaderId!==t.ownerId||n.gameState.time-(t.lastDepositTime??0)<g_)},perform:(e,t,n)=>{var s;let o=null;t.buildingType===X.Bonfire?((s=e.heldItem)==null?void 0:s.type)===Gt.Wood&&(o=e.heldItem,e.heldItem=void 0):e.heldItem?(o=e.heldItem,e.heldItem=void 0):o=e.food.pop()??null,o&&t.storedItems.push({item:o,positionOffset:XT(t)}),t.lastDepositTime=n.gameState.time,ke(n,Pe.StorageDeposit,t.position)}},Lb={id:"storageRetrieve",sourceType:"human",targetType:"building",maxDistance:ci,checker:(e,t,n)=>!(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Qa||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId!==t.ownerId||n.gameState.time-(t.lastRetrieveTime??0)<m_),perform:(e,t,n)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&(e.food.push(o.item),XT(t)),t.lastRetrieveTime=n.gameState.time,ke(n,Pe.StorageRetrieve,t.position)}},Ub={id:"storageSteal",sourceType:"human",targetType:"building",maxDistance:ci,checker:(e,t,n)=>{var u;if(t.buildingType!=="storageSpot"||e.stateMachine[0]!==Os||!t.isConstructed||t.storedItems.length===0||e.food.length>=e.maxFood||e.leaderId===t.ownerId)return!1;const o=e.leaderId?n.gameState.entities.entities[e.leaderId]:void 0;if(!o||!((u=o.tribeControl)!=null&&u.diplomacy)||(t.ownerId?o.tribeControl.diplomacy[t.ownerId]:void 0)!==bt.Hostile||n.gameState.time-(t.lastStealTime??0)<y_)return!1;const l=VS({leaderId:t.ownerId},n.gameState);for(const d of l)if(K(e.position,d.position,n.gameState.mapDimensions.width,n.gameState.mapDimensions.height)<=v_)return!1;return!0},perform:(e,t,n)=>{if(t.storedItems.length===0)return;const o=t.storedItems.pop();(o==null?void 0:o.item.itemType)==="food"&&e.food.push(o.item),t.lastStealTime=n.gameState.time,ke(n,Pe.StorageSteal,t.position),Fe(n.gameState,Ce.Attack,t.position,.5)}},Gb={id:"human-takeover-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="takingOverBuilding"||!Tr(e,t,n.gameState)||!PS(t.position,Ai,e.id,n.gameState).valid),perform:(e,t,n)=>{t.ownerId=e.id,RS(t.position,Ai,e.id,n.gameState),t.constructionProgress=1,t.isConstructed=!0,t.isBeingDestroyed=!1,t.destructionProgress=0,e.activeAction="idle",Fe(n.gameState,Ce.BushClaimed,t.position,2,t.id)}},$b={id:"human-remove-enemy-building",sourceType:"human",targetType:"building",maxDistance:20,checker:(e,t,n)=>!(e.leaderId!==e.id||e.activeAction!=="destroyingBuilding"||!Tr(e,t,n.gameState)||t.isBeingDestroyed),perform:(e,t,n)=>{t.isBeingDestroyed=!0,e.activeAction="idle",Fe(n.gameState,Ce.Hit,t.position,1,t.id)}},Wb={id:"humanTreeChop",sourceType:"human",targetType:"tree",maxDistance:Bu,checker:(e,t,n)=>{const[o]=t.stateMachine??[],s=o===ri||o===zn||o===Ei;return e.isAdult&&s&&e.stateMachine[0]===Op&&!e.heldItem&&(!e.gatheringCooldownTime||e.gatheringCooldownTime<n.gameState.time)||!1},perform:(e,t,n)=>{const{gameState:o}=n;if(t.stateMachine=[Vt,{enteredAt:o.time,previousState:t.stateMachine[0]}],!t.woodGenerated){const s=Math.min(1,t.age/Uo),a=Math.floor(jy+s*(Vu-jy));t.wood=Array.from({length:a},()=>({itemType:"item",type:Gt.Wood,id:o.entities.nextEntityId++})),t.woodGenerated=!0}e.activeAction="idle",e.gatheringCooldownTime=o.time+1,ke(n,Pe.Gather,e.position)}},Yb={id:"human-attack-building",sourceType:"human",targetType:"building",maxDistance:40,checker:(e,t,n)=>{const{gameState:o}=n;return!(t.buildingType!==X.Palisade&&t.buildingType!==X.Gate||!t.ownerId||t.ownerId===e.leaderId||e.attackCooldown&&e.attackCooldown.melee>o.time)},perform:(e,t,n)=>{const{gameState:o}=n;t.isBeingDestroyed=!0;const s=.1;t.destructionProgress=Math.min(1,t.destructionProgress+s),e.attackCooldown||(e.attackCooldown={melee:0,ranged:0}),e.attackCooldown.melee=o.time+ml,Fe(o,Ce.Hit,t.position,.5,e.id,void 0,t.id)}},jb=[gb,mb,yb,vb,Sb,Tb,Ib,...Cb,fb,hb,pb,xb,Lb,Ub,Gb,$b,Wb,Yb,Pb,Ob,Nb,Bb,_b,Rb,Mb,kb,Hb,bb,Db],Ky=Object.values(jb.reduce((e,t)=>{const n=`${t.sourceType}-${t.targetType}`;e[n]||(e[n]={sourceType:t.sourceType,targetType:t.targetType,maxDistance:t.maxDistance,interactions:[]});const o={...t,maxDistanceSq:t.maxDistance*t.maxDistance,isCollision:t.id.toLowerCase().includes("collision")??!1};return e[n].interactions.push(o),e[n].maxDistance=Math.max(e[n].maxDistance,t.maxDistance),e},{}));let Qy=0;function VT(e){const{gameState:t}=e,n=t,{width:o,height:s}=t.mapDimensions;Qy++;const a=Qy%2===0;for(let l=0;l<Ky.length;l++){const u=Ky[l],d=n.search[u.sourceType].all();for(let h=0;h<d.length;h++){const p=d[h],m=n.search[u.targetType].byRadius(p.position,u.maxDistance);for(let S=0;S<m.length;S++){const y=m[S];if(p.id===y.id)continue;const I=Rt(p.position,y.position,o,s);for(let T=0;T<u.interactions.length;T++){const E=u.interactions[T];!E.isCollision&&a||I<=E.maxDistanceSq&&E.checker(p,y,e)&&E.perform(p,y,e)}}}}}function Lp(e){e.visualEffects=e.visualEffects.filter(t=>e.time-t.startTime<=t.duration)}function zb(e){const t=e.search.berryBush.byProperty("type","berryBush"),n=e.search.predator.byProperty("type","predator"),o=e.search.human.byProperty("type","human");for(let s=0;s<20;s++){let a;if(t.length>0&&s<15){const d=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,p=50+Math.random()*100;a={x:Math.max(50,Math.min(We-50,d.position.x+Math.cos(h)*p)),y:Math.max(50,Math.min(Ye-50,d.position.y+Math.sin(h)*p))}}else a={x:50+Math.random()*(We-100),y:50+Math.random()*(Ye-100)};let l=!0;const u=100;for(const d of n)if(Math.sqrt((a.x-d.position.x)**2+(a.y-d.position.y)**2)<u){l=!1;break}if(l){for(const d of o)if(Math.sqrt((a.x-d.position.x)**2+(a.y-d.position.y)**2)<u){l=!1;break}}if(l)return a}return{x:We*.3+Math.random()*We*.4,y:Ye*.3+Math.random()*Ye*.4}}function Xb(e){const t=e.search.prey.byProperty("type","prey"),n=e.search.human.byProperty("type","human");for(let s=0;s<15;s++){let a;if(t.length>0&&s<10){const d=t[Math.floor(Math.random()*t.length)],h=Math.random()*2*Math.PI,p=100+Math.random()*150;a={x:Math.max(50,Math.min(We-50,d.position.x+Math.cos(h)*p)),y:Math.max(50,Math.min(Ye-50,d.position.y+Math.sin(h)*p))}}else a={x:50+Math.random()*(We-100),y:50+Math.random()*(Ye-100)};let l=!0;const u=150;for(const d of n)if(Math.sqrt((a.x-d.position.x)**2+(a.y-d.position.y)**2)<u){l=!1;break}if(l)return a}switch(Math.floor(Math.random()*4)){case 0:return{x:Math.random()*We,y:50+Math.random()*100};case 1:return{x:We-150+Math.random()*100,y:Math.random()*Ye};case 2:return{x:Math.random()*We,y:Ye-150+Math.random()*100};default:return{x:50+Math.random()*100,y:Math.random()*Ye}}}function Vb(e){const t=e.search.human.byProperty("type","human"),n=e.search.berryBush.byProperty("type","berryBush");for(let o=0;o<20;o++){const s={x:50+Math.random()*(We-100),y:50+Math.random()*(Ye-100)};let a=!0;const l=80,u=60;for(const d of t)if(Math.sqrt((s.x-d.position.x)**2+(s.y-d.position.y)**2)<l){a=!1;break}if(a){for(const d of n)if(Math.sqrt((s.x-d.position.x)**2+(s.y-d.position.y)**2)<u){a=!1;break}}if(a)return s}return{x:Math.random()*We,y:Math.random()*Ye}}function qT(e,t=4){console.log(` Respawning ${t} prey to prevent extinction`);const n=e;for(let o=0;o<t;o++){const s=zb(n),a=o%2===0?"male":"female";Rs(e.entities,s,a,void 0,void 0,ul())}}function ZT(e,t=2){console.log(` Respawning ${t} predators to prevent extinction`);const n=e;for(let o=0;o<t;o++){const s=Xb(n),a=o%2===0?"male":"female";ks(e.entities,s,a,void 0,void 0,dl())}}function qb(e){const t=e,n=t.search.prey.count(),o=t.search.predator.count();let s=!1;return n===0&&(qT(e,6),s=!0),o===0&&(ZT(e,3),s=!0),s}function Zb(e){const t=e,n=t.search.prey.count(),o=t.search.predator.count(),s=t.search.berryBush.count();let a=!1;if(n>0&&n<5){const l=Math.max(2,Math.floor(8-n));qT(e,l),a=!0}if(o>0&&o<2){const l=Math.max(1,Math.floor(3-o));ZT(e,l),a=!0}if(s<5){console.log(` Boosting bush count from ${s} to help ecosystem`);for(let l=0;l<5;l++){const u=Vb(t);Al(e.entities,u,e.time)}a=!0}return a}const Kb=1,Qb=.3,Jb=.8,Jy=.8,eD=.99,tD=.05;var KT=(e=>(e[e.INCREASE_PREY_GESTATION=0]="INCREASE_PREY_GESTATION",e[e.DECREASE_PREY_GESTATION=1]="DECREASE_PREY_GESTATION",e[e.INCREASE_PREY_PROCREATION_COOLDOWN=2]="INCREASE_PREY_PROCREATION_COOLDOWN",e[e.DECREASE_PREY_PROCREATION_COOLDOWN=3]="DECREASE_PREY_PROCREATION_COOLDOWN",e[e.INCREASE_PREY_HUNGER=4]="INCREASE_PREY_HUNGER",e[e.DECREASE_PREY_HUNGER=5]="DECREASE_PREY_HUNGER",e[e.INCREASE_PREDATOR_GESTATION=6]="INCREASE_PREDATOR_GESTATION",e[e.DECREASE_PREDATOR_GESTATION=7]="DECREASE_PREDATOR_GESTATION",e[e.INCREASE_PREDATOR_PROCREATION_COOLDOWN=8]="INCREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.DECREASE_PREDATOR_PROCREATION_COOLDOWN=9]="DECREASE_PREDATOR_PROCREATION_COOLDOWN",e[e.INCREASE_PREDATOR_HUNGER=10]="INCREASE_PREDATOR_HUNGER",e[e.DECREASE_PREDATOR_HUNGER=11]="DECREASE_PREDATOR_HUNGER",e[e.INCREASE_BUSH_SPREAD=12]="INCREASE_BUSH_SPREAD",e[e.DECREASE_BUSH_SPREAD=13]="DECREASE_BUSH_SPREAD",e[e.INCREASE_TREE_SPREAD=14]="INCREASE_TREE_SPREAD",e[e.DECREASE_TREE_SPREAD=15]="DECREASE_TREE_SPREAD",e[e.NO_ACTION=16]="NO_ACTION",e))(KT||{});const ph=Object.keys(KT).length/2;class nD{constructor(){Yt(this,"qTable",new Map);Yt(this,"epsilon",Jy);Yt(this,"lastState",null);Yt(this,"lastAction",null)}discretizeState(t,n,o,s){const a=Math.min(4,Math.floor(t/25)),l=Math.min(4,Math.floor(n/5)),u=Math.min(4,Math.floor(o/15)),d=Math.min(4,Math.floor(s/50));return`${a}-${l}-${u}-${d}`}getQValue(t,n){return this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).get(n)||0}setQValue(t,n,o){this.qTable.has(t)||this.qTable.set(t,new Map),this.qTable.get(t).set(n,o)}getBestAction(t){let n=0,o=this.getQValue(t,0);for(let s=1;s<ph;s++){const a=this.getQValue(t,s);a>o&&(o=a,n=s)}return n}chooseAction(t){return Math.random()<this.epsilon?Math.floor(Math.random()*ph):this.getBestAction(t)}applyEmergencyCorrections(t,n,o,s,a){t<ji*.5&&(a.ecosystem.preyGestationPeriod=Math.max(ss,a.ecosystem.preyGestationPeriod*.8),a.ecosystem.preyProcreationCooldown=Math.max(as,a.ecosystem.preyProcreationCooldown*.8),a.ecosystem.preyHungerIncreasePerHour=Math.max(us,a.ecosystem.preyHungerIncreasePerHour*.9)),n<zi*.6&&(a.ecosystem.predatorGestationPeriod=Math.max(ls,a.ecosystem.predatorGestationPeriod*.75),a.ecosystem.predatorProcreationCooldown=Math.max(cs,a.ecosystem.predatorProcreationCooldown*.75),a.ecosystem.predatorHungerIncreasePerHour=Math.max(ds,a.ecosystem.predatorHungerIncreasePerHour*.85)),o<Xi*.5&&(a.ecosystem.berryBushSpreadChance=Math.min(xa,a.ecosystem.berryBushSpreadChance*1.2)),s<Vi*.5&&(a.ecosystem.treeSpreadChance=Math.min(Wa,a.ecosystem.treeSpreadChance*1.2)),t>ji*1.4&&(a.ecosystem.preyHungerIncreasePerHour=Math.min(bo,a.ecosystem.preyHungerIncreasePerHour*1.05)),n>zi*1.4&&(a.ecosystem.predatorHungerIncreasePerHour=Math.min(Do,a.ecosystem.predatorHungerIncreasePerHour*1.05)),o>Xi*1.4&&(a.ecosystem.berryBushSpreadChance=Math.max(qi,a.ecosystem.berryBushSpreadChance*.95)),s>Vi*1.4&&(a.ecosystem.treeSpreadChance=Math.max(Zi,a.ecosystem.treeSpreadChance*.95))}calculateReward(t,n,o,s){const a=Math.abs(t-ji),l=Math.abs(n-zi),u=Math.abs(o-Xi),d=Math.abs(s-Vi),h=a/ji,p=l/zi,m=u/Xi,S=d/Vi,y=h+p+m+S;return 100*Math.exp(-y*2)-50}applyAction(t,n){switch(t){case 0:n.ecosystem.preyGestationPeriod=Math.min(fr,n.ecosystem.preyGestationPeriod+.2*(fr-ss));break;case 1:n.ecosystem.preyGestationPeriod=Math.max(ss,n.ecosystem.preyGestationPeriod-.2*(fr-ss));break;case 2:n.ecosystem.preyProcreationCooldown=Math.min(hr,n.ecosystem.preyProcreationCooldown+.2*(hr-as));break;case 3:n.ecosystem.preyProcreationCooldown=Math.max(as,n.ecosystem.preyProcreationCooldown-.2*(hr-as));break;case 4:n.ecosystem.preyHungerIncreasePerHour=Math.min(bo,n.ecosystem.preyHungerIncreasePerHour+.2*(bo-us));break;case 5:n.ecosystem.preyHungerIncreasePerHour=Math.max(us,n.ecosystem.preyHungerIncreasePerHour-.2*(bo-us));break;case 6:n.ecosystem.predatorGestationPeriod=Math.min(pr,n.ecosystem.predatorGestationPeriod+.2*(pr-ls));break;case 7:n.ecosystem.predatorGestationPeriod=Math.max(ls,n.ecosystem.predatorGestationPeriod-.2*(pr-ls));break;case 8:n.ecosystem.predatorProcreationCooldown=Math.min(gr,n.ecosystem.predatorProcreationCooldown+.2*(gr-cs));break;case 9:n.ecosystem.predatorProcreationCooldown=Math.max(cs,n.ecosystem.predatorProcreationCooldown-.2*(gr-cs));break;case 10:n.ecosystem.predatorHungerIncreasePerHour=Math.min(Do,n.ecosystem.predatorHungerIncreasePerHour+.2*(Do-ds));break;case 11:n.ecosystem.predatorHungerIncreasePerHour=Math.max(ds,n.ecosystem.predatorHungerIncreasePerHour-.2*(Do-ds));break;case 12:n.ecosystem.berryBushSpreadChance=Math.min(xa,n.ecosystem.berryBushSpreadChance+.2*(xa-qi));break;case 13:n.ecosystem.berryBushSpreadChance=Math.max(qi,n.ecosystem.berryBushSpreadChance-.2*(xa-qi));break;case 14:n.ecosystem.treeSpreadChance=Math.min(Wa,n.ecosystem.treeSpreadChance+.2*(Wa-Zi));break;case 15:n.ecosystem.treeSpreadChance=Math.max(Zi,n.ecosystem.treeSpreadChance-.2*(Wa-Zi));break}}updateQTable(t,n,o,s){const a=this.getQValue(t,n),l=Math.max(...Array.from({length:ph},(d,h)=>this.getQValue(s,h))),u=a+Qb*(o+Jb*l-a);this.setQValue(t,n,u)}step(t){const n=t,o=n.search.prey.count(),s=n.search.predator.count(),a=n.search.berryBush.count(),l=n.search.tree.count();this.applyEmergencyCorrections(o,s,a,l,t);const u=this.discretizeState(o,s,a,l);if(this.lastState!==null&&this.lastAction!==null){const h=this.calculateReward(o,s,a,l);this.updateQTable(this.lastState,this.lastAction,h,u)}const d=this.chooseAction(u);this.applyAction(d,t),this.epsilon=Math.max(tD,this.epsilon*eD),this.lastState=u,this.lastAction=d}reset(){this.qTable.clear(),this.epsilon=Jy,this.lastState=null,this.lastAction=null}getStats(){return{qTableSize:this.qTable.size,explorationRate:this.epsilon}}}let QT=new nD;function iD(e){qb(e),Zb(e),e.ecosystem.lastUpdateTime||(e.ecosystem.preyGestationPeriod=ss+(fr-ss)*.3,e.ecosystem.preyProcreationCooldown=as+(hr-as)*.3,e.ecosystem.preyHungerIncreasePerHour=us+(bo-us)*.3,e.ecosystem.predatorGestationPeriod=ls+(pr-ls)*.3,e.ecosystem.predatorProcreationCooldown=cs+(gr-cs)*.3,e.ecosystem.predatorHungerIncreasePerHour=ds+(Do-ds)*.3,e.ecosystem.berryBushSpreadChance=qi+(xa-qi)*.7,e.ecosystem.treeSpreadChance=Zi+(Wa-Zi)*.2),QT.step(e)}function oD(e){e.ecosystem.lastUpdateTime||(e.ecosystem.lastUpdateTime=0),!(e.time-e.ecosystem.lastUpdateTime<Kb)&&(e.ecosystem.lastUpdateTime=e.time,iD(e))}function rD(){return QT.getStats()}function sD(e){e.selectedBuildingType&&e.selectedBuildingType!=="removal"&&(e.autopilotControls.activeAutopilotAction=void 0,e.autopilotControls.hoveredAutopilotAction=void 0)}function aD(e){const{gameState:t}=e,n=t.time,o=t.scheduledEvents.filter(a=>a.scheduledTime<=n),s=t.scheduledEvents.filter(a=>a.scheduledTime>n);t.scheduledEvents=s;for(const a of o)switch(a.type){case"ranged-impact":{const l=t.entities.entities[a.data.targetId];if(!l||l.hitpoints<=0)continue;l.hitpoints-=a.data.damage,l.movementSlowdown={modifier:Fu,endTime:t.time+xu};const u=xe(a.data.attackerPosition,l.position,t.mapDimensions.width,t.mapDimensions.height),d=ct(u,a.data.pushbackForce);l.forces.push(d),Fe(t,Ce.Hit,l.position,Xe,l.id),l.hitpoints<=0?ke(e,Pe.HumanDeath,l.position):ke(e,Pe.Attack,l.position);break}}}const JT=80,eI=200,wu=15,lD=100,tI=300;function nI(e,t,n,o){if(e.length===0)return[];if(e.length===1)return[e];const s=t*t,a=[];for(let h=0;h<e.length;h++)a[h]=h;const l=h=>(a[h]!==h&&(a[h]=l(a[h])),a[h]),u=(h,p)=>{const m=l(h),S=l(p);m!==S&&(a[S]=m)};for(let h=0;h<e.length;h++)for(let p=h+1;p<e.length;p++)Rt(e[h].position,e[p].position,n,o)<=s&&u(h,p);const d=new Map;for(let h=0;h<e.length;h++){const p=l(h);d.has(p)||d.set(p,[]),d.get(p).push(e[h])}return Array.from(d.values())}function iI(e,t,n,o){const s=Math.ceil(t/me),a=Math.ceil(n/me),l=s*a,u=new Array(l).fill(!1),d=o*o;for(const h of e){const p=Math.floor((h.position.x-o)/me),m=Math.ceil((h.position.x+o)/me),S=Math.floor((h.position.y-o)/me),y=Math.ceil((h.position.y+o)/me);for(let I=S;I<=y;I++)for(let T=p;T<=m;T++){const E=(T+s)%s,P=(I+a)%a,C=P*s+E;if(u[C])continue;const _=E*me+me/2,k=P*me+me/2;Rt({x:_,y:k},h.position,t,n)<=d&&(u[C]=!0)}}return u}function cD(e,t,n){if(e.length<3)return 0;const o=[e[0]];for(let a=1;a<e.length;a++){let l=e[a].x-e[a-1].x,u=e[a].y-e[a-1].y;l>t/2?l-=t:l<-t/2&&(l+=t),u>n/2?u-=n:u<-n/2&&(u+=n),o.push({x:o[a-1].x+l,y:o[a-1].y+u})}let s=0;for(let a=0;a<o.length;a++){const l=o[a],u=o[(a+1)%o.length];s+=l.x*u.y-u.x*l.y}return s/2}function oI(e,t,n){const o=[],s=new Set;for(let h=0;h<n;h++)for(let p=0;p<t;p++){const m=h*t+p;if(!e[m])continue;let S=!1;const y=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:I,dy:T}of y){const E=(p+I+t)%t,P=(h+T+n)%n;if(!e[P*t+E]){S=!0;break}}S&&(o.push({x:p,y:h}),s.add(`${p},${h}`))}if(o.length===0)return[];const a=[],l=new Set,u=t*me,d=n*me;for(const h of o){if(l.has(`${h.x},${h.y}`))continue;const p=[];let m=h.x,S=h.y,y=1;const I=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];let T=0;const E=t*n;do{p.push({x:m*me+me/2,y:S*me+me/2}),l.add(`${m},${S}`);let P=!1;for(let C=-1;C<=2;C++){const _=(y+C+4)%4,k=(m+I[_].dx+t)%t,w=(S+I[_].dy+n)%n;if(e[w*t+k]){m=k,S=w,y=_,P=!0;break}}if(!P)break;T++}while((m!==h.x||S!==h.y)&&T<E);p.length>2&&cD(p,u,d)>0&&a.push(p)}return a}function rI(e,t,n,o){if(e.length===0)return[];let s=0;for(let m=0;m<e.length;m++){const S=e[m],y=e[(m+1)%e.length];s+=K(S,y,n,o)}const a=Math.max(1,Math.floor(s/tI));let l=0,u=1/0;for(let m=0;m<e.length;m++){const S=Rt(e[m],t,n,o);S<u&&(u=S,l=m)}const d=[...e.slice(l),...e.slice(0,l)],h=e.length/a,p=[];for(let m=0;m<d.length;m++){let S=!1;for(let y=0;y<a;y++){const I=Math.round(y*h);if(m===I){S=!0;break}}p.push({position:d[m],isGate:S})}return p}const sI="ownedIndices",ev="frontierScanIndex",Ja="frontierCandidates";function uD(e){const{gameState:t}=e,n=t,s=n.search.human.all().filter(h=>h.leaderId===h.id),{width:a,height:l}=t.mapDimensions,u=Math.ceil(a/_e),d=Math.ceil(l/_e);for(const h of s){if(!h.aiBlackboard)continue;const p=Oe.get(h.aiBlackboard,sI)||[];if(p.length===0)continue;let m=Oe.get(h.aiBlackboard,ev)||0;const S=Oe.get(h.aiBlackboard,Ja)||{},y=li(h.id,t),I=20;for(let E=0;E<I;E++){m>=p.length&&(m=0);const P=p[m];m=(m+1)%p.length;const C=P%u,_=Math.floor(P/u),k=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const{dx:w,dy:M}of k){const R=(C+w+u)%u,H=(_+M+d)%d,j=H*u+R,$=t.terrainOwnership[j],V=$!==null&&eo(h.id,$,t);if($===null||V){let ee=0;for(const{dx:G,dy:J}of k){const pe=(R+G+u)%u,ne=(H+J+d)%d;t.terrainOwnership[ne*u+pe]===h.id&&ee++}const ue=ee*20,oe=Lh(j,a),re=n.search.berryBush.byRadius(oe,100),fe=n.search.tree.byRadius(oe,100),ie=re.length*10+fe.length*5,W=V?50:0,x=K(oe,y,a,l)/100*5,D=ue+ie+W-x;S[j.toString()]={score:D,fromIdx:P,lastSeenTime:t.time}}}}const T=Object.entries(S).sort((E,P)=>P[1].score-E[1].score);if(T.length>50){const E={};for(let P=0;P<50;P++){const[C,_]=T[P];E[C]=_}Oe.set(h.aiBlackboard,Ja,E)}else Oe.set(h.aiBlackboard,Ja,S);Oe.set(h.aiBlackboard,ev,m)}}function dD(e,t,n){const{gameState:o}=n,s=o,{width:a,height:l}=o.mapDimensions,u=Math.ceil(a/me);Object.keys(o.tasks).forEach(S=>{const y=o.tasks[S];y.creatorEntityId===e&&(y.type===q.HumanPlacePalisade||y.type===q.HumanPlaceGate)&&delete o.tasks[S]});const d=t.filter(S=>S.buildingType===X.Bonfire||S.buildingType===X.StorageSpot);if(d.length===0)return;const h=t.filter(S=>S.buildingType===X.Palisade||S.buildingType===X.Gate),p=nI(d,eI,a,l),m=li(e,o);for(const S of p){if(S.length===0)continue;const y=iI(S,a,l,JT),I=oI(y,u,Math.ceil(l/me));if(I.length!==0)for(const T of I){if(T.length===0)continue;const P=rI(T,m,a,l).filter(_=>!(Nn(_.position.x,_.position.y,o)!==e||h.some(M=>Rt(_.position,M.position,a,l)<wu*wu)));if(P.length===0)continue;let C=0;for(let _=0;_<P.length;_++){const k=P[_];if(k.isGate&&(C=0),C>0){C--;continue}const w=k.position;if(s.search.building.at(w,me/2))continue;const R=s.search.tree.byRadius(w,me/2);if(R.length>0){const $=R[0],V=`Chop-Gord-${$.id}`;o.tasks[V]||(o.tasks[V]={id:V,type:q.HumanChopTree,position:$.position,creatorEntityId:e,target:$.id,validUntilTime:o.time+12});continue}const H=k.isGate?q.HumanPlaceGate:q.HumanPlacePalisade,j=`${q[H]}-${e}-${Math.floor(w.x)}-${Math.floor(w.y)}`;o.tasks[j]={id:j,type:H,position:w,creatorEntityId:e,target:w,validUntilTime:o.time+24},C=k.isGate?4:2}}}}function fD(e){var m;const{gameState:t}=e,n=t,o=n.search.human.all(),s=new Map,a=new Set;for(let S=0;S<o.length;S++){const y=o[S];y.leaderId&&(s.has(y.leaderId)||s.set(y.leaderId,[]),s.get(y.leaderId).push(y),y.leaderId===y.id&&a.add(y.id))}const l=Object.values(t.tasks),u=new Map;for(let S=0;S<l.length;S++){const y=l[S];y.creatorEntityId&&(u.has(y.creatorEntityId)||u.set(y.creatorEntityId,[]),u.get(y.creatorEntityId).push(y))}const d=n.search.building.all(),h=new Map;for(let S=0;S<d.length;S++){const y=d[S];if(y.ownerId){const I=t.entities.entities[y.ownerId],T=I==null?void 0:I.leaderId;T&&(h.has(T)||h.set(T,[]),h.get(T).push(y))}}const p=new Map;for(const S of a)p.set(S,li(S,t));for(const S of a){const y=t.entities.entities[S];if(!y)continue;const I=[];for(let V=0;V<t.terrainOwnership.length;V++)t.terrainOwnership[V]===S&&I.push(V);Oe.set(y.aiBlackboard,sI,I);const T=s.get(S)||[];if(T.length<iT)continue;const E=T.filter(V=>V.isAdult);if(E.length===0)continue;const P=u.get(S)||[],C=V=>P.some(ee=>ee.type===V),_=h.get(S)||[];dD(S,_,e);const k=[];for(const[V,ee]of p.entries())V!==S&&k.push(ee);if(!C(q.HumanPlaceStorage)){const V=_.filter(fe=>fe.buildingType===X.StorageSpot);let ee=0,ue=0;for(let fe=0;fe<V.length;fe++){const ie=V[fe];ee+=((m=ie.storedItems)==null?void 0:m.length)||0,ue+=ie.storageCapacity||0}const oe=ue>0?ee/ue:0;if(V.length===0||oe>Kw){const fe=V.length===0?eC:eh,ie=tu(X.StorageSpot,S,t,Jf,fe,y.position,k);ie&&$c(S,q.HumanPlaceStorage,ie,t)}}if(!C(q.HumanPlaceBonfire)){const V=_.filter(W=>W.buildingType===X.Bonfire),ee=p.get(S),oe=fl(t.temperature,ee,t.time,t.mapDimensions.width,t.mapDimensions.height)<SC&&V.length===0,re=V.length>0&&V.length<Math.ceil(E.length/EC);let fe;const ie=T.filter(W=>fl(t.temperature,W.position,t.time,t.mapDimensions.width,t.mapDimensions.height)<dr+5?V.every(D=>K(W.position,D.position,t.mapDimensions.width,t.mapDimensions.height)>Xa*1.5):!1);if(ie.length>=3){const W=ie.reduce((x,D)=>x+D.position.x,0)/ie.length,te=ie.reduce((x,D)=>x+D.position.y,0)/ie.length;fe={x:W,y:te}}if(oe||re||fe){const W=tu(X.Bonfire,S,t,Jf,eh,fe||y.position,k);W&&$c(S,q.HumanPlaceBonfire,W,t)}}if(!C(q.HumanPlacePlantingZone)){const ee=_.filter(oe=>oe.buildingType===X.PlantingZone&&NP(oe,t)).reduce((oe,re)=>oe+KS(re),0),ue=Math.max(Jw,E.length*Qw);if(ee<ue){const oe=tu(X.PlantingZone,S,t,Jf,eh,y.position,k);oe&&$c(S,q.HumanPlacePlantingZone,oe,t)}}const w=Oe.get(y.aiBlackboard,Ja)||{},{width:M,height:R}=t.mapDimensions,H=_.filter(V=>V.buildingType===X.BorderPost),j=P.filter(V=>V.type===q.HumanPlaceBorderPost);for(const V in w){const ee=parseInt(V,10),ue=t.terrainOwnership[ee],oe=ue!==null&&eo(y.id,ue,t);if(ue===S||ue!==null&&!oe){delete w[V];continue}const re=Lh(ee,M);(H.some(ie=>Rt(re,ie.position,M,R)<100*100)||j.some(ie=>Rt(re,ie.position,M,R)<100*100))&&delete w[V]}Oe.set(y.aiBlackboard,Ja,w);const $=3;if(j.length<$){const V=Object.entries(w).map(([re,fe])=>({idx:parseInt(re,10),...fe})).sort((re,fe)=>fe.score-re.score),ee=[];for(const re of V){if(ee.length>=$-j.length)break;const fe=Lh(re.idx,M);ee.every(W=>Rt(fe,W,M,R)>100*100)&&ee.push(fe)}const ue=new Set(j.map(re=>{const fe=re.id.split("-");return parseInt(fe[fe.length-1],10)}).filter(re=>!isNaN(re))),oe=[];for(let re=0;re<$;re++)ue.has(re)||oe.push(re);for(let re=0;re<ee.length;re++)$c(S,q.HumanPlaceBorderPost,ee[re],t,oe[re])}}}function $c(e,t,n,o,s=0){const a=`${q[t]}-${e}-${s}`;o.tasks[a]={id:a,position:n,type:t,creatorEntityId:e,target:n,validUntilTime:o.time+12}}function hD(e){const{gameState:t}=e,s=t.search.human.all().filter(a=>a.leaderId===a.id);for(const a of s){if(!a.aiBlackboard)continue;const l=`diplomacy-${a.id}`;if(t.tasks[l])continue;const u=Oe.get(a.aiBlackboard,"lastDiplomacyCheckTime")??-1/0;if(t.time-u<gy)continue;const d={id:l,type:q.HumanDiplomacy,position:a.position,creatorEntityId:a.id,validUntilTime:t.time+gy};t.tasks[l]=d}}function aI(e){var o;const n=e.pathfindingQueue.splice(0,10);for(const s of n){const a=e.entities.entities[s];if(a&&a.type==="human"&&a.target){let l;if(typeof a.target=="object"?l=a.target:l=(o=e.entities.entities[a.target])==null?void 0:o.position,l){const{path:u}=hT(e,a.position,l,a);if(u)a.path=u,a.pathTarget={...l};else{const{width:d,height:h}=e.mapDimensions,p=xe(a.position,l,d,h),m=Math.sqrt(p.x*p.x+p.y*p.y);if(m<.001)continue;const S=Math.ceil(m/(me/2)),y=p.x/S,I=p.y/S,T=p.x/m,P=-(p.y/m),C=T,_=a.radius*.5;let k=!1;for(let w=0;w<=Math.min(S,40);w++){const M={x:a.position.x+y*w,y:a.position.y+I*w},R=[M,{x:M.x+P*_,y:M.y+C*_},{x:M.x-P*_,y:M.y-C*_},{x:M.x+P*_*.5,y:M.y+C*_*.5},{x:M.x-P*_*.5,y:M.y-C*_*.5}];for(const H of R){const j=Np(H,d,h);if(!Es(e.navigationGrid,j,a.leaderId,!1)){const $=e.search.building.at(H,me*1.5);if($&&($.buildingType===X.Palisade||$.buildingType===X.Gate)&&$.ownerId!==a.leaderId){const V=`Breach-${a.id}`;e.tasks[V]||(e.tasks[V]={id:V,type:q.HumanAttackBuilding,position:$.position,creatorEntityId:a.id,target:$.id,validUntilTime:e.time+.5,claimedByEntityId:a.id}),k=!0;break}}}if(k)break}}}}}}const pD=1/60;function gD(e,t){if(!e.cameraFollowingPlayer)return;const n=Nt(e);n&&(e.viewportCenter=ou(e.viewportCenter,n.position,uu*t))}function Zu(e,t){if(e.isPaused)return e;if(e.autosaveIntervalSeconds){const n=Date.now();n-e.lastAutosaveTime>e.autosaveIntervalSeconds*1e3&&(tp(e),e.lastAutosaveTime=n)}for(;t>0;){const n=pl(e),o=Math.min(t,pD),s=o*(Ot/Ut);n.time+=s,gD(n,o),Yw(n),ZR(n),oD(n),GP(n),$R(n),jw(n),aD({gameState:n}),$T({gameState:n,deltaTime:o}),VT({gameState:n,deltaTime:o}),uD({gameState:n}),aI(n),Math.floor(n.time)>Math.floor(n.time-s)&&(bP(n),fD({gameState:n}),hD({gameState:n})),Lp(n),tb(n,o),sD(n),e=n,t-=o}return e}function gh(e,t,n){e.save();const{x:o,y:s,width:a,height:l}=t.rect,u=FS;if(e.beginPath(),e.moveTo(o+u,s),e.lineTo(o+a-u,s),e.quadraticCurveTo(o+a,s,o+a,s+u),e.lineTo(o+a,s+l-u),e.quadraticCurveTo(o+a,s+l,o+a-u,s+l),e.lineTo(o+u,s+l),e.quadraticCurveTo(o,s+l,o,s+l-u),e.lineTo(o,s+u),e.quadraticCurveTo(o,s,o+u,s),e.closePath(),e.fillStyle=t.isDisabled?xS:t.backgroundColor,e.fill(),t.activated){e.save();const d=(Math.sin(Date.now()/1e3*$S)+1)/2;e.strokeStyle=GS,e.lineWidth=2+d*2,e.globalAlpha=.7+d*.3,e.stroke(),e.restore()}if(t.lastActivated){const d=Date.now()-t.lastActivated;if(d<mu){const h=1-d/mu;e.fillStyle=US,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=wp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?LS:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+a-4,s+l-2))):(e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+a/2,s+l/2)),e.restore()}function mD(e,t,n,o){e.save(),e.font=`${Ay}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="bottom";const a=e.measureText(n).width,l=Ay,u=a+Ey*2,d=l+Ey*2,h=o.x-u/2,p=e.canvas.height,m=t.y<p/2?t.y+t.height-wy:t.y-d+wy;e.fillStyle=qC,e.fillRect(h,m,u,d),e.fillStyle=ZC,e.fillText(n,o.x,m+d/2+l/2),e.restore()}function yD(e,t,n){e.save();const o=Nt(t),s=[{id:"fastForwardButton",action:Te.FastForward,text:"FFWD [T]",currentWidth:Yi*1.3,backgroundColor:On,textColor:Dt,tooltip:"Fast-forward time",rect:{x:0,y:0,width:0,height:0}},{id:"pauseButton",action:Te.TogglePause,text:t.isPaused?"UN[P]AUSE":"[P]AUSE",backgroundColor:t.isPaused?La:On,currentWidth:t.isPaused?Yi*1.4:Yi*1.1,tooltip:t.isPaused?"Resume Game":"Pause Game",rect:{x:0,y:0,width:0,height:0},textColor:Dt},{id:"muteButton",action:Te.ToggleMute,text:t.isMuted?"UN[M]UTE":"[M]UTE",backgroundColor:t.isMuted?La:On,tooltip:`Toggle Sound (${t.isMuted?"Muted":"Enabled"})`,currentWidth:Yi,rect:{x:0,y:0,width:0,height:0},textColor:Dt},{id:"returnToIntroButton",action:Te.ReturnToIntro,text:"EXIT",backgroundColor:On,tooltip:"Return to Main Menu [ESC]",currentWidth:Yi*.9,rect:{x:0,y:0,width:0,height:0},textColor:Dt}];if(t.uiButtons.push(...s),o){const h=Dp(t,o),p=new Set(h.map(C=>C.type));let m=[{playerAction:Se.Gather,buttonAction:Te.CommandGather,shortcut:"E",name:"Gather",toggleKey:"gathering",condition:()=>o.isAdult===!0},{playerAction:Se.Eat,buttonAction:Te.CommandEat,shortcut:"F",name:"Eat"},{playerAction:Se.Plant,buttonAction:Te.CommandPlant,shortcut:"B",name:"Plant",toggleKey:"planting",condition:()=>o.isAdult===!0},{playerAction:Se.Procreate,buttonAction:Te.ToggleProcreationBehavior,shortcut:"R",name:"Procreation",toggleKey:"procreation",condition:()=>o.isAdult===!0},{playerAction:Se.FeedChild,buttonAction:Te.ToggleFeedChildBehavior,shortcut:"H",name:"Feed Child",toggleKey:"feedChildren",condition:()=>o.isAdult===!0},{playerAction:Se.Attack,buttonAction:Te.ToggleAttackBehavior,shortcut:"Q",name:"Attack",toggleKey:"attack",condition:()=>o.isAdult===!0&&o.leaderId===o.id},{playerAction:Se.TribeSplit,buttonAction:Te.CommandTribeSplit,shortcut:"K",name:"Split Tribe",condition:()=>o.leaderId!==void 0&&o.leaderId!==o.id&&o.isAdult===!0},{playerAction:Se.Build,buttonAction:Te.CommandBuild,shortcut:"L",name:"Build",toggleKey:"build",condition:()=>o.isAdult===!0&&o.leaderId===o.id&&xo(o.id,t).length>iT}];m=m.filter(C=>C.condition?C.condition():!0);const S=1,y=m.length,I=y*kn+(y-1)*ir,T=S*kn+(S-1)*ir,E=(n-I)/2,P=e.canvas.height-T-20;if(m.forEach((C,_)=>{const k=_%y,w=Math.floor(_/y),M=E+k*(kn+ir),R=P+w*(kn+ir),H=!!C.toggleKey,j=H&&t.autopilotControls.behaviors[C.toggleKey],$=!p.has(C.playerAction),ee=C.playerAction===Se.Build&&t.buildMenuOpen,ue=!t.hasPlayerEnabledAutopilot||t.hasPlayerEnabledAutopilot<4?" (Press Shift to toggle Auto)":"",oe=H?`${C.name}${ue}`:C.name,re=j||ee?La:On,fe={id:`commandButton_${C.name}`,action:C.buttonAction,rect:{x:M,y:R,width:kn,height:kn},icon:$u[C.playerAction],text:C.shortcut,backgroundColor:re,textColor:Dt,currentWidth:kn,tooltip:oe,isDisabled:$,activated:j||C.buttonAction===Te.CommandBuild&&ee};t.uiButtons.push(fe)}),t.buildMenuOpen){const C=[{id:"buildMenu_storageSpot",action:Te.SelectStorageSpot,icon:"",shortcut:"1",name:"Storage Spot"},{id:"buildMenu_plantingZone",action:Te.SelectPlantingZone,icon:"",shortcut:"2",name:"Planting Zone"},{id:"buildMenu_palisade",action:Te.SelectPalisade,icon:"",shortcut:"3",name:"Palisade"},{id:"buildMenu_bonfire",action:Te.SelectBonfire,icon:"",shortcut:"4",name:"Bonfire"},{id:"buildMenu_borderPost",action:Te.SelectBorderPost,icon:"",shortcut:"5",name:"Border Post"},{id:"buildMenu_removal",action:Te.SelectRemovalTool,icon:"",shortcut:"6",name:"Remove Building"},{id:"buildMenu_gate",action:Te.SelectGate,icon:"",shortcut:"7",name:"Gate"}],_=C.length,k=_*kn+(_-1)*ir,w=(n-k)/2,M=P-kn-ir;C.forEach((R,H)=>{const j=w+H*(kn+ir),$=M,V=R.action===Te.SelectStorageSpot&&t.selectedBuildingType==="storageSpot"||R.action===Te.SelectPlantingZone&&t.selectedBuildingType==="plantingZone"||R.action===Te.SelectPalisade&&t.selectedBuildingType==="palisade"||R.action===Te.SelectBorderPost&&t.selectedBuildingType==="borderPost"||R.action===Te.SelectBonfire&&t.selectedBuildingType==="bonfire"||R.action===Te.SelectRemovalTool&&t.selectedBuildingType==="removal"||R.action===Te.SelectGate&&t.selectedBuildingType==="gate",ee={id:R.id,action:R.action,rect:{x:j,y:$,width:kn,height:kn},icon:R.icon,text:R.shortcut,backgroundColor:V?La:On,textColor:Dt,currentWidth:kn,tooltip:R.name,activated:V};t.uiButtons.push(ee),gh(e,ee,t.hoveredButtonId===ee.id)})}}let a=n-Je;s.forEach(h=>{const p=Je,m=a-h.currentWidth;h.rect={x:m,y:p,width:h.currentWidth,height:HS},gh(e,h,t.hoveredButtonId===h.id),a-=h.currentWidth+VC});let l=null;t.uiButtons.filter(h=>h.id.startsWith("commandButton_")||h.id.startsWith("buildMenu_")).forEach(h=>{l||(l={x:h.rect.x,y:h.rect.y,width:h.rect.width,height:h.rect.height}),l.x=Math.min(l.x,h.rect.x),l.y=Math.min(l.y,h.rect.y),l.width=Math.max(l.width,h.rect.x+h.rect.width-l.x),l.height=Math.max(l.height,h.rect.y+h.rect.height-l.y),h.id.startsWith("commandButton_")&&gh(e,h,t.hoveredButtonId===h.id)});const d=t.hoveredButtonId?t.uiButtons.find(h=>h.id===t.hoveredButtonId):void 0;return d&&d.tooltip&&t.mousePosition&&mD(e,d.rect,d.tooltip,t.mousePosition),e.restore(),{commandButtonsRect:l}}function vD(e){e.save(),e.fillStyle=KC,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle=QC,e.font=`${JC}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("PAUSED",e.canvas.width/2,e.canvas.height/2),e.restore()}function Vh(e,t,n,o){const s=t.x-n.width/2,a=t.y-n.height/2,l=s+e.x,u=a+e.y,d=(l%o.width+o.width)%o.width,h=(u%o.height+o.height)%o.height;return{x:d,y:h}}function El(e,t,n,o){let s=e.x-t.x,a=e.y-t.y;return Math.abs(s)>o.width/2&&(s=s-Math.sign(s)*o.width),Math.abs(a)>o.height/2&&(a=a-Math.sign(a)*o.height),{x:s+n.width/2,y:a+n.height/2}}function el(e,t,n,o){const s=El(e.position,t,n,o),l=("radius"in e?e.radius:20)+20;return s.x>=-l&&s.x<=n.width+l&&s.y>=-l&&s.y<=n.height+l}function $n(e,t,n,o,s,...a){const l={...s.position};for(let u=-n;u<=n;u+=n)for(let d=-t;d<=t;d+=t)s.position.x=l.x+d,s.position.y=l.y+u,o(e,s,...a);s.position=l}function lI(e,t){const n=document.createElement("canvas");n.width=e,n.height=t;const o=n.getContext("2d");if(!o)throw new Error("Could not get 2D context for offscreen canvas");return{canvas:n,ctx:o}}function si(e){const t=Math.sin(e)*1e4;return t-Math.floor(t)}function Cr(e,t){return Math.round(e*t)/t}function Up(e,t=8){const o=(Math.atan2(e.y,e.x)+Math.PI*2)%(Math.PI*2);return Math.round(o/(Math.PI*2)*t)%t}function Gp(e,t=8){const n=e/t*Math.PI*2;return[Math.cos(n),Math.sin(n)]}const SD=25,TD=0,tv=28;function cI(e,t,n,o,s,a,l,u,d,h){e.save();const{x:p,y:m}=El(t,l,{width:u,height:d},h);e.strokeStyle=o,e.lineWidth=a,e.setLineDash(s),e.beginPath(),e.arc(p,m,n+Lu,0,2*Math.PI),e.stroke(),e.restore()}function ID(e,t,n,o,s,a,l){if(t.length===0)return;e.save(),t.forEach(m=>{m.targetEntity&&cI(e,m.targetEntity.position,m.targetEntity.radius,Ap,Ep,2,o,s,a,l)}),e.font=`${Ts}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:u,y:d}=El(n.position,o,{width:s,height:a},l);let h=0,p={};t.forEach(m=>{const S=$u[m.type];if(m.targetEntity){p[m.targetEntity.id]=(p[m.targetEntity.id]||0)+1;const y=m.targetEntity.position.x-o.x+s/2,I=m.targetEntity.position.y-o.y+a/2,T=`${S}${m.key.toUpperCase()}`,E=I-m.targetEntity.radius-Lu-Ts/2-(p[m.targetEntity.id]-1)*tv;e.fillText(T,y,E)}else{e.textAlign="left";const y=`${S}${m.key.toUpperCase()}`,I=u+SD,E=d+TD+h*tv;e.fillText(y,I,E),h++,e.textAlign="center"}}),e.restore()}function AD(e,t,n,o,s,a,l){const h=oh+8+30,p={x:ky,y:a-ky-h,width:oh,height:oh};t.minimapRect=p,e.save(),e.fillStyle=wP,e.fillRect(p.x,p.y,p.width,p.height),e.strokeStyle=EP,e.lineWidth=2,e.strokeRect(p.x,p.y,p.width,p.height);const{width:m,height:S}=t.mapDimensions,y=Math.ceil(m/_e),I=Math.ceil(S/_e),T=new Map;o.forEach((se,ge)=>{const L=se.isPlayerTribe?0:ge%(Xt.length-1)+1;T.set(se.leaderId,Xt[L])});const E=p.width/y,P=p.height/I,C=p.x+p.width/2,_=p.y+p.height/2,k=y>400?4:y>200?2:1;for(let se=0;se<I;se+=k)for(let ge=0;ge<y;ge+=k){const L=se*y+ge,ce=t.terrainOwnership[L];if(ce!==null){const ye=(ge+.5)*_e,Ae=(se+.5)*_e,Z=xe(n,{x:ye,y:Ae},m,S),$e=C+Z.x/m*p.width,Le=_+Z.y/S*p.height,He=t.hoveredMinimapTribeId===ce;if(e.fillStyle=T.get(ce)||"#888",He){const it=(Math.sin(t.time*5)+1)/2;e.globalAlpha=.6+it*.4}else e.globalAlpha=.8;e.fillRect($e-E*k/2,Le-P*k/2,E*k,P*k)}}e.globalAlpha=1,e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip();for(const se of o){if(!se.territoryCenter)continue;const ge=xe(n,se.territoryCenter,m,S),L=C+ge.x/m*p.width,ce=_+ge.y/S*p.height;e.font="14px Arial",e.textAlign="center",e.textBaseline="middle",e.fillStyle="white",e.fillText(se.tribeBadge,L,ce),se.isPlayerTribe&&(e.strokeStyle="gold",e.lineWidth=1,e.beginPath(),e.arc(L,ce,10,0,Math.PI*2),e.stroke())}e.restore();const w=s/l,M=a/l,R=w/m*p.width,H=M/S*p.height;e.save(),e.beginPath(),e.rect(p.x,p.y,p.width,p.height),e.clip(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.strokeRect(C-R/2,_-H/2,R,H),e.restore(),e.restore();const j=p.y+p.height+8,$=p.x,V=j,ee="recenter_camera_btn",ue={id:ee,action:Te.RecenterCamera,rect:{x:$,y:V,width:30,height:30},text:"",currentWidth:30,backgroundColor:t.cameraFollowingPlayer?La:On,textColor:Dt,tooltip:"Lock camera to player"};t.uiButtons.push(ue),e.fillStyle=t.hoveredButtonId===ee?"#4a5568":ue.backgroundColor,e.fillRect($,V,30,30),e.strokeStyle="#666",e.strokeRect($,V,30,30);const oe=$+30/2,re=V+30/2,fe=30*.35;e.strokeStyle=Dt,e.lineWidth=2,e.beginPath(),e.arc(oe,re,fe,0,Math.PI*2),e.stroke();const ie=fe*.6;e.beginPath(),e.moveTo(oe-ie,re),e.lineTo(oe+ie,re),e.moveTo(oe,re-ie),e.lineTo(oe,re+ie),e.stroke(),e.fillStyle=Dt,e.beginPath(),e.arc(oe,re,2,0,Math.PI*2),e.fill();const W="open_tribe_modal_btn",te=`Tribes (${o.length})`;e.font='10px "Press Start 2P", Arial';const x=e.measureText(te),D=Math.max(30,x.width+16),G=30,J=$+30+8,pe=j,ne={id:W,action:Te.OpenTribeModal,rect:{x:J,y:pe,width:D,height:G},text:te,currentWidth:D,backgroundColor:On,textColor:Dt,tooltip:"View all tribes and diplomacy"};t.uiButtons.push(ne),e.fillStyle=t.hoveredButtonId===W?"#4a5568":On,e.fillRect(J,pe,D,G),e.strokeStyle="#666",e.strokeRect(J,pe,D,G),e.fillStyle=Dt,e.textAlign="center",e.textBaseline="middle",e.fillText(te,J+D/2,pe+G/2)}const De=(e,t,n,o,s,a,l)=>{a==="transparent"||o<=0||s<=0||(e.fillStyle=a,e.fillRect(Math.floor(t*l),Math.floor(n*l),Math.ceil(o*l),Math.ceil(s*l)))},nv=10,iv=10,yi=6,xi=4,Wc=2,ED=5,Gn=4,wD=2,en=4,CD=2,ft=3,es=2,Ro=0,tl=Ro+xi-1,ln=tl,At=tl+Gn-1,PD="rgba(0, 0, 0, 0.4)",_D=4,RD=1,$p={name:"tribe-human-2d",referenceImage:"swos.png",description:`A 2D human character asset for the Tribe game. This includes ensuring that the unique animations for stances like 'eat' and 'procreate' do not erroneously appear in other stances, such as 'walk', which was observed in the provided rendered media. The 'idle' animation was updated to a leg sway to better match the provided video for that stance, replacing a simpler body bob.

# Visual style

Human characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like people from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the character to give it a sense of depth.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 60, with 20 being the average age.
- gender: 
  - The male characters should have only pants, while female cover their breasts with a top. The clothing should be simple and muted, reflecting a stone-age style.
  - Female characters should have long hair, while male should have short hair and beard.
  - Male characters should have a more robust, muscular build
  - Female characters should have thinner arms and legs, with a more pronounced waist and hips.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'gathering': The character is gathering food from berry bushes, with arms reaching out and a slight bend at the knees.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'defending': The character takes a defensive stance, with arms raised and a slight bend at the knees.
- 'stunned': The character is stunned and laying on the ground, with limbs relaxed and a neutral expression.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a skeleton over time.

`,stances:["idle","walk","gathering","eat","procreate","dead","attacking","defending","stunned"],render(e,t,n,o,s,a,l,u="male",d=20,h=[1,0],p=!1,m=0){const S=["dead","stunned"].includes(l),y=S?iv+4:nv,I=S?nv+4:iv+ft,T=.15,E=Math.min(o*(1-2*T)/y,s*(1-2*T)/I),P=y*E,C=I*E,_=t+(o-P)/2,k=n+(s-C)/2;e.save(),h[0]<0&&!S?(e.translate(_+P,k),e.scale(-1,1)):e.translate(_,k);const M="#D09A5A",R=d>50?"#BDBDBD":"#281808",H="#7F5C4A",j="#6B4F3A",$="#E0D8C0",V="#A0522D",ee=1-Math.max(0,Math.min(100,m))/100*.2,ue=u==="male"?1.1:.9,oe=.8+(Math.max(1,Math.min(d,60))-1)/59*.2;let re=ED*ee*ue*oe,fe=wD*ee*ue*oe,ie=CD*ee*oe;p&&u==="female"&&(re*=1.5);const W=Math.round((y-re)/2),te=Math.round((y-yi)/2),x=W-fe,D=W+re,G=1,J=W+(re/2-G/2)-ie,pe=W+(re/2+G/2),ne=h[1]<-.2&&Math.abs(h[0])<.7,se=ce=>{e.fillStyle=PD,e.beginPath();const ye=y/2,Ae=ce;e.ellipse(Math.floor(ye*E),Math.floor(Ae*E),Math.max(1,Math.floor(_D*E)),Math.max(1,Math.floor(RD*E)),0,0,2*Math.PI),e.fill()},ge=(ce,ye)=>{u==="male"?(De(e,W,tl+ce,re,Gn-es,ye,E),De(e,W,tl+Gn-es+ce,re,es,H,E)):De(e,W,tl+ce,re,Gn,j,E)},L=(ce,ye)=>{ne?De(e,te,Ro+ce,yi,xi,R,E):(De(e,te,Ro+ce,yi,xi,ye,E),De(e,te,Ro+ce,yi,Wc,R,E),u==="female"?(De(e,te-1,Ro+Wc+ce,1,xi,R,E),De(e,te+yi,Ro+Wc+ce,1,xi,R,E)):De(e,te+1,Ro+2+ce,yi-2,xi-2,R,E))};switch(l){case"idle":{const ce=a*Math.PI*2,ye=Math.sin(ce)*.5,Z=(Math.cos(ce*2)+1)*.25;se(At+ft+1),De(e,J+ye,At+Z,ie,ft,M,E),De(e,pe-ye,At+Z,ie,ft,M,E),ge(Z,M),De(e,x,ln+Z,fe,en,M,E),De(e,D,ln+Z,fe,en,M,E),L(Z,M);break}case"walk":{const ce=a*Math.PI*2,ye=Math.sin(ce)*2,Z=Math.abs(Math.cos(ce))*1;se(At+ft+1),De(e,J+ye,At+Z,ie,ft,M,E),De(e,pe-ye,At+Z,ie,ft,M,E),ge(Z,M),De(e,x-ye,ln+Z,fe,en,M,E),De(e,D+ye,ln+Z,fe,en,M,E),L(Z,M);break}case"gathering":{const ce=a*Math.PI*2,ye=1,Ae=(Math.sin(ce)+1)/2*2,Z=ye+Math.abs(Math.cos(ce))*.5;se(At+ft+1),De(e,J,At+Z,ie,ft-ye,M,E),De(e,pe,At+Z,ie,ft-ye,M,E),ge(Z,M),De(e,x+1,ln+Z-Ae,fe,en,M,E),De(e,D-1,ln+Z-Ae,fe,en,M,E),L(Z,M);break}case"eat":{se(At+ft+1),De(e,J,At+1,ie,ft-1,M,E),De(e,pe,At+1,ie,ft-1,M,E),ge(1,M);const Ae=(Math.sin(a*Math.PI*4)+1)/2,Z=te+yi/2,$e=Ro+xi/2,Le=D+(Z-D)*Ae,He=ln+1+($e-(ln+1))*Ae;De(e,x,ln+1,fe,en,M,E),De(e,Le,He,fe,en,M,E),De(e,Le,He-1,1,1,V,E),L(1,M);break}case"procreate":{const ce=(Math.sin(a*Math.PI*8)+1)/4,ye=(Math.sin(a*Math.PI*6)+1)*.5,Ae=1.5,Z=Ae-ye;se(At+ft+1),De(e,J,At+Z,ie,ft-Ae,M,E),De(e,pe,At+Z,ie,ft-Ae,M,E),ge(Z,M),De(e,x,ln+Z,fe,en,M,E),De(e,D,ln+Z,fe,en,M,E),L(Z,M),e.globalAlpha=ce,ge(Z,"white"),e.globalAlpha=1;break}case"attacking":{const ce=Math.sin(a*Math.PI)*1.5,ye=Math.abs(Math.sin(a*Math.PI));se(At+ft+1),De(e,J-ce,At+ye,ie,ft,M,E),De(e,pe+ce*.5,At+ye,ie,ft,M,E),ge(ye,M),De(e,x,ln+ye-2,fe,en,M,E),De(e,D,ln+ye-2.5,fe,en,M,E),L(ye,M);break}case"defending":{se(At+ft+1),De(e,J,At+1,ie,ft-1,M,E),De(e,pe,At+1,ie,ft-1,M,E),ge(1,M),De(e,x-1,ln+1-1,fe,en,M,E),De(e,D+1,ln+1-1,fe,en,M,E),L(1,M);break}case"stunned":case"dead":{const ce=l==="dead",ye=ce?Math.min(1,a):0,Ae=ye>.5?$:M,Z=u==="male"?H:j,$e=ye>.8?"transparent":R,Le=y/2,He=I/2,it=2;se(I-1),De(e,Le-ie-it,He,ie,ft,Ae,E),De(e,Le+it,He,ie,ft,Ae,E),De(e,Le-fe-it,He-Gn+1,fe,en,Ae,E),De(e,Le+it,He-Gn+1,fe,en,Ae,E);const St=Le-re/2,Et=He-Gn/2;u==="male"?(ye<.7&&De(e,St,Et+Gn-es,re,es,Z,E),De(e,St,Et,re,Gn-es,Ae,E)):ye<.7?De(e,St,Et,re,Gn,Z,E):De(e,St,Et,re,Gn,Ae,E);const ot=Le-yi/2,qt=He-Gn/2-xi+1;if(De(e,ot,qt,yi,xi,Ae,E),$e!=="transparent"&&De(e,ot,qt,yi,Wc,$e,E),ce&&ye>.6){const En="#B0A890";for(let to=0;to<3;to++)De(e,St+1,Et+to*1+1,re-2,.5,En,E)}break}default:De(e,0,0,y,I,"magenta",E);break}e.restore()}};function kD(e,t,n,o,s){const a=t.x,l=t.y-n-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-o/2,l,o,o/2),e.fill(),e.beginPath(),e.moveTo(a-o/2,l),e.lineTo(a-o/4,l-o/3),e.lineTo(a-o/6,l),e.moveTo(a-o/6,l),e.lineTo(a,l-o/2),e.lineTo(a+o/6,l),e.moveTo(a+o/6,l),e.lineTo(a+o/4,l-o/3),e.lineTo(a+o/2,l),e.stroke(),e.restore()}function hl(e,t,n,o,s,a=!1,l=!1,u=!1,d=!1){o<fp&&(n=n*.75),$p.render(e,t.x-n/2,t.y-n/2,n,n,0,"idle",s,o,[0,0],!1,0);let h,p;a?(h=UC,p=DS):l?(h=GC,p=BS):u?(h=$C,p=NS):d&&(h=WC,p=OS),h&&p&&kD(e,t,n/2,h,p)}function MD(e,t,n,o,s,a){if(e.save(),o.length===0){e.restore();return}const l=o.length*s,u=4;let d;const h=l+(o.length-1)*u;o.length>1&&h>a?d=(a-l)/(o.length-1):d=u,o.length<=1&&(d=0);for(let p=0;p<o.length;p++){const{member:m,isPlayer:S,isHeir:y,isPartner:I,isParent:T}=o[p],E=t+p*(s+d)+s/2,P=n+s/4;hl(e,{x:E,y:P},s,m.age,m.gender,S,y,I,T)}e.restore()}function bD(e,t,n,o,s){e.save(),e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(0,0,o,s);const a=500,l=Math.min(s*.8,n.length*(wa+Ty)+120),u=(o-a)/2,d=(s-l)/2;e.fillStyle="#2d3748",e.strokeStyle="#4a5568",e.lineWidth=4,e.fillRect(u,d,a,l),e.strokeRect(u,d,a,l),e.fillStyle="#fff",e.font='20px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="top",e.fillText("WORLD TRIBES",o/2,d+30);const h=d+80,p=a-Ca*4,m=u+Ca*2;for(let C=0;C<n.length;C++){const _=n[C],k=h+C*(wa+Ty);if(k+wa>d+l-60)break;const w=k+wa/2;_.isPlayerTribe&&(e.fillStyle="rgba(255, 215, 0, 0.2)",e.fillRect(m,k,p,wa));let M=m+Ca;if(e.font=`${nr}px "Press Start 2P", Arial`,e.textBaseline="middle",e.textAlign="left",e.fillStyle="white",e.fillText(_.tribeBadge,M,w),M+=nr+Ca*2,_.isPlayerTribe)e.fillStyle="#aaa",e.font='10px "Press Start 2P", Arial',e.textAlign="left",e.fillText("(YOU)",M,w);else{const R=_.diplomacyStatus===bt.Friendly?"":"",H=`modal_diplomacy_${_.leaderId}`,j={x:M,y:w-nr/2,width:nr*1.5,height:nr},$={id:H,action:Te.ToggleDiplomacy,rect:j,text:"",icon:R,backgroundColor:"transparent",textColor:"white",currentWidth:j.width,tooltip:`Set status to ${_.diplomacyStatus===bt.Friendly?"Hostile":"Friendly"}`,targetTribeId:_.leaderId};t.uiButtons.push($),t.hoveredButtonId===H&&(e.fillStyle=wp,e.fillRect(j.x,j.y,j.width,j.height)),e.font=`${nr*.8}px Arial`,e.textAlign="center",e.fillText(R,j.x+j.width/2,w)}M+=nr*2+Ca,hl(e,{x:M+10,y:w},Gi*.6,25,"male"),e.fillStyle="white",e.font=`${YC}px "Press Start 2P"`,e.fillText(`${_.adultCount}`,M+30,w),M+=80,hl(e,{x:M+10,y:w},Gi*.6,5,"female"),e.fillText(`${_.childCount}`,M+30,w)}const S=120,y=40,I=o/2-S/2,T=d+l-60,E="close_tribe_modal_btn",P={id:E,action:Te.CloseTribeModal,rect:{x:I,y:T,width:S,height:y},text:"CLOSE",currentWidth:S,backgroundColor:On,textColor:Dt};t.uiButtons.push(P),e.fillStyle=t.hoveredButtonId===E?"#4a5568":On,e.fillRect(I,T,S,y),e.strokeStyle="#fff",e.strokeRect(I,T,S,y),e.fillStyle=Dt,e.font='12px "Press Start 2P", Arial',e.textAlign="center",e.textBaseline="middle",e.fillText("CLOSE",o/2,T+y/2),e.restore()}function DD(e,t,n,o,s){const a=jS,l=zS,u=t+o-a-l,d=n+l;e.save(),e.lineWidth=2,e.strokeStyle=s?cP:lP,e.beginPath();const h=5;e.moveTo(u+h,d+h),e.lineTo(u+a-h,d+a-h),e.moveTo(u+a-h,d+h),e.lineTo(u+h,d+a-h),e.stroke(),e.restore()}function OD(e,t,n,o){const{tutorialState:s,tutorial:a}=t;if(s.transitionState===tn.INACTIVE)return;const l=a.steps[s.currentStepIndex];if(!l)return;e.save(),e.globalAlpha=s.transitionAlpha;const u=eP,d=tP,h=nP,p=`${nh}px "Press Start 2P", Arial`,m=`${Cy}px "Press Start 2P", Arial`,S=oP,y=Cy*1.5;e.font=m;const I=l.text.split(" ");let T="";const E=[];for(let $=0;$<I.length;$++){const V=T+I[$]+" ";e.measureText(V).width>u-d*2&&$>0?(E.push(T),T=I[$]+" "):T=V}E.push(T);const P=d*2+nh+d/2+E.length*y,C=(n-u)/2,_=o-P-160;e.fillStyle=iP,e.beginPath(),e.moveTo(C+h,_),e.lineTo(C+u-h,_),e.quadraticCurveTo(C+u,_,C+u,_+h),e.lineTo(C+u,_+P-h),e.quadraticCurveTo(C+u,_+P,C+u-h,_+P),e.lineTo(C+h,_+P),e.quadraticCurveTo(C,_+P,C,_+P-h),e.lineTo(C,_+h),e.quadraticCurveTo(C,_,C+h,_),e.closePath(),e.fill(),e.fillStyle=S,e.textAlign="center",e.textBaseline="top",e.font=p,e.fillText(l.title,C+u/2,_+d),e.font=m;let k=_+d+nh+d/2;for(const $ of E)e.fillText($,C+u/2,k),k+=y;const w=t.hoveredButtonId==="tutorial-dismiss";DD(e,C,_,u,w),e.restore();const M=jS,R=zS,H=C+u-M-R,j=_+R;return{x:H,y:j,width:M,height:M}}function mh(e,t,n){e.save();const o=aP,s={x:t.x-o,y:t.y-o,width:t.width+o*2,height:t.height+o*2};e.strokeStyle=WS,e.lineWidth=YS+Math.sin(n*Cp)*1.5,e.setLineDash([8,8]),e.strokeRect(s.x,s.y,s.width,s.height),e.restore()}function ND(e,t){e.fillStyle="white",e.font='30px "Press Start 2P", Arial',e.textAlign="center",e.fillText("Game Over!",e.canvas.width/2,e.canvas.height/2-60),e.font='20px "Press Start 2P", Arial',e.fillText("Lineage Extinct.",e.canvas.width/2,e.canvas.height/2-20),e.fillText(`Cause: ${t.causeOfGameOver||"Unknown"}`,e.canvas.width/2,e.canvas.height/2+20)}const uI=10,BD=3,ov=uI*.7;function HD(e,t){const{position:n,food:o,maxFood:s}=t;if(e.beginPath(),e.arc(n.x,n.y,uI,0,Math.PI*2),e.fillStyle="#228B22",e.fill(),e.strokeStyle="#006400",e.lineWidth=1,e.stroke(),o.length>0){const a=Math.PI*2/Math.min(o.length,s);for(let l=0;l<o.length;l++){const u=l*a,d=n.x+ov*Math.cos(u),h=n.y+ov*Math.sin(u);e.beginPath(),e.arc(d,h,BD,0,Math.PI*2),e.fillStyle="#FF0000",e.fill()}}}const rv=(e,t,n=70,o=50)=>{const s=e>>t&255;return`hsl(${Math.floor(s/255*360)}, ${n}%, ${o}%)`},FD=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(!n)return e;const[o,s,a]=[parseInt(n[1]),parseInt(n[2]),parseInt(n[3])];return`hsl(${o}, ${s}%, ${Math.max(0,a-t)}%)`},Yc=(e,t,n,o,s,a,l,u=!1)=>{e.save(),e.translate(t,n),e.rotate(a),e.fillStyle=u?FD(l,15):l,e.beginPath(),e.roundRect(-o/2,0,o,s,o/2),e.fill(),e.restore()},yh=(e,t)=>{const n=e.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/),o=75;if(!n)return`hsl(0, 0%, ${o}%)`;const[,s,a,l]=n.map(Number),u=a*(1-t),d=l+(o-l)*t;return`hsl(${s}, ${u}%, ${d}%)`},dI={name:"tribe-prey-2d",referenceImage:"swos.png",description:`A 2D prey asset for the Tribe game, featuring various stances and animations.

Prey is an animal which can be hunted by predators or humans in the Tribe game.

Preys look like small 4 leg mammals, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Prey characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Prey walks on all fours, unlike human (two legs).

Each prey is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Prey should have should have visible body parts, such as head, torso, arms, and legs. The body parts should be connected and should not overlap. The character's body parts should be simple shapes, such as circles and rectangles, with solid colors and no gradients or patterns.

Preys are supposed to be sympathetic and friendly, so the character's face should have a friendly expression, with a smile and bright eyes. The character's eyes should be large and expressive, with a simple design.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 0 and 12, with 2 being the average age.
- gender:
  - 'male': Male prey are larger and more robust, with a more pronounced musculature.
  - 'female': Female prey are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","procreate"],render(e,t,n,o,s,a,l,u={gender:"male",age:2,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){e.save(),e.imageSmoothingEnabled=!1;const d=o*.15,h=t+o/2,p=n+s/2,m=o-d*2,S=s-d*2,{gender:y,age:I,direction:T,isPregnant:E,hungryLevel:P,geneCode:C}=u,_=.8+Math.min(I,10)/10*.4,k=y==="male"?1.05:.95,w=1-P/100*.3,M=m*.5*w*_*k;let R=S*.3*_*k;const H=m*.15*_*k,j=M*.2,$=S*.3,V=rv(C,0,30,50);let ee=rv(C,8,50,40);if(I>45){const se=Math.min(1,(I-45)/15);ee=yh(ee,se)}e.translate(h,p),T[0]<0&&e.scale(-1,1);const ue=Math.sin(a*Math.PI*2),oe=Math.cos(a*Math.PI*2),re=$+R*.2;if(l==="dead"){const se=Math.min(a,1);e.translate(0,S*.2),e.rotate(Math.PI/2);const ge=yh(ee,se),L=yh(V,se);e.globalAlpha=.5+se*.5,e.strokeStyle=ge,e.lineWidth=j*.5,e.beginPath(),e.moveTo(-M*.4,0),e.lineTo(M*.4,0),e.stroke();for(let ce=-1;ce<=1;ce+=1)e.beginPath(),e.arc(0,0,R*.4,Math.PI*.4*ce-Math.PI*.2,Math.PI*.4*ce+Math.PI*.2),e.stroke();e.fillStyle=L,e.beginPath(),e.arc(M*.5,0,H,0,Math.PI*2),e.fill(),e.fillStyle="black",e.beginPath(),e.arc(M*.55,0,H*.3,0,Math.PI*2),e.fill(),e.restore();return}e.fillStyle="rgba(0, 0, 0, 0.1)",e.beginPath(),e.ellipse(0,re,M*.7,M*.25,0,0,2*Math.PI),e.fill();let fe=0,ie=0,W=0,te=0,x=0,D=0;switch(l){case"idle":ie=ue*(S*.02),W=ue*.05,te=-ue*.05,x=-ue*.05,D=ue*.05;break;case"walk":ie=Math.abs(oe)*(S*-.04),W=ue*.7,te=-ue*.7,x=-ue*.7,D=ue*.7;break;case"eat":fe=S*.1,ie=S*.05,fe+=ue*(S*.02);break;case"procreate":ie=S*.05;const se=(1-oe)*-m*.05;e.translate(se,0),e.shadowColor="rgba(255, 182, 193, 0.9)",e.shadowBlur=10;break}E&&y==="female"&&(R*=1.6);const G=ie,J=G-R*.2;Yc(e,M*-.35,J,j,$,x,ee,!0),Yc(e,M*.35,J,j,$,D,ee,!0),e.fillStyle=ee,e.beginPath(),e.ellipse(0,G,M/2,R/2,0,0,2*Math.PI),e.fill();const pe=M*.45,ne=J+fe;e.fillStyle=V,e.beginPath(),e.arc(pe,ne,H,0,Math.PI*2),e.fill(),T[1]>=0&&(e.fillStyle="black",e.beginPath(),e.arc(pe+H*.3,ne-H*.2,H*.15,0,Math.PI*2),e.fill()),Yc(e,M*-.35,J,j,$,W,ee),Yc(e,M*.35,J,j,$,te,ee),e.restore()}};function xD(e,t){let[n,o,s]=e.match(/\d+/g).map(Number);return n=Math.max(0,n-t),o=Math.max(0,o-t),s=Math.max(0,s-t),`rgb(${n}, ${o}, ${s})`}function LD(e){const t=(e&16711680)>>16,n=(e&65280)>>8,o=e&255,s=`rgb(${t}, ${n}, ${o})`,a=xD(s,40),l=(e&255)%100+50,u=(e>>8&255)%100,d=(e>>16&255)%100,h=`rgb(${l}, ${u}, ${d})`,p=(e&8388608)!==0?"#00aaff":"#ffaa00";return{furColor:s,darkerFurColor:a,skinColor:h,eyeColor:p}}const fI={name:"tribe-predator-2d",referenceImage:"swos.png",description:`A 2D predator asset for the Tribe game, featuring various stances and animations.

Predator is an animal which can hunt and attack humans in the Tribe game. It is designed to be a threat to the player, adding an element of danger and challenge to the game world.

Predator look like bears or wolves, with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

# Visual style

Predator characters in the Tribe game are inspired by classic 2D pixel art, they look like Sensible Soccer players(Sensible Soccer game visual style is IMPORTANT), with a simple and recognizable design. The characters are designed to be easily distinguishable and animated in a way that conveys their actions clearly.

Character in Tribe game look like creatures from stone age, they have simple clothing, no shoes, and no modern accessories. The characters are designed to be easily distinguishable and animated in away that conveys their actions clearly.

Predator walks on arms and legs, unlike human (two legs).

Each predator is described by a unique gene code, which is a number that defines its appearance, size, and other characteristics. The gene code is used to generate the character's appearance, including body proportions, color, and other visual features. The gene code is a 32-bit integer, with each bit representing a specific characteristic of the character.

Predator should have visible ears, eyes, and mouth with teeth. It must have a tail. Front legs should be shorter than back legs, and they should be positioned closer to the body. The character's body should be wider at the top and narrower at the bottom, with a slight curve to the back. The character's head should be larger than the body, with a pronounced jaw and sharp teeth.

# Technical details

The asset is rendered on a canvas using the CanvasRenderingContext2D API. The rendering function takes parameters for position, size, progress, stance, direction, gender, and age. The character can face left or right, and the rendering adapts based on the stance (e.g., idle, walk, eat, procreate).
The rendering function must be simple and efficient, it should not use complex patterns or gradients, and should focus on solid colors and basic shapes to maintain the pixel art aesthetic.

15% padding from all edges of the rendering box is required to ensure the character is not cut off during rendering.

Subtle shadow should be drawn under the a character to give it a sense of depth.

IMPORTANT: The character is visible from the side, just like in Sensible Soccer.

# Rendering parameters

- age: The age of the character, which affects the size and proportions of the body parts. Age is a number between 1 and 20, with 3 being the average age.
- gender:
  - 'male': Male predators are larger and more robust, with a more pronounced musculature.
  - 'female': Female predators are smaller and more agile, with a leaner build.
- isPregnant: (applicable only for females) Indicates if the character is pregnant, like very large belly. Pregnant characters should have a larger torso.
- direction: A vector indicating the character's facing direction. There should be at least 8 directions (like in Sensible Soccer): top left, top, top right, left, right, bottom left, bottom, bottom right. The character should be flipped horizontally if the direction vector's X component is negative.
             When moving up(top, top left, top right), the character back of the head should be visible, when moving down(Y > 0), the character face should be visible.
- hungryLevel: A number between 0 and 100 indicating how hungry the character is, hunger level 100 means the character is starving, 0 means the character is not hungry at all. So hungry characters should be thinner, with less body fat, and more pronounced muscles. The character's hunger level affects the size and proportions of the body parts, with hungrier characters being smaller and more gaunt.

# Rendering details

- All parts of the body must be connected
- Rendering must take into account direction vector (X and Y) to flip the character horizontally if needed
- The character's age affects the size and proportions of the body parts, with older characters being larger and more robust. Hair color should become gray for older characters.

# Stances

- 'idle': The character stands still, with a slight leg sway to indicate life.
- 'walk': The character moves forward, with legs and arms in motion.
- 'eat': The character holds food and brings it to their mouth, with a slight bend at the knees.
- 'procreate': The character performs a mating animation, with a specific pose and movement. There should be some additional visual effects to indicate this action, such as a slight glow or aura around the characters, or a dust particles to indicate movement.
- 'attacking': The character performs an attack animation, with arms raised and a forward motion.
- 'dead': The character lies on the ground, with limbs relaxed and a neutral expression, slowly turns into a grey skeleton over time. The character pose and body parts should not be animated in this stance, as the character is dead so it should not move.`,stances:["idle","walk","eat","dead","attacking","procreate"],render(e,t,n,o,s,a,l,u={gender:"male",age:20,direction:[1,0],isPregnant:!1,hungryLevel:0,geneCode:8405024}){const{gender:d,age:h,direction:p,isPregnant:m,hungryLevel:S,geneCode:y}=u;e.save();const I=o*.15,T=Math.max(1,Math.floor((o-I*2)/10)),E=p[0]<0;e.translate(t+o/2,n+s/2),E&&e.scale(-1,1);const P=LD(y),C=.8+Math.min(h,20)/20*.4,_=d==="male"?1.05:.95,k=1-S/100*.25,w=C*_*k,M=Math.max(0,Math.min(1,(h-15)/5));e.filter=`grayscale(${M})`;const R=P.furColor,H=P.darkerFurColor,j=P.eyeColor,$="#FFFFFF",V="#c75c5c",ee="#E0E0E0",ue="#A0A0A0",oe=s/2-2*T,re=Math.sin(a*Math.PI*2),fe=Math.abs(re);if(e.fillStyle="rgba(0,0,0,0.15)",e.beginPath(),e.ellipse(0,oe,T*4,T,0,0,2*Math.PI),e.fill(),e.filter="none",l==="dead"){const Le=Math.min(1,a*2);e.save(),e.translate(0,oe-T*3),e.rotate(-Math.PI/2);const He=(it,St,Et,ot,qt=!1)=>{e.fillStyle=qt?ue:ee,e.fillRect(it*T,St*T,Et*T,ot*T)};Le<1&&(e.globalAlpha=1-Le,e.fillStyle=R,e.beginPath(),e.ellipse(0,0,T*3,T*5,0,0,Math.PI*2),e.fill(),e.globalAlpha=1),Le>0&&(e.globalAlpha=Le,He(-1,-4,2,2),He(1,-3.5,1,1,!0),He(-.5,-2,1,5,!0),He(-2.5,-1,5,.5),He(-2.5,0,5,.5),He(-2.5,1,5,.5),He(-3,-2,-1,2,!0),He(3,-2,1,2),He(-3,2,-1,2,!0),He(3,2,1,2),e.globalAlpha=1),e.restore(),e.restore();return}e.fillStyle=R;let ie=0,W=0,te=0,x=[0,0,0,0];switch(l){case"idle":ie=re*T*.1;break;case"walk":const Le=Math.sin(a*Math.PI*4);ie=Math.abs(Le)*-T*.5,x=[Le*T,-Le*T,-Le*T,Le*T];break;case"attacking":const He=Math.sin(a*Math.PI*4);W=T*2+He*T,te=T*2,ie=T;break;case"eat":te=T*3+fe*T,ie=T*1.5,e.fillStyle=V,e.fillRect(-T,oe-T,T*2,T);break;case"procreate":ie=Math.sin(a*Math.PI*8)*T*.3,e.fillStyle="rgba(139, 69, 19, 0.5)";for(let St=0;St<5;St++){const Et=(Math.random()-.5)*T*8,ot=oe+(Math.random()-.5)*T*2;fe>.5&&e.fillRect(Et,ot,T*.5,T*.5)}break}const D=T*3*w*(m?1.3:1),G=T*5*w,J=-G/1.5,pe=oe-D-T*2.5+ie;e.fillStyle=R,e.beginPath(),e.moveTo(J-T*.5,pe+D*.5),e.quadraticCurveTo(J-T*3,pe-T,J-T*2+re*T,pe+D+T),e.fill();const ne=T*1.2*w,se=T*3*w,ge=T*2.5*w,L=J+G*.8,ce=J+G*.2;e.fillStyle=H,e.fillRect(ce,oe-ge,ne,ge+x[2]),e.fillRect(L,oe-se,ne,se+x[0]),e.fillStyle=R,e.beginPath(),e.moveTo(J,pe+D),e.lineTo(J,pe+T),e.quadraticCurveTo(J+G/2,pe,J+G,pe+T),e.lineTo(J+G,pe+D),e.fill(),e.fillStyle=R,e.fillRect(ce+T/2,oe-ge,ne,ge+x[3]),e.fillRect(L+T/2,oe-se,ne,se+x[1]);const ye=T*3.5*w,Ae=J+G-ye*.3+W,Z=pe-ye*.3+te;e.fillStyle=R,e.beginPath(),e.arc(Ae,Z,ye/2,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(Ae+ye*.4,Z+ye*.2,T*1.5,T,0,0,Math.PI*2),e.fill(),p[1]>=0&&(e.fillStyle=j,e.fillRect(Ae+T*.5,Z-T*.5,T*.5,T*.5),l==="attacking"&&(e.fillStyle=$,e.fillRect(Ae+ye*.5,Z+ye*.4,T,T*.4))),e.fillStyle=H,e.beginPath(),e.moveTo(Ae-ye*.4,Z-ye*.3),e.lineTo(Ae,Z-ye*.7),e.lineTo(Ae,Z-ye*.2),e.fill(),e.restore()}};class wl{constructor(t=200){Yt(this,"cache",new Map);Yt(this,"maxSize");this.maxSize=t}getOrRender(t,n,o,s){const a=this.cache.get(t);if(a)return this.cache.delete(t),this.cache.set(t,a),a;const{canvas:l,ctx:u}=lI(n,o);if(s(u),this.cache.size>=this.maxSize){const d=this.cache.keys().next().value;d!==void 0&&this.cache.delete(d)}return this.cache.set(t,l),l}clear(){this.cache.clear()}}const UD=9,GD=new wl(200);function $D(e,t){const{position:n,gender:o,age:s,decayProgress:a,food:l,radius:u,originalEntityType:d,geneCode:h}=t,p=Cr(a,20),m=Math.floor(s),S=`${d}_${o}_${m}_${p}_${u}_${h||0}`,y=Math.ceil(u*2)+4,I=GD.getOrRender(S,y,y,T=>{T.translate(y/2,y/2),d==="human"?$p.render(T,-y/2+2,-y/2+2,y-4,y-4,p,"dead",o,m,[0,0],!1,0):d==="prey"?dI.render(T,-y/2+2,-y/2+2,y-4,y-4,p,"dead",{gender:o,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024}):d==="predator"&&fI.render(T,-y/2+2,-y/2+2,y-4,y-4,p,"dead",{gender:o,age:m,direction:[0,0],isPregnant:!1,hungryLevel:0,geneCode:h||8405024})});if(e.save(),e.globalAlpha=1-a,e.drawImage(I,n.x-I.width/2,n.y-I.height/2),e.restore(),l.length>0){e.save(),e.font=`${UD}px Arial`,e.textAlign="center",e.textBaseline="middle";const T=ut*.9,E=Math.PI/yS*3;l.forEach((P,C)=>{const _=C*E,k=n.x+T*Math.cos(_)*Math.atan2(C,C),w=n.y+T*Math.sin(_)*Math.atan2(C,C),M=cp[P.type];e.fillText(M,k,w)}),e.restore()}}function Oo(e,t,n,o,s,a,l,u){e.save(),e.fillStyle=l,e.fillRect(t,n,o,s),e.fillStyle=u,e.fillRect(t,n,o*Math.max(0,a),s),e.restore()}function WD(e,t,n,o,s,a){if(e.save(),o.length===0){e.restore();return}const l=o.length*s;let u;l>a||l+(o.length-1)*4>a?u=(a-l)/(o.length-1):u=4,o.length===1&&(u=0);for(let d=0;d<o.length;d++){const h=cp[o[d].type];e.fillText(h,t+d*(s+u),n)}e.restore()}function YD(e,t,n,o,s){const a=t.autopilotControls.hoveredAutopilotAction;if(!a)return;let l,u=ut/2;const d=$u[a.action],h=tT[a.action],p=`${d} ${h}`;if("targetEntityId"in a){const m=t.entities.entities[a.targetEntityId];m&&(l=m.position,u=m.radius)}else"position"in a&&(l=a.position);if(l){cI(e,l,u,Ap,Ep,2,n,o,s,t.mapDimensions),e.save(),e.font=`${Ts}px "Press Start 2P", Arial`,e.fillStyle="white",e.textAlign="center",e.textBaseline="bottom",e.shadowColor="black",e.shadowBlur=5;const{x:m,y:S}=El(l,n,{width:o,height:s},t.mapDimensions),y=S-u-Lu-Ts/2;e.fillText(p,m,y),e.restore()}}function jD(e,t,n,o,s){e.save();const a=(Math.sin(s*Cp)+1)/2,l=n+Lu+a*5;e.strokeStyle=Ap,e.lineWidth=2,e.setLineDash(Ep),e.beginPath(),e.arc(t.x,t.y,l,0,Math.PI*2),e.stroke(),e.setLineDash([]);const u=$u[o],d=tT[o];if(u){e.font=`${Ts*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle";const h=t.y-l-25;e.fillText(u,t.x,h),e.font=`${Ts*.8}px "Press Start 2P", Arial`,e.fillText(d,t.x,h+25)}e.restore()}function zD(e,t){const{activeAutopilotAction:n}=t.autopilotControls;if(Nt(t)&&n){let s,a=15;if("position"in n)s=n.position;else if("targetEntityId"in n){const l=t.entities.entities[n.targetEntityId];l&&(s=l.position,a=l.radius||(l.type==="building"?20:30))}if(s){const l=(u,d)=>{jD(u,d.position,a,n.action,t.time)};$n(e,t.mapDimensions.width,t.mapDimensions.height,l,{position:{...s}},s,a+30)}}}function sv(e,t,n,o,s,a,l=!0){const u=t.split(" ");let d="";const h=[];for(let p=0;p<u.length;p++){const m=d+u[p]+" ";e.measureText(m).width>s&&p>0?(h.push(d),d=u[p]+" "):d=m}if(h.push(d),l)for(let p=0;p<h.length;p++)e.fillText(h[p],n,o+p*a);return h.length*a}function XD(e){return 1-Math.pow(1-e,3)}function VD(e,t,n,o){t.notificationButtonRects={dismiss:{},view:{}};const s=t.notifications.filter(l=>!l.isDismissed);if(s.length===0)return;e.save();let a=o-vP;for(const l of s){const u=n-xc-or;e.font=`${ih}px "Press Start 2P", Arial`;const d=u+or,h=xc-or*2,p=sv(e,l.message,-9999,-9999,h,ih*1.2,!1),m=or*2+p+mi,S=a-m,y=Date.now()-l.creationTime,I=Math.min(y/yP,1),T=XD(I),E=o,P=E+(S-E)*T;e.fillStyle=dP,e.beginPath(),e.roundRect(u,P,xc,m,uP),e.fill(),e.fillStyle=fP,e.textBaseline="top",sv(e,l.message,d,P+or,h,ih*1.2,!0);const C=P+m-mi-or/2,_=u+xc-mi-or/2,k={x:_,y:C,width:mi,height:mi};t.notificationButtonRects&&(t.notificationButtonRects.dismiss[l.id]=k);const w=t.hoveredButtonId===`notification-dismiss-${l.id}`;if(e.fillStyle=w?Ry:hP,e.font=`${mi}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("",k.x+k.width/2,k.y+k.height/2),l.targetEntityIds||l.targetPosition||l.targetArea||l.targetRadius){const H={x:_-mi-_y,y:C,width:mi,height:mi};t.notificationButtonRects&&(t.notificationButtonRects.view[l.id]=H);const j=t.hoveredButtonId===`notification-view-${l.id}`;e.fillStyle=j?Ry:pP,e.font=`${mi*(j?1.5:1.2)}px Arial`,e.fillText("",H.x+H.width/2,H.y+H.height/2)}a-=m+_y}e.restore()}function qD(e){return e.length===0?0:e.reduce((n,o)=>n+o,0)/e.length}function vh(e,t,n,o,s,a,l,u){e.save(),e.fillStyle="rgba(255, 255, 255, 0.1)",e.fillRect(o,s,a,l),e.strokeStyle="#555",e.lineWidth=1,e.strokeRect(o,s,a,l);const d=qD(n);e.fillStyle="white",e.font="11px monospace",e.textAlign="left",e.fillText(`${t}: ${d.toFixed(2)}ms`,o+Je,s+Je+8);const h=Math.max(...n,1),p=n.map(m=>m/h*l);if(e.beginPath(),e.strokeStyle=u,e.lineWidth=2,p.length>1){e.moveTo(o,s+l-p[0]);for(let m=1;m<p.length;m++){const S=o+m/(p.length-1)*a,y=s+l-p[m];e.lineTo(S,y)}}else if(p.length===1){const m=s+l-p[0];e.moveTo(o,m),e.lineTo(o+a,m)}e.stroke(),e.fillStyle="rgba(255, 255, 255, 0.7)",e.font="10px monospace",e.textAlign="right",e.fillText(`${h.toFixed(2)}ms`,o+a-Je,s+Je+8),e.restore()}function ZD(e,t,n){const{performanceMetrics:o}=t;if(!o)return;const s=280,a=240,l=n-s-Je,u=Je+In*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(l,u,s,a),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(l,u,s,a),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let d=u+Je+5;const h=l+Je;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Performance Debugger",h,d),d+=25,e.fillStyle="white",e.font="12px monospace";const p=KD(t);e.fillText(`FPS: ${p.toFixed(1)}`,h,d),d+=20;const m=s-Je*2,S=45,y=10;vh(e,"Render",Sh(t,"renderTime"),h,d,m,S,"#4CAF50"),d+=S+y,vh(e,"World Update",Sh(t,"worldUpdateTime"),h,d,m,S,"#2196F3"),d+=S+y,vh(e,"AI Update",Sh(t,"aiUpdateTime"),h,d,m,S,"#FFC107"),e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '2' to toggle this panel",l+s/2,u+a-10),e.restore()}function KD(e){const{performanceMetrics:t}=e;if(!t||t.history.length===0)return 0;const n=t.history[t.history.length-1].bucketTime/(Ot/Ut);return t.history.filter(a=>n-a.bucketTime/(Ot/Ut)<1).length}function QD(e,t){if(e.length===0)return[];const n=new Map;for(const a of e){const l=Math.floor(a.bucketTime/(Ot/Ut));n.set(l,(n.get(l)||0)+a[t])}return Array.from(n.keys()).sort().map(a=>n.get(a)).slice(0,-1).slice(1).reverse()}function Sh(e,t){return QD(e.performanceMetrics.history,t)}const JD={moving:"walk",gathering:"gathering",eating:"eat",feeding:"eat",procreating:"procreate",idle:"idle",attacking:"attacking",planting:"gathering",depositing:"gathering",retrieving:"gathering",takingOverBuilding:"attacking",destroyingBuilding:"attacking",chopping:"gathering"},eO=new wl(1e4);function tO(e,t,n){if(!t.path||t.path.length===0)return;const{width:o,height:s}=n.mapDimensions;e.save(),e.setLineDash([5,5]),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=2;let a={...t.position};e.beginPath(),e.moveTo(a.x,a.y);for(const u of t.path){const d=xe(a,u,o,s),h={x:a.x+d.x,y:a.y+d.y};e.lineTo(h.x,h.y),a=h}if(t.pathTarget){const u=xe(a,t.pathTarget,o,s),d={x:a.x+u.x,y:a.y+u.y};e.lineTo(d.x,d.y),a=d}e.stroke(),e.setLineDash([]),e.fillStyle="rgba(255, 255, 255, 0.3)";let l={...t.position};for(const u of t.path){const d=xe(l,u,o,s),h={x:l.x+d.x,y:l.y+d.y};e.beginPath(),e.arc(h.x,h.y,2,0,Math.PI*2),e.fill(),l=h}if(t.pathTarget){const u=xe(l,t.pathTarget,o,s),d={x:l.x+u.x,y:l.y+u.y};e.fillStyle="rgba(255, 255, 0, 0.8)",e.beginPath(),e.arc(d.x,d.y,4,0,Math.PI*2),e.fill()}e.restore()}function nO(e,t,n){var d;const{radius:o,position:s,activeAction:a="idle"}=t,l=t.stateMachine[0]||"N/A",u=t.isAdult?ut+20:ut*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${a}`,s.x,s.y-u),e.fillText(`State: ${l}`,s.x,s.y-u+10),e.fillText(`Path: ${((d=t.path)==null?void 0:d.length)||0} waypoints`,s.x,s.y-u+50),e.fillText(`HP: ${t.hitpoints}`,s.x,s.y-u+20),e.fillText(`Cooldown: ${t.attackCooldown||"N/A"}`,s.x,s.y-u+30),e.fillText(`Tribe: ${t.leaderId||"N/A"}`,s.x,s.y-u+40),e.restore(),e.beginPath(),e.arc(s.x,s.y,o,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",n.debugCharacterId===t.id&&tO(e,t,n),e.lineWidth=1,e.stroke(),e.closePath()}function iO(e,t,n,o,s){e.save(),e.font=`${Va}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(n,t.x,t.y-(o?ut:Ds)-Va-s),e.restore()}function oO(e,t,n,o,s){const a=t.x,l=t.y-n-o/2;e.save(),e.fillStyle=s,e.strokeStyle=s,e.lineWidth=1.5,e.beginPath(),e.rect(a-o/2,l,o,o/2),e.fill(),e.beginPath(),e.moveTo(a-o/2,l),e.lineTo(a-o/4,l-o/3),e.lineTo(a-o/6,l),e.moveTo(a-o/6,l),e.lineTo(a,l-o/2),e.lineTo(a+o/6,l),e.moveTo(a+o/6,l),e.lineTo(a+o/4,l-o/3),e.lineTo(a+o/2,l),e.stroke(),e.restore()}function rO(e,t,n){var u;const{position:o,radius:s}=t,a=o.x-th/2,l=o.y-s-jC;if(t.stateMachine[0]===Lo){const d=t.stateMachine[1],h=n-d.attackStartTime,p=Math.min(h/Hu,1);Oo(e,a,l,th,Iy,p,Mo,zC)}else if((u=t.attackCooldown)!=null&&u.melee&&t.attackCooldown.melee>0){const d=1-t.attackCooldown.melee/ml;Oo(e,a,l,th,Iy,d,Mo,XC)}}function sO(e,t,n=!1,o=!1,s=!1,a=!1,l=!1,u=!1,d=!1,h){var H,j;const{position:p,activeAction:m="idle"}=t,S=t.isAdult?ut:ut*.6,y=JD[m]||"idle",I=Cr(t.animationProgress||0,12),T=Up(t.direction,8),E=Math.floor(t.age),P=Cr(t.hunger/100,5)*100,C=`${y}_${t.gender}_${E}_${T}_${I}_${t.isPregnant??!1}_${P}_${S}`,_=Math.ceil(S*2)+4,k=eO.getOrRender(C,_,_,$=>{$.translate(_/2,_/2);const V=Gp(T,8);$p.render($,-_/2+2,-_/2+2,_-4,_-4,I,y,t.gender,E,V,t.isPregnant??!1,P)});e.drawImage(k,p.x-k.width/2,p.y-k.height/2),u&&(e.save(),e.strokeStyle=_C,e.lineWidth=2,e.beginPath(),e.arc(p.x,p.y,S+3,0,2*Math.PI),e.stroke(),e.restore());let w,M;if(l?(w=kC,M=BS):n?(w=RC,M=DS):s?(w=MC,M=PC):o?(w=bC,M=OS):a&&(w=DC,M=NS),w&&M&&oO(e,p,S,w,M),(H=t.tribeInfo)!=null&&H.tribeBadge&&iO(e,p,t.tribeInfo.tribeBadge,t.isAdult??!1,w??0),t.heldItem){const $=Pp[t.heldItem.type],V=(j=t.tribeInfo)!=null&&j.tribeBadge?Va:0;e.save(),e.font=`${Va}px Arial`,e.textAlign="center",e.textBaseline="middle";const ee=p.y-(t.isAdult?ut:Ds)-Va-(w??0)-V;e.fillText($,p.x,ee),e.restore()}const R=d&&(h.debugCharacterId===void 0||t.id===h.debugCharacterId);rO(e,t,h.time),R&&nO(e,t,h)}const aO={grazing:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},lO=new wl(200);function cO(e,t){const{radius:n,position:o,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?ut+20:ut*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-l),e.fillText(`State: ${a}`,o.x,o.y-l+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-l+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,n,0,Math.PI*2),e.strokeStyle="rgba(0, 255, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function uO(e,t,n=!1,o){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,u=aO[a]||"idle",d=Cr(t.animationProgress||0,12),h=Up(t.direction||{x:1,y:0},8),p=Math.floor(t.age),m=Cr(t.hunger/100,5)*100,S=`${u}_${p}_${h}_${d}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,y=Math.ceil(l*2)+4,I=lO.getOrRender(S,y,y,E=>{E.translate(y/2,y/2);const P=Gp(h,8);dI.render(E,-y/2+2,-y/2+2,y-4,y-4,d,u,{gender:t.gender,age:p,direction:P,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(I,s.x-I.width/2,s.y-I.height/2),t.hitpoints<t.maxHitpoints){const E=l*1.5,P=3,C=s.x-E/2,_=s.y-l-8;e.fillStyle="#555",e.fillRect(C,_,E,P);const k=t.hitpoints/t.maxHitpoints;e.fillStyle=k>.5?"#4CAF50":k>.25?"#FFC107":"#F44336",e.fillRect(C,_,E*k,P)}n&&(o===void 0||t.id===o)&&cO(e,t)}const dO={attacking:"attacking",eating:"eat",moving:"walk",procreating:"procreate",feeding:"eat",idle:"idle"},fO=new wl(200);function hO(e,t){const{radius:n,position:o,activeAction:s="idle"}=t,a=t.stateMachine[0]||"N/A",l=t.isAdult?ut+20:ut*.6+20;e.save(),e.fillStyle="white",e.font="10px Arial",e.textAlign="center",e.fillText(`Action: ${s}`,o.x,o.y-l),e.fillText(`State: ${a}`,o.x,o.y-l+10),e.fillText(`HP: ${t.hitpoints}`,o.x,o.y-l+20),e.fillText(`Hunger: ${Math.round(t.hunger)}`,o.x,o.y-l+30),e.fillText(`Age: ${Math.round(t.age)}`,o.x,o.y-l+40),e.restore(),e.beginPath(),e.arc(o.x,o.y,n,0,Math.PI*2),e.strokeStyle="rgba(255, 0, 0, 0.5)",e.lineWidth=1,e.stroke(),e.closePath()}function pO(e,t,n=!1,o){const{position:s,activeAction:a="idle"}=t,l=t.isAdult?t.radius:t.radius*.6,u=dO[a]||"idle",d=Cr(t.animationProgress||0,12),h=Up(t.direction||{x:1,y:0},8),p=Math.floor(t.age),m=Cr(t.hunger/100,5)*100,S=`${u}_${p}_${h}_${d}_${t.isPregnant??!1}_${m}_${t.geneCode}_${l}`,y=Math.ceil(l*2)+4,I=fO.getOrRender(S,y,y,E=>{E.translate(y/2,y/2);const P=Gp(h,8);fI.render(E,-y/2+2,-y/2+2,y-4,y-4,d,u,{gender:t.gender,age:p,direction:P,isPregnant:t.isPregnant??!1,hungryLevel:m,geneCode:t.geneCode})});if(e.drawImage(I,s.x-I.width/2,s.y-I.height/2),t.hitpoints<t.maxHitpoints){const E=l*1.5,P=3,C=s.x-E/2,_=s.y-l-8;e.fillStyle="#555",e.fillRect(C,_,E,P);const k=t.hitpoints/t.maxHitpoints;e.fillStyle=k>.5?"#4CAF50":k>.25?"#FFC107":"#F44336",e.fillRect(C,_,E*k,P)}(t.attackCooldown&&t.attackCooldown>0||t.huntCooldown&&t.huntCooldown>0)&&(e.strokeStyle="#FF8C00",e.lineWidth=3,e.beginPath(),e.arc(s.x,s.y,l+3,0,2*Math.PI),e.stroke()),n&&(o===void 0||t.id===o)&&hO(e,t)}const hI=15;function gO(e,t,n,o,s=1.5){const a=n-t.startTime,l=Math.min(a/t.duration,1),u=1-l,h=1+Math.sin(l*Math.PI*2)*(s-1),p=hI*h;e.save(),e.globalAlpha=u,e.beginPath(),e.arc(t.position.x,t.position.y,Math.max(0,p),0,Math.PI*2),e.fillStyle=o,e.fill(),e.restore()}function ka(e,t,n,o,s=2){const a=n-t.startTime,l=Math.min(a/t.duration,1),u=1-l,d=hI*2*l;e.save(),e.globalAlpha=u,e.beginPath(),e.arc(t.position.x,t.position.y,d,0,Math.PI*2),e.strokeStyle=o,e.lineWidth=s,e.stroke(),e.restore()}function Hi(e,t,n,o){const s=n-t.startTime,a=Math.min(s/t.duration,1),l=1-a,u=-20*a;e.save(),e.globalAlpha=l,e.font="20px Arial",e.textAlign="center",e.fillText(o,t.position.x,t.position.y+u),e.restore()}function mO(e,t,n,o){const{width:s,height:a}=o.mapDimensions;let l=t.targetPosition;if(t.targetEntityId){const T=o.entities.entities[t.targetEntityId];T&&(l=T.position)}if(!l)return;const u=n-t.startTime,d=Math.min(u/t.duration,1);let h=l.x-t.position.x,p=l.y-t.position.y;h=h-Math.round(h/s)*s,p=p-Math.round(p/a)*a;const m={x:h,y:p},S=t.position.x+m.x*d,y=t.position.y+m.y*d,I=-Math.sin(d*Math.PI)*40;e.save(),e.beginPath(),e.ellipse(S,y,4,2,0,0,Math.PI*2),e.fillStyle="rgba(0, 0, 0, 0.3)",e.fill(),e.translate(S,y+I),e.rotate(d*Math.PI*4),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="#888",e.fill(),e.strokeStyle="#444",e.lineWidth=1,e.stroke(),e.restore()}function pI(e,t,n,o){switch(t.type){case Ce.Procreation:Hi(e,t,n,"");break;case Ce.Pregnant:gO(e,t,n,"rgba(255, 105, 180, 0.7)",1.2);break;case Ce.TargetAcquired:ka(e,t,n,"rgba(255, 0, 0, 0.8)",3);break;case Ce.Attack:Hi(e,t,n,"");break;case Ce.Partnered:Hi(e,t,n,"");break;case Ce.BushClaimed:ka(e,t,n,"rgba(0, 255, 0, 0.7)",2);break;case Ce.BushClaimLost:ka(e,t,n,"rgba(128, 128, 128, 0.7)",2);break;case Ce.Eating:Hi(e,t,n,"");break;case Ce.ChildFed:Hi(e,t,n,"");break;case Ce.AttackDeflected:Hi(e,t,n,"");break;case Ce.AttackResisted:Hi(e,t,n,"");break;case Ce.Hit:Hi(e,t,n,"");break;case Ce.SeizeBuildup:ka(e,t,n,"rgba(255, 215, 0, 0.8)",4);break;case Ce.BorderClaim:Hi(e,t,n,"");break;case Ce.Seize:ka(e,t,n,"rgba(148, 0, 211, 0.8)",4);break;case Ce.StoneProjectile:mO(e,t,n,o);break}}function av(e,t,n,o,s,a,l){e.save();const{position:u}=t;e.strokeStyle=o,e.lineWidth=s+Math.sin(l*a)*(s/2),e.setLineDash([8,8]),e.beginPath(),e.arc(u.x,u.y,n,0,2*Math.PI),e.stroke(),e.restore()}const lv=8,yO=1.5,vO=.5,cv=2,SO="#5a5a5a",TO="#7e7e7e",IO="#8B0000",AO="#FF4444",EO=6,fs="#8B4513",wO="#A0522D",CO="rgba(40, 40, 40, 0.7)",PO=new wl(1e3),uv=20,Ku={top:!1,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1};function _O(e,t,n=!1,o=!0,s=Ku){if(n)return`ghost_${e.buildingType}_${o}`;const a=e,l=a.buildingType===X.Bonfire&&(a.fuelLevel??0)>0,u=s,d=`${u.top}${u.right}${u.bottom}${u.left}${u.topRight}${u.bottomRight}${u.bottomLeft}${u.topLeft}`;return`${a.id}_${a.buildingType}_${a.width}_${a.height}_${t}_${a.isConstructed}_${l}_${d}`}function gI(e,t,n=!1,o=!0,s=Ku){const a=_O(e,t,n,o,s),{width:l,height:u,id:d,buildingType:h}=e,p=l+uv*2,m=u+uv*2;return PO.getOrRender(a,p,m,S=>{const y=mt[h],I="isConstructed"in e?e.isConstructed:!0;if(S.translate(p/2,m/2),n){const T=o?"#4CAF50":"#F44336";h===X.Palisade||h===X.Gate?RO(S,l,u,T):Th(S,l,u,9999,T),S.font=`${Math.min(l,u)*.5}px Arial`,S.textAlign="center",S.textBaseline="middle",S.fillStyle=T,S.fillText(y.icon,0,0)}else{const T=e;let E=y.icon,P="#FFFFFF";T.ownerId!==void 0&&T.ownerId!==null&&(P=Xt[T.ownerId%Xt.length]),h===X.Palisade?kO(S,l,u,d,P,s):h===X.Gate?MO(S,l,u,P,s):(T.buildingType===X.Bonfire&&I&&(E=(T.fuelLevel??0)>0?"":""),t?Th(S,l,u,d,IO,AO):Th(S,l,u,d),S.globalAlpha=.5,S.font=`${Math.min(l,u,30)*.5}px Arial`,S.textAlign="center",S.textBaseline="middle",S.shadowColor="rgba(0,0,0,0.5)",S.shadowBlur=4,S.fillStyle="#FFFFFF",S.fillText(E,0,0))}})}function RO(e,t,n,o){e.fillStyle=o,e.fillRect(-t/2,-n/2,t,n),e.strokeStyle="rgba(0,0,0,0.2)",e.strokeRect(-t/2,-n/2,t,n)}function kO(e,t,n,o,s,a){const l=t/2,u=n/2,d=n/4;e.fillStyle=fs,a.right&&e.fillRect(0,-d/2,l,d),a.left&&e.fillRect(-l,-d/2,l,d),a.bottom&&e.fillRect(-d/2,0,d,u),a.top&&e.fillRect(-d/2,-u,d,u),e.lineWidth=d,e.strokeStyle=fs,e.lineCap="round";const h=(m,S)=>{e.beginPath(),e.moveTo(0,0),e.lineTo(m,S),e.stroke()};a.topRight&&h(l,-u),a.bottomRight&&h(l,u),a.bottomLeft&&h(-l,u),a.topLeft&&h(-l,-u);const p=t/2;e.fillStyle=fs,e.fillRect(-p/2,-u,p,n),e.fillStyle=wO,e.fillRect(-p/4,-u,p/2,n),a.top||(e.fillStyle=fs,e.beginPath(),e.moveTo(-p/2,-u),e.lineTo(0,-u-5),e.lineTo(p/2,-u),e.fill()),e.fillStyle=s,e.fillRect(-p/2,-n/8,p,n/4),e.strokeStyle="rgba(0,0,0,0.1)",e.lineWidth=1;for(let m=0;m<3;m++){const S=(si(o+m)-.5)*p;e.beginPath(),e.moveTo(S,-u),e.lineTo(S,u),e.stroke()}}function MO(e,t,n,o,s){(s.top||s.bottom)&&e.rotate(Math.PI/2);const a=t/4,l=t/2,u=n/2;e.fillStyle=fs,e.fillRect(-l,-u,a,n),e.fillRect(l-a,-u,a,n),e.fillStyle="#5D2906",e.fillRect(-l,-u,t,a),e.fillStyle=fs;const d=(t-a*2)/2;e.fillRect(-l+a+1,-u+a+1,d-2,n-a-2),e.fillRect(1,-u+a+1,d-2,n-a-2),e.strokeStyle="rgba(0,0,0,0.1)",e.lineWidth=1;for(let h=-1;h<=1;h+=2){const p=h*(d/2);e.beginPath(),e.moveTo(p,-u+a),e.lineTo(p,u),e.stroke()}e.fillStyle=o,e.beginPath(),e.arc(0,a/2,4,0,Math.PI*2),e.fill(),e.fillStyle="#C0C0C0",e.fillRect(-2,a/2-1,1,2),e.fillRect(1,a/2-1,1,2)}function bO(e,t,n,o,s){if(o<=0)return;e.save(),e.strokeStyle=CO,e.lineWidth=1,e.lineCap="round";const a=Math.floor(o*10)+1;for(let l=0;l<a;l++){const u=s+l*17;let d=(si(u)-.5)*t,h=(si(u+1)-.5)*n;e.beginPath(),e.moveTo(d,h);const p=5+si(u+2)*10,m=si(u+3)*Math.PI*2;for(let S=0;S<3;S++)d+=Math.cos(m)*(p/3),h+=Math.sin(m)*(p/3),e.lineTo(d,h);e.stroke()}e.restore()}function Th(e,t,n,o,s,a){const l=(t+n)*2,u=Math.floor(l/lv),d=-t/2,h=t/2,p=-n/2,m=n/2;for(let S=0;S<u;S++){const y=o+S*13,I=si(y),T=si(y+1);let E=S*lv,P=0,C=0;E<t?(P=d+E,C=p):E<t+n?(P=h,C=p+(E-t)):E<t*2+n?(P=h-(E-(t+n)),C=m):(P=d,C=m-(E-(t*2+n)));const _=(T-.5)*cv,k=(si(y+2)-.5)*cv;e.beginPath();const w=yO+I*vO;s?e.fillStyle=s:e.fillStyle=I>.5?a||TO:s||SO,e.ellipse(P+_,C+k,w,w*.85,T*Math.PI,0,Math.PI*2),e.fill(),s||(e.strokeStyle="#2b2b2b",e.lineWidth=1,e.stroke())}}function DO(e,t){if(!t.storedItems||t.storedItems.length===0)return;const{position:n,storedItems:o}=t;e.save(),e.font=`${EO}px Arial`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(0,0,0,0.5)",e.shadowBlur=2,o.forEach(s=>{const a=s.item.type,l=(cp[a]||Pp[a])??"?",u={x:n.x+s.positionOffset.x,y:n.y+s.positionOffset.y};e.fillText(l,u.x,u.y)}),e.shadowBlur=0,e.shadowColor="transparent",e.restore()}function Wp(e,t,n){const{position:o,width:s,height:a,constructionProgress:l,destructionProgress:u,isConstructed:d,isBeingDestroyed:h,buildingType:p,ownerId:m,id:S}=t,y=Nt(n),I=!!(y&&Tr(y,t,n));let T={...Ku};if(p===X.Palisade||p===X.Gate){const{width:k,height:w}=n.mapDimensions,M=n.search.building.byRadius(o,me*1.5);for(const R of M)if(R.id!==S&&(R.buildingType===X.Palisade||R.buildingType===X.Gate)&&R.ownerId===m){const H=xe(o,R.position,k,w),j=me*.5,$=H.x>j,V=H.x<-5,ee=H.y>j,ue=H.y<-5,oe=Math.abs(H.x),re=Math.abs(H.y);oe>j&&re<j?($&&(T.right=!0),V&&(T.left=!0)):re>j&&oe<j?(ee&&(T.bottom=!0),ue&&(T.top=!0)):oe>j&&re>j&&($&&ue&&(T.topRight=!0),$&&ee&&(T.bottomRight=!0),V&&ee&&(T.bottomLeft=!0),V&&ue&&(T.topLeft=!0))}}const E=gI(t,I,!1,!0,T);e.save(),d||(e.globalAlpha=.3+l*.7),e.drawImage(E,o.x-E.width/2,o.y-E.height/2),h&&d&&(e.translate(o.x,o.y),bO(e,s,a,u,S)),e.restore();const P=s,C=o.x-P/2,_=o.y+a/2+x1;d?h&&Oo(e,C,_,P,j0,1-u,Mo,F1):Oo(e,C,_,P,j0,l,Mo,H1),(t.buildingType===X.StorageSpot||t.buildingType===X.Bonfire)&&d&&DO(e,t)}function Yp(e,t,n,o,s){const a=mt[n],{width:l,height:u}=a.dimensions,d=gI({buildingType:n,width:l,height:u,id:9999},!1,!0,o,Ku),h=(m,S)=>{m.save(),m.globalAlpha=B1,m.drawImage(d,S.x-d.width/2,S.y-d.height/2),m.restore()},p={position:{...t},radius:Math.max(l,u)/2,id:0,type:"building",direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Oe.create()};$n(e,s.width,s.height,(m,S)=>h(m,S.position),p)}const os=1,OO=20,ii=4,dv=8,NO="rgba(34, 85, 34, 0.25)",BO="rgba(139, 50, 50, 0.25)",ps=new Map,HO=50;function FO(e,t){return e.map(n=>n.id).sort((n,o)=>n-o).join(",")+`_${t}`}function xO(){if(ps.size>HO){const e=ps.keys().next().value;e&&ps.delete(e)}}function LO(e){const t=new Map;for(const n of e){const o=n.ownerId;o&&(t.has(o)||t.set(o,[]),t.get(o).push(n))}return t}function UO(e,t,n,o){let s=0;const a=Math.max(o.width,o.height)/2;for(const l of n){const u=e-l.position.x,d=t-l.position.y,h=u*u+d*d;h>0?s+=a*a/h:s+=100}return s}function GO(e,t,n){let o=1/0,s=1/0,a=-1/0,l=-1/0;for(const u of e)o=Math.min(o,u.position.x-t.width/2),s=Math.min(s,u.position.y-t.height/2),a=Math.max(a,u.position.x+t.width/2),l=Math.max(l,u.position.y+t.height/2);return{minX:o-n,minY:s-n,maxX:a+n,maxY:l+n}}function $O(e,t,n,o){const s=FO(e,o);if(ps.has(s))return ps.get(s);const a=n.maxX-n.minX,l=n.maxY-n.minY,u=Math.ceil(a/ii),d=Math.ceil(l/ii),h=[],p=[];for(let y=0;y<d;y++)h[y]=new Array(u);for(let y=0;y<d;y++)for(let I=0;I<u;I++){const T=n.minX+I*ii,E=n.minY+y*ii,P=UO(T,E,e,t);h[y][I]=P}for(let y=1;y<d-1;y++)for(let I=1;I<u-1;I++)if(h[y][I]>=os&&(h[y-1][I]<os||h[y+1][I]<os||h[y][I-1]<os||h[y][I+1]<os)){const E=n.minX+I*ii,P=n.minY+y*ii;p.push({x:E,y:P})}const m=jO(p),S={fieldValues:h,edgePoints:p,regions:m,bounds:n};return ps.set(s,S),xO(),S}function WO(e,t,n,o,s,a){if(t.length===0)return;const{bounds:l}=a,u=10;if(!a.canvas){const d=l.maxX-l.minX+u*2,h=l.maxY-l.minY+u*2,{canvas:p,ctx:m}=lI(d,h);m.translate(-l.minX+u,-l.minY+u);const{fieldValues:S,regions:y}=a;YO(m,S,l,o);let I=s;for(const T of y){const E=zO(T);XO(m,E,o,I),I+=1e3}a.canvas=p}e.save(),e.globalAlpha=1,e.drawImage(a.canvas,l.minX-u,l.minY-u),e.restore()}function YO(e,t,n,o){const s=o?BO:NO;e.save(),e.fillStyle=s,e.beginPath();for(let a=0;a<t.length;a++)for(let l=0;l<t[a].length;l++)if(t[a][l]>=os){const u=n.minX+l*ii,d=n.minY+a*ii;e.rect(u,d,ii,ii)}e.fill(),e.restore()}function jO(e){if(e.length===0)return[];const t=ii*2,n=t,o=new Map;function s(h,p){const m=Math.floor(h/n),S=Math.floor(p/n);return`${m},${S}`}for(let h=0;h<e.length;h++){const p=s(e[h].x,e[h].y);o.has(p)||o.set(p,[]),o.get(p).push(h)}function a(h,p){const m=[],S=Math.floor(h/n),y=Math.floor(p/n);for(let I=-1;I<=1;I++)for(let T=-1;T<=1;T++){const E=`${S+I},${y+T}`,P=o.get(E);P&&m.push(...P)}return m}const l=new Set,u=[],d=t*t;for(let h=0;h<e.length;h++){if(l.has(h))continue;const p=[],m=[h];for(;m.length>0;){const S=m.shift();if(l.has(S))continue;l.add(S),p.push(e[S]);const y=a(e[S].x,e[S].y);for(const I of y){if(l.has(I))continue;const T=e[I].x-e[S].x,E=e[I].y-e[S].y;T*T+E*E<=d&&m.push(I)}}p.length>0&&u.push(p)}return u}function zO(e){if(e.length<=1)return e;const t=[],n=[...e];for(t.push(n.shift());n.length>0;){const o=t[t.length-1];let s=0,a=1/0;for(let l=0;l<n.length;l++){const u=n[l].x-o.x,d=n[l].y-o.y,h=u*u+d*d;h<a&&(a=h,s=l)}t.push(n.splice(s,1)[0])}return t}function XO(e,t,n,o){if(t.length===0)return;let s=0,a=0;for(let l=1;l<t.length;l++){const u=t[l-1],d=t[l],h=d.x-u.x,p=d.y-u.y,m=Math.sqrt(h*h+p*p);for(s+=m;s>=dv;){s-=dv;const S=1-s/m,y=u.x+h*S,I=u.y+p*S;VO(e,y,I,n,o+a*13),a++}}}function VO(e,t,n,o,s){const a=si(s),l=si(s+1),u=(l-.5)*2,d=(si(s+2)-.5)*2;e.beginPath();const h=1.5+a*.5;o?e.fillStyle=a>.5?"#FF4444":"#8B0000":e.fillStyle=a>.5?"#7e7e7e":"#5a5a5a",e.ellipse(t+u,n+d,h,h*.85,l*Math.PI,0,Math.PI*2),e.fill(),o||(e.strokeStyle="#2b2b2b",e.lineWidth=.5,e.stroke())}function mI(e,t,n,o){var m,S,y;const s=t;if(!((m=s.search)!=null&&m.building))return;const l=s.search.building.all().filter(I=>I.buildingType===X.PlantingZone&&I.isConstructed);if(l.length===0)return;const u=l.filter(I=>el(I,n,{width:e.canvas.width,height:e.canvas.height},t.mapDimensions));if(u.length===0)return;const d=mt[X.PlantingZone].dimensions,h=LO(u),p=o?t.entities.entities[o]:void 0;for(const[I,T]of h){const E=((y=(S=p==null?void 0:p.tribeControl)==null?void 0:S.diplomacy)==null?void 0:y[I])==="Hostile",P=typeof I=="number"?I:0,C=GO(T,d,OO),_=$O(T,d,C,E);WO(e,T,d,E,P,_)}}const qO=.001,ZO=.05,KO=12;function QO(e,t,n){const{position:o,age:s,swayOffset:a}=t,[l]=t.stateMachine??[],u=Math.min(1,Math.max(.4,s/Uo)),h=l!==Vt&&l!==wi?Math.sin(n*qO+a)*ZO:0;if(e.save(),e.translate(o.x,o.y),e.scale(u,u),e.save(),e.scale(1,.4),e.transform(1,0,-.5,1,0,0),e.fillStyle=MR,e.beginPath(),e.arc(0,0,15,0,Math.PI*2),e.fill(),e.restore(),l===wi?Ih(e,10,8):l===Vt?(e.rotate(Math.PI/2),Ih(e,10,30),e.translate(0,-25),fv(e,40,20,40,15)):(e.rotate(h),Ih(e,10,30),e.translate(0,-25),e.rotate(h*.5),fv(e,40,20,40,15)),e.restore(),(l===Vt||l===wi)&&t.wood&&t.wood.length>0){e.save(),e.font=`${KO}px Arial`,e.textAlign="center",e.textBaseline="middle";const p=t.radius*1.1,m=Math.PI*2/(Vu-1);t.wood.forEach((S,y)=>{const I=y===0?0:p,T=y===0?0:(y-1)*m,E=o.x+I*Math.cos(T),P=o.y+I*Math.sin(T),C=Pp[S.type];e.fillText(C,E,P)}),e.restore()}}function Ih(e,t,n){e.fillStyle=CR,e.beginPath(),e.moveTo(-10/2,0),e.lineTo(0,0),e.lineTo(0,-n),e.lineTo(-10/2,-n+5),e.closePath(),e.fill(),e.fillStyle=PR,e.beginPath(),e.moveTo(0,0),e.lineTo(t/2,0),e.lineTo(t/2,-n+5),e.lineTo(0,-n),e.closePath(),e.fill()}function fv(e,t,n,o,s){e.fillStyle=_R,hv(e,t+4,n+4,o+2,s+2),e.translate(0,-2),e.fillStyle=RR,hv(e,t,n,o,s),e.fillStyle=kR,e.beginPath(),e.moveTo(-10,-20),e.lineTo(-5,-30),e.lineTo(-15,-30),e.fill(),e.beginPath(),e.moveTo(10,-10),e.lineTo(15,-20),e.lineTo(5,-20),e.fill()}function hv(e,t,n,o,s){e.beginPath(),e.moveTo(-t/2,0),e.lineTo(-n/2,-o),e.lineTo(0,-o-s),e.lineTo(n/2,-o),e.lineTo(t/2,0),e.closePath(),e.fill()}const jc=200;let Eo=null;function JO(e,t,n,o,s){const a=GR(t.time);if(a<=0)return;Eo||(Eo=document.createElement("canvas")),(Eo.width!==o.width||Eo.height!==o.height)&&(Eo.width=o.width,Eo.height=o.height);const l=Eo.getContext("2d");if(l){l.clearRect(0,0,o.width,o.height),l.fillStyle=`rgba(0, 0, 40, ${a*.85})`,l.fillRect(0,0,o.width,o.height),l.globalCompositeOperation="destination-out";for(const u of s){const d=El(u.position,n,o,t.mapDimensions),h=l.createRadialGradient(d.x,d.y,0,d.x,d.y,u.radius);h.addColorStop(0,`rgba(255, 255, 255, ${u.intensity})`),h.addColorStop(1,"rgba(255, 255, 255, 0)"),l.fillStyle=h,l.beginPath(),l.arc(d.x,d.y,u.radius,0,Math.PI*2),l.fill()}l.globalCompositeOperation="source-over",e.save(),e.setTransform(1,0,0,1,0,0),e.drawImage(Eo,0,0),e.restore()}}function pv(e,t,n,o,s,a,l){for(let u=-s.height;u<=s.height;u+=s.height)for(let d=-s.width;d<=s.width;d+=s.width){const h={x:t.x+d,y:t.y+u};el({position:h,radius:n},a,l,s)&&e.push({position:h,radius:n,intensity:o})}}function e2(e,t,n,o,s,a=[]){const l=Nt(t),u=l?Ji(t,l):[],d=Is(u),{width:h,height:p}=t.mapDimensions,m=[];a.forEach(P=>{m.push({position:P,radius:30,intensity:.3})}),mI(e,t,o,l==null?void 0:l.leaderId);const S=t,y={left:o.x-s.width/2-jc,top:o.y-s.height/2-jc,right:o.x+s.width/2+jc,bottom:o.y+s.height/2+jc};[...S.search.human.byRect(y),...S.search.building.byRect(y),...S.search.berryBush.byRect(y),...S.search.tree.byRect(y),...S.search.corpse.byRect(y),...S.search.prey.byRect(y),...S.search.predator.byRect(y)].sort((P,C)=>n&&P.id===t.debugCharacterId&&P.id!==C.id||P.type==="building"&&C.type!=="building"||P.position.y<C.position.y?-1:P.position.y>C.position.y?1:P.id-C.id).forEach(P=>{var C,_;if(P.type==="building"){const k=P;if(k.isConstructed){const w=k.buildingType===X.Bonfire&&(k.fuelLevel??0)>0,M=w?180:60,R=w?.9:.4;pv(m,k.position,M,R,t.mapDimensions,o,s)}if(k.buildingType===X.PlantingZone&&k.isConstructed)return;$n(e,h,p,Wp,k,t,l,t.time)}else if(P.type==="berryBush")$n(e,h,p,HD,P,t,l,t.time);else if(P.type==="tree")$n(e,h,p,QO,P,t.time);else if(P.type==="human"){const k=P,w=k.id===(l==null?void 0:l.id),M=u.some(V=>V.id===k.id),R=k.id===(d==null?void 0:d.id),H=l&&(k.id===l.motherId||k.id===l.fatherId),j=l&&(((C=k.partnerIds)==null?void 0:C.includes(l.id))||((_=l.partnerIds)==null?void 0:_.includes(k.id))),$=(l==null?void 0:l.attackTargetId)===k.id;pv(m,k.position,40,.3,t.mapDimensions,o,s),$n(e,h,p,sO,k,w,H,M,j,R,$,n,t)}else P.type==="corpse"?$n(e,h,p,$D,P):P.type==="prey"?$n(e,h,p,uO,P,n,t.time,t.debugCharacterId):P.type==="predator"&&$n(e,h,p,pO,P,n,t.time,t.debugCharacterId)}),t.visualEffects.filter(P=>el(P,o,s,t.mapDimensions)).forEach(P=>{$n(e,h,p,pI,P,t.time,t)});const E=t.notifications.filter(P=>!P.isDismissed);for(const P of E)if(P.highlightedEntityIds&&P.renderHighlights)for(const C of P.highlightedEntityIds){const _=t.entities.entities[C];_&&el(_,o,s,t.mapDimensions)&&$n(e,h,p,av,_,SP,TP,AP,IP,t.time)}if(t.tutorialState.isActive&&t.tutorialState.highlightedEntityIds.length>0)for(const P of t.tutorialState.highlightedEntityIds){const C=t.entities.entities[P];C&&el(C,o,s,t.mapDimensions)&&$n(e,h,p,av,C,sP,WS,YS,Cp,t.time)}JO(e,t,o,s,m)}function t2(e,t,n,o,s,a){let l=null,u=null;e.textAlign="left";let d=Je+In;const p=t.time/(Ot/Ut)/Nu%1,m=Pa[ns.Time],S=25,y=Je+S;e.fillText(m,Je,d+Rn/2+In/3),Oo(e,y,d,Ao,Rn,p,Mo,LC),d+=Rn+Bi;const I=d+Gi/2,T=d+(Gi-Rn)/2,E=5;hl(e,{x:Je*2,y:I},Gi,5,n.gender,!1,!1,!1);const P=Je+Gi+E,C=Ao+S-(Gi+E)*2;Oo(e,P,T,C,Rn,Math.floor(n.age)/sl,Mo,xC),hl(e,{x:P+C+E+Gi/2,y:I},Gi,sl,n.gender,!1,!1,!1),d+=Rn+Bi*2;const _=[],k=new Set;if(_.push({member:n,isPlayer:!0,isHeir:!1,isPartner:!1,isParent:!1}),k.add(n.id),o&&!k.has(o.id)&&(_.push({member:o,isPlayer:!1,isHeir:!0,isPartner:!1,isParent:!1}),k.add(o.id)),s.forEach(oe=>{k.has(oe.id)||(_.push({member:oe,isPlayer:!1,isHeir:!1,isPartner:!0,isParent:!1}),k.add(oe.id))}),a.forEach(oe=>{k.has(oe.id)||(_.push({member:oe,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!1}),k.add(oe.id))}),n.motherId&&!k.has(n.motherId)){const oe=t.entities.entities[n.motherId];oe&&(_.push({member:oe,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),k.add(oe.id))}if(n.fatherId&&!k.has(n.fatherId)){const oe=t.entities.entities[n.fatherId];oe&&(_.push({member:oe,isPlayer:!1,isHeir:!1,isPartner:!1,isParent:!0}),k.add(oe.id))}const w=Pa[ns.Family],M=10,R=Je+In+M,H=Ao+S-(In+M),j=d+Fc/2;e.font=`${In}px "Press Start 2P", Arial`,e.textBaseline="middle",e.fillText(w,Je,j);const $=d+Fc/2;MD(e,R,$,_,Fc,H),d+=Fc+Bi,e.textBaseline="alphabetic";const V=Pa[ns.Hitpoints];e.fillText(V,Je,d+Rn/2+In/3),Oo(e,y,d,Ao,Rn,n.hitpoints/n.maxHitpoints,Mo,FC),d+=Rn+Bi;const ee=Pa[ns.Hunger];e.fillText(ee,Je,d+Rn/2+In/3),Oo(e,y,d,Ao,Rn,(on-n.hunger)/on,Mo,HC),l={x:Je,y:d-Bi/2,width:Ao+S,height:Rn+Bi},d+=Rn+Bi,e.textBaseline="middle";const ue=Pa[ns.Food];return e.fillText(ue,Je,d+Hc/2),WD(e,y,d+Hc/2,n.food,Hc,Ao),u={x:Je,y:d-Bi/5,width:Ao+S,height:Hc+Bi},e.textBaseline="alphabetic",{hungerBarRect:l,foodBarRect:u}}let Ma=[],gv=0;const n2=36,i2=200;function o2(e,t,n,o){const s=t.search.prey.count(),a=t.search.predator.count(),l=t.search.berryBush.count(),u=t.search.tree.count();t.time-gv>=n2&&(Ma.push({time:t.time,prey:s,predators:a,bushes:l,trees:u}),Ma.length>i2&&(Ma=Ma.slice(-200)),gv=t.time);const d=We*Ye,h=s/d*1e6,p=a/d*1e6,m=l/d*1e6,S=u/d*1e6,y=rD(),I=Math.floor(t.time/(24*365)),T=Math.floor(t.time%(24*365)/24),E=Math.floor(t.time%24),P=400,C=Math.min(o*.8,600),_=n-P-10,k=Je+In*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(_,k,P,C),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(_,k,P,C),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let w=k+20;const M=14,R=_+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Ecosystem Debugger",R,w),w+=25,e.fillStyle="white",e.font="12px monospace",e.fillText(`Game Time: Year ${I}, Day ${T}, Hour ${E}`,R,w),w+=M,e.fillText(`Map Size: ${We}  ${Ye} pixels`,R,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Q-Learning Status",R,w),w+=18,y&&(e.fillText(`Q-Table Size: ${y.qTableSize} entries`,R,w),w+=M,e.fillText(`Exploration Rate: ${(y.explorationRate*100).toFixed(1)}%`,R,w),w+=M);const H=Ma.slice(-20);H.length>1&&(e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Trends (Last 20 Points)",R,w),w+=30,r2(e,R,w,H),w+=50),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Density (per 1000 px)",R,w),w+=18,e.fillStyle="white",e.font="12px monospace";const j=(ji/d*1e6).toFixed(2),$=(zi/d*1e6).toFixed(2),V=(Xi/d*1e6).toFixed(2),ee=(Vi/d*1e6).toFixed(2);e.fillText(`Prey: ${h.toFixed(2)} (target: ${j})`,R,w),w+=M,e.fillText(`Predators: ${p.toFixed(2)} (target: ${$})`,R,w),w+=M,e.fillText(`Bushes: ${m.toFixed(2)} (target: ${V})`,R,w),w+=M,e.fillText(`Trees: ${S.toFixed(2)} (target: ${ee})`,R,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Population Status",R,w),w+=18,e.fillStyle="white",e.font="12px monospace";const ue=Math.round(s/ji*100),oe=Math.round(a/zi*100),re=Math.round(l/Xi*100),fe=Math.round(u/Vi*100),ie=W=>W<50?"#ff4444":W<80?"#ffaa44":W>120?"#44aaff":"#44ff44";e.fillStyle=ie(ue),e.fillText(`Prey: ${s}/${ji} (${ue}%)`,R,w),w+=M,e.fillStyle=ie(oe),e.fillText(`Predators: ${a}/${zi} (${oe}%)`,R,w),w+=M,e.fillStyle=ie(fe),e.fillText(`Trees: ${u}/${Vi} (${fe}%)`,R,w),w+=M,e.fillStyle=ie(re),e.fillText(`Bushes: ${l}/${Xi} (${re}%)`,R,w),w+=20,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Current Parameters",R,w),w+=18,e.fillStyle="white",e.font="10px monospace",e.fillText("Prey:",R,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.preyGestationPeriod.toFixed(1)}h`,R,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.preyProcreationCooldown.toFixed(1)}h`,R,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.preyHungerIncreasePerHour.toFixed(1)}/h`,R,w),w+=13,e.fillText("Predators:",R,w),w+=13,e.fillText(` Gestation: ${t.ecosystem.predatorGestationPeriod.toFixed(1)}h`,R,w),w+=11,e.fillText(` Procreation: ${t.ecosystem.predatorProcreationCooldown.toFixed(1)}h`,R,w),w+=11,e.fillText(` Hunger: ${t.ecosystem.predatorHungerIncreasePerHour.toFixed(1)}/h`,R,w),w+=13,e.fillText("Bushes:",R,w),w+=13,e.fillText(` Spread Chance: ${(t.ecosystem.berryBushSpreadChance*100).toFixed(1)}%`,R,w),w+=15,e.fillText("Trees:",R,w),w+=13,e.fillText(` Spread Chance: ${(t.ecosystem.treeSpreadChance*100).toFixed(1)}%`,R,w),w+=15,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press '1' to toggle this debugger",_+P/2,k+C-10),e.restore()}function r2(e,t,n,o){if(o.length<2)return;const u={prey:Math.max(...o.map(h=>h.prey),ji),predators:Math.max(...o.map(h=>h.predators),zi),bushes:Math.max(...o.map(h=>h.bushes),Xi),trees:Math.max(...o.map(h=>h.trees),Vi)};[{data:o.map(h=>h.prey),color:"#44ff44",label:"Prey",target:ji,max:u.prey},{data:o.map(h=>h.predators),color:"#ff4444",label:"Predators",target:zi,max:u.predators},{data:o.map(h=>h.trees),color:"#76a331",label:"Trees",target:Vi,max:u.trees},{data:o.map(h=>h.bushes),color:"#ffaa44",label:"Bushes",target:Xi,max:u.bushes}].forEach((h,p)=>{const m=t+p%2*115,S=n+Math.floor(p/2)*55;e.fillStyle=h.color,e.font="10px monospace",e.textAlign="left",e.fillText(h.label,m,S-5),e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(m,S,100,30),e.beginPath(),e.strokeStyle=h.color;for(let I=0;I<h.data.length;I++){const T=m+I/(h.data.length-1)*100,E=S+30-h.data[I]/h.max*30;I===0?e.moveTo(T,E):e.lineTo(T,E)}e.stroke(),e.beginPath(),e.strokeStyle="#888",e.setLineDash([2,2]);const y=S+30-h.target/h.max*30;e.moveTo(m,y),e.lineTo(m+100,y),e.stroke(),e.setLineDash([])})}function s2(e,t){const n=t.search.human.byProperty("leaderId",e),o={total:n.length,children:0,males:0,females:0,old:0};for(const s of n)s.isAdult||o.children++,s.gender==="male"?o.males++:s.gender==="female"&&o.females++,s.age>=hp&&o.old++;return o}function a2(e,t){const n=t.search,a=n.building.byProperty("ownerId",e).flatMap(h=>n.berryBush.byRadius(h.position,h.radius)).reduce((h,p)=>h+p.food.length,0),d=n.building.byProperty("ownerId",e).filter(h=>h.buildingType===X.StorageSpot).reduce((h,p)=>h+(p.storedItems.filter(m=>m.item.itemType==="food").length||0),0);return{totalBushFood:a,totalStorageFood:d,consumptionRate:0}}function l2(e,t,n){const s=t.search.human.byProperty("leaderId",e),a=t.entities.entities,l=new Map,u=new Map;for(const h of s){const p=Su(h.id,t,l);u.has(p)||u.set(p,[]),u.get(p).push(h)}const d=[];for(const[h,p]of u.entries()){const m=a[h];m&&d.push({patriarch:m,memberCount:p.length,members:p.map(S=>S.id)})}return d.sort((h,p)=>p.memberCount-h.memberCount),d.slice(0,n)}let ba=[],vi=[],mv=0;const c2=36,yv=200;function u2(e,t,n,o){var k;if(!t.debugCharacterId)return;const s=t.search.human.byProperty("id",t.debugCharacterId)[0];if(!s)return;let a=(k=Fp(s,t))==null?void 0:k.id;if(!a)return;const l=s2(a,t),u=a2(a,t);if(t.time-mv>=c2){ba.push({time:t.time,total:l.total,children:l.children,males:l.males,females:l.females,old:l.old});const w=u.totalBushFood+u.totalStorageFood;vi.push({time:t.time,bushFood:u.totalBushFood,storageFood:u.totalStorageFood,totalFood:w}),ba.length>yv&&(ba=ba.slice(-200)),vi.length>yv&&(vi=vi.slice(-200)),mv=t.time}let d=0;if(vi.length>=2){const w=vi[vi.length-1],M=vi[vi.length-2],R=w.time-M.time;R>0&&(d=(M.totalFood-w.totalFood)/R)}const h=400,p=Math.min(o*.9,700),m=n-h-10,S=Je+In*2;e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(m,S,h,p),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(m,S,h,p),e.fillStyle="white",e.font="12px monospace",e.textAlign="left";let y=S+20;const I=13,T=m+15;e.fillStyle="#66ccff",e.font="bold 14px monospace",e.fillText(" Tribe Debugger",T,y),y+=25,e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Population Over Time",T,y),y+=18,e.fillStyle="white",e.font="11px monospace",e.fillText(`Total: ${l.total}`,T,y),y+=I,e.fillStyle="#00ffff",e.fillText(`Children: ${l.children}`,T,y),y+=I,e.fillStyle="#4488ff",e.fillText(`Males: ${l.males}`,T,y),y+=I,e.fillStyle="#ff88ff",e.fillText(`Females: ${l.females}`,T,y),y+=I,e.fillStyle="#888888",e.fillText(`Old (${l.old})`,T,y),y+=20;const E=ba.slice(-50);E.length>1&&(d2(e,T,y,E),y+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Food Metrics",T,y),y+=18;const P=u.totalBushFood+u.totalStorageFood;e.fillStyle="#ffff00",e.font="11px monospace",e.fillText(`Total Food: ${P}`,T,y),y+=I,e.fillStyle="#44ff44",e.fillText(`Bush Food: ${u.totalBushFood}`,T,y),y+=I,e.fillStyle="#ffaa44",e.fillText(`Storage Food: ${u.totalStorageFood}`,T,y),y+=I,e.fillStyle="#ff4444",e.fillText(`Consumption: ${d.toFixed(2)}/hour`,T,y),y+=20;const C=vi.slice(-50);C.length>1&&(f2(e,T,y,C),y+=100),e.fillStyle="#66ccff",e.font="bold 13px monospace",e.fillText(" Top 5 Families",T,y),y+=18;const _=l2(a,t,5);e.fillStyle="white",e.font="11px monospace",_.length===0?(e.fillText("No families found",T,y),y+=I):_.forEach((w,M)=>{const H=`${M+1}. ${w.patriarch.isPlayer?"Player":"#"+w.patriarch.id} (${w.memberCount} members, can split: ${cT(w.patriarch,t).canSplit})`;e.fillText(H,T,y),y+=I}),y+=10,e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift+3' to toggle this debugger",m+h/2,S+p-10),e.restore()}function d2(e,t,n,o){if(o.length<2)return;const l=Math.max(...o.map(d=>Math.max(d.total,d.children,d.males,d.females,d.old)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:o.map(d=>d.total),color:"#ffffff",label:"Total"},{data:o.map(d=>d.children),color:"#00ffff",label:"Children"},{data:o.map(d=>d.males),color:"#4488ff",label:"Males"},{data:o.map(d=>d.females),color:"#ff88ff",label:"Females"},{data:o.map(d=>d.old),color:"#888888",label:"Old"}].forEach(d=>{e.beginPath(),e.strokeStyle=d.color,e.lineWidth=2;for(let h=0;h<d.data.length;h++){const p=t+h/(d.data.length-1)*350,m=n+80-d.data[h]/l*80;h===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function f2(e,t,n,o){if(o.length<2)return;const l=Math.max(...o.map(d=>Math.max(d.totalFood,d.bushFood,d.storageFood)),10);e.strokeStyle="#333",e.lineWidth=1,e.strokeRect(t,n,350,80),[{data:o.map(d=>d.totalFood),color:"#ffff00",label:"Total"},{data:o.map(d=>d.bushFood),color:"#44ff44",label:"Bush"},{data:o.map(d=>d.storageFood),color:"#ffaa44",label:"Storage"}].forEach(d=>{e.beginPath(),e.strokeStyle=d.color,e.lineWidth=2;for(let h=0;h<d.data.length;h++){const p=t+h/(d.data.length-1)*350,m=n+80-d.data[h]/l*80;h===0?e.moveTo(p,m):e.lineTo(p,m)}e.stroke()})}function vv(e,t,n){e.save();const{x:o,y:s,width:a,height:l}=t.rect,u=FS;if(e.beginPath(),e.moveTo(o+u,s),e.lineTo(o+a-u,s),e.quadraticCurveTo(o+a,s,o+a,s+u),e.lineTo(o+a,s+l-u),e.quadraticCurveTo(o+a,s+l,o+a-u,s+l),e.lineTo(o+u,s+l),e.quadraticCurveTo(o,s+l,o,s+l-u),e.lineTo(o,s+u),e.quadraticCurveTo(o,s,o+u,s),e.closePath(),e.fillStyle=t.isDisabled?xS:t.backgroundColor,e.fill(),t.activated){e.save();const d=(Math.sin(Date.now()/1e3*$S)+1)/2;e.strokeStyle=GS,e.lineWidth=2+d*2,e.globalAlpha=.7+d*.3,e.stroke(),e.restore()}if(t.lastActivated){const d=Date.now()-t.lastActivated;if(d<mu){const h=1-d/mu;e.fillStyle=US,e.globalAlpha=h,e.fill(),e.globalAlpha=1}}n&&!t.isDisabled&&(e.fillStyle=wp,e.globalAlpha=.5,e.fill(),e.globalAlpha=1),e.fillStyle=t.isDisabled?LS:t.textColor,t.icon?(e.font=`${l*.55}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.icon,o+a/2,s+l/2),t.text&&(e.font=`${l*.18}px "Press Start 2P", Arial`,e.textAlign="right",e.textBaseline="bottom",e.fillText(t.text,o+a-4,s+l-2))):(e.font=`${In*1.5}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(t.text,o+a/2,s+l/2)),e.restore()}function h2(e,t,n,o){e.save(),e.fillStyle="rgba(0, 0, 0, 0.6)",e.fillRect(0,0,n,o);const s=500,a=150,l=(n-s)/2,u=(o-a)/2;e.fillStyle=Dt,e.font=`${In*1.1}px "Press Start 2P", Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText("Are you sure you want to exit",n/2,u+a/3-10),e.fillText("to the main menu?",n/2,u+a/3+10);const d=Yi*1.5,h=HS,p=u+a-h-Je*2,m=20,S=d*2+m,y=l+(s-S)/2,I={id:"confirmExitYes",action:Te.ConfirmExitYes,rect:{x:y,y:p,width:d,height:h},text:"Yes",backgroundColor:On,textColor:Dt,currentWidth:d},T=y+d+m,E={id:"confirmExitNo",action:Te.ConfirmExitNo,rect:{x:T,y:p,width:d,height:h},text:"No",backgroundColor:On,textColor:Dt,currentWidth:d};t.uiButtons.push(I,E),vv(e,I,t.hoveredButtonId===I.id),vv(e,E,t.hoveredButtonId===E.id),e.restore()}let Sv="",Tv=null;function p2(e){return e.map(t=>`${t.gridX},${t.gridY},${Math.floor(t.health)}`).join("|")}function g2(e){const t=new Set;for(const n of e)t.add(`${n.gridX},${n.gridY}`);return t}function zc(e,t,n,o,s,a,l){const u=((t+o)%a+a)%a,d=((n+s)%l+l)%l;return e.has(`${u},${d}`)}function m2(e,t,n,o){const s=$P(t.soilDepletion,hS);if(s.length===0)return;const{width:a,height:l}=t.mapDimensions,u=o.width/2,d=o.height/2,h=Math.ceil(a/zt),p=Math.ceil(l/zt),m=p2(s);m!==Sv&&(Sv=m,Tv=g2(s));const S=Tv,y=zt*2,I=n.x-u-y,T=n.x+u+y,E=n.y-d-y,P=n.y+d+y;e.save();const C=e.globalAlpha;for(const _ of s){const k=_.gridX*zt,w=_.gridY*zt,M=y2(k,w,a,l,I,T,E,P);for(const R of M)v2(e,R.x,R.y,_.health,_.gridX,_.gridY,S,h,p)}e.globalAlpha=C,e.restore()}function y2(e,t,n,o,s,a,l,u){const d=[],h=zt,p=[{dx:0,dy:0},{dx:-n,dy:0},{dx:n,dy:0},{dx:0,dy:-o},{dx:0,dy:o},{dx:-n,dy:-o},{dx:n,dy:-o},{dx:-n,dy:o},{dx:n,dy:o}];for(const m of p){const S=e+m.dx,y=t+m.dy;S+h>=s&&S<=a&&y+h>=l&&y<=u&&d.push({x:S,y})}return d}function v2(e,t,n,o,s,a,l,u,d){const h=Math.floor(t),p=Math.floor(n),m=zt,S=1-o/hS,I=o<gw?ly:ly*S,T=!zc(l,s,a,0,-1,u,d),E=!zc(l,s,a,0,1,u,d),P=!zc(l,s,a,-1,0,u,d),C=!zc(l,s,a,1,0,u,d);e.globalAlpha=I,e.fillStyle=hw,e.fillRect(h,p,m,m);const _=3;e.fillStyle=pw,e.globalAlpha=I*1.2,T&&e.fillRect(h,p,m,_),E&&e.fillRect(h,p+m-_,m,_),P&&e.fillRect(h,p,_,m),C&&e.fillRect(h+m-_,p,_,m),e.globalAlpha=I*.5;const k=_+1;T&&P&&e.fillRect(h,p,k,k),T&&C&&e.fillRect(h+m-k,p,k,k),E&&P&&e.fillRect(h,p+m-k,k,k),E&&C&&e.fillRect(h+m-k,p+m-k,k,k),e.globalAlpha=1}const Da=8,Oa=12,cn=24;function Iv(e,t,n,o,s){e.strokeStyle="#5D4037",e.lineWidth=2,e.beginPath(),e.moveTo(t,n),e.lineTo(t,n-Oa),e.stroke(),e.fillStyle=o,e.beginPath(),e.moveTo(t,n-Oa),e.lineTo(t+Da,n-Oa+Da/2),e.lineTo(t,n-Oa+Da),e.closePath(),e.fill(),s&&(e.font="8px sans-serif",e.fillStyle="#FFFFFF",e.textAlign="center",e.textBaseline="middle",e.fillText(s,t+Da/2,n-Oa+Da/2))}function jp(e,t,n,o,s){const a=Uu(t,s);let l=1;const u=new Map,d=new Map;for(const T of a){const P=T.leaderId===s?0:l++,C=Xt[P%Xt.length];u.set(T.leaderId,C),d.set(T.leaderId,T.tribeBadge||"")}const h=[],p=cn*2,m=Math.floor((n.x-o.width/2-p)/cn)*cn,S=Math.floor((n.x+o.width/2+p)/cn)*cn,y=Math.floor((n.y-o.height/2-p)/cn)*cn,I=Math.floor((n.y+o.height/2+p)/cn)*cn;for(let T=y;T<=I;T+=cn)for(let E=m;E<=S;E+=cn){const P=Nn(E,T,t),C=E+cn,_=Nn(C,T,t);if(P!==_){const M=P||_;if(M){const R=E+cn/2,H=T;Iv(e,R,H,u.get(M)||"#000",d.get(M)||""),h.push({x:R,y:H})}}const k=T+cn,w=Nn(E,k,t);if(P!==w){const M=P||w;if(M){const R=E,H=T+cn/2;Iv(e,R,H,u.get(M)||"#000",d.get(M)||""),h.push({x:R,y:H})}}}return h}const un=12,at=16,dn=15;function Av(e){switch(e){case N.Success:return"#4CAF50";case N.Failure:return"#F44336";case N.Running:return"#FFC107";case N.Empty:return"#9E9E9E";default:return"#FFFFFF"}}function Ah(e){if(e==null)return"None";if(typeof e=="number")return`Entity #${e}`;if(typeof e=="string")return`Task #${e}`;if(typeof e=="object"&&"x"in e&&"y"in e){const t=e;return`Pos(${t.x.toFixed(0)}, ${t.y.toFixed(0)})`}return JSON.stringify(e)}function S2(e,t,n,o){var R,H;const{debugCharacterId:s}=t,a=500,l=Math.min(o*.9,800),u=n-a-10,d=Je+In*2;t.debugPanelRect={x:u,y:d,width:a,height:l},e.save(),e.fillStyle="rgba(0, 0, 0, 0.9)",e.fillRect(u,d,a,l),e.strokeStyle="#444",e.lineWidth=2,e.strokeRect(u,d,a,l),e.fillStyle="white",e.font=`${un}px monospace`,e.textAlign="left",e.textBaseline="top";let h=d+20;const p=u+15;if(e.fillStyle="#66ccff",e.font=`bold ${un+2}px monospace`,e.fillText(" Task AI Debugger",p,h),h+=25,!s){e.fillStyle="#888",e.font=`${un}px monospace`,e.fillText("No character selected for debugging.",p,h),e.fillText("Click on a character to inspect their Task AI.",p,h+20),e.restore();return}const m=t.entities.entities[s];if(!m||m.type!=="human"&&m.type!=="predator"&&m.type!=="prey"){e.fillStyle="#ff4444",e.font=`${un}px monospace`,e.fillText(`Character #${s} not found or not a character.`,p,h),e.restore();return}const S=m;e.fillStyle="white",e.font=`${un}px monospace`,e.fillText(`Character: ${S.type} #${S.id} (${S.age.toFixed(1)}y)`,p,h),h+=at*1.5,e.fillStyle="#66ccff",e.font=`bold ${un}px monospace`,e.fillText(" Current Task",p,h),h+=at*1.5;const y=Au(S),I=y?t.tasks[y]:null;if(e.font=`${un}px monospace`,I){const j=Oe.get(S.aiBlackboard,OT),$=Oe.get(S.aiBlackboard,NT),V=j!==void 0?N[j]:"N/A";e.fillStyle="white",e.fillText(`ID: ${I.id}`,p+dn,h),h+=at,e.fillText(`Type: ${q[I.type]}`,p+dn,h),h+=at,e.fillText(`Target: ${Ah(I.target)}`,p+dn,h),h+=at,e.fillStyle=Av(j),e.fillText(`Status: ${V}`,p+dn,h),h+=at,$&&(e.fillStyle="#aaa",e.fillText(`Message: ${$}`,p+dn,h),h+=at)}else e.fillStyle="#888",e.fillText("No active task.",p+dn,h),h+=at;if(h+=at,S.type==="human"){const j=S;e.fillStyle="#66ccff",e.font=`bold ${un}px monospace`,e.fillText(" Pathfinding",p,h),h+=at*1.5,e.font=`${un}px monospace`,e.fillStyle="white",e.fillText(`Waypoints: ${((R=j.path)==null?void 0:R.length)||0}`,p+dn,h),h+=at,j.pathTarget&&(e.fillText(`Target: ${Ah(j.pathTarget)}`,p+dn,h),h+=at),j.path&&j.path.length>0&&(e.fillText(`Next: ${Ah(j.path[0])}`,p+dn,h),h+=at),h+=at}e.fillStyle="#66ccff",e.font=`bold ${un}px monospace`,e.fillText(" Recent Task History (Last 5)",p,h),h+=at*1.5;const T=Oe.get(S.aiBlackboard,jh)||[];if(T.length===0)e.fillStyle="#888",e.font=`${un}px monospace`,e.fillText("No task history yet.",p+dn,h),h+=at;else for(const j of T){e.fillStyle="white",e.font=`${un}px monospace`;const $=q[j.type];e.fillText(` ${$}`,p+dn,h);const V=N[j.result];e.fillStyle=Av(j.result);const ee=e.measureText(` ${$} `).width;e.fillText(`(${V})`,p+dn+ee,h),e.fillStyle="#666";const ue=e.measureText(`(${V}) `).width;e.fillText(`@ ${j.completedAtTick.toFixed(1)}h`,p+dn+ee+ue,h),h+=at,j.message&&(e.fillStyle="#888",e.fillText(`   ${j.message}`,p+dn,h),h+=at)}h+=at,e.fillStyle="#66ccff",e.font=`bold ${un}px monospace`,e.fillText(" Available Tasks",p,h),h+=at*1.5;const E=h,P=d+l-E-30;e.save(),e.beginPath(),e.rect(u,E,a,P),e.clip();const C=((H=t.debugPanelScroll)==null?void 0:H.y)??0;e.translate(0,-C);const _=t.search.tasks.byRadius(m.position,800);let k=0;if(_.length===0)e.fillStyle="#888",e.font=`${un}px monospace`,e.fillText("No tasks available in the world.",p+dn,h),h+=at;else{const j=_.map($=>{const V=qu[$.type];return{task:$,score:V&&V.scorer&&S.type==="human"?V.scorer(S,$,{gameState:t,deltaTime:0}):null}});j.sort(($,V)=>{const ee=$.score!==null?$.score:-1/0;return(V.score!==null?V.score:-1/0)-ee});for(const{task:$,score:V}of j){let ee="Unclaimed",ue="#888";$.claimedByEntityId&&($.claimedByEntityId===S.id?(ee="Claimed by this character",ue="#4CAF50"):(ee=`Claimed by #${$.claimedByEntityId}`,ue="#F44336")),e.font=`${un}px monospace`,e.fillStyle=ue;const oe=` Task ID: ${$.id}`;e.fillText(oe,p,h),h+=at,e.fillStyle="white",e.fillText(`  Type: ${q[$.type]}`,p,h),h+=at;const re=V!==null?V.toFixed(3):"N/A";e.fillStyle=V!==null&&V>0?"#FFC107":"#888",e.fillText(`  Score: ${re}`,p,h),h+=at,e.fillStyle=ue,e.fillText(`  Status: ${ee}`,p,h),h+=at*1.5,k=Math.max(k,e.measureText(oe).width+30)}}const w=h-E;t.debugPanelContentSize={width:k,height:w},e.restore();const M=d+l-15;e.fillStyle="#888",e.font="10px monospace",e.textAlign="center",e.fillText("Press 'Shift + ~' to toggle this debugger",u+a/2,M),e.restore()}function T2(e,t,n,o){const{debugCharacterId:s}=t;if(!s)return;const a=t.entities.entities[s];if(!(!a||a.type!=="human"&&a.type!=="predator"&&a.type!=="prey"))switch(a.aiType){case Go.TaskBased:default:S2(e,t,n,o);break}}function Cu(e,t,n,o,s,a=!1){var h;if(e.save(),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillStyle="#2c5234",e.fillRect(0,0,e.canvas.width,e.canvas.height),e.translate(e.canvas.width/2-n.x,e.canvas.height/2-n.y),!a&&t.gameOver){e.restore(),ND(e,t);return}const l=Nt(t),u=jp(e,t,n,s,l==null?void 0:l.leaderId);if(m2(e,t,n,s),e2(e,t,t.debugPanel===qe.General,n,s,u),l&&t.selectedBuildingType&&t.selectedBuildingType!=="removal"&&t.mousePosition){const p=Vh(t.mousePosition,n,s,t.mapDimensions),m=Ir(p,t.selectedBuildingType,l.leaderId,t);Yp(e,p,t.selectedBuildingType,m,t.mapDimensions)}const d=t.notifications.filter(p=>!p.isDismissed);for(const p of d){const m=(Math.sin(t.time*mP)+1)/2;e.globalAlpha=m*.5+.25,e.fillStyle=gP,p.targetArea&&e.fillRect(p.targetArea.x,p.targetArea.y,p.targetArea.width,p.targetArea.height),p.targetRadius&&(e.beginPath(),e.arc(p.targetRadius.x,p.targetRadius.y,p.targetRadius.radius,0,Math.PI*2),e.fill())}if(e.globalAlpha=1,zD(e,t),e.restore(),!a){e.fillStyle=OC,e.font=`${In}px "Press Start 2P", Arial`,e.shadowColor=NC,e.shadowBlur=BC,t.uiButtons=[];let p=null,m=null;if(l){const I=Ji(t,l),T=Is(I),E=((h=l.partnerIds)==null?void 0:h.map(C=>t.entities.entities[C]).filter(C=>C!==void 0))||[],P=t2(e,t,l,T,E,I);p=P.hungerBarRect,m=P.foodBarRect}const S=Uu(t,l==null?void 0:l.leaderId);AD(e,t,n,S,e.canvas.width,e.canvas.height,t.cameraZoom);const{commandButtonsRect:y}=yD(e,t,e.canvas.width);if(e.shadowColor="transparent",e.shadowBlur=0,l&&(YD(e,t,n,e.canvas.width,e.canvas.height),o.length>0&&ID(e,o,l,n,e.canvas.width,e.canvas.height,t.mapDimensions)),t.tutorialState.activeUIHighlights.length>0){const{activeUIHighlights:I}=t.tutorialState;I.includes(yr.HUNGER_BAR)&&p&&mh(e,p,t.time),I.includes(yr.FOOD_BAR)&&m&&mh(e,m,t.time),I.includes(yr.COMMAND_BUTTONS)&&y&&mh(e,y,t.time)}if(t.tutorialState.isActive){const I=OD(e,t,e.canvas.width,e.canvas.height);I&&t.uiButtons.push({id:"tutorial-dismiss",action:Te.DismissTutorial,rect:I,text:"",currentWidth:I.width,backgroundColor:"transparent",textColor:"transparent"})}switch(VD(e,t,e.canvas.width,e.canvas.height),t.debugPanel){case qe.Ecosystem:o2(e,t,e.canvas.width,e.canvas.height);break;case qe.Tribe:u2(e,t,e.canvas.width,e.canvas.height);break;case qe.Performance:ZD(e,t,s.width);break;case qe.General:T2(e,t,e.canvas.width,e.canvas.height);break}t.tribeModalOpen&&bD(e,t,S,e.canvas.width,e.canvas.height),t.isPaused&&t.exitConfirmation!=="pending"&&vD(e),t.exitConfirmation==="pending"&&h2(e,t,e.canvas.width,e.canvas.height)}}const I2=Ne.div`
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
`,A2=Ne.canvas`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background-color: #2c5234;
`,E2=Ne.div`
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  z-index: 1;
  background: linear-gradient(to bottom, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0) 50%, rgba(0, 0, 0, 0.7) 100%);
`,w2=Ne.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #fff;
  text-shadow: 4px 4px 0px #ff0000;
  margin-bottom: 2rem;
`,Ev=Ne.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  color: #fff;
  background-color: #ff0000;
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;

  &:hover {
    background-color: #fff;
    color: #ff0000;
    box-shadow: 4px 4px 0px #ff0000;
  }
`,C2=Ne.div`
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
  align-items: center;
`,P2=Ne.div`
  position: absolute;
  bottom: 1rem;
  font-family: 'Press Start 2P', cursive;
  font-size: 0.8rem;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
  a {
    color: #fff;
    text-decoration: none;
    &:hover {
      text-decoration: underline;
    }
  }
`,Xc="intro-soundtrack",wv=()=>{const{setAppState:e,savedGameState:t,clearCurrentSave:n}=Pi(),o=Q.useRef(null),s=Q.useRef(null),a=Q.useRef(rb()),l=Q.useRef(),u=Q.useRef(a.current.viewportCenter),d=Q.useRef(),h=Q.useCallback(()=>{ch(Xc,2),n(),e("game")},[e,n]),p=Q.useCallback(()=>{t&&(ch(Xc,2),e("game"))},[e,t]);Q.useEffect(()=>{const y=I=>{(I.key==="Enter"||I.key===" ")&&(t?p():h())};return window.addEventListener("keydown",y),()=>{window.removeEventListener("keydown",y)}},[h,p,t]),Q.useEffect(()=>(kp(Pe.SoundTrack1,{loop:!0,trackId:Xc}),()=>{ch(Xc,2)}),[]),Q.useEffect(()=>{const y=o.current;if(!y)return;s.current=y.getContext("2d");const I=()=>{y&&s.current&&(y.width=window.innerWidth,y.height=window.innerHeight,Cu(s.current,a.current,u.current,[],{width:y.width,height:y.height},!0))};return I(),window.addEventListener("resize",I),()=>window.removeEventListener("resize",I)},[]),Q.useEffect(()=>{const y=()=>{const T=kS(a.current);if(T.length>0){const E=Math.floor(Math.random()*T.length);d.current=T[E].id}};y();const I=setInterval(y,QE);return()=>clearInterval(I)},[]);const[m,S]=lp(y=>{var E,P;if(!s.current)return;if(l.current===void 0){l.current=y;return}const I=Math.min((y-l.current)/1e3,1);a.current=Zu(a.current,I);const T=d.current?a.current.entities.entities[d.current]:void 0;if(T){const{mapDimensions:C}=a.current,{width:_,height:k}=C;let w={...T.position};const M=w.x-u.current.x;Math.abs(M)>_/2&&(M>0?w.x-=_:w.x+=_);const R=w.y-u.current.y;Math.abs(R)>k/2&&(R>0?w.y-=k:w.y+=k);let H=ou(u.current,w,uu*I);H={x:(H.x%_+_)%_,y:(H.y%k+k)%k},u.current=H}Cu(s.current,a.current,u.current,[],{width:((E=o.current)==null?void 0:E.width)||800,height:((P=o.current)==null?void 0:P.height)||600},!0),l.current=y},!1);return Q.useEffect(()=>(S(),m),[S,m]),z.jsxs(I2,{children:[z.jsx(A2,{ref:o}),z.jsxs(E2,{children:[z.jsx(w2,{children:"Tribe2"}),z.jsxs(C2,{children:[z.jsx(Ev,{onClick:h,children:"New Game"}),t&&z.jsx(Ev,{onClick:p,children:"Load Game"})]}),z.jsxs(P2,{children:["by"," ",z.jsx("a",{href:"https://github.com/gtanczyk",target:"_blank",rel:"noopener noreferrer",children:"gtanczyk"})]})]})]})};function _2(){console.log("Tribe game initialized with detailed 2D world state.");const e=ob();return e.ecosystem={preyGestationPeriod:fr,preyProcreationCooldown:hr,predatorGestationPeriod:pr,predatorProcreationCooldown:gr,preyHungerIncreasePerHour:bo,predatorHungerIncreasePerHour:Do,berryBushSpreadChance:qi,treeSpreadChance:Zi},e.debugPanel=qe.None,e.performanceMetrics={currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},e}const R2=({canvasRef:e,ctxRef:t,gameStateRef:n,viewportCenterRef:o,playerActionHintsRef:s})=>(Q.useEffect(()=>{const a=e.current;if(!a)return;t.current=a.getContext("2d");const l=()=>{a&&t.current&&n.current&&(a.width=window.innerWidth,a.height=window.innerHeight,Cu(t.current,n.current,o.current,s.current,{width:a.width,height:a.height},!1))};return l(),window.addEventListener("resize",l),()=>window.removeEventListener("resize",l)},[]),z.jsx("canvas",{ref:e,style:{display:"block",background:"#2c5234"}})),k2=(e,t,n,o=!1)=>{var l,u;let s;const a=hC(e,n);if(a){if(t.isAdult&&a.type==="berryBush"&&a.food.length>0)s={action:Se.AutopilotGather,targetEntityId:a.id};else if(t.isAdult&&a.type==="corpse"&&a.food.length>0)s={action:Se.AutopilotGather,targetEntityId:a.id};else if(a.type==="human"){const d=a;t.isAdult&&yl(t,d,n)?s={action:Se.AutopilotAttack,targetEntityId:d.id}:bs(t,d,n)?s={action:Se.AutopilotProcreate,targetEntityId:d.id}:t.food.length>0&&!d.isAdult&&(d.motherId===t.id||d.fatherId===t.id)&&(s={action:Se.AutopilotFeedChild,targetEntityId:d.id})}else if(a.type==="prey")s={action:Se.AutopilotAttack,targetEntityId:a.id};else if(a.type==="predator")s={action:Se.AutopilotAttack,targetEntityId:a.id};else if(a.type==="building"){const d=a;if(n.selectedBuildingType==="removal")t.leaderId===t.id&&Tr(t,d,n)&&d.isConstructed?s={action:Se.RemoveEnemyBuilding,targetEntityId:d.id}:s={action:Se.Removal,position:a.position};else if(t.leaderId===t.id&&Tr(t,d,n)&&d.isConstructed)PS(d.position,Ai,t.id,n).valid?s={action:Se.TakeOverBuilding,targetEntityId:d.id}:s={action:Se.AutopilotMove,position:e};else if(d.buildingType==="storageSpot"){const h=d.ownerId===t.leaderId,p=d.storedItems.length>0,m=d.storageCapacity!==void 0&&d.storedItems.length<d.storageCapacity;if(o&&d.isConstructed&&p&&t.food.length<t.maxFood)if(h)s={action:Se.AutopilotRetrieve,targetEntityId:a.id};else{const S=t.leaderId?n.entities.entities[t.leaderId]:void 0;S&&((l=S.tribeControl)!=null&&l.diplomacy)?(d.ownerId&&S.tribeControl.diplomacy[d.ownerId])===bt.Hostile?s={action:Se.AutopilotGather,targetEntityId:a.id}:s={action:Se.AutopilotMove,position:e}:s={action:Se.AutopilotMove,position:e}}else h&&d.isConstructed?(t.food.length>0||t.heldItem)&&m?s={action:Se.AutopilotDeposit,targetEntityId:a.id}:t.food.length<t.maxFood&&p?s={action:Se.AutopilotRetrieve,targetEntityId:a.id}:s={action:Se.AutopilotMove,position:e}:s={action:Se.AutopilotMove,position:e}}else d.buildingType==="plantingZone"&&t.food.filter(h=>h.type===ui.Berry).length>=vr&&!Qi(e,n,Ou)&&!Er(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:Se.AutopilotPlant,position:e}:d.buildingType===X.Bonfire&&((u=t.heldItem)==null?void 0:u.type)===Gt.Wood&&d.isConstructed&&d.storedItems.length<(d.storageCapacity||0)?s={action:Se.AutopilotDeposit,targetEntityId:d.id}:s={action:Se.AutopilotMove,position:e}}else if(a.type==="tree"){const d=a,[h]=d.stateMachine??[],p=h===ri||h===zn||h===Ei;t.isAdult&&!t.heldItem&&p?s={action:Se.AutopilotChop,targetEntityId:d.id}:t.isAdult&&!t.heldItem&&h===Vt&&d.wood.length>0?s={action:Se.AutopilotGather,targetEntityId:d.id}:s={action:Se.AutopilotMove,position:e}}}else t.food.filter(d=>d.type===ui.Berry).length>=vr&&(n.autopilotControls.isManuallyPlanting||Sl(e,n,t))&&!Er(n.soilDepletion,e,n.mapDimensions.width,n.mapDimensions.height)?s={action:Se.AutopilotPlant,position:e}:s={action:Se.AutopilotMove,position:e};return s},M2=(e,t)=>{if(e.isPaused)return;const n=Nt(e);if(!n)return;if(e.selectedBuildingType&&e.selectedBuildingType!=="removal"){const s=e.selectedBuildingType,a=K(n.position,t,e.mapDimensions.width,e.mapDimensions.height),l=100;a<=l?Ir(t,s,n.leaderId,e,n.position,l)&&(Ip(t,s,n.leaderId,e),e.selectedBuildingType=null):Ir(t,s,n.leaderId,e)&&(e.autopilotControls.activeAutopilotAction={action:Se.AutopilotBuildingPlacement,position:t,buildingType:s},e.selectedBuildingType=null);return}if(e.selectedBuildingType==="removal"){const s=CC(t,e);s&&$h(s.id,e);return}const o=e.autopilotControls.hoveredAutopilotAction;e.autopilotControls.activeAutopilotAction=void 0,o?(e.autopilotControls.activeAutopilotAction=o,(o.action===Se.AutopilotMove||o.action===Se.AutopilotGather||o.action===Se.AutopilotChop)&&(e.hasPlayerMovedEver=!0),o.action===Se.AutopilotPlant&&(e.hasPlayerPlantedBush=!0)):e.autopilotControls.activeAutopilotAction={action:Se.AutopilotMove,position:t},e.autopilotControls.isManuallyMoving=!1,e.autopilotControls.isManuallyPlanting=!1},b2=(e,t)=>{var l,u,d,h,p,m;const n=e.key.toLowerCase(),o=e.ctrlKey||e.metaKey;let s=!0,a=t;if(o){switch(n){case"s":tp(t);break;default:s=!1;break}return{newState:a,handled:s}}switch(n){case"escape":const{autopilotControls:S}=t;S.activeAutopilotAction||S.isManuallyMoving||S.isManuallyPlanting||t.buildMenuOpen||t.selectedBuildingType?(S.activeAutopilotAction=void 0,S.isManuallyMoving=!1,S.isManuallyPlanting=!1,t.buildMenuOpen=!1,t.selectedBuildingType=null):a.exitConfirmation==="pending"?(a.exitConfirmation="inactive",a.isPaused=!1):(a.exitConfirmation="pending",a.isPaused=!0);break;case"m":t.isMuted=!t.isMuted,qa(t.masterVolume,t.isMuted);break;case"=":case"+":const y=Math.min(1,t.masterVolume+.1);t.masterVolume=parseFloat(y.toFixed(1)),qa(t.masterVolume,t.isMuted);break;case"-":const I=Math.max(0,t.masterVolume-.1);t.masterVolume=parseFloat(I.toFixed(1)),qa(t.masterVolume,t.isMuted);break;case"t":a=Zu(t,nT);break;case" ":case"p":t.isPaused=!t.isPaused;break;case"":case"`":a.debugPanel===qe.General?(a.debugPanel=qe.None,a.debugCharacterId=void 0):(a.debugPanel=qe.General,a.debugCharacterId||(a.debugCharacterId=((l=Nt(a))==null?void 0:l.id)??((u=Object.values(a.entities.entities).find(T=>T.type==="human"||T.type==="prey"||T.type==="predator"))==null?void 0:u.id)));break;case"!":if(e.shiftKey){if(a.debugPanel===qe.Ecosystem){a.debugPanel=qe.None;break}a.debugPanel=qe.Ecosystem,a.debugCharacterId||(a.debugCharacterId=((d=Nt(a))==null?void 0:d.id)??((h=Object.values(a.entities.entities).find(T=>T.type==="human"||T.type==="prey"||T.type==="predator"))==null?void 0:h.id))}else s=!1;break;case"#":if(e.shiftKey){if(a.debugPanel===qe.Tribe){a.debugPanel=qe.None;break}a.debugPanel=qe.Tribe,(!a.debugCharacterId||!a.entities.entities[a.debugCharacterId])&&(a.debugCharacterId=((p=Nt(a))==null?void 0:p.id)??((m=a.search.human.all().find(T=>T.leaderId===T.id))==null?void 0:m.id))}else s=!1;break;case"@":if(e.shiftKey){if(a.debugPanel===qe.Performance){a.debugPanel=qe.None;break}a.debugPanel=qe.Performance}else s=!1;break;case"tab":if(a.debugPanel!==qe.General&&a.debugPanel!==qe.Tribe&&(a.debugPanel=qe.General),a.debugPanel===qe.General){const T=Object.values(a.entities.entities).filter(E=>E.type==="human"||E.type==="prey"||E.type==="predator");if(T.length>0){const E=T.sort((k,w)=>{if(k.type==="human"&&k.isPlayer)return-1;if(w.type==="human"&&w.isPlayer)return 1;if(k.type!==w.type){const M={human:0,prey:1,predator:2},R=M[k.type]??999,H=M[w.type]??999;return R-H}return k.id-w.id}),P=a.debugCharacterId,_=((P?E.findIndex(k=>k.id===P):-1)+1)%E.length;a.debugCharacterId=E[_].id}else a.debugCharacterId=void 0}else if(a.debugPanel===qe.Tribe){const T=a.search.human.all().filter(P=>P.leaderId===P.id);let E=T.findIndex(P=>P.id===a.debugCharacterId)+1;(E===-1||E>T.length-1)&&(E=0),a.debugCharacterId=T[E].id}else a.debugPanel=qe.None,a.debugCharacterId=void 0;break;default:s=!1;break}return{newState:a,handled:s}},D2=(e,t,n,o,s)=>{var l;const a={gameState:n};if(t&&["e","b","r","h","c"].includes(e)&&n.hasPlayerEnabledAutopilot++,n.buildMenuOpen){if(e==="1"){n.selectedBuildingType="storageSpot",ke(a,Pe.ButtonClick,o.position);return}else if(e==="2"){n.selectedBuildingType="plantingZone",ke(a,Pe.ButtonClick,o.position);return}else if(e==="3"){n.selectedBuildingType="palisade",ke(a,Pe.ButtonClick,o.position);return}else if(e==="4"){n.selectedBuildingType="bonfire",ke(a,Pe.ButtonClick,o.position);return}else if(e==="5"){n.selectedBuildingType="borderPost",ke(a,Pe.ButtonClick,o.position);return}else if(e==="6"){n.selectedBuildingType="removal",ke(a,Pe.ButtonClick,o.position);return}else if(e==="7"){n.selectedBuildingType="gate",ke(a,Pe.ButtonClick,o.position);return}}if(e==="escape"&&n.selectedBuildingType){n.selectedBuildingType=null;return}if(e==="e"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const u=Ke(o,n,"berryBush",Qe,p=>p.food.length>0&&o.food.length<o.maxFood),d=Ke(o,n,"corpse",Qe,p=>p.food.length>0&&o.food.length<o.maxFood);let h=null;u&&d?h=K(o.position,u.position,n.mapDimensions.width,n.mapDimensions.height)<=K(o.position,d.position,n.mapDimensions.width,n.mapDimensions.height)?u:d:h=u||d,h&&(o.activeAction="gathering",ke(a,Pe.Gather,o.position))}else if(e==="r"){if(t){n.autopilotControls.behaviors.procreation=!n.autopilotControls.behaviors.procreation;return}Ke(o,n,"human",Qe,d=>bs(o,d,n))&&(o.activeAction="procreating",ke(a,Pe.Procreate,o.position))}else if(e==="f")o.food.length>0&&(o.activeAction="eating",ke(a,Pe.Eat,o.position));else if(e==="h"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const u=s.find(d=>d.type===Se.FeedChild);u&&u.targetEntity&&(o.activeAction="feeding",o.target=u.targetEntity.id)}else if(e==="arrowup"||e==="w")o.direction.y=-1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowdown"||e==="s")o.direction.y=1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowleft"||e==="a")o.direction.x=-1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="arrowright"||e==="d")o.direction.x=1,o.activeAction="moving",o.target=void 0,n.hasPlayerMovedEver=!0,n.autopilotControls.isManuallyMoving=!0,n.autopilotControls.activeAutopilotAction=void 0;else if(e==="q"){if(t){n.autopilotControls.behaviors.attack=!n.autopilotControls.behaviors.attack;return}const u=Ke(o,n,"human",An,d=>yl(o,d,n))??Ke(o,n,"predator",An)??Ke(o,n,"prey",An);u&&(o.activeAction="attacking",o.attackTargetId=u.id)}else if(e==="b"){if(t){n.autopilotControls.behaviors.planting=!n.autopilotControls.behaviors.planting;return}if(s.find(d=>d.type===Se.Plant)){const d=zw(o.position,n,50,Hh);d&&(o.activeAction="planting",o.target=d,n.hasPlayerPlantedBush=!0)}}else if(e==="x"){if(t){n.autopilotControls.behaviors.gathering=!n.autopilotControls.behaviors.gathering;return}const u=Ke(o,n,"building",ci,h=>{const p=h;return p.buildingType===X.Bonfire&&p.isConstructed&&p.storedItems.length<(p.storageCapacity||0)});if(((l=o.heldItem)==null?void 0:l.type)===Gt.Wood&&u){o.activeAction="depositing",o.target=u.id,ke(a,Pe.StorageDeposit,o.position);return}const d=Ke(o,n,"building",ci,h=>{const p=h;return p.buildingType===X.StorageSpot&&p.ownerId===o.leaderId&&p.isConstructed&&p.storageCapacity!==void 0&&p.storedItems.length<p.storageCapacity});d&&(o.activeAction="idle",o.target=d.id,ke(a,Pe.StorageDeposit,o.position))}else if(e==="z"){if(t){n.autopilotControls.behaviors.feedChildren=!n.autopilotControls.behaviors.feedChildren;return}const u=Ke(o,n,"building",ci,d=>{const h=d;return h.buildingType==="storageSpot"&&h.ownerId===o.leaderId&&h.isConstructed&&h.storedItems.length>0});u&&(o.activeAction="idle",o.target=u.id,ke(a,Pe.StorageRetrieve,o.position))}else if(e==="k")uT(o,n);else if(e==="l"){if(t){n.autopilotControls.behaviors.build=!n.autopilotControls.behaviors.build;return}n.buildMenuOpen=!n.buildMenuOpen,ke(a,Pe.ButtonClick,o.position)}else if(e==="c"){if(t){n.autopilotControls.behaviors.chopping=!n.autopilotControls.behaviors.chopping;return}const u=Ke(o,n,"tree",Bu,d=>d.wood&&d.wood.length>0&&!o.heldItem);u&&(o.activeAction="chopping",o.target=u.id)}},O2=(e,t,n,o)=>{e==="arrowup"||e==="w"||e==="arrowdown"||e==="s"?t.direction.y=0:(e==="arrowleft"||e==="a"||e==="arrowright"||e==="d")&&(t.direction.x=0),!o.current.has("arrowup")&&!o.current.has("arrowdown")&&!o.current.has("arrowleft")&&!o.current.has("arrowright")&&!o.current.has("w")&&!o.current.has("a")&&!o.current.has("s")&&!o.current.has("d")&&(t.activeAction==="moving"&&(t.activeAction="idle"),n.autopilotControls.isManuallyMoving=!1),!o.current.has("e")&&t.activeAction==="gathering"&&(t.activeAction="idle"),!o.current.has("f")&&t.activeAction==="eating"&&(t.activeAction="idle"),!o.current.has("r")&&t.activeAction==="procreating"&&(t.activeAction="idle"),!o.current.has("h")&&t.activeAction==="feeding"&&(t.activeAction="idle"),!o.current.has("c")&&t.activeAction==="chopping"&&(t.activeAction="idle")},N2=(e,t,n)=>{const{mapDimensions:o}=e,{width:s,height:a}=o;if(!e.cameraFollowingPlayer){if(e.cameraTargetPosition){const d=xe(t,e.cameraTargetPosition,s,a);if(Bo(d)<1){const S=e.cameraTargetPosition;return e.cameraTargetPosition=void 0,S}const p=Xn(t,d);let m=ou(t,p,uu*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return t}let u=Nt(e);if(e.debugCharacterId){const d=e.entities.entities[e.debugCharacterId];d&&"position"in d&&(u=d)}if(u){let d={...u.position};const h=d.x-t.x;Math.abs(h)>s/2&&(h>0?d.x-=s:d.x+=s);const p=d.y-t.y;Math.abs(p)>a/2&&(p>0?d.y-=a:d.y+=a);let m=ou(t,d,uu*n);return m={x:(m.x%s+s)%s,y:(m.y%a+a)%a},m}return e.viewportCenter};function B2(e,t){const{width:n,height:o}=e.mapDimensions;e.cameraTargetPosition=void 0,e.viewportCenter={x:(t.x%n+n)%n,y:(t.y%o+o)%o}}const H2=(e,t,n,o)=>{var d,h;const s={gameState:n},a=Nt(n);a&&ke(s,Pe.ButtonClick,a.position);const l=n.uiButtons.find(p=>p.id===e.id);l&&(l.lastActivated=Date.now()),t&&[Te.CommandGather,Te.CommandPlant,Te.ToggleProcreationBehavior,Te.CommandBuild].includes(e.action)&&n.hasPlayerEnabledAutopilot++;const{behaviors:u}=n.autopilotControls;switch(e.action){case Te.ReturnToIntro:n.exitConfirmation="pending",n.isPaused=!0;break;case Te.ConfirmExitYes:o(),n.exitConfirmation="inactive";break;case Te.ConfirmExitNo:n.exitConfirmation="inactive",n.isPaused=!1;break;case Te.ToggleMute:n.isMuted=!n.isMuted,qa(n.masterVolume,n.isMuted);break;case Te.TogglePause:n.isPaused=!n.isPaused;break;case Te.FastForward:return Zu(n,nT);case Te.DismissTutorial:n.tutorialState.isActive=!1;break;case Te.CommandEat:a&&a.food.length>0&&(a.activeAction="eating");break;case Te.CommandGather:t?u.gathering=!u.gathering:a&&(a.activeAction="gathering");break;case Te.CommandPlant:t?u.planting=!u.planting:a&&(n.autopilotControls.isManuallyPlanting=!0);break;case Te.ToggleProcreationBehavior:u.procreation=!u.procreation;break;case Te.ToggleAttackBehavior:u.attack=!u.attack;break;case Te.ToggleFeedChildBehavior:u.feedChildren=!u.feedChildren;break;case Te.CommandTribeSplit:a&&uT(a,n);break;case Te.CommandBuild:t?u.build=!u.build:n.buildMenuOpen=!n.buildMenuOpen;break;case Te.SelectStorageSpot:n.selectedBuildingType="storageSpot";break;case Te.SelectPlantingZone:n.selectedBuildingType="plantingZone";break;case Te.SelectRemovalTool:n.selectedBuildingType="removal";break;case Te.SelectBorderPost:n.selectedBuildingType="borderPost";break;case Te.SelectBonfire:n.selectedBuildingType="bonfire";break;case Te.SelectPalisade:n.selectedBuildingType="palisade";break;case Te.SelectGate:n.selectedBuildingType="gate";break;case Te.ToggleDiplomacy:if(a&&a.leaderId&&e.targetTribeId){const p=a.leaderId,m=e.targetTribeId,S=n.entities.entities[m],y=(d=a.tribeControl)==null?void 0:d.diplomacy,I=(h=S==null?void 0:S.tribeControl)==null?void 0:h.diplomacy;if(y&&I){const E=(y[m]||bt.Friendly)===bt.Friendly?bt.Hostile:bt.Friendly;y[m]=E,I[p]=E}}break;case Te.OpenTribeModal:n.tribeModalOpen=!0;break;case Te.RecenterCamera:n.cameraFollowingPlayer=!0;break;case Te.CloseTribeModal:n.tribeModalOpen=!1;break}return n};function F2(e,t,n){if(!e.notificationButtonRects)return!1;const o=Nt(e);for(const[s,a]of Object.entries(e.notificationButtonRects.dismiss))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height)return Ww(e,s),o&&ke({gameState:e},Pe.ButtonClick,o.position),!0;for(const[s,a]of Object.entries(e.notificationButtonRects.view))if(t>=a.x&&t<=a.x+a.width&&n>=a.y&&n<=a.y+a.height){const l=e.notifications.find(u=>u.id===s);if(l){let u=l.targetPosition;if(!u&&l.targetEntityIds&&l.targetEntityIds.length>0){const d=e.entities.entities[l.targetEntityIds[0]];d&&(u=d.position)}return u&&B2(e,u),o&&ke({gameState:e},Pe.ButtonClick,o.position),l.highlightedEntityIds&&(l.renderHighlights=!l.renderHighlights),!0}}return!1}function yI(e,t){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}const x2=(e,t)=>{var n;if(t.debugPanel!==qe.General||!t.debugPanelRect||!t.mousePosition)return{newState:t,handled:!1};if(yI(t.mousePosition,t.debugPanelRect)){t.debugPanelScroll.y+=e.deltaY>0?40:-40,t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.height-60,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.height)??0)-s);return t.debugPanelScroll.y>a&&(t.debugPanelScroll.y=a),e.preventDefault(),{newState:t,handled:!0}}return{newState:t,handled:!1}},L2=(e,t)=>t.debugPanel!==qe.General||!t.debugPanelRect||!t.mousePosition?{newState:t,handled:!1}:yI(t.mousePosition,t.debugPanelRect)?(t.isDraggingDebugPanel=!0,{newState:t,handled:!0}):{newState:t,handled:!1},Cv=(e,t)=>t.isDraggingDebugPanel?(t.isDraggingDebugPanel=!1,{newState:t,handled:!0}):{newState:t,handled:!1},U2=(e,t)=>{var n,o;if(t.isDraggingDebugPanel&&t.debugPanelRect){t.debugPanelScroll.x-=e.movementX,t.debugPanelScroll.y-=e.movementY,t.debugPanelScroll.x<0&&(t.debugPanelScroll.x=0),t.debugPanelScroll.y<0&&(t.debugPanelScroll.y=0);const s=t.debugPanelRect.width-30,a=Math.max(0,(((n=t.debugPanelContentSize)==null?void 0:n.width)??0)-s);t.debugPanelScroll.x>a&&(t.debugPanelScroll.x=a);const l=t.debugPanelRect.height-60,u=Math.max(0,(((o=t.debugPanelContentSize)==null?void 0:o.height)??0)-l);return t.debugPanelScroll.y>u&&(t.debugPanelScroll.y=u),{newState:t,handled:!0}}return{newState:t,handled:!1}};function G2(e,t,n){if(!n.minimapRect)return;const{x:o,y:s,width:a,height:l}=n.minimapRect;e>=o&&e<=o+a&&t>=s&&t<=s+l&&(n.isDraggingMinimap=!0,n.minimapDragDistance=0)}function $2(e,t,n,o){n.isDraggingMinimap&&(n.isDraggingMinimap=!1,n.minimapDragDistance<5&&Y2(e,t,n,o,!1))}function W2(e,t,n,o,s){if(!n.minimapRect){n.hoveredMinimapTribeId=null;return}if(n.isDraggingMinimap){if(o){n.minimapDragDistance+=Math.sqrt(o.x*o.x+o.y*o.y),n.cameraFollowingPlayer=!1,n.cameraTargetPosition=void 0;const{width:l,height:u}=n.mapDimensions,{width:d,height:h}=n.minimapRect,p=o.x/d*l,m=o.y/h*u,S=n.viewportCenter.x-p,y=n.viewportCenter.y-m,I={x:(S%l+l)%l,y:(y%u+u)%u};n.viewportCenter=I,s&&(s.current=I)}return}const a=vI(e,t,n.minimapRect,n);a?n.hoveredMinimapTribeId=Nn(a.x,a.y,n):n.hoveredMinimapTribeId=null}function Y2(e,t,n,o,s=!1){if(!n.minimapRect)return;const a=vI(e,t,n.minimapRect,n);a&&(n.cameraFollowingPlayer=!1,s?(n.viewportCenter=a,n.cameraTargetPosition=void 0,o&&(o.current=a)):n.cameraTargetPosition=a)}function j2(e,t,n,o,s){if(!o.minimapRect)return!1;const{x:a,y:l,width:u,height:d}=o.minimapRect;if(t>=a&&t<=a+u&&n>=l&&n<=l+d){o.cameraFollowingPlayer=!1,o.cameraTargetPosition=void 0;const{width:h,height:p}=o.mapDimensions,m=e.deltaX/u*h,S=e.deltaY/d*p,y=o.viewportCenter.x+m,I=o.viewportCenter.y+S,T={x:(y%h+h)%h,y:(I%p+p)%p};return o.viewportCenter=T,s&&(s.current=T),!0}return!1}function vI(e,t,n,o){const s=e-n.x,a=t-n.y;if(s<0||s>n.width||a<0||a>n.height)return null;const{width:l,height:u}=o.mapDimensions,d=n.width/2,h=n.height/2,p=s-d,m=a-h,S=p/n.width*l,y=m/n.height*u,I=o.viewportCenter.x+S,T=o.viewportCenter.y+y;return{x:(I%l+l)%l,y:(T%u+u)%u}}function z2(e,t,n){t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,a=t.viewportCenter.x+e.deltaX,l=t.viewportCenter.y+e.deltaY,u={x:(a%o+o)%o,y:(l%s+s)%s};return t.viewportCenter=u,n.current=u,!0}function X2(e,t){(e.button===1||e.button===2)&&(t.isDraggingViewport=!0,t.viewportDragButton=e.button,t.viewportDragDistance=0)}function V2(e,t,n){if(t.isDraggingViewport){t.viewportDragDistance+=Math.sqrt(e.movementX*e.movementX+e.movementY*e.movementY),t.cameraFollowingPlayer=!1,t.cameraTargetPosition=void 0;const{width:o,height:s}=t.mapDimensions,a=t.viewportCenter.x-e.movementX,l=t.viewportCenter.y-e.movementY,u={x:(a%o+o)%o,y:(l%s+s)%s};t.viewportCenter=u,n.current=u}}function q2(e,t){t.isDraggingViewport&&e.button===t.viewportDragButton&&(t.isDraggingViewport=!1,t.viewportDragButton=null)}const Z2=({isActive:e,gameStateRef:t,canvasRef:n,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:a,returnToIntro:l})=>(Q.useEffect(()=>{const u=d=>{if(!e()||t.current.gameOver||!n.current)return;const h=n.current.getBoundingClientRect(),p=d.clientX-h.left,m=d.clientY-h.top;if(j2(d,p,m,t.current,o)){d.preventDefault();return}const S=x2(d,t.current);t.current=S.newState,!S.handled&&z2(d,t.current,o)&&d.preventDefault()};return window.addEventListener("wheel",u,{passive:!1}),()=>{window.removeEventListener("wheel",u)}},[e,n,t,o]),Q.useEffect(()=>{const u=h=>{if(!e()||t.current.gameOver||!n.current||!h.target||h.target!==n.current)return;const p=n.current.getBoundingClientRect(),m=h.clientX-p.left,S=h.clientY-p.top;if(F2(t.current,m,S))return;const I=t.current.uiButtons.find(C=>m>=C.rect.x&&m<=C.rect.x+C.rect.width&&S>=C.rect.y&&S<=C.rect.y+C.rect.height);if(I){t.current=H2(I,h.shiftKey,t.current,l);return}const T=t.current.minimapRect;if(T&&m>=T.x&&m<=T.x+T.width&&S>=T.y&&S<=T.y+T.height){G2(m,S,t.current);return}const E=L2(h,t.current);if(t.current=E.newState,E.handled)return;X2(h,t.current);const P=Vh({x:m,y:S},o.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);M2(t.current,P)},d=h=>{if(!e()||!n.current)return;const p=n.current.getBoundingClientRect(),m=h.clientX-p.left,S=h.clientY-p.top;$2(m,S,t.current,o),q2(h,t.current);const y=Cv(h,t.current);t.current=y.newState};return window.addEventListener("mousedown",u),window.addEventListener("mouseup",d),()=>{window.removeEventListener("mousedown",u),window.removeEventListener("mouseup",d)}},[e,n,t,o,l]),Q.useEffect(()=>{const u=d=>{if(!e()||!n.current)return;const h=U2(d,t.current);if(t.current=h.newState,h.handled)return;if(t.current.isDraggingDebugPanel&&(d.buttons&1)===0){const P=Cv(d,t.current);t.current=P.newState}const p=n.current.getBoundingClientRect(),m=d.clientX-p.left,S=d.clientY-p.top;V2(d,t.current,o),t.current.mousePosition={x:m,y:S};let y;if(t.current.notificationButtonRects){for(const[P,C]of Object.entries(t.current.notificationButtonRects.dismiss))if(m>=C.x&&m<=C.x+C.width&&S>=C.y&&S<=C.y+C.height){y=`notification-dismiss-${P}`;break}if(!y){for(const[P,C]of Object.entries(t.current.notificationButtonRects.view))if(m>=C.x&&m<=C.x+C.width&&S>=C.y&&S<=C.y+C.height){y=`notification-view-${P}`;break}}}if(!y)for(let P=t.current.uiButtons.length-1;P>=0;P--){const C=t.current.uiButtons[P];if(m>=C.rect.x&&m<=C.rect.x+C.rect.width&&S>=C.rect.y&&S<=C.rect.y+C.rect.height){y=C.id;break}}if(t.current.hoveredButtonId=y,y){t.current.autopilotControls.hoveredAutopilotAction=void 0,t.current.hoveredMinimapTribeId=null;return}const I=t.current.minimapRect,T=t.current.isDraggingMinimap;if(I&&m>=I.x&&m<=I.x+I.width&&S>=I.y&&S<=I.y+I.height||T){W2(m,S,t.current,{x:d.movementX,y:d.movementY},o),t.current.autopilotControls.hoveredAutopilotAction=void 0;return}else t.current.hoveredMinimapTribeId=null;const E=Nt(t.current);if(E){const P=Vh({x:m,y:S},o.current,{width:n.current.width,height:n.current.height},t.current.mapDimensions);t.current.autopilotControls.hoveredAutopilotAction=k2(P,E,t.current,d.shiftKey)}else t.current.autopilotControls.hoveredAutopilotAction=void 0};return window.addEventListener("mousemove",u),()=>{window.removeEventListener("mousemove",u)}},[e,n,t,o]),Q.useEffect(()=>{const u=h=>{if(!e()||t.current.gameOver)return;const p=h.key.toLowerCase();(p===" "||p==="p"||p==="tab"||(h.ctrlKey||h.metaKey)&&(p==="s"||p==="a"))&&h.preventDefault();const m=b2(h,t.current);if(t.current=m.newState,m.handled)return;const S=Nt(t.current);S&&(a.current.add(p),D2(p,h.shiftKey,t.current,S,s.current))},d=h=>{if(!e()||t.current.gameOver)return;const p=h.key.toLowerCase();a.current.delete(p);const m=Nt(t.current);m&&O2(p,m,t.current,a)};return window.addEventListener("keydown",u),window.addEventListener("keyup",d),()=>{window.removeEventListener("keydown",u),window.removeEventListener("keyup",d)}},[e,t,s,a,l]),Q.useEffect(()=>{const u=n.current;if(!u)return;const d=h=>{e()&&h.preventDefault()};return u.addEventListener("contextmenu",d),()=>{u.removeEventListener("contextmenu",d)}},[n,e]),null),K2=({gameStateRef:e,ctxRef:t,debugPanelTypeRef:n,viewportCenterRef:o,playerActionHintsRef:s,keysPressed:a,canvasRef:l,setAppState:u,appState:d})=>{const h=Q.useRef(),{returnToIntro:p}=Pi(),[m,S,y]=lp(I=>{var k,w;if(!t.current||!h.current){h.current=I;return}const T=Math.min(I-h.current,1e3)/1e3,{performanceMetrics:E}=e.current;E.currentBucket={renderTime:0,worldUpdateTime:0,aiUpdateTime:0};const P=performance.now();e.current=Zu(e.current,T),E.currentBucket.worldUpdateTime=performance.now()-P;const C=Nt(e.current);C?s.current=Dp(e.current,C):s.current=[],(e.current.viewportCenter.x!==o.current.x||e.current.viewportCenter.y!==o.current.y)&&(o.current=e.current.viewportCenter),o.current=N2(e.current,o.current,T),e.current.viewportCenter=o.current;const _=performance.now();Cu(t.current,e.current,o.current,s.current,{width:((k=l.current)==null?void 0:k.width)||800,height:((w=l.current)==null?void 0:w.height)||600},!1),E.currentBucket.renderTime=performance.now()-_,E.history.push({bucketTime:e.current.time,...E.currentBucket}),E.history.length>JE&&E.history.shift(),h.current=I,e.current.gameOver&&d!=="gameOver"&&(kp(Pe.GameOver,{masterVolume:e.current.masterVolume,isMuted:e.current.isMuted}),u("gameOver",{generations:e.current.generationCount,cause:e.current.causeOfGameOver||"Unknown"}))},!1);return Q.useEffect(()=>(S(),m),[S,m]),z.jsx(Z2,{isActive:y,gameStateRef:e,canvasRef:l,viewportCenterRef:o,playerActionHintsRef:s,debugPanelTypeRef:n,keysPressed:a,returnToIntro:p})},Pv=()=>{const{savedGameState:e,contextReady:t}=Pi(),[n,o]=Q.useState(null);return Q.useEffect(()=>{t&&(e?(console.log("Loading saved game state..."),o(e)):(console.log("Initializing new game state..."),o(_2())))},[t,e]),!t||!n?z.jsx("div",{children:"Loading..."}):z.jsx(Q2,{initialState:n})},Q2=({initialState:e})=>{const t=Q.useRef(null),n=Q.useRef(null),o=Q.useRef(e),s=Q.useRef(new Set),a=Q.useRef(e.debugPanel),l=Q.useRef(e.viewportCenter),u=Q.useRef([]),{appState:d,setAppState:h}=Pi();return z.jsxs(z.Fragment,{children:[z.jsx(R2,{canvasRef:t,ctxRef:n,gameStateRef:o,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:u}),z.jsx(K2,{gameStateRef:o,ctxRef:n,debugPanelTypeRef:a,viewportCenterRef:l,playerActionHintsRef:u,keysPressed:s,canvasRef:t,setAppState:h,appState:d})]})},J2=Ne.div`
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.75); // Semi-transparent overlay
  color: #fff;
  padding: 20px;
  z-index: 10; // Ensure it's on top
`,eN=Ne.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 4rem;
  color: #ff4136; // Red for emphasis
  text-shadow: 4px 4px 0px #000;
  margin-bottom: 1.5rem;
`,Vc=Ne.p`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.2rem;
  margin: 0.5em 0;
  color: #fff;
  text-shadow: 2px 2px 0px #000;
`,tN=Ne.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1rem;
  padding: 1rem 2rem;
  margin-top: 2em;
  color: #fff;
  background-color: #ff4136; // Red button
  border: 2px solid #fff;
  box-shadow: 4px 4px 0px #fff;
  cursor: pointer;
  transition: all 0.2s ease-in-out;
  text-transform: uppercase;

  &:hover {
    background-color: #fff;
    color: #ff4136;
    box-shadow: 4px 4px 0px #ff4136;
  }
`,nN=()=>{const{setAppState:e,gameOverDetails:t}=Pi(),n=()=>{e("intro")};return z.jsxs(J2,{children:[z.jsx(eN,{children:"Game Over"}),z.jsx(Vc,{children:"Your tribe's lineage has ended."}),t&&z.jsxs(z.Fragment,{children:[z.jsxs(Vc,{children:["Generations Survived: ",t.generations]}),z.jsxs(Vc,{children:["Cause of Extinction: ",t.cause]})]}),!t&&z.jsx(Vc,{children:"Game details are unavailable."}),z.jsx(tN,{onClick:n,children:"Return to Menu"})]})},iN=Ne.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,oN=Ne.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,rN=Ne.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,sN=Ne.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,aN=Ne.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,SI=Ne.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,lN=Ne(SI)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,Na=800,Ba=600,cN=()=>{const{returnToIntro:e}=Pi(),t=Q.useRef(null),n=Q.useRef(),o=Q.useRef({time:0,visualEffects:[],nextVisualEffectId:1,mapDimensions:{width:Na,height:Ba}}),s=l=>{const u={x:Na/2,y:Ba/2};let d;l===Ce.StoneProjectile&&(d={x:u.x+200*(Math.random()-Math.random()),y:u.y+200*(Math.random()-Math.random())}),Fe(o.current,l,u,1,void 0,d)};Q.useEffect(()=>{const l=()=>{o.current.time+=.016,Lp(o.current);const d=t.current,h=d==null?void 0:d.getContext("2d");h&&(h.clearRect(0,0,Na,Ba),h.fillStyle="#2c5234",h.fillRect(0,0,Na,Ba),o.current.visualEffects.forEach(p=>{pI(h,p,o.current.time,o.current)})),n.current=requestAnimationFrame(l)};return n.current=requestAnimationFrame(l),()=>{n.current&&cancelAnimationFrame(n.current)}},[]);const a=Object.keys(Ce).filter(l=>isNaN(Number(l))).map(l=>({name:l,value:Ce[l]}));return z.jsxs(iN,{children:[z.jsxs(oN,{children:[z.jsx(aN,{children:"Visual Effects"}),a.map(l=>z.jsx(SI,{onClick:()=>s(l.value),children:l.name},l.name)),z.jsx(lN,{onClick:e,children:"Back to Intro"})]}),z.jsxs(rN,{children:[z.jsx(sN,{ref:t,width:Na,height:Ba}),z.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Effects are triggered at the center of the canvas."})]})]})},uN=Ne.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,dN=Ne.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,fN=Ne.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,hN=Ne.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,pN=Ne.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,_v=Ne.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,qh=Ne.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,gN=Ne(qh)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,mN=Ne.label`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  cursor: pointer;

  input {
    margin-right: 8px;
  }
`,Wn=800,Yn=600,yN=(e,t)=>{const n=e.reduce((s,a)=>(s[a.id]=a,s),{});n[1]={id:1,type:"human",leaderId:1,isPlayer:!0,tribeInfo:{tribeBadge:"",tribeColor:"#4CAF50"},position:{x:0,y:0},radius:10,isAdult:!0,gender:"male",age:25},n[2]={id:2,type:"human",leaderId:2,isPlayer:!1,tribeInfo:{tribeBadge:"",tribeColor:"#F44336"},position:{x:0,y:0},radius:10,isAdult:!0,gender:"male",age:30,tribeControl:{diplomacy:{1:"Hostile"}}};const o={time:0,mapDimensions:{width:Wn,height:Yn},entities:{entities:n},terrainOwnership:t,notifications:[],visualEffects:[],tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[]},plantingZoneConnections:{}};return o.search={building:{all:()=>e,byRadius:(s,a)=>e.filter(l=>K(s,l.position,Wn,Yn)<=a),byRect:()=>e,byProperty:(s,a)=>e.filter(l=>l[s]===a)},human:{all:()=>[n[1],n[2]],byProperty:(s,a)=>Object.values(n).filter(l=>l.type==="human"&&l[s]===a),byRadius:()=>[],byRect:()=>Object.values(n).filter(s=>s.type==="human")},berryBush:{byRect:()=>[],all:()=>[]},tree:{byRect:()=>[],all:()=>[]},corpse:{byRect:()=>[],all:()=>[]},prey:{byRect:()=>[],all:()=>[]},predator:{byRect:()=>[],all:()=>[]},tasks:{byRect:()=>[],all:()=>[]}},o},vN=(e,t,n,o)=>{const s=mt[t];return{id:e,type:"building",buildingType:t,position:n,ownerId:o,constructionProgress:1,destructionProgress:0,isConstructed:!0,isBeingDestroyed:!1,width:s.dimensions.width,height:s.dimensions.height,storedItems:[],storageCapacity:10,radius:Math.max(s.dimensions.width,s.dimensions.height)/2,direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Oe.create()}},SN=()=>{const{returnToIntro:e}=Pi(),t=Q.useRef(null),n=Q.useRef(),[o,s]=Q.useState(X.Palisade),[a,l]=Q.useState(!1),[u,d]=Q.useState([]),[h,p]=Q.useState(null),[m,S]=Q.useState(10),[y,I]=Q.useState(new Array(Math.ceil(Wn/_e)*Math.ceil(Yn/_e)).fill(null)),T=Q.useCallback((_,k)=>{const w=me;return{x:Math.round(_/w)*w,y:Math.round(k/w)*w}},[]),E=Q.useCallback(_=>{const k=t.current;if(!k)return;const w=k.getBoundingClientRect(),M=_.clientX-w.left,R=_.clientY-w.top,H=T(M,R);if(!u.some($=>Math.abs($.position.x-H.x)<5&&Math.abs($.position.y-H.y)<5)){const $=a?2:1,V=vN(m,o,H,$),ee=[...y],ue={mapDimensions:{width:Wn,height:Yn},terrainOwnership:ee},oe=o===X.BorderPost?Pu:Ai;hs(H,oe,$,ue),I(ee),o!==X.BorderPost&&d(re=>[...re,V]),S(re=>re+1)}},[o,a,m,T,u,y]),P=Q.useCallback(_=>{const k=t.current;if(!k)return;const w=k.getBoundingClientRect(),M=_.clientX-w.left,R=_.clientY-w.top;p(T(M,R))},[T]),C=Q.useCallback(()=>{d([]),S(10),I(new Array(Math.ceil(Wn/_e)*Math.ceil(Yn/_e)).fill(null))},[]);return Q.useEffect(()=>{const _=()=>{const k=t.current,w=k==null?void 0:k.getContext("2d");if(!w)return;const M={x:Wn/2,y:Yn/2},R=yN(u,y);w.fillStyle="#2c5234",w.fillRect(0,0,Wn,Yn),jp(w,R,M,{width:Wn,height:Yn},1),mI(w,R,M,1),w.strokeStyle="rgba(255,255,255,0.05)",w.lineWidth=1;for(let H=0;H<=Wn;H+=me)w.beginPath(),w.moveTo(H,0),w.lineTo(H,Yn),w.stroke();for(let H=0;H<=Yn;H+=me)w.beginPath(),w.moveTo(0,H),w.lineTo(Wn,H),w.stroke();for(const H of u)H.buildingType!==X.PlantingZone&&Wp(w,H,R);h&&Yp(w,h,o,!0,{width:Wn,height:Yn}),n.current=requestAnimationFrame(_)};return n.current=requestAnimationFrame(_),()=>{n.current&&cancelAnimationFrame(n.current)}},[u,h,o,y]),z.jsxs(uN,{children:[z.jsxs(dN,{children:[z.jsx(pN,{children:"Building Test"}),z.jsx(_v,{children:"Settings"}),z.jsxs(mN,{children:[z.jsx("input",{type:"checkbox",checked:a,onChange:_=>l(_.target.checked)}),"Show as Hostile"]}),z.jsx(_v,{children:"Building Type"}),Object.values(X).map(_=>z.jsxs(qh,{onClick:()=>s(_),style:{backgroundColor:o===_?"#666":"#444",borderLeft:o===_?"3px solid #4CAF50":"none"},children:[mt[_].icon," ",mt[_].name]},_)),z.jsx(qh,{onClick:C,style:{backgroundColor:"#a33",marginTop:"20px",textAlign:"center"},children:" Clear All"}),z.jsx(gN,{onClick:e,children:"Back to Intro"})]}),z.jsxs(fN,{children:[z.jsx(hN,{ref:t,width:Wn,height:Yn,onClick:E,onMouseMove:P,onMouseLeave:()=>p(null),style:{cursor:"crosshair"}}),z.jsx("p",{style:{marginTop:"20px",color:"#888"},children:"Click to place buildings. Test palisade connectivity by placing them adjacent to each other."})]})]})},TN=Ne.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,IN=Ne.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,AN=Ne.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,EN=Ne.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,wN=Ne.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,Ha=Ne.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,Tn=Ne.button`
  background-color: ${e=>e.active?"#666":"#444"};
  color: white;
  border: ${e=>e.active?"2px solid #4CAF50":"none"};
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: center;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
`,Rv=Ne.div`
  display: flex;
  flex-direction: column;
  margin-bottom: 15px;

  label {
    font-size: 0.8rem;
    color: #aaa;
    margin-bottom: 5px;
  }
`,CN=Ne(Tn)`
  background-color: #833;
  margin-top: auto;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,wo=Ne.p`
  font-size: 0.9rem;
  color: #888;
  margin: 5px 0;
`,bn=800,Dn=600,PN=()=>{const e=Math.ceil(bn/_e)*Math.ceil(Dn/_e);return{time:0,mapDimensions:{width:bn,height:Dn},entities:{entities:{},nextEntityId:2},navigationGrid:Yu(bn,Dn),soilDepletion:up(),temperature:{sectors:{}},pathfindingQueue:[],notifications:[],visualEffects:[],nextVisualEffectId:1,tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[],currentStepIndex:0,completedSteps:[],transitionAlpha:0,transitionState:tn.INACTIVE,stepStartTime:null},plantingZoneConnections:{},terrainOwnership:new Array(e).fill(null),performanceMetrics:{currentBucket:{renderTime:0,worldUpdateTime:0,aiUpdateTime:0},history:[]},autopilotControls:{behaviors:{procreation:!1,planting:!1,gathering:!1,attack:!1,feedChildren:!1,build:!1,chopping:!1},isManuallyMoving:!1},ecosystem:{lastUpdateTime:0,preyGestationPeriod:24,preyProcreationCooldown:48,predatorGestationPeriod:36,predatorProcreationCooldown:72,preyHungerIncreasePerHour:.1,predatorHungerIncreasePerHour:.1,berryBushSpreadChance:.01,treeSpreadChance:.005},tasks:{},scheduledEvents:[],nextScheduledEventId:1,generationCount:1,gameOver:!1,viewportCenter:{x:bn/2,y:Dn/2},isPaused:!1,exitConfirmation:"inactive",buildMenuOpen:!1,tribeModalOpen:!1,cameraFollowingPlayer:!1,cameraZoom:1,masterVolume:1,isMuted:!1,uiButtons:[],tutorial:{steps:[]},lastAutosaveTime:Date.now(),autosaveIntervalSeconds:0,debugPanel:qe.None,debugPanelScroll:{x:0,y:0},isDraggingDebugPanel:!1,hasPlayerMovedEver:!1,hasPlayerPlantedBush:!1,hasPlayerEnabledAutopilot:0,isDraggingMinimap:!1,minimapDragDistance:0,isDraggingViewport:!1,viewportDragButton:null,viewportDragDistance:0,selectedBuildingType:null,selectedBuildingForRemoval:null}},_N=()=>{var pe;const{returnToIntro:e}=Pi(),t=Q.useRef(null),[n]=Q.useState(PN()),[o,s]=Q.useState(null),[a,l]=Q.useState(null),[u,d]=Q.useState(null),[h,p]=Q.useState(0),[m,S]=Q.useState("tree"),[y,I]=Q.useState(null),[T,E]=Q.useState(1),[P,C]=Q.useState(1),[_,k]=Q.useState([]),[w,M]=Q.useState(null),[R,H]=Q.useState(null),[j,$]=Q.useState(!1),[V,ee]=Q.useState(1),[ue,oe]=Q.useState(As),re=Q.useRef(0),fe=Q.useCallback((ne,se)=>({x:Math.round(ne/me)*me,y:Math.round(se/me)*me}),[]);Q.useEffect(()=>{n.navigationGrid=Yu(bn,Dn),n.entities.entities={},n.entities.nextEntityId=100;for(const ne of _){let se;if(ne.type==="tree")se=wr;else{const ce=mt[ne.type].dimensions;se=Math.max(ce.width,ce.height)/2}const ge=ne.type===X.Gate?ne.ownerId??null:null;if((ne.type===X.Palisade||ne.type===X.Gate||ne.type==="tree")&&ws(n,ne.pos,se,!0,ge,ue),ne.type==="tree")_s(n.entities,ne.pos,n.time,100);else{const ce=YT(n.entities,ne.pos,ne.type,ne.ownerId||0);ce.isConstructed=!0}}if(o&&a){const ne={leaderId:P},{path:se,iterations:ge}=hT(n,o,a,ne);d(se),p(ge)}},[_,ue,o,a,P,n]);const ie=Q.useCallback(ne=>{const se=t.current;if(!se)return;const ge=se.getBoundingClientRect(),L=ne.clientX-ge.left,ce=ne.clientY-ge.top,ye=fe(L,ce);if(m==="start")s(ye);else if(m==="end")l(ye);else if(m==="palisadeLine")if(!w)M(ye);else{const Ae=K(w,ye,bn,Dn),Z=xe(w,ye,bn,Dn),$e=yt(Z),Le=Math.ceil(Ae/20),He=[];for(let it=0;it<=Le;it++){const St=Xn(w,ct($e,it*20)),Et=fe(St.x,St.y);!_.some(ot=>ot.pos.x===Et.x&&ot.pos.y===Et.y)&&!He.some(ot=>ot.pos.x===Et.x&&ot.pos.y===Et.y)&&He.push({pos:Et,type:X.Palisade,ownerId:null})}k(it=>[...it,...He]),M(null)}else{const Ae=_.findIndex(Z=>Z.pos.x===ye.x&&Z.pos.y===ye.y);if(Ae!==-1){const Z=_[Ae];m!==Z.type&&(m==="tree"||Object.values(X).includes(m))?k($e=>{const Le=[...$e];return Le[Ae]={pos:ye,type:m,ownerId:m===X.Gate?T:null},Le}):k($e=>$e.filter((Le,He)=>He!==Ae))}else k(Z=>[...Z,{pos:ye,type:m,ownerId:m===X.Gate?T:null}])}},[m,fe,T,_,w]),W=()=>{if(o&&a){R&&Ci(n.entities,R.id);const ne=cr(n.entities,o,n.time,"male",!1,25,0,void 0,void 0,[],P,{tribeBadge:"",tribeColor:"#4A90E2"});ne.target=a,ne.activeAction="moving",ne.stateMachine=[Si,{enteredAt:n.time}],n.pathfindingQueue.includes(ne.id)||n.pathfindingQueue.push(ne.id),H(ne),$(!0)}},te=()=>{R&&Ci(n.entities,R.id),H(null),$(!1)},[x,D]=lp(ne=>{if(re.current===0){re.current=ne;return}const se=(ne-re.current)/1e3;if(re.current=ne,!j||!R)return;n.entities.entities[R.id]||(n.entities.entities[R.id]=R);let ge=se*V;const L=1/60;let ce=n;for(;ge>0;){const Ae=pl(ce),Z=Math.min(ge,L),$e=Z*(Ot/Ut);Ae.time+=$e,$T({gameState:Ae,deltaTime:Z}),VT({gameState:Ae,deltaTime:Z}),aI(Ae),Lp(Ae),ce=Ae,ge-=Z}ce!==n&&Object.assign(n,ce);const ye=n.entities.entities[R.id];ye&&H({...ye})});Q.useEffect(()=>(D(),()=>x()),[D,x]);const G=Q.useCallback(ne=>{const se=t.current;if(!se)return;const ge=se.getBoundingClientRect(),L=ne.clientX-ge.left,ce=ne.clientY-ge.top;I(fe(L,ce))},[fe]),J=Q.useCallback(()=>{s(null),l(null),d(null),p(0),R&&Ci(n.entities,R.id),H(null),$(!1),k([]),M(null),n.pathfindingQueue=[]},[n,R]);return Q.useEffect(()=>{const se=requestAnimationFrame(()=>{const ge=t.current,L=ge==null?void 0:ge.getContext("2d");if(!L)return;L.fillStyle="#2c5234",L.fillRect(0,0,bn,Dn),L.strokeStyle="rgba(255,255,255,0.05)",L.lineWidth=1;for(let Z=0;Z<=bn;Z+=me)L.beginPath(),L.moveTo(Z,0),L.lineTo(Z,Dn),L.stroke();for(let Z=0;Z<=Dn;Z+=me)L.beginPath(),L.moveTo(0,Z),L.lineTo(bn,Z),L.stroke();const ce=Math.ceil(bn/me),ye=Math.ceil(Dn/me);for(let Z=0;Z<ye;Z++)for(let $e=0;$e<ce;$e++){const Le=Z*ce+$e,He=!Es(n.navigationGrid,Le,P,!1),it=n.navigationGrid.paddingCount[Le];if(He)L.fillStyle="rgba(244, 67, 54, 0.5)",L.fillRect($e*me,Z*me,me,me);else if(it>0){const St=Math.min(.6,.15+it/fT*.45);L.fillStyle=`rgba(255, 235, 59, ${St})`,L.fillRect($e*me,Z*me,me,me)}else n.navigationGrid.obstacleCount[Le]>0&&(L.fillStyle="rgba(76, 175, 80, 0.3)",L.fillRect($e*me,Z*me,me,me))}L.font="16px Arial",L.textAlign="center",L.textBaseline="middle";for(const Z of _){let $e="";Z.type==="tree"?$e="":$e=mt[Z.type].icon,$e&&L.fillText($e,Z.pos.x,Z.pos.y)}const Ae=(R==null?void 0:R.path)||u;if(Ae&&Ae.length>1){L.strokeStyle=R?"rgba(0, 255, 0, 0.3)":"#00FF00",L.setLineDash(R?[5,5]:[]),L.lineWidth=2,L.beginPath(),L.moveTo(Ae[0].x,Ae[0].y);for(let Z=1;Z<Ae.length;Z++)L.lineTo(Ae[Z].x,Ae[Z].y);L.stroke(),L.setLineDash([]),L.fillStyle="#00FF00";for(const Z of Ae)L.beginPath(),L.arc(Z.x,Z.y,2,0,Math.PI*2),L.fill()}if(o&&(L.fillStyle="#00FF00",L.beginPath(),L.arc(o.x,o.y,8,0,Math.PI*2),L.fill(),L.fillStyle="white",L.font="10px Arial",L.fillText("START",o.x,o.y-12)),a&&(L.fillStyle="#FF0000",L.beginPath(),L.arc(a.x,a.y,8,0,Math.PI*2),L.fill(),L.fillStyle="white",L.font="10px Arial",L.fillText("END",a.x,a.y-12)),R){const{position:Z,direction:$e,path:Le}=R;L.strokeStyle="rgba(255, 255, 255, 0.2)",L.lineWidth=1,L.beginPath(),L.arc(Z.x,Z.y,ut,0,Math.PI*2),L.stroke(),L.fillStyle="#4A90E2",L.beginPath(),L.arc(Z.x,Z.y,ut/3,0,Math.PI*2),L.fill(),L.strokeStyle="white",L.stroke(),L.strokeStyle="white",L.lineWidth=2,L.beginPath(),L.moveTo(Z.x,Z.y),L.lineTo(Z.x+$e.x*20,Z.y+$e.y*20),L.stroke();const He=Le&&Le.length>0?Le[0]:null;if(He){L.strokeStyle="#FFEB3B",L.setLineDash([2,2]),L.beginPath(),L.moveTo(Z.x,Z.y),L.lineTo(He.x,He.y),L.stroke(),L.setLineDash([]),L.fillStyle="#FFEB3B",L.beginPath(),L.arc(He.x,He.y,4,0,Math.PI*2),L.fill();const ot=xe(Z,He,bn,Dn),qt=Math.sqrt(ot.x*ot.x+ot.y*ot.y);if(qt>.001){const En=ot.x/qt,Bs=-(ot.y/qt),Hs=En,Fs=ut*.5;L.strokeStyle="rgba(255, 255, 255, 0.2)",L.lineWidth=1,[Fs,-15,Fs*.5,-7.5].forEach($o=>{L.beginPath(),L.moveTo(Z.x+Bs*$o,Z.y+Hs*$o),L.lineTo(He.x+Bs*$o,He.y+Hs*$o),L.stroke()})}}const it=yt($e),St=ru(it,-za),Et=ru(it,za);[it,St,Et].forEach((ot,qt)=>{const En=Xn(Z,ct(ot,Fh));L.strokeStyle=qt===0?"rgba(255,255,255,0.5)":"rgba(255,255,255,0.2)",L.beginPath(),L.moveTo(Z.x,Z.y),L.lineTo(En.x,En.y),L.stroke()})}if(w&&y&&(L.strokeStyle="rgba(255, 255, 255, 0.5)",L.setLineDash([5,5]),L.beginPath(),L.moveTo(w.x,w.y),L.lineTo(y.x,y.y),L.stroke(),L.setLineDash([])),y){let Z="";m==="tree"?Z="":m==="start"?Z="":m==="end"?Z="":m==="palisadeLine"?Z=mt[X.Palisade].icon:Object.values(X).includes(m)&&(Z=mt[m].icon),Z&&(L.globalAlpha=.5,L.fillText(Z,y.x,y.y),L.globalAlpha=1)}});return()=>cancelAnimationFrame(se)},[n,o,a,u,y,m,R,_,P,w]),z.jsxs(TN,{children:[z.jsxs(IN,{children:[z.jsx(wN,{children:"Navigation Debug"}),z.jsx(Ha,{children:"Placement Mode"}),z.jsx(Tn,{active:m==="start",onClick:()=>{S("start"),M(null)},children:" Start Point"}),z.jsx(Tn,{active:m==="end",onClick:()=>{S("end"),M(null)},children:" End Point"}),z.jsxs(Tn,{active:m==="tree",onClick:()=>{S("tree"),M(null)},children:[" Tree (Radius ",wr,")"]}),Object.entries(mt).map(([ne,se])=>z.jsxs(Tn,{active:m===ne,onClick:()=>{S(ne),M(null)},children:[se.icon," ",se.name," (",se.dimensions.width,"x",se.dimensions.height,")"]},ne)),z.jsx(Tn,{active:m==="palisadeLine",onClick:()=>{S("palisadeLine"),M(null)},children:" Palisade Line"}),z.jsx(Ha,{children:"Gate Ownership"}),z.jsx(Tn,{active:T===1,onClick:()=>E(1),children:" Player (ID: 1)"}),z.jsx(Tn,{active:T===2,onClick:()=>E(2),children:" Enemy (ID: 2)"}),z.jsx(Ha,{children:"Human Tribe"}),z.jsx(Tn,{active:P===1,onClick:()=>C(1),children:" Player (ID: 1)"}),z.jsx(Tn,{active:P===2,onClick:()=>C(2),children:" Enemy (ID: 2)"}),z.jsx(Ha,{children:"Simulation"}),z.jsx(Tn,{onClick:W,disabled:!o||!a,children:" Spawn Human"}),z.jsx(Tn,{onClick:()=>$(!j),active:j,children:j?" Pause":" Play"}),z.jsx(Tn,{onClick:te,style:{backgroundColor:"#555"},children:" Reset Human"}),z.jsxs(Rv,{children:[z.jsxs("label",{children:["Sim Speed: ",V.toFixed(1),"x"]}),z.jsx("input",{type:"range",min:"0.1",max:"5",step:"0.1",value:V,onChange:ne=>ee(parseFloat(ne.target.value))})]}),z.jsxs(Rv,{children:[z.jsxs("label",{children:["Obstacle Padding: ",ue,"px"]}),z.jsx("input",{type:"range",min:"0",max:"50",step:"1",value:ue,onChange:ne=>oe(parseInt(ne.target.value))})]}),z.jsx(Ha,{children:"Info"}),z.jsxs(wo,{children:["Grid: ",me,"px"]}),z.jsxs(wo,{children:["Path Nodes: ",((pe=R==null?void 0:R.path)==null?void 0:pe.length)||(u==null?void 0:u.length)||0]}),z.jsxs(wo,{children:["A* Iterations: ",h]}),z.jsxs(wo,{children:["Action: ",(R==null?void 0:R.activeAction)||"idle"]}),z.jsxs(wo,{children:["Accel: ",(R==null?void 0:R.acceleration.toFixed(2))||"0.00"]}),z.jsxs(wo,{children:["Status:"," ",(R==null?void 0:R.activeAction)==="moving"&&R.acceleration===0?" STUCK":(R==null?void 0:R.activeAction)==="idle"||(R==null?void 0:R.stateMachine[0])===ht?" REACHED":R?" Moving":" Idle"]}),z.jsx(wo,{style:{fontSize:"0.75rem",color:"#666",marginTop:"10px"},children:"Note: Click any tool on an existing object to replace or remove it. Use Palisade Line for multi-segment walls."}),z.jsx(Tn,{onClick:J,style:{backgroundColor:"#a33",marginTop:"20px"},children:" Clear All"}),z.jsx(CN,{onClick:e,children:"Back to Intro"})]}),z.jsxs(AN,{children:[z.jsx(EN,{ref:t,width:bn,height:Dn,onClick:ie,onMouseMove:G,onMouseLeave:()=>I(null),style:{cursor:"crosshair"}}),z.jsx(wo,{style:{marginTop:"10px",textAlign:"center"},children:"Place Trees and Buildings to test pathfinding. Only Palisades and Gates physically block movement. Adjust padding to see how it affects real game navigation logic."})]})]})},RN=Ne.div`
  display: flex;
  width: 100vw;
  height: 100vh;
  background-color: #1a1a1a;
  color: white;
  font-family: 'Arial', sans-serif;
`,kN=Ne.div`
  width: 300px;
  height: 100%;
  background-color: #222;
  border-right: 1px solid #444;
  display: flex;
  flex-direction: column;
  padding: 20px;
  overflow-y: auto;
`,MN=Ne.div`
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 20px;
`,bN=Ne.canvas`
  background-color: #2c5234;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
  border: 2px solid #444;
`,DN=Ne.h1`
  font-size: 1.5rem;
  margin-bottom: 20px;
  text-align: center;
`,ts=Ne.h2`
  font-size: 1rem;
  margin: 15px 0 10px;
  color: #aaa;
`,Li=Ne.button`
  background-color: #444;
  color: white;
  border: none;
  padding: 10px;
  margin-bottom: 10px;
  cursor: pointer;
  border-radius: 4px;
  text-align: left;
  transition: background-color 0.2s;

  &:hover {
    background-color: #666;
  }

  &:active {
    background-color: #888;
  }
`,ON=Ne(Li)`
  background-color: #833;
  margin-top: auto;
  text-align: center;
  font-weight: bold;

  &:hover {
    background-color: #a44;
  }
`,Eh=Ne.label`
  display: flex;
  align-items: center;
  margin-bottom: 10px;
  cursor: pointer;

  input {
    margin-right: 8px;
  }
`,Co=Ne.p`
  font-size: 0.85rem;
  color: #888;
  margin: 5px 0;
`,NN=Ne.span`
  display: inline-block;
  padding: 2px 8px;
  border-radius: 4px;
  font-weight: bold;
  font-size: 0.75rem;
  background-color: ${e=>{switch(e.$rating){case"Excellent":return"#2a5";case"Good":return"#28a";case"Fair":return"#a82";case"Poor":return"#a33"}}};
`,Ct=800,Pt=600,BN=JT,HN=800,FN=500,xN=300,LN=.7,UN=.5,GN=.3,$N=.05,WN=.15,YN=.02,jN=.25,zN=80,XN=60,VN=40,wh=(e,t)=>{const n=e.reduce((s,a)=>(s[a.id]=a,s),{});n[1]={id:1,type:"human",leaderId:1,isPlayer:!0,tribeInfo:{tribeBadge:"",tribeColor:"#4CAF50"},position:{x:Ct/2,y:Pt/2},radius:10,isAdult:!0,gender:"male",age:25,stateMachine:["",{enteredAt:0}],aiBlackboard:Oe.create(),debuffs:[],forces:[],velocity:{x:0,y:0},acceleration:0,direction:{x:0,y:0}};const o={time:0,mapDimensions:{width:Ct,height:Pt},entities:{entities:n},terrainOwnership:t,notifications:[],visualEffects:[],tutorialState:{isActive:!1,highlightedEntityIds:[],activeUIHighlights:[]},plantingZoneConnections:{},navigationGrid:{obstacleCount:new Uint16Array(0),paddingCount:new Uint16Array(0),gateRefCount:{},gatePaddingRefCount:{}},tasks:{},soilDepletion:{}};return o.search={building:{all:()=>e,byRadius:(s,a)=>e.filter(l=>K(s,l.position,Ct,Pt)<=a),byRect:()=>e,byProperty:(s,a)=>e.filter(l=>l[s]===a),at:(s,a)=>e.find(l=>K(s,l.position,Ct,Pt)<=a)},human:{all:()=>[n[1]],byProperty:()=>[],byRadius:()=>[],byRect:()=>[n[1]]},berryBush:{byRect:()=>[],all:()=>[],byRadius:()=>[]},tree:{byRect:()=>[],all:()=>[],byRadius:()=>[]},corpse:{byRect:()=>[],all:()=>[]},prey:{byRect:()=>[],all:()=>[]},predator:{byRect:()=>[],all:()=>[]},tasks:{byRect:()=>[],all:()=>[]}},o.cache={tribeCenters:{}},o};function qN(e,t,n,o){if(e.length===0)return[];const s=Ct,a=Pt,l=Math.ceil(s/me),u=Math.ceil(a/me),d=t.filter(m=>m.buildingType===X.Palisade||m.buildingType===X.Gate),h=nI(e,eI,s,a),p=[];for(const m of h){if(m.length===0)continue;const S={x:m.reduce((T,E)=>T+E.position.x,0)/m.length,y:m.reduce((T,E)=>T+E.position.y,0)/m.length},y=iI(m,s,a,n),I=oI(y,l,u);if(I.length!==0)for(const T of I){const P=rI(T,S,s,a).filter(C=>Nn(C.position.x,C.position.y,{terrainOwnership:o,mapDimensions:{width:s,height:a}})!==1?!1:!d.some(w=>Rt(C.position,w.position,s,a)<wu*wu));p.push(...P)}}return p}function ZN(e,t,n){var _,k;const o=e.filter(w=>!w.isGate).length,s=e.filter(w=>w.isGate).length,a=e.length;let l=0;for(let w=0;w<e.length;w++){const M=e[w].position,R=e[(w+1)%e.length].position;l+=K(M,R,Ct,Pt)}let u=0;for(let w=0;w<e.length;w++){const M=e[w].position,R=e[(w+1)%e.length].position;u+=M.x*R.y-R.x*M.y}u=Math.abs(u)/2;let d=0;for(const w of e){let M=1/0;for(const R of t){const H=K(w.position,R.position,Ct,Pt);H<M&&(M=H)}d+=M}const h=e.length>0?Math.round(d/e.length):0,p=n>0?h/n:0,m=o>0?u/o:0,S=l>0?4*Math.PI*u/(l*l):0,y=a>0?s/a:0,I=(_=mt[X.Palisade].cost)==null?void 0:_.wood,T=(k=mt[X.Gate].cost)==null?void 0:k.wood,E=o*I+s*T;let P=0;m>HN?P+=30:m>FN?P+=20:m>xN&&(P+=10),S>LN?P+=30:S>UN?P+=20:S>GN&&(P+=10),y>=$N&&y<=WN?P+=25:y>YN&&y<jN&&(P+=15),p>=.8&&p<=1.2&&(P+=20);let C;return P>=zN?C="Excellent":P>=XN?C="Good":P>=VN?C="Fair":C="Poor",{perimeterLength:Math.round(l),palisadeCount:o,gateCount:s,hubCount:t.length,enclosedArea:Math.round(u),defenseEfficiency:Math.round(m),compactness:Math.round(S*100)/100,accessibilityScore:Math.round(y*1e3)/1e3,woodCost:E,qualityRating:C,protectionScore:Math.round(p*100)/100,averageProtectionDistance:h}}const Ch=(e,t,n,o)=>{const s=mt[t];return{id:e,type:"building",buildingType:t,position:n,ownerId:o,constructionProgress:1,destructionProgress:0,isConstructed:!0,isBeingDestroyed:!1,width:s.dimensions.width,height:s.dimensions.height,storedItems:[],storageCapacity:10,radius:Math.max(s.dimensions.width,s.dimensions.height)/2,direction:{x:0,y:0},acceleration:0,forces:[],velocity:{x:0,y:0},debuffs:[],stateMachine:["",{enteredAt:0}],aiBlackboard:Oe.create()}},KN=()=>{const{returnToIntro:e}=Pi(),t=Q.useRef(null),n=Q.useRef(),[o,s]=Q.useState(X.Bonfire),[a,l]=Q.useState([]),[u,d]=Q.useState(null),[h,p]=Q.useState(10),[m,S]=Q.useState(!0),[y,I]=Q.useState(!1),[T]=Q.useState(!0),[E,P]=Q.useState(!0),[C,_]=Q.useState(BN),[k]=Q.useState(lD),[w,M]=Q.useState([]),[R,H]=Q.useState(new Array(Math.ceil(Ct/_e)*Math.ceil(Pt/_e)).fill(null)),j=Q.useMemo(()=>a.filter(W=>W.buildingType===X.Bonfire||W.buildingType===X.StorageSpot),[a]),$=Q.useMemo(()=>w.length===0?null:ZN(w,j,C),[w,j,C]),V=Q.useCallback((W,te)=>{const x=me;return{x:Math.round(W/x)*x,y:Math.round(te/x)*x}},[]),ee=Q.useCallback(W=>{const te=t.current;if(!te)return;const x=te.getBoundingClientRect(),D=W.clientX-x.left,G=W.clientY-x.top,J=V(D,G),pe=wh(a,R);if(!Ir(J,o,1,pe))return;const ne=Ch(h,o,J,1),se=[...R],ge={mapDimensions:{width:Ct,height:Pt},terrainOwnership:se},L=o===X.BorderPost?Pu:Ai;hs(J,L,1,ge),H(se),o!==X.BorderPost&&l(ce=>[...ce,ne]),p(ce=>ce+1)},[o,h,V,a,R]),ue=Q.useCallback(W=>{const te=t.current;if(!te)return;const x=te.getBoundingClientRect(),D=W.clientX-x.left,G=W.clientY-x.top;d(V(D,G))},[V]),oe=Q.useCallback(()=>{l([]),M([]),p(10),H(new Array(R.length).fill(null))},[R.length]),re=Q.useCallback(()=>{if(j.length===0){M([]);return}const W=qN(j,a,C,R);M(W)},[j,a,C,k,R]),fe=Q.useCallback(()=>{if(w.length===0)return;const W=[];let te=h;const x=[...R],D={mapDimensions:{width:Ct,height:Pt},terrainOwnership:x};for(const G of w){const J=G.isGate?X.Gate:X.Palisade,pe=Ch(te++,J,G.position,1);W.push(pe),hs(G.position,Ai,1,D)}H(x),l(G=>[...G,...W]),p(te),M([])},[w,h,R]),ie=Q.useCallback(()=>{const W=wh(a,R),te={x:Ct/2,y:Pt/2},x=tu(o,1,W,200,100,te);if(x){const D=Ch(h,o,x,1),G=[...R];hs(x,Ai,1,{mapDimensions:{width:Ct,height:Pt},terrainOwnership:G}),H(G),l(pe=>[...pe,D]),p(pe=>pe+1)}},[a,R,o,h]);return Q.useEffect(()=>{const W=()=>{const te=t.current,x=te==null?void 0:te.getContext("2d");if(!x)return;const D={x:Ct/2,y:Pt/2},G=wh(a,R);if(x.fillStyle="#2c5234",x.fillRect(0,0,Ct,Pt),m&&jp(x,G,D,{width:Ct,height:Pt},1),y){x.strokeStyle="rgba(255,255,255,0.05)",x.lineWidth=1;for(let J=0;J<=Ct;J+=me)x.beginPath(),x.moveTo(J,0),x.lineTo(J,Pt),x.stroke();for(let J=0;J<=Pt;J+=me)x.beginPath(),x.moveTo(0,J),x.lineTo(Ct,J),x.stroke()}for(const J of a)Wp(x,J,G);if(E&&w.length>0){x.save();for(let J=0;J<w.length;J++){const pe=w[J],{x:ne,y:se}=pe.position,ge=me;pe.isGate?(x.fillStyle="rgba(100, 150, 255, 0.7)",x.strokeStyle="#4080FF"):(x.fillStyle="rgba(180, 120, 60, 0.7)",x.strokeStyle="#8B4513"),x.fillRect(ne-ge/2,se-ge/2,ge,ge),x.lineWidth=2,x.strokeRect(ne-ge/2,se-ge/2,ge,ge),(J<5||J===w.length-1)&&(x.fillStyle="#FFFFFF",x.font="8px Arial",x.textAlign="center",x.textBaseline="middle",x.fillText(String(J+1),ne,se))}if(w.length>1){x.strokeStyle="rgba(255, 255, 0, 0.5)",x.lineWidth=1,x.beginPath(),x.moveTo(w[0].position.x,w[0].position.y);for(let J=1;J<w.length;J++){const pe=w[J-1].position,ne=w[J].position;Rt(pe,ne,Ct,Pt)<1e4?x.lineTo(ne.x,ne.y):x.moveTo(ne.x,ne.y)}x.stroke()}x.restore()}if(u){const J=Ir(u,o,1,G);Yp(x,u,o,T?J:!0,{width:Ct,height:Pt}),T&&(x.save(),x.font="12px Arial",x.fillStyle=J?"#00FF00":"#FF0000",x.fillText(J?" Valid placement":" Invalid placement",u.x+15,u.y-15),x.restore())}n.current=requestAnimationFrame(W)};return n.current=requestAnimationFrame(W),()=>{n.current&&cancelAnimationFrame(n.current)}},[a,u,o,R,m,y,T,E,w]),z.jsxs(RN,{children:[z.jsxs(kN,{children:[z.jsx(DN,{children:"Gord Builder Test"}),z.jsx(ts,{children:"1. Place Hub Buildings"}),z.jsxs(Li,{onClick:()=>s(X.Bonfire),style:{backgroundColor:o===X.Bonfire?"#666":"#444",borderLeft:o===X.Bonfire?"3px solid #FF6600":"none"},children:[mt[X.Bonfire].icon," Bonfire (Hub)"]}),z.jsxs(Li,{onClick:()=>s(X.StorageSpot),style:{backgroundColor:o===X.StorageSpot?"#666":"#444",borderLeft:o===X.StorageSpot?"3px solid #FF6600":"none"},children:[mt[X.StorageSpot].icon," Storage (Hub)"]}),z.jsx(ts,{children:"2. Manual Placement"}),z.jsxs(Li,{onClick:()=>s(X.Palisade),style:{backgroundColor:o===X.Palisade?"#666":"#444",borderLeft:o===X.Palisade?"3px solid #4CAF50":"none"},children:[mt[X.Palisade].icon," Palisade"]}),z.jsxs(Li,{onClick:()=>s(X.Gate),style:{backgroundColor:o===X.Gate?"#666":"#444",borderLeft:o===X.Gate?"3px solid #4CAF50":"none"},children:[mt[X.Gate].icon," Gate"]}),z.jsx(ts,{children:"3. AI Gord Planning"}),z.jsxs(Co,{children:["Safe Radius: ",C,"px"]}),z.jsx("input",{type:"range",min:"40",max:"120",value:C,onChange:W=>_(Number(W.target.value)),style:{width:"100%",marginBottom:"10px"}}),z.jsxs(Co,{children:["Min Gate Dist: ",tI,"px"]}),z.jsxs(Li,{onClick:re,style:{backgroundColor:j.length>0?"#2a5":"#555",textAlign:"center"},disabled:j.length===0,children:[" Plan Gord (",j.length," hubs)"]}),z.jsxs(Li,{onClick:fe,style:{backgroundColor:w.length>0?"#25a":"#555",textAlign:"center"},disabled:w.length===0,children:[" Execute Plan (",w.length,")"]}),z.jsx(ts,{children:"Gord Statistics"}),$?z.jsxs(z.Fragment,{children:[z.jsxs(Co,{children:[" Quality: ",z.jsx(NN,{$rating:$.qualityRating,children:$.qualityRating})]}),z.jsxs(Co,{children:[" Hubs: ",$.hubCount," |  Palis: ",$.palisadeCount," |  Gates: ",$.gateCount]}),z.jsxs(Co,{children:[" Perimeter: ",$.perimeterLength,"px |  Area: ~",$.enclosedArea,"px"]}),z.jsxs(Co,{children:[" Efficiency: ",$.defenseEfficiency," |  Compact: ",$.compactness]}),z.jsxs(Co,{children:[" Protection: ",($.protectionScore*100).toFixed(1),"% |  Cost: ",$.woodCost]})]}):z.jsx(Co,{children:"No gord planned. Place hubs first."}),z.jsx(ts,{children:"Visualization"}),z.jsxs(Eh,{children:[z.jsx("input",{type:"checkbox",checked:E,onChange:W=>P(W.target.checked)})," ","Show Planned Gord"]}),z.jsxs(Eh,{children:[z.jsx("input",{type:"checkbox",checked:m,onChange:W=>S(W.target.checked)})," ","Show Territory"]}),z.jsxs(Eh,{children:[z.jsx("input",{type:"checkbox",checked:y,onChange:W=>I(W.target.checked)})," Show Nav Grid"]}),z.jsx(ts,{children:"Actions"}),z.jsx(Li,{onClick:ie,style:{backgroundColor:"#357",textAlign:"center"},children:" Auto-Place Single"}),z.jsx(Li,{onClick:oe,style:{backgroundColor:"#a33",textAlign:"center"},children:" Clear All"}),z.jsx(ON,{onClick:e,children:"Back to Intro"})]}),z.jsxs(MN,{children:[z.jsx(bN,{ref:t,width:Ct,height:Pt,onClick:ee,onMouseMove:ue,onMouseLeave:()=>d(null)}),z.jsxs("p",{style:{marginTop:"20px",color:"#888",maxWidth:"600px",textAlign:"center"},children:[z.jsx("strong",{children:"How to test:"})," Place hubs (Bonfire/Storage) -> Plan Gord -> Execute Plan.",z.jsx("br",{}),"Multiple hub clusters will create separate gords. Holes are filtered out."]})]})]})},QN=zE`
  /* CSS Reset */
  *, *::before, *::after {
    box-sizing: border-box;
  }

  body {
    margin: 0;
    padding: 0;
    font-family: 'Press Start 2P', 'Arial', sans-serif;
    background-color: #121212;
    color: #f0f0f0;
    line-height: 1.6;
  }

  /* Additional global styles */
  h1, h2, h3, h4, h5, h6 {
    margin-top: 0;
  }

  button {
    cursor: pointer;
    font-family: inherit;
  }

  /* Prevent overflow issues */
  html, body {
    height: 100%;
    overflow-x: hidden;
  }

  /* Root element for React app */
  #root {
    height: 100%;
  }
`;function JN(e,t){Q.useEffect(()=>{const n=()=>{const o=document.location.hash;t(o==="#game"?"game":o==="#effects"?"effects":o==="#buildings"?"buildings":o==="#navigation"?"navigation":o==="#palisadePlacement"?"palisadePlacement":"intro")};return window.addEventListener("hashchange",n),n(),()=>{window.removeEventListener("hashchange",n)}},[]),Q.useEffect(()=>{e==="game"?document.location.hash="#game":e==="effects"?document.location.hash="#effects":e==="intro"&&(document.location.hash="")},[e])}const eB=()=>{const{appState:e,setAppState:t}=Pi();JN(e,t);const n=()=>{switch(e){case"intro":return z.jsx(wv,{});case"game":return z.jsx(Pv,{});case"effects":return z.jsx(cN,{});case"buildings":return z.jsx(SN,{});case"navigation":return z.jsx(_N,{});case"palisadePlacement":return z.jsx(KN,{});case"gameOver":return z.jsxs(z.Fragment,{children:[z.jsx(Pv,{}),z.jsx(nN,{})]});default:return z.jsx(wv,{})}};return z.jsxs(z.Fragment,{children:[z.jsx(QN,{}),n()]})},kv=document.getElementById("root");kv?o_().then(()=>{_1.createRoot(kv).render(z.jsx(Ii.StrictMode,{children:z.jsx(j1,{initialAppState:document.location.hash==="#game"?"game":document.location.hash==="#effects"?"effects":document.location.hash==="#navigation"?"navigation":document.location.hash==="#palisadePlacement"?"palisadePlacement":document.location.hash==="#buildings"?"buildings":"intro",children:z.jsx(eB,{})})}))}):console.error("Failed to find the root element");
