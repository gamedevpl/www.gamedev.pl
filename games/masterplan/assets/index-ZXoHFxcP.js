var qD=Object.defineProperty;var YD=(t,e,n)=>e in t?qD(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var se=(t,e,n)=>YD(t,typeof e!="symbol"?e+"":e,n);function QD(t,e){for(var n=0;n<e.length;n++){const s=e[n];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in t)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(t,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=n(r);fetch(r.href,o)}})();var Gi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sS(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function JD(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var n=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach(function(s){var r=Object.getOwnPropertyDescriptor(t,s);Object.defineProperty(n,s,r.get?r:{enumerable:!0,get:function(){return t[s]}})}),n}var rS={exports:{}},Hf={},oS={exports:{}},_e={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var iu=Symbol.for("react.element"),ZD=Symbol.for("react.portal"),e_=Symbol.for("react.fragment"),t_=Symbol.for("react.strict_mode"),n_=Symbol.for("react.profiler"),s_=Symbol.for("react.provider"),r_=Symbol.for("react.context"),o_=Symbol.for("react.forward_ref"),i_=Symbol.for("react.suspense"),a_=Symbol.for("react.memo"),l_=Symbol.for("react.lazy"),Av=Symbol.iterator;function c_(t){return t===null||typeof t!="object"?null:(t=Av&&t[Av]||t["@@iterator"],typeof t=="function"?t:null)}var iS={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},aS=Object.assign,lS={};function xl(t,e,n){this.props=t,this.context=e,this.refs=lS,this.updater=n||iS}xl.prototype.isReactComponent={};xl.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};xl.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function cS(){}cS.prototype=xl.prototype;function F1(t,e,n){this.props=t,this.context=e,this.refs=lS,this.updater=n||iS}var O1=F1.prototype=new cS;O1.constructor=F1;aS(O1,xl.prototype);O1.isPureReactComponent=!0;var Dv=Array.isArray,uS=Object.prototype.hasOwnProperty,z1={current:null},dS={key:!0,ref:!0,__self:!0,__source:!0};function hS(t,e,n){var s,r={},o=null,i=null;if(e!=null)for(s in e.ref!==void 0&&(i=e.ref),e.key!==void 0&&(o=""+e.key),e)uS.call(e,s)&&!dS.hasOwnProperty(s)&&(r[s]=e[s]);var a=arguments.length-2;if(a===1)r.children=n;else if(1<a){for(var l=Array(a),c=0;c<a;c++)l[c]=arguments[c+2];r.children=l}if(t&&t.defaultProps)for(s in a=t.defaultProps,a)r[s]===void 0&&(r[s]=a[s]);return{$$typeof:iu,type:t,key:o,ref:i,props:r,_owner:z1.current}}function u_(t,e){return{$$typeof:iu,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function M1(t){return typeof t=="object"&&t!==null&&t.$$typeof===iu}function d_(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var _v=/\/+/g;function Um(t,e){return typeof t=="object"&&t!==null&&t.key!=null?d_(""+t.key):e.toString(36)}function fh(t,e,n,s,r){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var i=!1;if(t===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(t.$$typeof){case iu:case ZD:i=!0}}if(i)return i=t,r=r(i),t=s===""?"."+Um(i,0):s,Dv(r)?(n="",t!=null&&(n=t.replace(_v,"$&/")+"/"),fh(r,e,n,"",function(c){return c})):r!=null&&(M1(r)&&(r=u_(r,n+(!r.key||i&&i.key===r.key?"":(""+r.key).replace(_v,"$&/")+"/")+t)),e.push(r)),1;if(i=0,s=s===""?".":s+":",Dv(t))for(var a=0;a<t.length;a++){o=t[a];var l=s+Um(o,a);i+=fh(o,e,n,l,r)}else if(l=c_(t),typeof l=="function")for(t=l.call(t),a=0;!(o=t.next()).done;)o=o.value,l=s+Um(o,a++),i+=fh(o,e,n,l,r);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return i}function Fd(t,e,n){if(t==null)return t;var s=[],r=0;return fh(t,s,"","",function(o){return e.call(n,o,r++)}),s}function h_(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var On={current:null},ph={transition:null},f_={ReactCurrentDispatcher:On,ReactCurrentBatchConfig:ph,ReactCurrentOwner:z1};function fS(){throw Error("act(...) is not supported in production builds of React.")}_e.Children={map:Fd,forEach:function(t,e,n){Fd(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return Fd(t,function(){e++}),e},toArray:function(t){return Fd(t,function(e){return e})||[]},only:function(t){if(!M1(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};_e.Component=xl;_e.Fragment=e_;_e.Profiler=n_;_e.PureComponent=F1;_e.StrictMode=t_;_e.Suspense=i_;_e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=f_;_e.act=fS;_e.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var s=aS({},t.props),r=t.key,o=t.ref,i=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,i=z1.current),e.key!==void 0&&(r=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)uS.call(e,l)&&!dS.hasOwnProperty(l)&&(s[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){a=Array(l);for(var c=0;c<l;c++)a[c]=arguments[c+2];s.children=a}return{$$typeof:iu,type:t.type,key:r,ref:o,props:s,_owner:i}};_e.createContext=function(t){return t={$$typeof:r_,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:s_,_context:t},t.Consumer=t};_e.createElement=hS;_e.createFactory=function(t){var e=hS.bind(null,t);return e.type=t,e};_e.createRef=function(){return{current:null}};_e.forwardRef=function(t){return{$$typeof:o_,render:t}};_e.isValidElement=M1;_e.lazy=function(t){return{$$typeof:l_,_payload:{_status:-1,_result:t},_init:h_}};_e.memo=function(t,e){return{$$typeof:a_,type:t,compare:e===void 0?null:e}};_e.startTransition=function(t){var e=ph.transition;ph.transition={};try{t()}finally{ph.transition=e}};_e.unstable_act=fS;_e.useCallback=function(t,e){return On.current.useCallback(t,e)};_e.useContext=function(t){return On.current.useContext(t)};_e.useDebugValue=function(){};_e.useDeferredValue=function(t){return On.current.useDeferredValue(t)};_e.useEffect=function(t,e){return On.current.useEffect(t,e)};_e.useId=function(){return On.current.useId()};_e.useImperativeHandle=function(t,e,n){return On.current.useImperativeHandle(t,e,n)};_e.useInsertionEffect=function(t,e){return On.current.useInsertionEffect(t,e)};_e.useLayoutEffect=function(t,e){return On.current.useLayoutEffect(t,e)};_e.useMemo=function(t,e){return On.current.useMemo(t,e)};_e.useReducer=function(t,e,n){return On.current.useReducer(t,e,n)};_e.useRef=function(t){return On.current.useRef(t)};_e.useState=function(t){return On.current.useState(t)};_e.useSyncExternalStore=function(t,e,n){return On.current.useSyncExternalStore(t,e,n)};_e.useTransition=function(){return On.current.useTransition()};_e.version="18.3.1";oS.exports=_e;var ye=oS.exports;const Us=sS(ye);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p_=ye,m_=Symbol.for("react.element"),g_=Symbol.for("react.fragment"),x_=Object.prototype.hasOwnProperty,y_=p_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,w_={key:!0,ref:!0,__self:!0,__source:!0};function pS(t,e,n){var s,r={},o=null,i=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(i=e.ref);for(s in e)x_.call(e,s)&&!w_.hasOwnProperty(s)&&(r[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)r[s]===void 0&&(r[s]=e[s]);return{$$typeof:m_,type:t,key:o,ref:i,props:r,_owner:y_.current}}Hf.Fragment=g_;Hf.jsx=pS;Hf.jsxs=pS;rS.exports=Hf;var Se=rS.exports,Ug={},mS={exports:{}},ls={},gS={exports:{}},xS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(R,z){var G=R.length;R.push(z);e:for(;0<G;){var X=G-1>>>1,q=R[X];if(0<r(q,z))R[X]=z,R[G]=q,G=X;else break e}}function n(R){return R.length===0?null:R[0]}function s(R){if(R.length===0)return null;var z=R[0],G=R.pop();if(G!==z){R[0]=G;e:for(var X=0,q=R.length,Q=q>>>1;X<Q;){var ee=2*(X+1)-1,J=R[ee],ne=ee+1,ie=R[ne];if(0>r(J,G))ne<q&&0>r(ie,J)?(R[X]=ie,R[ne]=G,X=ne):(R[X]=J,R[ee]=G,X=ee);else if(ne<q&&0>r(ie,G))R[X]=ie,R[ne]=G,X=ne;else break e}}return z}function r(R,z){var G=R.sortIndex-z.sortIndex;return G!==0?G:R.id-z.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var i=Date,a=i.now();t.unstable_now=function(){return i.now()-a}}var l=[],c=[],u=1,d=null,h=3,f=!1,p=!1,g=!1,x=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(R){for(var z=n(c);z!==null;){if(z.callback===null)s(c);else if(z.startTime<=R)s(c),z.sortIndex=z.expirationTime,e(l,z);else break;z=n(c)}}function v(R){if(g=!1,w(R),!p)if(n(l)!==null)p=!0,U(b);else{var z=n(c);z!==null&&K(v,z.startTime-R)}}function b(R,z){p=!1,g&&(g=!1,m(S),S=-1),f=!0;var G=h;try{for(w(z),d=n(l);d!==null&&(!(d.expirationTime>z)||R&&!A());){var X=d.callback;if(typeof X=="function"){d.callback=null,h=d.priorityLevel;var q=X(d.expirationTime<=z);z=t.unstable_now(),typeof q=="function"?d.callback=q:d===n(l)&&s(l),w(z)}else s(l);d=n(l)}if(d!==null)var Q=!0;else{var ee=n(c);ee!==null&&K(v,ee.startTime-z),Q=!1}return Q}finally{d=null,h=G,f=!1}}var C=!1,k=null,S=-1,$=5,N=-1;function A(){return!(t.unstable_now()-N<$)}function M(){if(k!==null){var R=t.unstable_now();N=R;var z=!0;try{z=k(!0,R)}finally{z?L():(C=!1,k=null)}}else C=!1}var L;if(typeof y=="function")L=function(){y(M)};else if(typeof MessageChannel<"u"){var V=new MessageChannel,B=V.port2;V.port1.onmessage=M,L=function(){B.postMessage(null)}}else L=function(){x(M,0)};function U(R){k=R,C||(C=!0,L())}function K(R,z){S=x(function(){R(t.unstable_now())},z)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(R){R.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,U(b))},t.unstable_forceFrameRate=function(R){0>R||125<R?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<R?Math.floor(1e3/R):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(l)},t.unstable_next=function(R){switch(h){case 1:case 2:case 3:var z=3;break;default:z=h}var G=h;h=z;try{return R()}finally{h=G}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(R,z){switch(R){case 1:case 2:case 3:case 4:case 5:break;default:R=3}var G=h;h=R;try{return z()}finally{h=G}},t.unstable_scheduleCallback=function(R,z,G){var X=t.unstable_now();switch(typeof G=="object"&&G!==null?(G=G.delay,G=typeof G=="number"&&0<G?X+G:X):G=X,R){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=G+q,R={id:u++,callback:z,priorityLevel:R,startTime:G,expirationTime:q,sortIndex:-1},G>X?(R.sortIndex=G,e(c,R),n(l)===null&&R===n(c)&&(g?(m(S),S=-1):g=!0,K(v,G-X))):(R.sortIndex=q,e(l,R),p||f||(p=!0,U(b))),R},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(R){var z=h;return function(){var G=h;h=z;try{return R.apply(this,arguments)}finally{h=G}}}})(xS);gS.exports=xS;var v_=gS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var b_=ye,os=v_;function te(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var yS=new Set,$c={};function Hi(t,e){Ua(t,e),Ua(t+"Capture",e)}function Ua(t,e){for($c[t]=e,t=0;t<e.length;t++)yS.add(e[t])}var Pr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gg=Object.prototype.hasOwnProperty,C_=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Fv={},Ov={};function k_(t){return Gg.call(Ov,t)?!0:Gg.call(Fv,t)?!1:C_.test(t)?Ov[t]=!0:(Fv[t]=!0,!1)}function S_(t,e,n,s){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return s?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function I_(t,e,n,s){if(e===null||typeof e>"u"||S_(t,e,n,s))return!0;if(s)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function zn(t,e,n,s,r,o,i){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=s,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=i}var ln={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ln[t]=new zn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ln[e]=new zn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ln[t]=new zn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ln[t]=new zn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ln[t]=new zn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ln[t]=new zn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ln[t]=new zn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ln[t]=new zn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ln[t]=new zn(t,5,!1,t.toLowerCase(),null,!1,!1)});var P1=/[\-:]([a-z])/g;function L1(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(P1,L1);ln[e]=new zn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(P1,L1);ln[e]=new zn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(P1,L1);ln[e]=new zn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ln[t]=new zn(t,1,!1,t.toLowerCase(),null,!1,!1)});ln.xlinkHref=new zn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ln[t]=new zn(t,1,!1,t.toLowerCase(),null,!0,!0)});function B1(t,e,n,s){var r=ln.hasOwnProperty(e)?ln[e]:null;(r!==null?r.type!==0:s||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(I_(e,n,r,s)&&(n=null),s||r===null?k_(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):r.mustUseProperty?t[r.propertyName]=n===null?r.type===3?!1:"":n:(e=r.attributeName,s=r.attributeNamespace,n===null?t.removeAttribute(e):(r=r.type,n=r===3||r===4&&n===!0?"":""+n,s?t.setAttributeNS(s,e,n):t.setAttribute(e,n))))}var Kr=b_.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Od=Symbol.for("react.element"),ga=Symbol.for("react.portal"),xa=Symbol.for("react.fragment"),V1=Symbol.for("react.strict_mode"),Hg=Symbol.for("react.profiler"),wS=Symbol.for("react.provider"),vS=Symbol.for("react.context"),W1=Symbol.for("react.forward_ref"),jg=Symbol.for("react.suspense"),Kg=Symbol.for("react.suspense_list"),U1=Symbol.for("react.memo"),so=Symbol.for("react.lazy"),bS=Symbol.for("react.offscreen"),zv=Symbol.iterator;function Pl(t){return t===null||typeof t!="object"?null:(t=zv&&t[zv]||t["@@iterator"],typeof t=="function"?t:null)}var bt=Object.assign,Gm;function Yl(t){if(Gm===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Gm=e&&e[1]||""}return`
`+Gm+t}var Hm=!1;function jm(t,e){if(!t||Hm)return"";Hm=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(c){var s=c}Reflect.construct(t,[],e)}else{try{e.call()}catch(c){s=c}t.call(e.prototype)}else{try{throw Error()}catch(c){s=c}t()}}catch(c){if(c&&s&&typeof c.stack=="string"){for(var r=c.stack.split(`
`),o=s.stack.split(`
`),i=r.length-1,a=o.length-1;1<=i&&0<=a&&r[i]!==o[a];)a--;for(;1<=i&&0<=a;i--,a--)if(r[i]!==o[a]){if(i!==1||a!==1)do if(i--,a--,0>a||r[i]!==o[a]){var l=`
`+r[i].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=i&&0<=a);break}}}finally{Hm=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Yl(t):""}function $_(t){switch(t.tag){case 5:return Yl(t.type);case 16:return Yl("Lazy");case 13:return Yl("Suspense");case 19:return Yl("SuspenseList");case 0:case 2:case 15:return t=jm(t.type,!1),t;case 11:return t=jm(t.type.render,!1),t;case 1:return t=jm(t.type,!0),t;default:return""}}function Xg(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case xa:return"Fragment";case ga:return"Portal";case Hg:return"Profiler";case V1:return"StrictMode";case jg:return"Suspense";case Kg:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case vS:return(t.displayName||"Context")+".Consumer";case wS:return(t._context.displayName||"Context")+".Provider";case W1:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case U1:return e=t.displayName||null,e!==null?e:Xg(t.type)||"Memo";case so:e=t._payload,t=t._init;try{return Xg(t(e))}catch{}}return null}function N_(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Xg(e);case 8:return e===V1?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Ro(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function CS(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function T_(t){var e=CS(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),s=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var r=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return r.call(this)},set:function(i){s=""+i,o.call(this,i)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return s},setValue:function(i){s=""+i},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function zd(t){t._valueTracker||(t._valueTracker=T_(t))}function kS(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),s="";return t&&(s=CS(t)?t.checked?"true":"false":t.value),t=s,t!==n?(e.setValue(t),!0):!1}function zh(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function qg(t,e){var n=e.checked;return bt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function Mv(t,e){var n=e.defaultValue==null?"":e.defaultValue,s=e.checked!=null?e.checked:e.defaultChecked;n=Ro(e.value!=null?e.value:n),t._wrapperState={initialChecked:s,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function SS(t,e){e=e.checked,e!=null&&B1(t,"checked",e,!1)}function Yg(t,e){SS(t,e);var n=Ro(e.value),s=e.type;if(n!=null)s==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(s==="submit"||s==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Qg(t,e.type,n):e.hasOwnProperty("defaultValue")&&Qg(t,e.type,Ro(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Pv(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var s=e.type;if(!(s!=="submit"&&s!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Qg(t,e,n){(e!=="number"||zh(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var Ql=Array.isArray;function Ra(t,e,n,s){if(t=t.options,e){e={};for(var r=0;r<n.length;r++)e["$"+n[r]]=!0;for(n=0;n<t.length;n++)r=e.hasOwnProperty("$"+t[n].value),t[n].selected!==r&&(t[n].selected=r),r&&s&&(t[n].defaultSelected=!0)}else{for(n=""+Ro(n),e=null,r=0;r<t.length;r++){if(t[r].value===n){t[r].selected=!0,s&&(t[r].defaultSelected=!0);return}e!==null||t[r].disabled||(e=t[r])}e!==null&&(e.selected=!0)}}function Jg(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(te(91));return bt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Lv(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(te(92));if(Ql(n)){if(1<n.length)throw Error(te(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Ro(n)}}function IS(t,e){var n=Ro(e.value),s=Ro(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),s!=null&&(t.defaultValue=""+s)}function Bv(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function $S(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Zg(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?$S(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Md,NS=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,s,r){MSApp.execUnsafeLocalFunction(function(){return t(e,n,s,r)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Md=Md||document.createElement("div"),Md.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Md.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Nc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var dc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},E_=["Webkit","ms","Moz","O"];Object.keys(dc).forEach(function(t){E_.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),dc[e]=dc[t]})});function TS(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||dc.hasOwnProperty(t)&&dc[t]?(""+e).trim():e+"px"}function ES(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var s=n.indexOf("--")===0,r=TS(n,e[n],s);n==="float"&&(n="cssFloat"),s?t.setProperty(n,r):t[n]=r}}var R_=bt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function e0(t,e){if(e){if(R_[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(te(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(te(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(te(61))}if(e.style!=null&&typeof e.style!="object")throw Error(te(62))}}function t0(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var n0=null;function G1(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var s0=null,Aa=null,Da=null;function Vv(t){if(t=cu(t)){if(typeof s0!="function")throw Error(te(280));var e=t.stateNode;e&&(e=Yf(e),s0(t.stateNode,t.type,e))}}function RS(t){Aa?Da?Da.push(t):Da=[t]:Aa=t}function AS(){if(Aa){var t=Aa,e=Da;if(Da=Aa=null,Vv(t),e)for(t=0;t<e.length;t++)Vv(e[t])}}function DS(t,e){return t(e)}function _S(){}var Km=!1;function FS(t,e,n){if(Km)return t(e,n);Km=!0;try{return DS(t,e,n)}finally{Km=!1,(Aa!==null||Da!==null)&&(_S(),AS())}}function Tc(t,e){var n=t.stateNode;if(n===null)return null;var s=Yf(n);if(s===null)return null;n=s[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(s=!s.disabled)||(t=t.type,s=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!s;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(te(231,e,typeof n));return n}var r0=!1;if(Pr)try{var Ll={};Object.defineProperty(Ll,"passive",{get:function(){r0=!0}}),window.addEventListener("test",Ll,Ll),window.removeEventListener("test",Ll,Ll)}catch{r0=!1}function A_(t,e,n,s,r,o,i,a,l){var c=Array.prototype.slice.call(arguments,3);try{e.apply(n,c)}catch(u){this.onError(u)}}var hc=!1,Mh=null,Ph=!1,o0=null,D_={onError:function(t){hc=!0,Mh=t}};function __(t,e,n,s,r,o,i,a,l){hc=!1,Mh=null,A_.apply(D_,arguments)}function F_(t,e,n,s,r,o,i,a,l){if(__.apply(this,arguments),hc){if(hc){var c=Mh;hc=!1,Mh=null}else throw Error(te(198));Ph||(Ph=!0,o0=c)}}function ji(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function OS(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Wv(t){if(ji(t)!==t)throw Error(te(188))}function O_(t){var e=t.alternate;if(!e){if(e=ji(t),e===null)throw Error(te(188));return e!==t?null:t}for(var n=t,s=e;;){var r=n.return;if(r===null)break;var o=r.alternate;if(o===null){if(s=r.return,s!==null){n=s;continue}break}if(r.child===o.child){for(o=r.child;o;){if(o===n)return Wv(r),t;if(o===s)return Wv(r),e;o=o.sibling}throw Error(te(188))}if(n.return!==s.return)n=r,s=o;else{for(var i=!1,a=r.child;a;){if(a===n){i=!0,n=r,s=o;break}if(a===s){i=!0,s=r,n=o;break}a=a.sibling}if(!i){for(a=o.child;a;){if(a===n){i=!0,n=o,s=r;break}if(a===s){i=!0,s=o,n=r;break}a=a.sibling}if(!i)throw Error(te(189))}}if(n.alternate!==s)throw Error(te(190))}if(n.tag!==3)throw Error(te(188));return n.stateNode.current===n?t:e}function zS(t){return t=O_(t),t!==null?MS(t):null}function MS(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=MS(t);if(e!==null)return e;t=t.sibling}return null}var PS=os.unstable_scheduleCallback,Uv=os.unstable_cancelCallback,z_=os.unstable_shouldYield,M_=os.unstable_requestPaint,Et=os.unstable_now,P_=os.unstable_getCurrentPriorityLevel,H1=os.unstable_ImmediatePriority,LS=os.unstable_UserBlockingPriority,Lh=os.unstable_NormalPriority,L_=os.unstable_LowPriority,BS=os.unstable_IdlePriority,jf=null,pr=null;function B_(t){if(pr&&typeof pr.onCommitFiberRoot=="function")try{pr.onCommitFiberRoot(jf,t,void 0,(t.current.flags&128)===128)}catch{}}var Hs=Math.clz32?Math.clz32:U_,V_=Math.log,W_=Math.LN2;function U_(t){return t>>>=0,t===0?32:31-(V_(t)/W_|0)|0}var Pd=64,Ld=4194304;function Jl(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Bh(t,e){var n=t.pendingLanes;if(n===0)return 0;var s=0,r=t.suspendedLanes,o=t.pingedLanes,i=n&268435455;if(i!==0){var a=i&~r;a!==0?s=Jl(a):(o&=i,o!==0&&(s=Jl(o)))}else i=n&~r,i!==0?s=Jl(i):o!==0&&(s=Jl(o));if(s===0)return 0;if(e!==0&&e!==s&&!(e&r)&&(r=s&-s,o=e&-e,r>=o||r===16&&(o&4194240)!==0))return e;if(s&4&&(s|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=s;0<e;)n=31-Hs(e),r=1<<n,s|=t[n],e&=~r;return s}function G_(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function H_(t,e){for(var n=t.suspendedLanes,s=t.pingedLanes,r=t.expirationTimes,o=t.pendingLanes;0<o;){var i=31-Hs(o),a=1<<i,l=r[i];l===-1?(!(a&n)||a&s)&&(r[i]=G_(a,e)):l<=e&&(t.expiredLanes|=a),o&=~a}}function i0(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function VS(){var t=Pd;return Pd<<=1,!(Pd&4194240)&&(Pd=64),t}function Xm(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function au(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Hs(e),t[e]=n}function j_(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var s=t.eventTimes;for(t=t.expirationTimes;0<n;){var r=31-Hs(n),o=1<<r;e[r]=0,s[r]=-1,t[r]=-1,n&=~o}}function j1(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var s=31-Hs(n),r=1<<s;r&e|t[s]&e&&(t[s]|=e),n&=~r}}var Ye=0;function WS(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var US,K1,GS,HS,jS,a0=!1,Bd=[],mo=null,go=null,xo=null,Ec=new Map,Rc=new Map,io=[],K_="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Gv(t,e){switch(t){case"focusin":case"focusout":mo=null;break;case"dragenter":case"dragleave":go=null;break;case"mouseover":case"mouseout":xo=null;break;case"pointerover":case"pointerout":Ec.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rc.delete(e.pointerId)}}function Bl(t,e,n,s,r,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:s,nativeEvent:o,targetContainers:[r]},e!==null&&(e=cu(e),e!==null&&K1(e)),t):(t.eventSystemFlags|=s,e=t.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),t)}function X_(t,e,n,s,r){switch(e){case"focusin":return mo=Bl(mo,t,e,n,s,r),!0;case"dragenter":return go=Bl(go,t,e,n,s,r),!0;case"mouseover":return xo=Bl(xo,t,e,n,s,r),!0;case"pointerover":var o=r.pointerId;return Ec.set(o,Bl(Ec.get(o)||null,t,e,n,s,r)),!0;case"gotpointercapture":return o=r.pointerId,Rc.set(o,Bl(Rc.get(o)||null,t,e,n,s,r)),!0}return!1}function KS(t){var e=ci(t.target);if(e!==null){var n=ji(e);if(n!==null){if(e=n.tag,e===13){if(e=OS(n),e!==null){t.blockedOn=e,jS(t.priority,function(){GS(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function mh(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=l0(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var s=new n.constructor(n.type,n);n0=s,n.target.dispatchEvent(s),n0=null}else return e=cu(n),e!==null&&K1(e),t.blockedOn=n,!1;e.shift()}return!0}function Hv(t,e,n){mh(t)&&n.delete(e)}function q_(){a0=!1,mo!==null&&mh(mo)&&(mo=null),go!==null&&mh(go)&&(go=null),xo!==null&&mh(xo)&&(xo=null),Ec.forEach(Hv),Rc.forEach(Hv)}function Vl(t,e){t.blockedOn===e&&(t.blockedOn=null,a0||(a0=!0,os.unstable_scheduleCallback(os.unstable_NormalPriority,q_)))}function Ac(t){function e(r){return Vl(r,t)}if(0<Bd.length){Vl(Bd[0],t);for(var n=1;n<Bd.length;n++){var s=Bd[n];s.blockedOn===t&&(s.blockedOn=null)}}for(mo!==null&&Vl(mo,t),go!==null&&Vl(go,t),xo!==null&&Vl(xo,t),Ec.forEach(e),Rc.forEach(e),n=0;n<io.length;n++)s=io[n],s.blockedOn===t&&(s.blockedOn=null);for(;0<io.length&&(n=io[0],n.blockedOn===null);)KS(n),n.blockedOn===null&&io.shift()}var _a=Kr.ReactCurrentBatchConfig,Vh=!0;function Y_(t,e,n,s){var r=Ye,o=_a.transition;_a.transition=null;try{Ye=1,X1(t,e,n,s)}finally{Ye=r,_a.transition=o}}function Q_(t,e,n,s){var r=Ye,o=_a.transition;_a.transition=null;try{Ye=4,X1(t,e,n,s)}finally{Ye=r,_a.transition=o}}function X1(t,e,n,s){if(Vh){var r=l0(t,e,n,s);if(r===null)rg(t,e,s,Wh,n),Gv(t,s);else if(X_(r,t,e,n,s))s.stopPropagation();else if(Gv(t,s),e&4&&-1<K_.indexOf(t)){for(;r!==null;){var o=cu(r);if(o!==null&&US(o),o=l0(t,e,n,s),o===null&&rg(t,e,s,Wh,n),o===r)break;r=o}r!==null&&s.stopPropagation()}else rg(t,e,s,null,n)}}var Wh=null;function l0(t,e,n,s){if(Wh=null,t=G1(s),t=ci(t),t!==null)if(e=ji(t),e===null)t=null;else if(n=e.tag,n===13){if(t=OS(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Wh=t,null}function XS(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(P_()){case H1:return 1;case LS:return 4;case Lh:case L_:return 16;case BS:return 536870912;default:return 16}default:return 16}}var lo=null,q1=null,gh=null;function qS(){if(gh)return gh;var t,e=q1,n=e.length,s,r="value"in lo?lo.value:lo.textContent,o=r.length;for(t=0;t<n&&e[t]===r[t];t++);var i=n-t;for(s=1;s<=i&&e[n-s]===r[o-s];s++);return gh=r.slice(t,1<s?1-s:void 0)}function xh(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Vd(){return!0}function jv(){return!1}function cs(t){function e(n,s,r,o,i){this._reactName=n,this._targetInst=r,this.type=s,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Vd:jv,this.isPropagationStopped=jv,this}return bt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=Vd)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=Vd)},persist:function(){},isPersistent:Vd}),e}var yl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Y1=cs(yl),lu=bt({},yl,{view:0,detail:0}),J_=cs(lu),qm,Ym,Wl,Kf=bt({},lu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Q1,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Wl&&(Wl&&t.type==="mousemove"?(qm=t.screenX-Wl.screenX,Ym=t.screenY-Wl.screenY):Ym=qm=0,Wl=t),qm)},movementY:function(t){return"movementY"in t?t.movementY:Ym}}),Kv=cs(Kf),Z_=bt({},Kf,{dataTransfer:0}),eF=cs(Z_),tF=bt({},lu,{relatedTarget:0}),Qm=cs(tF),nF=bt({},yl,{animationName:0,elapsedTime:0,pseudoElement:0}),sF=cs(nF),rF=bt({},yl,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),oF=cs(rF),iF=bt({},yl,{data:0}),Xv=cs(iF),aF={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lF={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},cF={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function uF(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=cF[t])?!!e[t]:!1}function Q1(){return uF}var dF=bt({},lu,{key:function(t){if(t.key){var e=aF[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=xh(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?lF[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Q1,charCode:function(t){return t.type==="keypress"?xh(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?xh(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),hF=cs(dF),fF=bt({},Kf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),qv=cs(fF),pF=bt({},lu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Q1}),mF=cs(pF),gF=bt({},yl,{propertyName:0,elapsedTime:0,pseudoElement:0}),xF=cs(gF),yF=bt({},Kf,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),wF=cs(yF),vF=[9,13,27,32],J1=Pr&&"CompositionEvent"in window,fc=null;Pr&&"documentMode"in document&&(fc=document.documentMode);var bF=Pr&&"TextEvent"in window&&!fc,YS=Pr&&(!J1||fc&&8<fc&&11>=fc),Yv=" ",Qv=!1;function QS(t,e){switch(t){case"keyup":return vF.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function JS(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ya=!1;function CF(t,e){switch(t){case"compositionend":return JS(e);case"keypress":return e.which!==32?null:(Qv=!0,Yv);case"textInput":return t=e.data,t===Yv&&Qv?null:t;default:return null}}function kF(t,e){if(ya)return t==="compositionend"||!J1&&QS(t,e)?(t=qS(),gh=q1=lo=null,ya=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return YS&&e.locale!=="ko"?null:e.data;default:return null}}var SF={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jv(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!SF[t.type]:e==="textarea"}function ZS(t,e,n,s){RS(s),e=Uh(e,"onChange"),0<e.length&&(n=new Y1("onChange","change",null,n,s),t.push({event:n,listeners:e}))}var pc=null,Dc=null;function IF(t){uI(t,0)}function Xf(t){var e=ba(t);if(kS(e))return t}function $F(t,e){if(t==="change")return e}var eI=!1;if(Pr){var Jm;if(Pr){var Zm="oninput"in document;if(!Zm){var Zv=document.createElement("div");Zv.setAttribute("oninput","return;"),Zm=typeof Zv.oninput=="function"}Jm=Zm}else Jm=!1;eI=Jm&&(!document.documentMode||9<document.documentMode)}function eb(){pc&&(pc.detachEvent("onpropertychange",tI),Dc=pc=null)}function tI(t){if(t.propertyName==="value"&&Xf(Dc)){var e=[];ZS(e,Dc,t,G1(t)),FS(IF,e)}}function NF(t,e,n){t==="focusin"?(eb(),pc=e,Dc=n,pc.attachEvent("onpropertychange",tI)):t==="focusout"&&eb()}function TF(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Xf(Dc)}function EF(t,e){if(t==="click")return Xf(e)}function RF(t,e){if(t==="input"||t==="change")return Xf(e)}function AF(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Qs=typeof Object.is=="function"?Object.is:AF;function _c(t,e){if(Qs(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(s=0;s<n.length;s++){var r=n[s];if(!Gg.call(e,r)||!Qs(t[r],e[r]))return!1}return!0}function tb(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function nb(t,e){var n=tb(t);t=0;for(var s;n;){if(n.nodeType===3){if(s=t+n.textContent.length,t<=e&&s>=e)return{node:n,offset:e-t};t=s}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=tb(n)}}function nI(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?nI(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function sI(){for(var t=window,e=zh();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=zh(t.document)}return e}function Z1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function DF(t){var e=sI(),n=t.focusedElem,s=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&nI(n.ownerDocument.documentElement,n)){if(s!==null&&Z1(n)){if(e=s.start,t=s.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var r=n.textContent.length,o=Math.min(s.start,r);s=s.end===void 0?o:Math.min(s.end,r),!t.extend&&o>s&&(r=s,s=o,o=r),r=nb(n,o);var i=nb(n,s);r&&i&&(t.rangeCount!==1||t.anchorNode!==r.node||t.anchorOffset!==r.offset||t.focusNode!==i.node||t.focusOffset!==i.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),t.removeAllRanges(),o>s?(t.addRange(e),t.extend(i.node,i.offset)):(e.setEnd(i.node,i.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var _F=Pr&&"documentMode"in document&&11>=document.documentMode,wa=null,c0=null,mc=null,u0=!1;function sb(t,e,n){var s=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;u0||wa==null||wa!==zh(s)||(s=wa,"selectionStart"in s&&Z1(s)?s={start:s.selectionStart,end:s.selectionEnd}:(s=(s.ownerDocument&&s.ownerDocument.defaultView||window).getSelection(),s={anchorNode:s.anchorNode,anchorOffset:s.anchorOffset,focusNode:s.focusNode,focusOffset:s.focusOffset}),mc&&_c(mc,s)||(mc=s,s=Uh(c0,"onSelect"),0<s.length&&(e=new Y1("onSelect","select",null,e,n),t.push({event:e,listeners:s}),e.target=wa)))}function Wd(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var va={animationend:Wd("Animation","AnimationEnd"),animationiteration:Wd("Animation","AnimationIteration"),animationstart:Wd("Animation","AnimationStart"),transitionend:Wd("Transition","TransitionEnd")},eg={},rI={};Pr&&(rI=document.createElement("div").style,"AnimationEvent"in window||(delete va.animationend.animation,delete va.animationiteration.animation,delete va.animationstart.animation),"TransitionEvent"in window||delete va.transitionend.transition);function qf(t){if(eg[t])return eg[t];if(!va[t])return t;var e=va[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in rI)return eg[t]=e[n];return t}var oI=qf("animationend"),iI=qf("animationiteration"),aI=qf("animationstart"),lI=qf("transitionend"),cI=new Map,rb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Po(t,e){cI.set(t,e),Hi(e,[t])}for(var tg=0;tg<rb.length;tg++){var ng=rb[tg],FF=ng.toLowerCase(),OF=ng[0].toUpperCase()+ng.slice(1);Po(FF,"on"+OF)}Po(oI,"onAnimationEnd");Po(iI,"onAnimationIteration");Po(aI,"onAnimationStart");Po("dblclick","onDoubleClick");Po("focusin","onFocus");Po("focusout","onBlur");Po(lI,"onTransitionEnd");Ua("onMouseEnter",["mouseout","mouseover"]);Ua("onMouseLeave",["mouseout","mouseover"]);Ua("onPointerEnter",["pointerout","pointerover"]);Ua("onPointerLeave",["pointerout","pointerover"]);Hi("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Hi("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Hi("onBeforeInput",["compositionend","keypress","textInput","paste"]);Hi("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Hi("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Hi("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zl="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zF=new Set("cancel close invalid load scroll toggle".split(" ").concat(Zl));function ob(t,e,n){var s=t.type||"unknown-event";t.currentTarget=n,F_(s,e,void 0,t),t.currentTarget=null}function uI(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var s=t[n],r=s.event;s=s.listeners;e:{var o=void 0;if(e)for(var i=s.length-1;0<=i;i--){var a=s[i],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==o&&r.isPropagationStopped())break e;ob(r,a,c),o=l}else for(i=0;i<s.length;i++){if(a=s[i],l=a.instance,c=a.currentTarget,a=a.listener,l!==o&&r.isPropagationStopped())break e;ob(r,a,c),o=l}}}if(Ph)throw t=o0,Ph=!1,o0=null,t}function ut(t,e){var n=e[m0];n===void 0&&(n=e[m0]=new Set);var s=t+"__bubble";n.has(s)||(dI(e,t,2,!1),n.add(s))}function sg(t,e,n){var s=0;e&&(s|=4),dI(n,t,s,e)}var Ud="_reactListening"+Math.random().toString(36).slice(2);function Fc(t){if(!t[Ud]){t[Ud]=!0,yS.forEach(function(n){n!=="selectionchange"&&(zF.has(n)||sg(n,!1,t),sg(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ud]||(e[Ud]=!0,sg("selectionchange",!1,e))}}function dI(t,e,n,s){switch(XS(e)){case 1:var r=Y_;break;case 4:r=Q_;break;default:r=X1}n=r.bind(null,e,n,t),r=void 0,!r0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),s?r!==void 0?t.addEventListener(e,n,{capture:!0,passive:r}):t.addEventListener(e,n,!0):r!==void 0?t.addEventListener(e,n,{passive:r}):t.addEventListener(e,n,!1)}function rg(t,e,n,s,r){var o=s;if(!(e&1)&&!(e&2)&&s!==null)e:for(;;){if(s===null)return;var i=s.tag;if(i===3||i===4){var a=s.stateNode.containerInfo;if(a===r||a.nodeType===8&&a.parentNode===r)break;if(i===4)for(i=s.return;i!==null;){var l=i.tag;if((l===3||l===4)&&(l=i.stateNode.containerInfo,l===r||l.nodeType===8&&l.parentNode===r))return;i=i.return}for(;a!==null;){if(i=ci(a),i===null)return;if(l=i.tag,l===5||l===6){s=o=i;continue e}a=a.parentNode}}s=s.return}FS(function(){var c=o,u=G1(n),d=[];e:{var h=cI.get(t);if(h!==void 0){var f=Y1,p=t;switch(t){case"keypress":if(xh(n)===0)break e;case"keydown":case"keyup":f=hF;break;case"focusin":p="focus",f=Qm;break;case"focusout":p="blur",f=Qm;break;case"beforeblur":case"afterblur":f=Qm;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=Kv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=eF;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=mF;break;case oI:case iI:case aI:f=sF;break;case lI:f=xF;break;case"scroll":f=J_;break;case"wheel":f=wF;break;case"copy":case"cut":case"paste":f=oF;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=qv}var g=(e&4)!==0,x=!g&&t==="scroll",m=g?h!==null?h+"Capture":null:h;g=[];for(var y=c,w;y!==null;){w=y;var v=w.stateNode;if(w.tag===5&&v!==null&&(w=v,m!==null&&(v=Tc(y,m),v!=null&&g.push(Oc(y,v,w)))),x)break;y=y.return}0<g.length&&(h=new f(h,p,null,n,u),d.push({event:h,listeners:g}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==n0&&(p=n.relatedTarget||n.fromElement)&&(ci(p)||p[Lr]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(p=n.relatedTarget||n.toElement,f=c,p=p?ci(p):null,p!==null&&(x=ji(p),p!==x||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=c),f!==p)){if(g=Kv,v="onMouseLeave",m="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(g=qv,v="onPointerLeave",m="onPointerEnter",y="pointer"),x=f==null?h:ba(f),w=p==null?h:ba(p),h=new g(v,y+"leave",f,n,u),h.target=x,h.relatedTarget=w,v=null,ci(u)===c&&(g=new g(m,y+"enter",p,n,u),g.target=w,g.relatedTarget=x,v=g),x=v,f&&p)t:{for(g=f,m=p,y=0,w=g;w;w=oa(w))y++;for(w=0,v=m;v;v=oa(v))w++;for(;0<y-w;)g=oa(g),y--;for(;0<w-y;)m=oa(m),w--;for(;y--;){if(g===m||m!==null&&g===m.alternate)break t;g=oa(g),m=oa(m)}g=null}else g=null;f!==null&&ib(d,h,f,g,!1),p!==null&&x!==null&&ib(d,x,p,g,!0)}}e:{if(h=c?ba(c):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var b=$F;else if(Jv(h))if(eI)b=RF;else{b=TF;var C=NF}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(b=EF);if(b&&(b=b(t,c))){ZS(d,b,n,u);break e}C&&C(t,h,c),t==="focusout"&&(C=h._wrapperState)&&C.controlled&&h.type==="number"&&Qg(h,"number",h.value)}switch(C=c?ba(c):window,t){case"focusin":(Jv(C)||C.contentEditable==="true")&&(wa=C,c0=c,mc=null);break;case"focusout":mc=c0=wa=null;break;case"mousedown":u0=!0;break;case"contextmenu":case"mouseup":case"dragend":u0=!1,sb(d,n,u);break;case"selectionchange":if(_F)break;case"keydown":case"keyup":sb(d,n,u)}var k;if(J1)e:{switch(t){case"compositionstart":var S="onCompositionStart";break e;case"compositionend":S="onCompositionEnd";break e;case"compositionupdate":S="onCompositionUpdate";break e}S=void 0}else ya?QS(t,n)&&(S="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(S="onCompositionStart");S&&(YS&&n.locale!=="ko"&&(ya||S!=="onCompositionStart"?S==="onCompositionEnd"&&ya&&(k=qS()):(lo=u,q1="value"in lo?lo.value:lo.textContent,ya=!0)),C=Uh(c,S),0<C.length&&(S=new Xv(S,t,null,n,u),d.push({event:S,listeners:C}),k?S.data=k:(k=JS(n),k!==null&&(S.data=k)))),(k=bF?CF(t,n):kF(t,n))&&(c=Uh(c,"onBeforeInput"),0<c.length&&(u=new Xv("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:c}),u.data=k))}uI(d,e)})}function Oc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Uh(t,e){for(var n=e+"Capture",s=[];t!==null;){var r=t,o=r.stateNode;r.tag===5&&o!==null&&(r=o,o=Tc(t,n),o!=null&&s.unshift(Oc(t,o,r)),o=Tc(t,e),o!=null&&s.push(Oc(t,o,r))),t=t.return}return s}function oa(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function ib(t,e,n,s,r){for(var o=e._reactName,i=[];n!==null&&n!==s;){var a=n,l=a.alternate,c=a.stateNode;if(l!==null&&l===s)break;a.tag===5&&c!==null&&(a=c,r?(l=Tc(n,o),l!=null&&i.unshift(Oc(n,l,a))):r||(l=Tc(n,o),l!=null&&i.push(Oc(n,l,a)))),n=n.return}i.length!==0&&t.push({event:e,listeners:i})}var MF=/\r\n?/g,PF=/\u0000|\uFFFD/g;function ab(t){return(typeof t=="string"?t:""+t).replace(MF,`
`).replace(PF,"")}function Gd(t,e,n){if(e=ab(e),ab(t)!==e&&n)throw Error(te(425))}function Gh(){}var d0=null,h0=null;function f0(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var p0=typeof setTimeout=="function"?setTimeout:void 0,LF=typeof clearTimeout=="function"?clearTimeout:void 0,lb=typeof Promise=="function"?Promise:void 0,BF=typeof queueMicrotask=="function"?queueMicrotask:typeof lb<"u"?function(t){return lb.resolve(null).then(t).catch(VF)}:p0;function VF(t){setTimeout(function(){throw t})}function og(t,e){var n=e,s=0;do{var r=n.nextSibling;if(t.removeChild(n),r&&r.nodeType===8)if(n=r.data,n==="/$"){if(s===0){t.removeChild(r),Ac(e);return}s--}else n!=="$"&&n!=="$?"&&n!=="$!"||s++;n=r}while(n);Ac(e)}function yo(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function cb(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var wl=Math.random().toString(36).slice(2),hr="__reactFiber$"+wl,zc="__reactProps$"+wl,Lr="__reactContainer$"+wl,m0="__reactEvents$"+wl,WF="__reactListeners$"+wl,UF="__reactHandles$"+wl;function ci(t){var e=t[hr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[Lr]||n[hr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=cb(t);t!==null;){if(n=t[hr])return n;t=cb(t)}return e}t=n,n=t.parentNode}return null}function cu(t){return t=t[hr]||t[Lr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ba(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(te(33))}function Yf(t){return t[zc]||null}var g0=[],Ca=-1;function Lo(t){return{current:t}}function ft(t){0>Ca||(t.current=g0[Ca],g0[Ca]=null,Ca--)}function ot(t,e){Ca++,g0[Ca]=t.current,t.current=e}var Ao={},kn=Lo(Ao),Hn=Lo(!1),Si=Ao;function Ga(t,e){var n=t.type.contextTypes;if(!n)return Ao;var s=t.stateNode;if(s&&s.__reactInternalMemoizedUnmaskedChildContext===e)return s.__reactInternalMemoizedMaskedChildContext;var r={},o;for(o in n)r[o]=e[o];return s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=r),r}function jn(t){return t=t.childContextTypes,t!=null}function Hh(){ft(Hn),ft(kn)}function ub(t,e,n){if(kn.current!==Ao)throw Error(te(168));ot(kn,e),ot(Hn,n)}function hI(t,e,n){var s=t.stateNode;if(e=e.childContextTypes,typeof s.getChildContext!="function")return n;s=s.getChildContext();for(var r in s)if(!(r in e))throw Error(te(108,N_(t)||"Unknown",r));return bt({},n,s)}function jh(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Ao,Si=kn.current,ot(kn,t),ot(Hn,Hn.current),!0}function db(t,e,n){var s=t.stateNode;if(!s)throw Error(te(169));n?(t=hI(t,e,Si),s.__reactInternalMemoizedMergedChildContext=t,ft(Hn),ft(kn),ot(kn,t)):ft(Hn),ot(Hn,n)}var Ar=null,Qf=!1,ig=!1;function fI(t){Ar===null?Ar=[t]:Ar.push(t)}function GF(t){Qf=!0,fI(t)}function Bo(){if(!ig&&Ar!==null){ig=!0;var t=0,e=Ye;try{var n=Ar;for(Ye=1;t<n.length;t++){var s=n[t];do s=s(!0);while(s!==null)}Ar=null,Qf=!1}catch(r){throw Ar!==null&&(Ar=Ar.slice(t+1)),PS(H1,Bo),r}finally{Ye=e,ig=!1}}return null}var ka=[],Sa=0,Kh=null,Xh=0,ms=[],gs=0,Ii=null,Fr=1,Or="";function ni(t,e){ka[Sa++]=Xh,ka[Sa++]=Kh,Kh=t,Xh=e}function pI(t,e,n){ms[gs++]=Fr,ms[gs++]=Or,ms[gs++]=Ii,Ii=t;var s=Fr;t=Or;var r=32-Hs(s)-1;s&=~(1<<r),n+=1;var o=32-Hs(e)+r;if(30<o){var i=r-r%5;o=(s&(1<<i)-1).toString(32),s>>=i,r-=i,Fr=1<<32-Hs(e)+r|n<<r|s,Or=o+t}else Fr=1<<o|n<<r|s,Or=t}function ex(t){t.return!==null&&(ni(t,1),pI(t,1,0))}function tx(t){for(;t===Kh;)Kh=ka[--Sa],ka[Sa]=null,Xh=ka[--Sa],ka[Sa]=null;for(;t===Ii;)Ii=ms[--gs],ms[gs]=null,Or=ms[--gs],ms[gs]=null,Fr=ms[--gs],ms[gs]=null}var ss=null,ts=null,gt=!1,Bs=null;function mI(t,e){var n=ys(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function hb(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ss=t,ts=yo(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ss=t,ts=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Ii!==null?{id:Fr,overflow:Or}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=ys(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,ss=t,ts=null,!0):!1;default:return!1}}function x0(t){return(t.mode&1)!==0&&(t.flags&128)===0}function y0(t){if(gt){var e=ts;if(e){var n=e;if(!hb(t,e)){if(x0(t))throw Error(te(418));e=yo(n.nextSibling);var s=ss;e&&hb(t,e)?mI(s,n):(t.flags=t.flags&-4097|2,gt=!1,ss=t)}}else{if(x0(t))throw Error(te(418));t.flags=t.flags&-4097|2,gt=!1,ss=t}}}function fb(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ss=t}function Hd(t){if(t!==ss)return!1;if(!gt)return fb(t),gt=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!f0(t.type,t.memoizedProps)),e&&(e=ts)){if(x0(t))throw gI(),Error(te(418));for(;e;)mI(t,e),e=yo(e.nextSibling)}if(fb(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(te(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){ts=yo(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}ts=null}}else ts=ss?yo(t.stateNode.nextSibling):null;return!0}function gI(){for(var t=ts;t;)t=yo(t.nextSibling)}function Ha(){ts=ss=null,gt=!1}function nx(t){Bs===null?Bs=[t]:Bs.push(t)}var HF=Kr.ReactCurrentBatchConfig;function Ul(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(te(309));var s=n.stateNode}if(!s)throw Error(te(147,t));var r=s,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(i){var a=r.refs;i===null?delete a[o]:a[o]=i},e._stringRef=o,e)}if(typeof t!="string")throw Error(te(284));if(!n._owner)throw Error(te(290,t))}return t}function jd(t,e){throw t=Object.prototype.toString.call(e),Error(te(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function pb(t){var e=t._init;return e(t._payload)}function xI(t){function e(m,y){if(t){var w=m.deletions;w===null?(m.deletions=[y],m.flags|=16):w.push(y)}}function n(m,y){if(!t)return null;for(;y!==null;)e(m,y),y=y.sibling;return null}function s(m,y){for(m=new Map;y!==null;)y.key!==null?m.set(y.key,y):m.set(y.index,y),y=y.sibling;return m}function r(m,y){return m=Co(m,y),m.index=0,m.sibling=null,m}function o(m,y,w){return m.index=w,t?(w=m.alternate,w!==null?(w=w.index,w<y?(m.flags|=2,y):w):(m.flags|=2,y)):(m.flags|=1048576,y)}function i(m){return t&&m.alternate===null&&(m.flags|=2),m}function a(m,y,w,v){return y===null||y.tag!==6?(y=fg(w,m.mode,v),y.return=m,y):(y=r(y,w),y.return=m,y)}function l(m,y,w,v){var b=w.type;return b===xa?u(m,y,w.props.children,v,w.key):y!==null&&(y.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===so&&pb(b)===y.type)?(v=r(y,w.props),v.ref=Ul(m,y,w),v.return=m,v):(v=Sh(w.type,w.key,w.props,null,m.mode,v),v.ref=Ul(m,y,w),v.return=m,v)}function c(m,y,w,v){return y===null||y.tag!==4||y.stateNode.containerInfo!==w.containerInfo||y.stateNode.implementation!==w.implementation?(y=pg(w,m.mode,v),y.return=m,y):(y=r(y,w.children||[]),y.return=m,y)}function u(m,y,w,v,b){return y===null||y.tag!==7?(y=xi(w,m.mode,v,b),y.return=m,y):(y=r(y,w),y.return=m,y)}function d(m,y,w){if(typeof y=="string"&&y!==""||typeof y=="number")return y=fg(""+y,m.mode,w),y.return=m,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Od:return w=Sh(y.type,y.key,y.props,null,m.mode,w),w.ref=Ul(m,null,y),w.return=m,w;case ga:return y=pg(y,m.mode,w),y.return=m,y;case so:var v=y._init;return d(m,v(y._payload),w)}if(Ql(y)||Pl(y))return y=xi(y,m.mode,w,null),y.return=m,y;jd(m,y)}return null}function h(m,y,w,v){var b=y!==null?y.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return b!==null?null:a(m,y,""+w,v);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case Od:return w.key===b?l(m,y,w,v):null;case ga:return w.key===b?c(m,y,w,v):null;case so:return b=w._init,h(m,y,b(w._payload),v)}if(Ql(w)||Pl(w))return b!==null?null:u(m,y,w,v,null);jd(m,w)}return null}function f(m,y,w,v,b){if(typeof v=="string"&&v!==""||typeof v=="number")return m=m.get(w)||null,a(y,m,""+v,b);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Od:return m=m.get(v.key===null?w:v.key)||null,l(y,m,v,b);case ga:return m=m.get(v.key===null?w:v.key)||null,c(y,m,v,b);case so:var C=v._init;return f(m,y,w,C(v._payload),b)}if(Ql(v)||Pl(v))return m=m.get(w)||null,u(y,m,v,b,null);jd(y,v)}return null}function p(m,y,w,v){for(var b=null,C=null,k=y,S=y=0,$=null;k!==null&&S<w.length;S++){k.index>S?($=k,k=null):$=k.sibling;var N=h(m,k,w[S],v);if(N===null){k===null&&(k=$);break}t&&k&&N.alternate===null&&e(m,k),y=o(N,y,S),C===null?b=N:C.sibling=N,C=N,k=$}if(S===w.length)return n(m,k),gt&&ni(m,S),b;if(k===null){for(;S<w.length;S++)k=d(m,w[S],v),k!==null&&(y=o(k,y,S),C===null?b=k:C.sibling=k,C=k);return gt&&ni(m,S),b}for(k=s(m,k);S<w.length;S++)$=f(k,m,S,w[S],v),$!==null&&(t&&$.alternate!==null&&k.delete($.key===null?S:$.key),y=o($,y,S),C===null?b=$:C.sibling=$,C=$);return t&&k.forEach(function(A){return e(m,A)}),gt&&ni(m,S),b}function g(m,y,w,v){var b=Pl(w);if(typeof b!="function")throw Error(te(150));if(w=b.call(w),w==null)throw Error(te(151));for(var C=b=null,k=y,S=y=0,$=null,N=w.next();k!==null&&!N.done;S++,N=w.next()){k.index>S?($=k,k=null):$=k.sibling;var A=h(m,k,N.value,v);if(A===null){k===null&&(k=$);break}t&&k&&A.alternate===null&&e(m,k),y=o(A,y,S),C===null?b=A:C.sibling=A,C=A,k=$}if(N.done)return n(m,k),gt&&ni(m,S),b;if(k===null){for(;!N.done;S++,N=w.next())N=d(m,N.value,v),N!==null&&(y=o(N,y,S),C===null?b=N:C.sibling=N,C=N);return gt&&ni(m,S),b}for(k=s(m,k);!N.done;S++,N=w.next())N=f(k,m,S,N.value,v),N!==null&&(t&&N.alternate!==null&&k.delete(N.key===null?S:N.key),y=o(N,y,S),C===null?b=N:C.sibling=N,C=N);return t&&k.forEach(function(M){return e(m,M)}),gt&&ni(m,S),b}function x(m,y,w,v){if(typeof w=="object"&&w!==null&&w.type===xa&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case Od:e:{for(var b=w.key,C=y;C!==null;){if(C.key===b){if(b=w.type,b===xa){if(C.tag===7){n(m,C.sibling),y=r(C,w.props.children),y.return=m,m=y;break e}}else if(C.elementType===b||typeof b=="object"&&b!==null&&b.$$typeof===so&&pb(b)===C.type){n(m,C.sibling),y=r(C,w.props),y.ref=Ul(m,C,w),y.return=m,m=y;break e}n(m,C);break}else e(m,C);C=C.sibling}w.type===xa?(y=xi(w.props.children,m.mode,v,w.key),y.return=m,m=y):(v=Sh(w.type,w.key,w.props,null,m.mode,v),v.ref=Ul(m,y,w),v.return=m,m=v)}return i(m);case ga:e:{for(C=w.key;y!==null;){if(y.key===C)if(y.tag===4&&y.stateNode.containerInfo===w.containerInfo&&y.stateNode.implementation===w.implementation){n(m,y.sibling),y=r(y,w.children||[]),y.return=m,m=y;break e}else{n(m,y);break}else e(m,y);y=y.sibling}y=pg(w,m.mode,v),y.return=m,m=y}return i(m);case so:return C=w._init,x(m,y,C(w._payload),v)}if(Ql(w))return p(m,y,w,v);if(Pl(w))return g(m,y,w,v);jd(m,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,y!==null&&y.tag===6?(n(m,y.sibling),y=r(y,w),y.return=m,m=y):(n(m,y),y=fg(w,m.mode,v),y.return=m,m=y),i(m)):n(m,y)}return x}var ja=xI(!0),yI=xI(!1),qh=Lo(null),Yh=null,Ia=null,sx=null;function rx(){sx=Ia=Yh=null}function ox(t){var e=qh.current;ft(qh),t._currentValue=e}function w0(t,e,n){for(;t!==null;){var s=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,s!==null&&(s.childLanes|=e)):s!==null&&(s.childLanes&e)!==e&&(s.childLanes|=e),t===n)break;t=t.return}}function Fa(t,e){Yh=t,sx=Ia=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Wn=!0),t.firstContext=null)}function Is(t){var e=t._currentValue;if(sx!==t)if(t={context:t,memoizedValue:e,next:null},Ia===null){if(Yh===null)throw Error(te(308));Ia=t,Yh.dependencies={lanes:0,firstContext:t}}else Ia=Ia.next=t;return e}var ui=null;function ix(t){ui===null?ui=[t]:ui.push(t)}function wI(t,e,n,s){var r=e.interleaved;return r===null?(n.next=n,ix(e)):(n.next=r.next,r.next=n),e.interleaved=n,Br(t,s)}function Br(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ro=!1;function ax(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Mr(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function wo(t,e,n){var s=t.updateQueue;if(s===null)return null;if(s=s.shared,Le&2){var r=s.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),s.pending=e,Br(t,n)}return r=s.interleaved,r===null?(e.next=e,ix(s)):(e.next=r.next,r.next=e),s.interleaved=e,Br(t,n)}function yh(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,j1(t,n)}}function mb(t,e){var n=t.updateQueue,s=t.alternate;if(s!==null&&(s=s.updateQueue,n===s)){var r=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?r=o=i:o=o.next=i,n=n.next}while(n!==null);o===null?r=o=e:o=o.next=e}else r=o=e;n={baseState:s.baseState,firstBaseUpdate:r,lastBaseUpdate:o,shared:s.shared,effects:s.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Qh(t,e,n,s){var r=t.updateQueue;ro=!1;var o=r.firstBaseUpdate,i=r.lastBaseUpdate,a=r.shared.pending;if(a!==null){r.shared.pending=null;var l=a,c=l.next;l.next=null,i===null?o=c:i.next=c,i=l;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==i&&(a===null?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(o!==null){var d=r.baseState;i=0,u=c=l=null,a=o;do{var h=a.lane,f=a.eventTime;if((s&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,g=a;switch(h=e,f=n,g.tag){case 1:if(p=g.payload,typeof p=="function"){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=g.payload,h=typeof p=="function"?p.call(f,d,h):p,h==null)break e;d=bt({},d,h);break e;case 2:ro=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=r.effects,h===null?r.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(c=u=f,l=d):u=u.next=f,i|=h;if(a=a.next,a===null){if(a=r.shared.pending,a===null)break;h=a,a=h.next,h.next=null,r.lastBaseUpdate=h,r.shared.pending=null}}while(!0);if(u===null&&(l=d),r.baseState=l,r.firstBaseUpdate=c,r.lastBaseUpdate=u,e=r.shared.interleaved,e!==null){r=e;do i|=r.lane,r=r.next;while(r!==e)}else o===null&&(r.shared.lanes=0);Ni|=i,t.lanes=i,t.memoizedState=d}}function gb(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var s=t[e],r=s.callback;if(r!==null){if(s.callback=null,s=n,typeof r!="function")throw Error(te(191,r));r.call(s)}}}var uu={},mr=Lo(uu),Mc=Lo(uu),Pc=Lo(uu);function di(t){if(t===uu)throw Error(te(174));return t}function lx(t,e){switch(ot(Pc,e),ot(Mc,t),ot(mr,uu),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Zg(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Zg(e,t)}ft(mr),ot(mr,e)}function Ka(){ft(mr),ft(Mc),ft(Pc)}function bI(t){di(Pc.current);var e=di(mr.current),n=Zg(e,t.type);e!==n&&(ot(Mc,t),ot(mr,n))}function cx(t){Mc.current===t&&(ft(mr),ft(Mc))}var wt=Lo(0);function Jh(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ag=[];function ux(){for(var t=0;t<ag.length;t++)ag[t]._workInProgressVersionPrimary=null;ag.length=0}var wh=Kr.ReactCurrentDispatcher,lg=Kr.ReactCurrentBatchConfig,$i=0,vt=null,Ht=null,Qt=null,Zh=!1,gc=!1,Lc=0,jF=0;function mn(){throw Error(te(321))}function dx(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Qs(t[n],e[n]))return!1;return!0}function hx(t,e,n,s,r,o){if($i=o,vt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,wh.current=t===null||t.memoizedState===null?YF:QF,t=n(s,r),gc){o=0;do{if(gc=!1,Lc=0,25<=o)throw Error(te(301));o+=1,Qt=Ht=null,e.updateQueue=null,wh.current=JF,t=n(s,r)}while(gc)}if(wh.current=ef,e=Ht!==null&&Ht.next!==null,$i=0,Qt=Ht=vt=null,Zh=!1,e)throw Error(te(300));return t}function fx(){var t=Lc!==0;return Lc=0,t}function rr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Qt===null?vt.memoizedState=Qt=t:Qt=Qt.next=t,Qt}function $s(){if(Ht===null){var t=vt.alternate;t=t!==null?t.memoizedState:null}else t=Ht.next;var e=Qt===null?vt.memoizedState:Qt.next;if(e!==null)Qt=e,Ht=t;else{if(t===null)throw Error(te(310));Ht=t,t={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},Qt===null?vt.memoizedState=Qt=t:Qt=Qt.next=t}return Qt}function Bc(t,e){return typeof e=="function"?e(t):e}function cg(t){var e=$s(),n=e.queue;if(n===null)throw Error(te(311));n.lastRenderedReducer=t;var s=Ht,r=s.baseQueue,o=n.pending;if(o!==null){if(r!==null){var i=r.next;r.next=o.next,o.next=i}s.baseQueue=r=o,n.pending=null}if(r!==null){o=r.next,s=s.baseState;var a=i=null,l=null,c=o;do{var u=c.lane;if(($i&u)===u)l!==null&&(l=l.next={lane:0,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null}),s=c.hasEagerState?c.eagerState:t(s,c.action);else{var d={lane:u,action:c.action,hasEagerState:c.hasEagerState,eagerState:c.eagerState,next:null};l===null?(a=l=d,i=s):l=l.next=d,vt.lanes|=u,Ni|=u}c=c.next}while(c!==null&&c!==o);l===null?i=s:l.next=a,Qs(s,e.memoizedState)||(Wn=!0),e.memoizedState=s,e.baseState=i,e.baseQueue=l,n.lastRenderedState=s}if(t=n.interleaved,t!==null){r=t;do o=r.lane,vt.lanes|=o,Ni|=o,r=r.next;while(r!==t)}else r===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function ug(t){var e=$s(),n=e.queue;if(n===null)throw Error(te(311));n.lastRenderedReducer=t;var s=n.dispatch,r=n.pending,o=e.memoizedState;if(r!==null){n.pending=null;var i=r=r.next;do o=t(o,i.action),i=i.next;while(i!==r);Qs(o,e.memoizedState)||(Wn=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,s]}function CI(){}function kI(t,e){var n=vt,s=$s(),r=e(),o=!Qs(s.memoizedState,r);if(o&&(s.memoizedState=r,Wn=!0),s=s.queue,px($I.bind(null,n,s,t),[t]),s.getSnapshot!==e||o||Qt!==null&&Qt.memoizedState.tag&1){if(n.flags|=2048,Vc(9,II.bind(null,n,s,r,e),void 0,null),en===null)throw Error(te(349));$i&30||SI(n,e,r)}return r}function SI(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=vt.updateQueue,e===null?(e={lastEffect:null,stores:null},vt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function II(t,e,n,s){e.value=n,e.getSnapshot=s,NI(e)&&TI(t)}function $I(t,e,n){return n(function(){NI(e)&&TI(t)})}function NI(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Qs(t,n)}catch{return!0}}function TI(t){var e=Br(t,1);e!==null&&js(e,t,1,-1)}function xb(t){var e=rr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bc,lastRenderedState:t},e.queue=t,t=t.dispatch=qF.bind(null,vt,t),[e.memoizedState,t]}function Vc(t,e,n,s){return t={tag:t,create:e,destroy:n,deps:s,next:null},e=vt.updateQueue,e===null?(e={lastEffect:null,stores:null},vt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(s=n.next,n.next=t,t.next=s,e.lastEffect=t)),t}function EI(){return $s().memoizedState}function vh(t,e,n,s){var r=rr();vt.flags|=t,r.memoizedState=Vc(1|e,n,void 0,s===void 0?null:s)}function Jf(t,e,n,s){var r=$s();s=s===void 0?null:s;var o=void 0;if(Ht!==null){var i=Ht.memoizedState;if(o=i.destroy,s!==null&&dx(s,i.deps)){r.memoizedState=Vc(e,n,o,s);return}}vt.flags|=t,r.memoizedState=Vc(1|e,n,o,s)}function yb(t,e){return vh(8390656,8,t,e)}function px(t,e){return Jf(2048,8,t,e)}function RI(t,e){return Jf(4,2,t,e)}function AI(t,e){return Jf(4,4,t,e)}function DI(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function _I(t,e,n){return n=n!=null?n.concat([t]):null,Jf(4,4,DI.bind(null,e,t),n)}function mx(){}function FI(t,e){var n=$s();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&dx(e,s[1])?s[0]:(n.memoizedState=[t,e],t)}function OI(t,e){var n=$s();e=e===void 0?null:e;var s=n.memoizedState;return s!==null&&e!==null&&dx(e,s[1])?s[0]:(t=t(),n.memoizedState=[t,e],t)}function zI(t,e,n){return $i&21?(Qs(n,e)||(n=VS(),vt.lanes|=n,Ni|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Wn=!0),t.memoizedState=n)}function KF(t,e){var n=Ye;Ye=n!==0&&4>n?n:4,t(!0);var s=lg.transition;lg.transition={};try{t(!1),e()}finally{Ye=n,lg.transition=s}}function MI(){return $s().memoizedState}function XF(t,e,n){var s=bo(t);if(n={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null},PI(t))LI(e,n);else if(n=wI(t,e,n,s),n!==null){var r=An();js(n,t,s,r),BI(n,e,s)}}function qF(t,e,n){var s=bo(t),r={lane:s,action:n,hasEagerState:!1,eagerState:null,next:null};if(PI(t))LI(e,r);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var i=e.lastRenderedState,a=o(i,n);if(r.hasEagerState=!0,r.eagerState=a,Qs(a,i)){var l=e.interleaved;l===null?(r.next=r,ix(e)):(r.next=l.next,l.next=r),e.interleaved=r;return}}catch{}finally{}n=wI(t,e,r,s),n!==null&&(r=An(),js(n,t,s,r),BI(n,e,s))}}function PI(t){var e=t.alternate;return t===vt||e!==null&&e===vt}function LI(t,e){gc=Zh=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function BI(t,e,n){if(n&4194240){var s=e.lanes;s&=t.pendingLanes,n|=s,e.lanes=n,j1(t,n)}}var ef={readContext:Is,useCallback:mn,useContext:mn,useEffect:mn,useImperativeHandle:mn,useInsertionEffect:mn,useLayoutEffect:mn,useMemo:mn,useReducer:mn,useRef:mn,useState:mn,useDebugValue:mn,useDeferredValue:mn,useTransition:mn,useMutableSource:mn,useSyncExternalStore:mn,useId:mn,unstable_isNewReconciler:!1},YF={readContext:Is,useCallback:function(t,e){return rr().memoizedState=[t,e===void 0?null:e],t},useContext:Is,useEffect:yb,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,vh(4194308,4,DI.bind(null,e,t),n)},useLayoutEffect:function(t,e){return vh(4194308,4,t,e)},useInsertionEffect:function(t,e){return vh(4,2,t,e)},useMemo:function(t,e){var n=rr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var s=rr();return e=n!==void 0?n(e):e,s.memoizedState=s.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},s.queue=t,t=t.dispatch=XF.bind(null,vt,t),[s.memoizedState,t]},useRef:function(t){var e=rr();return t={current:t},e.memoizedState=t},useState:xb,useDebugValue:mx,useDeferredValue:function(t){return rr().memoizedState=t},useTransition:function(){var t=xb(!1),e=t[0];return t=KF.bind(null,t[1]),rr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var s=vt,r=rr();if(gt){if(n===void 0)throw Error(te(407));n=n()}else{if(n=e(),en===null)throw Error(te(349));$i&30||SI(s,e,n)}r.memoizedState=n;var o={value:n,getSnapshot:e};return r.queue=o,yb($I.bind(null,s,o,t),[t]),s.flags|=2048,Vc(9,II.bind(null,s,o,n,e),void 0,null),n},useId:function(){var t=rr(),e=en.identifierPrefix;if(gt){var n=Or,s=Fr;n=(s&~(1<<32-Hs(s)-1)).toString(32)+n,e=":"+e+"R"+n,n=Lc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=jF++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},QF={readContext:Is,useCallback:FI,useContext:Is,useEffect:px,useImperativeHandle:_I,useInsertionEffect:RI,useLayoutEffect:AI,useMemo:OI,useReducer:cg,useRef:EI,useState:function(){return cg(Bc)},useDebugValue:mx,useDeferredValue:function(t){var e=$s();return zI(e,Ht.memoizedState,t)},useTransition:function(){var t=cg(Bc)[0],e=$s().memoizedState;return[t,e]},useMutableSource:CI,useSyncExternalStore:kI,useId:MI,unstable_isNewReconciler:!1},JF={readContext:Is,useCallback:FI,useContext:Is,useEffect:px,useImperativeHandle:_I,useInsertionEffect:RI,useLayoutEffect:AI,useMemo:OI,useReducer:ug,useRef:EI,useState:function(){return ug(Bc)},useDebugValue:mx,useDeferredValue:function(t){var e=$s();return Ht===null?e.memoizedState=t:zI(e,Ht.memoizedState,t)},useTransition:function(){var t=ug(Bc)[0],e=$s().memoizedState;return[t,e]},useMutableSource:CI,useSyncExternalStore:kI,useId:MI,unstable_isNewReconciler:!1};function Ps(t,e){if(t&&t.defaultProps){e=bt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function v0(t,e,n,s){e=t.memoizedState,n=n(s,e),n=n==null?e:bt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Zf={isMounted:function(t){return(t=t._reactInternals)?ji(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var s=An(),r=bo(t),o=Mr(s,r);o.payload=e,n!=null&&(o.callback=n),e=wo(t,o,r),e!==null&&(js(e,t,r,s),yh(e,t,r))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var s=An(),r=bo(t),o=Mr(s,r);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=wo(t,o,r),e!==null&&(js(e,t,r,s),yh(e,t,r))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=An(),s=bo(t),r=Mr(n,s);r.tag=2,e!=null&&(r.callback=e),e=wo(t,r,s),e!==null&&(js(e,t,s,n),yh(e,t,s))}};function wb(t,e,n,s,r,o,i){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(s,o,i):e.prototype&&e.prototype.isPureReactComponent?!_c(n,s)||!_c(r,o):!0}function VI(t,e,n){var s=!1,r=Ao,o=e.contextType;return typeof o=="object"&&o!==null?o=Is(o):(r=jn(e)?Si:kn.current,s=e.contextTypes,o=(s=s!=null)?Ga(t,r):Ao),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Zf,t.stateNode=e,e._reactInternals=t,s&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=r,t.__reactInternalMemoizedMaskedChildContext=o),e}function vb(t,e,n,s){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,s),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,s),e.state!==t&&Zf.enqueueReplaceState(e,e.state,null)}function b0(t,e,n,s){var r=t.stateNode;r.props=n,r.state=t.memoizedState,r.refs={},ax(t);var o=e.contextType;typeof o=="object"&&o!==null?r.context=Is(o):(o=jn(e)?Si:kn.current,r.context=Ga(t,o)),r.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(v0(t,e,o,n),r.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&Zf.enqueueReplaceState(r,r.state,null),Qh(t,n,r,s),r.state=t.memoizedState),typeof r.componentDidMount=="function"&&(t.flags|=4194308)}function Xa(t,e){try{var n="",s=e;do n+=$_(s),s=s.return;while(s);var r=n}catch(o){r=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:r,digest:null}}function dg(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function C0(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var ZF=typeof WeakMap=="function"?WeakMap:Map;function WI(t,e,n){n=Mr(-1,n),n.tag=3,n.payload={element:null};var s=e.value;return n.callback=function(){nf||(nf=!0,D0=s),C0(t,e)},n}function UI(t,e,n){n=Mr(-1,n),n.tag=3;var s=t.type.getDerivedStateFromError;if(typeof s=="function"){var r=e.value;n.payload=function(){return s(r)},n.callback=function(){C0(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){C0(t,e),typeof s!="function"&&(vo===null?vo=new Set([this]):vo.add(this));var i=e.stack;this.componentDidCatch(e.value,{componentStack:i!==null?i:""})}),n}function bb(t,e,n){var s=t.pingCache;if(s===null){s=t.pingCache=new ZF;var r=new Set;s.set(e,r)}else r=s.get(e),r===void 0&&(r=new Set,s.set(e,r));r.has(n)||(r.add(n),t=fO.bind(null,t,e,n),e.then(t,t))}function Cb(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function kb(t,e,n,s,r){return t.mode&1?(t.flags|=65536,t.lanes=r,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=Mr(-1,1),e.tag=2,wo(n,e,1))),n.lanes|=1),t)}var eO=Kr.ReactCurrentOwner,Wn=!1;function Nn(t,e,n,s){e.child=t===null?yI(e,null,n,s):ja(e,t.child,n,s)}function Sb(t,e,n,s,r){n=n.render;var o=e.ref;return Fa(e,r),s=hx(t,e,n,s,o,r),n=fx(),t!==null&&!Wn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Vr(t,e,r)):(gt&&n&&ex(e),e.flags|=1,Nn(t,e,s,r),e.child)}function Ib(t,e,n,s,r){if(t===null){var o=n.type;return typeof o=="function"&&!kx(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,GI(t,e,o,s,r)):(t=Sh(n.type,null,s,e,e.mode,r),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&r)){var i=o.memoizedProps;if(n=n.compare,n=n!==null?n:_c,n(i,s)&&t.ref===e.ref)return Vr(t,e,r)}return e.flags|=1,t=Co(o,s),t.ref=e.ref,t.return=e,e.child=t}function GI(t,e,n,s,r){if(t!==null){var o=t.memoizedProps;if(_c(o,s)&&t.ref===e.ref)if(Wn=!1,e.pendingProps=s=o,(t.lanes&r)!==0)t.flags&131072&&(Wn=!0);else return e.lanes=t.lanes,Vr(t,e,r)}return k0(t,e,n,s,r)}function HI(t,e,n){var s=e.pendingProps,r=s.children,o=t!==null?t.memoizedState:null;if(s.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ot(Na,Zn),Zn|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,ot(Na,Zn),Zn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},s=o!==null?o.baseLanes:n,ot(Na,Zn),Zn|=s}else o!==null?(s=o.baseLanes|n,e.memoizedState=null):s=n,ot(Na,Zn),Zn|=s;return Nn(t,e,r,n),e.child}function jI(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function k0(t,e,n,s,r){var o=jn(n)?Si:kn.current;return o=Ga(e,o),Fa(e,r),n=hx(t,e,n,s,o,r),s=fx(),t!==null&&!Wn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~r,Vr(t,e,r)):(gt&&s&&ex(e),e.flags|=1,Nn(t,e,n,r),e.child)}function $b(t,e,n,s,r){if(jn(n)){var o=!0;jh(e)}else o=!1;if(Fa(e,r),e.stateNode===null)bh(t,e),VI(e,n,s),b0(e,n,s,r),s=!0;else if(t===null){var i=e.stateNode,a=e.memoizedProps;i.props=a;var l=i.context,c=n.contextType;typeof c=="object"&&c!==null?c=Is(c):(c=jn(n)?Si:kn.current,c=Ga(e,c));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof i.getSnapshotBeforeUpdate=="function";d||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==s||l!==c)&&vb(e,i,s,c),ro=!1;var h=e.memoizedState;i.state=h,Qh(e,s,i,r),l=e.memoizedState,a!==s||h!==l||Hn.current||ro?(typeof u=="function"&&(v0(e,n,u,s),l=e.memoizedState),(a=ro||wb(e,n,a,s,h,l,c))?(d||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(e.flags|=4194308)):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=s,e.memoizedState=l),i.props=s,i.state=l,i.context=c,s=a):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),s=!1)}else{i=e.stateNode,vI(t,e),a=e.memoizedProps,c=e.type===e.elementType?a:Ps(e.type,a),i.props=c,d=e.pendingProps,h=i.context,l=n.contextType,typeof l=="object"&&l!==null?l=Is(l):(l=jn(n)?Si:kn.current,l=Ga(e,l));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==d||h!==l)&&vb(e,i,s,l),ro=!1,h=e.memoizedState,i.state=h,Qh(e,s,i,r);var p=e.memoizedState;a!==d||h!==p||Hn.current||ro?(typeof f=="function"&&(v0(e,n,f,s),p=e.memoizedState),(c=ro||wb(e,n,c,s,h,p,l)||!1)?(u||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(s,p,l),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(s,p,l)),typeof i.componentDidUpdate=="function"&&(e.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=s,e.memoizedState=p),i.props=s,i.state=p,i.context=l,s=c):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),s=!1)}return S0(t,e,n,s,o,r)}function S0(t,e,n,s,r,o){jI(t,e);var i=(e.flags&128)!==0;if(!s&&!i)return r&&db(e,n,!1),Vr(t,e,o);s=e.stateNode,eO.current=e;var a=i&&typeof n.getDerivedStateFromError!="function"?null:s.render();return e.flags|=1,t!==null&&i?(e.child=ja(e,t.child,null,o),e.child=ja(e,null,a,o)):Nn(t,e,a,o),e.memoizedState=s.state,r&&db(e,n,!0),e.child}function KI(t){var e=t.stateNode;e.pendingContext?ub(t,e.pendingContext,e.pendingContext!==e.context):e.context&&ub(t,e.context,!1),lx(t,e.containerInfo)}function Nb(t,e,n,s,r){return Ha(),nx(r),e.flags|=256,Nn(t,e,n,s),e.child}var I0={dehydrated:null,treeContext:null,retryLane:0};function $0(t){return{baseLanes:t,cachePool:null,transitions:null}}function XI(t,e,n){var s=e.pendingProps,r=wt.current,o=!1,i=(e.flags&128)!==0,a;if((a=i)||(a=t!==null&&t.memoizedState===null?!1:(r&2)!==0),a?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(r|=1),ot(wt,r&1),t===null)return y0(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(i=s.children,t=s.fallback,o?(s=e.mode,o=e.child,i={mode:"hidden",children:i},!(s&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=np(i,s,0,null),t=xi(t,s,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=$0(n),e.memoizedState=I0,t):gx(e,i));if(r=t.memoizedState,r!==null&&(a=r.dehydrated,a!==null))return tO(t,e,i,s,a,r,n);if(o){o=s.fallback,i=e.mode,r=t.child,a=r.sibling;var l={mode:"hidden",children:s.children};return!(i&1)&&e.child!==r?(s=e.child,s.childLanes=0,s.pendingProps=l,e.deletions=null):(s=Co(r,l),s.subtreeFlags=r.subtreeFlags&14680064),a!==null?o=Co(a,o):(o=xi(o,i,n,null),o.flags|=2),o.return=e,s.return=e,s.sibling=o,e.child=s,s=o,o=e.child,i=t.child.memoizedState,i=i===null?$0(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=t.childLanes&~n,e.memoizedState=I0,s}return o=t.child,t=o.sibling,s=Co(o,{mode:"visible",children:s.children}),!(e.mode&1)&&(s.lanes=n),s.return=e,s.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=s,e.memoizedState=null,s}function gx(t,e){return e=np({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Kd(t,e,n,s){return s!==null&&nx(s),ja(e,t.child,null,n),t=gx(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function tO(t,e,n,s,r,o,i){if(n)return e.flags&256?(e.flags&=-257,s=dg(Error(te(422))),Kd(t,e,i,s)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=s.fallback,r=e.mode,s=np({mode:"visible",children:s.children},r,0,null),o=xi(o,r,i,null),o.flags|=2,s.return=e,o.return=e,s.sibling=o,e.child=s,e.mode&1&&ja(e,t.child,null,i),e.child.memoizedState=$0(i),e.memoizedState=I0,o);if(!(e.mode&1))return Kd(t,e,i,null);if(r.data==="$!"){if(s=r.nextSibling&&r.nextSibling.dataset,s)var a=s.dgst;return s=a,o=Error(te(419)),s=dg(o,s,void 0),Kd(t,e,i,s)}if(a=(i&t.childLanes)!==0,Wn||a){if(s=en,s!==null){switch(i&-i){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(s.suspendedLanes|i)?0:r,r!==0&&r!==o.retryLane&&(o.retryLane=r,Br(t,r),js(s,t,r,-1))}return Cx(),s=dg(Error(te(421))),Kd(t,e,i,s)}return r.data==="$?"?(e.flags|=128,e.child=t.child,e=pO.bind(null,t),r._reactRetry=e,null):(t=o.treeContext,ts=yo(r.nextSibling),ss=e,gt=!0,Bs=null,t!==null&&(ms[gs++]=Fr,ms[gs++]=Or,ms[gs++]=Ii,Fr=t.id,Or=t.overflow,Ii=e),e=gx(e,s.children),e.flags|=4096,e)}function Tb(t,e,n){t.lanes|=e;var s=t.alternate;s!==null&&(s.lanes|=e),w0(t.return,e,n)}function hg(t,e,n,s,r){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:s,tail:n,tailMode:r}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=s,o.tail=n,o.tailMode=r)}function qI(t,e,n){var s=e.pendingProps,r=s.revealOrder,o=s.tail;if(Nn(t,e,s.children,n),s=wt.current,s&2)s=s&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Tb(t,n,e);else if(t.tag===19)Tb(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}s&=1}if(ot(wt,s),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(n=e.child,r=null;n!==null;)t=n.alternate,t!==null&&Jh(t)===null&&(r=n),n=n.sibling;n=r,n===null?(r=e.child,e.child=null):(r=n.sibling,n.sibling=null),hg(e,!1,r,n,o);break;case"backwards":for(n=null,r=e.child,e.child=null;r!==null;){if(t=r.alternate,t!==null&&Jh(t)===null){e.child=r;break}t=r.sibling,r.sibling=n,n=r,r=t}hg(e,!0,n,null,o);break;case"together":hg(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function bh(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Vr(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Ni|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(te(153));if(e.child!==null){for(t=e.child,n=Co(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Co(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function nO(t,e,n){switch(e.tag){case 3:KI(e),Ha();break;case 5:bI(e);break;case 1:jn(e.type)&&jh(e);break;case 4:lx(e,e.stateNode.containerInfo);break;case 10:var s=e.type._context,r=e.memoizedProps.value;ot(qh,s._currentValue),s._currentValue=r;break;case 13:if(s=e.memoizedState,s!==null)return s.dehydrated!==null?(ot(wt,wt.current&1),e.flags|=128,null):n&e.child.childLanes?XI(t,e,n):(ot(wt,wt.current&1),t=Vr(t,e,n),t!==null?t.sibling:null);ot(wt,wt.current&1);break;case 19:if(s=(n&e.childLanes)!==0,t.flags&128){if(s)return qI(t,e,n);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ot(wt,wt.current),s)break;return null;case 22:case 23:return e.lanes=0,HI(t,e,n)}return Vr(t,e,n)}var YI,N0,QI,JI;YI=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};N0=function(){};QI=function(t,e,n,s){var r=t.memoizedProps;if(r!==s){t=e.stateNode,di(mr.current);var o=null;switch(n){case"input":r=qg(t,r),s=qg(t,s),o=[];break;case"select":r=bt({},r,{value:void 0}),s=bt({},s,{value:void 0}),o=[];break;case"textarea":r=Jg(t,r),s=Jg(t,s),o=[];break;default:typeof r.onClick!="function"&&typeof s.onClick=="function"&&(t.onclick=Gh)}e0(n,s);var i;n=null;for(c in r)if(!s.hasOwnProperty(c)&&r.hasOwnProperty(c)&&r[c]!=null)if(c==="style"){var a=r[c];for(i in a)a.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else c!=="dangerouslySetInnerHTML"&&c!=="children"&&c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&($c.hasOwnProperty(c)?o||(o=[]):(o=o||[]).push(c,null));for(c in s){var l=s[c];if(a=r!=null?r[c]:void 0,s.hasOwnProperty(c)&&l!==a&&(l!=null||a!=null))if(c==="style")if(a){for(i in a)!a.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in l)l.hasOwnProperty(i)&&a[i]!==l[i]&&(n||(n={}),n[i]=l[i])}else n||(o||(o=[]),o.push(c,n)),n=l;else c==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(o=o||[]).push(c,l)):c==="children"?typeof l!="string"&&typeof l!="number"||(o=o||[]).push(c,""+l):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&($c.hasOwnProperty(c)?(l!=null&&c==="onScroll"&&ut("scroll",t),o||a===l||(o=[])):(o=o||[]).push(c,l))}n&&(o=o||[]).push("style",n);var c=o;(e.updateQueue=c)&&(e.flags|=4)}};JI=function(t,e,n,s){n!==s&&(e.flags|=4)};function Gl(t,e){if(!gt)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var s=null;n!==null;)n.alternate!==null&&(s=n),n=n.sibling;s===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:s.sibling=null}}function gn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,s=0;if(e)for(var r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags&14680064,s|=r.flags&14680064,r.return=t,r=r.sibling;else for(r=t.child;r!==null;)n|=r.lanes|r.childLanes,s|=r.subtreeFlags,s|=r.flags,r.return=t,r=r.sibling;return t.subtreeFlags|=s,t.childLanes=n,e}function sO(t,e,n){var s=e.pendingProps;switch(tx(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gn(e),null;case 1:return jn(e.type)&&Hh(),gn(e),null;case 3:return s=e.stateNode,Ka(),ft(Hn),ft(kn),ux(),s.pendingContext&&(s.context=s.pendingContext,s.pendingContext=null),(t===null||t.child===null)&&(Hd(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Bs!==null&&(O0(Bs),Bs=null))),N0(t,e),gn(e),null;case 5:cx(e);var r=di(Pc.current);if(n=e.type,t!==null&&e.stateNode!=null)QI(t,e,n,s,r),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!s){if(e.stateNode===null)throw Error(te(166));return gn(e),null}if(t=di(mr.current),Hd(e)){s=e.stateNode,n=e.type;var o=e.memoizedProps;switch(s[hr]=e,s[zc]=o,t=(e.mode&1)!==0,n){case"dialog":ut("cancel",s),ut("close",s);break;case"iframe":case"object":case"embed":ut("load",s);break;case"video":case"audio":for(r=0;r<Zl.length;r++)ut(Zl[r],s);break;case"source":ut("error",s);break;case"img":case"image":case"link":ut("error",s),ut("load",s);break;case"details":ut("toggle",s);break;case"input":Mv(s,o),ut("invalid",s);break;case"select":s._wrapperState={wasMultiple:!!o.multiple},ut("invalid",s);break;case"textarea":Lv(s,o),ut("invalid",s)}e0(n,o),r=null;for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];i==="children"?typeof a=="string"?s.textContent!==a&&(o.suppressHydrationWarning!==!0&&Gd(s.textContent,a,t),r=["children",a]):typeof a=="number"&&s.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&Gd(s.textContent,a,t),r=["children",""+a]):$c.hasOwnProperty(i)&&a!=null&&i==="onScroll"&&ut("scroll",s)}switch(n){case"input":zd(s),Pv(s,o,!0);break;case"textarea":zd(s),Bv(s);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(s.onclick=Gh)}s=r,e.updateQueue=s,s!==null&&(e.flags|=4)}else{i=r.nodeType===9?r:r.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=$S(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=i.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof s.is=="string"?t=i.createElement(n,{is:s.is}):(t=i.createElement(n),n==="select"&&(i=t,s.multiple?i.multiple=!0:s.size&&(i.size=s.size))):t=i.createElementNS(t,n),t[hr]=e,t[zc]=s,YI(t,e,!1,!1),e.stateNode=t;e:{switch(i=t0(n,s),n){case"dialog":ut("cancel",t),ut("close",t),r=s;break;case"iframe":case"object":case"embed":ut("load",t),r=s;break;case"video":case"audio":for(r=0;r<Zl.length;r++)ut(Zl[r],t);r=s;break;case"source":ut("error",t),r=s;break;case"img":case"image":case"link":ut("error",t),ut("load",t),r=s;break;case"details":ut("toggle",t),r=s;break;case"input":Mv(t,s),r=qg(t,s),ut("invalid",t);break;case"option":r=s;break;case"select":t._wrapperState={wasMultiple:!!s.multiple},r=bt({},s,{value:void 0}),ut("invalid",t);break;case"textarea":Lv(t,s),r=Jg(t,s),ut("invalid",t);break;default:r=s}e0(n,r),a=r;for(o in a)if(a.hasOwnProperty(o)){var l=a[o];o==="style"?ES(t,l):o==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&NS(t,l)):o==="children"?typeof l=="string"?(n!=="textarea"||l!=="")&&Nc(t,l):typeof l=="number"&&Nc(t,""+l):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&($c.hasOwnProperty(o)?l!=null&&o==="onScroll"&&ut("scroll",t):l!=null&&B1(t,o,l,i))}switch(n){case"input":zd(t),Pv(t,s,!1);break;case"textarea":zd(t),Bv(t);break;case"option":s.value!=null&&t.setAttribute("value",""+Ro(s.value));break;case"select":t.multiple=!!s.multiple,o=s.value,o!=null?Ra(t,!!s.multiple,o,!1):s.defaultValue!=null&&Ra(t,!!s.multiple,s.defaultValue,!0);break;default:typeof r.onClick=="function"&&(t.onclick=Gh)}switch(n){case"button":case"input":case"select":case"textarea":s=!!s.autoFocus;break e;case"img":s=!0;break e;default:s=!1}}s&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return gn(e),null;case 6:if(t&&e.stateNode!=null)JI(t,e,t.memoizedProps,s);else{if(typeof s!="string"&&e.stateNode===null)throw Error(te(166));if(n=di(Pc.current),di(mr.current),Hd(e)){if(s=e.stateNode,n=e.memoizedProps,s[hr]=e,(o=s.nodeValue!==n)&&(t=ss,t!==null))switch(t.tag){case 3:Gd(s.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Gd(s.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else s=(n.nodeType===9?n:n.ownerDocument).createTextNode(s),s[hr]=e,e.stateNode=s}return gn(e),null;case 13:if(ft(wt),s=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(gt&&ts!==null&&e.mode&1&&!(e.flags&128))gI(),Ha(),e.flags|=98560,o=!1;else if(o=Hd(e),s!==null&&s.dehydrated!==null){if(t===null){if(!o)throw Error(te(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(te(317));o[hr]=e}else Ha(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;gn(e),o=!1}else Bs!==null&&(O0(Bs),Bs=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(s=s!==null,s!==(t!==null&&t.memoizedState!==null)&&s&&(e.child.flags|=8192,e.mode&1&&(t===null||wt.current&1?Xt===0&&(Xt=3):Cx())),e.updateQueue!==null&&(e.flags|=4),gn(e),null);case 4:return Ka(),N0(t,e),t===null&&Fc(e.stateNode.containerInfo),gn(e),null;case 10:return ox(e.type._context),gn(e),null;case 17:return jn(e.type)&&Hh(),gn(e),null;case 19:if(ft(wt),o=e.memoizedState,o===null)return gn(e),null;if(s=(e.flags&128)!==0,i=o.rendering,i===null)if(s)Gl(o,!1);else{if(Xt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(i=Jh(t),i!==null){for(e.flags|=128,Gl(o,!1),s=i.updateQueue,s!==null&&(e.updateQueue=s,e.flags|=4),e.subtreeFlags=0,s=n,n=e.child;n!==null;)o=n,t=s,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,t=i.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return ot(wt,wt.current&1|2),e.child}t=t.sibling}o.tail!==null&&Et()>qa&&(e.flags|=128,s=!0,Gl(o,!1),e.lanes=4194304)}else{if(!s)if(t=Jh(i),t!==null){if(e.flags|=128,s=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Gl(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!gt)return gn(e),null}else 2*Et()-o.renderingStartTime>qa&&n!==1073741824&&(e.flags|=128,s=!0,Gl(o,!1),e.lanes=4194304);o.isBackwards?(i.sibling=e.child,e.child=i):(n=o.last,n!==null?n.sibling=i:e.child=i,o.last=i)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=Et(),e.sibling=null,n=wt.current,ot(wt,s?n&1|2:n&1),e):(gn(e),null);case 22:case 23:return bx(),s=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==s&&(e.flags|=8192),s&&e.mode&1?Zn&1073741824&&(gn(e),e.subtreeFlags&6&&(e.flags|=8192)):gn(e),null;case 24:return null;case 25:return null}throw Error(te(156,e.tag))}function rO(t,e){switch(tx(e),e.tag){case 1:return jn(e.type)&&Hh(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Ka(),ft(Hn),ft(kn),ux(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return cx(e),null;case 13:if(ft(wt),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(te(340));Ha()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return ft(wt),null;case 4:return Ka(),null;case 10:return ox(e.type._context),null;case 22:case 23:return bx(),null;case 24:return null;default:return null}}var Xd=!1,yn=!1,oO=typeof WeakSet=="function"?WeakSet:Set,de=null;function $a(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(s){Ct(t,e,s)}else n.current=null}function T0(t,e,n){try{n()}catch(s){Ct(t,e,s)}}var Eb=!1;function iO(t,e){if(d0=Vh,t=sI(),Z1(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var s=n.getSelection&&n.getSelection();if(s&&s.rangeCount!==0){n=s.anchorNode;var r=s.anchorOffset,o=s.focusNode;s=s.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var i=0,a=-1,l=-1,c=0,u=0,d=t,h=null;t:for(;;){for(var f;d!==n||r!==0&&d.nodeType!==3||(a=i+r),d!==o||s!==0&&d.nodeType!==3||(l=i+s),d.nodeType===3&&(i+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++c===r&&(a=i),h===o&&++u===s&&(l=i),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=a===-1||l===-1?null:{start:a,end:l}}else n=null}n=n||{start:0,end:0}}else n=null;for(h0={focusedElem:t,selectionRange:n},Vh=!1,de=e;de!==null;)if(e=de,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,de=t;else for(;de!==null;){e=de;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var g=p.memoizedProps,x=p.memoizedState,m=e.stateNode,y=m.getSnapshotBeforeUpdate(e.elementType===e.type?g:Ps(e.type,g),x);m.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(te(163))}}catch(v){Ct(e,e.return,v)}if(t=e.sibling,t!==null){t.return=e.return,de=t;break}de=e.return}return p=Eb,Eb=!1,p}function xc(t,e,n){var s=e.updateQueue;if(s=s!==null?s.lastEffect:null,s!==null){var r=s=s.next;do{if((r.tag&t)===t){var o=r.destroy;r.destroy=void 0,o!==void 0&&T0(e,n,o)}r=r.next}while(r!==s)}}function ep(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var s=n.create;n.destroy=s()}n=n.next}while(n!==e)}}function E0(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function ZI(t){var e=t.alternate;e!==null&&(t.alternate=null,ZI(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[hr],delete e[zc],delete e[m0],delete e[WF],delete e[UF])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function e$(t){return t.tag===5||t.tag===3||t.tag===4}function Rb(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||e$(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function R0(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=Gh));else if(s!==4&&(t=t.child,t!==null))for(R0(t,e,n),t=t.sibling;t!==null;)R0(t,e,n),t=t.sibling}function A0(t,e,n){var s=t.tag;if(s===5||s===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(s!==4&&(t=t.child,t!==null))for(A0(t,e,n),t=t.sibling;t!==null;)A0(t,e,n),t=t.sibling}var on=null,Ls=!1;function to(t,e,n){for(n=n.child;n!==null;)t$(t,e,n),n=n.sibling}function t$(t,e,n){if(pr&&typeof pr.onCommitFiberUnmount=="function")try{pr.onCommitFiberUnmount(jf,n)}catch{}switch(n.tag){case 5:yn||$a(n,e);case 6:var s=on,r=Ls;on=null,to(t,e,n),on=s,Ls=r,on!==null&&(Ls?(t=on,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):on.removeChild(n.stateNode));break;case 18:on!==null&&(Ls?(t=on,n=n.stateNode,t.nodeType===8?og(t.parentNode,n):t.nodeType===1&&og(t,n),Ac(t)):og(on,n.stateNode));break;case 4:s=on,r=Ls,on=n.stateNode.containerInfo,Ls=!0,to(t,e,n),on=s,Ls=r;break;case 0:case 11:case 14:case 15:if(!yn&&(s=n.updateQueue,s!==null&&(s=s.lastEffect,s!==null))){r=s=s.next;do{var o=r,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&T0(n,e,i),r=r.next}while(r!==s)}to(t,e,n);break;case 1:if(!yn&&($a(n,e),s=n.stateNode,typeof s.componentWillUnmount=="function"))try{s.props=n.memoizedProps,s.state=n.memoizedState,s.componentWillUnmount()}catch(a){Ct(n,e,a)}to(t,e,n);break;case 21:to(t,e,n);break;case 22:n.mode&1?(yn=(s=yn)||n.memoizedState!==null,to(t,e,n),yn=s):to(t,e,n);break;default:to(t,e,n)}}function Ab(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new oO),e.forEach(function(s){var r=mO.bind(null,t,s);n.has(s)||(n.add(s),s.then(r,r))})}}function Os(t,e){var n=e.deletions;if(n!==null)for(var s=0;s<n.length;s++){var r=n[s];try{var o=t,i=e,a=i;e:for(;a!==null;){switch(a.tag){case 5:on=a.stateNode,Ls=!1;break e;case 3:on=a.stateNode.containerInfo,Ls=!0;break e;case 4:on=a.stateNode.containerInfo,Ls=!0;break e}a=a.return}if(on===null)throw Error(te(160));t$(o,i,r),on=null,Ls=!1;var l=r.alternate;l!==null&&(l.return=null),r.return=null}catch(c){Ct(r,e,c)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)n$(e,t),e=e.sibling}function n$(t,e){var n=t.alternate,s=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Os(e,t),sr(t),s&4){try{xc(3,t,t.return),ep(3,t)}catch(g){Ct(t,t.return,g)}try{xc(5,t,t.return)}catch(g){Ct(t,t.return,g)}}break;case 1:Os(e,t),sr(t),s&512&&n!==null&&$a(n,n.return);break;case 5:if(Os(e,t),sr(t),s&512&&n!==null&&$a(n,n.return),t.flags&32){var r=t.stateNode;try{Nc(r,"")}catch(g){Ct(t,t.return,g)}}if(s&4&&(r=t.stateNode,r!=null)){var o=t.memoizedProps,i=n!==null?n.memoizedProps:o,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&SS(r,o),t0(a,i);var c=t0(a,o);for(i=0;i<l.length;i+=2){var u=l[i],d=l[i+1];u==="style"?ES(r,d):u==="dangerouslySetInnerHTML"?NS(r,d):u==="children"?Nc(r,d):B1(r,u,d,c)}switch(a){case"input":Yg(r,o);break;case"textarea":IS(r,o);break;case"select":var h=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?Ra(r,!!o.multiple,f,!1):h!==!!o.multiple&&(o.defaultValue!=null?Ra(r,!!o.multiple,o.defaultValue,!0):Ra(r,!!o.multiple,o.multiple?[]:"",!1))}r[zc]=o}catch(g){Ct(t,t.return,g)}}break;case 6:if(Os(e,t),sr(t),s&4){if(t.stateNode===null)throw Error(te(162));r=t.stateNode,o=t.memoizedProps;try{r.nodeValue=o}catch(g){Ct(t,t.return,g)}}break;case 3:if(Os(e,t),sr(t),s&4&&n!==null&&n.memoizedState.isDehydrated)try{Ac(e.containerInfo)}catch(g){Ct(t,t.return,g)}break;case 4:Os(e,t),sr(t);break;case 13:Os(e,t),sr(t),r=t.child,r.flags&8192&&(o=r.memoizedState!==null,r.stateNode.isHidden=o,!o||r.alternate!==null&&r.alternate.memoizedState!==null||(wx=Et())),s&4&&Ab(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(yn=(c=yn)||u,Os(e,t),yn=c):Os(e,t),sr(t),s&8192){if(c=t.memoizedState!==null,(t.stateNode.isHidden=c)&&!u&&t.mode&1)for(de=t,u=t.child;u!==null;){for(d=de=u;de!==null;){switch(h=de,f=h.child,h.tag){case 0:case 11:case 14:case 15:xc(4,h,h.return);break;case 1:$a(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){s=h,n=h.return;try{e=s,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(g){Ct(s,n,g)}}break;case 5:$a(h,h.return);break;case 22:if(h.memoizedState!==null){_b(d);continue}}f!==null?(f.return=h,de=f):_b(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{r=d.stateNode,c?(o=r.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=d.stateNode,l=d.memoizedProps.style,i=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=TS("display",i))}catch(g){Ct(t,t.return,g)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=c?"":d.memoizedProps}catch(g){Ct(t,t.return,g)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Os(e,t),sr(t),s&4&&Ab(t);break;case 21:break;default:Os(e,t),sr(t)}}function sr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(e$(n)){var s=n;break e}n=n.return}throw Error(te(160))}switch(s.tag){case 5:var r=s.stateNode;s.flags&32&&(Nc(r,""),s.flags&=-33);var o=Rb(t);A0(t,o,r);break;case 3:case 4:var i=s.stateNode.containerInfo,a=Rb(t);R0(t,a,i);break;default:throw Error(te(161))}}catch(l){Ct(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function aO(t,e,n){de=t,s$(t)}function s$(t,e,n){for(var s=(t.mode&1)!==0;de!==null;){var r=de,o=r.child;if(r.tag===22&&s){var i=r.memoizedState!==null||Xd;if(!i){var a=r.alternate,l=a!==null&&a.memoizedState!==null||yn;a=Xd;var c=yn;if(Xd=i,(yn=l)&&!c)for(de=r;de!==null;)i=de,l=i.child,i.tag===22&&i.memoizedState!==null?Fb(r):l!==null?(l.return=i,de=l):Fb(r);for(;o!==null;)de=o,s$(o),o=o.sibling;de=r,Xd=a,yn=c}Db(t)}else r.subtreeFlags&8772&&o!==null?(o.return=r,de=o):Db(t)}}function Db(t){for(;de!==null;){var e=de;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:yn||ep(5,e);break;case 1:var s=e.stateNode;if(e.flags&4&&!yn)if(n===null)s.componentDidMount();else{var r=e.elementType===e.type?n.memoizedProps:Ps(e.type,n.memoizedProps);s.componentDidUpdate(r,n.memoizedState,s.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&gb(e,o,s);break;case 3:var i=e.updateQueue;if(i!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}gb(e,i,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&n.focus();break;case"img":l.src&&(n.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var c=e.alternate;if(c!==null){var u=c.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Ac(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(te(163))}yn||e.flags&512&&E0(e)}catch(h){Ct(e,e.return,h)}}if(e===t){de=null;break}if(n=e.sibling,n!==null){n.return=e.return,de=n;break}de=e.return}}function _b(t){for(;de!==null;){var e=de;if(e===t){de=null;break}var n=e.sibling;if(n!==null){n.return=e.return,de=n;break}de=e.return}}function Fb(t){for(;de!==null;){var e=de;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{ep(4,e)}catch(l){Ct(e,n,l)}break;case 1:var s=e.stateNode;if(typeof s.componentDidMount=="function"){var r=e.return;try{s.componentDidMount()}catch(l){Ct(e,r,l)}}var o=e.return;try{E0(e)}catch(l){Ct(e,o,l)}break;case 5:var i=e.return;try{E0(e)}catch(l){Ct(e,i,l)}}}catch(l){Ct(e,e.return,l)}if(e===t){de=null;break}var a=e.sibling;if(a!==null){a.return=e.return,de=a;break}de=e.return}}var lO=Math.ceil,tf=Kr.ReactCurrentDispatcher,xx=Kr.ReactCurrentOwner,Ss=Kr.ReactCurrentBatchConfig,Le=0,en=null,zt=null,an=0,Zn=0,Na=Lo(0),Xt=0,Wc=null,Ni=0,tp=0,yx=0,yc=null,Bn=null,wx=0,qa=1/0,Er=null,nf=!1,D0=null,vo=null,qd=!1,co=null,sf=0,wc=0,_0=null,Ch=-1,kh=0;function An(){return Le&6?Et():Ch!==-1?Ch:Ch=Et()}function bo(t){return t.mode&1?Le&2&&an!==0?an&-an:HF.transition!==null?(kh===0&&(kh=VS()),kh):(t=Ye,t!==0||(t=window.event,t=t===void 0?16:XS(t.type)),t):1}function js(t,e,n,s){if(50<wc)throw wc=0,_0=null,Error(te(185));au(t,n,s),(!(Le&2)||t!==en)&&(t===en&&(!(Le&2)&&(tp|=n),Xt===4&&ao(t,an)),Kn(t,s),n===1&&Le===0&&!(e.mode&1)&&(qa=Et()+500,Qf&&Bo()))}function Kn(t,e){var n=t.callbackNode;H_(t,e);var s=Bh(t,t===en?an:0);if(s===0)n!==null&&Uv(n),t.callbackNode=null,t.callbackPriority=0;else if(e=s&-s,t.callbackPriority!==e){if(n!=null&&Uv(n),e===1)t.tag===0?GF(Ob.bind(null,t)):fI(Ob.bind(null,t)),BF(function(){!(Le&6)&&Bo()}),n=null;else{switch(WS(s)){case 1:n=H1;break;case 4:n=LS;break;case 16:n=Lh;break;case 536870912:n=BS;break;default:n=Lh}n=d$(n,r$.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function r$(t,e){if(Ch=-1,kh=0,Le&6)throw Error(te(327));var n=t.callbackNode;if(Oa()&&t.callbackNode!==n)return null;var s=Bh(t,t===en?an:0);if(s===0)return null;if(s&30||s&t.expiredLanes||e)e=rf(t,s);else{e=s;var r=Le;Le|=2;var o=i$();(en!==t||an!==e)&&(Er=null,qa=Et()+500,gi(t,e));do try{dO();break}catch(a){o$(t,a)}while(!0);rx(),tf.current=o,Le=r,zt!==null?e=0:(en=null,an=0,e=Xt)}if(e!==0){if(e===2&&(r=i0(t),r!==0&&(s=r,e=F0(t,r))),e===1)throw n=Wc,gi(t,0),ao(t,s),Kn(t,Et()),n;if(e===6)ao(t,s);else{if(r=t.current.alternate,!(s&30)&&!cO(r)&&(e=rf(t,s),e===2&&(o=i0(t),o!==0&&(s=o,e=F0(t,o))),e===1))throw n=Wc,gi(t,0),ao(t,s),Kn(t,Et()),n;switch(t.finishedWork=r,t.finishedLanes=s,e){case 0:case 1:throw Error(te(345));case 2:si(t,Bn,Er);break;case 3:if(ao(t,s),(s&130023424)===s&&(e=wx+500-Et(),10<e)){if(Bh(t,0)!==0)break;if(r=t.suspendedLanes,(r&s)!==s){An(),t.pingedLanes|=t.suspendedLanes&r;break}t.timeoutHandle=p0(si.bind(null,t,Bn,Er),e);break}si(t,Bn,Er);break;case 4:if(ao(t,s),(s&4194240)===s)break;for(e=t.eventTimes,r=-1;0<s;){var i=31-Hs(s);o=1<<i,i=e[i],i>r&&(r=i),s&=~o}if(s=r,s=Et()-s,s=(120>s?120:480>s?480:1080>s?1080:1920>s?1920:3e3>s?3e3:4320>s?4320:1960*lO(s/1960))-s,10<s){t.timeoutHandle=p0(si.bind(null,t,Bn,Er),s);break}si(t,Bn,Er);break;case 5:si(t,Bn,Er);break;default:throw Error(te(329))}}}return Kn(t,Et()),t.callbackNode===n?r$.bind(null,t):null}function F0(t,e){var n=yc;return t.current.memoizedState.isDehydrated&&(gi(t,e).flags|=256),t=rf(t,e),t!==2&&(e=Bn,Bn=n,e!==null&&O0(e)),t}function O0(t){Bn===null?Bn=t:Bn.push.apply(Bn,t)}function cO(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var s=0;s<n.length;s++){var r=n[s],o=r.getSnapshot;r=r.value;try{if(!Qs(o(),r))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function ao(t,e){for(e&=~yx,e&=~tp,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Hs(e),s=1<<n;t[n]=-1,e&=~s}}function Ob(t){if(Le&6)throw Error(te(327));Oa();var e=Bh(t,0);if(!(e&1))return Kn(t,Et()),null;var n=rf(t,e);if(t.tag!==0&&n===2){var s=i0(t);s!==0&&(e=s,n=F0(t,s))}if(n===1)throw n=Wc,gi(t,0),ao(t,e),Kn(t,Et()),n;if(n===6)throw Error(te(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,si(t,Bn,Er),Kn(t,Et()),null}function vx(t,e){var n=Le;Le|=1;try{return t(e)}finally{Le=n,Le===0&&(qa=Et()+500,Qf&&Bo())}}function Ti(t){co!==null&&co.tag===0&&!(Le&6)&&Oa();var e=Le;Le|=1;var n=Ss.transition,s=Ye;try{if(Ss.transition=null,Ye=1,t)return t()}finally{Ye=s,Ss.transition=n,Le=e,!(Le&6)&&Bo()}}function bx(){Zn=Na.current,ft(Na)}function gi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,LF(n)),zt!==null)for(n=zt.return;n!==null;){var s=n;switch(tx(s),s.tag){case 1:s=s.type.childContextTypes,s!=null&&Hh();break;case 3:Ka(),ft(Hn),ft(kn),ux();break;case 5:cx(s);break;case 4:Ka();break;case 13:ft(wt);break;case 19:ft(wt);break;case 10:ox(s.type._context);break;case 22:case 23:bx()}n=n.return}if(en=t,zt=t=Co(t.current,null),an=Zn=e,Xt=0,Wc=null,yx=tp=Ni=0,Bn=yc=null,ui!==null){for(e=0;e<ui.length;e++)if(n=ui[e],s=n.interleaved,s!==null){n.interleaved=null;var r=s.next,o=n.pending;if(o!==null){var i=o.next;o.next=r,s.next=i}n.pending=s}ui=null}return t}function o$(t,e){do{var n=zt;try{if(rx(),wh.current=ef,Zh){for(var s=vt.memoizedState;s!==null;){var r=s.queue;r!==null&&(r.pending=null),s=s.next}Zh=!1}if($i=0,Qt=Ht=vt=null,gc=!1,Lc=0,xx.current=null,n===null||n.return===null){Xt=1,Wc=e,zt=null;break}e:{var o=t,i=n.return,a=n,l=e;if(e=an,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var c=l,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=Cb(i);if(f!==null){f.flags&=-257,kb(f,i,a,o,e),f.mode&1&&bb(o,c,e),e=f,l=c;var p=e.updateQueue;if(p===null){var g=new Set;g.add(l),e.updateQueue=g}else p.add(l);break e}else{if(!(e&1)){bb(o,c,e),Cx();break e}l=Error(te(426))}}else if(gt&&a.mode&1){var x=Cb(i);if(x!==null){!(x.flags&65536)&&(x.flags|=256),kb(x,i,a,o,e),nx(Xa(l,a));break e}}o=l=Xa(l,a),Xt!==4&&(Xt=2),yc===null?yc=[o]:yc.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var m=WI(o,l,e);mb(o,m);break e;case 1:a=l;var y=o.type,w=o.stateNode;if(!(o.flags&128)&&(typeof y.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(vo===null||!vo.has(w)))){o.flags|=65536,e&=-e,o.lanes|=e;var v=UI(o,a,e);mb(o,v);break e}}o=o.return}while(o!==null)}l$(n)}catch(b){e=b,zt===n&&n!==null&&(zt=n=n.return);continue}break}while(!0)}function i$(){var t=tf.current;return tf.current=ef,t===null?ef:t}function Cx(){(Xt===0||Xt===3||Xt===2)&&(Xt=4),en===null||!(Ni&268435455)&&!(tp&268435455)||ao(en,an)}function rf(t,e){var n=Le;Le|=2;var s=i$();(en!==t||an!==e)&&(Er=null,gi(t,e));do try{uO();break}catch(r){o$(t,r)}while(!0);if(rx(),Le=n,tf.current=s,zt!==null)throw Error(te(261));return en=null,an=0,Xt}function uO(){for(;zt!==null;)a$(zt)}function dO(){for(;zt!==null&&!z_();)a$(zt)}function a$(t){var e=u$(t.alternate,t,Zn);t.memoizedProps=t.pendingProps,e===null?l$(t):zt=e,xx.current=null}function l$(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=rO(n,e),n!==null){n.flags&=32767,zt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Xt=6,zt=null;return}}else if(n=sO(n,e,Zn),n!==null){zt=n;return}if(e=e.sibling,e!==null){zt=e;return}zt=e=t}while(e!==null);Xt===0&&(Xt=5)}function si(t,e,n){var s=Ye,r=Ss.transition;try{Ss.transition=null,Ye=1,hO(t,e,n,s)}finally{Ss.transition=r,Ye=s}return null}function hO(t,e,n,s){do Oa();while(co!==null);if(Le&6)throw Error(te(327));n=t.finishedWork;var r=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(te(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(j_(t,o),t===en&&(zt=en=null,an=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||qd||(qd=!0,d$(Lh,function(){return Oa(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=Ss.transition,Ss.transition=null;var i=Ye;Ye=1;var a=Le;Le|=4,xx.current=null,iO(t,n),n$(n,t),DF(h0),Vh=!!d0,h0=d0=null,t.current=n,aO(n),M_(),Le=a,Ye=i,Ss.transition=o}else t.current=n;if(qd&&(qd=!1,co=t,sf=r),o=t.pendingLanes,o===0&&(vo=null),B_(n.stateNode),Kn(t,Et()),e!==null)for(s=t.onRecoverableError,n=0;n<e.length;n++)r=e[n],s(r.value,{componentStack:r.stack,digest:r.digest});if(nf)throw nf=!1,t=D0,D0=null,t;return sf&1&&t.tag!==0&&Oa(),o=t.pendingLanes,o&1?t===_0?wc++:(wc=0,_0=t):wc=0,Bo(),null}function Oa(){if(co!==null){var t=WS(sf),e=Ss.transition,n=Ye;try{if(Ss.transition=null,Ye=16>t?16:t,co===null)var s=!1;else{if(t=co,co=null,sf=0,Le&6)throw Error(te(331));var r=Le;for(Le|=4,de=t.current;de!==null;){var o=de,i=o.child;if(de.flags&16){var a=o.deletions;if(a!==null){for(var l=0;l<a.length;l++){var c=a[l];for(de=c;de!==null;){var u=de;switch(u.tag){case 0:case 11:case 15:xc(8,u,o)}var d=u.child;if(d!==null)d.return=u,de=d;else for(;de!==null;){u=de;var h=u.sibling,f=u.return;if(ZI(u),u===c){de=null;break}if(h!==null){h.return=f,de=h;break}de=f}}}var p=o.alternate;if(p!==null){var g=p.child;if(g!==null){p.child=null;do{var x=g.sibling;g.sibling=null,g=x}while(g!==null)}}de=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,de=i;else e:for(;de!==null;){if(o=de,o.flags&2048)switch(o.tag){case 0:case 11:case 15:xc(9,o,o.return)}var m=o.sibling;if(m!==null){m.return=o.return,de=m;break e}de=o.return}}var y=t.current;for(de=y;de!==null;){i=de;var w=i.child;if(i.subtreeFlags&2064&&w!==null)w.return=i,de=w;else e:for(i=y;de!==null;){if(a=de,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:ep(9,a)}}catch(b){Ct(a,a.return,b)}if(a===i){de=null;break e}var v=a.sibling;if(v!==null){v.return=a.return,de=v;break e}de=a.return}}if(Le=r,Bo(),pr&&typeof pr.onPostCommitFiberRoot=="function")try{pr.onPostCommitFiberRoot(jf,t)}catch{}s=!0}return s}finally{Ye=n,Ss.transition=e}}return!1}function zb(t,e,n){e=Xa(n,e),e=WI(t,e,1),t=wo(t,e,1),e=An(),t!==null&&(au(t,1,e),Kn(t,e))}function Ct(t,e,n){if(t.tag===3)zb(t,t,n);else for(;e!==null;){if(e.tag===3){zb(e,t,n);break}else if(e.tag===1){var s=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof s.componentDidCatch=="function"&&(vo===null||!vo.has(s))){t=Xa(n,t),t=UI(e,t,1),e=wo(e,t,1),t=An(),e!==null&&(au(e,1,t),Kn(e,t));break}}e=e.return}}function fO(t,e,n){var s=t.pingCache;s!==null&&s.delete(e),e=An(),t.pingedLanes|=t.suspendedLanes&n,en===t&&(an&n)===n&&(Xt===4||Xt===3&&(an&130023424)===an&&500>Et()-wx?gi(t,0):yx|=n),Kn(t,e)}function c$(t,e){e===0&&(t.mode&1?(e=Ld,Ld<<=1,!(Ld&130023424)&&(Ld=4194304)):e=1);var n=An();t=Br(t,e),t!==null&&(au(t,e,n),Kn(t,n))}function pO(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),c$(t,n)}function mO(t,e){var n=0;switch(t.tag){case 13:var s=t.stateNode,r=t.memoizedState;r!==null&&(n=r.retryLane);break;case 19:s=t.stateNode;break;default:throw Error(te(314))}s!==null&&s.delete(e),c$(t,n)}var u$;u$=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Hn.current)Wn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Wn=!1,nO(t,e,n);Wn=!!(t.flags&131072)}else Wn=!1,gt&&e.flags&1048576&&pI(e,Xh,e.index);switch(e.lanes=0,e.tag){case 2:var s=e.type;bh(t,e),t=e.pendingProps;var r=Ga(e,kn.current);Fa(e,n),r=hx(null,e,s,t,r,n);var o=fx();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,jn(s)?(o=!0,jh(e)):o=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,ax(e),r.updater=Zf,e.stateNode=r,r._reactInternals=e,b0(e,s,t,n),e=S0(null,e,s,!0,o,n)):(e.tag=0,gt&&o&&ex(e),Nn(null,e,r,n),e=e.child),e;case 16:s=e.elementType;e:{switch(bh(t,e),t=e.pendingProps,r=s._init,s=r(s._payload),e.type=s,r=e.tag=xO(s),t=Ps(s,t),r){case 0:e=k0(null,e,s,t,n);break e;case 1:e=$b(null,e,s,t,n);break e;case 11:e=Sb(null,e,s,t,n);break e;case 14:e=Ib(null,e,s,Ps(s.type,t),n);break e}throw Error(te(306,s,""))}return e;case 0:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ps(s,r),k0(t,e,s,r,n);case 1:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ps(s,r),$b(t,e,s,r,n);case 3:e:{if(KI(e),t===null)throw Error(te(387));s=e.pendingProps,o=e.memoizedState,r=o.element,vI(t,e),Qh(e,s,null,n);var i=e.memoizedState;if(s=i.element,o.isDehydrated)if(o={element:s,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){r=Xa(Error(te(423)),e),e=Nb(t,e,s,n,r);break e}else if(s!==r){r=Xa(Error(te(424)),e),e=Nb(t,e,s,n,r);break e}else for(ts=yo(e.stateNode.containerInfo.firstChild),ss=e,gt=!0,Bs=null,n=yI(e,null,s,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Ha(),s===r){e=Vr(t,e,n);break e}Nn(t,e,s,n)}e=e.child}return e;case 5:return bI(e),t===null&&y0(e),s=e.type,r=e.pendingProps,o=t!==null?t.memoizedProps:null,i=r.children,f0(s,r)?i=null:o!==null&&f0(s,o)&&(e.flags|=32),jI(t,e),Nn(t,e,i,n),e.child;case 6:return t===null&&y0(e),null;case 13:return XI(t,e,n);case 4:return lx(e,e.stateNode.containerInfo),s=e.pendingProps,t===null?e.child=ja(e,null,s,n):Nn(t,e,s,n),e.child;case 11:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ps(s,r),Sb(t,e,s,r,n);case 7:return Nn(t,e,e.pendingProps,n),e.child;case 8:return Nn(t,e,e.pendingProps.children,n),e.child;case 12:return Nn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(s=e.type._context,r=e.pendingProps,o=e.memoizedProps,i=r.value,ot(qh,s._currentValue),s._currentValue=i,o!==null)if(Qs(o.value,i)){if(o.children===r.children&&!Hn.current){e=Vr(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){i=o.child;for(var l=a.firstContext;l!==null;){if(l.context===s){if(o.tag===1){l=Mr(-1,n&-n),l.tag=2;var c=o.updateQueue;if(c!==null){c=c.shared;var u=c.pending;u===null?l.next=l:(l.next=u.next,u.next=l),c.pending=l}}o.lanes|=n,l=o.alternate,l!==null&&(l.lanes|=n),w0(o.return,n,e),a.lanes|=n;break}l=l.next}}else if(o.tag===10)i=o.type===e.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error(te(341));i.lanes|=n,a=i.alternate,a!==null&&(a.lanes|=n),w0(i,n,e),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===e){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}Nn(t,e,r.children,n),e=e.child}return e;case 9:return r=e.type,s=e.pendingProps.children,Fa(e,n),r=Is(r),s=s(r),e.flags|=1,Nn(t,e,s,n),e.child;case 14:return s=e.type,r=Ps(s,e.pendingProps),r=Ps(s.type,r),Ib(t,e,s,r,n);case 15:return GI(t,e,e.type,e.pendingProps,n);case 17:return s=e.type,r=e.pendingProps,r=e.elementType===s?r:Ps(s,r),bh(t,e),e.tag=1,jn(s)?(t=!0,jh(e)):t=!1,Fa(e,n),VI(e,s,r),b0(e,s,r,n),S0(null,e,s,!0,t,n);case 19:return qI(t,e,n);case 22:return HI(t,e,n)}throw Error(te(156,e.tag))};function d$(t,e){return PS(t,e)}function gO(t,e,n,s){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=s,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ys(t,e,n,s){return new gO(t,e,n,s)}function kx(t){return t=t.prototype,!(!t||!t.isReactComponent)}function xO(t){if(typeof t=="function")return kx(t)?1:0;if(t!=null){if(t=t.$$typeof,t===W1)return 11;if(t===U1)return 14}return 2}function Co(t,e){var n=t.alternate;return n===null?(n=ys(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Sh(t,e,n,s,r,o){var i=2;if(s=t,typeof t=="function")kx(t)&&(i=1);else if(typeof t=="string")i=5;else e:switch(t){case xa:return xi(n.children,r,o,e);case V1:i=8,r|=8;break;case Hg:return t=ys(12,n,e,r|2),t.elementType=Hg,t.lanes=o,t;case jg:return t=ys(13,n,e,r),t.elementType=jg,t.lanes=o,t;case Kg:return t=ys(19,n,e,r),t.elementType=Kg,t.lanes=o,t;case bS:return np(n,r,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case wS:i=10;break e;case vS:i=9;break e;case W1:i=11;break e;case U1:i=14;break e;case so:i=16,s=null;break e}throw Error(te(130,t==null?t:typeof t,""))}return e=ys(i,n,e,r),e.elementType=t,e.type=s,e.lanes=o,e}function xi(t,e,n,s){return t=ys(7,t,s,e),t.lanes=n,t}function np(t,e,n,s){return t=ys(22,t,s,e),t.elementType=bS,t.lanes=n,t.stateNode={isHidden:!1},t}function fg(t,e,n){return t=ys(6,t,null,e),t.lanes=n,t}function pg(t,e,n){return e=ys(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function yO(t,e,n,s,r){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Xm(0),this.expirationTimes=Xm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xm(0),this.identifierPrefix=s,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function Sx(t,e,n,s,r,o,i,a,l){return t=new yO(t,e,n,a,l),e===1?(e=1,o===!0&&(e|=8)):e=0,o=ys(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:s,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},ax(o),t}function wO(t,e,n){var s=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ga,key:s==null?null:""+s,children:t,containerInfo:e,implementation:n}}function h$(t){if(!t)return Ao;t=t._reactInternals;e:{if(ji(t)!==t||t.tag!==1)throw Error(te(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(jn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(te(171))}if(t.tag===1){var n=t.type;if(jn(n))return hI(t,n,e)}return e}function f$(t,e,n,s,r,o,i,a,l){return t=Sx(n,s,!0,t,r,o,i,a,l),t.context=h$(null),n=t.current,s=An(),r=bo(n),o=Mr(s,r),o.callback=e??null,wo(n,o,r),t.current.lanes=r,au(t,r,s),Kn(t,s),t}function sp(t,e,n,s){var r=e.current,o=An(),i=bo(r);return n=h$(n),e.context===null?e.context=n:e.pendingContext=n,e=Mr(o,i),e.payload={element:t},s=s===void 0?null:s,s!==null&&(e.callback=s),t=wo(r,e,i),t!==null&&(js(t,r,i,o),yh(t,r,i)),i}function of(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function Mb(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Ix(t,e){Mb(t,e),(t=t.alternate)&&Mb(t,e)}function vO(){return null}var p$=typeof reportError=="function"?reportError:function(t){console.error(t)};function $x(t){this._internalRoot=t}rp.prototype.render=$x.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(te(409));sp(t,e,null,null)};rp.prototype.unmount=$x.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Ti(function(){sp(null,t,null,null)}),e[Lr]=null}};function rp(t){this._internalRoot=t}rp.prototype.unstable_scheduleHydration=function(t){if(t){var e=HS();t={blockedOn:null,target:t,priority:e};for(var n=0;n<io.length&&e!==0&&e<io[n].priority;n++);io.splice(n,0,t),n===0&&KS(t)}};function Nx(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function op(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Pb(){}function bO(t,e,n,s,r){if(r){if(typeof s=="function"){var o=s;s=function(){var c=of(i);o.call(c)}}var i=f$(e,s,t,0,null,!1,!1,"",Pb);return t._reactRootContainer=i,t[Lr]=i.current,Fc(t.nodeType===8?t.parentNode:t),Ti(),i}for(;r=t.lastChild;)t.removeChild(r);if(typeof s=="function"){var a=s;s=function(){var c=of(l);a.call(c)}}var l=Sx(t,0,!1,null,null,!1,!1,"",Pb);return t._reactRootContainer=l,t[Lr]=l.current,Fc(t.nodeType===8?t.parentNode:t),Ti(function(){sp(e,l,n,s)}),l}function ip(t,e,n,s,r){var o=n._reactRootContainer;if(o){var i=o;if(typeof r=="function"){var a=r;r=function(){var l=of(i);a.call(l)}}sp(e,i,t,r)}else i=bO(n,e,t,r,s);return of(i)}US=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=Jl(e.pendingLanes);n!==0&&(j1(e,n|1),Kn(e,Et()),!(Le&6)&&(qa=Et()+500,Bo()))}break;case 13:Ti(function(){var s=Br(t,1);if(s!==null){var r=An();js(s,t,1,r)}}),Ix(t,1)}};K1=function(t){if(t.tag===13){var e=Br(t,134217728);if(e!==null){var n=An();js(e,t,134217728,n)}Ix(t,134217728)}};GS=function(t){if(t.tag===13){var e=bo(t),n=Br(t,e);if(n!==null){var s=An();js(n,t,e,s)}Ix(t,e)}};HS=function(){return Ye};jS=function(t,e){var n=Ye;try{return Ye=t,e()}finally{Ye=n}};s0=function(t,e,n){switch(e){case"input":if(Yg(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var s=n[e];if(s!==t&&s.form===t.form){var r=Yf(s);if(!r)throw Error(te(90));kS(s),Yg(s,r)}}}break;case"textarea":IS(t,n);break;case"select":e=n.value,e!=null&&Ra(t,!!n.multiple,e,!1)}};DS=vx;_S=Ti;var CO={usingClientEntryPoint:!1,Events:[cu,ba,Yf,RS,AS,vx]},Hl={findFiberByHostInstance:ci,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kO={bundleType:Hl.bundleType,version:Hl.version,rendererPackageName:Hl.rendererPackageName,rendererConfig:Hl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Kr.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=zS(t),t===null?null:t.stateNode},findFiberByHostInstance:Hl.findFiberByHostInstance||vO,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Yd=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Yd.isDisabled&&Yd.supportsFiber)try{jf=Yd.inject(kO),pr=Yd}catch{}}ls.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=CO;ls.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Nx(e))throw Error(te(200));return wO(t,e,null,n)};ls.createRoot=function(t,e){if(!Nx(t))throw Error(te(299));var n=!1,s="",r=p$;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(s=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=Sx(t,1,!1,null,null,n,!1,s,r),t[Lr]=e.current,Fc(t.nodeType===8?t.parentNode:t),new $x(e)};ls.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(te(188)):(t=Object.keys(t).join(","),Error(te(268,t)));return t=zS(e),t=t===null?null:t.stateNode,t};ls.flushSync=function(t){return Ti(t)};ls.hydrate=function(t,e,n){if(!op(e))throw Error(te(200));return ip(null,t,e,!0,n)};ls.hydrateRoot=function(t,e,n){if(!Nx(t))throw Error(te(405));var s=n!=null&&n.hydratedSources||null,r=!1,o="",i=p$;if(n!=null&&(n.unstable_strictMode===!0&&(r=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),e=f$(e,null,t,1,n??null,r,!1,o,i),t[Lr]=e.current,Fc(t),s)for(t=0;t<s.length;t++)n=s[t],r=n._getVersion,r=r(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,r]:e.mutableSourceEagerHydrationData.push(n,r);return new rp(e)};ls.render=function(t,e,n){if(!op(e))throw Error(te(200));return ip(null,t,e,!1,n)};ls.unmountComponentAtNode=function(t){if(!op(t))throw Error(te(40));return t._reactRootContainer?(Ti(function(){ip(null,null,t,!1,function(){t._reactRootContainer=null,t[Lr]=null})}),!0):!1};ls.unstable_batchedUpdates=vx;ls.unstable_renderSubtreeIntoContainer=function(t,e,n,s){if(!op(n))throw Error(te(200));if(t==null||t._reactInternals===void 0)throw Error(te(38));return ip(t,e,n,!1,s)};ls.version="18.3.1-next-f1338f8080-20240426";function m$(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(m$)}catch(t){console.error(t)}}m$(),mS.exports=ls;var SO=mS.exports,Lb=SO;Ug.createRoot=Lb.createRoot,Ug.hydrateRoot=Lb.hydrateRoot;var bn=function(){return bn=Object.assign||function(e){for(var n,s=1,r=arguments.length;s<r;s++){n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},bn.apply(this,arguments)};function Uc(t,e,n){if(n||arguments.length===2)for(var s=0,r=e.length,o;s<r;s++)(o||!(s in e))&&(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return t.concat(o||Array.prototype.slice.call(e))}var dt="-ms-",vc="-moz-",je="-webkit-",g$="comm",ap="rule",Tx="decl",IO="@import",x$="@keyframes",$O="@layer",y$=Math.abs,Ex=String.fromCharCode,z0=Object.assign;function NO(t,e){return Jt(t,0)^45?(((e<<2^Jt(t,0))<<2^Jt(t,1))<<2^Jt(t,2))<<2^Jt(t,3):0}function w$(t){return t.trim()}function Rr(t,e){return(t=e.exec(t))?t[0]:t}function Ee(t,e,n){return t.replace(e,n)}function Ih(t,e,n){return t.indexOf(e,n)}function Jt(t,e){return t.charCodeAt(e)|0}function Ya(t,e,n){return t.slice(e,n)}function lr(t){return t.length}function v$(t){return t.length}function ec(t,e){return e.push(t),t}function TO(t,e){return t.map(e).join("")}function Bb(t,e){return t.filter(function(n){return!Rr(n,e)})}var lp=1,Qa=1,b$=0,Ns=0,Ft=0,vl="";function cp(t,e,n,s,r,o,i,a){return{value:t,root:e,parent:n,type:s,props:r,children:o,line:lp,column:Qa,length:i,return:"",siblings:a}}function no(t,e){return z0(cp("",null,null,"",null,null,0,t.siblings),t,{length:-t.length},e)}function ia(t){for(;t.root;)t=no(t.root,{children:[t]});ec(t,t.siblings)}function EO(){return Ft}function RO(){return Ft=Ns>0?Jt(vl,--Ns):0,Qa--,Ft===10&&(Qa=1,lp--),Ft}function Ks(){return Ft=Ns<b$?Jt(vl,Ns++):0,Qa++,Ft===10&&(Qa=1,lp++),Ft}function yi(){return Jt(vl,Ns)}function $h(){return Ns}function up(t,e){return Ya(vl,t,e)}function M0(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function AO(t){return lp=Qa=1,b$=lr(vl=t),Ns=0,[]}function DO(t){return vl="",t}function mg(t){return w$(up(Ns-1,P0(t===91?t+2:t===40?t+1:t)))}function _O(t){for(;(Ft=yi())&&Ft<33;)Ks();return M0(t)>2||M0(Ft)>3?"":" "}function FO(t,e){for(;--e&&Ks()&&!(Ft<48||Ft>102||Ft>57&&Ft<65||Ft>70&&Ft<97););return up(t,$h()+(e<6&&yi()==32&&Ks()==32))}function P0(t){for(;Ks();)switch(Ft){case t:return Ns;case 34:case 39:t!==34&&t!==39&&P0(Ft);break;case 40:t===41&&P0(t);break;case 92:Ks();break}return Ns}function OO(t,e){for(;Ks()&&t+Ft!==57;)if(t+Ft===84&&yi()===47)break;return"/*"+up(e,Ns-1)+"*"+Ex(t===47?t:Ks())}function zO(t){for(;!M0(yi());)Ks();return up(t,Ns)}function MO(t){return DO(Nh("",null,null,null,[""],t=AO(t),0,[0],t))}function Nh(t,e,n,s,r,o,i,a,l){for(var c=0,u=0,d=i,h=0,f=0,p=0,g=1,x=1,m=1,y=0,w="",v=r,b=o,C=s,k=w;x;)switch(p=y,y=Ks()){case 40:if(p!=108&&Jt(k,d-1)==58){Ih(k+=Ee(mg(y),"&","&\f"),"&\f",y$(c?a[c-1]:0))!=-1&&(m=-1);break}case 34:case 39:case 91:k+=mg(y);break;case 9:case 10:case 13:case 32:k+=_O(p);break;case 92:k+=FO($h()-1,7);continue;case 47:switch(yi()){case 42:case 47:ec(PO(OO(Ks(),$h()),e,n,l),l);break;default:k+="/"}break;case 123*g:a[c++]=lr(k)*m;case 125*g:case 59:case 0:switch(y){case 0:case 125:x=0;case 59+u:m==-1&&(k=Ee(k,/\f/g,"")),f>0&&lr(k)-d&&ec(f>32?Wb(k+";",s,n,d-1,l):Wb(Ee(k," ","")+";",s,n,d-2,l),l);break;case 59:k+=";";default:if(ec(C=Vb(k,e,n,c,u,r,a,w,v=[],b=[],d,o),o),y===123)if(u===0)Nh(k,e,C,C,v,o,d,a,b);else switch(h===99&&Jt(k,3)===110?100:h){case 100:case 108:case 109:case 115:Nh(t,C,C,s&&ec(Vb(t,C,C,0,0,r,a,w,r,v=[],d,b),b),r,b,d,a,s?v:b);break;default:Nh(k,C,C,C,[""],b,0,a,b)}}c=u=f=0,g=m=1,w=k="",d=i;break;case 58:d=1+lr(k),f=p;default:if(g<1){if(y==123)--g;else if(y==125&&g++==0&&RO()==125)continue}switch(k+=Ex(y),y*g){case 38:m=u>0?1:(k+="\f",-1);break;case 44:a[c++]=(lr(k)-1)*m,m=1;break;case 64:yi()===45&&(k+=mg(Ks())),h=yi(),u=d=lr(w=k+=zO($h())),y++;break;case 45:p===45&&lr(k)==2&&(g=0)}}return o}function Vb(t,e,n,s,r,o,i,a,l,c,u,d){for(var h=r-1,f=r===0?o:[""],p=v$(f),g=0,x=0,m=0;g<s;++g)for(var y=0,w=Ya(t,h+1,h=y$(x=i[g])),v=t;y<p;++y)(v=w$(x>0?f[y]+" "+w:Ee(w,/&\f/g,f[y])))&&(l[m++]=v);return cp(t,e,n,r===0?ap:a,l,c,u,d)}function PO(t,e,n,s){return cp(t,e,n,g$,Ex(EO()),Ya(t,2,-2),0,s)}function Wb(t,e,n,s,r){return cp(t,e,n,Tx,Ya(t,0,s),Ya(t,s+1,-1),s,r)}function C$(t,e,n){switch(NO(t,e)){case 5103:return je+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return je+t+t;case 4789:return vc+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return je+t+vc+t+dt+t+t;case 5936:switch(Jt(t,e+11)){case 114:return je+t+dt+Ee(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return je+t+dt+Ee(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return je+t+dt+Ee(t,/[svh]\w+-[tblr]{2}/,"lr")+t}case 6828:case 4268:case 2903:return je+t+dt+t+t;case 6165:return je+t+dt+"flex-"+t+t;case 5187:return je+t+Ee(t,/(\w+).+(:[^]+)/,je+"box-$1$2"+dt+"flex-$1$2")+t;case 5443:return je+t+dt+"flex-item-"+Ee(t,/flex-|-self/g,"")+(Rr(t,/flex-|baseline/)?"":dt+"grid-row-"+Ee(t,/flex-|-self/g,""))+t;case 4675:return je+t+dt+"flex-line-pack"+Ee(t,/align-content|flex-|-self/g,"")+t;case 5548:return je+t+dt+Ee(t,"shrink","negative")+t;case 5292:return je+t+dt+Ee(t,"basis","preferred-size")+t;case 6060:return je+"box-"+Ee(t,"-grow","")+je+t+dt+Ee(t,"grow","positive")+t;case 4554:return je+Ee(t,/([^-])(transform)/g,"$1"+je+"$2")+t;case 6187:return Ee(Ee(Ee(t,/(zoom-|grab)/,je+"$1"),/(image-set)/,je+"$1"),t,"")+t;case 5495:case 3959:return Ee(t,/(image-set\([^]*)/,je+"$1$`$1");case 4968:return Ee(Ee(t,/(.+:)(flex-)?(.*)/,je+"box-pack:$3"+dt+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+je+t+t;case 4200:if(!Rr(t,/flex-|baseline/))return dt+"grid-column-align"+Ya(t,e)+t;break;case 2592:case 3360:return dt+Ee(t,"template-","")+t;case 4384:case 3616:return n&&n.some(function(s,r){return e=r,Rr(s.props,/grid-\w+-end/)})?~Ih(t+(n=n[e].value),"span",0)?t:dt+Ee(t,"-start","")+t+dt+"grid-row-span:"+(~Ih(n,"span",0)?Rr(n,/\d+/):+Rr(n,/\d+/)-+Rr(t,/\d+/))+";":dt+Ee(t,"-start","")+t;case 4896:case 4128:return n&&n.some(function(s){return Rr(s.props,/grid-\w+-start/)})?t:dt+Ee(Ee(t,"-end","-span"),"span ","")+t;case 4095:case 3583:case 4068:case 2532:return Ee(t,/(.+)-inline(.+)/,je+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(lr(t)-1-e>6)switch(Jt(t,e+1)){case 109:if(Jt(t,e+4)!==45)break;case 102:return Ee(t,/(.+:)(.+)-([^]+)/,"$1"+je+"$2-$3$1"+vc+(Jt(t,e+3)==108?"$3":"$2-$3"))+t;case 115:return~Ih(t,"stretch",0)?C$(Ee(t,"stretch","fill-available"),e,n)+t:t}break;case 5152:case 5920:return Ee(t,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(s,r,o,i,a,l,c){return dt+r+":"+o+c+(i?dt+r+"-span:"+(a?l:+l-+o)+c:"")+t});case 4949:if(Jt(t,e+6)===121)return Ee(t,":",":"+je)+t;break;case 6444:switch(Jt(t,Jt(t,14)===45?18:11)){case 120:return Ee(t,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+je+(Jt(t,14)===45?"inline-":"")+"box$3$1"+je+"$2$3$1"+dt+"$2box$3")+t;case 100:return Ee(t,":",":"+dt)+t}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Ee(t,"scroll-","scroll-snap-")+t}return t}function af(t,e){for(var n="",s=0;s<t.length;s++)n+=e(t[s],s,t,e)||"";return n}function LO(t,e,n,s){switch(t.type){case $O:if(t.children.length)break;case IO:case Tx:return t.return=t.return||t.value;case g$:return"";case x$:return t.return=t.value+"{"+af(t.children,s)+"}";case ap:if(!lr(t.value=t.props.join(",")))return""}return lr(n=af(t.children,s))?t.return=t.value+"{"+n+"}":""}function BO(t){var e=v$(t);return function(n,s,r,o){for(var i="",a=0;a<e;a++)i+=t[a](n,s,r,o)||"";return i}}function VO(t){return function(e){e.root||(e=e.return)&&t(e)}}function WO(t,e,n,s){if(t.length>-1&&!t.return)switch(t.type){case Tx:t.return=C$(t.value,t.length,n);return;case x$:return af([no(t,{value:Ee(t.value,"@","@"+je)})],s);case ap:if(t.length)return TO(n=t.props,function(r){switch(Rr(r,s=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":ia(no(t,{props:[Ee(r,/:(read-\w+)/,":"+vc+"$1")]})),ia(no(t,{props:[r]})),z0(t,{props:Bb(n,s)});break;case"::placeholder":ia(no(t,{props:[Ee(r,/:(plac\w+)/,":"+je+"input-$1")]})),ia(no(t,{props:[Ee(r,/:(plac\w+)/,":"+vc+"$1")]})),ia(no(t,{props:[Ee(r,/:(plac\w+)/,dt+"input-$1")]})),ia(no(t,{props:[r]})),z0(t,{props:Bb(n,s)});break}return""})}}var UO={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Jn={},Ja=typeof process<"u"&&Jn!==void 0&&(Jn.REACT_APP_SC_ATTR||Jn.SC_ATTR)||"data-styled",k$="active",S$="data-styled-version",dp="6.1.13",Rx=`/*!sc*/
`,lf=typeof window<"u"&&"HTMLElement"in window,GO=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Jn!==void 0&&Jn.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Jn.REACT_APP_SC_DISABLE_SPEEDY!==""?Jn.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Jn.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Jn!==void 0&&Jn.SC_DISABLE_SPEEDY!==void 0&&Jn.SC_DISABLE_SPEEDY!==""&&Jn.SC_DISABLE_SPEEDY!=="false"&&Jn.SC_DISABLE_SPEEDY),HO={},hp=Object.freeze([]),Za=Object.freeze({});function I$(t,e,n){return n===void 0&&(n=Za),t.theme!==n.theme&&t.theme||e||n.theme}var $$=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),jO=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,KO=/(^-|-$)/g;function Ub(t){return t.replace(jO,"-").replace(KO,"")}var XO=/(a)(d)/gi,Qd=52,Gb=function(t){return String.fromCharCode(t+(t>25?39:97))};function L0(t){var e,n="";for(e=Math.abs(t);e>Qd;e=e/Qd|0)n=Gb(e%Qd)+n;return(Gb(e%Qd)+n).replace(XO,"$1-$2")}var gg,N$=5381,Ta=function(t,e){for(var n=e.length;n;)t=33*t^e.charCodeAt(--n);return t},T$=function(t){return Ta(N$,t)};function E$(t){return L0(T$(t)>>>0)}function qO(t){return t.displayName||t.name||"Component"}function xg(t){return typeof t=="string"&&!0}var R$=typeof Symbol=="function"&&Symbol.for,A$=R$?Symbol.for("react.memo"):60115,YO=R$?Symbol.for("react.forward_ref"):60112,QO={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},JO={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},D$={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},ZO=((gg={})[YO]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},gg[A$]=D$,gg);function Hb(t){return("type"in(e=t)&&e.type.$$typeof)===A$?D$:"$$typeof"in t?ZO[t.$$typeof]:QO;var e}var ez=Object.defineProperty,tz=Object.getOwnPropertyNames,jb=Object.getOwnPropertySymbols,nz=Object.getOwnPropertyDescriptor,sz=Object.getPrototypeOf,Kb=Object.prototype;function _$(t,e,n){if(typeof e!="string"){if(Kb){var s=sz(e);s&&s!==Kb&&_$(t,s,n)}var r=tz(e);jb&&(r=r.concat(jb(e)));for(var o=Hb(t),i=Hb(e),a=0;a<r.length;++a){var l=r[a];if(!(l in JO||n&&n[l]||i&&l in i||o&&l in o)){var c=nz(e,l);try{ez(t,l,c)}catch{}}}}return t}function el(t){return typeof t=="function"}function Ax(t){return typeof t=="object"&&"styledComponentId"in t}function hi(t,e){return t&&e?"".concat(t," ").concat(e):t||e||""}function B0(t,e){if(t.length===0)return"";for(var n=t[0],s=1;s<t.length;s++)n+=t[s];return n}function Gc(t){return t!==null&&typeof t=="object"&&t.constructor.name===Object.name&&!("props"in t&&t.$$typeof)}function V0(t,e,n){if(n===void 0&&(n=!1),!n&&!Gc(t)&&!Array.isArray(t))return e;if(Array.isArray(e))for(var s=0;s<e.length;s++)t[s]=V0(t[s],e[s]);else if(Gc(e))for(var s in e)t[s]=V0(t[s],e[s]);return t}function Dx(t,e){Object.defineProperty(t,"toString",{value:e})}function du(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(t," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var rz=function(){function t(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return t.prototype.indexOfGroup=function(e){for(var n=0,s=0;s<e;s++)n+=this.groupSizes[s];return n},t.prototype.insertRules=function(e,n){if(e>=this.groupSizes.length){for(var s=this.groupSizes,r=s.length,o=r;e>=o;)if((o<<=1)<0)throw du(16,"".concat(e));this.groupSizes=new Uint32Array(o),this.groupSizes.set(s),this.length=o;for(var i=r;i<o;i++)this.groupSizes[i]=0}for(var a=this.indexOfGroup(e+1),l=(i=0,n.length);i<l;i++)this.tag.insertRule(a,n[i])&&(this.groupSizes[e]++,a++)},t.prototype.clearGroup=function(e){if(e<this.length){var n=this.groupSizes[e],s=this.indexOfGroup(e),r=s+n;this.groupSizes[e]=0;for(var o=s;o<r;o++)this.tag.deleteRule(s)}},t.prototype.getGroup=function(e){var n="";if(e>=this.length||this.groupSizes[e]===0)return n;for(var s=this.groupSizes[e],r=this.indexOfGroup(e),o=r+s,i=r;i<o;i++)n+="".concat(this.tag.getRule(i)).concat(Rx);return n},t}(),Th=new Map,cf=new Map,Eh=1,Jd=function(t){if(Th.has(t))return Th.get(t);for(;cf.has(Eh);)Eh++;var e=Eh++;return Th.set(t,e),cf.set(e,t),e},oz=function(t,e){Eh=e+1,Th.set(t,e),cf.set(e,t)},iz="style[".concat(Ja,"][").concat(S$,'="').concat(dp,'"]'),az=new RegExp("^".concat(Ja,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),lz=function(t,e,n){for(var s,r=n.split(","),o=0,i=r.length;o<i;o++)(s=r[o])&&t.registerName(e,s)},cz=function(t,e){for(var n,s=((n=e.textContent)!==null&&n!==void 0?n:"").split(Rx),r=[],o=0,i=s.length;o<i;o++){var a=s[o].trim();if(a){var l=a.match(az);if(l){var c=0|parseInt(l[1],10),u=l[2];c!==0&&(oz(u,c),lz(t,u,l[3]),t.getTag().insertRules(c,r)),r.length=0}else r.push(a)}}},Xb=function(t){for(var e=document.querySelectorAll(iz),n=0,s=e.length;n<s;n++){var r=e[n];r&&r.getAttribute(Ja)!==k$&&(cz(t,r),r.parentNode&&r.parentNode.removeChild(r))}};function uz(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var F$=function(t){var e=document.head,n=t||e,s=document.createElement("style"),r=function(a){var l=Array.from(a.querySelectorAll("style[".concat(Ja,"]")));return l[l.length-1]}(n),o=r!==void 0?r.nextSibling:null;s.setAttribute(Ja,k$),s.setAttribute(S$,dp);var i=uz();return i&&s.setAttribute("nonce",i),n.insertBefore(s,o),s},dz=function(){function t(e){this.element=F$(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(n){if(n.sheet)return n.sheet;for(var s=document.styleSheets,r=0,o=s.length;r<o;r++){var i=s[r];if(i.ownerNode===n)return i}throw du(17)}(this.element),this.length=0}return t.prototype.insertRule=function(e,n){try{return this.sheet.insertRule(n,e),this.length++,!0}catch{return!1}},t.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.prototype.getRule=function(e){var n=this.sheet.cssRules[e];return n&&n.cssText?n.cssText:""},t}(),hz=function(){function t(e){this.element=F$(e),this.nodes=this.element.childNodes,this.length=0}return t.prototype.insertRule=function(e,n){if(e<=this.length&&e>=0){var s=document.createTextNode(n);return this.element.insertBefore(s,this.nodes[e]||null),this.length++,!0}return!1},t.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},t}(),fz=function(){function t(e){this.rules=[],this.length=0}return t.prototype.insertRule=function(e,n){return e<=this.length&&(this.rules.splice(e,0,n),this.length++,!0)},t.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},t}(),qb=lf,pz={isServer:!lf,useCSSOMInjection:!GO},uf=function(){function t(e,n,s){e===void 0&&(e=Za),n===void 0&&(n={});var r=this;this.options=bn(bn({},pz),e),this.gs=n,this.names=new Map(s),this.server=!!e.isServer,!this.server&&lf&&qb&&(qb=!1,Xb(this)),Dx(this,function(){return function(o){for(var i=o.getTag(),a=i.length,l="",c=function(d){var h=function(m){return cf.get(m)}(d);if(h===void 0)return"continue";var f=o.names.get(h),p=i.getGroup(d);if(f===void 0||!f.size||p.length===0)return"continue";var g="".concat(Ja,".g").concat(d,'[id="').concat(h,'"]'),x="";f!==void 0&&f.forEach(function(m){m.length>0&&(x+="".concat(m,","))}),l+="".concat(p).concat(g,'{content:"').concat(x,'"}').concat(Rx)},u=0;u<a;u++)c(u);return l}(r)})}return t.registerId=function(e){return Jd(e)},t.prototype.rehydrate=function(){!this.server&&lf&&Xb(this)},t.prototype.reconstructWithOptions=function(e,n){return n===void 0&&(n=!0),new t(bn(bn({},this.options),e),this.gs,n&&this.names||void 0)},t.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.prototype.getTag=function(){return this.tag||(this.tag=(e=function(n){var s=n.useCSSOMInjection,r=n.target;return n.isServer?new fz(r):s?new dz(r):new hz(r)}(this.options),new rz(e)));var e},t.prototype.hasNameForId=function(e,n){return this.names.has(e)&&this.names.get(e).has(n)},t.prototype.registerName=function(e,n){if(Jd(e),this.names.has(e))this.names.get(e).add(n);else{var s=new Set;s.add(n),this.names.set(e,s)}},t.prototype.insertRules=function(e,n,s){this.registerName(e,n),this.getTag().insertRules(Jd(e),s)},t.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.prototype.clearRules=function(e){this.getTag().clearGroup(Jd(e)),this.clearNames(e)},t.prototype.clearTag=function(){this.tag=void 0},t}(),mz=/&/g,gz=/^\s*\/\/.*$/gm;function O$(t,e){return t.map(function(n){return n.type==="rule"&&(n.value="".concat(e," ").concat(n.value),n.value=n.value.replaceAll(",",",".concat(e," ")),n.props=n.props.map(function(s){return"".concat(e," ").concat(s)})),Array.isArray(n.children)&&n.type!=="@keyframes"&&(n.children=O$(n.children,e)),n})}function xz(t){var e,n,s,r=Za,o=r.options,i=o===void 0?Za:o,a=r.plugins,l=a===void 0?hp:a,c=function(h,f,p){return p.startsWith(n)&&p.endsWith(n)&&p.replaceAll(n,"").length>0?".".concat(e):h},u=l.slice();u.push(function(h){h.type===ap&&h.value.includes("&")&&(h.props[0]=h.props[0].replace(mz,n).replace(s,c))}),i.prefix&&u.push(WO),u.push(LO);var d=function(h,f,p,g){f===void 0&&(f=""),p===void 0&&(p=""),g===void 0&&(g="&"),e=g,n=f,s=new RegExp("\\".concat(n,"\\b"),"g");var x=h.replace(gz,""),m=MO(p||f?"".concat(p," ").concat(f," { ").concat(x," }"):x);i.namespace&&(m=O$(m,i.namespace));var y=[];return af(m,BO(u.concat(VO(function(w){return y.push(w)})))),y};return d.hash=l.length?l.reduce(function(h,f){return f.name||du(15),Ta(h,f.name)},N$).toString():"",d}var yz=new uf,W0=xz(),z$=Us.createContext({shouldForwardProp:void 0,styleSheet:yz,stylis:W0});z$.Consumer;Us.createContext(void 0);function U0(){return ye.useContext(z$)}var wz=function(){function t(e,n){var s=this;this.inject=function(r,o){o===void 0&&(o=W0);var i=s.name+o.hash;r.hasNameForId(s.id,i)||r.insertRules(s.id,i,o(s.rules,i,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=n,Dx(this,function(){throw du(12,String(s.name))})}return t.prototype.getName=function(e){return e===void 0&&(e=W0),this.name+e.hash},t}(),vz=function(t){return t>="A"&&t<="Z"};function Yb(t){for(var e="",n=0;n<t.length;n++){var s=t[n];if(n===1&&s==="-"&&t[0]==="-")return t;vz(s)?e+="-"+s.toLowerCase():e+=s}return e.startsWith("ms-")?"-"+e:e}var M$=function(t){return t==null||t===!1||t===""},P$=function(t){var e,n,s=[];for(var r in t){var o=t[r];t.hasOwnProperty(r)&&!M$(o)&&(Array.isArray(o)&&o.isCss||el(o)?s.push("".concat(Yb(r),":"),o,";"):Gc(o)?s.push.apply(s,Uc(Uc(["".concat(r," {")],P$(o),!1),["}"],!1)):s.push("".concat(Yb(r),": ").concat((e=r,(n=o)==null||typeof n=="boolean"||n===""?"":typeof n!="number"||n===0||e in UO||e.startsWith("--")?String(n).trim():"".concat(n,"px")),";")))}return s};function ko(t,e,n,s){if(M$(t))return[];if(Ax(t))return[".".concat(t.styledComponentId)];if(el(t)){if(!el(o=t)||o.prototype&&o.prototype.isReactComponent||!e)return[t];var r=t(e);return ko(r,e,n,s)}var o;return t instanceof wz?n?(t.inject(n,s),[t.getName(s)]):[t]:Gc(t)?P$(t):Array.isArray(t)?Array.prototype.concat.apply(hp,t.map(function(i){return ko(i,e,n,s)})):[t.toString()]}function L$(t){for(var e=0;e<t.length;e+=1){var n=t[e];if(el(n)&&!Ax(n))return!1}return!0}var bz=T$(dp),Cz=function(){function t(e,n,s){this.rules=e,this.staticRulesId="",this.isStatic=(s===void 0||s.isStatic)&&L$(e),this.componentId=n,this.baseHash=Ta(bz,n),this.baseStyle=s,uf.registerId(n)}return t.prototype.generateAndInjectStyles=function(e,n,s){var r=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,n,s):"";if(this.isStatic&&!s.hash)if(this.staticRulesId&&n.hasNameForId(this.componentId,this.staticRulesId))r=hi(r,this.staticRulesId);else{var o=B0(ko(this.rules,e,n,s)),i=L0(Ta(this.baseHash,o)>>>0);if(!n.hasNameForId(this.componentId,i)){var a=s(o,".".concat(i),void 0,this.componentId);n.insertRules(this.componentId,i,a)}r=hi(r,i),this.staticRulesId=i}else{for(var l=Ta(this.baseHash,s.hash),c="",u=0;u<this.rules.length;u++){var d=this.rules[u];if(typeof d=="string")c+=d;else if(d){var h=B0(ko(d,e,n,s));l=Ta(l,h+u),c+=h}}if(c){var f=L0(l>>>0);n.hasNameForId(this.componentId,f)||n.insertRules(this.componentId,f,s(c,".".concat(f),void 0,this.componentId)),r=hi(r,f)}}return r},t}(),_x=Us.createContext(void 0);_x.Consumer;var yg={};function kz(t,e,n){var s=Ax(t),r=t,o=!xg(t),i=e.attrs,a=i===void 0?hp:i,l=e.componentId,c=l===void 0?function(v,b){var C=typeof v!="string"?"sc":Ub(v);yg[C]=(yg[C]||0)+1;var k="".concat(C,"-").concat(E$(dp+C+yg[C]));return b?"".concat(b,"-").concat(k):k}(e.displayName,e.parentComponentId):l,u=e.displayName,d=u===void 0?function(v){return xg(v)?"styled.".concat(v):"Styled(".concat(qO(v),")")}(t):u,h=e.displayName&&e.componentId?"".concat(Ub(e.displayName),"-").concat(e.componentId):e.componentId||c,f=s&&r.attrs?r.attrs.concat(a).filter(Boolean):a,p=e.shouldForwardProp;if(s&&r.shouldForwardProp){var g=r.shouldForwardProp;if(e.shouldForwardProp){var x=e.shouldForwardProp;p=function(v,b){return g(v,b)&&x(v,b)}}else p=g}var m=new Cz(n,h,s?r.componentStyle:void 0);function y(v,b){return function(C,k,S){var $=C.attrs,N=C.componentStyle,A=C.defaultProps,M=C.foldedComponentIds,L=C.styledComponentId,V=C.target,B=Us.useContext(_x),U=U0(),K=C.shouldForwardProp||U.shouldForwardProp,R=I$(k,B,A)||Za,z=function(J,ne,ie){for(var ce,ue=bn(bn({},ne),{className:void 0,theme:ie}),xe=0;xe<J.length;xe+=1){var be=el(ce=J[xe])?ce(ue):ce;for(var ke in be)ue[ke]=ke==="className"?hi(ue[ke],be[ke]):ke==="style"?bn(bn({},ue[ke]),be[ke]):be[ke]}return ne.className&&(ue.className=hi(ue.className,ne.className)),ue}($,k,R),G=z.as||V,X={};for(var q in z)z[q]===void 0||q[0]==="$"||q==="as"||q==="theme"&&z.theme===R||(q==="forwardedAs"?X.as=z.forwardedAs:K&&!K(q,G)||(X[q]=z[q]));var Q=function(J,ne){var ie=U0(),ce=J.generateAndInjectStyles(ne,ie.styleSheet,ie.stylis);return ce}(N,z),ee=hi(M,L);return Q&&(ee+=" "+Q),z.className&&(ee+=" "+z.className),X[xg(G)&&!$$.has(G)?"class":"className"]=ee,X.ref=S,ye.createElement(G,X)}(w,v,b)}y.displayName=d;var w=Us.forwardRef(y);return w.attrs=f,w.componentStyle=m,w.displayName=d,w.shouldForwardProp=p,w.foldedComponentIds=s?hi(r.foldedComponentIds,r.styledComponentId):"",w.styledComponentId=h,w.target=s?r.target:t,Object.defineProperty(w,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(v){this._foldedDefaultProps=s?function(b){for(var C=[],k=1;k<arguments.length;k++)C[k-1]=arguments[k];for(var S=0,$=C;S<$.length;S++)V0(b,$[S],!0);return b}({},r.defaultProps,v):v}}),Dx(w,function(){return".".concat(w.styledComponentId)}),o&&_$(w,t,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),w}function Qb(t,e){for(var n=[t[0]],s=0,r=e.length;s<r;s+=1)n.push(e[s],t[s+1]);return n}var Jb=function(t){return Object.assign(t,{isCss:!0})};function B$(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(el(t)||Gc(t))return Jb(ko(Qb(hp,Uc([t],e,!0))));var s=t;return e.length===0&&s.length===1&&typeof s[0]=="string"?ko(s):Jb(ko(Qb(s,e)))}function G0(t,e,n){if(n===void 0&&(n=Za),!e)throw du(1,e);var s=function(r){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];return t(e,n,B$.apply(void 0,Uc([r],o,!1)))};return s.attrs=function(r){return G0(t,e,bn(bn({},n),{attrs:Array.prototype.concat(n.attrs,r).filter(Boolean)}))},s.withConfig=function(r){return G0(t,e,bn(bn({},n),r))},s}var V$=function(t){return G0(kz,t)},In=V$;$$.forEach(function(t){In[t]=V$(t)});var Sz=function(){function t(e,n){this.rules=e,this.componentId=n,this.isStatic=L$(e),uf.registerId(this.componentId+1)}return t.prototype.createStyles=function(e,n,s,r){var o=r(B0(ko(this.rules,n,s,r)),""),i=this.componentId+e;s.insertRules(i,i,o)},t.prototype.removeStyles=function(e,n){n.clearRules(this.componentId+e)},t.prototype.renderStyles=function(e,n,s,r){e>2&&uf.registerId(this.componentId+e),this.removeStyles(e,s),this.createStyles(e,n,s,r)},t}();function W$(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var s=B$.apply(void 0,Uc([t],e,!1)),r="sc-global-".concat(E$(JSON.stringify(s))),o=new Sz(s,r),i=function(l){var c=U0(),u=Us.useContext(_x),d=Us.useRef(c.styleSheet.allocateGSInstance(r)).current;return c.styleSheet.server&&a(d,l,c.styleSheet,u,c.stylis),Us.useLayoutEffect(function(){if(!c.styleSheet.server)return a(d,l,c.styleSheet,u,c.stylis),function(){return o.removeStyles(d,c.styleSheet)}},[d,l,c.styleSheet,u,c.stylis]),null};function a(l,c,u,d,h){if(o.isStatic)o.renderStyles(l,HO,u,h);else{var f=bn(bn({},c),{theme:I$(c,d,i.defaultProps)});o.renderStyles(l,f,u,h)}}return Us.memo(i)}const Iz=W$`
:root {
  font-family: 'Press Start 2P', system-ui;
  font-size: 13px;
  line-height: 1.5;
  font-weight: 400;
  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;
  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: #242424;
  overscroll-behavior: none;
  background: radial-gradient(ellipse at center, #30c530 0%, #30c530 64%, #138c13 100%);
}
`,$z=In.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background-color: #242424;
  color: #ffffff;
  width: 100%;
`,Nz=In.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 3rem;
  margin-bottom: 2rem;
  text-align: center;
  @media (max-width: 768px) {
    font-size: 2rem;
  }
`,Tz=In.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  background-color: #4caf50;
  color: white;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s ease;
  &:hover {
    background-color: #45a049;
  }
  &:focus {
    outline: 2px solid #ffffff;
  }
`,Ez=({onPlayClick:t})=>Se.jsxs($z,{children:[Se.jsx(Nz,{children:"MasterPlan"}),Se.jsx(Tz,{onClick:t,"aria-label":"Start the game",children:"Play"})]});function Rz(t,e){var n=ye.useRef(!1),s=ye.useRef(),r=ye.useRef(t),o=ye.useCallback(function(){return n.current},[]),i=ye.useCallback(function(){n.current=!1,s.current&&clearTimeout(s.current),s.current=setTimeout(function(){n.current=!0,r.current()},e)},[e]),a=ye.useCallback(function(){n.current=null,s.current&&clearTimeout(s.current)},[]);return ye.useEffect(function(){r.current=t},[t]),ye.useEffect(function(){return i(),a},[e]),[o,a,i]}function Az(t,e,n){n===void 0&&(n=[]);var s=Rz(t,e),r=s[0],o=s[1],i=s[2];return ye.useEffect(i,n),[r,o]}function Dz(t,e){e===void 0&&(e=!0);var n=ye.useRef(null),s=ye.useRef(!1),r=ye.useRef(t);r.current=t;var o=ye.useCallback(function(a){s.current&&(r.current(a),n.current=requestAnimationFrame(o))},[]),i=ye.useMemo(function(){return[function(){s.current&&(s.current=!1,n.current&&cancelAnimationFrame(n.current))},function(){s.current||(s.current=!0,n.current=requestAnimationFrame(o))},function(){return s.current}]},[]);return ye.useEffect(function(){return e&&i[1](),i[0]},[]),i}const _z=10,Zb=100,hu="layer-default",uo=800,tl=100,is=32,Wr=32,wi=1600,vi=800,So=wi/is,Io=vi/Wr,Fz=10,H0=is+Fz,eC=600,Oz=250,tC=300,nC=500,zz=is*5,sC=1e3,rC=is/3,za=is*4,U$=1500,Mz=1e3,nl=Math.floor(So/2),sl=Math.floor(Io/2),G$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkDEigyAtVVggAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAB4SURBVFjD7VfLDsAgCIOF///l7rSTizp5aJZyMxFtoMUqsjnUmQ/vudfuChBAVKDDh7MroAsMD73bgqSKhb1UAQHIQ0J8II2yBRktqBzXzboSgL4NLcsgFklIAJUyRI/hv/aEIw847RHNWfLjXS8ow4xXrOzTUhI3cssYNHqG9WQAAAAASUVORK5CYII=",H$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkDEigk9gHg0wAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAACySURBVFjD1VZbDsAgCLPE+1+5+13cIqI8Nn7JpNAW1lpx4PB7brzLe16SG34AloLiqADAjAJUir/mJQHYVOjdeZS0uqw7WXcU2DLnUjH2SACm4hEAzJtVkjzOKABURKlORw461vheoqNvcMxFsTFSAzDm4bkJYaAJnraZFaeHJU9vAKMWx+zA8LRrOEwCFs49bPipGLk3a0HaT0PrdHkSu79k+FrH2/egXAPyF8FV0JcTF5HDMyNBbtWDAAAAAElFTkSuQmCC",j$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkJDBsdJGpj9QAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAACjSURBVFjD7VbREoAgCHMe///L6zW9wgLErpOnNLkNnACKzfjwHEYHallsHgLwRP6LDISYOHx5SjW71LNEqXT2K0AAiMcgCUDQMDJEyFkitOiMuw5sAqsJoP+WRHBerWVB9E3f2CLcBMTxjLRGkzITsgOEZZaoL9iaACJSikHkWnYw+idKsbAAa4Oru4wyyK/Zqy/Fll4HosBvrw8WJ2cXRPmSHSqNI0GjWZKJAAAAAElFTkSuQmCC",K$="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEUAAAAAAAClZ7nPAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfiCQwTIjRI+GJcAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAGtJREFUCNdjYCAHJICIG0DMeAJIMD8BEux/QMQPIMH/gYHxg/wDBiYP+wMMrCH1DAwsT/4B5f4CVbD8/9/AwBr+yYGByf/VAgbG//8VGBjk9z9gYNinDmTVaC1gYLAQcmBgEOBvYGDgYGAAAKEvGyWBDTuGAAAAAElFTkSuQmCC",j0={warrior:G$,archer:H$,tank:j$,artillery:K$},Pz=t=>new Promise((e,n)=>{const s=new Image;s.onload=()=>e(s),s.onerror=n,s.src=t}),Fx=Us.memo(({width:t,height:e,cellWidth:n,cellHeight:s,units:r,selectedUnitId:o,onMouseDown:i,onMouseMove:a,onMouseUp:l,onTouchStart:c,onTouchMove:u,onTouchEnd:d,onCellClick:h,isPlayerArea:f})=>{const p=ye.useRef(null),[g,x]=ye.useState({});ye.useEffect(()=>{(async()=>{const b={};for(const[C,k]of Object.entries(j0))try{b[C]=await Pz(k)}catch(S){console.error(`Failed to load image for ${C}:`,S)}x(b)})()},[]);const m=ye.useCallback(v=>{v.strokeStyle="#ccc",v.lineWidth=1;for(let b=0;b<=t;b+=n)v.beginPath(),v.moveTo(b,0),v.lineTo(b,e),v.stroke();for(let b=0;b<=e;b+=s)v.beginPath(),v.moveTo(0,b),v.lineTo(t,b),v.stroke()},[t,e,n,s]),y=ye.useCallback(v=>{r.forEach(b=>{const C=(b.col+nl)*n,k=(b.row+sl)*s,S=b.sizeCol*n,$=b.sizeRow*s;if(g[b.type])for(let N=0;N<b.sizeCol;N++)for(let A=0;A<b.sizeRow;A++)v.drawImage(g[b.type],C+N*n,k+A*s,n,s),v.fillStyle=f?"#ff0000":"#00ff00",v.fillRect(C+N*n,k+A*s+10,10,5);else v.fillStyle=b.type==="archer"?"green":b.type==="tank"?"blue":"red",v.fillRect(C,k,S,$);f&&b.id===o&&(v.strokeStyle="yellow",v.lineWidth=2,v.strokeRect(C,k,S,$)),v.fillStyle="white",v.font="12px Arial",v.textAlign="center",v.textBaseline="middle",v.fillText(b.type,C+S/2,k+$/2)})},[r,o,g,n,s,f]);ye.useEffect(()=>{const v=p.current;if(!v)return;const b=v.getContext("2d");b&&(b.clearRect(0,0,t,e),m(b),y(b))},[t,e,n,s,r,o,g,m,y]);const w=ye.useCallback(v=>{if(!f)return;const b=p.current;if(!b)return;const C=b.getBoundingClientRect(),k=(v.clientX-C.left)*(b.width/C.width),S=(v.clientY-C.top)*(b.height/C.height),$=Math.floor(k/n)-nl,N=Math.floor(S/s)-sl;h($,N)},[n,s,h,f]);return Se.jsx(Lz,{ref:p,"data-is-player-area":f,width:t,height:e,onClick:w,onMouseDown:i,onMouseMove:a,onMouseUp:l,onTouchStart:c,onTouchMove:u,onTouchEnd:d})});Fx.displayName="CanvasGrid";const Lz=In.canvas`
  position: absolute;
  transform: translate(-50%, -50%);
  left: 50%;
  top: 50%;
  max-width: 90vw;
  max-height: 50vh;
`,oC=(t,e)=>({x:(t+nl)*is,y:(e+sl)*Wr}),iC=(t,e)=>({col:Math.floor(t/is)-nl,row:Math.floor(e/Wr)-sl}),Bz=(t,e)=>{const[n,s]=ye.useState({isDragging:!1,draggedUnit:null,dragOffset:{x:0,y:0}}),r=ye.useCallback(l=>"touches"in l?{clientX:l.touches[0].clientX,clientY:l.touches[0].clientY}:{clientX:l.clientX,clientY:l.clientY},[]),o=ye.useCallback(l=>{const c=l.currentTarget,u=c.getBoundingClientRect(),{clientX:d,clientY:h}=r(l),{col:f,row:p}=iC((d-u.left)*(c.width/u.width),(h-u.top)*(c.height/u.height)),g=t.find(x=>f>=x.col&&f<x.col+x.sizeCol&&p>=x.row&&p<x.row+x.sizeRow);g&&s({isDragging:!0,draggedUnit:g,dragOffset:{x:d-u.left-oC(g.col,g.row).x/(c.width/u.width),y:h-u.top-oC(g.col,g.row).y/(c.height/u.height)}})},[t,r]),i=ye.useCallback(l=>{if(n.isDragging&&n.draggedUnit){const c=l.currentTarget,u=c.getBoundingClientRect(),{clientX:d,clientY:h}=r(l),{col:f,row:p}=iC((d-u.left)*(c.width/u.width)-n.dragOffset.x,(h-u.top)*(c.height/u.height)-n.dragOffset.y);e(g=>g.map(x=>x.id===n.draggedUnit.id?{...x,col:Math.max(-nl,Math.min(f,So-nl-x.sizeCol)),row:Math.max(-sl,Math.min(p,Io-sl-x.sizeRow))}:x))}},[n,e,r]),a=ye.useCallback(()=>{s({isDragging:!1,draggedUnit:null,dragOffset:{x:0,y:0}})},[]);return{isDragging:n.isDragging,handleDragStart:o,handleDragMove:i,handleDragEnd:a}},Vz=t=>{const[e,n]=ye.useState(null),s=ye.useCallback((o,i)=>{const a=t.find(l=>o>=l.col&&o<l.col+l.sizeCol&&i>=l.row&&i<l.row+l.sizeRow);return n(a||null),a},[t]),r=ye.useCallback(()=>{n(null)},[]);return{selectedUnit:e,handleUnitSelect:s,setSelectedUnit:n,clearSelection:r}};function aC(t,e){if(e.length===0)throw new Error("No AI plans available for selection");const n=e.map(r=>({plan:r,score:r.probabilityScore(t)}));n.sort((r,o)=>o.score-r.score);const s=n[0].plan;return console.log("Selected plan:",s.name,"with score:",n[0].score),console.log("All plan scores:"),n.forEach(({plan:r,score:o})=>{console.log(`${r.name}: ${o}`)}),s.units}function Qe(t){return t.reduce((e,n)=>(e[n.type]=(e[n.type]||0)+1,e),{tank:0,warrior:0,archer:0,artillery:0})}function nt(t){const e={left:0,center:0,right:0,front:0};t.forEach(s=>{s.col<-5?e.left++:s.col>5?e.right++:e.center++,s.row>-5&&e.front++});const n=t.length;return{left:e.left/n,center:e.center/n,right:e.right/n,front:e.front/n}}function ct(t){return t.length===0?0:t.reduce((n,s)=>n+s.sizeCol*s.sizeRow,0)/(t.length*16)}function At(t){const e=t.map(i=>({x:i.col,y:i.row})),n=e.reduce((i,a)=>i+a.x,0)/e.length,s=e.reduce((i,a)=>i+a.y,0)/e.length,r=Math.sqrt(32*32+18*18);return e.reduce((i,a)=>{const l=a.x-n,c=a.y-s;return i+Math.sqrt(l*l+c*c)},0)/e.length/r}const Ox=[{id:201,col:-12,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance-wait"},{id:202,col:0,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance-wait"},{id:203,col:12,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance-wait"},{id:204,col:-8,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:205,col:8,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:206,col:-16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:207,col:16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:208,col:2,row:-8,sizeCol:8,sizeRow:1,type:"artillery",command:"wait-advance"}],Wz="Balanced Assault",Uz=t=>{const e=Qe(t),n=nt(t),s=1-Math.abs(.25-e.warrior/t.length)-Math.abs(.25-e.archer/t.length)-Math.abs(.25-e.tank/t.length)-Math.abs(.25-e.artillery/t.length),r=(n.left+n.right+n.center)/3,o=1-Math.abs(.5-ct(t));return(s*.5+r*.3+o*.2)*100},Gz=Object.freeze(Object.defineProperty({__proto__:null,name:Wz,probabilityScore:Uz,units:Ox},Symbol.toStringTag,{value:"Module"})),Hz=[{id:301,col:-16,row:0,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:302,col:16,row:0,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:303,col:0,row:-4,sizeCol:8,sizeRow:3,type:"artillery",command:"advance-wait"},{id:304,col:-12,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:305,col:12,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:306,col:-8,row:-6,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:307,col:8,row:-6,sizeCol:4,sizeRow:3,type:"tank",command:"advance"}],jz="Anti-Tank Defense",Kz=t=>{const e=Qe(t),n=nt(t),s=e.tank/t.length,r=Math.min(s*2,1),o=n.center,i=ct(t.filter(a=>a.type==="tank"));return(r*.5+o*.3+i*.2)*100},Xz=Object.freeze(Object.defineProperty({__proto__:null,name:jz,probabilityScore:Kz,units:Hz},Symbol.toStringTag,{value:"Module"})),qz=[{id:401,col:-12,row:-2,sizeCol:4,sizeRow:2,type:"tank",command:"flank-left"},{id:402,col:12,row:-2,sizeCol:4,sizeRow:2,type:"tank",command:"flank-right"},{id:403,col:0,row:-6,sizeCol:6,sizeRow:3,type:"artillery",command:"wait-advance"},{id:404,col:-16,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:405,col:16,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:406,col:-8,row:-10,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:407,col:8,row:-10,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:408,col:-4,row:-4,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"},{id:409,col:4,row:-4,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"}],Yz="Archer Counter",Qz=t=>{const e=Qe(t),n=nt(t),s=e.archer/t.length,r=Math.min(s*2,1),o=Math.max(n.left,n.right),i=1-ct(t.filter(a=>a.type==="archer"));return(r*.5+o*.3+i*.2)*100},Jz=Object.freeze(Object.defineProperty({__proto__:null,name:Yz,probabilityScore:Qz,units:qz},Symbol.toStringTag,{value:"Module"})),Zz=[{id:501,col:-12,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:502,col:12,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:503,col:-8,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"flank-left"},{id:504,col:8,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"flank-right"},{id:505,col:-16,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:506,col:16,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:507,col:0,row:-6,sizeCol:6,sizeRow:3,type:"artillery",command:"wait-advance"},{id:508,col:-4,row:-2,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"},{id:509,col:4,row:-2,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"}],e3="Warrior Blitz",t3=t=>{const e=Qe(t),n=nt(t),s=e.tank/t.length,r=(e.warrior+e.archer)/t.length,o=(1-s)*.5+r*.5,i=n.center,a=1-ct(t);return(o*.4+i*.4+a*.2)*100},n3=Object.freeze(Object.defineProperty({__proto__:null,name:e3,probabilityScore:t3,units:Zz},Symbol.toStringTag,{value:"Module"})),s3=[{id:601,col:-12,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance-wait"},{id:602,col:12,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance-wait"},{id:603,col:-16,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"},{id:604,col:16,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"},{id:605,col:0,row:-8,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:606,col:-8,row:-10,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:607,col:8,row:-10,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:608,col:0,row:-12,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:609,col:0,row:-2,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"}],r3="Tank Formation",o3=t=>{const e=Qe(t),n=nt(t),s=(e.warrior+e.archer)/t.length,r=Math.min(s*1.5,1),o=1-n.center,i=1-ct(t);return(r*.4+o*.4+i*.2)*100},i3=Object.freeze(Object.defineProperty({__proto__:null,name:r3,probabilityScore:o3,units:s3},Symbol.toStringTag,{value:"Module"})),a3=[{id:701,col:-16,row:-4,sizeCol:6,sizeRow:3,type:"artillery",command:"advance"},{id:702,col:16,row:-4,sizeCol:6,sizeRow:3,type:"artillery",command:"advance"},{id:703,col:0,row:0,sizeCol:6,sizeRow:3,type:"tank",command:"advance-wait"},{id:704,col:-8,row:-10,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:705,col:8,row:-10,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:706,col:-12,row:-12,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:707,col:12,row:-12,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:708,col:0,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"}],l3="Artillery Strike",c3=t=>{const e=Qe(t),n=nt(t),s=(e.tank+e.artillery)/t.length,r=Math.min(s*2,1),o=Math.max(n.left,n.center,n.right),i=ct(t);return(r*.4+o*.4+i*.2)*100},u3=Object.freeze(Object.defineProperty({__proto__:null,name:l3,probabilityScore:c3,units:a3},Symbol.toStringTag,{value:"Module"})),d3=[{id:801,col:-16,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:802,col:-8,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:803,col:0,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:804,col:8,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:805,col:16,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:806,col:-12,row:-10,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:807,col:12,row:-10,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:808,col:0,row:-14,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:809,col:-20,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:810,col:20,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:811,col:-4,row:-8,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"},{id:812,col:4,row:-8,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"}],h3="Archer Ambush",f3=t=>{const e=Qe(t),n=nt(t),s=(e.warrior+e.tank)/t.length,r=Math.min(s*1.5,1),o=n.center+n.front*.5,i=ct(t);return(r*.4+o*.4+i*.2)*100},p3=Object.freeze(Object.defineProperty({__proto__:null,name:h3,probabilityScore:f3,units:d3},Symbol.toStringTag,{value:"Module"})),m3=[{id:301,col:-16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:302,col:-8,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:303,col:8,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:304,col:16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:305,col:-12,row:-4,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:306,col:12,row:-4,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:307,col:-8,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:308,col:8,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:309,col:0,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:310,col:-16,row:-2,sizeCol:4,sizeRow:2,type:"warrior",command:"flank-left"},{id:311,col:16,row:-2,sizeCol:4,sizeRow:2,type:"warrior",command:"flank-right"}],g3="Warrior Counter",x3=t=>{const e=Qe(t),n=t.length,s=(e.warrior||0)/n,r=At(t),o=Math.min(s*2,1),i=1-r,a=1-ct(t.filter(l=>l.type==="warrior"));return(o*.5+i*.3+a*.2)*100},y3=Object.freeze(Object.defineProperty({__proto__:null,name:g3,probabilityScore:x3,units:m3},Symbol.toStringTag,{value:"Module"})),w3=[{id:301,col:-6,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:302,col:6,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:303,col:-10,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:304,col:-5,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:305,col:0,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:306,col:5,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:307,col:10,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:308,col:-12,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:309,col:0,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:310,col:12,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:311,col:-12,row:-12,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:312,col:12,row:-12,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"}],v3="Artillery Counter",b3=t=>{const e=Qe(t),n=nt(t),s=Math.min(e.artillery/t.length,.5)*2,r=n.center,o=ct(t);return(s*.6+r*.2+o*.2)*100},C3=Object.freeze(Object.defineProperty({__proto__:null,name:v3,probabilityScore:b3,units:w3},Symbol.toStringTag,{value:"Module"})),Rh=[...[...Array(10)].map((t,e)=>({id:e,type:"warrior",col:-2+e%5,row:-4+Math.floor(e/5),sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(5)].map((t,e)=>({id:e+10,type:"archer",col:-2+e,row:-2,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(3)].map((t,e)=>({id:e+15,type:"artillery",col:-3+e*3,row:0,sizeCol:3,sizeRow:2,command:"advance"})),...[...Array(4)].map((t,e)=>({id:e+18,type:"warrior",col:e<2?-4:4,row:-5+e%2*2,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(4)].map((t,e)=>({id:e+22,type:"archer",col:e<2?-5:5,row:-4+e%2*2,sizeCol:2,sizeRow:2,command:"advance"}))],k3="Phalanx Formation";function S3(t){const e=Qe(Rh),n=Qe(t),s=nt(Rh),r=nt(t),o=At(Rh),i=At(t);let a=.5;return a+=(e.warrior-n.warrior)*.02,a+=(n.tank-e.tank)*.03,a+=(s.center-r.center)*.1,a+=(i-o)*.1,a-=Math.max(0,n.archer-e.archer)*.01,a-=Math.max(0,n.artillery-e.artillery)*.01,Math.max(0,Math.min(1,a))}const I3=Object.freeze(Object.defineProperty({__proto__:null,name:k3,probabilityScore:S3,units:Rh},Symbol.toStringTag,{value:"Module"})),tc=[...[...Array(5)].map((t,e)=>({id:e,type:"tank",col:Math.floor(e/2)-1,row:-6+e%2+Math.floor(e/2),sizeCol:3,sizeRow:3,command:"advance"})),...[...Array(3)].map((t,e)=>({id:e+5,type:"tank",col:(e-1)*2,row:-2,sizeCol:3,sizeRow:3,command:"advance"})),...[...Array(2)].map((t,e)=>({id:e+8,type:"artillery",col:e*4-2,row:2,sizeCol:3,sizeRow:2,command:"advance"})),...[...Array(4)].map((t,e)=>({id:e+10,type:"warrior",col:e<2?-6:6,row:-4+e%2*2,sizeCol:2,sizeRow:2,command:"advance"}))],$3="Cavalry Charge";function N3(t){const e=Qe(tc),n=Qe(t),s=nt(tc),r=nt(t),o=ct(tc),i=ct(t),a=At(tc),l=At(t);let c=.5;return c+=(e.tank-n.tank)*.03,c-=(n.warrior+n.artillery)*.02,c+=(s.front-r.front)*.1,c+=(l-a)*.1,c+=(o-i)*.2,c+=Math.max(0,n.archer-e.archer)*.01,Math.max(0,Math.min(1,c))}const T3=Object.freeze(Object.defineProperty({__proto__:null,name:$3,probabilityScore:N3,units:tc},Symbol.toStringTag,{value:"Module"})),nc=[...[...Array(7)].map((t,e)=>({id:e,type:"artillery",col:e*3-9,row:2,sizeCol:3,sizeRow:2,command:"advance"})),...[...Array(4)].map((t,e)=>({id:e+7,type:"artillery",col:e*4-6,row:0,sizeCol:3,sizeRow:2,command:"advance"})),...[...Array(3)].map((t,e)=>({id:e+11,type:"tank",col:e*6-6,row:-4,sizeCol:4,sizeRow:3,command:"wait-advance"})),...[...Array(5)].map((t,e)=>({id:e+14,type:"warrior",col:e*4-8,row:-6,sizeCol:3,sizeRow:2,command:"wait-advance"}))],E3="Artillery Barrage";function R3(t){const e=Qe(nc),n=Qe(t),s=nt(nc),r=nt(t),o=ct(nc),i=ct(t),a=At(nc),l=At(t);let c=.5;return c+=(e.artillery-n.artillery)*.04,c-=(n.tank+n.warrior)*.02,c+=(l-a)*.15,c+=(r.front-s.front)*.1,c+=(i-o)*.1,c+=Math.max(0,n.archer-e.archer)*.02,c-=Math.max(0,n.tank-e.tank)*.03,Math.max(0,Math.min(1,c))}const A3=Object.freeze(Object.defineProperty({__proto__:null,name:E3,probabilityScore:R3,units:nc},Symbol.toStringTag,{value:"Module"})),Zo=(t,e,n)=>[{id:t,type:"warrior",col:e-1,row:n-1,sizeCol:2,sizeRow:2,command:"advance"},{id:t+1,type:"archer",col:e,row:n,sizeCol:2,sizeRow:2,command:"advance"},{id:t+2,type:"tank",col:e+1,row:n+1,sizeCol:3,sizeRow:3,command:"advance"}],Ah=[...Zo(0,-10,-5),...Zo(3,0,-6),...Zo(6,10,-5),...Zo(9,-8,0),...Zo(12,8,0),...Zo(15,-5,5),...Zo(18,5,5),...[...Array(2)].map((t,e)=>({id:21+e,type:"artillery",col:e*10-5,row:8,sizeCol:3,sizeRow:2,command:"advance"}))],D3="Guerrilla Tactics";function _3(t){const e=Qe(Ah),n=Qe(t),s=nt(t),r=ct(Ah),o=ct(t),i=At(Ah),a=At(t);let l=.5;l+=(i-a)*.2,l+=(Math.abs(s.front-.5)+Math.abs(s.center-.5))*.15,l+=(o-r)*.15;const c=Math.min(e.warrior,e.archer,e.tank,e.artillery)/Math.max(e.warrior,e.archer,e.tank,e.artillery);l+=c*.1;const u=Math.max(n.warrior-e.warrior,n.archer-e.archer,n.tank-e.tank,n.artillery-e.artillery);return l-=Math.max(0,u)*.02,Math.max(0,Math.min(1,l))}const F3=Object.freeze(Object.defineProperty({__proto__:null,name:D3,probabilityScore:_3,units:Ah},Symbol.toStringTag,{value:"Module"})),sc=[...[...Array(12)].map((t,e)=>({id:e,type:"warrior",col:e<3?-6:e<6?e-7.5:e<9?6:7.5-e,row:e<3?e-7.5:e<6?-6:e<9?7.5-e:6,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(3)].map((t,e)=>({id:e+12,type:"tank",col:e===0?-3:e===1?3:0,row:e===0?-3:e===1?3:-3,sizeCol:3,sizeRow:3,command:"wait-advance"})),...[...Array(6)].map((t,e)=>({id:e+15,type:"archer",col:e<3?-2:2,row:e%3-1,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(2)].map((t,e)=>({id:e+21,type:"artillery",col:e*2-1,row:-1,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(3)].map((t,e)=>({id:e+23,type:"warrior",col:(e-1)*2,row:-5,sizeCol:2,sizeRow:2,command:"wait-advance"}))],O3="Fortress Defense";function z3(t){const e=Qe(sc),n=Qe(t),s=nt(sc),r=nt(t),o=ct(sc),i=ct(t),a=At(sc),l=At(t);let c=.5;c+=(l-a)*.2,c+=(e.warrior+e.tank-n.warrior-n.tank)*.02,c+=(e.artillery-n.artillery)*.03,c+=(r.front-s.front)*.15,c+=(s.center-r.center)*.1;const u=e.archer+e.artillery,d=n.archer+n.artillery;return c-=Math.max(0,d-u)*.02,c+=(i-o)*.1,Math.max(0,Math.min(1,c))}const M3=Object.freeze(Object.defineProperty({__proto__:null,name:O3,probabilityScore:z3,units:sc},Symbol.toStringTag,{value:"Module"})),P3=[{id:301,col:-14,row:-2,sizeCol:4,sizeRow:3,type:"tank",command:"flank-left"},{id:302,col:-18,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"flank-left"},{id:303,col:-16,row:2,sizeCol:6,sizeRow:2,type:"warrior",command:"flank-left"},{id:304,col:-4,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:305,col:4,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:306,col:0,row:-6,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:307,col:14,row:-2,sizeCol:4,sizeRow:3,type:"tank",command:"flank-right"},{id:308,col:18,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"flank-right"},{id:309,col:16,row:2,sizeCol:6,sizeRow:2,type:"warrior",command:"flank-right"}],L3="Pincer Attack",B3=t=>{const e=Qe(t),n=nt(t),s=At(t),r=1-(n.left+n.right)/2,o=1-Math.max(Math.abs(e.warrior-e.archer),Math.abs(e.warrior-e.tank),Math.abs(e.warrior-e.artillery),Math.abs(e.archer-e.tank),Math.abs(e.archer-e.artillery),Math.abs(e.tank-e.artillery))/t.length,i=1-s;return(r*.4+o*.3+i*.3)*100},V3=Object.freeze(Object.defineProperty({__proto__:null,name:L3,probabilityScore:B3,units:P3},Symbol.toStringTag,{value:"Module"})),W3=[{id:401,col:-16,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:402,col:0,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:403,col:16,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:404,col:-12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:405,col:0,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:406,col:12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:407,col:0,row:-8,sizeCol:8,sizeRow:2,type:"artillery",command:"advance"},{id:408,col:-16,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:409,col:16,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"}],U3="Shield Wall",G3=t=>{const e=Qe(t),n=nt(t),s=At(t),r=ct(t),o=(e.warrior+e.tank)/t.length,i=n.front,a=s,l=r;return(o*.35+i*.25+a*.2+l*.2)*100},H3=Object.freeze(Object.defineProperty({__proto__:null,name:U3,probabilityScore:G3,units:W3},Symbol.toStringTag,{value:"Module"})),j3=[{id:501,col:-4,row:2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:502,col:4,row:2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:503,col:0,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:504,col:-10,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:505,col:10,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:506,col:0,row:-6,sizeCol:8,sizeRow:2,type:"artillery",command:"advance"},{id:507,col:-16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:508,col:16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"advance"}],K3="Blitzkrieg",X3=t=>{const e=Qe(t),n=nt(t),s=At(t),r=ct(t),o=1-e.tank/t.length,i=1-(n.left+n.right)/2,a=1-s,l=1-r,c=n.front;return(o*.25+i*.2+a*.2+l*.15+c*.2)*100},q3=Object.freeze(Object.defineProperty({__proto__:null,name:K3,probabilityScore:X3,units:j3},Symbol.toStringTag,{value:"Module"})),Y3=[{id:601,col:-16,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:602,col:0,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:603,col:16,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:604,col:-12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:605,col:0,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:606,col:12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:607,col:-16,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"wait-advance"},{id:608,col:0,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"wait-advance"},{id:609,col:16,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"wait-advance"},{id:610,col:-10,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:611,col:10,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"}],Q3="Scorched Earth",J3=t=>{const e=Qe(t),n=nt(t),s=At(t),r=ct(t),o=1-(e.artillery+e.archer)/t.length,i=s,a=n.front,l=r,c=(e.warrior+e.tank)/t.length;return(o*.25+i*.2+a*.2+l*.15+c*.2)*100},Z3=Object.freeze(Object.defineProperty({__proto__:null,name:Q3,probabilityScore:J3,units:Y3},Symbol.toStringTag,{value:"Module"})),eM=[{id:701,col:-8,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"},{id:702,col:8,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"},{id:703,col:-8,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:704,col:0,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:705,col:8,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:706,col:-12,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance-wait"},{id:707,col:12,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance-wait"},{id:708,col:-16,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:709,col:0,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:710,col:16,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"}],tM="Trojan Horse",nM=t=>{const e=Qe(t),n=nt(t),s=At(t),r=ct(t),o=(e.warrior+e.tank)/t.length,i=n.front,a=1-s,l=1-(e.artillery+e.archer)/t.length,c=r;return(o*.3+i*.25+a*.15+l*.2+c*.1)*100},sM=Object.freeze(Object.defineProperty({__proto__:null,name:tM,probabilityScore:nM,units:eM},Symbol.toStringTag,{value:"Module"})),rM=[{id:801,col:0,row:2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:802,col:-4,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:803,col:-8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:804,col:-12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:805,col:-16,row:-6,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:806,col:4,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:807,col:8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:808,col:12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:809,col:16,row:-6,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:810,col:0,row:-4,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"}],oM="Flying V",iM=t=>{const e=Qe(t),n=nt(t),s=At(t),r=ct(t),o=1-(n.left+n.right)/2,i=1-Math.max(Math.abs(e.warrior-e.archer),Math.abs(e.warrior-e.tank),Math.abs(e.warrior-e.artillery),Math.abs(e.archer-e.tank),Math.abs(e.archer-e.artillery),Math.abs(e.tank-e.artillery))/t.length,a=s,l=n.front,c=1-r;return(o*.3+i*.2+a*.15+l*.25+c*.1)*100},aM=Object.freeze(Object.defineProperty({__proto__:null,name:oM,probabilityScore:iM,units:rM},Symbol.toStringTag,{value:"Module"})),lM=[{id:901,col:-8,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:902,col:8,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:903,col:-4,row:-2,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:904,col:4,row:-2,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:905,col:-16,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:906,col:-20,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:907,col:16,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:908,col:20,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:909,col:-12,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:910,col:12,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:911,col:0,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"wait-advance"}],cM="Hammer and Anvil",uM=t=>{const e=Qe(t),n=nt(t),s=At(t),r=ct(t),o=1-(n.left+n.right)/2,i=(e.warrior+e.tank)/t.length,a=1-s,l=n.front,c=r,u=1-(e.artillery+e.archer)/t.length;return(o*.25+i*.2+a*.15+l*.2+c*.1+u*.1)*100},dM=Object.freeze(Object.defineProperty({__proto__:null,name:cM,probabilityScore:uM,units:lM},Symbol.toStringTag,{value:"Module"})),hM=[{id:1001,col:12,row:2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1002,col:8,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1003,col:4,row:-2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1004,col:0,row:-4,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1005,col:-4,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1006,col:-8,row:-8,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1007,col:12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:1008,col:0,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:1009,col:-16,row:-12,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"}],fM="Echelon Formation",pM=t=>{const e=Qe(t),n=nt(t),s=At(t),r=ct(t),o=Math.abs(n.left-n.right),i=1-Math.max(Math.abs(e.warrior-e.archer),Math.abs(e.warrior-e.tank),Math.abs(e.warrior-e.artillery),Math.abs(e.archer-e.tank),Math.abs(e.archer-e.artillery),Math.abs(e.tank-e.artillery))/t.length,a=s,l=1-e.artillery/t.length,c=1-r;return(o*.25+i*.2+a*.2+l*.25+c*.1)*100},mM=Object.freeze(Object.defineProperty({__proto__:null,name:fM,probabilityScore:pM,units:hM},Symbol.toStringTag,{value:"Module"})),gM=[{id:1101,col:-6,row:2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1102,col:6,row:2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1103,col:-8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1104,col:8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1105,col:-6,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1106,col:6,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1107,col:-3,row:-2,sizeCol:3,sizeRow:3,type:"tank",command:"advance"},{id:1108,col:3,row:-2,sizeCol:3,sizeRow:3,type:"tank",command:"advance"},{id:1109,col:-4,row:-4,sizeCol:3,sizeRow:2,type:"archer",command:"advance"},{id:1110,col:4,row:-4,sizeCol:3,sizeRow:2,type:"archer",command:"advance"},{id:1111,col:0,row:-4,sizeCol:4,sizeRow:2,type:"artillery",command:"advance"}],xM="Turtle Formation",yM=t=>{const e=Qe(t),n=nt(t),s=At(t),r=ct(t),o=(e.warrior+e.tank)/t.length,i=1-s,a=r,l=1-e.artillery/t.length,c=1-(e.artillery+e.archer)/t.length,u=n.front;return(o*.25+i*.2+a*.15+l*.2+c*.1+u*.1)*100},wM=Object.freeze(Object.defineProperty({__proto__:null,name:xM,probabilityScore:yM,units:gM},Symbol.toStringTag,{value:"Module"})),vM=[{id:1201,col:-12,row:2,sizeCol:3,sizeRow:2,type:"archer",command:"wait-advance"},{id:1202,col:-4,row:2,sizeCol:3,sizeRow:2,type:"archer",command:"wait-advance"},{id:1203,col:4,row:2,sizeCol:3,sizeRow:2,type:"archer",command:"wait-advance"},{id:1204,col:12,row:2,sizeCol:3,sizeRow:2,type:"archer",command:"wait-advance"},{id:1205,col:-8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1206,col:8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1207,col:-6,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1208,col:6,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1209,col:-8,row:-10,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:1210,col:8,row:-10,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"}],bM="Skirmisher Screen",CM=t=>{const e=Qe(t),n=nt(t),s=At(t),r=ct(t),o=(e.tank+e.artillery)/t.length,i=s,a=r,l=1-e.archer/t.length,c=n.front,u=1-e.warrior/t.length;return(o*.25+i*.2+a*.15+l*.15+c*.15+u*.1)*100},kM=Object.freeze(Object.defineProperty({__proto__:null,name:bM,probabilityScore:CM,units:vM},Symbol.toStringTag,{value:"Module"})),lC=[Gz,Xz,Jz,n3,i3,u3,p3,y3,C3,I3,T3,A3,F3,M3,V3,H3,q3,Z3,sM,aM,dM,mM,wM,kM];/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SM=1e-7,IM=1e-4;class X${constructor(e,n){this.backend=e,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,n){this.dataIdsCount++,this.data.set(e,n)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class zx{refCount(e){return Ln("refCount")}incRef(e){return Ln("incRef")}timerAvailable(){return!0}time(e){return Ln("time")}read(e){return Ln("read")}readSync(e){return Ln("readSync")}readToGPU(e,n){return Ln("readToGPU")}numDataIds(){return Ln("numDataIds")}disposeData(e,n){return Ln("disposeData")}write(e,n,s){return Ln("write")}move(e,n,s,r,o){return Ln("move")}createTensorFromGPUData(e,n,s){return Ln("createTensorFromGPUData")}memory(){return Ln("memory")}floatPrecision(){return Ln("floatPrecision")}epsilon(){return this.floatPrecision()===32?SM:IM}dispose(){return Ln("dispose")}}function Ln(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $M(t){let e=t.length,n=0;for(;e>0;)n=Math.random()*e|0,e--,fa(t,e,n)}function Ei(t,e,n){return Math.max(t,Math.min(e,n))}function Mx(t){return t%2===0?t:t+1}function fa(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function NM(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function I(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Px(t,e,n=""){I(Ue(t,e),()=>n+` Shapes ${t} and ${e} must match`)}function Lx(t){I(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function j(t){if(t.length===0)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function Ue(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function rl(t){return t%1===0}function K0(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function Ma(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function cC(t,e=r=>0,n,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(t()){r();return}i++;const l=e(i);if(n!=null&&i>=n){o();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function q$(t,e){let n=1,s=-1;for(let o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(t[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(t[o]<0)throw Error(`Shapes can not be < 0. Found ${t[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(n===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const r=t.slice();return r[s]=e/n,r}function Ae(t,e){const n=e.length;return t=t==null?e.map((s,r)=>r):[].concat(t),I(t.every(s=>s>=-n&&s<n),()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`),I(t.every(s=>rl(s)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(s=>s<0?n+s:s)}function Vo(t,e){const n=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:Ae(e,t).sort();let i=0;for(let a=0;a<t.length;++a){if(o!=null){if(o[i]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(o[i]==null||o[i]>a)&&t[a]===1&&(n.push(t[a]),s.push(a)),o[i]<=a&&i++}t[a]!==1&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function cn(t,e){return kt(t,e)}function kt(t,e){let n=null;if(t==null||t==="float32")n=new Float32Array(e);else if(t==="int32")n=new Int32Array(e);else if(t==="bool")n=new Uint8Array(e);else if(t==="string")n=new Array(e);else throw new Error(`Unknown data type ${t}`);return n}function TM(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function EM(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function Y$(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function df(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function RM(t){if(t==null)return 0;let e=0;return t.forEach(n=>e+=n.length),e}function fu(t){return typeof t=="string"||t instanceof String}function AM(t){return typeof t=="boolean"}function X0(t){return typeof t=="number"}function bl(t){return Array.isArray(t)?bl(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":X0(t)?"float32":fu(t)?"string":AM(t)?"bool":"float32"}function q0(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Y0(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function pe(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function Q$(t,e,n,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=n[t+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((l,c)=>l*c)*(s?2:1);for(let l=0;l<o;l++)r[l]=Q$(t+l*a,i,n,s)}return r}function Xs(t,e,n=!1){if(t.length===0)return e[0];const s=t.reduce((r,o)=>r*o)*(n?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${n?" for a complex tensor":""}.`);return Q$(0,t,e,n)}function DM(t,e){if(Array.isArray(t))return t;if(e==="float32")return t instanceof Float32Array?t:new Float32Array(t);if(e==="int32")return t instanceof Int32Array?t:new Int32Array(t);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(t));throw new Error(`Unknown dtype ${e}`)}function Bx(t,e){const n=un(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function un(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function J$(t,e){const n=t.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return Xs(t,new Float32Array(n));if(e==="int32")return Xs(t,new Int32Array(n));if(e==="bool")return Xs(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function Xr(t){t.forEach(e=>{I(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function gr(t,e,n){if(e===0)return 0;if(e===1)return t[0];let s=t[t.length-1];for(let r=0;r<t.length-1;++r)s+=n[r]*t[r];return s}function Cl(t,e,n){if(e===0)return[];if(e===1)return[t];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(t/n[r]),t-=s[r]*n[r];return s[s.length-1]=t,s}function Vx(t){return t&&t.then&&typeof t.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uC="tfjsflags";class _M{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=FM,this.populateURLFlags()}setPlatform(e,n){this.platform!=null&&(W().getBool("IS_TEST")||W().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=n}registerFlag(e,n,s){if(this.flagRegistry[e]={evaluationFn:n,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];W().getBool("IS_TEST")||W().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const n=this.evaluateFlag(e);if(Vx(n))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=n,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,n){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=n,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(n)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);uC in e&&e[uC].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=zM(r,o)})}}function FM(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(n,...s)=>(OM(e,s[0],s[1]),s.join("="))),e}function OM(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function zM(t,e){const n=e.toLowerCase();return n==="true"||n==="false"?n==="true":`${+n}`===n?+n:e}function W(){return Z$}let Z$=null;function MM(t){Z$=t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let wg;function e2(){if(wg==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");wg=t}return wg}function PM(){const t=e2();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function Wx(t,e){const n=PM();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const fp="Abs",pu="Acos",mu="Acosh",kl="Add",Ux="AddN",Gx="All",Hx="Any",pp="ArgMax",mp="ArgMin",gu="Asin",xu="Asinh",yu="Atan",wu="Atanh",vu="Atan2",gp="AvgPool",jx="AvgPoolGrad",xp="AvgPool3D",Kx="AvgPool3DGrad",yp="BatchMatMul",wp="BatchToSpaceND",Xx="Bincount",qx="BitwiseAnd",LM="BroadcastTo",t2="BroadcastArgs",bu="Cast",Cu="Ceil",ku="ClipByValue",Yx="Complex",vp="ComplexAbs",bp="Concat",Cp="Conv2D",Qx="Conv2DBackpropFilter",kp="Conv2DBackpropInput",Sp="Conv3D",Jx="Conv3DBackpropFilterV2",Zx="Conv3DBackpropInputV2",Su="Cos",Iu="Cosh",ey="Cumprod",Ip="Cumsum",ty="CropAndResize",ny="DenseBincount",sy="DepthToSpace",$p="DepthwiseConv2dNative",ry="DepthwiseConv2dNativeBackpropFilter",oy="DepthwiseConv2dNativeBackpropInput",n2="Diag",Np="Dilation2D",Q0="Dilation2DBackpropInput",J0="Dilation2DBackpropFilter",BM="Draw",$u="RealDiv",iy="Einsum",Nu="Elu",ay="EluGrad",Tu="Erf",Tp="Equal",Eu="Exp",Ep="ExpandDims",Ru="Expm1",ly="FFT",cy="Fill",uy="FlipLeftRight",Au="Floor",Du="FloorDiv",Rp="FusedBatchNorm",Ap="GatherV2",s2="GatherNd",Dp="Greater",_u="GreaterEqual",Fu="Identity",dy="IFFT",hy="Imag",Ou="IsFinite",zu="IsInf",Mu="IsNan",_p="LeakyRelu",Fp="Less",Op="LessEqual",r2="LinSpace",Pu="Log",Lu="Log1p",zp="LogicalAnd",Mp="LogicalNot",Pp="LogicalOr",VM="LogSoftmax",Lp="LRN",fy="LRNGrad",Bp="Max",Bu="Maximum",Vp="MaxPool",py="MaxPoolGrad",Wp="MaxPool3D",my="MaxPool3DGrad",o2="MaxPoolWithArgmax",Up="Mean",Gp="Min",Vu="Minimum",Hp="MirrorPad",Wu="Mod",i2="Multinomial",Uu="Multiply",jp="Neg",Kp="NotEqual",gy="NonMaxSuppressionV3",xy="NonMaxSuppressionV4",yy="NonMaxSuppressionV5",Xp="OnesLike",qp="OneHot",Yp="Pack",Qp="PadV2",Gu="Pow",Jp="Prelu",Zp="Prod",a2="RaggedGather",l2="RaggedRange",c2="RaggedTensorToTensor",wy="Range",vy="Real",Hu="Reciprocal",ju="Relu",em="Reshape",tm="ResizeNearestNeighbor",by="ResizeNearestNeighborGrad",nm="ResizeBilinear",Cy="ResizeBilinearGrad",Ku="Relu6",sm="Reverse",Xu="Round",qu="Rsqrt",u2="ScatterNd",d2="TensorScatterUpdate",h2="SearchSorted",rm="Select",Yu="Selu",om="Slice",Qu="Sin",Ju="Sinh",Zu="Sign",ed="Sigmoid",td="Softplus",nd="Sqrt",im="Sum",am="SpaceToBatchND",lm="SplitV",cm="Softmax",f2="SparseFillEmptyRows",p2="SparseReshape",m2="SparseSegmentMean",g2="SparseSegmentSum",x2="SparseToDense",sd="SquaredDifference",ky="Square",Sy="StaticRegexReplace",Iy="StridedSlice",y2="StringNGrams",w2="StringSplit",v2="StringToHashBucketFast",rd="Sub",od="Tan",id="Tanh",ad="Tile",$y="TopK",Ny="Transform",Pa="Transpose",Ty="Unique",um="Unpack",dm="UnsortedSegmentSum",hm="ZerosLike",ld="Step",WM="FromPixels",Ey="RotateWithOffset",hf="_FusedMatMul",ff="FusedConv2D",b2="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function es(...t){W().getBool("IS_TEST")||W().getBool("PROD")||console.warn(...t)}function UM(...t){W().getBool("IS_TEST")||W().getBool("PROD")||console.log(...t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pf=Wx("kernelRegistry",()=>new Map),Z0=Wx("gradRegistry",()=>new Map);function dC(t,e){const n=k2(t,e);return pf.get(n)}function hC(t){return Z0.get(t)}function fC(t){const e=pf.entries(),n=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===t&&n.push(i)}return n}function C2(t){const{kernelName:e,backendName:n}=t,s=k2(e,n);pf.has(s)&&es(`The kernel '${e}' for backend '${n}' is already registered`),pf.set(s,t)}function GM(t){const{kernelName:e}=t;Z0.has(e)&&W().getBool("DEBUG")&&es(`Overriding the gradient for '${e}'`),Z0.set(e,t)}function k2(t,e){return`${e}_${t}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S2(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}var I2=at,ws=null;try{ws=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function at(t,e,n){this.low=t|0,this.high=e|0,this.unsigned=!!n}at.prototype.__isLong__;Object.defineProperty(at.prototype,"__isLong__",{value:!0});function Qn(t){return(t&&t.__isLong__)===!0}at.isLong=Qn;var pC={},mC={};function Ki(t,e){var n,s,r;return e?(t>>>=0,(r=0<=t&&t<256)&&(s=mC[t],s)?s:(n=lt(t,(t|0)<0?-1:0,!0),r&&(mC[t]=n),n)):(t|=0,(r=-128<=t&&t<128)&&(s=pC[t],s)?s:(n=lt(t,t<0?-1:0,!1),r&&(pC[t]=n),n))}at.fromInt=Ki;function vs(t,e){if(isNaN(t))return e?fi:bs;if(e){if(t<0)return fi;if(t>=$2)return E2}else{if(t<=-xC)return Un;if(t+1>=xC)return T2}return t<0?vs(-t,e).neg():lt(t%ol|0,t/ol|0,e)}at.fromNumber=vs;function lt(t,e,n){return new at(t,e,n)}at.fromBits=lt;var mf=Math.pow;function Ry(t,e,n){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return bs;if(typeof e=="number"?(n=e,e=!1):e=!!e,n=n||10,n<2||36<n)throw RangeError("radix");var s;if((s=t.indexOf("-"))>0)throw Error("interior hyphen");if(s===0)return Ry(t.substring(1),e,n).neg();for(var r=vs(mf(n,8)),o=bs,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),l=parseInt(t.substring(i,i+a),n);if(a<8){var c=vs(mf(n,a));o=o.mul(c).add(vs(l))}else o=o.mul(r),o=o.add(vs(l))}return o.unsigned=e,o}at.fromString=Ry;function tr(t,e){return typeof t=="number"?vs(t,e):typeof t=="string"?Ry(t,e):lt(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}at.fromValue=tr;var gC=65536,HM=1<<24,ol=gC*gC,$2=ol*ol,xC=$2/2,yC=Ki(HM),bs=Ki(0);at.ZERO=bs;var fi=Ki(0,!0);at.UZERO=fi;var Ea=Ki(1);at.ONE=Ea;var N2=Ki(1,!0);at.UONE=N2;var e1=Ki(-1);at.NEG_ONE=e1;var T2=lt(-1,2147483647,!1);at.MAX_VALUE=T2;var E2=lt(-1,-1,!0);at.MAX_UNSIGNED_VALUE=E2;var Un=lt(0,-2147483648,!1);at.MIN_VALUE=Un;var oe=at.prototype;oe.toInt=function(){return this.unsigned?this.low>>>0:this.low};oe.toNumber=function(){return this.unsigned?(this.high>>>0)*ol+(this.low>>>0):this.high*ol+(this.low>>>0)};oe.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(Un)){var n=vs(e),s=this.div(n),r=s.mul(n).sub(this);return s.toString(e)+r.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var o=vs(mf(e,6),this.unsigned),i=this,a="";;){var l=i.div(o),c=i.sub(l.mul(o)).toInt()>>>0,u=c.toString(e);if(i=l,i.isZero())return u+a;for(;u.length<6;)u="0"+u;a=""+u+a}};oe.getHighBits=function(){return this.high};oe.getHighBitsUnsigned=function(){return this.high>>>0};oe.getLowBits=function(){return this.low};oe.getLowBitsUnsigned=function(){return this.low>>>0};oe.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Un)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,n=31;n>0&&!(e&1<<n);n--);return this.high!=0?n+33:n+1};oe.isZero=function(){return this.high===0&&this.low===0};oe.eqz=oe.isZero;oe.isNegative=function(){return!this.unsigned&&this.high<0};oe.isPositive=function(){return this.unsigned||this.high>=0};oe.isOdd=function(){return(this.low&1)===1};oe.isEven=function(){return(this.low&1)===0};oe.equals=function(e){return Qn(e)||(e=tr(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};oe.eq=oe.equals;oe.notEquals=function(e){return!this.eq(e)};oe.neq=oe.notEquals;oe.ne=oe.notEquals;oe.lessThan=function(e){return this.comp(e)<0};oe.lt=oe.lessThan;oe.lessThanOrEqual=function(e){return this.comp(e)<=0};oe.lte=oe.lessThanOrEqual;oe.le=oe.lessThanOrEqual;oe.greaterThan=function(e){return this.comp(e)>0};oe.gt=oe.greaterThan;oe.greaterThanOrEqual=function(e){return this.comp(e)>=0};oe.gte=oe.greaterThanOrEqual;oe.ge=oe.greaterThanOrEqual;oe.compare=function(e){if(Qn(e)||(e=tr(e)),this.eq(e))return 0;var n=this.isNegative(),s=e.isNegative();return n&&!s?-1:!n&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};oe.comp=oe.compare;oe.negate=function(){return!this.unsigned&&this.eq(Un)?Un:this.not().add(Ea)};oe.neg=oe.negate;oe.add=function(e){Qn(e)||(e=tr(e));var n=this.high>>>16,s=this.high&65535,r=this.low>>>16,o=this.low&65535,i=e.high>>>16,a=e.high&65535,l=e.low>>>16,c=e.low&65535,u=0,d=0,h=0,f=0;return f+=o+c,h+=f>>>16,f&=65535,h+=r+l,d+=h>>>16,h&=65535,d+=s+a,u+=d>>>16,d&=65535,u+=n+i,u&=65535,lt(h<<16|f,u<<16|d,this.unsigned)};oe.subtract=function(e){return Qn(e)||(e=tr(e)),this.add(e.neg())};oe.sub=oe.subtract;oe.multiply=function(e){if(this.isZero())return bs;if(Qn(e)||(e=tr(e)),ws){var n=ws.mul(this.low,this.high,e.low,e.high);return lt(n,ws.get_high(),this.unsigned)}if(e.isZero())return bs;if(this.eq(Un))return e.isOdd()?Un:bs;if(e.eq(Un))return this.isOdd()?Un:bs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(yC)&&e.lt(yC))return vs(this.toNumber()*e.toNumber(),this.unsigned);var s=this.high>>>16,r=this.high&65535,o=this.low>>>16,i=this.low&65535,a=e.high>>>16,l=e.high&65535,c=e.low>>>16,u=e.low&65535,d=0,h=0,f=0,p=0;return p+=i*u,f+=p>>>16,p&=65535,f+=o*u,h+=f>>>16,f&=65535,f+=i*c,h+=f>>>16,f&=65535,h+=r*u,d+=h>>>16,h&=65535,h+=o*c,d+=h>>>16,h&=65535,h+=i*l,d+=h>>>16,h&=65535,d+=s*u+r*c+o*l+i*a,d&=65535,lt(f<<16|p,d<<16|h,this.unsigned)};oe.mul=oe.multiply;oe.divide=function(e){if(Qn(e)||(e=tr(e)),e.isZero())throw Error("division by zero");if(ws){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var n=(this.unsigned?ws.div_u:ws.div_s)(this.low,this.high,e.low,e.high);return lt(n,ws.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?fi:bs;var s,r,o;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return fi;if(e.gt(this.shru(1)))return N2;o=fi}else{if(this.eq(Un)){if(e.eq(Ea)||e.eq(e1))return Un;if(e.eq(Un))return Ea;var i=this.shr(1);return s=i.div(e).shl(1),s.eq(bs)?e.isNegative()?Ea:e1:(r=this.sub(e.mul(s)),o=s.add(r.div(e)),o)}else if(e.eq(Un))return this.unsigned?fi:bs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();o=bs}for(r=this;r.gte(e);){s=Math.max(1,Math.floor(r.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(s)/Math.LN2),l=a<=48?1:mf(2,a-48),c=vs(s),u=c.mul(e);u.isNegative()||u.gt(r);)s-=l,c=vs(s,this.unsigned),u=c.mul(e);c.isZero()&&(c=Ea),o=o.add(c),r=r.sub(u)}return o};oe.div=oe.divide;oe.modulo=function(e){if(Qn(e)||(e=tr(e)),ws){var n=(this.unsigned?ws.rem_u:ws.rem_s)(this.low,this.high,e.low,e.high);return lt(n,ws.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};oe.mod=oe.modulo;oe.rem=oe.modulo;oe.not=function(){return lt(~this.low,~this.high,this.unsigned)};oe.and=function(e){return Qn(e)||(e=tr(e)),lt(this.low&e.low,this.high&e.high,this.unsigned)};oe.or=function(e){return Qn(e)||(e=tr(e)),lt(this.low|e.low,this.high|e.high,this.unsigned)};oe.xor=function(e){return Qn(e)||(e=tr(e)),lt(this.low^e.low,this.high^e.high,this.unsigned)};oe.shiftLeft=function(e){return Qn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?lt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):lt(0,this.low<<e-32,this.unsigned)};oe.shl=oe.shiftLeft;oe.shiftRight=function(e){return Qn(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?lt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):lt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};oe.shr=oe.shiftRight;oe.shiftRightUnsigned=function(e){if(Qn(e)&&(e=e.toInt()),e&=63,e===0)return this;var n=this.high;if(e<32){var s=this.low;return lt(s>>>e|n<<32-e,n>>>e,this.unsigned)}else return e===32?lt(n,0,this.unsigned):lt(n>>>e-32,0,this.unsigned)};oe.shru=oe.shiftRightUnsigned;oe.shr_u=oe.shiftRightUnsigned;oe.toSigned=function(){return this.unsigned?lt(this.low,this.high,!1):this};oe.toUnsigned=function(){return this.unsigned?this:lt(this.low,this.high,!0)};oe.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};oe.toBytesLE=function(){var e=this.high,n=this.low;return[n&255,n>>>8&255,n>>>16&255,n>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};oe.toBytesBE=function(){var e=this.high,n=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,n>>>24,n>>>16&255,n>>>8&255,n&255]};at.fromBytes=function(e,n,s){return s?at.fromBytesLE(e,n):at.fromBytesBE(e,n)};at.fromBytesLE=function(e,n){return new at(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,n)};at.fromBytesBE=function(e,n){return new at(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],n)};const R2=sS(I2),jM=QD({__proto__:null,default:R2},[I2]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oi=R2||jM;function fm(t){return oi.fromString(t,!0,16)}const A2=fm("c3a5c85c97cb3127"),ri=fm("b492b66fbe98f273"),wn=fm("9ae16a3b2f90404f");function t1(t){return t.xor(t.shru(47))}function D2(t,e,n){const s=t.slice(e,e+n);return oi.fromBytes(Array.from(s),!0,!0)}function et(t,e){return D2(t,e,8)}function wC(t,e){return D2(t,e,4)}function jt(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function $o(t,e,n=fm("9ddfea08eb382d69")){let s=t.xor(e).mul(n);s=s.xor(s.shru(47));let r=e.xor(s).mul(n);return r=r.xor(r.shru(47)),r=r.mul(n),r}function KM(t,e,n,s,r,o){r=r.add(t),o=jt(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(n),o=o.add(jt(r,44)),[r.add(s),o.add(i)]}function Zd(t,e,n,s){return KM(et(t,e),et(t,e+8),et(t,e+16),et(t,e+24),n,s)}function XM(t,e=t.length){if(e>=8){const n=wn.add(e*2),s=et(t,0).add(wn),r=et(t,e-8),o=jt(r,37).mul(n).add(s),i=jt(s,25).add(r).mul(n);return $o(o,i,n)}if(e>=4){const n=wn.add(e*2),s=wC(t,0);return $o(s.shl(3).add(e),wC(t,e-4),n)}if(e>0){const n=t[0],s=t[e>>1],r=t[e-1],o=n+(s<<8),i=e+(r<<2);return t1(wn.mul(o).xor(A2.mul(i))).mul(wn)}return wn}function qM(t,e=t.length){const n=wn.add(e*2),s=et(t,0).mul(ri),r=et(t,8),o=et(t,e-8).mul(n),i=et(t,e-16).mul(wn);return $o(jt(s.add(r),43).add(jt(o,30)).add(i),s.add(jt(r.add(wn),18)).add(o),n)}function YM(t,e=t.length){const n=wn.add(e*2),s=et(t,0).mul(wn),r=et(t,8),o=et(t,e-8).mul(n),i=et(t,e-16).mul(wn),a=jt(s.add(r),43).add(jt(o,30)).add(i),l=$o(a,s.add(jt(r.add(wn),18)).add(o),n),c=et(t,16).mul(n),u=et(t,24),d=a.add(et(t,e-32)).mul(n),h=l.add(et(t,e-24)).mul(n);return $o(jt(c.add(u),43).add(jt(d,30)).add(h),c.add(jt(u.add(s),18)).add(d),n)}function QM(t,e=t.length){const n=oi.fromNumber(81,!0);if(e<=32)return e<=16?XM(t,e):qM(t,e);if(e<=64)return YM(t,e);let s=n,r=n.mul(ri).add(113),o=t1(r.mul(wn).add(113)).mul(wn),i=[oi.UZERO,oi.UZERO],a=[oi.UZERO,oi.UZERO];s=s.mul(wn).add(et(t,0));let l=0;const c=(e-1>>6)*64,u=c+(e-1&63)-63;do s=jt(s.add(r).add(i[0]).add(et(t,l+8)),37).mul(ri),r=jt(r.add(i[1]).add(et(t,l+48)),42).mul(ri),s=s.xor(a[1]),r=r.add(i[0]).add(et(t,l+40)),o=jt(o.add(a[0]),33).mul(ri),i=Zd(t,l,i[1].mul(ri),s.add(a[0])),a=Zd(t,l+32,o.add(a[1]),r.add(et(t,l+16))),[o,s]=[s,o],l+=64;while(l!==c);const d=ri.add(o.and(255).shl(1));return l=u,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=jt(s.add(r).add(i[0]).add(et(t,l+8)),37).mul(d),r=jt(r.add(i[1]).add(et(t,l+48)),42).mul(d),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(et(t,l+40))),o=jt(o.add(a[0]),33).mul(d),i=Zd(t,l,i[1].mul(d),s.add(a[0])),a=Zd(t,l+32,o.add(a[1]),r.add(et(t,l+16))),[o,s]=[s,o],$o($o(i[0],a[0],d).add(t1(r).mul(A2)).add(o),$o(i[1],a[1],d).add(s),d)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wo(t,e){return e==="string"?No(t):Xi([t],e)}function JM(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Xi(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Ri(t)),W().getBool("DEBUG")&&TM(t,e),JM(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){const n=new Uint8Array(t.length);for(let s=0;s<n.length;++s)Math.round(t[s])!==0&&(n[s]=1);return n}else throw new Error(`Unknown data type ${e}`)}function Tn(){return W().platform.now()}function No(t,e="utf-8"){return e=e||"utf-8",W().platform.encode(t,e)}function Do(t,e="utf-8"){return e=e||"utf-8",W().platform.decode(t,e)}function Ts(t){return W().platform.isTypedArray!=null?W().platform.isTypedArray(t):S2(t)}function Ri(t,e=[],n=!1){if(e==null&&(e=[]),typeof t=="boolean"||typeof t=="number"||typeof t=="string"||Vx(t)||t==null||Ts(t)&&n)e.push(t);else if(Array.isArray(t)||Ts(t))for(let s=0;s<t.length;++s)Ri(t[s],e,n);else{let s=-1;for(const r of Object.keys(t))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Ri(t[r],e,n)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZM{constructor(e,n){this.backendTimer=e,this.logger=n,n==null&&(this.logger=new tP)}profileKernel(e,n,s){let r;const o=()=>{r=s()};let i;const a=Tn();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const c of r)c.dataSync();i=Promise.resolve({kernelMs:Tn()-a})}if(W().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<r.length;c++){const u=r[c];u.data().then(d=>{eP(d,u.dtype,e)})}return{kernelName:e,outputs:r,inputs:n,timeMs:i.then(c=>c.kernelMs),extraInfo:i.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:n,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),r,i]).then(l=>{this.logger.logKernelProfile(n,a,l[0],l[1],o,l[2])})})}}function eP(t,e,n){if(e!=="float32")return!1;for(let s=0;s<t.length;s++){const r=t[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${n}'`),!0}return!1}class tP{logKernelProfile(e,n,s,r,o,i){const a=typeof r=="number"?Ma(`${r}ms`,9):r.error,l=Ma(e,25),c=n.rank,u=n.size,d=Ma(n.shape.toString(),14);let h="";for(const f in o){const p=o[f];if(p!=null){const g=p.shape||n.shape,x=g.length;h+=`${f}: ${x}D ${x>0?g:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${h}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nP(t,e,n){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<t.length;l++){const c=t[l],u=c.inputs;for(const d in u){const h=u[d];let f=!1;for(let p=0;p<e.length;p++)if(s[h.id]){c.outputs.forEach(g=>s[g.id]=!0),f=!0,r[c.id]=!0;break}if(f)break}}const o={};o[n.id]=!0;const i={};for(let l=t.length-1;l>=0;l--){const c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(o[c.outputs[d].id]){for(const h in u)o[u[h].id]=!0,i[c.id]=!0;break}}const a=[];for(let l=0;l<t.length;l++){const c=t[l];if(r[c.id]&&i[c.id]){const u={};for(const h in c.inputs){const f=c.inputs[h];s[f.id]&&(u[h]=f)}const d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function sP(t,e,n,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(l=>{const c=t[l.id];c!=null?i.push(c):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const l in o.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const c=n(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);const u=o.inputs[l];if(!Ue(c.shape,u.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{const d=t[u.id];t[u.id]=s(d,c),d.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vC=20,jl=3,vg=7;function rP(t,e,n,s){const r=pe(e),o=oP(t,e,n,r),i=e.length,a=Dh(t,e,n,r,o),l=["Tensor"];return s&&(l.push(`  dtype: ${n}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function oP(t,e,n,s){const r=j(e),o=s[s.length-1],i=new Array(o).fill(0),a=e.length,l=n==="complex64"?oc(t):t;if(a>1)for(let c=0;c<r/o;c++){const u=c*o;for(let d=0;d<o;d++)i[d]=Math.max(i[d],rc(l[u+d],0,n).length)}return i}function rc(t,e,n){let s;return Array.isArray(t)?s=`${parseFloat(t[0].toFixed(vg))} + ${parseFloat(t[1].toFixed(vg))}j`:fu(t)?s=`'${t}'`:n==="bool"?s=_2(t):s=parseFloat(t.toFixed(vg)).toString(),Ma(s,e)}function _2(t){return t===0?"false":"true"}function Dh(t,e,n,s,r,o=!0){const i=n==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(n==="complex64"){const g=oc(t);return[rc(g[0],0,n)]}return n==="bool"?[_2(t[0])]:[t[0].toString()]}if(l===1){if(a>vC){const x=jl*i;let m=Array.from(t.slice(0,x)),y=Array.from(t.slice((a-jl)*i,a*i));return n==="complex64"&&(m=oc(m),y=oc(y)),["["+m.map((w,v)=>rc(w,r[v],n)).join(", ")+", ..., "+y.map((w,v)=>rc(w,r[a-jl+v],n)).join(", ")+"]"]}return["["+(n==="complex64"?oc(t):Array.from(t)).map((x,m)=>rc(x,r[m],n)).join(", ")+"]"]}const c=e.slice(1),u=s.slice(1),d=s[0]*i,h=[];if(a>vC){for(let g=0;g<jl;g++){const x=g*d,m=x+d;h.push(...Dh(t.slice(x,m),c,n,u,r,!1))}h.push("...");for(let g=a-jl;g<a;g++){const x=g*d,m=x+d;h.push(...Dh(t.slice(x,m),c,n,u,r,g===a-1))}}else for(let g=0;g<a;g++){const x=g*d,m=x+d;h.push(...Dh(t.slice(x,m),c,n,u,r,g===a-1))}const f=l===2?",":"";h[0]="["+(a>0?h[0]+f:"");for(let g=1;g<h.length-1;g++)h[g]=" "+h[g]+f;let p=`,
`;for(let g=2;g<l;g++)p+=`
`;return h[h.length-1]=" "+h[h.length-1]+"]"+(o?"":p),h}function oc(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tn{constructor(e,n,s){if(this.dtype=n,this.shape=e.slice(),this.size=j(e),s!=null){const r=s.length;I(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(n==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||kt(n,this.size),this.strides=pe(e)}set(e,...n){n.length===0&&(n=[0]),I(n.length===this.rank,()=>`The number of provided coordinates (${n.length}) must match the rank (${this.rank})`);const s=this.locToIndex(n);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let n=0;for(const r of e){if(r<0||r>=this.shape[n]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}n++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let n=e[e.length-1];for(let s=0;s<e.length-1;++s)n+=this.strides[s]*e[s];return n}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const n=new Array(this.shape.length);for(let s=0;s<n.length-1;++s)n[s]=Math.floor(e/this.strides[s]),e-=n[s]*this.strides[s];return n[n.length-1]=e,n}get rank(){return this.shape.length}toTensor(){return Vs().makeTensor(this.values,this.shape,this.dtype)}}let Vs=null,pa=null;function iP(t){Vs=t}function aP(t){pa=t}class Ot{constructor(e,n,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=n||"float32",this.size=j(e),this.strides=pe(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return pa.buffer(this.shape,this.dtype,e)}bufferSync(){return pa.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return Xs(this.shape,e,this.dtype==="complex64")}arraySync(){return Xs(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=Vs().read(this.dataId);if(this.dtype==="string"){const n=await e;try{return n.map(s=>Do(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),Vs().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=Vs().readSync(this.dataId);if(this.dtype==="string")try{return e.map(n=>Do(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await Vs().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),Vs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return pa.print(this,e)}clone(){return this.throwIfDisposed(),pa.clone(this)}toString(e=!1){const n=this.dataSync();return rP(n,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),pa.cast(this,e)}variable(e=!0,n,s){return this.throwIfDisposed(),Vs().makeVariable(this,e,n,s)}}Object.defineProperty(Ot,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function H(){return Wx("Tensor",()=>Ot)}H();class gf extends Ot{constructor(e,n,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=n,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!Ue(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);Vs().disposeTensor(this),this.dataId=e.dataId,Vs().incRef(this,null)}dispose(){Vs().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(gf,Symbol.hasInstance,{value:t=>t instanceof Ot&&t.assign!=null&&t.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var bC;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(bC||(bC={}));var n1;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(n1||(n1={}));var s1;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(s1||(s1={}));var r1;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(r1||(r1={}));var o1;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(o1||(o1={}));const lP={float32:r1,int32:n1,bool:s1,complex64:o1};function Xn(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return lP[t][e]}function Ay(t){return Xn(t,"int32")}function F2(t){return t!=null&&typeof t=="object"&&"texture"in t&&t.texture instanceof WebGLTexture}function O2(t){return typeof GPUBuffer<"u"&&t!=null&&typeof t=="object"&&"buffer"in t&&t.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function It(t,e){if(t.dtype===e.dtype)return[t,e];const n=Xn(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function z2(t){const e=[];return M2(t,e,new Set),e}function M2(t,e,n){if(t==null)return;if(t instanceof Ot){e.push(t);return}if(!cP(t))return;const s=t;for(const r in s){const o=s[r];n.has(o)||(n.add(o),M2(o,e,n))}}function cP(t){return Array.isArray(t)||typeof t=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bg(t){return t.kernelName!=null}class CC{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class il{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new CC}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:n}=this.initializeBackendsAndReturnBest();if(n)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:n}=this.initializeBackend(e);if(n)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,n,s=1){return e in this.registryFactory?(es(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:n,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:n,asyncInit:s}=this.initializeBackend(e);if(!(s?await n:n))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new ZM(this.backendInstance),!0}setupRegisteredKernels(){fC(this.backendName).forEach(n=>{n.setupFunc!=null&&n.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){fC(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const n=this.registryFactory[e];if(n==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=n.factory();if(s&&!(s instanceof zx)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,es(`Initialization of backend ${e} failed`),es(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return es(`Initialization of backend ${e} failed`),es(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,n)=>this.registryFactory[n].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let n=0;n<e.length;n++){const s=e[n],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,n){const s=this.state.tensorInfo.get(n),r=s.backend,o=this.readSync(n),i=r.refCount(n);r.disposeData(n,!0),s.backend=e,e.move(n,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,n){let s=null;if(n==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");n=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof n!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=n(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,n,s){e();try{const r=s();return n(),r}catch(r){throw n(),r}}nextTensorId(){return il.nextTensorId++}nextVariableId(){return il.nextVariableId++}clone(e){const n=_.runKernel(Fu,{x:e}),s={x:e},r=i=>({x:()=>{const a="float32",l={x:i},c={dtype:a};return _.runKernel(bu,l,c)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[n],r,o,{}),n}runKernel(e,n,s){if(this.backendName==null&&this.backend,!(dC(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:n,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,n,s){const r=this.backend.numDataIds();let o=0;s.forEach(l=>{o+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-n-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let n,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const c=bg(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(bg(e)){const{kernelName:p,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;const m=dC(p,this.backendName);I(m!=null,()=>`Cannot find registered kernel '${p}' for backend '${this.backendName}'`),a=()=>{const y=this.backend.numDataIds();l=m.kernelFunc({inputs:g,attrs:x,backend:this.backend});const w=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(p,y,w);const v=w.map(b=>b.rank!=null?b:this.makeTensorFromTensorInfo(b));if(r){const b=this.getTensorsForGradient(p,g,v);s=this.saveTensorsForBackwardMode(b)}return v}}else{const{forwardFunc:p}=e,g=x=>{r&&(s=x.map(m=>this.keep(this.clone(m))))};a=()=>{const x=this.backend.numDataIds();l=this.tidy(()=>p(this.backend,g));const m=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(c,x,m),m}}const{inputs:u,attrs:d}=e,h=bg(e)?null:e.backwardsFunc;let f;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?n=a():(f=this.profiler.profileKernel(c,u,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(f),n=f.outputs)}),r&&this.addTapeNode(c,u,n,h,s,d),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(u).map(p=>u[p]!=null?u[p].shape:null),outputShapes:n.map(p=>p.shape),kernelTimeMs:f.timeMs,extraInfo:f.extraInfo}),Array.isArray(l)?n:n[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,n,s){const r=hC(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(I(Array.isArray(n),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(n).map(c=>n[c])):a=o.map(c=>n[c]);const l=s.filter((c,u)=>i[u]);return a.concat(l)}return[]}makeTensor(e,n,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&fu(e[0])&&(o=e.map(l=>No(l)));const i=r.write(o,n,s),a=new Ot(n,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(i),c=RM(o);this.state.numBytes+=c-l.bytes,l.bytes=c}return a}makeTensorFromDataId(e,n,s,r){s=s||"float32";const o={dataId:e,shape:n,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,n){const{dataId:s,shape:r,dtype:o}=e,i=new Ot(r,o,s,this.nextTensorId());return this.trackTensor(i,n),i}makeVariable(e,n=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new gf(e,n,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,n){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*df(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:n||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof gf||this.track(e)}incRef(e,n){this.trackTensor(e,n),this.backend.incRef(e.dataId)}removeDataId(e,n){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===n&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const n=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=n.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*df(e.dtype);this.state.numBytes-=s}n.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,n.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const n=this.state.registeredVariables[e];this.disposeVariable(n)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const n=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,n,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:n,outputs:s,saved:o},l=hC(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=c=>(c=c.map((u,d)=>{if(u==null){const h=s[d],f=un(h.size,h.dtype);return this.makeTensor(f,h.shape,h.dtype)}return u}),r(c.length>1?c:c[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const n={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(n.name=e),this.state.scopeStack.push(n),this.state.activeScope=n}endScope(e){const n=z2(e),s=new Set(n.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,n,s,r=!1){if(I(n.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));I(o instanceof Ot,()=>"The result y returned by f() must be a tensor.");const i=nP(this.state.activeTape,n,o);if(!r&&i.length===0&&n.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??uP(o.shape),sP(a,i,c=>this.tidy(c),dP);const l=n.map(c=>a[c.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(c=>{for(const u of c.saved)u.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(e){return I(q0(e),()=>"The f passed in customGrad(f) must be a function."),(...n)=>{I(n.every(a=>a instanceof Ot),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};n.forEach((a,l)=>{r[l]=a});const o=(a,l)=>(s=e(...n,l),I(s.value instanceof Ot,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),I(q0(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,l)=>{const c=s.gradFunc(a,l),u=Array.isArray(c)?c:[c];I(u.length===n.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),I(u.every(h=>h instanceof Ot),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const d={};return u.forEach((h,f)=>{d[f]=()=>h}),d};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,n){return this.state.tensorInfo.get(e).backend.readToGPU(e,n)}async time(e){const n=Tn(),s=await this.backend.time(e);return s.wallMs=Tn()-n,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new CC;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}il.nextTensorId=0;il.nextVariableId=0;function uP(t){const e=Bx(j(t),"float32");return _.makeTensor(e,t,"float32")}function P2(){const t=e2();if(t._tfengine==null){const e=new _M(t);t._tfengine=new il(e)}return MM(t._tfengine.ENV),iP(()=>t._tfengine),t._tfengine}const _=P2();function dP(t,e){const n={a:t,b:e};return _.runKernel(kl,n)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hP(){return typeof navigator<"u"&&navigator!=null}function L2(t){if(t||hP()){if(t||(t=navigator),t.product==="ReactNative")return!0;const e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){const n=t;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function B2(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _n=W();_n.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});_n.registerFlag("IS_BROWSER",()=>B2());_n.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");_n.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));_n.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));_n.registerFlag("PROD",()=>!1);_n.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>_n.getBool("DEBUG"));_n.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);_n.registerFlag("IS_TEST",()=>!1);_n.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>_n.getBool("DEBUG"));_n.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);_n.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);_n.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cd(t,e){let n=t;if(Ts(t))return e==="string"?[]:[t.length];if(F2(t)){const r=t.channels||"RGBA";return[t.height,t.width*r.length]}else if(O2(t))return[t.buffer.size/(e==null?4:df(e))];if(!Array.isArray(t))return[];const s=[];for(;Array.isArray(n)||Ts(n)&&e!=="string";)s.push(n.length),n=n[0];return Array.isArray(t)&&W().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&V2(t,s,[]),s}function V2(t,e,n){if(n=n||[],!Array.isArray(t)&&!Ts(t)){I(e.length===0,()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}I(e.length>0,()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`),I(t.length===e[0],()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);const s=e.slice(1);for(let r=0;r<t.length;++r)V2(t[r],s,n.concat(r))}function kC(t,e,n,s){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function T(t,e,n,s="numeric"){if(t instanceof H())return kC(s,t.dtype,e,n),t;let r=bl(t);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),kC(s,r,e,n),t==null||!Ts(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){const l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${l}'`)}const o=cd(t,r);!Ts(t)&&!Array.isArray(t)&&(t=[t]);const a=r!=="string"?Xi(t,r):Ri(t,[],!0);return _.makeTensor(a,o,r)}function W2(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((o,i)=>T(o,`${e}[${i}]`,n,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fP="__op";function O(t){const e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n=n+fP;const r=(...o)=>{_.startScope(n);try{const i=s(...o);return Vx(i)&&console.error("Cannot return a Promise inside of tidy."),_.endScope(i),i}catch(i){throw _.endScope(null),i}};return Object.defineProperty(r,"name",{value:n,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pP(t,e){const n=T(t,"real","complex"),s=T(e,"imag","complex");Px(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:n,imag:s};return _.runKernel(Yx,r)}const Ai=O({complex_:pP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ud(t,e,n,s){if(s==null)s=bl(t);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(O2(t)||F2(t)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return _.backend.createTensorFromGPUData(t,e||n,s)}if(!Ts(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){Xr(e);const r=j(e),o=j(n);I(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<n.length;++i){const a=n[i],l=i===n.length-1?a!==j(e.slice(i)):!0;I(n[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `)}}return!Ts(t)&&!Array.isArray(t)&&(t=[t]),e=e||n,t=s!=="string"?Xi(t,s):Ri(t,[],!0),_.makeTensor(t,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bc(t,e,n){const s=cd(t,n);return ud(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xf={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class Uo{static join(e){return new Uo(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Ts(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let n=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=n+r.byteLength;this.shards.push({buffer:r,start:n,end:o}),n=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,n=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,n=isNaN(Number(n))?0:n,e=Math.max(0,e),n=Math.min(this.byteLength,n),n<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=n-e,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let l=s;l<this.shards.length;l++){const c=this.shards[l],d=e+a-c.start,h=a,p=Math.min(n,c.end)-c.start,g=new Uint8Array(c.buffer,d,p-d);if(i.set(g,h),a+=g.length,n<c.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function n(r){return e<r.start?-1:e>=r.end?1:0}if(n(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=mP(this.shards,n);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function mP(t,e){let n=0,s=t.length;for(;n<=s;){const r=Math.floor((s-n)/2)+n,o=e(t[r]);if(o===0)return r;o<0?s=r:n=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function or(){return _}function SC(){return _.memory()}function P(t,e){return _.tidy(t,e)}function Ne(t){z2(t).forEach(n=>n.dispose())}function xr(t){return _.keep(t)}function U2(t,e,n=1){return _.registerBackend(t,e,n)}function gP(){return _.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const al=4;async function IC(t,e){const n=[],s=[],r=Array.isArray(t)?t.map(i=>i.name):Object.keys(t);for(let i=0;i<r.length;++i){const a=r[i],l=Array.isArray(t)?t[i].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const u=new Promise(async d=>{const h=await l.bytes(),f=h.reduce((x,m)=>x+m.length,0)+al*h.length,p=new Uint8Array(f);let g=0;for(let x=0;x<h.length;x++){const m=h[x],y=new Uint8Array(new Uint32Array([m.length]).buffer);p.set(y,g),g+=al,p.set(m,g),g+=m.length}d(p)});s.push(u)}else s.push(l.data());e!=null&&(c.group=e),n.push(c)}const o=await Promise.all(s);return{data:vP(o),specs:n}}function xP(t,e){const n=new Uo(t),s={};let r=0;for(const o of e){const i=yP(o,(a,l)=>n.slice(r+a,r+l));s[o.name]=wP(o,n.slice(r,r+i)),r+=i}return s}function yP(t,e){const n=j(t.shape);let s;if("quantization"in t){const r=t.quantization;s=xf[r.dtype]}else if(t.dtype==="string"){let r=0;for(let o=0;o<n;o++)r+=al+new Uint32Array(e(r,r+al))[0];return r}else s=xf[t.dtype];return n*s}function wP(t,e){const n=t.name,s=t.dtype,r=t.shape,o=j(r);let i,a=0;if("quantization"in t){const l=t.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${t.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${t.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${t.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const c=xf[l.dtype],u=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){i=new Float32Array(u.length);for(let d=0;d<u.length;d++){const h=u[d];i[d]=h*l.scale+l.min}}else if(l.dtype==="float16")i=RP()(u);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);i=new Int32Array(u.length);for(let d=0;d<u.length;d++){const h=u[d];i[d]=Math.round(h*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=o*c}else if(s==="string"){const l=j(t.shape);i=[];for(let c=0;c<l;c++){const u=new Uint32Array(e.slice(a,a+al))[0];a+=al;const d=new Uint8Array(e.slice(a,a+u));i.push(d),a+=u}}else{const l=xf[s];if(s==="float32")i=new Float32Array(e);else if(s==="int32")i=new Int32Array(e);else if(s==="bool")i=new Uint8Array(e);else if(s==="complex64"){i=new Float32Array(e);const c=new Float32Array(i.length/2),u=new Float32Array(i.length/2);for(let p=0;p<c.length;p++)c[p]=i[p*2],u[p]=i[p*2+1];const d=bc(c,r,"float32"),h=bc(u,r,"float32"),f=Ai(d,h);return d.dispose(),h.dispose(),f}else throw new Error(`Unsupported dtype in weight '${n}': ${s}`);a+=o*l}return bc(i,r,s)}function vP(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach(o=>{if(e+=o.byteLength,n.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return n.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const Dy=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function $C(t){return Dy?Buffer.byteLength(t,"utf8"):new Blob([t]).size}function bP(t){if(Dy)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,r=e.length;s<r;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function CP(t){if(Dy){const s=Buffer.from(t,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function kP(t){return Uo.join(t)}function SP(t,e){const n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),n}function IP(t,e,n){const s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(s.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!n)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=n}return t.signature!=null&&(s.signature=t.signature),t.userDefinedMetadata!=null&&(s.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(s.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(s.initializerSignature=t.initializerSignature),s}async function $P(t,e){let n,s;return t.weightsManifest!=null&&([n,s]=await e(t.weightsManifest)),IP(t,n,s)}function _y(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:$C(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:$C(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:new Uo(t.weightData).byteLength}}function NC(t){const e=[];for(const n of t)e.push(...n.weights);return e}function NP(){const t=n=>{let s=n<<13,r=0;for(;!(s&8388608);)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let n=1;n<1024;n++)e[n]=t(n);for(let n=1024;n<2048;n++)e[n]=939524096+(n-1024<<13);return e}function TP(){const t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function EP(){const t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function RP(){const t=NP(),e=TP(),n=EP();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let i=0;i<s.length;i++){const a=s[i],l=t[n[a>>10]+(a&1023)]+e[a>>10];o[i]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gt{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Gt.instance==null&&(Gt.instance=new Gt),Gt.instance}static registerSaveRouter(e){Gt.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Gt.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Gt.getHandlers(e,"save")}static getLoadHandlers(e,n){return Gt.getHandlers(e,"load",n)}static getHandlers(e,n,s){const r=[];return(n==="load"?Gt.getInstance().loadRouters:Gt.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&r.push(a)}),r}}const AP=t=>Gt.getSaveHandlers(t),DP=(t,e)=>Gt.getLoadHandlers(t,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i1="tensorflowjs",a1=1,pi="models_store",ho="model_info_store";function G2(){if(!W().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function l1(t){const e=t.result;e.createObjectStore(pi,{keyPath:"modelPath"}),e.createObjectStore(ho,{keyPath:"modelPath"})}class Di{constructor(e){if(this.indexedDB=G2(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,n){return new Promise((s,r)=>{const o=this.indexedDB.open(i1,a1);o.onupgradeneeded=()=>l1(o),o.onsuccess=()=>{const i=o.result;if(n==null){const a=i.transaction(pi,"readonly"),c=a.objectStore(pi).get(this.modelPath);c.onsuccess=()=>{if(c.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(c.result.modelArtifacts)},c.onerror=u=>(i.close(),r(c.error)),a.oncomplete=()=>i.close()}else{n.weightData=Uo.join(n.weightData);const a=_y(n),l=i.transaction(ho,"readwrite");let c=l.objectStore(ho),u;try{u=c.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(h){return r(h)}let d;u.onsuccess=()=>{d=i.transaction(pi,"readwrite");const h=d.objectStore(pi);let f;try{f=h.put({modelPath:this.modelPath,modelArtifacts:n,modelArtifactsInfo:a})}catch(p){return r(p)}f.onsuccess=()=>s({modelArtifactsInfo:a}),f.onerror=p=>{c=l.objectStore(ho);const g=c.delete(this.modelPath);g.onsuccess=()=>(i.close(),r(f.error)),g.onerror=x=>(i.close(),r(f.error))}},u.onerror=h=>(i.close(),r(u.error)),l.oncomplete=()=>{d==null?i.close():d.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}Di.URL_SCHEME="indexeddb://";const H2=t=>W().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Di.URL_SCHEME)?_P(t.slice(Di.URL_SCHEME.length)):null;Gt.registerSaveRouter(H2);Gt.registerLoadRouter(H2);function _P(t){return new Di(t)}function FP(t){return t.startsWith(Di.URL_SCHEME)?t.slice(Di.URL_SCHEME.length):t}class OP{constructor(){this.indexedDB=G2()}async listModels(){return new Promise((e,n)=>{const s=this.indexedDB.open(i1,a1);s.onupgradeneeded=()=>l1(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(ho,"readonly"),a=o.objectStore(ho).getAll();a.onsuccess=()=>{const l={};for(const c of a.result)l[c.modelPath]=c.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),n(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>n(s.error)})}async removeModel(e){return e=FP(e),new Promise((n,s)=>{const r=this.indexedDB.open(i1,a1);r.onupgradeneeded=()=>l1(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(ho,"readwrite"),a=i.objectStore(ho),l=a.get(e);let c;l.onsuccess=()=>{if(l.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const u=a.delete(e),d=()=>{c=o.transaction(pi,"readwrite");const f=c.objectStore(pi).delete(e);f.onsuccess=()=>n(l.result.modelArtifactsInfo),f.onerror=p=>s(l.error)};u.onsuccess=d,u.onerror=h=>(d(),o.close(),s(l.error))}},l.onerror=u=>(o.close(),s(l.error)),i.oncomplete=()=>{c==null?o.close():c.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _r="/",ma="tensorflowjs_models",j2="info",zP="model_topology",MP="weight_specs",PP="weight_data",LP="model_metadata";function K2(t){return{info:[ma,t,j2].join(_r),topology:[ma,t,zP].join(_r),weightSpecs:[ma,t,MP].join(_r),weightData:[ma,t,PP].join(_r),modelMetadata:[ma,t,LP].join(_r)}}function X2(t){for(const e of Object.values(t))window.localStorage.removeItem(e)}function BP(t){const e=t.split(_r);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(_r)}function VP(t){return t.startsWith(_i.URL_SCHEME)?t.slice(_i.URL_SCHEME.length):t}class _i{constructor(e){if(!W().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=K2(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=_y(e),o=Uo.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,bP(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw X2(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const n={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);n.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);n.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);n.format=a.format,n.generatedBy=a.generatedBy,n.convertedBy=a.convertedBy,a.signature!=null&&(n.signature=a.signature),a.userDefinedMetadata!=null&&(n.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(n.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(n.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(n.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return n.weightData=CP(i),n}}_i.URL_SCHEME="localstorage://";const q2=t=>W().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(_i.URL_SCHEME)?WP(t.slice(_i.URL_SCHEME.length)):null;Gt.registerSaveRouter(q2);Gt.registerLoadRouter(q2);function WP(t){return new _i(t)}class UP{constructor(){I(W().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),I(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},n=ma+_r,s=_r+j2;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(n)&&o.endsWith(s)){const i=BP(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=VP(e);const n=K2(e);if(this.LS.getItem(n.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(n.info));return X2(n),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TC="://";class ir{constructor(){this.managers={}}static getInstance(){return ir.instance==null&&(ir.instance=new ir),ir.instance}static registerManager(e,n){I(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(TC)&&(e=e.slice(0,e.indexOf(TC))),I(e.length>0,()=>"scheme must not be an empty string.");const s=ir.getInstance();I(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=n}static getManager(e){const n=ir.getInstance().managers[e];if(n==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return n}static getSchemes(){return Object.keys(ir.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GP{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,n){return fetch(e,n)}now(){return performance.now()}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${n}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,n){return new TextDecoder(n).decode(e)}setTimeoutCustom(e,n){if(typeof window>"u"||!W().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,n);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},n),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return S2(e)}}if(W().get("IS_BROWSER")){W().setPlatform("browser",new GP);try{ir.registerManager(_i.URL_SCHEME,new UP)}catch{}try{ir.registerManager(Di.URL_SCHEME,new OP)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HP={importFetch:()=>require("node-fetch")};let Cg;class jP{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,n){return W().global.fetch!=null?W().global.fetch(e,n):(Cg==null&&(Cg=HP.importFetch()),Cg(e,n))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,n){if(n!=="utf-8"&&n!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${n}`);return this.textEncoder.encode(e)}decode(e,n){return e.length===0?"":new this.util.TextDecoder(n).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}W().get("IS_NODE")&&!W().get("IS_BROWSER")&&W().setPlatform("node",new jP);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Re(t,e="float32",n){return e=e||"float32",Xr(t),new tn(t,e,n)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KP(t,e){const n=T(t,"x","cast");if(!EM(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&n.dtype!=="string"||e!=="string"&&n.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:n},r={dtype:e};return _.runKernel(bu,s,r)}const le=O({cast_:KP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XP(t){const n={x:T(t,"x","clone","string_or_numeric")};return _.runKernel(Fu,n)}const bi=O({clone_:XP});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qP(t,e=!1){console.log(t.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */P2();const YP={buffer:Re,cast:le,clone:bi,print:qP};aP(YP);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QP(t,e){let n=T(t,"a","add"),s=T(e,"b","add");[n,s]=It(n,s);const r={a:n,b:s};return _.runKernel(kl,r)}const Z=O({add_:QP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JP(t,e){let n=T(t,"a","floorDiv"),s=T(e,"b","floorDiv");[n,s]=It(n,s);const r={a:n,b:s};return _.runKernel(Du,r)}const Y2=O({floorDiv_:JP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZP(t,e){let n=T(t,"a","div"),s=T(e,"b","div");if([n,s]=It(n,s),n.dtype==="int32"&&s.dtype==="int32")return Y2(n,s);const r={a:n,b:s},o={};return _.runKernel($u,r,o)}const ge=O({div_:ZP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eL(t,e){let n=T(t,"a","mul"),s=T(e,"b","mul");[n,s]=It(n,s);const r={a:n,b:s};return _.runKernel(Uu,r)}const D=O({mul_:eL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tL(t){const e=T(t,"x","abs");if(e.dtype==="complex64"){const n={x:e};return _.runKernel(vp,n)}else{const n={x:e};return _.runKernel(fp,n)}}const xn=O({abs_:tL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nL(t){const n={x:T(t,"x","acos")};return _.runKernel(pu,n)}const sL=O({acos_:nL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rL(t){const n={x:T(t,"x","acosh")};return _.runKernel(mu,n)}const oL=O({acosh_:rL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iL(t,e=null,n=!1){const r={x:T(t,"x","all","bool")},o={axis:e,keepDims:n};return _.runKernel(Gx,r,o)}const Q2=O({all_:iL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aL(t,e=null,n=!1){const r={x:T(t,"x","any","bool")},o={axis:e,keepDims:n};return _.runKernel(Hx,r,o)}const c1=O({any_:aL});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(t,e=0){const s={x:T(t,"x","argMax")},r={axis:e};return _.runKernel(pp,s,r)}const Hc=O({argMax_:lL});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cL(t,e=0){const s={x:T(t,"x","argMin")},r={axis:e};return _.runKernel(mp,s,r)}const uL=O({argMin_:cL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dL(t){const n={x:T(t,"x","asin")};return _.runKernel(gu,n)}const hL=O({asin_:dL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fL(t){const n={x:T(t,"x","asinh")};return _.runKernel(xu,n)}const pL=O({asinh_:fL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mL(t){const n={x:T(t,"x","atan")};return _.runKernel(yu,n)}const gL=O({atan_:mL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xL(t,e){let n=T(t,"a","atan2"),s=T(e,"b","atan2");[n,s]=It(n,s);const r={a:n,b:s};return _.runKernel(vu,r)}const yL=O({atan2_:xL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wL(t){const n={x:T(t,"x","atanh")};return _.runKernel(wu,n)}const vL=O({atanh_:wL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dd(t,e,n,s,r="NHWC",o){const i=t[3],a=[...e,i],l=Yr(r);return nn(t,a,n,o,s,null,null,l)}function Rs(t,e,n,s,r,o,i="channelsLast"){const[a,l]=jc(e);let c;if(i==="channelsLast")c=[a,l,t[3],t[3]];else if(i==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return nn(t,c,n,s,r,o,!1,i)}function qr(t,e,n,s,r,o,i="NDHWC"){const[a,l,c]=u1(e);let u,d;if(i==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(i==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return Go(t,u,n,s,r,!1,d,o)}function nn(t,e,n,s,r,o,i=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);const[h,f,,p]=e,[g,x]=jc(n),[m,y]=jc(s),w=La(h,m),v=La(f,y),{padInfo:b,outHeight:C,outWidth:k}=kL(r,c,u,g,x,w,v,o,a),S=i?p*d:p;let $;return a==="channelsFirst"?$=[l,S,C,k]:a==="channelsLast"&&($=[l,C,k,S]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:C,outWidth:k,outChannels:S,padInfo:b,strideHeight:g,strideWidth:x,filterHeight:h,filterWidth:f,effectiveFilterHeight:w,effectiveFilterWidth:v,dilationHeight:m,dilationWidth:y,inShape:t,outShape:$,filterShape:e}}function Go(t,e,n,s,r,o=!1,i="channelsLast",a){let[l,c,u,d,h]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,c,u,d,h]=t;else if(i==="channelsFirst")[l,h,c,u,d]=t;else throw new Error(`Unknown dataFormat ${i}`);const[f,p,g,,x]=e,[m,y,w]=u1(n),[v,b,C]=u1(s),k=La(f,v),S=La(p,b),$=La(g,C),{padInfo:N,outDepth:A,outHeight:M,outWidth:L}=SL(r,c,u,d,m,y,w,k,S,$,a),V=o?x*h:x;let B;return i==="channelsFirst"?B=[l,V,A,M,L]:i==="channelsLast"&&(B=[l,A,M,L,V]),{batchSize:l,dataFormat:i,inDepth:c,inHeight:u,inWidth:d,inChannels:h,outDepth:A,outHeight:M,outWidth:L,outChannels:V,padInfo:N,strideDepth:m,strideHeight:y,strideWidth:w,filterDepth:f,filterHeight:p,filterWidth:g,effectiveFilterDepth:k,effectiveFilterHeight:S,effectiveFilterWidth:$,dilationDepth:v,dilationHeight:b,dilationWidth:C,inShape:t,outShape:B,filterShape:e}}function bL(t,e,n,s,r){s==null&&(s=Fy(t,e,n));const o=t[0],i=t[1],a=Kc((o-e+2*s)/n+1,r),l=Kc((i-e+2*s)/n+1,r);return[a,l]}function CL(t,e,n,s,r,o){r==null&&(r=Fy(t,e[0],s[0]));const i=[0,0,0,n];for(let a=0;a<3;a++)t[a]+2*r>=e[a]&&(i[a]=Kc((t[a]-e[a]+2*r)/s[a]+1,o));return i}function Fy(t,e,n,s=1){const r=La(e,s);return Math.floor((t[0]*(n-1)-n+r)/2)}function jc(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function u1(t){return typeof t=="number"?[t,t,t]:t}function La(t,e){return e<=1?t:t+(t-1)*(e-1)}function kL(t,e,n,s,r,o,i,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};const f=bL([e,n],o,s,t,a);u=f[0],d=f[1]}else if(t==="same"){u=Math.ceil(e/s),d=Math.ceil(n/r);const h=Math.max(0,(u-1)*s+o-e),f=Math.max(0,(d-1)*r+i-n),p=Math.floor(h/2),g=h-p,x=Math.floor(f/2),m=f-x;c={top:p,bottom:g,left:x,right:m,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((e-o+1)/s),d=Math.ceil((n-i+1)/r);else if(typeof t=="object"){const h=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],p=l==="channelsLast"?t[2][0]:t[3][0],g=l==="channelsLast"?t[2][1]:t[3][1];c={top:h,bottom:f,left:p,right:g,type:h===0&&f===0&&p===0&&g===0?"VALID":"EXPLICIT"},u=Kc((e-o+h+f)/s+1,a),d=Kc((n-i+p+g)/r+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function SL(t,e,n,s,r,o,i,a,l,c,u){let d,h,f,p;if(t==="valid"&&(t=0),typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};const x=CL([e,n,s,1],[a,l,c],1,[r,o,i],t,u);h=x[0],f=x[1],p=x[2]}else if(t==="same"){h=Math.ceil(e/r),f=Math.ceil(n/o),p=Math.ceil(s/i);const g=(h-1)*r+a-e,x=(f-1)*o+l-n,m=(p-1)*i+c-s,y=Math.floor(g/2),w=g-y,v=Math.floor(x/2),b=x-v,C=Math.floor(m/2),k=m-C;d={top:v,bottom:b,left:C,right:k,front:y,back:w,type:"SAME"}}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:h,outHeight:f,outWidth:p}}function Kc(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Fi(t){const[e,n,s]=jc(t);return e===1&&n===1&&s===1}function hn(t,e){return Fi(t)||Fi(e)}function Oi(t){return jc(t).every(e=>e>0)}function Yr(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Mn(t,e,n){if(n!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);if(typeof e=="number")I(rl(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{I(rl(r),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${n} but got pad ${r}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IL(t,e){const s={x:T(t,"x","reshape","string_or_numeric")},r={shape:e};return _.runKernel(em,s,r)}const F=O({reshape_:IL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $L(t,e,n,s,r){const o=T(t,"x","avgPool","float32"),i=1;I(hn(n,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`);let a=o,l=!1;o.rank===3&&(l=!0,a=F(o,[1,o.shape[0],o.shape[1],o.shape[2]])),I(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),Mn("avgPool",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r};let d=_.runKernel(gp,c,u);return d=le(d,o.dtype),l?F(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Oy=O({avgPool_:$L});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NL(t,e,n,s,r,o="NDHWC"){const i=T(t,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=F(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),I(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),I(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),I(typeof n=="number"&&n>0||Array.isArray(n)&&n[0]>0&&n[1]>0&&n[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${n}'`),Mn("avgPool3d",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:o};let d=_.runKernel(xp,c,u);return d=le(d,a.dtype),l?F(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const TL=O({avgPool3d_:NL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EL(t,e=0){I(t.length>=1,()=>"Pass at least one tensor to concat");const n=W2(t,"tensors","concat","string_or_numeric");if(n[0].dtype==="complex64"&&n.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),n.length===1)return bi(n[0]);const s=n,r={axis:e};return _.runKernel(bp,s,r)}const Dn=O({concat_:EL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RL(t,e,n=!1,s=!1){let r=T(t,"a","matMul"),o=T(e,"b","matMul");[r,o]=It(r,o);const i={a:r,b:o},a={transposeA:n,transposeB:s};return _.runKernel(yp,i,a)}const Ve=O({matMul_:RL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AL(t){const n={x:T(t,"x","sigmoid","float32")};return _.runKernel(ed,n)}const Sl=O({sigmoid_:AL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DL(t,e,n){const s=T(t,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:n};return _.runKernel(om,r,o)}const tt=O({slice_:DL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _L(t){const n={x:T(t,"x","tanh","float32")};return _.runKernel(id,n)}const pm=O({tanh_:_L});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FL(t,e,n){const s=T(t,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);I(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),I(n.length===e.length,()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`),I(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:n};return _.runKernel(wp,o,i)}const zy=O({batchToSpaceND_:FL});function OL(t){let e;return t.rank===0||t.rank===1?e=F(t,[1,1,1,t.size]):t.rank===2?e=F(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=F(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zL(t,e,n,s,r,o){o==null&&(o=.001);const i=T(t,"x","batchNorm"),a=T(e,"mean","batchNorm"),l=T(n,"variance","batchNorm");let c;r!=null&&(c=T(r,"scale","batchNorm"));let u;s!=null&&(u=T(s,"offset","batchNorm")),I(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),I(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),I(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const h={x:OL(i),scale:c,offset:u,mean:a,variance:l},f={varianceEpsilon:o},p=_.runKernel(Rp,h,f);return F(p,i.shape)}const mm=O({batchNorm_:zL});function ML(t,e,n,s,r,o){const i=T(t,"x","batchNorm"),a=T(e,"mean","batchNorm"),l=T(n,"variance","batchNorm");let c;r!=null&&(c=T(r,"scale","batchNorm"));let u;return s!=null&&(u=T(s,"offset","batchNorm")),I(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),I(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),I(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&I(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&I(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),mm(i,a,l,u,c,o)}const PL=O({batchNorm2d_:ML});function LL(t,e,n,s,r,o){const i=T(t,"x","batchNorm"),a=T(e,"mean","batchNorm"),l=T(n,"variance","batchNorm");let c;r!=null&&(c=T(r,"scale","batchNorm"));let u;return s!=null&&(u=T(s,"offset","batchNorm")),I(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),I(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),I(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&I(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&I(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),mm(i,a,l,u,c,o)}const BL=O({batchNorm3d_:LL});function VL(t,e,n,s,r,o){const i=T(t,"x","batchNorm"),a=T(e,"mean","batchNorm"),l=T(n,"variance","batchNorm");let c;r!=null&&(c=T(r,"scale","batchNorm"));let u;return s!=null&&(u=T(s,"offset","batchNorm")),I(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),I(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),I(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&I(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&I(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),mm(i,a,l,u,c,o)}const WL=O({batchNorm4d_:VL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UL(t,e,n){const s=T(t,"x","bincount"),r=T(e,"weights","bincount");I(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),I(n>=0,()=>`size must be non-negative, but got ${n}.`),I(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:n};return _.runKernel(Xx,o,i)}const GL=O({bincount_:UL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HL(t,e){let n=T(t,"broadcastTo","x");const s=n.shape;if(Xr(e),e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const c=n.shape.slice();for(;c.length<e.length;)c.unshift(1);n=F(n,c)}const r=n.shape,o=Array.from(e);for(let c=e.length-1;c>=0;c--)if(r[c]===e[c])o[c]=1;else if(n.shape[c]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return bi(n);const a={x:n},l={reps:o};return _.runKernel(ad,a,l)}const Cc=O({broadcastTo_:HL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jL(t){const n={x:T(t,"x","ceil","float32")};return _.runKernel(Cu,n)}const KL=O({ceil_:jL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gm(t,e,n){Xr(t),n=n||bl(e);const s={shape:t,value:e,dtype:n};return _.runKernel(cy,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XL(t,e,n){const s=T(t,"x","clipByValue");if(I(e<=n,()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`),e===n)return gm(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:n};return _.runKernel(ku,r,o)}const as=O({clipByValue_:XL});function qL(t){return Dn(t,0)}const YL=O({concat1d_:qL});function QL(t,e){return Dn(t,e)}const JL=O({concat2d_:QL});function ZL(t,e){return Dn(t,e)}const e4=O({concat3d_:ZL});function t4(t,e){return Dn(t,e)}const n4=O({concat4d_:t4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s4(t,e,n,s,r="NHWC",o=[1,1],i){const a=T(t,"x","conv2d","float32"),l=T(e,"filter","conv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=F(a,[1,a.shape[0],a.shape[1],a.shape[2]])),I(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),I(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),Mn("conv2d",s,i);const d=r==="NHWC"?c.shape[3]:c.shape[1];I(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),I(hn(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),I(Oi(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),I(Oi(n),()=>"Error in conv2D: Strides should be larger than 0.");const h={x:c,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},p=_.runKernel(Cp,h,f);return u?F(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const zi=O({conv2d_:s4});function r4(t,e,n,s,r="NWC",o=1,i){const a=T(t,"x","conv1d"),l=T(e,"filter","conv1d");let c=a,u=!1;a.rank===2&&(u=!0,c=F(a,[1,a.shape[0],a.shape[1]])),I(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),I(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),Mn("conv1d",s,i),I(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),I(hn(n,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${o}'`),I(Oi(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),I(Oi(n),()=>"Error in conv1D: Stride should be larger than 0."),I(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const d=F(l,[1,l.shape[0],l.shape[1],l.shape[2]]),h=F(c,[c.shape[0],1,c.shape[1],c.shape[2]]),x=zi(h,d,[1,n],s,"NHWC",[1,o],i);return u?F(x,[x.shape[2],x.shape[3]]):F(x,[x.shape[0],x.shape[2],x.shape[3]])}const J2=O({conv1d_:r4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o4(t,e,n,s,r,o="NHWC",i){I(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,c=!1;e.rank===3&&(c=!0,l=F(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),I(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),I(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),I(n.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`);const u=o==="NHWC"?a[3]:a[1],d=o==="NHWC"?l.shape[3]:l.shape[1];I(u===n.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[2]}.`),I(d===n.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${n.shape[3]}.`),Mn("conv2dDerInput",r,i);const h={dy:l,filter:n},f={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},p=_.runKernel(kp,h,f);return c?F(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const My=O({conv2DBackpropInput_:o4});function i4(t,e,n,s,r,o){const i=T(t,"x","conv2dTranspose"),a=T(e,"filter","conv2dTranspose");return My(n,i,a,s,r,"NHWC",o)}const Z2=O({conv2dTranspose_:i4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a4(t,e,n,s,r="NDHWC",o=[1,1,1]){const i=T(t,"x","conv3d"),a=T(e,"filter","conv3d");let l=i,c=!1;i.rank===4&&(c=!0,l=F(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),I(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),I(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),I(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),I(hn(n,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`),I(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),I(Oi(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),I(Oi(n),()=>"Error in conv3D: Strides should be larger than 0.");const u={x:l,filter:a},d={strides:n,pad:s,dataFormat:r,dilations:o},h=_.runKernel(Sp,u,d);return c?F(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const l4=O({conv3d_:a4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c4(t,e,n,s,r){I(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let o=t,i=e,a=!1;e.rank===4&&(a=!0,i=F(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,t[0],t[1],t[2],t[3]]);const l=o[4],c=i.shape[4];I(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),I(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),I(n.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`),I(l===n.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[3]}.`),I(c===n.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`);const u={dy:i,filter:n},d={pad:r,strides:s,inputShape:o},h=_.runKernel(Zx,u,d);return a?F(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}const eN=O({conv3DBackpropInput_:c4});function u4(t,e,n,s,r){const o=T(t,"x","conv3dTranspose"),i=T(e,"filter","conv3dTranspose");return eN(n,o,i,s,r)}const d4=O({conv3dTranspose_:u4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h4(t){const n={x:T(t,"x","cos","float32")};return _.runKernel(Su,n)}const Py=O({cos_:h4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function f4(t){const n={x:T(t,"x","cosh","float32")};return _.runKernel(Iu,n)}const tN=O({cosh_:f4});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p4(t,e=0,n=!1,s=!1){const o={x:T(t,"x","cumprod")},i={axis:e,exclusive:n,reverse:s};return _.runKernel(ey,o,i)}const d1=O({cumprod_:p4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function m4(t,e=0,n=!1,s=!1){const o={x:T(t,"x","cumsum")},i={axis:e,exclusive:n,reverse:s};return _.runKernel(Ip,o,i)}const nN=O({cumsum_:m4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g4(t,e,n,s=!1){const r=T(t,"x","denseBincount"),o=T(e,"weights","denseBincount");I(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),I(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),I(n>=0,()=>`size must be non-negative, but got ${n}.`),I(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:n,binaryOutput:s};return _.runKernel(ny,i,a)}const EC=O({denseBincount_:g4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function x4(t,e,n="NHWC"){const s=T(t,"x","depthToSpace","float32"),r=n==="NHWC"?s.shape[1]:s.shape[2],o=n==="NHWC"?s.shape[2]:s.shape[3],i=n==="NHWC"?s.shape[3]:s.shape[1];I(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),I(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),I(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),I(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:n};return _.runKernel(sy,a,l)}const y4=O({depthToSpace_:x4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w4(t,e,n,s,r="NHWC",o=[1,1],i){const a=T(t,"x","depthwiseConv2d","float32"),l=T(e,"filter","depthwiseConv2d","float32");let c=a,u=!1;a.rank===3&&(u=!0,c=F(a,[1,a.shape[0],a.shape[1],a.shape[2]])),I(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),I(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const d=r==="NHWC"?c.shape[3]:c.shape[1];I(d===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${d}) must match the inChannels dimension in filter ${l.shape[2]}.`),Mn("depthwiseConv2d",s,i);const h={x:c,filter:l},f={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},p=_.runKernel($p,h,f);return u?F(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const Ly=O({depthwiseConv2d_:w4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v4(t,e,n,s,r=[1,1],o="NHWC"){const i=T(t,"x","dilation2d"),a=T(e,"filter","dilation2d");I(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),I(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),I(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=i,c=!1;i.rank===3&&(l=F(i,[1,i.shape[0],i.shape[1],i.shape[2]]),c=!0),I(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const u={x:l,filter:a},d={strides:n,pad:s,dilations:r},h=_.runKernel(Np,u,d);return c?F(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const b4=O({dilation2d_:v4});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ll(t,e){const n=t.length,s=[];for(let r=0;r<n;r++){const o=n-1-r,i=t[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function Vt(t,e){const n=[];for(let s=0;s<e.length;s++){const r=t[t.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&n.unshift(o)}return n}function Ie(t,e){const n=Math.max(t.length,e.length),s=new Array(n);for(let r=0;r<n;r++){let o=t[t.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)s[n-r-1]=i;else if(i===1)s[n-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else s[n-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C4(t,e){let n=T(t,"a","equal","string_or_numeric"),s=T(e,"b","equal","string_or_numeric");[n,s]=It(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(Tp,r)}const Cr=O({equal_:C4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k4(t,e,n){const s=T(e,"a","where"),r=T(n,"b","where"),o=T(t,"condition","where","bool"),i=Ie(Ie(o.shape,s.shape),r.shape),a=Cc(o,i),l=Cc(s,i),c=Cc(r,i),u={condition:a,t:l,e:c};return _.runKernel(rm,u)}const Cn=O({where_:k4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S4(t){const n={x:T(t,"x","zerosLike")};return _.runKernel(hm,n)}const Oe=O({zerosLike_:S4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I4(t,e){let n=T(t,"a","div"),s=T(e,"b","div");[n,s]=It(n,s);const r=ge(n,s),o=Oe(r),i=Cr(s,o);return Cn(i,o,r)}const $4=O({divNoNan_:I4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N4(t,e){const n=T(t,"t1","dot"),s=T(e,"t2","dot");I((n.rank===1||n.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`);const r=n.rank===1?n.size:n.shape[1],o=s.rank===1?s.size:s.shape[0];if(I(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),n.rank===1&&s.rank===1){const i=F(n,[1,-1]),a=F(s,[-1,1]),l=Ve(i,a);return F(l,[])}else if(n.rank===1&&s.rank===2){const i=F(n,[1,-1]),a=F(s,[s.shape[0],s.shape[1]]),l=Ve(i,a);return F(l,[l.size])}else if(n.rank===2&&s.rank===1){const i=F(s,[-1,1]),a=Ve(n,i);return F(a,[a.size])}else{const i=F(s,[s.shape[0],s.shape[1]]);return Ve(n,i)}}const T4=O({dot_:N4});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E4(t,...e){const n=e.map((r,o)=>T(r,`tensors${o}`,"einsum")),s={equation:t};return _.runKernel(iy,n,s)}const Kl=O({einsum_:E4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R4(t){const n={x:T(t,"x","elu","float32")};return _.runKernel(Nu,n)}const xm=O({elu_:R4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A4(t){let e=T(t,"x","erf");I(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=le(e,"float32"));const n={x:e};return _.runKernel(Tu,n)}const sN=O({erf_:A4});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function By(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function rN(t,e,n){const s=t.length+e.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)n.indexOf(a)===-1?r.push(t[o++]):r.push(e[i++]);return r}function Yt(t,e){const n=[],s=t.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&n.push(t[o]);const r=e.map(o=>t[o]);return[n,r]}function Dt(t,e){const n=e.map(s=>1);return rN(t,n,e)}function sn(t,e,n){I(By(e,n),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`)}function yt(t,e){if(By(t,e))return null;const n=[];for(let s=0;s<e;++s)t.indexOf(s)===-1&&n.push(s);return t.forEach(s=>n.push(s)),n}function Ho(t){return t.map((e,n)=>[n,e]).sort((e,n)=>e[1]-n[1]).map(e=>e[0])}function $t(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D4(t,e=null,n=!1){const r={x:T(t,"x","max")},o={reductionIndices:e,keepDims:n};return _.runKernel(Bp,r,o)}const qs=O({max_:D4});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _4(t,e=null,n=!1){const r={x:T(t,"x","min")},o={axis:e,keepDims:n};return _.runKernel(Gp,r,o)}const yf=O({min_:_4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F4(t,e){let n=T(t,"base","pow"),s=T(e,"exp","pow");[n,s]=It(n,s);const r={a:n,b:s};return _.runKernel(Gu,r)}const Mi=O({pow_:F4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function We(t,e){if((Ts(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Ts(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ud(t,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O4(t){const n={x:T(t,"x","sqrt","float32")};return _.runKernel(nd,n)}const dn=O({sqrt_:O4});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z4(t){const e=T(t,"x","square"),n={};return _.runKernel("Square",{x:e},n)}const it=O({square_:z4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M4(t,e=null,n=!1){let s=T(t,"x","sum");s.dtype==="bool"&&(s=le(s,"int32"));const r={x:s},o={axis:e,keepDims:n};return _.runKernel(im,r,o)}const me=O({sum_:M4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P4(t,e="euclidean",n=null,s=!1){t=T(t,"x","norm");const r=oN(t,e,n);let o=r.shape;if(s){const i=Ae(n,t.shape);o=Dt(r.shape,i)}return F(r,o)}function oN(t,e,n=null){if(t.rank===0)return xn(t);if(t.rank!==1&&n===null)return oN(F(t,[-1]),e,n);if(t.rank===1||typeof n=="number"||Array.isArray(n)&&n.length===1){if(e===1)return me(xn(t),n);if(e===1/0)return qs(xn(t),n);if(e===-1/0)return yf(xn(t),n);if(e==="euclidean"||e===2)return dn(me(Mi(xn(t),We(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&n.length===2){if(e===1)return qs(me(xn(t),n[0]),n[1]-1);if(e===1/0)return qs(me(xn(t),n[1]),n[0]);if(e===-1/0)return yf(me(xn(t),n[1]),n[0]);if(e==="fro"||e==="euclidean")return dn(me(it(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const ym=O({norm_:P4});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L4(t,e=null,n=!1){return ym(t,"euclidean",e,n)}const B4=O({euclideanNorm_:L4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V4(t){const n={x:T(t,"x","exp")};return _.runKernel(Eu,n)}const kr=O({exp_:V4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W4(t,e=0){const n=T(t,"x","expandDims","string_or_numeric");I(e<=n.rank,()=>"Axis must be <= rank of the tensor");const s={input:n},r={dim:e};return _.runKernel(Ep,s,r)}const En=O({expandDims_:W4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U4(t){const n={x:T(t,"x","expm1")};return _.runKernel(Ru,n)}const G4=O({expm1_:U4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H4(t,e){const n=T(t,"x","tile","string_or_numeric");I(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`);const s={x:n},r={reps:e};return _.runKernel(ad,s,r)}const Gs=O({tile_:H4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j4(t,e,n,s="float32"){e==null&&(e=t);const r=Re([t,e],s),o=t<=e?t:e;for(let a=0;a<o;++a)r.set(1,a,a);const i=F(r.toTensor(),[t,e]);if(n==null)return i;if(n.length===1)return Gs(En(i,0),[n[0],1,1]);if(n.length===2)return Gs(En(En(i,0),0),[n[0],n[1],1,1]);if(n.length===3)return Gs(En(En(En(i,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const iN=O({eye_:j4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K4(t){const n={x:T(t,"x","floor","float32")};return _.runKernel(Au,n)}const wm=O({floor_:K4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function X4(t,e,n=0,s=0){const r=T(t,"x","gather"),o=T(e,"indices","gather","int32"),i={x:r,indices:o},a={axis:n,batchDims:s};return _.runKernel(Ap,i,a)}const Vy=O({gather_:X4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q4(t,e){let n=T(t,"a","greater","string_or_numeric"),s=T(e,"b","greater","string_or_numeric");[n,s]=It(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(Dp,r)}const us=O({greater_:q4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y4(t,e){let n=T(t,"a","greaterEqual","string_or_numeric"),s=T(e,"b","greaterEqual","string_or_numeric");[n,s]=It(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(_u,r)}const qi=O({greaterEqual_:Y4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q4(t){const n={input:T(t,"input","imag")};return _.runKernel(hy,n)}const Wy=O({imag_:Q4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J4(t){const n={x:T(t,"x","isFinite")};return _.runKernel(Ou,n)}const Z4=O({isFinite_:J4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(t){const n={x:T(t,"x","isInf")};return _.runKernel(zu,n)}const tB=O({isInf_:eB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nB(t){const n={x:T(t,"x","isNaN")};return _.runKernel(Mu,n)}const sB=O({isNaN_:nB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(t,e=.2){const s={x:T(t,"x","leakyRelu")},r={alpha:e};return _.runKernel(_p,s,r)}const Uy=O({leakyRelu_:rB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(t,e){let n=T(t,"a","less","string_or_numeric"),s=T(e,"b","less","string_or_numeric");[n,s]=It(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(Fp,r)}const wf=O({less_:oB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iB(t,e){let n=T(t,"a","lessEqual","string_or_numeric"),s=T(e,"b","lessEqual","string_or_numeric");[n,s]=It(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(Op,r)}const Il=O({lessEqual_:iB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aB(t,e=5,n=1,s=1,r=.5){const o=T(t,"x","localResponseNormalization");I(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),I(rl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=F(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:i},c={depthRadius:e,bias:n,alpha:s,beta:r},u=_.runKernel(Lp,l,c);return a?F(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const lB=O({localResponseNormalization_:aB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cB(t){const n={x:T(t,"x","log","float32")};return _.runKernel(Pu,n)}const Sr=O({log_:cB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uB(t){const n={x:T(t,"x","log1p")};return _.runKernel(Lu,n)}const aN=O({log1p_:uB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dB(t,e){I(q0(t),()=>"The f passed in variableGrads(f) must be a function"),I(e==null||Array.isArray(e)&&e.every(c=>c instanceof gf),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const n=e!=null;if(!n){e=[];for(const c in _.registeredVariables)e.push(_.registeredVariables[c])}const s=n?e.filter(c=>!c.trainable):null,r=e.length;e=e.filter(c=>c.trainable),I(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=_.gradients(t,e,null,o);I(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),I(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return e.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),s!=null&&s.forEach(c=>l[c.name]=null),{value:i,grads:l}}function cl(t){return _.customGrad(t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hB(t){const n={x:T(t,"x","neg")};return _.runKernel(jp,n)}const St=O({neg_:hB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fB(t){const n={x:T(t,"x","softplus")};return _.runKernel(td,n)}const hd=O({softplus_:fB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pB(t){const e=T(t,"x","logSigmoid");return cl(s=>({value:St(hd(St(s))),gradFunc:i=>D(i,Sl(St(s)))}))(e)}const mB=O({logSigmoid_:pB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gB(t,e){let n=T(t,"a","sub"),s=T(e,"b","sub");[n,s]=It(n,s);const r={a:n,b:s};return _.runKernel(rd,r)}const ve=O({sub_:gB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xB(t,e=-1){const n=T(t,"logits","logSoftmax");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);return cl((r,o)=>{const a=qs(r,e,!0),l=ve(r,a),c=ve(le(l,"float32"),Sr(me(kr(l),e,!0)));return o([c]),{value:c,gradFunc:(d,h)=>{const[f]=h,p=!0,g=kr(f);return ve(d,D(me(d,e,p),g))}}})(n)}const lN=O({logSoftmax_:xB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yB(t,e=null,n=!1){const s=T(t,"x","logSumExp"),r=Ae(e,s.shape),o=qs(s,r,!0),i=ve(s,o),a=kr(i),l=me(a,r),c=Sr(l),u=Z(F(o,c.shape),c);if(n){const d=Dt(u.shape,r);return F(u,d)}return u}const cN=O({logSumExp_:yB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wB(t,e){const n=T(t,"a","logicalAnd","bool"),s=T(e,"b","logicalAnd","bool");Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(zp,r)}const Ur=O({logicalAnd_:wB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vB(t){const n={x:T(t,"x","logicalNot","bool")};return _.runKernel(Mp,n)}const Gy=O({logicalNot_:vB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bB(t,e){const n=T(t,"a","logicalOr","bool"),s=T(e,"b","logicalOr","bool");Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(Pp,r)}const uN=O({logicalOr_:bB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CB(t,e){const n=T(t,"a","logicalXor","bool"),s=T(e,"b","logicalXor","bool");return Ie(n.shape,s.shape),Ur(uN(t,e),Gy(Ur(t,e)))}const kB=O({logicalXor_:CB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SB(t,e,n,s,r){const o=T(t,"x","maxPool"),i=1;let a=o,l=!1;o.rank===3&&(l=!0,a=F(o,[1,o.shape[0],o.shape[1],o.shape[2]])),I(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),I(hn(n,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${i}'`),Mn("maxPool",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r},d=_.runKernel(Vp,c,u);return l?F(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Hy=O({maxPool_:SB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IB(t,e=[1,1,1],n,s,r,o="NDHWC"){const i=T(t,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=F(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),I(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),I(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),Mn("maxPool3d",s,r);const c={x:a},u={filterSize:e,strides:n,pad:s,dimRoundingMode:r,dataFormat:o},d=_.runKernel(Wp,c,u);return l?F(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}const $B=O({maxPool3d_:IB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(t,e){let n=T(t,"a","maximum"),s=T(e,"b","maximum");[n,s]=It(n,s),n.dtype==="bool"&&(n=le(n,"int32"),s=le(s,"int32")),Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(Bu,r)}const jo=O({maximum_:NB});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TB(t,e=null,n=!1){const r={x:T(t,"x","mean")},o={axis:e,keepDims:n};return _.runKernel(Up,r,o)}const Rt=O({mean_:TB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kt(t,e="float32"){if(Xr(t),e==="complex64"){const s=Kt(t,"float32"),r=Kt(t,"float32");return Ai(s,r)}const n=un(j(t),e);return _.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ko(t,e="float32"){if(Xr(t),e==="complex64"){const s=Ko(t,"float32"),r=Kt(t,"float32");return Ai(s,r)}const n=Bx(j(t),e);return _.makeTensor(n,t,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(t,e){let n=T(t,"a","minimum"),s=T(e,"b","minimum");[n,s]=It(n,s),n.dtype==="bool"&&(n=le(n,"int32"),s=le(s,"int32")),Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(Vu,r)}const Xc=O({minimum_:EB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(t,e,n){I(n==="reflect"||n==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`);const s=T(t,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");I(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=n==="reflect"?1:0;for(let a=0;a<s.rank;a++)I(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),I(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:n},i={x:s};return _.runKernel(Hp,i,o)}const AB=O({mirrorPad_:RB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(t,e){let n=T(t,"a","mod"),s=T(e,"b","mod");[n,s]=It(n,s);const r={a:n,b:s};return _.runKernel(Wu,r)}const _B=O({mod_:DB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(t,e=null,n=!1){t=T(t,"x","moments");const s=Ae(e,t.shape),r=Rt(t,s,n);let o=r.shape;n||(o=Dt(r.shape,s));const i=it(ve(le(t,"float32"),F(r,o))),a=Rt(i,s,n);return{mean:r,variance:a}}const jy=O({moments_:FB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(t,e){let n=T(t,"a","notEqual","string_or_numeric"),s=T(e,"b","notEqual","string_or_numeric");[n,s]=It(n,s),Ie(n.shape,s.shape);const r={a:n,b:s};return _.runKernel(Kp,r)}const vf=O({notEqual_:OB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(t,e,n=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:T(t,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:n,offValue:s};return _.runKernel(qp,i,a)}const dN=O({oneHot_:zB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(t){const n={x:T(t,"x","onesLike")};return _.runKernel(Xp,n)}const Es=O({onesLike_:MB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PB(t,e,n=0){const s=T(t,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:n},o={x:s};return _.runKernel(Qp,o,r)}const Ky=O({pad_:PB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(t,e,n){const s=T(t,"x","spaceToBatchND");I(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),I(n.length===e.length,()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`),I(s.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+n[l-1][0]+n[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:n};return _.runKernel(am,r,o)}const Xy=O({spaceToBatchND_:LB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BB(t,e,n,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=T(t,"x","maxPool");let l=a,c=!1;a.rank===3&&(c=!0,l=F(a,[1,a.shape[0],a.shape[1],a.shape[2]])),I(hn(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const u=Rs(l.shape,e,o,r,s),d=[u.dilationHeight,u.dilationWidth];let h;s==="same"?h=WB([u.filterHeight,u.filterWidth],d):h=[[0,0],[0,0]];const f=d[0]===1&&d[1]===1,[p,g]=VB([u.inHeight,u.inWidth],d,h),x=f?s:"valid",m=f?l:Xy(l,d,p),w=(n==="avg"?()=>Oy(m,e,o,x,i):()=>Hy(m,e,o,x,i))(),v=f?w:zy(w,d,g);return c?F(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function VB(t,e,n){const s=n.map(u=>u[0]),r=n.map(u=>u[1]),o=t.concat(s,r),i=e.map((u,d)=>(u-o[d]%u)%u),a=r.map((u,d)=>u+i[d]),l=e.map((u,d)=>[s[d],a[d]]),c=e.map((u,d)=>[0,i[d]]);return[l,c]}function WB(t,e){const s=t.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const UB=O({pool_:BB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(t,e){const n=T(t,"x","prelu"),s=T(e,"alpha","prelu"),r={x:n,alpha:s};return _.runKernel(Jp,r)}const qy=O({prelu_:GB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(t,e=null,n=!1){let s=T(t,"x","prod");s.dtype==="bool"&&(s=le(s,"int32"));const r={x:s},o={axis:e,keepDims:n};return _.runKernel(Zp,r,o)}const jB=O({prod_:HB});var Yy={exports:{}};Yy.exports;(function(t){(function(e,n,s){function r(l){var c=this,u=a();c.next=function(){var d=2091639*c.s0+c.c*23283064365386963e-26;return c.s0=c.s1,c.s1=c.s2,c.s2=d-(c.c=d|0)},c.c=1,c.s0=u(" "),c.s1=u(" "),c.s2=u(" "),c.s0-=u(l),c.s0<0&&(c.s0+=1),c.s1-=u(l),c.s1<0&&(c.s1+=1),c.s2-=u(l),c.s2<0&&(c.s2+=1),u=null}function o(l,c){return c.c=l.c,c.s0=l.s0,c.s1=l.s1,c.s2=l.s2,c}function i(l,c){var u=new r(l),d=c&&c.state,h=u.next;return h.int32=function(){return u.next()*4294967296|0},h.double=function(){return h()+(h()*2097152|0)*11102230246251565e-32},h.quick=h,d&&(typeof d=="object"&&o(d,u),h.state=function(){return o(u,{})}),h}function a(){var l=4022871197,c=function(u){u=String(u);for(var d=0;d<u.length;d++){l+=u.charCodeAt(d);var h=.02519603282416938*l;l=h>>>0,h-=l,h*=l,l=h>>>0,h-=l,l+=h*4294967296}return(l>>>0)*23283064365386963e-26};return c}n&&n.exports?n.exports=i:this.alea=i})(Gi,t)})(Yy);var KB=Yy.exports,Qy={exports:{}};Qy.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var d=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^d^d>>>8},a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=i:this.xor128=i})(Gi,t)})(Qy);var XB=Qy.exports,Jy={exports:{}};Jy.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.next=function(){var d=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(d^d<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:c+=a;for(var u=0;u<c.length+64;u++)l.x^=c.charCodeAt(u)|0,u==c.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=i:this.xorwow=i})(Gi,t)})(Jy);var qB=Jy.exports,Zy={exports:{}};Zy.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var u=l.x,d=l.i,h,f;return h=u[d],h^=h>>>7,f=h^h<<24,h=u[d+1&7],f^=h^h>>>10,h=u[d+3&7],f^=h^h>>>3,h=u[d+4&7],f^=h^h<<7,h=u[d+7&7],h=h^h<<13,f^=h^h<<9,u[d]=f,l.i=d+1&7,f};function c(u,d){var h,f=[];if(d===(d|0))f[0]=d;else for(d=""+d,h=0;h<d.length;++h)f[h&7]=f[h&7]<<15^d.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],u.x=f,u.i=0,h=256;h>0;--h)u.next()}c(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.x&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=i:this.xorshift7=i})(Gi,t)})(Zy);var YB=Zy.exports,ew={exports:{}};ew.exports;(function(t){(function(e,n,s){function r(a){var l=this;l.next=function(){var u=l.w,d=l.X,h=l.i,f,p;return l.w=u=u+1640531527|0,p=d[h+34&127],f=d[h=h+1&127],p^=p<<13,f^=f<<17,p^=p>>>15,f^=f>>>12,p=d[h]=p^f,l.i=h,p+(u^u>>>16)|0};function c(u,d){var h,f,p,g,x,m=[],y=128;for(d===(d|0)?(f=d,d=null):(d=d+"\0",f=0,y=Math.max(y,d.length)),p=0,g=-32;g<y;++g)d&&(f^=d.charCodeAt((g+32)%d.length)),g===0&&(x=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,g>=0&&(x=x+1640531527|0,h=m[g&127]^=f+x,p=h==0?p+1:0);for(p>=128&&(m[(d&&d.length||0)&127]=-1),p=127,g=4*128;g>0;--g)f=m[p+34&127],h=m[p=p+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,m[p]=f^h;u.w=x,u.X=m,u.i=p}c(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(u.X&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=i:this.xor4096=i})(Gi,t)})(ew);var QB=ew.exports,tw={exports:{}};tw.exports;(function(t){(function(e,n,s){function r(a){var l=this,c="";l.next=function(){var d=l.b,h=l.c,f=l.d,p=l.a;return d=d<<25^d>>>7^h,h=h-f|0,f=f<<24^f>>>8^p,p=p-d|0,l.b=d=d<<20^d>>>12^h,l.c=h=h-f|0,l.d=f<<16^h>>>16^p,l.a=p-d|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):c+=a;for(var u=0;u<c.length+20;u++)l.b^=c.charCodeAt(u)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var c=new r(a),u=l&&l.state,d=function(){return(c.next()>>>0)/4294967296};return d.double=function(){do var h=c.next()>>>11,f=(c.next()>>>0)/4294967296,p=(h+f)/(1<<21);while(p===0);return p},d.int32=c.next,d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}n&&n.exports?n.exports=i:this.tychei=i})(Gi,t)})(tw);var JB=tw.exports,hN={exports:{}};const ZB={},eV=Object.freeze(Object.defineProperty({__proto__:null,default:ZB},Symbol.toStringTag,{value:"Module"})),tV=JD(eV);(function(t){(function(e,n,s){var r=256,o=6,i=52,a="random",l=s.pow(r,o),c=s.pow(2,i),u=c*2,d=r-1,h;function f(v,b,C){var k=[];b=b==!0?{entropy:!0}:b||{};var S=m(x(b.entropy?[v,w(n)]:v??y(),3),k),$=new p(k),N=function(){for(var A=$.g(o),M=l,L=0;A<c;)A=(A+L)*r,M*=r,L=$.g(1);for(;A>=u;)A/=2,M/=2,L>>>=1;return(A+L)/M};return N.int32=function(){return $.g(4)|0},N.quick=function(){return $.g(4)/4294967296},N.double=N,m(w($.S),n),(b.pass||C||function(A,M,L,V){return V&&(V.S&&g(V,$),A.state=function(){return g($,{})}),L?(s[a]=A,M):A})(N,S,"global"in b?b.global:this==s,b.state)}function p(v){var b,C=v.length,k=this,S=0,$=k.i=k.j=0,N=k.S=[];for(C||(v=[C++]);S<r;)N[S]=S++;for(S=0;S<r;S++)N[S]=N[$=d&$+v[S%C]+(b=N[S])],N[$]=b;(k.g=function(A){for(var M,L=0,V=k.i,B=k.j,U=k.S;A--;)M=U[V=d&V+1],L=L*r+U[d&(U[V]=U[B=d&B+M])+(U[B]=M)];return k.i=V,k.j=B,L})(r)}function g(v,b){return b.i=v.i,b.j=v.j,b.S=v.S.slice(),b}function x(v,b){var C=[],k=typeof v,S;if(b&&k=="object")for(S in v)try{C.push(x(v[S],b-1))}catch{}return C.length?C:k=="string"?v:v+"\0"}function m(v,b){for(var C=v+"",k,S=0;S<C.length;)b[d&S]=d&(k^=b[d&S]*19)+C.charCodeAt(S++);return w(b)}function y(){try{var v;return h&&(v=h.randomBytes)?v=v(r):(v=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(v)),w(v)}catch{var b=e.navigator,C=b&&b.plugins;return[+new Date,e,C,e.screen,w(n)]}}function w(v){return String.fromCharCode.apply(0,v)}if(m(s.random(),n),t.exports){t.exports=f;try{h=tV}catch{}}else s["seed"+a]=f})(typeof self<"u"?self:Gi,[],Math)})(hN);var nV=hN.exports,sV=KB,rV=XB,oV=qB,iV=YB,aV=QB,lV=JB,Yi=nV;Yi.alea=sV;Yi.xor128=rV;Yi.xorwow=oV;Yi.xorshift7=iV;Yi.xor4096=aV;Yi.tychei=lV;var nw=Yi;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fN{constructor(e,n,s,r,o){this.mean=e,this.stdDev=n,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=nw.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,n,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*a,n=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(n))&&(this.nextVal=this.convertValue(n)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class cV{constructor(e=0,n=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=n-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${n} <= 1 and dtype is not float`);this.random=nw.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uV(t,e=0,n=1,s,r){if(Xr(t),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new fN(e,n,s,!1,r),i=Re(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const dV=O({randomNormal_:uV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hV(t,e=0,n=1,s="float32",r){Xr(t);const o=Re(t,s),i=new cV(e,n,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const fd=O({randomUniform_:hV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qc(t,e,n=1,s="float32"){if(n===0)throw new Error("Cannot have a step of zero");const r={start:t,stop:e,step:n,dtype:s};return _.runKernel(wy,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(t){const n={input:T(t,"input","real")};return _.runKernel(vy,n)}const bf=O({real_:fV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(t){const n={x:T(t,"x","reciprocal")};return _.runKernel(Hu,n)}const mV=O({reciprocal_:pV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(t){const n={x:T(t,"x","relu")};return _.runKernel(ju,n)}const Qi=O({relu_:gV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xV(t){const n={x:T(t,"x","relu6")};return _.runKernel(Ku,n)}const pN=O({relu6_:xV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yV(t,e){const s={x:T(t,"x","reverse")},r={dims:e};return _.runKernel(sm,s,r)}const Pi=O({reverse_:yV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wV(t){const n={x:T(t,"x","round")};return _.runKernel(Xu,n)}const mN=O({round_:wV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vV(t){const n={x:T(t,"x","rsqrt","float32")};return _.runKernel(qu,n)}const gN=O({rsqrt_:vV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(t){const n={x:T(t,"x","selu")};return _.runKernel(Yu,n)}const xN=O({selu_:bV});function CV(t,e,n,s,r,o=[1,1],i="NHWC"){const a=T(t,"x","separableConv2d"),l=T(e,"depthwiseFilter","separableConv2d"),c=T(n,"pointwiseFilter","separableConv2d");let u=a,d=!1;if(a.rank===3&&(d=!0,u=F(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");I(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),I(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),I(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),I(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),I(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);const h=l.shape[2],f=l.shape[3];I(c.shape[2]===h*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${h*f}, but got ${c.shape[2]}.`);const p=Ly(u,l,s,r,i,o),x=zi(p,c,1,"valid",i);return d?F(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const yN=O({separableConv2d_:CV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kV(t){const n={x:T(t,"x","sign")};return _.runKernel(Zu,n)}const SV=O({sign_:kV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IV(t){const n={x:T(t,"x","sin","float32")};return _.runKernel(Qu,n)}const wN=O({sin_:IV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(t){const n={x:T(t,"x","sinh")};return _.runKernel(Ju,n)}const vN=O({sinh_:$V});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(t,e,n){const s=T(t,"x","slice1d");return I(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),tt(s,[e],[n])}const sw=O({slice1d_:NV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TV(t,e,n){const s=T(t,"x","slice2d");return I(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),tt(s,e,n)}const bN=O({slice2d_:TV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EV(t,e,n){const s=T(t,"x","slice3d");return I(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),tt(s,e,n)}const rw=O({slice3d_:EV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV(t,e,n){const s=T(t,"x","slice4d");return I(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),tt(s,e,n)}const Cf=O({slice4d_:RV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AV(t,e=-1){const n=T(t,"logits","softmax","float32");if(e===-1&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},r={dim:e};return _.runKernel(cm,s,r)}const ow=O({softmax_:AV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DV(t){I(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);const e={input:t};return _.runKernel(ly,e)}const CN=O({fft_:DV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V(t){I(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);const e={input:t};return _.runKernel(dy,e)}const h1=O({ifft_:_V});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FV(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const r=F(t,[n,e]);s=h1(r)}else{const r=[n,2*(e-1)],o=F(bf(t),[n,e]),i=F(Wy(t),[n,e]),a=Pi(tt(o,[0,1],[n,e-2]),1),l=D(Pi(tt(i,[0,1],[n,e-2]),1),We(-1)),c=Dn([o,a],1),u=Dn([i,l],1),d=F(Ai(c,u),[r[0],r[1]]);s=h1(d)}if(s=bf(s),t.rank===3&&t.shape[0]!==0){const r=s,o=t.shape[0];s=F(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const OV=O({irfft_:FV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zV(t,e,n=0){const r={x:T(t,"x","split")},o={numOrSizeSplits:e,axis:n};return _.runKernel(lm,r,o)}const rs=O({split_:zV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(t,e){I(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let n=t.shape[t.shape.length-1];const s=t.size/n;let r;if(e!=null&&e<n){const p=t.shape.map(x=>0),g=t.shape.map(x=>x);g[t.shape.length-1]=e,r=tt(t,p,g),n=e}else if(e!=null&&e>n){const p=t.shape.map(g=>g);p[t.shape.length-1]=e-n,r=Dn([t,Kt(p)],t.shape.length-1),n=e}else r=t;const o=Oe(r),i=F(Ai(r,o),[s,n]),a=CN(i),l=Math.floor(n/2)+1,c=bf(a),u=Wy(a),d=rs(c,[l,n-l],c.shape.length-1),h=rs(u,[l,n-l],u.shape.length-1),f=r.shape.slice();return f[r.shape.length-1]=l,F(Ai(d[0],h[0]),f)}const PV=O({rfft_:MV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(t,e){let n=T(t,"a","squaredDifference"),s=T(e,"b","squaredDifference");[n,s]=It(n,s),Ie(n.shape,s.shape);const r={a:n,b:s},o={};return _.runKernel(sd,r,o)}const BV=O({squaredDifference_:LV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(t,e){const n=T(t,"x","squeeze","string_or_numeric");return F(n,Vo(n.shape,e).newShape)}const pd=O({squeeze_:VV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WV(t,e=0){const n=W2(t,"tensors","stack","string_or_numeric");I(n.length>=1,()=>"Pass at least one tensor to tf.stack"),n.length>0&&I(e<=n[0].rank,()=>"Axis must be <= rank of the tensor");const s=n,r={axis:e};return _.runKernel(Yp,s,r)}const Gr=O({stack_:WV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UV(t,e=0){const s={x:T(t,"x","step")},r={alpha:e};return _.runKernel(ld,s,r)}const md=O({step_:UV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GV(t,e,n,s,r=0,o=0,i=0,a=0,l=0){const u={x:T(t,"x","stridedSlice","string_or_numeric")},d={begin:e,end:n,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return _.runKernel(Iy,u,d)}const HV=O({stridedSlice_:GV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jV(t){const n={x:T(t,"x","tan","float32")};return _.runKernel(od,n)}const KV=O({tan_:jV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gn(t,e){Lx(t);const n=cd(t,e);if(n.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ud(t,null,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kg(t,e,n){if(Lx(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=cd(t,n);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ud(t,e,s,n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XV(t,e,n){Lx(t);const s=cd(t,n);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ud(t,e,s,n)}function kN(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${r}.`;if(n.rank<r)throw new Error(o+` update.rank < ${r}. `);if(t.length<s+(n.rank-r))throw new Error(o+` Output shape length < ${s+(n.rank-r)}`);if(n.rank!==r+t.length-s)throw new Error(o+` update.rank != ${r+t.length-s}`);for(let i=0;i<r;++i)if(n.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${n.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<n.rank-r;++i)if(n.shape[i+r]!==t[i+s])throw new Error(o+` updates.shape[${i+r}] (${n.shape[i+r]}) != shape[${i+r}] (${t[i+r]})`)}function qV(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(n.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}kN(n,e,t)}function Ji(t,e,n){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=n.length;let i=1;for(let d=r;d<o;++d)i*=n[d];const a=r<1?1:r,l=j(e.shape)/a,c=[...pe(n.slice(0,r)),1],u=j(n);return{sliceRank:r,numUpdates:l,sliceSize:i,strides:c,outputSize:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YV(t,e=1,n=!0){const s=T(t,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:n},[a,l]=_.runKernel($y,o,i);return{values:a,indices:l}}const QV=O({topk_:YV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JV(t,e=0,n=1,s,r){if(Xr(t),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new fN(e,n,s,!0,r),i=Re(t,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const SN=O({truncatedNormal_:JV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZV(t,e=0){const n=T(t,"x","unique","string_or_numeric");I(n.rank>0,()=>"The input tensor must be at least 1D");const s={x:n},r={axis:e},[o,i]=_.runKernel(Ty,s,r);return{values:o,indices:i}}const eW=O({unique_:ZV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(t,e,n){const s=T(t,"x","unsortedSegmentSum"),r=T(e,"segmentIds","unsortedSegmentSum","int32");I(rl(n),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:n};return _.runKernel(dm,o,i)}const IN=O({unsortedSegmentSum_:tW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nW(t,e=0){const n=T(t,"x","unstack","string_or_numeric");I(e>=-n.shape.length&&e<n.shape.length,()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`);const s={value:n},r={axis:e};return _.runKernel(um,s,r)}const Li=O({unstack_:nW});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sW(t,e=!0,n,s){return _.makeVariable(t,e,n,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $N(t,e){const n=[];for(let o=0;o<e.length;o++)e[o]&&n.push(o);const s=Re(t,"int32"),r=Re([n.length,t.length],"int32");for(let o=0;o<n.length;o++){const i=s.indexToLoc(n[o]),a=o*t.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rW(t,e,n){const s=T(t,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),I(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{I(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?P(()=>{let i=bf(s),a=Wy(s);return i=_.runKernel(Pa,{x:i},o),a=_.runKernel(Pa,{x:a},o),n&&(a=St(a)),Ai(i,a)}):_.runKernel(Pa,r,o)}const Fe=O({transpose_:rW});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(t,e){if(e==null)return t.shape.slice();if(Ue(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)e[s]==null&&t.shape[s]!=null?n.push(t.shape[s]):n.push(e[s]);return n}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(t,e,n,s){const r=T(t,"x","dropout");if(I(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),I(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Ot?r.clone():r;const o=oW(r,n),i=1-e,a=ge(wm(Z(fd(o,0,1,"float32",s),i)),i);return D(r,a)}const aW=O({dropout_:iW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lW(t,e,n,s,r,o="NHWC",i){let a=t;t.rank===3&&(a=F(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=F(e,[1,e.shape[0],e.shape[1],e.shape[2]])),I(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),I(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),I(n.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`);const c=o==="NHWC"?a.shape[3]:a.shape[1],u=o==="NHWC"?l.shape[3]:l.shape[1];I(c===n[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`),I(u===n[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${n[3]}).`),Mn("conv2dDerFilter",r,i);const d={x:a,dy:l},h={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:n};return _.runKernel(Qx,d,h)}const iw=O({conv2DBackpropFilter_:lW});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aw(t,e,n){if(n==null||n==="linear")return t;if(n==="relu")return D(t,md(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function lw(t,e){let n=e;const s=Vt(t.shape,e.shape);return s.length>0&&(n=me(n,s)),F(n,t.shape)}function cw(t,e,n,s){if(e==="linear")return t;if(e==="relu")return Qi(t);if(e==="elu")return xm(t);if(e==="relu6")return pN(t);if(e==="prelu")return qy(t,n);if(e==="leakyrelu")return Uy(t,s);if(e==="sigmoid")return Sl(t);throw new Error(`Unknown fused activation ${e}.`)}const uw=(t,e)=>!(t>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cW({x:t,filter:e,strides:n,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",uw(_.state.gradientDepth,l)===!1){I(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let C=zi(t,e,n,s,r,o,i);return a!=null&&(C=Z(C,a)),cw(C,l,c,u)}const d=T(t,"x","conv2d","float32"),h=T(e,"filter","conv2d","float32");let f=d,p=!1;d.rank===3&&(p=!0,f=F(d,[1,d.shape[0],d.shape[1],d.shape[2]])),I(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),I(h.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${h.rank}.`),Mn("fused conv2d",s,i);const g=r==="NHWC"?f.shape[3]:f.shape[1];I(h.shape[2]===g,()=>`Error in conv2d: depth of input (${g}) must match input depth for filter ${h.shape[2]}.`),I(hn(n,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`);const x=nn(f.shape,h.shape,n,o,s,i);let m;a!=null&&(m=T(a,"bias","fused conv2d"),[m]=It(m,d),r==="NHWC"?Ie(x.outShape,m.shape):(I(m.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${m.shape.length}.`),I(m.shape.length===0||m.shape[0]===x.outChannels||m.shape[0]===1,()=>`Error in fused conv2d: bias shape (${m.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let y;if(c!=null){const C=c.shape;if(I(C.length<=1||C.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${C.length}.`),C.length===1)I(C[0]===1||C[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the number of output channels (${x.outChannels}).`);else if(C.length===3)try{Ie(C,x.outShape)}catch{const S=`Error in fused conv2d: PReLU activation weights (${C}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(S)}y=T(c,"prelu weights","fused conv2d")}const w=(C,k)=>{I(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[S,$,N,A]=k,M=aw(C,N,l);I(Fi(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const L=My($.shape,M,S,n,s),V=iw($,M,S.shape,n,s),B=[L,V];if(A!=null){const U=lw(A,M);B.push(U)}return B},v={x:f,filter:h,bias:m,preluActivationWeights:y},b={strides:n,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:l,leakyreluAlpha:u};return a==null?cl((k,S,$)=>{let N=_.runKernel(ff,v,b);return $([S,k,N]),p&&(N=F(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:w}})(f,h):cl((k,S,$,N)=>{let A=_.runKernel(ff,v,b);return N([S,k,A,$]),p&&(A=F(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:w}})(f,h,m)}const uW=O({fusedConv2d_:cW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dW(t,e,n,s,r,o=[1,1],i){let a=t;t.rank===3&&(a=F(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=F(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:l},u={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:n};return _.runKernel(ry,c,u)}const hW=O({depthwiseConv2dNativeBackpropFilter_:dW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fW(t,e,n,s,r,o=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=F(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},u={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:t},d=_.runKernel(oy,c,u);return l?F(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const pW=O({depthwiseConv2dNativeBackpropInput_:fW});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mW({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(uw(_.state.gradientDepth,o)===!1){let A=Ve(t,e,n,s);return r!=null&&(A=Z(A,r)),cw(A,o,i,a)}let l=T(t,"a","fused matMul"),c=T(e,"b","fused matMul");[l,c]=It(l,c);const u=n?l.shape[l.rank-2]:l.shape[l.rank-1],d=s?c.shape[c.rank-1]:c.shape[c.rank-2],h=n?l.shape[l.rank-1]:l.shape[l.rank-2],f=s?c.shape[c.rank-2]:c.shape[c.rank-1],p=l.shape.slice(0,-2),g=c.shape.slice(0,-2),x=j(p),m=j(g);I(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${n} and transposeB=${s} must match.`);const w=Ie(l.shape.slice(0,-2),c.shape.slice(0,-2)).concat([h,f]),v=n?F(l,[x,u,h]):F(l,[x,h,u]),b=s?F(c,[m,f,d]):F(c,[m,d,f]);let C;r!=null&&(C=T(r,"bias","fused matMul"),[C]=It(C,l),Ie(w,C.shape));let k;i!=null&&(k=T(i,"prelu weights","fused matMul"));const S=(A,M)=>{const[L,V,B,U]=M,K=aw(F(A,B.shape),B,o);let R,z;if(!n&&!s?(R=Ve(K,V,!1,!0),z=Ve(L,K,!0,!1)):!n&&s?(R=Ve(K,V,!1,!1),z=Ve(K,L,!0,!1)):n&&!s?(R=Ve(V,K,!1,!0),z=Ve(L,K,!1,!1)):(R=Ve(V,K,!0,!0),z=Ve(K,L,!0,!0)),r!=null){const G=lw(U,K);return[R,z,G]}else return[R,z]},$={a:v,b,bias:C,preluActivationWeights:k},N={transposeA:n,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?cl((M,L,V)=>{const B=_.runKernel(hf,$,N);return V([M,L,B]),{value:F(B,w),gradFunc:S}})(v,b):cl((M,L,V,B)=>{const U=_.runKernel(hf,$,N);return B([M,L,U,V]),{value:F(U,w),gradFunc:S}})(v,b,C)}const RC=O({fusedMatMul_:mW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(t,e,n,s,r="bilinear",o=0){const i=T(t,"image","cropAndResize"),a=T(e,"boxes","cropAndResize","float32"),l=T(n,"boxInd","cropAndResize","int32"),c=a.shape[0];I(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),I(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`),I(l.rank===1&&l.shape[0]===c,()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`),I(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),I(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),I(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const u={image:i,boxes:a,boxInd:l},d={method:r,extrapolationValue:o,cropSize:s};return _.runKernel(ty,u,d)}const xW=O({cropAndResize_:gW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yW(t){const e=T(t,"image","flipLeftRight","float32");I(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const n={image:e};return _.runKernel(uy,n,{})}const wW=O({flipLeftRight_:yW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vW(t){const e=T(t,"image","grayscaleToRGB"),n=e.rank-1,s=e.shape[n];I(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),I(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,n),r[n]=3,Gs(e,r)}const bW=O({grayscaleToRGB_:vW});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CW(t){const e=T(t,"image","RGBToGrayscale"),n=e.rank-1,s=e.shape[n];I(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),I(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=le(e,"float32"),i=Gn([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Kl("ij,j->i",o,i);break;case 3:a=Kl("ijk,k->ij",o,i);break;case 4:a=Kl("ijkl,l->ijk",o,i);break;case 5:a=Kl("ijklm,m->ijkl",o,i);break;case 6:a=Kl("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=En(a,-1),le(a,r)}const kW=O({rgbToGrayscale_:CW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SW(t,e,n=0,s=.5){const r=T(t,"image","rotateWithOffset","float32");I(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:n,center:s};return _.runKernel(Ey,o,i)}const IW=O({rotateWithOffset_:SW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $l(t,e,n,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=t.shape[0];return n=Math.min(n,i),I(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),I(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),I(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),I(e.rank===1,()=>"scores must be a 1D tensor"),I(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),I(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $W(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const o=T(t,"boxes","nonMaxSuppression","float32"),i=T(e,"scores","nonMaxSuppression","float32"),a=$l(o,i,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:n,iouThreshold:s,scoreThreshold:r};return _.runKernel(gy,{boxes:o,scores:i},l)}const NW=O({nonMaxSuppression_:$W});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TW(t,e,n){const s=EW(t,e,n),r=s<0?-(s+1):s;t.splice(r,0,e)}function EW(t,e,n){return AW(t,e,n||RW)}function RW(t,e){return t>e?1:t<e?-1:0}function AW(t,e,n){let s=0,r=t.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=n(e,t[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dw(t,e,n,s,r){return pw(t,e,n,s,r,0)}function hw(t,e,n,s,r,o){return pw(t,e,n,s,r,0,!1,o,!0)}function fw(t,e,n,s,r,o){return pw(t,e,n,s,r,o,!0)}function pw(t,e,n,s,r,o,i=!1,a=!1,l=!1){const c=[];for(let x=0;x<e.length;x++)e[x]>r&&c.push({score:e[x],boxIndex:x,suppressBeginIndex:0});c.sort(AC);const u=o>0?-.5/o:0,d=[],h=[];for(;d.length<n&&c.length>0;){const x=c.pop(),{score:m,boxIndex:y,suppressBeginIndex:w}=x;if(m<r)break;let v=!1;for(let b=d.length-1;b>=w;--b){const C=DW(t,y,d[b]);if(C>=s){v=!0;break}if(x.score=x.score*_W(s,u,C),x.score<=r)break}x.suppressBeginIndex=d.length,v||(x.score===m?(d.push(y),h.push(x.score)):x.score>r&&TW(c,x,AC))}const f=d.length,p=n-f;a&&p>0&&(d.push(...new Array(p).fill(0)),h.push(...new Array(p).fill(0)));const g={selectedIndices:d};return i&&(g.selectedScores=h),l&&(g.validOutputs=f),g}function DW(t,e,n){const s=t.subarray(e*4,e*4+4),r=t.subarray(n*4,n*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),c=Math.min(r[0],r[2]),u=Math.min(r[1],r[3]),d=Math.max(r[0],r[2]),h=Math.max(r[1],r[3]),f=(a-o)*(l-i),p=(d-c)*(h-u);if(f<=0||p<=0)return 0;const g=Math.max(o,c),x=Math.max(i,u),m=Math.min(a,d),y=Math.min(l,h),w=Math.max(m-g,0)*Math.max(y-x,0);return w/(f+p-w)}function _W(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function AC(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function FW(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY){const o=T(t,"boxes","nonMaxSuppressionAsync"),i=T(e,"scores","nonMaxSuppressionAsync"),a=$l(o,i,n,s,r);n=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([o.data(),i.data()]),c=l[0],u=l[1],{selectedIndices:d}=dw(c,u,n,s,r);return o!==t&&o.dispose(),i!==e&&i.dispose(),Gn(d,"int32")}const OW=FW;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zW(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=T(t,"boxes","nonMaxSuppression"),a=T(e,"scores","nonMaxSuppression"),l=$l(i,a,n,s,r,o);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const c={boxes:i,scores:a},u={maxOutputSize:n,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},d=_.runKernel(yy,c,u);return{selectedIndices:d[0],selectedScores:d[1]}}const MW=O({nonMaxSuppressionWithScore_:zW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function PW(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=T(t,"boxes","nonMaxSuppressionAsync"),a=T(e,"scores","nonMaxSuppressionAsync"),l=$l(i,a,n,s,r,o);n=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const c=await Promise.all([i.data(),a.data()]),u=c[0],d=c[1],{selectedIndices:h,selectedScores:f}=fw(u,d,n,s,r,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Gn(h,"int32"),selectedScores:Gn(f)}}const LW=PW;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BW(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=T(t,"boxes","nonMaxSuppression"),a=T(e,"scores","nonMaxSuppression"),l=$l(i,a,n,s,r,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,h={boxes:i,scores:a},f={maxOutputSize:c,iouThreshold:u,scoreThreshold:d,padToMaxOutputSize:o},p=_.runKernel(xy,h,f);return{selectedIndices:p[0],validOutputs:p[1]}}const VW=O({nonMaxSuppressionPadded_:BW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function WW(t,e,n,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=T(t,"boxes","nonMaxSuppressionAsync"),a=T(e,"scores","nonMaxSuppressionAsync"),l=$l(i,a,n,s,r,null),c=l.maxOutputSize,u=l.iouThreshold,d=l.scoreThreshold,[h,f]=await Promise.all([i.data(),a.data()]),{selectedIndices:p,validOutputs:g}=hw(h,f,c,u,d,o);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Gn(p,"int32"),validOutputs:We(g,"int32")}}const UW=WW;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GW(t,e,n=!1,s=!1){const r=T(t,"images","resizeBilinear");I(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),I(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),I(s===!1||n===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=F(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:n,halfPixelCenters:s,size:e},c=_.runKernel(nm,a,l);return i?F(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const NN=O({resizeBilinear_:GW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HW(t,e,n=!1,s=!1){const r=T(t,"images","resizeNearestNeighbor");I(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),I(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),I(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),I(s===!1||n===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=F(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:n,halfPixelCenters:s,size:e},c=_.runKernel(tm,a,l);return i?F(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const TN=O({resizeNearestNeighbor_:HW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jW(t,e="binary",n=!1,s=.5){const r=T(t,"image","threshold"),o=.2989,i=.587,a=.114,l=r.shape[0]*r.shape[1];let c=D(Gn([s]),255),u,d,h,f;if(I(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),I(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),I(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),I(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[u,d,h]=rs(r,[1,1,1],-1);const x=D(u,o),m=D(d,i),y=D(h,a);f=Z(Z(x,m),y)}else f=t;if(e==="otsu"){const x=GL(le(mN(f),"int32"),bc([]),256);c=KW(x,l)}const p=n?Il(f,c):us(f,c);return le(D(p,255),"int32")}function KW(t,e){let n=Gn([-1]),s=Gn([0]),r=Gn([0]),o,i,a,l,c,u;for(let d=0;d<t.size-1;d++){o=tt(t,0,d+1),i=tt(t,d+1),c=ge(me(o),e),u=ge(me(i),e);const h=me(D(o,qc(0,o.size)));a=ge(h,me(o));const f=gm(i.shape,o.size),p=Z(qc(0,i.size),f),g=D(i,p);l=ge(me(g),me(i));const x=ve(a,l),m=ve(a,l),y=D(c,u);r=D(D(y,x),m);const w=us(r,s);s=Cn(w,r,s),n=Cn(w,Gn([d]),n)}return n}const XW=O({threshold_:jW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qW(t,e,n="nearest",s="constant",r=0,o){const i=T(t,"image","transform","float32"),a=T(e,"transforms","transform","float32");I(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),I(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),I(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:i,transforms:a},c={interpolation:n,fillMode:s,fillValue:r,outputShape:o};return _.runKernel(Ny,l,c)}const YW=O({transform_:qW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QW(t,e,n){const s=T(t,"a","bandPart");I(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,l;typeof e=="number"?(I(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),I(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=T(e<0?o:e,"numLower","bandPart")):(I(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Cn(wf(e,0),o,Xc(e,o))),typeof n=="number"?(I(n%1===0,()=>`bandPart(): numUpper must be an integer, got ${n}.`),I(n<=i,()=>`bandPart(): numUpper (${n}) must not be greater than the number of columns (${i}).`),l=T(n<0?i:n,"numUpper","bandPart")):(I(n.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Cn(wf(n,0),i,Xc(n,i)));const c=F(qc(0,o,1,"int32"),[-1,1]),u=qc(0,i,1,"int32"),d=ve(c,u),h=Ur(Il(d,a),qi(d,St(l))),f=Kt([o,i],s.dtype);return F(Gr(Li(F(s,[-1,o,i])).map(p=>Cn(h,p,f))),r)}const JW=O({bandPart_:QW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZW(t){let e;if(Array.isArray(t)){e=!1,I(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=t[0].shape[0];for(let o=1;o<t.length;++o)I(t[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[o].shape[0]} vs. ${r})`)}else e=!0,t=rs(t,t.shape[0],0).map(r=>pd(r,[0]));I(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);const n=[],s=t;for(let r=0;r<t.length;++r)n.push(_.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=D(me(D(n[i],o)),n[i]);o=ve(o,a)}return ge(o,ym(o,"euclidean"))}));return e?Gr(n,0):n}const eU=O({gramSchmidt_:ZW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tU(t,e=!1){if(I(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return DC(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),s=Li(F(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),r=[],o=[];s.forEach(l=>{const[c,u]=DC(l,e);r.push(c),o.push(u)});const i=F(Gr(r,0),t.shape),a=F(Gr(o,0),t.shape);return[i,a]}}function DC(t,e=!1){return _.tidy(()=>{I(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);const n=t.shape[0],s=t.shape[1];let r=iN(n),o=bi(t);const i=kg([[1]],[1,1]);let a=bi(i);const l=n>=s?s:n;for(let c=0;c<l;++c){const u=o,d=a,h=r;[a,o,r]=_.tidy(()=>{const f=tt(o,[c,c],[n-c,1]),p=ym(f),g=tt(o,[c,c],[1,1]),x=Cn(us(g,0),kg([[-1]]),kg([[1]])),m=ve(g,D(x,p)),y=ge(f,m);y.shape[0]===1?a=bi(i):a=Dn([i,tt(y,[1,0],[y.shape[0]-1,y.shape[1]])],0);const w=St(ge(Ve(x,m),p)),v=tt(o,[c,0],[n-c,s]),b=D(w,a),C=Fe(a);if(c===0)o=ve(v,Ve(b,Ve(C,v)));else{const $=ve(v,Ve(b,Ve(C,v)));o=Dn([tt(o,[0,0],[c,s]),$],0)}const k=Fe(b),S=tt(r,[0,c],[n,r.shape[1]-c]);if(c===0)r=ve(S,Ve(Ve(S,a),k));else{const $=ve(S,Ve(Ve(S,a),k));r=Dn([tt(r,[0,0],[n,c]),$],1)}return[a,o,r]}),Ne([u,d,h])}return!e&&n>s&&(r=tt(r,[0,0],[n,s]),o=tt(o,[0,0],[s,s])),[r,o]})}const nU=O({qr_:tU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zr={flipLeftRight:wW,grayscaleToRGB:bW,resizeNearestNeighbor:TN,resizeBilinear:NN,rgbToGrayscale:kW,rotateWithOffset:IW,cropAndResize:xW,nonMaxSuppression:NW,nonMaxSuppressionAsync:OW,nonMaxSuppressionWithScore:MW,nonMaxSuppressionWithScoreAsync:LW,nonMaxSuppressionPadded:VW,nonMaxSuppressionPaddedAsync:UW,threshold:XW,transform:YW},sU={bandPart:JW,gramSchmidt:eU,qr:nU};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rU=new Map,oU=new Map;class Nl{getClassName(){return this.constructor.className}static fromConfig(e,n){return new e(n)}}class xs{constructor(){this.classNameMap={}}static getMap(){return xs.instance==null&&(xs.instance=new xs),xs.instance}static register(e){xs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function Y(t,e,n){I(t.className!=null,()=>"Class being registered does not have the static className property defined."),I(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),I(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof n>"u"&&(n=t.className);const s=n,r=e+">"+s;return xs.register(t),rU.set(r,t),oU.set(t,r),t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Xo extends Nl{minimize(e,n=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return Ne(o),n?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,n){return dB(e,n)}dispose(){this.iterations_!=null&&Ne(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:We(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(Xo,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EN extends Xo{static get className(){return"Adadelta"}constructor(e,n,s=null){super(),this.learningRate=e,this.rho=n,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=_.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=_.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:P(()=>Oe(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:P(()=>Oe(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,c=this.accumulatedUpdates[r].variable;P(()=>{const u=Z(D(l,this.rho),D(it(a),1-this.rho)),d=D(ge(dn(Z(c,this.epsilon)),dn(Z(l,this.epsilon))),a),h=Z(D(c,this.rho),D(it(d),1-this.rho));l.assign(u),c.assign(h);const f=Z(D(d,-this.learningRate),o);o.assign(f)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ne(this.accumulatedGrads.map(e=>e.variable)),Ne(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.rho,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class RN extends Xo{static get className(){return"Adagrad"}constructor(e,n=.1){super(),this.learningRate=e,this.initialAccumulatorValue=n,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=_.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:P(()=>gm(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;P(()=>{const l=Z(a,it(i));a.assign(l);const c=Z(D(ge(i,dn(Z(l,_.backend.epsilon()))),-this.learningRate),o);o.assign(c)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ne(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,n){return new e(n.learningRate,n.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AN extends Xo{static get className(){return"Adam"}constructor(e,n,s,r=null){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],P(()=>{this.accBeta1=We(n).variable(),this.accBeta2=We(s).variable()}),r==null&&(this.epsilon=_.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);P(()=>{const s=ve(1,this.accBeta1),r=ve(1,this.accBeta2);n.forEach((o,i)=>{const a=_.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:P(()=>Oe(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:P(()=>Oe(a).variable(l))});const c=Array.isArray(e)?e[i].tensor:e[o];if(c==null)return;const u=this.accumulatedFirstMoment[i].variable,d=this.accumulatedSecondMoment[i].variable,h=Z(D(u,this.beta1),D(c,1-this.beta1)),f=Z(D(d,this.beta2),D(it(c),1-this.beta2)),p=ge(h,s),g=ge(f,r);u.assign(h),d.assign(f);const x=Z(D(ge(p,Z(dn(g),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(D(this.accBeta1,this.beta1)),this.accBeta2.assign(D(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ne(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ne(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e),P(()=>{this.accBeta1.assign(Mi(this.beta1,this.iterations_+1)),this.accBeta2.assign(Mi(this.beta2,this.iterations_+1))});const n=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DN extends Xo{static get className(){return"Adamax"}constructor(e,n,s,r=null,o=0){super(),this.learningRate=e,this.beta1=n,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],P(()=>{this.iteration=We(0).variable(),this.accBeta1=We(n).variable()}),r==null&&(this.epsilon=_.backend.epsilon())}applyGradients(e){const n=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);P(()=>{const s=ve(1,this.accBeta1),r=ge(-this.learningRate,Z(D(this.iteration,this.decay),1));n.forEach((o,i)=>{const a=_.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:Oe(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:Oe(a).variable(l)});const c=Array.isArray(e)?e[i].tensor:e[o];if(c==null)return;const u=this.accumulatedFirstMoment[i].variable,d=this.accumulatedWeightedInfNorm[i].variable,h=Z(D(u,this.beta1),D(c,1-this.beta1)),f=D(d,this.beta2),p=xn(c),g=jo(f,p);u.assign(h),d.assign(g);const x=Z(D(ge(r,s),ge(h,Z(g,this.epsilon))),a);a.assign(x)}),this.iteration.assign(Z(this.iteration,1)),this.accBeta1.assign(D(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ne(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ne(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,n){return new e(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mw extends Xo{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=_.registeredVariables[s];P(()=>{const a=Z(D(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=xr(We(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,n){return new e(n.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _N extends mw{static get className(){return"Momentum"}constructor(e,n,s=!1){super(e),this.learningRate=e,this.momentum=n,this.useNesterov=s,this.accumulations=[],this.m=We(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=_.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:P(()=>Oe(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&P(()=>{let l;const c=Z(D(this.m,i),a);this.useNesterov?l=Z(D(this.c,Z(a,D(c,this.m))),o):l=Z(D(this.c,c),o),i.assign(c),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ne(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,n){return new e(n.learningRate,n.momentum,n.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FN extends Xo{static get className(){return"RMSProp"}constructor(e,n=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=n,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=_.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=_.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:P(()=>Oe(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:P(()=>Oe(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:P(()=>Oe(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,c=this.accumulatedMoments[r].variable;P(()=>{const u=Z(D(l,this.decay),D(it(a),1-this.decay));if(this.centered){const d=this.accumulatedMeanGrads[r].variable,h=Z(D(d,this.decay),D(a,1-this.decay)),f=ge(D(a,this.learningRate),dn(ve(u,Z(it(h),this.epsilon)))),p=Z(D(c,this.momentum),f);l.assign(u),d.assign(h),c.assign(p);const g=ve(o,p);o.assign(g)}else{const d=Z(D(l,this.decay),D(it(a),1-this.decay)),h=Z(D(c,this.momentum),ge(D(a,this.learningRate),dn(Z(d,this.epsilon))));l.assign(d),c.assign(h);const f=ve(o,h);o.assign(f)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ne(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ne(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ne(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(n=>({name:n.originalName,tensor:n.variable})))}async setWeights(e){e=await this.extractIterations(e);const n=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,n).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(n,n*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(n*2,n*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,n){return new e(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iU=[EN,RN,AN,DN,_N,FN,mw];function aU(){for(const t of iU)Y(t)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _C(t,e,n,s){i(t),n=n??0,s=s??1,a(n,s);let r=0;const o=l=>(l.then(c=>{const u=n+ ++r/t.length*(s-n);return e(u),c}),l);function i(l){I(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){I(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),I(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),I(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function lU(t,e){e==null&&(e={});const n=e.fetchFunc==null?W().platform.fetch:e.fetchFunc,s=t.map(d=>n(d,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await _C(s,e.onProgress,0,.5)).map(d=>d.arrayBuffer());return e.onProgress==null?await Promise.all(a):await _C(a,e.onProgress,.5,1)}function cU(t,e){var n;const s=e.fetchFunc==null?W().platform.fetch:e.fetchFunc;let r=0,o;return(n=e.onProgress)===null||n===void 0||n.call(e,0),new ReadableStream({pull:async i=>{for(var a;r<t.length;){o||(o=(await s(t[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:c}=await o.read();if(l){r++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/t.length);continue}i.enqueue(c);return}i.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uU="application/octet-stream",dU="application/json";class gw{constructor(e,n){if(this.DEFAULT_METHOD="POST",n==null&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.weightUrlConverter=n.weightUrlConverter,n.fetchFunc!=null?(I(typeof n.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=n.fetchFunc):this.fetch=W().platform.fetch,I(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&I(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,n.requestInit!=null&&n.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{},this.loadOptions=n}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);n.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=SP(e,s);if(n.body.append("model.json",new Blob([JSON.stringify(r)],{type:dU}),"model.json"),e.weightData!=null){const i=Uo.join(e.weightData);n.body.append("model.weights.bin",new Blob([i],{type:uU}),"model.weights.bin")}const o=await this.fetch(this.path,n);if(o.ok)return{modelArtifactsInfo:_y(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let n;try{n=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=n.modelTopology,r=n.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return n}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return $P(e,n=>this.loadWeights(n))}async loadStream(){const e=await this.loadModelJSON(),n=await this.getWeightUrls(e.weightsManifest),s=NC(e.weightsManifest),r=()=>cU(n,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const n=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=hU(n),o=this.weightPathPrefix||s,i=[],a=[];for(const l of e)for(const c of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(c)):i.push(o+c+r);return this.weightUrlConverter&&i.push(...await Promise.all(a)),i}async loadWeights(e){const n=await this.getWeightUrls(e),s=NC(e),r=await lU(n,this.loadOptions);return[s,r]}}gw.URL_SCHEME_REGEX=/^https?:\/\//;function hU(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),r=n>e?t.substring(n):"";return[s+"/",r]}function FC(t){return t.match(gw.URL_SCHEME_REGEX)!=null}const ON=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let n=!0;if(Array.isArray(t)?n=t.every(s=>FC(s)):n=FC(t),n)return zN(t,e)}return null};Gt.registerSaveRouter(ON);Gt.registerLoadRouter(ON);function zN(t,e){return new gw(t,e)}function fU(t,e){return zN(t,e)}function xw(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(j(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let d=0;d<r.length-1;++d)i*=r[d];const a=t.shape,l=r.slice();l.pop();let c=1;for(let d=o;d<n;++d)c*=a[d],l.push(a[d]);const u=[...pe(t.shape).map(d=>d/c),1].slice(0,o);return[l,i,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f1=-2,pU=-1;function yw(t,e,n){const s=t.shape.length;I(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),I(s===n.length,()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)I(e[r]+n[r]<=t.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+n[r]}) would overflow input.shape[${r}] (${t.shape[r]})`)}function mU(t){const e=[];let n=0;for(;t>0;)t&1&&e.push(n),t/=2,n++;return e}function ww(t,e,n){const s=[];for(let r=0;r<t.length;r++)s[r]=Math.ceil((e[r]-t[r])/n[r]);return s}function MN(t,e,n,s){const r=[...t];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<n;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function PN(t,e,n){return n<=t?n:n-(e-1)}function LN(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function gU(t,e,n,s,r,o,i,a,l){const c=t.length;let u=new Array(c),d=new Array(c),h=new Array(c);if(e.length&&n>0){const f=e[0],p=n+1;u=BN(i,f,p,s,t),d=VN(a,f,p,r,t),h=MN(o,f,p,t)}else for(let f=0;f<c;f++)u[f]=UN(i,s,o,t,f,l),d[f]=GN(a,r,o,t,f,l),h[f]=WN(o,f,l);return{begin:u,end:d,strides:h}}function BN(t,e,n,s,r){const o=[...r],i=LN(n,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const l=PN(e,n,a);let c=s[l];t&1<<l&&(c=0),o[a]=c}return o}function VN(t,e,n,s,r){const o=[...r],i=LN(n,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const l=PN(e,n,a);let c=s[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),o[a]=c}for(let a=0;a<o.length;a++){const l=r[a];o[a]<0&&(o[a]+=l),o[a]=Ei(0,o[a],r[a])}return o}function WN(t,e,n){let s=t[e];return(n&1<<e||s==null)&&(s=1),s}function UN(t,e,n,s,r,o){let i=e[r];const a=n[r]||1;(t&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),i=Ei(0,i,l-1),i}function GN(t,e,n,s,r,o){let i=e[r];const a=n[r]||1;(t&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),a>0?i=Ei(0,i,l):i=Ei(-1,i,l-1),i}function vw(t,e,n){let s=n.length;for(let r=0;r<n.length;r++)if(n[r]>1){s=r;break}for(let r=s+1;r<n.length;r++)if(e[r]>0||n[r]!==t[r])return!1;return!0}function bw(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function vm(t,e,n){let s;const r=t.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{I(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return n==null?o=new Array(r).fill(-1):typeof n=="number"?o=[n,...new Array(r-1).fill(-1)]:n.length<r?o=n.concat(new Array(r-n.length).fill(-1)):o=n,o=o.map((i,a)=>i>=0?i:(I(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),t.shape[a]-s[a])),[s,o]}function Cw(t,e,n,s,r,o,i,a,l){let c;if(s==null?(c=new Array(e.length),c.fill(1)):c=s,i!=null&&i&i-1)throw new Error("Multiple ellipses in slice is not allowed.");let u=!1;const d={dims:c.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:n.slice(),strides:c.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let w=0;w<d.dims;w++)u&&1<<w&a&&d.numAddAxisAfterEllipsis++,1<<w&i&&(u=!0);u||(d.ellipsisMask|=1<<d.dims,d.dims++);const h={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};xU(d,h);let f=!0,p=!0,g=!0;const x=[],m=[];for(let w=0;w<t.length;++w){if(h.strides[w]===0)throw Error(`strides[${w}] must be non-zero`);const v=!!(h.shrinkAxisMask&1<<w),b=t[w];if(b===-1){x.push(v?1:-1);continue}const C=[h.beginMask&1<<w,h.endMask&1<<w],k=[h.strides[w]>0?0:-1,h.strides[w]>0?b:b-1];if(v&&h.strides[w]<=0)throw Error("only stride 1 allowed on non-range indexing.");g=g&&h.strides[w]===1;const S=!!(h.beginMask&1<<w&&h.endMask&1<<w);if(h.beginValid&&h.endValid){if(v){const M=h.begin[w]<0?b+h.begin[w]:h.begin[w];if(h.begin[w]=M,h.end[w]=h.begin[w]+1,M<0||M>=b)throw Error(`slice index ${h.begin[w]} of dimension ${w} out of bounds.`)}else h.begin[w]=OC(h.begin[w],0,h.strides[w],b,C,k),h.end[w]=OC(h.end[w],1,h.strides[w],b,C,k);const A=h.strides[w]===1&&h.begin[w]===0&&h.end[w]===b;f=f&&A,p=p&&(w===0&&h.strides[w]===1||A)}else f=f&&h.strides[w]===1&&S,p=p&&(w===0&&h.strides[w]===1||S);let $,N=!1;if(h.beginValid&&h.endValid?($=h.end[w]-h.begin[w],N=!0):v?($=1,N=!0):S&&b>=0&&(h.strides[w]<0?$=-b:$=b,N=!0),N){let A;$===0||$<0!=h.strides[w]<0?A=0:A=Math.trunc($/h.strides[w])+($%h.strides[w]!==0?1:0),x.push(A)}else x.push(-1)}for(let w=0;w<h.finalShapeGatherIndices.length;++w){const v=h.finalShapeGatherIndices[w];v>=0?m.push(x[v]):v===f1&&m.push(1)}return{finalShapeSparse:m.filter((w,v)=>h.finalShapeGatherIndices[v]!==f1),finalShape:m,isIdentity:f,sliceDim0:p,isSimpleSlice:g,begin:h.begin,end:h.end,strides:h.strides}}function xU(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let n=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<t.dims;s++)if(1<<s&t.ellipsisMask){const r=Math.min(e.dims-(t.dims-s)+1+t.numAddAxisAfterEllipsis,e.dims);for(;n<r;n++)e.begin[n]=0,e.end[n]=0,e.strides[n]=1,e.beginMask|=1<<n,e.endMask|=1<<n,e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[n]=s}else if(1<<s&t.newAxisMask)e.finalShapeGatherIndices.push(f1),e.finalShapeGatherIndicesSparse.push(-1);else{if(n===e.begin.length)throw Error(`Index out of range using input dim ${n}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[n]=t.begin[s]),t.end!=null&&(e.end[n]=t.end[s]),e.strides[n]=t.strides[s],t.beginMask&1<<s&&(e.beginMask|=1<<n),t.endMask&1<<s&&(e.endMask|=1<<n),t.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(pU),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<n):(e.finalShapeGatherIndices.push(n),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[n]=s,n++}}function OC(t,e,n,s,r,o){if(r[e])return n>0?o[e]:o[e+1&1];{const i=t<0?s+t:t;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const yU=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:yw,computeFlatOffset:bw,computeOutShape:ww,getNormalizedAxes:gU,isSliceContinous:vw,maskToAxes:mU,parseSliceParams:vm,sliceInfo:Cw,startForAxis:UN,startIndicesWithElidedDims:BN,stopForAxis:GN,stopIndicesWithElidedDims:VN,stridesForAxis:WN,stridesWithElidedDims:MN},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wU{static sgd(e){return new mw(e)}static momentum(e,n,s=!1){return new _N(e,n,s)}static rmsprop(e,n=.9,s=0,r=null,o=!1){return new FN(e,n,s,r,o)}static adam(e=.001,n=.9,s=.999,r=null){return new AN(e,n,s,r)}static adadelta(e=.001,n=.95,s=null){return new EN(e,n,s)}static adamax(e=.002,n=.9,s=.999,r=null,o=0){return new DN(e,n,s,r,o)}static adagrad(e,n=.1){return new RN(e,n)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aa=wU;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vU=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function HN(){return new Promise(t=>vU(()=>t()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kw(t,e){const n=t[0].length;t.forEach((r,o)=>{I(r.length===n,()=>`Error in concat${n}D: rank of tensors[${o}] must be the same as the rank of the rest (${n})`)}),I(e>=0&&e<n,()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`);const s=t[0];t.forEach((r,o)=>{for(let i=0;i<n;i++)I(i===e||r[i]===s[i],()=>`Error in concat${n}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function yr(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ws;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(Ws||(Ws={}));function jN(t,e,n){let s=new Array;if(n==null&&e==null)return s;if(e==null)for(;s.length<t+n.length;)s.push(-1);else s=e.slice();if(n==null)return s;if(t+n.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+n.length}, but shape.rank = ${s.length}`);for(let r=1;r<n.length;++r){const o=n[r],i=s[s.length-n.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+t}] = ${o} but shape[${r+t}] = ${a}`)}else s[i]=o}return s}function KN(t){const e={FIRST_DIM_SIZE:Ws.FIRST_DIM_SIZE,VALUE_ROWIDS:Ws.VALUE_ROWIDS,ROW_LENGTHS:Ws.ROW_LENGTHS,ROW_SPLITS:Ws.ROW_SPLITS,ROW_LIMITS:Ws.ROW_LIMITS,ROW_STARTS:Ws.ROW_STARTS},n=[];for(const s of t)if(s in e)n.push(e[s]);else break;return n}function XN(t){return t.length===0?0:t[0]===Ws.FIRST_DIM_SIZE?t.length-1:t.length}function qN(t,e){if(t==null||e==null)return;const n=t.length,s=e.length;if(n>=s)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${n} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(n,s-1);++r){const o=t[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-t.length}] = ${o} but ragged tensor input.flatValues.shape[${r-t.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sw=30;function bm(t){return t<=Sw?t:Y0(t,Math.floor(Math.sqrt(t)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iw(t,e,n){const s=n*(typeof t=="number"?t:t[0]),r=e*(typeof t=="number"?t:t[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gd(t,e,n,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(t[0]/n),r=r.concat(t.slice(1));else{r=r.concat(t[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([t[i+1]/e[i],e[i]]);r=r.concat(t.slice(o+1))}return r}function xd(t,e,n=!0){const s=[];if(n){s.push(e);for(let r=e+1;r<t;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<t;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function yd(t,e,n,s=!0){const r=[];s?r.push(t[0]/n):r.push(t[0]*n);for(let o=1;o<t.length;++o)o<=e.length?s?r.push(e[o-1]*t[o]):r.push(t[o]/e[o-1]):r.push(t[o]);return r}function $w(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function Nw(t,e,n){const s=t.slice(0,1);for(let r=0;r<n;++r)s.push(t[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cm=1.7580993408473768,km=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tw=.3275911,Ew=.254829592,Rw=-.284496736,Aw=1.421413741,Dw=-1.453152027,_w=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hr(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(t.length*2);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function YN(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function QN(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function JN(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<t.length;r+=4)n[Math.floor(r/4)]=t[r],s[Math.floor(r/4)]=t[r+1];return{real:n,imag:s}}function Fw(t,e){const n=t[e*2],s=t[e*2+1];return{real:n,imag:s}}function ZN(t,e,n,s){t[s*2]=e,t[s*2+1]=n}function eT(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let r=0;r<Math.ceil(t/2);r++){const o=(e?2:-2)*Math.PI*(r/t);n[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:n,imag:s}}function tT(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sg="->",bU=/->/g,zC=",",MC="...";function Ow(t,e){t=t.replace(/\s/g,"");const n=(t.length-t.replace(bU,"").length)/Sg.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error(`Equation must contain exactly one arrow ("${Sg}").`);const[s,r]=t.split(Sg);I(s.indexOf(MC)===-1,()=>`The ellipsis notation ("${MC}") is not supported yet.`);const o=s.split(zC),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let h=0;h<r.length;++h){const f=r[h];if(!o.some(p=>p.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let h=0;h<s.length;++h){const f=s[h];a.indexOf(f)===-1&&f!==zC&&a.push(f)}const l=new Array(o.length);for(let h=0;h<i;++h){if(new Set(o[h].split("")).size!==o[h].length)throw new Error(`Found duplicate axes in input component ${o[h]}. Support for duplicate axes in input is not implemented yet.`);l[h]=[];for(let f=0;f<o[h].length;++f)l[h].push(a.indexOf(o[h][f]))}const c=a.length,u=r.length,d=[];for(let h=u;h<c;++h)d.push(h);return{allDims:a,summedDims:d,idDims:l}}function zw(t,e){let n=new Array(t);n.fill(-1);for(let r=0;r<e.length;++r)n[e[r]]=r;const s=[];for(let r=0;r<t;++r)n[r]===-1&&s.push(r);return n=n.filter(r=>r!==-1),{permutationIndices:n,expandDims:s}}function Mw(t,e,n){const s=new Array(t);for(let r=0;r<n.length;++r){const o=n[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:I(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function Pw(t,e){const n=t,s=[];let r=0;t.length===0&&n.push(-1),r=t.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<n.length;++i){const a=n[i],l=CU(e,a);for(const c of l)o.indexOf(c)===-1&&(s[i].push(c),o.push(c))}return{path:n,steps:s}}function Lw(t){return t.every((e,n)=>e===n)}function CU(t,e){const n=[];for(let s=0;s<t.length;++s)(t[s].length===0||t[s].indexOf(e)!==-1||e===-1)&&n.push(s);return n}function Bw(t,e,n=0){let s=[];if(typeof e=="number")I(t.shape[n]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(t.shape[n]/e);else{const r=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);I(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,l)=>l>0?a+l:a);e[o]=t.shape[n]-i}I(t.shape[n]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nT(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function sT(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function rT(t,e,n){return`indices(${t}, 0) is invalid: ${e} >= ${n}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oT(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function iT(t,e){return`size ${t} must be non-negative, not ${e}`}function aT(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function lT(t,e){const n=j(t),s=j(e);return`Input to reshape is a SparseTensor with ${n}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${t} outputShape= ${e}`}function cT(t,e){const n=j(t),s=j(e);return`Input to reshape is a tensor with ${n} dense values, but the requested shape has ${s}. inputShape=${t} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p1(){return"segment ids must be >= 0"}function uT(){return"segment ids are not increasing"}function dT(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function hT(t,e,n){return`Bad: indices[${t}] == ${e} out of range [0, ${n})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fT(t,e){let n=!1,s;for(t<=Sw?(s=t,n=!0):s=Y0(t,Math.floor(Math.sqrt(t)));!n;)s>e||s===t?n=!0:s=Y0(t,s+1);return s}function pT(t,e,n){const s=[],r=t.length;for(let o=0;o<r;o++)o!==e?s.push(t[o]):s.push(n);return s}function Vw(t,e,n,s){const r=e.shape.length,o=t.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let d=0;d<s;++d)if(t.shape[d]!==e.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${e.shape[d]}.`);const i=t.shape[n],a=[];let l=1,c=1,u=1;for(let d=0;d<s;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=s;d<n;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=s;d<r;d++)a.push(e.shape[d]);for(let d=n+1;d<o;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:i,outputShape:a}}const kU=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:Vw,computeOutShape:pT,segOpComputeOptimalWindowSize:fT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jr(t){try{return t.map(e=>Do(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function mT(t){return t.map(e=>No(e))}const SU=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:Ew,ERF_A2:Rw,ERF_A3:Aw,ERF_A4:Dw,ERF_A5:_w,ERF_P:Tw,PARALLELIZE_THRESHOLD:Sw,get RowPartitionType(){return Ws},SELU_SCALE:km,SELU_SCALEALPHA:Cm,applyActivation:cw,assertAndGetBroadcastShape:Ie,assertAxesAreInnerMostDims:sn,assertParamsConsistent:kw,assignToTypedArray:ZN,axesAreInnerMostDims:By,calculateShapes:Ji,checkEinsumDimSizes:Mw,checkPadOnDimRoundingMode:Mn,combineLocations:rN,combineRaggedTensorToTensorShapes:jN,complexWithEvenIndex:QN,complexWithOddIndex:JN,computeConv2DInfo:nn,computeConv3DInfo:Go,computeDefaultPad:Fy,computeDilation2DInfo:dd,computeOptimalWindowSize:bm,computeOutAndReduceShapes:Yt,computeOutShape:yr,computePool2DInfo:Rs,computePool3DInfo:qr,convertConv2DDataFormat:Yr,decodeEinsumEquation:Ow,eitherStridesOrDilationsAreOne:hn,expandShapeToKeepDim:Dt,exponent:tT,exponents:eT,fromStringArrayToUint8:mT,fromUint8ToStringArray:jr,getAxesPermutation:yt,getBroadcastDims:ll,getComplexWithIndex:Fw,getEinsumComputePath:Pw,getEinsumPermutation:zw,getFusedBiasGradient:lw,getFusedDyActivation:aw,getImageCenter:Iw,getInnerMostAxes:$t,getPermuted:xd,getRaggedRank:XN,getReductionAxes:Vt,getReshaped:gd,getReshapedPermuted:yd,getRowPartitionTypesHelper:KN,getSliceBeginCoords:$w,getSliceSize:Nw,getSparseFillEmptyRowsIndicesDenseShapeMismatch:nT,getSparseFillEmptyRowsNegativeIndexErrorMessage:sT,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:rT,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:aT,getSparseReshapeInputOutputMismatchErrorMessage:cT,getSparseReshapeInputOutputMultipleErrorMessage:lT,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:oT,getSparseReshapeNegativeOutputDimErrorMessage:iT,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:hT,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:p1,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:uT,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:dT,getUndoAxesPermutation:Ho,isIdentityPermutation:Lw,log:UM,mergeRealAndImagArrays:Hr,prepareAndValidate:xw,prepareSplitSize:Bw,segment_util:kU,shouldFuse:uw,slice_util:yU,splitRealAndImagArrays:YN,stridesOrDilationsArePositive:Oi,tupleValuesAreOne:Fi,upcastType:Xn,validateDefaultValueShape:qN,validateInput:qV,validateUpdateShape:kN,warn:es},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */aU();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gT={kernelName:fp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(t,md(le(n,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IU={kernelName:pu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=it(le(n,"float32")),r=dn(ve(We(1),s));return St(ge(t,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $U={kernelName:mu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=dn(ve(it(le(n,"float32")),1));return ge(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NU={kernelName:kl,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{let a=t;const l=Vt(n.shape,r);return l.length>0&&(a=me(a,l)),F(a,n.shape)},b:()=>{let a=t;const l=Vt(s.shape,r);return l.length>0&&(a=me(a,l)),F(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TU={kernelName:Ux,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach((s,r)=>{n[r]=()=>t.clone()}),n}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU={kernelName:pp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Oe(n)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU={kernelName:mp,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Oe(n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU={kernelName:gu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ge(t,dn(ve(We(1),it(le(n,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU={kernelName:xu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=dn(Z(We(1),it(le(n,"float32"))));return ge(t,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U={kernelName:vu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=Z(it(n),it(s));let l=D(t,ge(s,a));const c=Vt(n.shape,r);return c.length>0&&(l=me(l,c)),F(l,n.shape)},b:()=>{const a=Z(it(n),it(s));let l=St(D(t,ge(n,a)));const c=Vt(s.shape,r);return c.length>0&&(l=me(l,c)),F(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FU={kernelName:yu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ge(t,Z(it(le(n,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OU={kernelName:wu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ge(t,ve(We(1),it(le(n,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zU(t,e,n,s,r,o){const i=T(t,"dy","avgPool3dGrad"),a=T(e,"input","avgPool3dGrad");let l=i,c=a,u=!1;a.rank===4&&(u=!0,l=F(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),c=F(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),I(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),I(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),Mn("avgPool3dGrad",r,o);const d={dy:l,input:c},h={filterSize:n,strides:s,pad:r,dimRoundingMode:o},f=_.runKernel(Kx,d,h);return u?F(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const MU=O({avgPool3dGrad_:zU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PU={kernelName:xp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=n;return{x:()=>MU(t,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LU(t,e,n,s,r){const o=T(t,"dy","avgPoolGrad"),i=T(e,"input","avgPoolGrad");I(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,l=o,c=!1;i.rank===3&&(c=!0,a=F(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=F(o,[1,o.shape[0],o.shape[1],o.shape[2]])),I(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),I(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const u={dy:l,input:a},d={filterSize:n,strides:s,pad:r},h=_.runKernel(jx,u,d);return c?F(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const BU=O({avgPoolGrad_:LU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU={kernelName:gp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=n;return{x:()=>BU(t,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU={kernelName:yp,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,r]=e,{transposeA:o,transposeB:i}=n;return!o&&!i?{a:()=>Ve(t,r,!1,!0),b:()=>Ve(s,t,!0,!1)}:!o&&i?{a:()=>Ve(t,r,!1,!1),b:()=>Ve(t,s,!0,!1)}:o&&!i?{a:()=>Ve(r,t,!1,!0),b:()=>Ve(s,t,!1,!1)}:{a:()=>Ve(r,t,!0,!0),b:()=>Ve(t,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UU={kernelName:wp,gradFunc:(t,e,n)=>{const{blockShape:s,crops:r}=n;return{x:()=>Xy(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GU={kernelName:LM,gradFunc:(t,e,n)=>{const s=n,r=s.inputShape,o=s.shape,i=Array.from(o);for(let l=r.length-1;l>=0;l--)if(r[l]===o[l])i[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>me(t,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU={kernelName:bu,gradFunc:t=>({x:()=>t.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jU={kernelName:Cu,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KU={kernelName:ku,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=n;return{x:()=>Cn(Ur(qi(s,r),Il(s,o)),t,Oe(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XU={kernelName:vp,inputsToSave:["x"],gradFunc:gT.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU={kernelName:bp,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map(l=>l.shape),{axis:r}=n,o=Ae(r,e[0].shape)[0],i=s.map(l=>l[o]);return rs(t,i,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YU={kernelName:Cp,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{dilations:o,strides:i,pad:a,dataFormat:l}=n;return I(Fi(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>My(s.shape,t,r,i,a,l),filter:()=>iw(s,t,r.shape,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU={kernelName:kp,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:l}=n;return{dy:()=>zi(t,r,o,i,a,1,l),filter:()=>iw(t,s,r.shape,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JU(t,e,n,s,r){let o=t;t.rank===4&&(o=F(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let i=e;i.rank===4&&(i=F(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),I(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),I(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),I(n.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`),I(o.shape[4]===n[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${n[3]}.`),I(i.shape[4]===n[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${n[4]}).`);const a={x:o,dy:i},l={strides:s,pad:r,filterShape:n};return _.runKernel(Jx,a,l)}const ZU=O({conv3DBackpropFilter_:JU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG={kernelName:Sp,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:o}=n;I(Fi(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>eN(i.shape,t,a,r,o),filter:()=>ZU(i,t,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tG={kernelName:Su,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(St(wN(le(n,"float32"))),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG={kernelName:Iu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(vN(le(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:Ip,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=n;return{x:()=>{const a=yt([r],s.rank);let l=nN(t,r,o,!i);return a!=null&&(l=Fe(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:$p,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=n,a=s??[1,1];I(Fi(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,c]=e;return I(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),I(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),I(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),I(hn(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),Mn("depthwiseConv2d",o,i),{x:()=>pW(l.shape,t,c,r,o,a,i),filter:()=>hW(l,t,c.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:Np,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,r]=e,o={x:s,filter:r,dy:t},i={x:s,filter:r,dy:t};return{x:()=>_.runKernel(Q0,o,n),filter:()=>_.runKernel(J0,i,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:Nu,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>_.runKernel(ay,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aG={kernelName:Tu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=D(kr(St(it(n))),2/Math.sqrt(Math.PI));return{x:()=>D(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lG={kernelName:Eu,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(t,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cG={kernelName:Ep,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>F(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG={kernelName:Ru,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(t,kr(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG={kernelName:Au,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hG={kernelName:Du,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=ge(t,le(s,"float32")),l=Vt(n.shape,r);return l.length>0?F(me(a,l),n.shape):a},b:()=>{let a=D(t,le(n,"float32"));const l=Vt(s.shape,r);l.length>0&&(a=F(me(a,l),s.shape));const c=it(s);return St(ge(a,le(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG={kernelName:Rp,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[r,o,i,a]=e,l=a??We(1),c=Vt(o.shape,r.shape),u=[];if(o.rank===1){for(let v=0;v<r.shape.length-1;++v)u.push(r.shape[v]);u.push(1)}const d=ve(r,o),h=D(t,l),f=gN(Z(i,We(s))),p=D(D(D(f,f),f),We(-.5));return{x:()=>o.rank===1?F(D(D(t,Gs(F(f,[1,1,1,o.shape[0]]),u)),l),r.shape):F(D(D(t,f),l),r.shape),mean:()=>{let v=D(D(f,We(-1)),h);return o.rank===1&&(v=me(v,c)),F(v,o.shape)},variance:()=>{let v=D(D(p,d),h);return o.rank===1&&(v=me(v,c)),F(v,o.shape)},scale:()=>{const v=D(d,f);let b=D(t,v);return o.rank===1&&(b=me(b,c)),F(b,o.shape)},offset:()=>{let v=t;return o.rank===1&&(v=me(v,c)),F(v,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG={kernelName:Ap,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,r]=e,{axis:o,batchDims:i}=n,a=Ae(o,s.shape)[0],l=(c,u,d)=>()=>{const h=c.shape,f=u.size,p=h.slice(0,a),g=p.length,x=h.slice(o,h.length).slice(1),m=x.length,y=PC(0,g),w=PC(g+1,g+1+m),v=LC([p,[f],x]),b=F(d,v),C=F(u,[f]),k=LC([[g],y,w]),S=Fe(b,k);let $=IN(S,C,c.shape[a]);const N=Ho(k);return $=Fe($,N),$};if(i===1){const c=s.shape[0],u=s.split(c,0);return{x:()=>Gr(u.map((f,p)=>l(f,r.slice(p,1),t.slice(p,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,t),indices:()=>r}}};function PC(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function LC(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG={kernelName:_u,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>Oe(n),b:()=>Oe(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG={kernelName:Fu,gradFunc:t=>({x:()=>le(t,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:Ou,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yG={kernelName:zu,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG={kernelName:Mu,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG={kernelName:_p,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:r}=n,o=us(s,0);return{x:()=>Cn(o,t,D(t,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG={kernelName:Lu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ge(t,Z(n,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CG={kernelName:Pu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ge(t,le(n,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG={kernelName:VM,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;return{logits:()=>{const i=kr(s);return ve(t,D(me(t,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SG(t,e,n,s=5,r=1,o=1,i=.5){const a={x:t,y:e,dy:n},l={depthRadius:s,bias:r,alpha:o,beta:i};return _.runKernel(fy,a,l)}const IG=O({localResponseNormalizationBackprop_:SG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $G={kernelName:Lp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:a,beta:l}=n;return{x:()=>IG(s,r,t,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xT(t,e,n,s){return e.rank<n.rank&&(e=F(e,Dt(e.shape,s))),t.rank<n.rank&&(t=F(t,Dt(t.shape,s))),{x:()=>D(t,le(Cr(n,e),t.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BC={kernelName:Bp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:r}=s,o=e[0],i=e[1],a=Ae(r,o.shape),l=xT(t,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NG={kernelName:Bu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>D(t,le(qi(n,s),"float32")),b:()=>D(t,le(wf(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TG(t,e,n,s,r,o,i){const a=T(t,"dy","maxPool3dGrad"),l=T(e,"input","maxPool3dGrad"),c=T(n,"output","maxPool3dGrad");let u=a,d=l,h=c,f=!1;l.rank===4&&(f=!0,u=F(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=F(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),h=F(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),I(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),I(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),I(h.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${h.rank}.`),Mn("maxPool3dGrad",o,i);const p={dy:u,input:d,output:h},g={filterSize:s,strides:r,pad:o,dimRoundingMode:i},x=_.runKernel(my,p,g);return f?F(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}const EG=O({maxPool3dGrad_:TG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG={kernelName:Wp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=n;return{x:()=>EG(t,s,r,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AG(t,e,n,s,r,o,i){const a=T(t,"dy","maxPoolGrad"),l=T(e,"input","maxPoolGrad"),c=T(n,"output","maxPoolGrad");I(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),I(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),I(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),Mn("maxPoolGrad",o,i);const u={dy:a,input:l,output:c},d={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return _.runKernel(py,u,d)}const DG=O({maxPoolGrad_:AG});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G={kernelName:Vp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a}=n;return{x:()=>DG(t,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG={kernelName:Up,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n,o=Ae(r,s.shape),a=Yt(s.shape,o)[1],l=j(a);return{x:()=>{const u=s.shape.slice();o.forEach(f=>{u[f]=1});const d=F(t,u);return ge(D(d,Ko(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG={kernelName:Gp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:r}=s,[o,i]=e,a=Ae(r,o.shape),l=xT(t,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zG={kernelName:Vu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>D(t,le(Il(n,s),"float32")),b:()=>D(t,le(us(n,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG={kernelName:Hp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,o=r.map(i=>i[0]);return{x:()=>tt(t,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG={kernelName:Wu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=Vt(n.shape,r);return a.length>0?F(me(t,a),n.shape):t},b:()=>{const a=D(t,St(wm(ge(n,s)))),l=Vt(s.shape,r);return l.length>0?F(me(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG={kernelName:Uu,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=D(t,le(s,"float32")),l=Vt(n.shape,r);return l.length>0?F(me(a,l),n.shape):a},b:()=>{const a=D(t,le(n,"float32")),l=Vt(s.shape,r);return l.length>0?F(me(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG={kernelName:jp,gradFunc:t=>({x:()=>St(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VG={kernelName:qp,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>Kt(n.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:Xp,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG={kernelName:Yp,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n;return Li(t,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VC={kernelName:Qp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:r}=n,o=r.map(i=>i[0]);return{x:()=>tt(t,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GG={kernelName:Gu,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,r]=e,o=n,i=s,a=Ie(o.shape,i.shape);return{a:()=>{const u=le(i,"float32");let d=D(t,D(u,Mi(o,ve(u,We(1)))));const h=Vt(o.shape,a);return h.length>0&&(d=me(d,h)),F(d,o.shape)},b:()=>{const u=us(o,0),d=Cn(u,Sr(o),Oe(o));let h=D(t,D(r,d));const f=Vt(i.shape,a);return f.length>0&&(h=me(h,f)),F(h,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HG={kernelName:Jp,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,r=us(n,0);return{x:()=>Cn(r,t,D(t,s)),alpha:()=>{let o=Cn(r,Oe(t),D(t,n));const i=Vt(s.shape,t.shape);return i.length>0&&(o=me(o,i)),F(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jG(t,e,n){const s=t.shape.slice();s[n]=1;const r=F(e,s),o=d1(t,n,!0,!1),i=d1(t,n,!0,!0),a=D(o,i);return D(r,a)}function KG(t,e,n){const s=t.shape.length,r=s-n.length,o=yt(n,s);let i=t;o!=null&&(i=Fe(t,o));const a=i.shape.slice(),c=a.splice(s-n.length,n.length).reduce((h,f)=>h*f,1);a.push(c);const u=i.reshape(a);let d=jG(u,e,r);if(d=d.reshape(i.shape),o!=null){const h=Ho(o);d=Fe(d,h)}return d}const XG={kernelName:Zp,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:r}=n;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>KG(s,t,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qG={kernelName:$u,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{const a=ge(t,le(s,"float32")),l=Vt(n.shape,r);return l.length>0?F(me(a,l),n.shape):a},b:()=>{let a=D(t,le(n,"float32"));const l=Vt(s.shape,r);l.length>0&&(a=F(me(a,l),s.shape));const c=it(s);return St(ge(a,le(c,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YG={kernelName:Hu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ge(t,St(it(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QG={kernelName:Ku,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=D(Il(n,6),md(n));return{x:()=>D(t,le(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JG={kernelName:ju,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(t,le(md(n),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZG={kernelName:em,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>F(t,n.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const e6={kernelName:nm,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>_.runKernel(Cy,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t6={kernelName:tm,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,r={dy:t,images:s};return{images:()=>_.runKernel(by,r,n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n6={kernelName:sm,gradFunc:(t,e,n)=>{const{dims:s}=n,r=Ae(s,t.shape);return{x:()=>Pi(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s6={kernelName:Xu,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const r6={kernelName:qu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>St(ge(t,D(Mi(n,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const o6={kernelName:rm,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>le(Oe(n),"float32"),t:()=>D(t,le(n,t.dtype)),e:()=>D(t,le(Gy(n),t.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const i6={kernelName:Yu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const s=us(n,We(0)),r=We(Cm),o=We(km),i=D(t,o),a=D(D(t,r),kr(le(n,"float32")));return Cn(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const a6={kernelName:ed,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(t,D(n,ve(We(1),n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l6={kernelName:Zu,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const c6={kernelName:Qu,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(Py(le(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u6={kernelName:Ju,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(tN(le(n,"float32")),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d6={kernelName:om,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:r,size:o}=n,i=s.shape,[a,l]=vm(s,r,o),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],i[u]-a[u]-l[u]]);return{x:()=>Ky(t,c)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h6={kernelName:cm,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:r}=n,o=!0,i=D(t,s);return{logits:()=>ve(i,D(me(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f6={kernelName:td,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(t,Sl(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WC={kernelName:am,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:r}=n;return{x:()=>zy(t,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UC={kernelName:lm,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>Dn(t,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p6={kernelName:nd,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ge(t,D(dn(le(n,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const m6={kernelName:ky,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(t,D(le(n,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g6={kernelName:sd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=We(2);return{a:()=>D(t,D(r,ve(n,s))),b:()=>D(t,D(r,ve(s,n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const x6={kernelName:ld,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y6={kernelName:rd,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,r=Ie(n.shape,s.shape);return{a:()=>{let a=t;const l=Vt(n.shape,r);return l.length>0&&(a=me(a,l)),F(a,n.shape)},b:()=>{let a=t;const l=Vt(s.shape,r);return l.length>0&&(a=me(a,l)),F(St(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w6={kernelName:im,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,r=s.shape.slice(),{axis:o}=n;Ae(o,s.shape).forEach(c=>{r[c]=1});const a=F(t,r),l=D(a,Ko(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v6={kernelName:od,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>ge(t,it(Py(n)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b6={kernelName:id,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>D(ve(We(1),it(n)),t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const C6={kernelName:ad,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:r}=n;return{x:()=>{let i=Oe(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=Z(i,tt(t,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)i=Z(i,tt(t,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)i=Z(i,tt(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let c=0;c<r[2];++c)for(let u=0;u<r[3];++u)i=Z(i,tt(t,[a*s.shape[0],l*s.shape[1],c*s.shape[2],u*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const k6={kernelName:Pa,gradFunc:(t,e,n)=>{const s=n,{perm:r}=s,o=Ho(r);return{x:()=>Fe(t,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const S6={kernelName:um,gradFunc:(t,e,n)=>{const s=n,{axis:r}=s;return{value:()=>Gr(t,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const I6={kernelName:dm,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>$6(t,n)}}};function $6(t,e){const n=jo(e,Oe(e)),s=Vy(t,n);let r=qi(e,We(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=En(r,a+1);r=Ur(r,Ko(s.shape,"bool"));const i=Oe(s);return Cn(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N6={kernelName:hm,gradFunc:t=>({x:()=>Oe(t)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const T6=[gT,IU,$U,NU,TU,EU,RU,AU,DU,_U,FU,OU,PU,VU,WU,UU,GU,HU,jU,KU,XU,qU,QU,YU,eG,tG,nG,sG,rG,oG,qG,iG,aG,lG,cG,uG,hG,dG,fG,pG,mG,gG,xG,yG,wG,vG,bG,CG,kG,$G,BC,BC,NG,RG,_G,FG,OG,zG,MG,PG,LG,BG,VG,WG,UG,VC,VC,GG,HG,XG,YG,QG,JG,ZG,e6,t6,n6,s6,r6,o6,i6,a6,l6,c6,u6,d6,h6,f6,WC,WC,UC,UC,p6,g6,m6,x6,y6,w6,v6,b6,C6,k6,S6,I6,N6];for(const t of T6)GM(t);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.abs=function(){return this.throwIfDisposed(),xn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.acos=function(){return this.throwIfDisposed(),sL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.acosh=function(){return this.throwIfDisposed(),oL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.add=function(t){return this.throwIfDisposed(),Z(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.all=function(t,e){return this.throwIfDisposed(),Q2(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.any=function(t,e){return this.throwIfDisposed(),c1(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.argMax=function(t){return this.throwIfDisposed(),Hc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.argMin=function(t){return this.throwIfDisposed(),uL(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.asScalar=function(){return this.throwIfDisposed(),I(this.size===1,()=>"The array must have only 1 element."),F(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.asType=function(t){return this.throwIfDisposed(),le(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.as1D=function(){return this.throwIfDisposed(),F(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.as2D=function(t,e){return this.throwIfDisposed(),F(this,[t,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.as3D=function(t,e,n){return this.throwIfDisposed(),F(this,[t,e,n])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),F(this,[t,e,n,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.as5D=function(t,e,n,s,r){return this.throwIfDisposed(),F(this,[t,e,n,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.asin=function(){return this.throwIfDisposed(),hL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.asinh=function(){return this.throwIfDisposed(),pL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.atan=function(){return this.throwIfDisposed(),gL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.atan2=function(t){return this.throwIfDisposed(),yL(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.atanh=function(){return this.throwIfDisposed(),vL(this)};H().prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),Oy(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),zy(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.batchNorm=function(t,e,n,s,r){return this.throwIfDisposed(),mm(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Cc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.cast=function(t){return this.throwIfDisposed(),le(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.ceil=function(){return this.throwIfDisposed(),KL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),as(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Ot&&(t=[t]),Dn([this,...t],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.conv1d=function(t,e,n,s,r,o){return this.throwIfDisposed(),J2(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.conv2dTranspose=function(t,e,n,s,r){return this.throwIfDisposed(),Z2(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.conv2d=function(t,e,n,s,r,o){return this.throwIfDisposed(),zi(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.cos=function(){return this.throwIfDisposed(),Py(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.cosh=function(){return this.throwIfDisposed(),tN(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.cumprod=function(t,e,n){return this.throwIfDisposed(),d1(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),nN(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),y4(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.depthwiseConv2d=function(t,e,n,s,r,o){return this.throwIfDisposed(),Ly(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.dilation2d=function(t,e,n,s,r){return this.throwIfDisposed(),b4(this,t,e,n,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.divNoNan=function(t){return this.throwIfDisposed(),$4(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.div=function(t){return this.throwIfDisposed(),ge(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.dot=function(t){return this.throwIfDisposed(),T4(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.elu=function(){return this.throwIfDisposed(),xm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.equal=function(t){return this.throwIfDisposed(),Cr(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.erf=function(){return this.throwIfDisposed(),sN(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),B4(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.exp=function(){return this.throwIfDisposed(),kr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.expandDims=function(t){return this.throwIfDisposed(),En(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.expm1=function(){return this.throwIfDisposed(),G4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.fft=function(){return this.throwIfDisposed(),CN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.flatten=function(){return this.throwIfDisposed(),F(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.floor=function(){return this.throwIfDisposed(),wm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.floorDiv=function(t){return this.throwIfDisposed(),Y2(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.gather=function(t,e,n){return this.throwIfDisposed(),Vy(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.greaterEqual=function(t){return this.throwIfDisposed(),qi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.greater=function(t){return this.throwIfDisposed(),us(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.ifft=function(){return this.throwIfDisposed(),h1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.irfft=function(){return this.throwIfDisposed(),OV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.isFinite=function(){return this.throwIfDisposed(),Z4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.isInf=function(){return this.throwIfDisposed(),tB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.isNaN=function(){return this.throwIfDisposed(),sB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Uy(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.lessEqual=function(t){return this.throwIfDisposed(),Il(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.less=function(t){return this.throwIfDisposed(),wf(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),lB(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.logSigmoid=function(){return this.throwIfDisposed(),mB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.logSoftmax=function(t){return this.throwIfDisposed(),lN(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),cN(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.log=function(){return this.throwIfDisposed(),Sr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.log1p=function(){return this.throwIfDisposed(),aN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.logicalAnd=function(t){return this.throwIfDisposed(),Ur(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.logicalNot=function(){return this.throwIfDisposed(),Gy(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.logicalOr=function(t){return this.throwIfDisposed(),uN(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.logicalXor=function(t){return this.throwIfDisposed(),kB(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.matMul=function(t,e,n){return this.throwIfDisposed(),Ve(this,t,e,n)};H().prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),Hy(this,t,e,n,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.max=function(t,e){return this.throwIfDisposed(),qs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.maximum=function(t){return this.throwIfDisposed(),jo(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.mean=function(t,e){return this.throwIfDisposed(),Rt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.min=function(t,e){return this.throwIfDisposed(),yf(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.minimum=function(t){return this.throwIfDisposed(),Xc(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),AB(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.mod=function(t){return this.throwIfDisposed(),_B(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.mul=function(t){return this.throwIfDisposed(),D(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.neg=function(){return this.throwIfDisposed(),St(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.norm=function(t,e,n){return this.throwIfDisposed(),ym(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.notEqual=function(t){return this.throwIfDisposed(),vf(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),dN(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.onesLike=function(){return this.throwIfDisposed(),Es(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.pad=function(t,e){return this.throwIfDisposed(),Ky(this,t,e)};H().prototype.pool=function(t,e,n,s,r,o){return this.throwIfDisposed(),UB(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.pow=function(t){return this.throwIfDisposed(),Mi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.prelu=function(t){return this.throwIfDisposed(),qy(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.prod=function(t,e){return this.throwIfDisposed(),jB(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.reciprocal=function(){return this.throwIfDisposed(),mV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.relu=function(){return this.throwIfDisposed(),Qi(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.relu6=function(){return this.throwIfDisposed(),pN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.reshapeAs=function(t){return this.throwIfDisposed(),F(this,t.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.reshape=function(t){return this.throwIfDisposed(),F(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),NN(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),TN(this,t,e,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.reverse=function(t){return this.throwIfDisposed(),Pi(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.rfft=function(){return this.throwIfDisposed(),PV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.round=function(){return this.throwIfDisposed(),mN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.rsqrt=function(){return this.throwIfDisposed(),gN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.selu=function(){return this.throwIfDisposed(),xN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.separableConv2d=function(t,e,n,s,r,o){return this.throwIfDisposed(),yN(this,t,e,n,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.sigmoid=function(){return this.throwIfDisposed(),Sl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.sign=function(){return this.throwIfDisposed(),SV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.sin=function(){return this.throwIfDisposed(),wN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.sinh=function(){return this.throwIfDisposed(),vN(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.slice=function(t,e){return this.throwIfDisposed(),tt(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.softmax=function(t){return this.throwIfDisposed(),ow(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.softplus=function(){return this.throwIfDisposed(),hd(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Xy(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.split=function(t,e){return this.throwIfDisposed(),rs(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.sqrt=function(){return this.throwIfDisposed(),dn(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.square=function(){return this.throwIfDisposed(),it(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.squaredDifference=function(t){return this.throwIfDisposed(),BV(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.squeeze=function(t){return this.throwIfDisposed(),pd(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof Ot?[this,t]:[this,...t];return Gr(n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.step=function(t){return this.throwIfDisposed(),md(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.stridedSlice=function(t,e,n,s,r,o,i,a){return this.throwIfDisposed(),HV(this,t,e,n,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.sub=function(t){return this.throwIfDisposed(),ve(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.sum=function(t,e){return this.throwIfDisposed(),me(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.tan=function(){return this.throwIfDisposed(),KV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.tanh=function(){return this.throwIfDisposed(),pm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.tile=function(t){return this.throwIfDisposed(),Gs(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.toBool=function(){return this.throwIfDisposed(),le(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.toFloat=function(){return this.throwIfDisposed(),le(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.toInt=function(){return this.throwIfDisposed(),le(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.topk=function(t,e){return this.throwIfDisposed(),QV(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.transpose=function(t){return this.throwIfDisposed(),Fe(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.unique=function(t){return this.throwIfDisposed(),eW(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),IN(this,t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.unstack=function(t){return this.throwIfDisposed(),Li(this,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.where=function(t,e){return this.throwIfDisposed(),Cn(t,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */H().prototype.zerosLike=function(){return this.throwIfDisposed(),Oe(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class cr extends Error{constructor(e){super(e),Object.setPrototypeOf(this,cr.prototype)}}class Cs extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Cs.prototype)}}class E extends Error{constructor(e){super(e),Object.setPrototypeOf(this,E.prototype)}}class $e extends Error{constructor(e){super(e),Object.setPrototypeOf(this,$e.prototype)}}class Ww extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Ww.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yT{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let n;return this.cache.has(e)&&(n=this.cache.get(e),this.cache.delete(e),this.cache.set(e,n)),n}put(e,n){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,n)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let n=0;n<this.maxEntries-e;n++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bi(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}else{const n=new Array(e);return n.fill(t),n}}function ur(t,e){if(!t)throw new Ww(e)}function GC(t,e){let n=0;for(const s of t)s===e&&n++;return n}function Rn(t){return t.length===1?t[0]:t}function Ke(t){return Array.isArray(t)?t:[t]}function Dr(t){const n=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return n[0]!=="_"?n:"private"+n}function ii(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,n)=>n.toUpperCase())}let hs={};function Uw(t){if(t==null)return null;const e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function m1(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>m1(e));else{const e=Object.keys(t);for(const n of e){const s=t[n];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?t[n]=s.value:m1(s))}}}function wd(t,e={},n={},s="object",r=!1){if(typeof t=="string"){const o=t;let i;if(o in n)i=n[o];else if(o in hs)i=hs[o];else if(i=e[o],i==null)throw new E(`Unknown ${s}: ${t}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=t;if(o.className==null||o.config==null)throw new E(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,l;if(i in n?[a,l]=n[i]:i in hs?[a,l]=hs.className:i in e&&([a,l]=e[i]),a==null)throw new E(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const c={};for(const f of Object.keys(hs))c[f]=hs[f];for(const f of Object.keys(n))c[f]=n[f];const u=o.config;u.customObjects=c;const d=Object.assign({},hs);for(const f of Object.keys(n))hs[f]=n[f];m1(o.config);const h=l(a,o.config,n,r);return hs=Object.assign({},d),h}else{const c=Object.assign({},hs);for(const d of Object.keys(n))hs[d]=n[d];const u=new a(o.config);return hs=Object.assign({},c),u}}}function E6(t,e){return t<e?-1:t>e?1:0}function eh(t,e){return-1*E6(t,e)}function To(t){if(t==null)return t;const e=[];for(const n of t)e.indexOf(n)===-1&&e.push(n);return e}function R6(t){if(t==null)throw new E(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function Zi(t,e,n){if(n!=null&&t.indexOf(n)<0)throw new E(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function Gw(t,e,n=0,s=1/0){return ur(n>=0),ur(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every(r=>typeof r===e)}function qt(t,e){Array.isArray(t)?(I(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((n,s)=>qt(n,`element ${s+1} of ${e}`))):I(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${wT(t)}.`)}function wT(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>wT(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function A6(t,e,n){let s=n!=null?n():Tn(),r;return(...i)=>{const a=n!=null?n():Tn();return a-s<e||(s=a,r=t(...i)),r}}function vT(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let D6=0;function bT(){return D6++}const th={};function Sm(t=""){return t in th||(th[t]=0),th[t]+=1,t+th[t].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const _6=["channelsFirst","channelsLast"],F6=["nearest","bilinear"],O6=["valid","same","causal"],z6=["max","avg"],M6=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const la=new Map;function Nt(t){Zi(_6,"DataFormat",t)}function P6(t){Zi(F6,"InterpolationFormat",t)}function ds(t){Zi(O6,"PaddingMode",t)}function CT(t){Zi(z6,"PoolMode",t)}const kc=[],HC="/";function Ci(t,e){kc.push(t);try{const n=e();return kc.pop(),n}catch(n){throw kc.pop(),n}}function L6(){return kc.length===0?"":kc.join(HC)+HC}function kT(t){if(!IT(t))throw new Error("Not a valid tensor name: '"+t+"'");return L6()+t}function ST(t){if(!IT(t))throw new Error("Not a valid tensor name: '"+t+"'");la.has(t)||la.set(t,0);const e=la.get(t);if(la.set(t,la.get(t)+1),e>0){const n=`${t}_${e}`;return la.set(n,1),n}else return t}const B6=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function IT(t){return!!t.match(B6)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function V6(t){return t===parseInt(t.toString(),10)}function Eo(t,e,n){e==null&&(e=0),n==null&&(n=t.length);let s=1;for(let r=e;r<n;++r)s*=t[r];return s}function ul(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s<e&&(e=s)}return e}function _o(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let n=0;n<t.length;n++){const s=t[n];s>e&&(e=s)}return e}function Js(t,e){if(e<t)throw new E(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Ig;function Mt(){return Ig==null&&(Ig=gP().epsilon()),Ig}function Zs(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function wr(t,e){return le(t,e)}function vd(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),F(t,n)}function W6(t,e){return P(()=>{if(t.shape.length!==2)throw new E(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=vd(t,1);return g1(n,[1,e,1])})}function U6(t){const e=[Eo(t.shape)];return F(t,e)}function G6(t){if(t.rank<=1)throw new E(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Eo(t.shape,1)];return F(t,e)}function ki(t,e,n){return P(()=>{switch(t.rank){case 1:return sw(t,e,n);case 2:return bN(t,[e,0],[n,t.shape[1]]);case 3:return rw(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Cf(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return tt(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return tt(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new E(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function $g(t,e,n){return P(()=>{switch(t.rank){case 1:return sw(t,e,n);case 2:return bN(t,[0,e],[t.shape[0],n]);case 3:return rw(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Cf(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new E(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function nh(t,e,n,s){return P(()=>{switch(t.rank){case 1:return sw(t,e,n);case 2:switch(s){case 1:return ki(t,e,n);case 2:return $g(t,e,n);default:throw new E(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return ki(t,e,n);case 2:return rw(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return $g(t,e,n);default:throw new E(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return ki(t,e,n);case 2:return Cf(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Cf(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return $g(t,e,n);default:throw new E(`The axis is not within the rank of the tensor ${s}`)}default:throw new E(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Hw(t,e=-1){let n;return e<0&&(n=t[0].rank,n!==0?e=n:e=0),e===t[0].rank&&(e=-1),Dn(t,e)}function jC(t,e){switch(t.rank){case 1:return YL([t,e]);case 2:return JL([t,e],0);case 3:return e4([t,e],0);case 4:return n4([t,e],0);default:throw new E(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function g1(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new E(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return Gs(t,e)}function Im(t,e=0,n=1,s,r){return dV(t,e,n,s,r)}function vr(t,e,n,s){if(t.rank<2||e.rank<2)throw new $e(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=t.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new $e(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return RC({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?x1(t.rank,s,Zs()):null,activation:n});{const r=t.shape.slice(),o=r.pop();t=F(t,[-1,o]);const i=e.shape.slice(),a=i.pop(),l=i.pop(),c=[...i,a],u=Array.from({length:e.rank},(p,g)=>g===0?e.rank-2:g<=e.rank-2?g-1:g);e=F(Fe(e,u),[l,-1]);const d=[...r,...c];return F(RC({a:t,b:e,transposeA:!1,transposeB:!1,bias:s?x1(t.rank,s,Zs()):null,activation:n}),d)}}function $T(t,e,n){return P(()=>(Array.isArray(e)?e=Gn(e,"int32"):e=le(e,"int32"),Vy(t,e,n)))}function bd(t){return D(t,t)}function x1(t,e,n){const s=e.shape;if(e.rank!==1&&e.rank!==t)throw new E(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(n==="channelsFirst")return s.length===1?F(e,[1,s[0],1,1,1]):F(e,[1,s[3],s[0],s[1],s[2]]);if(n==="channelsLast")return s.length===1?F(e,[1,1,1,1,s[0]]):F(e,[1].concat(s))}else if(t===4){if(n==="channelsFirst")return s.length===1?F(e,[1,s[0],1,1]):F(e,[1,s[2],s[0],s[1]]);if(n==="channelsLast")return s.length===1?F(e,[1,1,1,s[0]]):F(e,[1].concat(s))}else if(t===3){if(n==="channelsFirst")return s.length===1?F(e,[1,s[0],1]):F(e,[1,s[1],s[0]]);if(n==="channelsLast")return s.length===1?F(e,[1,1,s[0]]):F(e,[1].concat(s))}else if(t<3)return e;throw new E(`Unsupported input rank by biasAdd: ${e.rank}`)}function nr(t,e,n){return P(()=>(n==null&&(n=Zs()),Nt(n),Z(t,x1(t.rank,e,n))))}function H6(t,e=1){if(e!==1)throw new $e(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return xm(t)}function j6(t){return P(()=>ge(t,Z(xn(t),1)))}function NT(t,e,n,s){return P(()=>aW(t,e,n,s))}function K6(t){return P(()=>{const e=Z(.5,D(.2,t));return as(e,0,1)})}function Cd(t,e,n=!1){return n?t():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const X6=["fanIn","fanOut","fanAvg"],q6=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Y6(t){Zi(X6,"FanMode",t)}function Q6(t){Zi(q6,"Distribution",t)}class As extends Nl{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class TT extends As{apply(e,n){return Kt(e,n)}}TT.className="Zeros";Y(TT);class jw extends As{apply(e,n){return Ko(e,n)}}jw.className="Ones";Y(jw);class ET extends As{constructor(e){if(super(),typeof e!="object")throw new E(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new E(`config must have value set but got ${e}`);this.value=e.value}apply(e,n){return P(()=>D(We(this.value),Ko(e,n)))}getConfig(){return{value:this.value}}}ET.className="Constant";Y(ET);class RT extends As{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,n){return fd(e,this.minval,this.maxval,n,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}RT.className="RandomUniform";Y(RT);class AT extends As{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new $e(`randomNormal does not support dType ${n}.`);return Im(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}AT.className="RandomNormal";Y(AT);class DT extends As{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,n){if(n=n||"float32",n!=="float32"&&n!=="int32")throw new $e(`truncatedNormal does not support dType ${n}.`);return SN(e,this.mean,this.stddev,n,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}DT.className="TruncatedNormal";Y(DT);class _T extends As{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,n){return P(()=>{if(e.length!==2||e[0]!==e[1])throw new E("Identity matrix initializer can only be used for 2D square matrices.");return D(this.gain,iN(e[0]))})}getConfig(){return{gain:this.gain}}}_T.className="Identity";Y(_T);function J6(t,e="channelsLast"){let n,s;if(Nt(e),t.length===2)n=t[0],s=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){const r=Eo(t,2);n=t[1]*r,s=t[0]*r}else if(e==="channelsLast"){const r=Eo(t,0,t.length-2);n=t[t.length-2]*r,s=t[t.length-1]*r}}else{const r=Eo(t);n=Math.sqrt(r),s=Math.sqrt(r)}return[n,s]}class qn extends As{constructor(e){if(super(),e.scale<0)throw new E(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Y6(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Q6(this.distribution),this.seed=e.seed}apply(e,n){const s=J6(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(n=n||"float32",n!=="float32"&&n!=="int32")throw new $e(`${this.getClassName()} does not support dType ${n}.`);return SN(e,0,a,n,this.seed)}else{const a=Math.sqrt(3*i);return fd(e,-a,a,n,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}qn.className="VarianceScaling";Y(qn);class Kw extends qn{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return qn.className}}Kw.className="GlorotUniform";Y(Kw);class Xw extends qn{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return qn.className}}Xw.className="GlorotNormal";Y(Xw);class qw extends qn{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return qn.className}}qw.className="HeNormal";Y(qw);class Yw extends qn{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return qn.className}}Yw.className="HeUniform";Y(Yw);class Qw extends qn{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return qn.className}}Qw.className="LeCunNormal";Y(Qw);class Jw extends qn{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return qn.className}}Jw.className="LeCunUniform";Y(Jw);class FT extends As{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,n){return P(()=>{if(e.length<2)throw new $e("Shape must be at least 2D.");if(n!=="int32"&&n!=="float32"&&n!==void 0)throw new TypeError(`Unsupported data type ${n}.`);n=n;const s=j(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=Im(i,0,1,n,this.seed),l=sU.qr(a,!1);let c=l[0];const d=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return c=D(c,d.sign()),s<r&&(c=c.transpose()),D(We(this.gain),c.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}FT.className="Orthogonal";Y(FT);const KC={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function XC(t,e={}){return wd(t,xs.getMap().classNameMap,e,"initializer")}function xt(t){return Uw(t)}function pt(t){if(typeof t=="string"){const e=t in KC?KC[t]:t;if(e==="GlorotNormal")return new Xw;if(e==="GlorotUniform")return new Kw;if(e==="HeNormal")return new qw;if(e==="HeUniform")return new Yw;if(e==="LeCunNormal")return new Qw;if(e==="LeCunUniform")return new Jw;{const n={};return n.className=e,n.config={},XC(n)}}else return t instanceof As?t:XC(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function y1(t){return Array.isArray(t)&&Array.isArray(t[0])}function kf(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Ce(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new E(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function Pe(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new E(`Expected exactly 1 Shape; got ${t.length}`)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Sf(t){let e=0;for(const n of t)n.shape.length===0?e+=1:e+=n.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const qC="Variable";class Z6{constructor(e,n="float32",s=qC,r=!0,o=null){this.dtype=n??"float32",this.shape=e.shape,this.id=bT(),s=s??qC,this.originalName=kT(s),this.name=ST(this.originalName),this.trainable_=r,this.constraint=o,this.val=sW(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),e5(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function e5(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function w1(t){return t.map(e=>e.read())}function Zw(t){t.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Pt{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Ir{constructor(e,n,s,r,o,i,a){this.dtype=e,this.shape=n,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=bT(),i!=null&&(this.originalName=kT(i),this.name=ST(this.originalName)),this.rank=n.length}}let t5=0;class $m{constructor(e,n){this.callArgs=n,this.id=t5++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const n of this.inboundLayers)n!=null?e.push(n.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let n5=0;class De extends Nl{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=n5++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let n=e.name;if(!n){const s=this.getClassName();n=Dr(s)+"_"+Sm(s)}if(this.name=n,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,n){return e.name+"_ib-"+n.toString()}getNodeAtIndex(e,n){if(this.inboundNodes.length===0)throw new Cs(`The layer has never been called and thus has no defined ${n}.`);if(this.inboundNodes.length<=e)throw new E(`Asked to get ${n} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return Rn(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return Rn(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new cr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new cr(`Layer ${this.name} is not connected, no input to return.`);return Rn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new cr(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new cr(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Rn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(n=>n.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const n=Ke(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=Ke(this.inputSpec);if(n.length!==s.length)throw new E(`Layer ${this.name} expects ${s.length} inputs, but it received ${n.length} input tensors. Input received: ${e}`);for(let r=0;r<n.length;r++){const o=n[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new E(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new E(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new E(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new E(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const l=o.shape;for(const c in i.axes){const u=Number(c),d=i.axes[c],h=u>=0?l[u]:l[l.length+u];if(d!=null&&[d,null].indexOf(h)===-1)throw new E(`Input ${r} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${d} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const c=i.shape[l],u=o.shape[l];if(c!=null&&u!=null&&c!==u)throw new E(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,n){return e}invokeCallHook(e,n){this._callHook!=null&&this._callHook(e,n)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,n){n=n||{},this.assertNotDisposed();const s=Ke(e),r=o5(e),o=i5(e);if(r===o)throw new E("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ci(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of Ke(e))i.push(a.shape);this.build(Rn(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,n);this.supportsMasking&&this.setMaskMetadata(e,i);const a=Ke(i),l=[];for(let c of a)s.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(i=Rn(l),this.activityRegularizer!=null)throw new $e("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=s5(e),a=this.computeOutputShape(i);let l;const c=r5(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new Ir(c,u,this,Ke(e),n,this.name,d)):l=new Ir(c,a,this,Ke(e),n,this.name),this.addInboundNode(e,l,null,null,i,a,n),this._refCount++,this.activityRegularizer!=null)throw new $e("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let n=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(n=!0)}),n&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new cr(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const n of this.inboundNodes){const s=JSON.stringify(n.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const n=this.inboundNodes[0].outputShapes;return Array.isArray(n)&&Array.isArray(n[0])&&n.length===1?n[0]:n}else throw new cr(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Cs(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Sf(this.weights)}build(e){this.built=!0}getWeights(e=!1){return w1(e?this.trainableWeights:this.weights)}setWeights(e){P(()=>{const n=this.weights;if(n.length!==e.length)throw new E(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${n.length} weights. Provided weights: ${e}...`);if(n.length===0)return;const s=[],r=w1(n);for(let o=0;o<r.length;++o){const i=r[o],a=n[o],l=e[o];if(!Ue(i.shape,l.shape))throw new E(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}Zw(s)})}addWeight(e,n,s,r,o,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new E(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():pt("zeros"));const c=r.apply(n,s),u=new Z6(c,s,e,i,a);return c.dispose(),o!=null&&this.addLoss(()=>o.apply(u.read())),i==null&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Ke(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,n){if(!this.supportsMasking){if(n!=null)if(Array.isArray(n))n.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return n}setMaskMetadata(e,n,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=Ke(n),i=Ke(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,n,s,r,o,i,a=null){const l=Ke(e);n=Ke(n),s=Ke(s),r=Ke(r),o=kf(o),i=kf(i);const c=[],u=[],d=[];for(const h of l)c.push(h.sourceLayer),u.push(h.nodeIndex),d.push(h.tensorIndex);new $m({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:n,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let h=0;h<n.length;h++)n[h].sourceLayer=this,n[h].nodeIndex=this.inboundNodes.length-1,n[h].tensorIndex=h}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function s5(t){t=Ke(t);const e=[];for(const n of t)e.push(n.shape);return Rn(e)}function r5(t){return"float32"}function OT(t,e,n){if((e==null||n!=null&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),e.inboundNodes.length===0)return[t];{const s=e.inboundNodes[n];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],l=s.nodeIndices[o],c=OT(i,a,l);for(const u of c)r.indexOf(u)===-1&&r.push(u)}return r}}}function o5(t){let e=!0;for(const n of Ke(t))if(!(n instanceof Ir)){e=!1;break}return e}function i5(t){let e=!0;for(const n of Ke(t))if(n instanceof Ir){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class kd extends De{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Sm("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new E("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let n=e.batchInputShape;if(n==null){if(e.inputShape==null)throw new E("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");n=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new E("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=n,this.dtype=s,this.inputSpec=[{shape:n}];const r=new Ir(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new $m({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[n],outputShapes:[n]})}apply(e,n){throw new E(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}kd.className="InputLayer";Y(kd);function a5(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new E("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let n=t.dtype;return n==null&&(n="float32"),new kd({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function l5(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return le(e,t.dtype)}catch{throw new E(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class fo{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof fo)for(const n in e.id2Value)this.id2Value[n]=e.id2Value[n],n in e.id2Mask&&(this.id2Mask[n]=e.id2Mask[n]);else{if(e==null)return;for(const n of e)this.add(n.key,n.value)}}add(e,n,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=l5(e,n),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new E(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Ir){if(this.id2Value[e.id]==null)throw new E(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const n=this.name2Id[e];if(n==null)throw new E(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[n]}}getMask(e){if(e instanceof Ir){if(this.id2Value[e.id]==null)throw new E(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const n=this.name2Id[e];if(n==null)throw new E(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[n]}}disposeMasks(){this.id2Mask!=null&&Ne(this.id2Mask)}}const If=new yT,$f=new yT;function c5(t){If!=null&&If.setMaxEntries(t),$f!=null&&$f.setMaxEntries(t)}function ic(t,e,n,s){const r=n==null?!1:n.training,o=Array.isArray(t),i=o?t:[t],a=i.map(p=>p.name),l=[],c=e.names();for(const p of a)c.indexOf(p)!==-1?l.push(e.getValue(p)):l.push(null);const u=a.join(",")+"|"+e.names().sort().join(",");let d=If.get(u),h;if(d==null){const p=u5(i,e);d=p.sorted,h=p.recipientCounts,If.put(u,d),$f.put(u,h)}h={},r||Object.assign(h,$f.get(u));const f=new fo(e);for(let p=0;p<d.length;++p){const g=d[p],x=g.sourceLayer;if(x instanceof kd)continue;const m=[],y=[],w=[];let v=!1;for(const $ of g.inputs){const N=f.getValue($),A=f.getMask($);m.push(N),y.push(A),A!=null&&(v=!0),r||(h[$.name]--,h[$.name]===0&&!e.hasKey($)&&a.indexOf($.name)===-1&&!N.isDisposed&&$.sourceLayer.stateful!==!0&&w.push(N))}v&&(n=n||{},n.mask=y[0]);const b=Ke(x.apply(m,n));let C=null;x.supportsMasking&&(C=x.computeMask(m,y));const k=h5(g),S=Array.isArray(k)?k:[k];for(let $=0;$<S.length;++$){f.hasKey(S[$])||f.add(S[$],b[$],Array.isArray(C)?C[0]:C);const N=a.indexOf(S[$].name);N!==-1&&(l[N]=b[$])}r||Ne(w)}return f.disposeMasks(),o?l:l[0]}function u5(t,e){I(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let n=[],s={};if(t.length===1){const r=YC(t[0],e);n=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of t){const{sorted:i,recipientMap:a}=YC(o,e);for(const l of i)r.has(l.name)||(n.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(c=>s[l].add(c))}}return{sorted:n,recipientCounts:d5(s)}}function d5(t){const e={};for(const n in t)e[n]=t[n].size;return e}function YC(t,e){const n=new Set,s=[],r={};for(const a of e.names())n.add(a);const o=[],i=[];for(o.push(t);o.length>0;){const a=o[o.length-1];if(n.has(a.name)){o.pop();continue}const l=i[i.length-1]===o.length-1;if(a.inputs.length===0||l)o.pop(),s.push(a),n.add(a.name),l&&i.pop();else{i.push(o.length-1);for(const c of a.inputs)r[c.name]==null&&(r[c.name]=new Set),r[c.name].add(a.name),!n.has(c.name)&&o.push(c)}}return{sorted:s,recipientMap:r}}function h5(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let n=null;for(let s=0;s<t.sourceLayer.inboundNodes.length;++s)for(const r of t.sourceLayer.inboundNodes[s].outputTensors)if(r.id===t.id){n=s;break}e=t.sourceLayer.getOutputAt(n)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f5=W();f5.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,c5);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ev(t,e){return P(()=>dn(me(D(t,t),e,!0)))}class Sd extends Nl{getConfig(){return{}}}class zT extends Sd{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return P(()=>{const n=ev(e,this.axis),s=as(n,0,this.maxValue);return D(e,ge(s,Z(Mt(),n)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}zT.className="MaxNorm";Y(zT);class MT extends Sd{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return P(()=>ge(e,Z(Mt(),ev(e,this.axis))))}getConfig(){return{axis:this.axis}}}MT.className="UnitNorm";Y(MT);class PT extends Sd{apply(e){return Qi(e)}}PT.className="NonNeg";Y(PT);class LT extends Sd{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return P(()=>{const n=ev(e,this.axis),s=Z(D(this.rate,as(n,this.minValue,this.maxValue)),D(1-this.rate,n));return D(e,ge(s,Z(Mt(),n)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}LT.className="MinMaxNorm";Y(LT);const QC={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Lt(t){return Uw(t)}function JC(t,e={}){return wd(t,xs.getMap().classNameMap,e,"constraint")}function Bt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in QC?QC[t]:t,config:{}};return JC(n)}else return t instanceof Sd?t:JC(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function ei(t){if(t==null)return;const e=[],n=[],s=[];for(const r in t){const o=t[r];if(typeof o!="number"){const i=o;e.push(i.data()),n.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)t[n[o]]=r[o][0];Ne(s)}}function BT(t){if(t!=null)for(const e in t){const n=t[e];typeof n!="number"&&n.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var ZC;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(ZC||(ZC={}));const p5=125;class Yc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,n){}async onEpochEnd(e,n){}async onBatchBegin(e,n){}async onBatchEnd(e,n){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class m5{constructor(e,n=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=n}append(e){this.callbacks.push(e)}setParams(e){for(const n of this.callbacks)n.setParams(e)}setModel(e){for(const n of this.callbacks)n.setModel(e)}async onEpochBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochBegin(e,n)}async onEpochEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onEpochEnd(e,n)}async onBatchBegin(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchBegin(e,n)}async onBatchEnd(e,n){n==null&&(n={});for(const s of this.callbacks)await s.onBatchEnd(e,n)}async onTrainBegin(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const n of this.callbacks)await n.onTrainEnd(e)}}class g5 extends Yc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,n){n==null&&(n={});const s=n.size==null?0:n.size;this.seen+=s;for(const r in n){const o=n[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=P(()=>Z(this.totals[r],D(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,n){if(n!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?n[s]=this.totals[s]/this.seen:P(()=>{const r=D(ge(1,this.seen),this.totals[s]);n[s]=r,this.totals[s].dispose(),xr(n[s])}))}}class x5 extends Yc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,n){n==null&&(n={}),this.epoch.push(e);for(const s in n)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(n[s])}async syncData(){const e=[],n=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];e.push(l.data()),n.push(o),s.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[n[o]][s[o]].dispose(),this.history[n[o]][s[o]]=r[o][0]}}class y5 extends Yc{constructor(e,n){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||HN,this.yieldEvery=n||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=p5),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");X0(this.yieldEvery)&&(this.maybeWait=A6(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,n,s){const r=[];this.yield!=null&&(await ei(s),r.push(this.yield(e,n,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,n){this.currentEpoch=e,this.epochBegin!=null&&(await ei(n),await this.epochBegin(e,n))}async onEpochEnd(e,n){const s=[];this.epochEnd!=null&&(await ei(n),s.push(this.epochEnd(e,n))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,n){this.batchBegin!=null&&(await ei(n),await this.batchBegin(e,n))}async onBatchEnd(e,n){const s=[];this.batchEnd!=null&&(await ei(n),s.push(this.batchEnd(e,n))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):X0(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,n)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await ei(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await ei(e),await this.trainEnd(e))}}function VT(t,e){return t==null&&(t={}),t instanceof Yc?[t]:Array.isArray(t)&&t[0]instanceof Yc?t:Ke(t).map(s=>new y5(s,e))}class ps{constructor(){}static registerCallbackConstructor(e,n){I(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),ps.checkForDuplicate(n),ps.constructors[e]==null&&(ps.constructors[e]=[]),ps.constructors[e].push(n)}static checkForDuplicate(e){for(const n in ps.constructors)ps.constructors[+n].forEach(r=>{if(r===e)throw new E("Duplicate callback constructor.")})}static clear(){ps.constructors={}}static createCallbacks(e){const n=[];for(const s in ps.constructors){const r=+s;e>=r&&n.push(...ps.constructors[r])}return n.map(s=>new s)}}ps.constructors={};function WT(t,e,n,s,r,o,i,a,l){const c=new x5,u=[new g5,...ps.createCallbacks(e)];t!=null&&u.push(...t),u.push(c);const d=new m5(u);return d.setParams({epochs:n,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:d,history:c}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function br(t,e={},n=!1){return wd(t,xs.getMap().classNameMap,e,"layer",n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Nf(t,e){return P(()=>{t.dtype!=="float32"&&(t=le(t,"float32"));const n=me(bd(t),e,!0),s=gm(n.shape,Mt()),r=dn(jo(n,s));return ge(t,r)})}function Nm(t,e){return P(()=>Rt(bd(ve(e,t)),-1))}function tv(t,e){return P(()=>Rt(xn(ve(e,t)),-1))}function nv(t,e){return P(()=>{const n=ve(t,e),s=as(xn(t),Mt(),Number.MAX_VALUE),r=xn(ge(n,s));return D(100,Rt(r,-1))})}function w5(t,e){return P(()=>{const n=as(e,Mt(),Number.MAX_VALUE),s=Sr(Z(1,n)),r=as(t,Mt(),Number.MAX_VALUE),o=Sr(Z(1,r));return Rt(bd(ve(s,o)),-1)})}function v5(t,e){return P(()=>{const n=jo(0,ve(1,D(t,e)));return Rt(bd(n),-1)})}function b5(t,e){return P(()=>{const n=jo(0,ve(1,D(t,e)));return Rt(n,-1)})}function C5(t,e){return P(()=>{const n=me(D(t,e),-1),s=qs(D(ve(1,t),e),-1);return jo(0,Z(1,ve(s,n)))})}function k5(t,e){return P(()=>{const n=Math.log(2),s=ve(e,t),r=ve(Z(s,hd(D(-2,s))),n);return Rt(r,-1)})}function Qc(t,e,n=!1){return P(()=>{if(n)e=ow(e);else{const s=me(e,e.shape.length-1,!0);e=ge(e,s)}return e=as(e,Mt(),1-Mt()),St(me(D(le(t,"float32"),Sr(e)),e.shape.length-1))})}function Tf(t,e,n=!1){return P(()=>{const s=le(wm(U6(t)),"int32");e=as(e,Mt(),1-Mt());const r=e.shape,o=F(dN(s,r[r.length-1]),r);return Qc(o,e,n)})}function S5(t,e){if(!Ue(t.shape,e.shape))throw new E(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return P(()=>{const n=Qi(e),s=St(xn(e));return Z(ve(n,D(e,t)),aN(kr(s)))})}function Tm(t,e){return P(()=>{let n;return n=as(e,Mt(),1-Mt()),n=Sr(ge(n,ve(1,n))),Rt(S5(t,n),-1)})}function I5(t,e){return P(()=>{const n=as(t,Mt(),1),s=as(e,Mt(),1);return me(D(t,Sr(ge(n,s))),-1)})}function $5(t,e){return P(()=>{const n=Sr(Z(Mt(),e));return Rt(ve(e,D(t,n)),-1)})}function UT(t,e){return P(()=>{const n=Nf(t,-1),s=Nf(e,-1),r=D(n,s);return St(me(r,-1))})}const Ef={meanSquaredError:Nm,meanAbsoluteError:tv,meanAbsolutePercentageError:nv,meanSquaredLogarithmicError:w5,squaredHinge:v5,hinge:b5,categoricalHinge:C5,logcosh:k5,categoricalCrossentropy:Qc,sparseCategoricalCrossentropy:Tf,binaryCrossentropy:Tm,kullbackLeiblerDivergence:I5,poisson:$5,cosineProximity:UT};function Ng(t){if(typeof t=="string"){if(t in Ef)return Ef[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new E(e)}else return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function GT(t,e){return P(()=>{const n=D(.5,Es(e)),s=wr(us(e,n),t.dtype);return Rt(Cr(t,s),-1)})}function HT(t,e){return P(()=>wr(Cr(Hc(t,-1),Hc(e,-1)),"float32"))}function N5(t,e){return P(()=>le(me(Ur(Cr(t,1),Cr(e,1))),"float32"))}function T5(t,e){return P(()=>le(me(Ur(Cr(t,0),Cr(e,1))),"float32"))}function E5(t,e){return P(()=>{const n=N5(t,e),s=T5(t,e),r=Z(n,s);return le(Cn(us(r,0),ge(n,r),0),"float32")})}function R5(t,e){return Tm(t,e)}function A5(t,e){return t.rank===e.rank&&(t=pd(t,[t.rank-1])),e=Hc(e,-1),e.dtype!==t.dtype&&(e=le(e,t.dtype)),le(Cr(t,e),"float32")}const D5=Nm,_5=Nm,F5=tv,O5=tv,z5=nv,M5=nv,jT=Qc,P5=UT,KT=Tf,Rf={binaryAccuracy:GT,categoricalAccuracy:HT,precision:E5,categoricalCrossentropy:jT,sparseCategoricalCrossentropy:KT,mse:D5,MSE:_5,mae:F5,MAE:O5,mape:z5,MAPE:M5,cosine:P5};function L5(t){if(typeof t=="string"&&t in Rf)return Rf[t];if(typeof t!="string"&&t!=null)return t;throw new E(`Unknown metric ${t}`)}function sh(t){if(ur(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(const n of Object.keys(Ef))if(Ef[n]===t){e=n;break}if(e!==void 0)return e;for(const n of Object.keys(Rf))if(Rf[n]===t){e=n;break}return e!==void 0?e:t.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function B5(t){const e={Adagrad:()=>aa.adagrad(.01),Adadelta:()=>aa.adadelta(1,.95,Mt()),Adam:()=>aa.adam(.001,.9,.999,Mt()),Adamax:()=>aa.adamax(.002,.9,.999,Mt(),0),RMSProp:()=>aa.rmsprop(.001,.9,0,Mt()),SGD:()=>aa.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new E(`Unknown Optimizer ${t}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const ek=1*1024*1024;function tk(t,e,n=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!v1(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const s=JSON.stringify(t);s.length>ek&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${ek}.`)}}function v1(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e)if(typeof n!="string"||!v1(t[n]))return!1;return!0}else if(Array.isArray(t)){for(const e of t)if(!v1(e))return!1;return!0}else return!1;else{const e=typeof t;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function V5(t,e,n,s=console.log){const r=U5(t),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,n=n||[.32,.61,.89,1]):(e=e||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map(u=>Math.floor(e*u)));let i;if(!r){o.push("Receives inputs"),i=[];for(const u in t.nodesByDepth)i.push(...t.nodesByDepth[u])}s("_".repeat(e)),Af(o,n,s),s("=".repeat(e));const a=t.layers;for(let u=0;u<a.length;++u)r?G5(a[u],n,s):H5(a[u],n,i,s),s((u===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const l=W5(t),c=Sf(t.nonTrainableWeights);s(`Total params: ${l+c}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function W5(t){let e;return t.collectedTrainableWeights!=null?e=Sf(t.collectedTrainableWeights):e=Sf(t.trainableWeights),e}function U5(t){let e=!0;const n=[],s=[];for(const r in t.nodesByDepth)n.push(t.nodesByDepth[r]);for(const r of n){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of t.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function Af(t,e,n=console.log){let s="";for(let r=0;r<t.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=t[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);n(s)}function G5(t,e,n){let s,r;try{r=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(t.outputShape)}catch{s="multiple"}const o=t.name,i=t.getClassName(),a=[`${o} (${i})`,r,s,t.countParams().toString()];Af(a,e,n)}function H5(t,e,n,s){let r,o;try{o=t.inboundNodes.map(d=>JSON.stringify(d.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}const i=[];for(const d of t.inboundNodes)if(!(n!=null&&n.length>0&&n.indexOf(d)===-1))for(let h=0;h<d.inboundLayers.length;++h){const f=d.inboundLayers[h].name,p=d.nodeIndices[h],g=d.tensorIndices[h];i.push(`${f}[${p}][${g}]`)}const a=t.name,l=t.getClassName(),c=i.length===0?"":i[0],u=[`${a} (${l})`,o,r,t.countParams().toString(),c];Af(u,e,s);for(let d=1;d<i.length;++d)Af(["","","","",i[d]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XT(t,e,n){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof n=="string"}function Df(t,e){if(t===null)return null;if(typeof t=="string")return ii(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const o=t[r];XT(e,r,o)?n.push(o):n.push(Df(o,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s];if(s==="name"&&typeof r=="string")n[s]=r;else{const o=ii(s);n[o]=Df(r,o)}}return n}}function b1(t,e){if(t==null)return null;if(typeof t=="string")return Dr(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){const n=[],s=t.length;for(let r=0;r<s;++r){const o=t[r];XT(e,r,o)?n.push(o):n.push(b1(o,e))}return n}else{const n={};for(const s of Object.keys(t)){const r=t[s],o=Dr(s);(s==="name"||s==="className")&&typeof r=="string"?n[o]=r:n[o]=b1(r,s)}return n}}/** @license See the LICENSE file. */const qT="4.21.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const j5=t=>{const e=Object.keys(t);if(e.length===0)return!1;const n=e[0].split("/");return!isNaN(parseInt(n[n.length-1],10))};class Ms extends De{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const y=this.getClassName().toLowerCase();this.name=Sm(y)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],To(this.inputs).length!==this.inputs.length)throw new E(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(y=>y.name)}`);To(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(y=>y.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const w=y.sourceLayer,v=y.nodeIndex,b=y.tensorIndex;this.outputLayers.push(w),this.outputLayersNodeIndices.push(v),this.outputLayersTensorIndices.push(b)}for(const y of this.inputs){const w=y.sourceLayer,v=y.nodeIndex,b=y.tensorIndex;ur(v===0,"input layer has >1 nodes"),ur(b===0,"input layer has >1 tensors"),this.inputLayers.push(w),this.inputLayersNodeIndices.push(v),this.inputLayersTensorIndices.push(b)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const w=this.inputLayers[y];if(!(w instanceof kd))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${y} (0-based) originates from layer type ${w.getClassName()}.`);this.inputNames.push(w.name),this.feedInputShapes.push(w.batchInputShape),this.feedInputNames.push(w.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map(y=>y.shape),this.internalOutputShapes=this.outputs.map(y=>y.shape);const n={},s={},r={},o={},i={},a=[],l=(y,w,v,b,C,k)=>{(b==null||C==null||k==null)&&(b=y.sourceLayer,C=y.nodeIndex,k=y.tensorIndex);const S=b.inboundNodes[C];if(v.indexOf(S)!==-1)throw new Cs(`The tensor ${y.name} at layer "${b.name}" is part of a cycle.`);if(w.indexOf(S)!==-1)return;this.containerNodes.add(Ms.nodeKey(b,C)),b.id in i||(i[b.id]=Object.keys(i).length),v.indexOf(S)===-1&&v.push(S);const $=S.inboundLayers.length;for(let N=0;N<$;N++){const A=S.inputTensors[N],M=S.inboundLayers[N],L=S.nodeIndices[N],V=S.tensorIndices[N];l(A,w,v,M,L,V)}for(w.push(S);v.indexOf(S)>=0;)v.splice(v.indexOf(S),1);a.push(S)},c=[],u=[];for(const y of this.outputs)l(y,c,u);const d=a.slice().reverse();for(const y of d){s[y.id]=y,y.id in n||(n[y.id]=0);let w=n[y.id];const v=r[y.outboundLayer.id]==null?0:r[y.outboundLayer.id];w=Math.max(w,v),r[y.outboundLayer.id]=w,o[y.outboundLayer.id]=y.outboundLayer,n[y.id]=w;for(let b=0;b<y.inboundLayers.length;b++){const C=y.inboundLayers[b],k=y.nodeIndices[b],S=C.inboundNodes[k],$=n[S.id]==null?0:n[S.id];n[S.id]=Math.max(w+1,$),s[S.id]=S}}const h={};for(const y in n){const w=n[y];w in h||(h[w]=[]),h[w].push(s[y])}const f={};for(const y in r){const w=r[y];w in f||(f[w]=[]),f[w].push(o[y])}let p=Object.keys(f).map(y=>parseInt(y,10)).sort(eh);this.layers=[];for(const y of p){const w=f[y];w.sort((v,b)=>{const C=i[v.id],k=i[b.id];return C<k?-1:C>k?1:0});for(const v of w)v instanceof Ms&&this.internalContainerRefs.push(v),this.layers.push(v)}this.layersByDepth=f,p=Object.keys(h).map(y=>parseInt(y,10)).sort(eh);const g=this.inputs.slice(),x=[];for(const y of p)for(const w of h[y]){const v=w.outboundLayer;if(v!=null){for(const b of w.inputTensors)if(g.indexOf(b)===-1)throw new Cs(`Graph disconnected: cannot obtain value for tensor ${b} at layer "${v.name}". The following previous layers were accessed without issue: ${x}`);for(const b of w.outputTensors)g.push(b);x.push(v.name)}}this.nodesByDepth=h;const m=this.layers.map(y=>y.name);for(const y of m){const w=m.filter(v=>v===y).length;if(w!==1)throw new Cs(`The name "${y}" is used ${w} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(m))}this.outboundNodes=[],this.inboundNodes=[],new $m({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(y=>null),outputMasks:this.outputs.map(y=>null),inputShapes:this.inputs.map(y=>y.shape),outputShapes:this.outputs.map(y=>y.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const n of this.layers)e.numDisposedVariables+=n.dispose().numDisposedVariables;for(const n of this.internalContainerRefs)e.numDisposedVariables+=n.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(n=>{n._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new E("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const n of this.layers)e=e.concat(n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.layers)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.layers)n.push(...s.trainableWeights);return n.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,n=!0){const s={};let r=0;const o=j5(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[l,c]of a.weights.entries()){const u=o?`${c.name.split("/").slice(0,-1).join("/")+"/"}${l}`:c.originalName;if(s[u]!=null)throw new E(`Duplicate weight name: ${u}`);s[u]=c,r++}const i=[];for(const a in e){let l=a;if(s[a]==null){const c=a.split("/");l=c.slice(0,-2).concat([c[c.length-1]]).join("/")}if(s[l]!=null)i.push([s[l],e[a]]);else if(n)throw new E(`Provided weight data has no target variable: ${a}`);delete s[l]}if(n){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new E(`${a.length} of ${r} weights are not set: ${a}`)}Zw(i)}parseWeights(e){for(const n in Object.keys(e)){const s=n.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==n&&(e[o]=e[n],delete e[n])}}updatedConfig(){const e=this.getConfig(),n={};return n.className=this.getClassName(),n.config=e,n.kerasVersion=`tfjs-layers ${qT}`,n.backend="TensorFlow.js",n}toJSON(e,n=!0){const s=b1(this.updatedConfig());return n?JSON.stringify(s):s}call(e,n){return P(()=>{e=Ke(e);const s=new fo;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return ic(this.outputs,s,n)})}computeMask(e,n){return P(()=>{e=Ke(e);let s;return n==null?s=Bi(null,e.length):s=Ke(n),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const n=kf(e);if(n.length!==this.inputLayers.length)throw new E(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<n.length;a++){const l=this.inputLayers[a],c=n[a],u=l.name+"_0_0";s[u]=c}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(eh);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const c of l){const u=c.outboundLayer;if(this.inputLayers.map(g=>g.id).indexOf(u.id)!==-1)continue;const d=[];for(let g=0;g<c.inboundLayers.length;g++){const x=c.inboundLayers[g],m=c.nodeIndices[g],y=c.tensorIndices[g],w=`${x.name}_${m}_${y}`,v=s[w];d.push(v)}const h=u.computeOutputShape(Rn(d)),f=kf(h),p=u.inboundNodes.indexOf(c);for(let g=0;g<f.length;g++){const x=`${u.name}_${p}_${g}`;s[x]=f[g]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;i.push(d)}for(let a=0;a<i.length;a++){const l=i[a];ur(l in s),o.push(s[l])}return Rn(o)}runInternalGraph(e,n){n==null&&(n=Bi(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const c=this.inputs[l],u=e[l],d=n[l];s[c.id]=[u,d]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(eh);for(const l of r){const c=this.nodesByDepth[l];for(const u of c){const d=u.outboundLayer,h=u.inputTensors,f=u.outputTensors,p=new Array;for(const g of h)g.id in s&&p.push(s[g.id]);if(p.length===h.length){let g={},x,m,y,w;if(u.callArgs!=null&&(g=u.callArgs),p.length===1){const[v,b]=p[0];g.mask==null&&(g.mask=b),y=Ke(d.call(v,g)),w=Ke(d.computeMask(v,b)),x=[v],m=[b]}else x=p.map(v=>v[0]),m=p.map(v=>v[1]),g.mask==null&&(g.mask=m),y=Ke(d.call(x,g)),w=Ke(d.computeMask(x,m));if(d.activityRegularizer)throw new $e("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let v=0;v<f.length;++v){const b=f[v],C=y[v],k=w[v];s[b.id]=[C,k]}}}}const o=[],i=[],a=[];for(const l of this.outputs){ur(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[c,u]=s[l.id];a.push(c.shape),o.push(c),i.push(u)}return[o,i,a]}buildNodeConversionMap(e){const n={};let s;for(const r of this.layers){s=r instanceof Ms?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=Ms.nodeKey(r,o);this.containerNodes.has(i)&&(n[i]=s,s+=1)}}return n}getLayer(e,n){if(n!=null)return this.findLayer(n);if(e==null)throw new E("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new E(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new E(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return P(()=>{const e=[];for(const n of this.layers)for(let s=0;s<n.inboundNodes.length;++s){const r=Ms.nodeKey(n,s);this.containerNodes.has(r)&&e.push(...n.calculateLosses())}return e})}getConfig(){const e={name:this.name},n=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),c=[];for(let d=0;d<i.inboundNodes.length;d++){const h=i.inboundNodes[d],f=Ms.nodeKey(i,d);let p={};if(this.containerNodes.has(f)){if(h.callArgs)try{JSON.stringify(h.callArgs),p=h.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${h.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),p={}}if(h.inboundLayers.length>0){const g=[];for(let x=0;x<h.inboundLayers.length;x++){const m=h.inboundLayers[x],y=h.nodeIndices[x],w=h.tensorIndices[x],v=Ms.nodeKey(m,y);let b=n[v];b==null&&(b=0),g.push([m.name,b,w,p])}c.push(g)}}}const u={};u.name=i.name,u.className=a,u.config=l,u.inboundNodes=c,s.push(u)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],c=Ms.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.inputLayersTensorIndices[i];r.push([a.name,u,d])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],c=Ms.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=n[c];u==null&&(u=0);const d=this.outputLayersTensorIndices[i];o.push([a.name,u,d])}return e.outputLayers=o,e}static fromConfig(e,n,s={},r=!1){const o={},i={};function a(x,m){x.name in i?i[x.name].push(m):i[x.name]=[m]}function l(x,m){const y=[];let w;for(const v of m){const b=v[0],C=v[1],k=v[2];if(w=v[3]==null?{}:v[3],!(b in o)){a(x,m);return}const S=o[b];if(S.inboundNodes.length<=C){a(x,m);return}const $=S.inboundNodes[C];y.push($.outputTensors[k])}y.length>0&&x.apply(Rn(y),w)}function c(x){const m=x.name,y=br(x,n.customObjects!=null?n.customObjects:{});y.setFastWeightInitDuringBuild(r),o[m]=y,x.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new E(`Corrupted configuration, expected array for nodeData: ${v}`);a(y,v)})}const u=n.name,d=n.layers;for(const x of d)c(x);for(;!R6(i);)for(const x of d){const m=o[x.name];if(m.name in i){const y=i[m.name];delete i[m.name];for(const w of y)l(m,w)}}const h=[],f=[],p=n.inputLayers;for(const x of p){const m=x[0],y=x[1],w=x[2];ur(m in o);const b=o[m].inboundNodes[y].outputTensors;h.push(b[w])}const g=n.outputLayers;for(const x of g){const m=x[0],y=x[1],w=x[2];ur(m in o);const b=o[m].inboundNodes[y].outputTensors;f.push(b[w])}return new e({inputs:h,outputs:f,name:u})}get stateful(){if(this._stateful)throw new E("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){P(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function K5(t,e,n){const s=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(r=>null);if(s===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){const r=[];return e.forEach(o=>{o in t?r.push(t[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function YT(t,e){return K5(t,e,"classWeight")}async function QT(t,e,n,s){if(n!=null){const r=P(()=>{if(t.shape.length===1)return bi(t);if(t.shape.length===2){if(t.shape[1]>1)return Hc(t,1);if(t.shape[1]===1)return F(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());Ne(r);const i=[];return o.forEach(a=>{if(n[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(n[a])}),Gn(i,"float32")}else return null}function X5(t,e){return D(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const q5=32;function JT(t,e){let n,s;const r=e;n=r.xs,s=r.ys,I(n!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=nk("input",t.inputNames,n),i=nk("output",t.outputNames,s),a=o[0].shape[0];I(o.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),I(i.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<o.length;l++)I(o[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<i.length;l++)I(i[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:o,ys:i}}function nk(t,e,n){if(n instanceof Ot)return[n];if(Array.isArray(n))return I(n.length===e.length,()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),n;{const s=[];for(const r of e){if(n[r]==null)throw new E(`The feature data generated by the dataset lacks the required ${t} key '${r}'.`);s.push(n[r])}return s}}function Y5(t){if(t.length===3)throw new $e("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function Q5(t,e,n){const s=n.batchesPerEpoch!=null;if(I(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),I(n!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),I(n.epochs!=null&&n.epochs>0&&Number.isInteger(n.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`),I(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`),I(n.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const r=n.validationData!=null;let o,i;if(r)if(sk(n.validationData))I(n.validationBatches==null||n.validationBatches>0&&Number.isInteger(n.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`);else{const x=Y5(n.validationData);o=x.xs,i=x.ys}const a=t.makeTrainFunction(),l=t.getDedupedMetricsNames();let c;r?c=l.slice().concat(l.map(x=>"val_"+x)):c=l.slice();const u=VT(n.callbacks,n.yieldEvery),d=n.verbose==null?1:n.verbose,{callbackList:h,history:f}=WT(u,d,n.epochs,null,null,J5(e,n),null,r,c);h.setModel(t),t.history=f,await h.onTrainBegin(),t.stopTraining_=!1;let p=n.initialEpoch==null?0:n.initialEpoch,g=await e.iterator();for(;p<n.epochs;){const x={};await h.onEpochBegin(p);let m=0,y=0;for(s||(g=await e.iterator());!s||m<n.batchesPerEpoch;){const w=await g.next();if(s&&w.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${m} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${n.batchesPerEpoch*n.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(w.value!=null){const{xs:v,ys:b}=JT(t,w.value),C={};C.batch=y,C.size=v[0].shape[0],await h.onBatchBegin(y,C);const k=[];if(n.classWeight!=null){const N=YT(n.classWeight,t.outputNames);for(let A=0;A<N.length;++A)k.push(await QT(b[A],null,N[A]))}const S=v.concat(b).concat(k),$=a(S);Ne(S);for(let N=0;N<l.length;++N){const A=l[N],M=$[N];C[A]=M,xr(M)}await h.onBatchEnd(y,C),BT(C),y++,m++}if(s?m>=n.batchesPerEpoch:w.done){if(r){let v;sk(n.validationData)?v=Ke(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):v=Ke(t.evaluate(o,i,{batchSize:n.validationBatchSize==null?q5:n.validationBatchSize,verbose:0}));for(let b=0;b<t.metricsNames.length;++b)x[`val_${t.metricsNames[b]}`]=v[b]}break}if(t.stopTraining_)break}if(await h.onEpochEnd(p,x),p++,t.stopTraining_)break}return await h.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function J5(t,e){let n=null;return e.batchesPerEpoch!=null?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function sk(t){return typeof t.iterator=="function"}function Z5(t){return typeof t.next=="function"}async function eH(t,e,n){n=n||{};const s=n.batches!=null,r=t.testFunction;let o=[];if(n.verbose>0)throw new $e("Verbose mode is not implemented yet.");I(!s||n.batches>0&&Number.isInteger(n.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`);const i=Z5(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<n.batches;){const c=await i.next();if(o=P(()=>{if(c.value){const{xs:u,ys:d}=JT(t,c.value),h=u.concat(d),f=P(()=>r(h));if(Ne(h),l===0)for(let g=0;g<f.length;++g)o.push(We(0));const p=h[0].shape[0];for(let g=0;g<f.length;++g){const x=f[g],m=o[g];o[g]=P(()=>Z(o[g],D(p,x))),l>0&&Ne(m)}Ne(f),a+=p,++l}return o}),c.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<o.length;++c){const u=o[c];o[c]=ge(o[c],a),Ne(u)}return Rn(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Tg(t){I(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Xl(t,e,n){return t==null?[null]:Array.isArray(t)?t.map(s=>ki(s,e,n-e)):ki(t,e,n-e)}function C1(t,e){return P(()=>t==null?null:Array.isArray(t)?t.map(n=>C1(n,e)):$T(t,e.dtype==="int32"?e:le(e,"int32")))}function Eg(t,e){const n=[];let s=0,r=null;for(;s<t;)r=s+e,r>=t&&(r=t),n.push([s,r]),s=r;return n}function ZT(t){const e=[];t instanceof Ot&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(s.rank===1)e.push(vd(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function zs(t,e){if(t==null)return;const n=[];if(e instanceof Ot)n.push(e.id);else if(Array.isArray(e))e.forEach(r=>n.push(r.id));else if(e!=null)for(const r in e){const o=e[r];n.push(o.id)}const s=[];if(t instanceof Ot)n.indexOf(t.id)===-1&&s.push(t);else if(Array.isArray(t))t.forEach(r=>{n.indexOf(r.id)===-1&&s.push(r)});else if(t!=null)for(const r in t){const o=t[r];n.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function tH(t){return t instanceof Ot}function k1(t){return Array.isArray(t)}function rk(t){return!tH(t)&&!k1(t)}function ok(t,e,n,s=!0,r=""){if(e==null||e.length===0){if(t!=null){let i=!1;if(k1(t)&&t.length>0)i=!0;else if(rk(t)){for(const a in t)if(t.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new E(`Error when checking model ${r} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(i=>null);let o;if(rk(t)){t=t,o=[];for(const i of e){if(t[i]==null)throw new E(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(t[i])}}else if(k1(t)){if(t=t,t.length!==e.length)throw new E(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);o=t}else{if(t=t,e.length>1)throw new E(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);o=[t]}if(o=ZT(o),n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=o[i];if(a.shape.length!==n[i].length)throw new E(`Error when checking ${r}: expected ${e[i]} to have ${n[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=n[i][l];if(u!=null&&u>=0&&c!==u)throw new E(`${r} expected a batch of elements where each example has shape [${n[i].slice(1,n[i].length)}] (i.e.,tensor shape [*,${n[i].slice(1,n[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function nH(t,e,n){const s=To(t.map(o=>o.shape[0]));s.sort();const r=To(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new E(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(o=>o.shape))}`);if(r.length>1)throw new E(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!Ue(s,r))throw new E(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function sH(t,e,n){const s=[Nm,Tm,Qc];for(let r=0;r<t.length;++r){const o=t[r],i=e[r],a=n[r];if(i!=null){if(i===Qc&&o.shape[o.shape.length-1]===1)throw new E(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const l=o.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){const d=l[u],h=c[u];if(h!=null&&d!==h)throw new E(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function ik(t,e,n,s=!0,r=""){let o;if(Array.isArray(t)){if(t.length!==e.length)throw new E(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);o=t}else{if(e.length>1)throw new E(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);o=[t]}if(n!=null)for(let i=0;i<e.length;++i){if(n[i]==null)continue;const a=o[i];if(a.shape.length!==n[i].length)throw new E(`Error when checking ${r}: expected ${e[i]} to have ${n[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<n[i].length;++l){if(l===0&&!s)continue;const c=a.shape[l],u=n[i][l];if(u!=null&&u!==c)throw new E(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(n[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function rH(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(s=>[]);let n;if(typeof t=="string"||typeof t=="function")n=[t];else if(Array.isArray(t)||typeof t=="object")n=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(n))return e.map(s=>n);{const s=[];for(const r of e){let o=n.hasOwnProperty(r)?n[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const oH="layers-model";class Ba extends Ms{constructor(e){super(e),this.isTraining=!1}summary(e,n,s=console.log){if(!this.built)throw new E("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");V5(this,e,n,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=B5(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Xo))throw new E("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let n=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new E(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),n.push(Ng(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new E(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);n=e.loss.map(a=>Ng(a))}else{const i=Ng(e.loss);this.outputs.forEach(a=>{n.push(i)})}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ci("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=rH(e.metrics,this.outputNames),o=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};Ci("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(c=>{const u="";let d,h,f;for(const p of c){if(typeof p=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(p)!==-1){const x=this.internalOutputShapes[i];x[x.length-1]===1||this.lossFunctions[i]===Tm?["accuracy","acc"].indexOf(p)!==-1?h=GT:["crossentropy","ce"].indexOf(p)!==-1&&(h=R5):this.lossFunctions[i]===Tf?["accuracy","acc"].indexOf(p)!==-1?h=A5:["crossentropy","ce"].indexOf(p)!==-1&&(h=KT):["accuracy","acc"].indexOf(p)!==-1?h=HT:["crossentropy","ce"].indexOf(p)!==-1&&(h=jT);let m;["accuracy","acc"].indexOf(p)!==-1?m="acc":["crossentropy","ce"].indexOf(p)!==-1&&(m="ce"),f=h,d=u+m}else f=L5(p),d=u+sh(p);let g;Ci(d,()=>{g=f}),o(i,d,g)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,n,s={}){const r=s.batchSize==null?32:s.batchSize;Tg(r);const i=this.standardizeUserDataXY(e,n,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,c=this.testLoop(l,a,r,s.verbose,s.steps);return Rn(c)}finally{zs(i[0],e),zs(i[1],n)}}async evaluateDataset(e,n){return this.makeTestFunction(),eH(this,e,n)}checkNumSamples(e,n,s,r="steps"){let o;if(s!=null){if(o=null,n!=null)throw new E(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${n}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new E(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,n){if(Array.isArray(n)&&n.length===0)throw new E("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(n),r=s?n:[n],o=this.retrieveSymbolicTensors(r),i=new fo;if(e instanceof Ot&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new E(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(const l of this.inputs){const c=e[l.name];if(c==null)throw new E(`No value is provided for the model's input ${l.name}`);i.add(l,c)}const a=ic(o,i);return s?a:a[0]}retrieveSymbolicTensors(e){const n=Bi(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const l=i.indexOf(e[a]);if(l!==-1&&(n[a]=o[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw n.forEach((o,i)=>{o==null&&r.push(e[i])}),new E(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return n}predictLoop(e,n=32,s=!1){return P(()=>{const r=this.checkNumSamples(e);if(s)throw new $e("Verbose predictLoop() is not implemented yet.");const o=Eg(r,n),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)P(()=>{const c=o[a][0],u=o[a][1],d=Xl(e,c,u),h=[];if(Array.isArray(d))for(let p=0;p<d.length;++p)h.push({key:this.inputs[p],value:d[p]});else h.push({key:this.inputs[0],value:d});const f=new fo(h);return ic(this.outputs,f)}).forEach((c,u)=>i[u].push(c));return Rn(i.map(a=>Dn(a,0)))})}predict(e,n={}){const s=ZT(e);ik(s,this.inputNames,this.feedInputShapes,!1);try{const r=n.batchSize==null?32:n.batchSize;return Tg(r),this.predictLoop(s,r)}finally{zs(s,e)}}predictOnBatch(e){ik(e,this.inputNames,this.feedInputShapes,!0);const n=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,n)}standardizeUserDataXY(e,n,s=!0,r){if(this.optimizer_==null)throw new Cs("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===Tf?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=ok(e,this.feedInputNames,this.feedInputShapes,!1,"input"),n=ok(n,this.feedOutputNames,o,!1,"target"),nH(e,n),sH(n,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new E(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,n]}async standardizeUserData(e,n,s,r,o=!0,i){const[a,l]=this.standardizeUserDataXY(e,n,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let c=null;if(r!=null){const u=YT(r,this.outputNames);c=[];for(let d=0;d<u.length;++d)c.push(await QT(l[d],null,u[d]))}return[a,l,c]}testLoop(e,n,s,r=0,o){return P(()=>{const i=this.checkNumSamples(n,s,o,"steps"),a=[];if(r>0)throw new $e("Verbose mode is not implemented yet.");if(o!=null)throw new $e("steps mode in testLoop() is not implemented yet");{const l=Eg(i,s),c=Gn(Js(0,i));for(let u=0;u<l.length;++u){const d=l[u][0],h=l[u][1],f=ki(c,d,h-d),p=C1(n,f),g=e(p);if(u===0)for(let x=0;x<g.length;++x)a.push(We(0));for(let x=0;x<g.length;++x){const m=g[x];a[x]=Z(a[x],D(h-d,m))}}for(let u=0;u<a.length;++u)a[u]=ge(a[u],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,n=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(GC(e,r)>1){const i=GC(e.slice(0,s),r);o+=`_${i}`}n.push(o)}return n}makeTrainFunction(){return e=>{const n=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const d=[];for(let g=0;g<this.inputs.length;++g)d.push({key:this.inputs[g],value:s[g]});const h=new fo(d),f=ic(this.outputs,h,{training:!0});let p;for(let g=0;g<this.lossFunctions.length;++g){const x=this.lossFunctions[g];let m=x(r[g],f[g]);o[g]!=null&&(m=X5(m,o[g]));const y=Rt(m);n.push(y),g===0?p=m:p=Z(p,m)}for(let g=0;g<this.metricsTensors.length;++g){let x;if(this.outputs.length>1&&g<this.outputs.length)x=n[g];else{const m=this.metricsTensors[g][0],y=this.metricsTensors[g][1];x=Rt(m(r[y],f[y]))}xr(x),i.push(x)}return p=Rt(p),this.calculateLosses().forEach(g=>{p=Z(p,g)}),p},l=this.collectedTrainableWeights.map(d=>d.read());return[this.optimizer_.minimize(a,!0,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>P(()=>{const n=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let c=0;c<this.inputs.length;++c)i.push({key:this.inputs[c],value:r[c]});const a=new fo(i),l=ic(this.outputs,a);for(let c=0;c<this.lossFunctions.length;++c){const u=this.lossFunctions[c],d=Rt(u(o[c],l[c]));c===0?s=d:s=Z(s,d),n.push(s)}for(let c=0;c<this.metricsTensors.length;++c){const u=this.metricsTensors[c][0],d=this.metricsTensors[c][1],h=Rt(u(o[d],l[d]));n.push(h)}return n})}async fit(e,n,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,l,c,u,d,h;try{const f=s.batchSize==null?32:s.batchSize;Tg(f);const g=await this.standardizeUserData(e,n,s.sampleWeight,s.classWeight,!1,f);r=g[0],o=g[1],h=g[2];let x=!1,m;if(s.validationData!=null&&s.validationData.length>0){if(x=!0,s.validationData.length===2)l=s.validationData[0],c=s.validationData[1];else throw s.validationData.length===3?new $e("validationData including sample weights is not supported yet."):new E(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const N=await this.standardizeUserData(l,c,null,null,!0,f);u=N[0],d=N[1],m=u.concat(d)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){x=!0;const $=Math.floor(r[0].shape[0]*(1-s.validationSplit)),N=r[0].shape[0];u=Xl(r,$,N),i=r,r=Xl(r,0,$),d=Xl(o,$,N),a=o,o=Xl(o,0,$),m=u.concat(d)}else s.validationSteps!=null&&(x=!0);const y=r.concat(o).concat(h);this.checkTrainableWeightsConsistency();const w=this.makeTrainFunction(),v=this.getDedupedMetricsNames();let b,C;x?(this.makeTestFunction(),b=this.testFunction,C=v.slice().concat(v.map($=>"val_"+$))):(b=null,m=[],C=v.slice());const k=VT(s.callbacks,s.yieldEvery);return await this.fitLoop(w,y,v,f,s.epochs,s.verbose,k,b,m,s.shuffle,C,s.initialEpoch,null,null)}finally{this.isTraining=!1,zs(r,e),zs(o,n),zs(i,e),zs(a,n),zs(u,l),zs(d,c),h!=null&&Ne(h)}}async fitLoop(e,n,s,r,o,i,a,l,c,u,d,h,f,p){r==null&&(r=32),o==null&&(o=1),u==null&&(u=!0),h==null&&(h=0);let g=!1;if(l!=null&&c!=null&&(g=!0),p!=null&&(g=!0,f==null))throw new E("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const x=this.checkNumSamples(n,r,f,"steps_per_epoch");let m;x!=null&&(m=Js(0,x)),i==null&&(i=1);const{callbackList:y,history:w}=WT(a,i,o,h,x,f,r,g,d);y.setModel(this),this.history=w,await y.onTrainBegin(),this.stopTraining_=!1;for(let v=h;v<o;++v){await y.onEpochBegin(v);const b={};if(f!=null)throw new $e("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new $e("batch shuffling is not implemneted yet");u&&$M(m);const C=Gn(m),k=Eg(x,r);for(let S=0;S<k.length;++S){const $={};if(await y.onBatchBegin(S,$),P(()=>{const N=k[S][0],A=k[S][1],M=ki(C,N,A-N);$.batch=S,$.size=A-N;const L=C1(n,M),V=e(L);for(let B=0;B<s.length;++B){const U=s[B],K=V[B];$[U]=K,xr(K)}if(S===k.length-1&&g){const B=this.testLoop(l,c,r);for(let U=0;U<s.length;++U){const K=s[U],R=B[U];xr(R),b["val_"+K]=R}}}),await y.onBatchEnd(S,$),BT($),this.stopTraining_)break}C.dispose()}if(await y.onEpochEnd(v,b),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,n){return Q5(this,e,n)}async trainOnBatch(e,n){const s=await this.standardizeUserData(e,n),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),l=[];for(const c of a){const u=await c.data();l.push(u[0])}return Ne(a),zs(s[0],e),zs(s[1],n),Rn(l)}getNamedWeights(e){const n=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||n.push({name:r[i].originalName,tensor:o[i]});return n}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const n=SC().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=n-SC().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Dr(this.loss);else if(Array.isArray(this.loss)){for(const n of this.loss)if(typeof n!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(n=>Dr(n))}else{const n=Object.keys(this.loss);e={};const s=this.loss;for(const r of n)if(typeof s[r]=="string")e[r]=Dr(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Dr(sh(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Dr(sh(e)));{const e={};for(const n in this.metrics)e[n]=Dr(sh(this.metrics[n]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const n=Df(e.optimizer_config),s=br(n);let r;if(typeof e.loss=="string")r=ii(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>ii(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=ii(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>ii(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=ii(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,n){if(typeof e=="string"){const c=AP(e);if(c.length===0)throw new E(`Cannot find any save handlers for URL '${e}'`);if(c.length>1)throw new E(`Found more than one (${c.length}) save handlers for URL '${e}'`);e=c[0]}if(e.save==null)throw new E("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await IC(this.getNamedWeights(n)),a={modelTopology:this.toJSON(null,!1),format:oH,generatedBy:`TensorFlow.js tfjs-layers v${qT}`,convertedBy:null};if((n==null?!1:n.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const c="optimizer",{data:u,specs:d}=await IC(await this.optimizer.getWeights(),c);s.specs.push(...d),s.data=kP([s.data,u])}return this.userDefinedMetadata!=null&&(tk(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){tk(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}Ba.className="Model";Y(Ba);class eE extends Ba{}eE.className="Functional";Y(eE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function iH(t,e){if(e==null&&(e={}),typeof t=="string"){const n=DP(t,e);if(n.length===0)n.push(fU(t,e));else if(n.length>1)throw new E(`Found more than one (${n.length}) load handlers for URL '${t}'`);t=n[0]}return aH(t,void 0,e)}async function aH(t,e,n){if(n==null&&(n={}),t.load==null)throw new E("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await t.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const o=n.strict==null?!0:n.strict,i=s.weightData!=null&&s.weightSpecs!=null&&o,a=br(Df(r),e,i),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new E("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:c,optimizerWeights:u}=lH(s.weightData,s.weightSpecs);a.loadWeights(c,o),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),Ne(c),Ne(u.map(d=>d.tensor))}return a}function lH(t,e){const n=xP(t,e),s={},r=[];return e.forEach(o=>{o.group==="optimizer"?r.push({name:o.name,tensor:n[o.name]}):s[o.name]=n[o.name]}),{modelWeights:s,optimizerWeights:r}}class Jc extends Ba{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Sm("sequential_"),e.layers!=null)for(const n of e.layers)this.add(n)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new E(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const n=e instanceof Jc||e instanceof Ba;let s;if(n){if(s=e,s.outputs.length!==1)throw new E("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new E("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new E("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=a5({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(n)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new E(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new E("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=OT(this.outputs[0])}this.inboundNodes=[],new $m({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Bi(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,n){return this.model==null&&this.build(),this.model.call(e,n)}build(e){if(Pe(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Ba({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,n,s=console.log){this.built||this.build(),super.summary(e,n,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,n,s={}){if(!this.built)throw new Cs("The model needs to be compiled before being used.");return this.model.evaluate(e,n,s)}async evaluateDataset(e,n){if(!this.built)throw new Cs("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,n)}predict(e,n={}){return this.model==null&&this.build(),this.model.predict(e,n)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,n,s={}){if(!this.built)throw new Cs("The model needs to be compiled before being used.");return this.model.fit(e,n,s)}async fitDataset(e,n){if(!this.built)throw new Cs("The model needs to be compiled before being used.");return this.model.fitDataset(e,n)}async trainOnBatch(e,n){return this.model.trainOnBatch(e,n)}static fromConfig(e,n,s={},r=!1){let o,i={};if(n instanceof Array){if(n[0].className==null||n[0].className==="Merge")throw new E("Legacy serialization format not supported yet.");o=n}else I(n.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=n.layers,delete n.layers,i=n;const a=new e(i);if(!(a instanceof Jc))throw new $e(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of o){const u=br(l,void 0,r);r&&u.setFastWeightInitDuringBuild(!0),a.add(u)}return a}set stopTraining(e){if(this.model==null)throw new E("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new E("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const n of this.layers){const s={};s.className=n.getClassName(),s.config=n.getConfig(),e.push(s)}return{name:this.name,layers:e}}}Jc.className="Sequential";Y(Jc);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let fn=class extends Nl{getConfig(){return{}}};class tE extends fn{apply(e,n=1){return H6(e,n)}}tE.className="elu";Y(tE);class nE extends fn{apply(e){return xN(e)}}nE.className="selu";Y(nE);class sE extends fn{apply(e){return Qi(e)}}sE.className="relu";Y(sE);class rE extends fn{apply(e){return P(()=>Xc(6,Qi(e)))}}rE.className="relu6";Y(rE);class oE extends fn{apply(e){return e}}oE.className="linear";Y(oE);class iE extends fn{apply(e){return Sl(e)}}iE.className="sigmoid";Y(iE);class aE extends fn{apply(e){return K6(e)}}aE.className="hardSigmoid";Y(aE);class lE extends fn{apply(e){return hd(e)}}lE.className="softplus";Y(lE);class cE extends fn{apply(e){return j6(e)}}cE.className="softsign";Y(cE);class uE extends fn{apply(e){return pm(e)}}uE.className="tanh";Y(uE);let sv=class extends fn{apply(e,n=-1){return ow(e,n)}};sv.className="softmax";Y(sv);class dE extends fn{apply(e,n=-1){return lN(e,n)}}dE.className="logSoftmax";Y(dE);class hE extends fn{apply(e){return P(()=>P(()=>{const n=Math.sqrt(2),s=D(.5,Z(1,sN(ge(e,n))));return D(e,s)}))}}hE.className="gelu";Y(hE);class fE extends fn{apply(e){return P(()=>D(.5,D(e,Z(1,pm(D(dn(ge(2,Math.PI)),Z(e,D(.044715,Mi(e,3)))))))))}}fE.className="gelu_new";Y(fE);class pE extends fn{apply(e){return P(()=>D(e,pm(hd(e))))}}pE.className="mish";Y(pE);class mE extends fn{apply(e,n=1){return P(()=>D(Sl(D(e,n)),e))}}mE.className="swish";Y(mE);function Fo(t){return t.getClassName()}function Rg(t,e={}){return wd(t,xs.getMap().classNameMap,e,"activation")}function Oo(t){if(t==null){const e={};return e.className="linear",e.config={},Rg(e)}if(typeof t=="string"){const e={};return e.className=t,e.config={},Rg(e)}else return t instanceof fn?t:Rg(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function cH(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}class gE extends Nl{}class xE extends gE{constructor(e){super(),cH(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return P(()=>{let n=Kt([1]);return this.hasL1&&(n=Z(n,me(D(this.l1,xn(e))))),this.hasL2&&(n=Z(n,me(D(this.l2,bd(e))))),F(n,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,n){return new e({l1:n.l1,l2:n.l2})}}xE.className="L1L2";Y(xE);const ak={l1l2:"L1L2"};function Ze(t){return Uw(t)}function lk(t,e={}){return wd(t,xs.getMap().classNameMap,e,"regularizer")}function mt(t){if(t==null)return null;if(typeof t=="string"){const n={className:t in ak?ak[t]:t,config:{}};return lk(n)}else return t instanceof gE?t:lk(t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class yE extends De{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,n){e=Ce(e);let s=Qi(e);return this.maxValue!=null&&(s=as(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},n=super.getConfig();return Object.assign(e,n),e}}yE.className="ReLU";Y(yE);class wE extends De{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ce(e);return Uy(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}}wE.className="LeakyReLU";Y(wE);class vE extends De{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=pt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=mt(e.alphaRegularizer),this.alphaConstraint=Bt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new E(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Pe(e);const n=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)n[r-1]=1;this.alpha=this.addWeight("alpha",n,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new Pt({ndim:e.length,axes:s})],this.built=!0}call(e,n){return e=Ce(e),qy(e,this.alpha.read())}getConfig(){const e={alphaInitializer:xt(this.alphaInitializer),alphaRegularizer:Ze(this.alphaRegularizer),alphaConstraint:Lt(this.alphaConstraint),sharedAxes:this.sharedAxes},n=super.getConfig();return Object.assign(e,n),e}}vE.className="PReLU";Y(vE);let bE=class extends De{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new $e(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,n){const s=Ce(e);return xm(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},n=super.getConfig();return Object.assign(e,n),e}};bE.className="ELU";Y(bE);class CE extends De{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,n){const s=Ce(e);return D(s,le(us(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},n=super.getConfig();return Object.assign(e,n),e}}CE.className="ThresholdedReLU";Y(CE);class kE extends De{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new sv().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,n){return P(()=>{let s=Ce(e);const r=n.mask;if(r!=null){const o=D(ve(Ko(s.shape),le(r,s.dtype)),We(-1e9));s=Z(s,o)}return this.axis instanceof Array?this.axis.length>1?kr(ve(s,cN(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}kE.className="Softmax";Y(kE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Va(t,e,n){if(typeof t=="number")return Bi(t,e);if(t.length!==e)throw new E(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const r=t[s];if(!V6(r))throw new E(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${r}`)}return t}function Ys(t,e,n,s,r=1){if(t==null)return t;const o=e+(e-1)*(r-1);let i;return n==="same"?i=t:i=t-o+1,Math.floor((i+s-1)/s)}function dr(t,e,n,s){if(t==null)return null;if(s==="valid")t=t*e+_o([n-e,0]);else if(s==="same")t=t*e;else throw new E(`Unsupport padding mode: ${s}.`);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function rv(t,e){return P(()=>(Nt(e),e==="channelsFirst"?Fe(t,[0,2,3,1]):t))}function SE(t,e){return P(()=>(Nt(e),e==="channelsFirst"?Fe(t,[0,2,3,4,1]):t))}function uH(t,e,n,s=1,r="valid",o,i=1){return P(()=>{if(o==null&&(o=Zs()),Nt(o),t.shape.length!==3)throw new E(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new E(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(n!=null&&n.shape.length!==1)throw new E(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(o==="channelsFirst"&&(t=Fe(t,[0,2,1])),r==="causal")throw new $e("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=J2(t,e,s,r==="same"?"same":"valid","NWC",i);return n!=null&&(a=nr(a,n)),a})}function ck(t,e,n,s=[1,1],r="valid",o,i,a=null){return P(()=>{if(o==null&&(o=Zs()),Nt(o),t.rank!==3&&t.rank!==4)throw new E(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new E(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=rv(t,o);if(r==="causal")throw new $e("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=uW({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:n,activation:a}),o==="channelsFirst"&&(l=Fe(l,[0,3,1,2])),l})}function dH(t,e,n,s=[1,1,1],r="valid",o,i){return P(()=>{if(o==null&&(o=Zs()),Nt(o),t.rank!==4&&t.rank!==5)throw new E(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new E(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=SE(t,o);if(r==="causal")throw new $e("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=l4(a,e,s,r==="same"?"same":"valid","NDHWC",i),n!=null&&(a=nr(a,n)),o==="channelsFirst"&&(a=Fe(a,[0,4,1,2,3])),a})}class Em extends De{constructor(e,n){if(super(n),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Em.verifyArgs(n),this.rank=e,qt(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new $e(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Va(n.kernelSize,e,"kernelSize"),this.strides=Va(n.strides==null?1:n.strides,e,"strides"),this.padding=n.padding==null?"valid":n.padding,ds(this.padding),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Nt(this.dataFormat),this.activation=Oo(n.activation),this.useBias=n.useBias==null?!0:n.useBias,this.biasInitializer=pt(n.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Bt(n.biasConstraint),this.biasRegularizer=mt(n.biasRegularizer),this.activityRegularizer=mt(n.activityRegularizer),this.dilationRate=Va(n.dilationRate==null?1:n.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new E(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new E(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new E(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(ur("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Gw(e.kernelSize,"number",1,3))throw new E(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Fo(this.activation),useBias:this.useBias,biasInitializer:xt(this.biasInitializer),biasRegularizer:Ze(this.biasRegularizer),activityRegularizer:Ze(this.activityRegularizer),biasConstraint:Lt(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}class Tl extends Em{constructor(e,n){super(e,n),this.kernel=null,Tl.verifyArgs(n),this.filters=n.filters,qt(this.filters,"filters"),this.kernelInitializer=pt(n.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Bt(n.kernelConstraint),this.kernelRegularizer=mt(n.kernelRegularizer)}build(e){e=Pe(e);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new E(`The channel dimension of the input should be defined. Found ${e[n]}`);const s=e[n],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[n]:s}}],this.built=!0}call(e,n){return P(()=>{e=Ce(e);let s;const r=this.bias==null?null:this.bias.read(),o=vT(this.activation.getClassName());if(o!=null&&this.rank===2)s=ck(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=uH(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=ck(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=dH(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new $e("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=Pe(e);const n=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=Ys(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);n.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(n),r.push(this.filters)):(r.push(this.filters),r=r.concat(n)),r}getConfig(){const e={filters:this.filters,kernelInitializer:xt(this.kernelInitializer),kernelRegularizer:Ze(this.kernelRegularizer),kernelConstraint:Lt(this.kernelConstraint)},n=super.getConfig();return Object.assign(e,n),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new E(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Id extends Tl{constructor(e){super(2,e),Id.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Gw(e.kernelSize,"number",1,2))throw new E(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Id.className="Conv2D";Y(Id);class $d extends Tl{constructor(e){super(3,e),$d.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new E(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}$d.className="Conv3D";Y($d);class IE extends Id{constructor(e){if(super(e),this.inputSpec=[new Pt({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new E(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Pe(e),e.length!==4)throw new E("Input should have rank 4; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new E("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Pt({ndim:4,axes:{[n]:s}})],this.built=!0}call(e,n){return P(()=>{let s=Ce(e);if(s.shape.length!==4)throw new E(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=r[i],c=r[a],u=this.kernelSize[0],d=this.kernelSize[1],h=this.strides[0],f=this.strides[1],p=dr(l,h,u,this.padding),g=dr(c,f,d,this.padding),x=[o,p,g,this.filters];this.dataFormat!=="channelsLast"&&(s=Fe(s,[0,2,3,1]));let m=Z2(s,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(m=Fe(m,[0,3,1,2])),this.bias!=null&&(m=nr(m,this.bias.read(),this.dataFormat)),this.activation!=null&&(m=this.activation.apply(m)),m})}computeOutputShape(e){e=Pe(e);const n=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],c=this.strides[1];return n[s]=this.filters,n[r]=dr(n[r],l,i,this.padding),n[o]=dr(n[o],c,a,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}IE.className="Conv2DTranspose";Y(IE);class $E extends $d{constructor(e){if(super(e),this.inputSpec=[new Pt({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new E(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Pe(e),e.length!==5)throw new E("Input should have rank 5; Received input shape: "+JSON.stringify(e));const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new E("The channel dimension of the inputs should be defined. Found `None`.");const s=e[n],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Pt({ndim:5,axes:{[n]:s}})],this.built=!0}call(e,n){return P(()=>{let s=Ce(e);if(s.shape.length!==5)throw new E(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const c=r[l],u=r[i],d=r[a],h=this.kernelSize[0],f=this.kernelSize[1],p=this.kernelSize[2],g=this.strides[0],x=this.strides[1],m=this.strides[2],y=dr(c,g,h,this.padding),w=dr(u,x,f,this.padding),v=dr(d,m,p,this.padding),b=[o,y,w,v,this.filters];this.dataFormat!=="channelsLast"&&(s=Fe(s,[0,2,3,4,1]));let C=d4(s,this.kernel.read(),b,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(C=Fe(C,[0,4,1,2,3])),this.bias!==null&&(C=nr(C,this.bias.read(),this.dataFormat)),this.activation!==null&&(C=this.activation.apply(C)),C})}computeOutputShape(e){e=Pe(e);const n=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],c=this.kernelSize[2],u=this.strides[0],d=this.strides[1],h=this.strides[2];return n[s]=this.filters,n[r]=dr(n[r],u,a,this.padding),n[o]=dr(n[o],d,l,this.padding),n[i]=dr(n[i],h,c,this.padding),n}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}$E.className="Conv3DTranspose";Y($E);class NE extends Tl{constructor(e,n){if(super(e,n),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,n.filters==null)throw new E("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(n.kernelInitializer!=null||n.kernelRegularizer!=null||n.kernelConstraint!=null)throw new E("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(n.padding!=null&&n.padding!=="same"&&n.padding!=="valid")throw new E(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(n.padding)}`);this.depthMultiplier=n.depthMultiplier==null?1:n.depthMultiplier,this.depthwiseInitializer=pt(n.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=mt(n.depthwiseRegularizer),this.depthwiseConstraint=Bt(n.depthwiseConstraint),this.pointwiseInitializer=pt(n.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=mt(n.pointwiseRegularizer),this.pointwiseConstraint=Bt(n.pointwiseConstraint)}build(e){if(e=Pe(e),e.length<this.rank+2)throw new E(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null||e[n]<0)throw new E(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[n])}`);const s=e[n],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Pt({ndim:this.rank+2,axes:{[n]:s}})],this.built=!0}call(e,n){return P(()=>{e=Ce(e);let s;if(this.rank===1)throw new $e("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Fe(e,[0,2,3,1])),s=yN(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=nr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=Fe(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=xt(this.depthwiseInitializer),e.pointwiseInitializer=xt(this.pointwiseInitializer),e.depthwiseRegularizer=Ze(this.depthwiseRegularizer),e.pointwiseRegularizer=Ze(this.pointwiseRegularizer),e.depthwiseConstraint=Lt(this.depthwiseConstraint),e.pointwiseConstraint=Lt(this.pointwiseConstraint),e}}NE.className="SeparableConv";class TE extends NE{constructor(e){super(2,e)}}TE.className="SeparableConv2D";Y(TE);class Rm extends Tl{constructor(e){super(1,e),Rm.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Gw(e.kernelSize,"number",1,1))throw new E(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Rm.className="Conv1D";Y(Rm);class EE extends De{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,n){return P(()=>{if(e=Ce(e),this.dataFormat==="channelsLast"){const s=nh(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return nh(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=nh(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return nh(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}EE.className="Cropping2D";Y(EE);class RE extends De{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Nt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,P6(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const n=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],n,s]}else{const n=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],n,s,e[3]]}}call(e,n){return P(()=>{let s=Ce(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=Fe(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?zr.resizeNearestNeighbor(s,[o,i]):zr.resizeBilinear(s,[o,i]);return Fe(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?zr.resizeNearestNeighbor(s,[o,i]):zr.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}}RE.className="UpSampling2D";Y(RE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function hH(t,e,n=[1,1],s="valid",r,o){return P(()=>{r==null&&(r=Zs()),Nt(r);let i=rv(t,r);if(t.rank!==4)throw new E(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new E(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=Ly(i,e,n,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=Fe(i,[0,3,1,2])),i})}class AE extends Em{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=pt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Bt(e.depthwiseConstraint),this.depthwiseRegularizer=mt(e.depthwiseRegularizer)}build(e){if(e=Pe(e),e.length<4)throw new E(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const n=this.dataFormat==="channelsFirst"?1:3;if(e[n]==null||e[n]<0)throw new E(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[n]}).`);const s=e[n],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return P(()=>{e=Ce(e);let s=hH(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=nr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=Pe(e);const n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=Ys(n,this.kernelSize[0],this.padding,this.strides[0]),i=Ys(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=xt(this.depthwiseInitializer),e.depthwiseRegularizer=Ze(this.depthwiseRegularizer),e.depthwiseConstraint=Lt(this.depthwiseRegularizer),e}}AE.className="DepthwiseConv2D";Y(AE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function DE(t,e,n,s){if(Array.isArray(t)){if(e!=null||n!=null)throw new E("When inputs is an array, neither initialState or constants should be provided");s!=null&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),n=r(n),{inputs:t,initialState:e,constants:n}}function _E(t,e,n,s=!1,r,o,i=!1,a=!1){return P(()=>{const l=e.shape.length;if(l<3)throw new E(`Input should be at least 3D, but is ${l}D.`);const c=[1,0].concat(Js(2,l));e=Fe(e,c),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=le(le(r,"bool"),"float32"),r.rank===l-1&&(r=En(r,-1)),r=Fe(r,c)),s&&(e=Pi(e,0),r!=null&&(r=Pi(r,0)));const u=[];let d,h=n;const f=e.shape[0],p=Li(e);let g;r!=null&&(g=Li(r));for(let m=0;m<f;++m){const y=p[m],w=P(()=>t(y,h));if(r==null)d=w[0],h=w[1];else{const v=P(()=>{const b=g[m],C=ve(Es(b),b),k=Z(D(w[0],b),D(h[0],C)),S=h.map(($,N)=>Z(D(w[1][N],b),D($,C)));return{output:k,newStates:S}});d=v.output,h=v.newStates}a&&u.push(d)}let x;return a&&(x=Gr(u,1)),[d,x,h]})}class qo extends De{constructor(e){super(e);let n;if(e.cell==null)throw new E("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?n=new av({cells:e.cell}):n=e.cell,n.stateSize==null)throw new E("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=n,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Pt({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Js(0,e).map(n=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){y1(e)&&(e=e[0]),e=e;let n=this.cell.stateSize;Array.isArray(n)||(n=[n]);const s=n[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of n)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,n){return P(()=>{Array.isArray(n)&&(n=n[0]);const s=this.returnSequences?n:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,n=[];for(let s=0;s<e;++s)n.push(null);return n}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new $e("Constants support is not implemented in RNN yet.");y1(e)&&(e=e[0]),e=e;const n=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new Pt({shape:[n,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!Ue(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new E(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new Pt({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,n=!1){P(()=>{if(!this.stateful)throw new cr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new E("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Kt([s,r])):this.states_=[Kt([s,this.cell.stateSize])];else if(e==null)Ne(this.states_),this.keptStates!=null&&(Ne(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>Kt([s,r])):this.states_[0]=Kt([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new E(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n===!0?this.keptStates.push(this.states_.slice()):Ne(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!Ue(o.shape,a))throw new E(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>xr(r.clone()))})}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const o=DE(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){n.initialState=s,i=i.concat(s),this.stateSpec=[];for(const c of s)this.stateSpec.push(new Pt({shape:c.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(n.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof Ir){const c=[e].concat(i),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return P(()=>{const s=n==null?null:n.mask,r=n==null?null:n.training;let o=n==null?null:n.initialState;e=Ce(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new E(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},c=_E((p,g)=>{const x=this.cell.call([p].concat(g),a);return[x[0],x.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),u=c[0],d=c[1],h=c[2];this.stateful&&this.resetStates(h,r);const f=this.returnSequences?d:u;return this.returnState?[f].concat(h):f})}getInitialState(e){return P(()=>{let n=Kt(e.shape);return n=me(n,[1,2]),n=vd(n),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?g1(n,[1,s]):n):this.cell.stateSize>1?[g1(n,[1,this.cell.stateSize])]:[n]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),n={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(n.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===qo.className&&(n.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),n)}static fromConfig(e,n,s={}){const r=n.cell,o=br(r,s);return new e(Object.assign(n,{cell:o}))}}qo.className="RNN";Y(qo);class Am extends De{}class ov extends Am{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,qt(this.units,"units"),this.activation=Oo(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=pt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=pt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=pt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=mt(e.kernelRegularizer),this.recurrentRegularizer=mt(e.recurrentRegularizer),this.biasRegularizer=mt(e.biasRegularizer),this.kernelConstraint=Bt(e.kernelConstraint),this.recurrentConstraint=Bt(e.recurrentConstraint),this.biasConstraint=Bt(e.biasConstraint),this.dropout=ul([1,_o([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ul([1,_o([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Pe(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return P(()=>{if(e=e,e.length!==2)throw new E(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=n.training==null?!1:n.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=zo({ones:()=>Es(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=zo({ones:()=>Es(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=vr(D(e,i),this.kernel.read()):o=vr(e,this.kernel.read()),this.bias!=null&&(o=nr(o,this.bias.read())),a!=null&&(s=D(s,a));let l=Z(o,vr(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Fo(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),recurrentInitializer:xt(this.recurrentInitializer),biasInitializer:xt(this.biasInitializer),kernelRegularizer:Ze(this.kernelRegularizer),recurrentRegularizer:Ze(this.recurrentRegularizer),biasRegularizer:Ze(this.biasRegularizer),activityRegularizer:Ze(this.activityRegularizer),kernelConstraint:Lt(this.kernelConstraint),recurrentConstraint:Lt(this.recurrentConstraint),biasConstraint:Lt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),n)}}ov.className="SimpleRNNCell";Y(ov);class FE extends qo{constructor(e){e.cell=new ov(e),super(e)}call(e,n){return P(()=>{this.cell.dropoutMask!=null&&(Ne(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ne(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,n){return new e(n)}}FE.className="SimpleRNN";Y(FE);class iv extends Am{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new E("GRUCell does not support reset_after parameter set to true.");this.units=e.units,qt(this.units,"units"),this.activation=Oo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Oo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=pt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=pt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=pt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=mt(e.kernelRegularizer),this.recurrentRegularizer=mt(e.recurrentRegularizer),this.biasRegularizer=mt(e.biasRegularizer),this.kernelConstraint=Bt(e.kernelConstraint),this.recurrentConstraint=Bt(e.recurrentConstraint),this.biasConstraint=Bt(e.biasConstraint),this.dropout=ul([1,_o([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ul([1,_o([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Pe(e);const n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,n){return P(()=>{if(e=e,e.length!==2)throw new E(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training==null?!1:n.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=zo({ones:()=>Es(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=zo({ones:()=>Es(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,c;0<this.dropout&&this.dropout<1&&(e=D(e,o[0]));let u=vr(e,this.kernel.read());this.useBias&&(u=nr(u,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=D(r,i[0]));const d=this.recurrentKernel.read(),[h,f]=rs(d,[2*this.units,this.units],d.rank-1),p=vr(r,h),[g,x,m]=rs(u,3,u.rank-1),[y,w]=rs(p,2,p.rank-1);a=this.recurrentActivation.apply(Z(g,y)),l=this.recurrentActivation.apply(Z(x,w));const v=vr(D(l,r),f);c=this.activation.apply(Z(m,v));const b=Z(D(a,r),D(Z(1,St(a)),c));return[b,b]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Fo(this.activation),recurrentActivation:Fo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),recurrentInitializer:xt(this.recurrentInitializer),biasInitializer:xt(this.biasInitializer),kernelRegularizer:Ze(this.kernelRegularizer),recurrentRegularizer:Ze(this.recurrentRegularizer),biasRegularizer:Ze(this.biasRegularizer),activityRegularizer:Ze(this.activityRegularizer),kernelConstraint:Lt(this.kernelConstraint),recurrentConstraint:Lt(this.recurrentConstraint),biasConstraint:Lt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),n)}}iv.className="GRUCell";Y(iv);class OE extends qo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new iv(e),super(e)}call(e,n){return P(()=>{this.cell.dropoutMask!=null&&(Ne(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ne(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}OE.className="GRU";Y(OE);class Dm extends Am{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,qt(this.units,"units"),this.activation=Oo(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Oo(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=pt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=pt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=pt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=mt(e.kernelRegularizer),this.recurrentRegularizer=mt(e.recurrentRegularizer),this.biasRegularizer=mt(e.biasRegularizer),this.kernelConstraint=Bt(e.kernelConstraint),this.recurrentConstraint=Bt(e.recurrentConstraint),this.biasConstraint=Bt(e.biasConstraint),this.dropout=ul([1,_o([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=ul([1,_o([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var n;e=Pe(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(n=class extends As{apply(l,c){const u=o.apply([i]),d=new jw().apply([i]),h=o.apply([i*2]);return jC(jC(u,d),h)}},n.className="CustomInit",n)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,n){return P(()=>{const s=n.training==null?!1:n.training;if(e=e,e.length!==3)throw new E(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=zo({ones:()=>Es(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=zo({ones:()=>Es(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,c,u,d;0<this.dropout&&this.dropout<1&&(e=D(e,i[0]));let h=vr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=D(r,a[0])),h=Z(h,vr(r,this.recurrentKernel.read())),this.useBias&&(h=nr(h,this.bias.read()));const[f,p,g,x]=rs(h,4,h.rank-1);l=this.recurrentActivation.apply(f),c=this.recurrentActivation.apply(p),u=Z(D(c,o),D(l,this.activation.apply(g))),d=this.recurrentActivation.apply(x);const m=D(d,this.activation.apply(u));return[m,m,u]})}getConfig(){const e=super.getConfig(),n={units:this.units,activation:Fo(this.activation),recurrentActivation:Fo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),recurrentInitializer:xt(this.recurrentInitializer),biasInitializer:xt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Ze(this.kernelRegularizer),recurrentRegularizer:Ze(this.recurrentRegularizer),biasRegularizer:Ze(this.biasRegularizer),activityRegularizer:Ze(this.activityRegularizer),kernelConstraint:Lt(this.kernelConstraint),recurrentConstraint:Lt(this.recurrentConstraint),biasConstraint:Lt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),n)}}Dm.className="LSTMCell";Y(Dm);class zE extends qo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Dm(e),super(e)}call(e,n){return P(()=>{this.cell.dropoutMask!=null&&(Ne(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ne(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,n){return n.implmentation===0&&(n.implementation=1),new e(n)}}zE.className="LSTM";Y(zE);class av extends Am{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const n of this.cells.slice().reverse())Array.isArray(n.stateSize)?e.push(...n.stateSize):e.push(n.stateSize);return e}call(e,n){return P(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=l.call(i,n),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){y1(e)&&(e=e[0]),e=e;let n;this.cells.forEach((s,r)=>{Ci(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?n=s.stateSize[0]:n=s.stateSize,e=[e[0],n]})}),this.built=!0}getConfig(){const e=super.getConfig(),n=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(n)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,n,s={}){const r=[];for(const o of n.cells)r.push(br(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const n of this.cells)e.push(...n.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const n of this.cells)e.push(...n.nonTrainableWeights);if(!this.trainable){const n=[];for(const s of this.cells)n.push(...s.trainableWeights);return n.concat(e)}return e}getWeights(){const e=[];for(const n of this.cells)e.push(...n.weights);return w1(e)}setWeights(e){const n=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)n.push([s.weights[i],o[i]])}Zw(n)}}av.className="StackedRNNCells";Y(av);function zo(t){const{ones:e,rate:n,training:s=!1,count:r=1,dropoutFunc:o}=t,i=()=>o!=null?o(e(),n):NT(e(),n),a=()=>Cd(i,e,s);return!r||r<=1?xr(a().clone()):Array(r).fill(void 0).map(a).map(c=>xr(c.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var fH=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(t);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(t,s[r])&&(n[s[r]]=t[s[r]]);return n};class ME extends qo{constructor(e){if(e.unroll)throw new $e("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new $e("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Pt({ndim:5})]}call(e,n){return P(()=>{if(this.cell.dropoutMask!=null&&(Ne(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ne(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),n&&n.constants)throw new E("ConvRNN2D cell does not support constants");const s=n==null?null:n.mask,r=n==null?null:n.training,o=n==null?null:n.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let n=this.computeSingleOutputShape(e);return this.returnSequences||(n=[n[0],...n.slice(2)]),this.returnState&&(n=[n,...Array(2).fill([e[0],...n.slice(-3)])]),n}getInitialState(e){return P(()=>{const{stateSize:n}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=Kt(o);return Array.isArray(n)?Array(n.length).fill(i):[i]})}resetStates(e,n=!1){P(()=>{if(!this.stateful)throw new cr("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new E("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Kt(o)):this.states_=[Kt(o)];else if(e==null)Ne(this.states_),this.keptStates!=null&&(Ne(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Kt(o)):this.states_[0]=Kt(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new E(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);n?this.keptStates.push(this.states_.slice()):Ne(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],c=o;if(!Ue(l.shape,c))throw new E(`State ${a} is incompatible with layer ${this.name}: expected shape=${c}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>xr(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:n,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,l=n==="channelsFirst",c=e[l?3:2],u=e[l?4:3],d=Ys(c,r[0],o,i[0],a[0]),h=Ys(u,r[1],o,i[1],a[1]);return[...e.slice(0,2),...l?[s,d,h]:[d,h,s]]}}ME.className="ConvRNN2D";class lv extends Dm{constructor(e){const{filters:n,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:n})),this.filters=n,qt(this.filters,"filters"),this.kernelSize=Va(s,2,"kernelSize"),this.kernelSize.forEach(l=>qt(l,"kernelSize")),this.strides=Va(r||1,2,"strides"),this.strides.forEach(l=>qt(l,"strides")),this.padding=o||"valid",ds(this.padding),this.dataFormat=i||"channelsLast",Nt(this.dataFormat),this.dilationRate=Va(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>qt(l,"dilationRate"))}build(e){var n;e=Pe(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new E(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const c=this.biasInitializer,u=this.filters;l=new(n=class extends As{apply(h,f){const p=c.apply([u]),g=Ko([u]),x=c.apply([u*2]);return Hw([p,g,x])}},n.className="CustomInit",n)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,n){return P(()=>{if(e.length!==3)throw new E(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=n.training||!1,r=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=zo({ones:()=>Es(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,c=(G,X,q)=>!X||!X[q]?G:D(X[q],G);let u=c(r,l,0),d=c(r,l,1),h=c(r,l,2),f=c(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=zo({ones:()=>Es(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const p=this.recurrentDropoutMask;let g=c(o,p,0),x=c(o,p,1),m=c(o,p,2),y=c(o,p,3);const w=3,[v,b,C,k]=rs(this.kernel.read(),a,w),[S,$,N,A]=this.useBias?rs(this.bias.read(),a):[null,null,null,null];u=this.inputConv(u,v,S,this.padding),d=this.inputConv(d,b,$,this.padding),h=this.inputConv(h,C,N,this.padding),f=this.inputConv(f,k,A,this.padding);const[M,L,V,B]=rs(this.recurrentKernel.read(),a,w);g=this.recurrentConv(g,M),x=this.recurrentConv(x,L),m=this.recurrentConv(m,V),y=this.recurrentConv(y,B);const U=this.recurrentActivation.apply(Z(u,g)),K=this.recurrentActivation.apply(Z(d,x)),R=Z(D(K,i),D(U,this.activation.apply(Z(h,m)))),z=D(this.recurrentActivation.apply(Z(f,y)),this.activation.apply(R));return[z,z,R]})}getConfig(){const e=super.getConfig(),n=fH(e,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),s)}inputConv(e,n,s,r){const o=zi(e,n,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?nr(o,s,this.dataFormat):o}recurrentConv(e,n){return zi(e,n,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}lv.className="ConvLSTM2DCell";Y(lv);class PE extends ME{constructor(e){const n=new lv(e);super(Object.assign(Object.assign({},e),{cell:n}))}static fromConfig(e,n){return new e(n)}}PE.className="ConvLSTM2D";Y(PE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class cv extends De{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const n=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?n[r]:this.noiseShape[r]);return s}call(e,n){return P(()=>{this.invokeCallHook(e,n);const s=Ce(e);if(0<this.rate&&this.rate<1){const r=n.training==null?!1:n.training,o=this.getNoiseShape(s);return Cd(()=>NT(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},n=super.getConfig();return Object.assign(e,n),e}dispose(){return super.dispose()}}cv.className="Dropout";Y(cv);class LE extends cv{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const n=e.shape;return[n[0],1,n[2]]}}LE.className="SpatialDropout1D";Y(LE);class BE extends De{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let n=null;e.batchSize!=null&&(n=e.batchSize),this.batchInputShape=[n,e.inputDim]}this.units=e.units,qt(this.units,"units"),this.activation=Oo(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=pt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=pt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Bt(e.kernelConstraint),this.biasConstraint=Bt(e.biasConstraint),this.kernelRegularizer=mt(e.kernelRegularizer),this.biasRegularizer=mt(e.biasRegularizer),this.activityRegularizer=mt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Pe(e);const n=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[n,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:n}}],this.built=!0}computeOutputShape(e){e=Pe(e);const n=e.slice();return n[n.length-1]=this.units,n}call(e,n){return P(()=>{this.invokeCallHook(e,n);const s=Ce(e),r=vT(this.activation.getClassName());let o;return r!=null?o=vr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=vr(s,this.kernel.read()),this.bias!=null&&(o=nr(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:Fo(this.activation),useBias:this.useBias,kernelInitializer:xt(this.kernelInitializer),biasInitializer:xt(this.biasInitializer),kernelRegularizer:Ze(this.kernelRegularizer),biasRegularizer:Ze(this.biasRegularizer),activityRegularizer:Ze(this.activityRegularizer),kernelConstraint:Lt(this.kernelConstraint),biasConstraint:Lt(this.biasConstraint)},n=super.getConfig();return Object.assign(e,n),e}}BE.className="Dense";Y(BE);class VE extends De{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Pe(e);for(const n of e.slice(1))if(n==null)throw new E(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Eo(e,1)]}call(e,n){return P(()=>{this.invokeCallHook(e,n);let s=Ce(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=Fe(s,r)}return G6(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const n=super.getConfig();return Object.assign(e,n),e}}VE.className="Flatten";Y(VE);class WE extends De{constructor(e){super(e),this.supportsMasking=!0,this.activation=Oo(e.activation)}call(e,n){return P(()=>{this.invokeCallHook(e,n);const s=Ce(e);return this.activation.apply(s)})}getConfig(){const e={activation:Fo(this.activation)},n=super.getConfig();return Object.assign(e,n),e}}WE.className="Activation";Y(WE);class UE extends De{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,n){return P(()=>(e=Ce(e),W6(e,this.n)))}getConfig(){const e={n:this.n},n=super.getConfig();return Object.assign(e,n),e}}UE.className="RepeatVector";Y(UE);class GE extends De{constructor(e){super(e),this.targetShape=e.targetShape;for(let n=0;n<this.targetShape.length;++n)this.isUnknown(this.targetShape[n])&&(this.targetShape[n]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,n){const s="Total size of new array must be unchanged.",r=n.slice();let o=1,i=null;for(let l=0;l<r.length;++l){const c=r[l];if(this.isUnknown(c))if(i===null)i=l;else throw new E("Can only specifiy one unknown dimension.");else o*=c}const a=Eo(e);if(i!==null){if(o===0||a%o!==0)throw new E(s);r[i]=a/o}else if(a!==o)throw new E(s);return r}computeOutputShape(e){let n=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){n=!0;break}return n?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,n){return P(()=>{this.invokeCallHook(e,n);const s=Ce(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return F(s,o)})}getConfig(){const e={targetShape:this.targetShape},n=super.getConfig();return Object.assign(e,n),e}}GE.className="Reshape";Y(GE);class HE extends De{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const n=Js(1,e.dims.length+1);if(!Ue(e.dims.slice().sort(),n))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Pt({ndim:this.dims.length+1})]}computeOutputShape(e){e=Pe(e);const n=e.slice();return this.dims.forEach((s,r)=>{n[r+1]=e[s]}),n}call(e,n){return Fe(Ce(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},n=super.getConfig();return Object.assign(e,n),e}}HE.className="Permute";Y(HE);class jE extends De{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={maskValue:this.maskValue};return Object.assign(n,e),n}computeMask(e,n){const s=Ce(e);return c1(vf(s,this.maskValue),-1)}call(e,n){return P(()=>{this.invokeCallHook(e,n);const s=Ce(e),i=c1(vf(s,this.maskValue),-1,!0);return D(s,le(i,s.dtype))})}}jE.className="Masking";Y(jE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class KE extends De{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let n=null;e.batchSize!=null&&(n=e.batchSize),e.inputLength==null?this.batchInputShape=[n,null]:this.batchInputShape=[n].concat(Ke(e.inputLength))}this.inputDim=e.inputDim,qt(this.inputDim,"inputDim"),this.outputDim=e.outputDim,qt(this.outputDim,"outputDim"),this.embeddingsInitializer=pt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=mt(e.embeddingsRegularizer),this.activityRegularizer=mt(e.activityRegularizer),this.embeddingsConstraint=Bt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,n){return P(()=>this.maskZero?(e=Ce(e),vf(e,Oe(e))):null)}computeOutputShape(e){if(e=Pe(e),this.inputLength==null)return[...e,this.outputDim];const n=Ke(this.inputLength);if(n.length!==e.length-1)throw new E(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<n.length;++r){const o=n[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new E(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(n[s]=i),s++}}return[e[0],...n,this.outputDim]}call(e,n){return P(()=>{this.invokeCallHook(e,n);let s=Ce(e);s.dtype!=="int32"&&(s=wr(s,"int32"));const r=$T(this.embeddings.read(),F(s,[s.size]));return F(r,Pe(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:xt(this.embeddingsInitializer),embeddingsRegularizer:Ze(this.embeddingsRegularizer),activityRegularizer:Ze(this.activityRegularizer),embeddingsConstraint:Lt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},n=super.getConfig();return Object.assign(e,n),e}}KE.className="Embedding";Y(KE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ea extends De{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new $e}computeElementwiseOpOutputShape(e,n){if(e==null||n==null)return null;if(e.length<n.length)return this.computeElementwiseOpOutputShape(n,e);if(n.length===0)return e;const s=e.slice(0,e.length-n.length);for(let r=0;r<n.length;++r){const o=e[e.length-n.length+r],i=n[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new E("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(n));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Pe(e)]),e=e,e.length<2)throw new E(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let n=[];for(const o of e)o!=null&&o[0]!==null&&n.push(o[0]);if(n=To(n),n.length>1)throw new E(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&To(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,n){return P(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=_o(r);for(let i of e){const a=i.rank;for(let l=0;l<o-a;++l)i=vd(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const l of e){const c=l.rank;if(c==null){const u=l.shape,d=u[0],h=u.slice(1).concat([d]);let f=F(l,[d].concat(Eo(u.slice(1))));f=Fe(f,[1,0]),f=F(f,h),s.push(f),o=!0}else if(c>1){const u=Js(1,c).concat([0]);s.push(Fe(l,u)),o=!0}else s.push(l)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const l=i.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));i=F(Fe(F(i,[-1,u]),[1,0]),d)}else if(a>1){const l=[a-1].concat(Js(0,a-1));i=Fe(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let n;e[0]==null?n=null:n=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);n=this.computeElementwiseOpOutputShape(n,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=To(s),s.length===1?n=s.concat(n):n=[null].concat(n),n}computeMask(e,n){return P(()=>{if(n==null)return null;if(!Array.isArray(n))throw new E("`mask` should be an Array");if(!Array.isArray(e))throw new E("`inputs` should be an Array");if(n.length!==e.length)throw new E(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${n.length})`);if(n.every(r=>r==null))return null;n=n.map(r=>r==null?r:En(r,0));let s=n[0];for(let r=1;r<n.length-1;++r)s=Ur(s,n[r]);return s})}}class XE extends ea{constructor(e){super(e)}mergeFunction(e){return P(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=Z(n,e[s]);return n})}}XE.className="Add";Y(XE);class qE extends ea{constructor(e){super(e)}mergeFunction(e){return P(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=D(n,e[s]);return n})}}qE.className="Multiply";Y(qE);class YE extends ea{constructor(e){super(e)}mergeFunction(e){return P(()=>{let n=e[0].clone();for(let s=1;s<e.length;++s)n=Z(n,e[s]);return D(1/e.length,n)})}}YE.className="Average";Y(YE);class QE extends ea{constructor(e){super(e)}mergeFunction(e){return P(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=jo(n,e[s]);return n})}}QE.className="Maximum";Y(QE);class JE extends ea{constructor(e){super(e)}mergeFunction(e){return P(()=>{let n=e[0];for(let s=1;s<e.length;++s)n=Xc(n,e[s]);return n})}}JE.className="Minimum";Y(JE);class ZE extends ea{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new E("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let n=!0;for(const r of e)if(r!=null){n=!1;break}if(n)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(Ue(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new E("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return P(()=>Hw(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new E("A `Concatenate` layer should be called on a list of inputs.");const n=e,s=n[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of n.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,n){if(n==null)return null;if(!Array.isArray(n))throw new E("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new E("`inputs` should be an array for Concatenate");if(n.length!==e.length)throw new E(`Mismatch in the length of mask (${n.length}) and the legnth of inputs (${e.length})`);return P(()=>{let s=!0;if(n.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)n[i]==null?r.push(le(Es(e[i]),"bool")):n[i].rank<e[i].rank?r.push(En(n[i],-1)):r.push(n[i]);const o=Dn(r,this.axis);return Q2(o,-1,!1)})}getConfig(){const e={axis:this.axis},n=super.getConfig();return Object.assign(e,n),e}}ZE.className="Concatenate";Y(ZE);function ql(t,e){for(;t<0;)t+=e;return t}function pH(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new $e("batchDot is not implemented for tensors of 4D or higher rank yet");if(I(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),I(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof n=="number"&&(n=[n,n]),t.dtype==="complex64"||e.dtype==="complex64")throw new $e("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,r=e.shape.length;n==null&&(n=[s-1,r-2]);const o=n;return P(()=>{let i;if(s>r){i=s-r;const l=[];for(let c=0;c<i;++c)l.push(1);e=F(e,e.shape.concat(l))}else if(r>s){i=r-s;const l=[];for(let c=0;c<i;++c)l.push(1);t=F(t,t.shape.concat(l))}else i=0;let a;if(t.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=me(D(t,e),o[0]):a=me(D(Fe(t,[1,0]),e),o[1]);else{const l=o[0]!==t.shape.length-1,c=o[1]===e.shape.length-1;a=Ve(t,e,l,c)}if(i>0){let l;s>r?l=s+r-3:l=s-1;const c=[];for(let u=l;u<l+i;++u)c.push(u);a=pd(a,c)}return a.shape.length===1&&(a=En(a,1)),a})}class eR extends ea{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){I(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0],s=e[1];if(n.length>3||s.length>3)throw new $e("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);if(n[r[0]]!==s[r[1]])throw new E(`Dimension incompatibility: ${n[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new E(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let n=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>ql(o,e[i].shape.length)):r=[ql(this.axes,n.shape.length),ql(this.axes,s.shape.length)],this.normalize&&(n=Nf(n,r[0]),s=Nf(s,r[1])),pH(n,s,r)}interpretAxes(e,n){let s;return Array.isArray(this.axes)?s=this.axes:s=[ql(this.axes,e.length),ql(this.axes,n.length)],s}computeOutputShape(e){I(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const n=e[0].slice(),s=e[1].slice();if(n.length>3||s.length>3)throw new $e("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(n,s);n.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=n.concat(s);return o.length===1&&o.push(1),o}computeMask(e,n){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},n=super.getConfig();return Object.assign(e,n),e}}eR.className="Dot";Y(eR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class tR extends De{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={stddev:this.stddev};return Object.assign(n,e),n}call(e,n){return P(()=>{this.invokeCallHook(e,n);const s=Ce(e);return Cd(()=>Z(Im(s.shape,0,this.stddev),s),()=>s,n.training||!1)})}}tR.className="GaussianNoise";Y(tR);class nR extends De{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return P(()=>{this.invokeCallHook(e,n);const s=Ce(e);return this.rate>0&&this.rate<1?Cd(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return D(s,Im(s.shape,1,o))},()=>s,n.training||!1):s})}}nR.className="GaussianDropout";Y(nR);class sR extends De{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ce(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),n={rate:this.rate};return Object.assign(n,e),n}call(e,n){return P(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return Cd(()=>{const o=Ce(e),l=-1.6732632423543772*1.0507009873554805;let c=qi(fd(s),this.rate);c=wr(c,"float32");const u=((1-this.rate)*(1+this.rate*l**2))**-.5,d=-u*l*this.rate,h=Z(D(o,c),D(Z(c,-1),l));return Z(D(h,u),d)},()=>Ce(e),n.training||!1)}return e})}}sR.className="AlphaDropout";Y(sR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Zc(t,e,n,s,r,o=.001){let i;if(t.rank===2)i=PL(t,e,n,s,r,o);else if(t.rank===3)i=BL(t,e,n,s,r,o);else if(t.rank===4)i=WL(t,e,n,s,r,o);else throw new $e(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return i}function mH(t,e,n,s,r=.001){return P(()=>{const o=jy(t,s),i=o.mean,a=o.variance;return[Zc(t,i,a,n,e,r),i,a]})}function gH(t,e,n,s,r=.001){return P(()=>{const o=jy(t,s),i=o.mean,a=o.variance,l=[];for(const p of Js(0,t.rank))s.indexOf(p)!==-1?l.push(1):l.push(t.shape[p]);const c=F(i,l),u=F(a,l),d=e==null?null:F(e,l),h=n==null?null:F(n,l);return[Zc(t,c,u,h,d,r),i,a]})}function xH(t,e,n,s,r=.001){return Ue(s.slice().sort(),Js(0,t.rank-1))?mH(t,e,n,s,r):gH(t,e,n,s,r)}class rR extends De{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=pt(e.betaInitializer||"zeros"),this.gammaInitializer=pt(e.gammaInitializer||"ones"),this.movingMeanInitializer=pt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=pt(e.movingVarianceInitializer||"ones"),this.betaConstraint=Bt(e.betaConstraint),this.gammaConstraint=Bt(e.gammaConstraint),this.betaRegularizer=mt(e.betaRegularizer),this.gammaRegularizer=mt(e.gammaRegularizer)}build(e){e=Pe(e);const n=this.axis>=0?this.axis:this.axis+e.length,s=e[n];if(s==null)throw new E(`Axis ${n} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Pt({ndim:e.length,axes:{[n]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,n){return P(()=>{const s=n.training==null?!1:n.training,r=Ce(e),o=r.shape,i=o.length,a=Js(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const c=Bi(1,i);c[l]=o[l];const u=a.slice();u.sort();const d=!Ue(u,Js(0,i).slice(0,i-1)),h=()=>{if(d){const y=F(this.movingMean.read(),c),w=F(this.movingVariance.read(),c),v=this.center?F(this.beta.read(),c):null,b=this.scale?F(this.gamma.read(),c):null;return Zc(r,y,w,v,b,this.epsilon)}else return Zc(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return h();const[f,p,g]=xH(r,this.gamma.read(),this.beta.read(),a,this.epsilon),x=(y,w,v)=>{P(()=>{const b=1-v,C=y.read(),k=D(ve(C,w),b);y.write(ve(C,k))})};return(()=>{x(this.movingMean,p,this.momentum),x(this.movingVariance,g,this.momentum)})(),f})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:xt(this.betaInitializer),gammaInitializer:xt(this.gammaInitializer),movingMeanInitializer:xt(this.movingMeanInitializer),movingVarianceInitializer:xt(this.movingVarianceInitializer),betaRegularizer:Ze(this.betaRegularizer),gammaRegularizer:Ze(this.gammaRegularizer),betaConstraint:Lt(this.betaConstraint),gammaConstraint:Lt(this.gammaConstraint)},n=super.getConfig();return Object.assign(e,n),e}}rR.className="BatchNormalization";Y(rR);class oR extends De{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const n of this.axis)if(!Number.isInteger(n))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=pt(e.betaInitializer||"zeros"),this.gammaInitializer=pt(e.gammaInitializer||"ones"),this.betaRegularizer=mt(e.betaRegularizer),this.gammaRegularizer=mt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Pe(e);const n=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=n);for(const o of this.axis)if(o<0||o>=n)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==To(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,n){const s=Ce(e),r=s.shape,o=r.length;return P(()=>{let{mean:a,variance:l}=jy(s,this.axis,!0);const c=Bi(1,o);for(const g of this.axis)c[g]=r[g];const u=g=>g!=null&&g.shape.length!==o?F(g,c):g;let d=this.scale?u(this.gamma.read()):null,h=this.center?u(this.beta.read()):null;const f=[],p=[];for(let g=0;g<o;++g)this.axis.indexOf(g)!==-1?(f.push(r[g]),p.push(1)):(f.push(1),p.push(r[g]));return a=Gs(a,f),l=Gs(l,f),d!=null&&(d=Gs(d,p)),h!=null&&(h=Gs(h,p)),Zc(s,a,l,h,d,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:xt(this.betaInitializer),gammaInitializer:xt(this.gammaInitializer),betaRegularizer:Ze(this.betaRegularizer),gammaRegularizer:Ze(this.gammaRegularizer)},n=super.getConfig();return Object.assign(e,n),e}}oR.className="LayerNormalization";Y(oR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function yH(t,e,n){return P(()=>{if(t.rank!==4)throw new E(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new E("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(n==null&&(n=Zs()),n!=="channelsLast"&&n!=="channelsFirst")throw new E(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return n==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],Ky(t,s)})}class iR extends De{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Zs():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new E(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let n,s;if(typeof e.padding[0]=="number")n=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new E(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(n=e.padding[0],e.padding[1].length!==2)throw new E(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[n,s]}this.inputSpec=[new Pt({ndim:4})]}computeOutputShape(e){e=Pe(e);let n,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?n=e[2]+this.padding[0][0]+this.padding[0][1]:n=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],n,s]):(e[1]!=null&&e[1]>=0?n=e[1]+this.padding[0][0]+this.padding[0][1]:n=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],n,s,e[3]])}call(e,n){return P(()=>yH(Ce(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}iR.className="ZeroPadding2D";Y(iR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _m(t,e,n,s,r,o){return P(()=>{Nt(r),CT(o),ds(s),n==null&&(n=[1,1]),s==null&&(s="valid"),r==null&&(r=Zs()),o==null&&(o="max"),t=rv(t,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=Hy(t,e,n,a):i=Oy(t,e,n,a),r==="channelsFirst"&&(i=Fe(i,[0,3,1,2])),i})}function aR(t,e,n,s,r,o){return P(()=>{Nt(r),CT(o),ds(s),n==null&&(n=[1,1,1]),s==null&&(s="valid"),r==null&&(r=Zs()),o==null&&(o="max"),t=SE(t,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=$B(t,e,n,a):i=TL(t,e,n,a),r==="channelsFirst"&&(i=Fe(i,[0,4,1,2,3])),i})}class lR extends De{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new E(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(qt(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new E(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);qt(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,ds(this.padding),this.inputSpec=[new Pt({ndim:3})]}computeOutputShape(e){e=Pe(e);const n=Ys(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],n,e[2]]}call(e,n){return P(()=>{this.invokeCallHook(e,n),e=vd(Ce(e),2);const s=this.poolingFunction(Ce(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return pd(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},n=super.getConfig();return Object.assign(e,n),e}}class cR extends lR{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Nt(o),ds(r),_m(e,n,s,r,o,"max")}}cR.className="MaxPooling1D";Y(cR);class uR extends lR{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Nt(o),ds(r),_m(e,n,s,r,o,"avg")}}uR.className="AveragePooling1D";Y(uR);class dR extends De{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new E(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];qt(this.poolSize,"poolSize"),qt(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Nt(this.dataFormat),ds(this.padding),this.inputSpec=[new Pt({ndim:4})]}computeOutputShape(e){e=Pe(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return n=Ys(n,this.poolSize[0],this.padding,this.strides[0]),s=Ys(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s]:[e[0],n,s,e[3]]}call(e,n){return P(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ce(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class hR extends dR{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Nt(o),ds(r),_m(e,n,s,r,o,"max")}}hR.className="MaxPooling2D";Y(hR);class fR extends dR{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Nt(o),ds(r),_m(e,n,s,r,o,"avg")}}fR.className="AveragePooling2D";Y(fR);class pR extends De{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new E(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];qt(this.poolSize,"poolSize"),qt(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Nt(this.dataFormat),ds(this.padding),this.inputSpec=[new Pt({ndim:5})]}computeOutputShape(e){e=Pe(e);let n=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return n=Ys(n,this.poolSize[0],this.padding,this.strides[0]),s=Ys(s,this.poolSize[1],this.padding,this.strides[1]),r=Ys(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],n,s,r]:[e[0],n,s,r,e[4]]}call(e,n){return P(()=>(this.invokeCallHook(e,n),this.poolingFunction(Ce(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class mR extends pR{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Nt(o),ds(r),aR(e,n,s,r,o,"max")}}mR.className="MaxPooling3D";Y(mR);class gR extends pR{constructor(e){super(e)}poolingFunction(e,n,s,r,o){return Nt(o),ds(r),aR(e,n,s,r,o,"avg")}}gR.className="AveragePooling3D";Y(gR);class xR extends De{constructor(e){super(e),this.inputSpec=[new Pt({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,n){throw new $e}}class yR extends xR{constructor(e){super(e||{})}call(e,n){return P(()=>{const s=Ce(e);return Rt(s,1)})}}yR.className="GlobalAveragePooling1D";Y(yR);class wR extends xR{constructor(e){super(e||{})}call(e,n){return P(()=>{const s=Ce(e);return qs(s,1)})}}wR.className="GlobalMaxPooling1D";Y(wR);class vR extends De{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Nt(this.dataFormat),this.inputSpec=[new Pt({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,n){throw new $e}getConfig(){const e={dataFormat:this.dataFormat},n=super.getConfig();return Object.assign(e,n),e}}class bR extends vR{call(e,n){return P(()=>{const s=Ce(e);return this.dataFormat==="channelsLast"?Rt(s,[1,2]):Rt(s,[2,3])})}}bR.className="GlobalAveragePooling2D";Y(bR);class CR extends vR{call(e,n){return P(()=>{const s=Ce(e);return this.dataFormat==="channelsLast"?qs(s,[1,2]):qs(s,[2,3])})}}CR.className="GlobalMaxPooling2D";Y(CR);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class kR extends De{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},n=super.getConfig();return Object.assign(e,n),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,n,s={}){const r=n.layer,o=br(r,s);delete n.layer;const i={layer:o};return Object.assign(i,n),new e(i)}}class SR extends kR{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Pe(e),e.length<3)throw new E(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const n=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(n),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Pe(e);const n=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(n),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,n){return P(()=>(e=Ce(e),_E((i,a)=>[Ce(this.layer.call(i,n)),[]],e,[],!1,null,null,!1,!0)[1]))}}SR.className="TimeDistributed";Y(SR);function wH(t){Zi(M6,"BidirectionalMergeMode",t)}const vH="concat";class IR extends kR{constructor(e){super(e);const n=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=n,this.forwardLayer=br(s),n.goBackwards=n.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=n,this.backwardLayer=br(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?vH:e.mergeMode,wH(this.mergeMode),e.weights)throw new $e("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const n=e.length,s=Math.floor(n/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let n=this.forwardLayer.computeOutputShape(e);Array.isArray(n)&&Array.isArray(n[0])||(n=[n]),n=n;let s,r,o;return this.returnState&&(o=n.slice(1)),s=n[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):Rn(r)}apply(e,n){let s=n==null?null:n.initialState,r=n==null?null:n.constants;n==null&&(n={});const o=DE(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,n);const i=[],a=[];if(s!=null){const c=s.length;if(c%2>0)throw new E("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");n.initialState=s,i.push(...s);const u=s.map(d=>new Pt({shape:d.shape}));this.forwardLayer.stateSpec=u.slice(0,c/2),this.backwardLayer.stateSpec=u.slice(c/2),a.push(...u)}if(r!=null)throw new $e("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof Ir;for(const c of i)if(c instanceof Ir!==l)throw new E("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const c=[e].concat(i),u=this.inputSpec.concat(a),d=this.inputSpec;this.inputSpec=u;const h=super.apply(c,n);return this.inputSpec=d,h}else return super.apply(e,n)}call(e,n){return P(()=>{const s=n.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,n),o=this.backwardLayer.call(e,n);else{const l=s.slice(0,s.length/2),c=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(n,{initialState:l})),o=this.backwardLayer.call(e,Object.assign(n,{initialState:c}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=Pi(o,1));let a;return this.mergeMode==="concat"?a=Hw([r,o]):this.mergeMode==="sum"?a=Z(r,o):this.mergeMode==="ave"?a=D(.5,Z(r,o)):this.mergeMode==="mul"?a=D(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Ci(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Ci(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,n){Array.isArray(n)&&(n=n[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[n,n]:s=n:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},n=super.getConfig();return Object.assign(e,n),e}static fromConfig(e,n){const s=br(n.layer);if(delete n.layer,n.numConstants!=null)throw new $e("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=n;return r.layer=s,new e(r)}}IR.className="Bidirectional";Y(IR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $R extends De{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return P(()=>(e=Ce(e),e.dtype!=="float32"&&(e=wr(e,"float32")),Z(D(e,this.scale),this.offset)))}}$R.className="Rescaling";Y($R);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:bH,cropAndResize:CH}=zr;class NR extends De{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,n,s,r,o,i,a,l){return P(()=>{let c,u=!1;const d=n/i,h=s/a,f=(r+n)/i,p=(o+s)/a,g=[d,h,f,p],x=[];e.rank===3?(u=!0,c=Gr([e])):c=e;for(let b=0;b<c.shape[0];b++)x.push(g);const m=bc(x,[x.length,4]),y=qc(0,x.length,1,"int32"),v=CH(c,m,y,[r,o],"nearest");return wr(u?Ce(Li(v)):v,l)})}upsize(e,n,s,r){return P(()=>{const o=bH(e,[n,s]);return wr(o,r)})}call(e,n){return P(()=>{const s=Ce(e),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let c=0;return a!==this.width&&(c=Math.floor((a-this.width)/2),c===0&&(c=1)),l>=0&&c>=0?this.centerCrop(s,l,c,this.height,this.width,i,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Pe(e);const n=e.length-3,s=e.length-2;return e[n]=this.height,e[s]=this.width,e}}NR.className="CenterCrop";Y(NR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function kH(t,e,n,s){let r=Ce(t);if(r.dtype!=="int32"&&(r=wr(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=En(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=En(r,-1)),r.rank>2)throw new E(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=EC(a,s,n,i):l=EC(a,[],n,i),e!=="tfIdf")return l;if(s)return D(l,s);throw new E("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class TR extends De{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){return e=Pe(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,n){return P(()=>{e=Ce(e),e.dtype!=="int32"&&(e=wr(e,"int32"));let s;if(typeof n.countWeights<"u"){if(this.outputMode!=="count")throw new E(`countWeights is not used when outputMode !== count.
              Received countWeights=${n.countWeights}`);s=Ce(n.countWeights)}const r=qs(e),o=yf(e),i=us(this.numTokens,r).bufferSync().get(0),a=qi(o,0).bufferSync().get(0);if(!(i&&a))throw new E(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return kH(e,this.outputMode,this.numTokens,s)})}}TR.className="CategoryEncoding";Y(TR);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const SH=["bilinear","nearest"],uk=new Set(SH);class ER extends De{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(uk.has(e.interpolation))this.interpolation=e.interpolation;else throw new E(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=Pe(e);const n=e[2];return[this.height,this.width,n]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},n=super.getConfig();return Object.assign(e,n),e}call(e,n){return P(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return zr.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return zr.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...uk]} are supported`)})}}ER.className="Resizing";Y(ER);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class RR{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}RR.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class AR extends De{constructor(e){super(e),this.randomGenerator=new RR(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},n=super.getConfig();return Object.assign(e,n),e}}AR.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const IH=["bilinear","nearest"],dk=new Set(IH);class DR extends AR{constructor(e){super(e);const{factor:n,interpolation:s="bilinear"}=e;if(this.factor=n,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new E(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new E(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new E(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(dk.has(s))this.interpolation=s;else throw new E(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},n=super.getConfig();return Object.assign(e,n),e}computeOutputShape(e){e=Pe(e);const n=e[2];return[this.imgHeight,-1,n]}call(e,n){return P(()=>{const s=Ce(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=fd([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return zr.resizeBilinear(e,i);case"nearest":return zr.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...dk]} are supported`)}})}}DR.className="RandomWidth";Y(DR);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $H=W();$H.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var hk;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(hk||(hk={}));var fk;(function(t){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(fk||(fk={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var pk;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(pk||(pk={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function he(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&I(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NH=$N;class Fm extends zx{nextDataId(){return Fm.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new X$(this,or())}write(e,n,s){this.firstUse&&(this.firstUse=!1,W().get("IS_NODE")&&es(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&fu(s[0])){const o=s.map(i=>No(i));r=this.write(o,e,n)}else r=this.write(s,e,n);return{dataId:r,shape:e,dtype:n}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const n=this.data.get(e);n.refCount++}decRef(e){if(this.data.has(e)){const n=this.data.get(e);n.refCount--}}move(e,n,s,r,o){this.data.set(e,{values:n,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:n,complexTensorInfos:s}=this.data.get(e);if(n==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return Hr(r,o)}return DM(this.data.get(e).values,n)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>Do(r));return Re(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Re(e.shape,e.dtype,n)}makeOutput(e,n,s){return or().makeTensorFromTensorInfo(this.makeTensorInfo(n,s,e),this)}disposeData(e,n=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!n&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const n=Tn();return e(),{kernelMs:Tn()-n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){he([e],"where");const n=this.readSync(e.dataId);return NH(e.shape,n)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Fm.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _R(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const TH=t=>{const{x:e}=t.inputs,n=t.backend;he(e,"abs");let s=new Float32Array(j(e.shape));const r=n.data.get(e.dataId).values;return s=_R(r),n.makeOutput(s,e.shape,e.dtype)},EH={kernelName:fp,backendName:"cpu",kernelFunc:TH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tt(t){return(e,n,s,r,o)=>{const i=Ie(e,n),a=i.length,l=pe(i),c=j(i),u=cn(o,c),d=e.length,h=n.length,f=pe(e),p=pe(n),g=ll(e,i),x=ll(n,i);if(g.length+x.length===0)for(let m=0;m<u.length;++m)u[m]=t(s[m%s.length],r[m%r.length]);else for(let m=0;m<u.length;++m){const y=Cl(m,a,l),w=y.slice(-d);g.forEach(k=>w[k]=0);const v=gr(w,d,f),b=y.slice(-h);x.forEach(k=>b[k]=0);const C=gr(b,h,p);u[m]=t(s[v],r[C])}return[u,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vn(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),l=n.data.get(a.dataId);return l.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",o),imag:n.makeTensorInfo(r.shape,"float32",i)},a}const RH={kernelName:Yx,backendName:"cpu",kernelFunc:Vn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _f(t,e,n="float32"){if(n==="complex64"){const r=_f(t,e,"float32"),o=_f(t,e,"float32");return Vn({inputs:{real:r,imag:o},backend:t})}const s=un(j(e),n);return t.makeTensorInfo(e,n,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $r(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const AH={kernelName:Fu,backendName:"cpu",kernelFunc:$r};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vi(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.real,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const DH={kernelName:vy,backendName:"cpu",kernelFunc:Vi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FR(t,e,n,s){if(s==="int32"){const r=Int32Array.from(t);return[e,"int32",r]}if(s==="bool"){const r=Xi([0],n),[o,i]=Tt((a,l)=>a!==l?1:0)(e,[],t,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${n} to ${s}`)}function Mo(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return $r({inputs:{x:r},backend:n});const u=_f(n,r.shape,r.dtype),d=Mo({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),h=Vn({inputs:{real:d,imag:u},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),h}if(r.dtype==="complex64"){const u=Vi({inputs:{input:r},backend:n}),d=Mo({inputs:{x:u},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(u),d}if(!Y$(r.dtype,o)){const u=$r({inputs:{x:r},backend:n});return{dataId:u.dataId,shape:u.shape,dtype:o}}const i=n.data.get(r.dataId).values,[a,l,c]=FR(i,r.shape,r.dtype,o);return n.makeTensorInfo(a,l,c)}const _H={kernelName:bu,backendName:"cpu",kernelFunc:Mo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wt(t,e,n,s){return n==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;he([i,a],t);const c=l.data.get(i.dataId).values,u=l.data.get(a.dataId).values,d=i.dtype==="string"?jr(c):c,h=i.dtype==="string"?jr(u):u,f=s||i.dtype,[p,g]=e(i.shape,a.shape,d,h,f);return l.makeTensorInfo(g,f,p)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const c=Mo({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,h=u.complexTensorInfos.imag,f=l.data.get(d.dataId).values,p=l.data.get(h.dataId).values,g=Mo({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),x=l.data.get(g.dataId),m=x.complexTensorInfos.real,y=x.complexTensorInfos.imag,w=l.data.get(m.dataId).values,v=l.data.get(y.dataId).values,[b,C,k]=n(i.shape,a.shape,f,p,w,v),S=l.makeTensorInfo(k,"float32",b),$=l.makeTensorInfo(k,"float32",C),N=Vn({inputs:{real:S,imag:$},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(g),l.disposeIntermediateTensorInfo(S),l.disposeIntermediateTensorInfo($),N}else{const c=l.data.get(i.dataId).values,u=l.data.get(a.dataId).values,d=s||i.dtype,[h,f]=e(i.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,h)}}}function uv(t){return(e,n,s,r,o,i)=>{const a=Ie(e,n),l=j(a),c=a.length,u=pe(a),d=cn("float32",l),h=cn("float32",l),f=ll(e,a),p=ll(n,a),g=Hr(s,r),x=Hr(o,i),m=e.length,y=pe(e),w=n.length,v=pe(n);if(f.length+p.length===0)for(let b=0;b<d.length;b++){const C=b%g.length,k=b%x.length,S=t(g[C*2],g[C*2+1],x[k*2],x[k*2+1]);d[b]=S.real,h[b]=S.imag}else for(let b=0;b<d.length;b++){const C=Cl(b,c,u),k=C.slice(-m);f.forEach(M=>k[M]=0);const S=gr(k,m,y),$=C.slice(-w);p.forEach(M=>$[M]=0);const N=gr($,w,v),A=t(g[S*2],g[S*2+1],x[N*2],x[N*2+1]);d[b]=A.real,h[b]=A.imag}return[d,h,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OR=Tt((t,e)=>t+e),FH=uv((t,e,n,s)=>({real:t+n,imag:e+s})),dl=Wt(kl,OR,FH),OH={kernelName:kl,backendName:"cpu",kernelFunc:dl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dv(t,e,n,s,r){const o=j(s),i=un(r,n);for(let a=0;a<t.length;a++){const l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(o>0?i[l]+=e[a]:i[l]+=1)}return i}function zR(t,e,n,s=!1){const r=t.shape[0],o=t.shape[1],i=Re([r,n],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<o;l++){const c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(s?i.set(1,a,c):e.size>0?i.set(i.get(a,c)+e.get(a,l),a,c):i.set(i.get(a,c)+1,a,c))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MR=Tt((t,e)=>t&e),zH=Wt(qx,MR),MH={kernelName:qx,backendName:"cpu",kernelFunc:zH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nr(t){return(e,n,s)=>{const r=kt(n,e.length);for(let o=0;o<e.length;++o)r[o]=t(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xe(t,e,n){const s=Nr(e);return Yo(t,s,n)}function Yo(t,e,n){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;he(i,t);const a=o,l=a.data.get(i.dataId).values;let c;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");c=jr(l)}else c=l;const u=n||i.dtype,d=e(c,u,r);return a.makeTensorInfo(i.shape,u,d)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PR=Nr(t=>Math.ceil(t)),PH=Yo(Cu,PR),LH={kernelName:Cu,backendName:"cpu",kernelFunc:PH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LR(t,e,n,s){const r=kt(n,j(e));if(s&&n!=="string"){let o=0;t.forEach(i=>{const a=j(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;t.forEach(i=>{const a=n==="string"?jr(i.vals):i.vals;let l=0;for(let c=0;c<i.shape[0];++c){const u=c*e[1]+o;for(let d=0;d<i.shape[1];++d)r[u+d]=a[l++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BR=Tt((t,e)=>t===e?1:0),VR=Wt(Tp,BR,null,"bool"),BH={kernelName:Tp,backendName:"cpu",kernelFunc:VR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WR=Nr(t=>Math.exp(t)),UR=Yo(Eu,WR,"float32"),VH={kernelName:Eu,backendName:"cpu",kernelFunc:UR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GR=Nr(t=>Math.expm1(t)),WH=Yo(Ru,GR),UH={kernelName:Ru,backendName:"cpu",kernelFunc:WH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HR=Nr(t=>Math.floor(t)),GH=Yo(Au,HR),HH={kernelName:Au,backendName:"cpu",kernelFunc:GH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jR=Tt((t,e)=>Math.floor(t/e)),jH=Wt(Du,jR,null,"int32"),KH={kernelName:Du,backendName:"cpu",kernelFunc:jH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KR(t,e,n,s,r,o,i,a,l){const c=Re([s,o],n);for(let u=0;u<s;u++){const d=[];let h=0;for(let f=0;f<r;f++){const p=t[u*r+f];h+=p*i[f],d.push(p)}if(h<0||h>=l/o)throw new Error(`Invalid indices: ${d} does not index into ${a}`);for(let f=0;f<o;f++)c.values[u*o+f]=e.get(...e.indexToLoc(h*o+f))}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XR(t,e,n){const s=Re(n,t.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],l=i[2],c=e.locToIndex([a,l]);i[2]=e.values[c];const u=t.locToIndex(i);0<=u&&u<t.values.length&&(s.values[r]=t.values[u])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qR=Tt((t,e)=>t>e?1:0),XH=Wt(Dp,qR,null,"bool"),qH={kernelName:Dp,backendName:"cpu",kernelFunc:XH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YR=Tt((t,e)=>t>=e?1:0),YH=Wt(_u,YR,null,"bool"),QH={kernelName:_u,backendName:"cpu",kernelFunc:YH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QR=Tt((t,e)=>t<e?1:0),JH=Wt(Fp,QR,null,"bool"),ZH={kernelName:Fp,backendName:"cpu",kernelFunc:JH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JR=Tt((t,e)=>t<=e?1:0),ej=Wt(Op,JR,null,"bool"),tj={kernelName:Op,backendName:"cpu",kernelFunc:ej};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZR(t,e,n){const s=(e-t)/(n-1),r=un(n,"float32");r[0]=t;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eA=Nr(t=>Math.log(t)),nj=Yo(Pu,eA),sj={kernelName:Pu,backendName:"cpu",kernelFunc:nj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tA(t,e,n,s){const r=cn(s,j(n));for(let o=0;o<r.length;++o){const i=o*e;let a=t[i];for(let l=0;l<e;++l){const c=t[i+l];(Number.isNaN(c)||c>a)&&(a=c)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nA=Tt((t,e)=>Math.max(t,e)),rj=Wt(Bu,nA),oj={kernelName:Bu,backendName:"cpu",kernelFunc:rj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sA=Tt((t,e)=>Math.min(t,e)),ij=Wt(Vu,sA),aj={kernelName:Vu,backendName:"cpu",kernelFunc:ij};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hv=Tt((t,e)=>t*e),lj=uv((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n})),Om=Wt(Uu,hv,lj),cj={kernelName:Uu,backendName:"cpu",kernelFunc:Om};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rA(t,e,n){const s=Wo(-1,n);return hv([],e,s,t,n)}function uj(t){const{inputs:e,backend:n}=t,{x:s}=e;he(s,"neg");const r=n.data.get(s.dataId).values,[o,i]=rA(r,s.shape,s.dtype);return n.makeTensorInfo(i,s.dtype,o)}const dj={kernelName:jp,backendName:"cpu",kernelFunc:uj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oA=Tt((t,e)=>t!==e?1:0),hj=Wt(Kp,oA,null,"bool"),fj={kernelName:Kp,backendName:"cpu",kernelFunc:hj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fv(t,e,n,s,r){const o=e.length,i=j(e),a=pe(e),l=pe(r),c=cn(n,j(r));for(let u=0;u<i;++u){const d=Cl(u,o,a),h=new Array(d.length);for(let p=0;p<h.length;p++)h[p]=d[s[p]];const f=gr(h,o,l);c[f]=t[u]}return c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fn(t){const{inputs:e,attrs:n,backend:s}=t,{x:r}=e,{perm:o}=n;he(r,"transpose");const i=r.shape.length,a=new Array(i);for(let d=0;d<a.length;d++)a[d]=r.shape[o[d]];const l=s.data.get(r.dataId).values,c=fv(l,r.shape,r.dtype,o,a);return{dataId:s.write(c,a,r.dtype),shape:a,dtype:r.dtype}}const pj={kernelName:Pa,backendName:"cpu",kernelFunc:Fn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iA(t,e,n,s){const[r,o]=Yt(t,s),i=Xn(e,"int32"),a=un(j(r),i),l=j(o);for(let c=0;c<a.length;++c){const u=c*l;let d=1;for(let h=0;h<l;++h)d*=n[u+h];a[c]=d}return{outVals:a,outShape:r,outDtype:i}}function mj(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;he(r,"prod");const a=r.shape.length,l=Ae(o,r.shape),c=yt(l,a);let u=l,d=r;const h=[];c!=null&&(d=Fn({inputs:{x:r},backend:n,attrs:{perm:c}}),h.push(d),u=$t(u.length,a));const f=n.data.get(d.dataId).values,{outVals:p,outShape:g,outDtype:x}=iA(d.shape,d.dtype,f,u);let m=g;return i&&(m=Dt(g,l)),h.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.makeTensorInfo(m,x,p)}const gj={kernelName:Zp,backendName:"cpu",kernelFunc:mj};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xj(t,e,n){t.forEach((s,r)=>{if(s<0||s>=n){const o=Cl(r,e.length,pe(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${n})`)}})}function yj(t,e){for(let n=0;n<t.length;++n){const s=t[n],r=n===t.length-1?e:t[n+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function wj(t,e,n,s){const r=[];let o=0;const i=e.length-1+n.length,a=new Array(i).fill(null).map(()=>[0]);yj(n,s);let l=1;for(let c=0;c<e.length-1;++c){l*=e[c];const u=e[c+1];for(let d=1;d<l+1;++d)a[c].push(d*u)}for(let c=0;c<t.length;++c){let u=t[c],d=t[c]+1;for(let h=0;h<n.length;++h){const f=n[h],p=h+e.length-1;if(p>=0){const g=a[p],x=g[g.length-1]-f[u];for(let m=u;m<d;++m)a[p].push(f[m+1]+x)}u=f[u],d=f[d]}d!==u&&(r.push([u,d]),o+=d-u)}return{outSplits:a,valueSlices:r,numValues:o}}function vj(t){const e=[];for(let n=0;n<t.length;++n){const s=t[n].length,r=kt("int32",s);e.push(r),t[n].forEach((o,i)=>r[i]=o)}return e}function mk(t,e){const n=t.slice(0,e);for(;n.length<e;)n.push(1);for(let s=e;s<t.length;s++)n[e-1]*=t[s];return n}function bj(t,e,n,s,r,o){const i=mk(e,2)[1],a=mk(o,2)[1];let l=0;for(const c of n)for(let u=c[0];u<c[1];++u){for(let d=0;d<s;++d)r[l*a+d]=t[u*i+d];++l}}function Cj(t,e,n,s,r){const o=e.slice();o[0]=r;const i=kt(n,j(o)),a=t.length,l=a===0?0:a/e[0];return bj(t,e,s,l,i,o),[i,o]}function aA(t,e,n,s,r,o,i,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(xj(o,i,l),s.length===0)throw new Error("params.rank must be nonzero");const c=s[0],{outSplits:u,valueSlices:d,numValues:h}=wj(o,i,t,c),f=vj(u),p=Cj(n,s,r,d,h);return[f,p[0],p[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gk=2147483647;function lA(t,e,n,s,r,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,c=i.length===0,u=[];a||u.push(e[0]),l||u.push(r[0]),c||u.push(i[0]);for(let x=1;x<u.length;++x)if(u[x]!==u[x-1])throw new Error("starts, limits, and deltas must have the same shape");const d=u.length===0?1:u[0],h=kt("int32",d+1);h[0]=0;for(let x=0;x<d;++x){const m=a?t[0]:t[x],y=l?s[0]:s[x],w=c?o[0]:o[x];if(w===0)throw new Error("Requires delta != 0");let v;if(w>0&&y<m||w<0&&y>m)v=0;else if(v=Math.ceil(Math.abs((y-m)/w)),v>gk)throw new Error(`Requires ((limit - start) / delta) <= ${gk}`);h[x+1]=h[x]+v}const f=h[d],p=kt(n,f);let g=0;for(let x=0;x<d;++x){const m=h[x+1]-h[x];let y=a?t[0]:t[x];const w=c?o[0]:o[x];for(let v=0;v<m;++v)p[g++]=y,y+=w}return[h,p]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fs=Ws;class Ff{constructor(e,n,s,r,o,i,a,l,c,u){this.shape=e,this.shapeShape=n,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=KN(u),this.raggedRank=XN(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===fs.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===fs.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const n=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case fs.VALUE_ROWIDS:return Ff.getMaxWidthValueRowID(n);case fs.ROW_SPLITS:return Ff.getMaxWidthRowSplit(n);default:throw new Error(`Cannot handle partition type ${fs[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const n=e.length;if(n===0||n===1)return 0;let s=0;for(let r=0;r<n-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const n=e.length;if(n===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<n;++i){const a=e[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(n-s,o)}tensorShapeFromTensor(e,n,s=!0){if(n.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return yk(e,s)}calculateOutputSize(e){const n=this.valuesShape,s=this.defaultValueShape;qN(s,n);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=jN(this.raggedRank,r,n);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,n,s){const r=Math.min(e,s),o=[];let i=0;for(let a=0;a<r;++a,i+=n)o.push(i);for(let a=r;a<e;++a)o.push(-1);return I(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,n,s,r){const o=e.length,i=[];for(let a=0;a<o-1;++a){const l=e[a+1]-e[a];let c=Math.min(r,l),u=n[a];u===-1&&(c=0);for(let d=0;d<c;++d)i.push(u),u+=s;for(let d=0;d<l-c;++d)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,n,s,r){const o=e.length,i=[];if(o===0)return[];let a=0,l=e[0];if(l>=n.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${n.length}`);let c=n[l];i.push(c);for(let u=1;u<o;++u){const d=e[u];if(d===l)c>=0&&(++a,a<r?c+=s:c=-1);else{if(a=0,l=d,d>=n.length)throw new Error(`Got nextValueRowId=${d} which is not less than ${n.length}`);c=n[d]}i.push(c)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,n,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case fs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,n,s,r);case fs.ROW_SPLITS:if(o.length-1>n.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${n.length}`);return this.calculateOutputIndexRowSplit(o,n,s,r);default:throw new Error(`Unsupported partition type: ${fs[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const n=this.rowPartitionTypes[0];switch(n){case fs.FIRST_DIM_SIZE:return e[0];case fs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case fs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${fs[n]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const n=this.getFirstDimensionSize(),s=this.calculateOutputSize(n),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const o=yk(s,!1),i=kt(this.valuesDType,j(o));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(n,r[0],s[0]);for(let c=1;c<=this.raggedRank;++c)l=this.calculateOutputIndex(c-1,l,r[c],s[c]);this.setOutput(this.raggedRank,l,i,o)}return[o,i]}setOutput(e,n,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(e+1);const l=j(a),c=n.length;let u=this.defaultValue;if(u.length!==l&&u.length!==1){const p=this.defaultValueShape;P(()=>{const g=F(u,p);u=Cc(g,a).dataSync()})}let d=0,h=0,f=0;for(let p=0;p<=c;++p){let g=p<c?n[p]:-1;if(g===f){++f;continue}if(h<f){const x=o.subarray(d*l),m=i.subarray(h*l),y=(f-h)*l;xk(m,x,y)}if(p>=c){const x=s.length;g=Math.floor(x/l)}if(g>f)if(this.defaultValue.length===1)i.subarray(f*l,g*l).fill(this.defaultValue[0]),f=g;else for(;g>f;){const x=i.slice(f*l);xk(x,u,l),++f}g<0?(d=p+1,h=f):(d=p,h=f,f=h+1)}}}function xk(t,e,n){for(let s=0;s<n;s++)t[s]=e[s]}function yk(t,e){const n=[];for(let s of t){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}n.push(s)}return n}function cA(t,e,n,s,r,o,i,a,l,c){return new Ff(t,e,n,s,r,o,i,a,l,c).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uA(t,e,n,s){const r=t===e,o=t<e&&n<0,i=e<t&&n>1;if(r||o||i)return un(0,s);const a=Math.abs(Math.ceil((e-t)/n)),l=un(a,s);e<t&&n===1&&(n=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+n;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dA=Nr(t=>1/Math.sqrt(t)),kj=Yo(qu,dA),Sj={kernelName:qu,backendName:"cpu",kernelFunc:kj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mi(t,e,n,s,r,o,i,a,l,c){const u=[s/r,r],d=t.values,h=e.values;if(s===0)return Re(n,e.dtype);const f=l instanceof tn?l:Re(u,e.dtype);typeof l=="string"||typeof l=="number"?f.values.fill(l):typeof l=="boolean"&&f.values.fill(+l);for(let p=0;p<o;p++){const g=[];let x=0;for(let m=0;m<i;m++){const y=d[p*i+m];g.push(y),x+=y*a[m]}if(x<0||x>=s/r)throw new Error(`Invalid indices: ${g} does not index into ${n}`);for(let m=0;m<r;m++)c?f.values[x*r+m]+=h[p*r+m]:f.values[x*r+m]=e.rank===0?h[0]:h[p*r+m]}return f}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ij=Nr(t=>1/(1+Math.exp(-t))),hA=Xe(ed,t=>1/(1+Math.exp(-t))),$j={kernelName:ed,backendName:"cpu",kernelFunc:hA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fA(t,e,n,s,r){const o=vw(s,e,n),i=j(n),a=pe(s);if(o){const d=bw(e,a);return r==="string"?t.slice(d,d+i):t.subarray(d,d+i)}const l=r==="string"?jr(t):t,c=Re(s,r,l),u=Re(n,r);for(let d=0;d<u.size;++d){const h=u.indexToLoc(d),f=h.map((p,g)=>p+e[g]);u.set(c.get(...f),...h)}return r==="string"?mT(u.values):u.values}function Wi(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,size:i}=s;he(r,"slice");const[a,l]=vm(r,o,i);yw(r,a,l);const c=n.data.get(r.dataId).values,u=fA(c,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,u)}const Nj={kernelName:om,backendName:"cpu",kernelFunc:Wi};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pA(t,e,n,s,r,o,i){const a=e[0],l=o[0],c=new Array(l),u=new Array(a),d=e[1];if(l===0){if(a!==0)throw new Error(nT(a));const x=kt(n,0),m=kt(r,0);return[x,[0,d],m,c,u]}let h=!0,f=0;const p=new Array(l).fill(0);for(let x=0;x<a;++x){const m=t[x*d];if(m<0)throw new Error(sT(x,m));if(m>=l)throw new Error(rT(x,m,l));++p[m],h=h&&m>=f,f=m}let g=!0;for(let x=0;x<l;++x){const m=p[x]===0;c[x]=m,g=g&&!m,p[x]=Math.max(p[x],1),x>0&&(p[x]+=p[x-1])}if(g&&h){const x=t,m=s;for(let y=0;y<a;++y)u[y]=y;return[x,[a,d],m,c,u]}else{const x=p[l-1],m=kt(n,x*d),y=kt(r,x),w=new Array(l).fill(0);for(let v=0;v<a;++v){const b=t[v*d],C=w[b],k=(b===0?0:p[b-1])+C;w[b]++;for(let S=0;S<d;++S)m[k*d+S]=t[v*d+S];y[k]=s[v],u[v]=k}for(let v=0;v<l;++v)if(w[v]===0){const C=v===0?0:p[v-1];m[C*d+0]=v;for(let k=1;k<d;++k)m[C*d+k]=0;y[C]=i}return[m,[x,d],y,c,u]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mA(t,e,n,s,r){const o=j(s),i=e[0],a=r.length,l=[];let c=1,u=-1;for(let x=0;x<a;++x){const m=r[x];if(m===-1){if(u!==-1)throw new Error(oT(u,x));u=x,l.push(1)}else{if(m<0)throw new Error(iT(x,m));c*=m,l.push(m)}}if(u!==-1){if(c<=0)throw new Error(aT());const x=Math.trunc(o/c);if(c*x!==o)throw new Error(lT(s,l));l[u]=x}if(j(l)!==o)throw new Error(cT(s,l));const h=s.length,f=[];if(h>0){f[h-1]=1;for(let x=h-2;x>=0;--x)f[x]=f[x+1]*s[x+1]}const p=[];if(a>0){p[a-1]=1;for(let x=a-2;x>=0;--x)p[x]=p[x+1]*l[x+1]}const g=kt(n,i*a);for(let x=0;x<i;++x){let m=0;for(let y=0;y<h;++y)m+=t[x*h+y]*f[y];for(let y=0;y<a;++y)g[x*a+y]=Math.trunc(m/p[y]),m%=p[y]}return[g,[i,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pv(t,e,n,s,r,o=!1,i=0){const a=s.length,l=[e[0],t.length/e[0]],c=l[1],d=a>0?r[a-1]+1:0;if(d<0)throw new Error(p1());const h=e.slice();h[0]=d;const f=h.reduce((w,v)=>w*v,1),p=kt(n,f);if(a===0)return d>0&&p.fill(i),[p,h];if(d<=0)throw new Error(p1());let g=0,x=1,m=0,y=r[g];for(;;){let w=0;if(x<a){if(w=r[x],y===w){++x;continue}if(y>=w)throw new Error(uT())}if(y<0||y>=d)throw new Error(dT(y,d));y>m&&p.fill(i,m*c,y*c);for(let v=g;v<x;++v){const b=s[v];if(b<0||b>=l[0])throw new Error(hT(v,s[v],l[0]));for(let C=0;C<c;C++)p[y*c+C]+=t[b*c+C]}if(o)for(let v=0;v<c;v++)p[y*c+v]/=x-g;if(g=x,++x,m=y+1,y=w,x>a)break}return m<d&&p.fill(i,m*c,d*c),[p,h]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tj=Nr(t=>Math.sqrt(t)),Ej=Xe(nd,t=>Math.sqrt(t)),Rj={kernelName:nd,backendName:"cpu",kernelFunc:Ej};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gA=Tt((t,e)=>{const n=t-e;return n*n}),Aj=Wt(sd,gA),Dj={kernelName:sd,backendName:"cpu",kernelFunc:Aj};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xA=Nr((t,e)=>{const{pattern:n,replaceGlobal:s,rewrite:r}=e;return t.replace(new RegExp(n,s?"g":""),r)}),_j=Yo(Sy,xA),Fj={kernelName:Sy,backendName:"cpu",kernelFunc:_j};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yA(t,e,n,s){const r=Re(t,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*n[l]+s[l];r.set(e.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Oj{constructor(e,n,s,r,o,i){this.separator=No(e),this.nGramWidths=n,this.leftPad=No(s),this.rightPad=No(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,n){const s=this.getPadWidth(n);return Math.max(0,e+2*s-n+1)}createNGrams(e,n,s,r,o,i){for(let a=0;a<o;++a){const l=this.getPadWidth(i),c=Math.max(0,l-a),u=Math.max(0,l-(o-(a+1))),d=i-(c+u),h=n+(c>0?0:a-l);let f=0;f+=c*this.leftPad.length;for(let y=0;y<d;++y)f+=e[h+y].length;f+=u*this.rightPad.length;const p=c+u+d-1;f+=p*this.separator.length,s[r+a]=new Uint8Array(f);const g=s[r+a];let x=0;const m=y=>y.forEach(w=>g[x++]=w);for(let y=0;y<c;++y)m(this.leftPad),m(this.separator);for(let y=0;y<d-1;++y)m(e[h+y]),m(this.separator);if(d>0){m(e[h+d-1]);for(let y=0;y<u;++y)m(this.separator),m(this.rightPad)}else{for(let y=0;y<u-1;++y)m(this.rightPad),m(this.separator);m(this.rightPad)}}}compute(e,n){const s=e.length,r=n.length;if(r>0){let l=n[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let c=1;c<r;++c){let u=n[c]>=l;if(u=u&&n[c]<=s,!u)throw new Error(`Invalid split value ${n[c]}, must be in [${l}, ${s}]`);l=n[c]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const o=r-1,i=kt("int32",r);if(s===0||r===0){const l=new Array(s);for(let c=0;c<=o;++c)i[c]=0;return[l,i]}i[0]=0;for(let l=1;l<=o;++l){const c=n[l]-n[l-1];let u=0;this.nGramWidths.forEach(d=>{u+=this.getNumNGrams(c,d)}),this.preserveShort&&c>0&&u===0&&(u=1),i[l]=i[l-1]+u}const a=new Array(i[o]);for(let l=0;l<o;++l){const c=n[l];let u=i[l];if(this.nGramWidths.forEach(d=>{const h=n[l+1]-n[l],f=this.getNumNGrams(h,d);this.createNGrams(e,c,a,u,f,d),u+=f}),this.preserveShort&&u===i[l]){const d=n[l+1]-n[l];if(d===0)continue;const h=d+2*this.padWidth;this.createNGrams(e,c,a,u,1,h)}}return[a,i]}}function wA(t,e,n,s,r,o,i,a){return new Oj(n,s,r,o,i,a).compute(t,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zj(t,e,n,s){if(!t.length)return;if(e.length===0){for(let o=0;o<t.length;++o)s.push(t.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=t.indexOf(o);for(;i!==-1;){const a=t.subarray(0,i);(!n||a.length!==0)&&s.push(a),t=t.subarray(i+1),i=t.indexOf(o)}(!n||t.length!==0)&&s.push(t);return}let r=0;for(let o=0;o<t.length+1;o++)if(o===t.length||e.indexOf(t[o])!==-1){const i=t.subarray(r,o);(!n||i.length!==0)&&s.push(i),r=o+1}}function vA(t,e,n){const s=t.length,r=[];let o=0,i=0;const a=new Array(s);for(let h=0;h<s;++h){const f=r.length;zj(t[h],e,n,r);const p=r.length-f;a[h]=p,o+=p,i=Math.max(i,p)}const l=kt("int32",o*2),c=new Array(o),u=[s,i];let d=0;for(let h=0;h<s;++h)for(let f=0;f<a[h];++f)l[d*2]=h,l[d*2+1]=f,c[d]=r[d],++d;return[l,c,u]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bA(t,e){const n=kt("int32",t.length);for(let s=0;s<t.length;++s)n[s]=QM(t[s]).modulo(e).getLowBitsUnsigned();return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CA=Tt((t,e)=>t-e),Mj=uv((t,e,n,s)=>({real:t-n,imag:e-s})),mv=Wt(rd,CA,Mj),Pj={kernelName:rd,backendName:"cpu",kernelFunc:mv};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kA(t,e){const n=new Array(t.rank);for(let r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];const s=Re(n,t.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(t.rank);for(let l=0;l<i.length;l++)i[l]=o[l]%t.shape[l];const a=t.locToIndex(i);s.values[r]=t.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ac=(t,e)=>{const n=e.value-t.value;return n===0?t.index-e.index:n};function SA(t,e,n=0,s=t.length-1){for(;s>n;){if(s-n>600){const a=s-n+1,l=e-n+1,c=Math.log(a),u=.5*Math.exp(2*c/3),d=.5*Math.sqrt(c*u*(a-u)/a)*Math.sign(l-a/2),h=Math.max(n,Math.floor(e-l*u/a+d)),f=Math.min(s,Math.floor(e+(a-l)*u/a+d));SA(t,e,h,f)}const r=t[e];let o=n,i=s;for(fa(t,n,e),ac(t[s],r)>0&&fa(t,n,s);o<i;){for(fa(t,o,i),o++,i--;ac(t[o],r)<0;)o=o+1;for(;ac(t[i],r)>0;)i=i-1}ac(t[n],r)===0?fa(t,n,i):(i=i+1,fa(t,i,s)),i<=e&&(n=i+1),e<=i&&(s=i-1)}}function IA(t,e,n,s,r){const o=e[e.length-1],[i,a]=[t.length/o,o],l=cn(n,i*s),c=cn("int32",i*s);for(let d=0;d<i;d++){const h=d*a,f=t.subarray(h,h+a);let p=new Array(f.length);f.forEach((y,w)=>p[w]={value:y,index:w}),s<p.length&&(SA(p,s),p=p.slice(0,s)),r&&p.sort(ac);const g=d*s,x=l.subarray(g,g+s),m=c.subarray(g,g+s);for(let y=0;y<s;y++)x[y]=p[y].value,m[y]=p[y].index}const u=e.slice();return u[u.length-1]=s,[Re(u,n,l),Re(u,"int32",c)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $A(t,e,n,s){const r=Ae(e,n)[0],o=[1,n[0],1];for(let p=0;p<r;p++)o[0]*=n[p];o[1]=n[r];for(let p=r+1;p<n.length;p++)o[2]*=n[p];const i=new Map,a=new Int32Array(n[r]),l=new tn(o,s,t),c=[],u=o[0]===1&&o[2]===1;for(let p=0;p<n[r];p++){let g;if(u)g=t[p].toString();else{const m=[];for(let y=0;y<o[0];y++)for(let w=0;w<o[2];w++)m.push(l.get(y,p,w));g=m.join(",")}const x=i.get(g);if(x!=null)a[p]=x;else{const m=i.size;i.set(g,m),a[p]=m,c.push(p)}}const d=o.slice();d[1]=i.size;const h=new tn(d,s);c.forEach((p,g)=>{for(let x=0;x<o[0];x++)for(let m=0;m<o[2];m++)h.set(l.get(x,p,m),x,g,m)});const f=n.slice();return f[r]=d[1],{outputValues:h.values,outputShape:f,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lj=Object.freeze(Object.defineProperty({__proto__:null,addImpl:OR,bincountImpl:dv,bincountReduceImpl:zR,bitwiseAndImpl:MR,castImpl:FR,ceilImpl:PR,concatImpl:LR,equalImpl:BR,expImpl:WR,expm1Impl:GR,floorDivImpl:jR,floorImpl:HR,gatherNdImpl:KR,gatherV2Impl:XR,greaterEqualImpl:YR,greaterImpl:qR,lessEqualImpl:JR,lessImpl:QR,linSpaceImpl:ZR,logImpl:eA,maxImpl:tA,maximumImpl:nA,minimumImpl:sA,multiplyImpl:hv,negImpl:rA,notEqualImpl:oA,prodImpl:iA,raggedGatherImpl:aA,raggedRangeImpl:lA,raggedTensorToTensorImpl:cA,rangeImpl:uA,rsqrtImpl:dA,scatterImpl:mi,sigmoidImpl:Ij,simpleAbsImpl:_R,sliceImpl:fA,sparseFillEmptyRowsImpl:pA,sparseReshapeImpl:mA,sparseSegmentReductionImpl:pv,sqrtImpl:Tj,squaredDifferenceImpl:gA,staticRegexReplaceImpl:xA,stridedSliceImpl:yA,stringNGramsImpl:wA,stringSplitImpl:vA,stringToHashBucketFastImpl:bA,subImpl:CA,tileImpl:kA,topKImpl:IA,transposeImpl:fv,uniqueImpl:$A},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */U2("cpu",()=>new Fm,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NA=Xe(Nu,t=>t>=0?t:Math.exp(t)-1),Bj={kernelName:Nu,backendName:"cpu",kernelFunc:NA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TA(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:o}=s;he([r],"leakyRelu");const i=j(r.shape),a=n.data.get(r.dataId).values,l=cn("float32",i);for(let c=0;c<a.length;c++)l[c]=a[c]<0?o*a[c]:a[c];return n.makeTensorInfo(r.shape,"float32",l)}const Vj={kernelName:_p,backendName:"cpu",kernelFunc:TA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wj=Tt((t,e)=>t<0?e*t:t);function EA(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e;he([s,r],"prelu");const o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,[a,l]=Wj(s.shape,r.shape,o,i,"float32");return n.makeTensorInfo(l,"float32",a)}const Uj={kernelName:Jp,backendName:"cpu",kernelFunc:EA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RA=Xe(ju,t=>Math.max(0,t)),Gj={kernelName:ju,backendName:"cpu",kernelFunc:RA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AA=Xe(Ku,t=>Math.min(Math.max(0,t),6)),Hj={kernelName:Ku,backendName:"cpu",kernelFunc:AA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Of(t,e,n,s,r){if(n==="linear")return $r({inputs:{x:e},backend:t});if(n==="relu")return RA({inputs:{x:e},backend:t});if(n==="elu")return NA({inputs:{x:e},backend:t});if(n==="relu6")return AA({inputs:{x:e},backend:t});if(n==="prelu")return EA({inputs:{x:e,alpha:s},backend:t});if(n==="leakyrelu")return TA({inputs:{x:e},backend:t,attrs:{alpha:r}});if(n==="sigmoid")return hA({inputs:{x:e},backend:t});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function st(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:o}=s,i=j(r.shape),a=q$(o,i),l=j(a);I(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),n.incRef(r.dataId);const c=n.data.get(r.dataId);if(c.complexTensorInfos!=null){const u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const jj={kernelName:em,backendName:"cpu",kernelFunc:st};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;he([r,o],"matMul");const l=r.shape.length,c=o.shape.length,u=i?r.shape[l-2]:r.shape[l-1],d=a?o.shape[c-1]:o.shape[c-2],h=i?r.shape[l-1]:r.shape[l-2],f=a?o.shape[c-2]:o.shape[c-1],p=r.shape.slice(0,-2),g=o.shape.slice(0,-2),x=j(p),m=j(g),w=Ie(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([h,f]);I(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const v=i?[x,u,h]:[x,h,u],b=a?[m,f,d]:[m,d,f],C=st({inputs:{x:r},backend:n,attrs:{shape:v}}),k=st({inputs:{x:o},backend:n,attrs:{shape:b}}),S=i?C.shape[1]:C.shape[2],$=i?C.shape[2]:C.shape[1],N=a?k.shape[1]:k.shape[2],A=Math.max(x,m),M=n.data.get(C.dataId).values,L=n.data.get(k.dataId).values,V=pe(C.shape),B=pe(k.shape),[U,K,R]=i?[V[0],1,V[1]]:[V[0],V[1],1],[z,G,X]=a?[1,B[1],B[0]]:[B[1],1,B[0]],q=$*N,Q=Re([A,$,N],C.dtype),ee=Q.values,J=n.blockSize;for(let ne=0;ne<A;ne++){const ie=ne%x,ce=ne%m;for(let ue=0;ue<$;ue+=J){const xe=Math.min(ue+J,$);for(let be=0;be<N;be+=J){const ke=Math.min(be+J,N);for(let He=0;He<S;He+=J){const Te=Math.min(He+J,S);for(let Me=ue;Me<xe;Me++)for(let Be=be;Be<ke;Be++){let qe=0;for(let Ge=He;Ge<Te;Ge++){const Pn=M[ie*U+Me*K+Ge*R],_t=L[Ge*z+Be*G+ce*X];qe+=Pn*_t}ee[ne*q+(Me*N+Be)]+=qe}}}}}return n.disposeIntermediateTensorInfo(C),n.disposeIntermediateTensorInfo(k),n.makeTensorInfo(w,Q.dtype,Q.values)}const Kj={kernelName:yp,backendName:"cpu",kernelFunc:DA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xj(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=s;let h,f,p;const g=[];h=DA({inputs:{a:r,b:o},attrs:{transposeA:l,transposeB:c},backend:n}),i&&(f=dl({inputs:{a:h,b:i},backend:n}),g.push(h),h=f),u&&(p=Of(n,h,u,a,d),g.push(h),h=p);for(const m of g)n.disposeIntermediateTensorInfo(m);return h}const qj={kernelName:hf,backendName:"cpu",kernelFunc:Xj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Yj=Xe(pu,t=>Math.acos(t)),Qj={kernelName:pu,backendName:"cpu",kernelFunc:Yj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jj=Xe(mu,t=>Math.acosh(t)),Zj={kernelName:mu,backendName:"cpu",kernelFunc:Jj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e8(t){const{inputs:e,backend:n}=t,s=e;he(e,"addN");const r=s.map(a=>n.data.get(a.dataId).values),o=Re(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const l=r[a];for(let c=0;c<i.length;c++)i[c]+=l[c]}return n.makeTensorInfo(o.shape,o.dtype,o.values)}const t8={kernelName:Ux,backendName:"cpu",kernelFunc:e8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;he(r,"all");const a=Ae(o,r.shape);let l=a;const c=yt(l,r.shape.length);let u=r;c!=null&&(u=Fn({inputs:{x:r},backend:n,attrs:{perm:c}}),l=$t(l.length,r.shape.length)),sn("all",l,u.shape.length);const[d,h]=Yt(u.shape,l),f=j(h),p=un(j(d),u.dtype),g=n.data.get(u.dataId).values;for(let m=0;m<p.length;++m){const y=m*f;let w=g[y];for(let v=0;v<f;++v){const b=g[y+v];w=w&&b}p[m]=w}c!=null&&n.disposeIntermediateTensorInfo(u);const x=n.makeTensorInfo(d,u.dtype,p);if(i){const m=Dt(d,a),y=st({inputs:{x},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(x),y}return x}const s8={kernelName:Gx,backendName:"cpu",kernelFunc:n8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;he(r,"any");const a=Ae(o,r.shape);let l=a;const c=yt(l,r.shape.length);let u=r;c!=null&&(u=Fn({inputs:{x:r},backend:n,attrs:{perm:c}}),l=$t(l.length,r.shape.length)),sn("any",l,u.shape.length);const[d,h]=Yt(u.shape,l),f=j(h),p=un(j(d),u.dtype),g=n.data.get(u.dataId).values;for(let m=0;m<p.length;++m){const y=m*f;let w=g[y];for(let v=0;v<f;++v){const b=g[y+v];w=w||b}p[m]=w}c!=null&&n.disposeIntermediateTensorInfo(u);const x=n.makeTensorInfo(d,u.dtype,p);if(i){const m=Dt(d,a),y=st({inputs:{x},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(x),y}return x}const o8={kernelName:Hx,backendName:"cpu",kernelFunc:r8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;he(r,"argMax");let i=Ae(o,r.shape);const a=yt(i,r.shape.length);let l=r;const c=[];a!=null&&(l=Fn({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),i=$t(i.length,l.shape.length)),i=[i[0]],sn("argMax",i,l.shape.length);const[u,d]=Yt(l.shape,i),h=j(u),f=un(h,"int32"),p=j(d),g=n.data.get(l.dataId).values;for(let x=0;x<f.length;++x){const m=x*p;let y=g[m],w=0;for(let v=0;v<p;++v){const b=g[m+v];b>y&&(y=b,w=v)}f[x]=w}return c.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(u,"int32",f)}const a8={kernelName:pp,backendName:"cpu",kernelFunc:i8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;he(r,"argMin");let i=Ae(o,r.shape);const a=yt(i,r.shape.length);let l=r;const c=[];a!=null&&(l=Fn({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),i=$t(i.length,l.shape.length)),i=[i[0]],sn("argMin",i,l.shape.length);const[u,d]=Yt(l.shape,i),h=j(u),f=un(h,"int32"),p=j(d),g=n.data.get(l.dataId).values;for(let x=0;x<f.length;++x){const m=x*p;let y=g[m],w=0;for(let v=0;v<p;++v){const b=g[m+v];b<y&&(y=b,w=v)}f[x]=w}return c.forEach(x=>n.disposeIntermediateTensorInfo(x)),n.makeTensorInfo(u,"int32",f)}const c8={kernelName:mp,backendName:"cpu",kernelFunc:l8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u8=Xe(gu,t=>Math.asin(t)),d8={kernelName:gu,backendName:"cpu",kernelFunc:u8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h8=Xe(xu,t=>Math.asinh(t)),f8={kernelName:xu,backendName:"cpu",kernelFunc:h8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const p8=Xe(yu,t=>Math.atan(t)),m8={kernelName:yu,backendName:"cpu",kernelFunc:p8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8=Tt((t,e)=>Math.atan2(t,e)),x8=Wt(vu,g8),y8={kernelName:vu,backendName:"cpu",kernelFunc:x8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const w8=Xe(wu,t=>Math.atanh(t)),v8={kernelName:wu,backendName:"cpu",kernelFunc:w8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gv(t,e,n,s,r,o){const i=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,u=r.effectiveFilterHeight,d=r.effectiveFilterWidth,h=r.padInfo.top,f=r.padInfo.left,p=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=Re(r.outShape,n),x=g.values,m=r.outShape[1]*r.outShape[2]*r.outShape[3],y=r.outShape[2]*r.outShape[3],w=r.outShape[3];for(let v=0;v<r.batchSize;++v){const b=v*m,C=v*s[0];for(let k=0;k<r.inChannels;++k)for(let S=0;S<r.outHeight;++S){const $=S*i-h,N=Math.max(0,$),A=Math.min(r.inHeight,u+$),M=b+S*y;for(let L=0;L<r.outWidth;++L){const V=L*a-f,B=Math.max(0,V),U=Math.min(r.inWidth,d+V);let K=p,R=0,z=0;for(let X=N;X<A;X+=l){const q=C+X*s[1];for(let Q=B;Q<U;Q+=c){const ee=q+Q*s[2],J=t[ee+k];o==="max"&&J>K?K=J:o==="avg"&&(R+=J,z++)}if(isNaN(K))break}const G=M+L*w+k;x[G]=o==="avg"?R/z:K}}}return g}function _A(t,e,n,s,r=!1,o=!1){const i=Re(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,c=s.dilationHeight,u=s.dilationWidth,d=s.effectiveFilterHeight,h=s.effectiveFilterWidth,f=s.padInfo.top,p=s.padInfo.left,g=Re(e,n,t);for(let x=0;x<s.batchSize;++x)for(let m=0;m<s.inChannels;++m)for(let y=0;y<s.outHeight;++y){const w=y*a-f;let v=w;for(;v<0;)v+=c;const b=Math.min(s.inHeight,d+w);for(let C=0;C<s.outWidth;++C){const k=C*l-p;let S=k;for(;S<0;)S+=u;const $=Math.min(s.inWidth,h+k);let N=Number.NEGATIVE_INFINITY,A=-1;for(let M=v;M<b;M+=c){const L=M-w;for(let V=S;V<$;V+=u){const B=V-k,U=g.get(x,M,V,m);U>N&&(N=U,r?A=o?((x*s.inHeight+M)*s.inWidth+V)*s.inChannels+m:(M*s.inWidth+V)*s.inChannels+m:A=L*h+B)}}i.set(A,x,y,C,m)}}return i}function FA(t,e,n,s,r,o){const i=r.strideDepth,a=r.strideHeight,l=r.strideWidth,c=r.dilationDepth,u=r.dilationHeight,d=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,p=r.effectiveFilterWidth,g=r.padInfo.front,x=r.padInfo.top,m=r.padInfo.left,y=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Re(r.outShape,n),v=w.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],k=r.outShape[3]*r.outShape[4],S=r.outShape[4];for(let $=0;$<r.batchSize;++$){const N=$*b,A=$*s[0];for(let M=0;M<r.inChannels;++M)for(let L=0;L<r.outDepth;++L){const V=L*i-g;let B=V;for(;B<0;)B+=c;const U=Math.min(r.inDepth,h+V),K=N+L*C;for(let R=0;R<r.outHeight;++R){const z=R*a-x;let G=z;for(;G<0;)G+=u;const X=Math.min(r.inHeight,f+z),q=K+R*k;for(let Q=0;Q<r.outWidth;++Q){const ee=Q*l-m;let J=ee;for(;J<0;)J+=d;const ne=Math.min(r.inWidth,p+ee),ie=q+Q*S;let ce=y,ue=0,xe=0;for(let ke=B;ke<U;ke+=c){const He=A+ke*s[1];for(let Te=G;Te<X;Te+=u){const Me=He+Te*s[2];for(let Be=J;Be<ne;Be+=d){const qe=Me+Be*s[3],Ge=t[qe+M];if(o==="max"&&Ge>ce?ce=Ge:o==="avg"&&(ue+=Ge,xe++),isNaN(ce))break}if(isNaN(ce))break}if(isNaN(ce))break}const be=ie+M;v[be]=o==="avg"?ue/Math.max(xe,1):ce}}}}return w}function b8(t,e){const n=Re(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,c=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,h=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left;for(let g=0;g<e.batchSize;++g)for(let x=0;x<e.inChannels;++x)for(let m=0;m<e.outDepth;++m){const y=m*s-h;let w=y;for(;w<0;)w+=i;const v=Math.min(e.inDepth,c+y);for(let b=0;b<e.outHeight;++b){const C=b*r-f;let k=C;for(;k<0;)k+=a;const S=Math.min(e.inHeight,u+C);for(let $=0;$<e.outWidth;++$){const N=$*o-p;let A=N;for(;A<0;)A+=l;const M=Math.min(e.inWidth,d+N);let L=Number.NEGATIVE_INFINITY,V=-1;for(let B=w;B<v;B+=i){const U=B-y;for(let K=k;K<S;K+=a){const R=K-C;for(let z=A;z<M;z+=l){const G=z-N,X=t.get(g,B,K,z,x);X>=L&&(L=X,V=U*u*d+R*u+G)}}}n.set(V,g,m,b,$,x)}}}return n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;he(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,c=1;I(hn(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Rs(r.shape,o,i,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&Ue(u.inShape,u.outShape))d=$r({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,f=pe(r.shape),p=gv(h,r.shape,r.dtype,f,u,"avg");d=n.makeTensorInfo(u.outShape,r.dtype,p.values)}return d}const k8={kernelName:gp,backendName:"cpu",kernelFunc:C8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=s;he(r,"avgPool3d");const u=qr(r.shape,o,i,1,a,l,c),d=n.data.get(r.dataId).values,h=FA(d,r.shape,r.dtype,pe(r.shape),u,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}const I8={kernelName:xp,backendName:"cpu",kernelFunc:S8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:c}=s;he([r,o],"avgPool3DGrad");const u=qr(o.shape,i,a,1,l,c),d=u.strideDepth,h=u.strideHeight,f=u.strideWidth,p=u.filterDepth,g=u.filterHeight,x=u.filterWidth,m=u.dilationDepth,y=u.dilationHeight,w=u.dilationWidth,v=u.effectiveFilterDepth,b=u.effectiveFilterHeight,C=u.effectiveFilterWidth,k=v-1-u.padInfo.front,S=C-1-u.padInfo.left,$=b-1-u.padInfo.top,N=Re(o.shape,"float32"),A=1/(p*g*x),M=n.bufferSync(r);for(let L=0;L<u.batchSize;++L)for(let V=0;V<u.inChannels;++V)for(let B=0;B<u.inDepth;++B)for(let U=0;U<u.inHeight;++U)for(let K=0;K<u.inWidth;++K){const R=B-k,z=U-$,G=K-S;let X=0;for(let q=0;q<v;q+=m){const Q=(R+q)/d;if(!(Q<0||Q>=u.outDepth||Math.floor(Q)!==Q))for(let ee=0;ee<b;ee+=y){const J=(z+ee)/h;if(!(J<0||J>=u.outHeight||Math.floor(J)!==J))for(let ne=0;ne<C;ne+=w){const ie=(G+ne)/f;if(ie<0||ie>=u.outWidth||Math.floor(ie)!==ie)continue;const ce=M.get(L,Q,J,ie,V);X+=ce}}}N.set(X*A,L,B,U,K,V)}return n.makeTensorInfo(N.shape,N.dtype,N.values)}const N8={kernelName:Kx,backendName:"cpu",kernelFunc:$8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T8(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o;he([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=Rs(i.shape,a,l,1,c),d=u.strideHeight,h=u.strideWidth,f=u.filterHeight,p=u.filterWidth,g=u.dilationHeight,x=u.dilationWidth,m=u.effectiveFilterHeight,y=u.effectiveFilterWidth,w=y-1-u.padInfo.left,v=m-1-u.padInfo.top,b=Re(i.shape,"float32"),C=1/(f*p),k=n.data.get(r.dataId).values,S=Re(r.shape,"float32",k);for(let $=0;$<u.batchSize;++$)for(let N=0;N<u.inChannels;++N)for(let A=0;A<u.inHeight;++A)for(let M=0;M<u.inWidth;++M){const L=A-v,V=M-w;let B=0;for(let U=0;U<m;U+=g){const K=(L+U)/d;if(!(K<0||K>=u.outHeight||Math.floor(K)!==K))for(let R=0;R<y;R+=x){const z=(V+R)/h;if(z<0||z>=u.outWidth||Math.floor(z)!==z)continue;const G=S.get($,K,z,N);B+=G}}b.set(B*C,$,A,M,N)}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const E8={kernelName:jx,backendName:"cpu",kernelFunc:T8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,scale:o,offset:i,mean:a,variance:l}=e;I(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),I(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),I(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),he([r,a,l,o,i],"batchNorm");let{varianceEpsilon:c}=s;c==null&&(c=.001);const u=n.data.get(r.dataId).values,d=n.data.get(a.dataId).values,h=n.data.get(l.dataId).values,f=o?n.data.get(o.dataId).values:new Float32Array([1]),p=i?n.data.get(i.dataId).values:new Float32Array([0]),g=new Float32Array(u.length),x=p.length,m=f.length,y=h.length,w=d.length;let v=0,b=0,C=0,k=0;for(let S=0;S<u.length;++S)g[S]=p[v++]+(u[S]-d[b++])*f[C++]/Math.sqrt(h[k++]+c),v>=x&&(v=0),b>=w&&(b=0),C>=m&&(C=0),k>=y&&(k=0);return n.makeTensorInfo(r.shape,r.dtype,g)}const A8={kernelName:Rp,backendName:"cpu",kernelFunc:R8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,crops:i}=s;he([r],"batchToSpaceND");const a=o.reduce((m,y)=>m*y),l=gd(r.shape,o,a),c=xd(l.length,o.length),u=yd(r.shape,o,a),d=$w(i,o.length),h=Nw(u,i,o.length),f=st({inputs:{x:r},backend:n,attrs:{shape:l}}),p=Fn({inputs:{x:f},backend:n,attrs:{perm:c}}),g=st({inputs:{x:p},backend:n,attrs:{shape:u}}),x=Wi({inputs:{x:g},backend:n,attrs:{begin:d,size:h}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),x}const _8={kernelName:wp,backendName:"cpu",kernelFunc:D8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i}=s,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,c=dv(a,l,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,c)}const O8={kernelName:Xx,backendName:"cpu",kernelFunc:F8};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z8(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,o=n.data.get(s.dataId).values,i=n.data.get(r.dataId).values,a=Ie(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const M8={kernelName:t2,backendName:"cpu",kernelFunc:z8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8=Xe(ku,(t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t}),L8={kernelName:ku,backendName:"cpu",kernelFunc:P8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const B8=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(j(e.shape)),r=n.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=n.data.get(o.dataId).values,l=n.data.get(i.dataId).values;for(let c=0;c<a.length;c++){const u=a[c],d=l[c];s[c]=Math.hypot(u,d)}return n.makeOutput(s,e.shape,"float32")},V8={kernelName:vp,backendName:"cpu",kernelFunc:B8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hl(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.data.get(s.dataId).complexTensorInfos.imag,o=n.data.get(r.dataId).values;return n.makeTensorInfo(r.shape,r.dtype,o)}const W8={kernelName:hy,backendName:"cpu",kernelFunc:hl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fl(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,o=Ae(r,e[0].shape)[0],i=e.map(g=>g.shape);kw(i,o);let a=yr(e.map(g=>g.shape),o);if(j(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(g=>j(g.shape)>0);if(l.length===1)return $r({inputs:{x:l[0]},backend:n});if(l[0].dtype==="complex64"){const g=l.map(v=>Vi({inputs:{input:v},backend:n})),x=l.map(v=>hl({inputs:{input:v},backend:n})),m=fl({inputs:g,backend:n,attrs:{axis:o}}),y=fl({inputs:x,backend:n,attrs:{axis:o}}),w=Vn({inputs:{real:m,imag:y},backend:n});return g.forEach(v=>n.disposeIntermediateTensorInfo(v)),x.forEach(v=>n.disposeIntermediateTensorInfo(v)),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),w}const c=l.map(g=>{const m=[-1,j(g.shape.slice(o))];return st({inputs:{x:g},backend:n,attrs:{shape:m}})}),u=c.map(g=>({vals:n.data.get(g.dataId).values,shape:g.shape}));a=yr(c.map(g=>g.shape),1);const d=c[0].shape[0]===1,h=LR(u,a,e[0].dtype,d),f=yr(l.map(g=>g.shape),o),p=n.makeTensorInfo(f,e[0].dtype,h);return c.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const U8={kernelName:bp,backendName:"cpu",kernelFunc:fl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OA(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s;he([r,o],"conv2d");const d=Yr(l),h=nn(r.shape,o.shape,i,c,a,u,!1,d),f=h.filterHeight,p=h.filterWidth,g=h.dilationHeight,x=h.dilationWidth,m=h.padInfo.left,y=h.padInfo.top,w=h.dataFormat==="channelsLast",v=new tn(h.outShape,r.dtype),b=pe(r.shape),C=pe(o.shape),k=b[0],S=w?b[1]:b[2],$=w?b[2]:1,N=w?1:b[1],A=v.strides[0],M=w?v.strides[1]:v.strides[2],L=w?v.strides[2]:1,V=w?1:v.strides[1],B=n.data.get(r.dataId).values,U=n.data.get(o.dataId).values,K=v.values;for(let R=0;R<h.batchSize;++R){const z=R*k,G=R*A;for(let X=0;X<h.outHeight;++X){const q=G+X*M,Q=X*h.strideHeight-y;for(let ee=0;ee<f;++ee){const J=Q+ee*g;if(J<0||J>=h.inHeight)continue;const ne=ee*C[0],ie=z+J*S;for(let ce=0;ce<h.outWidth;++ce){const ue=q+ce*L,xe=ce*h.strideWidth-m;for(let be=0;be<p;++be){const ke=xe+be*x;if(ke<0||ke>=h.inWidth)continue;const He=ne+be*C[1],Te=ie+ke*$;let Me=He;for(let Be=0;Be<h.inChannels;++Be){const qe=B[Te+Be*N];for(let Ge=0;Ge<h.outChannels;++Ge)K[ue+Ge*V]+=qe*U[Me+Ge];Me+=h.outChannels}}}}}}return n.makeTensorInfo(v.shape,v.dtype,K)}const G8={kernelName:Cp,backendName:"cpu",kernelFunc:OA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s;he([r,o],"conv2dBackpropFilter");const d=Yr(l),h=nn(r.shape,u,i,1,a,c,!1,d),{strideHeight:f,strideWidth:p,filterHeight:g,filterWidth:x}=h,m=h.dataFormat==="channelsLast",y=new tn(h.filterShape,"float32"),w=h.padInfo.left,v=h.padInfo.top,b=n.data.get(r.dataId).values,C=n.data.get(o.dataId).values,k=new tn(r.shape,r.dtype,b),S=new tn(o.shape,o.dtype,C);for(let $=0;$<g;++$){const N=Math.max(0,Math.ceil((v-$)/f)),A=Math.min(h.outHeight,(h.inHeight+v-$)/f);for(let M=0;M<x;++M){const L=Math.max(0,Math.ceil((w-M)/p)),V=Math.min(h.outWidth,(h.inWidth+w-M)/p);for(let B=0;B<h.inChannels;++B)for(let U=0;U<h.outChannels;++U){let K=0;for(let R=0;R<h.batchSize;++R)for(let z=N;z<A;++z){const G=$+z*f-v;for(let X=L;X<V;++X){const q=M+X*p-w;m?K+=k.get(R,G,q,B)*S.get(R,z,X,U):K+=k.get(R,B,G,q)*S.get(R,U,z,X)}}y.set(K,$,M,B,U)}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const j8={kernelName:Qx,backendName:"cpu",kernelFunc:H8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K8(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s;he([r,o],"conv2dBackpropInput");const d=pe(o.shape),h=pe(r.shape);let f=Yr(c);const p=nn(i,o.shape,a,1,l,u,!1,f),g=new tn(p.inShape,"float32"),x=g.values,m=n.data.get(r.dataId).values,y=n.data.get(o.dataId).values,[w,v,b]=d,{batchSize:C,filterHeight:k,filterWidth:S,inChannels:$,inHeight:N,inWidth:A,outChannels:M,outHeight:L,outWidth:V,strideHeight:B,strideWidth:U}=p;f=p.dataFormat;const K=k-1-p.padInfo.top,R=S-1-p.padInfo.left,z=f==="channelsLast",G=g.strides[0],X=z?g.strides[1]:g.strides[2],q=z?g.strides[2]:1,Q=z?1:g.strides[1],ee=h[0],J=z?h[1]:h[2],ne=z?h[2]:1,ie=z?1:h[1];for(let ce=0;ce<C;++ce)for(let ue=0;ue<$;++ue)for(let xe=0;xe<N;++xe){const be=xe-K,ke=Math.max(0,Math.ceil(be/B)),He=Math.min(L,(k+be)/B);for(let Te=0;Te<A;++Te){const Me=Te-R,Be=Math.max(0,Math.ceil(Me/U)),qe=Math.min(V,(S+Me)/U);let Ge=0;for(let _t=ke;_t<He;++_t){const _s=_t*B-be;for(let Ut=Be;Ut<qe;++Ut){const Jo=Ut*U-Me,Fs=ee*ce+J*_t+ne*Ut,Tr=w*(k-1-_s)+v*(S-1-Jo)+b*ue;for(let Jr=0;Jr<M;++Jr){const Zr=m[Fs+ie*Jr],eo=y[Tr+Jr];Ge+=Zr*eo}}}const Pn=G*ce+X*xe+q*Te+Q*ue;x[Pn]=Ge}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const X8={kernelName:kp,backendName:"cpu",kernelFunc:K8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s;he([r,o],"conv3d");const c=Go(r.shape,o.shape,i,l,a),{filterDepth:u,filterHeight:d,filterWidth:h,dilationDepth:f,dilationHeight:p,dilationWidth:g,padInfo:x}=c,m=x.front,y=x.left,w=x.top,v=new tn(c.outShape,r.dtype),b=n.data.get(r.dataId).values,C=n.data.get(o.dataId).values,k=v.values,S=pe(r.shape),$=pe(o.shape);for(let N=0;N<c.batchSize;++N){const A=N*S[0],M=N*v.strides[0];for(let L=0;L<c.outDepth;++L){const V=M+L*v.strides[1],B=L*c.strideDepth-m;for(let U=0;U<u;++U){const K=B+U*f;if(K<0||K>=c.inDepth)continue;const R=U*$[0],z=A+K*S[1];for(let G=0;G<c.outHeight;++G){const X=V+G*v.strides[2],q=G*c.strideHeight-w;for(let Q=0;Q<d;++Q){const ee=q+Q*p;if(ee<0||ee>=c.inHeight)continue;const J=R+Q*$[1],ne=z+ee*S[2];for(let ie=0;ie<c.outWidth;++ie){const ce=X+ie*c.outChannels,ue=ie*c.strideWidth-y;for(let xe=0;xe<h;++xe){const be=ue+xe*g;if(be<0||be>=c.inWidth)continue;const ke=J+xe*$[2],He=ne+be*c.inChannels;let Te=ke;for(let Me=0;Me<c.inChannels;++Me){const Be=b[He+Me];for(let qe=0;qe<c.outChannels;++qe)k[ce+qe]+=Be*C[Te+qe];Te+=c.outChannels}}}}}}}}return n.makeTensorInfo(v.shape,v.dtype,v.values)}const Y8={kernelName:Sp,backendName:"cpu",kernelFunc:q8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q8(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s;he([r,o],"conv3dBackpropFilterV2");const c=pe(r.shape),u=pe(o.shape),d=Go(r.shape,l,i,1,a),h=d.strideDepth,f=d.strideHeight,p=d.strideWidth,g=d.filterDepth,x=d.filterHeight,m=d.filterWidth,y=new tn(d.filterShape,"float32"),w=y.values,[v,b,C,k]=y.strides,S=n.data.get(o.dataId).values,[$,N,A,M]=u,L=n.data.get(r.dataId).values,[V,B,U,K]=c,R=d.padInfo.front,z=d.padInfo.left,G=d.padInfo.top;for(let X=0;X<g;++X){const q=Math.max(0,Math.ceil((R-X)/h)),Q=Math.min(d.outDepth,(d.inDepth+R-X)/h),ee=X*v;for(let J=0;J<x;++J){const ne=Math.max(0,Math.ceil((G-J)/f)),ie=Math.min(d.outHeight,(d.inHeight+G-J)/f),ce=J*b+ee;for(let ue=0;ue<m;++ue){const xe=Math.max(0,Math.ceil((z-ue)/p)),be=Math.min(d.outWidth,(d.inWidth+z-ue)/p),ke=ue*C+ce;for(let He=0;He<d.inChannels;++He){const Te=He*k+ke;for(let Me=0;Me<d.outChannels;++Me){let Be=0;for(let qe=0;qe<d.batchSize;++qe){const Ge=qe*V,Pn=qe*$;for(let _t=q;_t<Q;++_t){const Ut=(X+_t*h-R)*B+Ge,Jo=_t*N+Pn;for(let Fs=ne;Fs<ie;++Fs){const Jr=(J+Fs*f-G)*U+Ut,Zr=Fs*A+Jo;for(let eo=xe;eo<be;++eo){const Vm=(ue+eo*p-z)*K+Jr,Wm=eo*M+Zr;Be+=L[Vm+He]*S[Wm+Me]}}}}w[Te+Me]=Be}}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const J8={kernelName:Jx,backendName:"cpu",kernelFunc:Q8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z8(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s;he([r],"conv3dBackpropInputV2");const c=pe(r.shape),u=pe(o.shape),d=Go(l,o.shape,a,1,i),h=new tn(d.inShape,"float32"),f=h.values,[p,g,x,m]=h.strides,y=n.data.get(r.dataId).values,[w,v,b,C]=c,k=n.data.get(o.dataId).values,[S,$,N,A]=u,{batchSize:M,filterDepth:L,filterHeight:V,filterWidth:B,inChannels:U,inDepth:K,inHeight:R,inWidth:z,outChannels:G,outDepth:X,outHeight:q,outWidth:Q,strideDepth:ee,strideHeight:J,strideWidth:ne}=d,ie=L-1-d.padInfo.front,ce=V-1-d.padInfo.top,ue=B-1-d.padInfo.left;for(let xe=0;xe<M;++xe)for(let be=0;be<U;++be)for(let ke=0;ke<K;++ke){const He=ke-ie,Te=Math.max(0,Math.ceil(He/ee)),Me=Math.min(X,(L+He)/ee);for(let Be=0;Be<R;++Be){const qe=Be-ce,Ge=Math.max(0,Math.ceil(qe/J)),Pn=Math.min(q,(V+qe)/J);for(let _t=0;_t<z;++_t){const _s=_t-ue,Ut=Math.max(0,Math.ceil(_s/ne)),Jo=Math.min(Q,(B+_s)/ne);let Fs=0;for(let Tr=Te;Tr<Me;++Tr){const Jr=Tr*ee-He;for(let Zr=Ge;Zr<Pn;++Zr){const eo=Zr*J-qe;for(let Ml=Ut;Ml<Jo;++Ml){const Vm=Ml*ne-_s,Wm=w*xe+v*Tr+b*Zr+C*Ml,jD=S*(L-1-Jr)+$*(V-1-eo)+N*(B-1-Vm)+A*be;for(let _d=0;_d<G;++_d){const KD=y[Wm+_d],XD=k[jD+_d];Fs+=KD*XD}}}}f[p*xe+g*ke+x*Be+m*_t+be]=Fs}}}return n.makeTensorInfo(h.shape,h.dtype,h.values)}const eK={kernelName:Zx,backendName:"cpu",kernelFunc:Z8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tK=Xe(Su,t=>Math.cos(t)),nK={kernelName:Su,backendName:"cpu",kernelFunc:tK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sK=Xe(Iu,t=>Math.cosh(t)),rK={kernelName:Iu,backendName:"cpu",kernelFunc:sK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oK(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:c}=s,[u,d,h,f]=r.shape,p=o.shape[0],[g,x]=a,m=Re([p,g,x,f],"float32"),y=n.data.get(o.dataId).values,w=n.data.get(i.dataId).values,v=n.data.get(r.dataId).values,b=pe(r.shape),C=pe(m.shape);for(let k=0;k<p;k++){const S=k*4,$=y[S],N=y[S+1],A=y[S+2],M=y[S+3],L=w[k];if(L>=u)continue;const V=g>1?(A-$)*(d-1)/(g-1):0,B=x>1?(M-N)*(h-1)/(x-1):0;for(let U=0;U<g;U++){const K=g>1?$*(d-1)+U*V:.5*($+A)*(d-1);if(K<0||K>d-1){for(let R=0;R<x;R++)for(let z=0;z<f;z++){const G=z+R*C[2]+U*C[1]+k*C[0];m.values[G]=c}continue}if(l==="bilinear"){const R=Math.floor(K),z=Math.ceil(K),G=K-R;for(let X=0;X<x;X++){const q=x>1?N*(h-1)+X*B:.5*(N+M)*(h-1);if(q<0||q>h-1){for(let ne=0;ne<f;ne++){const ie=ne+X*C[2]+U*C[1]+k*C[0];m.values[ie]=c}continue}const Q=Math.floor(q),ee=Math.ceil(q),J=q-Q;for(let ne=0;ne<f;ne++){let ie=ne+Q*b[2]+R*b[1]+L*b[0];const ce=v[ie];ie=ne+ee*b[2]+R*b[1]+L*b[0];const ue=v[ie];ie=ne+Q*b[2]+z*b[1]+L*b[0];const xe=v[ie];ie=ne+ee*b[2]+z*b[1]+L*b[0];const be=v[ie],ke=ce+(ue-ce)*J,He=xe+(be-xe)*J;ie=ne+X*C[2]+U*C[1]+k*C[0],m.values[ie]=ke+(He-ke)*G}}}else for(let R=0;R<x;++R){const z=x>1?N*(h-1)+R*B:.5*(N+M)*(h-1);if(z<0||z>h-1){for(let q=0;q<f;q++){const Q=q+R*C[2]+U*C[1]+k*C[0];m.values[Q]=c}continue}const G=Math.round(z),X=Math.round(K);for(let q=0;q<f;q++){const Q=q+G*b[2]+X*b[1]+L*b[0],ee=q+R*C[2]+U*C[1]+k*C[0];m.values[ee]=v[Q]}}}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const iK={kernelName:ty,backendName:"cpu",kernelFunc:oK};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;he(r,"cumprod");const l=yt([o],r.shape.length);let c=r;l!=null&&(c=Fn({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=$t(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Xn(c.dtype,"int32"),h=Bx(j(c.shape),d),f=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],g=a?(m,y)=>m+p-y-1:(m,y)=>m+y;for(let m=0;m<f.length;m+=p)for(let y=0;y<p;y++){const w=g(m,y);if(y===0)h[w]=i?1:f[w];else{const v=g(m,y-1);h[w]=i?f[v]*h[v]:f[w]*h[v]}}const x=n.makeTensorInfo(c.shape,d,h);if(l!=null){const m=Ho(l),y=Fn({inputs:{x},backend:n,attrs:{perm:m}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),y}return x}const lK={kernelName:ey,backendName:"cpu",kernelFunc:aK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;he(r,"cumsum");const l=yt([o],r.shape.length);let c=r;l!=null&&(c=Fn({inputs:{x:r},backend:n,attrs:{perm:l}}));const u=$t(1,r.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);const d=Xn(c.dtype,"int32"),h=un(j(c.shape),d),f=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],g=a?(m,y)=>m+p-y-1:(m,y)=>m+y;for(let m=0;m<f.length;m+=p)for(let y=0;y<p;y++){const w=g(m,y);if(y===0)h[w]=i?0:f[w];else{const v=g(m,y-1);h[w]=i?f[v]+h[v]:f[w]+h[v]}}const x=n.makeTensorInfo(c.shape,d,h);if(l!=null){const m=Ho(l),y=Fn({inputs:{x},backend:n,attrs:{perm:m}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),y}return x}const uK={kernelName:Ip,backendName:"cpu",kernelFunc:cK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,u=dv(l,c,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,u)}else if(r.shape.length===2){const l=n.bufferSync(r),c=n.bufferSync(o),u=zR(l,c,i,a);return n.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const hK={kernelName:ny,backendName:"cpu",kernelFunc:dK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:o,dataFormat:i}=s;I(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],l=r.shape[1],c=r.shape[2],u=r.shape[3],d=l*o,h=c*o,f=u/(o*o),p=n.data.get(r.dataId).values,g=new Float32Array(a*d*h*f);let x=0;for(let m=0;m<a;++m)for(let y=0;y<d;++y){const w=Math.floor(y/o),v=y%o;for(let b=0;b<h;++b){const C=Math.floor(b/o),k=b%o,S=(v*o+k)*f;for(let $=0;$<f;++$){const A=$+S+u*(C+c*(w+l*m));g[x++]=p[A]}}}return n.makeTensorInfo([a,d,h,f],r.dtype,g)}const pK={kernelName:sy,backendName:"cpu",kernelFunc:fK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zA(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:c}=s;he([r,o],"depthwiseConv2DNative");const u=pe(r.shape),d=pe(o.shape);let h=l;h==null&&(h=[1,1]),I(hn(i,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${h}'`);const f=nn(r.shape,o.shape,i,h,a,c,!0),{filterHeight:p,filterWidth:g,dilationHeight:x,dilationWidth:m,padInfo:y}=f,w=y.left,v=y.top,b=f.outChannels/f.inChannels,C=new tn(f.outShape,r.dtype),k=n.data.get(r.dataId).values,S=n.data.get(o.dataId).values,$=C.values;for(let N=0;N<f.batchSize;++N){const A=N*u[0],M=N*C.strides[0];for(let L=0;L<f.outHeight;++L){const V=M+L*C.strides[1],B=L*f.strideHeight-v;for(let U=0;U<p;++U){const K=B+U*x;if(K<0||K>=f.inHeight)continue;const R=U*d[0],z=A+K*u[1];for(let G=0;G<f.outWidth;++G){const X=V+G*C.strides[2],q=G*f.strideWidth-w;for(let Q=0;Q<g;++Q){const ee=q+Q*m;if(ee<0||ee>=f.inWidth)continue;const J=R+Q*d[1],ne=z+ee*f.inChannels;let ie=X,ce=J;for(let ue=0;ue<f.inChannels;++ue){const xe=k[ne+ue];for(let be=0;be<b;++be)$[ie+be]+=xe*S[ce+be];ie+=b,ce+=b}}}}}}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const mK={kernelName:$p,backendName:"cpu",kernelFunc:zA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s;he([r,o],"depthwiseConv2dNativeBackpropFilter");const d=nn(r.shape,u,i,a,l,c,!0),{strideHeight:h,strideWidth:f,filterHeight:p,filterWidth:g}=d,x=new tn(d.filterShape,"float32"),m=d.padInfo.left,y=d.padInfo.top,w=d.outChannels/d.inChannels,v=n.data.get(r.dataId).values,b=new tn(r.shape,r.dtype,v),C=n.data.get(o.dataId).values,k=new tn(o.shape,o.dtype,C);for(let S=0;S<p;++S){const $=Math.max(0,Math.ceil((y-S)/h)),N=Math.min(d.outHeight,(d.inHeight+y-S)/h);for(let A=0;A<g;++A){const M=Math.max(0,Math.ceil((m-A)/f)),L=Math.min(d.outWidth,(d.inWidth+m-A)/f);for(let V=0;V<d.outChannels;++V){const B=Math.trunc(V/w),U=V%w;let K=0;for(let R=0;R<d.batchSize;++R)for(let z=$;z<N;++z){const G=S+z*h-y;for(let X=M;X<L;++X){const q=A+X*f-m;K+=b.get(R,G,q,B)*k.get(R,z,X,V)}}x.set(K,S,A,B,U)}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const xK={kernelName:ry,backendName:"cpu",kernelFunc:gK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yK(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s;he([r,o],"depthwiseConv2DNativeBackpropInput");const d=pe(r.shape),h=pe(o.shape),f=nn(u,o.shape,i,a,l,c,!0),p=new tn(f.inShape,"float32"),g=p.values,[x,m,y]=p.strides,w=n.data.get(r.dataId).values,[v,b,C]=d,k=n.data.get(o.dataId).values,[S,$,N]=h,{batchSize:A,filterHeight:M,filterWidth:L,inChannels:V,inHeight:B,inWidth:U,outChannels:K,outHeight:R,outWidth:z,strideHeight:G,strideWidth:X}=f,q=M-1-f.padInfo.top,Q=L-1-f.padInfo.left,ee=K/V;for(let J=0;J<A;++J)for(let ne=0;ne<V;++ne)for(let ie=0;ie<B;++ie){const ce=ie-q,ue=Math.max(0,Math.ceil(ce/G)),xe=Math.min(R,(M+ce)/G);for(let be=0;be<U;++be){const ke=be-Q,He=Math.max(0,Math.ceil(ke/X)),Te=Math.min(z,(L+ke)/X);let Me=0;for(let Be=ue;Be<xe;++Be){const qe=Be*G-ce;for(let Ge=He;Ge<Te;++Ge){const Pn=Ge*X-ke,_t=v*J+b*Be+C*Ge,_s=S*(M-1-qe)+$*(L-1-Pn)+N*ne;for(let Ut=0;Ut<ee;++Ut){const Jo=ne*ee+Ut,Fs=w[_t+Jo],Tr=k[_s+Ut];Me+=Fs*Tr}}}g[x*J+m*ie+y*be+ne]=Me}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const wK={kernelName:oy,backendName:"cpu",kernelFunc:yK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vK(t){const{inputs:e,backend:n}=t,{x:s}=e,r=j(s.shape),o=n.data.get(s.dataId).values,i=Re([r,r],s.dtype),a=i.values;for(let c=0;c<o.length;c++)a[c*r+c]=o[c];const l=[...s.shape,...s.shape];return n.makeTensorInfo(l,i.dtype,i.values)}const bK={kernelName:n2,backendName:"cpu",kernelFunc:vK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CK={kernelName:Np,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r}=t,{strides:o,pad:i,dilations:a}=n,l=e,c=l.data.get(s.dataId).values,u=s.shape.length,d=l.data.get(r.dataId).values,h=r.shape.length,{batchSize:f,inHeight:p,inWidth:g,inChannels:x,outHeight:m,outWidth:y,padInfo:w,strideHeight:v,strideWidth:b,filterHeight:C,filterWidth:k,dilationHeight:S,dilationWidth:$,outShape:N}=dd(s.shape,r.shape,o,i,"NHWC",a),A=j(N),M=N.length,L=kt(s.dtype,A);for(let B=0;B<f;++B)for(let U=0;U<m;++U){const K=U*v-w.top;for(let R=0;R<y;++R){const z=R*b-w.left;for(let G=0;G<x;++G){let X=Number.MIN_SAFE_INTEGER;for(let Q=0;Q<C;++Q){const ee=K+Q*S;if(ee>=0&&ee<p)for(let J=0;J<k;++J){const ne=z+J*$;if(ne>=0&&ne<g){const ie=gr([B,ee,ne,G],u,pe(s.shape)),ce=gr([Q,J,G],h,pe(r.shape)),ue=c[ie]+d[ce];ue>X&&(X=ue)}}}const q=gr([B,U,R,G],M,pe(N));L[q]=X}}}return{dataId:l.write(Xi(L,s.dtype),N,s.dtype),shape:N,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kK={kernelName:J0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:o}=t,{strides:i,pad:a,dilations:l}=n,c=e,u=Xs(s.shape,c.data.get(s.dataId).values),d=Xs(r.shape,c.data.get(r.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:g,outHeight:x,outWidth:m,padInfo:y,strideHeight:w,strideWidth:v,filterHeight:b,filterWidth:C,dilationHeight:k,dilationWidth:S,outShape:$}=dd(s.shape,r.shape,i,a,"NHWC",l);I(o.rank===$.length,()=>`Error in ${J0}, dy must have the same rank as output ${$.length}, but got ${o.rank}`);const N=Xs($,c.data.get(o.dataId).values),A=J$(r.shape,r.dtype);for(let L=0;L<h;++L)for(let V=0;V<x;++V){const B=V*w-y.top;for(let U=0;U<m;++U){const K=U*v-y.left;for(let R=0;R<g;++R){let z=Number.MIN_SAFE_INTEGER,G=0,X=0;for(let q=0;q<b;++q){const Q=B+q*k;if(Q>=0&&Q<f)for(let ee=0;ee<C;++ee){const J=K+ee*S;if(J>=0&&J<p){const ne=u[L][Q][J][R]+d[q][ee][R];ne>z&&(z=ne,G=q,X=ee)}}}A[G][X][R]+=N[L][V][U][R]}}}return{dataId:c.write(Xi(A,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SK={kernelName:Q0,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:r,dy:o}=t,{strides:i,pad:a,dilations:l}=n,c=e,u=Xs(s.shape,c.data.get(s.dataId).values),d=Xs(r.shape,c.data.get(r.dataId).values),{batchSize:h,inHeight:f,inWidth:p,inChannels:g,outHeight:x,outWidth:m,padInfo:y,strideHeight:w,strideWidth:v,filterHeight:b,filterWidth:C,dilationHeight:k,dilationWidth:S,outShape:$}=dd(s.shape,r.shape,i,a,"NHWC",l);I(o.rank===$.length,()=>`Error in ${Q0}, dy must have the same rank as output ${$.length}, but got ${o.rank}`);const N=Xs($,c.data.get(o.dataId).values),A=J$(s.shape,s.dtype);for(let L=0;L<h;++L)for(let V=0;V<x;++V){const B=V*w-y.top;for(let U=0;U<m;++U){const K=U*v-y.left;for(let R=0;R<g;++R){let z=Number.MIN_SAFE_INTEGER,G=B<0?0:B,X=K<0?0:K;for(let q=0;q<b;++q){const Q=B+q*k;if(Q>=0&&Q<f)for(let ee=0;ee<C;++ee){const J=K+ee*S;if(J>=0&&J<p){const ne=u[L][Q][J][R]+d[q][ee][R];ne>z&&(z=ne,G=Q,X=J)}}}A[L][G][X][R]+=N[L][V][U][R]}}}return{dataId:c.write(Xi(A,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IK(t){const{inputs:e,backend:n,attrs:s}=t,{image:r}=e,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:l}=i||{},c=(l==null?void 0:l.alpha)||1,u=(a==null?void 0:a.contextType)||"2d";if(u!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const d=o.getContext(u,(a==null?void 0:a.contextAttributes)||{});if(d==null)throw new Error(`Could not get the context with ${u} type.`);const[h,f]=r.shape.slice(0,2),p=r.shape.length===2?1:r.shape[2],g=n.data.get(r.dataId).values,x=r.dtype==="float32"?255:1,m=new Uint8ClampedArray(f*h*4);for(let w=0;w<h*f;++w){const v=[0,0,0,255*c];for(let C=0;C<p;C++){const k=g[w*p+C];if(r.dtype==="float32"){if(k<0||k>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${k}.`)}else if(r.dtype==="int32"&&(k<0||k>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${k}.`);p===1?(v[0]=k*x,v[1]=k*x,v[2]=k*x):v[C]=k*x}const b=w*4;m[b+0]=Math.round(v[0]),m[b+1]=Math.round(v[1]),m[b+2]=Math.round(v[2]),m[b+3]=Math.round(v[3])}o.width=f,o.height=h;const y=new ImageData(m,f,h);return d.putImageData(y,0,0),r}const $K={kernelName:BM,backendName:"cpu",kernelFunc:IK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nd(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;he(r,"sum");let a;r.dtype==="bool"?a=Mo({inputs:{x:r},backend:n,attrs:{dtype:"int32"}}):a=$r({inputs:{x:r},backend:n});const l=a.shape.length,c=Ae(o,a.shape),u=yt(c,l);let d=c,h=a;u!=null&&(h=Fn({inputs:{x:a},backend:n,attrs:{perm:u}}),d=$t(d.length,l)),sn("sum",d,h.shape.length);const[f,p]=Yt(h.shape,d),g=Xn(h.dtype,"int32");let x=_f(n,f,g);const m=j(p),y=n.data.get(x.dataId).values,w=n.data.get(h.dataId).values;for(let v=0;v<y.length;++v){const b=v*m;let C=0;for(let k=0;k<m;++k)C+=w[b+k];y[v]=C}if(i){const v=Dt(x.shape,c),b=x;x=st({inputs:{x},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(b)}return n.disposeIntermediateTensorInfo(a),u!=null&&n.disposeIntermediateTensorInfo(h),x}const NK={kernelName:im,backendName:"cpu",kernelFunc:Nd};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TK(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=Ow(r,o.length);Mw(i.length,l,o);const{path:c,steps:u}=Pw(a,l),d=u.length;let h=null,f=i.length;const p=[];for(let g=0;g<d;++g){for(const x of u[g]){const{permutationIndices:m,expandDims:y}=zw(f,l[x]);let w;Lw(m)?w=o[x]:(w=Fn({inputs:{x:o[x]},backend:n,attrs:{perm:m}}),p.push(w));const v=w.shape.slice();for(let b=0;b<y.length;++b)v.splice(y[b],0,1);Ue(w.shape,v)||(w=st({inputs:{x:w},backend:n,attrs:{shape:v}}),p.push(w)),h===null?h=w:(h=Om({inputs:{a:w,b:h},backend:n}),p.push(h))}g<d-1&&(c[g]>=0&&(h=Nd({inputs:{x:h},backend:n,attrs:{axis:c[g]-(i.length-f),keepDims:!1}}),p.push(h)),f--)}for(const g of p)g!==h&&n.disposeIntermediateTensorInfo(g);return h}const EK={kernelName:iy,backendName:"cpu",kernelFunc:TK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(t){const{inputs:e,backend:n}=t,{dy:s,y:r}=e;he([s,r],"eluGrad");const o=new Float32Array(j(r.shape)),i=n.data.get(r.dataId).values,a=n.data.get(s.dataId).values;for(let l=0;l<i.length;++l){const c=i[l];c>=0?o[l]=a[l]:o[l]=a[l]*(c+1)}return n.makeTensorInfo(r.shape,"float32",o)}const AK={kernelName:ay,backendName:"cpu",kernelFunc:RK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DK=Tw,_K=Ew,FK=Rw,OK=Aw,zK=Dw,MK=_w,PK=Xe(Tu,t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+DK*n);return e*(1-((((MK*s+zK)*s+OK)*s+FK)*s+_K)*s*Math.exp(-n*n))}),LK={kernelName:Tu,backendName:"cpu",kernelFunc:PK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zf(t){const{inputs:e,backend:n,attrs:s}=t,{input:r}=e,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let l=o;return o<0&&(I(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),st({inputs:{x:r},backend:n,attrs:{shape:a}})}const BK={kernelName:Ep,backendName:"cpu",kernelFunc:zf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VK=Tt((t,e)=>t/e),xv=Wt($u,VK),S1={kernelName:$u,backendName:"cpu",kernelFunc:xv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MA(t,e,n){const s=t.shape,r=s[0],o=s[1],i=n.data.get(t.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,c=[r,o],u=j(c),d=cn("float32",u),h=cn("float32",u);for(let x=0;x<r;x++){const m=Wi({inputs:{x:a},backend:n,attrs:{begin:[x,0],size:[1,o]}}),y=Wi({inputs:{x:l},backend:n,attrs:{begin:[x,0],size:[1,o]}}),w=Vn({inputs:{real:m,imag:y},backend:n}),{real:v,imag:b}=WK(w,e,n),C=Hr(v,b);for(let k=0;k<o;k++){const S=Fw(C,k);d[x*o+k]=S.real,h[x*o+k]=S.imag}n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(w)}const f=n.makeTensorInfo(c,"float32",d),p=n.makeTensorInfo(c,"float32",h),g=Vn({inputs:{real:f,imag:p},backend:n});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),g}function WK(t,e,n){const s=j(t.shape),r=n.data.get(t.dataId),o=n.data.get(r.complexTensorInfos.real.dataId).values,i=n.data.get(r.complexTensorInfos.imag.dataId).values;if(UK(s)){const a=I1(o,i,s,e,n),l=[t.shape[0],t.shape[1]];if(e){const c=n.makeTensorInfo(l,"float32",a.real),u=n.makeTensorInfo(l,"float32",a.imag),d=n.makeTensorInfo([],"float32",Wo(s,"float32")),h=$r({inputs:{x:d},backend:n}),f=S1.kernelFunc({inputs:{a:c,b:d},backend:n}),p=S1.kernelFunc({inputs:{a:u,b:h},backend:n}),g=n.data.get(f.dataId).values,x=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),{real:g,imag:x}}return a}else{const a=Hr(o,i),l=GK(a,s,e);return YN(l)}}function UK(t){return(t&t-1)===0}function I1(t,e,n,s,r){if(n===1)return{real:t,imag:e};const o=Hr(t,e),i=n/2,a=QN(o),l=a.real,c=a.imag,u=[l.length],d=r.makeTensorInfo(u,"float32",l),h=r.makeTensorInfo(u,"float32",c),f=Vn({inputs:{real:d,imag:h},backend:r}),p=JN(o),g=p.real,x=p.imag,m=[g.length],y=r.makeTensorInfo(m,"float32",g),w=r.makeTensorInfo(m,"float32",x),v=Vn({inputs:{real:y,imag:w},backend:r}),b=I1(l,c,i,s,r),C=b.real,k=b.imag,S=[C.length],$=r.makeTensorInfo(S,"float32",C),N=r.makeTensorInfo(S,"float32",k),A=Vn({inputs:{real:$,imag:N},backend:r}),M=I1(g,x,i,s,r),L=M.real,V=M.imag,B=[L.length],U=r.makeTensorInfo(B,"float32",L),K=r.makeTensorInfo(B,"float32",V),R=Vn({inputs:{real:U,imag:K},backend:r}),z=eT(n,s),G=[z.real.length],X=r.makeTensorInfo(G,"float32",z.real),q=r.makeTensorInfo(G,"float32",z.imag),Q=Vn({inputs:{real:X,imag:q},backend:r}),ee=Om({inputs:{a:Q,b:R},backend:r}),J=dl({inputs:{a:A,b:ee},backend:r}),ne=mv({inputs:{a:A,b:ee},backend:r}),ie=Vi({inputs:{input:J},backend:r}),ce=Vi({inputs:{input:ne},backend:r}),ue=hl({inputs:{input:J},backend:r}),xe=hl({inputs:{input:ne},backend:r}),be=fl({inputs:[ie,ce],backend:r,attrs:{axis:0}}),ke=fl({inputs:[ue,xe],backend:r,attrs:{axis:0}}),He=r.data.get(be.dataId).values,Te=r.data.get(ke.dataId).values;return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(w),r.disposeIntermediateTensorInfo(v),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(A),r.disposeIntermediateTensorInfo(U),r.disposeIntermediateTensorInfo(K),r.disposeIntermediateTensorInfo(R),r.disposeIntermediateTensorInfo(X),r.disposeIntermediateTensorInfo(q),r.disposeIntermediateTensorInfo(Q),r.disposeIntermediateTensorInfo(ee),r.disposeIntermediateTensorInfo(J),r.disposeIntermediateTensorInfo(ne),r.disposeIntermediateTensorInfo(ie),r.disposeIntermediateTensorInfo(ue),r.disposeIntermediateTensorInfo(ce),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo(be),r.disposeIntermediateTensorInfo(ke),{real:He,imag:Te}}function GK(t,e,n){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let a=0;a<e;a++){const l=tT(r*a,e,n),c=Fw(t,a);o+=c.real*l.real-c.imag*l.imag,i+=c.real*l.imag+c.imag*l.real}n&&(o/=e,i/=e),ZN(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HK(t){const{inputs:e,backend:n}=t,{input:s}=e,r=j(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=st({inputs:{x:s},backend:n,attrs:{shape:[i,o]}}),l=MA(a,!1,n),c=st({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const jK={kernelName:ly,backendName:"cpu",kernelFunc:HK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yv(t){const{backend:e,attrs:n}=t,{shape:s,value:r,dtype:o}=n,i=o||bl(r),a=kt(i,j(s));return XK(a,r,i),e.makeTensorInfo(s,i,a)}const KK={kernelName:cy,backendName:"cpu",kernelFunc:yv};function XK(t,e,n){t.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qK={kernelName:uy,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,r=n,o=cn(s.dtype,j(s.shape)),[i,a,l,c]=s.shape,u=r.data.get(s.dataId).values;for(let h=0;h<i;h++){const f=h*l*a*c;for(let p=0;p<a;p++){const g=p*(l*c);for(let x=0;x<l;x++){const m=x*c;for(let y=0;y<c;y++){const w=Math.round(l-x-1),v=f+g+m+y;let b=u[v];if(w>=0&&w<l){const C=w*c,k=f+g+C+y;b=u[k]}o[v]=b}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s;let g=OA({inputs:{x:r,filter:o},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(i){const x=g;if(u==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const m=st({inputs:{x:i},backend:n,attrs:{shape:[i.shape[0],1,1]}});g=dl({inputs:{a:g,b:m},backend:n}),n.disposeIntermediateTensorInfo(m)}else g=dl({inputs:{a:g,b:i},backend:n});n.disposeIntermediateTensorInfo(x)}if(f){const x=g;if(u==="NCHW"&&f==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const m=st({inputs:{x:a},backend:n,attrs:{shape:[a.shape[0],1,1]}});g=Of(n,g,f,m,p),n.disposeIntermediateTensorInfo(m)}else g=Of(n,g,f,a,p);n.disposeIntermediateTensorInfo(x)}return g}const QK={kernelName:ff,backendName:"cpu",kernelFunc:YK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s;let g=zA({inputs:{x:r,filter:o},backend:n,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h}});if(i){const x=g;g=dl({inputs:{a:g,b:i},backend:n}),n.disposeIntermediateTensorInfo(x)}if(f){const x=g;g=Of(n,g,f,a,p),n.disposeIntermediateTensorInfo(x)}return g}const ZK={kernelName:b2,backendName:"cpu",kernelFunc:JK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eX(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,o=j(s.shape),i=r.shape,a=i[i.length-1],[l,c,u,d]=xw(s,r);if(c===0)return n.makeTensorInfo(l,s.dtype,[]);const h=n.data.get(r.dataId).values,f=n.bufferSync(s),p=KR(h,f,s.dtype,c,a,u,d,s.shape,o);return n.makeTensorInfo(l,s.dtype,p.values)}const tX={kernelName:s2,backendName:"cpu",kernelFunc:eX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:o}=e,{axis:i,batchDims:a}=s;he([r,o],"gatherV2");const l=Ae(i,r.shape)[0],c=n.data.get(o.dataId).values,u=r.shape[l];for(let v=0;v<c.length;++v){const b=c[v];I(b<=u-1&&b>=0,()=>`GatherV2: the index value ${b} is not in [0, ${u-1}]`)}let d=a;a==null&&(d=0);const h=j(o.shape),f=Vw(r,o,l,d),p=st({inputs:{x:r},backend:n,attrs:{shape:[f.batchSize,f.outerSize,f.dimSize,f.sliceSize]}}),g=st({inputs:{x:o},backend:n,attrs:{shape:[f.batchSize,h/f.batchSize]}}),x=[f.batchSize,f.outerSize,h/f.batchSize,f.sliceSize],m=n.bufferSync(g),y=n.bufferSync(p),w=XR(y,m,x);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(f.outputShape,w.dtype,w.values)}const sX={kernelName:Ap,backendName:"cpu",kernelFunc:nX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rX(t){const{inputs:e,backend:n}=t,{input:s}=e,r=j(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=st({inputs:{x:s},backend:n,attrs:{shape:[i,o]}}),l=MA(a,!0,n),c=st({inputs:{x:l},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),c}const oX={kernelName:dy,backendName:"cpu",kernelFunc:rX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iX=Xe(Ou,t=>Number.isFinite(t)?1:0,"bool"),aX={kernelName:Ou,backendName:"cpu",kernelFunc:iX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lX=Xe(zu,t=>Math.abs(t)===1/0?1:0,"bool"),cX={kernelName:zu,backendName:"cpu",kernelFunc:lX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uX=Xe(Mu,t=>Number.isNaN(t)?1:0,"bool"),dX={kernelName:Mu,backendName:"cpu",kernelFunc:uX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hX(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:o}=n,i=ZR(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const fX={kernelName:r2,backendName:"cpu",kernelFunc:hX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pX=Xe(Lu,t=>Math.log1p(t)),mX={kernelName:Lu,backendName:"cpu",kernelFunc:pX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gX=Tt((t,e)=>t&&e),xX=Wt(zp,gX,null,"bool"),yX={kernelName:zp,backendName:"cpu",kernelFunc:xX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wX=Xe(Mp,t=>t?0:1,"bool"),vX={kernelName:Mp,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bX=Tt((t,e)=>t||e),CX=Wt(Pp,bX,null,"bool"),kX={kernelName:Pp,backendName:"cpu",kernelFunc:CX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s;he(r,"LRN");const c=r.shape[3],u=c-1,d=n.data.get(r.dataId).values,h=j(r.shape),f=new Float32Array(h);function p(g){const x=g%c;let m=g-x+Math.max(0,x-o);const y=g-x+Math.min(x+o,u);let w=0;for(;m<=y;m++){const v=d[m];w+=v*v}return w}for(let g=0;g<h;g++){const x=p(g),m=d[g]*Math.pow(i+a*x,-l);f[g]=m}return n.makeTensorInfo(r.shape,r.dtype,f)}const IX={kernelName:Lp,backendName:"cpu",kernelFunc:SX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $X(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s;he(i,"LRNGrad");const d=j(i.shape),h=i.shape[3],f=n.data.get(i.dataId).values,p=n.data.get(r.dataId).values,g=n.data.get(o.dataId).values,x=new Float32Array(d),m=d;for(let y=0;y<m;y++){const w=y%h,v=y-w+Math.max(0,w-a),b=y-w+Math.min(h,w+a+1);let C=0;for(let k=v;k<b;k++)C+=Math.pow(p[k],2);C=c*C+l;for(let k=v;k<b;k++){let S=-2*c*u*p[k]*g[y]/C;y===k&&(S+=Math.pow(C,-u)),S*=f[y],x[k]+=S}}return n.makeTensorInfo(i.shape,r.dtype,x)}const NX={kernelName:fy,backendName:"cpu",kernelFunc:$X};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PA(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=n;let l=r.shape;const c=l.length,u=Ae(o,l);let d=u;const h=yt(d,c);let f=a.data.get(r.dataId).values;if(h!=null){const v=new Array(c);for(let b=0;b<v.length;b++)v[b]=l[h[b]];f=fv(f,l,r.dtype,h,v),d=$t(d.length,c),l=v}he(r,"max"),sn("max",d,c);const[p,g]=Yt(l,d),x=j(g),m=tA(f,x,p,r.dtype),y=a.write(m,p,r.dtype);let w=p;return i&&(w=Dt(p,u)),{dataId:y,shape:w,dtype:r.dtype}}const TX={kernelName:Bp,backendName:"cpu",kernelFunc:PA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;he(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,c=1;I(hn(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Rs(r.shape,o,i,c,a,l);let d;if(u.filterWidth===1&&u.filterHeight===1&&Ue(u.inShape,u.outShape))d=$r({inputs:{x:r},backend:n});else{const h=n.data.get(r.dataId).values,f=pe(r.shape),p=gv(h,r.shape,r.dtype,f,u,"max");d=n.makeTensorInfo(u.outShape,r.dtype,p.values)}return d}const RX={kernelName:Vp,backendName:"cpu",kernelFunc:EX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=s;he(r,"maxPool3d");const u=qr(r.shape,o,i,1,a,l,c),d=n.data.get(r.dataId).values,h=FA(d,r.shape,r.dtype,pe(r.shape),u,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}const DX={kernelName:Wp,backendName:"cpu",kernelFunc:AX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _X(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:c}=s;he([r,o],"maxPool3DGrad");const u=qr(o.shape,i,a,1,l,c),d=n.bufferSync(o),h=b8(d,u),f=u.strideDepth,p=u.strideHeight,g=u.strideWidth,x=u.dilationDepth,m=u.dilationHeight,y=u.dilationWidth,w=u.effectiveFilterDepth,v=u.effectiveFilterHeight,b=u.effectiveFilterWidth,C=w-1-u.padInfo.front,k=b-1-u.padInfo.left,S=v-1-u.padInfo.top,$=Re(o.shape,"float32"),N=n.bufferSync(r);for(let A=0;A<u.batchSize;++A)for(let M=0;M<u.inChannels;++M)for(let L=0;L<u.inDepth;++L)for(let V=0;V<u.inHeight;++V)for(let B=0;B<u.inWidth;++B){const U=L-C,K=V-S,R=B-k;let z=0;for(let G=0;G<w;G+=x){const X=(U+G)/f;if(!(X<0||X>=u.outDepth||Math.floor(X)!==X))for(let q=0;q<v;q+=m){const Q=(K+q)/p;if(!(Q<0||Q>=u.outHeight||Math.floor(Q)!==Q))for(let ee=0;ee<b;ee+=y){const J=(R+ee)/g;if(J<0||J>=u.outWidth||Math.floor(J)!==J)continue;const ne=w*v*b-1-h.get(A,X,Q,J,M),ie=G*v*b+q*b+ee,ce=ne===ie?1:0;if(ce===0)continue;const ue=N.get(A,X,Q,J,M);z+=ue*ce}}}$.set(z,A,L,V,B,M)}return n.makeTensorInfo($.shape,$.dtype,$.values)}const FX={kernelName:my,backendName:"cpu",kernelFunc:_X};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OX(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o,output:i}=e,a=o;he([o,i],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,h=Rs(a.shape,l,c,1,u,d),f=n.data.get(a.dataId).values,p=Re(h.outShape,a.dtype,_A(f,a.shape,a.dtype,h).values),g=h.strideHeight,x=h.strideWidth,m=h.dilationHeight,y=h.dilationWidth,w=h.effectiveFilterHeight,v=h.effectiveFilterWidth,b=v-1-h.padInfo.left,C=w-1-h.padInfo.top,k=Re(a.shape,"float32"),S=n.data.get(r.dataId).values,$=Re(r.shape,"float32",S);for(let N=0;N<h.batchSize;++N)for(let A=0;A<h.inChannels;++A)for(let M=0;M<h.inHeight;++M)for(let L=0;L<h.inWidth;++L){const V=M-C,B=L-b;let U=0;for(let K=0;K<w;K+=m){const R=(V+K)/g;if(!(R<0||R>=h.outHeight||Math.floor(R)!==R))for(let z=0;z<v;z+=y){const G=(B+z)/x;if(G<0||G>=h.outWidth||Math.floor(G)!==G)continue;const X=w*v-1-p.get(N,R,G,A),q=K*v+z,Q=X===q?1:0;if(Q===0)continue;const ee=$.get(N,R,G,A);U+=ee*Q}}k.set(U,N,M,L,A)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const zX={kernelName:py,backendName:"cpu",kernelFunc:OX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MX(t,e,n,s,r){const o=pe(e),i=gv(t,e,n,o,r,"max"),a=_A(t,e,n,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PX={kernelName:o2,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=n;he(s,"MaxPoolWithArgmax");const c=l.data.get(s.dataId).values,u=Rs(s.shape,r,o,[1,1],i),[d,h]=MX(c,s.shape,s.dtype,a,u),f=l.write(d,u.outShape,s.dtype),p=l.write(h,u.outShape,s.dtype);return[{dataId:f,shape:u.outShape,dtype:s.dtype},{dataId:p,shape:u.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=Ae(o,r.shape),c=Yt(r.shape,a)[1],u=j(c),d=[],h=n.makeTensorInfo([],"float32",new Float32Array([u]));d.push(h);const f=Mo({inputs:{x:r},backend:n,attrs:{dtype:"float32"}});d.push(f);const p=xv({inputs:{a:f,b:h},backend:n});d.push(p);const g=Nd({inputs:{x:p},backend:n,attrs:{axis:o,keepDims:i}});return d.forEach(x=>n.disposeIntermediateTensorInfo(x)),g}const BX={kernelName:Up,backendName:"cpu",kernelFunc:LX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;he(r,"min");const a=Ae(o,r.shape);let l=a;const c=yt(l,r.shape.length);let u=r;c!=null&&(u=Fn({inputs:{x:r},backend:n,attrs:{perm:c}}),l=$t(l.length,r.shape.length)),sn("min",l,u.shape.length);const[d,h]=Yt(u.shape,l),f=j(h),p=un(j(d),u.dtype),g=n.data.get(u.dataId).values;for(let m=0;m<p.length;++m){const y=m*f;let w=g[y];for(let v=0;v<f;++v){const b=g[y+v];(Number.isNaN(b)||b<w)&&(w=b)}p[m]=w}c!=null&&n.disposeIntermediateTensorInfo(u);const x=n.makeTensorInfo(d,u.dtype,p);if(i){const m=Dt(d,a),y=st({inputs:{x},backend:n,attrs:{shape:m}});return n.disposeIntermediateTensorInfo(x),y}return x}const WX={kernelName:Gp,backendName:"cpu",kernelFunc:VX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UX(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,mode:i}=s;he(r,"mirrorPad");const a=o.map((w,v)=>w[0]+r.shape[v]+w[1]),l=o.map(w=>w[0]),c=o.map((w,v)=>w[0]+r.shape[v]),u=i==="reflect"?0:1,d=n.data.get(r.dataId).values,h=r.shape.length,f=pe(r.shape),p=j(a),g=a.length,x=pe(a),m=cn(r.dtype,p);for(let w=0;w<p;w++){let v=Cl(w,g,x);for(let C=0;C<g;C++)v[C]<l[C]?v[C]=l[C]*2-v[C]-u:v[C]>=c[C]&&(v[C]=(c[C]-1)*2-v[C]+u);v=v.map((C,k)=>C-l[k]);const b=gr(v,h,f);m[w]=d[b]}return{dataId:n.write(m,a,r.dtype),shape:a,dtype:r.dtype}}const GX={kernelName:Hp,backendName:"cpu",kernelFunc:UX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HX=Tt((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}),jX=Wt(Wu,HX),KX={kernelName:Wu,backendName:"cpu",kernelFunc:jX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LA(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=Ae([a],r.shape),c=PA({inputs:{x:r},backend:n,attrs:{reductionIndices:l,keepDims:!1}}),u=Dt(c.shape,l),d=st({inputs:{x:c},backend:n,attrs:{shape:u}}),h=mv({inputs:{a:r,b:d},backend:n}),f=UR({inputs:{x:h},backend:n}),p=Nd({inputs:{x:f},backend:n,attrs:{axis:l,keepDims:!1}}),g=st({inputs:{x:p},backend:n,attrs:{shape:u}}),x=xv({inputs:{a:f,b:g},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),x}const XX={kernelName:cm,backendName:"cpu",kernelFunc:LA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qX(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s;he(r,"multinomial");const l=a?r:LA({inputs:{logits:r},backend:n,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=n.data.get(l.dataId).values,h=[c,o],f=un(j(h),"int32");for(let p=0;p<c;++p){const g=p*u,x=new Float32Array(u-1);x[0]=d[g];for(let w=1;w<x.length;++w)x[w]=x[w-1]+d[g+w];const m=nw.alea(i.toString()),y=p*o;for(let w=0;w<o;++w){const v=m();f[y+w]=x.length;for(let b=0;b<x.length;b++)if(v<x[b]){f[y+w]=b;break}}}return a||n.disposeIntermediateTensorInfo(l),n.makeTensorInfo(h,"int32",f)}const YX={kernelName:i2,backendName:"cpu",kernelFunc:qX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QX=dw;function JX(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s;he(r,"NonMaxSuppression");const c=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,{selectedIndices:d}=QX(c,u,i,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const ZX={kernelName:gy,backendName:"cpu",kernelFunc:JX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eq=hw;function tq(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s;he(r,"NonMaxSuppressionPadded");const u=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,{selectedIndices:h,validOutputs:f}=eq(u,d,i,a,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const nq={kernelName:xy,backendName:"cpu",kernelFunc:tq};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sq=fw;function rq(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s;he(r,"NonMaxSuppressionWithScore");const u=n.data.get(r.dataId).values,d=n.data.get(o.dataId).values,h=i,f=a,p=l,g=c,{selectedIndices:x,selectedScores:m}=sq(u,d,h,f,p,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([m.length],"float32",new Float32Array(m))]}const oq={kernelName:yy,backendName:"cpu",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s;he(r,"oneHot");const c=j(r.shape),u=new Float32Array(c*i);u.fill(l);const d=n.data.get(r.dataId).values;for(let h=0;h<c;++h)d[h]>=0&&d[h]<i&&(u[h*i+d[h]]=a);return n.makeTensorInfo([...r.shape,i],o,u)}const aq={kernelName:qp,backendName:"cpu",kernelFunc:iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mf(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Vi({inputs:{input:s},backend:n}),o=Mf({inputs:{x:r},backend:n}),i=hl({inputs:{input:s},backend:n}),a=Mf({inputs:{x:i},backend:n}),l=Vn({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return yv({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const lq={kernelName:hm,backendName:"cpu",kernelFunc:Mf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BA(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=Vi({inputs:{input:s},backend:n}),o=BA({inputs:{x:r},backend:n}),i=hl({inputs:{input:s},backend:n}),a=Mf({inputs:{x:i},backend:n}),l=Vn({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return yv({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const cq={kernelName:Xp,backendName:"cpu",kernelFunc:BA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VA(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return zf({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(u=>{Px(o,u.shape,"All tensors passed to stack must have matching shapes"),I(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=zf({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(d),d}),c=fl({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const uq={kernelName:Yp,backendName:"cpu",kernelFunc:VA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dq(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,constantValue:i}=s;he(r,"pad");const a=o.map((y,w)=>y[0]+r.shape[w]+y[1]),l=o.map(y=>y[0]),c=n.data.get(r.dataId).values,u=j(r.shape),d=r.shape.length,h=pe(r.shape),f=j(a),p=a.length,g=pe(a),x=cn(r.dtype,f);i!==0&&x.fill(i);for(let y=0;y<u;y++){const v=Cl(y,d,h).map((C,k)=>C+l[k]),b=gr(v,p,g);x[b]=c[y]}return{dataId:n.write(x,a,r.dtype),shape:a,dtype:r.dtype}}const WA={kernelName:Qp,backendName:"cpu",kernelFunc:dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hq=Tt((t,e)=>Math.pow(t,e)),fq=Wt(Gu,hq),pq={kernelName:Gu,backendName:"cpu",kernelFunc:fq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mq(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,a=r.map(x=>n.data.get(x.dataId).values),l=r.map(x=>x.shape),c=n.data.get(o.dataId).values,u=n.data.get(i.dataId).values,[d,h,f]=aA(a,l,c,o.shape,o.dtype,u,i.shape),p=d.map(x=>n.makeTensorInfo([x.length],"int32",x)),g=n.makeTensorInfo(f,o.dtype,h);return p.concat([g])}const gq={kernelName:a2,backendName:"cpu",kernelFunc:mq};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xq(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:o}=e,i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[c,u]=lA(i,s.shape,s.dtype,a,r.shape,l,o.shape),d=n.makeTensorInfo([c.length],"int32",c),h=n.makeTensorInfo([u.length],s.dtype,u);return[d,h]}const yq={kernelName:l2,backendName:"cpu",kernelFunc:xq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wq(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values,d=n.data.get(i.dataId).values,h=a.map(x=>n.data.get(x.dataId).values),f=a.map(x=>x.shape),[p,g]=cA(c,r.shape,u,o.shape,o.dtype,d,i.shape,h,f,l);return n.makeTensorInfo(p,o.dtype,g)}const vq={kernelName:c2,backendName:"cpu",kernelFunc:wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(t){const{backend:e,attrs:n}=t,{start:s,stop:r,dtype:o,step:i}=n,a=uA(s,r,i,o);return e.makeTensorInfo([a.length],o,a)}const Cq={kernelName:wy,backendName:"cpu",kernelFunc:bq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kq=Xe(Hu,t=>1/t),Sq={kernelName:Hu,backendName:"cpu",kernelFunc:kq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iq(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;he(r,"resizeBilinear");const l=pe(r.shape),[c,u]=a,[d,h,f,p]=r.shape,g=n.data.get(r.dataId).values,x=new Float32Array(j([d,c,u,p])),m=[o&&c>1?h-1:h,o&&u>1?f-1:f],y=[o&&c>1?c-1:c,o&&u>1?u-1:u];let w=0;const v=m[0]/y[0],b=m[1]/y[1];for(let C=0;C<d;C++)for(let k=0;k<c;k++){let S;i?S=v*(k+.5)-.5:S=v*k;const $=Math.max(0,Math.floor(S)),N=S-$,A=Math.min(h-1,Math.ceil(S)),M=C*l[0]+$*l[1],L=C*l[0]+A*l[1];for(let V=0;V<u;V++){let B;i?B=b*(V+.5)-.5:B=b*V;const U=Math.max(0,Math.floor(B)),K=B-U,R=Math.min(f-1,Math.ceil(B)),z=M+U*l[2],G=L+U*l[2],X=M+R*l[2],q=L+R*l[2];for(let Q=0;Q<p;Q++){const ee=g[z+Q],J=g[G+Q],ne=g[X+Q],ie=g[q+Q],ce=ee+(ne-ee)*K,ue=J+(ie-J)*K,xe=ce+(ue-ce)*N;x[w++]=xe}}}return n.makeTensorInfo([d,c,u,p],"float32",x)}const $q={kernelName:nm,backendName:"cpu",kernelFunc:Iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nq(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s;he([o,r],"resizeBilinearGrad");const a=pe(r.shape),[l,c,u,d]=r.shape,[,h,f]=o.shape,p=new Float32Array(l*c*u*d),g=[i&&h>1?c-1:c,i&&f>1?u-1:u],x=[i&&h>1?h-1:h,i&&f>1?f-1:f],m=g[0]/x[0],y=g[1]/x[1],w=n.data.get(o.dataId).values;let v=0;for(let b=0;b<l;b++){const C=b*a[0];for(let k=0;k<h;k++){const S=k*m,$=Math.floor(S),N=Math.min(Math.ceil(S),c-1),A=C+$*a[1],M=C+N*a[1],L=S-$,V=1-L;for(let B=0;B<f;B++){const U=B*y,K=Math.floor(U),R=Math.min(Math.ceil(U),u-1),z=U-K,G=1-z,X=A+K*a[2],q=A+R*a[2],Q=M+K*a[2],ee=M+R*a[2],J=V*G,ne=V*z,ie=L*G,ce=L*z;for(let ue=0;ue<d;ue++){const xe=w[v++];p[X+ue]+=xe*J,p[q+ue]+=xe*ne,p[Q+ue]+=xe*ie,p[ee+ue]+=xe*ce}}}}return n.makeTensorInfo([l,u,c,d],"float32",p)}const Tq={kernelName:Cy,backendName:"cpu",kernelFunc:Nq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;he(r,"resizeNearestNeighbor");const l=pe(r.shape),[c,u]=a,[d,h,f,p]=r.shape,g=n.data.get(r.dataId).values,x=new Float32Array(d*c*u*p),m=[o&&c>1?h-1:h,o&&u>1?f-1:f],y=[o&&c>1?c-1:c,o&&u>1?u-1:u],w=m[0]/y[0],v=m[1]/y[1];let b=0;for(let C=0;C<d;C++){const k=C*l[0];for(let S=0;S<c;S++){const $=i?w*(S+.5):w*S;let N=Math.min(h-1,o?Math.round($):Math.floor($));i&&(N=Math.max(0,N));const A=k+N*l[1];for(let M=0;M<u;M++){const L=i?v*(M+.5):v*M;let V=Math.min(f-1,o?Math.round(L):Math.floor(L));i&&(V=Math.max(0,V));const B=A+V*l[2];for(let U=0;U<p;U++){const K=g[B+U];x[b++]=K}}}}return n.makeTensorInfo([d,c,u,p],r.dtype,x)}const Rq={kernelName:tm,backendName:"cpu",kernelFunc:Eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aq(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s;he([o,r],"resizeNearestNeighborGrad");const a=pe(r.shape),l=pe(o.shape),[c,u,d,h]=r.shape,[,f,p]=o.shape,g=new Float32Array(c*u*d*h),x=n.data.get(o.dataId).values,m=[i&&f>1?u-1:u,i&&p>1?d-1:d],y=[i&&f>1?f-1:f,i&&p>1?p-1:p],w=m[0]/y[0],v=m[1]/y[1],b=1/w,C=1/v,k=Math.ceil(b)*2+2,S=Math.ceil(C)*2+2;for(let $=0;$<c;$++){const N=$*a[0];for(let A=0;A<u;A++){const M=N+A*a[1],L=Math.floor(A*b),V=Math.floor(L-k/2);for(let B=0;B<d;B++){const U=M+B*a[2],K=Math.floor(B*C),R=Math.floor(K-S/2);for(let z=0;z<h;z++){let G=0;for(let X=0;X<k;X++){const q=X+V;if(q<0||q>=f)continue;const Q=N+q*l[1],ee=q*w,J=Math.min(u-1,i?Math.round(ee):Math.floor(ee));if(A===J)for(let ne=0;ne<S;ne++){const ie=ne+R;if(ie<0||ie>=p)continue;const ce=Q+ie*l[2],ue=ie*v,xe=Math.min(d-1,i?Math.round(ue):Math.floor(ue));B===xe&&(G+=x[ce+z])}}g[U+z]=G}}}}return n.makeTensorInfo(r.shape,r.dtype,g)}const Dq={kernelName:by,backendName:"cpu",kernelFunc:Aq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _q(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:o}=s;he(r,"reverse");const i=r.shape.length,a=Ae(o,r.shape);if(i===0)return $r({inputs:{x:r},backend:n});const l=new tn(r.shape,r.dtype),c=n.bufferSync(r);for(let u=0;u<l.size;u++){const d=l.indexToLoc(u),h=d.slice();a.forEach(f=>h[f]=r.shape[f]-1-h[f]),l.set(c.get(...h),...d)}return n.makeTensorInfo(l.shape,l.dtype,l.values)}const Fq={kernelName:sm,backendName:"cpu",kernelFunc:_q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oq={kernelName:Ey,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:o,center:i}=e,a=n,l=cn(s.dtype,j(s.shape)),[c,u,d,h]=s.shape,[f,p]=Iw(i,u,d),g=255,x=Math.sin(r),m=Math.cos(r),y=a.data.get(s.dataId).values;for(let v=0;v<c;v++){const b=v*d*u*h;for(let C=0;C<u;C++){const k=C*(d*h);for(let S=0;S<d;S++){const $=S*h;for(let N=0;N<h;N++){const A=[c,C,S,N],M=A[2],L=A[1];let V=(M-f)*m-(L-p)*x,B=(M-f)*x+(L-p)*m;V=Math.round(V+f),B=Math.round(B+p);let U=o;if(typeof o!="number"&&(N===3?U=g:U=o[N]),V>=0&&V<d&&B>=0&&B<u){const R=B*(d*h),z=V*h,G=b+R+z+N;U=y[G]}const K=b+k+$+N;l[K]=U}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zq=Xe(Xu,t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),Mq={kernelName:Xu,backendName:"cpu",kernelFunc:zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pq(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Ji(o,r,i),h=!0,f=n.bufferSync(r),p=n.bufferSync(o),g=mi(f,p,i,d,c,l,a,u,0,h);return n.makeTensorInfo(i,g.dtype,g.values)}const Lq={kernelName:u2,backendName:"cpu",kernelFunc:Pq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<e?n=r+1:s=r;return s}function Vq(t,e){let n=0,s=t.length,r=0;for(;n<s;)r=Math.floor((n+s)/2),t[r]<=e?n=r+1:s=r;return s}function Wq(t,e,n,s,r,o){const i=kt("int32",n*r);for(let a=0;a<n;++a){const l=t.slice(a*s,(a+1)*s),c=a*r;for(let u=0;u<r;++u)i[c+u]=o==="left"?Bq(l,e[u+c]):Vq(l,e[u+c])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uq(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:o}=e,{side:i}=s,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,c=Wq(a,l,r.shape[0],r.shape[1],o.shape[1],i);return n.makeTensorInfo(o.shape,"int32",c)}const Gq={kernelName:h2,backendName:"cpu",kernelFunc:Uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hq(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:o}=e;he([s,r,o],"select");const i=s.shape.length,a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,u=Xn(r.dtype,o.dtype),d=un(j(r.shape),u);let h=0;const f=i===0||i>1||r.shape.length===1?1:j(r.shape.slice(1));for(let p=0;p<a.length;p++)for(let g=0;g<f;g++)a[p]===1?d[h++]=l[p]:d[h++]=c[p];return n.makeTensorInfo(r.shape,u,d)}const jq={kernelName:rm,backendName:"cpu",kernelFunc:Hq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq=Cm,Xq=km,qq=Xe(Yu,t=>t>=0?Xq*t:Kq*(Math.exp(t)-1)),Yq={kernelName:Yu,backendName:"cpu",kernelFunc:qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qq=Xe(Zu,t=>t<0?-1:t>0?1:0),Jq={kernelName:Zu,backendName:"cpu",kernelFunc:Qq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Zq=Xe(Qu,t=>Math.sin(t)),e7={kernelName:Qu,backendName:"cpu",kernelFunc:Zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t7=Xe(Ju,t=>Math.sinh(t)),n7={kernelName:Ju,backendName:"cpu",kernelFunc:t7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s7=11920928955078125e-23,wk=Math.log(s7)+2,r7=Xe(td,t=>{const e=t>-wk,n=t<wk,s=Math.exp(t);let r;return n?r=s:e?r=t:r=Math.log(1+s),r}),o7={kernelName:td,backendName:"cpu",kernelFunc:r7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i7(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,paddings:i}=s;he([r],"spaceToBatchND");const a=j(o),l=[[0,0]];l.push(...i);for(let C=1+o.length;C<r.shape.length;++C)l.push([0,0]);const c=WA.kernelFunc({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),u=gd(c.shape,o,a,!1),d=xd(u.length,o.length,!1),h=yd(c.shape,o,a,!1),g=st({inputs:{x:c},backend:n,attrs:{shape:u}}),y=Fn({inputs:{x:g},backend:n,attrs:{perm:d}}),b=st({inputs:{x:y},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),b}const a7={kernelName:am,backendName:"cpu",kernelFunc:i7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l7(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.data.get(s.dataId).values,l=n.data.get(r.dataId).values,c=n.data.get(o.dataId).values,u=n.data.get(i.dataId).values[0],[d,h,f,p,g]=pA(a,s.shape,s.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(x=>Number(x)))),n.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const c7={kernelName:f2,backendName:"cpu",kernelFunc:l7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.data.get(r.dataId).values),a=n.data.get(s.dataId).values,l=Array.from(n.data.get(o.dataId).values),[c,u,d]=mA(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(u,s.dtype,c),n.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const d7={kernelName:p2,backendName:"cpu",kernelFunc:u7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h7(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[c,u]=pv(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(u,s.dtype,c)}const f7={kernelName:m2,backendName:"cpu",kernelFunc:h7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=n.data.get(s.dataId).values,a=n.data.get(r.dataId).values,l=n.data.get(o.dataId).values,[c,u]=pv(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(u,s.dtype,c)}const m7={kernelName:g2,backendName:"cpu",kernelFunc:p7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g7(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=Ji(o,r,a),f=!1,p=n.bufferSync(r);let g;switch(o.dtype){case"bool":{const x=n.bufferSync(o),m=!!n.data.get(i.dataId).values[0];g=mi(p,x,a,h,u,c,l,d,m,f);break}case"float32":{const x=n.bufferSync(o),m=n.data.get(i.dataId).values[0];g=mi(p,x,a,h,u,c,l,d,m,f);break}case"int32":{const x=n.bufferSync(o),m=n.data.get(i.dataId).values[0];g=mi(p,x,a,h,u,c,l,d,m,f);break}case"string":{const x=n.bufferSync(o),m=Do(n.data.get(i.dataId).values[0]);g=mi(p,x,a,h,u,c,l,d,m,f);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return n.makeTensorInfo(a,g.dtype,g.values)}const x7={kernelName:x2,backendName:"cpu",kernelFunc:g7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y7(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Ae(i,r.shape)[0],l=Bw(r,o,a),c=new Array(r.shape.length).fill(0),u=r.shape.slice();return l.map(d=>{const h=[...u];h[a]=d;const f=Wi({inputs:{x:r},backend:n,attrs:{begin:c,size:h}});return c[a]+=d,f})}const w7={kernelName:lm,backendName:"cpu",kernelFunc:y7};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const v7={kernelName:ky,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;he(n,"square");const r=s.data.get(n.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];o[a]=l*l}return{dataId:s.write(o,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const b7=Xe(ld,(t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha}),C7={kernelName:ld,backendName:"cpu",kernelFunc:b7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k7(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=s;he(r,"stridedSlice");const{finalShapeSparse:f,finalShape:p,isIdentity:g,sliceDim0:x,isSimpleSlice:m,begin:y,end:w,strides:v}=Cw(r.shape,o,i,a,l,c,u,d,h);let b;if(g)b=st({inputs:{x:r},backend:n,attrs:{shape:p}});else if(x||m){I(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const C=ww(y,w,v),k=Wi({inputs:{x:r},backend:n,attrs:{begin:y,size:C}});b=st({inputs:{x:k},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(k)}else{const C=n.bufferSync(r),k=yA(f,C,v,y);b=n.makeTensorInfo(p,k.dtype,k.values)}return b}const S7={kernelName:Iy,backendName:"cpu",kernelFunc:k7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I7(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:d}=e,h=n.data.get(u.dataId).values,f=n.data.get(d.dataId).values,[p,g]=wA(h,f,r,o,i,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",g)]}const $7={kernelName:y2,backendName:"cpu",kernelFunc:I7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N7(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.data.get(o.dataId).values,l=n.data.get(i.dataId).values[0],[c,u,d]=vA(a,l,r),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const T7={kernelName:w2,backendName:"cpu",kernelFunc:N7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E7(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=n.data.get(o.dataId).values,a=bA(i,r);return n.makeTensorInfo(o.shape,"int32",a)}const R7={kernelName:v2,backendName:"cpu",kernelFunc:E7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const A7=Xe(od,t=>Math.tan(t)),D7={kernelName:od,backendName:"cpu",kernelFunc:A7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _7=Xe(id,t=>Math.tanh(t)),F7={kernelName:id,backendName:"cpu",kernelFunc:_7};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O7(t){const{inputs:e,backend:n}=t,{tensor:s,indices:r,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:l,strides:c,outputSize:u}=Ji(o,r,s.shape),d=!1,h=n.bufferSync(r),f=n.bufferSync(o),p=n.bufferSync(s),g=mi(h,f,s.shape,u,l,a,i,c,p,d);return n.makeTensorInfo(s.shape,g.dtype,g.values)}const z7={kernelName:d2,backendName:"cpu",kernelFunc:O7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function M7(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:o}=s;he(r,"tile");const i=kA(n.bufferSync(r),o);return n.makeTensorInfo(i.shape,i.dtype,i.values)}const P7={kernelName:ad,backendName:"cpu",kernelFunc:M7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L7(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:o,sorted:i}=s;he(r,"topk");const a=n.data.get(r.dataId).values,[l,c]=IA(a,r.shape,r.dtype,o,i);return[n.makeTensorInfo(l.shape,l.dtype,l.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const B7={kernelName:$y,backendName:"cpu",kernelFunc:L7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V7(t){const{inputs:e,attrs:n,backend:s}=t,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:c}=n,[u,d,h,f]=r.shape,[p,g]=c??[d,h],x=[u,p,g,f],m=pe(r.shape),y=m[0],w=m[1],v=m[2],b=pe(x),C=b[0],k=b[1],S=b[2],$=cn(r.dtype,j(x));$.fill(l);const N=s.data.get(r.dataId).values,A=s.data.get(o.dataId).values;for(let L=0;L<u;++L){const V=o.shape[0]===1?A:A.subarray(L*8,L*8+8);for(let B=0;B<p;++B)for(let U=0;U<g;++U)for(let K=0;K<f;++K){let R;const z=V[6]*U+V[7]*B+1;if(z===0)continue;const G=(V[0]*U+V[1]*B+V[2])/z,X=(V[3]*U+V[4]*B+V[5])/z,q=vk(G,h,a),Q=vk(X,d,a);switch(i){case"nearest":R=K7(N,d,h,y,w,v,L,Q,q,K,l);break;case"bilinear":R=X7(N,d,h,y,w,v,L,Q,q,K,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const ee=L*C+B*k+U*S+K;$[ee]=R}return s.makeTensorInfo(x,r.dtype,$)}return{dataId:s.write($,x,r.dtype),shape:r.shape,dtype:r.dtype}}const W7={kernelName:Ny,backendName:"cpu",kernelFunc:V7};function vk(t,e,n){switch(n){case"reflect":return U7(t,e);case"wrap":return G7(t,e);case"nearest":return j7(t,e);case"constant":default:return H7(t)}}function U7(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=2*e;n<s&&(n=s*Math.trunc(-n/s)+n),n=n<-e?n+s:-n-1}else if(n>e-1)if(e<=1)n=0;else{const s=2*e;n-=s*Math.trunc(n/s),n>=e&&(n=s-n-1)}return Ei(0,n,e-1)}function G7(t,e){let n=t;if(n<0)if(e<=1)n=0;else{const s=e-1;n+=e*(Math.trunc(-n/s)+1)}else if(n>e-1)if(e<=1)n=0;else{const s=e-1;n-=e*Math.trunc(n/s)}return Ei(0,n,e-1)}function H7(t,e){return t}function j7(t,e){return Ei(0,t,e-1)}function lc(t,e,n,s,r,o,i,a,l,c,u){const d=i*s+a*r+l*o+c;return 0<=a&&a<e&&0<=l&&l<n?t[d]:u}function K7(t,e,n,s,r,o,i,a,l,c,u){const d=Math.round(a),h=Math.round(l);return lc(t,e,n,s,r,o,i,d,h,c,u)}function X7(t,e,n,s,r,o,i,a,l,c,u){const d=Math.floor(a),h=Math.floor(l),f=d+1,p=h+1,g=(p-l)*lc(t,e,n,s,r,o,i,d,h,c,u)+(l-h)*lc(t,e,n,s,r,o,i,d,p,c,u),x=(p-l)*lc(t,e,n,s,r,o,i,f,h,c,u)+(l-h)*lc(t,e,n,s,r,o,i,f,p,c,u);return(f-a)*g+(a-d)*x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q7(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:o}=e;he(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:l,indices:c}=$A(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const Y7={kernelName:Ty,backendName:"cpu",kernelFunc:q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q7(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],l=new Array(i-1);let c=0;for(let f=0;f<i;f++)f!==o&&(l[c++]=r.shape[f]);const u=new Array(i).fill(0),d=r.shape.slice();d[o]=1;const h=new Array(a);for(let f=0;f<h.length;f++){u[o]=f;const p=Wi({inputs:{x:r},backend:n,attrs:{begin:u,size:d}});h[f]=st({inputs:{x:p},backend:n,attrs:{shape:l}}),n.disposeIntermediateTensorInfo(p)}return h}const J7={kernelName:um,backendName:"cpu",kernelFunc:Q7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z7(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:o}=e,{numSegments:i}=s;he(r,"unsortedSegmentSum");const a=r.shape.length,l=o.shape.length,c=[],u=[],d=a-l;let h=o;for(let p=0;p<d;++p){const g=zf({inputs:{input:h},backend:n,attrs:{dim:p+1}});h=g,u.push(g)}for(let p=0;p<i;++p){const g=Wo(p,"int32"),x=n.makeTensorInfo([],"int32",g),m=VR({inputs:{a:x,b:h},backend:n}),y=Mo({inputs:{x:m},backend:n,attrs:{dtype:"float32"}}),w=Om({inputs:{a:y,b:r},backend:n}),v=Nd({inputs:{x:w},backend:n,attrs:{axis:0,keepDims:!1}});c.push(v),u.push(x),u.push(m),u.push(y),u.push(w),u.push(v)}const f=VA({inputs:c,backend:n,attrs:{axis:0}});return u.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const e9={kernelName:dm,backendName:"cpu",kernelFunc:Z7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t9=[qj,EH,Qj,Zj,OH,t8,s8,o8,a8,c8,d8,f8,m8,y8,v8,k8,I8,N8,E8,Kj,A8,_8,O8,MH,M8,_H,LH,L8,RH,V8,U8,G8,j8,X8,Y8,J8,eK,nK,rK,iK,lK,uK,hK,pK,mK,xK,wK,bK,CK,kK,SK,$K,EK,Bj,AK,BH,LK,VH,BK,UH,jK,KK,qK,HH,KH,QK,ZK,tX,sX,qH,QH,AH,oX,W8,aX,cX,dX,Vj,ZH,tj,fX,sj,mX,yX,vX,kX,IX,NX,TX,oj,RX,DX,FX,zX,PX,BX,WX,aj,GX,KX,YX,cj,dj,ZX,nq,oq,fj,aq,cq,uq,WA,pq,Uj,gj,gq,yq,vq,Cq,DH,S1,Sq,Gj,Hj,jj,$q,Tq,Rq,Dq,Fq,Oq,Mq,Sj,Lq,Gq,jq,Yq,$j,Jq,e7,n7,Nj,XX,o7,a7,c7,d7,f7,m7,x7,w7,Rj,v7,Dj,Fj,C7,S7,$7,T7,R7,Pj,NK,D7,F7,z7,P7,B7,W7,pj,Y7,J7,e9,lq];for(const t of t9)C2(t);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ai={},rh={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function n9(t,e){ai[t]=e}function er(t,e){if(!(t in ai)||e!=null){const s=r9(t,e);if(s!==null)ai[t]=s;else return console.log("Could not get context for WebGL version",t),null}const n=ai[t];return n==null||n.isContextLost()?(delete ai[t],er(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),ai[t])}function s9(t){if(!W().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function r9(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const n=e??s9(t);return n.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete ai[t]},!1),W().getBool("SOFTWARE_WEBGL_ENABLED")&&(rh.failIfMajorPerformanceCaveat=!1),t===1?n.getContext("webgl",rh)||n.getContext("experimental-webgl",rh):n.getContext("webgl2",rh)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var eu;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(eu||(eu={}));var ns;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(ns||(ns={}));var Zt;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Zt||(Zt={}));function Td(t,e){return[e,t]}function o9(t,e){return t*e}function oh(t){const e=j(t),n=Math.ceil(e/4);return K0(n)}function El(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function i9(t,e){const[n,s]=El(t,e);return n*s*4}function wv(t,e){const n=t;let s,r,o,i,a,l,c,u,d,h;return W().getNumber("WEBGL_VERSION")===2?(s=n.R32F,r=n.R16F,o=n.RGBA16F,i=n.RGBA32F,a=n.RED,c=4,u=1,d=n.HALF_FLOAT,h=n.FLOAT,l=n.RGBA8):(s=t.RGBA,r=t.RGBA,o=t.RGBA,i=n.RGBA,a=t.RGBA,c=4,u=4,d=e!=null?e.HALF_FLOAT_OES:null,h=t.FLOAT,l=t.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:h}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ae(t,e){const n=e();return W().getBool("DEBUG")&&a9(t),n}function a9(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+d9(t,e))}const l9=596e-10,c9=65504;function u9(t){return!!(W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||l9<Math.abs(t)&&Math.abs(t)<c9)}function d9(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function ih(t,e){return Qr(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function h9(t,e){const n=Qr(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ae(t,()=>t.shaderSource(n,e)),ae(t,()=>t.compileShader(n)),t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function f9(t,e){const n=Qr(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ae(t,()=>t.shaderSource(n,e)),ae(t,()=>t.compileShader(n)),W().get("ENGINE_COMPILE_ONLY"))return n;if(t.getShaderParameter(n,t.COMPILE_STATUS)===!1)throw UA(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const p9=/ERROR: [0-9]+:([0-9]+):/g;function UA(t,e){const n=p9.exec(e);if(n==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}const s=+n[1],r=t.split(`
`),o=r.length.toString().length+2,i=r.map((d,h)=>Ma((h+1).toString(),o)+d);let a=0;for(let d=0;d<i.length;d++)a=Math.max(i[d].length,a);const l=i.slice(0,s-1),c=i.slice(s-1,s),u=i.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${Ma(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function m9(t){return Qr(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function g9(t,e){if(ae(t,()=>t.linkProgram(e)),!W().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function Ag(t,e){if(ae(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function x9(t,e){const n=Qr(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ae(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),ae(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function y9(t,e){const n=Qr(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ae(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n)),ae(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),n}function w9(t){return Qr(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function v9(t,e){const n=W().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const s=`[${t}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,r=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function b9(t){return Qr(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function bk(t,e,n,s,r,o,i){const a=t.getAttribLocation(e,n);return a===-1?!1:(ae(t,()=>t.bindBuffer(t.ARRAY_BUFFER,s)),ae(t,()=>t.vertexAttribPointer(a,r,t.FLOAT,!1,o,i)),ae(t,()=>t.enableVertexAttribArray(a)),!0)}function C9(t,e,n){N9(t,n),ae(t,()=>t.activeTexture(t.TEXTURE0+n)),ae(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function k9(t,e,n){return Qr(t,()=>t.getUniformLocation(e,n),'uniform "'+n+'" not present in program.')}function S9(t,e,n){return t.getUniformLocation(e,n)}function I9(t,e,n,s){ae(t,()=>C9(t,e,s)),ae(t,()=>t.uniform1i(n,s))}function Dg(t,e,n){ae(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),ae(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function Ck(t,e){ae(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),ae(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function ah(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+$9(t,e))}function $9(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Qr(t,e,n){const s=ae(t,()=>e());if(s==null)throw new Error(n);return s}function N9(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const r=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${r}.`)}}function pl(t,e=2){return j(t.slice(0,t.length-e))}function ml(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function lh(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[pl(t),...ml(t)]),e}function T9(t,e=!1){let n=W().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=W().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&W().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=n/2),e&&(n=n*2,s=s*2,t=t.map((a,l)=>l>=t.length-2?Mx(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=Vo(t).newShape);let r=j(t),o=null;t.length<=1&&r<=n?o=[1,r]:t.length===2&&t[0]<=n&&t[1]<=n?o=t:t.length===3&&t[0]*t[1]<=n&&t[2]<=n?o=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=n&&t[1]*t[2]<=n?o=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=n&&t[3]<=n?o=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=n&&t[1]*t[2]*t[3]<=n&&(o=[t[0],t[1]*t[2]*t[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=pl(t);let l=2,c=2;t.length&&([l,c]=ml(t)),r=a*(l/2)*(c/2),o=K0(r).map(u=>u*2)}else o=K0(r);return o}function ch(t){return t%2===0}function Pf(t,e){if(t=t.slice(-2),e=e.slice(-2),Ue(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){const n=t[t.length-1],s=e[e.length-1];if(n===s||ch(n)&&ch(s)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&ch(t[0])&&ch(e[0])}let _g,Fg;function E9(t){if(_g==null){const e=er(t);_g=e.getParameter(e.MAX_TEXTURE_SIZE)}return _g}function R9(t){if(Fg==null){const e=er(t);Fg=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Fg)}function A9(t){if(t===0)return 0;let e;const n=er(t);return ks(n,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:ks(n,"EXT_disjoint_timer_query")?e=1:e=0,e}function ks(t,e){return t.getExtension(e)!=null}function kk(t){try{if(er(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function D9(t){if(t===0)return!1;const e=er(t);if(t===1){if(!ks(e,"OES_texture_float"))return!1}else if(!ks(e,"EXT_color_buffer_float"))return!1;return $1(e)}function _9(t){if(t===0)return!1;const e=er(t);if(t===1){if(!ks(e,"OES_texture_float")||!ks(e,"WEBGL_color_buffer_float"))return!1}else{if(ks(e,"EXT_color_buffer_float"))return $1(e);const s="EXT_color_buffer_half_float";if(ks(e,s)){const r=e.getExtension(s);return F9(e,r)}return!1}return $1(e)}function $1(t){const e=wv(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(o),i}function F9(t,e){const n=wv(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(i),a}function O9(t){return t!==2?!1:er(t).fenceSync!=null}function Ed(t,e){Array.isArray(t)||(t=[t]),t.forEach(n=>{n!=null&&I(n.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fe=W();fe.registerFlag("HAS_WEBGL",()=>fe.getNumber("WEBGL_VERSION")>0);fe.registerFlag("WEBGL_VERSION",()=>kk(2)?2:kk(1)?1:0);fe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);fe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>fe.get("WEBGL_VERSION")===2);fe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);fe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);fe.registerFlag("WEBGL_PACK",()=>fe.getBool("HAS_WEBGL"));fe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_CLIP",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_REDUCE",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_LAZILY_UNPACK",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_CONV_IM2COL",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>fe.getBool("WEBGL_PACK"));fe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>E9(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>R9(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const t=fe.getNumber("WEBGL_VERSION");return t===0?0:A9(t)});fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>fe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!L2());fe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>D9(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>fe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:fe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));fe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>_9(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>O9(fe.getNumber("WEBGL_VERSION")));fe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>fe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);fe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});fe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>L2()?1:-1,t=>{if(typeof t!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${t}.`);if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});fe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);fe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);fe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);fe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);fe.registerFlag("WEBGL_EXP_CONV",()=>!1);fe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>fe.getBool("IS_TEST"));fe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);fe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);fe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);fe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $n(){let t,e,n,s,r,o,i,a,l,c;return W().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",n="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=W().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",n="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ta(t,e,n="index"){const s=pe(e);return s.map((r,o)=>{const i=`int ${t[o]} = ${n} / ${r}`,a=o===s.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * ${r}`:`index -= ${t[o]} * ${r}`;return`${i}; ${a};`}).join("")}function zm(t,e,n="index"){const s=pe(e);return s.map((r,o)=>{const i=`int ${t[o]} = ${n} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${t[o+1]} = ${n} - ${t[o]} * outShapeStrides[${o}]`:`index -= ${t[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function z9(t,e){const n=t.length,s=t.map(o=>`${e}[${o}]`),r=new Array(n-1);r[n-2]=s[n-1];for(let o=n-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function M9(t,e,n="index"){const s=t.map((o,i)=>i),r=z9(s,e);return r.map((o,i)=>{const a=`int ${t[i]} = ${n} / ${r[i]}`,l=i===r.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${r[i]}`:`index -= ${t[i]} * ${r[i]}`;return`${a}; ${l};`}).join("")}function vv(t){const e=pe(t).map(n=>n.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function bv(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const GA=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:HA}=SU;function P9(t,e,n){const s=[];if(t.forEach(f=>{const p=j(f.shapeInfo.logicalShape);if(f.shapeInfo.isUniform?s.push(`uniform float ${f.name}${p>1?`[${p}]`:""};`):(s.push(`uniform sampler2D ${f.name};`),s.push(`uniform int offset${f.name};`)),n.enableShapeUniforms){const{uniformShape:g}=Cv(n.packedInputs,f.shapeInfo.logicalShape,f.shapeInfo.texShape);switch(g.length){case 1:s.push(`uniform int ${f.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${f.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${f.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${f.name}Shape;`);break}s.push(`uniform ivec2 ${f.name}TexShape;`)}}),n.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach(f=>{s.push(`uniform ${f.type} ${f.name}${f.arrayIndex?`[${f.arrayIndex}]`:""};`)});const r=s.join(`
`),o=t.map(f=>L9(f,e,n.packedInputs,n.enableShapeUniforms)).join(`
`),i=e.texShape,a=$n(),l=W9(a);let c,u,d=H9(a);return e.isPacked?(c=B9(e.logicalShape,i,n.enableShapeUniforms),u=G9(a)):(c=V9(e.logicalShape,i,n.enableShapeUniforms),u=U9(a)),n.packedInputs&&(d+=q9),[d,l,u,r,c,o,n.userCode].join(`
`)}function Rl(t,e=!1){const n=t.shapeInfo.logicalShape;switch(n.length){case 0:return aY(t,e);case 1:return cY(t,e);case 2:return dY(t,e);case 3:return fY(t,e);case 4:return mY(t,e);case 5:return gY(t);case 6:return xY(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function jA(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return iY(t);case 1:return lY(t,e);case 2:return uY(t,e);case 3:return hY(t,e);default:return pY(t,e)}}function L9(t,e,n=!1,s){let r="";n?r+=jA(t,s):r+=Rl(t,s);const o=t.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(n?r+=yY(t,e):r+=wY(t,e)),r}function B9(t,e,n){switch(t.length){case 0:return KA();case 1:return Y9(t,e,n);case 2:return rY(t,e,n);case 3:return J9(t,e,n);default:return eY(t,e,n)}}function V9(t,e,n){switch(t.length){case 0:return KA();case 1:return Q9(t,e,n);case 2:return oY(t,e,n);case 3:return Z9(t,e,n);case 4:return tY(t,e,n);case 5:return nY(t,e);case 6:return sY(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function W9(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function U9(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function G9(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function H9(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${j9}
    ${K9}
    ${X9}
  `}const j9=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,K9=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,X9=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,q9=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function KA(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Y9(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?n?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function Q9(t,e,n){return e[0]===1?n?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?n?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:n?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function J9(t,e,n){if(n)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function Z9(t,e,n){if(n)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${zm(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;const s=ta(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function eY(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2);let i=o,a="",l="b, r, c";for(let c=2;c<t.length-1;c++)i*=t[t.length-c-1],a=`
      int b${c} = index / ${i};
      index -= b${c} * ${i};
    `+a,l=`b${c}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${l});
    }
  `}function tY(t,e,n){if(n)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${zm(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;const s=ta(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function nY(t,e){const n=ta(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function sY(t,e){const n=ta(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${n}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function rY(t,e,n){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(Ue(t,e))return n?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(t[1]/2);return n?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function oY(t,e,n){return Ue(t,e)?n?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?n?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:n?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function na(t){return`offset${t}`}function iY(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=$n();return`
    vec4 ${n}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function aY(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${s}() {return ${n};}`;const[r,o]=t.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${n}, halfCR);
      }
    `;const i=na(n);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], ${i});
      return sampleTexture(${n}, uv);
    }
  `;const[a,l]=t.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${n}, uv);
    }
  `}function lY(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=$n();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${n}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${n}, uv);
    }
  `}function cY(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Al(t)}
      }
    `;const r=t.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;const a=na(n);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${a});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${n}, uv);
    }
  `}function uY(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape,i=o[0],a=o[1],l=$n();if(o!=null&&Ue(n,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const c=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],u=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${u}, ${c[0]}, ${c[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function dY(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape;if(o!=null&&Ue(n,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const h=o[0],f=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${f}.0, ${h}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=Vo(n),l=i;if(l.length<n.length){const h=Dl(t,l),f=["row","col"];return`
      ${Rl(h,e)}
      float ${r}(int row, int col) {
        return ${r}(${_l(f,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Al(t)}
      }
    `;const c=o[0],u=o[1],d=na(s);return u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${c}.0);
      return sampleTexture(${s}, uv);
    }
  `:c===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${d}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${d}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${u}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${d};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${d};
    vec2 uv = uvFromFlat(${c}, ${u}, index);
    return sampleTexture(${s}, uv);
  }
`}function hY(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){const h=n.slice(1),f=[1,2],p=Dl(t,h),g=["b","row","col"];return`
        ${jA(p,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${_l(g,f)});
        }
      `}const a=$n();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=i[0],c=i[1],u=Math.ceil(n[2]/2),d=u*Math.ceil(n[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${c}, ${d}, ${u}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function fY(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n[1]*n[2],i=n[2],{newShape:a,keptDims:l}=Vo(n),c=a;if(c.length<n.length){const g=Dl(t,c),x=["row","col","depth"];return`
        ${Rl(g,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${_l(x,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Al(t)}
      }
    `;const u=t.shapeInfo.texShape,d=u[0],h=u[1],f=t.shapeInfo.flatOffset;if(h===o&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${h}.0, ${d}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(h===i&&f==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${d}.0);
      return sampleTexture(${s}, uv);
    }
  `;const p=na(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${p};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${p};
        vec2 uv = uvFromFlat(${d}, ${h}, index);
        return sampleTexture(${s}, uv);
      }
  `}function pY(t,e){const n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=$n();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${n}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${n}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${n}, uv);
    }
  `;const o=t.shapeInfo.logicalShape,i=o.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=l[0],u=l[1],d=Math.ceil(o[i-1]/2);let h=d*Math.ceil(o[i-2]/2),f="int b, int row, int col",p=`b * ${h} + (row / 2) * ${d} + (col / 2)`;for(let g=2;g<i-1;g++)f=`int b${g}, `+f,h*=o[i-g-1],p=`b${g} * ${h} + `+p;return`
    vec4 ${s}(${f}) {
      int index = ${p};
      int texR = index / ${u};
      int texC = index - texR * ${u};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${c});
      return ${r.texture2D}(${n}, uv);
    }
  `}function mY(t,e){const n=t.shapeInfo.logicalShape,s=t.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n[3],i=n[2]*o,a=n[1]*i,{newShape:l,keptDims:c}=Vo(n);if(l.length<n.length){const y=Dl(t,l),w=["row","col","depth","depth2"];return`
      ${Rl(y,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${_l(w,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${Al(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],f=d[1],p=`int stride2 = ${s}Shape[3];`,g=`int stride1 = ${s}Shape[2] * stride2;`,x=`int stride0 = ${s}Shape[1] * stride1;`;if(f===a&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${p}
        ${g}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(f===o&&u==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${h}.0);
        return sampleTexture(${s}, uv);
      }
    `;const m=na(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${p}
      ${g}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${m});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${h}, ${f}, index + ${m});
      return sampleTexture(${s}, uv);
    }
  `}function gY(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,a=e[1]*i,{newShape:l,keptDims:c}=Vo(e);if(l.length<e.length){const g=Dl(t,l),x=["row","col","depth","depth2","depth3"];return`
      ${Rl(g)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${_l(x,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${Al(t)}
      }
    `;const u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,h=d[0],f=d[1];if(f===a&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(f===r&&u==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${h}.0);
        return sampleTexture(${n}, uv);
      }
    `;const p=na(n);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${p};
      vec2 uv = uvFromFlat(${h}, ${f}, index);
      return sampleTexture(${n}, uv);
    }
  `}function xY(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:r,keptDims:o}=Vo(e);if(r.length<e.length){const x=Dl(t,r),m=["row","col","depth","depth2","depth3","depth4"];return`
      ${Rl(x)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${_l(m,o)});
      }
    `}const i=e[5],a=e[4]*i,l=e[3]*a,c=e[2]*l,u=e[1]*c;if(t.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Al(t)}
      }
    `;const d=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,f=h[0],p=h[1];if(p===u&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(p===i&&d==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;const g=na(n);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${g};
      vec2 uv = uvFromFlat(${f}, ${p}, index);
      return sampleTexture(${n}, uv);
    }
  `}function Al(t){const e=t.name,n=j(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`
    for (int i = 0; i < ${n}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function yY(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",o=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=HA(t.shapeInfo.logicalShape,e.logicalShape),l=Je(i),c=i-o;let u;const d=["x","y","z","w","u","v"];o===0?u="":i<2&&a.length>=1?u="coords = 0;":u=a.map(y=>`coords.${d[y+c]} = 0;`).join(`
`);let h="";i<2&&o>0?h="coords":h=t.shapeInfo.logicalShape.map((y,w)=>`coords.${d[w+c]}`).join(", ");let f="return outputValue;";const g=j(t.shapeInfo.logicalShape)===1,m=j(e.logicalShape)===1;if(o===1&&!g&&!m)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(g&&!m)i===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){const y=o-2,w=o-1;a.indexOf(y)>-1&&a.indexOf(w)>-1?f="return vec4(outputValue.x);":a.indexOf(y)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(w)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${s}(${h});
      ${f}
    }
  `}function wY(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&Ue(i,o))return`
      float ${r}() {
        return sampleTexture(${n}, resultUV);
      }
    `;const c=Je(l),u=HA(t.shapeInfo.logicalShape,e.logicalShape),d=l-a;let h;const f=["x","y","z","w","u","v"];a===0?h="":l<2&&u.length>=1?h="coords = 0;":h=u.map(g=>`coords.${f[g+d]} = 0;`).join(`
`);let p="";return l<2&&a>0?p="coords":p=t.shapeInfo.logicalShape.map((g,x)=>`coords.${f[x+d]}`).join(", "),`
    float ${r}() {
      ${c} coords = getOutputCoords();
      ${h}
      return get${s}(${p});
    }
  `}function Je(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function Cv(t,e,n){const{newShape:s,keptDims:r}=Vo(e),o=e.length,i=t&&o===3&&e[0]===1,a=i?e.slice(1):s,l=!t&&o>1&&!Ue(e,n)&&s.length<o||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Dl(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function _l(t,e){return e.map(n=>t[n]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vY(t,e,n,s){const r=n.map((u,d)=>{const h={logicalShape:u.shape,texShape:u.isUniform?null:u.texData.texShape,isUniform:u.isUniform,isPacked:u.isUniform?!1:u.texData.isPacked,flatOffset:null};return u.texData!=null&&u.texData.slice!=null&&u.texData.slice.flatOffset>0&&(h.flatOffset=u.texData.slice.flatOffset),{name:e.variableNames[d],shapeInfo:h}}),o=r.map(u=>u.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=P9(r,i,e),l=f9(t.gl,a),c=t.createProgram(l);return W().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(t.buildVao(c),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:c,inShapeInfos:o,outShapeInfo:i},XA(t,e,c)))}function XA(t,e,n){const s=[],r=[];let o,i,a,l=null,c=null;c=t.getUniformLocation(n,"NAN",!1),W().getNumber("WEBGL_VERSION")===1&&(l=t.getUniformLocation(n,"INFINITY",!1));const u=!1;for(const d of e.variableNames){const h={name:d,uniform:t.getUniformLocation(n,d,u),offset:t.getUniformLocation(n,`offset${d}`,u)};e.enableShapeUniforms&&(h.shape=t.getUniformLocation(n,`${d}Shape`,u),h.texShape=t.getUniformLocation(n,`${d}TexShape`,u)),s.push(h)}if(e.enableShapeUniforms&&(o=t.getUniformLocation(n,"outShape",u),a=t.getUniformLocation(n,"outShapeStrides",u),i=t.getUniformLocation(n,"outTexShape",u)),e.customUniforms)for(const d of e.customUniforms)r.push(t.getUniformLocation(n,d.name,u));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:c,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function Sk(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((n,s)=>{const r=n.logicalShape,o=e[s],i=o.shape;if(!Ue(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(n.isUniform&&o.isUniform)return;const a=n.texShape,l=o.isUniform?null:o.texData.texShape;if(!Ue(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function bY(t,e,n,s,r){e.program.enableShapeUniforms||(Sk(e.inShapeInfos,n),Sk([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):t.setOutputMatrixTexture(o.texture,i[0],i[1]),t.setProgram(e.webGLProgram),t.bindVertexArray(e.webGLProgram.vao),W().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<n.length;++l){const c=n[l],{uniform:u,offset:d,shape:h,texShape:f}=e.variablesLocations[l];if(h){const{uniformShape:p}=Cv(e.program.packedInputs,c.shape,c.texData.texShape);switch(p.length){case 1:t.gl.uniform1iv(h,new Int32Array(p));break;case 2:t.gl.uniform2iv(h,new Int32Array(p));break;case 3:t.gl.uniform3iv(h,new Int32Array(p));break;case 4:t.gl.uniform4iv(h,new Int32Array(p));break}}if(f&&t.gl.uniform2i(f,c.texData.texShape[0],c.texData.texShape[1]),u!=null){if(c.isUniform){if(j(c.shape)<2)t.gl.uniform1f(u,c.uniformValues[0]);else{let p=c.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(u,p)}continue}c.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,c.texData.slice.flatOffset),t.setInputMatrixTexture(c.texData.texture.texture,u,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=pe(s.shape);switch(s.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const c=e.program.customUniforms[l],u=e.customUniformLocations[l],d=r[l];if(c.type==="float")t.gl.uniform1fv(u,d);else if(c.type==="vec2")t.gl.uniform2fv(u,d);else if(c.type==="vec3")t.gl.uniform3fv(u,d);else if(c.type==="vec4")t.gl.uniform4fv(u,d);else if(c.type==="int")t.gl.uniform1iv(u,d);else if(c.type==="ivec2")t.gl.uniform2iv(u,d);else if(c.type==="ivec3")t.gl.uniform3iv(u,d);else if(c.type==="ivec4")t.gl.uniform4iv(u,d);else throw Error(`uniform type ${c.type} is not supported yet.`)}t.executeProgram()}function CY(t,e,n){let s="";e.concat(n).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:c,uniformShape:u,keptDims:d}=Cv(t.packedInputs,i.shape,l);let h="",f="",p="";if(u.length===1&&t.packedInputs){const b=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];h=`${b[0]>1}_${b[1]>1}`}else if(u.length===2&&!t.packedInputs)f=`${u[0]>1}_${u[1]>1}`;else if(u.length>2&&!t.packedInputs){const b=pe(u);p=`${b[0]===l[1]}_${b[b.length-1]===l[1]}`}const g=i.shape.length,x=u.length===2&&Ue(i.shape,l),m=j(i.shape)===1,y=ll(i.shape,n.shape),w=!t.packedInputs&&g===n.shape.length&&Ue(l,n.texData.texShape),v=t.packedInputs||u.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${g}_${w}_${c?d:""}_${u.length}_${m}_${y}_${x}_${h}_${f}_${p}_${v}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${l}_${a}`}});const r=t.userCode;let o=t.constructor.name;return o+="_"+s+"_"+r+`${W().getNumber("WEBGL_VERSION")}`,o}function pn(t){return W().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class kY{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=eu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=$n();this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?zm(["r","c","d"],e):ta(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SY{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=eu.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const n=$n();this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?zm(["r","c","d"],e):ta(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IY{constructor(e){this.variableNames=["A"],this.outTexUsage=ns.DOWNLOAD;const n=$n();this.outputShape=e,this.userCode=`
      ${GA}

      void main() {
        float x = getAAtOutCoords();
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Y{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=ns.DOWNLOAD;const n=$n();this.outputShape=e,this.userCode=`
      ${GA}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${n.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NY={R:0,G:1,B:2,A:3};class Ik{constructor(e,n=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=$n();this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);let o="result";n&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const l=s[a];i+=`
          if(offset == ${a}) {
            result = values[${NY[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?bv():vv(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class TY{constructor(e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=$n();this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);let r="",o="result";n&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?bv():vv(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EY(t){const e=$n(),n=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return h9(t,n)}function RY(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return x9(t,e)}function AY(t){const e=new Uint16Array([0,1,2,2,1,3]);return y9(t,e)}function Rd(t,e,n,s,r,o){v9(e,n);const i=w9(t),a=t.TEXTURE_2D;return ae(t,()=>t.bindTexture(a,i)),ae(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),ae(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),ae(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),ae(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),W().getNumber("WEBGL_VERSION")===1?ae(t,()=>t.texImage2D(a,0,s,e,n,0,r,o,null)):ae(t,()=>t.texStorage2D(a,1,s,e,n)),ae(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:i,texShape:[n,e]}}function qA(t){return t.internalFormatFloat}function DY(t,e,n,s){const[r,o]=Td(e,n);return Rd(t,r,o,qA(s),s.textureFormatFloat,t.FLOAT)}function YA(t){return t.internalFormatHalfFloat}function _Y(t,e,n,s){const[r,o]=Td(e,n);return Rd(t,r,o,YA(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function QA(t){return t.downloadTextureFormat}function FY(t,e,n,s){const[r,o]=Td(e,n);return Rd(t,r,o,QA(s),t.RGBA,t.UNSIGNED_BYTE)}function JA(t){return t.internalFormatPackedFloat}function OY(t,e,n,s){const[r,o]=El(e,n);return Rd(t,r,o,JA(s),t.RGBA,t.FLOAT)}function ZA(t){return t.internalFormatPackedHalfFloat}function zY(t,e,n,s){const[r,o]=El(e,n);return Rd(t,r,o,ZA(s),t.RGBA,s.textureTypeHalfFloat)}function MY(t,e,n){return ae(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),bk(t,e,"clipSpacePos",n,3,20,0)&&bk(t,e,"uv",n,2,20,12)}function PY(t,e,n,s,r,o){ae(t,()=>t.bindTexture(t.TEXTURE_2D,e));let i,a,l;r instanceof Uint8Array?(i=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(i=new Float32Array(n*s*4),a=t.FLOAT,l=o.internalFormatPackedFloat),i.set(r),W().getNumber("WEBGL_VERSION")===2?ae(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n,s,t.RGBA,a,i)):ae(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,n,s,0,t.RGBA,a,i)),ae(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function LY(t,e,n){ae(t,()=>t.bindTexture(t.TEXTURE_2D,e)),n.data instanceof Uint8Array?W().getNumber("WEBGL_VERSION")===2?ae(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,n.width,n.height,t.RGBA,t.UNSIGNED_BYTE,n.data)):ae(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data)):W().getNumber("WEBGL_VERSION")===2?ae(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,n)):ae(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),ae(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function BY(t,e,n,s){const r=t.createBuffer();ae(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,r));const a=4*4*e*n;return ae(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),ae(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0)),ae(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),r}function VY(t,e,n){const s=t,r=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function WY(t,e,n,s){const[r,o]=Td(e,n),i=4,a=new Uint8Array(o9(e*n,i));return ae(t,()=>t.readPixels(0,0,r,o,s.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function UY(t,e,n,s,r,o,i,a){const l=t,c=new Float32Array(i9(o,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function GY(t,e,n){const s=new Float32Array(e*n*4);return ae(t,()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Og{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const n=W().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,n9(n,e)):this.gl=er(n),e=this.gl,W().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>ae(o,()=>o.createVertexArray()),this.bindVertexArray=i=>ae(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>ae(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>ae(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>ae(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>ae(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>ae(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>ae(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),W().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=ih(this.gl,o),ks(this.gl,i))this.textureHalfFloatExtension=ih(this.gl,i);else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),ks(this.gl,r))this.colorBufferHalfFloatExtension=ih(this.gl,r);else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",ks(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(ks(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=RY(this.gl),this.indexBuffer=AY(this.gl),this.framebuffer=b9(this.gl),this.textureConfig=wv(this.gl,this.textureHalfFloatExtension)}get debug(){return W().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;ae(e,()=>e.finish()),ae(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),ae(e,()=>e.deleteFramebuffer(this.framebuffer)),ae(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),ae(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),ae(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,n){return this.throwIfDisposed(),DY(this.gl,e,n,this.textureConfig)}createFloat16MatrixTexture(e,n){return this.throwIfDisposed(),_Y(this.gl,e,n,this.textureConfig)}createUnsignedBytesMatrixTexture(e,n){return this.throwIfDisposed(),FY(this.gl,e,n,this.textureConfig)}uploadPixelDataToTexture(e,n){this.throwIfDisposed(),LY(this.gl,e,n)}uploadDenseMatrixToTexture(e,n,s,r){this.throwIfDisposed(),PY(this.gl,e,n,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,n){return this.throwIfDisposed(),zY(this.gl,e,n,this.textureConfig)}createPackedMatrixTexture(e,n){return this.throwIfDisposed(),OY(this.gl,e,n,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(Ck(this.gl,this.framebuffer),this.outputTexture=null),ae(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,n,s){return this.downloadMatrixDriver(e,()=>WY(this.gl,n,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,n,s,r,o,i){return UY(this.gl,e,n,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,n){return VY(this.gl,e,n)}createBufferFromTexture(e,n,s){this.bindTextureToFrameBuffer(e);const r=BY(this.gl,n,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let n,s;if(W().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},n=o}else W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(n=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(n,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:n,isFencePassed:s}}downloadMatrixFromPackedTexture(e,n,s){return this.downloadMatrixDriver(e,()=>GY(this.gl,n,s))}createProgram(e){this.throwIfDisposed();const n=this.gl;this.vertexShader==null&&(this.vertexShader=EY(n));const s=m9(n);ae(n,()=>n.attachShader(s,this.vertexShader)),ae(n,()=>n.attachShader(s,e)),g9(n,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&Ag(n,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const n=this.gl;ae(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),MY(n,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(ae(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Ag(this.gl,this.program),ae(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,n,s=!0){return this.throwIfDisposed(),s?k9(this.gl,e,n):S9(this.gl,e,n)}getAttributeLocation(e,n){return this.throwIfDisposed(),ae(this.gl,()=>this.gl.getAttribLocation(e,n))}getUniformLocationNoThrow(e,n){return this.throwIfDisposed(),this.gl.getUniformLocation(e,n)}setInputMatrixTexture(e,n,s){this.throwIfDisposed(),this.throwIfNoProgram(),I9(this.gl,e,n,s)}setOutputMatrixTexture(e,n,s){this.setOutputMatrixTextureDriver(e,s,n)}setOutputPackedMatrixTexture(e,n,s){this.throwIfDisposed();const[r,o]=El(n,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,n,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,n)}setOutputPackedMatrixWriteRegion(e,n,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&Ag(this.gl,this.program),ah(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const n=this.getVertexArray();console.assert(n===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}ae(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ae(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ih(this.gl,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),n=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,n),n}endQuery(){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const n=this.gl,s=this.getQueryTimerExtensionWebGL2();n.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await cC(()=>this.disposed||this.isQueryAvailable(e,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,n){if(n===0)return null;if(n===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,n){if(n===0)return!0;if(n===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(n=>{this.addItemToPoll(()=>e.isFencePassed(),()=>n())})}pollItems(){const e=HY(this.itemsToPoll.map(n=>n.isDoneFn));for(let n=0;n<=e;++n){const{resolveFn:s}=this.itemsToPoll[n];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,n){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:n}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in W().platform&&(s=W().platform.setTimeoutCustom.bind(W().platform)),cC(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),Dg(this.gl,e,this.framebuffer),this.debug&&ah(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(Dg(this.gl,this.outputTexture,this.framebuffer),this.debug&&ah(this.gl)):Ck(this.gl,this.framebuffer)}downloadMatrixDriver(e,n){this.bindTextureToFrameBuffer(e);const s=n();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,n,s){this.throwIfDisposed();const r=this.gl;Dg(r,e,this.framebuffer),this.debug&&ah(r),this.outputTexture=e,ae(r,()=>r.viewport(0,0,n,s)),ae(r,()=>r.scissor(0,0,n,s))}setOutputMatrixWriteRegionDriver(e,n,s,r){this.throwIfDisposed(),ae(this.gl,()=>this.gl.scissor(e,n,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function HY(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:jY,bincountImpl:eD,bincountReduceImpl:KY,bitwiseAndImpl:XY,castImpl:qY,ceilImpl:YY,concatImpl:QY,equalImpl:JY,expImpl:ZY,expm1Impl:eQ,floorImpl:tQ,gatherNdImpl:nQ,gatherV2Impl:sQ,greaterImpl:rQ,greaterEqualImpl:oQ,lessImpl:iQ,lessEqualImpl:aQ,linSpaceImpl:lQ,logImpl:cQ,maxImpl:uQ,maximumImpl:dQ,minimumImpl:hQ,multiplyImpl:fQ,negImpl:pQ,notEqualImpl:mQ,prodImpl:gQ,raggedGatherImpl:xQ,raggedRangeImpl:yQ,raggedTensorToTensorImpl:wQ,rangeImpl:vQ,rsqrtImpl:bQ,scatterImpl:CQ,sigmoidImpl:kQ,simpleAbsImpl:tD,sliceImpl:SQ,sparseFillEmptyRowsImpl:IQ,sparseReshapeImpl:$Q,sparseSegmentReductionImpl:nD,sqrtImpl:NQ,staticRegexReplaceImpl:TQ,stridedSliceImpl:EQ,stringNGramsImpl:RQ,stringSplitImpl:AQ,stringToHashBucketFastImpl:DQ,subImpl:_Q,tileImpl:FQ,topKImpl:OQ,transposeImpl:kv,uniqueImpl:zQ}=Lj;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sD(t,e){return["x","y","z","w","u","v"].slice(0,e).map(n=>`${t}.${n}`)}function vn(t,e){return e===1?[t]:sD(t,e)}function MQ(t,e){if(t===1)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PQ{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=pn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const n=vn("rc",this.rank),s=Je(this.rank),r=this.getOutOfBoundsCondition(n),o=this.getSetup(n),i=this.getOutput(n);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const n=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;n.push(o)}return n}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let n="";for(let s=this.rank-2;s<this.rank;s++)n+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(n+="||");return n}getSetup(e){if(this.rank===1)return"";const n=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${n[0]};
      int c = ${n[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const n=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${n[0]}),
            cEdge ? 0. : getA(${n[1]}),
            rEdge ? 0. : getA(${n[2]}),
            rEdge || cEdge ? 0. : getA(${n[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rD{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${LQ(n,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?bv():vv(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function LQ(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?M9(["r","c","d"],"inputShape"):ta(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BQ{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,n,s){const r=Nk(n,s),o=Tk(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=$k(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let a;return r===Zt.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===Zt.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===Zt.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===Zt.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===Zt.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,n,s,r){if(this.freeTextures==null)return;const o=Nk(s,r),i=Tk(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=$k(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=W().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const c=this.usedTextures[i],u=c&&c.indexOf(e);if(u==null||u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c[u]=c[c.length-1],c.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const n=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*n)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(n=>{this.gpgpu.deleteMatrixTexture(n.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function VQ(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;if(e===n.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function $k(t,e,n,s,r){const o=WQ(e,s);let i;if(r){const[l,c]=El(t[0],t[1]);i=l*c}else{const[l,c]=Td(t[0],t[1]);i=l*c}const a=VQ(n,o);return i*a}function WQ(t,e){switch(t){case Zt.PACKED_2X2_FLOAT32:return JA(e);case Zt.PACKED_2X2_FLOAT16:return ZA(e);case Zt.UNPACKED_FLOAT32:return qA(e);case Zt.UNPACKED_FLOAT16:return YA(e);case Zt.PACKED_4X1_UNSIGNED_BYTE:return QA(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function UQ(t){return W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Zt.PACKED_2X2_FLOAT32:Zt.UNPACKED_FLOAT32:t?Zt.PACKED_2X2_FLOAT16:Zt.UNPACKED_FLOAT16}function Nk(t,e){if(t===ns.UPLOAD)return Zt.PACKED_2X2_FLOAT32;if(t===ns.RENDER||t==null)return UQ(e);if(t===ns.DOWNLOAD||t===ns.PIXELS)return Zt.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function Tk(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fr{constructor(e,n){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${n}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const Ds="if (isnan(x)) return x;",GQ="return x;",Ek="return abs(x);",HQ="return (x >= 0.0) ? x : (exp(x) - 1.0);",jQ=Ds+`
  return (x < 0.0) ? 0.0 : x;
`,KQ=Ds+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,oo="return x;",XQ="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qQ="return x;",YQ=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,QQ=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,JQ=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ZQ="return 1.0 / (1.0 + exp(-1.0 * x));";class po{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${n}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eJ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);const n=e.length,s=vn("rc",n),r=Je(n),o=MQ(n,s),i=s.slice(-2),a=n<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tJ=$N,nJ=1e-7,sJ=1e-4,uh={};function rJ(t){return t in uh||(uh[t]={}),uh[t]}const oJ=W().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),iJ=600;function aJ(){return W().global.screen==null?1024:W().global.screen.height*W().global.screen.width*window.devicePixelRatio*iJ/1024/1024}class Mm extends zx{nextDataId(){return Mm.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!W().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let n;if(e!=null){if(e instanceof Og)n=e;else{const s=er(W().getNumber("WEBGL_VERSION"),e);n=new Og(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=er(W().getNumber("WEBGL_VERSION"));n=new Og(s),this.binaryCache=rJ(W().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=n,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new BQ(this.gpgpu),this.numMBBeforeWarning=aJ(),this.texData=new X$(this,or())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,n,s,r,o,i){const a=this.makeTensorInfo(n,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,o]},l.texShape=[r,o];const c=lh(n),u=new Ik(c,!1,i),d=this.runWebGLProgram(u,[a],s,[[r,o]]);return d.shape=n,l.texture=null,this.disposeIntermediateTensorInfo(a),d.dataId}write(e,n,s){if((W().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||W().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:n,dtype:s,values:e,usage:ns.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const n=this.texData.get(e);n.refCount++}decRef(e){if(this.texData.has(e)){const n=this.texData.get(e);n.refCount--}}move(e,n,s,r,o){if(W().getBool("DEBUG")&&this.checkNumericalProblems(n),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:n,usage:ns.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const n=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:l}=n;if(i!=null){let h;l?h=new po(a,oo):h=new fr(a,oo);const f=this.runWebGLProgram(h,[{dataId:e,shape:a,dtype:r}],r),p=this.readSync(f.dataId);return this.disposeIntermediateTensorInfo(f),p}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const c=this.activeTimers!=null;let u;c&&(u=Tn());let d;if(r==="complex64"){const h=this.readSync(o.real.dataId),f=this.readSync(o.imag.dataId);d=Hr(h,f)}else d=this.getValuesFromTexture(e);return c&&(this.downloadWaitMs+=Tn()-u),this.convertAndCacheOnCPU(e,d)}async read(e){if(this.pendingRead.has(e)){const p=this.pendingRead.get(e);return new Promise(g=>p.push(g))}const n=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:l}=n;if(o!=null){let p;l?p=new po(r,oo):p=new fr(r,oo);const g=this.runWebGLProgram(p,[{dataId:e,shape:r,dtype:i}],i),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(W().getBool("DEBUG")&&!W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&W().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let c=null,u;if(i!=="complex64"&&W().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(e);const p=this.texData.get(u.dataId);c=this.gpgpu.createBufferFromTexture(p.texture.texture,...oh(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let d;if(i==="complex64"){const p=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),g=p[0],x=p[1];d=Hr(g,x)}else if(c==null)d=this.getValuesFromTexture(e);else{const p=j(r);d=this.gpgpu.downloadFloat32MatrixFromBuffer(c,p)}if(u!=null&&this.disposeIntermediateTensorInfo(u),c!=null){const p=this.gpgpu.gl;ae(p,()=>p.deleteBuffer(c))}const h=this.convertAndCacheOnCPU(e,d),f=this.pendingRead.get(e);return this.pendingRead.delete(e),f.forEach(p=>p(h)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&or().removeDataId(e,this),this.pendingDeletes--),h}readToGPU(e,n={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:a,isPacked:l,texture:c}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let f;l?f=new po(o,oo):f=new fr(o,oo);const p=this.runWebGLProgram(f,[{dataId:e,shape:o,dtype:a}],a),g=this.readToGPU(p,n);return this.disposeIntermediateTensorInfo(p),g}if(c==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const u=this.decode(e,n.customTexShape),d=or().makeTensorFromTensorInfo(u),h=this.texData.get(u.dataId);return Object.assign({tensorRef:d},h.texture)}bufferSync(e){const n=this.readSync(e.dataId);if(e.dtype==="string")try{const s=n.map(r=>Do(r));return Re(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Re(e.shape,e.dtype,n)}checkNumericalProblems(e){if(e!=null)for(let n=0;n<e.length;n++){const s=e[n];if(!u9(s))throw W().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:n,dtype:s,isPacked:r}=this.texData.get(e),o=j(n);if(W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const h=this.decode(e),f=this.texData.get(h.dataId),p=this.gpgpu.downloadMatrixFromPackedTexture(f.texture.texture,...oh(n)).subarray(0,o);return this.disposeIntermediateTensorInfo(h),p}const i=W().getBool("WEBGL_PACK")&&r===!0,a=i?lh(n):n,l=i?new $Y(a):new IY(a),c=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),u=this.texData.get(c.dataId),d=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(u.texture.texture,u.texShape[0],u.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(c),d}timerAvailable(){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const n=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=Ri(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=Ri(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=n,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);a.kernelMs=NM(l),a.getExtraProfileInfo=()=>l.map((c,u)=>({name:i[u],ms:c})).map(c=>`${c.name}: ${c.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Tn(),endMs:null}}endTimer(e){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Tn(),e)}async getQueryTime(e){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const n=e;return n.endMs-n.startMs}disposeData(e,n=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(n?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!n&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,n),this.disposeData(s.imag.dataId,n)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:n,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(n,r,o,i)));const u=this.texData.get(e);u.texture=null,u.texShape=null,u.isPacked=!1,u.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,n=oJ){return W().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&j(s.shape)<n)}getGPGPUContext(){return this.gpgpu}where(e){es("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const n=e.dataSync();return tJ(e.shape,n)}packedUnaryOp(e,n,s){const r=new po(e.shape,n),o=this.compileAndRun(r,[e],s);return or().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=tD(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Ek,e.dtype);const n=new fr(e.shape,Ek),s=this.compileAndRun(n,[e]);return or().makeTensorFromTensorInfo(s)}makeTensorInfo(e,n,s){let r;if(n==="string"&&s!=null&&s.length>0&&fu(s[0])){const o=s.map(i=>No(i));r=this.write(o,e,n)}else r=this.write(s,e,n);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:n}}makeOutput(e,n,s){return or().makeTensorFromTensorInfo(this.makeTensorInfo(e,n,s),this)}unpackTensor(e){const n=new eJ(e.shape);return this.runWebGLProgram(n,[e],e.dtype)}packTensor(e){const n=new PQ(e.shape);return this.runWebGLProgram(n,[e],e.dtype,null,!0)}packedReshape(e,n){const s=[pl(e.shape),...ml(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[pl(n),...ml(n)],i=new rD(o,s),a=!0,l=[s],c=this.runWebGLProgram(i,[r],e.dtype,l,a);return{dataId:c.dataId,shape:n,dtype:c.dtype}}decode(e,n){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(n!=null){const h=j(o),f=n[0]*n[1]*4;I(h<=f,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=lh(o);let l;r?l=new SY(a):l=new kY(a);const c=!0,u=[n??oh(a)],d=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,u,c,n);return{dtype:i,shape:o,dataId:d.dataId}}runWebGLProgram(e,n,s,r,o=!1,i){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===eu.DENSE){const m=i??oh(e.outputShape);l.texShape=m.map(y=>y*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),j(a.shape)===0)return l.values=cn(a.dtype,0),a;const c=[],u=n.map(m=>{if(m.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(m.dataId);if(y.texture==null){if(!e.packedInputs&&j(m.shape)<=W().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:m.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=m.shape)}if(this.uploadToGPU(m.dataId),!!y.isPacked!=!!e.packedInputs)m=y.isPacked?this.unpackTensor(m):this.packTensor(m),c.push(m),y=this.texData.get(m.dataId);else if(y.isPacked&&!Pf(y.shape,m.shape)){const w=m,v=m.shape;m.shape=y.shape,m=this.packedReshape(m,v),c.push(m),y=this.texData.get(m.dataId),w.shape=v}return{shape:m.shape,texData:y,isUniform:!1}});this.uploadToGPU(a.dataId);const d={shape:a.shape,texData:l,isUniform:!1},h=CY(e,u,d),f=this.getAndSaveBinary(h,()=>vY(this.gpgpu,e,u,d)),p=this.activeTimers!=null;let g;p&&(g=this.startTimer()),W().get("ENGINE_COMPILE_ONLY")||bY(this.gpgpu,f,u,d,r),c.forEach(m=>this.disposeIntermediateTensorInfo(m)),p&&(g=this.endTimer(g),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(g)}));const x=W().getNumber("WEBGL_FLUSH_THRESHOLD");if(x>0){const m=Tn();m-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=m)}if(!W().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const m=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),m}return a}compileAndRun(e,n,s,r,o=!1){return s=s||n[0].dtype,this.runWebGLProgram(e,n,s,r,o)}getAndSaveBinary(e,n){return e in this.binaryCache||(this.binaryCache[e]=n()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(W().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(n=>{this.gpgpu.deleteProgram(this.binaryCache[n].webGLProgram),delete this.binaryCache[n]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=P(()=>{if(!W().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=W().getBool("DEBUG");W().set("DEBUG",!1);const n=this.abs(We(1e-8)).dataSync()[0];if(W().set("DEBUG",e),n>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?nJ:sJ}uploadToGPU(e){const n=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:l}=n;if(i!=null)return;const c=this.activeTimers!=null;let u;c&&(u=Tn());let d=n.texShape;if(d==null&&(d=T9(s,l),n.texShape=d),o!=null){const h=lh(s);let f,p=d[1],g=d[0];const x=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!x)&&([p,g]=El(d[0],d[1])),l?f=new TY(h,x):f=new Ik(h,x);const m=x?[g,p]:d,y=this.makeTensorInfo(m,r),w=this.texData.get(y.dataId);x?w.usage=ns.PIXELS:w.usage=ns.UPLOAD,w.texShape=m,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),p,g,o);const v=[[g,p]],C=this.runWebGLProgram(f,[y],r,v,!0),k=this.texData.get(C.dataId);n.texShape=k.texShape,n.isPacked=k.isPacked,n.usage=k.usage,W().get("ENGINE_COMPILE_ONLY")?this.disposeData(C.dataId):(n.texture=k.texture,n.values=null,this.texData.delete(C.dataId)),this.disposeIntermediateTensorInfo(y),c&&(this.uploadWaitMs+=Tn()-u)}else{const h=this.acquireTexture(d,a,r,l);n.texture=h}}convertAndCacheOnCPU(e,n){const s=this.texData.get(e),{dtype:r}=s;return n!=null&&(s.values=lJ(n,r)),s.values}acquireTexture(e,n,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,n,r)}computeBytes(e,n){return e[0]*e[1]*df(n)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,n]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(n));return Promise.all(e)}else{for(const[,n]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(n),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await HN(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(UA(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:n,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=XA(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=n,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,n,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=e,l=or().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const c=l.writeTexture(r,n,s,o,i,a);return or().makeTensorFromDataId(c,n,s,l)}}Mm.nextDataId=0;function lJ(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){const n=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let s=0;s<n.length;++s)n[s]=Math.round(t[s]);return n}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */B2()&&U2("webgl",()=>new Mm,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Sv=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class Ui{constructor(e,n,s){this.variableNames=["A","B"],this.outputShape=Ie(n,s),this.enableShapeUniforms=pn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sa=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Fl{constructor(e,n,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ie(n,s);const o=this.outputShape.length;this.enableShapeUniforms=pn(o);let i="";if(r)if(o===0||j(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${Je(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=vn("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yn(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const cJ={kernelName:Fu,backendName:"webgl",kernelFunc:Yn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qo(t){const{inputs:e,backend:n}=t,{real:s,imag:r}=e,o=n.makeTensorInfo(s.shape,"complex64"),i=n.texData.get(o.dataId),a=Yn({inputs:{x:s},backend:n}),l=Yn({inputs:{x:r},backend:n});return i.complexTensorInfos={real:a,imag:l},o}const uJ={kernelName:Yx,backendName:"webgl",kernelFunc:Qo};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oD="return (a < 0.) ? b * a : a;",iD=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function dJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{alpha:o}=s,i=n.makeTensorInfo([],"float32",Wo(o,"float32")),a=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fl(iD,r.shape,i.shape):new Ui(oD,r.shape,i.shape),l=n.runWebGLProgram(a,[r,i],"float32");return n.disposeIntermediateTensorInfo(i),l}const hJ={kernelName:_p,backendName:"webgl",kernelFunc:dJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aD="return (a < 0.) ? b * a : a;",lD=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function fJ(t){const{inputs:e,backend:n}=t,{x:s,alpha:r}=e,o=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fl(lD,s.shape,r.shape):new Ui(aD,s.shape,r.shape);return n.runWebGLProgram(o,[s,r],"float32")}const pJ={kernelName:Jp,backendName:"webgl",kernelFunc:fJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ol="if (isnan(x)) return x;";function ze({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,l=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&n!=null){const d=a.texData.get(i.dataId),h=n(d.values,l);return a.makeTensorInfo(i.shape,l,h)}const c=W().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let u;return c?u=new po(i.shape,e):u=new fr(i.shape,t),a.runWebGLProgram(u,[i],l)}}function rn({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:l,b:c}=i,u=a;if(s&&l.dtype==="complex64"){const p=u.texData.get(l.dataId),g=u.texData.get(c.dataId),[x,m]=[[p.complexTensorInfos.real,g.complexTensorInfos.real],[p.complexTensorInfos.imag,g.complexTensorInfos.imag]].map(w=>{const[v,b]=w,C={dataId:v.dataId,dtype:v.dtype,shape:l.shape},k={dataId:b.dataId,dtype:b.dtype,shape:c.shape},S=new Ui(t,l.shape,c.shape);return u.runWebGLProgram(S,[C,k],Xn(v.dtype,b.dtype))}),y=Qo({inputs:{real:x,imag:m},backend:u});return u.disposeIntermediateTensorInfo(x),u.disposeIntermediateTensorInfo(m),y}const d=o||Xn(l.dtype,c.dtype);if((l.dtype==="string"||c.dtype==="string"||u.shouldExecuteOnCPU([l,c]))&&r!=null){const p=u.texData.get(l.dataId).values,g=u.texData.get(c.dataId).values,x=l.dtype==="string"?jr(p):p,m=l.dtype==="string"?jr(g):g,[y,w]=r(l.shape,c.shape,x,m,d),v=u.makeTensorInfo(w,d),b=u.texData.get(v.dataId);return b.values=y,v}const h=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let f;return h?f=new Fl(e,l.shape,c.shape,n):f=new Ui(t,l.shape,c.shape),u.runWebGLProgram(f,[l,c],d)}}function tu(t,e=!1){if(t==="linear")return e?qQ:GQ;if(t==="relu")return e?QQ:jQ;if(t==="elu")return e?YQ:HQ;if(t==="relu6")return e?JQ:KQ;if(t==="prelu")return e?lD:aD;if(t==="leakyrelu")return e?iD:oD;if(t==="sigmoid")return e?ZQ:XQ;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class cD{constructor(e,n,s,r=!1,o=!1,i=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=pn(this.outputShape.length);const u=r?e[1]:e[2],d=Math.ceil(u/2),h=r?"i * 2, rc.y":"rc.y, i * 2",f=o?"rc.z, i * 2":"i * 2, rc.z",p=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],g=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let x="",m="";a&&(l?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,m="result = activation(result);");const y=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let w="rc.x",v="rc.x";e[0]<n[0]?w=`imod(rc.x, ${e[0]})`:n[0]<e[0]&&(v=`imod(rc.x, ${n[0]})`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${w};
        int batchB = ${v};
        for (int i = 0; i < ${d}; i++) {
          vec4 a = getMatrixA(batchA, ${h});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${p[0]} * ${g[0]});
          result += (${p[1]} * ${g[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${m}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rk={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class Ak{constructor(e,n,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ie(n,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dk="return a * b;";function Iv(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,o=Xn(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),c=new Ak(Rk.REAL,s.shape,r.shape),u=new Ak(Rk.IMAG,s.shape,r.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],h=n.runWebGLProgram(c,d,"float32"),f=n.runWebGLProgram(u,d,"float32"),p=Qo({inputs:{real:h,imag:f},backend:n});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}if(n.shouldExecuteOnCPU([s,r])){const a=n.texData.get(s.dataId),l=n.texData.get(r.dataId),[c,u]=fQ(s.shape,r.shape,a.values,l.values,o),d=n.makeTensorInfo(u,o),h=n.texData.get(d.dataId);return h.values=c,d}let i;return W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Fl(Dk,s.shape,r.shape):i=new Ui(Dk,s.shape,r.shape),n.runWebGLProgram(i,[s,r],o)}const mJ={kernelName:Uu,backendName:"webgl",kernelFunc:Iv};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gJ(t,e,n){const s=[pl(t.shape),...ml(t.shape)],r={dtype:t.dtype,shape:s,dataId:t.dataId},o=[pl(e),...ml(e)],i=new rD(o,s),a=!0,l=[s],c=n.runWebGLProgram(i,[r],t.dtype,l,a);return{dataId:c.dataId,shape:e,dtype:c.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function re(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{shape:o}=s,i=n,a=j(r.shape),l=q$(o,a),c=j(l);I(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const u=i.texData.get(r.dataId);return u.isPacked&&!Pf(r.shape,l)&&!(u.texture!==null&&Pf(u.shape,l))?gJ(r,l,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const xJ={kernelName:em,backendName:"webgl",kernelFunc:re};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _k{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const a=Math.floor(s/4)*4,l=s%4;let c="sumValue += dot(values, ones);";if(n!=null){const d=1/n;c=`sumValue += dot(values * ${rl(d)?d.toPrecision(2):d}, ones);`}let u="";o%s>0&&(u=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class yJ{constructor(e,n){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let a="0.0",l="";n==="prod"?a="1.0":n==="min"?(a="1.0 / 1e-20",l="min"):n==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="sum"?c="sumValue":n==="prod"?c="prodValue":n==="all"?c="allValue":n==="any"&&(c="anyValue");const u=Math.floor(s/4)*4,d=s%4;let h=`
      if (${n==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${n==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${n==="min"} || ${n==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,f="vec4";n==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):n==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let p="";o%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${p}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${h}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wJ(t){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const n=e.length?e[e.length-1].outSize:t[1],s=bm(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function ra(t,e,n,s){const r=wJ(t.shape);let o=t;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:l,outSize:c}=r[i];let u,d;n==="mean"?u=i===0?new _k({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new _k({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new yJ({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},n),d=o,o=s.runWebGLProgram(u,[o],e),d.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(d)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vJ{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[n[i]];this.outputShape=s,this.rank=s.length;const r=Je(this.rank),o=bJ(n);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function bJ(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<t.length;r++)s[t[r]]=n[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CJ{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let u=0;u<s.length;u++)s[u]=e[n[u]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Je(this.rank),o=sD("rc",this.rank),i=new Array(this.rank);for(let u=0;u<n.length;u++)i[n[u]]=o[u];const a=`vec2(${i.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${s[this.rank-1]}`,c=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pm(t,e,n){const s=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new CJ(t.shape,e):new vJ(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kJ(t,e,n,s){const r=e,o=t.shape.length,i=Ae(r,t.shape);let a=i;const l=yt(a,o),c=l!=null;let u=t;c&&(u=Pm(t,l,s),a=$t(a.length,o)),sn("sum",a,o);const[d,h]=Yt(u.shape,a);let f=d;n&&(f=Dt(d,i));const p=j(h),x=j(t.shape)/p,m=re({inputs:{x:u},attrs:{shape:[x,p]},backend:s}),y=Ay(t.dtype),w=ra(m,y,"sum",s),v=re({inputs:{x:w},attrs:{shape:f},backend:s});return s.disposeIntermediateTensorInfo(m),s.disposeIntermediateTensorInfo(w),c&&s.disposeIntermediateTensorInfo(u),v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lm(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s;return kJ(r,o,i,n)}const SJ={kernelName:im,backendName:"webgl",kernelFunc:Lm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sn(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{perm:o}=s,i=n,a=r.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=r.shape[o[u]];let c;if(i.shouldExecuteOnCPU([r])){const d=i.texData.get(r.dataId).values,h=kv(d,r.shape,r.dtype,o,l);c=i.makeTensorInfo(l,r.dtype);const f=i.texData.get(c.dataId);f.values=h}else c=Pm(r,o,i);return c}const IJ={kernelName:Pa,backendName:"webgl",kernelFunc:Sn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uD=1e3;function Lf({a:t,b:e,transposeA:n,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const c=t.shape.length,u=e.shape.length,d=n?t.shape[c-2]:t.shape[c-1],h=s?e.shape[u-1]:e.shape[u-2],f=n?t.shape[c-1]:t.shape[c-2],p=s?e.shape[u-2]:e.shape[u-1],g=t.shape.slice(0,-2),x=e.shape.slice(0,-2),m=j(g),y=j(x),v=Ie(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([f,p]);I(d===h,()=>`Error in matMul: inner shapes (${d}) and (${h}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`);const b=n?[m,d,f]:[m,f,d],C=s?[y,p,h]:[y,h,p],k=re({inputs:{x:t},backend:r,attrs:{shape:b}}),S=re({inputs:{x:e},backend:r,attrs:{shape:C}}),$=[k,S],N=Math.max(m,y),A=n?k.shape[1]:k.shape[2],M=o!=null,L=i!=null,V=l==="leakyrelu",B=l!=null?tu(l,!0):null,U=M||L||V||B!=null;let K;if((f===1||p===1)&&A>uD&&U===!1){let z=k,G=S;n&&(z=Sn({inputs:{x:k},backend:r,attrs:{perm:[0,2,1]}}),$.push(z)),s&&(G=Sn({inputs:{x:S},backend:r,attrs:{perm:[0,2,1]}}),$.push(G));const X=p!==1,q=p===1;let Q=z;X&&(Q=re({inputs:{x:z},backend:r,attrs:{shape:[N,A,1]}}),$.push(Q));const ee=p===1?2:1;let J=G;q&&(J=re({inputs:{x:G},backend:r,attrs:{shape:[N,1,A]}}),$.push(J));const ne=Iv({inputs:{a:Q,b:J},backend:r});K=Lm({inputs:{x:ne},backend:r,attrs:{axis:ee,keepDims:!0}}),$.push(ne)}else{const z=Xn(t.dtype,e.dtype),G=new cD(b,C,[N,f,p],n,s,M,B,L,V),X=[k,S];if(o!=null&&X.push(o),L&&X.push(i),V){const q=r.makeTensorInfo([],"float32",Wo(a,"float32"));X.push(q),$.push(q)}K=r.runWebGLProgram(G,X,z)}const R=re({inputs:{x:K},backend:r,attrs:{shape:v}});$.push(K);for(const z of $)r.disposeIntermediateTensorInfo(z);return R}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $J(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=s;return Lf({a:r,b:o,transposeA:l,transposeB:c,backend:n,bias:i,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}const NJ={kernelName:hf,backendName:"webgl",kernelFunc:$J};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fk="return abs(x);";function TJ(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=n.texData.get(s.dataId),i=tD(o.values);return n.makeTensorInfo(s.shape,s.dtype,i)}let r;return W().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new po(s.shape,Fk):r=new fr(s.shape,Fk),n.runWebGLProgram(r,[s],s.dtype)}const EJ={kernelName:fp,backendName:"webgl",kernelFunc:TJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RJ=Ds+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,AJ=ze({opSnippet:RJ}),DJ={kernelName:pu,backendName:"webgl",kernelFunc:AJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _J=Ds+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,FJ=ze({opSnippet:_J}),OJ={kernelName:mu,backendName:"webgl",kernelFunc:FJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ok="return a + b;",zJ=rn({opSnippet:Ok,packedOpSnippet:Ok,supportsComplex:!0,cpuKernelImpl:jY}),MJ={kernelName:kl,backendName:"webgl",kernelFunc:zJ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class PJ{constructor(e,n){this.outputShape=[],this.outputShape=e,this.variableNames=n.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class LJ{constructor(e,n){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=n.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _h(t){const{inputs:e,backend:n}=t,s=e;if(s.length===1)return Yn({inputs:{x:s[0]},backend:n});if(s.length>W().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),c=_h({inputs:s.slice(0,l),backend:n}),u=_h({inputs:s.slice(l),backend:n});return _h({inputs:[c,u],backend:n})}const r=s.map(l=>l.dtype).reduce((l,c)=>Xn(l,c)),o=s.map(l=>l.shape),a=W().getBool("WEBGL_PACK")?new LJ(s[0].shape,o):new PJ(s[0].shape,o);return n.runWebGLProgram(a,s,r)}const BJ={kernelName:Ux,backendName:"webgl",kernelFunc:_h};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=Ae(o,r.shape);let c=l;const u=yt(c,a);let d=r;u!=null&&(d=Sn({inputs:{x:r},backend:n,attrs:{perm:u}}),c=$t(c.length,a)),sn("all",c,a);const[h,f]=Yt(d.shape,c),p=j(f),g=re({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),x=ra(g,g.dtype,"all",n);let m;if(i){const y=Dt(h,l);m=re({inputs:{x},backend:n,attrs:{shape:y}})}else m=re({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),u!=null&&n.disposeIntermediateTensorInfo(d),m}const WJ={kernelName:Gx,backendName:"webgl",kernelFunc:VJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=Ae(o,r.shape);let c=l;const u=yt(c,a);let d=r;u!=null&&(d=Sn({inputs:{x:r},backend:n,attrs:{perm:u}}),c=$t(c.length,a)),sn("any",c,a);const[h,f]=Yt(d.shape,c),p=j(f),g=re({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),x=ra(g,g.dtype,"any",n);let m;if(i){const y=Dt(h,l);m=re({inputs:{x},backend:n,attrs:{shape:y}})}else m=re({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),u!=null&&n.disposeIntermediateTensorInfo(d),m}const GJ={kernelName:Hx,backendName:"webgl",kernelFunc:UJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class HJ{constructor(e,n,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=n==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jJ{constructor(e,n,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,I(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/n);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,c=Je(l),u=vn("coords",l);let d,h;if(i===1){h=l+1;const S=Je(h);d=`
        ${S} sourceLocR = ${S}(${u.join()}, 0);
        ++${u[l-1]};
        ${S} sourceLocG = ${S}(${u.join()}, 0);
        ++${u[l-2]};
        ${S} sourceLocA = ${S}(${u.join()}, 0);
        --${u[l-1]};
        ${S} sourceLocB = ${S}(${u.join()}, 0);
        --${u[l-2]};`}else h=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;const f=["x","y","z","w","u","v"].slice(0,h),p="."+f[h-1],g=f.map(S=>"int "+S),x=vn("sourceLocR",h-1).concat("inIdx.r"),m=vn("sourceLocG",h-1).concat("inIdx.g"),y=vn("sourceLocB",h-1).concat("inIdx.b"),w=vn("sourceLocA",h-1).concat("inIdx.a"),v=s==="max"?"greaterThan":"lessThan",b=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${m.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${w.join()})));`,C=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${m.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${w.join()}) : 0.)`,k=r?"":`
      float getBestIndicesAChannel(${g.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${g.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${k}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${p}, sourceLocG${p},
          sourceLocB${p}, sourceLocA${p}) * ${n};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${C};

        for (int i = 0; i < ${n}; i++) {
          inIdx = srcIdx;
          ${b}
          vec4 candidate = ${C};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dD(t,e,n,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=bm(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},l=new HJ(a,n,s==null),c=[e];s!=null&&c.push(s);const u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;const d=dD(t,e,n,u);return t.disposeIntermediateTensorInfo(u),d}function hD(t,e,n,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=bm(o),a=new jJ(r,i,n,s==null),l=s==null?[e]:[e,s],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===e.shape.length){const u=hD(t,e,n,c);return t.disposeIntermediateTensorInfo(c),u}return c}function fD(t,e,n,s){const r=[n];if(sn("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!W().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=t.texData.get(e.dataId),a=i!==null&&i.isPacked;let l=e;a&&(l=t.unpackTensor(e),o.push(l));const[c,u]=Yt(l.shape,r),d=j(u),h=re({inputs:{x:l},backend:t,attrs:{shape:[-1,d]}});o.push(h);const f=dD(t,h,s);o.push(f);const p=re({inputs:{x:f},backend:t,attrs:{shape:c}});return o.forEach(g=>t.disposeIntermediateTensorInfo(g)),p}return hD(t,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;let i=Ae(o,r.shape);const a=yt(i,r.shape.length);let l=r;const c=[];a!=null&&(l=Sn({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),i=$t(i.length,l.shape.length)),sn("argMax",[i[0]],l.shape.length);const u=fD(n,l,i[0],"max");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const XJ={kernelName:pp,backendName:"webgl",kernelFunc:KJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qJ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o}=s;let i=Ae(o,r.shape);const a=yt(i,r.shape.length);let l=r;const c=[];a!=null&&(l=Sn({inputs:{x:r},backend:n,attrs:{perm:a}}),c.push(l),i=$t(i.length,l.shape.length)),sn("argMin",[i[0]],l.shape.length);const u=fD(n,l,i[0],"min");return c.forEach(d=>n.disposeIntermediateTensorInfo(d)),u}const YJ={kernelName:mp,backendName:"webgl",kernelFunc:qJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QJ=Ds+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,JJ=ze({opSnippet:QJ}),ZJ={kernelName:gu,backendName:"webgl",kernelFunc:JJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eZ=Ds+"return log(x + sqrt(x * x + 1.0));",tZ=ze({opSnippet:eZ}),nZ={kernelName:xu,backendName:"webgl",kernelFunc:tZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sZ=Ds+`
  return atan(x);
`,rZ=ze({opSnippet:sZ}),oZ={kernelName:yu,backendName:"webgl",kernelFunc:rZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iZ=Sv+`
  return atan(a, b);
`,aZ=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+sa+`
  return result;
`,lZ=rn({opSnippet:iZ,packedOpSnippet:aZ}),cZ={kernelName:vu,backendName:"webgl",kernelFunc:lZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uZ=Ds+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,dZ=ze({opSnippet:uZ}),hZ={kernelName:wu,backendName:"webgl",kernelFunc:dZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nu{constructor(e,n,s,r=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterHeight,h=e.effectiveFilterWidth,f=e.padInfo.top,p=e.padInfo.left;this.outputShape=e.outShape;const g=n==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,m=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let y="0.0";if(g||(y="-1.0 / 1e-20"),s){const S=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${p});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${h};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${S} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?x:m:`wR * ${h} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const w="max";let v=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(v="avgValue / max(count, 1.0)");const b=Math.floor(i/4)*4,C=i%4,k=`
      if (${g}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${p});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${b}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${k}
          }

          int xC = xCCorner + ${b};
          if (${C===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${C===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${C===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${k}
          }
        }
        setOutput(${v});
      }
    `}}class $v{constructor(e,n,s,r=!1,o=!1){if(this.variableNames=["x"],n==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,c=e.strideWidth,u=e.dilationDepth,d=e.dilationHeight,h=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=e.padInfo.front,m=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;const w=n==="avg";let v="0.0";if(w||(v="-1.0 / 1e-20"),s){const N=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${x}, ${m}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${p};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${g};
                  wC += ${h}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${N} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${p} * ${g} +
                      wR * ${g} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const b="max";let C=`${n}(${n}(${n}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;n==="avg"&&(C="avgValue / max(count, 1.0)");const k=Math.floor(i/4)*4,S=i%4,$=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${x}, ${m}, ${y});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${k}; wC += 4) {
              int xC = xCCorner + wC * ${h};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                getValue(batch, xD, xR, xC + 3 * ${h}, ch)
              );

              ${$}
            }

            int xC = xCCorner + ${k};
            if (${S===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${S===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                initializationValue,
                initializationValue
              );

              ${$}
            } else if (${S===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${h}, ch),
                getValue(batch, xD, xR, xC + 2 * ${h}, ch),
                initializationValue
              );

              ${$}
            }
          }
        }
        setOutput(${C});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Ed(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,c=1;I(hn(i,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Rs(r.shape,o,i,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&Ue(u.inShape,u.outShape))return Yn({inputs:{x:r},backend:n});const d=new nu(u,"avg",!1);return n.runWebGLProgram(d,[r],"float32")}const pZ={kernelName:gp,backendName:"webgl",kernelFunc:fZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:c}=s,u=[1,1,1],d=qr(r.shape,o,i,u,a,l,c),h=new $v(d,"avg",!1);return n.runWebGLProgram(h,[r],"float32")}const gZ={kernelName:xp,backendName:"webgl",kernelFunc:mZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xZ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,c=e.effectiveFilterWidth,u=l-1-e.padInfo.top,d=c-1-e.padInfo.left,h=1/(n*s);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${h});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class yZ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.effectiveFilterDepth,h=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=d-1-e.padInfo.front,g=h-1-e.padInfo.top,x=f-1-e.padInfo.left,m=1/(n*s*r);this.userCode=`
      const ivec3 pads = ivec3(${p}, ${g}, ${x});
      const float avgMultiplier = float(${m});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${h};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wZ(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,d=[1,1,1],h=qr(i.shape,a,l,d,c,u),f=new yZ(h);return n.runWebGLProgram(f,[r],i.dtype)}const vZ={kernelName:Kx,backendName:"webgl",kernelFunc:wZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bZ(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o;Ed([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:c}=s,u=Rs(i.shape,a,l,1,c),d=new xZ(u);return n.runWebGLProgram(d,[r],i.dtype)}const CZ={kernelName:jx,backendName:"webgl",kernelFunc:bZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kZ(t){const{inputs:e,backend:n,attrs:s}=t,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return Lf({a:r,b:o,transposeA:i,transposeB:a,backend:n})}const SZ={kernelName:yp,backendName:"webgl",kernelFunc:kZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IZ{constructor(e,n,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ie(e,n),Ie(e,s);let a="0.0";r!=null&&(Ie(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";o!=null&&(Ie(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $Z{constructor(e,n,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ie(e,n),Ie(e,s);let a="vec4(0.0)";r!=null&&(Ie(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(Ie(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NZ=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=t;I(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),I(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),I(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=n;l==null&&(l=.001);const c=[s,r,o];let u=null;i!=null&&(u=i.shape,c.push(i));let d=null;a!=null&&(d=a.shape,c.push(a));const h=W().getBool("WEBGL_PACK_NORMALIZATION")?new $Z(s.shape,r.shape,o.shape,u,d,l):new IZ(s.shape,r.shape,o.shape,u,d,l);return e.runWebGLProgram(h,c,c[0].dtype)},TZ={kernelName:Rp,backendName:"webgl",kernelFunc:NZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EZ{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const n=Je(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=RZ(this.rank);let r;const o=e.map((i,a)=>`sourceLoc.${N1[a]} = start[${a}] + coords.${N1[a]};`);r=`
        ${n} sourceLoc;
        ${n} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const N1=["x","y","z","w","u","v"];function RZ(t){if(t===1)return"sourceLoc";if(t<=6)return N1.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class AZ{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const n=Je(this.rank),s=vn("coords",this.rank),r=vn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${n}(${e.map((u,d)=>`start[${d}]`).join()});`:e.map((u,d)=>`${r[d]} = ${s[d]} + start[${d}];`).join(`
`);this.userCode=`
      void main() {
        ${n} coords = getOutputCoords();
        ${n} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DZ(t,e,n,s){const r=s.texData.get(t.dataId),o=s.makeTensorInfo(n,t.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=n,i.dtype=t.dtype;let a=bw(e,pe(t.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||t.dataId};const l=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,l+1),o}function zl(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,size:i}=s,[a,l]=vm(r,o,i);if(yw(r,a,l),j(l)===0)return n.makeTensorInfo(l,r.dtype,[]);if(n.shouldExecuteOnCPU([r])||r.dtype==="string"){const d=n.texData.get(r.dataId),h=SQ(d.values,a,l,r.shape,r.dtype);return n.makeTensorInfo(l,r.dtype,h)}const{isPacked:c}=n.texData.get(r.dataId),u=vw(r.shape,a,l);if(c||!u){const d=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new AZ(l):new EZ(l),h=[a];return n.runWebGLProgram(d,[r],r.dtype,h)}return n.uploadToGPU(r.dataId),DZ(r,a,l,n)}const _Z={kernelName:om,backendName:"webgl",kernelFunc:zl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FZ=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,crops:i}=s;I(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((y,w)=>y*w),l=gd(r.shape,o,a),c=xd(l.length,o.length),u=yd(r.shape,o,a),d=$w(i,o.length),h=Nw(u,i,o.length),f=[],p=re({inputs:{x:r},backend:n,attrs:{shape:l}}),g=Sn({inputs:{x:p},backend:n,attrs:{perm:c}}),x=re({inputs:{x:g},backend:n,attrs:{shape:u}}),m=zl({inputs:{x},backend:n,attrs:{begin:d,size:h}});return f.push(p),f.push(g),f.push(x),f.forEach(y=>n.disposeIntermediateTensorInfo(y)),m},OZ={kernelName:wp,backendName:"webgl",kernelFunc:FZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i}=s,a=n.readSync(r.dataId),l=n.readSync(o.dataId),c=eD(a,l,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,c)}const MZ={kernelName:Xx,backendName:"webgl",kernelFunc:zZ};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PZ=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,LZ=`
  return float(int(a.r) & int(b.r));
`;function BZ(t){const{inputs:e,backend:n}=t,{a:s,b:r}=e,o=W().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=W().getNumber("WEBGL_VERSION");if(n.shouldExecuteOnCPU([s,r])||i===1){const l=n.texData.get(s.dataId).values,c=n.texData.get(r.dataId).values,[u,d]=XY(s.shape,r.shape,l,c,s.dtype),h=n.makeTensorInfo(d,s.dtype),f=n.texData.get(h.dataId);return f.values=u,h}let a;return o?a=new Fl(PZ,s.shape,r.shape,!1):a=new Ui(LZ,s.shape,r.shape),n.runWebGLProgram(a,[s,r],s.dtype)}const VZ={kernelName:qx,backendName:"webgl",kernelFunc:BZ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WZ(t){const{inputs:e,backend:n}=t,{s0:s,s1:r}=e,o=n.readSync(s.dataId),i=n.readSync(r.dataId),a=Ie(Array.from(o),Array.from(i));return n.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const UZ={kernelName:t2,backendName:"webgl",kernelFunc:WZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GZ="return float(a != b);",pD=rn({opSnippet:GZ,cpuKernelImpl:mQ,dtype:"bool"}),HZ={kernelName:Kp,backendName:"webgl",kernelFunc:pD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ad(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Yn({inputs:{x:r.complexTensorInfos.real},backend:n})}const jZ={kernelName:vy,backendName:"webgl",kernelFunc:Ad};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KZ="return float(int(x));";function XZ(t,e){const n=new fr(t.shape,KZ),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T1(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Yn({inputs:{x:r},backend:n});const i=Kt(r.shape),a=T1({inputs:{x:r},backend:n,attrs:{dtype:"float32"}}),l=Qo({inputs:{real:a,imag:i},backend:n});return i.dispose(),n.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const i=Ad({inputs:{input:r},backend:n}),a=T1({inputs:{x:i},backend:n,attrs:{dtype:o}});return n.disposeIntermediateTensorInfo(i),a}if(!Y$(r.dtype,o)){const i=Yn({inputs:{x:r},backend:n});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(n.shouldExecuteOnCPU([r])){const i=n.texData.get(r.dataId).values,[a,l,c]=qY(i,r.shape,r.dtype,o);return n.makeTensorInfo(a,l,c)}if(o==="int32")return XZ(r,n);if(o==="bool"){const i=n.makeTensorInfo([],"bool",cn("bool",1)),l=pD({inputs:{a:r,b:i},backend:n});return n.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const qZ={kernelName:bu,backendName:"webgl",kernelFunc:T1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zk="return ceil(x);",YZ=ze({opSnippet:zk,packedOpSnippet:zk,cpuKernelImpl:YY}),QZ={kernelName:Cu,backendName:"webgl",kernelFunc:YZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JZ{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ZZ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;W().getBool("WEBGL_PACK_CLIP")?a=new ZZ(r.shape):a=new JZ(r.shape);const l=[[o],[i]];return n.runWebGLProgram(a,[r],r.dtype,l)}const tee={kernelName:ku,backendName:"webgl",kernelFunc:eee};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nee{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mk(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function see(t){const{inputs:e,backend:n}=t,{x:s}=e,r=n.texData.get(s.dataId),o=new nee(s.shape),i=[Mk(s,r.complexTensorInfos.real),Mk(s,r.complexTensorInfos.imag)];return n.runWebGLProgram(o,i,i[0].dtype)}const ree={kernelName:vp,backendName:"webgl",kernelFunc:see};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class oee{constructor(e){this.outputShape=[],this.outputShape=yr(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const n=new Array(e.length-1);n[0]=e[0][1];for(let i=1;i<n.length;i++)n[i]=n[i-1]+e[i][1];const s=[`if (yC < ${n[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<n.length;i++){const a=n[i-1];s.push(`else if (yC < ${n[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=n.length,o=n[n.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iee{constructor(e,n){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=yr(e,n);const s=this.outputShape,r=s.length,o=Je(r),i=vn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((g,x)=>`T${x}`);const l=new Array(e.length-1);l[0]=e[0][n];for(let g=1;g<l.length;g++)l[g]=l[g-1]+e[g][n];const c=a[n],u=a.slice(-2),d=a.join();let h=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let g=1;g<l.length;g++){const x=l[g-1];h+=`
        if (${c} < ${l[g]}  && ${c} >= ${l[g-1]}) {
          return getChannel(
            getT${g}(${dh(a,c,x)}),
            vec2(${dh(u,c,x)}));
        }`}const f=l.length,p=l[l.length-1];h+=`
        return getChannel(
          getT${f}(${dh(a,c,p)}),
          vec2(${dh(u,c,p)}));`,this.userCode=`
      float getValue(${a.map(g=>"int "+g)}) {
        ${h}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function dh(t,e,n){const s=t.indexOf(e);return t.map((o,i)=>i===s?`${o} - ${n}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bm(t){const{inputs:e,backend:n}=t,{input:s}=e,r=n.texData.get(s.dataId);return Yn({inputs:{x:r.complexTensorInfos.imag},backend:n})}const aee={kernelName:hy,backendName:"webgl",kernelFunc:Bm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cc(t,e,n){const s=t[0].dtype;if(s==="complex64"){const f=t.map(y=>Ad({inputs:{input:y},backend:n})),p=t.map(y=>Bm({inputs:{input:y},backend:n})),g=cc(f,e,n),x=cc(p,e,n),m=Qo({inputs:{real:g,imag:x},backend:n});return f.forEach(y=>n.disposeIntermediateTensorInfo(y)),p.forEach(y=>n.disposeIntermediateTensorInfo(y)),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),m}let r=n.shouldExecuteOnCPU(t);if(s==="string"&&(r=!0),r){const f=t.map(v=>{const C=[-1,j(v.shape.slice(e))];return re({inputs:{x:v},backend:n,attrs:{shape:C}})}),p=f.map(v=>({vals:n.readSync(v.dataId),shape:v.shape})),g=yr(f.map(v=>v.shape),1),x=f[0].shape[0]===1,m=QY(p,g,s,x),y=yr(t.map(v=>v.shape),e),w=n.makeTensorInfo(y,s,m);return f.forEach(v=>n.disposeIntermediateTensorInfo(v)),w}const o=t.filter(f=>j(f.shape)>0),i=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const f=i?new fr(t[0].shape,oo):new po(t[0].shape,oo);return n.runWebGLProgram(f,t,s)}const a=W().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const f=[];for(let g=0;g<o.length;g+=a){const x=o.slice(g,g+a);f.push(cc(x,e,n))}const p=cc(f,e,n);for(const g of f)n.disposeIntermediateTensorInfo(g);return p}if(i){const f=new iee(o.map(p=>p.shape),e);return n.runWebGLProgram(f,o,s)}const{tensors2D:l,outShape:c}=lee(o,e,n),u=new oee(l.map(f=>f.shape)),d=n.runWebGLProgram(u,l,s);l.forEach(f=>n.disposeIntermediateTensorInfo(f));const h=re({inputs:{x:d},attrs:{shape:c},backend:n});return n.disposeIntermediateTensorInfo(d),h}function lee(t,e,n){const s=yr(t.map(o=>o.shape),e);return{tensors2D:t.map(o=>re({inputs:{x:o},attrs:{shape:[-1,j(o.shape.slice(e))]},backend:n})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mD(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s,o=Ae(r,e[0].shape)[0],i=e.map(c=>c.shape);kw(i,o);const a=yr(e.map(c=>c.shape),o);if(j(a)===0)return n.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(c=>j(c.shape)>0);return l.length===1?Yn({inputs:{x:l[0]},backend:n}):cc(l,o,n)}const cee={kernelName:bp,backendName:"webgl",kernelFunc:mD};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class gD{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,c=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,h=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,g=e.inChannels%4,x=e.dataFormat==="channelsLast",m=x?1:2,y=x?2:3,w=x?3:1;let v="",b="";s&&(r?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:v=`
          float activation(float x) {
            ${s}
          }
        `,b="result = activation(result);");const C=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${w}];

        ivec2 xRCCorner =
            ivec2(coords[${m}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${h}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${p}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${g===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${p}) *
                    getW(wR, wC, ${p}, d2);
              } else {
                dotProd +=
                    getX(batch, ${p}, xR, xC) *
                    getW(wR, wC, ${p}, d2);
              }

            } else if (${g===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${g===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${p}, d2),
                getW(wR, wC, ${p} + 1, d2),
                getW(wR, wC, ${p} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${p}),
                  getX(batch, xR, xC, ${p} + 1),
                  getX(batch, xR, xC, ${p} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${p}, xR, xC),
                  getX(batch, ${p} + 1, xR, xC),
                  getX(batch, ${p} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${C}
        ${b}
        setOutput(result);
      }
    `}}class uee{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const n=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,c=e.dilationHeight,u=e.dilationWidth,d=e.filterDepth,h=e.filterHeight,f=e.filterWidth,p=Math.floor(e.inChannels/4)*4,g=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${n}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${h}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${p}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${g===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${p}) *
                  getW(wF, wR, wC, ${p}, d2);
              } else if (${g===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${g===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${p}),
                  getX(batch, xF, xR, xC, ${p} + 1),
                  getX(batch, xF, xR, xC, ${p} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${p}, d2),
                  getW(wF, wR, wC, ${p} + 1, d2),
                  getW(wF, wR, wC, ${p} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xD{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=pn(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,c=e.filterHeight,u=e.filterWidth,d=u;let h=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<u;x++)h+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;h+=`
     for (int r = 0; r < ${c}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<u;x++)h+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;h+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(d+1)/2;x++){const m=x*2;if(h+=`
           xC = xCCorner + ${m*l};
           `,a===1){if(m<u&&(i%2===1?(h+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }
               `,l===1&&m>0?h+=`
                 xC${m} = vec4(xTexelC${m-2}.zw, xTexelC${m}.xy);
                 `:h+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${m} = vec4(previous.zw, xTexelC${m}.xy);
                   } else {
                     xC${m} = vec4(0.0, 0.0, xTexelC${m}.xy);
                   }
                   `):h+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }

                 xC${m} = xTexelC${m};
                 `,m+1<u)){const y=i%2===0?Mx(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(h+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m+1}Ready == 0) {
                     xTexelC${m+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${m+1}.zw = vec2(0.0);
                     }
                     xTexelC${m+1}Ready = 1;
                   }
                   `,l>1?h+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${m+1} = vec4(previous.zw, xTexelC${m+1}.xy);
                     } else {
                      xC${m+1} = vec4(0.0, 0.0, xTexelC${m+1}.xy);
                     }
                     `:h+=`
                     xC${m+1} = vec4(xTexelC${m}.zw, xTexelC${m+1}.xy);
                     `):y===1?h+=`
                     xC${m+1} = xTexelC${m};
                     `:h+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m+1}Ready == 0) {
                       xTexelC${m+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${m+1}.zw = vec2(0.0);
                       }
                       xTexelC${m+1}Ready = 1;
                     }

                     xC${m+1} = xTexelC${m+1};
                     `}}else m<u&&(i%2===1?(h+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${m+1}Ready == 0) {
                   xTexelC${m+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${m+1}.zw = vec2(0.0);
                   }
                   xTexelC${m+1}Ready = 1;
                 }

                 xC${m} = vec4(xTexelC${m}.zw, xTexelC${m+1}.zw);
               `,m+1<u&&(h+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${m+1} = vec4(xTexelC${m+1}.xy, final.xy);
                 `)):(h+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${m}Ready == 0) {
                   xTexelC${m} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${m}.zw = vec2(0.0);
                   }
                   xTexelC${m}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${m+1}Ready == 0) {
                   xTexelC${m+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${m+1}.zw = vec2(0.);
                   }
                   xTexelC${m+1}Ready = 1;
                 }

                 xC${m} = vec4(
                   xTexelC${m}.xy, xTexelC${m+1}.xy);
               `,m+1<u&&(h+=`
                   xC${m+1} = vec4(xTexelC${m}.zw, xTexelC${m+1}.zw);
                 `)));m<u&&(h+=`
             wTexel = getW(r, ${m}, d1, d2);
             dotProd += xC${m}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${m}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,m+1<u&&(h+=`
               wTexel = getW(r, ${m+1}, d1, d2);
               dotProd += xC${m+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${m+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}h+=`
     }
   `,h+=`
     }
   `,h+=`
     }
   `;let f="",p="";s&&(r?f=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?f=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:f=`vec4 activation(vec4 x) {
           ${s}
         }`,p="result = activation(result);");const g=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${f}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${h}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${g}
         ${p}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dee{constructor(e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=pn(this.outputShape.length);const{dataFormat:s}=n,r=$n(),o=s==="channelsLast",i=o?1:2,a=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let c="";for(let u=0;u<=1;u++)for(let d=0;d<=1;d++)c+=`
          blockIndex = rc.z + ${d};
          pos = rc.y + ${u};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${u*2+d}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${c}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bf(t,e){const n=t.length;return n>=3?e?[...t.slice(0,-3),t[n-3]*t[n-2],t[n-1]]:[...t.slice(0,-3),t[n-3],t[n-2]*t[n-1]]:!e&&n===1&&t[0]>1?[t[0],1]:null}function yD({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const l=t.shape,c=s.texData.get(t.dataId),u=n.inChannels,d=l[0]*l[1]*l[2],h=n.outChannels,f=n.dataFormat==="channelsLast",p=!1,g=!1;let x;const m=[];if(o!=null){const v=Bf(o.shape,f);v!=null&&(o=re({inputs:{x:o},backend:s,attrs:{shape:v}}),m.push(o))}if(r!=null){const v=Bf(r.shape,f);v!=null&&(r=re({inputs:{x:r},backend:s,attrs:{shape:v}}),m.push(r))}if(!((d===1||h===1)&&u>uD)&&c.isPacked&&f&&c.texture!=null&&l[2]%2!==0&&Ue(c.shape.slice(-3),l.slice(-3))){const v=l[0]*l[1]*(l[2]+1),b={dataId:t.dataId,shape:[1,v,n.inChannels],dtype:t.dtype},C=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,I(Pf(c.shape,b.shape),()=>`packed reshape ${c.shape} to ${b.shape} isn't free`);const k=re({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});m.push(k);const S=Lf({a:b,b:k,backend:s,transposeA:p,transposeB:g,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),$=s.texData.get(S.dataId);I($.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=C,$.shape=n.outShape,x=Yn({inputs:{x:S},backend:s}),x.shape=n.outShape,m.push(S)}else{const v=n.outHeight*n.outWidth,b=re({inputs:{x:t},backend:s,attrs:{shape:f?[n.batchSize,v,n.inChannels]:[n.batchSize,n.inChannels,v]}}),C=re({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),k=Lf({a:f?b:C,b:f?C:b,transposeA:!f,transposeB:g,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});x=re({inputs:{x:k},backend:s,attrs:{shape:n.outShape}}),m.push(b),m.push(C),m.push(k)}for(const v of m)s.disposeIntermediateTensorInfo(v);return x}function wD({x:t,filter:e,convInfo:n,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:h,dataFormat:f}=n,p=f==="channelsLast",g=l*c*u,x=h*d,m=[n.batchSize,g,x],y=!0,w=!1,v=[];if(o!=null){const R=Bf(o.shape,p);R!=null&&(o=re({inputs:{x:o},backend:s,attrs:{shape:R}}),v.push(o))}if(r!=null){const R=Bf(r.shape,p);R!=null&&(r=re({inputs:{x:r},backend:s,attrs:{shape:R}}),v.push(r))}const b=re({inputs:{x:e},backend:s,attrs:{shape:[1,g,j(e.shape)/g]}});v.push(b);const C=new dee(m,n),k=[t.shape,[n.padInfo.top,n.padInfo.left],[n.strideHeight,n.strideWidth],[n.dilationHeight,n.dilationWidth],[n.inChannels],[n.filterWidth*n.inChannels],[n.outWidth]],S=s.runWebGLProgram(C,[t],"float32",k),$=re({inputs:{x:S},backend:s,attrs:{shape:m}});v.push(S),v.push($);const N=r!=null,A=o!=null,M=a==="leakyrelu",L=a?tu(a,!0):null,V=new cD(p?$.shape:b.shape,p?b.shape:$.shape,p?[n.batchSize,x,n.outChannels]:[n.batchSize,n.outChannels,x],y,w,N,L,A,M),B=p?[$,b]:[b,$];if(r&&B.push(r),A&&B.push(o),M){const R=s.makeTensorInfo([],"float32",Wo(i,"float32"));B.push(R),v.push(R)}const U=s.runWebGLProgram(V,B,"float32"),K=re({inputs:{x:U},backend:s,attrs:{shape:n.outShape}});v.push(U);for(const R of v)s.disposeIntermediateTensorInfo(R);return K}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=s,d=Yr(l),h=nn(r.shape,o.shape,i,c,a,u,!1,d);let f;if(h.filterHeight===1&&h.filterWidth===1&&h.dilationHeight===1&&h.dilationWidth===1&&h.strideHeight===1&&h.strideWidth===1&&(h.padInfo.type==="SAME"||h.padInfo.type==="VALID"))f=yD({x:r,filter:o,convInfo:h,backend:n});else if(h.strideWidth<=2&&d==="channelsLast"&&W().getBool("WEBGL_EXP_CONV")){const g=new xD(h),x=[[h.padInfo.top,h.padInfo.left],[h.strideHeight,h.strideWidth],[h.dilationHeight,h.dilationWidth],[h.inHeight,h.inWidth]];f=n.runWebGLProgram(g,[r,o],"float32",x)}else if(W().getBool("WEBGL_CONV_IM2COL"))f=wD({x:r,filter:o,convInfo:h,backend:n});else{const g=new gD(h);f=n.runWebGLProgram(g,[r,o],"float32")}const p=re({inputs:{x:f},backend:n,attrs:{shape:h.outShape}});return n.disposeIntermediateTensorInfo(f),p}const fee={kernelName:Cp,backendName:"webgl",kernelFunc:hee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pee{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class mee{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=n-1-e.padInfo.top,l=s-1-e.padInfo.left,c=i?1:2,u=i?2:3,d=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class gee{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${n} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class xee{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=n-1-e.padInfo.front,c=s-1-e.padInfo.top,u=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${n}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${n} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=s,d=Yr(l),h=nn(r.shape,u,i,1,a,c,!1,d),f=new pee(h);return n.runWebGLProgram(f,[r,o],"float32")}const wee={kernelName:Qx,backendName:"webgl",kernelFunc:yee};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vee{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=pn(this.outputShape.length);const n=e.filterHeight,s=e.filterWidth,r=n-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bee(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=s,d=Yr(c),h=nn(i,o.shape,a,1,l,u,!1,d);if(W().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&d==="channelsLast"){const f=[[h.strideHeight,h.strideWidth]],p=new vee(h);return n.runWebGLProgram(p,[r,o],"float32",f)}else{const f=new mee(h);return n.runWebGLProgram(f,[r,o],"float32")}}const Cee={kernelName:kp,backendName:"webgl",kernelFunc:bee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,c=Go(r.shape,o.shape,i,l,a),u=new uee(c);return n.runWebGLProgram(u,[r,o],"float32")}const See={kernelName:Sp,backendName:"webgl",kernelFunc:kee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s,c=Go(r.shape,l,i,1,a),u=new gee(c);return n.runWebGLProgram(u,[r,o],"float32")}const $ee={kernelName:Jx,backendName:"webgl",kernelFunc:Iee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nee(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s,c=Go(l,o.shape,a,1,i),u=new xee(c);return n.runWebGLProgram(u,[r,o],"float32")}const Tee={kernelName:Zx,backendName:"webgl",kernelFunc:Nee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eee=Ol+`
  return cos(x);
`,Ree=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${sa}
  return result;
`,Aee=ze({opSnippet:Eee,packedOpSnippet:Ree}),Dee={kernelName:Su,backendName:"webgl",kernelFunc:Aee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ee=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Fee=ze({opSnippet:_ee}),Oee={kernelName:Iu,backendName:"webgl",kernelFunc:Fee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zee{constructor(e,n,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,c]=e,[u]=n,[d,h]=s;this.outputShape=[u,d,h,c];const f=r==="bilinear"?1:0,[p,g]=[`${a-1}.0`,`${l-1}.0`],[x,m,y]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${p} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${p}`],[w,v,b]=h>1?[`${(l-1)/(h-1)}`,"(x2-x1) * width_ratio",`x1*${g} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${g}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${w});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${m};
        float width_scale = ${v};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${p} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${b};
        if( in_x < 0.0 || in_x > ${g} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mee=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:c}=s,u=new zee(r.shape,o.shape,a,l,c);return n.runWebGLProgram(u,[r,o,i],"float32")},Pee={kernelName:ty,backendName:"webgl",kernelFunc:Mee};var su;(function(t){t.Prod="*",t.Sum="+"})(su||(su={}));class Pk{constructor(e,n,s,r){this.op=e,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===su.Prod?"1.0":"0.0",a=s?i:`getX(${Lk(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let c="",u="";s?(c=r?`end != ${l-1}`:"end != 0",u=r?"end + 1":"end - 1"):(c=r?`end + pow2 < ${l}`:"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Je(o)} coords = getOutputCoords();
        int end = ${Bk(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${c}) {
          int idx = ${u};
          ${Bk(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${Lk(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function Lk(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}function Bk(t,e,n){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${n} for rank ${t} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vD(t,e,n,s,r,o){const i=e.shape.length,a=yt([s],i);let l=e;a!=null&&(l=Sn({inputs:{x:e},backend:n,attrs:{perm:a}}));const c=$t(1,i)[0];if(c!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const u=l.shape[c];let d=Yn({inputs:{x:l},backend:n});for(let h=0;h<=Math.ceil(Math.log2(u))-1;h++){const f=new Pk(t,l.shape,!1,o),p=[[h]],g=d;d=n.runWebGLProgram(f,[d],d.dtype,p),n.disposeIntermediateTensorInfo(g)}if(r){const h=new Pk(t,l.shape,r,o),f=d;d=n.runWebGLProgram(h,[d],d.dtype),n.disposeIntermediateTensorInfo(f)}if(a!=null){const h=Ho(a),f=Sn({inputs:{x:d},backend:n,attrs:{perm:h}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),f}return d}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return vD(su.Prod,r,n,o,i,a)}const Bee={kernelName:ey,backendName:"webgl",kernelFunc:Lee};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return vD(su.Sum,r,n,o,i,a)}const Wee={kernelName:Ip,backendName:"webgl",kernelFunc:Vee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=n.readSync(r.dataId),c=n.readSync(o.dataId),u=eD(l,c,o.dtype,o.shape,i);return n.makeTensorInfo([i],o.dtype,u)}else if(r.shape.length===2){const l=n.bufferSync(r),c=n.bufferSync(o),u=KY(l,c,i,a);return n.makeTensorInfo(u.shape,o.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const Gee={kernelName:ny,backendName:"webgl",kernelFunc:Uee};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hee{constructor(e,n,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=n,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${n};
      int offset_h = imod(h, ${n});
      int in_w = w / ${n};
      int offset_w = imod(w, ${n});
      int offset_d = (offset_h * ${n} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],l=i==="NHWC"?r.shape[1]:r.shape[2],c=i==="NHWC"?r.shape[2]:r.shape[3],u=i==="NHWC"?r.shape[3]:r.shape[1],d=l*o,h=c*o,f=u/(o*o),p=i==="NHWC"?[a,d,h,f]:[a,f,d,h],g=new Hee(p,o,i);return n.runWebGLProgram(g,[r],r.dtype)}const Kee={kernelName:sy,backendName:"webgl",kernelFunc:jee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bD{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=pn(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let c="",u="";s&&(r?c=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?c=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:c=`
          float activation(float x) {
            ${s}
          }
        `,u="result = activation(result);");const d=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${c}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${d}
        ${u}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class CD{constructor(e,n=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=pn(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,c=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,h=d;let f=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let m=0;m<d;m++)f+=`
          vec4 xTexelC${m*2};
          int xTexelC${m*2}Ready;
          vec4 xTexelC${m*2+1};
          int xTexelC${m*2+1}Ready;
          vec4 xC${m};`;f+=`
    for (int r = 0; r < ${u}; r++) {
      `;for(let m=0;m<d;m++)f+=`
          xTexelC${m*2} = vec4(0.0);
          xTexelC${m*2}Ready = 0;
          xTexelC${m*2+1} = vec4(0.0);
          xTexelC${m*2+1}Ready = 0;
          xC${m} = vec4(0.0);`;f+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let m=0;m<(h+1)/2;m++){const y=m*2;if(f+=`
          xC = xCCorner + ${y*c};
          `,l===1){if(y<d&&(a%2===1?(f+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,c===1&&y>0?f+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:f+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):f+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<d)){const w=a%2===0?Mx(c):c;c%2===0&&a%2===1||c%2!==0&&a%2!==1?(f+=`
                  xCOffset = xC + imod(pads[1], 2) + ${w};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,c>1?f+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:f+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):w===1?f+=`
                    xC${y+1} = xTexelC${y};
                    `:f+=`
                    xCOffset = xC + ${w};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<d&&(a%2===1?(f+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<d&&(f+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<d&&(f+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<d&&(f+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<d&&(f+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}f+=`
    }
  `,f+=`
      }
    `;let p="",g="";s&&(r?p=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?p=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:p=`vec4 activation(vec4 x) {
          ${s}
        }`,g="result = activation(result);");const x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${p}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${f}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:c}=s;let u=l;u==null&&(u=[1,1]),I(hn(i,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=nn(r.shape,o.shape,i,u,a,c,!0);let h;W().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?h=new CD(d):h=new bD(d);const f=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];return n.runWebGLProgram(h,[r,o],"float32",f)}const qee={kernelName:$p,backendName:"webgl",kernelFunc:Xee};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yee{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const n=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${n} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class Qee{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const n=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=n-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${n}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${n} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jee(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=s,d=nn(r.shape,u,i,a,l,c,!0),h=new Yee(d);return n.runWebGLProgram(h,[r,o],"float32")}const Zee={kernelName:ry,backendName:"webgl",kernelFunc:Jee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ete(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=s,d=nn(u,o.shape,i,a,l,c,!0),h=new Qee(d);return n.runWebGLProgram(h,[r,o],"float32")}const tte={kernelName:oy,backendName:"webgl",kernelFunc:ete};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nte{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ste(t){const{inputs:e,backend:n}=t,{x:s}=e,r=[...s.shape,...s.shape],o=j(s.shape),i=re({inputs:{x:s},backend:n,attrs:{shape:[o]}}),a=new nte(o),l=n.runWebGLProgram(a,[i],i.dtype),c=re({inputs:{x:l},backend:n,attrs:{shape:r}});return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(l),c}const rte={kernelName:n2,backendName:"webgl",kernelFunc:ste};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ote{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:n,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=e,{top:d,left:h}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${d}, ${h});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${n}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ite(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,c=dd(r.shape,o.shape,i,a,"NHWC",l);let u;const d=new ote(c);u=n.runWebGLProgram(d,[r,o],"float32");const h=re({inputs:{x:u},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(u),h}const ate={kernelName:Np,backendName:"webgl",kernelFunc:ite};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lte(t){const{inputs:e,backend:n,attrs:s}=t,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=Ow(r,o.length);Mw(i.length,l,o);const{path:c,steps:u}=Pw(a,l),d=u.length;let h=null,f=i.length;const p=[];for(let g=0;g<d;++g){for(const x of u[g]){const{permutationIndices:m,expandDims:y}=zw(f,l[x]);let w;Lw(m)?w=o[x]:(w=Sn({inputs:{x:o[x]},backend:n,attrs:{perm:m}}),p.push(w));const v=w.shape.slice();for(let b=0;b<y.length;++b)v.splice(y[b],0,1);Ue(w.shape,v)||(w=re({inputs:{x:w},backend:n,attrs:{shape:v}}),p.push(w)),h===null?h=w:(h=Iv({inputs:{a:w,b:h},backend:n}),p.push(h))}g<d-1&&(c[g]>=0&&(h=Lm({inputs:{x:h},backend:n,attrs:{axis:c[g]-(i.length-f),keepDims:!1}}),p.push(h)),f--)}for(const g of p)g!==h&&n.disposeIntermediateTensorInfo(g);return h}const cte={kernelName:iy,backendName:"webgl",kernelFunc:lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ute="return (x >= 0.0) ? x : (exp(x) - 1.0);",dte=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,hte=ze({opSnippet:ute,packedOpSnippet:dte}),fte={kernelName:Nu,backendName:"webgl",kernelFunc:hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pte="return (b >= 0.0) ? a : a * (b + 1.0);",mte=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,gte=t=>{const{inputs:e,backend:n}=t,{dy:s,y:r}=e,o=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fl(mte,s.shape,r.shape):new Ui(pte,s.shape,r.shape);return n.runWebGLProgram(o,[s,r],s.dtype)},xte={kernelName:ay,backendName:"webgl",kernelFunc:gte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yte=`
  return vec4(equal(a, b));
`,wte="return float(a == b);",vte=rn({opSnippet:wte,packedOpSnippet:yte,dtype:"bool",cpuKernelImpl:JY}),bte={kernelName:Tp,backendName:"webgl",kernelFunc:vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cte=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${Tw};
  float a1 = ${Ew};
  float a2 = ${Rw};
  float a3 = ${Aw};
  float a4 = ${Dw};
  float a5 = ${_w};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,kte=ze({opSnippet:Cte}),Ste={kernelName:Tu,backendName:"webgl",kernelFunc:kte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ite=Ol+`
  return exp(x);
`,$te=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,kD=ze({opSnippet:Ite,packedOpSnippet:$te,cpuKernelImpl:ZY,dtype:"float32"}),Nte={kernelName:Eu,backendName:"webgl",kernelFunc:kD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E1(t){const{inputs:e,attrs:n,backend:s}=t,{dim:r}=n,{input:o}=e,i=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(I(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+r+1),a.splice(l,0,1),re({inputs:{x:o},backend:s,attrs:{shape:a}})}const Tte={kernelName:Ep,backendName:"webgl",kernelFunc:E1};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vk="return exp(x) - 1.0;",Ete=ze({opSnippet:Vk,packedOpSnippet:Vk,cpuKernelImpl:eQ}),Rte={kernelName:Ru,backendName:"webgl",kernelFunc:Ete};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wk{constructor(e,n,s){this.variableNames=["real","imag"];const r=n[1];this.outputShape=n;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SD(t,e,n){const s=n.texData.get(t.dataId),r=j(t.shape),o=t.shape[t.shape.length-1],i=r/o,a=re({inputs:{x:t},backend:n,attrs:{shape:[i,o]}}),l=a.shape,c=new Wk("real",l,e),u=new Wk("imag",l,e),d=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],h=n.runWebGLProgram(c,d,"float32"),f=n.runWebGLProgram(u,d,"float32"),p=Qo({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);const g=re({inputs:{x:p},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(p),g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ate(t){const{inputs:e,backend:n}=t,{input:s}=e;return SD(s,!1,n)}const Dte={kernelName:ly,backendName:"webgl",kernelFunc:Ate};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _te{constructor(e,n){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dd(t){const{backend:e,attrs:n}=t,{shape:s,value:r}=n;let{dtype:o}=n;if(o=o||bl(r),o==="string"){const i=kt(o,j(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new _te(s,r),a=[[r]];return e.runWebGLProgram(i,[],o,a)}}const Fte={kernelName:cy,backendName:"webgl",kernelFunc:Dd};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ote{constructor(e){this.variableNames=["Image"],this.outputShape=[];const n=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${n} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${n}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zte={kernelName:uy,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,r=new Ote(n.shape);return s.runWebGLProgram(r,[n],n.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Uk="return floor(x);",Mte=ze({opSnippet:Uk,packedOpSnippet:Uk,cpuKernelImpl:tQ}),Pte={kernelName:Au,backendName:"webgl",kernelFunc:Mte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lte=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,Bte=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Vte=rn({opSnippet:Lte,packedOpSnippet:Bte,dtype:"int32"}),Wte={kernelName:Du,backendName:"webgl",kernelFunc:Vte};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ute{constructor(e){this.variableNames=["A"];const n=$n(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${n.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gte{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const n=$n(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${n.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${n.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hte={kernelName:WM,backendName:"webgl",kernelFunc:jte};let ca,zg=W().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function jte(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,c]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],u=[c,l],d=[c,l,o];if(a||i){const g=W().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(ca==null||g!==zg)&&(zg=g,ca=document.createElement("canvas").getContext("2d",{willReadFrequently:zg})),ca.canvas.width=l,ca.canvas.height=c,ca.drawImage(r,0,0,l,c),r=ca.canvas}const h=n.makeTensorInfo(u,"int32");n.texData.get(h.dataId).usage=ns.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(h.dataId),r);const f=W().getBool("WEBGL_PACK")?new Gte(d):new Ute(d),p=n.runWebGLProgram(f,[h],"int32");return n.disposeData(h.dataId),p}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:h,activation:f,leakyreluAlpha:p}=s,g=Yr(u),x=nn(r.shape,o.shape,l,d,c,h,!1,g);let m;const y=[],w=i!=null,v=a!=null,b=f==="leakyrelu",C=()=>{const S=[r,o],$=(N,A)=>{if(A==="NCHW"&&N.shape.length===1&&N.shape[0]!==1){const M=re({inputs:{x:N},backend:n,attrs:{shape:[N.shape[0],1,1]}});return y.push(M),M}return N};if(w&&S.push($(i,u)),v&&S.push($(a,u)),b){const N=n.makeTensorInfo([],"float32",Wo(p,"float32"));S.push(N),y.push(N)}return S};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))m=yD({x:r,filter:o,convInfo:x,backend:n,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else if(x.strideWidth<=2&&g==="channelsLast"&&W().getBool("WEBGL_EXP_CONV")){const S=f?tu(f,!0):null,$=new xD(x,w,S,v,b),N=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],A=C();m=n.runWebGLProgram($,A,"float32",N)}else if(W().getBool("WEBGL_CONV_IM2COL"))m=wD({x:r,filter:o,convInfo:x,backend:n,bias:i,activation:f,preluActivationWeights:a,leakyreluAlpha:p});else{const S=f?tu(f,!1):null,$=new gD(x,w,S,v,b),N=C();m=n.runWebGLProgram($,N,"float32")}const k=re({inputs:{x:m},backend:n,attrs:{shape:x.outShape}});return y.push(m),y.forEach(S=>n.disposeIntermediateTensorInfo(S)),k}const Xte={kernelName:ff,backendName:"webgl",kernelFunc:Kte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qte(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:h,leakyreluAlpha:f}=s,p=[];let g=u;g==null&&(g=[1,1]),I(hn(l,g),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${g}'`);const x=nn(r.shape,o.shape,l,g,c,d,!0),m=W().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,y=h?tu(h,m):null,w=[r,o],v=i!=null,b=a!=null,C=h==="leakyrelu";if(v&&w.push(i),b&&w.push(a),C){const N=n.makeTensorInfo([],"float32",Wo(f,"float32"));w.push(N),p.push(N)}let k;m?k=new CD(x,v,y,b,C):k=new bD(x,v,y,b,C);const S=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],$=n.runWebGLProgram(k,w,"float32",S);return p.forEach(N=>n.disposeIntermediateTensorInfo(N)),$}const Yte={kernelName:b2,backendName:"webgl",kernelFunc:qte};class Qte{constructor(e,n,s,r){this.sliceDim=e,this.strides=n,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=Je(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jte(t){const{inputs:e,backend:n}=t,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=j(s.shape),[l,c,u,d]=xw(s,r),h=re({inputs:{x:r},backend:n,attrs:{shape:[c,i]}}),f=re({inputs:{x:s},backend:n,attrs:{shape:[j(s.shape)/u,u]}});if(n.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const m=n.readSync(r.dataId),y=n.bufferSync(s),w=nQ(m,y,s.dtype,c,i,u,d,s.shape,a);return n.makeTensorInfo(l,s.dtype,w.values)}const p=new Qte(i,d,[c,u],s.shape),g=n.runWebGLProgram(p,[f,h],f.dtype),x=re({inputs:{x:g},backend:n,attrs:{shape:l}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(g),x}const Zte={kernelName:s2,backendName:"webgl",kernelFunc:Jte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ene{constructor(e,n){this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;const s=Je(this.rank),r=tne(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function tne(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<t.length;r++)r===2?s.push("index"):s.push(`${n[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ID(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,l=Ae(i,r.shape)[0];if(W().get("DEBUG")){const y=n.readSync(o.dataId),w=r.shape[l];for(let v=0;v<y.length;++v){const b=y[v];I(b<=w-1&&b>=0,()=>`GatherV2: the index value ${b} is not in [0, ${w-1}]`)}}const c=Vw(r,o,l,a),u=j(o.shape),d=[],h=re({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=re({inputs:{x:o},backend:n,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(h),d.push(f);const p=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const y=n.bufferSync(f),w=n.bufferSync(h),v=sQ(w,y,p);return d.forEach(b=>n.disposeIntermediateTensorInfo(b)),n.makeTensorInfo(c.outputShape,v.dtype,v.values)}const g=new ene(h.shape,p),x=n.runWebGLProgram(g,[h,f],h.dtype);d.push(x);const m=re({inputs:{x},backend:n,attrs:{shape:c.outputShape}});return d.forEach(y=>n.disposeIntermediateTensorInfo(y)),m}const nne={kernelName:Ap,backendName:"webgl",kernelFunc:ID};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sne="return float(a > b);",rne=`
  return vec4(greaterThan(a, b));
`,one=rn({opSnippet:sne,packedOpSnippet:rne,cpuKernelImpl:rQ,dtype:"bool"}),ine={kernelName:Dp,backendName:"webgl",kernelFunc:one};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ane="return float(a >= b);",lne=`
  return vec4(greaterThanEqual(a, b));
`,cne=rn({opSnippet:ane,packedOpSnippet:lne,dtype:"bool",cpuKernelImpl:oQ}),une={kernelName:_u,backendName:"webgl",kernelFunc:cne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dne(t){const{inputs:e,backend:n}=t,{input:s}=e;return SD(s,!0,n)}const hne={kernelName:dy,backendName:"webgl",kernelFunc:dne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fne="return float(!isnan(x) && !isinf(x));",pne=ze({opSnippet:fne,dtype:"bool"}),mne={kernelName:Ou,backendName:"webgl",kernelFunc:pne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gne="return float(isinf(x));",xne=ze({opSnippet:gne,dtype:"bool"}),yne={kernelName:zu,backendName:"webgl",kernelFunc:xne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wne="return float(isnan(x));",vne=ze({opSnippet:wne,dtype:"bool"}),bne={kernelName:Mu,backendName:"webgl",kernelFunc:vne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cne="return float(a < b);",kne=`
  return vec4(lessThan(a, b));
`,Sne=rn({opSnippet:Cne,packedOpSnippet:kne,cpuKernelImpl:iQ,dtype:"bool"}),Ine={kernelName:Fp,backendName:"webgl",kernelFunc:Sne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $ne="return float(a <= b);",Nne=`
  return vec4(lessThanEqual(a, b));
`,Tne=rn({opSnippet:$ne,packedOpSnippet:Nne,cpuKernelImpl:aQ,dtype:"bool"}),Ene={kernelName:Op,backendName:"webgl",kernelFunc:Tne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rne(t){const{backend:e,attrs:n}=t,{start:s,stop:r,num:o}=n,i=lQ(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const Ane={kernelName:r2,backendName:"webgl",kernelFunc:Rne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Dne=Ol+`
  return x < 0.0 ? 0./0. : log(x);
`,_ne=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Fne=ze({opSnippet:Dne,packedOpSnippet:_ne,cpuKernelImpl:cQ}),One={kernelName:Pu,backendName:"webgl",kernelFunc:Fne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zne=Ol+`
  return log(1.0 + x);
`,Mne=ze({opSnippet:zne}),Pne={kernelName:Lu,backendName:"webgl",kernelFunc:Mne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lne="return float(a >= 1.0 && b >= 1.0);",Bne=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Vne=rn({opSnippet:Lne,packedOpSnippet:Bne,dtype:"bool"}),Wne={kernelName:zp,backendName:"webgl",kernelFunc:Vne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Une="return float(!(x >= 1.0));",Gne=ze({opSnippet:Une}),Hne={kernelName:Mp,backendName:"webgl",kernelFunc:Gne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jne="return float(a >= 1.0 || b >= 1.0);",Kne=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Xne=rn({opSnippet:jne,packedOpSnippet:Kne,dtype:"bool"}),qne={kernelName:Pp,backendName:"webgl",kernelFunc:Xne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yne{constructor(e,n,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Qne{constructor(e,n,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=n,a=e[3]-1;this.outputShape=e;let l;const c=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${c})`:o===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jne=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s,c=W().getBool("WEBGL_PACK_NORMALIZATION")?new Qne(r.shape,o,i,a,l):new Yne(r.shape,o,i,a,l);return n.runWebGLProgram(c,[r],r.dtype)},Zne={kernelName:Lp,backendName:"webgl",kernelFunc:Jne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ese{constructor(e,n,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=n,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${n})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${n} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tse=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:c,beta:u}=s,d=new ese(r.shape,a,l,c,u);return n.runWebGLProgram(d,[r,o,i],r.dtype)},nse={kernelName:fy,backendName:"webgl",kernelFunc:tse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sse(t,e,n,s){const r=j(e),i=j(t.shape)/r,a=re({inputs:{x:t},attrs:{shape:[i,r]},backend:s}),l=ra(a,t.dtype,"max",s),c=re({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $D(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,l=Ae(o,r.shape);let c=l;const u=yt(c,a),d=u!=null,h=n.shouldExecuteOnCPU([r]);let f=r;if(d){if(h){const w=n.texData.get(f.dataId).values,v=new Array(a);for(let k=0;k<v.length;k++)v[k]=r.shape[u[k]];const b=kv(w,r.shape,r.dtype,u,v);f=n.makeTensorInfo(v,r.dtype);const C=n.texData.get(f.dataId);C.values=b}else f=Pm(r,u,n);c=$t(c.length,a)}sn("max",c,a);const[p,g]=Yt(f.shape,c);let x=p;i&&(x=Dt(p,l));let m;if(h){const w=n.texData.get(f.dataId).values,v=uQ(w,j(g),x,r.dtype);m=n.makeTensorInfo(x,r.dtype);const b=n.texData.get(m.dataId);b.values=v}else m=sse(f,g,x,n);return d&&n.disposeIntermediateTensorInfo(f),m}const rse={kernelName:Bp,backendName:"webgl",kernelFunc:$D};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ose=Sv+`
  return max(a, b);
`,ise=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+sa+`
  return result;
`,ase=rn({opSnippet:ose,packedOpSnippet:ise,cpuKernelImpl:dQ}),lse={kernelName:Bu,backendName:"webgl",kernelFunc:ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;Ed(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,c=1;I(hn(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);const u=Rs(r.shape,o,i,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&Ue(u.inShape,u.outShape))return Yn({inputs:{x:r},backend:n});const d=new nu(u,"max",!1);return n.runWebGLProgram(d,[r],r.dtype)}const use={kernelName:Vp,backendName:"webgl",kernelFunc:cse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:l,dimRoundingMode:c}=s,u=[1,1,1],d=qr(r.shape,o,i,u,a,c,l),h=new $v(d,"max",!1);return n.runWebGLProgram(h,[r],r.dtype)}const hse={kernelName:Wp,backendName:"webgl",kernelFunc:dse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fse{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,l=i-1-e.padInfo.left,c=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${n}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class pse{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const n=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,c=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.front,h=c-1-e.padInfo.top,f=u-1-e.padInfo.left,p=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${h}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${n}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${p} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mse(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=s,d=[1,1,1],h=qr(i.shape,a,l,d,c,u),f=new $v(h,"max",!0),p=n.runWebGLProgram(f,[i],i.dtype),g=new pse(h),x=n.runWebGLProgram(g,[r,p],i.dtype);return n.disposeIntermediateTensorInfo(p),x}const gse={kernelName:my,backendName:"webgl",kernelFunc:mse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xse(t){const{inputs:e,backend:n,attrs:s}=t,{dy:r,input:o,output:i}=e,a=o;Ed([o,i],"maxPoolGrad");const{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=s,h=Rs(a.shape,l,c,1,u,d),f=!0,p=new nu(h,"max",f),g=n.runWebGLProgram(p,[a],a.dtype),x=new fse(h),m=n.runWebGLProgram(x,[r,g],a.dtype);return n.disposeIntermediateTensorInfo(g),m}const yse={kernelName:py,backendName:"webgl",kernelFunc:xse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wse(t,e,n,s){let r=new nu(n,"max",!1);const o=s.runWebGLProgram(r,[t],"float32");r=new nu(n,"max",!0,!0,e);const i=s.runWebGLProgram(r,[t],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vse={kernelName:o2,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=n;I(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const c=[1,1];I(hn(o,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`);const u=Rs(s.shape,r,o,c,i),[d,h]=wse(s,a,u,l);return[d,h]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bse(t,e,n,s){const r=j(e),i=j(t.shape)/r,a=re({inputs:{x:t},attrs:{shape:[i,r]},backend:s}),l=ra(a,"float32","mean",s),c=re({inputs:{x:l},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),c}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cse={kernelName:Up,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:r,axis:o}=e,i=n,a=s.shape.length,l=Ae(o,s.shape);let c=l;const u=yt(c,a),d=u!=null,h=i.shouldExecuteOnCPU([s]),f=[];let p=s;if(d){if(h){const v=i.texData.get(p.dataId).values,b=new Array(a);for(let S=0;S<b.length;S++)b[S]=s.shape[u[S]];const C=kv(v,s.shape,s.dtype,u,b);p=i.makeTensorInfo(b,s.dtype);const k=i.texData.get(p.dataId);k.values=C}else p=Pm(s,u,i);f.push(p),c=$t(c.length,a)}sn("sum",c,a);const[g,x]=Yt(p.shape,c);let m=g;r&&(m=Dt(g,l));const y=bse(p,x,m,i);for(const w of f)i.disposeIntermediateTensorInfo(w);return y}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kse(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=Ae(o,r.shape);let c=l;const u=yt(c,a);let d=r;u!=null&&(d=Sn({inputs:{x:r},backend:n,attrs:{perm:u}}),c=$t(c.length,r.shape.length)),sn("min",c,a);const[h,f]=Yt(d.shape,c),p=j(f),g=re({inputs:{x:d},backend:n,attrs:{shape:[-1,p]}}),x=ra(g,g.dtype,"min",n);let m;if(i){const y=Dt(h,l);m=re({inputs:{x},backend:n,attrs:{shape:y}})}else m=re({inputs:{x},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(x),u!=null&&n.disposeIntermediateTensorInfo(d),m}const Sse={kernelName:Gp,backendName:"webgl",kernelFunc:kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ise=Sv+`
  return min(a, b);
`,$se=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+sa+`
  return result;
`,Nse=rn({opSnippet:Ise,packedOpSnippet:$se,cpuKernelImpl:hQ}),Tse={kernelName:Vu,backendName:"webgl",kernelFunc:Nse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ese{constructor(e,n,s){this.variableNames=["x"],this.outputShape=n.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,o=Je(r),i=n.map(u=>u[0]).join(","),a=n.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),c=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Rse{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((p,g)=>p[0]+e[g]+p[1]);const r=e.length,o=Je(r),i=n.map(p=>p[0]).join(","),a=n.map((p,g)=>p[0]+e[g]).join(","),l=vn("rc",r),c=vn("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${c.slice(-2).join()})`,h=s==="reflect"?0:1;let f="";if(r===1){const p=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${h};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${h};
        }
        source -= start;
      `;f=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[r-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{const p=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${h}) +
                gte * ((end - 1) * 2 - source + ${h});
        source -= start;
      `;f=`
        ${o} rc = outputLoc;
        ${p}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[r-1]} += 1;
        if(${u}) {
          ${p}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${p}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[r-1]} += 1;
          if(${u}) {
            ${p}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ase=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:r,mode:o}=n,i=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Rse(s.shape,r,o):new Ese(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},Dse={kernelName:Hp,backendName:"webgl",kernelFunc:Ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _se=`if (b == 0.0) return NAN;
  return mod(a, b);`,Fse=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+sa+`
  return result;
`,Ose=rn({opSnippet:_se,packedOpSnippet:Fse}),zse={kernelName:Wu,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Mse{constructor(e,n,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${n-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${n-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pse=`
if (a == b) {
  return 1.0;
};
return a / b;`,Lse=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,ND=rn({opSnippet:Pse,packedOpSnippet:Lse,checkOutOfBounds:!0}),Bse={kernelName:$u,backendName:"webgl",kernelFunc:ND};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gk="return a - b;",TD=rn({opSnippet:Gk,packedOpSnippet:Gk,supportsComplex:!0,cpuKernelImpl:_Q}),Vse={kernelName:rd,backendName:"webgl",kernelFunc:TD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ED(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{dim:o}=s,i=Ae([o],r.shape),a=$D({inputs:{x:r},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),l=Dt(a.shape,i),c=re({inputs:{x:a},backend:n,attrs:{shape:l}}),u=TD({inputs:{a:r,b:c},backend:n}),d=kD({inputs:{x:u},backend:n}),h=Lm({inputs:{x:d},backend:n,attrs:{axis:i,keepDims:!1}}),f=re({inputs:{x:h},backend:n,attrs:{shape:l}}),p=ND({inputs:{a:d,b:f},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),p}const Wse={kernelName:cm,backendName:"webgl",kernelFunc:ED};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Use(t){const{inputs:e,backend:n,attrs:s}=t,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,l=a?r:ED({inputs:{logits:r},backend:n,attrs:{dim:r.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new Mse(c,u,o),h=[[i]],f=n.runWebGLProgram(d,[l],"int32",h);return a||n.disposeIntermediateTensorInfo(l),f}const Gse={kernelName:i2,backendName:"webgl",kernelFunc:Use};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hse=Ds+`
  return -x;
`,jse=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Kse(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const o=n.texData.get(s.dataId),[i,a]=pQ(o.values,s.shape,s.dtype);return n.makeTensorInfo(a,s.dtype,i)}let r;return W().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new po(s.shape,jse):r=new fr(s.shape,Hse),n.runWebGLProgram(r,[s],s.dtype)}const Xse={kernelName:jp,backendName:"webgl",kernelFunc:Kse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qse=dw;function Yse(t){es("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s,c=n.readSync(r.dataId),u=n.readSync(o.dataId),{selectedIndices:d}=qse(c,u,i,a,l);return n.makeTensorInfo([d.length],"int32",new Int32Array(d))}const Qse={kernelName:gy,backendName:"webgl",kernelFunc:Yse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jse=hw;function Zse(t){es("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=s,u=n.readSync(r.dataId),d=n.readSync(o.dataId),{selectedIndices:h,validOutputs:f}=Jse(u,d,i,a,l,c);return[n.makeTensorInfo([h.length],"int32",new Int32Array(h)),n.makeTensorInfo([],"int32",new Int32Array([f]))]}const ere={kernelName:xy,backendName:"webgl",kernelFunc:Zse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tre=fw;function nre(t){es("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=s,u=n.readSync(r.dataId),d=n.readSync(o.dataId),h=i,f=a,p=l,g=c,{selectedIndices:x,selectedScores:m}=tre(u,d,h,f,p,g);return[n.makeTensorInfo([x.length],"int32",new Int32Array(x)),n.makeTensorInfo([m.length],"float32",new Float32Array(m))]}const sre={kernelName:yy,backendName:"webgl",kernelFunc:nre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rre{constructor(e,n,s,r){this.variableNames=["indices"],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ore=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s,c=j(r.shape),u=new rre(c,i,a,l),d=re({inputs:{x:r},backend:n,attrs:{shape:[c]}}),h=n.runWebGLProgram(u,[d],o);n.disposeIntermediateTensorInfo(d);const f=[...r.shape,i],p=re({inputs:{x:h},backend:n,attrs:{shape:f}});return n.disposeIntermediateTensorInfo(h),p},ire={kernelName:qp,backendName:"webgl",kernelFunc:ore};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vf(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="complex64"){const r=Ad({inputs:{input:s},backend:n}),o=Vf({inputs:{x:r},backend:n}),i=Bm({inputs:{input:s},backend:n}),a=Vf({inputs:{x:i},backend:n}),l=Qo({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return Dd({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:n})}const are={kernelName:hm,backendName:"webgl",kernelFunc:Vf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RD(t){const{inputs:e,backend:n}=t,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Ad({inputs:{input:s},backend:n}),o=RD({inputs:{x:r},backend:n}),i=Bm({inputs:{input:s},backend:n}),a=Vf({inputs:{x:i},backend:n}),l=Qo({inputs:{real:o,imag:a},backend:n});return n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(a),l}else return Dd({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const lre={kernelName:Xp,backendName:"webgl",kernelFunc:RD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cre(t){const{inputs:e,backend:n,attrs:s}=t,{axis:r}=s;if(e.length===1)return E1({inputs:{input:e[0]},backend:n,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(u=>{Px(o,u.shape,"All tensors passed to stack must have matching shapes"),I(i===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(u=>{const d=E1({inputs:{input:u},backend:n,attrs:{dim:r}});return a.push(d),d}),c=mD({inputs:l,backend:n,attrs:{axis:r}});return a.forEach(u=>n.disposeIntermediateTensorInfo(u)),c}const ure={kernelName:Yp,backendName:"webgl",kernelFunc:cre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dre{constructor(e,n,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((c,u)=>c[0]+e[u]+c[1]);const r=e.length,o=Je(r),i=n.map(c=>c[0]).join(","),a=n.map((c,u)=>c[0]+e[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hre{constructor(e,n,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((g,x)=>g[0]+e[x]+g[1]);const r=e.length,o=Je(r),i=n.map(g=>g[0]).join(","),a=n.map((g,x)=>g[0]+e[x]).join(","),l=vn("rc",r),c=vn("source",r),u=`${l[r-1]} < ${this.outputShape[r-1]}`,d=r===1?"source":`vec2(${c.slice(-2).join()})`,h=[`${o} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${u}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${u}) {`],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let p="";for(let g=0,x=r===1?2:4;g<x;g++)p+=`
        ${h[g]}
        if (${f}) {
          result[${g}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${g}] = getChannel(getX(${c.join()}), ${d});
        }
      `;p+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${p}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AD=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{paddings:o,constantValue:i}=s;if(j(r.shape)===0){const c=o.map((u,d)=>u[0]+r.shape[d]+u[1]);return Dd({backend:n,attrs:{shape:c,value:i,dtype:r.dtype}})}const a=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hre(r.shape,o,i):new dre(r.shape,o,i),l=[[i]];return n.runWebGLProgram(a,[r],r.dtype,l)},fre={kernelName:Qp,backendName:"webgl",kernelFunc:AD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pre=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,mre=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+sa+`
  return result;
`,gre=rn({opSnippet:pre,packedOpSnippet:mre}),xre={kernelName:Gu,backendName:"webgl",kernelFunc:gre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yre(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=[],c=Ae(o,r.shape);let u=c;const d=yt(u,a);let h=r;d!=null&&(h=Sn({inputs:{x:r},backend:n,attrs:{perm:d}}),u=$t(u.length,a),l.push(h)),sn("prod",u,a);let f;if(n.shouldExecuteOnCPU([h])){const p=n.texData.get(h.dataId).values,{outVals:g,outShape:x,outDtype:m}=gQ(h.shape,h.dtype,p,u);f=n.makeTensorInfo(x,m,g)}else{const[p,g]=Yt(h.shape,u),x=j(g),m=re({inputs:{x:h},backend:n,attrs:{shape:[-1,x]}}),y=Ay(r.dtype),w=ra(m,y,"prod",n);f=re({inputs:{x:w},backend:n,attrs:{shape:p}}),l.push(m),l.push(w)}if(i){l.push(f);const p=Dt(f.shape,c);f=re({inputs:{x:f},backend:n,attrs:{shape:p}})}return l.forEach(p=>n.disposeIntermediateTensorInfo(p)),f}const wre={kernelName:Zp,backendName:"webgl",kernelFunc:yre};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vre(t){const{inputs:e,backend:n,attrs:s}=t,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,l=r.map(m=>n.readSync(m.dataId)),c=r.map(m=>m.shape),u=n.readSync(o.dataId),d=n.readSync(i.dataId),[h,f,p]=xQ(l,c,u,o.shape,o.dtype,d,i.shape,a),g=h.map(m=>n.makeTensorInfo([m.length],"int32",m)),x=n.makeTensorInfo(p,o.dtype,f);return g.concat([x])}const bre={kernelName:a2,backendName:"webgl",kernelFunc:vre};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cre(t){const{inputs:e,backend:n}=t,{starts:s,limits:r,deltas:o}=e,i=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(o.dataId),[c,u]=yQ(i,s.shape,s.dtype,a,r.shape,l,o.shape),d=n.makeTensorInfo([c.length],"int32",c),h=n.makeTensorInfo([u.length],s.dtype,u);return[d,h]}const kre={kernelName:l2,backendName:"webgl",kernelFunc:Cre};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sre(t){const{inputs:e,backend:n,attrs:s}=t,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,c=n.readSync(r.dataId),u=n.readSync(o.dataId),d=n.readSync(i.dataId),h=a.map(x=>n.readSync(x.dataId)),f=a.map(x=>x.shape),[p,g]=wQ(c,r.shape,u,o.shape,o.dtype,d,i.shape,h,f,l);return n.makeTensorInfo(p,o.dtype,g)}const Ire={kernelName:c2,backendName:"webgl",kernelFunc:Sre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DD=t=>{const{backend:e,attrs:n}=t,{start:s,stop:r,step:o,dtype:i}=n,a=vQ(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},$re={kernelName:wy,backendName:"webgl",kernelFunc:DD};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nre="return 1.0 / x;",Tre=ze({opSnippet:Nre}),Ere={kernelName:Hu,backendName:"webgl",kernelFunc:Tre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Rre=Ds+`
  return (x < 0.0) ? 0.0 : x;
`,Are=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Dre=ze({opSnippet:Rre,packedOpSnippet:Are}),_re={kernelName:ju,backendName:"webgl",kernelFunc:Dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fre=Ds+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Ore=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zre=ze({opSnippet:Fre,packedOpSnippet:Ore}),Mre={kernelName:Ku,backendName:"webgl",kernelFunc:zre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Pre{constructor(e,n,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;o?h="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":h="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Lre{constructor(e,n,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s];let h;o?h="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":h="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${h};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bre(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,c]=a,u=W().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Lre(r.shape,l,c,o,i):new Pre(r.shape,l,c,o,i);return n.runWebGLProgram(u,[r],"float32")}const Vre={kernelName:nm,backendName:"webgl",kernelFunc:Bre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Wre{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,o]=n,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],c=[s&&i>1?i-1:i,s&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,f=1/d,p=Math.ceil(h)*2+2,g=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ure(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s,a=new Wre(o.shape,r.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}const Gre={kernelName:Cy,backendName:"webgl",kernelFunc:Ure};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hre{constructor(e,n,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let f;o?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jre{constructor(e,n,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,c]=e;this.outputShape=[i,n,s,c];const u=[r&&n>1?a-1:a,r&&s>1?l-1:l],d=[r&&n>1?n-1:n,r&&s>1?s-1:s],h=r?"0.5":"0.0";let f;o?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kre(t){const{inputs:e,backend:n,attrs:s}=t,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,c]=a,u=W().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new jre(r.shape,l,c,o,i):new Hre(r.shape,l,c,o,i);return n.runWebGLProgram(u,[r],r.dtype)}const Xre={kernelName:tm,backendName:"webgl",kernelFunc:Kre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qre{constructor(e,n,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;const[,r,o]=n,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],c=[s&&i>1?i-1:i,s&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],h=1/u,f=1/d,p=Math.ceil(h)*2+2,g=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${h});
        const float invWidthScale = float(${f});

        const int winHeight = int(${p});
        const int winWidth = int(${g});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yre(t){const{inputs:e,backend:n,attrs:s}=t,{images:r,dy:o}=e,{alignCorners:i}=s,a=new qre(o.shape,r.shape,i);return n.runWebGLProgram(a,[o],o.dtype)}const Qre={kernelName:by,backendName:"webgl",kernelFunc:Yre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jre{constructor(e,n){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>n.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,l)=>r(l)).join(","),i=Je(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zre{constructor(e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=vn("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Je(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${o}){
            result.g = ${c(r.slice())};
          }
          if(${i}) {
            result.b = ${u(r.slice())};
            if(${o}) {
              result.a = ${d(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(p){return h(p)}function c(p){return p[s-1]="("+p[s-1]+" + 1)",h(p)}function u(p){return p[s-2]="("+p[s-2]+" + 1)",h(p)}function d(p){return p[s-1]="("+p[s-1]+" + 1)",p[s-2]="("+p[s-2]+" + 1)",h(p)}function h(p){const g=e.map((y,w)=>f(w,p)),x=g.join(","),m=g.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${m}))`}function f(p,g){return n.indexOf(p)!==-1&&e[p]!==1?`${e[p]} - ${g[p]} - 1`:`${g[p]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{dims:o}=s,i=r.shape.length,a=Ae(o,r.shape);if(i===0)return Yn({inputs:{x:r},backend:n});const l=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Zre(r.shape,a):new Jre(r.shape,a);return n.runWebGLProgram(l,[r],r.dtype)}const toe={kernelName:sm,backendName:"webgl",kernelFunc:eoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class noe{constructor(e,n){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof n=="number"?o=`float outputValue = ${n.toFixed(2)};`:o=`
        vec3 fill = vec3(${n.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const soe={kernelName:Ey,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:r,fillValue:o,center:i}=e,a=n,l=new noe(s.shape,o),[c,u]=Iw(i,s.shape[1],s.shape[2]),d=[[c,u,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,d)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const roe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,ooe=ze({opSnippet:roe}),ioe={kernelName:Xu,backendName:"webgl",kernelFunc:ooe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aoe="return inversesqrt(x);",loe=ze({opSnippet:aoe,cpuKernelImpl:bQ}),coe={kernelName:qu,backendName:"webgl",kernelFunc:loe};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nv{constructor(e,n,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const c=Je(o.length),u=Je(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let g="";l&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,m=n>1?"strides[j]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${n}; j++) {
              int index = round(${h});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${p};
              found = true;
            }
          }
          setOutput(mix(${x}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uoe{constructor(e,n,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const c=Je(o.length),u=Je(i.length);let d="";s===1?d="i":s===2&&(d="i, j");const h=`getIndices(${d})`;let f="";r===1?f="i":r===2&&(f="i, coords[1]");const p=`getUpdates(${f})`;let g="";l&&(g="coords[0], coords[1]");const x=`getDefaultValue(${g})`,m=n>1?"strides[j]":"strides",y=n>1?"strides[j + 1]":"strides";this.userCode=`
        ${c} strides = ${c}(${o});

        void main() {
          ${u} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${n}; j+=2) {
              ivec4 index = round(${h});
              flattenedIndex += index.xz * ${m};
              if (j + 1 < ${n}) {
                flattenedIndex += index.yw * ${y};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${p};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${x}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(t){const{inputs:e,backend:n,attrs:s}=t,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Ji(o,r,i),h=[d/c,c];if(d===0)return n.makeTensorInfo(i,r.dtype);const f=re({inputs:{x:r},backend:n,attrs:{shape:[l,a]}}),p=re({inputs:{x:o},backend:n,attrs:{shape:[l,c]}}),g=n.makeTensorInfo([],"float32",new Float32Array([0]));let x;W().getBool("WEBGL_PACK")?x=new uoe(l,a,f.shape.length,p.shape.length,u,h):x=new Nv(l,a,f.shape.length,p.shape.length,u,h);const m=n.runWebGLProgram(x,[p,f,g],p.dtype),y=re({inputs:{x:m},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),y}const hoe={kernelName:u2,backendName:"webgl",kernelFunc:doe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class foe{constructor(e,n,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(n+1))}; ++i) { if (left >= right) break;`,a=W().getNumber("WEBGL_VERSION")===2?o:i,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function poe(t){const{inputs:e,backend:n,attrs:s}=t,{sortedSequence:r,values:o}=e,{side:i}=s,a=new foe(r.shape[0],r.shape[1],o.shape[1],i),l=[[r.shape[1]]];return n.runWebGLProgram(a,[r,o],"int32",l)}const moe={kernelName:h2,backendName:"webgl",kernelFunc:poe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class goe{constructor(e,n,s){this.variableNames=["c","a","b"],this.outputShape=n;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<n.length;u++)c.push(`${a[u]}`),u<e&&l.push(`${a[u]}`);r=l.join(),o=c.join()}const i=Je(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xoe(t){const{inputs:e,backend:n}=t,{condition:s,t:r,e:o}=e,i=new goe(s.shape.length,r.shape,r.shape.length);return n.runWebGLProgram(i,[s,r,o],Xn(r.dtype,o.dtype))}const yoe={kernelName:rm,backendName:"webgl",kernelFunc:xoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const woe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Cm};
  float scale = ${km};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,voe=ze({opSnippet:woe}),boe={kernelName:Yu,backendName:"webgl",kernelFunc:voe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Coe=Ol+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,koe=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Soe=ze({opSnippet:Coe,packedOpSnippet:koe,cpuKernelImpl:kQ}),Ioe={kernelName:ed,backendName:"webgl",kernelFunc:Soe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $oe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Noe=ze({opSnippet:$oe}),Toe={kernelName:Zu,backendName:"webgl",kernelFunc:Noe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eoe=Ol+`
  return sin(x);
`,Roe=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${sa}
  return result;
`,Aoe=ze({opSnippet:Eoe,packedOpSnippet:Roe}),Doe={kernelName:Qu,backendName:"webgl",kernelFunc:Aoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _oe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Foe=ze({opSnippet:_oe}),Ooe={kernelName:Ju,backendName:"webgl",kernelFunc:Foe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zoe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Moe=ze({opSnippet:zoe}),Poe={kernelName:td,backendName:"webgl",kernelFunc:Moe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Loe=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{blockShape:o,paddings:i}=s;I(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((m,y)=>m*y),l=[[0,0]];l.push(...i);for(let m=1+o.length;m<r.shape.length;++m)l.push([0,0]);const c=[],u=AD({inputs:{x:r},backend:n,attrs:{paddings:l,constantValue:0}}),d=gd(u.shape,o,a,!1),h=xd(d.length,o.length,!1),f=yd(u.shape,o,a,!1),p=re({inputs:{x:u},backend:n,attrs:{shape:d}}),g=Sn({inputs:{x:p},backend:n,attrs:{perm:h}}),x=re({inputs:{x:g},backend:n,attrs:{shape:f}});return c.push(u),c.push(p),c.push(g),c.forEach(m=>n.disposeIntermediateTensorInfo(m)),x},Boe={kernelName:am,backendName:"webgl",kernelFunc:Loe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Voe(t){const{inputs:e,backend:n}=t,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=n.readSync(s.dataId),l=n.readSync(r.dataId),c=n.readSync(o.dataId),u=n.readSync(i.dataId)[0],[d,h,f,p,g]=IQ(a,s.shape,s.dtype,l,r.dtype,c,u);return[n.makeTensorInfo(h,s.dtype,d),n.makeTensorInfo([h[0]],r.dtype,f),n.makeTensorInfo([p.length],"bool",new Uint8Array(p.map(x=>Number(x)))),n.makeTensorInfo([g.length],s.dtype,new Int32Array(g))]}const Woe={kernelName:f2,backendName:"webgl",kernelFunc:Voe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uoe(t){const{inputs:e,backend:n}=t,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(n.readSync(r.dataId)),a=n.readSync(s.dataId),l=Array.from(n.readSync(o.dataId)),[c,u,d]=$Q(a,s.shape,s.dtype,i,l);return[n.makeTensorInfo(u,s.dtype,c),n.makeTensorInfo([d.length],o.dtype,new Int32Array(d))]}const Goe={kernelName:p2,backendName:"webgl",kernelFunc:Uoe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hoe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(o.dataId),[c,u]=nD(i,s.shape,s.dtype,a,l,!0);return n.makeTensorInfo(u,s.dtype,c)}const joe={kernelName:m2,backendName:"webgl",kernelFunc:Hoe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Koe(t){const{inputs:e,backend:n}=t,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=n.readSync(s.dataId),a=n.readSync(r.dataId),l=n.readSync(o.dataId),[c,u]=nD(i,s.shape,s.dtype,a,l);return n.makeTensorInfo(u,s.dtype,c)}const Xoe={kernelName:g2,backendName:"webgl",kernelFunc:Koe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qoe(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:h}=Ji(o,r,a),f=!1;if(o.dtype==="string"){const m=n.bufferSync(r),y=n.bufferSync(o),w=Do(n.readSync(i.dataId)[0]),v=CQ(m,y,a,h,u,c,l,d,w,f);return n.makeTensorInfo(a,v.dtype,v.values)}const p=new Nv(c,l,r.shape.length,o.shape.length,d,[h,1],f),g=n.runWebGLProgram(p,[o,r,i],o.dtype),x=re({inputs:{x:g},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(g),x}const Yoe={kernelName:x2,backendName:"webgl",kernelFunc:qoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qoe(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Ae(i,r.shape)[0],l=Bw(r,o,a),c=r.shape.length,u=new Array(c).fill(0),d=r.shape.slice();return l.map(h=>{const f=[...d];f[a]=h;const p=zl({inputs:{x:r},backend:n,attrs:{begin:u,size:f}});return u[a]+=h,p})}const Joe={kernelName:lm,backendName:"webgl",kernelFunc:Qoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hk="return sqrt(x);",Zoe=ze({opSnippet:Hk,packedOpSnippet:Hk,cpuKernelImpl:NQ}),eie={kernelName:nd,backendName:"webgl",kernelFunc:Zoe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tie="return x * x;",nie=ze({opSnippet:tie}),sie={kernelName:ky,backendName:"webgl",kernelFunc:nie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jk="return (a - b) * (a - b);",rie=rn({opSnippet:jk,packedOpSnippet:jk}),oie={kernelName:sd,backendName:"webgl",kernelFunc:rie};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iie(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=n.readSync(r.dataId),i=jr(o),a=TQ(i,"string",s);return n.makeTensorInfo(r.shape,"string",a)}const aie={kernelName:Sy,backendName:"webgl",kernelFunc:iie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lie({inputs:t,attrs:e,backend:n}){const{x:s}=t,r=Ds+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new fr(s.shape,r);return n.runWebGLProgram(o,[s],s.dtype)}const cie={kernelName:ld,backendName:"webgl",kernelFunc:lie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class uie{constructor(e,n,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=Je(s.length),i=Je(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((c,u)=>(l++,s.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${n});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function die(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:h}=s,{finalShapeSparse:f,finalShape:p,isIdentity:g,sliceDim0:x,isSimpleSlice:m,begin:y,end:w,strides:v}=Cw(r.shape,o,i,a,l,c,u,d,h);let b;if(g)b=re({inputs:{x:r},backend:n,attrs:{shape:p}});else if(x||m){I(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const k=ww(y,w,v),S=zl({inputs:{x:r},backend:n,attrs:{begin:y,size:k}});b=re({inputs:{x:S},backend:n,attrs:{shape:p}}),n.disposeIntermediateTensorInfo(S)}else if(n.shouldExecuteOnCPU([r])){const S=n.readSync(r.dataId),$=Re(r.shape,r.dtype,S),N=EQ(f,$,v,y);b=n.makeTensorInfo(p,r.dtype,N.values)}else{const S=new uie(y,v,f);b=n.runWebGLProgram(S,[r],r.dtype)}const C=re({inputs:{x:b},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(b),C}const hie={kernelName:Iy,backendName:"webgl",kernelFunc:die};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fie(t){const{inputs:e,backend:n,attrs:s}=t,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:c}=s,{data:u,dataSplits:d}=e,h=n.readSync(u.dataId),f=n.readSync(d.dataId),[p,g]=RQ(h,f,r,o,i,a,l,c);return[n.makeTensorInfo([p.length],"string",p),n.makeTensorInfo(d.shape,"int32",g)]}const pie={kernelName:y2,backendName:"webgl",kernelFunc:fie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mie(t){const{inputs:e,backend:n,attrs:s}=t,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=n.readSync(o.dataId),l=n.readSync(i.dataId)[0],[c,u,d]=AQ(a,l,r),h=u.length;return[n.makeTensorInfo([h,2],"int32",c),n.makeTensorInfo([h],"string",u),n.makeTensorInfo([2],"int32",new Int32Array(d))]}const gie={kernelName:w2,backendName:"webgl",kernelFunc:mie};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xie(t){const{inputs:e,backend:n,attrs:s}=t,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=n.readSync(o.dataId),a=DQ(i,r);return n.makeTensorInfo(o.shape,"int32",a)}const yie={kernelName:v2,backendName:"webgl",kernelFunc:xie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wie="return tan(x);",vie=ze({opSnippet:wie}),bie={kernelName:od,backendName:"webgl",kernelFunc:vie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cie=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,kie=ze({opSnippet:Cie}),Sie={kernelName:id,backendName:"webgl",kernelFunc:kie};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iie(t){const{inputs:e,backend:n,attrs:s}=t,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=Ji(i,o,r.shape),h=[d/c,c];if(d===0)return n.makeTensorInfo(r.shape,o.dtype);const f=re({inputs:{x:o},backend:n,attrs:{shape:[l,a]}}),p=re({inputs:{x:i},backend:n,attrs:{shape:[l,c]}}),g=re({inputs:{x:r},backend:n,attrs:{shape:h}}),x=new Nv(l,a,f.shape.length,p.shape.length,u,h,!1,!0),m=n.runWebGLProgram(x,[p,f,g],g.dtype),y=re({inputs:{x:m},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(m),y}const $ie={kernelName:d2,backendName:"webgl",kernelFunc:Iie};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nie{constructor(e,n){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*n[i];this.outputShape=s,this.rank=s.length;const r=Je(this.rank),o=Tie(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function Tie(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<t.length;r++)s.push(`imod(${n[r]}, ${t[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _D(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const l=n.readSync(r.dataId),c=r.dtype==="string"?l.map(h=>Do(h)):l,u=Re(r.shape,r.dtype,c),d=FQ(u,o);return n.makeTensorInfo(d.shape,d.dtype,d.values)}const i=new Nie(r.shape,o);return n.runWebGLProgram(i,[r],r.dtype)}const Eie={kernelName:ad,backendName:"webgl",kernelFunc:_D};class Rie{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class Aie{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ti(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function Kk(t){let e=1;for(;e<t;)e*=2;return e}function Die(t){const{inputs:e,backend:n,attrs:s}=t,{x:r}=e,{k:o,sorted:i}=s,a=W().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=W().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=r.shape,u=c[c.length-1];if(n.shouldExecuteOnCPU([r])||u<a||o>l){const N=n.readSync(r.dataId),[A,M]=OQ(N,c,r.dtype,o,i);return[n.makeTensorInfo(A.shape,A.dtype,A.values),n.makeTensorInfo(M.shape,M.dtype,M.values)]}if(o===0)return c[c.length-1]=0,[n.makeTensorInfo(c,r.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(u===1)return[r,Dd({attrs:{shape:c,dtype:"int32",value:0},backend:n})];const d=n.texData.get(r.dataId),h=d!==null&&d.isPacked,f=h?n.unpackTensor(r):r,g=j(c)/u,x=re({inputs:{x:f},attrs:{shape:[g,u]},backend:n});h&&ti(n,f);const m=Kk(o),y=Kk(u);let w=null;const v=()=>w===null?[x,x]:[x,w],b=(N,A,M)=>{const L=v(),V=new Rie(M),U=[[u],[w===null?1:0],[Number.NEGATIVE_INFINITY],[N],[A]],K=w;w=n.runWebGLProgram(V,L,"int32",U),ti(n,K)};for(let N=1;N<m;N*=2){const A=N*2;for(let M=N;M>=1;M/=2)b(A,M,[g,y])}for(let N=y;N>m;N/=2){const A=v(),M=new Aie([g,N/2]),V=[[u],[w===null?1:0],[m]],B=w;w=n.runWebGLProgram(M,A,"int32",V),ti(n,B);const U=m/2,K=U*2;for(let R=U;R>=1;R/=2)b(K,R,w.shape)}let C=w;w=zl({inputs:{x:w},backend:n,attrs:{begin:0,size:[g,o]}}),ti(n,C);let k=ID({inputs:{x,indices:w},backend:n,attrs:{axis:1,batchDims:1}});ti(n,x);const S=c.slice(0,-1);S.push(o),C=w,w=re({inputs:{x:w},attrs:{shape:S},backend:n}),ti(n,C);const $=k;return k=re({inputs:{x:k},attrs:{shape:S},backend:n}),ti(n,$),[k,w]}const _ie={kernelName:$y,backendName:"webgl",kernelFunc:Die};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Fie{constructor(e,n,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${n}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${n}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Oie(t){const{inputs:e,backend:n,attrs:s}=t,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:c}=s,[u,d,h,f]=r.shape,[p,g]=c??[d,h],x=[u,p,g,f],m=new Fie(d,h,i,a,l,x);return n.runWebGLProgram(m,[r,o],"float32")}const zie={kernelName:Ny,backendName:"webgl",kernelFunc:Oie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mie(t){const{inputs:e,attrs:n,backend:s}=t,{axis:r}=n,{x:o}=e;Ed(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:l,indices:c}=zQ(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const Pie={kernelName:Ty,backendName:"webgl",kernelFunc:Mie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lie(t){const{inputs:e,backend:n,attrs:s}=t,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,l=r.shape[o],c=new Array(a-1);let u=0;for(let g=0;g<a;g++)g!==o&&(c[u++]=i.shape[g]);const d=[],h=new Array(a).fill(0),f=i.shape.slice();f[o]=1;const p=new Array(l);for(let g=0;g<p.length;g++){h[o]=g;const x=zl({inputs:{x:i},backend:n,attrs:{begin:h,size:f}}),m=re({inputs:{x},backend:n,attrs:{shape:c}});p[g]=m,d.push(x)}return d.forEach(g=>n.disposeIntermediateTensorInfo(g)),p}const Bie={kernelName:um,backendName:"webgl",kernelFunc:Lie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Vie{constructor(e,n){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const l="0.0",c="sumValue",u=Math.floor(s/4)*4,d=s%4,h=`
        sumValue += dot(values, segFilter);
    `;let f="";o%s>0&&(f=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let p="";o%s>0&&(p=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${p}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${h}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${h}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${h}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${h}
        }
        setOutput(${c});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wie(t){const{inputs:e,backend:n,attrs:s}=t,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,l=[];let c=0;const u=yt([c],a);let d=r;u!=null&&(d=Sn({inputs:{x:r},backend:n,attrs:{perm:u}}),l.push(d),c=$t(1,a)[0]);const h=pT(d.shape,c,i),f=j([d.shape[c]]),p=re({inputs:{x:d},backend:n,attrs:{shape:[-1,f]}});l.push(p);const g=Ay(r.dtype),x=(v,b,C,k,S)=>{const $=v.shape[0],N=v.shape[1],A=fT(N,S),M={windowSize:A,inSize:N,batchSize:$,numSegments:S},L=new Vie(M,b),V=n.compileAndRun(L,[v,C],k);if(l.push(V),V.shape[1]===S)return V;const B=DD({backend:n,attrs:{start:0,stop:S,step:1,dtype:"float32"}}),U=_D({inputs:{x:B},backend:n,attrs:{reps:[N/A]}});return l.push(B),l.push(U),x(V,b,U,k,S)},m=x(p,"unsortedSegmentSum",o,g,i),y=re({inputs:{x:m},backend:n,attrs:{shape:h}});let w=y;if(u!=null){l.push(y);const v=Ho(u);w=Sn({inputs:{x:w},backend:n,attrs:{perm:v}})}return l.forEach(v=>n.disposeIntermediateTensorInfo(v)),w}const Uie={kernelName:dm,backendName:"webgl",kernelFunc:Wie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gie=[NJ,EJ,DJ,OJ,MJ,BJ,WJ,GJ,XJ,YJ,ZJ,nZ,oZ,cZ,hZ,pZ,gZ,vZ,CZ,SZ,TZ,OZ,MZ,VZ,UZ,qZ,QZ,tee,uJ,ree,cee,fee,wee,Cee,See,$ee,Tee,Dee,Oee,Pee,Bee,Wee,Gee,Kee,qee,Zee,tte,rte,ate,cte,fte,xte,bte,Ste,Nte,Tte,Rte,Dte,Fte,zte,Pte,Wte,Hte,Xte,Yte,Zte,nne,ine,une,cJ,hne,aee,mne,yne,bne,hJ,Ine,Ene,Ane,One,Pne,Wne,Hne,qne,Zne,nse,rse,lse,use,hse,gse,yse,vse,Cse,Sse,Tse,Dse,zse,Gse,mJ,Xse,Qse,ere,sre,HZ,ire,lre,ure,fre,xre,pJ,wre,bre,kre,Ire,$re,jZ,Bse,Ere,_re,Mre,xJ,Vre,Gre,Xre,Qre,toe,soe,ioe,coe,hoe,moe,yoe,boe,Ioe,Toe,Doe,Ooe,_Z,Wse,Poe,Boe,Woe,Goe,joe,Xoe,Yoe,Joe,eie,sie,oie,aie,cie,hie,pie,gie,yie,Vse,SJ,bie,Sie,$ie,Eie,_ie,zie,IJ,Pie,Bie,Uie,are];for(const t of Gie)C2(t);const ar={tank:0,warrior:1,archer:2,artillery:3},Sc={"advance-wait":4,advance:5,"wait-advance":6,"flank-left":7,"flank-right":8},ru=30,Wf=Math.floor(ru/(So/Io));let Ic=null;async function Hie(){try{Ic?console.log("Model is already loaded"):(Ic=await iH(window.location.origin+window.location.pathname+"/tfmodel/model.json"),console.log("Model loaded successfully"))}catch(t){throw console.error("Failed to load the model:",t),t}}function jie(t){return[t.data.map(e=>e.flat())]}async function Kie(t){if(Ic||await Hie(),!Ic)throw new Error("Model not loaded. Call loadModel() first.");const e=XV(jie(t)),n=Ic.predict(e),s=n.squeeze([0]),r=s.arraySync();return e.dispose(),n.dispose(),s.dispose(),{data:r.map(o=>o.reduce((i,a,l)=>(l%9===0&&i.push(o.slice(l,l+9)),i),[])),cols:ru,rows:Wf}}function FD(t){return t.map(e=>({...e,col:-e.col,row:-e.row}))}function Xie(t){const e=ru,n=Wf,s=Array.from({length:n},()=>Array.from({length:e},()=>Array(Object.keys(ar).length+Object.keys(Sc).length).fill(0)));let r=0;for(const o of t)for(let i=0;i<o.sizeRow;i++)for(let a=0;a<o.sizeCol;a++){const l=Io/2+o.row+i,c=So/2+o.col+a,u=Math.min(Math.floor(l*n/Io),Wf-1),d=Math.min(Math.floor(c*e/So),ru-1);s[u]&&s[u][d]&&(s[u][d][ar[o.type]]=1+(s[u][d][ar[o.type]]||0),r=Math.max(r,s[u][d][ar[o.type]]),o.command&&Sc[o.command]&&(s[u][d][Sc[o.command]]=1))}for(const o of s)for(const i of o)for(const a in ar)i[ar[a]]=i[ar[a]]/r;return{cols:e,rows:n,data:s}}function qie(t){var a,l,c;const e=[],n={},s=t.data.map(u=>u.map(d=>Object.values(ar).map(h=>d[h]))).flat(2),r=Math.min(...s),o=Math.max(...s),i=r+(o-r)*.5;for(let u=0;u<t.rows;u++)for(let d=0;d<t.cols;d++){const h=(l=(a=Object.keys(ar).map(p=>[p,t.data[u][d][ar[p]]]).sort((p,g)=>g[1]-p[1]).filter(p=>p[1]>i))==null?void 0:a[0])==null?void 0:l[0],f=(c=Object.keys(Sc).map(p=>[p,t.data[u][d][Sc[p]]]).sort((p,g)=>g[1]-p[1])[0])==null?void 0:c[0];h&&(n[u+","+d]={type:h,command:f})}for(let u=0;u<So;u++)for(let d=0;d<Io;d++){const h=Math.min(Math.floor(d*t.rows/Io),Wf-1),f=Math.min(Math.floor(u*t.cols/So),ru-1),p=n[h+","+f];p&&e.push({id:e.length+1,col:u-So/2,row:d-Io/2,sizeCol:1,sizeRow:1,type:p.type,command:p.command||"advance"})}return FD(e)}function Yie(t,e){if(e<=0)throw new Error("maxSoldiers must be a positive integer.");const n=t.map(o=>({...o}));let s=Uf(n);if(s<=e)return n;let r=s-e;for(n.sort((o,i)=>i.sizeCol*i.sizeRow-o.sizeCol*o.sizeRow);r>0;){let o=!1;for(let i of n)if(i.sizeCol>1&&i.sizeRow>1){const a=i.sizeCol*i.sizeRow-(i.sizeCol-1)*(i.sizeRow-1);if(a<=0)continue;if(a<=r&&(i.sizeCol-=1,i.sizeRow-=1,r-=a,o=!0,r<=0))break}if(!o){for(let i of n)if(i.sizeCol>1&&i.sizeRow>1){if(i.sizeCol/i.sizeRow>=1?(i.sizeCol-=1,r-=i.sizeRow):(i.sizeRow-=1,r-=i.sizeCol),r<=0)break}else if(i.sizeCol>1&&i.sizeRow===1){if(i.sizeCol-=1,r-=i.sizeRow,r<=0)break}else if(i.sizeRow>1&&i.sizeCol===1&&(i.sizeRow-=1,r-=i.sizeCol,r<=0))break;break}}if(r>0){n.sort((o,i)=>i.sizeCol*i.sizeRow-o.sizeCol*o.sizeRow);for(let o of n){for(;r>0;){if(o.sizeCol>1&&o.sizeRow>1)o.sizeCol-=1,o.sizeRow-=1,r-=o.sizeCol+o.sizeRow+1;else if(o.sizeCol>1)o.sizeCol-=1,r-=o.sizeRow;else if(o.sizeRow>1)o.sizeRow-=1,r-=o.sizeCol;else break;if(o.sizeCol<1||o.sizeRow<1){o.sizeCol=Math.max(o.sizeCol,1),o.sizeRow=Math.max(o.sizeRow,1);break}if(r<=0)break}if(r<=0)break}}return n}function Uf(t){return t.reduce((e,n)=>e+n.sizeCol*n.sizeRow,0)}function Qie(t){var u,d,h;if(t.length===0)return[];let e=1/0,n=1/0,s=-1/0,r=-1/0;t.forEach(f=>{e=Math.min(e,f.col),n=Math.min(n,f.row),s=Math.max(s,f.col+f.sizeCol-1),r=Math.max(r,f.row+f.sizeRow-1)});const o=s-e+1,i=r-n+1,a=Array.from({length:i},()=>Array(o).fill(null));t.forEach(f=>{var p;for(let g=f.row;g<f.row+f.sizeRow;g++)for(let x=f.col;x<f.col+f.sizeCol;x++){const m=g-n,y=x-e;if(a[m][y]&&((p=a[m][y])==null?void 0:p.unit.id)!==f.id)throw new Error("Units overlap on the grid.");a[m][y]={unit:f,processed:!1}}});const l=[];let c=Math.max(...t.map(f=>f.id))+1;for(let f=0;f<i;f++)for(let p=0;p<o;p++){const g=a[f][p];if(g&&!g.processed){const{unit:x}=g;let m=p;for(;m+1<o&&((u=a[f][m+1])==null?void 0:u.unit.type)===x.type&&((d=a[f][m+1])==null?void 0:d.unit.command)===x.command&&!((h=a[f][m+1])!=null&&h.processed);)m++;let y=f,w=!0;for(;w&&y+1<i;){for(let b=p;b<=m;b++){const C=a[y+1][b];if(!C||C.unit.type!==x.type||C.unit.command!==x.command||C.processed){w=!1;break}}w&&y++}for(let b=f;b<=y;b++)for(let C=p;C<=m;C++)a[b][C].processed=!0;const v={id:c++,col:p+e,row:f+n,sizeCol:m-p+1,sizeRow:y-f+1,type:x.type,command:x.command};l.push(v)}}return l}async function Jie(t){const e=Xie(t),n=await Kie(e);return Yie(Qie(qie(n)),Uf(t))}const Zie=()=>{const[t,e]=ye.useState([]),n=ye.useCallback(async s=>{let r;try{r=await Jie(s),console.log("Generated counter plan using AI model"),Uf(r)<Uf(s)*.7&&(console.warn("Counter plan has insufficient number of soldiers:",r.length,s.length),r=aC(s,lC))}catch(o){console.error("Error predicting counter plan:",o),r=aC(s,lC),console.log("Fallback to pre-defined plan selection")}return e(r),r},[]);return{oppositionPlan:t,generateOppositionPlan:()=>Ox,updateOppositionPlan:n}},eae=({unit:t,position:e,onModifyUnit:n})=>{const[s,r]=ye.useState(null),o=l=>{r(s===l?null:l)},i=l=>{n(t.id,{type:l}),r(null)},a=l=>{n(t.id,l),r(null)};return Se.jsxs(nae,{style:{left:e.x,top:e.y},children:[Se.jsxs(Xk,{onClick:()=>o("type"),children:[Se.jsx(sae,{src:j0[t.type],alt:t.type}),s==="type"&&Se.jsx(qk,{children:["warrior","archer","tank","artillery"].map(l=>Se.jsx(oae,{src:j0[l],alt:l,onClick:()=>i(l)},l))})]}),Se.jsxs(Xk,{onClick:()=>o("formation"),children:[Se.jsxs(rae,{children:[t.sizeCol,"x",t.sizeRow]}),s==="formation"&&Se.jsx(qk,{children:tae(t.sizeCol,t.sizeRow).map(l=>Se.jsxs(iae,{onClick:()=>a(l),children:[l.sizeCol,"x",l.sizeRow]},`${l.sizeCol}x${l.sizeRow}`))})]})]})};function tae(t,e){const n=t*e;return[{sizeCol:n,sizeRow:1},...Array.from({length:n-1},(s,r)=>({sizeCol:r+1,sizeRow:Math.ceil(n/(r+1))})).filter(s=>s.sizeCol*s.sizeRow<=n),{sizeCol:1,sizeRow:n}]}const nae=In.div`
  position: absolute;
  display: flex;
  gap: 10px;
  padding: 5px;
  background-color: rgba(255, 255, 255, 0.8);
  border-radius: 5px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  animation: fadeIn 0.3s ease-out;
  transform: translateX(-50%);

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }
`,Xk=In.div`
  position: relative;
  cursor: pointer;
`,sae=In.img`
  width: 32px;
  height: 32px;
`,rae=In.div`
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #ddd;
  border-radius: 4px;
  font-size: 12px;
  font-weight: bold;
  color: black;
`,qk=In.div`
  position: absolute;
  top: 100%;
  left: 0;
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 5px;
  padding: 5px;
  background-color: white;
  border-radius: 4px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  z-index: 10;
  animation: expandDown 0.2s ease-out;

  @keyframes expandDown {
    from {
      opacity: 0;
      transform: scaleY(0);
    }
    to {
      opacity: 1;
      transform: scaleY(1);
    }
  }
`,oae=In.img`
  width: 24px;
  height: 24px;
  cursor: pointer;
  transition: transform 0.1s;

  &:hover {
    transform: scale(1.1);
  }
`,iae=In.div`
  width: 36px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #eee;
  border-radius: 4px;
  font-size: 10px;
  font-weight: bold;
  cursor: pointer;
  transition: background-color 0.1s;
  color: black;

  &:hover {
    background-color: #ddd;
  }
`,Mg=100,Pg=50,ua=10;function aae(t,e,n,s){const r=e.getBoundingClientRect(),o=(t.col+t.sizeCol/2)*n/(e.width/r.width),i=(t.row+t.sizeRow)*s/(e.height/r.height);let a=o+r.left+r.width/2,l=i+r.top+r.height/2;return a+Mg+ua>r.right&&(a=o-Mg+r.left),l+Pg+ua>r.bottom&&(l=i-Pg+r.top+r.height/2),a=Math.max(r.left+ua,Math.min(a,r.right-Mg-ua)),l=Math.max(r.top+ua,Math.min(l,r.bottom-Pg-ua)),{x:a,y:l}}const lae=({units:t})=>{const e=()=>{};return Se.jsx(cae,{children:Se.jsx(Fx,{width:wi,height:vi,cellWidth:is*(wi/wi),cellHeight:Wr*(vi/vi),units:t,selectedUnitId:null,onCellClick:e,onMouseDown:e,onMouseMove:e,onMouseUp:e,onTouchStart:e,onTouchMove:e,onTouchEnd:e,onModifyUnit:e,isPlayerArea:!1})})},cae=In.div`
  width: 100%;
  height: 50%;
  position: relative;
`,uae=({onStartBattle:t,initialPlayerUnits:e})=>{const[n,s]=ye.useState([]),[r,o]=ye.useState([]),[i,a]=ye.useState(!1),[l,c]=ye.useState({x:0,y:0}),u=ye.useRef(null),{selectedUnit:d,handleUnitSelect:h,setSelectedUnit:f}=Vz(n),{handleDragStart:p,handleDragMove:g,handleDragEnd:x,isDragging:m}=Bz(n,s),{generateOppositionPlan:y,updateOppositionPlan:w}=Zie();ye.useEffect(()=>{s(e??dae),o(y())},[]);const v=ye.useCallback((k,S)=>{s($=>$.map(N=>N.id===k?{...N,...S}:N)),f($=>($==null?void 0:$.id)===k?{...$,...S}:$)},[]),b=ye.useCallback(async()=>{t(n,await w(n))},[n,r,t]),C=ye.useCallback((k,S)=>{h(k,S)},[h]);return ye.useEffect(()=>{if(m)a(!1);else if(d&&u.current){const k=aae(d,u.current.querySelector('canvas[data-is-player-area="true"]'),is,Wr);c(k),a(!0)}else a(!1)},[m,d]),Az(()=>{w(n).then(o)},1e3,[n]),Se.jsxs(hae,{ref:u,children:[Se.jsx(lae,{units:r}),Se.jsx(fae,{children:Se.jsx(Fx,{isPlayerArea:!0,width:wi,height:vi,cellWidth:is*(wi/wi),cellHeight:Wr*(vi/vi),units:n,selectedUnitId:(d==null?void 0:d.id)||null,onCellClick:C,onMouseDown:p,onMouseMove:g,onMouseUp:x,onTouchStart:p,onTouchMove:g,onTouchEnd:x,onModifyUnit:v})}),i&&d&&Se.jsx(eae,{unit:d,position:l,onModifyUnit:v}),Se.jsx(pae,{onClick:b,children:"Start Battle"})]})},dae=FD(Ox),hae=In.div`
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
`,fae=In.div`
  flex: 1;
  position: relative;
`,pae=In.button`
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 10px 20px;
  font-size: 16px;
  background-color: #4caf50;
  color: black;
  border: none;
  border-radius: 5px;
  cursor: pointer;
`;function mae(t,e){const n=new CustomEvent(t,{bubbles:!0,detail:e});document.dispatchEvent(n)}function gae(t,e){ye.useEffect(()=>{const n=s=>{e(s.detail)};return document.addEventListener(t,n,!1),()=>{document.removeEventListener(t,n,!1)}},[t,e])}const xae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkDEig5lQeMCgAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAC/SURBVFjD7ZZtCoAwCIbd6kxdyvN4ql2qPzEqhvg1JpEQBavpfPRNgKch8Ia3K8QK45gEwZE3gAqLbVemkwY4XJmQIOCcoBfHcgSSite8r/axMYvHdW/CzZohgCY5eWjfv33VjNwjGYvrS5rmcBzLERSjmHgVsH9fB/KqkWQ3kuKUVk/28kvxbNnGEYJIDSFvDUBQpbP7pNABjeSSUR/w1br9uSichw6jaRBoAyCDQOX/GYX39mem4lmT1W+5EJz4zihIINpFJwAAAABJRU5ErkJggg==",yae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkDEigo/7es+AAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAC/SURBVFjD7ZZtCoAwCIbd6kxdyvN4ql2qPzEqhvg1JpEQBavpfPRNgKch8Ia3K8QK45gEwZE3gAqLbVemkwY4XJmQIOCcoBfHcgSSite8r/axMYvHdW/CzZohgCY5eWjfv33VjNwjGYvrS5rmcBzLERSjmHgVsH9fB/KqkWQ3kuKUVk/28kvxbNnGEYJIDSFvDUBQpbP7pNABjeSSUR/w1br9uSichw6jaRBoAyCDQOX/GYX39mem4lmT1W+5EJz4zihIINpFJwAAAABJRU5ErkJggg==",wae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkJDB0Hj1I9CQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAADvSURBVFjDxVZBDsMwCCPZPtVn8RJ/a8/apZ0mLUtsBkukqpFKY2MIYMYtF+xYWzMzayI4BJJgCHQR3AWFKCVugkeP8/HzfdkckzOON1spBEocQdhDIeCLQyLfweaAB28DCDBXFcCXPSszdStWOQAxJ2QSLaH4zEj4QD0ohSiDxLSgqZUwnURFCCQSrQjY2GvZisGXJNom74eVsMp7ah6oBseguL0IbPH8ItU2xN2ViSgCzDYtmBl6QYwllTKScNR86NWVCTZ5hP/IASQBI0ogW4kQgSgJj/77aztGdgj+Ho4ueFgxNdm9qs1mL69S4QlnbztJQYeCiQAAAABJRU5ErkJggg==",vae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkMExcBvHpkyQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAACoSURBVFjD7ZVLDsAgCETF9Nqs5uLd2gUyKP2k4SVNjU0FhxFbK4qiKIofoMH5C3JjAiOwPvSXVXpMAVONY2FxLAQ1/zuc4DDGaXQnuJJyY3hCJhRy9578IEqIaAJtx1yGmoh4YLfmyiTYiUXg1dGp/fTUdOfIgDXTZOc6S0ISmgyIvtEsD0hCfbGY7PJdoE4AEHNplxEI46Z1Th3eaiysxDjdAxEjfo8TBO0sl43evjkAAAAASUVORK5CYII=",bae=W$`
#game-hud {
  position: fixed;
  z-index: 2;
  pointer-events: none;
  width: 100%;
  height: 100%;
  display: none;
  font-family: monospace;
}

#battle-result:empty {
  display: none;
}

#battle-result:not(:empty) div {
  width: 404px;
  height: 300px;
  color: red;
  left: 50%;
  top: 50%;
  margin: -150px -150px;
  text-align: center;
  position: absolute;
  font-size: 30px;
  background: rgba(0, 0, 0, 0.25);
}

#battle-result:not(:empty) {
  width: 100%;
  height: 100%;
  display: block;
  background: rgba(0, 0, 0, 0.3);
  position: fixed;
}

#battle-result span.result {
  color: black;
  font-weight: bold;
  animation: blinker 1s linear infinite;
}

@keyframes blinker {
  50% {
    opacity: 0;
  }
}

#battle-result span.winner {
  position: absolute;
  top: 80px;
  left: 0px;
  right: 0px;
  font-weight: bold;
}

#battle-result span.loser {
  position: absolute;
  top: 120px;
  left: 0px;
  right: 0px;
}

#battle-result span.continue {
  color: white;
  position: absolute;
  font-size: 15px;
  bottom: 5px;
  left: 5px;
}

#battle-result span {
  display: block;
}

#battle-stats {
  position: absolute;
  background: rgba(0, 0, 0, 0.25);
  padding: 20px;
}

#battle-time:before {
  content: 'Timer: ' attr(data-time);
  display: block;
  font-size: 30px;
  margin-bottom: 10px;
  color: white;
}

#battle-balance:before {
  display: block;
  content: "Who is winning?";
  font-size: 30px;
  width: 300px;
  color: white;
}

#battle-balance-left {
  height: 30px;
  width: 50%;
  background: red;
  float: left;
}


#battle-balance-right {
  height: 30px;
  width: 50%;
  background: #0fde0f;
  float: right;
}

#battle-balance-left, #battle-balance-right {
  overflow: hidden;
  text-overflow: 'hidden';
}

#battle-balance-left[data-winning=true], #battle-balance-right[data-winning=true] {
  border: 1px solid yellow;
  box-sizing: border-box;
}

#battle-balance-left[data-username]:before, #battle-balance-right[data-username]:before {
  display: block;
  content: attr(data-username);
  margin-left: 3px;
}

#battle-balance-left[data-winning=true]:before, #battle-balance-right[data-winning=true]:before {
  display: block;
  content: "Winning!";
  margin-left: 3px;
}



canvas#layer-default {
  max-width: 100vw;
  max-height: 100vh;
  position: absolute;
  pointer-events: none;
  background: radial-gradient(ellipse at center, #30c530 0%, #30c530 64%, #138c13 100%);
  z-index: 1;
}
`;let rt=0;const OD=rt++,zD=rt++,MD=rt++,Cae=rt++,kae=rt++,PD=rt++,LD=rt++,Sae=rt++;rt++;const Iae=rt++,$ae=rt++,Nae=rt++,Tae=rt++,BD=rt++,Eae=rt++,Rae=rt++,Aae=rt++,Dae=rt++,_ae=rt++,Fae=rt++,Oae=rt++,zae=rt++,Mae=rt++,Pae=rt++;rt++;const R1=rt++,A1=rt++,we={EPSILON:Math.pow(2,-16),length:function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},distanceSquared:function(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)},distance:function(t,e){return Math.sqrt(this.distanceSquared(t,e))},withinDistance:function(t,e,n){var s=t[0]-e[0],r=t[1]-e[1];if(Math.abs(s)>n||Math.abs(r)>n)return!1;var o=Math.pow(s,2)+Math.pow(r,2);return Math.sqrt(o)<n},normalize:function(t){return this.scale(t,1/this.length(t))},angle:function(t,e){return Math.atan2(this.perpDot(t,e),this.dot(t,e))},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},perpDot:function(t,e){return t[0]*e[1]-t[1]*e[0]},atan2:function(t,e){return Math.atan2(e[1]-t[1],e[0]-t[0])},sub:function(t,e){return[t[0]-e[0],t[1]-e[1]]},add:function(t,e){return[t[0]+e[0],t[1]+e[1]]},scale:function(t,e){return[t[0]*e,t[1]*e]},rotate:function(t,e){var n=this.length(t);return e=Math.atan2(t[1],t[0])+e,[Math.cos(e)*n,Math.sin(e)*n]},reflect:function(){return[0,0]},project:function(){return[0,0]},normal:function(t,e){var n=this.sub(e,t);return n=this.scale(n,1/this.length(n)),[[-n[1],n[0]],[n[1],-n[0]]]},intersectLineLine:function(t,e,n,s){var r=this.sub(e,t),o=this.sub(s,n),i=this.perpDot(o,r);if(i!=0){var a=this.perpDot(this.sub(t,n),o)/i,l=this.perpDot(this.sub(t,n),r)/i;if(!(a<0||l<0||a>1||l>1))return[a,l]}},intersectSphereSphere:function(t,e,n,s,r,o){var i=this.sub(e,t),a=this.sub(s,n),l=r+o,c=this.dot(i,i),u=l*l,d=this.dot(a,a);if(d!=0){var h=2*this.dot(a,i),f=c-u;if(c<=u)return[0,0];var p=h*h-4*d*f;if(!(p<0)){p=Math.sqrt(p);var g=(-h-p)/(2*d),x=(-h+p)/(2*d);return g<x?[g,x]:[x,g]}}},intersectSphereLine:function(t,e,n,s,r){var o=this.sub(r,s),i=n/Math.sqrt(this.dot(o,o)),a=this.scale([-o[1],o[0]],i),l=this.scale([o[1],-o[0]],i);a=this.add(t,a),l=this.add(t,l);var c=[this.intersectLineLine(a,this.add(a,e),s,r),this.intersectLineLine(l,this.add(l,e),s,r)];if(!c[0]||!c[1])return c[0]||c[1];if(!(!c[0]&&!c[1])&&(c[0][0]<c[1][0]?c=c[0]:c=c[1],!(c[0][0]<0||c[1]<0)&&c[0]<=1&&c[1]<=1))return c}};class Lae{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,n){let s=this.length++;for(;s>0;){const r=s-1>>1,o=this.values[r];if(n>=o)break;this.ids[s]=this.ids[r],this.values[s]=o,s=r}this.ids[s]=e,this.values[s]=n}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const n=this.ids[0]=this.ids[this.length],s=this.values[0]=this.values[this.length],r=this.length>>1;let o=0;for(;o<r;){let i=(o<<1)+1;const a=i+1;let l=this.ids[i],c=this.values[i];const u=this.values[a];if(a<this.length&&u<c&&(i=a,l=this.ids[a],c=u),c>=s)break;this.ids[o]=l,this.values[o]=c,o=i}this.ids[o]=n,this.values[o]=s}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const Yk=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Lg=3;class Tv{static from(e,n=0){if(n%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!e||e.byteLength===void 0||e.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[s,r]=new Uint8Array(e,n+0,2);if(s!==251)throw new Error("Data does not appear to be in a Flatbush format.");const o=r>>4;if(o!==Lg)throw new Error(`Got v${o} data when expected v${Lg}.`);const i=Yk[r&15];if(!i)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,n+2,1),[l]=new Uint32Array(e,n+4,1);return new Tv(l,a,i,void 0,e,n)}constructor(e,n=16,s=Float64Array,r=ArrayBuffer,o,i=0){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.byteOffset=i;let a=e,l=a;this._levelBounds=[a*4];do a=Math.ceil(a/this.nodeSize),l+=a,this._levelBounds.push(l*4);while(a!==1);this.ArrayType=s,this.IndexArrayType=l<16384?Uint16Array:Uint32Array;const c=Yk.indexOf(this.ArrayType),u=l*4*this.ArrayType.BYTES_PER_ELEMENT;if(c<0)throw new Error(`Unexpected typed array class: ${s}.`);o&&o.byteLength!==void 0&&!o.buffer?(this.data=o,this._boxes=new this.ArrayType(this.data,i+8,l*4),this._indices=new this.IndexArrayType(this.data,i+8+u,l),this._pos=l*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new r(8+u+l*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,l*4),this._indices=new this.IndexArrayType(this.data,8+u,l),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(Lg<<4)+c]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e),this._queue=new Lae}add(e,n,s=e,r=n){const o=this._pos>>2,i=this._boxes;return this._indices[o]=o,i[this._pos++]=e,i[this._pos++]=n,i[this._pos++]=s,i[this._pos++]=r,e<this.minX&&(this.minX=e),n<this.minY&&(this.minY=n),s>this.maxX&&(this.maxX=s),r>this.maxY&&(this.maxY=r),o}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const e=this._boxes;if(this.numItems<=this.nodeSize){e[this._pos++]=this.minX,e[this._pos++]=this.minY,e[this._pos++]=this.maxX,e[this._pos++]=this.maxY;return}const n=this.maxX-this.minX||1,s=this.maxY-this.minY||1,r=new Uint32Array(this.numItems),o=65535;for(let i=0,a=0;i<this.numItems;i++){const l=e[a++],c=e[a++],u=e[a++],d=e[a++],h=Math.floor(o*((l+u)/2-this.minX)/n),f=Math.floor(o*((c+d)/2-this.minY)/s);r[i]=Vae(h,f)}D1(r,e,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,a=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;a<l;){const c=a;let u=e[a++],d=e[a++],h=e[a++],f=e[a++];for(let p=1;p<this.nodeSize&&a<l;p++)u=Math.min(u,e[a++]),d=Math.min(d,e[a++]),h=Math.max(h,e[a++]),f=Math.max(f,e[a++]);this._indices[this._pos>>2]=c,e[this._pos++]=u,e[this._pos++]=d,e[this._pos++]=h,e[this._pos++]=f}}}search(e,n,s,r,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let i=this._boxes.length-4;const a=[],l=[];for(;i!==void 0;){const c=Math.min(i+this.nodeSize*4,Jk(i,this._levelBounds));for(let u=i;u<c;u+=4){if(s<this._boxes[u]||r<this._boxes[u+1]||e>this._boxes[u+2]||n>this._boxes[u+3])continue;const d=this._indices[u>>2]|0;i>=this.numItems*4?a.push(d):(o===void 0||o(d))&&l.push(d)}i=a.pop()}return l}neighbors(e,n,s=1/0,r=1/0,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let i=this._boxes.length-4;const a=this._queue,l=[],c=r*r;e:for(;i!==void 0;){const u=Math.min(i+this.nodeSize*4,Jk(i,this._levelBounds));for(let d=i;d<u;d+=4){const h=this._indices[d>>2]|0,f=Qk(e,this._boxes[d],this._boxes[d+2]),p=Qk(n,this._boxes[d+1],this._boxes[d+3]),g=f*f+p*p;g>c||(i>=this.numItems*4?a.push(h<<1,g):(o===void 0||o(h))&&a.push((h<<1)+1,g))}for(;a.length&&a.peek()&1;)if(a.peekValue()>c||(l.push(a.pop()>>1),l.length===s))break e;i=a.length?a.pop()>>1:void 0}return a.clear(),l}}function Qk(t,e,n){return t<e?e-t:t<=n?0:t-n}function Jk(t,e){let n=0,s=e.length-1;for(;n<s;){const r=n+s>>1;e[r]>t?s=r:n=r+1}return e[n]}function D1(t,e,n,s,r,o){if(Math.floor(s/o)>=Math.floor(r/o))return;const i=t[s+r>>1];let a=s-1,l=r+1;for(;;){do a++;while(t[a]<i);do l--;while(t[l]>i);if(a>=l)break;Bae(t,e,n,a,l)}D1(t,e,n,s,l,o),D1(t,e,n,l+1,r,o)}function Bae(t,e,n,s,r){const o=t[s];t[s]=t[r],t[r]=o;const i=4*s,a=4*r,l=e[i],c=e[i+1],u=e[i+2],d=e[i+3];e[i]=e[a],e[i+1]=e[a+1],e[i+2]=e[a+2],e[i+3]=e[a+3],e[a]=l,e[a+1]=c,e[a+2]=u,e[a+3]=d;const h=n[s];n[s]=n[r],n[r]=h}function Vae(t,e){let n=t^e,s=65535^n,r=65535^(t|e),o=t&(e^65535),i=n|s>>1,a=n>>1^n,l=r>>1^s&o>>1^r,c=n&r>>1^o>>1^o;n=i,s=a,r=l,o=c,i=n&n>>2^s&s>>2,a=n&s>>2^s&(n^s)>>2,l^=n&r>>2^s&o>>2,c^=s&r>>2^(n^s)&o>>2,n=i,s=a,r=l,o=c,i=n&n>>4^s&s>>4,a=n&s>>4^s&(n^s)>>4,l^=n&r>>4^s&o>>4,c^=s&r>>4^(n^s)&o>>4,n=i,s=a,r=l,o=c,l^=n&r>>8^s&o>>8,c^=s&r>>8^(n^s)&o>>8,n=l^l>>1,s=c^c>>1;let u=t^e,d=s|65535^(u|n);return u=(u|u<<8)&16711935,u=(u|u<<4)&252645135,u=(u|u<<2)&858993459,u=(u|u<<1)&1431655765,d=(d|d<<8)&16711935,d=(d|d<<4)&252645135,d=(d|d<<2)&858993459,d=(d|d<<1)&1431655765,(d<<1|u)>>>0}function Wae(t){return{searchSoldiers:Zk(t.queryObjects("Soldier")),searchArrows:Zk(t.queryObjects("Arrow").filter(e=>e.isHit()))}}function Zk(t,e){t=[...t];const n=t.length===0?void 0:new Tv(t.length);for(const o of t)n==null||n.add(o.vec[0],o.vec[1],o.vec[0],o.vec[1]);n==null||n.finish();const s=new Map;return{byRect:o=>(n==null?void 0:n.search(o.left,o.top,o.right,o.bottom).map(i=>t[i]))??[],byRadius:(o,i)=>(n==null?void 0:n.neighbors(o[0],o[1],void 0,i).map(a=>t[a]))??[],byProperty:(o,i)=>{if(!s.has(o)){const a=s.set(o,new Map).get(o);t.forEach(l=>{if(o in l){const c=l[o];a.has(c)||a.set(c,[]),a.get(c).push(l)}})}return s.get(o).get(i)??[]},resetPropertyCache:()=>{s.clear()}}}const Gf=class Gf{constructor(e,n,s,r,o){se(this,"id");se(this,"vec");se(this,"direction");se(this,"objectWidth");se(this,"objectHeight");this.id=String(Gf.idCounter++),this.vec=[e,n],this.direction=o,this.objectWidth=s,this.objectHeight=r}getTargetVelocity(){}update(e){}render(e){e.save().translate(-this.getWidth()/2,-this.getHeight()/2).fillRect(0,0,this.getWidth(),this.getHeight()).restore()}getX(){return this.vec[0]}setX(e){this.vec[0]=e}getY(){return this.vec[1]}setY(e){this.vec[1]=e}getDirection(){return this.direction}setDirection(e){this.direction=e}getWidth(){return this.objectWidth}getHeight(){return this.objectHeight}getClass(){return"Object"}};se(Gf,"idCounter",0);let ou=Gf;const eS={arrow:[10,1],ball:[10,10]};class VD extends ou{constructor(n,s,r,o,i){super(n[0],n[1],eS[i][0],eS[i][1],we.atan2(n,s));se(this,"world");se(this,"from");se(this,"to");se(this,"maxDist");se(this,"attackBase");se(this,"type");se(this,"v");se(this,"adir");se(this,"ay");this.world=r,this.from=n,this.to=s,this.maxDist=we.distance(n,s),this.attackBase=o,this.type=i,this.v=we.normalize(we.sub(s,n))}update(n){var s=we.scale(this.v,n*20);this.vec[0]+=s[0],this.vec[1]+=s[1];var r=Math.sin(we.distance(this.from,this.vec)/this.maxDist*Math.PI);this.adir=this.direction-Math.PI/3*(1-r),this.ay=this.vec[1]-r*this.maxDist/10,we.distance(this.from,this.vec)>this.maxDist&&this.world.removeObject(this)}getY(){return this.ay}getDirection(){return this.adir}isHit(){return this.maxDist-we.distance(this.from,this.vec)<10}hit(n,s){n.hitByArrow(this,s)}getAttack(){return this.attackBase}getClass(){return"Arrow"}}class Uae extends ou{constructor(n,s,r){super(n[0],n[1],za*2,za*2,0);se(this,"time");se(this,"world");this.time=s,this.world=r}render(n){var s=this.world.getTime()-this.time;s<100&&n.save().arc(0,0,za*Math.min(s/100,1)).restore()}getClass(){return"Explosion"}}class Gae{constructor(e){se(this,"soldier");se(this,"velocity",0);se(this,"targetVelocity",1);se(this,"force",[0,0]);se(this,"targetDirection");this.soldier=e,this.targetDirection=e.getDirection()}update(e){this.updateVelocity(e),this.updatePosition(e),this.updateDirection(e),this.updateForce(e)}updateVelocity(e){this.velocity=this.getTargetVelocity()*e+this.velocity*(1-e)}updatePosition(e){this.soldier.setX(this.soldier.getX()+this.force[0]*e),this.soldier.setY(this.soldier.getY()+this.force[1]*e)}updateDirection(e){const n=Math.cos(this.soldier.getDirection())*(1-e),s=Math.sin(this.soldier.getDirection())*(1-e),r=Math.cos(this.targetDirection)*e,o=Math.sin(this.targetDirection)*e;this.soldier.setDirection(Math.atan2(s+o,n+r))}updateForce(e){this.soldier.state.isAlive()&&this.addForce(we.scale([Math.cos(this.soldier.getDirection()),Math.sin(this.soldier.getDirection())],this.velocity*(1-Math.random())*e/2)),this.force=we.sub(this.force,we.scale(this.force,e*.1)),we.length(this.force)<we.EPSILON&&(this.force=[0,0])}setTargetDirection(e){this.targetDirection=e}setTargetVelocity(e){this.targetVelocity=e*this.soldier.state.baseSpeed}getTargetVelocity(){return this.targetVelocity}getVelocity(){return this.velocity}addForce(e){this.force=we.add(this.force,e)}distance(e){return we.distance(this.soldier.vec,e.vec)}}function Hae(){this.setSettings=function(t){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=t[e]||0;this.c<.01&&(this.c=.01);var n=this.b+this.c+this.e;if(n<.18){var s=.18/n;this.b*=s,this.c*=s,this.e*=s}}}function jae(){this._params=new Hae;var t,e,n,s,r,o,i,a,l,c,u,d;this.reset=function(){var h=this._params;s=100/(h.f*h.f+.001),r=100/(h.g*h.g+.001),o=1-h.h*h.h*h.h*.01,i=-h.i*h.i*h.i*1e-6,h.a||(u=.5-h.n/2,d=-h.o*5e-5),a=1+h.l*h.l*(h.l>0?-.9:10),l=0,c=h.m==1?0:(1-h.m)*(1-h.m)*2e4+32},this.totalReset=function(){this.reset();var h=this._params;return t=h.b*h.b*1e5,e=h.c*h.c*1e5,n=h.e*h.e*1e5+12,((t+e+n)/3|0)*3},this.synthWave=function(h,f){var p=this._params,g=p.s!=1||p.v,x=p.v*p.v*.1,m=1+p.w*3e-4,y=p.s*p.s*p.s*.1,w=1+p.t*1e-4,v=p.s!=1,b=p.x*p.x,C=p.g,k=p.q||p.r,S=p.r*p.r*p.r*.2,$=p.q*p.q*(p.q<0?-1020:1020),N=p.p?((1-p.p)*(1-p.p)*2e4|0)+32:0,A=p.d,M=p.j/2,L=p.k*p.k*.01,V=p.a,B=t,U=1/t,K=1/e,R=1/n,z=5/(1+p.u*p.u*20)*(.01+y);z>.8&&(z=.8),z=1-z;var G=!1,X=0,q=0,Q=0,ee=0,J=0,ne,ie=0,ce,ue=0,xe,be=0,ke,He=0,Te,Me,Be=0,qe=new Array(1024),Ge=new Array(32);for(let Ut=qe.length;Ut--;)qe[Ut]=0;for(let Ut=Ge.length;Ut--;)Ge[Ut]=Math.random()*2-1;for(var Pn=0;Pn<f;Pn++){if(G)return Pn;if(N&&++He>=N&&(He=0,this.reset()),c&&++l>=c&&(c=0,s*=a),o+=i,s*=o,s>r&&(s=r,C>0&&(G=!0)),ce=s,M>0&&(Be+=L,ce*=1+Math.sin(Be)*M),ce|=0,ce<8&&(ce=8),V||(u+=d,u<0?u=0:u>.5&&(u=.5)),++q>B)switch(q=0,++X){case 1:B=e;break;case 2:B=n}switch(X){case 0:Q=q*U;break;case 1:Q=1+(1-q*K)*2*A;break;case 2:Q=1-q*R;break;case 3:Q=0,G=!0}k&&($+=S,xe=$|0,xe<0?xe=-xe:xe>1023&&(xe=1023)),g&&m&&(x*=m,x<1e-5?x=1e-5:x>.1&&(x=.1)),Me=0;for(var _t=8;_t--;){if(ue++,ue>=ce&&(ue%=ce,V==3))for(var _s=Ge.length;_s--;)Ge[_s]=Math.random()*2-1;switch(V){case 0:Te=ue/ce<u?.5:-.5;break;case 1:Te=1-ue/ce*2;break;case 2:ke=ue/ce,ke=(ke>.5?ke-1:ke)*6.28318531,Te=1.27323954*ke+.405284735*ke*ke*(ke<0?1:-1),Te=.225*((Te<0?-1:1)*Te*Te-Te)+Te;break;case 3:Te=Ge[Math.abs(ue*32/ce|0)]}g&&(ne=ie,y*=w,y<0?y=0:y>.1&&(y=.1),v?(J+=(Te-ie)*y,J*=z):(ie=Te,J=0),ie+=J,ee+=ie-ne,ee*=1-x,Te=ee),k&&(qe[be%1024]=Te,Te+=qe[(be-xe+1024)%1024],be++),Me+=Te}Me*=.125*Q*b,h[Pn]=Me>=1?32767:Me<=-1?-32768:Me*32767|0}return f}}var Bg=new jae;const Kae=function(t){Bg._params.setSettings(t);var e=Bg.totalReset(),n=new Uint8Array(((e+1)/2|0)*4+44),s=Bg.synthWave(new Uint16Array(n.buffer,44),e)*2,r=new Uint32Array(n.buffer,0,44);r[0]=1179011410,r[1]=s+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=s,s+=44;for(var o=0,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a="data:audio/wav;base64,";o<s;o+=3){var l=n[o]<<16|n[o+1]<<8|n[o+2];a+=i[l>>18]+i[l>>12&63]+i[l>>6&63]+i[l&63]}return a},Vg=typeof window<"u";class Xae{constructor(){this.sounds={},Vg&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext))}async add(e,n,s){if(Vg){this.sounds[e]=[];for(let r=0;r<s.length;r++){const o={tick:0,count:n,buffers:[]};for(let i=0;i<n;i++){const a=Kae(s[r]),l=await this.base64ToArrayBuffer(a),c=await this.audioContext.decodeAudioData(l);o.buffers.push(c)}this.sounds[e].push(o)}}}play(e){if(!Vg)return;const n=this.sounds[e],s=n.length>1?n[Math.floor(Math.random()*n.length)]:n[0],r=this.audioContext.createBufferSource();r.buffer=s.buffers[s.tick];const o=this.audioContext.createGain();r.connect(o),o.connect(this.audioContext.destination),r.start(0),s.tick<s.count-1?s.tick++:s.tick=0}async base64ToArrayBuffer(e){const n=e.split(",")[1],s=atob(n),r=s.length,o=new Uint8Array(r);for(let i=0;i<r;i++)o[i]=s.charCodeAt(i);return o.buffer}}const gl=new Xae;gl.add("arrow",10,[[0,.13,.12,.21,.28,.7097,.11,.4399,,,,.2845,.6608,,,,,,1,,,,,.32]]);gl.add("hitarrow",10,[[2,,.0664,,.1176,.7984,,-.5791,,,,,,,,,,,1,,,.0922,,.47]]);gl.add("damage",10,[[3,,.0421,,.1467,.7815,,-.4846,,,,,,.4464,,,,,1,,,.2247,,.47]]);class WD{constructor(e,n,s,r,o,i,a,l="blood"){se(this,"gravity",5);this.x=e,this.y=n,this.z=s,this.velocityX=r,this.velocityY=o,this.velocityZ=i,this.life=a,this.type=l}update(e){this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.z=Math.max(this.z+this.velocityZ*e,0),this.type==="smoke"?(this.velocityX*=.99,this.velocityY*=.99,this.velocityZ=Math.max(this.velocityZ-1*e,.5)):(this.velocityX*=.98,this.velocityY*=.98,this.velocityZ-=this.gravity*e),this.life-=e}isAlive(){return this.life>0}isDead(){return this.type==="smoke"?this.life<=0:this.life<=0&&this.z<=0&&Math.abs(this.velocityX)<.01&&Math.abs(this.velocityY)<.01}}const Wg=typeof window<"u";class qae{constructor(e,n){se(this,"particles",[]);se(this,"deadParticlesCanvas");se(this,"deadParticlesContext");Wg&&(this.deadParticlesCanvas=document.createElement("canvas"),this.deadParticlesCanvas.width=e,this.deadParticlesCanvas.height=n,this.deadParticlesContext=this.deadParticlesCanvas.getContext("2d"),this.deadParticlesContext.translate(e/2,n/2))}addParticle(e){Wg&&this.particles.push(e)}update(e){if(!Wg)return;const n=[];this.particles=this.particles.filter(s=>(s.update(e),s.isDead()?(s.type==="blood"&&n.push(s),!1):!0)),this.renderDeadParticles(n)}renderDeadParticles(e){const n=new Path2D;e.forEach(s=>{s.type==="blood"&&(n.moveTo(s.x,s.y-s.z),n.arc(s.x,s.y-s.z,1,0,Math.PI*2),n.closePath())}),this.deadParticlesContext&&(this.deadParticlesContext.fillStyle="red",this.deadParticlesContext.fill(n))}renderDead(e){this.deadParticlesCanvas&&e.drawImage(this.deadParticlesCanvas,-this.deadParticlesCanvas.width/2,-this.deadParticlesCanvas.height/2)}renderActive(e){e.save();const n=new Path2D,s=new Path2D;this.particles.forEach(r=>{const o=r.type==="smoke"?s:n;o.moveTo(r.x,r.y-r.z),o.arc(r.x,r.y-r.z,r.type==="smoke"?Math.min(r.life,2):1,0,Math.PI*2),o.closePath()}),e.fillStyle("red"),e.fill(n),e.fillStyle("rgba(128, 128, 128, 0.5)"),e.fill(s),e.restore()}}function Yae([t,e],[n,s],r){const[o,i]=we.scale(we.normalize([t-n,e-s]),5),a=30+Math.random()*10;for(let l=0;l<a;l++){const c=(Math.random()-Math.random())*2+o,u=(Math.random()-Math.random())*2+i,d=Math.random()*10+5,h=50+Math.random()*5,f=new WD(t,e,0,c,u,d,h,"smoke");r.addParticle(f)}}class Qae{constructor(e){se(this,"soldier");se(this,"enemy",null);this.soldier=e}seekEnemy(e=this.soldier.state.seekRange){if(this.enemy&&(this.enemy.state.life<=0||this.enemy.distance(this.soldier)>e)&&this.clearEnemy(),!this.enemy&&this.soldier.state.cooldown("seek-"+e,Mz)&&this.setEnemy(this.queryEnemy(e)),this.enemy){const n=this.enemy.vec,s=we.distance(this.soldier.vec,n),r=we.atan2(this.soldier.vec,n);this.soldier.movement.setTargetDirection(r);let o=0;return this.soldier.state.canCharge&&s>50&&s<e&&!this.soldier.state.cooldown("charge",10)&&(o+=1),this.soldier.movement.setTargetVelocity(this.soldier.state.isMelee||s>this.soldier.state.attackRange?1+o:0),this.soldier.state.rangeAttack&&s<this.soldier.state.attackRange&&s>zz&&this.soldier.state.cooldown("arrow",this.soldier.state.rangedCooldown)&&(this.soldier.world.addObject(new VD(this.soldier.vec,this.enemy.vec,this.soldier.world,this.soldier.state.rangeAttack,this.soldier.state.rangeType)),gl.play("arrow"),this.soldier.type==="artillery"&&(this.soldier.state.hitBy(50),Yae(this.soldier.vec,this.enemy.vec,this.soldier.world.particles))),s<H0&&this.soldier.state.cooldown("sword",this.soldier.state.meleeAttackCooldown)&&this.soldier.attack.hit(this.enemy),!0}return!1}queryEnemy(e){const n=this.soldier.world.queryObjects("Soldier",s=>s.isEnemy(this.soldier)&&s.state.life>0&&we.withinDistance(s.vec,this.soldier.vec,e)&&this.soldier.plan.canClaim(s,this.soldier));if(n.length>0){const s=this.soldier.type==="artillery"?(r,o)=>o.distance(this.soldier)>r.distance(this.soldier)?o:r:(r,o)=>o.distance(this.soldier)<r.distance(this.soldier)?o:r;return n.reduce(s,n[0])}return null}setEnemy(e){this.enemy&&(this.soldier.plan.unclaim(this.enemy,this.soldier),this.enemy=null),e&&this.soldier.plan.claim(e,this.soldier)&&(this.enemy=e)}clearEnemy(){this.setEnemy(null)}hasEnemy(){return this.enemy!==null}getEnemy(){return this.enemy}}function tS([t,e],[n,s],r,o){const[i,a]=we.scale(we.normalize([t-n,e-s]),15);for(let l=0;l<r+2;l++){const c=(Math.random()-Math.random())*5+i,u=(Math.random()-Math.random())*5+a,d=Math.random()*15,h=.5,f=new WD(t,e,0,c,u,d,h);o.addParticle(f)}}class Jae{constructor(e){se(this,"soldier");this.soldier=e}hit(e){const n=(this.soldier.state.cooldown("defence",this.soldier.state.defenceCooldown)?this.getDefence(e,this.soldier.state.meleeDefence):1)*this.getAttack(e);e.state.hitBy(n),ht(R1,{soldier:e,damage:n}),e.targeting.setEnemy(this.soldier),gl.play("damage"),tS(e.vec,this.soldier.vec,n/5,this.soldier.world.particles)}hitByArrow(e,n){let s;e.type==="ball"?s=e.getAttack()/Math.pow(n,1/4):s=e.getAttack()*(this.soldier.state.cooldown("defence",this.soldier.state.defenceCooldown)?this.getDefence(e,this.soldier.state.rangeDefence):1),this.soldier.state.hitBy(s),ht(A1,{soldier:this.soldier,damage:s}),gl.play("hitarrow"),tS(this.soldier.vec,e.vec,s/5,this.soldier.world.particles)}getDefence(e,n){const s=Math.abs(we.angle(we.sub(e.vec,this.soldier.vec),[Math.cos(this.soldier.getDirection()),Math.sin(this.soldier.getDirection())]))/Math.PI;return Math.min(s/n,.3)}getAttack(e){return(1-this.getDefence(e,this.soldier.state.meleeDefence))*this.soldier.state.meleeAttack}}class Zae{constructor(e){se(this,"soldier");se(this,"life",tl);se(this,"newLife",tl);se(this,"defenceCooldown",U$);se(this,"weight",1);se(this,"baseSpeed",1);se(this,"seekRange",0);se(this,"attackRange",0);se(this,"rangeDefence",0);se(this,"meleeDefence",0);se(this,"meleeAttack",0);se(this,"meleeAttackCooldown",Oz);se(this,"rangeAttack");se(this,"rangedCooldown");se(this,"canCharge",!1);se(this,"isMelee",!1);se(this,"rangeType");se(this,"cooldowns",{});this.soldier=e}setProperties(e){Object.assign(this,e)}update(e){this.life=this.newLife}cooldown(e,n){return!this.cooldowns[e]||this.soldier.world.getTime()>this.cooldowns[e]?(this.cooldowns[e]=this.soldier.world.getTime()+n,!0):!1}hitBy(e){this.newLife=Math.max(this.newLife-e,0)}isAlive(){return this.life>0}}class ele{constructor(e){se(this,"soldier");this.soldier=e}render(e){e.save().translate(-this.soldier.getWidth()/2,-this.soldier.getHeight()/2).drawImage(this.soldier.state.isAlive()?this.soldier.image:this.soldier.imageDead,0,0),this.soldier.state.isAlive()&&(this.soldier.state.life<tl&&e.drawText(10,0,String(this.soldier.state.life<<0)),e.fillStyle(this.soldier.color).fillRect(0,10,10,5*this.soldier.state.life/tl)),e.restore()}}function li(t,e){return tle(t,e)[0]}function tle(t,e){return typeof document<"u"?(e||document.body).querySelectorAll(t):[]}let nle=0;class Fh extends ou{constructor(n,s,r,o,i,a,l){r+=(Math.random()-Math.random())/1e3;super(n,s,is,Wr,r);se(this,"soldierId");se(this,"plan");se(this,"world");se(this,"type");se(this,"color");se(this,"image");se(this,"imageDead");se(this,"movement");se(this,"targeting");se(this,"attack");se(this,"state");se(this,"soldierRender");this.soldierId=nle++,this.plan=o,this.world=i,this.type=l,this.color=a,this.image=li("#asset-soldier-"+this.type),this.imageDead=li("#asset-soldier-"+this.type+"-dead"),this.movement=new Gae(this),this.targeting=new Qae(this),this.attack=new Jae(this),this.state=new Zae(this),this.soldierRender=new ele(this),this.initializeTypeSpecificProperties()}initializeTypeSpecificProperties(){switch(this.type){case"warrior":this.initializeWarrior();break;case"tank":this.initializeTank();break;case"archer":this.initializeArcher();break;case"artillery":this.initializeArtillery();break}}initializeWarrior(){this.state.setProperties({seekRange:eC,attackRange:H0,rangeDefence:30,meleeDefence:50,meleeAttack:25,baseSpeed:3,canCharge:!0,isMelee:!0})}initializeTank(){this.state.setProperties({seekRange:eC,attackRange:H0*1.1,rangeDefence:100,meleeDefence:100,meleeAttack:15,life:tl*2,newLife:tl*2,defenceCooldown:U$/5,weight:3,canCharge:!1,isMelee:!0})}initializeArcher(){this.state.setProperties({seekRange:nC,attackRange:tC,rangeAttack:45,rangeDefence:25,rangedCooldown:sC,meleeDefence:10,meleeAttack:10,rangeType:"arrow"})}initializeArtillery(){this.state.setProperties({seekRange:nC,attackRange:tC*5,weight:10,baseSpeed:.1,rangeAttack:100,rangeDefence:1,rangedCooldown:sC*10,meleeDefence:1,meleeAttack:1,rangeType:"ball"})}update(n){this.state.isAlive()?this.updatePlan():this.targeting.hasEnemy()&&this.targeting.clearEnemy(),this.movement.update(n),this.state.update(n)}updatePlan(){this.targeting.seekEnemy()||this.plan.getCommand(this.world.getTime()).execute(this)}render(n){this.soldierRender.render(n)}distance(n){return this.movement.distance(n)}hitByArrow(n,s){this.attack.hitByArrow(n,s)}isEnemy(n){return this.plan.masterPlan!==n.plan.masterPlan}getClass(){return"Soldier"}}class sle{constructor(){se(this,"objects");se(this,"objectsByType");se(this,"collisionHandlers");se(this,"edgeRadius");se(this,"worldTime");se(this,"particles");this.objects=[],this.objectsByType={Soldier:[],Arrow:[],Explosion:[]},this.collisionHandlers=[],this.edgeRadius=uo*1.5,this.particles=new qae(uo*3,uo*2),this.worldTime=0,this.onCollision(Fh,Fh,this.onSoldierCollision.bind(this)),this.onCollision(Fh,VD,this.onArrowCollision.bind(this))}destroy(){}getTime(){return this.worldTime}getEdgeRadius(){return this.edgeRadius}addObject(...e){for(var n of e)this.objects.push(n),this.objectsByType[n.getClass()].push(n)}removeObject(e){this.objects.splice(this.objects.indexOf(e),1)}queryObjects(e,n){return this.objectsByType[e].filter(s=>!n||n(s))}update(e){var n=Math.min(e,_z);return this.objects.forEach(s=>{this.updateObject(s,n/Zb)}),e-=n,this.worldTime+=n,this.collisions(),this.edgeRadius=Math.max(uo*1.5*(1-this.getTime()/6e4),400),this.particles.update(n/Zb),e}collisions(){const e=Wae(this),n={},s=this.queryObjects("Arrow",r=>r.isHit());this.queryObjects("Soldier").forEach(r=>{r.state.life<=0||(e.searchSoldiers.byRadius(r.vec,r.getWidth()).forEach(o=>{o.state.life<=0||r===o||n[r.id+o.id]||n[o.id+r.id]||(n[r.id+o.id]=!0,we.withinDistance(r.vec,o.vec,r.getWidth())&&this.triggerCollisions(r,o))}),e.searchArrows.byRadius(r.vec,Math.max(rC,za)).forEach(o=>{o&&we.withinDistance(r.vec,o.vec,o.type==="arrow"?rC:za)&&this.triggerCollisions(r,o)}),we.withinDistance(r.vec,[0,0],this.getEdgeRadius())||r.movement.addForce(we.scale(we.normalize(r.vec),-1)))},this),s.forEach(r=>{this.objects.splice(this.objects.indexOf(r),1),this.objectsByType.Arrow.splice(this.objectsByType.Arrow.indexOf(r),1),r.type==="ball"&&this.addObject(new Uae(r.vec,this.getTime(),this))})}triggerCollisions(e,n){this.collisionHandlers.forEach(function(s){e instanceof s.left&&n instanceof s.right&&s.handler(e,n),n instanceof s.left&&e instanceof s.right&&s.handler(n,e)})}onCollision(e,n,s){this.collisionHandlers.push({left:e,right:n,handler:s})}onSoldierCollision(e,n){var s=we.distance(e.vec,n.vec);if(s===0){var r=we.scale([Math.random()-Math.random(),Math.random()-Math.random()],1/Number.MAX_SAFE_INTEGER);e.movement.addForce(r),n.movement.addForce(we.scale(r,-1))}else{var o=we.scale(we.normalize(we.sub(e.vec,n.vec)),e.getWidth()-s);e.movement.addForce(we.scale(o,1/e.state.weight*n.state.weight)),n.movement.addForce(we.scale(o,-1*e.state.weight/n.state.weight))}}onArrowCollision(e,n){var s=we.distance(n.vec,e.vec);if(n.type==="arrow")n.hit(e,s);else if(n.type==="ball"&&e.state.cooldown("ballhit",150)){n.hit(e,s);var r=we.scale(we.normalize(we.sub(e.vec,n.vec)),e.getWidth()-s);e.movement.addForce(we.scale(r,-.5/e.state.weight*(1-s/za)))}}updateObject(e,n){e.update(n)}getAlive(){return this.queryObjects("Soldier",e=>e.state.life>0).reduce((e,n)=>(e[n.color]=(e[n.color]||0)+1,e),{"#ff0000":0,"#00ff00":0})}getBalance(){var e=this.getAlive(),n=Object.keys(this.getAlive());return e[n[0]]/(e[n[0]]+e[n[1]])}}class Ev{constructor(){se(this,"startTime",-1);se(this,"done",!1)}start(e){this.startTime=e}execute(e){}isDone(e){return this.done}}class _1 extends Ev{constructor(n){super();se(this,"duration");this.duration=n}isDone(n){return!!this.duration&&this.startTime>=0&&n-this.startTime>this.duration}execute(n){n.movement.setTargetVelocity(0)}}class Oh extends Ev{constructor(){super()}getTarget(e){return e.plan.formation}execute(e){var n=this.getTarget(e),s=we.distance(e.vec,n),r=we.atan2(e.vec,n);s>50?(e.movement.setTargetVelocity(1),e.movement.setTargetDirection(r)):(e.movement.setTargetVelocity(0),this.done=!0)}}class UD extends Oh{constructor(n){super();se(this,"angle");this.angle=n}getTarget(n){return we.add(we.rotate([200,100*Math.sign(Math.cos(this.angle))],this.angle),n.plan.formation)}}class rle extends UD{getTarget(e){return we.add(we.rotate([200,-100*Math.sign(Math.cos(this.angle))],this.angle),e.plan.formation)}}class da extends Ev{constructor(){super()}execute(e){e.targeting.seekEnemy(uo)||(this.done=!0)}}class ole{constructor(e,n,s){se(this,"masterPlan");se(this,"formation");se(this,"plan");se(this,"currentCommand");se(this,"claims");this.masterPlan=e,this.formation=n,this.plan=s,this.currentCommand=null,this.claims=e.claims}getPosition(){return this.formation}getCommand(e){return(!this.currentCommand||this.currentCommand.isDone(e))&&this.plan.length>0&&(this.currentCommand=this.plan.splice(0,1)[0],this.currentCommand.start(e)),this.currentCommand||(this.currentCommand=new _1),this.currentCommand}canClaim(e,n){if(this.claims[e.soldierId]||(this.claims[e.soldierId]=[]),this.claims[e.soldierId].length<5)return!0;var s=n.distance(e),r=this.claims[e.soldierId].filter(o=>o.distance(e)>s);return r.length===this.claims[e.soldierId].length}unclaim(e,n){var s=this.claims[e.soldierId].indexOf(n);s>=0&&this.claims[e.soldierId].splice(s,1)}claim(e,n){return this.canClaim(e,n)?(this.claims[e.soldierId].push(n),!0):!1}}class ile{constructor(e,n){se(this,"type");se(this,"formation");se(this,"plan");se(this,"claims");var s=we.atan2(e,[0,0]);this.type=[],this.formation=[],this.plan=[],this.claims={},n.forEach(r=>{for(var o=r.sizeCol*r.sizeRow,i=[r.col*is,r.row*Wr],a=0;a<o;a++){var l=[a%r.sizeCol*is,(a/r.sizeCol<<0)*Wr];switch(this.formation.push(we.add(l,i)),this.type.push(r.type),r.command){case"advance-wait":this.plan.push([new Oh,new _1(1e4),new da]);break;case"advance":this.plan.push([new Oh,new da]);break;case"wait-advance":this.plan.push([new _1(1e4),new da]);break;case"flank-left":this.plan.push([new UD(s),new da]);break;case"flank-right":this.plan.push([new rle(s),new da]);break;default:this.plan.push([new Oh,new da]);break}}})}getSoldierCount(){return this.formation.length}getType(e){return this.type[e]}getSolderPlan(e){return new ole(this,this.formation[e],this.plan[e])}}class ale{constructor(e){this.world=e,this.HUD=li("#game-hud"),this.battleTime=li("#battle-time"),this.battleResult=li("#battle-result"),this.balanceLeft=li("#battle-balance-left"),this.balanceRight=li("#battle-balance-right"),this.HUD.style.display="block"}destroy(){this.HUD.style.display="none",this.battleResult.innerHTML=""}getBalance(e){return e.getBalance()}setNames(e,n){this.balanceLeft.dataset.username=e||"",this.balanceRight.dataset.username=n||""}render(e){var n=60-e.getTime()/1e3<<0,s=1e3-e.getTime()%1e3<<0;this.battleTime.dataset.time=(n<10?"0":"")+n+":"+s;var r=this.getBalance(e);this.balanceLeft.style.width=r*100+"%",this.balanceLeft.dataset.winning=r>2/3,this.balanceRight.style.width=(1-r)*100+"%",this.balanceRight.dataset.winning=r<1/3}renderResults(e){var n=this.getBalance(e),s="</span>";if(n>1/3&&n<2/3)this.battleResult.innerHTML=`<div style="color: white">
                <span class="result">DRAW!${s}
                <span class="continue">Click to continue${s}
            </div>`;else{var r=n>.3333333333333333?"#ff0000":"#00ff00";return this.battleResult.innerHTML=`<div style="color: ${r}">
                <span class="result" style="background: ${r}">${n>2/3?"Victory":"Defeat"}!${s}
                <span class="winner">${n>2/3?this.balanceLeft.dataset.username:this.balanceRight.dataset.username} wins!${s}
                <span class="loser">${n>2/3?this.balanceRight.dataset.username:this.balanceLeft.dataset.username} defeated!${s}
                <span class="continue">Click to continue${s}
            </div>`,r}}showPause(){}}function GD(t){t=t||hu;var e=Wa.layers[t];return e||(Wa.layers[t]=new Wa(t))}function lle(t){t=t||hu;var e=Wa.layers[t];e&&(e.destroy(),delete Wa.layers[t])}class Wa{constructor(e){se(this,"element");se(this,"ctx");this.element=document.createElement("canvas"),this.element.id=e,this.element.width=uo*3,this.element.height=uo*2,this.ctx=this.element.getContext("2d"),document.body.appendChild(this.element)}destroy(){document.body.removeChild(this.element)}getWidth(){return this.element.width}getHeight(){return this.element.height}clear(){return this.ctx.clearRect(0,0,this.getWidth(),this.getHeight()),this}drawText(e,n,s){return this.ctx.fillStyle="white",this.ctx.font="11px serif",this.ctx.fillText(s,e-this.ctx.measureText(s).width/2,n),this}fillStyle(e){return this.ctx.fillStyle=e,this}strokeStyle(e){return this.ctx.strokeStyle=e,this}fillRect(e,n,s,r){return this.ctx.fillRect(e,n,s,r),this}arc(e,n,s){return this.ctx.beginPath(),this.ctx.arc(e,n,s,0,Math.PI*2),this.ctx.stroke(),this}line(e,n,s,r){return this.save(),this.ctx.beginPath(),this.ctx.moveTo(e,n),this.ctx.lineTo(s,r),this.ctx.stroke(),this.restore(),this}drawImage(e,n,s){return this.ctx.drawImage(e,n,s),this}fill(e){this.ctx.fill(e)}scale(e){return this.ctx.scale(e,e),this}translate(e,n){return this.ctx.translate(e,n),this}rotate(e){return this.ctx.rotate(e),this}save(){return this.ctx.save(),this}restore(){return this.ctx.restore(),this}getCtx(){return this.ctx}}se(Wa,"layers",{});function Rv(t){var e=GD(hu);e.clear(),e.save().translate(e.getWidth()/2,e.getHeight()/2),t.particles.renderDead(e),t.queryObjects("Soldier",n=>n.state.life===0).forEach(hh),t.queryObjects("Soldier",n=>n.state.life>0).forEach(hh),t.queryObjects("Arrow").forEach(hh),t.queryObjects("Explosion").forEach(hh),t.particles.renderActive(e),e.restore()}function hh(t){var e=GD(hu);e.save().fillStyle("red").translate(t.getX(),t.getY()).rotate(t.getDirection()),t.render(e),e.restore()}function nS(t,e,n,s){for(var r=Math.PI/2*e,o=[0,e*uo/2],i=new ile(o,s),a=0;a<i.getSoldierCount();a++){var l=i.getSolderPlan(a),c=l.getPosition();c=we.add(c,o),t.addObject(new Fh(c[0],c[1],r+Math.PI,l,t,n,i.getType(a)))}}function cle(t,e){var n=new sle;nS(n,1,"#ff0000",t),nS(n,-1,"#00ff00",e);var s=new ale(n);return s.setNames("Player","Computer"),function(o){if(Rv(n),s.render(n),o==OD)return ule(n,s)}}function ule(t,e){var n={[R1]:{"#ff0000":0,"#00ff00":0},[A1]:{"#ff0000":0,"#00ff00":0}},s=JSON.parse(JSON.stringify(n));return function(o,i){if(o==zD){for(var a=Math.min(i,1e3);a>0;)a=t.update(a);Rv(t)}if(o===PD&&e.render(t),o===LD){var l=e.getBalance(t);if(t.getTime()>6e4||l===0||l===1)return dle(t,e)}if(o===R1||o===A1){const{damage:c,soldier:u}=i;n[o][u.color]+=c,s[o][u.color]++}}}function dle(t,e){return e.renderResults(t),function(s){if(Rv(t),s===BD)return lle(hu),e.destroy(),mae("battleEnd"),HD()}}function HD(){return function(e,n){if(e==MD)return cle(n.playerUnits,n.oppositionUnits)}}let uc;function hle(){uc=HD()}function ht(t,e){var n=uc(t,e);n&&n!==uc&&(console.log("Transition from "+uc.name+" to "+n.name),uc=n)}document.addEventListener("visibilitychange",function(){document.hidden?ht(Cae):ht(kae)});window.addEventListener("resize",function(){ht(Sae)});function ha(t,e){ye.useEffect(()=>(window.addEventListener(t,e),()=>{window.removeEventListener(t,e)}),[t,e])}function fle(){return ha("keydown",function(t){t.keyCode==37&&ht(Aae),t.keyCode==38&&ht(_ae),t.keyCode==39&&ht(Dae),t.keyCode==40&&ht(Fae),t.keyCode==27&&ht(Iae),ht(Eae,t.keyCode)}),ha("keyup",function(t){t.keyCode==37&&ht(Oae),t.keyCode==38&&ht(Mae),t.keyCode==39&&ht(zae),t.keyCode==40&&ht(Pae),ht(Rae,t)}),ha("mousedown",function(t){ht($ae,t)}),ha("mouseup",function(t){ht(Nae,t)}),ha("mousemove",function(t){ht(Tae,t)}),ha("click",function(t){ht(BD,t)}),null}function ple({onBattleEnd:t,playerUnits:e,oppositionUnits:n}){ye.useEffect(()=>{hle(),ht(MD,{playerUnits:e,oppositionUnits:n});const r=setTimeout(()=>ht(OD),1e3),o=setInterval(()=>ht(PD),100),i=setInterval(()=>ht(LD),1e3);return()=>{clearTimeout(r),clearInterval(o),clearInterval(i)}},[]),gae("battleEnd",()=>{t()});const s=ye.useRef();return Dz(()=>{let r=Date.now();s.current&&ht(zD,r-s.current),s.current=r}),Se.jsxs(Se.Fragment,{children:[Se.jsx(bae,{}),Se.jsx(fle,{}),Se.jsx("img",{src:G$,id:"asset-soldier-warrior"}),Se.jsx("img",{src:xae,id:"asset-soldier-warrior-dead"}),Se.jsx("img",{src:H$,id:"asset-soldier-archer"}),Se.jsx("img",{src:yae,id:"asset-soldier-archer-dead"}),Se.jsx("img",{src:j$,id:"asset-soldier-tank"}),Se.jsx("img",{src:wae,id:"asset-soldier-tank-dead"}),Se.jsx("img",{src:K$,id:"asset-soldier-artillery"}),Se.jsx("img",{src:vae,id:"asset-soldier-artillery-dead"}),Se.jsxs("div",{id:"game-hud",children:[Se.jsxs("div",{id:"battle-stats",children:[Se.jsx("div",{id:"battle-time",children:" "}),Se.jsxs("div",{id:"battle-balance",children:[Se.jsx("div",{id:"battle-balance-left",children:" "}),Se.jsx("div",{id:"battle-balance-right",children:" "})]})]}),Se.jsx("div",{id:"battle-result"})]})]})}const mle=()=>{const[t,e]=ye.useState({name:"intro"}),n=()=>{e({name:"designer"})},s=(o,i)=>{e({name:"battle",playerUnits:o,oppositionUnits:i}),console.log("Battle started!")},r=()=>{e({name:"designer",playerUnits:t.name==="battle"?t.playerUnits:void 0})};return Se.jsxs(Us.StrictMode,{children:[Se.jsx(Iz,{}),(t==null?void 0:t.name)==="intro"&&Se.jsx(Ez,{onPlayClick:n}),(t==null?void 0:t.name)==="designer"&&Se.jsx(uae,{onStartBattle:s,initialPlayerUnits:t.playerUnits}),(t==null?void 0:t.name)==="battle"&&Se.jsx(ple,{onBattleEnd:r,playerUnits:t.playerUnits,oppositionUnits:t.oppositionUnits})]})},gle=Ug.createRoot(document.getElementById("root"));gle.render(Se.jsx(mle,{}));
